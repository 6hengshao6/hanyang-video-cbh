/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import"../../chunks/typedArrayUtil.js";import{i as t,a as e,u as s}from"../../chunks/maybe.js";import{l as r}from"../../chunks/arcadeOnDemand.js";import{d as o,e as l,f as i,h as a,c as n,a as c,b as m,g as u,i as p}from"../../chunks/utils6.js";import{S as h}from"../../chunks/previewUtils.js";import{g as d,a as b,r as y,b as f,c as j,d as k,e as g,f as S,h as L}from"../../chunks/renderUtils.js";import{i as w,c as v}from"../../chunks/widgetUtils.js";import{t as C}from"../../chunks/jsxFactory.js";import{getSymbolLayerFill as M}from"../../chunks/previewSymbol3D.js";import"../../geometry.js";import"../../chunks/ensureType.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../core/lang.js";import"../../chunks/string.js";import"../../geometry/Extent.js";import"../../chunks/tslib.es6.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/tracking.js";import"../../geometry/Geometry.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/ArrayPool.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../core/promiseUtils.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../chunks/Ellipsoid.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/common.js";import"../../chunks/vec4.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../symbols.js";import"../CIMSymbol.js";import"../../chunks/enumeration.js";import"../../layers/support/fieldUtils.js";import"../Symbol.js";import"../ExtrudeSymbol3DLayer.js";import"../Symbol3DLayer.js";import"../../chunks/utils2.js";import"../edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../edges/SketchEdges3D.js";import"../edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../FillSymbol.js";import"../SimpleLineSymbol.js";import"../LineSymbol.js";import"../LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../FillSymbol3DLayer.js";import"../patterns/LineStylePattern3D.js";import"../patterns/StylePattern3D.js";import"../../chunks/utils3.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../Font.js";import"../IconSymbol3DLayer.js";import"../../core/urlUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/Symbol3DAnchorPosition2D.js";import"../LabelSymbol3D.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../kernel.js";import"../../request.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../chunks/locale.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../portal/PortalGroup.js";import"../LineSymbol3DLayer.js";import"../LineStyleMarker3D.js";import"../../core/Clonable.js";import"../ObjectSymbol3DLayer.js";import"../PathSymbol3DLayer.js";import"../TextSymbol3DLayer.js";import"../WaterSymbol3DLayer.js";import"./StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../callouts/Callout3D.js";import"../callouts/LineCallout3D.js";import"./Symbol3DVerticalOffset.js";import"../LineSymbol3D.js";import"../MarkerSymbol.js";import"../MeshSymbol3D.js";import"../PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../PictureMarkerSymbol.js";import"../PointSymbol3D.js";import"../PolygonSymbol3D.js";import"../SimpleFillSymbol.js";import"../SimpleMarkerSymbol.js";import"../TextSymbol.js";import"../WebStyleSymbol.js";import"../../chunks/asyncUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/mat4f32.js";import"../../chunks/mat4.js";import"../../chunks/_commonjsHelpers.js";import"../../chunks/assets.js";import"../../chunks/ItemCache.js";import"../../chunks/MemCache.js";import"./cimSymbolUtils.js";import"../../chunks/utils7.js";import"../../chunks/colorUtils2.js";import"../../chunks/projector.js";import"../../chunks/mat2df32.js";import"../../chunks/mat2d.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/webStyleSymbolUtils.js";import"../../chunks/devEnvironmentUtils.js";import"./jsonUtils.js";import"../../chunks/layerUtils.js";import"../../chunks/styleUtils.js";const x="esri-relationship-ramp",U=`${x}--diamond`,H=`${x}--square`,T="http://www.w3.org/2000/svg",q={diamondContainer:`${U}__container`,diamondLeftCol:`${U}__left-column`,diamondRightCol:`${U}__right-column`,diamondMidCol:`${U}__middle-column`,diamondMidColLabel:`${U}__middle-column--label`,diamondMidColRamp:`${U}__middle-column--ramp`,squareTable:`${H}__table`,squareTableRow:`${H}__table-row`,squareTableCell:`${H}__table-cell`,squareTableLabel:`${H}__table-label`,squareTableLabelLeftBottom:`${H}__table-label--left-bottom`,squareTableLabelRightBottom:`${H}__table-label--right-bottom`,squareTableLabelLeftTop:`${H}__table-label--left-top`,squareTableLabelRightTop:`${H}__table-label--right-top`};function D(t,e,s,r){const{focus:l,labels:i}=t,a=!!l,n=function(t,e,s,r,l=60){const{focus:i,numClasses:a,colors:n,rotation:c}=t,m=!!i,u=Math.sqrt(l**2+l**2)+(m?0:5),p=[],h=[],S=[],L=(l||75)/a;for(let t=0;t<a;t++){const e=t*L;for(let s=0;s<a;s++){const r=s*L,o=d(n[t][s]),l=b(null),i={type:"rect",x:r,y:e,width:L,height:L},a=y(o);a&&p.push(a);const c=f(i,o.fill,l,null);c&&h.push(c),S.push(j(i))}}let w=null;m||(w="margin: -15px -15px -18px -15px");const v=$("left",i,e),M=$("right",i,e),x=k(S),U=g(x,u,u,0,!1,c,!1),H=g(x,u,u,0,!1,m?-45:null,!1),D={filter:o(r)??void 0,opacity:null==s?"":`${s}`};return C("div",{styles:D,class:m?q.diamondMidColRamp:q.squareTableCell},C("svg",{xmlns:T,width:u,height:u,style:w},C("defs",null,C("marker",{id:`${e}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},C("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),C("marker",{id:`${e}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},C("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),p),C("g",{transform:U},h),C("g",{transform:H},C("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":v.markerStart,"marker-end":v.markerEnd,x1:-10,y1:l-15,x2:-10,y2:15}),C("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":M.markerStart,"marker-end":M.markerEnd,x1:15,y1:l+10,x2:l-15,y2:l+10}))))}(t,e,s,r),c=w();return a?C("div",{class:q.diamondContainer,styles:{justifyContent:"center"}},C("div",{class:q.diamondLeftCol},c?i.right:i.left),C("div",{class:q.diamondMidCol},C("div",{class:q.diamondMidColLabel},i.top),n,C("div",{class:q.diamondMidColLabel},i.bottom)),C("div",{class:q.diamondRightCol},c?i.left:i.right)):C("div",{class:q.squareTable},C("div",{class:q.squareTableRow},C("div",{class:v(q.squareTableCell,q.squareTableLabel,q.squareTableLabelRightBottom)},c?i.top:i.left),C("div",{class:q.squareTableCell}),C("div",{class:v(q.squareTableCell,q.squareTableLabel,q.squareTableLabelLeftBottom)},c?i.left:i.top)),C("div",{class:q.squareTableRow},C("div",{class:q.squareTableCell}),n,C("div",{class:q.squareTableCell})),C("div",{class:q.squareTableRow},C("div",{class:v(q.squareTableCell,q.squareTableLabel,q.squareTableLabelRightTop)},c?i.right:i.bottom),C("div",{class:q.squareTableCell}),C("div",{class:v(q.squareTableCell,q.squareTableLabel,q.squareTableLabelLeftTop)},c?i.bottom:i.right)))}function $(t,e,s){const r=`${s}_arrowStart`,o=`${s}_arrowEnd`,l="left"===t,i={markerStart:null,markerEnd:null};switch(e){case"HL":l?i.markerStart=`url(#${o})`:i.markerEnd=`url(#${r})`;break;case"LL":i.markerStart=`url(#${o})`;break;case"LH":l?i.markerEnd=`url(#${r})`:i.markerStart=`url(#${o})`;break;default:i.markerEnd=`url(#${r})`}return i}const _={HH:315,HL:45,LL:135,LH:225},R={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function P(t){if(!t)return;const{type:e}=t;if(e.includes("3d"))return M(t.symbolLayers.getItemAt(0));if("simple-line"===e){const e=l(t);return e&&e.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const e=l(t);return e&&e.color}return i(t)}function E(t){const{focus:e,infos:s,numClasses:r}=t,o=R[r],l={};s.forEach((t=>{l[t.value]={label:t.label,fill:P(t.symbol)}}));const i=[];for(let t=0;t<r;t++){const e=[];for(let s=0;s<r;s++){const r=l[o[t][s]];e.push(r.fill)}i.push(e)}const a=function(t,e){const s=e.HH.label,r=e.LL.label,o=e.HL.label,l=e.LH.label;switch(t){case"HH":default:return{top:s,bottom:r,left:o,right:l};case"HL":return{top:o,bottom:l,left:r,right:s};case"LL":return{top:r,bottom:s,left:l,right:o};case"LH":return{top:l,bottom:o,left:s,right:r}}}(e,l);return{type:"relationship-ramp",numClasses:r,focus:e,colors:i,labels:a,rotation:V(e)}}function V(t){let e=_[t];return t&&null==e&&(e=_.HH),e||0}let A=null;const I=[255,255,255];function W(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function F(t,e,s){const{backgroundColor:r,outline:o,dotSize:l}=t,i=s&&s.swatchSize||h.size,a=Math.round(i*i/l**2*.8),n=window.devicePixelRatio,c=document.createElement("canvas"),m=i*n;c.width=m,c.height=m,c.style.width=c.width/n+"px",c.style.height=c.height/n+"px";const u=c.getContext("2d");if(r&&(u.fillStyle=r.toCss(!0),u.fillRect(0,0,m,m),u.fill()),u.fillStyle=e.toCss(!0),A&&A.length/2===a)for(let t=0;t<2*a;t+=2){const e=A[t],s=A[t+1];u.fillRect(e,s,l*n,l*n),u.fill()}else{A=[];for(let t=0;t<2*a;t+=2){const t=W(0,m),e=W(0,m);A.push(t,e),u.fillRect(t,e,l*n,l*n),u.fill()}}o&&(o.color&&(u.strokeStyle=o.color.toCss(!0)),u.lineWidth=o.width,u.strokeRect(0,0,m,m));const p=new Image(i,i);return p.src=c.toDataURL(),p}function O(t,e={}){const s=e.radius||40,r=2*Math.PI*s,o=t.length,i=r/o,a=[],n=l(e.outline);null!=n?.width&&(n.width*=2),(n||e.backgroundColor)&&a.push({shape:{type:"circle",cx:s,cy:s,r:s},fill:e.backgroundColor,stroke:n,offset:[0,0]});const c=e.values,m=c&&c.length===o&&100===c.reduce(((t,e)=>t+e),0),u=[0];for(let e=0;e<o;e++){let o=null;m&&(o=c[e]*r/100,u.push(o+u[e])),a.push({shape:{type:"circle",cx:s,cy:s,r:s/2},fill:[0,0,0,0],stroke:{width:s,dashArray:`${(o??i)/2} ${r}`,dashoffset:"-"+(m?u[e]/2:e*(i/2)),color:t[e]},offset:[0,0]})}let p=null;const h=2*s+(n?.width||0),d=e.holePercentage;if(d){n&&a.push({shape:{type:"circle",cx:s,cy:s,r:s*d},fill:null,stroke:n,offset:[0,0]});const t=h/2;p=[[{shape:{type:"circle",cx:t,cy:t,r:t},fill:I,stroke:n?{...n,color:I}:null,offset:[0,0]},{shape:{type:"circle",cx:t,cy:t,r:s*d},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return S([a],[h,h],{effectView:e.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90})}function z(t,e={}){const s=t?.authoringInfo;if("relationship"!==s?.type||!s?.numClasses||!t.uniqueValueInfos)return null;const{focus:r,numClasses:o}=s,l=E({focus:r,numClasses:o,infos:t.uniqueValueInfos}),i=e&&e.node||document.createElement("div");return L(i,(()=>D(l,e.id||"relationship",e.opacity||1,e.effectList))),i}function B(t,e={}){const s="horizontal"===e.align,r=s?75:24,l=s?24:75,i=e.width??r,a=e.height??l,n=e.gradient??!0,c=window.devicePixelRatio,m=i*c,u=a*c,p=document.createElement("canvas");p.width=m,p.height=u,p.style.width=`${i}px`,p.style.height=`${a}px`;const h=p.getContext("2d"),d=s?m:0,b=s?0:u;if(n){const e=h.createLinearGradient(0,0,d,b),s=t.length,r=1===s?0:1/(s-1);t.forEach(((t,s)=>e.addColorStop(s*r,t.toString()))),h.fillStyle=e,h.fillRect(0,0,m,u)}else{const e=s?m/t.length:m,r=s?u:u/t.length;let o=0,l=0;for(const i of t)h.fillStyle=i.toString(),h.fillRect(o,l,e,r),o=s?o+e:0,l=s?0:l+r}const y=document.createElement("div");return y.style.width=`${i}px`,y.style.height=`${a}px`,function(t,e){if(!e)return;t.style.filter=o(e);const s=e.effects;if(s)for(const e of s)if("drop-shadow"===e?.type){e.offsetX<0?t.style.marginLeft=`${Math.abs(e.offsetX)}px`:t.style.marginRight=`${e.offsetX}px`;break}}(y,e?.effectList),y.appendChild(p),y}async function G(t,e){switch(t.type){case"web-style":{const{previewWebStyleSymbol:s}=await import("../../chunks/previewWebStyleSymbol.js");return s(t,G,e)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:s}=await import("../../chunks/previewSymbol3D.js");return s(t,e)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:s}=await import("../../chunks/previewSymbol2D.js");return s(t,e)}case"cim":{const{previewCIMSymbol:s}=await import("../../chunks/previewCIMSymbol.js");return s(t,e)}default:return}}function X(t){return t&&"opacity"in t?t.opacity*X(t.parent):1}async function Q(o,l){if(!o)return;const i=o.sourceLayer,u=(t(l)&&l.useSourceLayer?i:o.layer)??i,p=X(u);if(t(o.symbol)&&(!t(l)||!0!==l.ignoreGraphicSymbol)){const e="web-style"===o.symbol.type?await a(o.symbol,{...l,cache:t(l)?l.webStyleCache:null}):o.symbol.clone();return n(e,null,p),e}const h=(t(l)?l.renderer:null)??(u&&"renderer"in u?u.renderer:null);let d=h&&"getSymbolAsync"in h?await h.getSymbolAsync(o,l):null;if(!d)return;if(d="web-style"===d.type?await d.fetchSymbol({...l,cache:t(l)?l.webStyleCache:null}):d.clone(),!(h&&"visualVariables"in h&&h.visualVariables&&h.visualVariables.length))return n(d,null,p),d;if("arcadeRequiredForVisualVariables"in h&&h.arcadeRequiredForVisualVariables&&(e(l)||e(l.arcade))){const t={...s(l)};t.arcade=await r(),l=t}const b=await import("../../chunks/visualVariableUtils.js"),y=[],f=[],j=[],k=[];for(const t of h.visualVariables)switch(t.type){case"color":y.push(t);break;case"opacity":f.push(t);break;case"rotation":k.push(t);break;case"size":t.target||j.push(t)}const g=!!y.length&&y[y.length-1],S=g?b.getColor(g,o,l):null,L=!!f.length&&f[f.length-1];let w=L?b.getOpacity(L,o,l):null;if(null!=p&&(w=null!=w?w*p:p),n(d,S,w),j.length){const t=b.getAllSizes(j,o,l);await c(d,t)}for(const t of k)m(d,b.getRotationAngle(t,o,l),t.axis);return d}async function Y(o,l){if(!o)return;const i=X(o.layer||o.sourceLayer);if(t(o.symbol)&&(!t(l)||!0!==l.ignoreGraphicSymbol)){const t="web-style"===o.symbol.type?await a(o.symbol,l):o.symbol.clone();return u(t,i)}const n=t(l)&&l.renderer||o.get("layer.renderer")||o.get("sourceLayer.renderer");let c=await n.getSymbolAsync(o,l);if(!c)return;c="web-style"===c.type?await a(c,l):c.clone();const m=u(c,i);if(!("visualVariables"in n)||"visualVariables"in n&&!n.visualVariables||"visualVariables"in n&&!n.visualVariables?.length)return m;if(n.arcadeRequiredForVisualVariables&&(e(l)||e(l.arcade))){const t={...s(l)};t.arcade=await r(),l=t}const h=await import("../../chunks/visualVariableUtils.js"),d=[],b=[];for(const t of n.visualVariables)switch(t.type){case"color":d.push(t);break;case"opacity":b.push(t)}const y=d.length>0?d[d.length-1]:null,f=y?h.getColor(y,o,l):m,j=b.length>0?b[b.length-1]:null;let k=j?h.getOpacity(j,o,l):null;return null!=i&&(k=null!=k?k*i:i),f?p(f,k):null}export{V as a,E as g,Y as getDisplayedColor,Q as getDisplayedSymbol,D as r,B as renderColorRampPreviewHTML,F as renderDotDensityPreviewHTML,O as renderPieChartPreviewHTML,G as renderPreviewHTML,z as renderRelationshipRampPreviewHTML};
