/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{h as e}from"../chunks/typedArrayUtil.js";import t from"./Error.js";import{L as n}from"../chunks/Logger.js";import{i as r,a as o,r as i,b as s}from"../chunks/maybe.js";import"./lang.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";function c(e){return e&&("function"==typeof e.on||"function"==typeof e.addEventListener)}function u(e,t,n){if(!c(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,n);if(Array.isArray(t)){const r=t.slice();for(const t of r)e.addEventListener(t,n);return{remove(){for(const t of r)e.removeEventListener(t,n)}}}return e.addEventListener(t,n),{remove(){e.removeEventListener(t,n)}}}function a(e,t,n){if(!c(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,n);const r=u(e,t,(t=>{r.remove(),n.call(e,t)}));return{remove(){r.remove()}}}function l(e,t,n){let r=!1;const o=u(e,t,(t=>{r||n.call(e,t)}));return{resume(){r=!1},pause(){r=!0},remove(){o.remove()}}}const f={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function m({key:e}){return f[e]||e}const p=(w=globalThis,{setTimeout:(e,t)=>{const n=w.setTimeout(e,t);return{remove:()=>w.clearTimeout(n)}}});var w;const h=new Set;function d(t,n,r={}){e("esri-deprecation-warnings")&&g(t,`Module: ${n}`,r)}function v(t,n,r={}){if(e("esri-deprecation-warnings")){const{moduleName:e}=r;g(t,"Function: "+(e?e+"::":"")+n+"()",r)}}function b(t,n,r={}){if(e("esri-deprecation-warnings")){const{moduleName:e}=r;g(t,"Property: "+(e?e+"::":"")+n,r)}}function g(t,n,r={}){if(e("esri-deprecation-warnings")){const{replacement:e,version:o,see:i,warnOnce:s}=r;let c=n;e&&(c+=`\n\t🛠️ Replacement: ${e}`),o&&(c+=`\n\t⚙️ Version: ${o}`),i&&(c+=`\n\t🔗 See ${i} for more details.`),function(e,t,n=!1){n&&h.has(t)||(n&&h.add(t),e.warn(`🛑 DEPRECATED - ${t}`))}(t,c,s)}}async function y(e,t){const n=e.slice(),r=await Promise.all(e.map(((e,n)=>t(e,n))));return n.filter(((e,t)=>r[t]))}function E(e){return v(n.getLogger("esri.core.promiseUtils"),"create",{moduleName:"esri.core.promiseUtils",replacement:"new Promise()",version:"4.24"}),new Promise(((t,n)=>{try{e(t,n)}catch(e){Promise.resolve().then((()=>n(e)))}}))}function j(e="Aborted"){return new t("AbortError",e)}function A(e,t="Aborted"){if(P(e))throw j(t)}function T(e){return r(e)?"aborted"in e?e:e.signal:e}function P(e){const t=T(e);return r(t)&&t.aborted}function L(e){if(C(e))throw e}function D(e){if(!C(e))throw e}function k(e,t){const n=T(e);if(!o(n)){if(!n.aborted)return a(n,"abort",(()=>t()));t()}}function $(e,t){const n=T(e);if(!o(n))return A(n),a(n,"abort",(()=>t(j())))}function S(e,t){const n=T(t);return o(n)?e:new Promise(((n,r)=>{let o=k(t,(()=>r(j())));const s=()=>o=i(o);e.then(s,s),e.then(n,r)}))}function U(e,n,r){return Promise.race([e,F(n).then((()=>{throw new t("timeout",`Did not resolve within ${n} milliseconds (${r??"timeout"})`)}))])}function C(e){return"AbortError"===e?.name}async function M(e){try{return await e}catch(e){if(!C(e))throw e;return}}async function R(e,t=n.getLogger("esri")){try{return await e}catch(e){C(e)||t.error(e)}}function N(){let e=null;const t=new Promise(((t,n)=>{e={promise:void 0,resolve:t,reject:n}}));return e.promise=t,e}async function x(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e),n=t.map((t=>e[t])),r=await x(n),o={};return t.map(((e,t)=>o[e]=r[t])),o}const t=e;return new Promise((e=>{const n=[];let r=t.length;0===r&&e(n),t.forEach((t=>{const o={promise:t||Promise.resolve(t)};n.push(o),o.promise.then((e=>{o.value=e})).catch((e=>{o.error=e})).then((()=>{--r,0===r&&e(n)}))}))}))}async function O(e){return(await x(e)).filter((e=>!!e.value)).map((e=>e.value))}function F(e,t=undefined,n){const r=new AbortController;return k(n,(()=>r.abort())),new Promise(((n,o)=>{let i=setTimeout((()=>{i=0,n(t)}),e);k(r,(()=>{i&&(clearTimeout(i),o(j()))}))}))}function V(e,n,r,o){const i=r&&"abort"in r?r:null;null!=o||i||(o=r);let s=setTimeout((()=>{s=0,i&&i.abort()}),n);const c=()=>o||new t("promiseUtils:timeout","The wrapped promise did not resolve within "+n+" ms");return e.then((e=>{if(0===s)throw c();return clearTimeout(s),e}),(e=>{throw clearTimeout(s),0===s?c():e}))}function W(e){return e&&"function"==typeof e.then}function q(e){return W(e)?e:Promise.resolve(e)}function z(e,t=-1){let n,r,o,i,c=null;const u=(...a)=>{if(n){r=a,i&&i.reject(j()),i=N();const e=s(i.promise);if(c){const e=c;c=null,e.abort()}return e}if(o=i||N(),i=null,t>0){const r=new AbortController;n=q(e(...a,r.signal));const o=n;F(t).then((()=>{n===o&&(i?r.abort():c=r)}))}else n=1,n=q(e(...a));const l=()=>{const e=r;r=o=n=c=null,null!=e&&u(...e)},f=n,m=o;return f.then(l,l),f.then(m.resolve,m.reject),s(m.promise)};return u}function B(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r})),r=t=>{e(t)};return r.resolve=t=>e(t),r.reject=e=>t(e),r.timeout=(e,t)=>p.setTimeout((()=>r.reject(t)),e),r.promise=n,r}function G(e,t){return e.then(t,t)}async function H(e){await Promise.resolve(),A(e)}export{g as a,F as after,G as always,d as b,p as c,E as create,j as createAbortError,N as createDeferred,B as createResolver,b as d,z as debounce,m as e,x as eachAlways,O as eachAlwaysValues,v as f,y as filter,c as i,M as ignoreAbortErrors,C as isAbortError,P as isAborted,W as isPromiseLike,R as logOnError,u as o,k as onAbort,$ as onAbortOrThrow,l as p,L as throwIfAbortError,A as throwIfAborted,D as throwIfNotAbortError,V as timeout,H as waitTick,q as when,S as whenOrAbort,U as whenOrTimeout};
