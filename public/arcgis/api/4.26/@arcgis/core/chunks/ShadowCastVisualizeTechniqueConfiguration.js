/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{l as t,c as e}from"./mathUtils.js";import{i as n}from"./maybe.js";import{a as i,i as o,o as a,p as r,r as s}from"./mat4.js";import{c}from"./mat4f64.js";import{k as l,l as u}from"./vec2.js";import{f as d,a as f}from"./vec2f64.js";import{s as m,f as h,A as g,n as b,g as p,e as y,a as v,k as A,c as M,d as N}from"./vec3.js";import{V as T}from"./ViewingMode.js";import{c as w}from"./mathUtils2.js";import{_ as x}from"./tslib.es6.js";import{p as P,S as O}from"./ShaderTechniqueConfiguration.js";var E,I,z={},G={get exports(){return z},set exports(t){z=t}};E=G,I=function(){var t=Math.PI,e=Math.sin,n=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,r=Math.acos,s=t/180,c=864e5,l=2440588,u=2451545,d={dec:0,ra:0};function f(t){return new Date((t+.5-l)*c)}function m(t){return function(t){return t.valueOf()/c-.5+l}(t)-u}var h=23.4397*s;function g(t,o){return a(e(t)*n(h)-i(o)*e(h),n(t))}function b(t,i){return o(e(i)*n(h)+n(i)*e(h)*e(t))}function p(t,o,r){return a(e(t),n(t)*e(o)-i(r)*n(o))}function y(t,i,a){return o(e(i)*e(a)+n(i)*n(a)*n(t))}function v(t,e){return s*(280.16+360.9856235*t)-e}function A(t){return s*(357.5291+.98560028*t)}function M(t){return s*(1.9148*e(t)+.02*e(2*t)+3e-4*e(3*t))}function N(e,n){return e+n+102.9372*s+t}function T(t,e){var n=A(t),i=N(n,M(n));return e||(e={dec:0,ra:0}),e.dec=b(i,0),e.ra=g(i,0),e}var w={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,n,i){var o=s*-n,a=s*e,r=m(t),c=T(r,d),l=v(r,o)-c.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=p(l,a,c.dec),i.altitude=y(l,a,c.dec),i}},x=[[-.83,"sunrise","sunset"]];w.addTime=function(t,e,n){x.push([t,e,n])};var P=9e-4;function O(e,n,i){return P+(e+n)/(2*t)+i}function E(t,n,i){return u+t+.0053*e(n)-.0069*e(2*i)}function I(t){var i=s*(134.963+13.064993*t),o=s*(93.272+13.22935*t),a=s*(218.316+13.176396*t)+6.289*s*e(i),r=5.128*s*e(o),c=385001-20905*n(i);return{ra:g(a,r),dec:b(a,r),dist:c}}return w.getTimes=function(i,o,a){var c=s*-a,l=s*o,u=function(e,n){return Math.round(e-P-n/(2*t))}(m(i),c),d=O(0,c,u),h=A(d),g=M(h),p=N(h,g),y=b(p,0),v=E(d,h,p);function T(t){return E(O(function(t,i,o){return r((e(t)-e(i)*e(o))/(n(i)*n(o)))}(t,l,y),c,u),h,p)}var I,z,G,S,j,D,H,L={solarNoon:f(v),nadir:f(v-.5),polarException:w.PolarException.NORMAL};for(I=0,z=x.length;I<z;I+=1)j=v-((S=T((G=x[I])[0]*s))-v),L[G[1]]=f(j),L[G[2]]=f(S);return L.polarException=(D=x[0][0]*s,(H=(e(D)-e(l)*e(y))/(n(l)*n(y)))<-1?w.PolarException.MIDNIGHT_SUN:H>1?w.PolarException.POLAR_NIGHT:w.PolarException.NORMAL),L},w.getMoonPosition=function(t,e,n){var o=s*-n,a=s*e,r=m(t),c=I(r),l=v(r,o)-c.ra,u=y(l,a,c.dec);return u+=.017*s/i(u+10.26*s/(u+5.1*s)),{azimuth:p(l,a,c.dec),altitude:u,distance:c.dist}},w.getMoonFraction=function(t){var i=m(t),o=T(i),s=I(i),c=149598e3,l=r(e(o.dec)*e(s.dec)+n(o.dec)*n(s.dec)*n(o.ra-s.ra)),u=a(c*e(l),s.dist-c*n(l));return(1+n(u))/2},w}(),void 0!==I&&(E.exports=I);const S=z,j={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class D{constructor(t,e){this.direct=t,this.ambient=e}}function H(i,o,a,r,s,c){m(c.ambient.color,1,1,1),c.ambient.intensity=j.global.ambient,m(c.direct.color,1,1,1),c.direct.intensity=j.global.direct;const d=o[2],b=e((Math.abs(d)-j.local.altitude)/(j.global.altitude-j.local.altitude),0,1);let p;if(c.globalFactor=b,n(i)&&(p=S.getTimes(i,o[1],o[0])),b<1){let e;if(n(i))e=function(t,e,n){const i=t.valueOf();let o,a;e.polarException===S.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===S.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=a-o,s=o+r/2,c=r/4,d=s-c,m=s+c,h=.06*r,b=o-h/2,p=o+h/2,y=a-h/2,v=a+h/2,A=f(),T=N(),w=N();let x="";if(i<b||i>v)l(A,tt),M(T,J),M(w,X),x="night";else if(i<p){const t=(i-b)/(p-b);u(A,tt,et,t),g(T,J,K,t),g(w,X,Y,t),x="sun rising"}else if(i<d){const t=(i-p)/(d-p);u(A,et,nt,t),g(T,K,Q,t),g(w,Y,Z,t),x="early morning"}else if(i<s){const t=(i-d)/(s-d);u(A,nt,it,t),g(T,Q,W,t),g(w,Z,$,t),x="late morning"}else if(i<m){const t=(i-s)/(m-s);u(A,it,ot,t),g(T,W,at,t),g(w,$,rt,t),x="early afternoon"}else if(i<y){const t=(i-m)/(y-m);u(A,ot,st,t),g(T,at,ct,t),g(w,rt,lt,t),x="late afternoon"}else if(i<v){const t=(i-y)/(v-y);u(A,st,tt,t),g(T,ct,J,t),g(w,lt,X,t),x="sun setting"}let P=0;switch(n){case"rainy":case"foggy":case"snowy":P=.5}P>0&&(B(T,P),B(w,P));const O=q(n);return{direct:{intensity:A[0]*O.direct,color:T},ambient:{intensity:A[1]*O.ambient,color:w},timeOfDay:x}}(i,p,r);else{const t=q(r);e={direct:{intensity:j.local.directAtNoon*t.direct,color:h(1,1,1)},ambient:{intensity:j.local.ambientAtNoon*t.ambient,color:h(1,1,1)},timeOfDay:"early afternoon"}}g(c.ambient.color,e.ambient.color,c.ambient.color,b),c.ambient.intensity=t(e.ambient.intensity,c.ambient.intensity,b),g(c.direct.color,e.direct.color,c.direct.color,b),c.direct.intensity=t(e.direct.intensity,c.direct.intensity,b),c.specularStrength="rainy"===r||"snowy"===r||"foggy"===r?0:1,c.environmentStrength="rainy"===r?.7:"snowy"===r||"foggy"===r?.75:1}c.noonFactor=n(i)?function(t,n){const i=t.valueOf();let o,a;n.polarException===S.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):n.polarException===S.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=n.sunrise.valueOf(),a=n.sunset.valueOf());const r=o+(a-o)/2;return 1-e(Math.abs(i-r)/432e5,0,1)}(i,p):1,n(i)?R(i,o,a,c.direct.directionToLightSource):L(s,a,c.direct.directionToLightSource)}function L(t,e,n){e===T.Global?b(ft,t.eye):m(ft,0,0,1),p(mt,t.viewForward,-1);const o=w(mt,ft),a=Math.max(o-2*gt,0),r=.85*a/(a+1),s=Math.max(gt,o-gt-r);i(dt,-s,t.viewRight),y(n,mt,dt),v(n,n,p(ht,t.viewRight,bt)),b(n,n)}function R(t,n,i,c){const l=V,u=o(k);if(i===T.Global)S.getPosition(t,0,0,l),m(c,0,0,-1),a(u,u,-l.azimuth),r(u,u,-l.altitude),y(c,c,u);else{const i=j.planarDirection,o=i.globalAngles,r=n[2];let d=(Math.abs(r)-i.localAltitude)/(i.globalAltitude-i.localAltitude);d=e(d,0,1),d<1?(S.getPosition(t,n[1],n[0],l),l.azimuth=(1-d)*l.azimuth+d*o.azimuth,l.altitude=(1-d)*l.altitude+d*o.altitude):(l.azimuth=o.azimuth,l.altitude=o.altitude),m(c,0,-1,0),s(u,u,-l.azimuth),a(u,u,-l.altitude),y(c,c,u)}}function U(t,e){if(e===T.Global)return!0;const n=j.planarDirection;return Math.abs(t)<n.localAltitude}function _(t,e,n,i,o){const a=t.getTime(),r=e.getTime()-a,s=Math.floor(r/n)+1,c=new Array(s);for(let t=0;t<s;++t)ut.setTime(a+n*t),c[t]=N(),R(ut,i,o,c[t]);return c}const F=h(.5773502691896258,-.5773502691896258,.5773502691896258);class C{constructor(){this.ambient={color:h(1,1,1),intensity:.55},this.direct={color:h(1,1,1),intensity:.55,directionToLightSource:A(F)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const k=c(),V={azimuth:0,altitude:0};function q(t){switch(t){case"disabled":case"sunny":case"cloudy":return new D(1,1);case"rainy":return new D(.4,1.2);case"snowy":return new D(.5,1.3);case"foggy":return new D(.2,1.6)}}function B(t,e){const n=(t[0]+t[1]+t[2])/3;t[0]+=(n-t[0])*e,t[1]+=(n-t[1])*e,t[2]+=(n-t[2])*e}const J=h(.01,.01,.01),K=h(1,.6,.5),Q=h(1,.98,.98),W=h(1,1,1),X=h(.8,.8,1),Y=h(.8,.8,1),Z=h(.98,.98,1),$=h(1,1,1),tt=d(.01,j.local.ambientAtNight),et=d(j.local.directAtTwilight,j.local.ambientAtTwilight),nt=d(.9*j.local.directAtNoon,j.local.ambientAtNoon),it=d(j.local.directAtNoon,j.local.ambientAtNoon),ot=nt,at=Q,rt=Z,st=et,ct=K,lt=Y,ut=new Date(0),dt=c(),ft=N(),mt=N(),ht=N(),gt=.25,bt=.2;var pt;!function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"}(pt||(pt={}));class yt extends O{constructor(){super(...arguments),this.visualization=pt.Gradient,this.bandsEnabled=!1}}x([P({count:pt.COUNT})],yt.prototype,"visualization",void 0),x([P()],yt.prototype,"bandsEnabled",void 0);export{C,pt as S,L as a,U as b,H as c,yt as d,S as e,_ as f};
