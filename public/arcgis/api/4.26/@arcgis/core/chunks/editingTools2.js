/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import{m as e,h as i,d as a,r as o}from"./handleUtils.js";import{i as s,a as n,g as r,d as l,u as p,r as h,e as c,q as d}from"./maybe.js";import{watch as u,on as m,initial as g,when as _,syncAndInitial as y,sync as v}from"../core/reactiveUtils.js";import{property as f}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import{h as M,n as b}from"./typedArrayUtil.js";import{subclass as S}from"../core/accessorSupport/decorators/subclass.js";import{F as x,d as w,s as E,a as j,g as O,f as A,J as T,b as D,n as G,m as I,h as R,G as L,I as P,l as V,A as C,k as U,H as z,c as H,w as N}from"./vec3.js";import{M as F}from"./MeshTransform.js";import{g as k,e as X,l as Z,b as Y,d as B,c as q}from"./elevationInfoUtils.js";import{E as W}from"./ElevationInfo.js";import{e as J,b as Q,s as K}from"./screenUtils.js";import"./Logger.js";import"../core/Error.js";import $ from"../core/Accessor.js";import{c as tt}from"./asyncUtils.js";import{throwIfAborted as et}from"../core/promiseUtils.js";import{e as it}from"./quantityFormatUtils.js";import{a as at,s as ot,n as st,h as nt,l as rt,j as lt,b as pt}from"./vec2.js";import{a as ht}from"./vec2f64.js";import{i as ct,t as dt}from"../geometry/Polygon.js";import{f as ut}from"./messages.js";import{g as mt}from"./getDefaultUnitForView.js";import{T as gt}from"./TextOverlayItem.js";import{d as _t,b as yt,T as vt,S as ft,a as Mt,e as bt}from"./automaticLengthMeasurementUtils.js";import{v as St}from"./viewUtils.js";import{S as xt}from"./SnappingVisualizer3D.js";import{s as wt,c as Et}from"./settings3.js";import{E as jt}from"./ExtendedLineVisualElement.js";import{O as Ot}from"./OutlineVisualElement.js";import{V as At}from"./VerticesVisualElement.js";import{e as Tt,E as Dt}from"./ElevationContext.js";import{G as Gt}from"./GraphicState.js";import{R as It}from"./Material.js";import{D as Rt,g as Lt,m as Pt,c as Vt,b as Ct,a as Ut,u as zt}from"./editPlaneUtils.js";import{D as Ht,S as Nt,E as Ft}from"./drawSurfaces.js";import kt from"../core/Collection.js";import Xt from"../core/Evented.js";import{HandleOwnerMixin as Zt,HandleOwner as Yt}from"../core/HandleOwner.js";import{s as Bt,z as qt,c as Wt,e as Jt}from"./quantityUtils.js";import{m as Qt}from"./dehydratedFeatures.js";import{M as Kt,R as $t,c as te,g as ee,f as ie,p as ae,a as oe,d as se}from"./manipulatorUtils.js";import{b as ne,S as re,g as le,i as pe}from"./isSupportedGraphic.js";import{c as he}from"./manipulatorUtils2.js";import{d as ce,c as de,r as ue}from"./mathUtils.js";import{L as me}from"./LaserlineVisualElement.js";import{projectVectorToVector as ge,projectPointToVector as _e}from"../geometry/projection.js";import{c as ye,k as ve,G as fe}from"./aaBoundingBox.js";import{j as Me}from"./aaBoundingRect.js";import{P as be}from"./PointVisualElement.js";import Se from"../core/Handles.js";import xe from"../Color.js";import{f as we,y as Ee,m as je,a as Oe,x as Ae,n as Te,o as De,g as Ge,A as Ie,r as Re}from"./mat4.js";import{c as Le,f as Pe,I as Ve}from"./mat4f64.js";import{s as Ce,d as Ue,w as ze,h as He,j as Ne,c as Fe}from"./ray.js";import{b as ke,c as Xe,d as Ze,e as Ye,f as Be,g as qe,s as We}from"./dragEventPipeline3D.js";import{d as Je,b as Qe,c as Ke,e as $e,f as ti,g as ei,E as ii,h as ai,I as oi,i as si,j as ni,s as ri,k as li}from"./dragEventPipeline.js";import{C as pi}from"./basicInterfaces.js";import{o as hi,t as ci,k as di,p as ui,e as mi,a as gi,f as _i}from"./GeometryUtil.js";import{C as yi}from"./ColorMaterial.js";import{a as vi,M as fi}from"./interfaces5.js";import{d as Mi}from"./colorUtils2.js";import{G as bi}from"./GraphicManipulator.js";import{E as Si,P as xi,O as wi,A as Ei,b as ji}from"./EditGeometryOperations.js";import Oi from"../views/interactive/sketch/SketchTooltipOptions.js";import{S as Ai}from"./SnappingContext.js";import{c as Ti}from"./SnappingDragPipelineStep.js";import{T as Di,a as Gi,b as Ii,c as Ri,d as Li,e as Pi}from"./TranslateTooltipInfos.js";import{v as Vi,g as Ci,h as Ui}from"./euclideanLengthMeasurementUtils.js";import"../geometry.js";import{g as zi,Y as Hi}from"./unitUtils.js";import Ni from"../geometry/Polyline.js";import{n as Fi,f as ki,c as Xi,q as Zi,h as Yi}from"./plane.js";import{l as Bi}from"./utils6.js";import{M as qi}from"./IViewEvents.js";import{a as Wi}from"./automaticAreaMeasurementUtils.js";import Ji from"../geometry/SpatialReference.js";import Qi from"../views/interactive/sketch/SketchLabelOptions.js";import Ki from"../geometry/Point.js";import{V as $i}from"./ViewingMode.js";import{b as ta}from"./Cyclical.js";import{addFrameTask as ea}from"../core/scheduling.js";import{a as ia}from"./vec4f64.js";import{d as aa,g as oa}from"./axisAngleDegrees.js";import{c as sa,a as na}from"./boundedPlane.js";import{B as ra,c as la,O as pa,C as ha,e as ca,E as da,F as ua,H as ma,l as ga,R as _a,o as ya,q as va,t as fa}from"./sliceToolUtils.js";import{g as Ma}from"./Factory.js";import{f as ba}from"./ray2.js";import{E as Sa,a as xa}from"./ExtentTooltipInfos.js";import"./watch.js";import"./ArrayPool.js";import"../core/lang.js";import"./get.js";import"./utils.js";import"./tracking.js";import"../config.js";import"./object.js";import"./string.js";import"./nextTick.js";import"./metadata.js";import"./common.js";import"../core/JSONSupport.js";import"./quat.js";import"./vec4.js";import"./quatf64.js";import"./spatialReferenceEllipsoidUtils.js";import"./DoubleArray.js";import"./vec32.js";import"./unitConversionUtils.js";import"./lengthUtils.js";import"./Ellipsoid.js";import"./jsonMap.js";import"./reader.js";import"./writer.js";import"../layers/support/fieldUtils.js";import"./arcadeOnDemand.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/support/webMercatorUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"./extentUtils.js";import"./typeUtils.js";import"../geometry/support/jsonUtils.js";import"./unitFormatUtils.js";import"./byteSizeEstimations.js";import"./number.js";import"./locale.js";import"../portal/Portal.js";import"../kernel.js";import"../core/urlUtils.js";import"../request.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"./projector.js";import"./widgetUtils.js";import"../intl.js";import"./assets.js";import"../widgets/Widget.js";import"./domUtils.js";import"./uuid.js";import"./dom.js";import"./index.js";import"./jsxWidgetSupport.js";import"./messageBundle.js";import"./jsxFactory.js";import"../geometry/geometryEngine.js";import"./geometryEngineBase.js";import"./hydrated.js";import"../geometry/support/geodesicUtils.js";import"./geodesicConstants.js";import"./vec4f32.js";import"./EngineVisualElement.js";import"../core/Identifiable.js";import"./RenderGeometry.js";import"./glUtil3D.js";import"./mat3.js";import"./mat3f64.js";import"./interfaces2.js";import"./ShaderBuilder.js";import"./VertexAttribute.js";import"./enums3.js";import"./VertexElementDescriptor.js";import"./FramebufferObject.js";import"./Texture.js";import"./context-util.js";import"./interfaces4.js";import"./vec2f32.js";import"./ShaderOutput.js";import"./TextureOnly.glsl.js";import"./ScreenSpacePass.glsl.js";import"./Float4PassUniform.js";import"./Texture2DPassUniform.js";import"./NestedMap.js";import"./ShaderTechniqueConfiguration.js";import"./Camera.js";import"./frustum.js";import"./vector.js";import"./Util2.js";import"./Attribute.js";import"./DefaultBufferWriter.js";import"./Indices.js";import"./triangle.js";import"./lineSegment.js";import"./doublePrecisionUtils.js";import"./BufferView.js";import"./TriangleMaterial.js";import"./sphere.js";import"./mathUtils2.js";import"./Octree.js";import"./InterleavedLayout.js";import"./types.js";import"./RenderSlot.js";import"./MarkerSizing.glsl.js";import"./VisualVariables.glsl.js";import"./Float3PassUniform.js";import"./Matrix3PassUniform.js";import"./FloatPassUniform.js";import"./sdfPrimitives.js";import"./floatRGBA.js";import"./Texture2.js";import"./compilerUtils.js";import"./requestImageUtils.js";import"./TransparencyPassType.js";import"./DefaultTechniqueConfiguration.js";import"./RibbonLine.glsl.js";import"./ForwardLinearDepth.glsl.js";import"./vec3f32.js";import"./View.glsl.js";import"./mat4f32.js";import"./Matrix4PassUniform.js";import"./RgbaFloatEncoding.glsl.js";import"./Slice.glsl.js";import"./ObjectAndLayerIdColor.glsl.js";import"./OutputDepth.glsl.js";import"./LineStipple.glsl.js";import"./MultipassTerrainTest.glsl.js";import"./ReadLinearDepth.glsl.js";import"./PiUtils.glsl.js";import"./AlphaCutoff.js";import"./ColorConversion.glsl.js";import"./Program2.js";import"./OrderIndependentTransparency.js";import"./renderState.js";import"./WaterSurface.glsl.js";import"./Transform.glsl.js";import"./OutputHighlight.glsl.js";import"./BooleanPassUniform.js";import"./Texture2DDrawUniform.js";import"./NormalUtils.glsl.js";import"./MultipassGeometryTest.glsl.js";import"./SSAOHelper.js";import"./SSAOBlur.glsl.js";import"./SSAO.glsl.js";import"./CameraSpace.glsl.js";import"./Intersector.js";import"./Intersector2.js";import"./verticalOffsetUtils.js";import"./glUtil.js";import"./AppleAmdDriverHelper.js";import"./VertexNormal.glsl.js";import"./MemCache.js";import"./Scheduler.js";import"./ObservableValue.js";import"./SimpleObservable.js";import"./debugFlags.js";import"./VisualElement.js";import"./VisualElementResources.js";import"./RightAngleQuadVisualElement.js";import"./Settings2.js";import"./LineSnappingHint.js";import"./snappingUtils.js";import"./InputManager.js";import"./Queue.js";import"./PropertiesPool.js";import"./keybindings.js";import"./lineStippleUtils.js";import"./line.js";import"./line2.js";import"./triangulationUtils.js";import"./earcut.js";import"./deduplicate.js";import"./LineVisualElement.js";import"./ElevationProvider.js";import"./graphicUtils.js";import"./hydratedFeatures.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"./enumeration.js";import"../popup/support/FieldInfoFormat.js";import"./date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"./chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"./shared.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"./colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"./utils2.js";import"../symbols/edges/Edges3D.js";import"./materialUtils.js";import"./opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"./Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"./lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"./utils3.js";import"./colors.js";import"./symbolLayerUtils3D.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"./persistableUrlUtils.js";import"./Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"./collectionUtils.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"./Thumbnail.js";import"./calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"./urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../layers/GraphicsLayer.js";import"./GraphicsCollection.js";import"../layers/Layer.js";import"../layers/mixins/BlendLayer.js";import"./jsonUtils.js";import"./parser.js";import"./_commonjsHelpers.js";import"../layers/mixins/ScaleRangeLayer.js";import"./WatchUpdatingTracking.js";import"../geometry/Circle.js";import"./surfaceCoordinateSystems.js";import"./mat2d.js";import"./mat2df64.js";import"./helpMessageUtils.js";import"./dehydratedFeatureComparison.js";import"./SnappingOperation.js";import"./quantizationUtils.js";import"../layers/support/Field.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"./ImageMaterial.js";import"./GLTextureMaterial.js";import"./ImageMaterial.glsl.js";import"./NativeLineMaterial.js";import"./NativeLine.glsl.js";import"./VertexColor.glsl.js";import"./ShadedColorMaterial.glsl.js";import"./LaserlinePath.glsl.js";import"./Laserline.glsl.js";import"./Laserlines.glsl.js";import"./pe.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"./zscale.js";import"./HUDMaterial.js";import"./AlignPixel.glsl.js";import"./VerticalOffset.glsl.js";import"./HUDMaterial.glsl.js";import"./drawUtils.js";import"./ColorMaterial.glsl.js";import"./defaults.js";import"./defaultsJSON.js";import"./drapedUtils.js";import"./geometry2dUtils.js";import"./RightAngleSnappingHint.js";import"./PointSnappingHint.js";import"./measurementUtils2.js";import"./ItemCache.js";import"../symbols/support/cimSymbolUtils.js";import"./utils7.js";import"./euclideanAreaMeasurementUtils.js";import"../analysis/SlicePlane.js";import"./persistable.js";import"./multiOriginJSONSupportUtils.js";import"./resourceExtension.js";import"./RenderCoordsHelper.js";import"./spatialReferenceSupport.js";const wa={default:15,far:25};let Ea=class extends ${constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const t=tt((async t=>{const e=await ut("esri/core/t9n/Units");et(t),this._messagesUnits=e})),i=()=>r(this.context,(t=>t.editGeometryOperations));this.addHandles([u((()=>[s(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((t=>m(i,t,(()=>this._update())))),e((()=>t.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return n(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((t=>t.label.text))}}get _edgeDistancePixels(){return wa[this.edgeDistance]}_update(){this._nextLabelIndex=0;const t=this.context;if(n(t))return void this._destroyUnusedLabels();const{components:e,geometry:i,coordinateHelper:a}=t.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const o=e.length;for(let n=0;n<o;++n){const r=[];if(e[n].iterateVertices((t=>{r.push(a.toXYZ(t.pos))})),0===n&&s(this.stagedVertex)&&r.push(a.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],p=r[r.length-1];"polygon"===i.type&&r.length>2&&!x(l,p)&&r.push(l);const h=1===o&&!ct(r,!1,!1);let c=Aa,d=Ta;this.toScreenPointArray(t,l,c);for(let e=1;e<r.length;++e){const i=r[e-1],a=r[e];this.toScreenPointArray(t,a,d),this._addLabel(t,i,c,a,d,h),[c,d]=[d,c]}}this._destroyUnusedLabels()}_addLabel(t,e,i,a,o,n){const{label:r}=this._getOrCreateLabel(t);if(!this.visible||at(i,o)<3025)return void(r.visible=!1);const l=s(t.graphicState)?t.graphicState.isDraped?"on-the-ground":"absolute-height":k(t.editGeometryOperations.data.geometry,t.elevationInfo),{spatialReference:p}=t.editGeometryOperations.data,h=_t(e,a,p,l),c=this._messagesUnits,d=mt(t.view);r.text=s(c)&&s(h)?it(c,h,d):"",r.visible=!0;const u=o[0]-i[0],m=o[1]-i[1];n?ot(ja,-m,u):ot(ja,m,-u),st(ja,ja),nt(ja,ja,this._edgeDistancePixels),rt(Oa,i,o,.5),lt(Oa,Oa,ja),r.position=[Oa[0],Oa[1]],Math.abs(ja[0])>Math.abs(ja[1])?r.anchor=ja[0]>0?"left":"right":r.anchor=-ja[1]<0?"top":"bottom"}_getOrCreateLabel(t){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const e=new gt({fontSize:10,anchor:"center"});t.view.overlay?.items.add(e);const i={label:e};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:t}){r(this.context,(e=>e.view.overlay?.items.remove(t))),t.destroy()}};t([f()],Ea.prototype,"context",void 0),t([f()],Ea.prototype,"stagedVertex",void 0),t([f()],Ea.prototype,"visible",void 0),t([f()],Ea.prototype,"edgeDistance",void 0),t([f()],Ea.prototype,"updating",null),t([f()],Ea.prototype,"_messagesUnits",void 0),t([f()],Ea.prototype,"_edgeDistancePixels",null),Ea=t([S("esri.views.interactive")],Ea);const ja=ht(),Oa=ht(),Aa=J(),Ta=J();let Da=class extends Ea{getCameraOrExtent({view:t}){return t.state.camera}toScreenPointArray({view:t,elevationInfo:e,editGeometryOperations:i},a,o=J()){const{spatialReference:s}=i.data.coordinateHelper;return St(a,s,e,t,Ga),t.state.camera.projectToScreen(Ga,o),o}};Da=t([S("esri.views.3d.interactive.SegmentLabels3D")],Da);const Ga=w();let Ia=class extends Rt{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new W({mode:t,offset:e})}normalizeCtorArgs(t){if(!t.elevationInfo){const e=t.hasZ??!0;return{...t,elevationInfo:X(e)}}return t}initializeGraphic(t){const e=this._createGraphicState=new Gt({graphic:t});return i([this.view.maskOccludee(t),this.view.trackGraphicState(e),u((()=>({element:this._outlineVisualElement,isDraped:e.isDraped})),(({element:t,isDraped:e})=>{r(t,(t=>t.isDraped=e))}),g)])}makeDrawOperation(){const{geometryType:t}=this,e="circle"!==t&&"rectangle"!==t;return new Ht({view:this.view,manipulators:this.manipulators,geometryType:Lt(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Nt(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Ft(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new xt,segmentLabels:e?new Da:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:s(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Z(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(t){const{view:i}=this;return s(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[t],this._updateVerticalLineVisualElement(t),null):(this._activeVertexVisualElement=new At({view:i,spatialReference:i.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:wt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=wt.colorToVec4(wt.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new jt({view:i,extensionType:wt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:It.OccludeAndTransparent}),wt.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),e((()=>{this._activeVertexVisualElement=l(this._activeVertexVisualElement),this._verticalLineVisualElement=l(this._verticalLineVisualElement)})))}_updateVerticalLineVisualElement(t){const e=this._verticalLineVisualElement;if(n(e))return;const{renderCoordsHelper:i,elevationProvider:a}=this.view;E(La,t[0],t[1],t[2]),Ra.setFromElevationInfo(this.elevationInfo),La[2]=Tt(La,a,Ra,i),i.toRenderCoords(La,this.view.spatialReference,La)?(e.setStartEndFromWorldDownAtLocation(La),e.attached=!0):e.attached=!1}onOutlineChanged(t){if(s(this._outlineVisualElement))return this._outlineVisualElement.geometry=t,null;const i=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Ot({view:this.view,geometry:t,elevationInfo:i,isDraped:s(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Z(this.hasZ,i),attached:!1}),wt.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),wt.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,e((()=>{this._outlineVisualElement=l(this._outlineVisualElement)}))}onRegularVerticesChanged(t){return s(this._verticesVisualElement)?(this._verticesVisualElement.vertices=t,null):(this._verticesVisualElement=new At({view:this.view,spatialReference:this.view.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:wt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,e((()=>{this._verticesVisualElement=l(this._verticesVisualElement)})))}_updateGraphicGeometry(t,e){if("mesh"===this.geometryType&&s(e)&&"point"===e.type){const i=this.geometryToPlace;return"mesh"===i?.type&&(i.transform||(i.transform=new F),i.centerAt(e)),t.geometry=i,void t.notifyGeometryChanged()}super._updateGraphicGeometry(t,e)}};t([f({constructOnly:!0})],Ia.prototype,"elevationInfo",void 0),t([f({constructOnly:!0})],Ia.prototype,"geometryType",void 0),t([f()],Ia.prototype,"type",void 0),t([f({constructOnly:!0})],Ia.prototype,"view",void 0),Ia=t([S("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ia);const Ra=new Dt,La=w();var Pa,Va;!function(t){t[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY"}(Pa||(Pa={})),function(t){t[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE"}(Va||(Va={}));class Ca{constructor(){this.grabbingState=Pa.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=Pa.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator(((t,e)=>{if(e===Va.TRANSLATE_Z&&(this.zManipulator=t),t instanceof Kt&&(t.selected&&(0===this.numSelected&&(this.firstSelected=t),this.numSelected++),n(this.firstGrabbedXY)&&t.grabbing&&e===Va.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=Pa.ANY,e){case Va.TRANSLATE_Z:this.grabbingState|=Pa.Z;break;case Va.TRANSLATE_XY:this.grabbingState|=Pa.XY}}))}}function Ua(t){return s(t.geometry)&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)}const za=w();function Ha(t){const{view:e,graphic:r}=t,l=new Gt({graphic:r}),p=[],h=function(t,e,i){const{view:n,graphic:r}=t,l=new be({view:n,geometry:Na(r),elevationInfo:Y(r),attached:!1});return function(t,e,i,a){(function(t,e,i,a){const{view:n,graphic:r}=t;let l=null;const p=()=>{const t=Na(r);(t=>{s(l)&&(l.remove(),l=null),i.isDraped&&s(t)&&(l=function(i,a,o){const s=i.elevationProvider.spatialReference;_e(a,Fa,s);const n=Fa[0],r=Fa[1];return i.elevationProvider.on("elevation-change",(i=>{Me(i.extent,n,r)&&(e.geometry=t)}))}(n,t))})(t),e.geometry=t};a.push(i.on("changed",p),o((()=>l))),p()})(t,e,i,a),wt.visualElements.pointGraphics.outline.apply(e),a.push(u((()=>i.displaying),(()=>e.attached=i.displaying),g))}(t,l,e,i),i.push(a(l)),l}(t,l,p);return function(t,e,i,o){const{view:r,graphic:l}=t,p=new jt({view:r,extensionType:wt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:It.OccludeAndTransparent});wt.visualElements.zVerticalLine.apply(p);const h=new me({view:r,intersectsLineInfinite:!0,attached:!1});wt.visualElements.pointGraphics.shadowStyle.apply(h);const c=ce(wt.visualElements.heightPlaneAngleCutoff),d=new me({view:r,attached:!1,angleCutoff:c});wt.visualElements.heightPlane.apply(d);const m=Y(t.graphic),g=Dt.fromElevationInfo(m),_="on-the-ground"===m.mode||!m.offset&&"absolute-height"!==m.mode,y=new Ca;let v=1,f=1;const M=()=>{y.update(t);const i=Na(l),a=_&&(e.isDraped||n(i)||!i.hasZ);let c=!0;if(!a&&s(i)){const t=Tt(i,r.elevationProvider,g,r.renderCoordsHelper);E(Fa,i.x,i.y,t),ge(Fa,i.spatialReference,Fa,r.renderCoordsHelper.spatialReference),p.setStartEndFromWorldDownAtLocation(Fa),h.intersectsWorldUpAtLocation=Fa}else c=!1;const u=y.grabbingState&Pa.Z?wt.visualElements.laserlineAlphaMultiplier:1;u!==v&&(v=u,wt.visualElements.heightPlane.apply(d,u));const m=ve(ka);!a&&e.displaying&&o.calculateMapBounds(m)&&ge(fe(m,Fa),r.spatialReference,Fa,r.renderCoordsHelper.spatialReference)?(d.heightManifoldTarget=Fa,d.attached=!0):d.attached=!1;const M=y.grabbingState&Pa.XY?wt.visualElements.laserlineAlphaMultiplier:1;M!==f&&(f=M,wt.visualElements.pointGraphics.shadowStyle.apply(h,M));const b=c&&e.displaying&&!a;h.attached=b,p.attached=b};i.push(u((()=>[e.displaying,e.isDraped]),M),e.on("changed",M)),t.forEachManipulator((t=>{i.push(t.events.on("grab-changed",M))})),i.push(a(h)),i.push(a(p)),i.push(a(d)),M()}(t,l,p,h),p.push(e.trackGraphicState(l)),{visualElement:h,remove(){i(p).remove()}}}function Na(t){const e=t.geometry;return n(e)?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}const Fa=w(),ka=ye();function Xa(t){switch(p(t.graphic.geometry).type){case"point":case"mesh":return Ha(t);case"polygon":case"polyline":return function(t){const{view:e,graphic:n}=t,r=new Gt({graphic:n}),l=function(t,e){const{view:o,graphic:s}=t,n=new Ot({view:o,geometry:Ua(s)?s.geometry:null,elevationInfo:Y(s),attached:!1});wt.visualElements.lineGraphics.shadowStyle.apply(n);const r=()=>{n.attached=e.displaying};wt.visualElements.lineGraphics.outline.apply(n);const l=[u((()=>e.displaying),r),u((()=>e.isDraped),(t=>{n.isDraped=t})),e.on("changed",(()=>n.geometry=Ua(s)?s.geometry:null)),a(n)];return r(),{visualElement:n,remove:()=>i(l).remove()}}(t,r),p=function(t,e,n){const{graphic:r,view:l}=t,p=[],h=Y(r),c="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,d=new Ca,m=new jt({view:l,extensionType:wt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:It.OccludeAndTransparent});wt.visualElements.pointGraphics.shadowStyle.apply(m);const g=ce(wt.visualElements.heightPlaneAngleCutoff),_=new me({view:l,attached:!1,angleCutoff:g});wt.visualElements.heightPlane.apply(_);let y=1,v=1;const f=()=>{if(d.update(t),!n.displaying||c&&(n.isDraped||!Ua(r)||!r.geometry.hasZ))return e.laserlineEnabled=!1,m.attached=!1,void(_.attached=!1);e.laserlineEnabled=!0;const i=d.grabbingState&Pa.XY?wt.visualElements.laserlineAlphaMultiplier:1;i!==y&&(y=i,wt.visualElements.lineGraphics.shadowStyle.apply(e,i),wt.visualElements.pointGraphics.shadowStyle.apply(m,i));const a=d.grabbingState&Pa.Z?wt.visualElements.laserlineAlphaMultiplier:1;a!==v&&(v=a,wt.visualElements.heightPlane.apply(_,a)),function(t,e){const i=1===e.numSelected?e.firstSelected:e.numSelected>1&&s(e.firstGrabbedXY)?e.firstGrabbedXY:null;s(i)?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1}(m,d),function(t,e,i,a){if(a.numSelected>0){E(za,0,0,0);let e=0;t.forEachManipulator(((t,i)=>{i===Va.TRANSLATE_XY&&t.selected&&t instanceof Kt&&(j(za,za,t.renderLocation),e++)})),e>0?(i.heightManifoldTarget=O(za,za,1/e),i.attached=!0):i.attached=!1}else{const a=e.attachmentOrigin;s(a)&&t.view.renderCoordsHelper.toRenderCoords(a,za)?(i.heightManifoldTarget=za,i.attached=!0):i.attached=!1}}(t,e,_,d)};wt.visualElements.zVerticalLine.apply(m),p.push(n.on("changed",f),u((()=>n.displaying),f),e.events.on("attachment-origin-changed",f),a(m),a(_));const M=[],b=()=>{i(M).remove(),M.length=0,t.forEachManipulator((t=>M.push(t.events.on("grab-changed",f)))),t.forEachManipulator((t=>M.push(t.events.on("select-changed",f)))),f()};return b(),p.push(t.onManipulatorsChanged(b),o((()=>i(M)))),i(p)}(t,l.visualElement,r),h=[l,p,e.maskOccludee(n),e.trackGraphicState(r)];return{visualElement:l.visualElement,remove:()=>i(h).remove()}}(t);default:return null}}const Za=[1,.5,0],Ya=70,Ba=Math.ceil(Ya/3*2),qa=5*Math.PI/12,Wa=1*Math.PI/3,Ja=3;class Qa{constructor(){this._available=!0}set location(t){this._forEachManipulator3D((e=>e.location=t))}set elevationAlignedLocation(t){this._forEachManipulator3D((e=>e.elevationAlignedLocation=t))}set elevationInfo(t){this._forEachManipulator3D((e=>e.elevationInfo=t))}get renderLocation(){let t;return this._forEachManipulator3D((e=>{t||(t=e.renderLocation)})),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D((e=>e.available=t))}get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}_forEachManipulator3D(t){this.forEachManipulator(((e,i)=>{e instanceof Kt&&t(e,i)}))}}function Ka(t,e,i,a){const o=t.graphic,s=(t,i)=>e({action:t,graphic:o,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((t,e,i)=>(e.next((t=>("start"===t.action&&s("start",t),t))).next(Je(o,a)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&s("update",t);break;case"end":s("end",t)}return t})),{steps:e,cancel:i=i.next(Qe(o)).next((t=>(s("end",{screenDeltaX:0,screenDeltaY:0}),t)))})))}function $a(t){if(n(t)||"polyline"!==t.type&&"polygon"!==t.type)return 0;const e=("polyline"===t.type?t.paths:t.rings)[0];if(!e||e.length<2)return 0;const i=e[0],a=e[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}function to(t){if(n(t)||n(t.axis))return 1;const{mapStart:e,mapEnd:i,axis:a}=t,o=[i.x-e.x,i.y-e.y];return o[0]*a[0]+o[1]*a[1]>0?1:-1}class eo extends Qa{constructor(t){super(),this._handles=new Se,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Ya,this._updateAfterDrag=!1,this.events=new Xt,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this._handles=l(this._handles),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:e}of this._arrowManipulatorInfos)t(e,Va.TRANSLATE_XY)}createGraphicDragPipeline(t,e,i){const a=e.graphic,o=Y(a),s=p(a.geometry).spatialReference;return Ka(e,i,(e=>this.createDragPipeline(((i,a,o,s,n)=>(({steps:a,cancel:o}=t(i,a,o,s,n)),e(i,a,o))),o,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,a,o){return i(this._arrowManipulatorInfos.map((({manipulator:i},s)=>Ke(i,((i,n,r,l,p)=>{const h=n.next((t=>({...t,manipulatorType:Va.TRANSLATE_XY}))).next($e(this._view,i.elevationAlignedLocation)).next(ke(this._view,i.elevationAlignedLocation,e,a,o)).next(ti(i.location,this.angle+(s+1)*Math.PI*.5)).next(ei());t(i,h,r,l,p)})))))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:e},i){const a=this._radius/Ya,o=54*a,s=o*Math.sqrt(3)/2,n=hi(this._opaqueMaterial,s,o/2,o/2,.02);ci(n,we(Ue.get(),E(Ce.get(),0,-s/3,0))),t.renderObjects=[new $t(n,vi.Focused),new $t(n.instantiate({material:this._transparentMaterial}),vi.Unfocused)],t.radius=s/3*2*1.2;const r=Ee(Ue.get(),i*Math.PI/2),l=we(Ue.get(),E(Ce.get(),0,100*a,0));je(e,r,l)}_createManipulators(){for(let t=0;t<4;t++){const e=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(e)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,e=Oe(Ue.get(),t,A(0,0,1));if(n(e))return;const i=Ae(Ue.get(),E(Ce.get(),this.displayScale,this.displayScale,this.displayScale)),a=je(Ue.get(),i,e);for(const t of this._arrowManipulatorInfos){const e=je(Ue.get(),a,t.transform);t.manipulator.modelTransform=e}}_createArrowManipulator(t){const e=new Kt({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:A(0,0,1)}}),i={manipulator:e,transform:Le()};return this._updateArrowManipulator(i,t),this._handles.add(e.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(t=1){const e=xe.toUnitRGBA(Et.main);return e[3]*=t,new yi({color:e,transparent:1!==t,cullFace:pi.Back,renderOccluded:It.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:t})=>t))}}}class io{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&s(this._lastDragEvent)&&s(this._next)){const e=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(s(i)){const a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?i:e,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(a)}}this._enabled=t}_snap(t){const e=s(this._view)?this._view.toMap(t,{exclude:[]}):null;return s(e)&&s(this._view)&&(e.z=B(e,this._view,this._elevationInfo)),e}createDragEventPipelineStep(t,e){this._view=t,this._elevationInfo=e,this._lastDragEvent=null;const i=new ii;return this._next=i,[t=>{if(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled){const e=this._snap(t.screenEnd);return s(e)?{action:t.action,mapStart:t.mapStart,mapEnd:e,screenStart:t.screenStart,screenEnd:t.screenEnd}:null}return{action:t.action,mapStart:t.mapStart,mapEnd:t.mapEnd,screenStart:t.screenStart,screenEnd:t.screenEnd}},i]}}class ao extends Qa{constructor(t){super(),this._snapToScene=new io,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Ya,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,Va.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,e,i){const a=e.graphic,o=Y(a),s=p(a.geometry).spatialReference;return Ka(e,i,(e=>this.createDragPipeline(((i,a,o,s,n)=>(({steps:a,cancel:o}=t(i,a,o,s,n)),e(i,a,o))),o,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const o=this._view;return Ke(this._manipulator,((s,n,r,l,p)=>{const h=n.next($e(o,s.elevationAlignedLocation)).next(ke(o,s.elevationAlignedLocation,e,i,a)).next(...this._snapToScene.createDragEventPipelineStep(o,e)).next((t=>({...t,manipulatorType:Va.TRANSLATE_XY}))).next(ei());t(s,h,r,l,p)}))}_updateManipulatorTransform(){const t=Ae(Ue.get(),E(Ce.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new Kt({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:A(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=di(this._discMaterial,.02,1,128,A(0,0,1),A(0,0,0));t.transformation=Ae(Le(),A(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new $t(t,vi.Focused),new $t(t.instantiate({material:this._discMaterialTransparent}),vi.Unfocused)],this._manipulator.radius=this._radius/Ya*80}_createMaterial(t=1){const e=xe.toUnitRGBA(Et.main);return e[3]*=t,new yi({color:e,transparent:1!==t,cullFace:pi.Back,renderOccluded:It.Transparent})}get test(){return{discManipulator:this._manipulator}}}class oo extends Qa{constructor(t){super(),this._radius=Ya,this.events=new Xt,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){t(this._manipulator,Va.TRANSLATE_Z)}createGraphicDragPipeline(t,e,i){const a=p(e.graphic.geometry).spatialReference;return Ka(e,i,(e=>this.createDragPipeline(((i,a,o,s,n)=>(({steps:a,cancel:o}=t(i,a,o,s,n)),e(i,a,o))),a)),this._view.state.viewingMode)}createDragPipeline(t,e){const i=this._view;return Ke(this._manipulator,((a,o,s,n,r)=>{const l=o.next((t=>({...t,manipulatorType:Va.TRANSLATE_Z}))).next(Xe(i,a.renderLocation,e)).next(ei());t(a,l,s,n,r)}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/Ya,e=wt.zManipulator.height*t,i=wt.zManipulator.coneHeight*t,a=wt.zManipulator.coneWidth*t,o=wt.zManipulator.width*t,s=[A(0,0,0),A(0,0,e)],n=[A(0,0,0),A(0,0,e+i)],r=(t=>{const i=Le();return Te(i,i,[0,0,e]),De(i,i,Math.PI/2),i})(),l=(t,e)=>{const i=Mi(wt.zManipulator.color,e);return[i.r/255,i.g/255,i.b/255,wt.zManipulator.color.a*t]},p=te(l(1,.25),It.Occlude),h=te(l(1,0),It.Occlude),c=te(l(.7,0),wt.zManipulator.renderOccluded),d=te(l(.85,0),wt.zManipulator.renderOccluded),u=ui(p,s,o/2,16,!1),m=mi(p,i,a/2,16,!1);m.transformation=r,this._manipulator.renderObjects=[new $t(m,vi.Unfocused),new $t(u,vi.Unfocused),new $t(m.instantiate({material:h}),vi.Focused),new $t(u.instantiate({material:h}),vi.Focused),new $t(m.instantiate({material:c}),vi.Unfocused),new $t(u.instantiate({material:c}),vi.Unfocused),new $t(m.instantiate({material:d}),vi.Focused),new $t(u.instantiate({material:d}),vi.Focused)],this._manipulator.radius=o/2+2,this._manipulator.collisionType={type:"line",paths:[n]}}_createManipulator(){const t=new Kt({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const e=this._view.state.camera,i=so;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=T(e.eye,i),o=e.computeRenderPixelSizeAtDist(a),s=D(no,i,e.eye);G(s,s);const n=ro;this._view.renderCoordsHelper.worldUpAtPosition(so,n);const r=Math.abs(I(s,n)),l=R(no,s,n),p=R(no,l,n),h=de(r,.01,1),c=1-Math.sqrt(1-h*h)/h/e.fullWidth,d=this._radius/Ya,u=wt.zManipulator.width*d;O(p,G(p,p),(1/c-1)*a+o*u),t[12]-=no[0],t[13]-=no[1],t[14]-=no[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const so=w(),no=w(),ro=w();class lo extends Qa{constructor(t){super(),this._handles=new Se,this._interactive=!0;const{tool:e,view:i,snapToScene:a,radius:o}=t;this._view=i,this.xyManipulation=new ao({tool:e,view:i,snapToScene:a,radius:o}),this.xyAxisManipulation=new eo({tool:e,view:i,radius:o}),this.zManipulation=new oo({tool:e,view:i,radius:o}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((t=>this._handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,e,a){return i([this.xyManipulation.createGraphicDragPipeline(((e,i,a,o,s)=>t(ho.XY,e,i,a,o,s)),e,a),this.xyAxisManipulation.createGraphicDragPipeline(((e,i,a,o,s)=>t(ho.XY_AXIS,e,i,a,o,s)),e,a),this.zManipulation.createGraphicDragPipeline(((e,i,a,o,s)=>t(ho.Z,e,i,a,o,s)),e,a)])}createDragPipeline(t,e,a,o){return i([this.xyManipulation.createDragPipeline(((e,i,a,o,s)=>t(ho.XY,e,i,a,o,s)),e,a,o),this.xyAxisManipulation.createDragPipeline(((e,i,a,o,s)=>t(ho.XY_AXIS,e,i,a,o,s)),e,a,o),this.zManipulation.createDragPipeline(((e,i,a,o,s)=>t(ho.Z,e,i,a,o,s)),a)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator((e=>t(e,Va.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((e=>t(e,Va.TRANSLATE_XY))),this.zManipulation.forEachManipulator((e=>t(e,Va.TRANSLATE_Z)))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator((t=>t.focused))||this.xyAxisManipulation.someManipulator((t=>t.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,e=this.xyManipulation;if(M("esri-mobile"))return;const i=[];e.forEachManipulator((t=>i.push(t))),t.forEachManipulator((t=>i.push(t)));const a=()=>{const e=[];this._xyAxisVisible||t.forEachManipulator((t=>e.push(t.disableDisplay()))),this._handles.remove(po),this._handles.add(e,po)};for(const t of i)this._handles.add(t.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(_((()=>this._view.inputManager?.latestPointerType),a)),a()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator((e=>{e.interactive=!t&&this._interactive||e.grabbing}))}static radiusForSymbol(t){const e=s(t)&&"point-3d"===t.type&&t.symbolLayers;return e&&e.length>0&&e.some((t=>"icon"===t.type))?Ba:Ya}}const po="disable-xy-axis-display";var ho;!function(t){t[t.XY=0]="XY",t[t.XY_AXIS=1]="XY_AXIS",t[t.Z=2]="Z"}(ho||(ho={}));class co extends Qa{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,Va.TRANSLATE_XY)}createGraphicDragPipeline(t){return Ka(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const e=this._view,i=this._graphicState.graphic,a=s(i.geometry)?i.geometry.spatialReference:null;return Ke(this._manipulator,((o,s,n,r,l)=>{const p=s.next(Ze(l,e,i,a)).next(ai()).next(ei());t(o,p,n,r,l)}))}_createManipulator(){const t=this._view,e=this._graphicState.graphic;this._manipulator=new bi({graphic:e,view:t,selectable:!0,cursor:"move"})}}class uo{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class mo{constructor(t,e,i){this.dx=t,this.dy=e,this.allGraphics=i,this.type="graphic-move"}}class go{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let _o=class extends(Zt(Xt.EventedMixin(oi))){constructor(t){super(t),this.graphics=new kt,this.enableZ=!0,this.tooltipOptions=new Oi,this.type="move-3d",this._tooltip=null}initialize(){const{graphics:t,view:e}=this;this.addHandles([t.on("change",(()=>this._refreshManipulators())),u((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new vt({view:e}):l(this._tooltip)}),y)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=l(this._tooltip),this._moveManipulation=l(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation?.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter((t=>ne(t)===re.SUPPORTED)).map((t=>new yo(t)));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map((t=>this.view.trackGraphicState(t.state)))),this._updateMoveManipulation(t))}_createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new co({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator((t=>this.handles.add([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:i.graphic}),t.stopPropagation()})),t.events.on("grab-changed",(({action:t})=>{const{tooltipOptions:e,_tooltip:i}=this;n(i)||("start"===t?i.info=new Di({tooltipOptions:e}):i.clear())}))]))),this.handles.add(e.manipulationXY.createDragPipeline(((e,i,a,o)=>this._buildDragEventPipeline(t,ho.XY,e,i,a,o))))}this._createMoveManipulation(t)}_createMoveManipulation(t){const e=new lo({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?lo.radiusForSymbol(t[0].graphic.symbol):Ya});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator((t=>{this.handles.add(t.events.on("immediate-click",(i=>{e.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=e=>i=>{this.handles.add(i.events.on("focus-changed",(({action:i})=>{const a=this._tooltip;n(a)||("focus"===i?this._updateMoveTooltip(t,e):a.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(ho.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(ho.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(ho.Z));const a=()=>this._updateMoveManipulation(t);for(const e of t)this.handles.add([e.state.on("changed",a),u((()=>e.state.displaying),a)]);const o=t[t.length-1];this.handles.add(o.state.on("changed",(()=>this._updateMoveManipulationAngle(o)))),this.handles.add(e.createDragPipeline(((e,i,a,o,s)=>this._buildDragEventPipeline(t,e,i,a,o,s)),Y(o.graphic),p(o.graphic.geometry).spatialReference,o.graphic)),this._updateMoveManipulationAngle(o)}_createVisualElements(t){for(const i of t){const a=i.graphic,o=Xa({view:this.view,graphic:a,forEachManipulator:t=>{i.manipulationXY?.forEachManipulator(t),this._moveManipulation.forEachManipulator(t)},onManipulatorsChanged:()=>e()});n(o)||(i.geometryRepresentation=o.visualElement,i.geometryRepresentation instanceof Ot&&this.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(()=>{i.state.isDraped||this._updateMoveManipulation(t)})),u((()=>i.state.isDraped),(()=>this._updateMoveManipulation(t)))]),this.handles.add(o))}}_updateMoveManipulationAngle(t){this._moveManipulation.angle=$a(t.graphic.geometry)}_updateMoveManipulation(t){const e=Qt(0,0,0,this.view.spatialReference);let i=0,a=!1;const o=this._moveManipulation;for(const o of t){if(!o.state.displaying)continue;const t=o.state.graphic;this.enableZ&&he(t)&&(a=!0);const n=o.geometryRepresentation instanceof Ot&&!o.state.isDraped?o.geometryRepresentation.attachmentOrigin:ee(this.view,t);if(s(n)){const{x:t,y:a,z:o}=n;e.x+=t,e.y+=a,o&&(e.z??(e.z=0),e.z+=o),i++}}i>0?(e.x/=i,e.y/=i,e.z??(e.z=0),e.z/=i,o.location=e,o.xyManipulation.available=!0,o.xyAxisManipulation.available=!0,o.zManipulation.available=a):o.available=!1}_buildDragEventPipeline(t,e,i,a,o,s){const n=[],r=[];let l=null,p=null;const h=()=>{for(const t of n)t.dragging=!1;n.length=0,r.length=0,l=null,p=null,this._moveManipulation.interactive=!0};if(1===t.length&&e===ho.XY){const e=t[0].graphic;({steps:a,cancel:o}=this._buildSnappingPipelineSteps(e,Y(e),a,o,s))}return o=o.next((t=>p?.(t))).next((()=>(this.emit("graphic-move-stop",new go(r)),this.destroyed||h(),null))),{steps:a=a.next((e=>{if("start"===e.action){n.length=0,r.length=0;for(const e of t)e.dragging||!e.manipulationXY?.hasManipulator(i)&&e.manipulationXY?.grabbing||(n.push(e),r.push(e.graphic),e.dragging=!0);if(0!==r.length&&(this._moveManipulation.interactive=!1,l=si(r,this.view.state.viewingMode),p=ni(r),this.emit("graphic-move-start",new uo(r)),this.destroyed))return null}return 0!==r.length?e:null})).next((t=>l?.(t))).next((i=>(this._updateMoveTooltip(t,e,i),i))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const e=this.view.toScreen(t.mapStart),i=this.view.toScreen(t.mapEnd),a=i.x-e.x,o=i.y-e.y;if(this.emit("graphic-move",new mo(a,o,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new go(r)),this.destroyed)return null;h()}return null})),cancel:o}}_updateMoveTooltip(t,e,i){const{tooltipOptions:a,_tooltip:o}=this;if(n(o))return;o.clear();const s=0===t.length?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(e){case ho.XY:o.info=new Di({tooltipOptions:a}),this._updateMoveTooltipDistance(o.info,i,((t,e)=>yt(t,e,s)));break;case ho.XY_AXIS:o.info=new Ii({tooltipOptions:a}),this._updateMoveTooltipDistance(o.info,i,((t,e)=>{const a=yt(t,e,s);return Bt(a,to(i))}));break;case ho.Z:o.info=new Gi({tooltipOptions:a}),this._updateMoveTooltipDistance(o.info,i,Vi)}}_updateMoveTooltipDistance(t,e,i){if(s(e)&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=s(n)?n:qt}}_buildSnappingPipelineSteps(t,e,i,a,o){const s=t.geometry;if(n(s)||"point"!==s.type&&"mesh"!==s.type)return{steps:i,cancel:a};const r=("point"===s.type?s:s.anchor).clone(),l=new Ai({elevationInfo:e,pointer:o,editGeometryOperations:Si.fromGeometry(r,this.view.state.viewingMode),visualizer:new xt,excludeFeature:t}),p=this.snappingManager,{snappingStep:h,cancelSnapping:c}=Ti({snappingContext:l,snappingManager:p,updatingHandles:this.updatingHandles});return a=a.next(c),{steps:i=i.next((e=>(r.z=q(this.view,r,Y(t),{mode:"absolute-height",offset:0}),{...e,snapOrigin:l.coordinateHelper.pointToVector(r)}))).next(...h),cancel:a}}get test(){return{tooltip:this._tooltip}}};t([f({constructOnly:!0,nonNullable:!0})],_o.prototype,"view",void 0),t([f()],_o.prototype,"graphics",void 0),t([f({constructOnly:!0,nonNullable:!0})],_o.prototype,"enableZ",void 0),t([f({constructOnly:!0,type:Oi})],_o.prototype,"tooltipOptions",void 0),t([f({constructOnly:!0})],_o.prototype,"snappingManager",void 0),t([f()],_o.prototype,"type",void 0),t([f()],_o.prototype,"updating",null),_o=t([S("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],_o);class yo{constructor(t){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Gt({graphic:t})}get graphic(){return this.state.graphic}}function vo(t,e,i){const a="on-the-ground"===i.mode?xi.XY:xi.XYZ;return new wi(t,a,e,0)}function fo(t,e,i){const a=w();if(!t.renderCoordsHelper.toRenderCoords(e,a))return null;const o=Mo(t,e,Fi(i.plane)),s=Mo(t,e,i.edgeDirection);if(n(o)||n(s))return null;const r=R(w(),o,s);return ki(a,r,Xi())}function Mo(t,e,i){const a=Qt(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),o=w(),s=w();return t.renderCoordsHelper.toRenderCoords(e,o)&&t.renderCoordsHelper.toRenderCoords(a,s)?L(s,o,s):null}let bo=class extends ft{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=qt,this.area=null,this.totalLength=null}};t([f()],bo.prototype,"type",void 0),t([f()],bo.prototype,"distance",void 0),t([f()],bo.prototype,"area",void 0),t([f()],bo.prototype,"totalLength",void 0),bo=t([S("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],bo);let So=class extends(Xt.EventedMixin(Yt)){constructor(t){super(t),this._vertexManipulatorMaterial=te(wt.colorToVec4(wt.reshapeManipulators.vertex.color),wt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=ie(wt.colorToVec4(wt.reshapeManipulators.vertex.outlineColor),wt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=ie(wt.colorToVec4(wt.reshapeManipulators.vertex.hoverOutlineColor),wt.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=te(wt.colorToVec4(wt.reshapeManipulators.edge.color),wt.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=ie(wt.colorToVec4(wt.reshapeManipulators.edge.outlineColor),wt.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=te(wt.colorToVec4(wt.reshapeManipulators.edgeOffset.color),wt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=te(wt.colorToVec4(wt.reshapeManipulators.edgeOffset.hoverColor),wt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=te(wt.colorToVec4(wt.reshapeManipulators.selected.color),wt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=ie(wt.colorToVec4(wt.reshapeManipulators.selected.outlineColor),wt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=ie(wt.colorToVec4(wt.reshapeManipulators.selected.hoverOutlineColor),wt.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._manipulatorHandles=new Se,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Ao.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:t,view:e}=this,i=this._graphicState=new Gt({graphic:t});this._tooltip=new vt({view:e}),this.addHandles([u((()=>i.displaying),(t=>{for(const e of this._manipulatorInfos)e.manipulator.available=t})),u((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:t,enabled:e,edgeOffsetEnabled:i})=>{s(t)&&(t.visible=e,t.edgeDistance=i?"far":"default")}),g),_((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),g),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=l(this._segmentLabels),this._tooltip=l(this._tooltip),this._removeManipulators()}get inputGeometry(){return s(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(t){this._recreateEditGeometryAndManipulators(t)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const t=this._manipulatorInfos.filter((t=>t.manipulator.selected&&"vertex"===t.type));this._removeVertices(t)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=l(this._moveManipulation),this._graphicMoveManipulation=l(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(t){if(n(this._editGeometryOperations))return;const e=Y(this.graphic);for(const i of this._editGeometryOperations.data.components){const a=t?.byComponentIndex.get(i.index);for(const t of i.vertices){const i=a?.has(t.index);this._createVertexOrEdgeManipulator(t,e,i)}for(const t of i.edges)this._createVertexOrEdgeManipulator(t,e)}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return s(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return s(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(n(this._editGeometryOperations))return null;const t=this._editGeometryOperations.redo();return s(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}undo(){if(n(this._editGeometryOperations))return null;this.emit("undo");const t=this._editGeometryOperations.undo();return s(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(t){const e={byComponentIndex:new Map};if(s(t)&&s(this.inputGeometry)&&dt(t,this.inputGeometry))for(const t of this._manipulatorInfos)if("vertex"===t.type&&t.manipulator.selected){const{index:i,component:{index:a}}=t.handle,{byComponentIndex:o}=e,s=o.get(a)||new Set;s.add(i),o.set(a,s)}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=l(this._editGeometryOperations),this._segmentLabels=l(this._segmentLabels),n(t)||(this._editGeometryOperations=Si.fromGeometry(t,this.view.state.viewingMode),this._createManipulators(e),this._segmentLabels=new Da({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:Y(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(t,e){if("end"===e.action)return e;let i=0;const a=[],o=this._manipulatorInfos.some((t=>"vertex"===t.type&&t.manipulator.selected)),s=t===To.SELECTED_OR_ALL&&o;for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.grabbing||s&&!t.manipulator.selected||a.push(t),i++);if(0===a.length)return e;if(this._moveVertices(a,e),a.length===i){if(this._updateEventState(Ao.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Ao.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((t,e)=>"vertex"===e.type&&e.manipulator.selected?t+1:t),0)>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(Ao.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:a}=t;if(!e&&!i&&!a)return;const o=[];for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.selected&&!e.manipulator.grabbing||e===t.info)&&o.push(e);this._moveVertices(o,t,Ei.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case Ao.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Ao.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Ao.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Ao.MOVING:switch(this._reshapeEventState){case Ao.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Ao.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Ao.RESHAPING:switch(this._reshapeEventState){case Ao.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Ao.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createGraphicMoveManipulation(){const{tool:t,view:e}=this,i=this._graphicState;if(this._graphicMoveManipulation=new co({tool:t,view:e,graphicState:i}),this.enableMoveGraphic){let t=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,i,a)=>{i.next((t=>this._trackNumDragging(t))).next((e=>("start"===e.action&&(t=p(this._editGeometryOperations).createUndoGroup()),e))).next((t=>this._perGraphicManipulatorDragAction(To.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(ho.XY,t),t))).next((e=>{"end"===e.action&&(this._tooltip.clear(),t=h(t))})),a.next((()=>this._onDragCancel(!0,(()=>t=h(t)))))}))),this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(t,!1))))}else this._graphicMoveManipulation.forEachManipulator((t=>{t.grabbable=!1,t.cursor=null}));this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(t.events.on("immediate-click",(t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})))))}_createMoveManipulation(t){const{graphic:e,handles:i,tool:a,view:o}=this,s=this._graphicState;this._moveManipulation=new lo({tool:a,view:o,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&he(e),snapToScene:!1,radius:lo.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>i.add([t.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(t)||this._manipulatorInfos.some((t=>t.manipulator.selected))||this.emit("immediate-click",{...i,graphic:e}),i.stopPropagation()})),this._watchAndUpdateGrabState(t,!1)])));const n=t=>e=>{i.add(e.events.on("focus-changed",(({action:e})=>{"focus"===e&&this._tooltipOptions.enabled?this._updateTranslateTooltip(t):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(n(ho.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(n(ho.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(n(ho.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const r=p(e.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,o,s,n,r)=>{const{snappingStep:l,cancelSnapping:h}=Ti({predicate:t=>!!t.info,snappingManager:a.snappingManager,snappingContext:new Ai({editGeometryOperations:p(this._editGeometryOperations),elevationInfo:t,pointer:r,excludeFeature:e,visualizer:new xt}),updatingHandles:this.updatingHandles,useZ:!1});return n=n.next((t=>(this._onDragCancel(),t))).next(h),{steps:s=s.next((t=>this._trackNumDragging(t))).next((t=>{const e=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));return t.manipulatorType===Va.TRANSLATE_XY&&1===e.length?{...t,info:e[0],snapOrigin:e[0].handle.pos}:t})).next(ri(this.view,t,e)).next(...l).next(ai()).next((t=>this._perGraphicManipulatorDragAction(To.SELECTED_OR_ALL,t))).next((t=>(this._updateTranslateTooltip(i,t),t))),cancel:n}}),t,r,e),u((()=>s.displaying),(()=>this._updateMoveManipulationPosition()),g),s.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),u((()=>s.isDraped),(t=>{this._updateMoveManipulationPosition();const e="align-move-manipulation";t?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):i.remove(e)}),g)])}_createVisualElements(){const{graphic:t,view:e}=this,i=Xa({view:e,graphic:t,forEachManipulator:t=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);for(const e of this._manipulatorInfos)t(e.manipulator,Va.TRANSLATE_XY)}},onManipulatorsChanged:t=>this.on("manipulators-changed",t)});s(i)&&(this._outlineVisualElement=i.visualElement instanceof Ot?i.visualElement:null),s(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t,e=Y(this.graphic)){const a=wt.reshapeManipulators.edgeOffset,o=a.size/2,r=o+a.collisionPadding,l=o/r,p=l*Math.sqrt(3)/2;n(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=hi(this._edgeOffsetManipulatorMaterial,p,l/2,l/2,a.height,a.offset)),n(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=hi(this._edgeOffsetManipulatorMaterial,-p,l/2,l/2,a.height,-a.offset));const h=[new $t(this._edgeOffsetManipulatorGeometryInside.instantiate(),vi.Unfocused),new $t(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),vi.Focused),new $t(this._edgeOffsetManipulatorGeometryOutside.instantiate(),vi.Unfocused),new $t(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),vi.Focused)],c=new Kt({view:this.view,renderObjects:h,elevationInfo:"on-the-ground"!==e.mode||Bi(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:r,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:A(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),d=new Kt({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),u={manipulator:c,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:d,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(u,a.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(u);const m=[];for(const t of[u.handle.leftVertex,u.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(t);s(e)&&m.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(u))))}u.locationUpdateHandle=i(m),this._manipulatorHandles.add(u.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(d,!0)],c),this._manipulatorHandles.add(Ke(c,this._createEdgeOffsetPipeline(u,e)),c),this._manipulatorHandles.add(Ke(d,((t,i,a,o)=>{if("touch"===o)this._createEdgeOffsetPipeline(u,e)(t,i,a);else if(this.enableMoveGraphic){const o=this.graphic,n=s(o.geometry)?o.geometry.spatialReference:null;i.next((t=>this._trackNumDragging(t))).next($e(this.view,t.elevationAlignedLocation)).next(ke(this.view,t.elevationAlignedLocation,e,n,o)).next(ei()).next(ai()).next((t=>this._perGraphicManipulatorDragAction(To.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(ho.XY,t),t))).next((t=>{"end"===t.action&&this._tooltip.clear()})),a.next((()=>this._onDragCancel(!t.metadata.deleting)))}})),c);const g=t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",g),d.events.on("immediate-click",g),c.events.on("focus-changed",(({action:t})=>{const e=this._tooltipOptions;if("focus"===t&&e.enabled){const t=this._tooltip.info=new bo({tooltipOptions:e});this._updateTooltipAreaOrTotalLength(t)}else this._tooltip.clear()}))],c),this._manipulatorInfos.push(u),this.manipulators.add(c),this.manipulators.add(d),this.emit("manipulators-changed"),u}_autoHideEdgeOffsetManipulator(t,e){const a=t.manipulator,o=t.edgeManipulator,n=()=>{t.visibilityHandle=h(t.visibilityHandle);const n=this._getManipulatorInfoFromHandle(t.handle.leftVertex),r=this._getManipulatorInfoFromHandle(t.handle.rightVertex),l=s(n)&&s(r)&&function(t,e,i){const a=i.projectToRenderScreen(t,Q()),o=i.projectToRenderScreen(e,Q());return s(a)&&s(o)?P(D(a,a,o)):0}(n.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!a.focused&&!o.focused||l)&&(a.grabbable=!l,o.grabbable=!l,t.visibilityHandle=i([a.disableDisplay(),{remove:()=>{a.grabbable=!0,o.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([a.events.on("focus-changed",n),o.events.on("focus-changed",n),{remove:()=>{h(t.visibilityHandle),o.metadata.deleting=!0,this.manipulators.remove(o)}}],a),n()}_updateEdgeOffsetManipulator(t){this._updateManipulatorPosition(t);const{coordinateHelper:e}=p(this._editGeometryOperations).data,i=fo(this.view,t.manipulator.elevationAlignedLocation,vo(e,t.handle,p(t.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(t.handle.leftVertex),o=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(n(a)||n(o))return;const r=a.manipulator.renderLocation,l=o.manipulator.renderLocation,h=s(i)?function(t,e,i){const a=Fi(t),o=L(w(),e,i),s=R(w(),o,a),n=R(w(),o,s);return Pe(o[0],o[1],o[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1)}(i,r,l):Ve;t.manipulator.modelTransform=h,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=h;const c=V(D(Eo,r,l))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-c,0,0],[c,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,a,o)=>{this._clearSelection();const{step:s,cleanup:n}=this._initializeEdgeOffset(t,e);a.next((t=>this._trackNumDragging(t))).next($e(this.view,i.elevationAlignedLocation)).next(s).next(Ye(this.view)).next(Be(this.view,p(this._editGeometryOperations).data.spatialReference)).next(ai()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(t)).next(this._showEdgeOffsetTooltip()).next((t=>{"end"===t.action&&n()})),o.next((()=>{i.metadata.deleting||(n(),this._onDragCancel())}))}}_initializeEdgeOffset(t,e){const o=p(this._editGeometryOperations),r=vo(o.data.coordinateHelper,t.handle,e),l=o.createUndoGroup(),c=fo(this.view,t.manipulator.elevationAlignedLocation,r);if(r.requiresSplitEdgeLeft){const e=this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge);s(e)&&this._splitEdgeManipulator(e,1)}if(r.requiresSplitEdgeRight){const e=this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge);s(e)&&this._splitEdgeManipulator(e,0)}const d=()=>new Ni({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:o.data.spatialReference}),m=new Ot({view:this.view,isDraped:this._graphicState.isDraped,geometry:d(),elevationInfo:t.elevationInfo,width:wt.visualElements.lineGraphics.outline.width,color:wt.colorToVec4(Et.main),attached:!0});let g;const _=()=>{this._cleanEdgeOffsetCollapsedEdges(t),g=h(g)},y=this.on("undo",_);return g=i([a(m),u((()=>this._graphicState.isDraped),(t=>m.isDraped=t)),this._graphicState.on("changed",(()=>m.geometry=d())),l,y]),{step:t=>n(r)||n(c)?(_(),null):{...t,operation:r,plane:c},cleanup:_}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||n(e.operation))return e;this._updateEventState(Ao.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o}=e;return(i||a||o)&&(this._offsetEdge(t,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return t=>{const{operation:e,mapEnd:i}=t;return n(e)||n(i)?t:("start"===t.action&&e.selectArrowFromStartPoint(i),{...t,signedDistance:e.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return t=>{const{mapEnd:e,signedDistance:i,operation:a}=t,o=this._tooltip,r=this._tooltipOptions;if(!r.enabled||n(i))return o.clear(),t;let l=o.info;(n(l)||"reshape-edge-offset"!==l.type)&&(l=o.info=new bo({tooltipOptions:r}));const{coordinateHelper:h}=p(this._editGeometryOperations).data;return l.distance="end"===t.action?qt:function(t,e,i,a,o){if(t){const t=o.toXYZ(o.pointToVector(i)),n=Zi(a,t,Ce.get()),r=bt(n,t,o.spatialReference);if(s(r))return Wt(r.value*Math.sign(e),r.unit)}return Wt(e*zi(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,e,a.plane,h),this._updateTooltipAreaOrTotalLength(l),t}}_cleanEdgeOffsetCollapsedEdges(t){const e=t.handle.leftVertex.leftEdge?.leftVertex,i=t.handle.leftVertex,a=t.handle.rightVertex.rightEdge?.rightVertex,o=t.handle.rightVertex,n=p(this._editGeometryOperations).data.coordinateHelper,r=[];if(e&&n.distance(e.pos,i.pos)<jo){const t=this._getManipulatorInfoFromHandle(i);s(t)&&r.push(t)}if(n.distance(i.pos,o.pos)<jo||a&&n.distance(a.pos,o.pos)<jo){const t=this._getManipulatorInfoFromHandle(o);s(t)&&r.push(t)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(t){const e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}_createVertexOrEdgeManipulator(t,e=Y(this.graphic),a=!1){if("edge"===t.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,e);if(!this.enableMidpoints)return null}if(n(this._vertexManipulatorGeometry)||n(this._vertexManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(wt.reshapeManipulators.vertex);this._vertexManipulatorGeometry=gi(this._vertexManipulatorMaterial,t,16,16),this._vertexManipulatorOutlineGeometry=gi(this._vertexManipulatorOutlineMaterial,e,16,16)}if(n(this._edgeManipulatorGeometry)||n(this._edgeManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(wt.reshapeManipulators.edge);this._edgeManipulatorGeometry=gi(this._edgeManipulatorMaterial,t,16,16),this._edgeManipulatorOutlineGeometry=gi(this._edgeManipulatorOutlineMaterial,e,16,16)}const o=s(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[new $t(this._vertexManipulatorGeometry.instantiate(),Oo.Vertex|vi.Unselected),new $t(this._vertexManipulatorOutlineGeometry.instantiate(),Oo.Vertex|vi.Unfocused|vi.Unselected),new $t(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Oo.Vertex|vi.Focused|vi.Unselected),new $t(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),vi.Selected),new $t(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),vi.Selected|vi.Unfocused),new $t(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),vi.Selected|vi.Focused)];this.enableMidpoints&&o.push(new $t(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Oo.Edge|vi.Focused|vi.Unselected),new $t(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Oo.Edge|vi.Focused|vi.Unselected),new $t(this._edgeManipulatorGeometry.instantiate(),Oo.Edge|vi.Unfocused|vi.Unselected),new $t(this._edgeManipulatorOutlineGeometry.instantiate(),Oo.Edge|vi.Unfocused|vi.Unselected));const r=new Kt({view:this.view,renderObjects:o,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});r.selected=a,this._setTypeSpecificManipulatorSettings(r,t,e);const l="edge"===t.type?{manipulator:r,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:r,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(l),this.manipulators.add(r),this._updateManipulatorPosition(l),"edge"===l.type){const t=[];for(const e of[l.handle.leftVertex,l.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(e);s(i)&&t.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(l))))}l.locationUpdateHandle=i(t),this._manipulatorHandles.add(l.locationUpdateHandle,r)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(r,!0),r);const c=Ke(r,((t,i,a,o)=>{let s=null;const{snappingStep:n,cancelSnapping:r}=Ti({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Ai({editGeometryOperations:p(this._editGeometryOperations),elevationInfo:e,pointer:o,excludeFeature:this.graphic,visualizer:new xt}),updatingHandles:this.updatingHandles,useZ:!1});a=a.next((e=>(this._onDragCancel(!t.metadata.deleting,(()=>s=h(s))),e))).next(r),i.next((t=>this._trackNumDragging(t))).next((t=>{if("start"===t.action&&(s=p(this._editGeometryOperations).createUndoGroup()),"edge"===l.type){const e=this._splitEdgeManipulator(l);return{...t,info:e,snapOrigin:e.handle.pos}}return{...t,info:l,snapOrigin:l.handle.pos}})).next($e(this.view,t.elevationAlignedLocation)).next(qe(this.view,this.graphic,t.elevationAlignedLocation,t.location.spatialReference,this.graphic)).next(ri(this.view,e,this.graphic)).next(...n).next(ai()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(s=h(s)),this._updateTranslateVertexTooltip(t,ho.XY,e)}))}));return this._manipulatorHandles.add([c,r.events.on("immediate-click",(t=>this._manipulatorClickCallback(t,l))),r.events.on("select-changed",(()=>{l.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),r.events.on("focus-changed",(({action:t})=>{"focus"===t&&"edge"!==l.type?this._updateTranslateVertexTooltip(r,ho.XY):this._tooltip.clear()}))],r),this.emit("manipulators-changed"),l}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_onDragCancel(t=!0,e){switch(this._numDragging--,t&&(this.undo(),this.outputGeometry=s(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),s(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Ao.NONE:break;case Ao.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Ao.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(Ao.NONE)}_setTypeSpecificManipulatorSettings(t,e,i){switch(e.type){case"vertex":t.state=Oo.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2,t.radius=wt.reshapeManipulators.vertex.size/2+wt.reshapeManipulators.vertex.collisionPadding,t.elevationInfo=i,t.interactive=s(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":t.state=Oo.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1,t.radius=wt.reshapeManipulators.edge.size/2+wt.reshapeManipulators.edge.collisionPadding,t.elevationInfo="on-the-ground"!==i.mode||Bi(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",(i=>this._onGrabStateChanged(t,e,i.action,i.pointerType)))}_onGrabStateChanged(t,e,i,a="mouse"){if(!this._recreatingManipulators){if("start"===i)e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Ao.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((t=>{t.manipulator.interactive=t.manipulator.grabbing||!this._numGrabbing&&s(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in t&&(t.edgeManipulator.interactive=t.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((t=>{t.interactive=t.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(t){n(t)||(t.manipulator.metadata.deleting=!0,this.manipulators.remove(t.manipulator),this._manipulatorHandles.remove(t.manipulator),b(this._manipulatorInfos,t),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(t){if(t)for(const e of this._manipulatorInfos)if(t===e.handle)return e;return null}_updateManipulatorPosition(t){if(n(t))return;const e=p(this._editGeometryOperations);if("vertex"===t.type)t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,wo),t.manipulator.grabbing&&s(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if("edge"===t.type){const i=this._getManipulatorInfoFromHandle(t.handle.leftVertex),a=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(n(i)||n(a))return;const o=i.manipulator,r=a.manipulator;if(s(t.manipulator.elevationInfo)&&"on-the-ground"===t.manipulator.elevationInfo.mode){const i=o.location,a=r.location,s=.5,n=i.x+s*(a.x-i.x),l=i.y+s*(a.y-i.y),p=i.hasZ&&a.hasZ?0:void 0;t.manipulator.location=Qt(n,l,p,e.data.spatialReference)}else C(Eo,o.renderLocation,r.renderLocation,.5),t.manipulator.renderLocation=Eo}}_splitEdgeManipulator(t,e=.5){const i=p(this._editGeometryOperations),a=p(i.splitEdge(t.handle,e).createdVertex);t.locationUpdateHandle=h(t.locationUpdateHandle);const o=Y(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(t),s=this._createVertexOrEdgeManipulator(a)):(s=t,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,o)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,ho.XY),this._updateSelection(t.manipulator);const n=this._updateEventState(Ao.RESHAPING),r=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:r,componentIndex:l,vertexIndex:p(a.index)}],added:r}),n&&this._updateEventState(Ao.NONE),s}_updateMoveManipulationPosition(){const t=E(Eo,0,0,0);let e=0,i=!1,a=null,o=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(e++,j(t,t,s.manipulator.renderLocation),n(a)||s.selectedIndex>a.selectedIndex?(o=a,a=s):(n(o)||s.selectedIndex>o.selectedIndex)&&(o=s)):i=!0);if(0===e){const t=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t,this._moveManipulation.zManipulation.available=t&&this.enableZShape&&he(this.graphic),this._moveManipulation.angle=$a(p(this.graphic.geometry)),this._moveManipulation.radius=lo.radiusForSymbol(this.graphic.symbol)}else{const t=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.zManipulation.available=t&&this.enableZVertex&&he(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t&&1!==e;let i=0;if(s(a)){const t=a.handle.pos,e=s(o)?o.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,r=n(o)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;e&&r?this._moveManipulation.xyAxisManipulation.available=!1:e?i=xo(e,t):r&&(i=xo(t,r))}this._moveManipulation.angle=i,this._moveManipulation.radius=Ba}0!==e&&i?(O(t,t,1/e),wo.spatialReference=p(this._editGeometryOperations).data.spatialReference,wo.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,wo),this._moveManipulation.elevationAlignedLocation=wo):s(this._outlineVisualElement)&&!this._graphicState.isDraped&&s(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:ae(this.view,this._moveManipulation,this.graphic)}_removeVertices(t){const e=new Array,i=p(this._editGeometryOperations);for(const a of t)if("vertex"===a.type&&i.canRemoveVertex()){e.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const t=i.removeVertices([a.handle]),o=p(t.removedVertices?.[0].createdEdge);o&&this._createVertexOrEdgeManipulator(o)}if(e.length>0){const t=e.map((t=>{const e=i.data.components.indexOf(t.component);return{coordinates:i.data.coordinateHelper.vectorToArray(t.pos),componentIndex:e,vertexIndex:p(t.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(Ao.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:t.map((t=>t.coordinates)),vertices:t}),this.destroyed)return;if(a&&(this._updateEventState(Ao.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(t,e,i=("start"===e.action?Ei.NEW_STEP:Ei.ACCUMULATE_STEPS)){const a=p(this._editGeometryOperations);a.moveVertices(t.map((t=>t.handle)),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const e of t)this._updateManipulatorPosition(e)}_offsetEdge(t,e){if(n(e.operation)||n(e.signedDistance))return;const i=p(this._editGeometryOperations),a=e.operation.clone();a.distance=e.signedDistance,i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),"vertex"===e.type&&(e.manipulator.selected=!e.manipulator.selected,t.button===qi.Right&&this._removeVertices([e])),"edge"===e.type&&t.button===qi.Left&&this._splitEdgeManipulator(e),t.stopPropagation()}_updateTranslateTooltip(t,e){const i=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,t,e):this._updateTranslateGraphicTooltip(t,e)}_updateTranslateGraphicTooltip(t,e){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case ho.XY:this._tooltip.info=new Di({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,e)=>yt(t,e,a)));break;case ho.XY_AXIS:this._tooltip.info=new Ii({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,i)=>{const o=yt(t,i,a);return Bt(o,to(e))}));break;case ho.Z:this._tooltip.info=new Gi({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,Vi)}}_updateTranslateVertexTooltip(t,e,i){const a=this._tooltipOptions;if(!a.enabled)return;let o;const n=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case ho.XY:o=new Pi({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,((t,e)=>yt(t,e,n))),this._updateTooltipAreaOrTotalLength(o);break;case ho.XY_AXIS:o=new Li({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,((t,e)=>{const a=yt(t,e,n);return Bt(a,to(i))})),this._updateTooltipAreaOrTotalLength(o);break;case ho.Z:o=new Ri({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,Vi)}const r=Ci(t.elevationAlignedLocation);s(r)&&(o.elevation={mode:"absolute-height",...r}),this._tooltip.info=o}_updateTranslateTooltipDistance(t,e,i){if(s(e)&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=s(n)?n:qt}}_updateTooltipAreaOrTotalLength(t){const{geometry:e}=this.graphic;if(n(e))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";t.area="polygon"===e.type?Wi(e,i):null,t.totalLength="polyline"===e.type?Mt(e,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function xo(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}t([f()],So.prototype,"_editGeometryOperations",void 0),t([f()],So.prototype,"_segmentLabels",void 0),t([f({constructOnly:!0})],So.prototype,"tool",void 0),t([f()],So.prototype,"_tooltip",void 0),t([f()],So.prototype,"inputGeometry",null),t([f()],So.prototype,"outputGeometry",void 0),t([f({readOnly:!0})],So.prototype,"updating",null),t([f()],So.prototype,"manipulators",null),t([f()],So.prototype,"view",null),t([f()],So.prototype,"graphic",null),t([f()],So.prototype,"enableZShape",null),t([f()],So.prototype,"enableZVertex",null),t([f()],So.prototype,"enableMoveGraphic",null),t([f()],So.prototype,"enableMidpoints",null),t([f()],So.prototype,"enableEdgeOffset",null),t([f()],So.prototype,"_labelOptions",null),t([f()],So.prototype,"_tooltipOptions",null),So=t([S("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],So);const wo=Qt(0,0,void 0,Ji.WGS84),Eo=w(),jo=1e-6;var Oo,Ao,To;!function(t){t.Vertex=fi.Custom1,t.Edge=fi.Custom2}(Oo||(Oo={})),function(t){t[t.NONE=0]="NONE",t[t.MOVING=1]="MOVING",t[t.RESHAPING=2]="RESHAPING"}(Ao||(Ao={})),function(t){t[t.ALL=0]="ALL",t[t.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(To||(To={}));let Do=class extends(Xt.EventedMixin(oi)){constructor(t){super(t),this._handles=new Se,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Qi,this.tooltipOptions=new Oi,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const t=this._reshapeOperation=new So({tool:this});this.addHandles([t.on("reshape",(t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)})),t.on("move",(t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)})),t.on("vertex-add",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)})),t.on("vertex-remove",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)})),t.on("immediate-click",(t=>this.emit("immediate-click",t))),this.view.on("pointer-down",["Shift"],(t=>t.stopPropagation())),u((()=>this.graphic),(()=>this._updateGraphic()),y)]),this.finishToolCreation()}destroy(){this._handles=l(this._handles),this._reshapeOperation=l(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const t=le(this.graphic);this._reshapeOperation.inputGeometry=s(t)?t.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),pe(this.graphic)!==re.SUPPORTED)return;const t=u((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),v);this._handles.add(t,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(t){this._internalGeometryUpdate=!0,this.graphic.geometry=t,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:t}=this._reshapeOperation;!n(this.graphic)&&t&&this._updateGeometryInternally(t.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){s(this.snappingManager)&&this.snappingManager.doneSnapping();const t=this._reshapeOperation.undo(),{outputGeometry:e}=this._reshapeOperation;t&&e&&this._updateGeometryInternally(e.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){s(this.snappingManager)&&this.snappingManager.doneSnapping();const t=this._reshapeOperation.redo(),{outputGeometry:e}=this._reshapeOperation;t&&e&&this._updateGeometryInternally(e.clone())}onInputEvent(t){"key-down"!==t.type||"Delete"!==t.key&&"Backspace"!==t.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};t([f()],Do.prototype,"_reshapeOperation",void 0),t([f({constructOnly:!0,nonNullable:!0})],Do.prototype,"view",void 0),t([f({constructOnly:!0})],Do.prototype,"graphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],Do.prototype,"enableZShape",void 0),t([f({constructOnly:!0,nonNullable:!0})],Do.prototype,"enableZVertex",void 0),t([f({constructOnly:!0,nonNullable:!0})],Do.prototype,"enableMoveGraphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],Do.prototype,"enableMidpoints",void 0),t([f({constructOnly:!0,nonNullable:!0})],Do.prototype,"enableEdgeOffset",void 0),t([f()],Do.prototype,"type",void 0),t([f({constructOnly:!0,type:Qi})],Do.prototype,"labelOptions",void 0),t([f({constructOnly:!0,type:Oi})],Do.prototype,"tooltipOptions",void 0),t([f({constructOnly:!0})],Do.prototype,"snappingManager",void 0),t([f()],Do.prototype,"updating",null),t([f()],Do.prototype,"automaticManipulatorSelection",void 0),Do=t([S("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Do);let Go=class extends ft{constructor(t){super(t),this.type="transform-rotate",this.rotationType="geographic"}};t([f()],Go.prototype,"type",void 0),t([f()],Go.prototype,"rotation",void 0),t([f()],Go.prototype,"rotationPrecision",void 0),t([f()],Go.prototype,"orientation",void 0),t([f()],Go.prototype,"orientationPrecision",void 0),t([f()],Go.prototype,"rotationType",void 0),Go=t([S("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Go);let Io=class extends ft{constructor(t){super(t),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};t([f()],Io.prototype,"type",void 0),t([f()],Io.prototype,"scale",void 0),t([f()],Io.prototype,"size",void 0),t([f()],Io.prototype,"sizeUnit",void 0),t([f()],Io.prototype,"sizePrecision",void 0),Io=t([S("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Io);let Ro=class extends ft{constructor(t){super(t),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var Lo,Po;t([f()],Ro.prototype,"type",void 0),t([f()],Ro.prototype,"orientation",void 0),t([f()],Ro.prototype,"orientationEnabled",void 0),t([f()],Ro.prototype,"orientationPrecision",void 0),t([f()],Ro.prototype,"rotationType",void 0),t([f()],Ro.prototype,"size",void 0),t([f()],Ro.prototype,"sizeUnit",void 0),t([f()],Ro.prototype,"sizeEnabled",void 0),t([f()],Ro.prototype,"sizePrecision",void 0),Ro=t([S("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Ro),function(t){t.ScaleIn=fi.Custom2,t.ScaleOut=fi.Custom3,t.RotateLeft=fi.Custom4,t.RotateRight=fi.Custom5,t.Unlocked=fi.Custom7,t.DelayedFocused=fi.Custom8,t.TouchInput=fi.Custom12}(Lo||(Lo={}));class Vo{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}constructor({adapter:t,tooltipOptions:e,mode:i,tool:a}){this._mode=null,this._handles=new Se,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new Xt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>s(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=a,this._mode=i,this._adapter=t,this._tooltipOptions=e,this._tooltip=new vt({view:a.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(_((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),g))}destroy(){s(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=l(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=l(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=ea({update:({deltaTime:e})=>{t.update(e)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:e}}cancelActiveAnimation(){s(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=l(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,Va.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const e=this.tool.graphicState.graphic,i=Ke(t,((t,i,a)=>{this._scaleRotateDragData=null;const o=this._adapter.startInteraction(),n={mode:"none",origin:U(t.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this._updateDragState();const r=Ce.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,r),i.next(We(this.tool.view,ki(t.renderLocation,r,Xi()))).next((t=>{const i=Fi(t.plane),a=oe(t.renderStart,t.renderEnd,n.origin,i),r=ta.shortestSignedDiff(n.angle,a);n.angleDir=de(n.angleDir+r,-.3,.3),n.angle=a;const l=function(t,e){const i=D(Ce.get(),e.renderStart,t.origin),a=D(Ce.get(),e.renderEnd,t.origin),o=V(i),s=V(a);return 0===o?0:s/o}(n,t),p=l-this._adapter.scale;if(n.scaleDir=de(n.scaleDir+p,-.2,.2),this._onScaleChanged(),"none"===n.mode){const i=this._mode||function(t,e,i,a){const{renderStart:o,renderEnd:s}=t,n=Co(o,a,Ce.get()),r=Co(s,a,Ce.get());if(z(n,r)<100)return null;const l=D(Ce.get(),o,i),p=R(Ce.get(),l,Fi(e)),h=o,c=j(Ce.get(),h,p),d=Co(i,a,Ce.get()),u=n,m=Co(c,a,Ce.get()),g=D(Ce.get(),m,u),_=D(Ce.get(),n,d),y=ze(u,g),v=ze(d,_);return He(y,r)<He(v,r)?"rotate":"scale"}(t,t.plane,n.origin,this.tool.view.state.camera);if(s(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:e,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:e,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}n.mode=i}}switch(n.mode){case"rotate":o.state.angle=n.initialAngle+a;break;case"scale":o.state.scale=l,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),t.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:e,angle:ue(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:e,xScale:l,yScale:l})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:ue(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:l,yScale:l})}}return"end"===t.action&&(this.startAnimation(Uo(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),o.done()),t})).next(this._updateTooltipPipelineStep(n)),a.next((()=>{if(o.cancel(),s(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:1,yScale:1})}this.startAnimation(Uo(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([i,t.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(function(t,e,i){let a=0,o=null;const s=()=>!1;return{start:()=>{o=t.getFocused,t.getFocused=s,a=0,e()},update:t=>(a+=t,!o?.()||a>=i.delayMs?Po.STOP:Po.CONTINUE),destroy:()=>{o&&(t.getFocused=o),e()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),t.events.on("immediate-click",(t=>{t.stopPropagation()})),u((()=>this.tool.graphicState?.displaying),(t=>this._ringManipulator.available=t),g)])}_updateTooltipPipelineStep(t){return e=>{const i=this._tooltipOptions;if(!i.enabled)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const a=this._tooltip,o=this._tooltipOptions.visualVariables,n=s(o)?o.size:null,r=s(o)?o.rotation:null;switch(t.mode){case"scale":a.info=new Io({tooltipOptions:i,scale:{value:this._adapter.scale},size:Wt(c(this._adapter.size,-1),"meters"),sizeUnit:s(n)?n.unit:null,sizePrecision:s(n)?zo(n.valueType):null});break;case"rotate":{const t=s(r)?zo(r.valueType):null,e=s(r)?r.rotationType:"geographic";a.info=new Go({tooltipOptions:i,rotation:Jt(c(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:t,orientation:Jt(-this._adapter.angle,"radians","geographic"),orientationPrecision:t,rotationType:e})}}return e}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,e=s(t)?t.rotation:null,i=s(t)?t.size:null;this._tooltip.info=new Ro({tooltipOptions:this._tooltipOptions,orientation:Jt(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:s(e)?zo(e.valueType):null,rotationType:s(e)?e.rotationType:"geographic",size:Wt(c(this._adapter.size,-1),"meters"),sizeUnit:s(i)?i.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:s(i)?zo(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Lo.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Lo.Unlocked,!(s(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),s(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Lo.ScaleIn|Lo.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Lo.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Lo.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Lo.RotateLeft|Lo.RotateRight,!1),this._ringManipulator.updateStateEnabled(Lo.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Lo.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Lo.ScaleIn|Lo.ScaleOut|Lo.RotateLeft|Lo.RotateRight,!1)}_updateManipulatorTransform(){const t=Oe(Ue.get(),this._adapter.angle,A(0,0,1));if(n(t))return;const e=this.getScale(),i=Ae(Ue.get(),E(Ce.get(),e,e,e));this._ringManipulator.modelTransform=je(Ue.get(),i,t)}_createRingManipulator(){const t=(t,e,i)=>{const a=[],o=Math.ceil(128*(e-t)/(2*Math.PI));for(let s=0;s<o+1;s++){const n=t+s*(e-t)/o;a.push(A(i*Math.cos(n),i*Math.sin(n),0))}return a},e=e=>t(0,2*Math.PI,e),i=this._createMaterial(1),a=(t,e,a=i)=>_i(a,(t=>[[-t/2,0],[t/2,0],[t/2,.25],[-t/2,.25]])(e),t,[],[],!1),o=e(160),s=a(o,24),n={left:new Array,right:new Array},r=[];for(let e=0;e<2;e++){const o=e*Math.PI-Math.PI/4,s=Math.PI/2-qa,l=o+s,p=o+Math.PI/2-s,h=t(l,p,190),c=a(h,9);r.push(h),r.push(t(l,p,201)),n.left.push(c),n.right.push(c.instantiate());for(let t=0;t<2;t++){const e=0===t,a=Le();if(e){Ge(a,a,[1,-1,1]),Ie(a,a,-l,[0,0,1]);const t=Math.round(.2*(h.length-1));a[12]=h[t][0],a[13]=h[t][1],a[14]=h[t][2]}else{Ie(a,a,p,[0,0,1]);const t=Math.round(.8*(h.length-1));a[12]=h[t][0],a[13]=h[t][1],a[14]=h[t][2]}const o=hi(i,60,0,23,.5);ci(o,a),(e?n.left:n.right).push(o)}}const l=[];for(let e=0;e<2;e++){const i=e*Math.PI-Math.PI/4,o=Math.PI/2-Wa,s=i+o,n=i+Math.PI/2-o,r=t(s,n,213);l.push(a(r,9))}const p=this._createMaterial(.66),h=this._createMaterial(.5),c=this._createMaterial(.33),d=e(190),u=e(213),m=a(d,9,p),g=a(u,9,c),_=e(130),y=e(107),v=a(_,9,p),f=a(y,9,c);let M=[new $t(s,Lo.DelayedFocused),new $t(s.instantiate({material:h}),vi.None)];this._mode&&"scale"!==this._mode||(M=M.concat([...l.map((t=>new $t(t,Lo.DelayedFocused|Lo.Unlocked))),new $t(m,Lo.DelayedFocused|Lo.ScaleIn),new $t(g,Lo.DelayedFocused|Lo.ScaleIn),new $t(v,Lo.DelayedFocused|Lo.ScaleOut),new $t(f,Lo.DelayedFocused|Lo.ScaleOut)])),this._mode&&"rotate"!==this._mode||(M=M.concat([...n.right.map((t=>new $t(t.instantiate(),Lo.DelayedFocused|Lo.Unlocked))),...n.left.map((t=>new $t(t,Lo.DelayedFocused|Lo.RotateLeft))),...n.right.map((t=>new $t(t,Lo.DelayedFocused|Lo.RotateRight)))]));const b=[o,...r];return new Kt({view:this.tool.view,renderObjects:M,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Y(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:b,direction:A(0,0,1)}})}_createMaterial(t){const e=ia([...Za,t]);return new yi({color:e,transparent:1!==t,cullFace:pi.Back,renderOccluded:It.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:t=>this._ringIndicatorDelayMs=t,tooltip:this._tooltip}}}function Co(t,e,i){return e.projectToScreen(t,Ho),E(i,Ho[0],Ho[1],0)}function Uo(t,e){let i=null,a=1;const o=()=>a;return{start:()=>{a=t.getScale(),i=t.getScale,t.getScale=o,e()},update:t=>(a+=((a+1)/2-a)*Math.min(t*Ja,1),e(),Math.abs(a-1)<.01?Po.STOP:Po.CONTINUE),destroy:()=>{i&&(t.getScale=i),e()}}}function zo(t){switch(t){case"integer":case"long":return 0;default:return null}}!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(Po||(Po={}));const Ho=J();function No(t){return s(t.geometry)&&"mesh"===t.geometry.type?(e=t.geometry,s(e.transform)?function(t,e){let i=e.clone(),a=null;return{undo:e=>{a=s(t.transform)?t.transform.clone():null,t.transform=i,e.notifyGeometryChanged()},redo:e=>{i=s(t.transform)?t.transform.clone():null,t.transform=a,e.notifyGeometryChanged()}}}(e,e.transform):function(t){let e,i=t.vertexAttributes.clonePositional();return{undo:a=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e,a.notifyGeometryChanged()}}}(e)):function(t){let e=t.geometry,i=d;return{undo(t){i=t.geometry,t.geometry=e},redo(t){e=t.geometry,t.geometry=i}}}(t);var e}let Fo=class extends Yt{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([_((()=>s(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null),(({interactionState:t})=>{this._updateMeshRotation(t)}),v),_((()=>s(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null),(({interactionState:t})=>{this._updateMeshSize(t)}),v)])}get angle(){const t=this.geometry.transform;if(n(t))return 0;const e=aa(t.rotation)[2];return Math.abs(e)>.999999?ce(oa(t.rotation))*Math.sign(e):0}get scale(){return s(this._interactionState)?this._interactionState.scale:1}startInteraction(){const t=new ko({angle:this.angle});this._interactionState=t;const e=()=>{this._interactionState=null};return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return No(this.graphic)}_updateMeshRotation(t){const e=this.geometry.anchor,i=this.viewingMode===$i.Global,{angle:a,previousAngle:o}=t;this.geometry.rotate(0,0,ue(a-o),{origin:e,geographic:i}),t.previousAngle=a,s(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(t){const e=this.geometry.anchor,i=this.viewingMode===$i.Global,{scale:a,previousScale:o}=t;this.geometry.scale(a/o,{origin:e,geographic:i}),t.previousScale=a,s(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};t([f({constructOnly:!0})],Fo.prototype,"graphic",void 0),t([f({constructOnly:!0})],Fo.prototype,"geometry",void 0),t([f({constructOnly:!0})],Fo.prototype,"viewingMode",void 0),t([f()],Fo.prototype,"angle",null),t([f()],Fo.prototype,"scale",null),t([f()],Fo.prototype,"_interactionState",void 0),Fo=t([S("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Fo);let ko=class extends ${get state(){const{angle:t,scale:e}=this;return{angle:t,scale:e}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};t([f()],ko.prototype,"angle",void 0),t([f()],ko.prototype,"initialAngle",void 0),t([f()],ko.prototype,"previousAngle",void 0),t([f()],ko.prototype,"previousScale",void 0),t([f()],ko.prototype,"scale",void 0),t([f()],ko.prototype,"state",null),ko=t([S("InteractionState")],ko);let Xo=class extends Yt{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(_((()=>s(this._interactionState)?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),v))}get angle(){return s(this._interactionState)?this._interactionState.angle:s(this._orientationReferenceSymbolLayer)?(t=this._orientationReferenceSymbolLayer.heading??0,-ce(t)):0;var t}get scale(){return s(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return s(this._interactionState)?this._interactionState.initialAngle:0}get size(){const t=this._sizeReferenceSymbolLayer;if(n(t))return null;const e=this.findLayerView(),i=this._graphicSymbol;if(n(e)||n(i)||"point-3d"!==i.type)return null;const a=e.getSymbolLayerSize(i,t);if("size"in a&&s(a.size))return a.size;const o=this.sizeAxis;return"width"in a&&s(a.width)&&(n(o)||"width"===o||"all"===o||"width-and-depth"===o)?a.width:"depth"in a&&s(t.depth)&&(n(o)||"depth"===o||"all"===o||"width-and-depth"===o)?a.depth:"height"in a&&s(t.height)&&(n(o)||"height"===o||"all"===o)?a.height:null}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return n(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return n(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&s(t.heading)))}get _graphicSymbol(){return s(this.graphic)&&s(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(s(this._interactionState)||n(t)||n(e))return Zo;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),a=t.clone(),o=this.angle,r=new Yo({originalSymbol:a,angle:o,initialSizes:i});this._interactionState=r;const l=()=>{this._interactionState=null};return{state:r,done:l,cancel:()=>{this._graphicSymbol=a,l()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:a}){const o=this._graphicSymbol;if(n(o)||"point-3d"!==o.type)return;const r=o.clone(),l=-ue(e-this.initialAngle);let p=!1;this._forEachObjectSymbolLayerPair(i,r,((e,i,o)=>{const n=c(e.heading,0)+l;i.heading!==n&&(i.heading=n,p=!0);const r=a[o];if(s(r)&&"width"in r){r.width=this.sizeFilter(r.width),r.height=this.sizeFilter(r.height),r.depth=this.sizeFilter(r.depth);const e=r.width*t;i.width!==e&&(i.width=e,p=!0);const a=r.depth*t;i.depth!==a&&(i.depth=a,p=!0);const o=r.height*t;i.height!==o&&(i.height=o,p=!0)}})),p&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,a)=>{const o=e.symbolLayers.getItemAt(a);"object"===t.type&&"object"===o.type&&i(t,o,a)}))}};t([f()],Xo.prototype,"angle",null),t([f()],Xo.prototype,"scale",null),t([f()],Xo.prototype,"relativeAngle",null),t([f()],Xo.prototype,"initialAngle",null),t([f()],Xo.prototype,"size",null),t([f()],Xo.prototype,"sizeAxis",void 0),t([f({constructOnly:!0})],Xo.prototype,"graphic",void 0),t([f()],Xo.prototype,"_interactionState",void 0),t([f({constructOnly:!0})],Xo.prototype,"findLayerView",void 0),t([f({constructOnly:!0})],Xo.prototype,"sizeFilter",void 0),t([f()],Xo.prototype,"_sizeReferenceSymbolLayer",null),t([f()],Xo.prototype,"_orientationReferenceSymbolLayer",null),t([f()],Xo.prototype,"_graphicSymbol",null),Xo=t([S("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Xo);const Zo={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Yo=class extends ${get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:o}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:o}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};t([f()],Yo.prototype,"originalSymbol",void 0),t([f()],Yo.prototype,"angle",void 0),t([f()],Yo.prototype,"initialAngle",void 0),t([f()],Yo.prototype,"initialSizes",void 0),t([f()],Yo.prototype,"scale",void 0),t([f()],Yo.prototype,"state",null),Yo=t([S("InteractionState")],Yo);let Bo=class extends(Zt(Xt.EventedMixin(oi))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Oi,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:t,view:i}=this;this.graphicState=new Gt({graphic:t}),this.addHandles(u((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new vt({view:i}):l(this._tooltip)}),y)),this._moveManipulation=new lo({tool:this,view:i,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&he(t),radius:lo.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))));const a=t=>e=>{this.handles.add(e.events.on("focus-changed",(({action:e})=>{const i=this._tooltip;n(i)||("focus"===e?this._updateMoveTooltip(t):i.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(a(ho.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(ho.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(ho.Z));const o=Y(t);this._moveManipulation.elevationInfo=o;const r=t.geometry;if(this._moveManipulation.createGraphicDragPipeline(((e,a,n,l,p)=>{if(s(r)&&e===ho.XY){const{snappingStep:e,cancelSnapping:a}=Ti({snappingContext:new Ai({elevationInfo:o,pointer:p,editGeometryOperations:Si.fromGeometry(new Ki({spatialReference:r.spatialReference}),i.state.viewingMode),visualizer:new xt,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});l=l.next(a),n=n.next(li(this.view,o)).next(...e)}return{steps:n=n.next((t=>(this._updateMoveTooltip(e,t),t))),cancel:l}}),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:o}=t,s={graphic:i,dxScreen:a,dyScreen:o};switch(e){case"start":this.emit("graphic-translate-start",s),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this._moveManipulation.angle=s(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(u((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Vo({tool:this,mode:t,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([Xa({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>e()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),u((()=>i.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof Kt&&this.handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=l(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=l(this._scaleRotate),this._scaleRotateAdapter=l(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){n(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return s(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Fo({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Xo({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:s(this.tooltipOptions.visualVariables)&&s(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(t){this._moveManipulation.forEachManipulator(t),s(this._scaleRotate)&&this._scaleRotate.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return u((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&he(this.graphic)}))}_createGeometryUndoRecord(){return No(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,s(this._scaleRotate)&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,s(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){s(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(n(this._scaleRotate))return;const t=this._scaleRotate.getScale();this._moveManipulation.displayScale=t}_updateMoveAngle(){this.view.state.viewingMode===$i.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){ae(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){const{tooltipOptions:i,_tooltip:a}=this;if(n(a))return;a.clear();const o=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case ho.XY:a.info=new Di({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,e)=>yt(t,e,o)));break;case ho.XY_AXIS:a.info=new Ii({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const a=yt(t,i,o);return Bt(a,to(e))}));break;case ho.Z:a.info=new Gi({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,Vi)}}_updateMoveTooltipDistance(t,e,i){if(s(e)&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=s(n)?n:qt}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:s(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:t=>s(this._scaleRotate)?this._scaleRotate.test.setRingIndicatorDelayMs(t):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};t([f({constructOnly:!0,nonNullable:!0})],Bo.prototype,"view",void 0),t([f({constructOnly:!0,nonNullable:!0})],Bo.prototype,"graphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],Bo.prototype,"enableZ",void 0),t([f()],Bo.prototype,"enableRotation",void 0),t([f()],Bo.prototype,"enableScaling",void 0),t([f({constructOnly:!0,type:Oi})],Bo.prototype,"tooltipOptions",void 0),t([f()],Bo.prototype,"graphicState",void 0),t([f({value:!1})],Bo.prototype,"snapToScene",null),t([f({constructOnly:!0})],Bo.prototype,"snappingManager",void 0),t([f({readOnly:!0})],Bo.prototype,"type",void 0),t([f({readOnly:!0})],Bo.prototype,"updating",null),Bo=t([S("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Bo);class qo{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&s(this._lastDragEvent)&&s(this._next)){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this._next.execute(e)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new ii;return this._next=t,[t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t),t]}_adjustScaleFactors(t){const e=ra(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}let Wo=class extends(Xt.EventedMixin(oi)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Oi,this._preserveAspectRatio=new qo,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new Se,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=sa(),this._mapBoundsStart=sa(),this._zmax=0,this._sizeStart=null,this._displayBounds=sa(),this._displayBoundsStart=sa(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=ht(),this._endScale=ht()}initialize(){const{view:t,graphic:i,manipulators:a,_handles:o}=this,n=this._graphicState=new Gt({graphic:i}),r=i.geometry;this._editGeometryOperations=Si.fromGeometry(r,t.state.viewingMode),this._graphicMoveManipulation=new co({tool:this,view:t,graphicState:n}),this._moveZManipulator=la(t,pa.CENTER_ON_CALLOUT),this._moveZManipulator.state|=ha,o.add([this._createMoveXYGraphicDragPipeline(),u((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,Va.TRANSLATE_Z))),this._createMoveZDragPipeline()]),a.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=ca(t,e);return o.add([u((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,Va.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),a.addMany(this._resizeManipulators);const l=!this.view._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._rotateManipulatorTexture=Ma(t.toolViewManager.textures,{premultiplyAlpha:l}),this._rotateManipulator=se(t,{texture:this._rotateManipulatorTexture.texture}),o.add([u((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,Va.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),a.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const p=Xa({view:t,graphic:i,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>e()});s(p)&&(this._outlineVisualElement=p.visualElement instanceof Ot?p.visualElement:null),s(this._outlineVisualElement)&&o.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),o.add(p),o.add([n.on("changed",(()=>this._onGeometryChanged())),u((()=>n.displaying),(()=>this._updateAllManipulatorAvailability())),u((()=>n.isDraped),(()=>this._graphicDrapedChanged()),g),t.trackGraphicState(n)]);const h=t.pointsOfInterest;o.add(u((()=>h?.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds()))),this._forEachManipulator((t=>{o.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))})),this._forEachManipulator(((t,e)=>{o.add(t.events.on("immediate-click",(t=>{e===Va.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:i}),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new vt({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a()})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(t=>{ot(this._startScale,t.xScale,t.yScale),ot(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(t=>{ot(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(()=>{ot(this._startScale,0,0),ot(this._endScale,0,0),a()}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=c(this._moveXYTooltipInfo,(()=>new Di({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo=c(this._moveZTooltipInfo,(()=>new Gi({tooltipOptions:this.tooltipOptions}))),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=Ui(e,i,this.view.spatialReference);if(n(a))return null;t.distance=a}else t.distance=Wt(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo=c(this._rotateTooltipInfo,(()=>new Sa({tooltipOptions:this.tooltipOptions})));return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if(n(t))return null;const e=this._scaleTooltipInfo=c(this._scaleTooltipInfo,(()=>new xa({tooltipOptions:this.tooltipOptions}))),i=Pt(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return n(i)?null:(e.xSize=i[0],e.ySize=i[1],s(this._sizeStart)&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(Jo),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{s(this._attachmentOrigin)&&Me(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),Jo)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof Kt){const a=this._graphicState.displaying,o=this.enableZ&&he(this.graphic);switch(e){case Va.ROTATE:t.available=a&&this.enableRotation;break;case Va.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||o),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?da:ua;break;case Va.TRANSLATE_Z:t.available=a&&o;break;default:t.available=a}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,Va.SCALE))),t(this._rotateManipulator,Va.ROTATE),t(this._moveZManipulator,Va.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get _moveUnit(){return c(Hi(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=pt(Ne.get(),i.leftVertex.pos,i.rightVertex.pos);st(a,a);const o=c(ee(this.view,this.graphic),(()=>t.extent?.center));let s=o?Ko*this.view.pixelSizeAt(o):0;const n=this.view.spatialReference,r=t.spatialReference;n.equals(r)||(s*=zi(n)/zi(r)),Vt(a,e,s,this._mapBounds),this._updateZMax()}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos)??0;i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const{geometry:t}=this.graphic;if(n(t))return;const{extent:e}=t;if(!e)return;const i=s(this._outlineVisualElement)&&!this._graphicState.isDraped&&s(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:ee(this.view,this.graphic);this._attachmentOrigin=c(i,e.center);const a=s(i)?i.z:Tt(this._mapBounds.origin,this.view.elevationProvider,Dt.fromElevationInfo(Y(this.graphic)),this.view.renderCoordsHelper),o=na(this._mapBounds);o.origin[2]=a??0,Ct(o,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent?.center;return e?Qo*this.view.pixelSizeAt(e):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,ho.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return Ke(this._moveZManipulator,((i,a,o)=>{const s=U(i.renderLocation),n=a.next(Xe(t,s,e)).next(ei());this._applyGraphicMoveSteps(n,o,ho.Z)}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next(ai()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||(t.mapEnd.z??0)-(t.mapStart.z??0))&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e)}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{s(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){na(this._displayBounds,this._displayBoundsStart),na(this._mapBounds,this._mapBoundsStart),n(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=Pt(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return t=>{if(n(this.inputState)||"move"!==this.inputState.type)return t;const e=[];for(const t of this._editGeometryOperations.data.components)e.push(...t.vertices);const i="start"===t.action?Ei.NEW_STEP:Ei.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return Ut(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===ho.XY||e===ho.XY_AXIS){const e=yt(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");s(e)&&s(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=e)}return t}_onResizeGrab({action:t,screenPoint:e}){if("start"!==t||!e)return;const i=this._calculatePickRay(e);Yi(this._displayBounds.plane,i,Ce.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(t,e){return Ke(t,((t,i,a)=>{n(this.inputState)||(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next(We(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e)}return t})),a.next((()=>{s(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,o=this._displayBoundsMarginStart,s=H(Ce.get(),e.origin);N(s,s,e.basis1,-i[0]),N(s,s,e.basis2,-i[1]);const n=D(Ce.get(),t.renderEnd,s),r=D(Ce.get(),t.renderStart,s),l=ra(t.handle),p=ma(e),h=ma(this._displayBounds)/p,c=(t,e)=>{if(0===t)return 1;let i=V(e),s=.5*t*I(e,n)/i;const p=s<0?-1:1;l&&(s+=(i-.5*t*I(e,r)/i)*p*h);const c=i<1.5*o?1:$o;return i=Math.max(i-o,$o),p>0&&(s-=a),p*Math.max(p*(s/i),c)};return{...t,factor1:c(i[0],e.basis1),factor2:c(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=H(w(),this._mapBoundsStart.origin);N(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),N(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=ot(ht(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);st(i,i);const a=[];for(const t of this._editGeometryOperations.data.components)a.push(...t.vertices);const o="start"===t.action?Ei.NEW_STEP:Ei.ACCUMULATE_STEPS,s=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,o,ji.REPLACE);return na(this._mapBoundsStart,this._mapBounds),Ut(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab({action:t,screenPoint:e}){if("start"!==t||!e)return;const i=ga(this._displayBounds,this.view.renderCoordsHelper,_a.HEADING,Xi()),a=this._calculatePickRay(e);Yi(i,a,Ce.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:i})}_createRotateDragPipeline(t){return Ke(t,((t,e,i)=>{const a=this.inputState;n(a)||(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next(We(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:ue(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e)}return t})),i.next((()=>{s(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=Fi(t.rotatePlane),a=oe(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=H(w(),this._mapBoundsStart.origin),i=[];for(const t of this._editGeometryOperations.data.components)i.push(...t.vertices);const a="start"===t.action?Ei.NEW_STEP:Ei.ACCUMULATE_STEPS,o=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,ji.REPLACE);return na(this._mapBoundsStart,this._mapBounds),Ut(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=Fe(),i=K(t);return ba(this.view.state.camera,i,e),G(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=ya(this._displayBounds,Ue.get());va(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{fa(e,this._resizeHandles[i],t,this._displayBounds)}))}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:D(Ce.get(),i.origin,i.basis1),edge:2},o=Ue.get();Re(o,e,a.edge*Math.PI/2),o[12]=0,o[13]=0,o[14]=0,t.modelTransform=o,t.renderLocation=a.position}_cancel(){const t=this._editGeometryOperations.lastOperation;n(t)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,zt(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(s(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,zt(p(t),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ut(p(t),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};t([f({constructOnly:!0,nonNullable:!0})],Wo.prototype,"view",void 0),t([f({constructOnly:!0,nonNullable:!0})],Wo.prototype,"graphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],Wo.prototype,"enableZ",void 0),t([f()],Wo.prototype,"enableRotation",void 0),t([f()],Wo.prototype,"enableScaling",void 0),t([f({constructOnly:!0,type:Oi})],Wo.prototype,"tooltipOptions",void 0),t([f()],Wo.prototype,"preserveAspectRatio",null),t([f()],Wo.prototype,"grabbing",void 0),t([f()],Wo.prototype,"inputState",void 0),t([f({readOnly:!0})],Wo.prototype,"type",void 0),t([f()],Wo.prototype,"_moveUnit",null),Wo=t([S("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Wo);const Jo="draped-elevation-changes",Qo=10,Ko=80,$o=1e-6;export{Ia as DrawGraphicTool3D,Wo as ExtentTransformTool,_o as GraphicMoveTool,Do as GraphicReshapeTool,Bo as GraphicTransformTool};
