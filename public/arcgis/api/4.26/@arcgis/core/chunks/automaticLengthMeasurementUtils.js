/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import e from"../core/Accessor.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./typedArrayUtil.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{e as n,i as o,a,g as r,d as l}from"./maybe.js";import{watch as c,syncAndInitial as p}from"../core/reactiveUtils.js";import"./Logger.js";import"../core/Error.js";import"../intl.js";import{e as h,g,h as u,i as m,j as v,k as d,l as f}from"./quantityFormatUtils.js";import{g as _}from"./getDefaultUnitForView.js";import b from"../widgets/Widget.js";import{c as y,i as w}from"./widgetUtils.js";import{m as T}from"./messageBundle.js";import{a as x}from"./number.js";import{t as L}from"./jsxFactory.js";import{b as M,c as $,d as z,f as C,e as j}from"./euclideanLengthMeasurementUtils.js";import{c as E}from"./quantityUtils.js";import{d as k}from"./vec3.js";import{geodesicLength as O}from"../geometry/geometryEngine.js";import{projectVectorToWGS84ComparableLonLat as H,projectPolylineToWGS84ComparableLonLat as N}from"../geometry/projection.js";import{isSupported as U,InverseGeodeticSolverResult as R,inverseGeodeticSolver as S,geodesicLengths as P}from"../geometry/support/geodesicUtils.js";import{c as V,b as W,f as A}from"./unitUtils.js";let D=class extends e{constructor(t){super(t),this.helpMessage=void 0}};t([s()],D.prototype,"tooltipOptions",void 0),t([s()],D.prototype,"helpMessage",void 0),D=t([i("esri.views.interactive.tooltip.SketchTooltipInfo")],D);const F="esri-tooltip",Z=`${F}-content`,G=`${F}-table`,q=`${F}-help-message`;let B=class extends b{get _units(){const t=_(this.tooltip.view);return{length:t,verticalLength:t,area:t}}_getHelpMessage(t){const{info:e}=this,{tooltipOptions:s,helpMessage:i,viewType:n}=e,o=s?.visibleElements?.helpMessage,a=t??i,r="3d"===n?"helpMessages3d":"helpMessages2d";return o&&a?this._messagesTooltip?.sketch?.[r]?.[a]:void 0}_formatScale(t){return x(t,{style:"percent",maximumFractionDigits:0})}_formatRelativeOrientation(t){return x(t,{maximumFractionDigits:2,minimumFractionDigits:2,signDisplay:"exceptZero"})}_formatLength(t,e,s){return h(this._messagesUnits,t,n(e,this._units.length),s)}_formatRelativeLength(t){return g(this._messagesUnits,t,this._units.length)}_formatVerticalLength(t){return u(this._messagesUnits,t,this._units.verticalLength)}_formatRelativeVerticalLength(t){return m(this._messagesUnits,t,this._units.verticalLength)}_formatTotalLength(t){return h(this._messagesUnits,t,this._units.length)}_formatArea(t){return v(this._messagesUnits,t,this._units.area)}_formatPercentage(t){return x(t.value,{style:"percent"})}};function X({className:t,helpMessage:e},...s){const i=s.filter((t=>!!t));return L("div",{class:y(t,Z)},i.length>0?L("div",{class:G},...i):null,e?L("div",{key:"help-message",class:q},e):null)}t([s()],B.prototype,"info",void 0),t([s()],B.prototype,"tooltip",void 0),t([s()],B.prototype,"_units",null),t([T("esri/core/t9n/Units"),s()],B.prototype,"_messagesUnits",void 0),t([T("esri/views/interactive/tooltip/t9n/Tooltip"),s()],B.prototype,"_messagesTooltip",void 0),B=t([i("esri.views.interactive.tooltip.content.TooltipContent")],B);const Y=`${F}-field`,I={base:Y,title:`${Y}__title`,value:`${Y}__value`};let J=class extends b{render(){return L("div",{class:I.base},L("div",{class:I.title},this.title),L("div",{class:I.value},this.value))}};t([s()],J.prototype,"title",void 0),t([s()],J.prototype,"value",void 0),J=t([i("esri.views.interactive.tooltip.support.TooltipField")],J);const K={base:`${F}-value-by-value`};let Q=class extends b{constructor(){super(...arguments),this.divider="Ã—"}render(){return L("div",{class:K.base},L("span",null,this.left),L("span",null,this.divider),L("span",null,this.right))}};t([s()],Q.prototype,"left",void 0),t([s()],Q.prototype,"divider",void 0),t([s()],Q.prototype,"right",void 0),Q=t([i("esri.views.interactive.tooltip.support.ValueByValue")],Q);const tt={base:`${Z} ${Z}--draw-rectangle`};let et=class extends B{render(){const{area:t,radius:e,xSize:s,ySize:i,tooltipOptions:n}=this.info,{visibleElements:a}=n,r=this._messagesTooltip.sketch;return L(X,{className:tt.base,helpMessage:this._getHelpMessage()},a.radius&&o(e)&&L(J,{title:r.radius,value:this._formatLength(e)}),a.size&&o(s)&&o(i)&&L(J,{title:r.size,value:L(Q,{left:this._formatLength(s),right:this._formatLength(i)})}),a.area&&L(J,{title:r.area,value:this._formatArea(t)}))}};et=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],et);const st={base:`${Z}--draw-point`};let it=class extends B{render(){const{elevation:t,tooltipOptions:e}=this.info,{visibleElements:s}=e,i=this._messagesTooltip.sketch;return L(X,{className:st.base,helpMessage:this._getHelpMessage()},s.elevation&&L(J,{title:i.elevation,value:this._formatVerticalLength(t)}))}};it=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],it);const nt={base:`${Z} ${Z}--draw-polygon`};let ot=class extends B{render(){const{area:t,elevation:e,tooltipOptions:s,viewType:i}=this.info,{visibleElements:n}=s,o=this._messagesTooltip.sketch;return L(X,{className:nt.base,helpMessage:this._getHelpMessage()},n.elevation&&"2d"!==i&&L(J,{title:o.elevation,value:this._formatVerticalLength(e)}),n.area&&L(J,{title:o.area,value:this._formatArea(t)}))}};ot=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],ot);const at={base:`${Z} ${Z}--draw-polyline`};let rt=class extends B{render(){const{elevation:t,totalLength:e,tooltipOptions:s,viewType:i}=this.info,{visibleElements:n}=s,o=this._messagesTooltip.sketch;return L(X,{className:at.base,helpMessage:this._getHelpMessage()},n.elevation&&"2d"!==i&&L(J,{title:o.elevation,value:this._formatVerticalLength(t)}),n.totalLength&&L(J,{title:o.totalLength,value:this._formatLength(e)}))}};rt=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],rt);const lt={base:`${Z} ${Z}--draw-rectangle`};let ct=class extends B{render(){const{area:t,xSize:e,ySize:s,tooltipOptions:i}=this.info,{visibleElements:n}=i,a=this._messagesTooltip.sketch;return L(X,{className:lt.base,helpMessage:this._getHelpMessage()},n.size&&o(e)&&o(s)&&L(J,{title:a.size,value:L(Q,{left:this._formatLength(e),right:this._formatLength(s)})}),n.area&&L(J,{title:a.area,value:this._formatArea(t)}))}};ct=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],ct);const pt={base:`${Z} ${Z}--extent-rotate`};let ht=class extends B{render(){const{angle:t,tooltipOptions:e}=this.info,{visibleElements:s}=e,i=this._messagesTooltip.sketch;return L(X,{className:pt.base,helpMessage:this._getHelpMessage()},s.rotation&&L(J,{title:i.rotation,value:this._formatRelativeOrientation(t)}))}};ht=t([i("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],ht);const gt={base:`${Z} ${Z}--extent-scale`};let ut=class extends B{render(){const t=this.info,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return L(X,{className:gt.base,helpMessage:this._getHelpMessage()},e.size&&L(J,{title:s.size,value:L(Q,{left:this._formatLength(t.xSize),right:this._formatLength(t.ySize)})}),e.scale&&L(J,{title:s.scale,value:L(Q,{left:this._formatScale(t.xScale),right:this._formatScale(t.yScale)})}))}};ut=t([i("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],ut);const mt={base:`${Z} ${Z}--reshape-edge-offset`};let vt=class extends B{render(){const{area:t,distance:e,totalLength:s,tooltipOptions:i}=this.info,{visibleElements:n}=i,a=this._messagesTooltip.sketch;return L(X,{className:mt.base,helpMessage:this._getHelpMessage()},n.distance&&L(J,{title:a.distance,value:this._formatRelativeLength(e)}),n.area&&o(t)&&L(J,{title:a.area,value:this._formatArea(t)}),n.totalLength&&o(s)&&L(J,{title:a.totalLength,value:this._formatLength(s)}))}};vt=t([i("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],vt);const dt={base:`${Z} ${Z}--transform-absolute`};let ft=class extends B{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return L(X,{className:dt.base,helpMessage:this._getHelpMessage()},e.orientation&&t.orientationEnabled&&L(J,{title:s.orientation,value:d(t.orientation,t.rotationType,t.orientationPrecision)}),e.size&&t.sizeEnabled&&L(J,{title:s.size,value:this._formatLength(t.size,t.sizeUnit,t.sizePrecision)}))}};ft=t([i("esri.views.interactive.tooltip.content.TooltipContentTransformAbsolute")],ft);const _t={base:`${Z} ${Z}--transform-rotate`};let bt=class extends B{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return L(X,{className:_t.base,helpMessage:this._getHelpMessage()},e.rotation&&L(J,{title:s.rotation,value:f(t.rotation,t.rotationType,t.rotationPrecision)}),e.orientation&&L(J,{title:s.orientation,value:d(t.orientation,t.rotationType,t.orientationPrecision)}))}};bt=t([i("esri.views.interactive.tooltip.content.TooltipContentTransformRotate")],bt);const yt={base:`${Z} ${Z}--transform-scale`};let wt=class extends B{render(){const{scale:t,size:e,sizePrecision:s,sizeUnit:i,tooltipOptions:n}=this.info,{visibleElements:o}=n,a=this._messagesTooltip.sketch;return L(X,{className:yt.base,helpMessage:this._getHelpMessage()},o.scale&&L(J,{title:a.scale,value:this._formatPercentage(t)}),o.size&&L(J,{title:a.size,value:this._formatLength(e,i,s)}))}};wt=t([i("esri.views.interactive.tooltip.content.TooltipContentTransformScale")],wt);const Tt={base:`${Z} ${Z}--translate-graphic`};let xt=class extends B{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return L(X,{className:Tt.base,helpMessage:this._getHelpMessage()},e.distance&&L(J,{title:s.distance,value:this._formatLength(t.distance)}))}};xt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphic")],xt);const Lt={base:`${Z} ${Z}--translate-graphic-xy`};let Mt=class extends B{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return L(X,{className:Lt.base,helpMessage:this._getHelpMessage()},e.distance&&L(J,{title:s.distance,value:this._formatRelativeLength(t.distance)}))}};Mt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphicXY")],Mt);const $t={base:`${Z} ${Z}--translate-graphic-z`};let zt=class extends B{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return L(X,{className:$t.base,helpMessage:this._getHelpMessage()},e.distance&&L(J,{title:s.distance,value:this._formatRelativeVerticalLength(t.distance)}))}};zt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphicZ")],zt);const Ct={base:`${Z} ${Z}--translate-vertex`};let jt=class extends B{render(){const{distance:t,elevation:e,area:s,totalLength:i,tooltipOptions:n}=this.info,{visibleElements:a}=n,r=this._messagesTooltip.sketch;return L(X,{className:Ct.base,helpMessage:this._getHelpMessage()},a.distance&&L(J,{title:r.distance,value:this._formatLength(t)}),a.elevation&&o(e)&&L(J,{title:r.elevation,value:this._formatVerticalLength(e)}),a.area&&o(s)&&L(J,{title:r.area,value:this._formatArea(s)}),a.totalLength&&o(i)&&L(J,{title:r.totalLength,value:this._formatLength(i)}))}};jt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],jt);const Et={base:`${Z} ${Z}--translate-vertex`};let kt=class extends B{render(){const{area:t,distance:e,elevation:s,totalLength:i,tooltipOptions:n}=this.info,{visibleElements:a}=n,r=this._messagesTooltip.sketch;return L(X,{className:Et.base,helpMessage:this._getHelpMessage()},a.distance&&L(J,{title:r.distance,value:this._formatRelativeLength(e)}),a.elevation&&o(s)&&L(J,{title:r.elevation,value:this._formatVerticalLength(s)}),a.area&&o(t)&&L(J,{title:r.area,value:this._formatArea(t)}),a.totalLength&&o(i)&&L(J,{title:r.totalLength,value:this._formatLength(i)}))}};kt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateVertexXY")],kt);const Ot={base:`${Z} ${Z}--translate-vertex`};let Ht=class extends B{render(){const{distance:t,elevation:e,tooltipOptions:s}=this.info,{visibleElements:i}=s,n=this._messagesTooltip.sketch;return L(X,{className:Ot.base,helpMessage:this._getHelpMessage()},i.distance&&L(J,{title:n.distance,value:this._formatRelativeVerticalLength(t)}),i.elevation&&o(e)&&L(J,{title:n.elevation,value:this._formatVerticalLength(e)}))}};Ht=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateVertexZ")],Ht);const Nt={base:`${F}`};let Ut=class extends e{constructor(t){super(t),this.info=null,this._contentContainer=(()=>{const t=document.createElement("div");return t.classList.add(Nt.base),t})(),this._contentWidget=null}initialize(){const t=this._contentContainer;this.addHandles([c((()=>this.view.overlay?.surface),(e=>{t.remove(),r(e,(e=>e.appendChild(t)))}),p),c((()=>this.info),((e,s)=>{o(this._contentWidget)&&o(e)&&o(s)&&e.type===s.type?this._contentWidget.info=e:(this._contentWidget=l(this._contentWidget),r(function(t,e){if(a(e))return null;const s=document.createElement("div");switch(e.type){case"draw-point":return new it({tooltip:t,info:e,container:s});case"draw-polygon":return new ot({tooltip:t,info:e,container:s});case"draw-polyline":return new rt({tooltip:t,info:e,container:s});case"draw-rectangle":return new ct({tooltip:t,info:e,container:s});case"draw-circle":return new et({tooltip:t,info:e,container:s});case"extent-rotate":return new ht({tooltip:t,info:e,container:s});case"extent-scale":return new ut({tooltip:t,info:e,container:s});case"transform-absolute":return new ft({tooltip:t,info:e,container:s});case"transform-rotate":return new bt({tooltip:t,info:e,container:s});case"transform-scale":return new wt({tooltip:t,info:e,container:s});case"translate-graphic":return new xt({tooltip:t,info:e,container:s});case"translate-graphic-z":return new zt({tooltip:t,info:e,container:s});case"translate-graphic-xy":return new Mt({tooltip:t,info:e,container:s});case"translate-vertex":return new jt({tooltip:t,info:e,container:s});case"translate-vertex-z":return new Ht({tooltip:t,info:e,container:s});case"translate-vertex-xy":return new kt({tooltip:t,info:e,container:s});case"reshape-edge-offset":return new vt({tooltip:t,info:e,container:s})}}(this,e),(e=>{this._contentWidget=e,e.container&&t.appendChild(e.container)})))}),p),c((()=>({container:this._contentContainer,contentWidget:this._contentWidget,screenPoint:this._screenPoint})),Rt,p)])}destroy(){this._contentWidget=l(this._contentWidget),this._contentContainer.remove()}clear(){this.info=null}get _screenPoint(){const t=this.view.inputManager;return t?.multiTouchActive?null:t?.latestPointerLocation}get test(){return{contentContainer:this._contentContainer,visible:"none"!==this._contentContainer?.style.display}}};function Rt({container:t,contentWidget:e,screenPoint:s}){const{style:i}=t;if(o(s)&&o(e)){i.display="block";const e=w(t),n=`translate(${Math.round(s.x)+St[0]*(e?-1:1)}px, ${Math.round(s.y)+St[1]}px)`;i.transform=e?`translate(-100%, 0) ${n}`:n}else i.display="none"}t([s({nonNullable:!0})],Ut.prototype,"view",void 0),t([s()],Ut.prototype,"info",void 0),t([s()],Ut.prototype,"_contentContainer",void 0),t([s()],Ut.prototype,"_contentWidget",void 0),t([s()],Ut.prototype,"_screenPoint",null),Ut=t([i("esri.views.interactive.tooltip.Tooltip")],Ut);const St=[20,20];function Pt(t,e,s,i,...n){return V(t)&&U(t)?e.apply(void 0,n):W(t)?s.apply(void 0,n):i.apply(void 0,n)}function Vt(t){const{spatialReference:e}=t;return Pt(e,Gt,qt,Bt,t)}function Wt(t,e){if(!A(t.spatialReference,e.spatialReference))return null;const{spatialReference:s}=t;return Yt[0]=t.x,Yt[1]=t.y,Yt[2]=t.hasZ?t.z:0,It[0]=e.x,It[1]=e.y,It[2]=e.hasZ?e.z:0,At(Yt,It,s)}function At(t,e,s){return Pt(s,Dt,Ft,Zt,t,e,s)}function Dt(t,e,s){return E(S(Xt,t,e,s).distance,"meters")}function Ft(t,e,s){return E(O(function(t,e,s){return{type:"polyline",spatialReference:s,paths:[[[...t],[...e]]]}}(t,e,s),"meters"),"meters")}function Zt(t,e,s){return H(t,s,Jt)&&H(e,s,Kt)?E(S(Xt,Jt,Kt).distance,"meters"):null}function Gt(t){return E(P([t],"meters")[0],"meters")}function qt(t){return E(O(t,"meters"),"meters")}function Bt(t){const e=[];if(!N(t,e))return null;let s=0;for(const t of e){let e=0;for(let s=1;s<t.length;++s)e+=S(Xt,t[s-1],t[s]).distance;s+=e}return E(s,"meters")}const Xt=new R,Yt=k(),It=k(),Jt=k(),Kt=k();function Qt(t,e){return oe($,Vt,M,e,t)}function te(t,e,s,i){return oe(j,At,C,i,t,e,s)}function ee(t,e,s){return oe(z,Wt,z,s,t,e)}function se(t,e,s,i){return oe(C,At,C,i,t,e,s)}function ie(t){return oe($,Vt,M,"on-the-ground",t)}function ne(t,e){return oe(z,Wt,z,"on-the-ground",t,e)}function oe(t,e,s,i,...n){if("on-the-ground"===i){const t=e.apply(void 0,n);return o(t)?t:s.apply(void 0,n)}return t.apply(void 0,n)}export{D as S,Ut as T,Qt as a,ee as b,se as c,te as d,At as e,ne as f,Pt as g,ie as h};
