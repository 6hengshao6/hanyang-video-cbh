/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../request.js";import r from"../core/Error.js";import{i as t}from"./maybe.js";import{throwIfAbortError as s}from"../core/promiseUtils.js";import{removeFile as o,normalize as n}from"../core/urlUtils.js";import a from"../portal/Portal.js";import l from"../portal/PortalQueryParams.js";import{h as i}from"./typedArrayUtil.js";const f=()=>!!i("enable-feature:force-wosr"),y=()=>!!i("enable-feature:direct-3d-object-feature-layer-display"),u=()=>!!i("enable-i3s-patching"),m=()=>!!i("enable-feature:SceneLayer-editing");let c={};function p(e,n,i){return e&&t(e.styleUrl)?async function(e,r){try{return{data:(await h(e,r)).data,baseUrl:o(e),styleUrl:e}}catch(e){return s(e),null}}(e.styleUrl,i):e&&t(e.styleName)?function(e,s,o){const n=t(s.portal)?s.portal:a.getDefault();let i;const f=`${n.url} - ${n.user&&n.user.username} - ${e}`;return c[f]||(c[f]=function(e,t,s){return t.load(s).then((()=>{const r=new l({disableExtraQuery:!0,query:`owner:${j} AND type:${w} AND typekeywords:"${e}"`});return t.queryItems(r,s)})).then((({results:t})=>{let o=null;const n=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const r=e.typeKeywords?.some((e=>e.toLowerCase()===n));if(r&&e.type===w&&e.owner===j){o=e;break}}if(!o)throw new r("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return o.load(s)}))}(e,n,o).then((e=>(i=e,e.fetchData()))).then((r=>({data:r,baseUrl:i.itemUrl??"",styleName:e})))),c[f]}(e.styleName,n,i):Promise.reject(new r("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function d(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function b(e,r){if("cimRef"===r)return e.cimRef;if(e.formatInfos&&!f())for(const r of e.formatInfos)if("gltf"===r.type)return r.href;return e.webRef}function h(r,t){const s={responseType:"json",query:{f:"json"},...t};return e(n(r),s)}const j="esri_en",w="Style",U="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{U as S,b as a,y as d,p as f,u as i,d as m,h as r,m as s};
