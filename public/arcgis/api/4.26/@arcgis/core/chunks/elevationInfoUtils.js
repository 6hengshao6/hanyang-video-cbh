/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{a as e,i as t,e as n}from"./maybe.js";import{g as o}from"./unitConversionUtils.js";function r(e){return e?y:E}function s(t,n){return e(n)||!n.mode?r(t).mode:n.mode}function a(e,n){return t(n)?n:r(e)}function u(e,n){return s(!!t(e)&&e.hasZ,n)}function i(e,n){return a(!!t(e)&&!!e.hasZ,n)}function l(e){const t=v(e);return u(e.geometry,t)}function c(e){const r=v(e),s=u(e.geometry,r);return{mode:s,offset:t(r)&&"on-the-ground"!==s?n(r.offset,0)*o(n(r.unit,"meters")):0}}function f(e){if("on-the-ground"===l(e))return!1;const n=v(e),o=t(n)&&n.featureExpressionInfo?n.featureExpressionInfo.expression:null;return!(!o||"0"===o)}function v(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function d(o,r,s){if(e(s)||!s.mode)return;const a=o.hasZ?o.z:0,u=t(s.offset)?s.offset:0;switch(s.mode){case"absolute-height":return a-u;case"on-the-ground":return 0;case"relative-to-ground":return a-(n(r.elevationProvider.getElevation(o.x,o.y,a,o.spatialReference,"ground"),0)+u);case"relative-to-scene":return a-(n(r.elevationProvider.getElevation(o.x,o.y,a,o.spatialReference,"scene"),0)+u)}}function g(e,t,n,o=null){return m(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,o)}function h(e,t,n,o,r=null){return m(e,t[0],t[1],t.length>2?t[2]:0,n,o,r)}function m(o,r,s,a,u,i,l=null){if(e(i))return;const c=t(l)?l.mode:"absolute-height";if("on-the-ground"===c)return 0;const{absoluteZ:f}=b(r,s,a,u,o,i);return function(e,o,r,s,a,u,i,l){const c=t(i)&&t(i.offset)?i.offset:0;switch(l){case"absolute-height":return e-c;case"relative-to-ground":return e-(n(u.elevationProvider.getElevation(o,r,s,a,"ground"),0)+c);case"relative-to-scene":return e-(n(u.elevationProvider.getElevation(o,r,s,a,"scene"),0)+c)}}(f,r,s,a,u,o,l,c)}function b(e,o,r,s,a,u){const i=t(u.offset)?u.offset:0;switch(u.mode){case"absolute-height":return{absoluteZ:r+i,elevation:0};case"on-the-ground":{const t=n(a.elevationProvider.getElevation(e,o,0,s,"ground"),0);return{absoluteZ:t,elevation:t}}case"relative-to-ground":{const t=n(a.elevationProvider.getElevation(e,o,r,s,"ground"),0);return{absoluteZ:r+t+i,elevation:t}}case"relative-to-scene":{const t=n(a.elevationProvider.getElevation(e,o,r,s,"scene"),0);return{absoluteZ:r+t+i,elevation:t}}}}function p(n,o){if(e(o))return!1;const{mode:r}=o;return t(r)&&("scene"===n&&"relative-to-scene"===r||"ground"===n&&"absolute-height"!==r)}const y={mode:"absolute-height",offset:0},E={mode:"on-the-ground",offset:null};export{h as a,c as b,g as c,d,a as e,y as f,u as g,l as h,f as i,i as j,p as k,s as l,E as o,b as z};
