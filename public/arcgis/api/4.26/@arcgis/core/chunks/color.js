/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{L as t}from"./Logger.js";import{C as n,J as r}from"./enums.js";import{a,b as s,V as i}from"./enums4.js";import{U as c,a as o,D as u}from"./enums3.js";import{V as l}from"./VertexElementDescriptor.js";import{a as f}from"./maybe.js";import{a as m}from"./number2.js";const d=t.getLogger("esri.views.2d.engine.webgl.Utils"),p="geometry",y=[{name:p,strideInBytes:12}],I=[{name:p,strideInBytes:36}],g=[{name:p,strideInBytes:24}],S=[{name:p,strideInBytes:12}],T=[{name:p,strideInBytes:40}],E=[{name:p,strideInBytes:36}],h=[{name:p,strideInBytes:36}];function w(e){const t={};for(const n of e)t[n.name]=n.strideInBytes;return t}const L=w([{name:p,strideInBytes:36}]),D=w(y),N=w(I),A=w(g),U=w(S),M=w(T),v=w(E),b=w(h);function B(e,t){switch(e){case a.MARKER:return t===s.HEATMAP?D:L;case a.FILL:switch(t){case s.DOT_DENSITY:return U;case s.SIMPLE:case s.OUTLINE_FILL_SIMPLE:return A;default:return N}case a.LINE:return M;case a.TEXT:return v;case a.LABEL:return b}}const C=[p],R=[p],_=[p],O=[p],F=[p];function x(e){switch(e){case a.MARKER:return C;case a.FILL:return R;case a.LINE:return _;case a.TEXT:return O;case a.LABEL:return F}}function z(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function P(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function j(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function V(e){return null!=e}function k(e){return"number"==typeof e}function $(t){switch(t){case"butt":return n.BUTT;case"round":return n.ROUND;case"square":return n.SQUARE;default:return d.error(new e("mapview-invalid-type",`Cap type ${t} is not a valid option. Defaulting to round`)),n.ROUND}}function G(t){switch(t){case"miter":return r.MITER;case"bevel":return r.BEVEL;case"round":return r.ROUND;default:return d.error(new e("mapview-invalid-type",`Join type ${t} is not a valid option. Defaulting to round`)),r.ROUND}}function Y(e){switch(e){case"opacity":return i.OPACITY;case"color":return i.COLOR;case"rotation":return i.ROTATION;case"size":return i.SIZE;default:return d.error(`Cannot interpret unknown vv: ${e}`),null}}function H(e,t,n,r,a,s,i){for(const t in s){const r=s[t].stride,i=z(r),c=s[t].data,o=n[t].data;if(null==c||null==o)continue;const u=r*a.vertexCount/i,l=r*e/i,f=r*a.vertexFrom/i;for(let e=0;e<u;++e)o[e+l]=c[e+f]}if(null!=i&&null!=r){const n=a.indexCount;for(let s=0;s<n;++s)r[s+t]=i[s+a.indexFrom]-a.vertexFrom+e}}const q={[p]:c.STATIC_DRAW};function K(e,t){const n=[];for(let r=0;r<5;++r){const a=x(r),s={};for(const e of a)s[e]={data:t(r,e)};n.push({data:e(r),buffers:s})}return n}function W(e){switch(e){case u.BYTE:case u.UNSIGNED_BYTE:return 1;case u.SHORT:case u.UNSIGNED_SHORT:return 2;case u.FLOAT:case u.INT:case u.UNSIGNED_INT:return 4}}function X(t){switch(t){case o.UNSIGNED_BYTE:return 1;case o.UNSIGNED_SHORT_4_4_4_4:return 2;case o.FLOAT:return 4;default:return void d.error(new e("webgl-utils",`Unable to handle type ${t}`))}}function J(t){switch(t){case o.UNSIGNED_BYTE:return Uint8Array;case o.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case o.FLOAT:return Float32Array;default:return void d.error(new e("webgl-utils",`Unable to handle type ${t}`))}}const Q=new Map,Z=(e,t)=>{if(!Q.has(e)){const n=function(e){const t={};for(const n in e){const r=e[n];let a=0;t[n]=r.map((e=>{const t=new l(e.name,e.count,e.type,a,0,e.normalized||!1);return a+=e.count*W(e.type),t})),t[n]?.forEach((e=>e.stride=a))}return t}(t),r=(e=>{const t={};for(const n in e){const r=e[n];t[n]=r?.length?r[0].stride:0}return t})(n),a=(e=>{const t=new Map;for(const n in e)for(const r of e[n])t.set(r.name,r.location);return t})(t),s={strides:r,bufferLayouts:n,attributes:a};Q.set(e,s)}return Q.get(e)};function ee(e){e(a.FILL),e(a.LINE),e(a.MARKER),e(a.TEXT),e(a.LABEL)}const te=e=>"path"in e&&pe(e.path),ne=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,re=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,ae=e=>null!=e&&e.startsWith("data:image/gif"),se=e=>"url"in e&&e.url&&(e.url.includes(".gif")||ae(e.url))||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&ae(e.imageData),ie=e=>null!=e&&e.startsWith("data:image/png"),ce=e=>"url"in e&&e.url&&(e.url.includes(".png")||ie(e.url))||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&ie(e.imageData),oe=e=>e.type&&e.type.toLowerCase().includes("3d");function ue(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const le=e=>e.includes("data:image/svg+xml");function fe(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":return!1;case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":return ye(e);default:return!0}}function me(e){const t="maxVVSize"in e&&e.maxVVSize,n="width"in e&&e.width||"size"in e&&e.size||0;return t||n}function de(e){const t=[];for(let n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}const pe=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),ye=e=>"fill"===e.type&&"CIMMarkerPlacementInsidePolygon"===e?.cim?.markerPlacement?.type;function Ie(e,t=0,n=!1){const r=e[t+3];return e[t]*=r,e[t+1]*=r,e[t+2]*=r,n||(e[t+3]*=255),e}function ge(e){if(!e)return 0;const{r:t,g:n,b:r,a}=e;return m(t*a,n*a,r*a,255*a)}function Se(e){if(!e)return 0;const[t,n,r,a]=e;return m(t*(a/255),n*(a/255),r*(a/255),a)}function Te(e,t,n=0){if(f(t))return e[n]=0,e[n+1]=0,e[n+2]=0,void(e[n+3]=0);const{r,g:a,b:s,a:i}=t;e[n]=r*i/255,e[n+1]=a*i/255,e[n+2]=s*i/255,e[n+3]=i}export{$ as A,G as B,q as C,Y as D,X as E,V as F,oe as a,de as b,Z as c,ue as d,te as e,ne as f,J as g,ye as h,k as i,re as j,me as k,se as l,ce as m,le as n,P as o,Ie as p,z as q,H as r,fe as s,K as t,j as u,B as v,Te as w,ee as x,Se as y,ge as z};
