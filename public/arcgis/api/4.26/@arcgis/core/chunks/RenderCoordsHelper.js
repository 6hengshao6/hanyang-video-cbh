/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{r as t}from"./mathUtils.js";import{i as e}from"./maybe.js";import{B as s,g as r}from"./unitUtils.js";import{j as o,s as i}from"./mat4.js";import{s as n,d as a,m as l,c as u,n as c,h as m}from"./vec3.js";import{g as p,j as f}from"./typedArrayUtil.js";import{projectPointToVector as d,projectVectorToVector as h,projectVectorToDehydratedPoint as v,projectVectorToPoint as y}from"../geometry/projection.js";import{A as S,b as A}from"./vector.js";import g from"../geometry/SpatialReference.js";import{g as j}from"./spatialReferenceEllipsoidUtils.js";import{f as _,b as R}from"./boundedPlane.js";import{f as w,s as C}from"./sphere.js";import{h as P}from"./plane.js";import{s as b}from"./ray.js";import{i as M}from"./ElevationProvider.js";import{V as U}from"./ViewingMode.js";import{i as x}from"./spatialReferenceSupport.js";function B(t,e,s=function(t){return{operations:t,value:t.create()}}(t)){return s.operations=t,t.copy(e,s.value),s}const G=2**50;function E(t,e,s,r){return t.operations.setAltitudeAt(t.value,e,s,r)}function I(t,e,s){return t.operations.elevate(t.value,e,s.value)}const L=a();function V(t,e,s,r,o){return o[0]=l(t,e),o[1]=l(t,s),o[2]=l(t,r),o}function Y(t,e,s,r,o){u(s,t),u(F,e),c(F,F),m(r,F,s),m(o,r,s)}function Z(t,e){return t?j(e):e.isGeographic?g.PlateCarree:e}const F=a();class O{constructor(t,e,s,r){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=s,this._coordinateSystem=r,this._tmpCoordinateSystem=function(t){const{value:e,operations:s}=t;return{operations:s,value:s.create(e)}}(r)}set extent(t){t&&function(t,e,s){t.operations.setExtent(t.value,e,s.value)}(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return s=t,(e=this._coordinateSystem).operations.altitudeAt(e.value,s);var e,s}setAltitude(t,e,s=t){return E(this._coordinateSystem,s,e,t)}setAltitudeOfTransformation(t,e){!function(t,e,s,r){e!==r&&o(r,e),n(L,r[12],r[13],r[14]),E(t,L,s,L),r[12]=L[0],r[13]=L[1],r[14]=L[2]}(this._coordinateSystem,e,t,e)}worldUpAtPosition(t,e){return r=t,o=e,(s=this._coordinateSystem).operations.axisAt(s.value,r,S.Z,o);var s,r,o}worldBasisAtPosition(t,e,s){return o=t,i=e,n=s,(r=this._coordinateSystem).operations.axisAt(r.value,o,i,n);var r,o,i,n}basisMatrixAtPosition(t,e){const s=this.worldBasisAtPosition(t,S.X,b.get()),r=this.worldBasisAtPosition(t,S.Y,b.get()),o=this.worldBasisAtPosition(t,S.Z,b.get());return i(e,s[0],s[1],s[2],0,r[0],r[1],r[2],0,o[0],o[1],o[2],0,0,0,0,1),e}headingAtPosition(e,s){const r=this.worldUpAtPosition(e,b.get()),o=this.worldBasisAtPosition(e,S.Y,b.get()),i=A(s,o,r);return t(i)}intersectManifoldClosestSilhouette(t,e,s){var r,o,i;return I(this._coordinateSystem,e,this._tmpCoordinateSystem),o=t,i=s,(r=this._tmpCoordinateSystem).operations.intersectRayClosestSilhouette(r.value,o,i),s}intersectManifold(t,e,s){I(this._coordinateSystem,e,this._tmpCoordinateSystem);const r=b.get();return i=t,n=r,(o=this._tmpCoordinateSystem).operations.intersectRay(o.value,i,n)?u(s,r):null;var o,i,n}intersectInfiniteManifold(t,e,s){if(this.viewingMode===U.Global)return this.intersectManifold(t,e,s);I(this._coordinateSystem,e,this._tmpCoordinateSystem);const r=this._tmpCoordinateSystem.value,o=b.get();return P(r.plane,t,o)?u(s,o):null}toRenderCoords(t,e,s){return M(t)?d(t,e,this.spatialReference):h(t,e,s,this.spatialReference)}fromRenderCoords(t,s,r=null){return M(s)?(e(r)&&(s.spatialReference=r),v(t,this.spatialReference,s)):function(t){return p(t)&&t.length>=3}(o=s)||function(t){return(f(t)||Array.isArray(t))&&t.length>=3}(o)?h(t,this.spatialReference,s,r)?s:null:y(t,this.spatialReference,s);var o}static create(t,e){switch(t){case U.Local:return new O(U.Local,e,r(e),B(R,_([0,0,0],[G,0,0],[0,G,0])));case U.Global:return new O(U.Global,e,1,function(t){return B(C,w(0,0,0,s(t).radius))}(e))}}static renderUnitScaleFactor(t,e){return T(t)/T(e)}}function T(t){if(x(t,U.Global))return 1;const e=Z(!1,t);return r(e)}export{O as R,Y as c,Z as r,V as v};
