/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{v as n}from"./typedArrayUtil.js";import{i}from"./maybe.js";import{a as t}from"./clusterUtils.js";import{b as e}from"./sizeVariableUtils.js";import{g as o}from"./utils15.js";import{b as l}from"./utils13.js";const a="cluster_count";function r(n,i){return n.split(`cluster_${i}_`).pop()}function s(n,o){const a=function(n){if(!n)return null;const{field:i,valueExpression:t,normalizationField:o,normalizationType:a,normalizationTotal:r}=n;let s=null;if(t)s=t;else if(i){const n=l({normalizationType:a,normalizationField:o,normalizationTotal:r});if(n){const t=n.toLowerCase();if(s=i.toLowerCase()+",norm:"+t,o)s+=","+o.toLowerCase();else if("percent-of-total"===t){let n=r;e(n)&&0!==n||(n=null),s+=","+n}}}return s}(n),r=i(a)?function(n){return t(n)}(a):n.field;return`${o}_${r}`}function u(n,i){return`cluster_${s(n,i)}`}function p(n,i){const t=i.getField(n);return t&&t.type}function f(n,t){const e="rotation"===t.type?t.rotationType:null,o=t.legendOptions&&t.legendOptions.title,l=t.field,a=l?p(l,n):null;return{field:l,fieldType:i(a)?a:null,rotationType:e,valueExpression:t.valueExpression,valueExpressionTitle:t.valueExpressionTitle||t.valueExpression&&o,normalizationField:"normalizationField"in t?t.normalizationField:null,vvType:t.type}}function c(n){return n?n.replace(/"/g,'\\"'):""}function m(n,i,t){return`\n  var uvInfos = [${function(n){return n.map((n=>`{\n        "value": "${String(n.value)}",\n        "label": "${c(String(n.label))}"\n      }`))}(n).join(", ")}];\n  var predominantType = Text($feature["${i}"]);\n  var label = "${c(t)}";\n\n  for (var i = 0; i < Count(uvInfos); i++) {\n    if (uvInfos[i].value == predominantType) {\n      label = uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  `}function v(n,i){const t=[s(n,i)];return"date"===n.fieldType&&t.push(n.fieldType.toLowerCase()),n.rotationType&&t.push(n.rotationType.toLowerCase()),t.join("_")}function T(n,i){return{statisticHash:v(n,i),attributeInfo:n,statisticType:i}}function d(t,e,l=!0){const a=[],r=function(n,t){const e="field"in t?t.field:null,o=e?p(e,n):null;return{field:e,fieldType:i(o)?o:null,valueExpression:"valueExpression"in t?t.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in t?t.valueExpressionTitle:null,normalizationField:"normalizationField"in t?t.normalizationField:null,normalizationType:"normalizationType"in t?t.normalizationType:null,normalizationTotal:"normalizationTotal"in t?t.normalizationTotal:null}}(t,e);"class-breaks"===e.type?a.push(T(r,"avg")):"unique-value"===e.type&&a.push(T(r,"type"));const s=o(e);for(const n of s){const i=f(t,n);a.push(T(i,"avg"))}return l?n(a,((n,i)=>n.statisticHash===i.statisticHash)):a}export{u as a,r as b,a as c,m as d,d as g};
