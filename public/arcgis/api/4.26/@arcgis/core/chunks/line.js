/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{i as t,e,a as r}from"./maybe.js";import{o}from"./vec2.js";import{s as n,d as a}from"./vec3.js";import{O as s}from"./vec4f64.js";import{B as i}from"./unitUtils.js";import{lonLatToWebMercatorComparable as u}from"../geometry/projection.js";import{n as c}from"./DoubleArray.js";import{a as f,n as p}from"./DefaultBufferWriter.js";import{g as l}from"./Indices.js";import{V as m}from"./ViewingMode.js";import{A as T}from"./Attribute.js";import{C as h}from"./Material.js";import{V as E}from"./VertexAttribute.js";function A(a,A,O=null){const D=[],b=[],g=A.mapPositions;!function(t,e,r){const{attributeData:{position:o},removeDuplicateStartEnd:n}=t,a=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(o)&&n,s=o.length/3-(a?1:0),i=new Array(2*(s-1)),u=a?o.slice(0,o.length-3):o;let c=0;for(let t=0;t<s-1;t++)i[c++]=t,i[c++]=t+1;e.push([E.POSITION,new T(u,3,a)]),r.push([E.POSITION,i])}(A,b,D);const j=b[0][1].data,w=D[0][1].length,S=l(w);return function(r,o,n,a){if(t(r.attributeData.colorFeature))return;const i=r.attributeData.color;o.push([E.COLOR,new T(e(i,s),4)]),n.push([E.COLOR,a])}(A,b,D,S),function(r,o,n,a){if(t(r.attributeData.sizeFeature))return;const s=r.attributeData.size;o.push([E.SIZE,new T([e(s,1)],1,!0)]),n.push([E.SIZE,a])}(A,b,D,S),function(e,r,o,n){if(!t(e.attributeData.normal))return;const a=e.attributeData.normal;r.push([E.NORMAL,new T(a,3)]),o.push([E.NORMAL,n])}(A,b,D,S),function(t,e,o,n){const a=t.attributeData.colorFeature;r(a)||(e.push([E.COLORFEATUREATTRIBUTE,new T([a],1,!0)]),o.push([E.COLOR,n]))}(A,b,D,S),function(t,e,o,n){const a=t.attributeData.sizeFeature;r(a)||(e.push([E.SIZEFEATUREATTRIBUTE,new T([a],1,!0)]),o.push([E.SIZEFEATUREATTRIBUTE,n]))}(A,b,D,S),function(t,e,o,n){const a=t.attributeData.opacityFeature;r(a)||(e.push([E.OPACITYFEATUREATTRIBUTE,new T([a],1,!0)]),o.push([E.OPACITYFEATUREATTRIBUTE,n]))}(A,b,D,S),function(t,e,a,s){if(r(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==m.Global||!t.overlayInfo.spatialReference.isGeographic)return;const f=c(s.length),l=i(t.overlayInfo.spatialReference);for(let t=0;t<f.length;t+=3)u(s,t,f,t,l);const h=s.length/3,A=p(h+1);let O=I,D=R,b=0,g=0;n(O,f[g++],f[g++],f[g++]),A[0]=0;for(let t=1;t<h+1;++t)t===h&&(g=0),n(D,f[g++],f[g++],f[g++]),b+=o(O,D),A[t]=b,[O,D]=[D,O];e.push([E.DISTANCETOSTART,new T(A,1,!0)]),a.push([E.DISTANCETOSTART,a[0][1]])}(A,b,D,j),new f(a,b,D,g,h.Line,O)}const I=a(),R=a();function O(t,e){if(r(t)||0===t.length)return[];const o=[];return t.forEach((t=>{const r=t.length,n=c(3*r);t.forEach(((t,e)=>{n[3*e]=t[0],n[3*e+1]=t[1],n[3*e+2]=t[2]}));const a={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};o.push(a)})),o}export{A as c,O as l};
