/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{k as t}from"./typedArrayUtil.js";import{n as e}from"./nextTick.js";import{r as i,k as s,c as r,b as n,d as a,h as o,n as h,m as f,a as c,g as m}from"./vec3.js";import{B as _}from"./byteSizeEstimations.js";import{a as u}from"./mat3f64.js";import{a as g}from"./mat4f64.js";import{a as l}from"./quatf64.js";import{c as P}from"./vec2f64.js";import{b as p}from"./vec4f64.js";class B{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&e((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*d);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,d));t++)this._items.push(this._allocator())}}const d=1024;class w{constructor(t,e,i){this._itemByteSize=t,this._itemCreate=e,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){0===this._itemsPtr&&e((()=>this._reset()));const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const t=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let e=0;e<this._itemsPerBuffer;++e)this._items.push(this._itemCreate(t,e*this._itemByteSize));this._buffers.push(t)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=M){return new w(16,P,t)}static createVec3f64(t=M){return new w(24,i,t)}static createVec4f64(t=M){return new w(32,p,t)}static createMat3f64(t=M){return new w(72,u,t)}static createMat4f64(t=M){return new w(128,g,t)}static createQuatf64(t=M){return new w(32,l,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const M=4*_.KILOBYTES,b=w.createVec2f64(),y=w.createVec3f64(),j=w.createVec4f64();w.createMat3f64();const z=w.createMat4f64(),S=w.createQuatf64();function V(t){return t?k(s(t.origin),s(t.direction)):k(a(),a())}function k(t,e){return{origin:t,direction:e}}function x(e,i){return t(e.origin,i.origin)&&t(e.direction,i.direction)}function A(t,e){const i=T.get();return i.origin=t,i.direction=e,i}function v(t,e=V()){return E(t.origin,t.direction,e)}function C(t,e,i=V()){return r(i.origin,t),n(i.direction,e,t),i}function E(t,e,i=V()){return r(i.origin,t),r(i.direction,e),i}function O(t,e){const i=o(y.get(),h(y.get(),t.direction),n(y.get(),e,t.origin));return f(i,i)}function Q(t,e,i){const s=f(t.direction,n(i,e,t.origin));return c(i,t.origin,m(i,t.direction,s)),i}const T=new B((()=>V()));export{B as O,j as a,v as b,V as c,z as d,Q as e,E as f,C as g,O as h,x as i,b as j,S as k,y as s,A as w};
