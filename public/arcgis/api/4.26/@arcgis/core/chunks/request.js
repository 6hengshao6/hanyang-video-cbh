/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{u as t}from"./maybe.js";import"../core/lang.js";import"./typedArrayUtil.js";import"./Logger.js";import"../config.js";import"./object.js";import"./string.js";let r;function s(s,a){let o=a.responseType;o?"array-buffer"!==o&&"blob"!==o&&"json"!==o&&"native"!==o&&"native-request-init"!==o&&"text"!==o&&(o="text"):o="json",a.responseType=o;const n=t(a.signal);return delete a.signal,globalThis.invokeStaticMessage("request",{url:s,options:a},{signal:n}).then((async t=>{let i,l,u,p,c;if(t.data)if(t.data instanceof ArrayBuffer){if(!("json"!==o&&"text"!==o&&"blob"!==o||(i=new Blob([t.data]),"json"!==o&&"text"!==o||(r||(r=new FileReaderSync),p=r.readAsText(i),"json"!==o)))){try{l=JSON.parse(p||null)}catch(t){const r={...t,url:s,requestOptions:a};throw new e("request:server",t.message,r)}if(l.error){const t={...l.error,url:s,requestOptions:a};throw new e("request:server",l.error.message,t)}}}else"native"===o&&(t.data.signal=n,u=await fetch(t.data.url,t.data),t.httpStatus=u.status);switch(o){case"blob":c=i;break;case"json":c=l;break;case"native":c=u;break;case"text":c=p;break;default:c=t.data}return{data:c,httpStatus:t.httpStatus,requestOptions:a,ssl:t.ssl,url:s}}))}export{s as execute};
