/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{c as e}from"../chunks/asyncUtils.js";import{g as i,i as s,d as o,r as n,u as r,a,e as l,f as c}from"../chunks/maybe.js";import{m as p}from"../chunks/memoize.js";import{o as d,throwIfAborted as h,createAbortError as m}from"../core/promiseUtils.js";import{watch as u,initial as g}from"../core/reactiveUtils.js";import{property as b}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import{F as f}from"../chunks/typedArrayUtil.js";import{subclass as v}from"../core/accessorSupport/decorators/subclass.js";import _ from"./Widget.js";import y from"./ElevationProfile/ElevationProfileViewModel.js";import k from"../core/Accessor.js";import j from"../core/Collection.js";import{substitute as C}from"../intl.js";import{t as x}from"../chunks/throttle.js";import{f as S,e as w,u as P}from"../chunks/unitFormatUtils.js";import{N as M,g as E,E as L,a as U}from"./ElevationProfile/ElevationProfileLine.js";import{e as T,i as B,o as I}from"../chunks/widgetUtils.js";import{m as A}from"../chunks/messageBundle.js";import{t as D}from"../chunks/jsxFactory.js";import{R as z,w as F}from"../chunks/unitUtils.js";import{P as O}from"../chunks/Popover.js";import $ from"../core/Error.js";import{h as V,m as R}from"../chunks/handleUtils.js";import{l as W}from"../chunks/chartUtils.js";import{i as H}from"../chunks/themeUtils.js";import{a as G}from"../chunks/number.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/string.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/tracking.js";import"../chunks/metadata.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../chunks/jsonMap.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../chunks/Ellipsoid.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/byteSizeEstimations.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/getDefaultUnitForView.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/vec2.js";import"../geometry/projection.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../geometry/support/geodesicUtils.js";import"../chunks/QueueProcessor.js";import"../chunks/Queue.js";import"../chunks/Scheduler.js";import"../chunks/ObservableValue.js";import"../chunks/debugFlags.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../Ground.js";import"../chunks/compilerUtils.js";import"../chunks/loadAll.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery.js";import"../layers/support/ElevationSampler.js";import"../chunks/ElevationSamplerData.js";import"../chunks/TileKey.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/vec4f64.js";import"../chunks/ray.js";import"../chunks/mat3f64.js";import"../chunks/mat4f64.js";import"../chunks/quatf64.js";import"../chunks/vec2f64.js";import"../chunks/Intersector2.js";import"../chunks/ViewingMode.js";import"../chunks/boundedPlane.js";import"../chunks/vector.js";import"../chunks/lineSegment.js";import"../chunks/plane.js";import"../chunks/mathUtils2.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/mat3.js";import"../chunks/quat.js";import"../chunks/vec3f32.js";import"../chunks/sphere.js";import"../chunks/intersectorUtilsConversions.js";import"../chunks/Intersector.js";import"../chunks/Intersector3.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../layers/Layer.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/ScaleRangeLayer.js";import"../chunks/ElevationInfo.js";import"./Sketch/SketchViewModel.js";import"../chunks/isSupportedGraphic.js";import"../geometry/Circle.js";import"../chunks/layerUtils3.js";import"../chunks/InputManager.js";import"../chunks/PropertiesPool.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SnappingManager.js";import"../chunks/Settings2.js";import"../chunks/LineSnappingHint.js";import"../chunks/QueryEngineResult.js";import"../chunks/quantizationUtils.js";import"../chunks/ItemCache.js";import"../core/sql/WhereClause.js";import"../chunks/executionError.js";import"../chunks/datetime.js";import"../chunks/utils10.js";import"../chunks/generateRendererUtils.js";import"../chunks/projectionSupport.js";import"../chunks/json.js";import"../chunks/SnappingCandidate.js";import"../chunks/utils9.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils4.js";import"../chunks/utils5.js";import"../chunks/featureConversionUtils.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/EdgeSnappingCandidate.js";import"../chunks/snappingUtils.js";import"../chunks/dehydratedFeatures.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/geometry2dUtils.js";import"../chunks/DrapedEdgeSnappingCandidate.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/viewUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/screenUtils2.js";import"../chunks/Cyclical.js";import"../chunks/Material.js";import"../chunks/interfaces2.js";import"../chunks/VertexAttribute.js";import"../chunks/Util2.js";const Y="esri-elevation-profile",X={esriWidget:"esri-widget--panel esri-widget",esriWidgetDisabled:"esri-widget--disabled",buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-elevation-profile",base:`${Y}`,portrait:`${Y}--portrait`,refined:`${Y}--refined`,mainContainer:`${Y}__main-container`,promptContainer:`${Y}__prompt-container`,header:`${Y}__header`,zoomOutButton:`${Y}__zoom-out-button esri-icon-zoom-out-magnifying-glass`,clearButton:`${Y}__clear-button esri-icon-trash`,actionButton:`${Y}__action-button esri-button`,sketchButton:`${Y}__sketch-button esri-button--primary`,sketchCancelButton:`${Y}__sketch-cancel-button esri-button--secondary`,sketchDoneButton:`${Y}__sketch-done-button esri-button--primary`,selectButton:`${Y}__select-button esri-button--secondary`,selectCancelButton:`${Y}__select-cancel-button esri-button--secondary`,chartContainer:`${Y}__chart-container`,chartSpinner:`${Y}__chart-spinner esri-icon-loading-indicator esri-rotating`,chartSpinnerVisible:`${Y}__chart-spinner--visible`,chartSpinnerSmall:`${Y}__chart-spinner--small`,footer:`${Y}__footer`},N="amcharts-cursor--enabled",q="esri-elevation-profile-legend-item",Z={base:q,disabled:`${q}--disabled`,expanded:`${q}--expanded`,colorIndicator:`${q}__color-indicator`,header:`${q}__header`,content:`${q}__content`,collapseToggle:`${q}__collapse-toggle esri-button esri-button--tertiary`,collapseToggleIcon:`${q}__collapse-toggle__icon esri-icon-down`,label:`${q}__label`,labelDisabled:`${q}__label--disabled`,checkbox:`${q}__checkbox`},Q="esri-elevation-profile-statistics",J={base:Q,statistic:`${Q}__statistic`,statisticLabel:`${Q}__statistic__label`,statisticValue:`${Q}__statistic__value`,slopeValue:`${Q}__slope-value`,slopeUpIcon:"esri-icon-arrow-up",slopeDownIcon:"esri-icon-arrow-down"},K="esri-elevation-profile-settings",tt={base:`${K} esri-icon-handle-vertical`,popoverContent:`${K}__popover-content`,select:`${K}__select esri-select`,selectLabel:`${K}__select-label`,checkboxLabel:`${K}__checkbox-label`,checkbox:`${K}__checkbox`,uniformChartScalingCheckbox:`${K}__uniform-chart-scaling-checkbox`};let et=class extends k{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([b()],et.prototype,"legend",void 0),t([b()],et.prototype,"chart",void 0),t([b()],et.prototype,"clearButton",void 0),t([b()],et.prototype,"settingsButton",void 0),t([b()],et.prototype,"sketchButton",void 0),t([b()],et.prototype,"selectButton",void 0),t([b()],et.prototype,"unitSelector",void 0),t([b()],et.prototype,"uniformChartScalingToggle",void 0),et=t([v("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],et);const it=et;let st=class extends _{constructor(t,e){super(t,e),this._updateLayout=t=>{const e=t.parentElement,i=t.style.display;e?.removeChild(t),document.body.appendChild(t),t.style.display="block";let s=80;for(const e of t.childNodes)e instanceof HTMLElement&&(s=Math.max(s,e.offsetWidth));document.body.removeChild(t),e?.appendChild(t),t.style.display=i,t.style.setProperty("--max-width",`${s}px`)},this._updateLayoutThrottled=x(this._updateLayout,100)}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return D("div",{bind:this,class:J.base,afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled},this._renderStatistics())}_renderStatistics(){const t=this._messages?.statistics;return t?[this._renderDistanceStatistic("maxDistance",t.maxDistance),this._renderElevationStatistic("elevationGain",t.gain),this._renderElevationStatistic("elevationLoss",t.loss),this._renderElevationStatistic("minElevation",t.minElevation),this._renderElevationStatistic("maxElevation",t.maxElevation),this._renderElevationStatistic("avgElevation",t.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",t.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",t.avgSlope)]:[]}_renderDistanceStatistic(t,e){const i=E().formatPrecision,s=this._renderValue(t,(t=>{const e=this.effectiveUnits.distance;return S(this._messagesUnits,t,e,i)}));return this._renderStatistic(e,s)}_renderElevationStatistic(t,e){const i=E().formatPrecision,s=this._renderValue(t,(t=>{const e=this.effectiveUnits.elevation;return S(this._messagesUnits,t,e,i)}));return this._renderStatistic(e,s)}_renderSlopeStatistic(t,e,i){const s=E().formatPrecision,o=D("div",{key:"slope-up",class:J.slopeValue},D("div",{class:J.slopeUpIcon}),this._renderValue(t,(t=>w(t,"degrees","geographic","geographic",s))),D("div",{class:J.slopeDownIcon}),this._renderValue(e,(t=>w(t,"degrees","geographic","geographic",s))));return this._renderStatistic(i,o)}_renderStatistic(t,e){return D("div",{class:J.statistic},D("label",{class:J.statisticLabel},t),D("div",{class:J.statisticValue},e))}_renderValue(t,e){const o=this.line,n=1===o.progress?o.statistics:null,r=i(n,(e=>e[t]));return s(r)?e(r):M}};function ot(t,{profiles:e}){const i=t.title;if(s(i))return i;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([b()],st.prototype,"effectiveUnits",void 0),t([b()],st.prototype,"line",void 0),t([b(),A("esri/widgets/ElevationProfile/t9n/ElevationProfile")],st.prototype,"_messages",void 0),t([b(),A("esri/core/t9n/Units")],st.prototype,"_messagesUnits",void 0),st=t([v("esri.widgets.ElevationProfile.Statistics")],st);let nt=class extends _{constructor(t,e){super(t,e),this.expanded=!1,this.checkboxVisible=!0,this._messages=null}initialize(){this._statistics=new st(this._statisticsProps),this.addHandles(u((()=>this._statisticsProps),(t=>this._statistics.set(t))))}destroy(){this._statistics=o(this._statistics)}render(){const t=this.expanded;return D("div",{key:this,class:this.classes(Z.base,{[Z.disabled]:this.disabled,[Z.expanded]:t})},this._renderColorIndicator(),D("div",{key:"header",class:Z.header},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t&&D("div",{key:"content",class:Z.content},this._statistics.render()))}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return D("div",{key:"color-indicator",class:Z.colorIndicator,styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const t=this._messages,e=this.expanded?t.hideDetails:t.showDetails;return D("button",{key:"collapse-toggle",bind:this,class:Z.collapseToggle,onclick:this._onCollapseToggleClick,title:e,"aria-label":e,type:"button"},D("span",{class:Z.collapseToggleIcon}))}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:i}=this,s=`${Z.base}__check-${t.id}`;return D("label",{key:"id",for:s,class:this.classes(Z.label,{[Z.labelDisabled]:i||!e})},e&&this._renderCheckbox(s),D("span",null,ot(t,this._messages)))}_renderCheckbox(t){const e=this.line,i=e.visible,s=this.disabled,o=this._messages,n=i?o.hideProfile:o.showProfile,r=ot(e,this._messages),a=C(n,{name:r});return D("input",{key:"checkbox",id:t,type:"checkbox",class:Z.checkbox,title:a,checked:i,disabled:s,"aria-label":a,bind:this,onchange:t=>this._onCheckboxToggle(t,e)})}_onCheckboxToggle(t,e){t.stopPropagation(),e.toggleVisibility()}};t([b({nonNullable:!0})],nt.prototype,"effectiveUnits",void 0),t([b({nonNullable:!0})],nt.prototype,"line",void 0),t([b()],nt.prototype,"expanded",void 0),t([b()],nt.prototype,"disabled",null),t([b()],nt.prototype,"checkboxVisible",void 0),t([b()],nt.prototype,"onExpandedToggle",void 0),t([b()],nt.prototype,"_statistics",void 0),t([b(),A("esri/widgets/ElevationProfile/t9n/ElevationProfile")],nt.prototype,"_messages",void 0),nt=t([v("esri.widgets.ElevationProfile.LegendItem")],nt);let rt=class extends _{constructor(t,e){super(t,e),this._items=new j,this._expandedLine=null}initialize(){this.addHandles([u((()=>this.profiles),(t=>{this._destroyItems(),this._items.addMany(t.map((t=>this._createItemForLine(t))))}),g),u((()=>this.effectiveUnits),(t=>{this._items.forEach((e=>{e.effectiveUnits=t}))}),g)])}destroy(){this._destroyItems()}render(){return D("div",{class:"esri-elevation-profile-legend"},this._items.toArray().map((t=>t.render())))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t,this._items.forEach((t=>t.expanded=t.line===this._expandedLine))}_createItemForLine(t){return new nt({line:t,effectiveUnits:this.effectiveUnits,expanded:t===this._expandedLine,checkboxVisible:this.profiles.length>1,onExpandedToggle:()=>this._onExpandedToggle(t)})}_destroyItems(){this._items.drain((t=>t.destroy()))}};t([b()],rt.prototype,"profiles",void 0),t([b()],rt.prototype,"effectiveUnits",void 0),t([b()],rt.prototype,"_items",void 0),t([b()],rt.prototype,"_expandedLine",void 0),rt=t([v("esri.widgets.ElevationProfile.Legend")],rt);let at=class extends _{constructor(t,e){super(t,e),this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;if(!t&&!e)return D("div",{key:`${this.id}-empty`});const i=s(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return D("button",{class:tt.base,title:i,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":i,type:"button"})}_initializePopover(t){this._destroyPopover(),this._buttonElement=t,this._popover=new O({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:t,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=n(this._focusOutElement),this._popover=o(this._popover)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return D("div",{class:tt.popoverContent,dir:T(r(this._buttonElement)),bind:this,afterCreate:this._onPopoverContentAfterCreate},t&&this._renderUnitSelector(),e&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:t,unitOptions:e}=this.viewModel,i=this._messagesUnits;return D("label",{key:"unit-selector-label",class:tt.selectLabel},this._messages.unitSelectLabel,D("select",{class:tt.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},e.map((t=>D("option",{key:t,value:t},z(t)?i.systems[t]:i.units[t].pluralCapitalized)))))}_onUnitChange(t){this.viewModel.unit=t.target.value}_onUnitSelectAfterCreate(t){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,t.focus())}_renderUniformChartScalingToggle(){const t=this._messages,e=this.viewModel.uniformChartScaling,i=e?t.uniformChartScalingDisable:t.uniformChartScalingEnable;return D("label",{key:"uniform-chart-scaling-label",class:tt.checkboxLabel,onmousedown:lt},D("input",{class:this.classes(tt.checkbox,tt.uniformChartScalingCheckbox),type:"checkbox",checked:e,title:i,"aria-label":i,bind:this,onchange:this._onUniformChartScalingChange}),t.uniformChartScalingLabel)}_onUniformChartScalingChange(t){this.viewModel.uniformChartScaling=t.target.checked}_togglePopover(t){s(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){i(this._popover,(t=>t.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:t=!0}={}){i(this._popover,(t=>t.open=!1)),t&&i(this._buttonElement,(t=>t.focus()))}_onPopoverContentAfterCreate(t){n(this._focusOutElement),this._focusOutElement=d(t,"focusout",(({relatedTarget:e})=>{const i=t.contains(e),s=e===this._buttonElement;i||s||this._closePopover({focusOnButton:!1})}))}};function lt(t){t.preventDefault()}function ct(t,e){const i=Math.floor(Math.log10(t)),s=t/10**i;let o;return o=e?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,o*10**i}t([b()],at.prototype,"viewModel",void 0),t([b()],at.prototype,"visibleElements",void 0),t([b(),A("esri/widgets/ElevationProfile/t9n/ElevationProfile")],at.prototype,"_messages",void 0),t([b(),A("esri/core/t9n/Units")],at.prototype,"_messagesUnits",void 0),at=t([v("esri.widgets.ElevationProfile.SettingsButton")],at);const pt="#f8f8f8",dt="#a9a9a9",ht="#323232",mt="line",ut="fill",gt=30,bt=.5,ft={sideSpacing:15,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:dt,axisTooltipFontSize:12,axisTooltipBackgroundColor:ht,axisTooltipLabelColor:pt,axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:pt,seriesTooltipLabelColor:ht,seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:Math.round(3.75),seriesTooltipPaddingHorizontal:Math.round(3.75),tooltipBorderRadius:0},vt={...ft,axisGridStroke:ht,axisLabelsColor:dt,axisTooltipBackgroundColor:ht,axisTooltipLabelColor:pt,seriesTooltipBackgroundColor:ht,seriesTooltipLabelColor:pt,seriesFillLighten:-.75},_t={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};function yt({data:t,bounds:e,pixelWidth:i,pixelHeight:s,centered:o}){if(a(t))return e;let{minX:n,maxX:r,minY:l,maxY:c}=e;if(null==n||null==r||null==l||null==c)return _t;const p=r-n,d=c-l,h=t.effectiveUnits,m=F(d,h.elevation,h.distance)/s/(p/i);return m>=1?[n,r]=kt([n,r],m,o):[l,c]=kt([l,c],1/m,o),{minX:n,maxX:r,minY:l,maxY:c}}function kt([t,e],i,s){const o=(e-t)*i;if(s){const i=(t+e)/2-o/2;return[i,i+o]}return[t,t+o]}function jt(t,{line:e,fill:o},n){const{theme:r}=t,{am4core:a}=t.amCharts4Index,{r:c,g:p,b:d,a:h}=n.color,m=a.color({r:c,g:p,b:d,a:h}),u=l(n.samples,new Array),g=u.length>0;e.stroke=m,e.visible=g,i(o,(t=>{t.visible=g,t.fill=m.lighten(r.seriesFillLighten)}));const b=u.length,f=e.data;if(f.length===b){let t=!1;for(let e=0;e<b;++e){const i=f[e],o=u[e];t=t||s(i.elevation)!==s(o.elevation),_=o,(v=i).x=_.x,v.y=_.y,v.z=_.z,v.distance=_.distance,v.elevation=_.elevation}t?(e.invalidateData(),i(o,(t=>t.invalidateData()))):(e.invalidateRawData(),i(o,(t=>t.invalidateRawData())))}else e.data=u,i(o,(t=>t.data=u));var v,_}function Ct(t,e){const{id:i}=e,s=xt(t,`${mt}-${i}`);s.strokeWidth=e.chartStrokeWidth,s.dy=e.chartStrokeOffsetY;let o=null;return e.chartFillEnabled&&(o=xt(t,`${ut}-${i}`),o.fillOpacity=1),{id:i,line:s,fill:o}}function xt(t,e){const i=new t.amCharts4Index.am4charts.LineSeries;return i.id=e,i.showOnInit=!1,i.simplifiedProcessing=!0,i.minDistance=bt,i.excludeFromTotal=!0,i.clickable=!1,i.contextMenuDisabled=!0,i.cursorHoverEnabled=!1,i.cursorTooltipEnabled=!1,i.connect=!1,i.fill=null,i.stroke=null,i.dataFields.valueX="distance",i.dataFields.valueY="elevation",i}function St(t,e){const{amChart:i,xAxis:s,yAxis:o}=t;let n=!1;const r=()=>{const{data:e}=t;if(!n||a(e)||!e.uniformScaling)return;n=!1;const{minX:r,maxX:l,minY:c,maxY:p}=yt({data:t.data,bounds:{minX:s.minZoomed,maxX:s.maxZoomed,minY:o.minZoomed,maxY:o.maxZoomed},pixelWidth:s.pixelWidth,pixelHeight:o.pixelHeight,centered:!0});null!=r&&null!=l&&s.zoomToValues(r,l,!0),null!=c&&null!=p&&o.zoomToValues(c,p,!0),i.validate(),Et(t)},l=()=>{e(t.xAxis.zoomFactor,t.yAxis.zoomFactor)},c=e=>{t.zooming=e,Et(t)},p=[i.events.on("down",(()=>c(!0))),i.events.on("up",(()=>c(!1))),i.cursor.events.on("zoomended",(()=>{n=!0})),s.events.on("startendchanged",r),o.events.on("startendchanged",r),s.events.on("rangechangeended",l),o.events.on("rangechangeended",l)];return R((()=>{p.forEach((t=>t.dispose()))}))}function wt({xAxis:t,yAxis:e}){const i=t=>()=>{t.renderer.grid.each((t=>{t.visible="none"!==t.dataItem.label.dom.getAttribute("display")}))},s=[t.events.on("rangechangeended",i(t)),t.events.on("validated",i(t)),e.events.on("rangechangeended",i(e)),e.events.on("validated",i(e))];return R((()=>{s.forEach((t=>t.dispose()))}))}function Pt(t,e){const{amChart:i,xAxis:o,yAxis:n}=t,{cursor:r,events:a}=i,l=e=>{t.pointerIsOver=e,Et(t)},c=()=>{l(!1),e(null,null)},p=[r.events.on("cursorpositionchanged",(()=>{if(!t.pointerIsOver)return;Et(t);let i=o.toAxisPosition(r.xPosition),a=n.toAxisPosition(r.yPosition);const l=t.data;if(s(l)&&s(l.statistics)){const{maxDistance:t,minElevation:e,maxElevation:r}=l.statistics;s(t)&&(i=Mt(i,o.minZoomed,o.maxZoomed,0,t)),s(e)&&s(r)&&(a=Mt(a,n.minZoomed,n.maxZoomed,e,r))}e(i,a)})),a.on("over",(()=>l(!0))),a.on("out",c),a.on("blur",c)];return R((()=>{p.forEach((t=>t.dispose()))}))}function Mt(t,e,i,s,o){return(e+t*(i-e)-s)/(o-s)}function Et(t){const{amChart:e,xAxis:o,data:n,theme:r,zooming:l,pointerIsOver:c}=t;if(t.amChart.tooltip.hide(),t.xAxis.hideTooltip(),!c)return;if(l)return;if(a(n)||!n.refined)return;const p=function(t){const{amChart:e,yAxis:o,data:n}=t;if(a(n))return null;const r=n.lines.map((e=>({line:e,y:i(Tt(t,e),(t=>t.elevation))}))).sort(Lt),l=r.length?r[0].y:null;if(a(l))return null;const c=e.cursor,p=o.measuredHeight,d=p+e.pixelPaddingTop;return{text:r.map((({y:e,line:i})=>function(t,e,i){const{data:o,messages:n}=t;if(a(o)||a(n))return"";const r=E().formatPrecision,l=C(n.chartTooltip,{name:ot(e,n),elevation:s(i)?S(n,i,o.effectiveUnits.elevation,r):M});return`[${e.color.toHex()}]●[/] ${l}`}(t,i,e))).join("\n"),x:c.point.x+c.parent.pixelX+e.pixelPaddingLeft,y:d-o.valueToPosition(l)*p}}(t);if(s(p)){const{cursor:i}=e,n=e.tooltip;i.show(0),i.validate(),n.text=p.text,n.show(0),n.validate();const l=p.y-n.contentHeight-r.seriesTooltipSpacing;n.pointerOrientation=l<gt?"up":"down",n.pointTo(p,!0),n.validate();const c=o.tooltip;c.text=function(t){const{data:e,messages:i}=t;if(a(e)||a(i))return"";const o=e.lines[0],n=o?Tt(t,o):null,r=E().formatPrecision;return s(n)?S(i,n.distance,e.effectiveUnits.distance,r):"-"}(t),c.show(0),c.validate()}}function Lt({y:t},{y:e}){return a(t)?1:a(e)?-1:e-t}function Ut(t,e){const i=t.xAxis.numberFormatter.clone();return i.format=(i,s,o)=>{const{messages:n,data:r}=t;return a(n)||a(r)||"string"==typeof i?"":`${G(i,{maximumFractionDigits:o})} ${P(n,r.effectiveUnits[e],"abbr")}`},i}function Tt({amChart:t,xAxis:e},i){const s=l(i.samples,[]);if(0===s.length)return null;const o=e.toAxisPosition(t.cursor.xPosition),n=e.positionToValue(o);return f(s,n,(t=>t.distance))}var Bt;!function(t){t.Sketch="sketch",t.SketchCancel="sketch-cancel",t.SketchDone="sketch-done",t.Select="select",t.SelectCancel="select-cancel"}(Bt||(Bt={}));const It=[{type:Bt.Select},{type:Bt.Sketch}],At={[L.None]:null,[L.NoValidInput]:"noProfile",[L.NoVisibleProfiles]:"noProfile",[L.RefinedButNoChartData]:"noProfile",[L.TooComplex]:"tooComplex",[L.UnknownError]:"unknown",[L.InvalidGeometry]:"invalidGeometry",[L.InvalidElevationInfo]:"invalidElevationInfo"},Dt=Symbol("resize-observer-handle");let zt=class extends _{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new it,this.iconClass=X.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._width=0,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=p(((t,e,i,s)=>({chart:t,data:e,stationary:i,messages:s}))),this._getDetailsPropsMemoized=p(((t,e)=>({effectiveUnits:t,profiles:e}))),t?.viewModel||(this._defaultViewModel=new y({view:t?.view}),this.viewModel=this._defaultViewModel)}initialize(){this._legend=new rt(this._legendProps),this._settingsButton=new at(this._settingsButtonProps),this.addHandles([u((()=>this._legendProps),(t=>this._legend.set(t))),u((()=>this._settingsButtonProps),(t=>this._settingsButton.set(t)))])}postInitialize(){this.addHandles([u((()=>({container:this._chartContainer,width:this._width})),(({container:t,width:e})=>{this._destroyChart(),s(t)&&e>0&&this._initializeChart(t)}),g),u((()=>this._chartUpdateParams),(()=>this._updateChart(this._chartUpdateParams)),g)])}destroy(){this._destroyChart(),s(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._legend=o(this._legend),this._settingsButton=o(this._settingsButton)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get input(){return this.viewModel.input}set input(t){this.viewModel.input=t}get profiles(){return this.viewModel.profiles}set profiles(t){this.viewModel.profiles=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get geodesicDistanceThreshold(){return this.viewModel.geodesicDistanceThreshold}set geodesicDistanceThreshold(t){this.viewModel.geodesicDistanceThreshold=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get _portrait(){return this._width<E().portraitModePixelBreakpoint}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,!s(t)||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _legendProps(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,this._profilesArray)}get _profilesArray(){return this.profiles.toArray()}get _settingsButtonProps(){return{viewModel:this.viewModel,visibleElements:this.visibleElements}}render(){const{viewModel:t,visible:e}=this;return D("div",{key:this,class:this.classes({[X.base]:e,[X.esriWidget]:e,[X.esriWidgetDisabled]:e&&"disabled"===t.state,[X.portrait]:this._portrait,[X.refined]:1===t.progress}),"aria-label":this.messages.widgetLabel},D("div",{key:"content-wrapper",bind:this,afterCreate:this._onContentWrapperAfterCreate,afterRemoved:this._onContentWrapperRemoved},e&&this._renderContentForState()))}_renderContentForState(){switch(this.viewModel.state){case U.Ready:return this._renderContentForReadyState();case U.Selecting:return this._renderContentForSelectingState();case U.Creating:return this._renderContentForCreatingState();case U.Selected:return this._renderContentForSelectedState();case U.Created:return this._renderContentForCreatedState();case U.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{sketchButton:t,selectButton:e}=this.visibleElements,i=this.messages;let s;return s=t&&e?i.readyPrompt:t?i.readyPromptCreateOnly:e?i.readyPromptSelectOnly:i.errors?.noProfile,this._renderContent({prompt:s,chart:!1,actions:It})}_renderContentForSelectingState(){const t=this.view;if(a(t))return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:Bt.SelectCancel}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(a(t))return null;const i=e.hasVertices?[{type:Bt.SketchCancel},{type:Bt.SketchDone,disabled:!e.tool.interaction.canStopCreating}]:[{type:Bt.Select},{type:Bt.Sketch,disabled:!0}];if(e.errorState===L.NoValidInput){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:i,prompt:e})}const s=this._getErrorMessage();return s?this._renderContent({chart:!1,actions:i,prompt:s}):this._renderContent({chart:!0,actions:i})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:It,prompt:t}):this._renderContent({chart:!0,actions:It})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:It,prompt:t}):this._renderContent({chart:!0,actions:It})}_getErrorMessage(){const t=At[this.viewModel.errorState];return t?this.messages?.errors?.[t]:null}_renderContent(t){const e=s(t.prompt)?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),i=s(this.viewModel.input);return[D("header",{key:"header",class:X.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&i&&this._renderClearButton(),this.visibleElements.settingsButton&&this._settingsButton.render()),D("div",{class:X.mainContainer},e),this.visibleElements.legend&&this._legend.render(),this._renderActions(t)]}_renderZoomOutButton(){return D("button",{key:"zoom-out",class:X.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut,type:"button"})}_onZoomOutButtonClick(){i(this._chart,(t=>t.zoomOut()))}_renderClearButton(){return D("button",{key:"clear-profile",class:X.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile,type:"button"})}_onClearButtonClick(){this.viewModel.clear()}_renderPrompt(t){return[D("div",{key:"prompt-container",bind:this,class:X.promptContainer},D("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return[D("div",{key:"empty-chart-container",class:X.chartContainer})];const t=this._chartIsRefined||this._canRenderChart();if(!t)return[this._renderSpinner({size:"large"}),D("div",{key:"chart-container-empty",class:X.chartContainer})];const{chartData:e,progress:i}=this.viewModel;return[s(e)&&i>0&&i<1&&this._renderSpinner({size:t?"small":"large"}),D("div",{key:"chart-container",bind:this,class:X.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]}_renderSpinner(t){return D("div",{key:"spinner",class:this.classes(X.chartSpinner,{[X.chartSpinnerSmall]:"small"===t.size}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})}_onSpinnerAfterCreate(t){requestAnimationFrame((()=>t.classList.add(X.chartSpinnerVisible)))}_onSpinnerExit(t,e){t.classList.remove(X.chartSpinnerVisible),setTimeout(e,200)}_canRenderChart(){const t=this.viewModel.chartData;if(a(t))return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:i}of t.lines)e+=s(i)?i.length:0;return t.refined||e<=E().largeChartSamples}_renderActions({actions:t}){const e=t.map((t=>{switch(t.type){case Bt.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onSketchButtonClick,className:X.sketchButton,label:this.messages.sketchButtonLabel});case Bt.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:X.sketchCancelButton,label:this.messagesCommon.cancel});case Bt.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:X.sketchDoneButton,label:this.messagesCommon.done});case Bt.Select:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:X.selectButton,label:this.messages.selectButtonLabel});case Bt.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:X.selectCancelButton,label:this.messagesCommon.cancel})}})).filter(Boolean);return e.length?D("footer",{key:"footer",class:X.footer},e):null}_renderAction({action:t,onClick:e,className:i,label:s}){return D("button",{key:`action-${t.type}`,class:this.classes(X.actionButton,i,{[X.buttonDisabled]:!!t.disabled}),bind:this,disabled:t.disabled,onclick:e,type:"button"},s)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_onContentWrapperAfterCreate(t){const e=I(t,(t=>{this._width=t.contentRect.width}));this.addHandles(e,Dt)}_onContentWrapperRemoved(){this.removeHandles(Dt)}_updateChart(t){const{data:e,chart:i,messages:o,stationary:n}=t;!a(i)&&!a(o)&&n&&this._canRenderChart()&&(i.update(t),this._chartIsRefined=s(e)&&e.refined)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}_initializeChart(t){c(this._chartInitTask),this._chartInitTask=e((async e=>{const n=await async function(t){const e=await W();if(!e)throw new $("elevation-profile:load-failed","Could not load amCharts");const{am4core:o,am4charts:n}=e;h(t.abortOptions);const{options:r}=o;r.minPolylineStep=.5,r.autoSetClassName=!0,r.animationsEnabled=!1;const l=H(),c=l?vt:ft;l&&o.useTheme(e.am4themes_dark);const p=o.create(t.container,n.XYChart);p.arrangeTooltips=!1,p.preloader.disabled=!0,p.zoomOutButton.disabled=!0;const d=B(t.container);p.rtl=d,p.padding(c.paddingTop,d?c.paddingLeft:c.paddingRight,c.paddingBottom,d?c.paddingRight:c.paddingLeft);const m=p.plotContainer.background;m.strokeWidth=0,m.strokeOpacity=0,m.stroke=null;const u=p.xAxes.push(new n.ValueAxis),g=p.yAxes.push(new n.ValueAxis),b={params:t,amCharts4Index:e,amChart:p,xAxis:u,yAxis:g,series:new Map,data:null,messages:null,theme:c,zooming:!1,pointerIsOver:!1};p.cursor=function(t){const e=new t.amCharts4Index.am4charts.XYCursor;return e.trackable=!0,e.lineY.disabled=!0,e.behavior="zoomXY",e}(b),function(t){const e=t.theme,i=t.amChart.tooltip,{am4core:s}=t.amCharts4Index;i.id="series-tooltip",i.fitPointerToBounds=!0,i.pointerOrientation="vertical",i.zIndex=-1,i.getFillFromObject=!1,i.label.fontSize=e.seriesTooltipFontSize,i.label.fill=s.color(e.seriesTooltipLabelColor),i.label.padding(e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal,e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal),i.background.cornerRadius=e.tooltipBorderRadius,i.background.stroke=null,i.background.fill=s.color(e.seriesTooltipBackgroundColor),i.background.padding(0,0,0,0),i.adapter.add("dy",(()=>e.seriesTooltipSpacing*(i.background.pointerY<=0?1:-1))),B(t.params.container)&&(i.label.textAlign="middle")}(b),function(t){const{xAxis:e,theme:i}=t,{am4core:s}=t.amCharts4Index;e.numberFormatter=Ut(t,"distance"),e.strictMinMax=!0,e.cursorTooltipEnabled=!1,e.title.visible=!1;const o=e.renderer;o.line.visible=!1,o.minGridDistance=i.xAxisMinGridDistance,o.minLabelPosition=i.xAxisMinLabelPosition,o.maxLabelPosition=i.xAxisMaxLabelPosition,o.fontWeight=i.axisFontWeight,o.fontSize=i.axisFontSize,o.baseGrid.disabled=!0;const n=o.labels.template;n.fontSize=i.axisLabelsFontSize,n.fontWeight=i.axisLabelsFontWeight,n.fill=s.color(i.axisLabelsColor),n.paddingTop=i.xAxisLabelsSpacing,n.horizontalCenter="left",n.paddingLeft=0;const r=e.tooltip;r.id="axis-tooltip",r.background.fill=s.color(i.axisTooltipBackgroundColor),r.background.stroke=null,r.background.padding(0,0,0,0),r.label.fontSize=i.axisTooltipFontSize,r.label.fill=s.color(i.axisTooltipLabelColor),r.label.padding(i.axisTooltipPaddingTop,i.axisTooltipPaddingHorizontal,i.axisTooltipPaddingBottom,i.axisTooltipPaddingHorizontal);const a=o.grid.template;a.strokeOpacity=1,a.stroke=s.color(i.axisGridStroke)}(b),function(t){const{yAxis:e,theme:i}=t,{am4core:s}=t.amCharts4Index;e.numberFormatter=Ut(t,"elevation"),e.title.visible=!1,e.cursorTooltipEnabled=!1,e.strictMinMax=!0,e.baseValue=E().noDataValue;const o=e.renderer;o.inside=!0,o.line.opacity=0,o.line.visible=!1,o.minGridDistance=i.yAxisMinGridDistance,o.minLabelPosition=i.yAxisMinLabelPosition,o.maxLabelPosition=i.yAxisMaxLabelPosition,o.fontWeight=i.axisFontWeight,o.fontSize=i.axisFontSize,o.baseGrid.disabled=!0;const n=o.labels.template;n.fontSize=i.axisLabelsFontSize,n.fontWeight=i.axisLabelsFontWeight,n.fill=s.color(i.axisLabelsColor),n.verticalCenter="bottom",n.paddingLeft=i.yAxisLabelSpacing,n.paddingBottom=0;const r=o.grid.template;r.strokeOpacity=1,r.stroke=s.color(i.axisGridStroke),B(t.params.container)&&(o.opposite=!0,n.textAlign="middle",n.paddingLeft=0,n.paddingRight=i.yAxisLabelSpacing)}(b);const f=[St(b,t.onRangeChange),Pt(b,t.onCursorPositionChange),wt(b)];let v=null,_=!1;const y=()=>{a(v)||("undefined"!=typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(v):clearTimeout(v),v=null)};return{...b,destroy(){_=!0,y(),V(f).remove(),p.dispose()},update(t){if(t.data===b.data&&t.messages===b.messages)return;if(y(),_)return;const e=()=>{_||(v=null,function(t,{data:e,messages:o}){const{htmlContainer:n}=t.amChart;if(!n)return;const r=s(e)&&e.refined;t.amChart.cursor.disabled=!r,n.classList.toggle(N,r);const l=t.data!==e,c=i(t.data,(t=>t.effectiveUnits))!==i(e,(t=>t.effectiveUnits));t.data=e,t.messages=o,l&&(function(t){const{xAxis:e,yAxis:s}=t,{minX:o,maxX:n,minY:r,maxY:l}=function({data:t,pixelWidth:e,pixelHeight:s}){if(a(t))return _t;const o=t.statistics,n=i(o,(t=>t.maxDistance));let r=i(o,(t=>t.minElevation)),l=i(o,(t=>t.maxElevation));if(a(n)||a(r)||a(l))return _t;const c=Math.max(n-0,.001);let p=Math.max(l-r,.001);const d=t.effectiveUnits;if(t.dynamicElevationRange){const t=F(c,d.distance,d.elevation);p=Math.max(p,t/E().maxChartRatio)}return r-=.02*p,l=r+p+.02*p,[r,l]=function(t,e,i=10){const s=ct(e-t,!1);if(0===s)return[t,e];const o=ct(s/(i-1),!0);return[Math.floor(t/o)*o,Math.ceil(e/o)*o]}(r,l,10),p=l-r,t.uniformScaling?yt({data:t,bounds:{minX:0,maxX:n,minY:r,maxY:l},pixelWidth:e,pixelHeight:s,centered:!0}):{minX:0,maxX:0+c,minY:r,maxY:r+p}}({data:t.data,pixelWidth:e.pixelWidth,pixelHeight:s.pixelHeight});e.min=o,e.max=n,s.min=r,s.max=l}(t),function(t){const{amChart:e,data:s}=t;if(a(s)||0===s.lines.length)return void e.series.clear();const o=new Map,n=new Set(e.series.values),r=s.lines.length;for(let a=0;a<r;a++){const l=s.lines[a];let c=t.series.get(l.id);c?(i(c.fill,(t=>n.delete(t))),n.delete(c.line)):(c=Ct(t,l),i(c.fill,(t=>e.series.push(t))),e.series.push(c.line)),o.set(c.id,c);const p=r-a-1;i(c.fill,(t=>t.zIndex=p)),c.line.zIndex=r+p,jt(t,c,l)}t.series=o;for(const t of n)e.series.removeValue(t)}(t)),c&&(t.yAxis.invalidateLabels(),t.xAxis.invalidateLabels()),Et(t)}(b,t))};v="undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(e,{timeout:30}):setTimeout(e,30)},zoomOut(){_||(b.yAxis.zoom({start:0,end:1},!1,!0),b.xAxis.zoom({start:0,end:1},!1,!0))}}}({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}});if(e.aborted)throw o(n),m();this._chart=n,this._updateChart(this._chartUpdateParams)}))}_destroyChart(){this._chartInitTask=c(this._chartInitTask),this._chart=o(this._chart),this._chartIsRefined=!1}get test(){return{chart:this._chart}}};t([b({type:y})],zt.prototype,"viewModel",void 0),t([b()],zt.prototype,"view",null),t([b()],zt.prototype,"input",null),t([b()],zt.prototype,"profiles",null),t([b()],zt.prototype,"unitOptions",null),t([b()],zt.prototype,"unit",null),t([b()],zt.prototype,"geodesicDistanceThreshold",null),t([b({type:it,nonNullable:!0})],zt.prototype,"visibleElements",void 0),t([b()],zt.prototype,"iconClass",void 0),t([b()],zt.prototype,"label",null),t([b()],zt.prototype,"visible",null),t([b(),A("esri/widgets/ElevationProfile/t9n/ElevationProfile")],zt.prototype,"messages",void 0),t([b(),A("esri/t9n/common")],zt.prototype,"messagesCommon",void 0),t([b(),A("esri/core/t9n/Units")],zt.prototype,"messagesUnits",void 0),t([b()],zt.prototype,"_chartContainer",void 0),t([b()],zt.prototype,"_chart",void 0),t([b()],zt.prototype,"_chartInitTask",void 0),t([b()],zt.prototype,"_chartIsRefined",void 0),t([b()],zt.prototype,"_settingsButton",void 0),t([b()],zt.prototype,"_legend",void 0),t([b()],zt.prototype,"_width",void 0),t([b()],zt.prototype,"_portrait",null),t([b()],zt.prototype,"_zoomOutButtonVisible",void 0),t([b()],zt.prototype,"_chartUpdateParams",null),t([b()],zt.prototype,"_chartMessages",null),t([b()],zt.prototype,"_legendProps",null),t([b()],zt.prototype,"_profilesArray",null),t([b()],zt.prototype,"_settingsButtonProps",null),zt=t([v("esri.widgets.ElevationProfile")],zt);const Ft=zt;export{Ft as default};
