/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{e as s}from"../core/promiseUtils.js";import{d as o,f as r}from"../chunks/maybe.js";import{watch as i,on as n,initial as l}from"../core/reactiveUtils.js";import{e as a}from"../chunks/string.js";import{property as u}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import"../chunks/typedArrayUtil.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import h from"./Widget.js";import p from"./Search/SearchResultRenderer.js";import d from"./Search/SearchViewModel.js";import{s as m,l as g,m as _}from"../chunks/widgetUtils.js";import{m as v}from"../chunks/messageBundle.js";import{v as y}from"../chunks/vmEvent.js";import{t as b}from"../chunks/jsxFactory.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/locale.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/messages.js";import"../core/Error.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/handleUtils.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/tracking.js";import"../chunks/metadata.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Accessor.js";import"../core/Handles.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/accessibleHandler.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/layerViewUtils.js";import"./Search/LayerSearchSource.js";import"./Search/SearchSource.js";import"../chunks/FullTextSearch.js";import"../chunks/geometryUtils3.js";import"../chunks/scaleUtils.js";import"./Search/LocatorSearchSource.js";import"../chunks/suggestLocations.js";import"../chunks/utils4.js";import"../rest/support/AddressCandidate.js";import"../chunks/commonProperties3.js";import"../chunks/geolocationUtils.js";import"../chunks/trimExtend.js";import"../rest/support/GeneralizeParameters.js";import"../rest/support/LengthsParameters.js";import"../rest/support/OffsetParameters.js";import"../chunks/project.js";import"../chunks/utils5.js";import"../rest/support/ProjectParameters.js";import"../rest/support/RelationParameters.js";import"../rest/support/TrimExtendParameters.js";import"./support/GoTo.js";const M="esri-search",j={base:`${M} esri-widget`,loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:`${M}--multiple-sources`,isLoading:`${M}--loading`,isSearching:`${M}--searching`,showSuggestions:`${M}--show-suggestions`,showSources:`${M}--sources`,showWarning:`${M}--warning`,container:`${M}__container`,input:`${M}__input`,inputContainer:`${M}__input-container`,form:`${M}__form`,submitButton:`${M}__submit-button`,sourcesButton:`${M}__sources-button`,clearButton:`${M}__clear-button`,sourceName:`${M}__source-name`,suggestionsMenu:`${M}__suggestions-menu`,suggestionList:`${M}__suggestions-list`,suggestionListCurrentLocation:`${M}__suggestions-list--current-location`,sourcesMenu:`${M}__sources-menu`,source:`${M}__source`,warningMenu:`${M}__warning-menu`,warningMenuBody:`${M}__warning-body`,warningMenuHeader:`${M}__warning-header`,warningMenuText:`${M}__warning-text`,noValueText:`${M}__no-value-text`,esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},S=/<[a-z/][\s\S]*>/i;let I=class extends h{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new p,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=j.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new d,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=e=>{const t=e.relatedTarget;t&&this._container?.contains(t)||this._clearActiveMenu()},this.addHandles([i((()=>this.searchTerm),(e=>{(e&&"warning"===this.activeMenu||!e&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()})),n((()=>this.viewModel?.allSources),"change",(()=>this._watchSourceChanges())),i((()=>this.activeMenu),(()=>this._resetActiveMenuItemIndex()),l),i((()=>this.viewModel?.defaultPopupTemplate),(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))}),l)])}destroy(){this.removeAllHandles(),this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=o(this._searchResultRenderer)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}async search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:s}=t;this._searchController=t;let o=null;try{if(o=await this.viewModel.search(e,{signal:s}),this._searchController!==t)return;this._clearActiveMenu(),this._searchController=null}catch(e){if(this._searchController!==t)return;this._clearActiveMenu(),this._searchController=null}if(this._searchController===t)return this.activeMenu=o?.numResults?"none":"warning",this._searchController=null,o}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;this._suggestController=t;try{const o=await this.viewModel.suggest(e,null,{signal:s});if(this._suggestController!==t)return;return this._suggestController=null,o?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),o}catch(e){return this._suggestController!==t||(this._suggestController=null),null}}render(){const{state:e}=this.viewModel,t={[j.disabled]:"disabled"===e,[j.esriWidgetDisabled]:this.disabled};return b("div",{class:this.classes(j.base,t)},"loading"===e?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e,disabled:t}=this;return b("button",{"aria-label":e.searchButtonTitle,bind:this,disabled:t,class:this.classes(j.submitButton,j.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},b("span",{"aria-hidden":"true",class:j.searchIcon}))}renderWarningMenu(){return b("div",{key:"esri-search__error-menu",class:this.classes(j.menu,j.warningMenu)},b("div",{class:j.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:s,sourceMenuButtonId:o,disabled:r}=this,{activeSourceIndex:i,allSources:n}=this.viewModel;return n.length>1?b("button",{id:o,key:"esri-search__source-menu-button",bind:this,disabled:r,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":("source"===t).toString(),"aria-controls":s,class:this.classes(j.sourcesButton,j.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:m,"data-node-ref":"_sourceMenuButtonNode",type:"button"},b("span",{"aria-hidden":"true",class:j.dropdownIcon}),b("span",{"aria-hidden":"true",class:j.dropupIcon}),b("span",{class:j.sourceName},this._getSourceName(i))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:s,activeMenu:o,sourceMenuId:r,sourceMenuButtonId:i}=this,n="source"===o&&s>-1?this._buildId("source-item",s):null;return e.length>1?b("ul",{"aria-activedescendant":n,"aria-labelledby":i,id:r,role:"menu",bind:this,afterCreate:m,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:j.menuList,tabIndex:-1},t?this.renderSource(d.ALL_INDEX):null,e.map(((e,t)=>this.renderSource(t))).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?b("div",{key:"esri-search__source-menu",class:this.classes(j.menu,j.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t,disabled:s}=this;return b("div",{class:j.loader,key:"base-loader",tabIndex:s?-1:void 0},b("span",{"aria-hidden":"true",class:j.loaderAnimation}),b("span",{class:j.fallbackText},e.searchButtonTitle),b("span",{class:j.loaderText},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:s}=this,o={[j.hasMultipleSources]:e.length>1,[j.isLoading]:"loading"===t,[j.isSearching]:"searching"===t,[j.showWarning]:"warning"===s,[j.showSources]:"source"===s,[j.showSuggestions]:"suggestion"===s};return b("div",{tabIndex:-1,afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(o,j.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?b("button",{bind:this,disabled:this.disabled,class:this.classes(j.clearButton,j.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},b("span",{"aria-hidden":"true",class:j.clearIcon})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:s}=this,o=t&&!s,r="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return o?b("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(j.menuList,j.suggestionList,j.suggestionListCurrentLocation)},b("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes(j.menuItem,r?j.menuItemFocus:null)},b("span",{"aria-hidden":"true",class:j.locate})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:s,messages:o,suggestionsMenuId:r,inputId:i,_activeMenuItemIndex:n,disabled:l}=this,{maxInputLength:a,placeholder:u,searchTerm:c,suggestionCount:h}=this.viewModel,p=!((!t||s)&&!h),d="suggestion"===e&&n>-1?this._buildId("suggestion-item",n):null;return b("input",{"aria-activedescendant":d,"aria-autocomplete":"list","aria-expanded":(p&&"suggestion"===e).toString(),"aria-controls":p?r:null,"aria-haspopup":"listbox","aria-label":o.searchButtonTitle,bind:this,disabled:l,placeholder:u,maxlength:a,autocomplete:"off",type:"text",class:this.classes(j.esriInput,j.input),value:c,id:i,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:m,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:c?"":u})}renderForm(){return b("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:j.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,{results:s}=e,o=s?.length;return o?b("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(j.menuList,j.suggestionList)},s?.map((e=>this.renderSuggestion(e,this._menuItemCount++)))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)])):[]}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:s,inputId:o}=this,{suggestionCount:r}=this.viewModel,i=t&&!e||r;return this._menuItemCount=0,i?b("div",{id:s,key:"esri-search__suggestions-menu",class:this.classes(j.menu,j.suggestionsMenu),role:"listbox","aria-labelledby":o,bind:this,afterCreate:m,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return b("div",{key:"esri-search__input-container",class:j.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:o}=e,r=e.results?.length,i=t.length>1&&s===d.ALL_INDEX;return r&&i?b("div",{key:`esri-search__suggestion-header-${o}`,class:j.menuHeader},this._getSourceName(o)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:s,messages:o}=this,{searchTerm:r}=this.viewModel;if(r){const{text:i}=e,n=i||o.untitledResult,l=S.test(n),a=[];if(l)a.push(b("div",{innerHTML:n}));else{const e=this._splitResult(n,r),t=r.toLowerCase();e.forEach(((e,s)=>{e&&e.length&&(e.toLowerCase()===t?a.push(b("strong",{key:s},e)):a.push(e))}))}const u="suggestion"===this.activeMenu&&s===t;return b("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(j.menuItem,u?j.menuItemFocus:null)},a)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:s}=this.viewModel,o={[j.menuItemActive]:e===t,[j.menuItemFocus]:"source"===this.activeMenu&&e===(s?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},r=s?e+1:e;return b("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",r),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(j.source,j.menuItem,o)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:s}=this,o=e?t(s.noResultsFoundForValue,{value:`"${e}"`}):s.noResultsFound;return b("div",{key:"esri-search__no_results"},b("div",{class:j.warningMenuHeader},s.noResults),b("div",{class:j.warningMenuText},o))}renderEmptySearchWarning(){const{messages:e}=this;return b("div",{key:"esri-search__empty-search"},b("span",{"aria-hidden":"true",class:j.noticeIcon}),b("span",{class:j.noValueText},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return b("div",{key:"esri-search__locate-error"},b("span",{"aria-hidden":"true",class:j.noticeIcon}),b("span",{class:j.noValueText},e.locateError))}renderWarning(){const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:s}=this;return t?this.renderLocateWarning():s.selectedSuggestion?.location||e?this.renderNoResultsWarning(e):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{viewModel:{allSources:e}}=this,t="sources";this.removeHandles(t),e.forEach((e=>this.addHandles(i((()=>e.name),(()=>this.scheduleRender())),t)))}_handleSourcesMenuToggleFocus(){"source"!==this.activeMenu&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,(async()=>{try{const e=await this.viewModel.searchNearby({signal:t});this.activeMenu=e?.numResults?"none":"warning"}catch(e){this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){if(!e)return;const t=e["data-source-index"];this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus()}_cancelSuggest(){this._suggestController=r(this._suggestController)}_cancelSearch(){this._searchController=r(this._searchController),this._locateFailed=!1}_handleInputKeyup(e){const t=s(e);if(e.ctrlKey||e.metaKey||"Copy"===t||"ArrowLeft"===t||"ArrowRight"===t||"Shift"===t)return;if("Tab"===t||"Escape"===t||e.shiftKey&&"Tab"===t)return this._cancelSuggest(),void("Escape"===t&&this._clearActiveMenu());const o="Home"===t||"End"===t||"ArrowUp"===t||"ArrowDown"===t;if("Enter"===t&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=this._suggestionListNode?.getElementsByTagName("li");if(r?.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),o)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);const s=r[this._activeMenuItemIndex];if("Enter"===t&&s){const e=s["data-suggestion"];return void(e?(this._focus(),this.search(e)):s["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,s){const o=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),o!==this._activeMenuItemIndex&&s&&g(t[this._activeMenuItemIndex],s)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=s(e);if(_(t)){e.preventDefault();const t=this._sourceListNode?.getElementsByTagName("li"),s=t?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(s)}else"ArrowUp"!==t&&"ArrowDown"!==t&&"End"!==t&&"Home"!==t||e.preventDefault()}_handleSourceMenuKeyup(e){const t=s(e),o="ArrowUp"===t||"ArrowDown"===t||"End"===t||"Home"===t;if(o&&e.preventDefault(),"Escape"===t)return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const r=this._sourceListNode?.getElementsByTagName("li");return r&&0!==r.length&&o?("source"!==this.activeMenu&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,this._sourceListNode?.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:t}=this,s=this.viewModel,{allSources:o}=s,r=o.getItemAt(e);return e===d.ALL_INDEX?t.all:r&&r.name||t.untitledSource}_splitResult(e,t){const s=a(t);return e.replace(new RegExp(`(^|)(${s})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};e([u()],I.prototype,"_activeMenuItemIndex",void 0),e([u()],I.prototype,"displayedSearchTerm",null),e([u({readOnly:!0})],I.prototype,"inputId",null),e([u({readOnly:!0})],I.prototype,"suggestionsMenuId",null),e([u({readOnly:!0})],I.prototype,"sourceMenuId",null),e([u({readOnly:!0})],I.prototype,"sourceMenuButtonId",null),e([u()],I.prototype,"activeMenu",void 0),e([u({readOnly:!0})],I.prototype,"activeSource",null),e([u()],I.prototype,"activeSourceIndex",null),e([u()],I.prototype,"allPlaceholder",null),e([u({readOnly:!0})],I.prototype,"allSources",null),e([u()],I.prototype,"autoNavigate",null),e([u()],I.prototype,"autoSelect",null),e([u({readOnly:!0})],I.prototype,"defaultSources",null),e([u()],I.prototype,"disabled",void 0),e([u()],I.prototype,"goToOverride",null),e([u()],I.prototype,"iconClass",void 0),e([u()],I.prototype,"includeDefaultSources",null),e([u()],I.prototype,"label",null),e([u()],I.prototype,"locationEnabled",null),e([u()],I.prototype,"maxResults",null),e([u()],I.prototype,"maxSuggestions",null),e([u(),v("esri/widgets/Search/t9n/Search")],I.prototype,"messages",void 0),e([u(),v("esri/t9n/common")],I.prototype,"messagesCommon",void 0),e([u()],I.prototype,"minSuggestCharacters",null),e([u()],I.prototype,"popupEnabled",null),e([u()],I.prototype,"popupTemplate",null),e([u()],I.prototype,"portal",null),e([u()],I.prototype,"resultGraphic",null),e([u()],I.prototype,"resultGraphicEnabled",null),e([u({readOnly:!0})],I.prototype,"results",null),e([u()],I.prototype,"searchAllEnabled",null),e([u()],I.prototype,"searchTerm",null),e([u({readOnly:!0})],I.prototype,"selectedResult",null),e([u()],I.prototype,"sources",null),e([u({readOnly:!0})],I.prototype,"suggestions",null),e([u()],I.prototype,"suggestionsEnabled",null),e([u()],I.prototype,"view",null),e([y(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),u({type:d})],I.prototype,"viewModel",void 0),I=e([c("esri.widgets.Search")],I);const w=I;export{w as default};
