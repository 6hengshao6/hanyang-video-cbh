/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{f as s}from"../core/promiseUtils.js";import{HandleOwnerMixin as o}from"../core/HandleOwner.js";import{L as i}from"../chunks/Logger.js";import{i as r}from"../chunks/maybe.js";import{on as l,watch as n}from"../core/reactiveUtils.js";import{property as m}from"../core/accessorSupport/decorators/property.js";import{cast as a}from"../core/accessorSupport/decorators/cast.js";import"../chunks/typedArrayUtil.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import c,{l as d}from"./Widget.js";import u from"./FeatureTable/FeatureTableViewModel.js";import h from"./FeatureTable/Grid/support/ButtonMenu.js";import g from"./FeatureTable/Grid/support/ButtonMenuItem.js";import{H as b}from"../chunks/Heading.js";import"../chunks/widgetUtils.js";import{m as j}from"../chunks/messageBundle.js";import{t as y}from"../chunks/jsxFactory.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/locale.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/ensureType.js";import"../chunks/WatchUpdatingTracking.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/layerViewUtils.js";import"./FeatureTable/Grid/Column.js";import"./FeatureTable/FieldColumn.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../chunks/editableLayers.js";import"../chunks/layerUtils.js";import"./FeatureForm/InputField.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./FeatureTable/Grid/EditorColumn.js";import"../chunks/uriUtils.js";import"./support/DatePicker.js";import"./support/DatePickerViewModel.js";import"./support/DateTimeElementViewModel.js";import"../chunks/Popover.js";import"../chunks/accessibleHandler.js";import"../chunks/datetime.js";import"./support/TimePicker.js";import"./support/TimePickerViewModel.js";import"./FeatureTable/Grid/GroupColumn.js";import"../rest/support/AttachmentQuery.js";import"./FeatureTable/Grid/support/ButtonMenuViewModel.js";const v={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0,selectedRecordsShowAllToggle:!0,selectedRecordsShowSelectedToggle:!0,zoomToSelection:!0,deleteSelection:!0},selectionColumn:!0,columnMenus:!0},w="esri-feature-table",M=`${w}__prompt`,k={base:w,header:`${w}__header`,title:`${w}__title`,content:`${w}__content`,loader:`${w}__loader`,loaderContainer:`${w}__loader-container`,menuContainer:`${w}__menu`,menuIcon:"esri-icon-handle-horizontal",menuItemGroupOpenedIcon:"esri-icon-down",menuItemGroupClosedIcon:"esri-icon-right",checkmarkIcon:"esri-icon-check-mark",promptContainer:M,promptHeader:`${M}__header`,promptHeading:`${M}__header__heading`,promptMessage:`${M}__message`,promptDivider:`${M}__divider`,promptActions:`${M}__actions`,widget:"esri-widget"},S=i.getLogger("esri.widgets.FeatureTable");let f=class extends(o(c)){constructor(e,t){super(e,t),this._prompt=null,this.menu=null,this.menuConfig=null,this.viewModel=new u,this.visibleElements={...v},this._showDeletePrompt=this._showDeletePrompt.bind(this),this._onDeleteSelectionClick=this._onDeleteSelectionClick.bind(this)}initialize(){this.handles.add([l((()=>this.viewModel.columns),"change",(()=>this._syncMenuConfig())),l((()=>this.viewModel.activeFilters),"change",(()=>this._syncMenuConfig())),l((()=>this.highlightIds),"change",(e=>{this._syncMenuConfig(),this._onSelectionChange(e)})),n((()=>[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled]),(()=>this.scheduleRender())),n((()=>[this.menuConfig,this.editingEnabled]),(()=>this._syncMenuConfig())),n((()=>this.messages),(()=>{this.menu&&(this.menu.label=this.messages?.options),this._syncMenuConfig()}))]),this._set("menu",new h({label:this.messages?.options,iconClass:k.menuIcon,...this.menuConfig}));const{attachmentsEnabled:e,relatedRecordsEnabled:t}=this;this.viewModel?.store?.set({attachmentsEnabled:e,relatedRecordsEnabled:t})}loadDependencies(){return d({button:()=>import("../chunks/calcite-button.js"),icon:()=>import("../chunks/calcite-icon.js"),scrim:()=>import("../chunks/calcite-scrim.js")})}destroy(){this._prompt=null,this.handles.removeAll(),this.menu?.destroy()}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(e){this.viewModel.attachmentsEnabled=e}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(e){this.viewModel.autoRefreshEnabled=e}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(e){this.viewModel.columnReorderingEnabled=e}get columns(){return this.viewModel.columns}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(e){this.viewModel.editingEnabled=e}get fieldConfigs(){return this.viewModel.fieldConfigs??[]}set fieldConfigs(e){this.viewModel.fieldConfigs=e}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(e){this.viewModel.filterGeometry=e}get grid(){return this.viewModel.grid}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(e){this.viewModel.hiddenFields=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(e){this.viewModel.highlightIds=e}get highlightOnRowSelectEnabled(){return this.viewModel.highlightEnabled}set highlightOnRowSelectEnabled(e){this.viewModel.highlightEnabled=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get messages(){return this.viewModel.messages}set messages(e){this.viewModel.messages=e}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(e){this.viewModel.messagesCommon=e}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(e){this.viewModel.messagesURIUtils=e}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(e){this.viewModel.multiSortEnabled=e}get pageSize(){return this.viewModel.pageSize}set pageSize(e){this.viewModel.pageSize=e}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(e){this.viewModel.relatedRecordsEnabled=e}get state(){return this.viewModel.state}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(e){this.viewModel.tableTemplate=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){const t={...v,...e};return this.grid?.set("visibleElements",{...this.grid.visibleElements,selectionColumn:t.selectionColumn,columnMenus:t.columnMenus}),t}clearHighlights(){return s(S,"`FeatureTable.clearHighlights` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"}),this.viewModel.clearHighlights()}clearSelection(){return s(S,"`FeatureTable.clearSelection` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"}),this.viewModel.clearSelection()}clearSelectionFilter(){return this.viewModel.clearSelectionFilter()}deleteSelection(e){return this.highlightIds.length?e?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()}deselectRows(e){return this.viewModel.deselectRows(e)}filterBySelection(){return this.viewModel.filterBySelection()}findColumn(e){return this.viewModel.findColumn(e)}hideColumn(e){this.grid?.hideColumn(e),this._syncMenuConfig()}refresh(){return this.viewModel.refresh()}showAllColumns(){return this.viewModel.showAllColumns()}showColumn(e){this.grid?.showColumn(e),this._syncMenuConfig()}sortColumn(e,t){return this.viewModel.sortColumn(e,t)}selectRows(e){return this.viewModel.selectRows(e)}scrollToIndex(e){return this.viewModel.scrollToIndex(e)}zoomToSelection(){return this.viewModel.zoomToSelection()}render(){const{_prompt:e}=this,t=r(e)?y("calcite-scrim",null,this.renderPrompt(e)):null;return y("div",{bind:this,class:this.classes(k.base,k.widget)},this.visibleElements.header?this._renderHeader():null,y("div",{class:k.content},"disabled"!==this.state&&this.grid?.render()),t)}renderPrompt({title:e,message:t,context:s,actions:o}){const i=y("calcite-button",{appearance:"solid",kind:"danger"===s?"danger":"brand",width:o.secondary?"half":"full",onclick:o.primary.action,key:"prompt-primary-button"},o.primary.label),r=o.secondary?y("calcite-button",{appearance:"outline",kind:"danger"===s?"danger":"brand",width:"half",onclick:o.secondary.action,key:"prompt-secondary-button"},o.secondary.label):null;return y("div",{class:`${k.promptContainer}--${s}`},y("div",{class:k.promptHeader},y("calcite-icon",{icon:"exclamation-mark-triangle"}),y(b,{class:k.promptHeading,level:2},e)),y("div",{class:k.promptMessage},t),y("div",{class:k.promptDivider}),y("div",{class:k.promptActions},r,i))}_renderHeader(){return y("div",{key:"header",class:k.header},this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)}_renderTitle(){return y("div",{class:k.title,key:"title"},this._getTitle())}_getTitle(){const{grid:e,highlightIds:s,layer:o,messages:i,viewModel:{size:r}}=this;return e&&o?t(i.header,{title:o.title,count:r,selected:s.length||0}):""}_renderLoader(){const{state:e,store:t}=this.viewModel,s="loading"===e||t.syncing||t.querying;return y("div",{class:k.loaderContainer},s?y("div",{class:k.loader,key:"loader"}):null)}_renderMenu(){return y("div",{class:k.menuContainer},this.menu?.render())}_onSelectionChange(e){const{added:t,removed:s}=e,o=t.map((e=>this.viewModel.store.getLocalItemByKey(e)||{objectId:e,feature:null,attachments:null,relatedRecords:null})),i=s.map((e=>this.viewModel.store.getLocalItemByKey(e)||{objectId:e,feature:null,attachments:null,relatedRecords:null}));this.emit("selection-change",{added:o,removed:i})}_syncMenuConfig(){this.menu?.set({...this.menuConfig,items:this._getMenuItems()})}_getMenuItems(){const e=this.menuConfig?.items,t=this._getDefaultMenuItems(),s=[];return t?.length&&s.push(...t),e?.length&&s.push(...e),s}_getDefaultMenuItems(){const{highlightIds:e,messages:t,viewModel:s,visibleElements:o}=this,{menuItems:i}=o,r=[];if(i?.refreshData&&r.push(new g({selectionEnabled:!1,label:t?.refreshData,clickFunction:()=>this.refresh()})),e.length){const s=this._getSelectionFilter();if(i?.clearSelection&&r.push(new g({selectionEnabled:!1,label:t?.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()})),i?.zoomToSelection&&this.view&&r.push(new g({selectionEnabled:!1,label:t?.zoomToSelection,clickFunction:()=>this.viewModel.zoomToSelection()})),i?.selectedRecordsShowSelectedToggle&&(!s||e.length!==s.objectIds.length)){const e=t.showSelected,s=new g({selectionEnabled:!1,label:e,clickFunction:()=>{this.filterBySelection(),s.set("label",e)}});r.push(s)}i?.deleteSelection&&this.editingEnabled&&this.layer?.capabilities?.operations?.supportsDelete&&r.push(new g({selectionEnabled:!1,label:t.deleteSelection,clickFunction:this._showDeletePrompt}))}if(i?.selectedRecordsShowAllToggle&&this._hasSelectionFilter()){const e=t.showAllRecords,s=new g({selectionEnabled:!1,label:e,clickFunction:()=>{this.clearSelectionFilter(),s.set("label",e)}});r.push(s)}return i?.toggleColumns&&r.push(new g({iconClass:k.menuItemGroupClosedIcon,label:t?.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:s?.columns?.items.map((({header:e,hidden:t,path:s})=>new g({label:e||s,selected:!t,selectionEnabled:!0,iconClass:k.checkmarkIcon,clickFunction:()=>this._toggleColumnFromMenuItem(s)})))})),r.length?r:null}_toggleMenuItemSelectedIcon({item:e}){e?.set("iconClass",e?.selected?k.menuItemGroupOpenedIcon:k.menuItemGroupClosedIcon)}_toggleColumnFromMenuItem(e){const{grid:t,viewModel:s}=this,o=s.findColumn(e);o?.hidden?t?.showColumn(e):t?.hideColumn(e)}_showDeletePrompt(){const{messages:e,messagesCommon:s}=this,o=this.highlightIds.length||0,i=t(e.deleteSelectionCount,{count:o});this.menu&&(this.menu.open=!1),this._prompt={title:i,message:e.deleteRecordsRemoved,context:"danger",actions:{primary:{label:s.delete,action:this._onDeleteSelectionClick},secondary:{label:e.keepRecords,action:()=>this._prompt=null}}}}async _onDeleteSelectionClick(){await this.viewModel.deleteSelection(),this._prompt=null}_getSelectionFilter(){return this.viewModel.activeFilters?.find((e=>"selection"===e.type))}_hasSelectionFilter(){return!!this._getSelectionFilter()}};e([m({readOnly:!0})],f.prototype,"activeFilters",null),e([m({readOnly:!0})],f.prototype,"activeSortOrders",null),e([m()],f.prototype,"attachmentsEnabled",null),e([m()],f.prototype,"autoRefreshEnabled",null),e([m()],f.prototype,"columnReorderingEnabled",null),e([m({readOnly:!0})],f.prototype,"columns",null),e([m()],f.prototype,"editingEnabled",null),e([m()],f.prototype,"fieldConfigs",null),e([m()],f.prototype,"filterGeometry",null),e([m({readOnly:!0})],f.prototype,"grid",null),e([m()],f.prototype,"hiddenFields",null),e([m()],f.prototype,"highlightEnabled",null),e([m()],f.prototype,"highlightIds",null),e([m()],f.prototype,"highlightOnRowSelectEnabled",null),e([m()],f.prototype,"label",null),e([m()],f.prototype,"layer",null),e([m(),j("esri/widgets/FeatureTable/t9n/FeatureTable")],f.prototype,"messages",null),e([m(),j("esri/t9n/common")],f.prototype,"messagesCommon",null),e([m(),j("esri/widgets/support/t9n/uriUtils")],f.prototype,"messagesURIUtils",null),e([m({readOnly:!0})],f.prototype,"menu",void 0),e([m()],f.prototype,"menuConfig",void 0),e([m()],f.prototype,"multiSortEnabled",null),e([m()],f.prototype,"pageSize",null),e([m()],f.prototype,"relatedRecordsEnabled",null),e([m({readOnly:!0})],f.prototype,"state",null),e([m()],f.prototype,"tableTemplate",null),e([m()],f.prototype,"timeExtent",null),e([m()],f.prototype,"view",null),e([m()],f.prototype,"viewModel",void 0),e([m()],f.prototype,"visibleElements",void 0),e([a("visibleElements")],f.prototype,"castVisibleElements",null),f=e([p("esri.widgets.FeatureTable")],f);const C=f;export{C as default};
