/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{cast as t}from"../core/accessorSupport/decorators/cast.js";import"../chunks/typedArrayUtil.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import o from"./Widget.js";import r,{L as l}from"./BuildingExplorer/BuildingExplorerViewModel.js";import{e as n,a,i as p,u as h}from"../chunks/maybe.js";import"../chunks/ensureType.js";import{on as m,watch as c,initial as u}from"../core/reactiveUtils.js";import{i as d,s as g,c as v}from"../chunks/widgetUtils.js";import{t as j}from"../chunks/jsxFactory.js";import{o as y}from"../core/promiseUtils.js";import _ from"../core/Handles.js";import{c as b}from"../chunks/mathUtils.js";import{H as k}from"../chunks/Heading.js";import{m as L}from"../chunks/messageBundle.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/string.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../chunks/tracking.js";import"../intl.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Accessor.js";import"../chunks/ArrayPool.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/collectionUtils.js";import"../layers/BuildingSceneLayer.js";import"../chunks/CollectionFlattener.js";import"../chunks/loadAll.js";import"../chunks/asyncUtils.js";import"../core/Loadable.js";import"../chunks/MultiOriginJSONSupport.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/writer.js";import"../layers/Layer.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../core/Identifiable.js";import"../layers/buildingSublayers/BuildingComponentSublayer.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../portal/Portal.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../chunks/layerUtils.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../renderers/support/jsonUtils.js";import"../layers/FeatureLayer.js";import"../core/sql.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/CustomParametersMixin.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../rest/support/StatisticDefinition.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties2.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/TimeReference.js";import"../chunks/datetime.js";import"../chunks/featureLayerUtils.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/RelationshipQuery.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/mixins/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/portalItemUtils.js";import"../geometry/projection.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../chunks/labelingInfo.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../support/popupUtils.js";import"../layers/buildingSublayers/BuildingSublayer.js";import"../chunks/capabilities.js";import"../chunks/I3SIndexInfo.js";import"../chunks/I3SLayerDefinitions.js";import"../chunks/I3SUtil.js";import"../chunks/mat3.js";import"../chunks/mat3f64.js";import"../chunks/mat4f64.js";import"../chunks/quat.js";import"../chunks/quatf32.js";import"../chunks/spatialReferenceEllipsoidUtils.js";import"../chunks/I3SBinaryReader.js";import"../chunks/VertexAttribute.js";import"../chunks/edgeUtils.js";import"../chunks/symbolColorUtils.js";import"../chunks/orientedBoundingBox.js";import"../chunks/quatf64.js";import"../chunks/vec3f32.js";import"../chunks/plane.js";import"../chunks/vector.js";import"../chunks/ray.js";import"../chunks/byteSizeEstimations.js";import"../chunks/vec2f64.js";import"../chunks/mathUtils2.js";import"../chunks/ViewingMode.js";import"../chunks/Attribute.js";import"../chunks/popupUtils.js";import"../layers/buildingSublayers/BuildingGroupSublayer.js";import"../layers/mixins/SceneService.js";import"../chunks/originUtils.js";import"../chunks/multiOriginJSONSupportUtils.js";import"../chunks/saveUtils.js";import"../chunks/resourceUtils.js";import"../layers/support/BuildingFilter.js";import"../chunks/BuildingFilterBlock.js";import"../layers/support/BuildingSummaryStatistics.js";import"../chunks/FetchAssociatedFeatureLayer.js";import"../chunks/filterUtils.js";import"./BuildingExplorer/BuildingNumericFilterViewModel.js";import"./BuildingExplorer/BuildingLevel.js";import"./BuildingExplorer/BuildingPhase.js";const f="esri-building-explorer",C={esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",esriIconLoadingIndicator:"esri-icon-loading-indicator",esriRotating:"esri-rotating",widgetIcon:"esri-icon-organization",base:`${f} esri-widget--panel`,panelError:`${f}__panel--error`,loadingContainer:`${f}__loading-container`,content:`${f}__content`,section:`${f}__section`,levels:`${f}__levels`,phases:`${f}__phases`,disciplines:`${f}__disciplines`};var S;const w={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},P="esri-building-disciplines-tree-node",x={base:`${P}`,root:`${P}--root`,leaf:`${P}--leaf`,label:`${P}__label`,checkbox:`${P}__checkbox`,checkboxChecked:`${P}__checkbox--checked esri-icon-check-mark`,checkboxIndeterminate:`${P}__checkbox--indeterminate esri-icon-minus`,collapseToggle:`${P}__collapse-toggle esri-icon-right`,collapseToggleCollapsed:`${P}__collapse-toggle--collapsed`,children:`${P}__children`,level:e=>`${P}--level-${e}`};let E=S=class extends o{constructor(e){super(e),this.messages=w,this.toggleSiblingsVisibility=!1,this._childWidgets=[],this._updateChildWidgets=()=>{this._destroyChildWidgets(),this._childWidgets=this.node.children.toArray().reverse().map((e=>new S({node:e,messages:this.messages,toggleSiblingsVisibility:this.toggleSiblingsVisibility})))}}initialize(){this.addHandles([m((()=>this.node.children),"after-changes",this._updateChildWidgets,{onListenerAdd:this._updateChildWidgets,onListenerRemove:this._updateChildWidgets}),c((()=>[this.messages,this.toggleSiblingsVisibility]),this._updateChildWidgets,u)])}destroy(){this._destroyChildWidgets()}render(){const e=this.node,s=e.isRoot,t=e.isLeaf;return e.isDiscipline&&t?j("div",{key:`${e.id}-empty`}):j("div",{key:e.id,class:this.classes(x.base,x.level(e.level),{[x.root]:s,[x.leaf]:t}),bind:this,onkeydown:this._onKeydown,tabIndex:t?void 0:0,role:"treeitem","aria-expanded":e.collapsed?"false":"true"},j("label",{bind:this,class:x.label,onclick:this._onCheckboxToggle},this._renderCollapseToggle(),this._renderCheckbox(),j("span",null,e.title)),this._renderChildren(e))}_renderCheckbox(){const e=this.node.visible,s=!0===e,t=null===e,i=s?this.messages?.hideSublayer:this.messages?.showSublayer;return j("button",{bind:this,class:this.classes(x.checkbox,{[x.checkboxChecked]:s,[x.checkboxIndeterminate]:t}),onclick:this._onCheckboxToggle,role:"checkbox","aria-checked":s?"true":"false","aria-label":i,title:i,type:"button"})}_renderCollapseToggle(){if(!this.node.hasChildren)return null;const e=this.node.collapsed,s=e?this.messages?.expand:this.messages?.collapse;return j("div",{bind:this,class:this.classes(x.collapseToggle,{[x.collapseToggleCollapsed]:e}),onclick:this._onCollapseToggle,"aria-label":s,title:s})}_renderChildren(e){return!e.hasChildren||e.collapsed?null:j("div",{class:x.children},this._childWidgets.map((e=>e.render())))}_onKeydown(e){switch(e.key){case"Space":case"Enter":if(!e.target.classList.contains(x.base))return;e.stopPropagation(),this.node.toggleVisibility();break;case"ArrowLeft":e.stopPropagation(),this.node.toggleCollapsed(!d(this.container));break;case"ArrowRight":e.stopPropagation(),this.node.toggleCollapsed(d(this.container))}}_onCheckboxToggle(e){e.preventDefault(),e.stopPropagation(),(e.metaKey||e.ctrlKey)&&this.toggleSiblingsVisibility?this.node.toggleAllSiblingsVisibility():this.node.toggleVisibility()}_onCollapseToggle(e){e.preventDefault(),e.stopPropagation(),this.node.toggleCollapsed()}_destroyChildWidgets(){this._childWidgets.forEach((e=>e.destroy())),this._childWidgets=[]}};e([s({type:l})],E.prototype,"node",void 0),e([s()],E.prototype,"messages",void 0),e([s({nonNullable:!0})],E.prototype,"toggleSiblingsVisibility",void 0),e([s()],E.prototype,"_childWidgets",void 0),E=S=e([i("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesNode")],E);const I=E,D={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"};let V=class extends o{constructor(e){super(e),this.toggleSiblingsVisibility=!1}render(){const{vm:e}=this,s=this.toggleSiblingsVisibility,t=n(this.messages,D);return j("div",{role:"tree",class:"esri-building-disciplines-tree"},e.root.children.toArray().reverse().map((e=>j(I,{node:e,messages:t,toggleSiblingsVisibility:s}))))}};e([s()],V.prototype,"vm",void 0),e([s()],V.prototype,"messages",void 0),e([s()],V.prototype,"toggleSiblingsVisibility",void 0),V=e([i("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesTree")],V);const U=V,M=Object.freeze(Object.defineProperty({__proto__:null,ALPHA_LEVEL_DEPENDENCY_FACTOR:30,ALPHA_SPREAD_FACTOR:10,LEVELS_MARGIN_FACTOR:2,LEVELS_PADDING:20,LEVELS_POINTER_ADJUSTMENT:.035,LEVEL_HEIGHT_DEFAULT:14,LEVEL_HOVERED_EXTRA_HEIGHT:30,LEVEL_HOVERED_EXTRA_WIDTH:20,LEVEL_WIDTH_CONSTANT:40,LEVEL_WIDTH_MAX:80,LEVEL_WIDTH_MIN:30,LEVEL_WIDTH_NOMINATOR:100},Symbol.toStringTag,{value:"Module"})),T="esri-building-level-picker",A={container:T,noLevel:`${T}--no-level`,animateLevel:`${T}--animate-level`,levelsContainer:`${T}__levels-container`,innerLevelsContainer:`${T}__inner-levels-container`,labelContainer:`${T}__label-container`,arrowUp:`${T}__arrow-up`,arrowDown:`${T}__arrow-down`},B="esri-building-level-picker-label",F={iconClose:"esri-icon-close",base:`${B}`,active:`${B}--active`,hover:`${B}--hover`,empty:`${B}--empty`,clearButton:`${B}__clear-button`},R={clearLevel:"",selectLevel:""};let W=class extends o{constructor(e,s){super(e,s),this.level=null,this.active=!1,this.hovering=!1,this.onClear=()=>{}}render(){const e=n(this.messages,R);if(a(this.level))return j("div",{class:F.empty,title:e.selectLevel},e.selectLevel);const s=e.clearLevel;return j("div",{bind:this,class:this.classes(F.base,{[F.active]:this.active,[F.hover]:this.hovering}),onclick:this.onClear,title:s,"aria-label":s},j("span",null,this.level),j("button",{bind:this,class:this.classes(F.clearButton,F.iconClose),disabled:!this.active,onclick:this.onClear,type:"button"}))}};e([s()],W.prototype,"level",void 0),e([s({nonNullable:!0})],W.prototype,"active",void 0),e([s({nonNullable:!0})],W.prototype,"hovering",void 0),e([s()],W.prototype,"messages",void 0),e([s({nonNullable:!0})],W.prototype,"onClear",void 0),W=e([i("esri.widgets.BuildingExplorer.BuildingLevelPicker.Label")],W);const $="esri-building-level-picker-item",H={container:$,base:`${$}__base`,hover:`${$}--hover`,active:`${$}--active`};let O=class extends o{constructor(e,s){super(e,s),this.active=!1,this.hovering=!1,this.width=0,this.height=0,this.onSelect=()=>{},this.onFocus=()=>{},this.onBlur=()=>{},this._baseElement=null}render(){return j("div",{key:this,bind:this,class:this.classes(H.container,{[H.active]:this.active,[H.hover]:this.hovering}),styles:{height:`${this.height}px`}},this._renderBase())}focus(){a(this._baseElement)||this._baseElement.focus()}_renderBase(){const e=this.width,s=.8*this.width;return j("div",{class:H.base,styles:{width:`${Math.round(e)}px`,height:`${Math.round(e)}px`}},j("button",{bind:this,class:"rect",styles:{width:`${Math.round(s)}px`,height:`${Math.round(s)}px`},onclick:this.onSelect,onfocus:this.onFocus,onblur:this.onBlur,afterCreate:g,"data-node-ref":"_baseElement","aria-label":this.label,title:this.label??"",tabIndex:-1,type:"button"}))}};e([s({nonNullable:!0})],O.prototype,"level",void 0),e([s({nonNullable:!0})],O.prototype,"active",void 0),e([s({nonNullable:!0})],O.prototype,"hovering",void 0),e([s({nonNullable:!0})],O.prototype,"width",void 0),e([s({nonNullable:!0})],O.prototype,"height",void 0),e([s({nonNullable:!0})],O.prototype,"onSelect",void 0),e([s({nonNullable:!0})],O.prototype,"onFocus",void 0),e([s({nonNullable:!0})],O.prototype,"onBlur",void 0),O=e([i("esri.widgets.BuildingExplorer.BuildingLevelPicker.LevelItem")],O);const N={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};let z=class extends o{constructor(e,s){super(e,s),this._levelHandles=new _,this._levelEventHandles=new _,this._levelWidgets=[],this._labelWidget=new W({onClear:()=>this.vm.clear()}),this._hoveredLevel=null,this._expandedLevelsHeight=void 0,this._normalizedPointerPosition=0,this._hovering=!1,this._containerPosTop=null,this._levelsContainer=null,this._onPointerUp=()=>{if(window.getSelection()?.removeAllRanges(),a(this._hoveredLevel))return;const{vm:e}=this;e.enabled&&this._hoveredLevel===e.value?e.clear():e.select(this._hoveredLevel)},this._onPointerEnter=()=>{this._hovering||a(this._levelsContainer)||(this._hovering=!0,this._containerPosTop=this._levelsContainer.getBoundingClientRect().top??0)},this._onPointerLeave=()=>{this._hovering&&(this._normalizedPointerPosition=0,this._hoveredLevel=null,this._hovering=!1)},this._onPointerMove=e=>{if(!this._hovering)return!1;if(window.getSelection()?.removeAllRanges(),p(this._containerPosTop)){const s=this._containerPosTop,t=40,i=this._expandedLevelsMargin;let o=this._levelsHeight,r=s+t+i;const l=this._levelHeight/2;r+=l,o-=l;let n=(e.clientY-r)/o;n+=.035,this._normalizedPointerPosition=n}return!1}}postInitialize(){this.addHandles([c((()=>this._levelsContainer),(()=>this._onContainerChange()),u),c((()=>this._levels),(()=>this._createLevelWidgets()),u),c((()=>this.messages),(()=>{this._labelWidget.messages=n(this.messages,N)}),u)])}destroy(){this._levelHandles.destroy(),this._levelEventHandles.destroy(),this._levelWidgets.forEach((e=>e.destroy())),this._labelWidget.destroy()}get _levels(){return this.vm.allowedValues}get _numLevels(){return this._levels.length}get _levelsHeight(){return Math.round(this._levelHeight*this._numLevels)}get _expandedLevelsMargin(){return Math.round(((this._expandedLevelsHeight??0)-this._levelsHeight)/2)}get _levelWidth(){const{LEVEL_WIDTH_NOMINATOR:e,LEVEL_WIDTH_CONSTANT:s}=M,t=e/Math.sqrt(this._numLevels)+s;return Math.round(b(t,30,80))}get _levelHeight(){const e=28/Math.sqrt(this._numLevels);return Math.round(b(e,2,14))}get _gaussianFactor(){const e=this._numLevels;return e/Math.log(30*e)*10}get _levelClosestToPointer(){if(!this._hovering)return null;const e=this._numLevels-1,s=this._normalizedPointerPosition;return e>=0&&p(s)?this._levels[Math.round((1-s)*e)]:null}render(){const e=this._levelWidgets.length,s=e>1?this._levelWidgets.map((e=>e.render())):null,t=this._levelsHeight,i=t+80;return j("div",{bind:this,key:this,class:this.classes("esri-widget",A.container,{[A.animateLevel]:!this._hovering,[A.noLevel]:e<2}),onkeydown:this._onKeyDown},this._renderLabelContainer(),j("div",{bind:this,class:A.levelsContainer,styles:{height:`${i}px`,marginTop:"-20px",marginBottom:"-20px"},onfocus:this._onFocus,afterCreate:g,"data-node-ref":"_levelsContainer"},j("div",{styles:{height:`${t}px`,margin:20-this._expandedLevelsMargin+"px 0 0 0"},class:A.innerLevelsContainer},s)))}_renderLabelContainer(){const e=n(this.messages,N),s=e.previousLevel,t=e.nextLevel;return j("div",{class:A.labelContainer,tabIndex:0},j("button",{bind:this,class:A.arrowUp,disabled:!this.vm.hasNext,onclick:this._onArrowUpClick,"aria-label":t,title:t,type:"button"}),this._labelWidget.render(),j("button",{bind:this,class:A.arrowDown,disabled:!this.vm.hasPrevious,onclick:this._onArrowDownClick,"aria-label":s,title:s,type:"button"}))}_updateComponents(){const e=n(this.messages,N),s=this.vm.enabled?this.vm.value:null,t=p(this._hoveredLevel)?this._hoveredLevel:s;this._levelWidgets.forEach((t=>{const i=this.vm.getValueLabel(t.level);t.label=p(i)?i:e.currentLevel?.replace("{{level}}",String(t.level)),t.active=t.level===s,t.hovering=t.level===this._hoveredLevel})),this._labelWidget.level=t,this._labelWidget.active=t===s,this._labelWidget.hovering=p(this._hoveredLevel)}_createLevelWidgets(){this._levelWidgets.forEach((e=>e.destroy())),this._levelWidgets=this._levels.map((e=>new O({level:e,onSelect:()=>this._onLevelToggle(e)}))),this._levelHandles.removeAll(),this._levelHandles.add([c((()=>{const{vm:e}=this;return[this.messages,e?.value,e?.enabled,this._hoveredLevel,this._hovering]}),(()=>this._updateComponents()),u),c((()=>[this._normalizedPointerPosition,this._hovering]),(()=>this._onPointerPositionChange()),u),c((()=>this._levelWidth),(e=>this._levelWidgets.forEach((s=>s.width=e))),u)])}_onContainerChange(){const e=this._levelsContainer;a(e)||(this._levelEventHandles.removeAll(),this._levelEventHandles.add([y(e,"pointerenter",this._onPointerEnter),y(e,"pointerover",this._onPointerEnter),y(e,"pointerleave",this._onPointerLeave),y(e,"pointerup",this._onPointerUp),y(e,"pointermove",this._onPointerMove)]))}_onKeyDown(e){switch(e.key){case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),this.vm.previous(),this._focusCurrentLevel();break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),this.vm.next(),this._focusCurrentLevel()}}_focusCurrentLevel(){const e=this._levelWidgets.find((e=>e.level===this.vm.value));e&&e.focus()}_onFocus(){this._hoveredLevel=this._levels.length>0?this._levels[0]:null}_onLevelToggle(e){const{vm:s}=this;s.enabled&&s.value===e?s.clear():s.select(e)}_onArrowUpClick(){this.vm.next()}_onArrowDownClick(){this.vm.previous()}_onPointerPositionChange(){let e=0;this._levelWidgets.forEach(((s,t)=>{const{width:i,height:o}=this._getLevelWidgetSize(t);s.height=o,s.width=i,e+=o})),this._hoveredLevel=this._levelClosestToPointer;const s=this._expandedLevelsHeight;(null==s||Math.abs(s-e)>30)&&(this._expandedLevelsHeight=e)}_getLevelWidgetSize(e){const s={width:this._levelWidth,height:this._levelHeight};if(this._hovering){const t=this._getGaussianFactor(e,this._normalizedPointerPosition);s.width+=20*t,s.height+=30*t}return s}_getGaussianFactor(e,s){const t=this._numLevels-1,i=(t-e)/t,o=this._gaussianFactor*(i-s);return Math.exp(-(o**2))}};e([s()],z.prototype,"vm",void 0),e([s()],z.prototype,"messages",void 0),e([s()],z.prototype,"_levelWidgets",void 0),e([s()],z.prototype,"_labelWidget",void 0),e([s()],z.prototype,"_hoveredLevel",void 0),e([s()],z.prototype,"_levels",null),e([s()],z.prototype,"_numLevels",null),e([s({readOnly:!0})],z.prototype,"_levelsHeight",null),e([s()],z.prototype,"_expandedLevelsHeight",void 0),e([s({readOnly:!0})],z.prototype,"_expandedLevelsMargin",null),e([s({readOnly:!0})],z.prototype,"_levelWidth",null),e([s({readOnly:!0})],z.prototype,"_levelHeight",null),e([s({readOnly:!0})],z.prototype,"_gaussianFactor",null),e([s({readOnly:!0})],z.prototype,"_levelClosestToPointer",null),e([s({type:Number,range:{min:0,max:1}})],z.prototype,"_normalizedPointerPosition",void 0),e([s()],z.prototype,"_hovering",void 0),e([s()],z.prototype,"_containerPosTop",void 0),e([s()],z.prototype,"_levelsContainer",void 0),z=e([i("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],z);const q=z,G={nextPhase:"nextPhase",previousPhase:"previousPhase",currentPhase:"{{value}}"},K="esri-building-phase-picker",Q={container:`${K}`,phasesContainer:`${K}__phases-container`,phase:`${K}__phase`,phaseActive:`${K}__phase--active`,phaseCurrent:`${K}__phase--current`,divider:`${K}__divider`,dividerActive:`${K}__divider--active`,arrowLeft:`${K}__arrow-left`,arrowRight:`${K}__arrow-right`};let J=class extends o{constructor(e,s){super(e,s),this._phasesContainer=null,this._shouldScrollCurrentPhaseIntoView=!0,this._shouldFocusCurrentPhase=!1,this._onKeyDown=e=>{const{vm:s}=this;switch(e.key){case"ArrowDown":case"ArrowLeft":e.stopPropagation(),e.preventDefault(),s.previous(),this._shouldFocusCurrentPhase=!0;break;case"ArrowUp":case"ArrowRight":e.stopPropagation(),e.preventDefault(),s.next(),this._shouldFocusCurrentPhase=!0}},this._onArrowLeftClick=()=>{this.vm.previous()},this._onArrowRightClick=()=>{this.vm.next()},this._onPhasesContainerAfterCreate=e=>{this._phasesContainer=e,requestAnimationFrame(this._scrollOrFocusPhase)},this._scrollOrFocusPhase=()=>{const e=this._phasesContainer;if(this.destroyed||a(e))return;const s=e.querySelector(`.${Q.phaseCurrent}`);if(s){if(this._shouldScrollCurrentPhaseIntoView){const t=e.offsetWidth,i=s.offsetLeft,o=s.offsetWidth;e.scrollLeft=-t/2+i-o/2,this._shouldScrollCurrentPhaseIntoView=!1}this._shouldFocusCurrentPhase&&(s.focus(),this._shouldFocusCurrentPhase=!1)}}}initialize(){this.addHandles(c((()=>[this._currentPhase,this._phasesContainer,this.container]),(()=>{this._shouldScrollCurrentPhaseIntoView=!0,requestAnimationFrame(this._scrollOrFocusPhase)}),u))}get _phases(){return this.vm.allowedValues}get _currentPhase(){const{vm:e}=this;return e.enabled?e.value:null}render(){if(this._phases.length<2)return j("div",{key:"no-phases"});const{vm:e,container:s,messages:t}=this,{previousPhase:i,nextPhase:o}=n(t,G),r=d(s);return j("div",{class:this.classes("esri-widget",Q.container),key:this,onkeydown:this._onKeyDown},j("button",{type:"button",class:r?Q.arrowRight:Q.arrowLeft,disabled:!e.hasPrevious,"aria-label":i,title:i,onclick:this._onArrowLeftClick}),j("div",{class:Q.phasesContainer,afterCreate:this._onPhasesContainerAfterCreate},this._renderPhaseButtons()),j("button",{type:"button",class:r?Q.arrowLeft:Q.arrowRight,disabled:!e.hasNext,"aria-label":o,title:o,onclick:this._onArrowRightClick}))}_renderPhaseButtons(){const e=this._phases,s=this._currentPhase,t=[];for(let i=0;i<e.length;++i){const o=e[i],r={phase:o,active:!!p(s)&&o<=s,current:!!p(s)&&o===s};i>0&&t.push(this._renderDivider(r)),t.push(this._renderPhaseButton(r))}return t}_renderPhaseButton({phase:e,active:s,current:t}){const{vm:i}=this,o=h(i.getValueLabel(e));return j("button",{key:`phase-${e}`,class:this.classes(Q.phase,{[Q.phaseActive]:s,[Q.phaseCurrent]:t}),"aria-label":o,title:o,onclick:()=>i.select(e),type:"button"},e)}_renderDivider({phase:e,active:s}){return j("div",{key:`phase-divider-${e}`,class:this.classes(Q.divider,{[Q.dividerActive]:s})})}};e([s({nonNullable:!0})],J.prototype,"vm",void 0),e([s()],J.prototype,"messages",void 0),e([s()],J.prototype,"_phases",null),e([s()],J.prototype,"_currentPhase",null),e([s()],J.prototype,"_phasesContainer",void 0),J=e([i("esri.widgets.BuildingExplorer.BuildingPhasePicker.BuildingPhasePicker")],J);const X=J,Y={levels:!0,phases:!0,disciplines:!0};let Z=class extends o{constructor(e,s){super(e,s),this._defaultViewModel=new r,this.viewModel=this._defaultViewModel,this.visibleElements={...Y},this.headingLevel=3,this.iconClass=C.widgetIcon,this.messages=null,this.messagesCommon=null,this.toggleSiblingsVisibility=!1}destroy(){this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}_castVisibleElements(e){return{...Y,...e}}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}render(){const e=this.viewModel,s="disabled"===e.state||!e.isSupported;return j("div",{key:this,class:v(C.esriWidget,C.base,{[C.esriWidgetDisabled]:s}),"aria-label":this.messages.widgetLabel},this._renderContent())}_renderContent(){const e=this.viewModel,s=this.messages;if(!e.isSupported)return j("p",{class:C.panelError},s.unsupported);if(!e.layers.length)return j("p",{class:C.panelError},s.noData);switch(e.state){case"loading":return this._renderLoadingIndicator();case"ready":return j("div",{key:"content",class:C.content},this._renderLevelPickerSection(),this._renderPhasePickerSection(),this._renderDisciplinesSection());case"failed":return j("p",{class:C.panelError},s.failed);default:return null}}_renderLoadingIndicator(){const e=this.messagesCommon.loading;return j("div",{key:"loading-container",role:"presentation",class:C.loadingContainer,"aria-label":e,title:e},j("span",{"aria-hidden":"true",class:v(C.esriIconLoadingIndicator,C.esriRotating)}))}_renderLevelPickerSection(){const e=this.viewModel.level,s="ready"===e.state,t=e.allowedValues.length>1;if(!this.visibleElements.levels||!s||!t)return null;const i=this.messages?.level;return j("div",{key:"levels",class:v(C.section,C.levels)},j(k,{level:this.headingLevel},i?.title),j(q,{vm:e,messages:i}))}_renderPhasePickerSection(){const e=this.viewModel.phase,s="ready"===e.state,t=e.allowedValues.length>1;if(!this.visibleElements.phases||!s||!t)return null;const i=this.messages.phase;return j("div",{key:"phases",class:v(C.section,C.phases)},j(k,{level:this.headingLevel},i.title),j(X,{vm:e,messages:i}))}_renderDisciplinesSection(){const e=this.viewModel.disciplines,s="ready"===e.state,t=e.root.hasChildren;if(!this.visibleElements.disciplines||!s||!t)return null;const i=this.messages?.disciplines;return j("div",{key:"disciplines",class:v(C.section,C.disciplines)},j(k,{level:this.headingLevel},i.title),j(U,{vm:e,messages:i,toggleSiblingsVisibility:this.toggleSiblingsVisibility}))}};e([s({type:r})],Z.prototype,"viewModel",void 0),e([s()],Z.prototype,"view",null),e([s()],Z.prototype,"layers",null),e([s()],Z.prototype,"visibleElements",void 0),e([t("visibleElements")],Z.prototype,"_castVisibleElements",null),e([s()],Z.prototype,"headingLevel",void 0),e([s()],Z.prototype,"iconClass",void 0),e([s()],Z.prototype,"label",null),e([s(),L("esri/widgets/BuildingExplorer/t9n/BuildingExplorer")],Z.prototype,"messages",void 0),e([s(),L("esri/t9n/common")],Z.prototype,"messagesCommon",void 0),e([s({nonNullable:!0})],Z.prototype,"toggleSiblingsVisibility",void 0),e([s()],Z.prototype,"uiStrings",void 0),Z=e([i("esri.widgets.BuildingExplorer")],Z);const ee=Z;export{ee as default};
