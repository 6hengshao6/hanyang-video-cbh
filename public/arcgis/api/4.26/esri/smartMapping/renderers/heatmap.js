// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Error ../../core/maybe ../../renderers/support/AuthoringInfo ../../renderers/support/HeatmapColorStop ../../renderers/support/heatmapUtils ./support/utils ../statistics/heatmapStatistics ../support/utils ../support/adapters/support/layerUtils ../symbology/heatmap".split(" "),
function(k,l,T,U,V,F,W,X,Y,Z,aa,v,m,w,g,G,n,H,I,e,p){async function J(a){if(!(a&&a.layer&&a.view))throw new v("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");a={...a,layer:a.layer,view:a.view};a.radius??(a.radius=null==a.blurRadius?18:G.gaussianBlurRadiusPxToKernelDensityRadiusPt(a.blurRadius));a.minRatio??(a.minRatio=.01);a.maxRatio??(a.maxRatio=1);a.fadeRatio??(a.fadeRatio=.2);a.fadeToTransparent??(a.fadeToTransparent=!0);var b=[e.LayerType.CSVLayer,e.LayerType.FeatureLayer,
e.LayerType.OGCFeatureLayer,e.LayerType.GeoJSONLayer,e.LayerType.WFSLayer],c=e.createLayerAdapter(a.layer,b);if(!c)throw new v("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+e.getLayerTypeLabels(b).join(", "));a.layer=c;b=m.isSome(a.signal)?{signal:a.signal}:null;await c.load(b);b=await I.getFieldsList({field:a.field});if(c=n.verifyBasicFieldValidity(c,b,"heatmap-renderer:invalid-parameters"))throw c;return a}async function K(a){let b=a.scheme,c=null;var d=null;d=await n.getBasemapInfo(a.basemap,
a.view);c=m.isSome(d.basemapId)?d.basemapId:null;d=m.isSome(d.basemapTheme)?d.basemapTheme:null;if(b)return{scheme:p.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=p.getSchemes({basemap:c,basemapTheme:d}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}}async function L(a,b){const {fieldOffset:c}=a,{field:d,basemap:q,radius:r,fadeToTransparent:h,heatmapScheme:M,view:N}=b,{scheme:x,basemapId:O,basemapTheme:P}=await K({basemap:q,scheme:M,view:N});var f=x.colors;
const y=f.length,z=!a.count,A=z?[0,.04]:[a.min,a.max];let B;const C=b.fadeRatio??0,t=b.minRatio??0,Q=((b.maxRatio??0)-t)/(y-1);b=f[0];const D=h?t:.01,u=[new g({ratio:0,color:new l([b.r,b.g,b.b,0])}),new g({ratio:.01,color:new l([b.r,b.g,b.b,0])}),new g({ratio:D,color:new l([b.r,b.g,b.b,D])})];n.createColors(f,y).forEach((R,S)=>{u.push(new g({ratio:t+Q*S,color:R}))});h&&(E(u,C),B=new w({fadeRatio:C}));f=new F({authoringInfo:B,radius:r,colorStops:u,field:d,minDensity:A[0],maxDensity:A[1]});null!=c&&
(f.fieldOffset=c);return{renderer:f,statistics:a,defaultValuesUsed:z,scheme:p.cloneScheme(x),basemapId:O,basemapTheme:P}}function E(a,b){const c=10*(1-b)+1;a.forEach((d,q)=>{if(!(2>=q)){var {ratio:r,color:h}=d;h.a=0===b?1:Math.min(Math.max(r*c,0),1)}})}k.createRenderer=async function(a){a=await J(a);const b=a.statistics??await H({layer:a.layer,field:a.field,fieldOffset:a.fieldOffset,radius:a.radius,view:a.view,signal:a.signal});return L(b,a)};k.updateRenderer=function(a){const {fadeRatio:b,renderer:c}=
a;a=c.clone();const d=null==b?a?.authoringInfo?.fadeRatio||0:b;E(a.colorStops,d);a.authoringInfo?a.authoringInfo.fadeRatio=d:a.authoringInfo=new w({fadeRatio:d});return a};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});