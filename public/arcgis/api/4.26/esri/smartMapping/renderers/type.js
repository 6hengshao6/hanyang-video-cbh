// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../renderers/PointCloudClassBreaksRenderer ../../renderers/PointCloudRenderer ../../renderers/PointCloudRGBRenderer ../../renderers/PointCloudStretchRenderer ../../renderers/PointCloudUniqueValueRenderer ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Error ../../core/lang ../../core/maybe ../../intl/messages ../../renderers/support/LegendOptions ../../renderers/support/utils ../heuristics/outline ../heuristics/sizeRange ./support/utils ../statistics/uniqueValues ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/type".split(" "),
function(C,ea,fa,ha,ia,R,ja,ka,la,ma,na,oa,pa,S,qa,m,I,z,T,U,D,V,W,e,J,X,E,q,F){async function Y(a){if(!a||!a.layer||!a.field&&!a.valueExpression)throw new m("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(a.valueExpression&&!a.view)throw new m("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&X.verifyBinningParams(a,"type-renderer");const b={...a,layer:a.layer};b.symbolType=b.symbolType||
"2d";b.numTypes=null==b.numTypes?10:b.numTypes;b.defaultSymbolEnabled??(b.defaultSymbolEnabled=!0);b.sortBy??(b.sortBy="count");b.sortEnabled??(b.sortEnabled=!0);b.statistics=I.clone(b.statistics);var c=a.forBinning?q.binningCapableLayerTypes:q.featureCapableLayerTypes;a=q.createLayerAdapter(b.layer,c,a.forBinning);if(!a)throw new m("type-renderer:invalid-parameters","'layer' must be one of these types: "+q.getLayerTypeLabels(c).join(", "));b.layer=a;c=z.isSome(b.signal)?{signal:b.signal}:null;await a.load(c);
c=a.geometryType;b.outlineOptimizationEnabled="polygon"===c?b.outlineOptimizationEnabled:!1;b.sizeOptimizationEnabled="point"===c||"multipoint"===c||"polyline"===c?b.sizeOptimizationEnabled:!1;if("mesh"===c)b.symbolType="3d-volumetric",b.colorMixMode=b.colorMixMode||"replace",b.edgesType=b.edgesType||"none";else{if("3d-volumetric-uniform"===b.symbolType&&"point"!==c)throw new m("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(b.symbolType.includes("3d-volumetric")&&
(!b.view||"3d"!==b.view.type))throw new m("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}c=await E.getFieldsList({field:b.field,field2:b.field2,field3:b.field3,valueExpression:b.valueExpression});if(a=e.verifyBasicFieldValidity(a,c,"type-renderer:invalid-parameters"))throw a;return b}async function Z(a){if(!(a&&a.layer&&a.field))throw new m("type-point-cloud-class-renderer:missing-parameters",
"'layer' and 'field' parameters are required");a={...a,layer:a.layer};a.statistics=I.clone(a.statistics);var b=[q.LayerType.PointCloudLayer],c=q.createLayerAdapter(a.layer,b);if(!c)throw new m("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+q.getLayerTypeLabels(b).join(", "));a.layer=c;a.density=a.density||25;a.size=a.size||"100%";if(!e.isValidPointSize(a.size))throw new m("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");
b=z.isSome(a.signal)?{signal:a.signal}:null;await c.load(b);b=await E.getFieldsList({field:a.field});if(c=e.verifyBasicFieldValidity(c,b,"type-point-cloud-class-renderer:invalid-parameters"))throw c;return a}async function K(a){let b=a.typeScheme,c=null;var d=null;d=await e.getBasemapInfo(a.basemap,a.view);c=z.isSome(d.basemapId)?d.basemapId:null;d=z.isSome(d.basemapTheme)?d.basemapTheme:null;if(b)return{scheme:F.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=F.getSchemes({basemap:c,basemapTheme:d,
geometryType:a.geometryType,theme:a.theme,worldScale:a.worldScale,view:a.view}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}}function L(a,b){return a.label<b.label?-1:a.label>b.label?1:0}function M(a,b){return a.value<b.value?-1:a.value>b.value?1:0}function aa(a,b){let c=b.count-a.count;0===c&&(c=L(a,b));return c}function ba(a,b){let c=b.count-a.count;0===c&&(c=M(a,b));return c}function N(a,b,c){let d;"count"===b?(d=ba,c&&"codedValues"in c&&c.codedValues&&
(d=aa)):"value"===b&&(d=M,c&&"codedValues"in c&&c.codedValues&&(d=L));d&&a.sort(d)}async function ca(a,b,c,d){var l=await T.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");const {field:n,field2:r,field3:p}=b;a=a.uniqueValueInfos;var t=b.layer,u=n?t.getField(n):null;const O=u?t.getFieldDomain(u.name):null,G=-1===b.numTypes?a.length:b.numTypes,v=t.geometryType;t=await K({basemap:b.basemap,geometryType:v,typeScheme:b.typeScheme,worldScale:!!b.symbolType?.includes("3d-volumetric"),view:b.view});
const w=t.scheme,g=new S({field:n,field2:r,field3:p,fieldDelimiter:n&&r?E.FIELD_DELIMITER:null}),P=[],Q=[],x={value:null,domain:O,fieldInfo:u};a.forEach((f,y)=>{x.value=f.value;f.label=D.createUniqueValueLabel(x);f=f.value;(null===f||"string"===typeof f&&f.toLowerCase().includes("\x3cnull\x3e"))&&P.unshift(y)});for(var h of P)Q.unshift(a.splice(h,1)[0]);!1!==b.sortEnabled&&N(a,b.sortBy,O);"date"===u?.type&&(h=a.filter((f,y)=>y<G).map(f=>f.value),x.dateFormatInterval=D.calculateDateFormatInterval(h));
h=c&&c.opacity;let H=e.createColors(w.colors,a.length);const A=e.getSymbolSizeFromScheme(w,v),B=e.getSymbolOutlineFromScheme(w,v,h);a.forEach((f,y)=>{x.value=f.value;f.label=D.createUniqueValueLabel(x);f.symbol=e.createSymbol(v,{type:b.symbolType,color:H[y],size:A,outline:B,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}})});b.valueExpression&&(g.valueExpression=b.valueExpression,g.valueExpressionTitle=b.valueExpressionTitle);b.legendOptions&&(g.legendOptions=new U.LegendOptions(b.legendOptions));
H=e.createColors(w.colors,G);for(h=0;h<G;h++)(u=a[h])&&g.addUniqueValueInfo({value:u.value,label:u.label,symbol:e.createSymbol(v,{type:b.symbolType,color:H[h],size:A,outline:B,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}})});b.defaultSymbolEnabled&&(g.defaultSymbol=e.createSymbol(v,{type:b.symbolType,color:w.noDataColor,size:A,outline:B,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),g.defaultLabel=l.other);for(var k of Q)k.symbol=e.createSymbol(v,{type:b.symbolType,
color:w.noDataColor,size:A,outline:B,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),a.push(k);l=[];k=g.uniqueValueInfos?.length??0;k=k===a.length?-1:k;if(-1<k)for(;k<a.length;k++)l.push({...a[k]});c&&c.visualVariables&&c.visualVariables.length&&(g.visualVariables=c.visualVariables.map(f=>f.clone()));d&&d.minSize&&(g.visualVariables?g.visualVariables.push(d.minSize):g.visualVariables=[d.minSize]);return{renderer:g,uniqueValueInfos:a,excludedUniqueValueInfos:l,typeScheme:F.cloneScheme(w),
basemapId:t.basemapId,basemapTheme:t.basemapTheme}}async function da(a,b){a=a.uniqueValueInfos;b=(b=await K({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:b}))&&b.scheme;const c="point-cloud-class"===b?.theme,d=c?b.colors:e.createColors(b?.colors??[],a.length);N(a,"value");return a.map((l,n)=>{const r=l.value;let p=null;c?(p=d[r])||(p=d[d.length-1]):p=d[n];return{values:[r],color:p,label:l.label}})}C.createPCClassRenderer=async function(a){a=await Z(a);const b=null!=a.statistics?
a.statistics:await J({layer:a.layer,field:a.field,signal:a.signal});return{renderer:new R({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:e.getPointSizeAlgorithm(a.size),colorUniqueValueInfos:await da(b,a.typeScheme)})}};C.createRenderer=async function(a){a=await Y(a);const {layer:b,view:c,signal:d}=a,l={layer:b,field:a.field,field2:a.field2,field3:a.field3,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:c,signal:d},[n,r,p]=await Promise.all([null!=a.statistics?
a.statistics:J(l),a.outlineOptimizationEnabled?V({layer:b,view:c,signal:d}).catch(e.errorCallback):null,a.sizeOptimizationEnabled?W({layer:b,view:c,signal:d}).catch(e.errorCallback):null]);return ca(n,a,r,p)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});