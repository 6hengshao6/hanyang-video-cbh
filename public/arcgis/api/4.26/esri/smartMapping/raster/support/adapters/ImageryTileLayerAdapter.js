// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/stretchUtils ./RasterLayerAdapter".split(" "),function(n,r,t,u,v,g,B,C,w,x,y,z){g=function(d){function h(){return A.apply(this,
arguments)}n._inherits(h,d);var A=n._createSuper(h);d=h.prototype;d.generateRasterInfo=async function(a){const {layer:b}=this;return"imagery-tile"===b.type?await b.generateRasterInfo(b.rasterFunction,{signal:a?.signal})??b.rasterInfo:this.rasterInfo};d.estimateStatisticsHistograms=async function(a){if(null!==this._statsCache)return this._statsCache;const {raster:b}=this.layer,{extent:k,width:p,height:c}=this._getSamplePixelBlockDescriptor(b.rasterInfo);({pixelBlock:a}=await b.fetchPixels(k,p,c,a));
if(u.isNone(a))throw new t("raster-layer-adapter","Unable to estimate histograms");return this._statsCache=y.estimateStatisticsHistograms(a)};d.supportsMultidirectionalHillshade=function(){return!0};d.load=function(a){this.addResolvingPromise(this.layer.load(a).then(()=>this.rasterInfo=this.layer.raster.rasterInfo));return Promise.resolve(this)};d._getSamplePixelBlockDescriptor=function(a,b=1E3){const {pyramidScalingFactor:k,maximumPyramidLevel:p}=a.storageInfo;let {extent:c,width:e,height:f,pixelSize:l}=
a,q=Math.ceil(Math.log(Math.max(e,f)/b)/Math.log(k))-1,m=a=0;q<=p?(b=k**q,e=Math.floor(e/b),f=Math.floor(f/b)):(q=0,e=Math.min(e,b),f=Math.min(f,b),a=Math.max(Math.floor(e/2-500),0),m=Math.max(Math.floor(f/2-500),0),c=new x({xmin:c.xmin+a*l.x,xmax:Math.min(c.xmax,c.xmin+a*l.x*b),ymin:c.ymin+m*l.y,ymax:Math.min(c.ymax,c.ymin+m*l.y*b)}));return{extent:c,width:e,height:f,origin:{x:a,y:m}}};return n._createClass(h)}(z);r.__decorate([v.property()],g.prototype,"layer",void 0);return g=r.__decorate([w.subclass("esri.smartMapping.support.adapters.ImageryTileLayerAdapter")],
g)});