// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/stretchUtils ../../../../rest/support/ImageHistogramParameters ./RasterLayerAdapter ../../../../geometry/Point".split(" "),function(h,
l,e,k,q,A,B,C,r,t,u,v,w){e=function(c){function f(){var a=x.apply(this,arguments);a._cacheSize=20;a._statsCache=new Map;return a}h._inherits(f,c);var x=h._createSuper(f);c=f.prototype;c.generateRasterInfo=function(a){const b=k.unwrap(a?.renderingRule);return this.layer.generateRasterInfo(b,{signal:a?.signal})};c.estimateStatisticsHistograms=async function(a){var b=k.unwrap(a?.renderingRule)?.functionName??"default";if(this._statsCache.has(b))return this._statsCache.get(b);let {width:m,height:n,pixelSize:g}=
this.layer.rasterInfo;for(var d=1;2E3<m||2E3<n;)m/=2,n/=2,d*=2;const y=a?.renderingRule??this.layer.renderingRule,{fullExtent:p,mosaicRule:z}=this.layer;g=new w(g.x*d,g.y*d,p.spatialReference);d=new u({geometry:p,pixelSize:g,renderingRule:y,mosaicRule:z});this.layer.capabilities.operations.supportsComputeStatisticsHistograms?a=await this.layer.computeStatisticsHistograms(d,a):({histograms:a}=await this.layer.computeHistograms(d,a),a={statistics:t.estimateStatisticsFromHistograms(a),histograms:a});
this._statsCache.set(b,a);this._statsCache.size>this._cacheSize&&(b=this._statsCache.keys().next().value,this._statsCache.delete(b));return a};c.supportsMultidirectionalHillshade=function(){return 10.81<=this.layer.version};c.load=function(a){this.addResolvingPromise(this.layer.load(a).then(()=>{this.generateRasterInfo({renderingRule:this.renderingRule,signal:k.unwrap(a)?.signal}).then(b=>this.rasterInfo=b)}));return Promise.resolve(this)};return h._createClass(f)}(v);l.__decorate([q.property()],
e.prototype,"layer",void 0);return e=l.__decorate([r.subclass("esri.smartMapping.support.adapters.ImageryLayerAdapter")],e)});