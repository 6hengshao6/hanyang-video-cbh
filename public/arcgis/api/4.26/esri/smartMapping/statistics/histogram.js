// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../core/Error ../../core/maybe ../../layers/support/fieldUtils ./support/utils ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils".split(" "),function(c,p,l,g,q,m,f){async function r(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new c("histogram:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new c("histogram:missing-parameters",
"View is required when 'valueExpression' is specified");a.forBinning&&q.verifyBinningParams(a,"histogram");const {layer:h,...k}=a;var b=a.forBinning?f.binningCapableLayerTypes:f.defaultSupportedLayerTypes;a=f.createLayerAdapter(h,b,a.forBinning);if(!a)throw new c("histogram:invalid-parameters","'layer' must be one of these types: "+f.getLayerTypeLabels(b).join(", "));b={layerAdapter:a,...k};b.normalizationType=m.getNormalizationType(b);var e=p.isSome(b.signal)?{signal:b.signal}:null;await a.load(e);
const t=b.valueExpression||b.sqlExpression;var d=b.field;e=d?a.getField(d):null;const n=!b.classificationMethod||"equal-interval"===b.classificationMethod;d=await m.getFieldsList({field:d,normalizationField:b.normalizationField,valueExpression:b.valueExpression});if(d=g.verifyBasicFieldValidity(a,d,"histogram:invalid-parameters"))throw d;if(e){if(a=g.verifyFieldType(a,e,"histogram:invalid-parameters",u))throw a;if(l.isDateField(e)){if(b.normalizationType)throw new c("histogram:invalid-parameters",
"Normalization is not allowed for date fields");if(!n)throw new c("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed for date fields");}}else if(t){if(b.normalizationType)throw new c("histogram:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");if(!n)throw new c("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'valueExpression' or 'sqlExpression' is specified");
}if(a=g.verifyFilterValidty(b.filter,"histogram:invalid-parameters"))throw a;return b}const u=["date",...l.numericTypes];return async function(a){const {layerAdapter:h,...k}=await r(a);return h.histogram(k)}});