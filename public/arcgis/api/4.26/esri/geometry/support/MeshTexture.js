// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),function(m,f,d,q,r,h,t,z,u,v,w,n){var k;const p=new WeakMap;let x=0;d=k=function(e){function l(a){a=
y.call(this,a);a.wrap="repeat";return a}m._inherits(l,e);var y=m._createSuper(l);e=l.prototype;e.writeData=function(a,b,c,g){a instanceof HTMLImageElement?(a={type:"image-element",src:n.toJSON(a.src,g),crossOrigin:a.crossOrigin},b[c]=a):a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this._encodeImageData(a)},b[c]=a):a instanceof HTMLVideoElement?(a={type:"video-element",src:n.toJSON(a.src,g),autoplay:a.autoplay,loop:a.loop,
muted:a.muted,crossOrigin:a.crossOrigin,preload:a.preload},b[c]=a):a instanceof ImageData&&(a={type:"image-data",imageData:this._encodeImageData(a)},b[c]=a)};e.readData=function(a){switch(a.type){case "image-element":var b=new Image;b.src=a.src;b.crossOrigin=a.crossOrigin;return b;case "canvas-element":return a=this._decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this._decodeImageData(a.imageData);
case "video-element":return b=document.createElement("video"),b.src=a.src,b.crossOrigin=a.crossOrigin,b.autoplay=a.autoplay,b.loop=a.loop,b.muted=a.muted,b.preload=a.preload,b}};e.clone=function(){const a={url:this.url,data:this.data,wrap:this._cloneWrap()};return new k(a)};e.cloneWithDeduplication=function(a){var b=a.get(this);if(b)return b;b=this.clone();a.set(this,b);return b};e._cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};
e._encodeImageData=function(a){let b="";for(let c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};e._decodeImageData=function(a){const b=atob(a.data),c=new Uint8ClampedArray(b.length);for(let g=0;g<b.length;g++)c[g]=b.charCodeAt(g);return q.wrapImageData(c,a.width,a.height)};e._imageDataContainsTransparent=function(a){for(let b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};l.from=function(a){return"string"===typeof a?new k({url:a}):
a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement?new k({data:a}):t.ensureClass(k,a)};m._createClass(l,[{key:"url",get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)}},{key:"transparent",get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?
this._imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this._imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){this._overrideIfSome("transparent",a)}},{key:"contentHash",get:function(){const a="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",b=(c="")=>`d:${c},t:${this.transparent},w:${a}`;
if(null!=this.url)return b(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return b(this.data.src);p.has(this.data)||p.set(this.data,++x);return b(p.get(this.data))}return b()}}]);return l}(r.JSONSupport);f.__decorate([h.property({type:String,json:{write:n.write}})],d.prototype,"url",null);f.__decorate([h.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),h.property()],d.prototype,"data",null);f.__decorate([w.writer("data")],
d.prototype,"writeData",null);f.__decorate([u.reader("data")],d.prototype,"readData",null);f.__decorate([h.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],d.prototype,"transparent",null);f.__decorate([h.property({json:{write:!0}})],d.prototype,"wrap",void 0);f.__decorate([h.property({readOnly:!0})],d.prototype,"contentHash",null);return d=k=f.__decorate([v.subclass("esri.geometry.support.MeshTexture")],d)});