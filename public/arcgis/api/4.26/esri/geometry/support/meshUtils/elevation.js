// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry ../../../Ground ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../Mesh ../../projection ../Indices ../MeshComponent ../MeshVertexAttributes ../../Point".split(" "),function(w,S,B,C,x,D,E,F,G,H,I,J,K){function y(a,b,c){var f=E.getMetersPerUnitForSR(b.spatialReference),d=(c?.demResolution??a.demResolution.min)/f;f=Math.round(b.width/d);d=Math.round(b.height/d);const k=f+1,t=d+1,m=new Float64Array(k*t*3),u=new Float32Array(k*
t*2);let q=0,z=0;const g=new Uint32Array(f*d*6);let h=0,l=0;const L=!a.spatialReference.equals(b.spatialReference);r.spatialReference=b.spatialReference;const {xmin:M,ymin:N,height:O,width:P}=b;for(let n=0;n<t;n++){const v=N+n/d*O;for(let p=0;p<k;p++){var e=M+p/f*P;m[q++]=e;m[q++]=v;L?(r.x=e,r.y=v,e=G.project(r,a.spatialReference),m[q++]=x.unwrapOr(a.elevationAt(e.x,e.y),0)):m[q++]=x.unwrapOr(a.elevationAt(e,v),0);e=p/f;const Q=n/d;u[z++]=e;u[z++]=Q;n!==d&&p!==f&&(g[l++]=h+1,g[l++]=h+k+1,g[l++]=h+
k,g[l++]=h,g[l++]=h+1,g[l++]=h+k);h++}}return new F({vertexAttributes:new J.MeshVertexAttributes({position:m,uv:u}),components:[new I({faces:H.compactIndices(g),shading:"smooth",material:c?.material??null})],spatialReference:b.spatialReference})}async function R(a){if(A(a))return a.load();await a.load();await D.eachAlways(a.layers.map(b=>b.load()));return a}function A(a){return"type"in a&&("elevation"===a.type||"base-elevation"===a.type)}const r=new K;w.create=async function(a,b,c){return A(a)||a instanceof
B?(a=await (await R(a)).createElevationSampler(b,{demResolution:c?.demResolution??"finest-contiguous"}),y(a,b,{material:c?.material})):"string"===typeof c?.demResolution?(C.getLogger("esri.geometry.support.meshUtils.elevation").error("create()","demResolution must be a number when used directly with a sampler"),null):y(a,b,{material:c?.material,demResolution:c?.demResolution})};Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});