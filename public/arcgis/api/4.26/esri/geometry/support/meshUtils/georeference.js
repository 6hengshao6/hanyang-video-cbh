// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../MeshTransform ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),function(p,h,r,G,y,z,A,H,I,J,n,t,l){function u(b,a,c){if(t.isGeographicMesh(a.spatialReference,c)){var d=a.spatialReference,e=B(a,c,v);c=new Float64Array(b.position.length);var f=b.position;a=d;var g=c;n.transformMat4(g,
f,e);f=new Float64Array(f.length);a=l.projectFromPCPF(g,f,a);e=A.normalFromMat4(C,e);g=c;f=b.normal;var k=e,q=d;if(h.isNone(f))g=null;else{var m=new Float32Array(f.length);n.transformMat3(m,f,k);l.projectNormalFromPCPF(m,a,g,q,m);g=m}b=b.tangent;if(h.isNone(b))b=null;else{f=new Float32Array(b.length);n.transformMat3(f,b,e,4);for(e=3;e<f.length;e+=4)f[e]=b[e];l.projectTangentFromPCPF(f,a,c,d,f);b=f}b={position:a,normal:g,tangent:b}}else{d=new Float64Array(b.position.length);e=b.position;g=a.x;f=a.y;
k=a.z||0;const {horizontal:D,vertical:K}=w(c?c.unit:null,a.spatialReference);for(a=0;a<e.length;a+=3)d[a]=e[a]*D+g,d[a+1]=e[a+1]*D+f,d[a+2]=e[a+2]*K+k;b={position:d,normal:b.normal,tangent:b.tangent}}return b}function E(b,a,c){const {position:d,normal:e,tangent:f}=b;if(h.isNone(a))return{position:d,normal:e,tangent:f};var g=a.localMatrix;b=n.transformMat4(new Float64Array(d.length),d,g);const k=h.isSome(e)?l.transformNormal(e,new Float32Array(e.length),g):null;g=h.isSome(f)?l.transformTangent(f,new Float32Array(f.length),
g):null;return u({position:b,normal:k,tangent:g},a.getOriginPoint(c),{geographic:a.geographic})}function x(b,a,c){if(t.isGeographicMesh(a.spatialReference,c)){var d=a.spatialReference;B(a,c,v);var e=y.invert(L,v);c=new Float64Array(b.position.length);a=e;var f=l.projectToPCPF(b.position,d,c),g=new Float64Array(f.length);n.transformMat4(g,f,a);a=g;e=A.normalFromMat4(C,e);g=b.normal;var k=b.position,q=c,m=d;f=e;h.isNone(g)?f=null:(g=l.projectNormalToPCPF(g,k,q,m,new Float32Array(g.length)),n.transformMat3(g,
g,f),f=g);g=b.tangent;b=b.position;h.isNone(g)?d=null:(d=l.projectTangentToPCPF(g,b,c,d,new Float32Array(g.length)),n.transformMat3(d,d,e,4));d={position:a,normal:f,tangent:d}}else d=F(b,a,c);return d}function F(b,a,c){const d=new Float64Array(b.position.length),e=b.position,f=a.x,g=a.y,k=a.z||0,{horizontal:q,vertical:m}=w(c?c.unit:null,a.spatialReference);for(a=0;a<e.length;a+=3)d[a]=(e[a]-f)/q,d[a+1]=(e[a+1]-g)/q,d[a+2]=(e[a+2]-k)/m;return{position:d,normal:b.normal,tangent:b.tangent}}function B(b,
a,c){H.computeTranslationToOriginAndRotation(b.spatialReference,[b.x,b.y,b.z||0],c,I.getSphericalPCPF(b.spatialReference));const {horizontal:d,vertical:e}=w(a?a.unit:null,b.spatialReference);y.scale(c,c,[d,d,e]);return c}function w(b,a){if(h.isNone(b))return M;const c=a.isGeographic?1:r.getMetersPerUnitForSR(a);a=a.isGeographic?1:r.getMetersPerVerticalUnitForSR(a);b=r.convertUnit(1,b,"meters");return{horizontal:b*c,vertical:b*a}}const v=z.create(),L=z.create(),C=G.create(),M={horizontal:1,vertical:1};
p.georeference=u;p.georeferenceApplyTransform=E;p.georeferenceByTransform=function(b,a,c){if(c?.useTransform){const {position:d,normal:e,tangent:f}=b;return{vertexAttributes:{position:d,normal:e,tangent:f},transform:new J({origin:[a.x,a.y,a.z??0],geographic:t.isGeographicMesh(a.spatialReference,c)})}}return{vertexAttributes:u(b,a,c),transform:null}};p.ungeoreference=x;p.ungeoreferenceByTransform=function(b,a,c,d){if(h.isNone(a))return x(b,c,d);b=E(b,a,c.spatialReference);return c.equals(a.getOriginPoint(c.spatialReference))?
F(b,c,d):x(b,c,d)};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});