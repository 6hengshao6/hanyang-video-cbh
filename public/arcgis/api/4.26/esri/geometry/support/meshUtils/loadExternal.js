// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),function(p,q,u,v,l,h,r,w){function x(a){const b=r.removeFile(a.url);return c=>{var d=r.makeRelative(c,b,b);return((d=d?d.replace(/^ *\.\//,""):null)?a.files.get(d):null)??c}}async function t(a,b){return a instanceof Blob?k.fromBlob(a):"string"===typeof a?new k(a):Array.isArray(a)?y(a,b):z(a,b)}async function y(a,b){const c=
new Map;let d=null;a=await h.eachAlwaysValues(a.map(async e=>({name:e.name,source:await t(e instanceof Blob?e:e.source,b)})));const f=[];for(const e of a)e&&(h.isAborted(b)?e.source.dispose():f.push(e));h.throwIfAborted(b);for(const {name:e,source:g}of f){if(l.isNone(d)||/\.(gltf|glb)/i.test(e))d=g.url;c.set(e,g.url);g.files&&g.files.forEach((m,n)=>c.set(n,m))}if(l.isNone(d))throw new v("mesh-load-external:missing-files","Missing files to load external mesh source");return new k(d,()=>f.forEach(({source:e})=>
e.dispose()),c)}async function z(a,b){const {default:c}=await h.whenOrAbort(new Promise((d,f)=>p(["../../../request"],e=>d(Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}))),f)),b);a="string"===typeof a.multipart[0]?await Promise.all(a.multipart.map(async d=>(await c(d,{responseType:"array-buffer"})).data)):a.multipart;return k.fromBlob(new Blob(a))}let k=function(){function a(b,c=()=>{},d=new Map){this.url=b;this.dispose=c;this.files=d}a.fromBlob=
function(b){const c=URL.createObjectURL(b);return new a(c,()=>URL.revokeObjectURL(c))};return u._createClass(a)}();q.loadExternal=async function(a,b,c){const {loadGLTFMesh:d}=await h.whenOrAbort(new Promise((m,n)=>p(["./loadGLTFMesh"],m,n)),c),f=await t(b,c);b=d(new w({x:0,y:0,z:0,spatialReference:a.spatialReference}),f.url,{resolveFile:x(f),useTransform:!0,signal:l.isSome(c)?c.signal:null});b.then(()=>f.dispose(),()=>f.dispose());const {vertexAttributes:e,components:g}=await b;a.vertexAttributes=
e;a.components=g};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});