// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(g,h,p,q,e,l,k,m,r,t,n){k=function(c){function f(a,b=""){var d=u.call(this);d.apiLayerUid=b;d.type=m.ContentObjectType.Layer;d.events=new p;d.sliceable=!1;d._objects=new l;d._objectsAdded=new l;d._stageHandles=new q;d.apiLayerUid=b;d.visible=a?.visible??
!0;d.pickable=a?.pickable??!0;d.updatePolicy=a?.updatePolicy??n.UpdatePolicy.ASYNC;d._disableOctree=a?.disableOctree??!1;return d}h._inherits(f,c);var u=h._createSuper(f);c=f.prototype;c.destroy=function(){this.detachStage();this._stage=null};c.attachStage=function(a){this.detachStage();this._stage=a;for(const b of r.DirtyEventNames)this._stageHandles.add(this.events.on(b,d=>a.handleEvent(b,d)))};c.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};c.add=
function(a){this._objects.push(a);a.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:a});e.isSome(this._octree)&&this._objectsAdded.push(a)};c.remove=function(a){this._objects.removeUnordered(a)&&(a.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:a}),e.isSome(this._octree)&&(this._objectsAdded.removeUnordered(a)||this._octree.remove([a])))};c.addMany=function(a){this._objects.pushArray(a);for(const b of a)b.parentLayer=this;this.events.emit("layerObjectsAdded",
{layer:this,objects:a});e.isSome(this._octree)&&this._objectsAdded.pushArray(a)};c.removeMany=function(a){const b=[];this._objects.removeUnorderedMany(a,a.length,b);if(0!==b.length){for(const d of b)d.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:b});if(e.isSome(this._octree)){for(a=0;a<b.length;)this._objectsAdded.removeUnordered(b[a])?(b[a]=b[b.length-1],--b.length):++a;this._octree.remove(b)}}};c.sync=function(){e.isSome(this._stage)&&this.updatePolicy!==n.UpdatePolicy.SYNC&&
this._stage.syncLayer(this.id)};c.notifyObjectBBChanged=function(a,b){e.isSome(this._octree)&&!this._objectsAdded.includes(a)&&this._octree.update(a,b)};c.getSpatialQueryAccelerator=function(){e.isNone(this._octree)&&50<this._objects.length&&!this._disableOctree?(this._octree=new t(a=>a.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):e.isSome(this._octree)&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),
this._objectsAdded.clear());return this._octree};c.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};c.invalidateSpatialQueryAccelerator=function(){this._octree=e.destroyMaybe(this._octree);this._objectsAdded.clear()};h._createClass(f,[{key:"objects",get:function(){return this._objects}}]);return f}(k.ContentObject);g.WebGLLayer=k;g.isWebGLLayer=function(c){return e.isSome(c)&&c.type===m.ContentObjectType.Layer};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})});