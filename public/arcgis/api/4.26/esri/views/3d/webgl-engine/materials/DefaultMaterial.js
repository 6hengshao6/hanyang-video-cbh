// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(v,h,L,p,g,l,D,M,e,w,z,N,x,A,O,y,m,P,Q,E,F,R,S){A=function(d){function f(a){a=r.call(this,a,T);a.supportsEdges=!0;a._configuration=new R.DefaultMaterialTechniqueConfiguration;var b=a.parameters;const c=M.newLayout().vec3f(m.VertexAttribute.POSITION).vec3f(m.VertexAttribute.NORMAL),n=b.textureId||b.normalTextureId||b.metallicRoughnessTextureId||b.emissiveTextureId||b.occlusionTextureId;b.hasVertexTangents&&c.vec4f(m.VertexAttribute.TANGENT);n&&c.vec2f(m.VertexAttribute.UV0);b.hasVertexColors&&
c.vec4u8(m.VertexAttribute.COLOR);b.hasSymbolColors&&c.vec4u8(m.VertexAttribute.SYMBOLCOLOR);L("enable-feature:objectAndLayerId-rendering")&&c.vec4u8(m.VertexAttribute.OBJECTANDLAYERIDCOLOR);a._vertexBufferLayout=c;return a}h._inherits(f,d);var r=h._createSuper(f);d=f.prototype;d.isVisibleForOutput=function(a){return a===e.ShaderOutput.Shadow||a===e.ShaderOutput.ShadowExcludeHighlight||a===e.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};d.isVisible=function(){var a=this.parameters;
if(!h._get(h._getPrototypeOf(f.prototype),"isVisible",this).call(this)||0===a.layerOpacity)return!1;const {hasInstancedColor:b,hasVertexColors:c,hasSymbolColors:n,vvColor:t}=a,q="replace"===a.colorMixMode,k=0<a.opacity;a=a.externalColor&&0<a.externalColor[3];const u=b||t||n;return c&&u?q||k:c?q?a:k:u?q||k:q?a:k};d.getConfiguration=function(a,b){this._configuration.output=a;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;
this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=p.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=p.isSome(this.parameters.screenSizePerspective);this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;p.isSome(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=
this.parameters.hasSlicePlane?N.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=b.multipassTerrain.enabled;this._configuration.cullAboveGround=b.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=p.isSome(this.parameters.modelTransformation);if(a===e.ShaderOutput.Color||a===e.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=
this.parameters.treeRendering?w.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?w.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?w.NormalsDoubleSidedMode.WindingOrder:w.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=
b.ssaoHelper.active?this.parameters.receiveSSAO:!1,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?z.PBRMode.Schematic:z.PBRMode.Normal:z.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=b.transparencyPassType,this._configuration.enableOffset=b.camera.relativeElevation<O.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(b),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,
this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};d.hasSnowCover=function(a){return p.isSome(a.weather)&&a.weatherVisible&&"snowy"===a.weather.type&&"enabled"===a.weather.snowCover};d.intersect=function(a,b,c,n,t,
q){if(p.isSome(this.parameters.verticalOffset)){const u=c.camera;g.set(B,b[12],b[13],b[14]);b=null;switch(c.viewingMode){case D.ViewingMode.Global:b=g.normalize(G,B);break;case D.ViewingMode.Local:b=g.copy(G,U)}let H=0;var k=g.subtract(V,B,u.eye);const I=g.length(k);k=g.scale(k,k,1/I);let J=null;this.parameters.screenSizePerspective&&(J=g.dot(b,k));H+=E.verticalOffsetAtDistance(u,I,this.parameters.verticalOffset,J??0,this.parameters.screenSizePerspective);g.scale(b,b,H);g.transformMat3(C,b,c.transform.inverseRotation);
n=g.subtract(W,n,C);t=g.subtract(X,t,C)}E.intersectTriangleGeometry(a,c,n,t,P.getVerticalOffsetObject3D(c.verticalOffset),q)};d.requiresSlot=function(a,b){return b===e.ShaderOutput.Color||b===e.ShaderOutput.Alpha||b===e.ShaderOutput.Depth||b===e.ShaderOutput.Normal||b===e.ShaderOutput.Shadow||b===e.ShaderOutput.ShadowHighlight||b===e.ShaderOutput.ShadowExcludeHighlight||b===e.ShaderOutput.Highlight||b===e.ShaderOutput.ObjectAndLayerIdColor?a===(this.parameters.transparent?this.parameters.writeDepth?
y.RenderSlot.TRANSPARENT_MATERIAL:y.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:y.RenderSlot.OPAQUE_MATERIAL)||a===y.RenderSlot.DRAPED_MATERIAL:!1};d.createGLMaterial=function(a){return new K(a)};d.createBufferWriter=function(){return new Q.DefaultBufferWriter(this._vertexBufferLayout)};return h._createClass(f)}(A.Material);let K=function(d){function f(a){return r.call(this,{...a,...a.material.parameters})}h._inherits(f,d);var r=h._createSuper(f);d=f.prototype;d._updateShadowState=function(a){a.shadowMap.enabled!==
this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:a.shadowMap.enabled})};d._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};d.beginSlot=function(a){if(this._output===e.ShaderOutput.Color||this._output===e.ShaderOutput.Alpha)this._updateShadowState(a),this._updateOccludeeState(a);const b=this._material.parameters;this.updateTexture(b.textureId);const c=
a.camera.viewInverseTransposeMatrix;g.set(b.origin,c[3],c[7],c[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(b.treeRendering?S.RealisticTreeTechnique:F.DefaultMaterialTechnique,a)};return h._createClass(f)}(x.GLTextureMaterial);x=function(d){function f(){var a=r.apply(this,arguments);a.initTextureTransparent=!1;a.treeRendering=!1;a.hasVertexTangents=!1;return a}h._inherits(f,d);var r=h._createSuper(f);return h._createClass(f)}(F.DefaultMaterialPassParameters);
const T=new x,W=l.create(),X=l.create(),U=l.fromValues(0,0,1),G=l.create(),C=l.create(),B=l.create(),V=l.create();v.DefaultGLMaterial=K;v.DefaultMaterial=A;v.DefaultMaterialParameters=x;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});