// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(b,p,c,g,w,d,F,G,H,x,y,z,A,q,e,B,C,D){b.DrapedHeatmapRenderer=function(k){function l(a){a=E.call(this,a);a.pixelRatio=1;a._colorRampData=new Uint8ClampedArray(4);a.type="draped-heatmap";a._heatmapParameters=new q.HeatmapPassParameters;return a}p._inherits(l,k);var E=p._createSuper(l);k=l.prototype;k.initialize=function(){this._densityMap=new B.FramebufferObject(this.rctx,{colorTarget:e.TargetType.TEXTURE,depthStencilTarget:e.DepthStencilTargetType.NONE,width:0,height:0},{target:e.TextureType.TEXTURE_2D,
pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=z.createQuadVAO(this.rctx);var a=this._colorRampData;this._colorRamp=new C.Texture(this.rctx,{target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,samplingMode:e.TextureSamplingMode.LINEAR,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:a.length/4,height:1},a);a=new q.HeatmapTechniqueConfiguration;
a.usesHalfFloat=this.dataType!==e.PixelType.FLOAT;this._technique=new q.HeatmapTechnique({rctx:this.rctx,viewingMode:y.ViewingMode.Local},a);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(w.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};k.destroy=function(){this._technique=g.releaseMaybe(this._technique);this._densityMap=g.disposeMaybe(this._densityMap);
this._quad=g.disposeMaybe(this._quad);this._colorRamp=g.disposeMaybe(this._colorRamp)};k.render=function(a){const f=this._sortedMaterialRenderers;if(0!==f.length){var n=this.rctx.getBoundFramebufferObject(),h=this.rctx.getViewport(),{pixelRatio:m}=this,t=Math.ceil(h.width*m);m=Math.ceil(h.height*m);this._densityMap.resize(t,m);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,t,m);this.rctx.clear(e.ClearBufferBit.COLOR_BUFFER_BIT);var u=!1;f.forAll(r=>{if(r.material.shouldRender(a)){const v=
r.prepareTechnique(a);g.isSome(v)&&(r.render(a,v),u=!0)}});this.rctx.bindFramebuffer(n);this.rctx.setViewport(h.x,h.y,h.width,h.height);u&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,a.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,D.vertexCount(this._quad,"geometry")))}};p._createClass(l,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(a){a!==this._heatmapParameters.searchRadius&&
(this._heatmapParameters.searchRadius=a,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(a){a!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=a,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(a){a!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=a,this.notifyChange("maxDensity"))}},{key:"fieldTotal",
get:function(){return this._heatmapParameters.fieldTotal},set:function(a){this._heatmapParameters.fieldTotal=a;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(a){const {colorRamp:f}=this._heatmapParameters;if(g.isSome(f)&&a!==this._colorRampData){const n=a.length/4;n!==f.descriptor.width&&f.resize(n,1);f.setData(a)}this._colorRampData=a}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(a){this._heatmapParameters.colorRamp=
a}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return l}(A.SortedRenderGeometryRenderer);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"searchRadius",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"minDensity",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"fieldTotal",
null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"dataType",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);c.__decorate([d.property({constructOnly:!0})],
b.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);b.DrapedHeatmapRenderer=c.__decorate([x.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],b.DrapedHeatmapRenderer);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});