// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Indices ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),function(C,l,D,E,F,G,z,H,I,w){let N=function(){function x(a,b){this._indices=l.isSome(a.indices)?a.indices:G.getContinuousIndexArray(a.positions.length/3);
this._positions=a.positions;this._components=b;this._componentIntersectionData=Array(b.count)}var t=x.prototype;t.getComponentAabb=function(a,b){if(l.isSome(this._perComponentAabbs)){for(let e=0;6>e;e++)b[e]=this._perComponentAabbs[6*a+e];return b}this._computePerComponentAabbs();return this.getComponentAabb(a,b)};t.getComponentPositions=function(a,b){b.indices=this._indices;b.data=this._positions;b.stride=3;b.startIndex=this._components.offsets[a];b.endIndex=this._components.offsets[a+1]};t.intersect=
function(a,b,e,u,c,m,h){const k=new H.Attribute(this._positions,3,!1,3),y=this._indices,n=this._components.offsets,p=w.computeInvDir(a,b,J),q=a[2],r=b[2];this._components.visibility.forEachComponent(d=>{if(!I.getVisibility(this._components.pickability,d))return!0;var f=this.getComponentAabb(d,K);if(l.isSome(m)){var g=m[d];l.isSome(c)?c.componentOffset=g:(a[2]=q-g,b[2]=r-g)}l.isSome(c)&&c.applyToAabb(f);if(!w.intersectAabbInvDir(f,a,p,e))return!0;f=n[d]/3;g=n[d+1]/3;const v=g-f,B=(L,A,M)=>h(d,L,D.transformMat3(A,
A,u),M);l.isNone(c)&&v>z.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[d]&&(this._componentIntersectionData[d]=new z.ComponentIntersectionData(this._indices,f,g,k)),this._componentIntersectionData[d].intersectRay({r0:a,r1:b},B)):w.intersectTriangles(a,b,f,g,y,k,void 0,c,B);return!0})};t._computePerComponentAabbs=function(){const a=this._components.count;this._perComponentAabbs=new Float32Array(6*a);const b=this._indices,e=this._positions,u=this._components.offsets;
let c=0;for(let k=0;k<a;k++){var m=u[k];const y=u[k+1];let n=Infinity,p=Infinity,q=Infinity,r=-Infinity,d=-Infinity,f=-Infinity;for(;m<y;m++){var h=3*b[m];const g=e[h],v=e[h+1];h=e[h+2];n=Math.min(n,g);p=Math.min(p,v);q=Math.min(q,h);r=Math.max(r,g);d=Math.max(d,v);f=Math.max(f,h)}this._perComponentAabbs[c++]=n;this._perComponentAabbs[c++]=p;this._perComponentAabbs[c++]=q;this._perComponentAabbs[c++]=r;this._perComponentAabbs[c++]=d;this._perComponentAabbs[c++]=f}};C._createClass(x,[{key:"positions",
get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return x}();const J=E.create(),K=F.create();return N});