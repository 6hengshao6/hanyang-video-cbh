// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(C,n,N,y,E,O,p,P,D,q,g,Q,F,z,G){let T=function(d){function h(a){a=
k.call(this,a,new H);a._vertexAttributeLocations=F.vertexAttributeLocations;a._configuration=new z.LineMarkerTechniqueConfiguration;a._layout=a.createLayout();return a}n._inherits(h,d);var k=n._createSuper(h);d=h.prototype;d.dispose=function(){};d.getConfiguration=function(a,b){this._configuration.output=a;this._configuration.space=b.slot===q.RenderSlot.DRAPED_MATERIAL?z.LineMarkerSpace.Draped:this.parameters.worldSpace?z.LineMarkerSpace.World:z.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=
this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==G.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=
!!this.parameters.vvOpacity;this._configuration.occluder=this.parameters.renderOccluded===D.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=b.transparencyPassType;this._configuration.hasMultipassTerrain=b.multipassTerrain.enabled;this._configuration.cullAboveGround=b.multipassTerrain.cullAboveGround;return this._configuration};d.intersect=function(){};d.createLayout=function(){const a=O.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0).vec3f(g.VertexAttribute.AUXPOS1);
this.parameters.worldSpace&&a.vec3f(g.VertexAttribute.NORMAL);this.parameters.vvSize?a.f32(g.VertexAttribute.SIZEFEATUREATTRIBUTE):a.f32(g.VertexAttribute.SIZE);this.parameters.vvColor?a.f32(g.VertexAttribute.COLORFEATUREATTRIBUTE):a.vec4f(g.VertexAttribute.COLOR);this.parameters.vvOpacity&&a.f32(g.VertexAttribute.OPACITYFEATUREATTRIBUTE);return a};d.createBufferWriter=function(){return new R(this._layout,this.parameters)};d.requiresSlot=function(a,b){return b===p.ShaderOutput.Color||b===p.ShaderOutput.Alpha||
b===p.ShaderOutput.Highlight||b===p.ShaderOutput.Depth?a===q.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===D.RenderOccludedFlag.OccludeAndTransparentStencil?a===q.RenderSlot.OPAQUE_MATERIAL||a===q.RenderSlot.OCCLUDER_MATERIAL||a===q.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:b===p.ShaderOutput.Color||b===p.ShaderOutput.Alpha?a===(this.parameters.writeDepth?q.RenderSlot.TRANSPARENT_MATERIAL:q.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):a===q.RenderSlot.OPAQUE_MATERIAL:!1};
d.createGLMaterial=function(a){return new S(a)};return n._createClass(h)}(D.Material),S=function(d){function h(){return k.apply(this,arguments)}n._inherits(h,d);var k=n._createSuper(h);d=h.prototype;d._updateParameters=function(a){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(F.LineMarkerTechnique,a)};d._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};
d.beginSlot=function(a){this._output!==p.ShaderOutput.Color&&this._output!==p.ShaderOutput.Alpha||this._updateOccludeeState(a);return this._updateParameters(a)};return n._createClass(h)}(P.GLTextureMaterial),H=function(d){function h(){var a=k.apply(this,arguments);a.width=0;a.color=[1,1,1,1];a.placement="end";a.cap=G.CapType.BUTT;a.anchor=z.LineMarkerAnchor.Center;a.hasTip=!1;a.worldSpace=!1;a.hideOnShortSegments=!1;a.writeDepth=!0;a.hasSlicePlane=!1;a.vvFastUpdate=!1;a.hasOccludees=!1;return a}n._inherits(h,
d);var k=n._createSuper(h);return n._createClass(h)}(Q.VisualVariablePassParameters),R=function(){function d(k,a){this.vertexBufferLayout=k;this._parameters=a}var h=d.prototype;h.allocate=function(k){return this.vertexBufferLayout.createBuffer(k)};h.elementCount=function(){return"begin-end"===this._parameters.placement?12:6};h.write=function(k,a,b,t,U){const r=b.vertexAttributes.get(g.VertexAttribute.POSITION).data,I=r.length/3;let A=[1,0,0];a=b.vertexAttributes.get(g.VertexAttribute.NORMAL);this._parameters.worldSpace&&
N.isSome(a)&&(A=a.data);let J=1,K=0;this._parameters.vvSize?K=b.vertexAttributes.get(g.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:b.vertexAttributes.has(g.VertexAttribute.SIZE)&&(J=b.vertexAttributes.get(g.VertexAttribute.SIZE).data[0]);let u=[1,1,1,1],L=0;this._parameters.vvColor?L=b.vertexAttributes.get(g.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:b.vertexAttributes.has(g.VertexAttribute.COLOR)&&(u=b.vertexAttributes.get(g.VertexAttribute.COLOR).data);let M=0;this._parameters.vvOpacity&&
(M=b.vertexAttributes.get(g.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const e=new Float32Array(t.buffer);let f=this.vertexBufferLayout.stride/4*U;const w=(c,v,l,m)=>{e[f++]=c[0];e[f++]=c[1];e[f++]=c[2];e[f++]=l[0];e[f++]=l[1];e[f++]=v[0];e[f++]=v[1];e[f++]=v[2];this._parameters.worldSpace&&(e[f++]=A[0],e[f++]=A[1],e[f++]=A[2]);this._parameters.vvSize?e[f++]=K:e[f++]=J;this._parameters.vvColor?e[f++]=L:(c=Math.min(4*m,u.length-4),e[f++]=u[c],e[f++]=u[c+1],e[f++]=u[c+2],e[f++]=u[c+3]);this._parameters.vvOpacity&&
(e[f++]=M)};let B;(function(c){c[c.ASCENDING=1]="ASCENDING";c[c.DESCENDING=-1]="DESCENDING"})(B||(B={}));b=(c,v)=>{const l=y.set(V,r[3*c],r[3*c+1],r[3*c+2]),m=W;let x=c+v;do y.set(m,r[3*x],r[3*x+1],r[3*x+2]),x+=v;while(y.equals(l,m)&&0<=x&&x<I);k&&(y.transformMat4(l,l,k),y.transformMat4(m,m,k));w(l,m,[-1,-1],c);w(l,m,[1,-1],c);w(l,m,[1,1],c);w(l,m,[-1,-1],c);w(l,m,[1,1],c);w(l,m,[-1,1],c)};t=this._parameters.placement;"begin"!==t&&"begin-end"!==t||b(0,B.ASCENDING);"end"!==t&&"begin-end"!==t||b(I-
1,B.DESCENDING)};return n._createClass(d)}();const V=E.create(),W=E.create();C.LineMarkerMaterial=T;C.Parameters=H;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});