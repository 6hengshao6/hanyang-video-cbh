// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(l,m,y,n,g,z,A){async function r(){m.isNone(q)&&(q=y.getBasisTranscoder(),e=await q);return q}function t(a,c,d,b,f){c=A.getBytesPerElementFormat(c?g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(d*b*c*(f&&1<a?(4**a-1)/(3*4**(a-1)):1))}function u(a){return 1<=
a.getNumImages()&&!a.isUASTC()}function v(a){return 1<=a.getFaces()&&a.isETC1S()}function w(a,c,d,b,f,h,k,B){const {compressedTextureETC:C,compressedTextureS3TC:D}=a.capabilities,[x,E]=C?b?[n.TextureFormat.ETC2_RGBA,g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[n.TextureFormat.ETC1_RGB,g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:D?b?[n.TextureFormat.BC3_RGBA,g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[n.TextureFormat.BC1_RGB,g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:
[n.TextureFormat.RGBA32,g.PixelFormat.RGBA];b=c.hasMipmap?d:Math.min(1,d);d=[];for(let p=0;p<b;p++)d.push(new Uint8Array(k(p,x))),B(p,x,d[p]);k=1<d.length;return new z.Texture(a,{...c,samplingMode:k?g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:g.TextureSamplingMode.LINEAR,hasMipmap:k,internalFormat:E,width:f,height:h},{type:"compressed",levels:d})}let e=null,q=null;l.createTextureBasis=async function(a,c,d){m.isNone(e)&&(e=await r());const b=new e.BasisFile(new Uint8Array(d));if(!u(b))return null;b.startTranscoding();
a=w(a,c,b.getNumLevels(0),b.getHasAlpha(),b.getImageWidth(0,0),b.getImageHeight(0,0),(f,h)=>b.getImageTranscodedSizeInBytes(0,f,h),(f,h,k)=>b.transcodeImage(k,0,f,h,0,0));b.close();b.delete();return a};l.createTextureKTX2=async function(a,c,d){m.isNone(e)&&(e=await r());const b=new e.KTX2File(new Uint8Array(d));if(!v(b))return null;b.startTranscoding();a=w(a,c,b.getLevels(),b.getHasAlpha(),b.getWidth(),b.getHeight(),(f,h)=>b.getImageTranscodedSizeInBytes(f,0,0,h),(f,h,k)=>b.transcodeImage(k,f,0,0,
h,0,-1,-1));b.close();b.delete();return a};l.estimateMemoryBasis=function(a,c){if(m.isNone(e))return a.byteLength;a=new e.BasisFile(new Uint8Array(a));c=u(a)?t(a.getNumLevels(0),a.getHasAlpha(),a.getImageWidth(0,0),a.getImageHeight(0,0),c):0;a.close();a.delete();return c};l.estimateMemoryKTX2=function(a,c){if(m.isNone(e))return a.byteLength;a=new e.KTX2File(new Uint8Array(a));c=v(a)?t(a.getLevels(),a.getHasAlpha(),a.getWidth(),a.getHeight(),c):0;a.close();a.delete();return c};l.loadBasis=r;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})});