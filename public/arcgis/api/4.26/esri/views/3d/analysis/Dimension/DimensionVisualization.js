// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../intl ../../../../core/Accessor ../../../../core/handleUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ./LengthDimensionVisualization ./settings ../../webgl-engine/lib/Material ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/MarkerTextureCache ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/shaders/LineMarkerTechniqueConfiguration ../../../../intl/locale ../../../../intl/messages".split(" "),
function(d,r,h,x,K,y,t,u,e,z,l,L,M,N,A,m,B,v,k,C,w,D,p,E,F,G){d.DimensionVisualization=function(f){function n(a){a=H.call(this,a);a.loadingMessages=!1;a._messages=null;a._dimensionVisualizations=new Map;a._markerMaterial=new C.LineMarkerMaterial({width:1,anchor:E.LineMarkerAnchor.Tip,color:m.ZEROS,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:k.RenderOccludedFlag.OccludeAndTransparent});a._dimensionLineMaterial=new p.RibbonLineMaterial({width:1,color:m.ZEROS,
renderOccluded:k.RenderOccludedFlag.OccludeAndTransparent,markerParameters:a._markerMaterial.parameters});a._offsetLineMaterial=new p.RibbonLineMaterial({width:1,color:m.ZEROS,renderOccluded:k.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:w.createStipplePatternSimple(5),stippleScaleWithLineWidth:!0});a._smallDimensionLineMaterial=new p.RibbonLineMaterial({width:1,color:m.ZEROS,renderOccluded:k.RenderOccludedFlag.OccludeAndTransparent});a._smallOffsetLineMaterial=new p.RibbonLineMaterial({width:1,
color:m.ZEROS,renderOccluded:k.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:w.createStipplePatternSimple(5),stippleScaleWithLineWidth:!0});return a}r._inherits(n,f);var H=r._createSuper(n);f=n.prototype;f.initialize=function(){var a=this.view.sharedSymbolResources?.textures;if(u.isSome(a)){const {textureRepository:b}=this.view._stage.renderView,c=new D.MarkerTextureCache(a,b);a=c.acquire("triangle");this.addHandles(t.makeHandle(()=>c.destroy()));this._markerMaterial.setParameters({textureId:a.id})}for(const b of this._lineMaterials())this.view._stage.add(b),
this.addHandles(t.makeHandle(()=>{this.view._stage.remove(b);b.dispose()}));({computations:a}=this.analysisViewData);for(const b of a)this._addComputation(b);this.addHandles([a.on("change",({added:b,removed:c})=>{for(const g of c)this._removeComputation(g);for(const g of b)this._addComputation(g)}),e.watch(()=>x.toUnitRGBA(this.analysis.style.color),b=>{for(const c of this._lineMaterials())c.setParameters({color:b})},e.syncAndInitial),e.watch(()=>this.analysis.style.lineSize,b=>{b=z.pt2px(b);this._markerMaterial.setParameters({width:b*
v.settings.markers.lineSizeFraction});this._dimensionLineMaterial.setParameters({width:b,markerParameters:this._markerMaterial.parameters});this._offsetLineMaterial.setParameters({width:Math.max(b*v.settings.offsetLine.lineSizeFraction,1)})},e.syncAndInitial),e.watch(()=>{var b=this.view.state.camera;const {fontSize:c,lineSize:g,textColor:q,textBackgroundColor:I}=this.analysis.style;var J={fontSize:c,lineSize:g,textBackgroundColor:I.clone(),textColor:q.clone()};return{camera:b,style:J}},({camera:b,
style:c})=>{for(const [g,q]of this._dimensionVisualizations)q.updateCameraDependentElements(b,g.geometry,c),q.updateLabelStyle(c)}),e.watch(()=>this.visible,b=>{for(const c of this._dimensionVisualizations.values())c.visible=b})]);this.addHandles([F.onLocaleChange(()=>this._updateMessageBundle()),e.when(()=>!this.loadingMessages,()=>{for(const b of this._dimensionVisualizations.values())b.updateUnitsMessages(this._messages)},e.sync)]);this._updateMessageBundle()};f.destroy=function(){this._dimensionVisualizations.forEach(a=>
{a.destroy()});this._dimensionVisualizations.clear()};f._addComputation=function(a){this._dimensionVisualizations.has(a)||this._dimensionVisualizations.set(a,new B.LengthDimensionVisualization({analysis:this.analysis,computation:a,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,
messages:this._messages}))};f._removeComputation=function(a){const b=this._dimensionVisualizations.get(a);u.isNone(b)||(b.destroy(),this._dimensionVisualizations.delete(a))};f._lineMaterials=function(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]};f._updateMessageBundle=async function(){this.loadingMessages=!0;try{this._messages=await G.fetchMessageBundle("esri/core/t9n/Units")}finally{this.loadingMessages=
!1}};r._createClass(n,[{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"testInfo",get:function(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const a of this._lineMaterials())a.setParameters({renderOccluded:k.RenderOccludedFlag.Occlude})}}}}]);return n}(y);h.__decorate([l.property({constructOnly:!0})],d.DimensionVisualization.prototype,"analysisViewData",
void 0);h.__decorate([l.property({constructOnly:!0,nonNullable:!0})],d.DimensionVisualization.prototype,"view",void 0);h.__decorate([l.property()],d.DimensionVisualization.prototype,"analysis",null);h.__decorate([l.property()],d.DimensionVisualization.prototype,"visible",null);h.__decorate([l.property()],d.DimensionVisualization.prototype,"loadingMessages",void 0);d.DimensionVisualization=h.__decorate([A.subclass("esri.views.3d.analysis.Dimension.DimensionVisualization")],d.DimensionVisualization);
Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});