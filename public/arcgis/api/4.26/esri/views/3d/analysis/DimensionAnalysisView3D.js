// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./AnalysisView3D ./Dimension/DimensionController ./Dimension/DimensionTool ./Dimension/DimensionVisualization ./Dimension/LengthDimensionComputation ./support/projectionUtils ../../analysis/analysisViewUtils ../../analysis/DimensionAnalysisView".split(" "),
function(m,c,b,t,u,h,p,d,E,F,G,v,w,x,y,z,A,q,n,B){b=function(f){function l(a){a=C.call(this,a);a.type="dimension-view-3d";a.tool=null;a.computations=new t;a.selectedDimension=null;a._dimensionsToComputations=new Map;a._placementTask=null;a._projectAndAlignPoint=null;return a}m._inherits(l,f);var C=m._createSuper(l);f=l.prototype;f.initialize=function(){this._projectAndAlignPoint=a=>{if(h.isNone(a))return null;const {spatialReference:e,elevationProvider:k}=this.view,g=q.applyProjectionAndElevationAlignment(a,
e,k);h.isNone(g)&&q.logFailedGeometryProjectionError(this.analysis,a.spatialReference,u.getLogger(this.declaredClass));return g};this.addHandles([n.connectAnalysisViewToTool(this,y.DimensionTool),p.on(()=>this.analysis.dimensions,"after-add",a=>this._onDimensionAdd(a.item),{onListenerAdd:a=>{for(const e of a)this._onDimensionAdd(e)},onListenerRemove:()=>{this._onDimensionsClear()}}),p.on(()=>this.analysis.dimensions,"after-remove",a=>this._onDimensionRemove(a.item))]);this._analysisVisualization=
new z.DimensionVisualization({analysisViewData:this,view:this.view});this._analysisController=new x.DimensionController({analysisViewData:this,view:this.view})};f.destroy=function(){this._placementTask=h.abortMaybe(this._placementTask);this._analysisVisualization=h.destroyMaybe(this._analysisVisualization);n.removeAnalysisViewTool(this)};f.createLengthDimensions=async function(a){this.selectedDimension=null;this._placementTask=h.abortMaybe(this._placementTask);this._placementTask=n.activateAnalysisViewTool(this,
a);return this._placementTask.promise};f._onDimensionAdd=function(a){const {computations:e,_dimensionsToComputations:k}=this;if(!k.has(a)){var g=new A.LengthDimensionComputation({dimension:a,projectAndAlignPoint:this._projectAndAlignPoint});e.add(g);k.set(a,g)}};f._onDimensionRemove=function(a){const {computations:e,_dimensionsToComputations:k}=this,g=e.findIndex(D=>D.dimension===a),r=e.getItemAt(g);r.dimension===this.selectedDimension&&(this.selectedDimension=null);e.removeAt(g);k.delete(a);h.destroyMaybe(r)};
f._onDimensionsClear=function(){this.computations.drain(a=>a.destroy());this._dimensionsToComputations.clear()};m._createClass(l,[{key:"updating",get:function(){return this._analysisVisualization?.loadingMessages??!1}},{key:"results",get:function(){return this.analysis.dimensions.map(a=>this._dimensionsToComputations.get(a).result)}},{key:"selectedComputation",get:function(){const {selectedDimension:a}=this;return h.isNone(a)?null:this._dimensionsToComputations.get(a)}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,
controller:this._analysisController}}}]);return l}(B(w.AnalysisView3D(b)));c.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property()],b.prototype,"tool",void 0);c.__decorate([d.property()],b.prototype,"updating",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"results",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"computations",void 0);c.__decorate([d.property()],b.prototype,"selectedDimension",void 0);c.__decorate([d.property()],b.prototype,
"selectedComputation",null);c.__decorate([d.property()],b.prototype,"_analysisVisualization",void 0);c.__decorate([d.property()],b.prototype,"_analysisController",void 0);c.__decorate([d.property()],b.prototype,"_dimensionsToComputations",void 0);c.__decorate([d.property()],b.prototype,"_placementTask",void 0);return b=c.__decorate([v.subclass("esri.views.3d.analysis.DimensionAnalysisView3D")],b)});