// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../core/support/WatchUpdatingTracking ./LineOfSightVisualElement ../../interactive/visualElements/LineVisualElement ../../interactive/visualElements/PointVisualElement ../../webgl-engine/lib/Material".split(" "),
function(f,y,k,g,I,J,K,q,L,m,Y,Z,aa,M,N,z,h,O,P,A,G,B){f.LineOfSightVisualization=function(d){function t(a){a=Q.call(this,a);a._lineOfSightVisualElements=[];a._computationHandles=new J;a._updatingHandles=new O.WatchUpdatingTracking;return a}y._inherits(t,d);var Q=y._createSuper(t);d=t.prototype;d.initialize=function(){this.addHandles(this._connectComputations());this._createObserverVisualization()};d.destroy=function(){this._updatingHandles=q.destroyMaybe(this._updatingHandles);this._computationHandles=
q.destroyMaybe(this._computationHandles);this._observerVisualElement=q.destroyMaybe(this._observerVisualElement)};d._createLineOfSightVisualization=function(){var a=this._configuration,b=this.view,c={view:b,attached:!0,width:a.outerWidth,innerWidth:a.innerWidth},e=g.toUnitRGBA(a.visibleOuterColor);const u=g.toUnitRGBA(a.visibleInnerColor);var v=g.toUnitRGBA(a.occludedOuterColor);const C=g.toUnitRGBA(a.occludedInnerColor),D=g.toUnitRGBA(a.undefinedOuterColor);a=g.toUnitRGBA(a.undefinedInnerColor);
e=new A.LineVisualElement({...c,color:e,innerColor:u});v=new A.LineVisualElement({...c,color:v,innerColor:C});c=new A.LineVisualElement({...c,color:D,innerColor:a});b=new G.PointVisualElement({view:b,attached:!0,...H,size:8});b=new P.LineOfSightVisualElement(e,v,c,b);this._lineOfSightVisualElements.push(b);return b};d._destroyLineOfSightVisualization=function(a){a.destroy();this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(a),1)};d._updateLineOfSightVisualization=function(a,
b,c){const e=this._configuration,{computationResult:u,inputPoints:v}=a,{start:C,end:D,intersection:R,isValid:S,isTargetVisible:T}=u;var {observer:l}=v;const p=U;p[12]=l[0];p[13]=l[1];p[14]=l[2];const E=z.subtract(V,C,l),F=z.subtract(W,D,l);l=z.subtract(X,R,l);const {visibleLineVisualElement:n,occludedLineVisualElement:w,undefinedLineVisualElement:x,targetVisualElement:r}=b;b=q.isNone(this.analysisViewData.elevationAlignedObserver)||q.isNone(a.elevationAlignedTargetLocation);b=this.visible&&!b;n.visible=
b;w.visible=b;x.visible=b;r.visible=b;r.attached=!c.interactiveAndEditable;b&&(n.geometry=null,w.geometry=null,x.geometry=null,r.geometry=a.elevationAlignedTargetLocation,S?T?(n.geometry=[[h.fromArray(E),h.fromArray(F)]],n.transform=p,n.color=g.toUnitRGBA(e.visibleOuterColor),r.color=g.toUnitRGBA(e.visibleInnerColor)):(n.geometry=[[h.fromArray(E),h.fromArray(l)]],n.transform=p,n.color=g.toUnitRGBA(e.occludedOuterColor),w.geometry=[[h.fromArray(l),h.fromArray(F)]],w.transform=p,r.color=g.toUnitRGBA(e.occludedInnerColor)):
(x.geometry=[[h.fromArray(E),h.fromArray(F)]],x.transform=p,r.color=g.toUnitRGBA(e.undefinedInnerColor)))};d._getLineOfSightVisualizationDependencies=function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:c}=this._configuration;return{computationResult:a,occludedOuterColor:b,visibleOuterColor:c,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}};d._connectComputation=function(a){const b=this._computationHandles;if(!b.has(a)){var c=this._createLineOfSightVisualization();
b.add([this._updatingHandles.add(()=>this._getLineOfSightVisualizationDependencies(a),e=>this._updateLineOfSightVisualization(a,c,e),{initial:!0,equals:()=>!1}),K.makeHandle(()=>this._destroyLineOfSightVisualization(c))],a)}};d._disconnectComputation=function(a){this._computationHandles.remove(a)};d._connectComputations=function(){return this._updatingHandles.addOnCollectionChange(()=>this.analysisViewData.computations,a=>this._onComputationsCollectionChange(a),{initial:!0,final:!0})};d._onComputationsCollectionChange=
function({added:a,removed:b}){for(const c of b)this._disconnectComputation(c);for(const c of a)this._connectComputation(c)};d._createObserverVisualization=function(){const a=g.toUnitRGBA(this._configuration.visibleInnerColor),b=new G.PointVisualElement({view:this.view,attached:!1,color:a,...H});this._observerVisualElement=b;this.addHandles(this._updatingHandles.add(()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible}),
({observer:c,interactiveAndEditable:e,visible:u})=>{q.isNone(c)||e||!u?b.attached=!1:(b.geometry=c,this._observerVisualElement.attached=!0)},L.initial))};y._createClass(t,[{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"test",get:function(){return{disablePartialOcclusion:()=>{for(const a of this._lineOfSightVisualElements)a.visibleLineVisualElement.renderOccluded=
B.RenderOccludedFlag.Occlude,a.occludedLineVisualElement.renderOccluded=B.RenderOccludedFlag.Occlude,a.undefinedLineVisualElement.renderOccluded=B.RenderOccludedFlag.Occlude},visualizations:this._lineOfSightVisualElements}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}}]);return t}(I);k.__decorate([m.property({constructOnly:!0})],f.LineOfSightVisualization.prototype,"analysis",void 0);k.__decorate([m.property({constructOnly:!0})],f.LineOfSightVisualization.prototype,
"analysisViewData",void 0);k.__decorate([m.property({constructOnly:!0})],f.LineOfSightVisualization.prototype,"view",void 0);k.__decorate([m.property({readOnly:!0})],f.LineOfSightVisualization.prototype,"visible",null);k.__decorate([m.property()],f.LineOfSightVisualization.prototype,"updating",null);k.__decorate([m.property()],f.LineOfSightVisualization.prototype,"interactiveAndEditable",null);k.__decorate([m.property()],f.LineOfSightVisualization.prototype,"test",null);k.__decorate([m.property()],
f.LineOfSightVisualization.prototype,"_configuration",null);f.LineOfSightVisualization=k.__decorate([M.subclass("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],f.LineOfSightVisualization);const H={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},V=h.create(),W=h.create(),X=h.create(),U=N.create();Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});