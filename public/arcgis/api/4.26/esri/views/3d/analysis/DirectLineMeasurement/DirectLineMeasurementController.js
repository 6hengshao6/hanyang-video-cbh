// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/quantityUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/geometryEngine ../../../../geometry/Polyline ../../../../geometry/projection ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/geodesicUtils ../interfaces ../support/projectionUtils ../support/UnitNormalizer".split(" "),
function(f,w,p,E,F,G,l,t,m,u,O,P,Q,H,y,q,I,J,h,x,v,z,A,K){const L=G.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController");f.DirectLineMeasurementController=function(g){function r(a){a=M.call(this,a);a._unitNormalizer=new K.UnitNormalizer;a._handles=new F;a._tempStartPosition=q.create();a._tempEndPosition=q.create();a._tempCornerPosition=q.create();return a}w._inherits(r,g);var M=w._createSuper(r);g=r.prototype;g.initialize=function(){const a=this.view.spatialReference;
var c=x.getSphericalPCPF(a);this._sphericalPCPF=c=c===x.SphericalECEFSpatialReference?x.WGS84ECEFSpatialReference:c;const e=h.canProjectWithoutEngine(a,c);this._unitNormalizer.spatialReference=e?c:a;this._handles.add([m.watch(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:b,startPoint:d})=>{b.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(d)},m.syncAndInitial),m.watch(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:b,
endPoint:d})=>{b.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(d)},m.syncAndInitial),m.watch(()=>({result:this._computedResult,viewData:this.viewData}),({result:b,viewData:d})=>{d.result=b},m.syncAndInitial)])};g.destroy=function(){this._handles=l.destroyMaybe(this._handles)};g._applyProjectionAndElevationAlignment=function(a){if(l.isNone(a))return a;const {spatialReference:c,elevationProvider:e}=this.view,b=A.applyProjectionAndElevationAlignment(a,c,e);return l.isNone(b)?(A.logFailedGeometryProjectionError(this.analysis,
a.spatialReference,L),null):b};g._euclideanDistances=function(a,c){var e=a.clone();e.z=c.z;const b=this._tempStartPosition;var d=this._tempEndPosition,k=this._tempCornerPosition,n=this.view.spatialReference;const B=this._sphericalPCPF;n=h.canProjectWithoutEngine(n,B)?B:n;h.projectPointToVector(a,b,n);h.projectPointToVector(c,d,n);h.projectPointToVector(e,k,n);e=y.distance(b,d);d=y.distance(k,d);a=Math.abs(c.z-a.z);c=N=>this._unitNormalizer.normalizeDistance(N);k=c(e);d=c(d);a=c(a);return{direct:t.createQuantity(k,
"meters"),horizontal:t.createQuantity(d,"meters"),vertical:t.createQuantity(a,"meters")}};g._geodesicDistance=function(a,c,e){var b=a.spatialReference;const d=new J({spatialReference:b});d.addPath([a,c]);b=b.isGeographic&&v.isSupported(b)?v.geodesicLengths([d],"meters")[0]:b.isWebMercator?I.geodesicLength(d,"meters"):null;a=l.isSome(b)?b:this._fallbackGeodesicDistance(a,c,e);return t.createQuantity(a,"meters")};g._fallbackGeodesicDistance=function(a,c,e){return h.projectPointToWGS84ComparableLonLat(a,
C)&&h.projectPointToWGS84ComparableLonLat(c,D)?(a=new v.InverseGeodeticSolverResult,v.inverseGeodeticSolver(a,C,D),a.distance):e};w._createClass(r,[{key:"_computedResult",get:function(){const {elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,measurementMode:e}=this.viewData;if(l.isNone(a)||l.isNone(c))return null;const b=this._euclideanDistances(a,c),d=this._geodesicDistance(a,c,b.horizontal.value),k=e===z.MeasurementMode.Geodesic||e===z.MeasurementMode.Auto&&1E5<b.horizontal.value?"geodesic":
"euclidean";return{mode:k,distance:"euclidean"===k?b.direct:d,directDistance:b.direct,horizontalDistance:b.horizontal,verticalDistance:b.vertical,geodesicDistance:d}}}]);return r}(E);p.__decorate([u.property()],f.DirectLineMeasurementController.prototype,"view",void 0);p.__decorate([u.property()],f.DirectLineMeasurementController.prototype,"analysis",void 0);p.__decorate([u.property()],f.DirectLineMeasurementController.prototype,"viewData",void 0);p.__decorate([u.property()],f.DirectLineMeasurementController.prototype,
"_computedResult",null);f.DirectLineMeasurementController=p.__decorate([H.subclass("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],f.DirectLineMeasurementController);const C=q.create(),D=q.create();Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});