// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/colorUtils ../../../../../core/Evented ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../../RenderObject ../dragEventPipeline3D ../ManipulatorType ../settings ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces".split(" "),
function(D,z,K,L,M,N,A,O,l,t,P,x,m,Q,E,k,B,C,R,F,G,H,n){C=function(p){function w(a){var b=S.call(this);b._radius=B.DISC_RADIUS;b.events=new L;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b._createManipulator();b.forEachManipulator(d=>b._tool.manipulators.add(d));return b}z._inherits(w,p);var S=z._createSuper(w);p=w.prototype;p.destroy=function(){this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()})};p.forEachManipulator=function(a){a(this._manipulator,E.ManipulatorType.TRANSLATE_Z)};
p.createGraphicDragPipeline=function(a,b,d){const e=N.unwrap(b.graphic.geometry).spatialReference;return R.createGraphicMoveDragPipeline(b,d,f=>this.createDragPipeline((q,g,c,u,y)=>{({steps:g,cancel:c}=a(q,g,c,u,y));return f(q,g,c)},e),this._view.state.viewingMode)};p.createDragPipeline=function(a,b){const d=this._view;return H.createManipulatorDragEventPipeline(this._manipulator,(e,f,q,g,c)=>{f=f.next(u=>({...u,manipulatorType:E.ManipulatorType.TRANSLATE_Z})).next(Q.screenToZConstrained(d,e.renderLocation,
b)).next(H.addScreenDelta());a(e,f,q,g,c)})};p._updateManipulator=function(){var a=this._radius/B.DISC_RADIUS;const b=k.settings.zManipulator.height*a;var d=k.settings.zManipulator.coneHeight*a;const e=k.settings.zManipulator.coneWidth*a;a*=k.settings.zManipulator.width;var f=[t.fromValues(0,0,0),t.fromValues(0,0,b)];const q=[t.fromValues(0,0,0),t.fromValues(0,0,b+d)],g=(r=>{const h=O.create();A.translate(h,h,[0,0,b]);A.rotateX(h,h,Math.PI/2);r&&(r=1+2*r/e,A.scale(h,h,[r,r,r]));return h})(0);var c=
(r,h)=>{h=K.darken(k.settings.zManipulator.color,h);return[h.r/255,h.g/255,h.b/255,k.settings.zManipulator.color.a*r]};const u=x.createManipulatorMaterial(c(1,.25),G.RenderOccludedFlag.Occlude),y=x.createManipulatorMaterial(c(1,0),G.RenderOccludedFlag.Occlude),I=x.createManipulatorMaterial(c(.7,0),k.settings.zManipulator.renderOccluded);c=x.createManipulatorMaterial(c(.85,0),k.settings.zManipulator.renderOccluded);f=F.createTubeGeometry(u,f,a/2,16,!1);d=F.createConeGeometry(u,d,e/2,16,!1);d.transformation=
g;this._manipulator.renderObjects=[new m.RenderObject(d,n.ManipulatorStateFlags.Unfocused),new m.RenderObject(f,n.ManipulatorStateFlags.Unfocused),new m.RenderObject(d.instantiate({material:y}),n.ManipulatorStateFlags.Focused),new m.RenderObject(f.instantiate({material:y}),n.ManipulatorStateFlags.Focused),new m.RenderObject(d.instantiate({material:I}),n.ManipulatorStateFlags.Unfocused),new m.RenderObject(f.instantiate({material:I}),n.ManipulatorStateFlags.Unfocused),new m.RenderObject(d.instantiate({material:c}),
n.ManipulatorStateFlags.Focused),new m.RenderObject(f.instantiate({material:c}),n.ManipulatorStateFlags.Focused)];this._manipulator.radius=a/2+2;this._manipulator.collisionType={type:"line",paths:[q]}};p._createManipulator=function(){const a=new P.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});a.applyObjectTransform=b=>{var d=this._view.state.camera,e=J;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,
e);const f=l.dist(d.eye,e),q=d.computeRenderPixelSizeAtDist(f);var g=l.subtract(v,e,d.eye);l.normalize(g,g);var c=T;this._view.renderCoordsHelper.worldUpAtPosition(J,c);e=Math.abs(l.dot(g,c));g=l.cross(v,g,c);c=l.cross(v,g,c);e=M.clamp(e,.01,1);d=1-Math.sqrt(1-e*e)/e/d.fullWidth;e=this._radius/B.DISC_RADIUS*k.settings.zManipulator.width;l.scale(c,l.normalize(c,c),(1/d-1)*f+q*e);b[12]-=v[0];b[13]-=v[1];b[14]-=v[2]};this._manipulator=a;this._updateManipulator()};z._createClass(w,[{key:"radius",get:function(){return this._radius},
set:function(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]);return w}(C.Manipulation);const J=t.create(),v=t.create(),T=t.create();D.MoveZManipulation=C;Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})});