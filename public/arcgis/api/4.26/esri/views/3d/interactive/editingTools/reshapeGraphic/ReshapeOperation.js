// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../geometry ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Evented ../../../../../core/HandleOwner ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/quantityUtils ../../../../../core/reactiveUtils ../../../../../core/unitUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/Polyline ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/plane ../../../../../geometry/support/vectorStacks ../../../../../layers/graphics/dehydratedFeatures ../../../../../support/elevationInfoUtils ../../../../../symbols/support/utils ../../Manipulator3D ../../manipulatorUtils ../../RenderObject ../../SegmentLabels3D ../../SnappingVisualizer3D ../dragEventPipeline3D ../ManipulatorType ../manipulatorUtils ../settings ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ../manipulations/moveUtils ../manipulations/MoveXYGraphicManipulation ./edgeOffsetUtils ../../visualElements/OutlineVisualElement ../../../layers/graphics/GraphicState ../../../webgl-engine/lib/GeometryUtil ../../../../input/IViewEvents ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces ../../../../interactive/editGeometry/EditGeometryOperations ../../../../interactive/editGeometry/interfaces ../../../../interactive/snapping/SnappingContext ../../../../interactive/snapping/SnappingDragPipelineStep ../../../../interactive/tooltip/ReshapeTooltipInfos ../../../../interactive/tooltip/Tooltip ../../../../interactive/tooltip/TranslateTooltipInfos ../../../../support/automaticAreaMeasurementUtils ../../../../support/automaticLengthMeasurementUtils ../../../../support/euclideanLengthMeasurementUtils ../../../../support/geodesicLengthMeasurementUtils ../../../../../geometry/SpatialReference".split(" "),
function(u,V,v,Ja,na,Ka,oa,pa,qa,N,g,G,F,ra,w,La,sa,ta,H,ba,ua,va,wa,xa,ca,O,da,W,D,y,ya,ea,T,fa,X,m,za,Aa,x,Y,Ba,I,ha,Ca,J,ia,z,r,Da,Z,ja,ka,la,Ea,K,Fa,P,aa,Ga,Ha){u.ReshapeOperation=function(h){function Q(a){a=Ia.call(this,a);a._vertexManipulatorMaterial=D.createManipulatorMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.vertex.color),m.settings.reshapeManipulators.vertex.renderOccluded);a._vertexManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.vertex.outlineColor),
m.settings.reshapeManipulators.vertex.renderOccluded);a._vertexManipulatorHoverOutlineMaterial=D.createManipulatorOutlineMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.vertex.hoverOutlineColor),m.settings.reshapeManipulators.vertex.renderOccluded);a._edgeManipulatorMaterial=D.createManipulatorMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.edge.color),m.settings.reshapeManipulators.edge.renderOccluded);a._edgeManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.edge.outlineColor),
m.settings.reshapeManipulators.edge.renderOccluded);a._edgeOffsetManipulatorMaterial=D.createManipulatorMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.edgeOffset.color),m.settings.reshapeManipulators.edgeOffset.renderOccluded,!1);a._edgeOffsetManipulatorHoverMaterial=D.createManipulatorMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.edgeOffset.hoverColor),m.settings.reshapeManipulators.edgeOffset.renderOccluded,!1);a._selectedManipulatorMaterial=D.createManipulatorMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.selected.color),
m.settings.reshapeManipulators.selected.renderOccluded);a._selectedManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.selected.outlineColor),m.settings.reshapeManipulators.selected.renderOccluded);a._selectedManipulatorHoverOutlineMaterial=D.createManipulatorOutlineMaterial(m.settings.colorToVec4(m.settings.reshapeManipulators.selected.hoverOutlineColor),m.settings.reshapeManipulators.selected.renderOccluded);a._selectedIndex=0;a._manipulatorHandles=
new qa;a._manipulatorInfos=[];a._numGrabbing=0;a._numDragging=0;a._reshapeEventState=t.NONE;a._recreatingManipulators=!1;a.outputGeometry=null;a._vertexLaserLineVisualElement=null;return a}V._inherits(Q,h);var Ia=V._createSuper(Q);h=Q.prototype;h.initialize=function(){const {graphic:a,view:b}=this,c=this._graphicState=new Ca.GraphicState({graphic:a});this._tooltip=new Ea.Tooltip({view:b});this.addHandles([F.watch(()=>c.displaying,d=>{for(const e of this._manipulatorInfos)e.manipulator.available=d}),
F.watch(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:d,enabled:e,edgeOffsetEnabled:f})=>{g.isSome(d)&&(d.visible=e,d.edgeDistance=f?"far":"default")},F.initial),F.when(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),F.initial),this.view.trackGraphicState(c)])};h.destroy=function(){this._segmentLabels=g.destroyMaybe(this._segmentLabels);this._tooltip=g.destroyMaybe(this._tooltip);this._removeManipulators()};h.removeSelectedVertices=
function(){const a=this._manipulatorInfos.filter(b=>b.manipulator.selected&&"vertex"===b.type);this._removeVertices(a)};h.onManipulatorSelectionChanged=function(){this.emit("manipulators-changed")};h._removeManipulators=function(){this._manipulatorHandles.removeAll();this._moveManipulation=g.destroyMaybe(this._moveManipulation);this._graphicMoveManipulation=g.destroyMaybe(this._graphicMoveManipulation);this.manipulators.removeAll();this._manipulatorInfos=[];this._numDragging=this._numGrabbing=0};
h._createManipulators=function(a){if(!g.isNone(this._editGeometryOperations)){var b=O.getGraphicEffectiveElevationInfo(this.graphic);for(const c of this._editGeometryOperations.data.components){const d=a?.byComponentIndex.get(c.index);for(const e of c.vertices){const f=d?.has(e.index);this._createVertexOrEdgeManipulator(e,b,f)}for(const e of c.edges)this._createVertexOrEdgeManipulator(e,b)}this._createGraphicMoveManipulation();this._createMoveManipulation(b);this._createVisualElements()}};h.redo=
function(){if(g.isNone(this._editGeometryOperations))return null;const a=this._editGeometryOperations.redo();g.isSome(a)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators());return a};h.undo=function(){if(g.isNone(this._editGeometryOperations))return null;this.emit("undo");const a=this._editGeometryOperations.undo();g.isSome(a)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators());return a};h._recreateManipulators=
function(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)};h._recreateEditGeometryAndManipulators=function(a){const b={byComponentIndex:new Map};if(g.isSome(a)&&g.isSome(this.inputGeometry)&&va.hasCompatibleTopology(a,this.inputGeometry))for(const c of this._manipulatorInfos)if("vertex"===c.type&&c.manipulator.selected){const {index:d,component:{index:e}}=c.handle,{byComponentIndex:f}=
b,k=f.get(e)||new Set;k.add(d);f.set(e,k)}this._recreatingManipulators=!0;this._removeManipulators();this._tooltip.clear();this._editGeometryOperations=g.destroyMaybe(this._editGeometryOperations);this._segmentLabels=g.destroyMaybe(this._segmentLabels);g.isNone(a)||(this._editGeometryOperations=Da.EditGeometryOperations.fromGeometry(a,this.view.state.viewingMode),this._createManipulators(b),this._segmentLabels=new ya.SegmentLabels3D({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,
elevationInfo:O.getGraphicEffectiveElevationInfo(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}));this._recreatingManipulators=!1};h._perGraphicManipulatorDragAction=function(a,b){if("end"===b.action)return b;let c=0;const d=[],e=this._manipulatorInfos.some(f=>"vertex"===f.type&&f.manipulator.selected);a=a===L.SELECTED_OR_ALL&&e;for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.grabbing||
a&&!f.manipulator.selected||d.push(f),c++);if(0===d.length)return b;this._moveVertices(d,b);if(d.length===c){this._updateEventState(t.MOVING);if(this.destroyed)return b;this.emit("move",{type:"move",dx:b.screenDeltaX,dy:b.screenDeltaY,mover:this.graphic})}else{this._updateEventState(t.RESHAPING);if(this.destroyed)return b;this.emit("reshape",{type:"reshape",mover:this.graphic})}return b};h._isMultiVertexSelection=function(){return 1<this._manipulatorInfos.reduce((a,b)=>"vertex"===b.type&&b.manipulator.selected?
a+1:a,0)};h._perVertexManipulatorDragAction=function(a){this._updateEventState(t.RESHAPING);if(!this.destroyed){var {mapDeltaX:b,mapDeltaY:c,mapDeltaZ:d}=a;if(b||c||d){var e=[];for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.selected&&!f.manipulator.grabbing||f===a.info)&&e.push(f);this._moveVertices(e,a,Z.AccumulationBehaviour.ACCUMULATE_STEPS);this.emit("reshape",{type:"reshape",mover:this.graphic})}}};h._updateEventState=function(a){if(a===this._reshapeEventState)return!1;
switch(a){case t.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case t.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case t.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case t.MOVING:switch(this._reshapeEventState){case t.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case t.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||
this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case t.RESHAPING:switch(this._reshapeEventState){case t.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case t.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const b=this._reshapeEventState!==a;this._reshapeEventState=a;return b};h._createGraphicMoveManipulation=function(){const {tool:a,
view:b}=this;this._graphicMoveManipulation=new Ba.MoveXYGraphicManipulation({tool:a,view:b,graphicState:this._graphicState});if(this.enableMoveGraphic){let c=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((d,e,f)=>{e.next(k=>this._trackNumDragging(k)).next(k=>{"start"===k.action&&(c=g.unwrap(this._editGeometryOperations).createUndoGroup());return k}).next(k=>this._perGraphicManipulatorDragAction(L.ALL,k)).next(k=>{this._updateTranslateGraphicTooltip(x.ManipulationType.XY,
k);return k}).next(k=>{"end"===k.action&&(this._tooltip.clear(),c=g.removeMaybe(c))});f.next(()=>this._onDragCancel(!0,()=>c=g.removeMaybe(c)))}));this._graphicMoveManipulation.forEachManipulator(d=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(d,!1)))}else this._graphicMoveManipulation.forEachManipulator(c=>{c.grabbable=!1;c.cursor=null});this._graphicMoveManipulation.forEachManipulator(c=>this._manipulatorHandles.add(c.events.on("immediate-click",d=>{this._manipulatorInfos.some(e=>
e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...d,graphic:this.graphic});d.stopPropagation()})))};h._createMoveManipulation=function(a){const {graphic:b,handles:c,tool:d,view:e}=this,f=this._graphicState;this._moveManipulation=new x.MoveManipulation({tool:d,view:e,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&X.canMoveZ(b),snapToScene:!1,radius:x.MoveManipulation.radiusForSymbol(b.symbol)});this._moveManipulation.forEachManipulator(l=>c.add([l.events.on("immediate-click",
n=>{this._moveManipulation.zManipulation.hasManipulator(l)||this._manipulatorInfos.some(q=>q.manipulator.selected)||this.emit("immediate-click",{...n,graphic:b});n.stopPropagation()}),this._watchAndUpdateGrabState(l,!1)]));var k=l=>n=>{c.add(n.events.on("focus-changed",({action:q})=>{"focus"===q&&this._tooltipOptions.enabled?this._updateTranslateTooltip(l):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(k(x.ManipulationType.XY));this._moveManipulation.xyAxisManipulation.forEachManipulator(k(x.ManipulationType.XY_AXIS));
this._moveManipulation.zManipulation.forEachManipulator(k(x.ManipulationType.Z));this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};k=g.unwrap(b.geometry).spatialReference;c.add([this._moveManipulation.createDragPipeline((l,n,q,B,A)=>{const {snappingStep:R,cancelSnapping:C}=ka.createSnapDragEventPipelineStep({predicate:p=>!!p.info,snappingManager:d.snappingManager,snappingContext:new ja.SnappingContext({editGeometryOperations:g.unwrap(this._editGeometryOperations),elevationInfo:a,
pointer:A,excludeFeature:b,visualizer:new ea.SnappingVisualizer3D}),updatingHandles:this.updatingHandles,useZ:!1});B=B.next(p=>{this._onDragCancel();return p}).next(C);q=q.next(p=>this._trackNumDragging(p)).next(p=>{const M=this._manipulatorInfos.filter(ma=>"vertex"===ma.type&&ma.manipulator.selected);return p.manipulatorType===fa.ManipulatorType.TRANSLATE_XY&&1===M.length?{...p,info:M[0],snapOrigin:M[0].handle.pos}:p}).next(z.sceneSnappingAtLocation(this.view,a,b)).next(...R).next(z.addMapDelta()).next(p=>
this._perGraphicManipulatorDragAction(L.SELECTED_OR_ALL,p)).next(p=>{this._updateTranslateTooltip(l,p);return p});return{steps:q,cancel:B}},a,k,b),F.watch(()=>f.displaying,()=>this._updateMoveManipulationPosition(),F.initial),f.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),F.watch(()=>f.isDraped,l=>{this._updateMoveManipulationPosition();l?c.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),"align-move-manipulation"):
c.remove("align-move-manipulation")},F.initial)])};h._createVisualElements=function(){const {graphic:a,view:b}=this,c=za.createVisualElements({view:b,graphic:a,forEachManipulator:d=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(d);this._moveManipulation.forEachManipulator(d);for(const e of this._manipulatorInfos)d(e.manipulator,fa.ManipulatorType.TRANSLATE_XY)}},onManipulatorsChanged:d=>this.on("manipulators-changed",d)});g.isSome(c)&&(this._outlineVisualElement=
c.visualElement instanceof ha.OutlineVisualElement?c.visualElement:null);g.isSome(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}));this._manipulatorHandles.add(c)};h._createEdgeOffsetManipulator=function(a,b=O.getGraphicEffectiveElevationInfo(this.graphic)){var c=m.settings.reshapeManipulators.edgeOffset,d=c.size/2,e=d+c.collisionPadding;d/=e;const f=
d*Math.sqrt(3)/2;g.isNone(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=J.createExtrudedTriangle(this._edgeOffsetManipulatorMaterial,f,d/2,d/2,c.height,c.offset));g.isNone(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=J.createExtrudedTriangle(this._edgeOffsetManipulatorMaterial,-f,d/2,d/2,c.height,-c.offset));d=[new y.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate(),r.ManipulatorStateFlags.Unfocused),
new y.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),r.ManipulatorStateFlags.Focused),new y.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate(),r.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),r.ManipulatorStateFlags.Focused)];e=new W.Manipulator3D({view:this.view,renderObjects:d,elevationInfo:"on-the-ground"!==
b.mode||da.isVolumetricSymbol(this.graphic.symbol)?{mode:"absolute-height",offset:0}:b,worldOriented:!1,focusMultiplier:1,radius:e,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:ba.fromValues(0,0,1)},collisionPriority:1,metadata:{deleting:!1}});d=new W.Manipulator3D({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",
metadata:{deleting:!1}});const k={manipulator:e,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:d,elevationInfo:b,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(k,c.minSquaredEdgeLength);this._updateEdgeOffsetManipulator(k);a=[];for(var l of[k.handle.leftVertex,k.handle.rightVertex])c=this._getManipulatorInfoFromHandle(l),g.isSome(c)&&a.push(c.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(k)));k.locationUpdateHandle=N.handlesGroup(a);
this._manipulatorHandles.add(k.locationUpdateHandle,e);this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!0),this._watchAndUpdateGrabState(d,!0)],e);this._manipulatorHandles.add(z.createManipulatorDragEventPipeline(e,this._createEdgeOffsetPipeline(k,b)),e);this._manipulatorHandles.add(z.createManipulatorDragEventPipeline(d,(n,q,B,A)=>{if("touch"===A)this._createEdgeOffsetPipeline(k,b)(n,q,B);else if(this.enableMoveGraphic){A=this.graphic;const R=g.isSome(A.geometry)?A.geometry.spatialReference:
null;q.next(C=>this._trackNumDragging(C)).next(z.dragAtLocation(this.view,n.elevationAlignedLocation)).next(T.screenToMapXYAtLocation(this.view,n.elevationAlignedLocation,b,R,A)).next(z.addScreenDelta()).next(z.addMapDelta()).next(C=>this._perGraphicManipulatorDragAction(L.ALL,C)).next(C=>{this._updateTranslateGraphicTooltip(x.ManipulationType.XY,C);return C}).next(C=>{"end"===C.action&&this._tooltip.clear()});B.next(()=>this._onDragCancel(!n.metadata.deleting))}}),e);l=n=>{this._manipulatorInfos.some(q=>
q.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...n,graphic:this.graphic});n.stopPropagation()};this._manipulatorHandles.add([e.events.on("immediate-click",l),d.events.on("immediate-click",l),e.events.on("focus-changed",({action:n})=>{const q=this._tooltipOptions;"focus"===n&&q.enabled?(n=this._tooltip.info=new la.ReshapeEdgeOffsetTooltipInfo({tooltipOptions:q}),this._updateTooltipAreaOrTotalLength(n)):this._tooltip.clear()})],e);this._manipulatorInfos.push(k);this.manipulators.add(e);
this.manipulators.add(d);this.emit("manipulators-changed");return k};h._autoHideEdgeOffsetManipulator=function(a,b){const c=a.manipulator,d=a.edgeManipulator,e=()=>{a.visibilityHandle=g.removeMaybe(a.visibilityHandle);var f=this._getManipulatorInfoFromHandle(a.handle.leftVertex);const k=this._getManipulatorInfoFromHandle(a.handle.rightVertex);f=g.isSome(f)&&g.isSome(k)&&I.screenEdgeLengthSquared(f.manipulator.renderLocation,k.manipulator.renderLocation,this.view.state.camera)<b;if(!c.focused&&!d.focused||
f)c.grabbable=!f,d.grabbable=!f,a.visibilityHandle=N.handlesGroup([c.disableDisplay(),{remove:()=>{c.grabbable=!0;d.grabbable=this.enableMoveGraphic}}])};this._manipulatorHandles.add([c.events.on("focus-changed",e),d.events.on("focus-changed",e),{remove:()=>{g.removeMaybe(a.visibilityHandle);d.metadata.deleting=!0;this.manipulators.remove(d)}}],c);e()};h._updateEdgeOffsetManipulator=function(a){this._updateManipulatorPosition(a);var {coordinateHelper:b}=g.unwrap(this._editGeometryOperations).data;
b=I.createEdgeOffsetIntersectionPlane(this.view,a.manipulator.elevationAlignedLocation,I.createEdgeOffsetOperation(b,a.handle,g.unwrap(a.manipulator.elevationInfo)));var c=this._getManipulatorInfoFromHandle(a.handle.leftVertex),d=this._getManipulatorInfoFromHandle(a.handle.rightVertex);g.isNone(c)||g.isNone(d)||(c=c.manipulator.renderLocation,d=d.manipulator.renderLocation,b=g.isSome(b)?I.edgeOffsetRotationMatrix(b,c,d):ta.IDENTITY,a.manipulator.modelTransform=b,a.edgeManipulator.elevationAlignedLocation=
a.manipulator.elevationAlignedLocation,a.edgeManipulator.modelTransform=b,b=H.length(H.subtract(U,c,d))/2,a.edgeManipulator.collisionType={type:"line",paths:[[[-b,0,0],[b,0,0]]]})};h._createEdgeOffsetPipeline=function(a,b){return(c,d,e)=>{this._clearSelection();const {step:f,cleanup:k}=this._initializeEdgeOffset(a,b);d.next(l=>this._trackNumDragging(l)).next(z.dragAtLocation(this.view,c.elevationAlignedLocation)).next(f).next(T.screenToRenderPlaneFromEvent(this.view)).next(T.convertToMapCoordinates(this.view,
g.unwrap(this._editGeometryOperations).data.spatialReference)).next(z.addMapDelta()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(a)).next(this._showEdgeOffsetTooltip()).next(l=>{"end"===l.action&&k()});e.next(()=>{c.metadata.deleting||(k(),this._onDragCancel())})}};h._initializeEdgeOffset=function(a,b){const c=g.unwrap(this._editGeometryOperations),d=I.createEdgeOffsetOperation(c.data.coordinateHelper,a.handle,b);b=c.createUndoGroup();const e=I.createEdgeOffsetIntersectionPlane(this.view,
a.manipulator.elevationAlignedLocation,d);if(d.requiresSplitEdgeLeft){var f=this._getManipulatorInfoFromHandle(a.handle.leftVertex.leftEdge);g.isSome(f)&&this._splitEdgeManipulator(f,1)}d.requiresSplitEdgeRight&&(f=this._getManipulatorInfoFromHandle(a.handle.rightVertex.rightEdge),g.isSome(f)&&this._splitEdgeManipulator(f,0));const k=()=>new ua({paths:[[a.handle.leftVertex.pos,a.handle.rightVertex.pos]],spatialReference:c.data.spatialReference}),l=new ha.OutlineVisualElement({view:this.view,isDraped:this._graphicState.isDraped,
geometry:k(),elevationInfo:a.elevationInfo,width:m.settings.visualElements.lineGraphics.outline.width,color:m.settings.colorToVec4(m.colors.main),attached:!0});let n;const q=()=>{this._cleanEdgeOffsetCollapsedEdges(a);n=g.removeMaybe(n)};f=this.on("undo",q);n=N.handlesGroup([N.destroyHandle(l),F.watch(()=>this._graphicState.isDraped,B=>l.isDraped=B),this._graphicState.on("changed",()=>l.geometry=k()),b,f]);return{step:B=>g.isNone(d)||g.isNone(e)?(q(),null):{...B,operation:d,plane:e},cleanup:q}};h._applyEdgeOffsetStep=
function(a){return b=>{if(this.destroyed||g.isNone(b.operation))return b;this._updateEventState(t.RESHAPING);const {mapDeltaX:c,mapDeltaY:d,mapDeltaZ:e}=b;if(c||d||e)this._offsetEdge(a,b),this.emit("reshape",{type:"reshape",mover:this.graphic});return b}};h._applyComputeEdgeOffsetDistanceStep=function(){return a=>{const {operation:b,mapEnd:c}=a;if(g.isNone(b)||g.isNone(c))return a;"start"===a.action&&b.selectArrowFromStartPoint(c);return{...a,signedDistance:b.signedDistanceToPoint(c)}}};h._showEdgeOffsetTooltip=
function(){return a=>{const {mapEnd:b,signedDistance:c,operation:d}=a;var e=this._tooltip,f=this._tooltipOptions;if(!f.enabled||g.isNone(c))return e.clear(),a;let k=e.info;if(g.isNone(k)||"reshape-edge-offset"!==k.type)k=e.info=new la.ReshapeEdgeOffsetTooltipInfo({tooltipOptions:f});var {coordinateHelper:l}=g.unwrap(this._editGeometryOperations).data;e=k;if("end"===a.action)f=G.zeroMeters;else a:{f=c*d.selectedArrow;var n=d.plane;if(this._graphicState.isDraped){const q=l.toXYZ(l.pointToVector(b));
n=wa.projectPoint(n,q,xa.sv3d.get());l=Ga.geodesicDistance(n,q,l.spatialReference);if(g.isSome(l)){f=G.createLength(l.value*Math.sign(f),l.unit);break a}}f=G.createLength(f*ra.getMetersPerUnitForSR(b.spatialReference),"meters")}e.distance=f;this._updateTooltipAreaOrTotalLength(k);return a}};h._cleanEdgeOffsetCollapsedEdges=function(a){var b=a.handle.leftVertex.leftEdge?.leftVertex,c=a.handle.leftVertex;const d=a.handle.rightVertex.rightEdge?.rightVertex,e=a.handle.rightVertex,f=g.unwrap(this._editGeometryOperations).data.coordinateHelper;
a=[];b&&1E-6>f.distance(b.pos,c.pos)&&(b=this._getManipulatorInfoFromHandle(c),g.isSome(b)&&a.push(b));if(1E-6>f.distance(c.pos,e.pos)||d&&1E-6>f.distance(d.pos,e.pos))c=this._getManipulatorInfoFromHandle(e),g.isSome(c)&&a.push(c);a.length&&this._removeVertices(a)};h._computeVertexManipulatorSizeAndOutline=function(a){const b=a.size/2,c=b+a.collisionPadding;return{size:b/c,outlineSize:(b+a.outlineSize)/c}};h._createVertexOrEdgeManipulator=function(a,b=O.getGraphicEffectiveElevationInfo(this.graphic),
c=!1){if("edge"===a.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(a,b);if(!this.enableMidpoints)return null}if(g.isNone(this._vertexManipulatorGeometry)||g.isNone(this._vertexManipulatorOutlineGeometry)){const {size:l,outlineSize:n}=this._computeVertexManipulatorSizeAndOutline(m.settings.reshapeManipulators.vertex);this._vertexManipulatorGeometry=J.createSphereGeometry(this._vertexManipulatorMaterial,l,16,16);this._vertexManipulatorOutlineGeometry=J.createSphereGeometry(this._vertexManipulatorOutlineMaterial,
n,16,16)}if(g.isNone(this._edgeManipulatorGeometry)||g.isNone(this._edgeManipulatorOutlineGeometry)){const {size:l,outlineSize:n}=this._computeVertexManipulatorSizeAndOutline(m.settings.reshapeManipulators.edge);this._edgeManipulatorGeometry=J.createSphereGeometry(this._edgeManipulatorMaterial,l,16,16);this._edgeManipulatorOutlineGeometry=J.createSphereGeometry(this._edgeManipulatorOutlineMaterial,n,16,16)}const d=g.isSome(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[new y.RenderObject(this._vertexManipulatorGeometry.instantiate(),
E.Vertex|r.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate(),E.Vertex|r.ManipulatorStateFlags.Unfocused|r.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),E.Vertex|r.ManipulatorStateFlags.Focused|r.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),
r.ManipulatorStateFlags.Selected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),r.ManipulatorStateFlags.Selected|r.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),r.ManipulatorStateFlags.Selected|r.ManipulatorStateFlags.Focused)];this.enableMidpoints&&d.push(new y.RenderObject(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),
E.Edge|r.ManipulatorStateFlags.Focused|r.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),E.Edge|r.ManipulatorStateFlags.Focused|r.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorGeometry.instantiate(),E.Edge|r.ManipulatorStateFlags.Unfocused|r.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate(),E.Edge|r.ManipulatorStateFlags.Unfocused|
r.ManipulatorStateFlags.Unselected));const e=new W.Manipulator3D({view:this.view,renderObjects:d,elevationInfo:b,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});e.selected=c;this._setTypeSpecificManipulatorSettings(e,a,b);const f="edge"===a.type?{manipulator:e,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:e,handle:a,type:"vertex",selectedIndex:0};this._manipulatorInfos.push(f);this.manipulators.add(e);
this._updateManipulatorPosition(f);if("edge"===f.type){a=[];for(var k of[f.handle.leftVertex,f.handle.rightVertex])c=this._getManipulatorInfoFromHandle(k),g.isSome(c)&&a.push(c.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(f)));f.locationUpdateHandle=N.handlesGroup(a);this._manipulatorHandles.add(f.locationUpdateHandle,e)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!0),e);k=z.createManipulatorDragEventPipeline(e,(l,n,q,B)=>{let A=null;const {snappingStep:R,
cancelSnapping:C}=ka.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ja.SnappingContext({editGeometryOperations:g.unwrap(this._editGeometryOperations),elevationInfo:b,pointer:B,excludeFeature:this.graphic,visualizer:new ea.SnappingVisualizer3D}),updatingHandles:this.updatingHandles,useZ:!1});q=q.next(p=>{this._onDragCancel(!l.metadata.deleting,()=>A=g.removeMaybe(A));return p}).next(C);n.next(p=>this._trackNumDragging(p)).next(p=>
{"start"===p.action&&(A=g.unwrap(this._editGeometryOperations).createUndoGroup());if("edge"===f.type){const M=this._splitEdgeManipulator(f);return{...p,info:M,snapOrigin:M.handle.pos}}return{...p,info:f,snapOrigin:f.handle.pos}}).next(z.dragAtLocation(this.view,l.elevationAlignedLocation)).next(T.screenToMapXYForGraphicAtLocation(this.view,this.graphic,l.elevationAlignedLocation,l.location.spatialReference,this.graphic)).next(z.sceneSnappingAtLocation(this.view,b,this.graphic)).next(...R).next(z.addMapDelta()).next(p=>
{this._perVertexManipulatorDragAction(p);"end"===p.action&&(A=g.removeMaybe(A));this._updateTranslateVertexTooltip(l,x.ManipulationType.XY,p)})});this._manipulatorHandles.add([k,e.events.on("immediate-click",l=>this._manipulatorClickCallback(l,f)),e.events.on("select-changed",()=>{f.selectedIndex=++this._selectedIndex;this._updateMoveManipulationPosition()}),e.events.on("focus-changed",({action:l})=>{"focus"===l&&"edge"!==f.type?this._updateTranslateVertexTooltip(e,x.ManipulationType.XY):this._tooltip.clear()})],
e);this.emit("manipulators-changed");return f};h._trackNumDragging=function(a){switch(a.action){case "start":this._numDragging++;break;case "end":this._numDragging--}return a};h._onDragCancel=function(a=!0,b){this._numDragging--;a&&(this.undo(),this.outputGeometry=g.isSome(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null);g.isSome(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping();this._tooltip.clear();switch(this._reshapeEventState){case t.MOVING:this.emit("move",
{type:"move",dx:0,dy:0,mover:this.graphic});break;case t.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}b&&b();this.destroyed||this._updateEventState(t.NONE)};h._setTypeSpecificManipulatorSettings=function(a,b,c){switch(b.type){case "vertex":a.state=E.Vertex;a.selectable=!0;a.cursor="move";a.collisionPriority=2;a.radius=m.settings.reshapeManipulators.vertex.size/2+m.settings.reshapeManipulators.vertex.collisionPadding;a.elevationInfo=c;a.interactive=g.isSome(this.graphic.geometry)&&
"point"!==this.graphic.geometry.type;break;case "edge":a.state=E.Edge,a.selectable=!1,a.cursor="copy",a.collisionPriority=-1,a.radius=m.settings.reshapeManipulators.edge.size/2+m.settings.reshapeManipulators.edge.collisionPadding,a.elevationInfo="on-the-ground"!==c.mode||da.isVolumetricSymbol(this.graphic.symbol)?{mode:"absolute-height",offset:0}:c}};h._watchAndUpdateGrabState=function(a,b){return a.events.on("grab-changed",c=>this._onGrabStateChanged(a,b,c.action,c.pointerType))};h._onGrabStateChanged=
function(a,b,c,d="mouse"){if(!this._recreatingManipulators){if("start"===c)b&&this._updateSelection(a),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(t.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing;if("touch"!==d||this.enableEdgeOffset)this._manipulatorInfos.forEach(e=>{e.manipulator.interactive=e.manipulator.grabbing||!this._numGrabbing&&g.isSome(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;"edgeManipulator"in e&&(e.edgeManipulator.interactive=
e.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(e=>{e.interactive=e.grabbing||!this._numGrabbing})}};h._clearSelection=function(){for(const a of this._manipulatorInfos)a.manipulator.grabbing||(a.manipulator.selected=!1)};h._updateSelection=function(a){a.grabbing&&!a.selected&&a.selectable&&(this._clearSelection(),a.selected=!0,this.emit("manipulators-changed"))};h._removeManipulator=function(a){g.isNone(a)||(a.manipulator.metadata.deleting=!0,this.manipulators.remove(a.manipulator),
this._manipulatorHandles.remove(a.manipulator),na.removeUnordered(this._manipulatorInfos,a),this.emit("manipulators-changed"))};h._getManipulatorInfoFromHandle=function(a){if(a)for(const b of this._manipulatorInfos)if(a===b.handle)return b;return null};h._updateManipulatorPosition=function(a){if(!g.isNone(a)){var b=g.unwrap(this._editGeometryOperations);if("vertex"===a.type)a.manipulator.location=b.data.coordinateHelper.vectorToDehydratedPoint(a.handle.pos,S),a.manipulator.grabbing&&g.isSome(this._vertexLaserLineVisualElement)&&
(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=a.manipulator.renderLocation);else if("edge"===a.type){var c=this._getManipulatorInfoFromHandle(a.handle.leftVertex),d=this._getManipulatorInfoFromHandle(a.handle.rightVertex);g.isNone(c)||g.isNone(d)||(c=c.manipulator,d=d.manipulator,g.isSome(a.manipulator.elevationInfo)&&"on-the-ground"===a.manipulator.elevationInfo.mode?(c=c.location,d=d.location,a.manipulator.location=ca.makeDehydratedPoint(c.x+.5*(d.x-c.x),c.y+.5*(d.y-
c.y),c.hasZ&&d.hasZ?0:void 0,b.data.spatialReference)):(H.lerp(U,c.renderLocation,d.renderLocation,.5),a.manipulator.renderLocation=U))}}};h._splitEdgeManipulator=function(a,b=.5){var c=g.unwrap(this._editGeometryOperations);b=g.unwrap(c.splitEdge(a.handle,b).createdVertex);a.locationUpdateHandle=g.removeMaybe(a.locationUpdateHandle);var d=O.getGraphicEffectiveElevationInfo(this.graphic);let e;this.enableEdgeOffset?(this._removeManipulator(a),e=this._createVertexOrEdgeManipulator(b)):(e=a,e.handle=
b,e.type="vertex",this._setTypeSpecificManipulatorSettings(a.manipulator,a.handle,d));b.leftEdge&&this._createVertexOrEdgeManipulator(b.leftEdge);b.rightEdge&&this._createVertexOrEdgeManipulator(b.rightEdge);this.outputGeometry=c.data.geometry;this._updateManipulatorPosition(e);this.enableEdgeOffset||this._updateTranslateVertexTooltip(e.manipulator,x.ManipulationType.XY);this._updateSelection(a.manipulator);a=this._updateEventState(t.RESHAPING);d=c.data.coordinateHelper.vectorToArray(e.handle.pos);
c=c.data.components.indexOf(b.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:d,componentIndex:c,vertexIndex:g.unwrap(b.index)}],added:d});a&&this._updateEventState(t.NONE);return e};h._updateMoveManipulationPosition=function(){const a=H.set(U,0,0,0);let b=0,c=!1;var d=null;let e=null;for(var f of this._manipulatorInfos)if("vertex"===f.type)if(f.manipulator.selected)if(b++,H.add(a,a,f.manipulator.renderLocation),g.isNone(d)||f.selectedIndex>d.selectedIndex)e=d,d=f;else{if(g.isNone(e)||
f.selectedIndex>e.selectedIndex)e=f}else c=!0;if(0===b)d=this._graphicState.displaying&&this.enableMoveGraphic,this._moveManipulation.xyManipulation.available=d,this._moveManipulation.xyAxisManipulation.available=d,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=d,this._moveManipulation.zManipulation.available=d&&this.enableZShape&&X.canMoveZ(this.graphic),this._moveManipulation.angle=Y.shapeOrientation(g.unwrap(this.graphic.geometry)),this._moveManipulation.radius=x.MoveManipulation.radiusForSymbol(this.graphic.symbol);
else{f=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=f;this._moveManipulation.xyAxisManipulation.available=f;this._moveManipulation.zManipulation.available=f&&this.enableZVertex&&X.canMoveZ(this.graphic);this._moveManipulation.xyAxisManipulation.orthogonalAvailable=f&&1!==b;f=0;if(g.isSome(d)){const k=d.handle.pos,l=g.isSome(e)?e.handle.pos:d.handle.leftEdge&&d.handle.leftEdge.leftVertex?d.handle.leftEdge.leftVertex.pos:null;d=g.isNone(e)&&d.handle.rightEdge&&d.handle.rightEdge.rightVertex?
d.handle.rightEdge.rightVertex.pos:null;l&&d?this._moveManipulation.xyAxisManipulation.available=!1:l?f=Math.atan2(k[1]-l[1],k[0]-l[0])+Math.PI/2:d&&(f=Math.atan2(d[1]-k[1],d[0]-k[0])+Math.PI/2)}this._moveManipulation.angle=f;this._moveManipulation.radius=Aa.DISC_RADIUS_SMALL}0!==b&&c?(H.scale(a,a,1/b),S.spatialReference=g.unwrap(this._editGeometryOperations).data.spatialReference,S.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(a,S),this._moveManipulation.elevationAlignedLocation=S):g.isSome(this._outlineVisualElement)&&
!this._graphicState.isDraped&&g.isSome(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:D.placeAtGraphic(this.view,this._moveManipulation,this.graphic)};h._removeVertices=function(a){var b=[];const c=g.unwrap(this._editGeometryOperations);for(var d of a)"vertex"===d.type&&c.canRemoveVertex()&&(b.push(d.handle),this._removeManipulator(d),this._removeManipulator(this._getManipulatorInfoFromHandle(d.handle.leftEdge)),
this._removeManipulator(this._getManipulatorInfoFromHandle(d.handle.rightEdge)),a=c.removeVertices([d.handle]),(a=g.unwrap(a.removedVertices?.[0].createdEdge))&&this._createVertexOrEdgeManipulator(a));if(0<b.length&&(b=b.map(e=>{const f=c.data.components.indexOf(e.component);return{coordinates:c.data.coordinateHelper.vectorToArray(e.pos),componentIndex:f,vertexIndex:g.unwrap(e.index)}}),this.outputGeometry=c.data.geometry,d=this._updateEventState(t.RESHAPING),!this.destroyed&&(this.emit("vertex-remove",
{type:"vertex-remove",removed:b.map(e=>e.coordinates),vertices:b}),!this.destroyed))){if(d&&(this._updateEventState(t.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}};h._moveVertices=function(a,b,c="start"===b.action?Z.AccumulationBehaviour.NEW_STEP:Z.AccumulationBehaviour.ACCUMULATE_STEPS){const d=g.unwrap(this._editGeometryOperations);d.moveVertices(a.map(e=>e.handle),b.mapDeltaX,b.mapDeltaY,b.mapDeltaZ,c);this.outputGeometry=d.data.geometry;for(const e of a)this._updateManipulatorPosition(e)};
h._offsetEdge=function(a,b){if(!g.isNone(b.operation)&&!g.isNone(b.signedDistance)){var c=g.unwrap(this._editGeometryOperations),d=b.operation.clone();d.distance=b.signedDistance;c.updateVertices([a.handle.leftVertex,a.handle.rightVertex],d);this.outputGeometry=c.data.geometry;this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.leftVertex));this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.rightVertex))}};h._manipulatorClickCallback=function(a,b){a.shiftKey||
this._clearSelection();"vertex"===b.type&&(b.manipulator.selected=!b.manipulator.selected,a.button===ia.MouseButton.Right&&this._removeVertices([b]));"edge"===b.type&&a.button===ia.MouseButton.Left&&this._splitEdgeManipulator(b);a.stopPropagation()};h._updateTranslateTooltip=function(a,b){const c=this._manipulatorInfos.filter(d=>"vertex"===d.type&&d.manipulator.selected);1===c.length?this._updateTranslateVertexTooltip(c[0].manipulator,a,b):this._updateTranslateGraphicTooltip(a,b)};h._updateTranslateGraphicTooltip=
function(a,b){const c=this._tooltipOptions;if(c.enabled){var d=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(a){case x.ManipulationType.XY:this._tooltip.info=new K.TranslateGraphicTooltipInfo({tooltipOptions:c});this._updateTranslateTooltipDistance(this._tooltip.info,b,(e,f)=>P.autoHorizontalDistanceByElevationModeBetweenPoints(e,f,d));break;case x.ManipulationType.XY_AXIS:this._tooltip.info=new K.TranslateGraphicXYTooltipInfo({tooltipOptions:c});this._updateTranslateTooltipDistance(this._tooltip.info,
b,(e,f)=>{e=P.autoHorizontalDistanceByElevationModeBetweenPoints(e,f,d);return G.scale(e,Y.axisConstrainedDragSign(b))});break;case x.ManipulationType.Z:this._tooltip.info=new K.TranslateGraphicZTooltipInfo({tooltipOptions:c}),this._updateTranslateTooltipDistance(this._tooltip.info,b,aa.verticalSignedDistanceBetweenPoints)}}};h._updateTranslateVertexTooltip=function(a,b,c){const d=this._tooltipOptions;if(d.enabled){var e=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(b){case x.ManipulationType.XY:var f=
new K.TranslateVertexTooltipInfo({tooltipOptions:d});this._updateTranslateTooltipDistance(f,c,(k,l)=>P.autoHorizontalDistanceByElevationModeBetweenPoints(k,l,e));this._updateTooltipAreaOrTotalLength(f);break;case x.ManipulationType.XY_AXIS:f=new K.TranslateVertexXYTooltipInfo({tooltipOptions:d});this._updateTranslateTooltipDistance(f,c,(k,l)=>{k=P.autoHorizontalDistanceByElevationModeBetweenPoints(k,l,e);return G.scale(k,Y.axisConstrainedDragSign(c))});this._updateTooltipAreaOrTotalLength(f);break;
case x.ManipulationType.Z:f=new K.TranslateVertexZTooltipInfo({tooltipOptions:d}),this._updateTranslateTooltipDistance(f,c,aa.verticalSignedDistanceBetweenPoints)}a=aa.elevationOfPoint(a.elevationAlignedLocation);g.isSome(a)&&(f.elevation={mode:"absolute-height",...a});this._tooltip.info=f}};h._updateTranslateTooltipDistance=function(a,b,c){if(g.isSome(b)&&"end"!==b.action){const {mapStart:d,mapEnd:e}=b;b=c(d,e);a.distance=g.isSome(b)?b:G.zeroMeters}};h._updateTooltipAreaOrTotalLength=function(a){const {geometry:b}=
this.graphic;if(!g.isNone(b)){var c=this._graphicState.isDraped?"on-the-ground":"absolute-height";a.area="polygon"===b.type?Fa.autoAreaByElevationMode(b,c):null;a.totalLength="polyline"===b.type?P.autoLengthByElevationMode(b,c):null}};V._createClass(Q,[{key:"inputGeometry",get:function(){return g.isSome(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null},set:function(a){this._recreateEditGeometryAndManipulators(a)}},{key:"updating",get:function(){return this.updatingHandles.updating}},
{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},
{key:"_labelOptions",get:function(){return this.tool.labelOptions}},{key:"_tooltipOptions",get:function(){return this.tool.tooltipOptions}},{key:"canRedo",get:function(){return g.isSome(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return g.isSome(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}},{key:"test",get:function(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}}]);return Q}(oa.EventedMixin(pa.HandleOwner));
v.__decorate([w.property()],u.ReshapeOperation.prototype,"_editGeometryOperations",void 0);v.__decorate([w.property()],u.ReshapeOperation.prototype,"_segmentLabels",void 0);v.__decorate([w.property({constructOnly:!0})],u.ReshapeOperation.prototype,"tool",void 0);v.__decorate([w.property()],u.ReshapeOperation.prototype,"_tooltip",void 0);v.__decorate([w.property()],u.ReshapeOperation.prototype,"inputGeometry",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"outputGeometry",void 0);v.__decorate([w.property({readOnly:!0})],
u.ReshapeOperation.prototype,"updating",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"manipulators",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"view",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"graphic",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"enableZShape",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"enableZVertex",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"enableMoveGraphic",
null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"enableMidpoints",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"enableEdgeOffset",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"_labelOptions",null);v.__decorate([w.property()],u.ReshapeOperation.prototype,"_tooltipOptions",null);u.ReshapeOperation=v.__decorate([sa.subclass("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],u.ReshapeOperation);const S=ca.makeDehydratedPoint(0,
0,void 0,Ha.WGS84),U=ba.create();var E;(function(h){h.Vertex=r.ManipulatorStateCustomFlags.Custom1;h.Edge=r.ManipulatorStateCustomFlags.Custom2})(E||(E={}));var t;(function(h){h[h.NONE=0]="NONE";h[h.MOVING=1]="MOVING";h[h.RESHAPING=2]="RESHAPING"})(t||(t={}));var L;(function(h){h[h.ALL=0]="ALL";h[h.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"})(L||(L={}));Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});