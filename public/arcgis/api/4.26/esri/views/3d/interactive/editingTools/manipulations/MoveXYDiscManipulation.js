// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/vectorStacks ../../../../../support/elevationInfoUtils ../../Manipulator3D ../../RenderObject ../dragEventPipeline3D ../ManipulatorType ../settings ./config ./Manipulation ./moveUtils ../snapping/SnapToScene ../../../webgl-engine/lib/basicInterfaces ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces".split(" "),
function(w,r,C,D,x,E,F,p,y,G,H,z,I,A,J,d,t,K,L,M,N,O,P,u,B){t=function(c){function e(a){var b=Q.call(this);b._snapToScene=new L.SnapToScene;b._discMaterial=b._createMaterial();b._discMaterialTransparent=b._createMaterial(.5);b._scale=1;b._radius=d.DISC_RADIUS;b._view=a.view;b._tool=a.tool;null!=a.snapToScene&&(b.snapToScene=a.snapToScene);null!=a.radius&&(b._radius=a.radius);b._createManipulator();b.forEachManipulator(f=>b._tool.manipulators.add(f));return b}r._inherits(e,c);var Q=r._createSuper(e);
c=e.prototype;c.destroy=function(){this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()});this._manipulator=this._view=this._tool=null};c.forEachManipulator=function(a){a(this._manipulator,A.ManipulatorType.TRANSLATE_XY)};c.createGraphicDragPipeline=function(a,b,f){const g=b.graphic,h=G.getGraphicEffectiveElevationInfo(g),k=D.unwrap(g.geometry).spatialReference;return K.createGraphicMoveDragPipeline(b,f,l=>this.createDragPipeline((q,m,n,v,R)=>{({steps:m,cancel:n}=a(q,m,n,v,R));
return l(q,m,n)},h,k,g),this._view.state.viewingMode)};c.createDragPipeline=function(a,b,f,g){const h=this._view;return u.createManipulatorDragEventPipeline(this._manipulator,(k,l,q,m,n)=>{l=l.next(u.dragAtLocation(h,k.elevationAlignedLocation)).next(I.screenToMapXYAtLocation(h,k.elevationAlignedLocation,b,f,g)).next(...this._snapToScene.createDragEventPipelineStep(h,b)).next(v=>({...v,manipulatorType:A.ManipulatorType.TRANSLATE_XY})).next(u.addScreenDelta());a(k,l,q,m,n)})};c._updateManipulatorTransform=
function(){const a=x.fromScaling(y.sm4d.get(),F.set(y.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=a};c._createManipulator=function(){this._manipulator=new H.Manipulator3D({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:p.fromValues(0,0,1)},worldOriented:!0});this._updateManipulator()};c._updateManipulator=function(){const a=N.createCylinderGeometry(this._discMaterial,
d.DISC_HEIGHT,1,d.GEOMETRY_SEGMENTS,p.fromValues(0,0,1),p.fromValues(0,0,0));a.transformation=x.fromScaling(E.create(),p.fromValues(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[new z.RenderObject(a,B.ManipulatorStateFlags.Focused),new z.RenderObject(a.instantiate({material:this._discMaterialTransparent}),B.ManipulatorStateFlags.Unfocused)];this._manipulator.radius=this._radius/d.DISC_RADIUS*d.DISC_COLLISION_RADIUS};c._createMaterial=function(a=1){const b=C.toUnitRGBA(J.colors.main);
b[3]*=a;return new P.ColorMaterial({color:b,transparent:1!==a,cullFace:M.CullFaceOptions.Back,renderOccluded:O.RenderOccludedFlag.Transparent})};r._createClass(e,[{key:"displayScale",get:function(){return this._scale},set:function(a){this._scale=a;this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(a){this._snapToScene.enabled=a}},{key:"radius",get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}},
{key:"test",get:function(){return{discManipulator:this._manipulator}}}]);return e}(t.Manipulation);w.MoveXYDiscManipulation=t;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});