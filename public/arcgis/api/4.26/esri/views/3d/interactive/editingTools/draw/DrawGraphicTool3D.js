// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/MeshTransform ../../../../../support/elevationInfoUtils ../../../../../symbols/support/ElevationInfo ../../SegmentLabels3D ../../SnappingVisualizer3D ../settings ../../visualElements/ExtendedLineVisualElement ../../visualElements/OutlineVisualElement ../../visualElements/VerticesVisualElement ../../../layers/graphics/elevationAlignmentUtils ../../../layers/graphics/ElevationContext ../../../layers/graphics/GraphicState ../../../webgl-engine/lib/Material ../../../../draw/DrawGraphicTool ../../../../draw/DrawOperation ../../../../draw/drawSurfaces".split(" "),
function(f,k,l,n,c,t,p,O,P,Q,y,z,A,B,q,C,D,E,g,F,G,u,H,I,J,K,v,L,w){f.DrawGraphicTool3D=function(d){function m(a){a=M.call(this,a);a._activeVertexVisualElement=null;a._createGraphicState=null;a._outlineVisualElement=null;a._verticesVisualElement=null;a._verticalLineVisualElement=null;a.geometryType=null;a.type="draw-3d";return a}k._inherits(m,d);var M=k._createSuper(m);d=m.prototype;d.initialize=function(){const {mode:a,offset:b}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new C({mode:a,
offset:b})};d.normalizeCtorArgs=function(a){return a.elevationInfo?a:{...a,elevationInfo:q.getEffectiveElevationInfo(a.hasZ??!0)}};d.initializeGraphic=function(a){const b=this._createGraphicState=new J.GraphicState({graphic:a});return n.handlesGroup([this.view.maskOccludee(a),this.view.trackGraphicState(b),t.watch(()=>({element:this._outlineVisualElement,isDraped:b.isDraped}),({element:e,isDraped:r})=>{c.applySome(e,N=>N.isDraped=r)},t.initial)])};d.makeDrawOperation=function(){const {geometryType:a}=
this,b="circle"!==a&&"rectangle"!==a;return new L.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:v.geometryTypeToDrawOperationGeometryType(a),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new w.SceneDrawSurface(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new w.ElevationDrawSurface(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,
snappingManager:this.snappingManager,snappingVisualizer:new E.SnappingVisualizer3D,segmentLabels:b?new D.SegmentLabels3D:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:c.isSome(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===q.getEffectiveElevationMode(this.hasZ,this.elevationInfo)})};d.onActiveVertexChanged=function(a){const {view:b}=this;if(c.isSome(this._activeVertexVisualElement))return this._activeVertexVisualElement.vertices=[a],
this._updateVerticalLineVisualElement(a),null;this._activeVertexVisualElement=new u.VerticesVisualElement({view:b,spatialReference:b.spatialReference,vertices:[a],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:g.settings.reshapeManipulators.vertex.renderOccluded,attached:!1});this._activeVertexVisualElement.color=g.settings.colorToVec4(g.settings.reshapeManipulators.selected.color);this._activeVertexVisualElement.attached=!0;this._verticalLineVisualElement=new F.ExtendedLineVisualElement({view:b,
extensionType:g.settings.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:K.RenderOccludedFlag.OccludeAndTransparent});g.settings.visualElements.zVerticalLine.apply(this._verticalLineVisualElement);return n.makeHandle(()=>{this._activeVertexVisualElement=c.destroyMaybe(this._activeVertexVisualElement);this._verticalLineVisualElement=c.destroyMaybe(this._verticalLineVisualElement)})};d._updateVerticalLineVisualElement=function(a){const b=this._verticalLineVisualElement;
if(!c.isNone(b)){var {renderCoordsHelper:e,elevationProvider:r}=this.view;z.set(h,a[0],a[1],a[2]);x.setFromElevationInfo(this.elevationInfo);h[2]=H.evaluateElevationAlignmentAtPoint(h,r,x,e);e.toRenderCoords(h,this.view.spatialReference,h)?(b.setStartEndFromWorldDownAtLocation(h),b.attached=!0):b.attached=!1}};d.onOutlineChanged=function(a){if(c.isSome(this._outlineVisualElement))return this._outlineVisualElement.geometry=a,null;const b=this.internalGraphicsLayer.elevationInfo;this._outlineVisualElement=
new G.OutlineVisualElement({view:this.view,geometry:a,elevationInfo:b,isDraped:c.isSome(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===q.getEffectiveElevationMode(this.hasZ,b),attached:!1});g.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement);g.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement);this._outlineVisualElement.attached=!0;this._outlineVisualElement.laserlineEnabled=!0;return n.makeHandle(()=>{this._outlineVisualElement=
c.destroyMaybe(this._outlineVisualElement)})};d.onRegularVerticesChanged=function(a){if(c.isSome(this._verticesVisualElement))return this._verticesVisualElement.vertices=a,null;this._verticesVisualElement=new u.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:a,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:g.settings.reshapeManipulators.vertex.renderOccluded,attached:!1});this._verticesVisualElement.attached=!0;return n.makeHandle(()=>
{this._verticesVisualElement=c.destroyMaybe(this._verticesVisualElement)})};d._updateGraphicGeometry=function(a,b){if("mesh"===this.geometryType&&c.isSome(b)&&"point"===b.type){const e=this.geometryToPlace;"mesh"===e?.type&&(e.transform||(e.transform=new B),e.centerAt(b));a.geometry=e;a.notifyGeometryChanged()}else k._get(k._getPrototypeOf(m.prototype),"_updateGraphicGeometry",this).call(this,a,b)};return k._createClass(m)}(v.DrawGraphicTool);l.__decorate([p.property({constructOnly:!0})],f.DrawGraphicTool3D.prototype,
"elevationInfo",void 0);l.__decorate([p.property({constructOnly:!0})],f.DrawGraphicTool3D.prototype,"geometryType",void 0);l.__decorate([p.property()],f.DrawGraphicTool3D.prototype,"type",void 0);l.__decorate([p.property({constructOnly:!0})],f.DrawGraphicTool3D.prototype,"view",void 0);f.DrawGraphicTool3D=l.__decorate([y.subclass("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],f.DrawGraphicTool3D);const x=new I.ElevationContext,h=A.create();Object.defineProperty(f,Symbol.toStringTag,
{value:"Module"})});