// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../Color ../../../../../core/Accessor ../../../../../core/analysisThemeUtils ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/lineSegment ../../../analysis/interfaces ../../../analysis/DirectLineMeasurement/interfaces ../../Manipulator3D ../../manipulatorUtils ../../visualElements/LaserlineVisualElement".split(" "),
function(c,r,d,t,x,u,y,e,m,f,G,H,I,z,v,A,B,w,C,D,E){var n;(function(g){g.Manipulators="manipulators";g.AnalysisViewDestroyed="analysis-view-destroyed";g.AnalysisView="analysis-view"})(n||(n={}));c.DirectLineMeasurement3DView=function(g){function p(a){a=F.call(this,a);a._params={laserLineGlowColor:t.toUnitRGB(u.getAccentColor()),laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:t.toUnitRGB(u.getContrastColor()),laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,handleColor:t.toUnitRGB(u.getAccentColor()),
handleOpacity:.5,handleRadius:5};a.cursorPoint=null;a._visible=!1;a._laserLine=null;a.laserLineEnabled=!0;a._handles=new y;a._lastDraggedHandle=null;return a}r._inherits(p,g);var F=r._createSuper(p);g=p.prototype;g.initialize=function(){this._laserLine=new E.LaserlineVisualElement({view:this.view,attached:!0});this._updateVisibility(this._visible);this._connectToAnalysisView()};g.destroy=function(){this._handles=e.destroyMaybe(this._handles);this._laserLine=e.destroyMaybe(this._laserLine)};g.createManipulators=
function(){var a=()=>{const h=D.createSphereManipulator(this.view,this._params.handleColor,this._params.handleOpacity);h.available=!1;h.radius=this._params.handleRadius;return h};const b=a(),k=a();a=new C.Manipulator3D({view:this.view});a.available=!1;a.interactive=!1;e.isSome(this.analysis.startPoint)&&(b.location=this.analysis.startPoint,b.available=!0);e.isSome(this.analysis.endPoint)&&(k.location=this.analysis.endPoint,k.available=!0);var l=()=>{let h=this._lastDraggedHandle;b.grabbing&&!k.grabbing&&
(h="start");k.grabbing&&!b.grabbing&&(h="end");b.grabbing||k.grabbing||(h=null);this._lastDraggedHandle=h};const q=b.events.on("grab-changed",l);l=k.events.on("grab-changed",l);this._handles.add([q,l],n.Manipulators);return{start:b,end:k,cursor:a}};g.show=function(){this.destroyed||this._visible||this._updateVisibility(!0)};g.hide=function(){!this.destroyed&&this._visible&&this._updateVisibility(!1)};g._connectToAnalysisView=function(){this._handles.remove(n.AnalysisView);this._handles.add([m.watch(()=>
e.applySome(this.analysisViewData,a=>a.destroyed),a=>{a&&this._handles.remove(n.AnalysisView)},m.initial),m.watch(()=>["measured"===this.toolState.lineState,this.analysisViewData],([a,b])=>{e.isSome(b)&&!b.destroyed&&(b.allowVisualElementsOrientationChange=!a)},m.initial),m.watch(()=>this._laserLineParams,a=>{const b=this._laserLine;b.heightManifoldTarget=a.heightManifoldTarget;b.pointDistanceLine=a.pointDistanceLine;b.lineVerticalPlaneSegment=a.lineVerticalPlaneSegment},m.initial)],n.AnalysisView)};
g._updateVisibility=function(a){this.initialized&&((this._visible=a)?this._laserLine.style={innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha}:this.view.cursor=null,this._laserLine.visible=a)};r._createClass(p,[{key:"visible",get:function(){return this._visible},set:function(a){a?this.show():
this.hide()}},{key:"testData",get:function(){const a=this._laserLine.testData,b=this.analysisViewData.testData;return{labels:b?.labels,stripeLength:b?.stripeLength,laserLineRenderer:{heightManifoldEnabled:e.isSome(a)?a.heightManifoldEnabled:!1,heightManifoldTarget:e.isSome(a)?a.heightManifoldTarget:null,pointDistanceEnabled:e.isSome(a)?a.pointDistanceEnabled:!1,pointDistanceOrigin:e.isSome(a)?a.pointDistanceOrigin:null,pointDistanceTarget:e.isSome(a)?a.pointDistanceTarget:null,lineVerticalPlaneEnabled:e.isSome(a)?
a.lineVerticalPlaneEnabled:!1}}}},{key:"_cursorPosition",get:function(){const a=v.create();e.applySome(this.cursorPoint,b=>this.view.renderCoordsHelper.toRenderCoords(b,a));return a}},{key:"_startPosition",get:function(){const a=v.create();e.applySome(this.analysis.startPoint,b=>this.view.renderCoordsHelper.toRenderCoords(b,a));return a}},{key:"_endPosition",get:function(){const a=v.create();e.applySome(this.analysis.endPoint,b=>this.view.renderCoordsHelper.toRenderCoords(b,a));return a}},{key:"_laserLineParams",
get:function(){const a=this._focusPosition,{active:b,lineState:k}=this.toolState,l=this.analysisViewData,q=this.laserLineEnabled&&!!a&&"measured"!==k&&b;if(!q||!this.visible||e.isNone(l)||l.destroyed)return{heightManifoldTarget:null,pointDistanceLine:null,lineVerticalPlaneSegment:null};const h=l.actualVisualizedMeasurement;return{heightManifoldTarget:"euclidean"===h?a:null,pointDistanceLine:"local"!==this.view.viewingMode&&q&&this.analysis.startPoint&&"geodesic"===h?this._pointDistanceLine:null,lineVerticalPlaneSegment:q&&
l.viewMode===w.ViewMode.Triangle?A.fromPoints(this._startPosition,this._endPosition):null}}},{key:"_focusPosition",get:function(){const {lineState:a}=this.toolState;var b=this.analysisViewData;b=e.isSome(b)&&!b.destroyed&&b.measurementMode===B.MeasurementMode.Euclidean&&b.viewMode===w.ViewMode.Direct;switch(a){case "drawing":return b?this._startPosition:this.analysis.endPoint?this._endPosition:this._startPosition;case "editing":return b?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:
"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return e.isSome(this.cursorPoint)?this._cursorPosition:null}}},{key:"_pointDistanceLine",get:function(){return{origin:"drawing"===this.toolState.lineState||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition,target:this._focusPosition}}}]);return p}(x);d.__decorate([f.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"view",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,
"_params",void 0);d.__decorate([f.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"analysis",void 0);d.__decorate([f.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"analysisViewData",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"cursorPoint",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"toolState",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"visible",null);d.__decorate([f.property()],
c.DirectLineMeasurement3DView.prototype,"testData",null);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_visible",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_laserLine",void 0);d.__decorate([f.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"laserLineEnabled",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_cursorPosition",null);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,
"_startPosition",null);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_endPosition",null);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_lastDraggedHandle",void 0);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_laserLineParams",null);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_focusPosition",null);d.__decorate([f.property()],c.DirectLineMeasurement3DView.prototype,"_pointDistanceLine",null);c.DirectLineMeasurement3DView=
d.__decorate([z.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DView")],c.DirectLineMeasurement3DView);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});