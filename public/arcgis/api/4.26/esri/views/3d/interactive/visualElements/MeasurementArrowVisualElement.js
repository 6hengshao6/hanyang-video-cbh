// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/analysisThemeUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/vectorStacks ./Object3DVisualElement ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Material ../../webgl-engine/materials/MeasurementArrowMaterial".split(" "),
function(y,q,r,t,C,l,f,D,E,F,z,u,m,v,G,H,I){v=function(c){function g(a){var b=J.call(this,a);b._parameters={arrowWidth:16,arrowOutlineColor:r.toUnitRGBA(t.getAccentColor()),arrowStripeEvenColor:r.toUnitRGBA(t.getContrastColor()),arrowStripeOddColor:r.toUnitRGBA(t.getAccentColor()),arrowSubdivisions:128};b._origin=z.create();b._originTransform=E.create();b._arrowCenter=z.create();b._renderOccluded=H.RenderOccludedFlag.OccludeAndTransparent;b._geometry=null;b._stripeLength=1;b._stripesEnabled=!0;b._opacity=
1;b.applyProps(a);return b}q._inherits(g,c);var J=q._createSuper(g);c=g.prototype;c.createExternalResources=function(){const {arrowStripeEvenColor:a,arrowStripeOddColor:b,arrowOutlineColor:e}=this._parameters;this._arrowMaterial=new I.MeasurementArrowMaterial({outlineColor:e,stripeEvenColor:this._stripesEnabled?a:b,stripeOddColor:b,renderOccluded:this.renderOccluded,polygonOffset:!0});this._handles=new C;this._handles.add(D.watch(()=>this.view.state.camera,()=>{this._viewChanged()}))};c.destroyExternalResources=
function(){this._arrowMaterial=null;this._handles=f.destroyMaybe(this._handles)};c.forEachExternalMaterial=function(a){a(this._arrowMaterial)};c.createGeometries=function(a){if(!(f.isNone(this._geometry)||f.isNone(this._geometry.startRenderSpace)||f.isNone(this._geometry.endRenderSpace))){var b=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);b.transformation=this._originTransform;a.addGeometry(b);this._viewChanged()}};c._createArrowGeometry=
function(a,b,e,d){const n=this.view.renderCoordsHelper,p=[],A=[],x=(w,h)=>{const k=m.sv3d.get();F.subtract(k,w,e);p.push(k);A.push(h)};if("euclidean"===d.type)d.eval(.5,this._arrowCenter),d=m.sv3d.get(),n.worldUpAtPosition(this._arrowCenter,d),x(a,d),x(b,d);else for(d.eval(.5,this._arrowCenter),a=this._parameters.arrowSubdivisions+1&-2,b=0;b<a;++b){const w=b/(a-1),h=m.sv3d.get(),k=m.sv3d.get();d.eval(w,h);n.worldUpAtPosition(h,k);x(h,k)}return G.createPolylineGeometry(this._arrowMaterial,p,A)};c._geometryChanged=
function(){this.recreateGeometry()};c._viewChanged=function(){if(this.view.ready&&this.attached&&f.isSome(this._geometry)){const a=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*a})}};c._updateArrowOpacity=function(){var a=this.opacity;const {arrowStripeEvenColor:b,arrowStripeOddColor:e,arrowOutlineColor:d}=this._parameters,n=l.applyOpacity(B,this._stripesEnabled?b:e,a),p=l.applyOpacity(K,d,a);a=l.applyOpacity(L,
e,a);this._arrowMaterial.setParameters({stripeEvenColor:n,outlineColor:p,stripeOddColor:a})};q._createClass(g,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:a}))}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this._geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(a){this._stripeLength=
a;this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(a){this._stripesEnabled=a;if(this.attached){a=this.opacity;const {arrowStripeEvenColor:b,arrowStripeOddColor:e}=this._parameters;a=l.applyOpacity(B,this._stripesEnabled?b:e,a);this._arrowMaterial.setParameters({stripeEvenColor:a})}}},{key:"opacity",get:function(){return this._opacity},set:function(a){a!==this._opacity&&(this._opacity=
a,this._updateArrowOpacity())}}]);return g}(v.Object3DVisualElement);const B=u.create(),K=u.create(),L=u.create();y.MeasurementArrowVisualElement=v;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});