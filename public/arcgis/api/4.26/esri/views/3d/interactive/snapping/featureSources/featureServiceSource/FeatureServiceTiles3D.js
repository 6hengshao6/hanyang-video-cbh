// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/HandleOwner ../../../../../../core/maybe ../../../../../../core/reactiveUtils ../../../../../../core/accessorSupport/decorators/property ../../../../../../core/accessorSupport/ensureType ../../../../../../core/arrayUtils ../../../../../../core/has ../../../../../../core/accessorSupport/decorators/subclass ../../../../../../layers/support/TileKey ../../../../layers/support/FeatureTileDescriptor3D ../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils".split(" "),
function(b,l,c,r,m,q,f,z,A,B,t,u,v,n){function w({lij:[g,d,k],extent:a}){return new u.TileKey(`${g}/${d}/${k}`,g,d,k,a)}b.FeatureServiceTiles3D=function(g){function d(a){a=k.call(this,a);a.pointOfInterest=null;return a}l._inherits(d,g);var k=l._createSuper(d);g=d.prototype;g.initialize=function(){this.handles.add(q.watch(()=>this.view.featureTiles,a=>{this.handles.remove("feature-tiles");a&&this.handles.add(a.addClient(),"feature-tiles")},q.initial))};g._filterTiles=function(a){return m.isNone(a)?
[]:a.filter(e=>50<Math.abs(e.measures.screenRect[3]-e.measures.screenRect[1])&&e.measures.visibility===v.Visibility.VISIBLE_ON_SURFACE)};l._createClass(d,[{key:"tiles",get:function(){const a=this.tilesCoveringView,e=this._effectivePointOfInterest;if(m.isSome(e)){const p=a.map(h=>n.distanceToTile(e,h));for(let h=1;h<p.length;h++)if(p[h-1]>p[h])return a.sort((x,y)=>n.distanceToTile(e,x)-n.distanceToTile(e,y)),a.slice()}return a}},{key:"tilesCoveringView",get:function(){return this._filterTiles(this.view.featureTiles?.tiles?.toArray()).map(w)}},
{key:"tileInfo",get:function(){return this.view.featureTiles?.tilingScheme.toTileInfo()??null}},{key:"tileSize",get:function(){return this.view.featureTiles?.tileSize??256}},{key:"_effectivePointOfInterest",get:function(){const a=this.pointOfInterest;return m.isSome(a)?a:this.view.pointsOfInterest?.focus.location}}]);return d}(r.HandleOwner);c.__decorate([f.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tiles",null);c.__decorate([f.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,
"tilesCoveringView",null);c.__decorate([f.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tileInfo",null);c.__decorate([f.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tileSize",null);c.__decorate([f.property({constructOnly:!0})],b.FeatureServiceTiles3D.prototype,"view",void 0);c.__decorate([f.property()],b.FeatureServiceTiles3D.prototype,"pointOfInterest",void 0);c.__decorate([f.property()],b.FeatureServiceTiles3D.prototype,"_effectivePointOfInterest",null);b.FeatureServiceTiles3D=
c.__decorate([t.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],b.FeatureServiceTiles3D);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});