// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../layers/graphics/dehydratedFeatures ../../../../support/elevationInfoUtils ../../../../symbols/support/ElevationInfo ./EngineVisualElement ./LaserlineVisualElement ../../layers/graphics/ElevationContext ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Material ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(t,k,z,f,n,u,l,p,A,B,C,D,E,F,q,G,H,v,w,r,I,J,x){q=function(d){function g(a){var b=K.call(this,a);b._attachmentOrigin=D.makeDehydratedPoint(0,0,0,null);b._attachmentOriginDirty=!0;b.events=new z;b._geometry=null;b._width=1;b._color=p.fromValues(1,0,1,1);b._innerWidth=0;b._innerColor=p.fromValues(1,1,1,1);b._stipplePattern=null;b._stippleOffColor=null;b._falloff=0;b._elevationInfo=null;b._laserlineStyle=null;b._laserlineEnabled=!1;b._renderOccluded=r.RenderOccludedFlag.OccludeAndTransparentStencil;
b._attachmentOrigin.spatialReference=a.view.spatialReference;b._laserline=new G.LaserlineVisualElement({view:a.view});b.applyProps(a);b.attached=a.attached??!0;return b}k._inherits(g,d);var K=k._createSuper(g);d=g.prototype;d.destroy=function(){this._laserline.destroy();k._get(k._getPrototypeOf(g.prototype),"destroy",this).call(this)};d.createObject3DResourceFactory=function(a){return{view:a,createResources:b=>this._createObject3DResources(b),destroyResources:b=>this._destroyExternalResources(b),
recreateGeometry:(b,c)=>{b.geometries.length=0;this._recreateGeometry(c,b.material,b.geometries)}}};d.createDrapedResourceFactory=function(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:b=>this._destroyExternalResources(b),recreateGeometry:b=>{b.geometries=this._createRenderGeometriesDraped(b.material);this._attachmentOriginChanged()}}};d.onAttachedChange=function(a){this._laserline.attached=this._laserlineAttached;a&&this._attachmentOriginChanged()};d._updateMaterial=
function(){f.isSome(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters);f.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)};d._recreateGeometry=function(a,b,c){this._createRenderGeometries(b,c);for(const e of c)a.addGeometry(e);this._attachmentOriginChanged()};d._attachmentOriginChanged=function(){this._attachmentOriginDirty=!0;this.events.emit("attachment-origin-changed")};
d._destroyExternalResources=function(a){a.geometries=[];a.material.dispose()};d._createObject3DResources=function(a){const b=new x.RibbonLineMaterial(this._materialParameters),c=[];this._recreateGeometry(a,b,c);return{material:b,geometries:c,forEach:e=>{e(b);c.forEach(e)}}};d._createDrapedResources=function(){const a=new x.RibbonLineMaterial(this._materialParameters),b=this._createRenderGeometriesDraped(a);return{material:a,geometries:b}};d._createRenderGeometriesDraped=function(a){var b=this.geometry;
if(f.isNone(b)||f.isNone(this.view.basemapTerrain.spatialReference))return[];b=w.geometryToRenderInfoDraped(b,this.view.basemapTerrain.spatialReference);const c=[];for(const {position:e}of b.lines)c.push(new I.RenderGeometry(v.createGeometry(a,{overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:e},removeDuplicateStartEnd:this._isClosed})));return c};d.calculateMapBounds=function(a){if(f.isNone(this.object3dResources.resources))return!1;
const b=this.view.renderCoordsHelper;for(const c of this.object3dResources.resources.geometries){const e=c.vertexAttributes.get(J.VertexAttribute.POSITION),m=C.newDoubleArray(e.data.length);A.projectBuffer(e.data,b.spatialReference,0,m,this.view.spatialReference,0,e.data.length/3);B.expandWithBuffer(a,m)}return!0};d._createRenderGeometries=function(a,b){var c=this.geometry;if(!f.isNone(c)){c=w.geometryToRenderInfo(c,this.view.elevationProvider,this.view.renderCoordsHelper,H.ElevationContext.fromElevationInfo(this.elevationInfo??
new F({mode:E.getGeometryEffectiveElevationMode(c,null)})));var e=[];for(const {position:m,mapPositions:L}of c.lines)b.push(v.createGeometry(a,{mapPositions:L,attributeData:{position:m},removeDuplicateStartEnd:this._isClosed})),e.push(m);this._laserline.pathVerticalPlane=e}};k._createClass(g,[{key:"_laserlineAttached",get:function(){return this.attached&&this.visible&&f.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=
a;this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(a){a!==this._width&&(this._width=a,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(a){l.exactEquals(a,this._color)||(l.copy(this._color,a),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(a){a!==this._innerWidth&&(this._innerWidth=a,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(a){l.exactEquals(a,
this._innerColor)||(l.copy(this._innerColor,a),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(a){const b=f.isSome(a)!==f.isSome(this._stipplePattern);this._stipplePattern=a;b?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(a){a&&this._stippleOffColor&&l.exactEquals(a,this._stippleOffColor)||(this._stippleOffColor=a?p.clone(a):null,this._updateMaterial())}},{key:"falloff",
get:function(){return this._falloff},set:function(a){a!==this._falloff&&(this._falloff=a,this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(a){this._elevationInfo=a;this.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(a){this._laserlineStyle=a;this._laserline.attached=this._laserlineAttached;f.isSome(a)&&(this._laserline.style=a)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},
set:function(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,this._laserline.attached=this._laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const a=f.toNullable(this.object3dResources.resources)?.geometries;if(!a||0===a.length)return null;n.set(h,0,0,0);let b=
0;for(const c of a)c.computeAttachmentOrigin(y)&&(n.add(h,h,y),b++);if(0===b)return null;n.scale(h,h,1/b);this.view.renderCoordsHelper.fromRenderCoords(h,this._attachmentOrigin);this._attachmentOriginDirty=!1;return this._attachmentOrigin}},{key:"_isClosed",get:function(){return f.isSome(this.geometry)&&"polygon"===this.geometry.type}},{key:"_materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,
isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}},{key:"_normalizedRenderOccluded",get:function(){return this.isDraped&&this._renderOccluded===r.RenderOccludedFlag.OccludeAndTransparentStencil?r.RenderOccludedFlag.OccludeAndTransparent:this._renderOccluded}}]);return g}(q.EngineVisualElement);const y=u.create(),h=u.create();t.OutlineVisualElement=q;Object.defineProperty(t,
Symbol.toStringTag,{value:"Module"})});