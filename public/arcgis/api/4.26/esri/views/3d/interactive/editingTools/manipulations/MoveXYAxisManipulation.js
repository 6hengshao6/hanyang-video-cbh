// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/vectorStacks ../../../../../support/elevationInfoUtils ../../Manipulator3D ../../RenderObject ../dragEventPipeline3D ../ManipulatorType ../settings ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/basicInterfaces ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces".split(" "),
function(A,u,G,H,I,J,v,h,K,w,B,g,L,M,C,N,D,O,n,x,P,Q,E,R,S,t,F){x=function(d){function p(a){var b=T.call(this);b._handles=new I;b._arrowManipulatorInfos=[];b._opaqueMaterial=b._createMaterial();b._transparentMaterial=b._createMaterial(.5);b._angle=0;b._scale=1;b._radius=n.DISC_RADIUS;b._updateAfterDrag=!1;b.events=new H;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b._createManipulators();b.forEachManipulator(c=>b._tool.manipulators.add(c));return b}u._inherits(p,d);var T=u._createSuper(p);
d=p.prototype;d.destroy=function(){this._handles=v.destroyMaybe(this._handles);this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()});this._view=this._tool=null;this._arrowManipulatorInfos.length=0};d.forEachManipulator=function(a){for(const {manipulator:b}of this._arrowManipulatorInfos)a(b,D.ManipulatorType.TRANSLATE_XY)};d.createGraphicDragPipeline=function(a,b,c){const e=b.graphic,f=L.getGraphicEffectiveElevationInfo(e),k=v.unwrap(e.geometry).spatialReference;return P.createGraphicMoveDragPipeline(b,
c,l=>this.createDragPipeline((m,q,r,y,z)=>{({steps:q,cancel:r}=a(m,q,r,y,z));return l(m,q,r)},f,k,e),this._view.state.viewingMode)};d.createDragPipeline=function(a,b,c,e){return J.handlesGroup(this._arrowManipulatorInfos.map(({manipulator:f},k)=>t.createManipulatorDragEventPipeline(f,(l,m,q,r,y)=>{m=m.next(z=>({...z,manipulatorType:D.ManipulatorType.TRANSLATE_XY})).next(t.dragAtLocation(this._view,l.elevationAlignedLocation)).next(N.screenToMapXYAtLocation(this._view,l.elevationAlignedLocation,b,
c,e)).next(t.constrainToMapAxis(l.location,this.angle+(k+1)*Math.PI*.5)).next(t.addScreenDelta());a(l,m,q,r,y)})))};d._updateManipulators=function(){for(let a=0;a<this._arrowManipulatorInfos.length;a++)this._updateArrowManipulator(this._arrowManipulatorInfos[a],a);this._updateManipulatorTransform()};d._updateArrowManipulator=function({manipulator:a,transform:b},c){var e=this._radius/n.DISC_RADIUS,f=n.DISC_TRANSLATE_ARROW_SIZE*e;const k=f*Math.sqrt(3)/2;f=E.createExtrudedTriangle(this._opaqueMaterial,
k,f/2,f/2,n.DISC_HEIGHT);E.transformInPlace(f,h.fromTranslation(g.sm4d.get(),w.set(g.sv3d.get(),0,-k/3,0)));a.renderObjects=[new C.RenderObject(f,F.ManipulatorStateFlags.Focused),new C.RenderObject(f.instantiate({material:this._transparentMaterial}),F.ManipulatorStateFlags.Unfocused)];a.radius=k/3*2.4;a=h.fromZRotation(g.sm4d.get(),c*Math.PI/2);e=h.fromTranslation(g.sm4d.get(),w.set(g.sv3d.get(),0,n.DISC_TRANSLATE_ARROW_OFFSET*e,0));h.multiply(b,a,e)};d._createManipulators=function(){for(let a=0;4>
a;a++){const b=this._createArrowManipulator(a);this._arrowManipulatorInfos.push(b)}this._updateManipulatorTransform()};d._updateManipulatorTransform=function(){var a=this.angle;a=h.fromRotation(g.sm4d.get(),a,B.fromValues(0,0,1));if(!v.isNone(a)){var b=h.fromScaling(g.sm4d.get(),w.set(g.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));a=h.multiply(g.sm4d.get(),b,a);for(const c of this._arrowManipulatorInfos)b=h.multiply(g.sm4d.get(),a,c.transform),c.manipulator.modelTransform=b}};
d._createArrowManipulator=function(a){const b=new M.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:B.fromValues(0,0,1)}}),c={manipulator:b,transform:K.create()};this._updateArrowManipulator(c,a);this._handles.add(b.events.on("drag",e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}));return c};d._createMaterial=function(a=1){const b=
G.toUnitRGBA(O.colors.main);b[3]*=a;return new S.ColorMaterial({color:b,transparent:1!==a,cullFace:Q.CullFaceOptions.Back,renderOccluded:R.RenderOccludedFlag.Transparent})};u._createClass(p,[{key:"orthogonalAvailable",set:function(a){this._arrowManipulatorInfos[1].manipulator.available=a;this._arrowManipulatorInfos[3].manipulator.available=a}},{key:"angle",get:function(){return this._angle},set:function(a){this._angle=a;this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",
get:function(){return this._scale},set:function(a){this._scale=a;this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(a){this._radius!==a&&(this._radius=a,this._updateManipulators())}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:a})=>a)}}}]);return p}(x.Manipulation);A.MoveXYAxisManipulation=x;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});