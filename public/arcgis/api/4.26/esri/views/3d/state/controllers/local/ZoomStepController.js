// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(k,p,u,v,w,x,I,J,K,L,M,y,d,f,z,A,B,C,D,l,q,E,F){k.ZoomStepController=function(g){function m(){var b=G.apply(this,arguments);b._zoomLocation=f.create();b._tmpCamera=new q.Camera;b._tmpRayDir=f.create();b._tmpCenter=f.create();b._constraintOptions={selection:A.ConstraintTypes.ALL,interactionType:B.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new q.Camera,interactionDirection:null,tiltMode:C.TiltMode.TUMBLE};return b}p._inherits(m,g);var G=p._createSuper(m);g=m.prototype;
g.zoomStep=function(b,c){if(this.active){var e=this.view.state,{interactionStartCamera:a}=this._constraintOptions;a&&(this.animation.finished?a.copyFrom(e.camera):this.animation.cameraAt(1,a));this._tmpCamera.copyFrom(e.camera);a=E.newIntersector(this.view.state.viewingMode);e=!1;0<b?(e=this.intersectionHelper.intersectScreenFreePointFallback(c,this._zoomLocation,0===this.view.map.ground.opacity?l.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,a,this._tmpCenter)&&
(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,a,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:d.copy(this._zoomLocation,this._tmpCamera.center);b=.6**b;c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,c[0],c[1],this.view.state.camera,60);d.subtract(n,this._tmpCamera.eye,this._zoomLocation);d.normalize(n,n);a=v.clamp(Math.min(l.ZOOM_DISTANCE_MODIFIER,1/Math.abs(d.dot(H,n)))*Math.abs(this.view.camera.position.z),
l.ZOOM_MIN_DISTANCE_MODIFIER,l.ZOOM_MAX_DISTANCE_MODIFIER);if(c=w.isSome(c)?c:a)if(a=f.create(),d.subtract(a,this._zoomLocation,this._tmpCamera.eye),c<d.length(a)||!e)d.normalize(a,a),d.add(this._zoomLocation,this._tmpCamera.eye,d.scale(a,a,c));this._updateCamera(this._tmpCamera,b,this._zoomLocation);this.begin(this._tmpCamera)}};g.animationSettings=function(){return{duration:x.Milliseconds(600),easing:F.outExpo}};g._updateCamera=function(b,c,e){d.subtract(this._tmpRayDir,e,b.eye);const a=d.length(this._tmpRayDir);
let h=a*c;const r=Math.max(4,1.01*b.nearFar[0]);0!==h&&(1>=c&&h<r&&(h=r,c=h/a),1E-6>Math.abs(a-h)||(d.scale(this._tmpRayDir,this._tmpRayDir,c),b.eye=d.subtract(t,e,this._tmpRayDir),b.center=d.lerp(t,b.center,e,1-c),z.applyAll(this.view,b,this._constraintOptions)))};return p._createClass(m)}(D.PointToPointAnimationController);k.ZoomStepController=u.__decorate([y.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],k.ZoomStepController);const t=f.create(),H=f.fromValues(0,0,1),n=f.create();
Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});