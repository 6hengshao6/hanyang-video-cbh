// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),function(k,q,r,w,x,l,u,v,C,D,E,y,z,A){function n(e,
h,t,a,c,d,f){for(const g of h)h=g.getElevation(t,a,c,d,f),l.isSome(h)&&(e=l.isSome(e)?Math.max(h,e):h);return e}k.CombinedElevationProvider=function(e){function h(a){a=t.call(this,a);a._im=[];a._ground=[];a._scene=[];a._handles=new Map;a.lastElevationQuery=null;a.elevationCacheEnabled=!1;return a}q._inherits(h,e);var t=q._createSuper(h);e=h.prototype;e.destroy=function(){this._elevationQueryCached=l.destroyMaybe(this._elevationQueryCached)};e.enableElevationCache=function(a){a||(this.lastElevationQuery=
null);this.elevationCacheEnabled=a};e.getElevation=function(a,c,d,f,g){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var b=this.lastElevationQuery;if(a===b.x&&c===b.y&&d===b.z&&z.equals(f,b.spatialReference)&&g===b.queryContext)return b.result}b=n(null,this._im,a,c,d,f,g);l.isNone(b)&&(b=n(b,this._ground,a,c,d,f,g));"scene"===g&&(b=n(b,this._scene,a,c,d,f,g));this.elevationCacheEnabled&&(this.lastElevationQuery={x:a,y:c,z:d,spatialReference:f,queryContext:g,result:b});return b};e.getSphereElevationBounds=
function(a,c){let d=Infinity,f=-Infinity;for(const g of[this._im,this._ground,this._scene])g.forEach(b=>{b.getSphereElevationBounds&&(b=b.getSphereElevationBounds(a,c),l.isSome(b)&&(d=Math.min(d,b.min),f=Math.max(f,b.max)))});return{min:d,max:f}};e.queryElevation=function(a,c,d,f,g,b=null,B=0){const p=u.createResolver();this._elevationQuery.queryElevation(a,c,b,B).then(m=>{"scene"===g&&(m=n(m,this._scene,a,c,d,f,g));p.resolve(m)}).catch(m=>{u.isAbortError(m)?p.reject(m):p.resolve(this.getElevation(a,
c,d,f,g))});return p.promise};e.register=function(a,c){this._handles.set(c,c.on("elevation-change",d=>this.emit("elevation-change",d)));this._providersFromContext(a).push(c)};e.unregister=function(a){this._handles.has(a)&&(this._handles.get(a)?.remove(),this._handles.delete(a));for(const c of[this._im,this._ground,this._scene]){const d=c.indexOf(a);-1<d&&c.splice(d,1)}};e._providersFromContext=function(a){switch(a){case "ground":return this._ground;case "im":return this._im;case "scene":return this._scene}};
q._createClass(h,[{key:"spatialReference",get:function(){return this.view?.basemapTerrain?.spatialReference}},{key:"_elevationQuery",get:function(){l.isNone(this._elevationQueryCached)&&(this._elevationQueryCached=new A.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQueryCached}}]);return h}(x.EventedMixin(w));r.__decorate([v.property({constructOnly:!0})],k.CombinedElevationProvider.prototype,
"view",void 0);r.__decorate([v.property()],k.CombinedElevationProvider.prototype,"spatialReference",null);k.CombinedElevationProvider=r.__decorate([y.subclass("esri.views.3d.support.CombinedElevationProvider")],k.CombinedElevationProvider);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});