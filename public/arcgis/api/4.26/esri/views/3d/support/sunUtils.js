// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),function(x,C,z,D,y,V,u,A,e,l,N,v,fa){function W(b,f,k){f===N.ViewingMode.Global?e.normalize(O,b.eye):e.set(O,0,0,1);e.scale(P,b.viewForward,-1);f=fa.angle(P,O);const g=Math.max(f-.5,0);y.fromRotation(X,
-Math.max(.25,f-.25-.85*g/(g+1)),b.viewRight);e.transformMat4(k,P,X);e.add(k,k,e.scale(ha,b.viewRight,.2));e.normalize(k,k)}function Y(b,f,k,g){const p=ia,c=y.identity(ja);if(k===N.ViewingMode.Global)v.SunCalc.getPosition(b,0,0,p),e.set(g,0,0,-1),y.rotateX(c,c,-p.azimuth),y.rotateY(c,c,-p.altitude);else{var d=q.planarDirection;k=d.globalAngles;d=(Math.abs(f[2])-d.localAltitude)/(d.globalAltitude-d.localAltitude);d=z.clamp(d,0,1);1>d?(v.SunCalc.getPosition(b,f[1],f[0],p),p.azimuth=(1-d)*p.azimuth+
d*k.azimuth,p.altitude=(1-d)*p.altitude+d*k.altitude):(p.azimuth=k.azimuth,p.altitude=k.altitude);e.set(g,0,-1,0);y.rotateZ(c,c,-p.azimuth);y.rotateX(c,c,-p.altitude)}e.transformMat4(g,g,c)}function Z(b){switch(b){case "disabled":case "sunny":return new B(1,1);case "cloudy":return new B(1,1);case "rainy":return new B(.4,1.2);case "snowy":return new B(.5,1.3);case "foggy":return new B(.2,1.6)}}function aa(b,f){const k=(b[0]+b[1]+b[2])/3;b[0]+=(k-b[0])*f;b[1]+=(k-b[1])*f;b[2]+=(k-b[2])*f}const q={local:{altitude:1500,
ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let B=C._createClass(function(b,f){this.direct=b;this.ambient=f});const ka=l.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);C=C._createClass(function(){this.ambient={color:l.fromValues(1,1,1),intensity:.55};this.direct={color:l.fromValues(1,
1,1),intensity:.55,directionToLightSource:l.clone(ka)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1});const ja=V.create(),ia={azimuth:0,altitude:0},Q=l.fromValues(.01,.01,.01),E=l.fromValues(1,.6,.5),F=l.fromValues(1,.98,.98),ba=l.fromValues(1,1,1),R=l.fromValues(.8,.8,1),G=l.fromValues(.8,.8,1),H=l.fromValues(.98,.98,1),ca=l.fromValues(1,1,1),S=A.fromValues(.01,q.local.ambientAtNight),I=A.fromValues(q.local.directAtTwilight,q.local.ambientAtTwilight),J=
A.fromValues(.9*q.local.directAtNoon,q.local.ambientAtNoon),da=A.fromValues(q.local.directAtNoon,q.local.ambientAtNoon),ea=new Date(0),X=V.create(),O=l.create(),P=l.create(),ha=l.create();x.ColorAndIntensity=C;x.computeColorAndIntensity=function(b,f,k,g,p,c){e.set(c.ambient.color,1,1,1);c.ambient.intensity=q.global.ambient;e.set(c.direct.color,1,1,1);c.direct.intensity=q.global.direct;var d=z.clamp((Math.abs(f[2])-q.local.altitude)/(q.global.altitude-q.local.altitude),0,1);c.globalFactor=d;var r;
D.isSome(b)&&(r=v.SunCalc.getTimes(b,f[1],f[0]));if(1>d){if(D.isSome(b)){var h=r;var a=b.valueOf();if(h.polarException===v.SunCalc.PolarException.MIDNIGHT_SUN){var m=a-36E5*(b.getHours()+48)-6E4*b.getMinutes();h=m+432E6}else h.polarException===v.SunCalc.PolarException.POLAR_NIGHT?(m=a-2,h=a-1):(m=h.sunrise.valueOf(),h=h.sunset.valueOf());var n=h-m;var t=m+n/2,w=n/4;const K=t-w;w=t+w;n*=.06;const T=m-n/2,L=m+n/2,M=h-n/2,U=h+n/2;m=A.create();n=l.create();h=l.create();a<T||a>U?(u.copy(m,S),e.copy(n,
Q),e.copy(h,R)):a<L?(a=(a-T)/(L-T),u.lerp(m,S,I,a),e.lerp(n,Q,E,a),e.lerp(h,R,G,a)):a<K?(a=(a-L)/(K-L),u.lerp(m,I,J,a),e.lerp(n,E,F,a),e.lerp(h,G,H,a)):a<t?(a=(a-K)/(t-K),u.lerp(m,J,da,a),e.lerp(n,F,ba,a),e.lerp(h,H,ca,a)):a<w?(a=(a-t)/(w-t),u.lerp(m,da,J,a),e.lerp(n,ba,F,a),e.lerp(h,ca,H,a)):a<M?(a=(a-w)/(M-w),u.lerp(m,J,I,a),e.lerp(n,F,E,a),e.lerp(h,H,G,a)):a<U&&(a=(a-M)/(U-M),u.lerp(m,I,S,a),e.lerp(n,E,Q,a),e.lerp(h,G,R,a));a=0;switch(g){case "rainy":case "foggy":a=.5;break;case "snowy":a=.5}0<
a&&(aa(n,a),aa(h,a));t=Z(g);a=m[0]*t.direct;m=m[1]*t.ambient}else h=Z(g),a=q.local.directAtNoon*h.direct,n=l.fromValues(1,1,1),m=q.local.ambientAtNoon*h.ambient,h=l.fromValues(1,1,1);e.lerp(c.ambient.color,h,c.ambient.color,d);c.ambient.intensity=z.lerp(m,c.ambient.intensity,d);e.lerp(c.direct.color,n,c.direct.color,d);c.direct.intensity=z.lerp(a,c.direct.intensity,d);c.specularStrength="rainy"===g||"snowy"===g||"foggy"===g?0:1;c.environmentStrength="rainy"===g?.7:"snowy"===g||"foggy"===g?.75:1}D.isSome(b)?
(g=b.valueOf(),r.polarException===v.SunCalc.PolarException.MIDNIGHT_SUN?(d=g-36E5*(b.getHours()+48)-6E4*b.getMinutes(),r=d+432E6):r.polarException===v.SunCalc.PolarException.POLAR_NIGHT?(d=g-2,r=g-1):(d=r.sunrise.valueOf(),r=r.sunset.valueOf()),g=1-z.clamp(Math.abs(g-(d+(r-d)/2))/432E5,0,1)):g=1;c.noonFactor=g;D.isSome(b)?Y(b,f,k,c.direct.directionToLightSource):W(p,k,c.direct.directionToLightSource)};x.computeDirectionsOverTime=function(b,f,k,g,p){b=b.getTime();f=f.getTime()-b;f=Math.floor(f/k)+
1;const c=Array(f);for(let d=0;d<f;++d)ea.setTime(b+k*d),c[d]=l.create(),Y(ea,g,p,c[d]);return c};x.computeShadowsEnabled=function(b,f){return f===N.ViewingMode.Global?!0:Math.abs(b)<q.planarDirection.localAltitude};x.computeVirtualLightDirection=W;Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});