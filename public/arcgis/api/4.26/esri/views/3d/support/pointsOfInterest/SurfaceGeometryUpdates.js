// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),function(b,p,d,t,u,v,h,B,C,D,
w,r,l,q){b.SurfaceGeometryUpdates=function(e){function m(a){a=x.call(this,a);a._tileGeometryUpdateExtent=l.empty();a._tileGeometryUpdateSpatialReference=null;a.events=new u;a.updating=!1;return a}p._inherits(m,e);var x=p._createSuper(m);e=m.prototype;e.initialize=function(){this.addHandles([this.surface.on("elevation-change",a=>this._tileGeometryChanged(a)),this.scheduler.registerTask(q.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};e.runTask=function(){if(!this.updating)return q.Task.YIELD;this._tileGeometryUpdateSpatialReference&&
this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",y);l.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return q.Task.YIELD};e._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=v.unwrap(a.spatialReference);l.expand(this._tileGeometryUpdateExtent,a.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};e._furthestCenterOnSurface=function(){let a=this.centerOnSurfaces[0];
for(let k=1;k<this.centerOnSurfaces.length;k++){const n=this.centerOnSurfaces[k];n.distance>a.distance&&(a=n)}return a};e._centerIntersectsExtent=function(a,k){const n=this.state.contentCamera.eye,c=z,A=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(n,f,k);this.renderCoordsHelper.fromRenderCoords(A.renderLocation,g,k);f[0]<g[0]?(c[0]=f[0],c[2]=g[0]):(c[0]=g[0],c[2]=f[0]);f[1]<g[1]?(c[1]=f[1],c[3]=g[1]):(c[1]=g[1],c[3]=f[1]);return l.intersects(c,a)};p._createClass(m,[{key:"running",
get:function(){return this.updating}}]);return m}(t);d.__decorate([h.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"state",void 0);d.__decorate([h.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);d.__decorate([h.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);d.__decorate([h.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"scheduler",void 0);d.__decorate([h.property({constructOnly:!0})],
b.SurfaceGeometryUpdates.prototype,"surface",void 0);d.__decorate([h.property({readOnly:!0})],b.SurfaceGeometryUpdates.prototype,"updating",void 0);b.SurfaceGeometryUpdates=d.__decorate([w.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],b.SurfaceGeometryUpdates);const y={},f=r.create(),g=r.create(),z=l.empty();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});