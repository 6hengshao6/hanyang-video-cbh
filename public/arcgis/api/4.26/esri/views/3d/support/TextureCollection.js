// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(d,g,k,n,p,l,t,u,v,q,m){d.TextureCollection=function(c){function e(a,b){var f=r.call(this,{});f._stage=a;f._textureRequests=new Map;f._frameTask=b?.registerTask(m.TaskPriority.TEXTURE_UNLOAD)??
m.ImmediateTask;return f}g._inherits(e,c);var r=g._createSuper(e);c=e.prototype;c.normalizeCtorArgs=function(){return{}};c.destroy=function(){g._get(g._getPrototypeOf(e.prototype),"destroy",this).call(this);this._frameTask?.remove();this._textureRequests?.forEach(a=>this._releaseTextureRequest(a));this._textureRequests?.clear()};c.fromData=function(a,b,f){const h=this.makeUid(a);a=this._textureRequests.get(h);a||(b=b(),a={referenceCount:0,texture:b,textureAsync:null,abortController:null,onRemove:f},
this._stage&&(this._stage.add(b),this._stage.loadImmediate(b)),this._textureRequests.set(h,a));a.referenceCount++;return{uid:h,texture:a.texture,release:()=>this._release(h)}};c._release=function(a){const b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(a))):console.warn(`TextureCollection: texture doesn't exist: '${a}'`)};c._releaseNow=function(a){if(this._textureRequests){var b=
this._textureRequests.get(a);!b||0<b.referenceCount||(this._releaseTextureRequest(b),this._textureRequests.delete(a))}};c._releaseTextureRequest=function(a){if(a.onRemove)a.onRemove();a.texture?this._stage?.remove(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};c.makeUid=function(a,b=null){return p.isSome(b)?`${a}.${b}px`:a};g._createClass(e,[{key:"updating",get:function(){return this._frameTask.updating}},{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);
return e}(n);k.__decorate([l.property()],d.TextureCollection.prototype,"_frameTask",void 0);k.__decorate([l.property()],d.TextureCollection.prototype,"updating",null);d.TextureCollection=k.__decorate([q.subclass("esri.views.3d.support.TextureCollection")],d.TextureCollection);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});