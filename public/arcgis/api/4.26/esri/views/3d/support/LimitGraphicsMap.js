// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(n,h,m,p,q){m=function(d){function e(a){var b=c.call(this);b._limit=a;b._all=new q.GraphicsMap;b._active=new r(h._assertThisInitialized(b));b._pending=new Map;b._handle=b._all.on("change",f=>b._handleChanges(f));return b}h._inherits(e,d);var c=h._createSuper(e);d=e.prototype;d.destroy=function(){this._handle.remove()};d.toArray=function(){return this._active.toArray()};
d.find=function(a){return this._active.find(a)};d.forEach=function(a){this._active.forEach(a)};d.addMany=function(a){this._all.addMany(a)};d.removeManyByObjectId=function(a){this._all.removeManyByObjectId(a)};d._handleChanges=function(a){let b=a.removed;if(0<this._pending.size){b=[];for(var f of a.removed)this._pending.delete(f.objectId)||b.push(f)}f=this._limit-this._active.length+b.length;f<a.added.length&&(this._active.removeMany(b),b=[],k.reset(1-this._limit/(this._active.length+a.added.length)),
this._active.forEach(g=>{k.sample()&&(b.push(g),this._pending.set(g.objectId,g))}),f=this._limit-this._active.length+b.length);let l=a.added;if(f<a.added.length){l=[];k.reset(f/a.added.length);for(const g of a.added)k.sample()?l.push(g):this._pending.set(g.objectId,g)}a=f-l.length;0<a&&0<this._pending.size&&(k.reset(a/this._pending.size),this._pending.forEach(g=>{k.sample()&&(l.push(g),this._pending.delete(g.objectId))}));this._active.addAndRemove(l,b)};h._createClass(e,[{key:"length",get:function(){return this._active.length}}]);
return e}(m);const k=new (function(){function d(){this._percentage=1;this._last=-1;this._index=0}var e=d.prototype;e.reset=function(c){this._percentage=c;this._last=-1};e.sample=function(){const c=Math.floor(this._index*this._percentage);++this._index;if(c===this._last)return!1;this._last=c;return!0};return h._createClass(d)}());let r=function(){function d(c){this._parent=c;this._map=new Map}var e=d.prototype;e.forEach=function(c){this._map.forEach(a=>c(a))};e.find=function(c){let a=void 0;p.someMap(this._map,
b=>c(b)?(a=b,!0):!1);return a};e.toArray=function(){return[...this._map.values()]};e.addAndRemove=function(c,a){for(const b of c)this._map.set(b.objectId,b);for(const b of a)this._map.delete(b.objectId);(0<c.length||0<a.length)&&this._parent.emit("change",{added:c,removed:a})};e.removeMany=function(c){for(const a of c)this._map.delete(a.objectId);0<c.length&&this._parent.emit("change",{added:[],removed:c})};h._createClass(d,[{key:"length",get:function(){return this._map.size}}]);return d}();n.LimitGraphicsMap=
m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});