// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(ba,E,M,ca,h,da,oa,S,F,x,B,ea,G,N,fa,ha,pa,qa,O,P,ra,sa,T,K,ia,U,ta,ja,ua,va,ka,la,C,y,V,W,wa,xa,n,ya,ma,X){const za=["mesh"];ca=function(g){function D(a,b,c,d){a=Y.call(this,a,b,c,d);a._materials=new Map;a._textures=new Map;a.ensureDrapedStatus(!1);return a}E._inherits(D,g);var Y=E._createSuper(D);g=D.prototype;g.doLoad=async function(){la.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new ma.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new ma.NativeLineMaterial({color:[0,
1,1,1]}))};g.destroy=function(){E._get(E._getPrototypeOf(D.prototype),"destroy",this).call(this);this._context.stage.removeMany(Array.from(this._materials.values(),a=>a.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};g.createGraphics3DGraphic=function(a){const b=a.graphic;if(!this._validateGeometry(b.geometry,za,"fill on mesh-3d"))return null;const c=this.setGraphicElevationContext(b,new ta.ElevationContext);return this._createAs3DShape(b,
a.renderingInfo,c,b.uid)};g.layerOpacityChanged=function(a,b){const c=this._getLayerOpacity();this._materials.forEach(d=>{d.material.setParameters({layerOpacity:c});const e=d.material.parameters;this._setMaterialTransparentParameter(e,d);d.material.setParameters({transparent:e.transparent})});a.forEach(d=>{d=b(d);h.isSome(d)&&d.layerOpacityChanged(c,this._context.isAsync)})};g.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,U.needsElevationUpdates3D)};
g.slicePlaneEnabledChanged=function(a,b){this._materials.forEach(c=>{c.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});a.forEach(c=>{c=b(c);h.isSome(c)&&c.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};g.physicalBasedRenderingChanged=function(){const a=this._usePBR();this._materials.forEach(b=>b.material.setParameters({usePBR:a}));return!0};g._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};
g._colorOrTextureUid=function(a){return h.isNone(a)?"-":a instanceof M?a.toHex():a.contentHash};g._materialPropertiesDefault=function(a,b){const c=this._requiresSymbolVertexColors(),d=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:c,hasVertexColors:d,hasVertexTangents:a,uid:`vc:${d},vt:${a},vct${b},svc:${c}`}};g._materialProperties=function(a,b,c){a=this._materialPropertiesDefault(a,c);if(!b.material)return a;const {color:d,colorTexture:e,normalTexture:f,doubleSided:k,
alphaCutoff:l,alphaMode:v}=b.material;c=this._colorOrTextureUid(d);var w=this._colorOrTextureUid(e),r=this._colorOrTextureUid(f);a.color=d;a.colorTexture=e;a.normalTexture=f;a.uid=`${a.uid},cmuid:${c},ctmuid:${w},ntmuid:${r},ds:${k},ac:${l},am:${v}`;if(b.material instanceof qa){const {metallic:m,roughness:z,metallicRoughnessTexture:t,emissiveColor:p,emissiveTexture:A,occlusionTexture:Q}=b.material;c=this._colorOrTextureUid(t);w=this._colorOrTextureUid(p);r=this._colorOrTextureUid(A);const Aa=this._colorOrTextureUid(Q);
a.metallic=m;a.roughness=z;a.metallicRoughnessTexture=t;a.emissiveColor=p;a.emissiveTexture=A;a.occlusionTexture=Q;a.colorTextureTransform=b.material.colorTextureTransform;a.normalTextureTransform=b.material.normalTextureTransform;a.emissiveTextureTransform=b.material.emissiveTextureTransform;a.occlusionTextureTransform=b.material.occlusionTextureTransform;a.metallicRoughnessTextureTransform=b.material.metallicRoughnessTextureTransform;a.uid=`${a.uid},mrm:${m},mrr:${z},mrt:${c},emuid:${w},etmuid:${r},otmuid:${Aa}`}return a};
g._setInternalColorValueParameters=function(a,b){b.diffuse=M.toUnitRGB(a);b.opacity=a.a};g._getLoadableTextureResource=function(a){return a.data?a.data:a.url};g._getInternalTextureId=function(a){a=this._getInternalTexture(a,y.AlphaDiscardMode.Opaque);return h.isSome(a)?a.id:null};g._getInternalTexture=function(a,b){const c=this._getLoadableTextureResource(a);if(!c)return null;const d=`${a.contentHash}/${b}`;let e=this._textures.get(d);e||(e=new xa.Texture(T.isEncodedMeshTexture(c)?c.data:c,{mipmap:!0,
wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0,preMultiplyAlpha:T.isEncodedMeshTexture(c)?!1:b!==y.AlphaDiscardMode.Opaque,encoding:T.isEncodedMeshTexture(c)&&h.isSome(c.encoding)?c.encoding:void 0}),this._textures.set(d,e),this._context.stage.add(e),this._context.stage.loadImmediate(e));return e};g._castTextureWrap=function(a="repeat"){return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};
g._castTextureWrapIndividual=function(a){switch(a){case "clamp":return X.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return X.TextureWrapMode.MIRRORED_REPEAT;default:return X.TextureWrapMode.REPEAT}};g._setInternalMaterialParameters=function(a,b){h.isSome(a.color)&&this._setInternalColorValueParameters(a.color,b);if(h.isSome(a.colorTexture)){const c=this._getInternalTexture(a.colorTexture,b.textureAlphaMode);h.isSome(c)?(b.textureId=c.id,b.textureAlphaPremultiplied=!!c.params.preMultiplyAlpha):b.textureId=
void 0}h.isSome(a.normalTexture)&&(b.normalTextureId=this._getInternalTextureId(a.normalTexture));h.isSome(a.emissiveColor)&&(b.emissiveFactor=M.toUnitRGB(a.emissiveColor));h.isSome(a.emissiveTexture)&&(b.emissiveTextureId=this._getInternalTextureId(a.emissiveTexture));h.isSome(a.occlusionTexture)&&(b.occlusionTextureId=this._getInternalTextureId(a.occlusionTexture));h.isSome(a.metallicRoughnessTexture)&&(b.metallicRoughnessTextureId=this._getInternalTextureId(a.metallicRoughnessTexture));b.colorTextureTransformMatrix=
K.getTransformMatrix(a.colorTextureTransform);b.normalTextureTransformMatrix=K.getTransformMatrix(a.normalTextureTransform);b.occlusionTextureTransformMatrix=K.getTransformMatrix(a.occlusionTextureTransform);b.emissiveTextureTransformMatrix=K.getTransformMatrix(a.emissiveTextureTransform);b.metallicRoughnessTextureTransformMatrix=K.getTransformMatrix(a.metallicRoughnessTextureTransform)};g._setExternalMaterialParameters=function(a){var b=this._drivenProperties.color;let c=h.isSome(this.symbolLayer.material)?
this.symbolLayer.material.colorMixMode:null;b?a.externalColor=ea.ONES:(b=h.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,h.isSome(b)?a.externalColor=M.toUnitRGBA(b):(c=null,a.externalColor=ea.ONES));c&&(a.colorMixMode=c);a.castShadows=!!this.symbolLayer.castShadows};g._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(h.isNone(a))return!1;for(let b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};g._getOrCreateMaterial=function(a,b){var c=b.material?.color,
d=b.material?.colorTexture,e=b.material?.alphaMode;const f="blend"===e;c="opaque"!==e&&(this._hasTransparentVertexColors(a)||h.isSome(c)&&1>c.a||h.isSome(d)&&d.transparent||f);a=this._materialProperties(a,b,c);if(d=this._materials.get(a.uid))return d.material;c={material:null,isComponentTransparent:c,alphaMode:b.material?b.material.alphaMode:"opaque"};d=null==a.metallicRoughnessTexture&&null==a.metallic&&null==a.roughness;e={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:a.hasVertexColors,hasSymbolColors:a.hasSymbolVertexColors,
hasVertexTangents:a.hasVertexTangents,ambient:B.ZEROS,diffuse:B.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:y.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};d||(e.mrrFactors=[null!=a.metallic?a.metallic:1,null!=a.roughness?a.roughness:1,.5]);b.material&&(e.doubleSided=b.material.doubleSided,e.cullFace=b.material.doubleSided?y.CullFaceOptions.None:y.CullFaceOptions.Back,e.textureAlphaCutoff=
b.material.alphaCutoff);this._setExternalMaterialParameters(e);this._setMaterialTransparentParameter(e,c);this._setInternalMaterialParameters(a,e);b=new ya.DefaultMaterial(e);c.material=b;this._materials.set(a.uid,c);this._context.stage.add(b);return b};g._usePBR=function(){return this._context.physicalBasedRenderingEnabled};g._setMaterialTransparentParameter=function(a,b){a.transparent=this.needsDrivenTransparentPass||b.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];
a.textureAlphaMode="auto"===b.alphaMode?a.transparent?y.AlphaDiscardMode.MaskBlend:y.AlphaDiscardMode.Opaque:"opaque"===b.alphaMode?y.AlphaDiscardMode.Opaque:"mask"===b.alphaMode?y.AlphaDiscardMode.Mask:y.AlphaDiscardMode.Blend};g._addDebugNormals=function(a,b){var c=b.length,d=a.spatialReference.isGeographic?20015077/180:1;const e=.1*Math.max(a.extent.width*d,a.extent.height*d,a.extent.zmax-a.extent.zmin);var f=[];const k=[];a=[];d=[];for(let z=0;z<c;z++){var l=b[z],v=l.vertexAttributes.get(n.VertexAttribute.POSITION),
w=l.vertexAttributes.get(n.VertexAttribute.NORMAL);const t=l.indices.get(n.VertexAttribute.POSITION);l=l.indices.get(n.VertexAttribute.NORMAL);v=v.data;w=w.data;for(let p=0;p<t.length;p++){var r=3*t[p];const A=3*l[p];for(var m=0;3>m;m++)f.push(v[r+m]);for(m=0;3>m;m++)f.push(v[r+m]+w[A+m]*e);k.push(k.length);k.push(k.length);if(0===p%3){this._calculateFaceNormal(v,t,p,H);this._getFaceVertices(v,t,p,q,I,J);x.add(q,q,I);x.add(q,q,J);x.scale(q,q,1/3);for(r=0;3>r;r++)a.push(q[r]);for(r=0;3>r;r++)a.push(q[r]+
H[r]*e);d.push(d.length);d.push(d.length)}}}c=b[0].transformation;f=new W.Geometry(this._debugVertexNormalMaterial,[[n.VertexAttribute.POSITION,new C.Attribute(f,3,!0)]],[[n.VertexAttribute.POSITION,k]],null,V.ContentObjectType.Line);b.push(f);f.transformation=c;a=new W.Geometry(this._debugFaceNormalMaterial,[[n.VertexAttribute.POSITION,new C.Attribute(a,3,!0)]],[[n.VertexAttribute.POSITION,d]],null,V.ContentObjectType.Line);a.transformation=c;b.push(a)};g._createAs3DShape=function(a,b,c,d){a=a.geometry;
if("mesh"!==a.type)return null;b=this._createGeometryInfo(a,b,d);if(h.isNone(b))return null;const {geometries:e,objectTransformation:f}=b;la.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,e);d=new wa.Object3D({geometries:e,metadata:{layerUid:this._context.layer.uid,graphicUid:d}});d.transformation=f;b=va.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});b=h.isSome(b)?new ja.Object3DEdgeState(e[0].material,[b],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):
null;b=new ja.Graphics3DObject3DGraphicLayer(this,d,e,null,null,ia.perObjectElevationAligner,c,b);b.needsElevationUpdates=U.needsElevationUpdates3D(c.mode);b.useObjectOriginAsAttachmentOrigin=!0;c.centerPointInElevationSR=this._getCenterPointInElevationSR(d);const {elevationProvider:k,renderCoordsHelper:l}=this._context;b.alignedSampledElevation=ia.perObjectElevationAligner(b,c,k.spatialReference,(v,w)=>U.evaluateElevationInfoAtPoint(v,k,c,l,w),l);return b};g._getCenterPointInElevationSR=function(a){const b=
ra.makeDehydratedPoint(0,0,0,h.isSome(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);G.projectVectorToDehydratedPoint([a.transformation[12],a.transformation[13],a.transformation[14]],this._context.renderCoordsHelper.spatialReference,b);return b};g._createComponentNormals=function(a,b,c,d){switch(c.shading||"flat"){default:case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,
d);case "smooth":return this._createComponentNormalsSmooth(a,d)}};g._createComponentNormalsSource=function(a,b,c,d){if(h.isNone(b))return this._createComponentNormalsFlat(a,d);let e=!1;if(!c.trustSourceNormals)for(c=0;c<d.length;c+=3){this._calculateFaceNormal(a,d,c,H);for(let f=0;3>f;f++){const k=3*d[c+f];q[0]=b[k];q[1]=b[k+1];q[2]=b[k+2];0>x.dot(H,q)&&(b[k]=-b[k],b[k+1]=-b[k+1],b[k+2]=-b[k+2],e=!0)}}return new Z(b,d,e)};g._createComponentNormalsFlat=function(a,b){const c=fa.newFloatArray(b.length),
d=Array(3*b.length);for(let e=0;e<b.length;e+=3){const f=this._calculateFaceNormal(a,b,e,H);for(let k=0;3>k;k++)c[e+k]=f[k],d[e+k]=e/3}return new Z(c,d,!1)};g._createComponentNormalsSmooth=function(a,b){const c={};for(var d=0;d<b.length;d+=3){var e=this._calculateFaceNormal(a,b,d,H);for(var f=0;3>f;f++){var k=b[d+f];let l=c[k];l||(l={normal:B.create(),count:0},c[k]=l);x.add(l.normal,l.normal,e);l.count++}}a=fa.newFloatArray(3*b.length);d=Array(3*b.length);for(e=0;e<b.length;e++){f=c[b[e]];1!==f.count&&
(x.normalize(f.normal,f.normal),f.count=1);for(k=0;3>k;k++)a[3*e+k]=f.normal[k];d[e]=e}return new Z(a,d,!1)};g._getFaceVertices=function(a,b,c,d,e,f){const k=3*b[c],l=3*b[c+1];b=3*b[c+2];d[0]=a[k];d[1]=a[k+1];d[2]=a[k+2];e[0]=a[l];e[1]=a[l+1];e[2]=a[l+2];f[0]=a[b];f[1]=a[b+1];f[2]=a[b+2]};g._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,q,I,J);x.subtract(I,I,q);x.subtract(J,J,q);x.cross(q,I,J);x.normalize(d,q);return d};g._getOrCreateComponents=function(a){return h.unwrapOr(a.components,
Ba)};g._createPositionBuffer=function(a,b){let c=a.vertexAttributes.position;const d=b.reprojection===u.ECEF?b.transformBeforeProject:null;h.isSome(d)&&(c=O.transformMat4(new Float64Array(c.length),c,d));if(b.reprojection===u.NONE)return b.needsBufferCopy?new Float64Array(c):c;b=h.isSome(d)?c:new Float64Array(c.length);G.projectBuffer(c,a.spatialReference,0,b,this._context.renderCoordsHelper.spatialReference,0,c.length/3);return b};g._createNormalBuffer=function(a,b,c){let d=a.vertexAttributes.normal;
if(h.isNone(d))return null;var e=c.reprojection===u.ECEF?c.transformBeforeProject:null;h.isSome(e)&&(d=P.transformNormal(d,new Float32Array(d.length),e));if("local"===this._context.graphicsCoreOwner.view.viewingMode||c.reprojection===u.NONE)return c.needsBufferCopy&&a.vertexAttributes.normal===d?new Float32Array(d):d;c=a.vertexAttributes.position;e=h.isSome(e)?d:new Float32Array(d.length);return P.projectNormalToPCPF(d,c,b,a.spatialReference,e)};g._createTangentBuffer=function(a,b,c){let d=a.vertexAttributes.tangent;
if(h.isNone(d))return null;var e=c.reprojection===u.ECEF?c.transformBeforeProject:null;h.isSome(e)&&(d=P.transformTangent(d,new Float32Array(d.length),e));if("local"===this._context.graphicsCoreOwner.view.viewingMode||c.reprojection===u.NONE)return c.needsBufferCopy&&a.vertexAttributes.normal===d?new Float32Array(d):d;c=a.vertexAttributes.position;e=h.isSome(e)?d:new Float32Array(d.length);return P.projectTangentToPCPF(d,c,b,a.spatialReference,e)};g._createColorBuffer=function(a){return a.vertexAttributes.color};
g._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);const b=ka.parseColorMixMode(h.get(this.symbolLayer,"material","colorMixMode")),c=new Uint8Array(4);ka.encodeSymbolColor(a,b,c);return c}return null};g._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal;const e=a.vertexAttributes.uv;
var f=a.vertexAttributes.tangent;if(h.isSome(d)&&d.length!==c.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(h.isSome(f)&&f.length/4!==c.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(h.isSome(e)&&e.length/2!==c.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;f=this._computeReprojectionInfo(a);c=this._createPositionBuffer(a,f);d=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);const k=this._createNormalBuffer(a,c,f),l=this._createTangentBuffer(a,c,f);a=f.reprojection===u.NONE&&h.isSome(f.objectTransformation)?f.objectTransformation:this._transformOriginLocal(a,c,k,l);f=f.reprojection===u.NONE&&h.isSome(f.geometryTransformation)?f.geometryTransformation:F.create();return{positionBuffer:c,normalBuffer:k,tangentBuffer:l,uvBuffer:e,colorBuffer:d,
symbolColorBuffer:b,objectTransformation:a,geometryTransformation:f}};g._computeReprojectionInfo=function(a){var b=h.isSome(a.transform);const c=b&&a.transform.geographic?u.NONE:this._context.renderCoordsHelper.viewingMode===sa.ViewingMode.Local?u.NONE:u.ECEF;if(b){if(c===u.NONE)return b=F.create(),G.computeTranslationToOriginAndRotation(a.spatialReference,a.transform.origin,b,this._context.renderCoordsHelper.spatialReference),a=F.clone(a.transform.localMatrix),{reprojection:c,objectTransformation:b,
geometryTransformation:a,needsBufferCopy:!1};b=S.fromTranslation(F.create(),a.transform.origin);S.multiply(b,b,a.transform.localMatrix);return{reprojection:c,transformBeforeProject:b,needsBufferCopy:!0}}return{reprojection:c,needsBufferCopy:!0}};g._transformOriginLocal=function(a,b,c,d){const e=this._context.renderCoordsHelper.spatialReference;var f=a.anchor;R[0]=f.x;R[1]=f.y;R[2]=f.z;f=F.create();G.computeTranslationToOriginAndRotation(a.spatialReference,R,f,e);S.invert(na,f);O.transformMat4(b,b,
na);if(h.isSome(c)||h.isSome(d))da.fromMat4(L,f),da.transpose(L,L),h.isSome(c)&&O.transformMat3(c,c,L),h.isSome(d)&&O.transformMat3(d,d,L,4);return f};g._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){let c=-1;for(let d=0;d<b.length;d++){const e=b[d];e>c&&(c=e)}if(a<=c)return this.logger.warn(`Vertex index ${c} is out of bounds of the mesh position buffer`),!1}else if(0!==a%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};g._getOrCreateFaces=function(a,b){return b.faces??ha.getContinuousIndexArray(a.vertexAttributes.position.length/3)};g._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;const c=this._context.elevationProvider.spatialReference,d=b.length/3;h.isSome(c)&&!a.spatialReference.equals(c)&&(b=new Float64Array(b.length),G.projectBuffer(a.vertexAttributes.position,a.spatialReference,0,b,c,0,d));N.empty(aa);
N.expandWithBuffer(aa,b,0,d);return!N.intersectsClippingArea(aa,this._context.clippingExtent)};g._createGeometryInfo=function(a,b,c){if(!G.canProjectWithoutEngine(a.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;b=this._createBuffers(a,b);if(h.isNone(b))return null;const {positionBuffer:d,uvBuffer:e,colorBuffer:f,symbolColorBuffer:k,normalBuffer:l,
tangentBuffer:v,objectTransformation:w,geometryTransformation:r}=b;var m=this._getOrCreateComponents(a);b=[];let z=!1;for(const A of m){if(!this._validateFaces(a,A))return null;var t=this._getOrCreateFaces(a,A);if(0===t.length)continue;var p=this._createComponentNormals(d,l,A,t);p.didFlipNormals&&(z=!0);m=[[n.VertexAttribute.POSITION,new C.Attribute(d,3,!0)],[n.VertexAttribute.NORMAL,new C.Attribute(p.normals,3,!0)]];p=[[n.VertexAttribute.POSITION,t],[n.VertexAttribute.NORMAL,p.indices]];h.isSome(f)&&
(m.push([n.VertexAttribute.COLOR,new C.Attribute(f,4,!0)]),p.push([n.VertexAttribute.COLOR,t]));h.isSome(k)&&(m.push([n.VertexAttribute.SYMBOLCOLOR,new C.Attribute(k,4,!0)]),p.push([n.VertexAttribute.SYMBOLCOLOR,ha.getZeroIndexArray(t.length)]));h.isSome(e)&&(m.push([n.VertexAttribute.UV0,new C.Attribute(e,2,!0)]),p.push([n.VertexAttribute.UV0,t]));h.isSome(v)&&(m.push([n.VertexAttribute.TANGENT,new C.Attribute(v,4,!0)]),p.push([n.VertexAttribute.TANGENT,t]));t=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:c,
layerUid:this._context.layer.uid});const Q=this._getOrCreateMaterial(a,A);m=new W.Geometry(Q,m,p,null,V.ContentObjectType.Mesh,t);m.transformation=r;b.push(m)}z&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:b,objectTransformation:w}};return E._createClass(D)}(ua.Graphics3DSymbolLayer);let Z=E._createClass(function(g,D,Y){this.normals=
g;this.indices=D;this.didFlipNormals=Y});const R=B.create(),q=B.create(),I=B.create(),J=B.create(),H=B.create(),na=F.create(),L=oa.create(),aa=N.create(),Ba=[new pa];var u;(function(g){g[g.NONE=0]="NONE";g[g.ECEF=1]="ECEF"})(u||(u={}));ba.Graphics3DMeshFillSymbolLayer=ca;Object.defineProperty(ba,Symbol.toStringTag,{value:"Module"})});