// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),function(f,k,p,A,M,N,l,w,O,P,B,Q,R){function r(a){return null!==a&&void 0!==a}function q(a){return"number"===typeof a}
function u(a){return"string"===typeof a}function g(a,b){a&&a.push(b)}function S(a,b,c,d=w.create()){a=a||0;b=b||0;c=c||0;0!==a&&l.rotateZ(d,d,-a/180*Math.PI);0!==b&&l.rotateX(d,d,b/180*Math.PI);0!==c&&l.rotateY(d,d,c/180*Math.PI);return d}function m(a,b,c,d,e){const h=a.minSize,C=a.maxSize;if(a.expression)return g(e,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=d.symbolSize[c],b.minSize[c]=a,b.maxSize[c]=a,b.offset[c]=b.minSize[c],b.factor[c]=0,b.type[c]=
f.FastSizeType.DefinedSize,!0;if(r(a.field)){if(r(a.stops)){if(2===a.stops.length&&q(a.stops[0].size)&&q(a.stops[1].size))return D(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,c),b.type[c]=f.FastSizeType.DefinedSize,!0;g(e,"Could not convert size info: stops only supported with 2 elements");return!1}if(q(h)&&q(C)&&r(a.minDataValue)&&r(a.maxDataValue))return D(h,C,a.minDataValue,a.maxDataValue,b,c),b.type[c]=f.FastSizeType.DefinedSize,!0;if(null!=B.meterIn[a.valueUnit])return b.minSize[c]=
-Infinity,b.maxSize[c]=Infinity,b.offset[c]=0,b.factor[c]=1/B.meterIn[a.valueUnit],b.type[c]=f.FastSizeType.DefinedSize,!0;if("unknown"===a.valueUnit)return g(e,"Could not convert size info: proportional size not supported"),!1;g(e,"Could not convert size info: scale-dependent size not supported");return!1}if(!r(a.field)){if(a.stops&&a.stops[0]&&q(a.stops[0].size))return b.minSize[c]=a.stops[0].size,b.maxSize[c]=a.stops[0].size,b.offset[c]=b.minSize[c],b.factor[c]=0,b.type[c]=f.FastSizeType.DefinedSize,
!0;if(q(h))return b.minSize[c]=h,b.maxSize[c]=h,b.offset[c]=h,b.factor[c]=0,b.type[c]=f.FastSizeType.DefinedSize,!0}g(e,"Could not convert size info: unsupported variant of sizeInfo");return!1}function D(a,b,c,d,e,h){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[h]=0<d?a:b;e.maxSize[h]=0<d?b:a;e.offset[h]=a-c*d;e.factor[h]=d}function T(a,b,c,d){if(a.normalizationField||a.valueRepresentation)return g(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!u(e))return g(d,
"Could not convert size info: field is not a string"),null;if(!b.size)b.size=new E(a.field);else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return g(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=m(a,b.size,0,c,d))?b:null;case "height":return(e=m(a,b.size,2,c,d))?b:null;case "depth":return(e=m(a,b.size,1,c,d))?b:null;case "width-and-depth":return(e=m(a,b.size,0,c,d))&&m(a,b.size,1,c,d),e?b:null;case null:case void 0:case "all":return(e=
(e=(e=m(a,b.size,0,c,d))&&m(a,b.size,1,c,d))&&m(a,b.size,2,c,d))?b:null;default:return g(d,`Could not convert size info: unknown axis "${a.axis}""`),null}}function U(a,b,c){for(let d=0;3>d;++d){let e=b.unitInMeters;a.type[d]===f.FastSizeType.DefinedSize&&(e*=b.modelSize[d],a.type[d]=f.FastSizeType.DefinedScale);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(a.type[0]!==f.FastSizeType.Undefined)b=0;else if(a.type[1]!==f.FastSizeType.Undefined)b=1;else if(a.type[2]!==f.FastSizeType.Undefined)b=
2;else return g(c,"No size axis contains a valid size or scale"),!1;for(c=0;3>c;++c)a.type[c]===f.FastSizeType.Undefined&&(a.minSize[c]=a.minSize[b],a.maxSize[c]=a.maxSize[b],a.offset[c]=a.offset[b],a.factor[c]=a.factor[b],a.type[c]=a.type[b]);return!0}function F(a,b,c){a[4*b]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function V(a,b,c){if(a.normalizationField)return g(c,"Could not convert color info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return g(c,
"Could not convert color info: too many color stops"),null;b.color=new G(a.field);a=a.stops;for(c=0;8>c;++c){const d=a[Math.min(c,a.length-1)];b.color.values[c]=d.value;F(b.color.colors,c,d.color)}}else return g(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(a=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},c=0;8>c;c++)b.color.values[c]=
Infinity,F(b.color.colors,c,a);else return g(c,"Could not convert color info: no field and no colors/stops"),null;return b}function W(a,b,c){if(a.normalizationField)return g(c,"Could not convert opacity info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return g(c,"Could not convert opacity info: too many opacity stops"),null;b.opacity=new H(a.field);a=a.stops;for(c=0;8>c;++c){const d=a[Math.min(c,a.length-1)];b.opacity.values[c]=d.value;b.opacity.opacityValues[c]=d.opacity}}else return g(c,
"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].opacity:0,b.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},c=0;8>c;c++)b.opacity.values[c]=Infinity,b.opacity.opacityValues[c]=a;else return g(c,"Could not convert opacity info: no field and no opacities/stops"),null;return b}function x(a,b,c){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=
1}function X(a,b,c){if(!u(a.field))return g(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return g(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return x(a,b.rotation,0),b;case "roll":return x(a,b.rotation,1),b;case null:case void 0:case "heading":return x(a,
b.rotation,2),b;default:return g(c,`Could not convert rotation info: unknown axis "${a.axis}""`),null}}function y(a,b,c){if(!a)return null;const d=a.reduce((e,h)=>{if(!e)return e;if(h.valueExpression)return g(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return b.supportsSize?T(h,e,b,c):e;case "color":return b.supportsColor?V(h,e,c):e;case "opacity":return b.supportsOpacity?W(h,e,c):null;case "rotation":return b.supportsRotation?X(h,e,c):
e;default:return null}},new I);return 0<a.length&&d&&!d.size&&!d.color&&!d.opacity&&!d.rotation||d&&d.size&&!U(d.size,b,c)?null:d}function v(a,b,c){if(!!a!==!!b||a&&a.field!==b?.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function z(a,b){a=new J(a);a.vvSize&&(a.vvSymbolAnchor=b.anchor,l.identity(t),S(b.rotation[2],b.rotation[0],b.rotation[1],t),a.vvSymbolRotationMatrix=a.vvSymbolRotationMatrix||
N.create(),M.fromMat4(a.vvSymbolRotationMatrix,t));return a}f.FastSizeType=void 0;(function(a){a[a.Undefined=0]="Undefined";a[a.DefinedSize=1]="DefinedSize";a[a.DefinedScale=2]="DefinedScale"})(f.FastSizeType||(f.FastSizeType={}));f.FastRotationType=void 0;(function(a){a[a.Undefined=0]="Undefined";a[a.DefinedAngle=1]="DefinedAngle"})(f.FastRotationType||(f.FastRotationType={}));p=k._createClass(function(a){this.field=a});let E=function(a){function b(d){d=c.call(this,d);d.minSize=[0,0,0];d.maxSize=
[0,0,0];d.offset=[0,0,0];d.factor=[0,0,0];d.type=[f.FastSizeType.Undefined,f.FastSizeType.Undefined,f.FastSizeType.Undefined];return d}k._inherits(b,a);var c=k._createSuper(b);return k._createClass(b)}(p),G=function(a){function b(d){d=c.call(this,d);d.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];d.values=[0,0,0,0,0,0,0,0];return d}k._inherits(b,a);var c=k._createSuper(b);return k._createClass(b)}(p),H=function(a){function b(d){d=c.call(this,d);d.values=[0,0,0,0,0,0,0,0];
d.opacityValues=[0,0,0,0,0,0,0,0];return d}k._inherits(b,a);var c=k._createSuper(b);return k._createClass(b)}(p);p=function(a){function b(d){d=c.call(this,d);d.offset=[0,0,0];d.factor=[1,1,1];d.type=[0,0,0];return d}k._inherits(b,a);var c=k._createSuper(b);return k._createClass(b)}(p);let I=k._createClass(function(){this.rotation=this.opacity=this.color=this.size=null}),Y=k._createClass(function(a=[1,1,1],b=[1,1,1],c=1,d=[0,0,0],e=[1,1,1],h=[0,0,0]){this.modelSize=a;this.symbolSize=b;this.unitInMeters=
c;this.anchor=d;this.scale=e;this.rotation=h;this.supportsRotation=this.supportsColor=this.supportsSize=!0;this.supportsOpacity=!1}),K=k._createClass(function(a,b,c){this.visualVariables=a;this.materialParameters=b;this.requiresShaderTransformation=c}),J=function(a){function b(d=null){var e=c.call(this);e.vvSymbolAnchor=null;e.vvSymbolRotationMatrix=null;e.vvSize=d?.size??null;e.vvColor=d?.color??null;e.vvOpacity=d?.opacity??null;return e}k._inherits(b,a);var c=k._createSuper(b);return k._createClass(b)}(R.NoParameters);
const n=w.create(),L=P.create(),t=w.create();f.ConvertOptions=Y;f.FastColorInfo=G;f.FastOpacityInfo=H;f.FastRotationInfo=p;f.FastSizeInfo=E;f.FastSymbolUpdatesState=K;f.FastVisualVariables=I;f.VisualVariablesParameters=J;f.convertVisualVariables=y;f.evaluateModelTransform=function(a,b,c){if(!a.vvSize)return c;l.copy(n,c);c=a.vvSymbolRotationMatrix;l.set(t,c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1);l.multiply(n,n,t);for(c=0;3>c;++c)L[c]=A.clamp(a.vvSize.offset[c]+b[0]*a.vvSize.factor[c],
a.vvSize.minSize[c],a.vvSize.maxSize[c]);l.scale(n,n,L);l.translate(n,n,a.vvSymbolAnchor);return n};f.evaluateModelTransformScale=function(a,b,c){if(b.vvSize)for(let d=0;3>d;++d)a[d]=A.clamp(b.vvSize.offset[d]+c[0]*b.vvSize.factor[d],b.vvSize.minSize[d],b.vvSize.maxSize[d]);else O.set(a,1,1,1)};f.getMaterialParameters=z;f.initFastSymbolUpdatesState=function(a,b){return!a||Q.TESTS_DISABLE_FAST_UPDATES?null:(a=y(a.visualVariables,b))?new K(a,z(a,b),!!a.size):null};f.updateFastSymbolUpdatesState=function(a,
b,c){if(!b||!a)return!1;const d=a.visualVariables;b=y(b.visualVariables,c);if(!(b&&v(d.size,b.size,"size")&&v(d.color,b.color,"color")&&v(d.rotation,b.rotation,"rotation")&&v(d.opacity,b.opacity,"opacity")))return!1;a.visualVariables=b;a.materialParameters=z(b,c);a.requiresShaderTransformation=!!b.size;return!0};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});