// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(n,q,g,l,r,t,u){let v=function(){function p(a){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=a("gltf-resources",()=>{});this._wosrMemCache=a("wosr-resources",()=>{})}var h=p.prototype;h.destroy=function(){this._gltfLoading.forEach(a=>a.abortController.abort());this._wosrLoading.forEach(a=>
a.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()};h.loadGLTF=function(a,c,b){const d=b?`gltfPBR:${a}`:`gltf:${a}`,e=this._gltfMemCache.get(d);return g.isSome(e)?Promise.resolve(e):this._loadOnce(this._gltfLoading,this._gltfMemCache,d,k=>t.loadGLTF(new r.DefaultLoadingContext(k.streamDataRequester),a,k,b),c)};h.loadWOSR=function(a,c){const b=`wosr:${a}:${c.disableTextures}`,d=this._wosrMemCache.get(b);return g.isSome(d)?Promise.resolve(d):this._loadOnce(this._wosrLoading,
this._wosrMemCache,b,e=>u.load(a,e),c)};h._loadOnce=async function(a,c,b,d,e){l.throwIfAborted(e);const k=l.onAbort(e,()=>this._abortLoad(a,b));var f=a.get(b);f?f.refCount++:(f=new AbortController,d=d({...e,signal:f.signal}),f={refCount:1,abortController:f,promise:d},a.set(b,f));try{const m=await f.promise;c.put(b,m,m.size);a.delete(b);l.throwIfAborted(e);return m}finally{g.removeMaybe(k)}};h._abortLoad=function(a,c){const b=a.get(c);g.isSome(b)&&0<--b.refCount||(a.delete(c),g.isSome(b)&&b.abortController.abort())};
return q._createClass(p)}();n.ObjectResourceCache=v;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});