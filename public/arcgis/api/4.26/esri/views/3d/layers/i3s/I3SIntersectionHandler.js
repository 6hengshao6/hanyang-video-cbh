// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../ViewingMode ./I3SUtil ./Intersector ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(w,C,h,D,x,E,y,F,z,G){function H(d,e,a,f=0){f=d[3]+f;const g=e[0]-d[0],k=e[1]-d[1];d=e[2]-d[2];e=a[0];const c=a[1];a=a[2];const m=e*g+c*k+a*d;return 0<=m*m-(e*e+c*c+a*a)*(g*g+k*k+d*d-f*f)}let M=function(){function d(a){this.type=
z.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=a.layerUid;this.sublayerUid=a.sublayerUid;this._collection=a.collection;this._traverseNodeHierarchy=a.traverseNodeHierarchy;this.slicePlaneEnabled=a.slicePlaneEnabled;this.isGround=a.isGround}var e=d.prototype;e.updateElevationAlignState=function(a,f){this._needVerticalOffset=a&&f===D.ViewingMode.Global};e.intersect=function(a,f,g,k){const c=a.results,m=a.options.store===z.StoreResults.ALL,t=a.ray.direction,n=a.tolerance;let A=b=>b,u=
b=>b;const p=G.getVerticalOffsetI3S(h.isSome(a.verticalOffset)?a.verticalOffset:this._needVerticalOffset?0:null);h.isSome(a.verticalOffset)&&h.isSome(p)&&(A=b=>p.applyToMbs(b),u=b=>p.applyToObb(b));this._traverseNodeHierarchy((b,B)=>{if(0===b.childrenLoaded)return!1;const v=h.isSome(b.serviceObbInRenderSR)&&x.isValidObb(b.serviceObbInRenderSR)?b.serviceObbInRenderSR:null;if(h.isSome(v)&&!y.intersectLine(u(v),g,t,n))return!1;B&&(h.isSome(v)||!x.isValidMbs(b.renderMbs)||H(A(b.renderMbs),g,t,n))&&(h.isNone(b.geometryObb)||
y.intersectLine(u(b.geometryObb),g,t,n))&&this._collection.intersect(B,g,k,n,p,(I,l,J,K)=>{if(0<=l&&(null==f||f(g,k,l))){var r=q=>{const L=new E.I3sTarget(this.layerUid,this.sublayerUid,b.index,I,K);q.set(this.type,L,l,J)};this.isGround&&(null==c.ground.dist||l<c.ground.dist)&&r(c.ground);if(!a.options.isFiltered&&((null==c.min.dist||l<c.min.dist)&&r(c.min),(null==c.max.dist||l>c.max.dist)&&r(c.max),m)){const q=F.newIntersectorResult(a.ray);r(q);a.results.all.push(q)}}});return!0})};return C._createClass(d)}();
w.I3SIntersectionHandler=M;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});