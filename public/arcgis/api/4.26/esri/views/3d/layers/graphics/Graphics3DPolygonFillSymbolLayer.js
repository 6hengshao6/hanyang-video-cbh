// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(w,k,E,f,F,x,g,y,u,n,G,H,I,v,J,K,p,z,A,B,C,L,D,M,N,O){const P=["polyline","polygon","extent"];v=function(e){function h(a,b,c,d){a=r.call(this,a,b,c,d);a._needsUV=!1;a._hasOutline=!1;return a}k._inherits(h,e);var r=k._createSuper(h);e=h.prototype;e.doLoad=async function(){};e._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};e._ensureFillMaterial=function(){if(!f.isSome(this._material)){var a=f.get(this.symbolLayer,"material","color");a=this._getCombinedOpacityAndColor(a);
this._material=z.createMaterial(this.symbolLayer,{color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled,draped:this.draped});this._needsUV=this._material instanceof N.PatternMaterial;this._context.stage.add(this._material)}};e._ensureOutlineMaterial=function(){const a=this.symbolLayer.outline;!f.isSome(this._outlineMaterial)&&this._isValidOutline(a)&&(this._hasOutline=!0,this._outlineMaterial=
(b=>{const c=M.getStipplePatternForLinePattern(a.pattern);return new O.RibbonLineMaterial({width:b,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:c,stippleScaleWithLineWidth:!0,cap:K.parseCapType(a.patternCap||"butt")})})(F.pt2px(a.size)),this._context.stage.add(this._outlineMaterial))};e._isValidOutline=function(a){return f.isSome(a)&&null!=a.size&&0<a.size&&f.isSome(a.color)&&(f.isNone(a.pattern)||"style"!==a.pattern.type||
"none"!==a.pattern.style)};e.destroy=function(){k._get(k._getPrototypeOf(h.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};e.createGraphics3DGraphic=function(a){const b=a.graphic;if(!this._validateGeometry(b.geometry,P,this.symbolLayer.type))return null;a=this._getVertexOpacityAndColor(a.renderingInfo,255);const c=this.setGraphicElevationContext(b,new G.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===c.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(b,a):this._createAs3DShape(b,a,c)};e.layerOpacityChanged=function(){if(f.isSome(this._material)){var a=this._material.parameters.color,b=f.get(this.symbolLayer,"material","color");b=this._getCombinedOpacity(b);this._material.setParameters({color:[a[0],a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass})}f.isSome(this._outlineMaterial)&&(a=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[a[0],a[1],a[2],this._getOutlineOpacity()]}))};e.layerElevationInfoChanged=function(a,b,c){const d=this._elevationContext.mode;c=n.elevationModeChangeUpdateType(h.elevationModeChangeTypes,c,d);if(c!==n.SymbolUpdateType.UPDATE)return c;const l=n.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,()=>l)};e.slicePlaneEnabledChanged=function(){f.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
f.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};e.physicalBasedRenderingChanged=function(){return!0};e._createAs3DShape=function(a,b,c){const d=p.geometryAsPolygon(a.geometry);if(f.isNone(d))return null;var l=C.geometryToRenderInfo(d,this._context.elevationProvider,this._context.renderCoordsHelper,c);b=new Q(l,b,this._context.layer.uid,a.uid);l=b.renderData.position.length/3;this._needsUV&&(b.uvMapSpace=u.newFloatArray(4*
l,!0),b.boundingRect=y.newDoubleArray(9*l,!0),A.createMapSpaceUVCoords(b.uvMapSpace,b.boundingRect,b.renderData.position,this._context.renderCoordsHelper));b.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(b);this._createAs3DShapeFill(b);this._hasOutline&&this._createAs3DShapeOutline(b);this._logGeometryCreationWarnings(b.renderData,d.rings,"rings","FillSymbol3DLayer");if(0===b.outGeometries.length)return null;a=new L.Object3D({geometries:b.outGeometries,castShadow:!1,
metadata:{layerUid:this._context.layer.uid,graphicUid:a.uid}});a=new I.Graphics3DObject3DGraphicLayer(this,a,b.outGeometries,null,null,z.uvElevationAligner,c);a.alignedSampledElevation=b.renderData.sampledElevation;a.needsElevationUpdates=n.needsElevationUpdates2D(c.mode);return a};e._createAs3DShapeFill=function(a){var b=a.renderData.polygons;for(const {position:c,mapPositions:d,holeIndices:l,index:q,count:t}of b){if(f.isSome(this._context.clippingExtent)&&(g.empty(m),g.expandWithBuffer(m,d),!g.intersectsClippingArea(m,
this._context.clippingExtent)))continue;b=x.earcut(d,l,3);0!==b.length&&(b=p.createColorGeometry({material:f.unwrap(this._material),indices:b,mapPositions:d,attributeData:{position:c,color:a.color,uvMapSpace:this._needsUV?u.floatSubArray(a.uvMapSpace,4*q,4*t):null,boundingRect:this._needsUV?y.doubleSubArray(a.boundingRect,9*q,9*t):null,objectAndLayerIdColor:a.objectAndLayerIdColor}}),a.outGeometries.push(b))}};e._createAs3DShapeOutline=function(a){if(this._hasOutline){var b=a.renderData.outlines;
for(let c=0;c<b.length;++c){const {mapPositions:d,position:l}=b[c];if(f.isSome(this._context.clippingExtent)&&(g.empty(m),g.expandWithBuffer(m,d),!g.intersectsClippingArea(m,this._context.clippingExtent)))continue;const q=B.createGeometry(f.unwrap(this._outlineMaterial),{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:d,attributeData:{position:l}},a.objectAndLayerIdColor);a.outGeometries.push(q)}}};e._createAsOverlay=function(a,b){const c=p.geometryAsPolygon(a.geometry);if(f.isNone(c))return null;
f.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;f.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const d=C.geometryToRenderInfoDraped(c,this._context.overlaySR);a=new R(d,b,this._context.layer.uid,a.uid);b=a.renderData.position.length/3;this._needsUV&&(a.uvMapSpace=u.newFloatArray(4*b,!0),A.createMapSpaceUVCoordsDraped(a.uvMapSpace,a.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));
a.outBoundingBox=g.empty();a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a);this._createAsOverlayFill(a);this._hasOutline&&this._createAsOverlayOutline(a);this._logGeometryCreationWarnings(a.renderData,c.rings,"rings","FillSymbol3DLayer");return 0===a.outGeometries.length?null:new H(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)};e._createAsOverlayFill=function(a){var b=a.renderData.polygons;for(const {position:c,holeIndices:d,index:l,count:q}of b){b=
g.empty(m);g.expandWithBuffer(b,c);if(!g.intersectsClippingArea(b,this._context.clippingExtent))continue;const t=x.earcut(c,d,3);0!==t.length&&(g.expandWithAABB(a.outBoundingBox,b),b=p.createColorGeometry({material:f.unwrap(this._material),indices:t,attributeData:{position:c,color:a.color,uvMapSpace:this._needsUV?u.floatSubArray(a.uvMapSpace,4*l,4*q):null,objectAndLayerIdColor:a.objectAndLayerIdColor}}),a.outGeometries.push(new D.RenderGeometry(b,a)))}};e._createAsOverlayOutline=function(a){if(this._hasOutline){var b=
a.renderData.outlines;for(let d=0;d<b.length;++d){var {position:c}=b[d];g.empty(m);g.expandWithBuffer(m,c);g.intersectsClippingArea(m,this._context.clippingExtent)&&(g.expandWithAABB(a.outBoundingBox,m),c=B.createGeometry(f.unwrap(this._outlineMaterial),{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:c}},a.objectAndLayerIdColor),a.outGeometries.push(new D.RenderGeometry(c,a)))}}};e._getOutlineOpacity=
function(){const a=f.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(f.isSome(a)?a.a:0)};e._getOutlineColor=function(){const a=f.get(this.symbolLayer,"outline","color"),b=this._getOutlineOpacity();return J.mixinColorAndOpacity(f.isSome(a)?E.toUnitRGB(a):null,b)};e.test=function(){return{...k._get(k._getPrototypeOf(h.prototype),"test",this).call(this),createAsOverlay:(a,b)=>this._createAsOverlay(a,b),createAs3DShape:(a,b,c)=>this._createAs3DShape(a,b,c)}};return k._createClass(h)}(v.Graphics3DSymbolLayer);
v.elevationModeChangeTypes={definedChanged:n.SymbolUpdateType.RECREATE,staysOnTheGround:n.SymbolUpdateType.NONE,onTheGroundChanged:n.SymbolUpdateType.RECREATE};const m=g.create();let Q=function(e){function h(a,b,c,d){a=r.call(this,a,c,d);a.color=b;return a}k._inherits(h,e);var r=k._createSuper(h);return k._createClass(h)}(p.PolygonCreationDataBase),R=function(e){function h(a,b,c,d){a=r.call(this,a,c,d);a.color=b;return a}k._inherits(h,e);var r=k._createSuper(h);return k._createClass(h)}(p.PolygonCreationDataBase);
w.Graphics3DPolygonFillSymbolLayer=v;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});