// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/CollectionFlattener ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../rest/support/DirectionLine ../../../rest/support/DirectionPoint ../../../rest/support/PointBarrier ../../../rest/support/PolygonBarrier ../../../rest/support/PolylineBarrier ../../../rest/support/RouteInfo ../../../rest/support/Stop ./LayerView3D ./graphics/GraphicsProcessor ./support/projectExtentUtils ../support/EventedSet ../webgl-engine/lib/UpdatePolicy ../../layers/LayerView".split(" "),
function(f,g,q,r,p,n,k,e,I,J,t,u,v,w,x,y,z,A,B,C,D,E,F,G){e=function(c){function h(){var a=H.apply(this,arguments);a.type="route-3d";a.loadedGraphics=new E.EventedSet;a._byObjectID=new Map;a.slicePlaneEnabled=!1;a.fullExtentInLocalViewSpatialReference=null;return a}f._inherits(h,c);var H=f._createSuper(h);c=h.prototype;c.initialize=function(){this._set("processor",new C.GraphicsProcessor({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0}));this.addResolvingPromise(this.processor.initializePromise);
this.updatingHandles.addOnCollectionChange(()=>this._routeItems,a=>this._routeItemsChanged(a),n.initial);this.addResolvingPromise(D.toViewIfLocal(this).then(a=>this.fullExtentInLocalViewSpatialReference=a));this.handles.add(n.when(()=>this.view?.basemapTerrain?.ready,()=>()=>this.notifyChange("updating"),{once:!0}))};c.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("processor",p.destroyMaybe(this.processor));this._get("_routeItems")?.destroy()};c._routeItemsChanged=
function(a){if(a.removed.length){this.loadedGraphics.removeMany(a.removed.map(b=>{const d=this._byObjectID.get(b);this._byObjectID.delete(b);return d}));for(const b of a.removed)this.handles.remove(b)}if(a.added.length){this.loadedGraphics.addMany(a.added.map(b=>{const d=b.toGraphic();this._byObjectID.set(b,d);return d}));for(const b of a.added)this.handles.add([n.watch(()=>b.geometry,(d,l)=>{this._updateGraphic(b,"geometry",d,l)}),n.watch(()=>b.symbol,(d,l)=>{this._updateGraphic(b,"symbol",d,l)})],
b)}};c.getSuspendInfo=function(){const a=f._get(f._getPrototypeOf(h.prototype),"getSuspendInfo",this).call(this);a.outsideScaleRange=this.processor?.scaleVisibilitySuspended??!1;a.outsideOfView=this.processor?.frustumVisibilitySuspended??!1;return a};c.fetchPopupFeatures=async function(a,b){return p.unwrap(b)?.clientGraphics??[]};c.getHit=function(a){return this.processor.getHit(a)};c.whenGraphicBounds=function(a,b){return this.processor.whenGraphicBounds(a,b)};c.computeAttachmentOrigin=function(a,
b){return this.processor?.computeAttachmentOrigin(a,b)};c.getSymbolLayerSize=function(a,b){return this.processor.getSymbolLayerSize(a,b)};c.queryGraphics=async function(){return new q(this.loadedGraphics.toArray())};c.maskOccludee=function(a){return this.processor.maskOccludee(a)};c.highlight=function(a){if(a instanceof u||a instanceof v||a instanceof w||a instanceof x||a instanceof y||a instanceof z||a instanceof A)a=this._byObjectID.get(a);return this.processor.highlight(a)};c.canResume=function(){return f._get(f._getPrototypeOf(h.prototype),
"canResume",this).call(this)&&!this.processor?.scaleVisibilitySuspended};c.isUpdating=function(){return!(!this.processor?.updating&&this.view?.basemapTerrain?.ready)};c._updateGraphic=function(a,b,d,l){a=this._byObjectID.get(a);a[b]=d;m.graphic=a;m.property=b;m.oldValue=l;m.newValue=d;this.processor?.graphicsCore.graphicUpdateHandler(m)};f._createClass(h,[{key:"_routeItems",get:function(){return new r({getCollections:()=>[this.layer.pointBarriers,this.layer.polygonBarriers,this.layer.polylineBarriers,
this.layer.stops,this.layer.directionLines,this.layer.directionPoints,p.isSome(this.layer.routeInfo)?new q([this.layer.routeInfo]):null]})}},{key:"legendEnabled",get:function(){return this.canResume()&&!this.processor?.frustumVisibilitySuspended}},{key:"updatePolicy",get:function(){return this.processor?.graphicsCore.effectiveUpdatePolicy||F.UpdatePolicy.SYNC}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,
nodes:0,core:null,updating:this.updating,elevationUpdating:this.processor?.elevationAlignment.updating??!1,visibilityFrustum:!this.processor?.frustumVisibilitySuspended}}}]);return h}(B.LayerView3D(G));g.__decorate([k.property()],e.prototype,"_routeItems",null);g.__decorate([k.property()],e.prototype,"loadedGraphics",void 0);g.__decorate([k.property({readOnly:!0})],e.prototype,"legendEnabled",null);g.__decorate([k.property()],e.prototype,"layer",void 0);g.__decorate([k.property({readOnly:!0})],e.prototype,
"processor",void 0);g.__decorate([k.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0);e=g.__decorate([t.subclass("esri.views.3d.layers.RouteLayerView3D")],e);const m={graphic:null,property:null,oldValue:null,newValue:null};return e});