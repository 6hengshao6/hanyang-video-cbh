// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(c,k,e,p,n,q,l,f,B,C,D,r,t,u,v,w,x){const y=v.QueryEngine;c.I3SQueryEngine=function(d){function g(a){a=z.call(this,a);a._handles=new q;return a}k._inherits(g,d);var z=k._createSuper(g);d=g.prototype;d.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};d.destroy=function(){this._dataQueryEngineInstance=l.destroyMaybe(this._dataQueryEngineInstance);this._handles=l.destroyMaybe(this._handles);this._set("layerView",
null)};d.executeQueryForCount=async function(a,b){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)};d.executeQueryForExtent=async function(a,b){const {count:h,extent:m}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b);a=t.fromJSON(m);return{count:h,extent:a}};d.executeQueryForIds=async function(a,b){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)};d.executeQuery=async function(a,b){a=this._ensureQueryJSON(a);if(a.returnGeometry)throw new n("feature-store:unsupported-query",
"returnGeometry is not yet supported for mesh scene layer queries");if(a.returnCentroid)throw new n("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");b=await this._dataQueryEngine.executeQuery(a,b);b=w.fromJSON(b);b.features.forEach(h=>{h.geometry=null});return b};d._ensureQueryJSON=function(a){return l.isNone(a)?this.defaultQueryJSON:a.toJSON()};d._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const a=this.layer.objectIdField||u.fallbackObjectIDAttribute,b=this.layer.fields?.map(A=>A.toJSON())??[],h=this.layerView.view.resourceController.scheduler,m=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new y({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:b,timeInfo:null,spatialReference:m,objectIdField:a,featureStore:this.spatialIndex,scheduler:h,priority:this.priority})};k._createClass(g,[{key:"spatialReference",get:function(){return this.layerView.view.spatialReference}},
{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"defaultQueryJSON",get:function(){return(new x({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return g}(p);e.__decorate([f.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"layerView",void 0);e.__decorate([f.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"priority",void 0);e.__decorate([f.property({constructOnly:!0})],c.I3SQueryEngine.prototype,
"spatialIndex",void 0);e.__decorate([f.property()],c.I3SQueryEngine.prototype,"spatialReference",null);e.__decorate([f.property()],c.I3SQueryEngine.prototype,"layer",null);e.__decorate([f.property()],c.I3SQueryEngine.prototype,"defaultQueryJSON",null);c.I3SQueryEngine=e.__decorate([r.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],c.I3SQueryEngine);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});