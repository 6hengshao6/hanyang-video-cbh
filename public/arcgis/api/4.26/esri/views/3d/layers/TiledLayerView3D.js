// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),function(q,n,d,m,p,t,e,y,z,A,u,r,v){q.TiledLayerView3D=c=>{c=function(f){function h(){return w.apply(this,
arguments)}n._inherits(h,f);var w=n._createSuper(h);f=h.prototype;f.getTileUrl=function(a,b,g){return this.layer.getTileUrl(a,b,g)};f._addTilingSchemeMatchPromise=function(){if(p.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new m("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var a=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(p.isSome(a))return this.addResolvingPromise(Promise.reject(a));a=t.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>
{const b=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(b)throw b;});this.addResolvingPromise(a)};f._getTileInfoSupportError=function(a,b){if(a=v.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.state.viewingMode)){b={layer:this.layer,error:a};switch(a.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":a=new m("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",b);break;default:a=new m("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return a}return null};f._getTileInfoCompatibilityError=function(a,b){return p.isNone(a)||!b.compatibleWith(a)?new m("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"):null};f.levelRangeFromScaleRange=function(a,b){const g=
{minLevel:0,maxLevel:Infinity};var k=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!k)return g;const x=k.levels[0];k=l=>{l=Math.log(x.scale/l)/Math.LN2;return 1E-9>.5-Math.abs(.5-l%1)?Math.round(l):Math.ceil(l)};null!=a&&0<a&&(g.minLevel=Math.max(0,k(a)));null!=b&&0<b&&(g.maxLevel=Math.max(0,k(b)));return g};f.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};n._createClass(h,[{key:"imageFormatIsOpaque",get:function(){return!1}},
{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const a=this.tileInfo.lods;return this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale)}},{key:"displayLevelRange",get:function(){var a=this.tileInfo.lods;a=this.levelRangeFromScaleRange(this.layer.minScale||a[0].scale,this.layer.maxScale||a[a.length-1].scale);this.layer.maxScale&&a.maxLevel++;return a}}]);
return h}(c);d.__decorate([e.property({readOnly:!0})],c.prototype,"imageFormatIsOpaque",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"updating",void 0);d.__decorate([e.property(r.updatingProgress)],c.prototype,"updatingProgress",void 0);d.__decorate([e.property(r.updatingProgressValue)],c.prototype,"updatingProgressValue",void 0);d.__decorate([e.property()],c.prototype,"fullExtent",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"isOpaque",null);d.__decorate([e.property({readOnly:!0})],
c.prototype,"dataLevelRange",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"displayLevelRange",null);d.__decorate([e.property()],c.prototype,"layer",void 0);d.__decorate([e.property()],c.prototype,"tileInfo",void 0);return c=d.__decorate([u.subclass("esri.views.3d.layers.TiledLayerView3D")],c)};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});