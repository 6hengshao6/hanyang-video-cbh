// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Collection ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../layers/Layer ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(c,p,d,r,v,w,x,k,y,n,e,O,P,Q,z,A,B,C,t,D,E,F,G,H,I,J,K,L,q,M){c.GraphicsProcessor=function(f){function m(a){a=N.call(this,a);a.type="graphics-3d";a.graphicsCore=null;a.drapeSourceType=E.DrapeSourceType.Features;a.scaleVisibilityEnabled=!1;a.frustumVisibilityEnabled=!1;a._suspendResumeExtent=null;return a}p._inherits(m,f);var N=p._createSuper(m);f=m.prototype;f.initialize=function(){const {layer:a}=this,b="effectiveScaleRange"in a?a:null;var g=this.scaleVisibilityEnabled&&k.isSome(b);g=new G.Graphics3DCore({owner:this,
layer:this.owner.layer,preferredUpdatePolicy:M.UpdatePolicy.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(h,l)=>new H({graphicsCoreOwner:this,graphicsCore:h,queryGraphicUIDsInExtent:l,elevationProvider:this.view.elevationProvider}),scaleVisibility:g?(h,l)=>new K({graphicsCoreOwner:this,layer:b,queryGraphicUIDsInExtent:l,graphicsCore:h,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:h=>new J.Graphics3DObjectStates(h)}});this._set("graphicsCore",g);this.frustumVisibilityEnabled&&
this._set("frustumVisibility",new I({graphicsCoreOwner:this}));if("fullOpacity"in this.owner){const h=this.owner;this.updatingHandles.add(()=>h.fullOpacity,()=>this.graphicsCore.opacityChange())}"elevationInfo"in a&&this.updatingHandles.add(()=>a.elevationInfo,(h,l)=>{A.diff(h,l)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this._set("initializePromise",this._initializeAsync());this.updatingHandles.addPromise(this.initializePromise)};f._initializeAsync=async function(){try{await this.graphicsCore.initializePromise}catch(a){if(y.isAbortError(a))return;
throw a;}this.destroyed||(this.handles.add(n.watch(()=>this.view.clippingArea,()=>this._updateClippingExtent(),n.sync)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())};f.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("frustumVisibility",k.destroyMaybe(this.frustumVisibility));this._set("graphicsCore",k.destroyMaybe(this.graphicsCore))};f.notifyGraphicGeometryChanged=function(a){this.graphicsCore.notifyGraphicGeometryChanged(a)};
f.notifyGraphicVisibilityChanged=function(a){this.graphicsCore.notifyGraphicVisibilityChanged(a)};f.getRenderingInfo=function(a,b,g){a=t.getRenderingInfo(a,{renderer:b,arcade:g});k.isSome(a)&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};f.getRenderingInfoAsync=function(a,b,g,h){return t.getRenderingInfoAsync(a,{renderer:b,arcade:g,...h})};f.getHit=function(a){if(this.owner.loadedGraphics){var b=this.owner.loadedGraphics.find(g=>g.uid===a);if(b)return b=C.hydrateGraphic(b,this.layer instanceof
B?this.layer:null),{type:"graphic",graphic:b,layer:b.layer}}return null};f.whenGraphicBounds=function(a,b){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(a,b):Promise.reject()};f.computeAttachmentOrigin=function(a,b){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(a,b):null};f.getSymbolLayerSize=function(a,b){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(a,b):null};f.maskOccludee=function(a){const {set:b,handle:g}=this.objectStates.acquireSet(q.Object3DState.MaskOccludee,
null);this.objectStates.setUid(b,a.uid);return g};f.highlight=function(a){if(a instanceof D)return u;if("number"===typeof a||a instanceof r)return this.highlight([a]);a instanceof v&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof r){a=a.map(h=>h.uid);const {set:b,handle:g}=this.objectStates.acquireSet(q.Object3DState.Highlight,null);this.objectStates.setUids(b,a);return g}if("number"===typeof a[0]){const {set:b,handle:g}=this.objectStates.acquireSet(q.Object3DState.Highlight,null);
this.objectStates.setObjectIds(b,a);return g}}return u};f._setupSuspendResumeExtent=function(){const {scaleVisibility:a,frustumVisibility:b}=this;if(!k.isNone(a)||!k.isNone(b)){var g=({computedExtent:h,extentPadding:l})=>{this._suspendResumeExtent=L.enlargeExtent(h,this._suspendResumeExtent,F.SUSPEND_RESUME_EXTENT_OPTIMISM,l);k.isSome(a)&&a.setExtent(this._suspendResumeExtent);k.isSome(b)&&b.setExtent(this._suspendResumeExtent)};this.handles.add(n.watch(()=>({computedExtent:this.graphicsCore?.computedExtent,
extentPadding:this.graphicsCore?.extentPadding}),h=>g(h),n.syncAndInitial))}};f._updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};p._createClass(m,[{key:"layer",get:function(){return this.owner.layer}},{key:"view",get:function(){return this.owner.view}},{key:"scaleVisibility",get:function(){return this.graphicsCore?.scaleVisibility}},{key:"elevationAlignment",get:function(){return this.graphicsCore?.elevationAlignment}},
{key:"objectStates",get:function(){return this.graphicsCore?.objectStates}},{key:"scaleVisibilitySuspended",get:function(){return!(!k.isSome(this.scaleVisibility)||!this.scaleVisibility.suspended)}},{key:"frustumVisibilitySuspended",get:function(){return k.isSome(this.frustumVisibility)&&this.frustumVisibility.suspended}},{key:"suspended",get:function(){return this.owner.suspended??!1}},{key:"updating",get:function(){return!!(this.graphicsCore?.updating||k.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||
k.isSome(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles.updating)}},{key:"graphics3DGraphics",get:function(){return this.graphicsCore?.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphicsCore?.graphics3DGraphicsByObjectID}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity??1}},{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},
{key:"updatePolicy",get:function(){return this.owner.updatePolicy}}]);return m}(w.HandleOwner);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"type",void 0);d.__decorate([e.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"owner",void 0);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"layer",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"view",null);d.__decorate([e.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"graphicsCore",void 0);
d.__decorate([e.property()],c.GraphicsProcessor.prototype,"scaleVisibility",null);d.__decorate([e.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"frustumVisibility",void 0);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"elevationAlignment",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"objectStates",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"scaleVisibilitySuspended",null);d.__decorate([e.property({readOnly:!0})],c.GraphicsProcessor.prototype,
"frustumVisibilitySuspended",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"suspended",null);d.__decorate([e.property({readOnly:!0})],c.GraphicsProcessor.prototype,"updating",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"loadedGraphics",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"fullOpacity",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"slicePlaneEnabled",null);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"drapeSourceType",
void 0);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"updatePolicy",null);d.__decorate([e.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"scaleVisibilityEnabled",void 0);d.__decorate([e.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"frustumVisibilityEnabled",void 0);d.__decorate([e.property()],c.GraphicsProcessor.prototype,"initializePromise",void 0);c.GraphicsProcessor=d.__decorate([z.subclass("esri.views.3d.layers.graphics.GraphicsProcessor")],c.GraphicsProcessor);
const u=x.makeHandle();Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});