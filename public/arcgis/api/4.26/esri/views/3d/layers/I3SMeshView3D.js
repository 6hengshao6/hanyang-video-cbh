// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/byteSizeEstimations ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../chunks/sphere ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(Sa,x,Q,u,Ta,ea,Ua,Va,Wa,la,Xa,ua,g,Ya,V,H,Za,va,wa,v,Ob,$a,ab,bb,xa,ya,cb,M,W,db,eb,fb,R,X,Y,za,gb,hb,ib,jb,kb,Aa,lb,mb,Ba,nb,Ca,y,fa,Da,ob,N,pb,qb,Ea,rb,sb,tb,Z,ma,ub,na,t,vb,wb,oa,pa,aa,Fa,ha,xb,yb,qa,zb,ia,Ga,ja){function O(k,e){V.isAbortError(k)||J.warn("Error while processing edges. Edges on this layer might not display correctly",e,k)}function Ha(k){if(g.isNone(k))return!1;const e=k.metallicRoughness;return e&&0<=e.baseColorTextureId||e&&0<=e.metallicRoughnessTextureId||0<=k.normalTextureId||
0<=k.emissiveTextureId||0<=k.occlusionTextureId}function Ia(k){return g.isSome(k)&&va.isArrayBuffer(k.data)}function Ja(k,e){k=1024+k.interleavedVertexData.byteLength+(k.indices?k.indices.byteLength:0)+k.positionData.data.byteLength+k.positionData.indices.byteLength;if(g.isSome(e))for(const r of e)g.isSome(r)&&va.isArrayBuffer(r.data)&&(k+=r.data.byteLength);return k}function Ka(k,e){return e.byteSize>Ab?(J.warn(`Node is too big to store in IndexedDB cache: ${k.id} (${e.byteSize} bytes)`),!1):0<e.byteSize}
function Bb(k){if(0===k.length)return null;const e=new Float64Array(10*k.length);k.forAll((r,ba)=>{let a=r.serviceObb;g.isNone(a)&&(a=Cb,M.copy(a.center,r.mbs),a.halfSize[0]=a.halfSize[1]=a.halfSize[2]=r.mbs[3]);r=10*ba;e[r]=a.center[0];e[r+1]=a.center[1];e[r+2]=a.center[2];e[r+3]=a.halfSize[0];e[r+4]=a.halfSize[1];e[r+5]=a.halfSize[2];e[r+6]=a.quaternion[0];e[r+7]=a.quaternion[1];e[r+8]=a.quaternion[2];e[r+9]=a.quaternion[3]});return e}function ca(k,e){k.forEach(r=>r.opacity=e)}function Db(k){return e=>
{if(k.immediate)return k.immediate.schedule(e);console.error("Error no immediate schudler");throw Error("cant find immediate scheduler");}}const J=Xa.getLogger("esri.views.3d.layers.I3SMeshView3D"),La=[1,1,1,1];let Eb=function(k){function e(ba,a,b,c,d,f,h){var l=r.call(this);l.node=ba;l.featureIds=a;l.objectHandle=b;l.cachedRendererVersion=c;l.attributeInfo=d;l.material=f;l.textures=h;l.cachedMidsTerrainSR=null;l.cachedEdgeMaterials=[];l.edgeMemoryUsage=0;l.cachedSymbology=null;return l}Q._inherits(e,
k);var r=Q._createSuper(e);return Q._createClass(e)}(Ea.NodeCrossfadeMetaData);var S;(function(k){k[k.CastShadows=4]="CastShadows";k[k.Pickable=5]="Pickable"})(S||(S={}));const Ab=100*Va.ByteSizeUnit.MEGABYTES;var I;(function(k){k[k.ADD=0]="ADD";k[k.REMOVE=1]="REMOVE";k[k.UPDATE=2]="UPDATE"})(I||(I={}));const Ma=X.create(),Na=Y.create(),Fb=Y.create(),Cb=ha.create(),da=[0,0,0,0],Gb=new Ta([0,0,0,0]),Oa=gb.fromValues(0,0,0,0),Hb={remove(){},pause(){},resume(){}};x.ElevationMode=void 0;(function(k){k[k.Absolute=
0]="Absolute";k[k.RelativeToGround=1]="RelativeToGround";k[k.OnTheGround=2]="OnTheGround"})(x.ElevationMode||(x.ElevationMode={}));const K=W.create(),T=X.create();x.I3SMeshView3D=k=>{k=function(e){function r(...a){a=ba.call(this,a);a._nodeId2Meta=new Map;a._nodeId2MetaReloading=new Map;a._i3sWasmLoaded=!1;a._snappingSourcesTrackers=[];a._hasLoadedPBRTextures=!1;a._asyncModuleLoading=0;a._addTasks=new Map;a._currentRenderer=null;a._rendererVersion=0;a._colorVariable=null;a._opacityVariable=null;a._rendererFields=
null;a._symbologyFields=null;a._symbologyOverride=null;a._symbologyOverrideFields=null;a._symbolInfos=new Map;a._visibleGeometryChangedSchedulerHandle=null;a._idbCache=la("enable-feature:idb-mock-cache")?new wb.IDBMockCache:new vb.IDBCache("esri-scenelayer-cache","geometries");a._hasComponentData=!1;a._hasVertexColors=!1;a.holeFilling="auto";a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._modifications=[];a.ignoresMemoryFactor=!1;a._layerUrl="";a._cacheKeySuffix=null;a._elevationTask=
null;a._filters=[];a._arcade=null;a._tmpAttributeOnlyGraphic=new ea(null,null,{});a._crossfadeHelper=new Ea.I3SCrossfadeHelper(Q._assertThisInitialized(a));return a}Q._inherits(r,e);var ba=Q._createSuper(r);e=r.prototype;e.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);var a=this.view.resourceController;this.i3sOverrides=new ub.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:a.memoryController});this._worker=new Ca.I3SMeshWorkerHandle(Db(a));
this.addResolvingPromise(this._worker.promise);a=this.i3slayer.store;this._worker.setLegacySchema(this.uid,a.defaultGeometrySchema);t.checkSceneLayerValid(this.i3slayer);t.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new ib({layerView:this});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();
a=a.defaultGeometrySchema;if(this._isIntegratedMesh||!a)this._hasComponentData=!1;else{const b=a.featureAttributes;this._hasComponentData=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=(a?.vertexAttributes.color??null)&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(this.uid,b=>this._deleteComponentObject(b));this._intersectionHandler=
new tb.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:b=>g.isSome(this._controller.index)&&g.isSome(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,c=>{var d=c.index;d=this._nodeId2Meta.get(d)||this._nodeId2MetaReloading.get(d);return b(c,g.isSome(d)?d.objectHandle:null)}):()=>{}});this.updatingHandles.add(()=>
this.layerUid,b=>this._intersectionHandler.layerUid=b);this.updatingHandles.add(()=>this.sublayerUid,b=>this._intersectionHandler.sublayerUid=b);this._elevationProvider=new rb({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR;this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),H.initial);this.updatingHandles.add(()=>this.fullOpacity,b=>this._opacityChange(b));this.updatingHandles.add(()=>this.slicePlaneEnabled,b=>
this._slicePlaneEnabledChange(b));this.updatingHandles.add(()=>this.elevationOffset,(b,c)=>{this._reloadAll(c);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(b,c)=>this._elevationInfoChanged(b,c),H.initial);this.updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==x.ElevationMode.Absolute,(b,c)=>{b?this.handles.add(this.view.basemapTerrain.on("elevation-change",({extent:d})=>this._ensureElevationTask().addExtent(d)),"elevation-change"):
c&&this.handles.remove("elevation-change")},H.initial);this.updatingHandles.add(()=>this._usePBR,b=>this._updatePBR(b));a=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,a);this.updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,a);this.updatingHandles.add(()=>this.suspended,b=>this._suspendedChange(b),H.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),H.initial);this.updatingHandles.add(()=>
this.i3slayer.labelingInfo,()=>this._labelingChanged(),H.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),H.initial);this.handles.add([H.watch(()=>aa.I3S_TREE_SHOW_TILES,b=>{if(b&&!this._treeDebugger){const c=this._controller.crsIndex;(new Promise((d,f)=>Sa(["./support/I3STreeDebugger"],d,f))).then(({I3STreeDebugger:d})=>{!this._treeDebugger&&aa.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new d({lv:this,view:this.view,nodeSR:c}))})}else b||aa.I3S_TREE_SHOW_TILES||
(this._treeDebugger=g.destroyMaybe(this._treeDebugger))},H.initial),H.watch(()=>aa.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),H.initial)]);this._cacheKeySuffix=t.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(b=>J.warn(`Failed to initialize IndexedDB cache: ${b}`))};e.destroy=function(){this._clearAddTasks();this._elevationTask=g.destroyMaybe(this._elevationTask);this.i3sOverrides=g.destroyMaybe(this.i3sOverrides);this._elevationProvider&&
(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const a=this._worker;a&&(a.destroyContext(this.uid).then(()=>a.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=g.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=
null;this._labeler=g.destroyMaybe(this._labeler);this._treeDebugger=g.destroyMaybe(this._treeDebugger);this._controller=g.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=g.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};e._memEstimateTextureAdded=
function(a){a=a.estimatedTexMemRequired;this._gpuMemoryEstimate+=a;this._texMemoryEstimate+=a;return a};e._memEstimateTextureRemoved=function(a){g.isSome(a)&&(a=a.estimatedTexMemRequired,this._gpuMemoryEstimate-=a,this._texMemoryEstimate-=a)};e._memEstimateGeometryAdded=function(a){a=this._collection.getObjectGPUMemoryUsage(a);this._gpuMemoryEstimate+=a;this._geoMemoryEstimate+=a;return a};e._memEstimateGeometryRemoved=function(a){a=this._collection.getObjectGPUMemoryUsage(a);this._gpuMemoryEstimate-=
a;this._geoMemoryEstimate-=a};e.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};e.isNodeReloading=function(a){return this._nodeId2MetaReloading.has(a)};e._labelingChanged=function(){if(!ob.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)g.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!g.isSome(this._labeler)){var a=new nb({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(b=>g.isSome(b)&&this._addMetaToLabeler(a,
b));this._labeler=a}};e._loadAsyncModule=function(a){++this._asyncModuleLoading;return a.then(b=>{--this._asyncModuleLoading;return b},b=>{--this._asyncModuleLoading;throw b;})};e._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=fa.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var a=this.uid,b=this.i3slayer.spatialReference;this._worker.setModifications(a,
this._layerClippingArea,this._modifications,b);var c=Ca.toWasmModification(this._layerClippingArea,this._modifications,b);fa.setModificationsSync({context:a,modifications:c,isGeodetic:b.isGeographic});this._controller.modificationsChanged();var d=this.hasModifications?new Ya:null;this._nodeId2Meta.forEach((f,h)=>{g.isNone(f)?(this._nodeId2Meta.delete(h),this._controller.updateLoadStatus(h,!1)):f.node.hasModifications?(this._nodeId2Meta.delete(h),this._nodeId2MetaReloading.set(h,f)):g.isSome(d)&&d.push(f.node)});
g.isSome(d)&&this._nodeId2MetaReloading.forEach(f=>d.push(f.node));g.isSome(d)&&0<d.length&&(this.updateNodeModificationStatus(d),d.forAll(f=>{if(f.imModificationImpact!==ma.NodeIMModificationImpact.Culled){const h=this._nodeId2Meta.get(f.index);this._controller.invalidateGeometryVisibility(f.index);g.isSome(h)?(this._nodeId2Meta.delete(f.index),this._nodeId2MetaReloading.set(f.index,h)):this._nodeId2Meta.has(f.index)&&(this._nodeId2Meta.delete(f.index),this._controller.updateLoadStatus(f.index,!1))}}));
this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};e._showModifications=function(){g.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(aa.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var a={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},b={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const c of this._modifications){const d=
c.geometry;d.spatialReference=this.i3slayer.spatialReference;this._modificationGraphics.push(new ea({geometry:d,symbol:{...b,color:a[c.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}};e._addMetaToLabeler=function(a,b){a.addNodeMeta(b,(c,d)=>this._createAttributes(c,d))};e._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):
(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};e.getLoadedAttributes=function(a){a=this._nodeId2Meta.get(a);if(g.isSome(a)&&g.isSome(a.attributeInfo))return a.attributeInfo.loadedAttributes};e.getAttributeData=function(a){a=this._nodeId2Meta.get(a);if(g.isSome(a)&&g.isSome(a.attributeInfo))return a.attributeInfo.attributeData};e.setAttributeData=function(a,b){a=this._nodeId2Meta.get(a);
g.isSome(a)&&g.isSome(a.attributeInfo)&&(a.attributeInfo.attributeData=b,this._attributeValuesChanged(a))};e.updateAttributes=async function(a,b,c){const d=this._nodeId2Meta.get(a);g.isSome(d)&&(await this.i3sOverrides.apply(d.featureIds,b,c),d.attributeInfo=b,this._controller.reschedule(()=>this._attributeValuesChanged(d),c).catch(f=>{V.isAbortError(f)||J.warn("Error while updating attribute values. Layer might not display correctly.",f)}))};e._attributeValuesChanged=function(a){a.cachedRendererVersion=
this._getInvalidRendererVersion();a.filteredIds=null;g.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(a,(b,c)=>this._createAttributes(b,c));this._updateEngineObject(a)};e.clearMemCache=function(){g.isSome(this._memCache)&&this._memCache.clear()};e.getVisibleNodes=function(){const a=[];this._nodeId2Meta.forEach(b=>g.isSome(b)&&a.push(b.node));return a};e.getNodeComponentObb=function(a){a=this._nodeId2Meta.get(a.index)??this._nodeId2MetaReloading.get(a.index);return g.isSome(a)?this._collection.getComponentObb(a.objectHandle):
null};e.getLoadedNodeIndices=function(a){this._nodeId2Meta.forEach((b,c)=>a.push(c));this._nodeId2MetaReloading.forEach((b,c)=>a.push(c))};e._preLoadBasis=function(){!la("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&N.TextureEncoding.Basis)&&g.applySome(this.i3slayer.textureSetDefinitions,a=>a.some(b=>b.formats.some(c=>"basis"===c.format||"ktx2"===c.format)))&&Ga.loadBasis()};e._getVertexBufferLayout=function(a,b){a={hasTexture:Ha(a.params.material),hasNormals:b.normal,hasRegions:b.uvRegion};
return yb.glLayout(zb.createVertexBufferLayout(this._getGeometryParameters(a)))};e._getObjectIdField=function(){return this.i3slayer.objectIdField||hb.fallbackObjectIDAttribute};e._findGraphicNodeAndIndex=function(a){const b=oa.attributeLookup(this.i3slayer.fieldsIndex,a.attributes,this._getObjectIdField());let c=null;ua.someMap(this._nodeId2Meta,d=>{if(g.isNone(d))return!1;const f=d.featureIds.indexOf(b);if(-1===f)return!1;c={node:d.node,index:f};return!0});return c};e._getGraphicIndices=function(a,
b){a=this._nodeId2Meta.get(a.index);if(g.isNone(a))return[];const c=[],d=this._getObjectIdField(),f=this.i3slayer.fieldsIndex;for(const h of b)b=oa.attributeLookup(f,h.attributes,d),b=a.featureIds.indexOf(b),-1!==b&&c.push(b);return c};e.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return Promise.reject();a=this._getAABB(a.node.index,a.index);return g.isNone(a)?Promise.reject():Promise.resolve({boundingBox:a,screenSpaceObjects:[]})};e.getAABBFromIntersectorTarget=function(a){return null==
a.nodeIndex||null==a.componentIndex?null:this._getAABB(a.nodeIndex,a.componentIndex)};e._getAABB=function(a,b){a=this._nodeId2Meta.get(a);if(g.isNone(a)||null==a.featureIds||b>=a.featureIds.length)return null;b=sb.boundingBoxCornerPoints(b,this._collection,a.objectHandle,za.newDoubleArray(24));if(!R.projectBuffer(b,this.view.renderSpatialReference,0,b,this.view.spatialReference,0,8))return null;a=X.empty();X.expandWithBuffer(a,b,0,8);return a};e.whenGraphicAttributes=function(a,b){return t.whenGraphicAttributes(this.i3slayer,
a,this._getObjectIdField(),b,()=>[...this._nodeId2Meta.values()].filter(g.isSome))};e.getGraphicFromIntersectorTarget=function(a){if(null==a.nodeIndex||null==a.componentIndex)return null;const b=this._nodeId2Meta.get(a.nodeIndex);return g.isNone(b)||null==b.featureIds||a.componentIndex>=b.featureIds.length?null:this._createGraphic(a.componentIndex,b)};e._getCacheKey=function(a){return`${this._layerUrl}/v${19}/${a.id}${this._cacheKeySuffix}`};e._getMemCacheKey=function(a,b=this.elevationOffset){return a+
"#"+b};e.loadCachedGPUData=function(a){return g.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(a.index)):null};e.deleteCachedGPUData=function(a){g.isSome(a)&&this._deleteComponentObject(a)};e._cacheGPUData=function(a,b=this.elevationOffset){if(g.isNone(this._memCache))this._deleteComponentObject(a);else{var c=this._controller.indexDepth-a.node.level;this._memCache.put(this._getMemCacheKey(a.node.index,b),a,a.node.memory,c)}};e.loadMissingTextures=function(a,b,c,d){const f=a?.filter((h,
l)=>{if(0===(h.usage&this.rendererTextureUsage))return!1;if(g.isNone(b))return!0;h=Z.selectEncoding(h.encodings,this.supportedTextureEncodings);l=b[l];return g.isNone(l)||null==l.data||h&&l.encoding!==h.encoding?!0:!1})??[];return 0===f.length?Promise.resolve(!1):c(f,d).then(h=>{let l=0;for(let n=0;n<a.length;n++)l<h.length&&h[l].id===a[n].id&&(b[n]=h[l],l++);return!0})};e.loadCachedNodeData=function(a,b,c){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(a),b).then(d=>{if(null==
d)return null;if(d.nodeVersion!==a.version)return this._idbCache.remove(this._getCacheKey(a)),null;this.elevationInfo.mode===x.ElevationMode.Absolute&&(a.geometryObb=d.geometryObb);return this.loadMissingTextures(d.requiredTextures,d.textureData,c,b).then(f=>{f&&this._idbCache.initialized&&g.isSome(d.textureData)&&(d.byteSize=Ja(d.transformedGeometry,d.textureData),d.textureData.every(Ia)&&Ka(a,d)&&this._idbCache.put(this._getCacheKey(a),d).catch(h=>J.warn(`Failed to update node with textures in IndexedDB cache: ${a.id}: ${h}`)));
V.throwIfAborted(b);return d})}):Promise.resolve(null)};e.addNode=function(a,b,c){return"geometryData"in b?null==b.geometryBuffer?(this._addNodeMeta(a.index,null),Promise.resolve()):this._addData(a,b.attributeDataInfo,()=>this._transformNode(a,b,c).then(d=>this._safeReschedule(()=>{if(g.isNone(d))return a.hasModifications=!1,this._addCachedNodeData(a,null,c);a.hasModifications=d.transformedGeometry.hasModifications;const {obb:f,componentOffsets:h,featureIds:l,transformedGeometry:n}=d;var m=na.computeGlobalTransformation(a.mbs,
this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),q=ha.create([f.center.x,f.center.y,f.center.z],[f.extents.x,f.extents.y,f.extents.z],cb.fromValues(f.orientation.x,f.orientation.y,f.orientation.z,f.orientation.w));M.transformMat4(q.center,q.center,m);this.elevationInfo.mode===x.ElevationMode.Absolute&&(a.geometryObb=q);b.geometryData.componentOffsets=h;l&&(b.geometryData.featureIds=Array.from(l));m={nodeVersion:a.version,geometryData:b.geometryData,requiredTextures:b.requiredTextures,
textureData:b.textureData,transformedGeometry:n,globalTrafo:m,geometryObb:q,byteSize:Ja(n,b.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&Ka(a,m)&&(q=g.isSome(m.textureData)?m.textureData.map(w=>Ia(w)?w:null):null,this._idbCache.put(this._getCacheKey(a),{...m,textureData:q}).catch(w=>J.warn(`Failed to store node in IndexedDB cache: ${a.id}: ${w}`)));return this._addCachedNodeData(a,m,c)},c))):Promise.reject()};e.getElevationRange=function(a){let b=Infinity,c=-Infinity;const d=fb.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference);
this._nodeId2Meta.forEach(f=>{if(g.isSome(f)&&g.isSome(f.node.geometryObb)&&ha.intersectSphere(f.node.geometryObb,a)){var h=this._collection.getObjectTransform(f.objectHandle);h=this.view.renderCoordsHelper.getAltitude(h.position);for(let n=0;n<f.featureIds.length;n++){var l=this._collection.getComponentAabb(f.objectHandle,n,T);if("local"===this.view.viewingMode)b=Math.min(b,h+l[2]),c=Math.max(c,h+l[5]);else{b=Math.min(b,h+l[2]);const m=Math.max(Math.abs(l[3]),Math.abs(l[0])),q=Math.max(Math.abs(l[4]),
Math.abs(l[1]));l=h+l[5]+d.radius;c=Math.max(c,Math.sqrt(m*m+q*q+l*l)-d.radius)}}}});return{min:b,max:c}};e.computeVisibilityObb=function(a){return t.computeVisibilityObb(a,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};e._transformNode=function(a,b,c){var d=b.geometryData.geometries??[];const f=Array(d.length);for(var h=0;h<d.length;++h)f[h]=this._getVertexBufferLayout(d[h],b.geometryDescriptor);d=a.mbs;h=this.elevationOffset;
var l=this._controller.crsIndex,n=this._controller.crsVertex;const m=this.view.renderSpatialReference,q=na.getLocalOrigin(d,h,l),w=na.computeGlobalTransformation(d,h,l,m);l=R.getProjectorName(l,n);n=R.getProjectorName(n,m);return g.isNone(l)||g.isNone(n)?Promise.resolve(null):this._worker.invoke({context:this.uid,geometryBuffer:b.geometryBuffer,geometryData:b.geometryData,geometryDescriptor:b.geometryDescriptor,layouts:f,localOrigin:q,globalTrafo:w,mbs:d,obb:a.serviceObb,elevationOffset:h,needNormals:!this._isIntegratedMesh&&
this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:l,vertexToRenderProjector:n},c)};e._setNewNodeOpacity=function(a){this._setNodeOpacity(a,this.nodeCrossfadingEnabled?0:this.fullOpacity)};e.addCachedGPUData=function(a,b,c){this.elevationInfo.mode===x.ElevationMode.Absolute&&(a.geometryObb=ha.clone(this._collection.getComponentObb(b.objectHandle)));this._controller.isGeometryVisible(a)?(g.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,
b),a=a.index,this._addNodeMeta(a,b),this.updateNodeState(a,c),this._collection.setObjectVisibility(b.objectHandle,qa.State.Visible),this._updateMaterial(b),this._setNewNodeOpacity(b),this.elevationInfo.mode!==x.ElevationMode.Absolute&&this._ensureElevationTask().schedule(a),this._updateEngineObject(b),this._highlights.objectCreated(b),g.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(b)};e.addCachedNodeData=function(a,b,c,d){return this._addData(a,c,()=>this._addCachedNodeData(a,
b,d))};e._addCachedNodeData=async function(a,b,c){if(this.suspended||!this._controller.isGeometryVisible(a))this._removeNodeStageData(a.index,this.elevationOffset,this._nodeId2MetaReloading);else if(g.isNone(b))this._addNodeMeta(a.index,null);else{var d=this._addTasks.get(a.index),{geometryData:f,transformedGeometry:h,globalTrafo:l}=b;await this.i3sOverrides.apply(f.featureIds,d.attributeInfo,c);var n=g.isSome(b.textureData)?b.textureData.filter(z=>g.isSome(z)&&0!==(z.usage&this.rendererTextureUsage)):
[];!la("disable-feature:i3s-basis")&&n.some(z=>g.isSome(z)&&(z.encoding===N.TextureEncoding.Basis||z.encoding===N.TextureEncoding.KTX2))&&await Ga.loadBasis();a.memory=0;var {componentOffsets:m,geometries:q,featureIds:w}=f,F=this._collection,C=q[0],{layout:A,indices:p,interleavedVertexData:B,positionData:G,hasColors:P}=h,E=this._materialParameters(C,A),ra=m||new Uint32Array([0,p?p.length:B.byteLength/A[0].stride]);ra={vertices:{data:B,count:B.byteLength/A[0].stride,layoutParameters:E.geometryParams},
positionData:{positions:G.data,indices:G.indices},indices:p,componentOffsets:ra};var U=C.transformation?ya.clone(C.transformation):ya.create();xa.multiply(U,l,U);C=xa.getTranslation(W.create(),U);U=ab.fromMat4(bb.create(),U);var Pa=this.view.renderSpatialReference,Qa=this.view.basemapTerrain.spatialReference,sa=W.create(),ta=[1,1,1];R.localLinearScaleFactors(C,Pa,ta,Qa)||J.errorOnce("Unsupported coordinate system for IM overlay");R.projectVectorToVector(C,Pa,sa,Qa);var ka=F.createObject({toMapSpace:eb.fromValues(sa[0],
sa[1],ta[0],ta[1]),geometry:ra,obb:b.geometryObb,transform:{position:C,rotationScale:U}}),{textures:Ra,texturePromise:Ib}=this._initMaterialAndTextures(ka,E.material,n,E.geometryParams.textureCoordinates===ia.TextureCoordinateAttributeType.Atlas);a.memory+=this._memEstimateGeometryAdded(ka);a.memory+=Ra.reduce((z,L)=>z+(g.isSome(L)?this._memEstimateTextureAdded(L):0),0);n=!!E.material.hasParametersFromSource;E="blend"!==E.material.alphaMode&&1<=E.material.metallicRoughness.baseColorFactor[3];var D=
new Eb(a,w,ka,this._getInvalidRendererVersion(),d.attributeInfo,{hasParametersFromSource:n,isOpaque:E},Ra);d.meta=D;!this._hasTextures&&b.requiredTextures?.some(({usage:z})=>0!==(z&N.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||P;this._hasTextures=this._hasTextures||!!a.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Jb=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(D),Ib]).then(([z])=>{g.isSome(z)&&
z.updateObjectVisibility(D.objectHandle,!1).catch(L=>O(L,this.i3slayer.title));return this._safeReschedule(()=>{var L=this._addTasks.get(a.index);if(L)if(this._addNodeMeta(a.index,D),L.meta=null,this.suspended)this._removeNodeStageData(a.index,this.elevationOffset);else{F.setObjectVisibility(ka,qa.State.Visible);g.isSome(z)&&z.updateObjectVisibility(D.objectHandle,!0).catch(Kb=>O(Kb,this.i3slayer.title));D.attributeInfo=L.attributeInfo;L=D.cachedRendererVersion!==this._rendererVersion;var Lb=Jb!==
this.slicePlaneEnabled;this._updateElevationOffsets(D);var Mb=D.elevationOffsets;this._updateComponentData(D);var Nb=this._applyFiltersToNode(D);(L||g.isSome(z)&&(Lb||Nb||Mb))&&this._addOrUpdateEdgeRendering(D);g.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,D);this._visibleGeometryChanged(D,I.ADD);this._highlights.objectCreated(D);this._updateMaterial(D);this._setNewNodeOpacity(D);g.isSome(this._treeDebugger)&&this._treeDebugger.update()}},c)}).catch(z=>{g.isSome(d.meta)&&(this._cacheGPUData(d.meta),
d.meta=null);throw z;})}};e._addNodeMeta=function(a,b){this._removeNodeStageData(a,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(a)){J.error("Removing duplicated node");const c=this._nodeId2Meta.get(a);g.isSome(c)&&this._deleteComponentObject(c)}else this._controller.updateLoadStatus(a,!0);g.isSome(b)&&(b.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&ca(b.cachedEdgeMaterials,0));this._nodeId2Meta.set(a,b)};e._updateElevationOffsets=function(a){const b=this.view.renderSpatialReference,
c=this.elevationInfo,d=this.view.basemapTerrain,f=d.spatialReference;var h=c.mode;if(g.isNone(b)||g.isNone(f)||h===x.ElevationMode.Absolute)a.elevationOffsets=null;else{var l=this._collection.getObjectTransform(a.objectHandle);a.elevationOffsets=a.elevationOffsets??[];var n=h===x.ElevationMode.OnTheGround;h=this.view.renderCoordsHelper;var m=a.featureIds.length;if(!a.cachedMidsTerrainSR){a.cachedMidsTerrainSR=za.newDoubleArray(3*m);const C=a.cachedMidsTerrainSR;for(let A=0;A<m;A++){this._collection.getComponentAabb(a.objectHandle,
A,T,!0);M.set(K,(T[0]+T[3])/2,(T[1]+T[4])/2,T[2]);M.transformMat3(K,K,l.rotationScale);M.add(K,K,l.position);const p=3*A;C[p+2]=h.getAltitude(K);R.projectVectorToVector(K,b,K,f);C[p]=K[0];C[p+1]=K[1]}}var q=a.cachedMidsTerrainSR,w=c.offset,F=a.elevationOffsets;d.getElevations(q,m,(C,A)=>{const p=n?q[3*C+2]:0;F[C]=w+(g.isSome(A)?A-p:0)})}};e._ensureElevationTask=function(){return g.isSome(this._elevationTask)?this._elevationTask:this._elevationTask=new qb.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,
a=>{a=this._controller.updateElevationChanged(a,this.view.basemapTerrain.spatialReference);return g.isSome(a)?a.filterInPlace(b=>g.isSome(this._nodeId2Meta.get(b))):null},a=>{a=this._nodeId2Meta.get(a);this._nodeElevationAlignmentChanged(a)})};e._elevationInfoChanged=function(a,b){const c=a.mode!==x.ElevationMode.Absolute;a=!!b&&b!==a&&b.mode!==x.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(c,this.view.state.viewingMode);c&&!a&&this._controller.removeAllGeometryObbs();
this._nodeId2Meta.forEach(d=>this._nodeElevationAlignmentChanged(d))};e._nodeElevationAlignmentChanged=function(a){g.isNone(a)||(this._updateElevationOffsets(a),this._updateComponentData(a),this._updateEdgeRendering(a),g.isSome(this._labeler)&&this._labeler.updateLabelPositions(a),this._updateSnappingSources(a,I.UPDATE))};e._safeReschedule=function(a,b){V.throwIfAborted(b);return this._controller.reschedule(a,b)};e._materialParameters=function(a,b){a=g.isSome(a.params.material)?a.params.material:
Z.defaultMaterial();const c=b.some(f=>"uvRegion"===f.name);b=b.some(f=>"normalCompressed"===f.name);const d=Ha(a);return{geometryParams:this._getGeometryParameters({hasTexture:d,hasNormals:b,hasRegions:c}),material:a}};e._initMaterialAndTextures=function(a,b,c,d){const f=this._stage.renderView,h=c.map(n=>Z.createTexture(n,b,d,f));this._stage.addMany(h);let l=null;this._collection.updateMaterial(a,n=>{l=Z.configureMaterial(n,b,h,c,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,
usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(n)});return{textures:h,texturePromise:l}};e._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture?a.hasRegions?ia.TextureCoordinateAttributeType.Atlas:ia.TextureCoordinateAttributeType.Default:ia.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:a.hasNormals&&!this._isIntegratedMesh}};
e._addData=function(a,b,c){let d=this._addTasks.get(a.index);d?d.attributeInfo=b:(d={...V.createResolver(),attributeInfo:b,meta:null},this._addTasks.set(a.index,d),c().then(d.resolve,d.reject).then(()=>this._addTasks.delete(a.index)).catch(f=>{this._addTasks.delete(a.index);throw f;}));return d.promise};e._clearAddTasks=function(){this._addTasks.forEach(a=>{g.isSome(a.meta)&&(this._cacheGPUData(a.meta),a.meta=null)});this._addTasks.clear()};e._clippingAreaChanged=function(){var a=this.view.renderSpatialReference;
const b=this.i3slayer.spatialReference,c=Y.create();this._renderClippingArea=Fa.toBoundingRect(this.view.clippingArea,c,a)?c:null;a=Y.create();this._layerClippingArea=Fa.toBoundingRect(this.view.clippingArea,a,b)?a:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};e._geometryFilterChange=function(){const a=this.hasGeometryFilter;this._controller.geometryFilterChanged(a);this._applyFilters(a)};
e._filterChange=function(){this._applyFilters(this.hasGeometryFilter)};e._applyFilters=function(a){this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(b=>{g.isSome(b)&&this._applyFiltersToNode(b)&&(this._addOrUpdateEdgeRendering(b),this._visibleGeometryChanged(b,I.UPDATE))})};e.getFilters=function(){const a=[],b=this._renderClippingArea;g.isSome(b)&&a.push((c,d)=>this._boundingRectFilter(c,d,b));return a};e.addSqlFilter=function(a,b,c){if(g.isSome(b)){const d=
b.fieldNames;a.push((f,h)=>this._sqlFilter(f,h,b,d,c))}};e._sqlFilter=function(a,b,c,d,f){const h={},l=this._createLayerGraphic(h),n=this.i3slayer.objectIdField,m=b.featureIds,q=g.isSome(b.attributeInfo)&&b.attributeInfo.attributeData;d.every(w=>w===n||q&&null!=q[w])&&t.filterInPlace(a,m,w=>{h[n]=m[w];for(const F of d)F!==n&&(h[F]=q?t.getCachedAttributeValue(q[F],w):null);try{return c.testFeature(l)}catch(F){return f(F),!1}})};e._boundingRectNodeTest=function(a,b){R.projectBoundingSphere(a.node.mbs,
this._controller.crsIndex,Oa,this.view.renderSpatialReference);return t.intersectBoundingRectWithMbs(b,Oa)};e._boundingRectFeatureTest=function(a,b,c){this._collection.getComponentAabb(a.objectHandle,b,Ma);X.toRect(Ma,Na);return Y.intersects(c,Na)};e._boundingRectFilter=function(a,b,c){var d=this._collection;const f=this._boundingRectNodeTest(b,c);if(f!==t.MbsIntersectResult.INSIDE)if(f===t.MbsIntersectResult.OUTSIDE)a.length=0;else if(d=d.getComponentCount(b.objectHandle),d.invisible+d.visible===
b.featureIds.length){var h=this._transformClippingArea(Fb,c,b.objectHandle);t.filterInPlace(a,b.featureIds,l=>this._boundingRectFeatureTest(b,l,h))}};e._transformClippingArea=function(a,b,c){var d=this._collection.getObjectTransform(c);c=d.position;d=d.rotationScale;a[0]=(b[0]-c[0])/d[0];a[1]=(b[1]-c[1])/d[4];a[2]=(b[2]-c[0])/d[0];a[3]=(b[3]-c[1])/d[4];return a};e._addOrUpdateEdgeRendering=function(a,b=!0){const c=this._edgeView;if(g.isNone(c))return Promise.resolve(null);const d=a.objectHandle;var f=
c.hasObject(d);const {hasEdges:h,perFeatureEdgeMaterials:l}=this._getFilteredEdgeMaterials(a),n={hasSlicePlane:this.slicePlaneEnabled};if(h&&f)return this.nodeCrossfadingEnabled&&(f=this.getNodeOpacity(a),ca(l,f)),c.updateAllComponentMaterials(d,l,n,b).catch(m=>O(m,this.i3slayer.title)),c.updateObjectVisibility(d,!0).catch(m=>O(m,this.i3slayer.title)),c.updateAllVerticalOffsets(d,a.elevationOffsets).catch(m=>O(m,this.i3slayer.title)),Promise.resolve(c);if(h&&!f)return this._collection.addEdges(d,
c,l,n).then(m=>{a.edgeMemoryUsage=m;a.node.memory+=m;c.updateAllVerticalOffsets(d,a.elevationOffsets).catch(q=>O(q,this.i3slayer.title));return c});!h&&f&&(a.node.memory-=a.edgeMemoryUsage,a.edgeMemoryUsage=0,c.removeObject(d));return Promise.resolve(null)};e._applyFiltersToNode=function(a){return this._applyFiltersToNodeComponents(a)?(g.isSome(this._labeler)&&this._labeler.applyFilterChange(a),!0):!1};e._applyFiltersToNodeComponents=function(a){const b=this._collection;var c=0===b.getComponentCount(a.objectHandle).invisible;
b.setAllComponentVisibilities(a.objectHandle,"all");if(0===this._filters.length)return a.filteredIds=null,!c;this._updateCachedFilteredIds(a);if(a.filteredIds===a.featureIds)return!c;c=this._computeFilteredComponentIndices(a);b.setAllComponentVisibilities(a.objectHandle,c);return!0};e._updateCachedFilteredIds=function(a){if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters};e._computeFilteredIds=function(a){const b=a.featureIds.slice();
for(const c of this._filters)if(c(b,a),0===b.length)break;return b.length===a.featureIds.length?a.featureIds:b};e._computeFilteredComponentIndices=function(a){const b=[],c=a.filteredIds;g.isSome(c)&&a.featureIds.forEach((d,f)=>{c[b.length]===d&&b.push(f)});return b};e._removeAllNodeDataFromStage=function(a=this.elevationOffset){this._nodeId2Meta.forEach((b,c)=>this._removeNodeStageData(c,a));this._nodeId2MetaReloading.forEach((b,c)=>this._removeNodeStageData(c,a,this._nodeId2MetaReloading));this._elevationTask=
g.destroyMaybe(this._elevationTask)};e.removeNode=function(a){const b=this.elevationOffset;this._removeNodeStageData(a,b);this._removeNodeStageData(a,b,this._nodeId2MetaReloading);g.isSome(this._elevationTask)&&this._elevationTask.remove(a)};e._removeNodeStageData=function(a,b,c=this._nodeId2Meta){c.has(a)&&this._controller.updateLoadStatus(a,!1);const d=c.get(a);g.isNone(d)?c.delete(a):(this._collection.setObjectVisibility(d.objectHandle,qa.State.Hidden),g.isSome(this._edgeView)&&this._edgeView.hasObject(d.objectHandle)&&
this._edgeView.updateObjectVisibility(d.objectHandle,!1).catch(f=>O(f,this.i3slayer.title)),this._visibleGeometryChanged(d,I.REMOVE),g.isSome(this._labeler)&&this._labeler.removeNodeMeta(d),c.delete(a),this._highlights.objectDeleted(d),c===this._nodeId2Meta?(this._cacheGPUData(d,b),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(d)):this._deleteComponentObject(d),g.isSome(this._treeDebugger)&&this._treeDebugger.update())};e._deleteComponentObject=function(a){g.isSome(this._edgeView)&&
this._edgeView.removeObject(a.objectHandle);this._memEstimateGeometryRemoved(a.objectHandle);this._collection.destroyObject(a.objectHandle);if(a.textures)for(const b of a.textures)this._memEstimateTextureRemoved(b),this._stage.remove(b)};e.updateNodeState=function(a,b){a=this._nodeId2Meta.get(a);g.isSome(a)&&this._collection.updateMaterial(a.objectHandle,c=>c.polygonOffsetEnabled=b===ma.NodeState.Hole)};e._invalidateAllSymbols=function(){this._rendererVersion=t.addWraparound(this._rendererVersion,
1);this._controller&&this._controller.requestUpdate()};e._getInvalidRendererVersion=function(){return t.addWraparound(this._rendererVersion,-1)};e._rendererChange=async function(a){this._currentRenderer=a;this.notifyChange("rendererTextureUsage");this._rendererVersion=t.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();a&&(this._rendererFields=await a.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();
!this._arcade&&a&&"arcadeRequired"in a&&a.arcadeRequired&&(this._arcade=await lb.loadArcade());if(a&&"visualVariables"in a&&a.visualVariables)for(const b of a.visualVariables)"color"===b.type?this._colorVariable=b:"opacity"===b.type?this._opacityVariable=b:J.warn(`Unsupported visual variable type for 3D Object Scene Services: ${b.type}`);if(a)for(const b of a.getSymbols())"mesh-3d"!==b.type&&J.error(`Symbols of type '${b.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()};
e._getCachedEdgeMaterials=function(a){this._hasComponentData&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedEdgeMaterials};e._getComponentParameters=function(a){this._hasComponentData&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);const b=a.cachedSymbology;return(c,d)=>{const f=5*c;db.set(d.externalColor,b[f]/255,b[f+1]/255,b[f+2]/255,b[f+3]/255);if(g.isSome(this._stage.renderView.objectAndLayerIdRenderHelper)){const h=
a.featureIds[c];this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(h,h,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabled,a.node.resources.attributes,c,this.sublayerId);d.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:h,layerUid:this.layerUid+"_"+this.sublayerId})}d.externalColorMixMode=b[f+4]&(1<<S.CastShadows)-1;d.castShadows=0!==(b[f+4]&1<<S.CastShadows);d.pickable=0!==(b[f+4]&1<<S.Pickable);d.elevationOffset=a.elevationOffsets?.[c]??
0}};e._getSymbolInfo=function(a,b){b=a&&a.getSymbol(b,{arcade:this._arcade});if(!(b instanceof mb))return null;a=b.id;if(this._symbolInfos.has(a))return this._symbolInfos.get(a);b=t.getSymbolInfo(b);this._symbolInfos.set(a,b);return b};e._setSymbologyOverride=function(a,b){this._symbologyOverride!==a&&(this._symbologyOverride=a,this._symbologyOverrideFields=b,this._invalidateAllSymbols(),this._updateSymbologyFields())};e._updateSymbologyFields=function(){this._symbologyFields=g.isSome(this._symbologyOverrideFields)&&
0<this._symbologyOverrideFields.length?g.isSome(this._rendererFields)&&0<this._rendererFields.length?jb.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};e._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var b=this._tmpAttributeOnlyGraphic,c={};b.attributes=c;var d=this._currentRenderer,f=g.isSome(a.attributeInfo)&&a.attributeInfo.attributeData,
h=null!=a.featureIds?this.i3slayer.objectIdField:null,l=null!=f&&g.isSome(this._symbologyFields)&&0<this._symbologyFields.length,n=null,m=null;if(l&&g.isSome(this._symbologyFields)){n=[];m=[];for(var q of this._symbologyFields){var w=f[q];w&&(n.push(q),m.push(w))}}a.cachedSymbology||(a.cachedSymbology=new Uint8Array(5*a.featureIds.length));f={color:da,castShadows:!0,pickable:!0,colorMixMode:pa.ColorMixModeEnum.Multiply,edgeMaterial:null};q=this.fullOpacity;q=this.nodeCrossfadingEnabled?this.getNodeOpacity(a):
q;w=null;var F=ja.Transparency.OPAQUE,C=t.transparentEdgeMaterial,A=0;for(let P=0;P<a.featureIds.length;P++){null!=h&&(c[h]=a.featureIds[P]);if(l&&n)for(var p=0;p<n.length;p++)c[n[p]]=t.getCachedAttributeValue(m[p],P);var B=d?this._getSymbolInfo(d,b):null;let E=p=null;if(d&&"visualVariables"in d){if(this._colorVariable){var G=Aa.getColor(this._colorVariable,b,{color:Gb,arcade:this._arcade});G&&(p=da,p[0]=G.r/255,p[1]=G.g/255,p[2]=G.b/255,this._opacityVariable||null===G.a||(E=G.a))}this._opacityVariable&&
(E=Aa.getOpacity(this._opacityVariable,b,{arcade:this._arcade}))}B&&B.material&&(G=B.material,p=g.isNone(p)||g.isNone(E)?Da.overrideColor(p,E,G.color,G.alpha,La,da):Da.overrideColor(p,E,null,null,La,da));g.isNone(p)&&(p=da,p[0]=1,p[1]=1,p[2]=1,p[3]=1);f.pickable=!0;f.castShadows=B?B.castShadows:!0;f.colorMixMode=B&&B.material?B.material.colorMixMode:pa.ColorMixModeEnum.Multiply;f.edgeMaterial=B?B.edgeMaterial:null;g.isSome(this._symbologyOverride)&&(f.color=p,this._symbologyOverride(b,f),p=f.color);
if(g.isSome(f.edgeMaterial)){B=0>=p[3]?ja.Transparency.INVISIBLE:1<=p[3]&&(a.material.isOpaque||f.colorMixMode===pa.ColorMixModeEnum.Replace)?ja.Transparency.OPAQUE:ja.Transparency.TRANSPARENT;if(f.edgeMaterial!==w||B!==F)C={...f.edgeMaterial,opacity:q,objectTransparency:B},w=f.edgeMaterial,F=B;a.cachedEdgeMaterials[P]=C}else a.cachedEdgeMaterials[P]=t.transparentEdgeMaterial;a.cachedSymbology[A]=Math.round(255*p[0]);a.cachedSymbology[A+1]=Math.round(255*p[1]);a.cachedSymbology[A+2]=Math.round(255*
p[2]);a.cachedSymbology[A+3]=Math.round(255*p[3]);a.cachedSymbology[A+4]=f.colorMixMode|+f.castShadows<<S.CastShadows|+f.pickable<<S.Pickable;A+=5}}};e._getFilteredEdgeMaterials=function(a){var b=this._getCachedEdgeMaterials(a);this.nodeCrossfadingEnabled||ca(b,this.fullOpacity);const c=a.filteredIds;if(g.isNone(c))return{hasEdges:b.some(h=>h!==t.transparentEdgeMaterial),perFeatureEdgeMaterials:b};let d=0,f=!1;b=b.map((h,l)=>{if(a.featureIds[l]!==c[d])return t.transparentEdgeMaterial;f=f||h!==t.transparentEdgeMaterial;
d++;return h});return{hasEdges:f,perFeatureEdgeMaterials:b}};e._updateComponentData=function(a){if(this._hasComponentData){var b=a.objectHandle;a=this._getComponentParameters(a);this._collection.setComponentData(b,a);this._stage.renderView.requestRender()}};e._reloadAll=function(a=this.elevationOffset){this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};e._opacityChange=function(a){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();
this._nodeId2Meta.forEach(b=>{g.isNone(b)||(this._collection.updateMaterial(b.objectHandle,c=>c.objectOpacity=a),ca(b.cachedEdgeMaterials,a),this._updateEdgeRendering(b))})};e._updateMaterial=function(a){this._collection.updateMaterial(a.objectHandle,b=>{b.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;b.usePBR=this._usePBR;this._updateMaterialOverlay(b)})};e._updateMaterialOverlay=function(a){};e._updateEngineObject=function(a){this._updateComponentData(a);this._applyFiltersToNode(a);
this._addOrUpdateEdgeRendering(a);this._visibleGeometryChanged(a,I.UPDATE)};e._slicePlaneEnabledChange=function(a){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=a);g.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=a);this._nodeId2Meta.forEach(b=>{g.isNone(b)||(this._collection.updateMaterial(b.objectHandle,c=>c.commonMaterialParameters.hasSlicePlane=a),this._updateEdgeRendering(b,!1))})};e._updatePBR=function(a){this._nodeId2Meta.forEach(b=>{g.isNone(b)||this._collection.updateMaterial(b.objectHandle,
c=>c.usePBR=a)});this._hasLoadedPBRTextures=!0};e._updateEdgeRendering=function(a,b=!0){g.isSome(this._edgeView)&&this._edgeView.hasObject(a.objectHandle)&&this._addOrUpdateEdgeRendering(a,b)};e._forAllNodes=function(a){this._nodeId2Meta.forEach(a)};e._forAllFeatures=function(a,b,c=y.ForAllFeaturesVisibilityMode.VISIBLE_ONLY){ua.someMap(this._nodeId2Meta,d=>{if(g.isNone(d))return!1;if(g.isSome(b))switch(b(d)){case y.ForAllFeaturesReturnType.EXIT:return!0;case y.ForAllFeaturesReturnType.SKIP:return!1}let f=
y.ForAllFeaturesReturnType.CONTINUE;switch(c){case y.ForAllFeaturesVisibilityMode.ALL:f=this._forAllFeaturesOfNode(d,a);break;case y.ForAllFeaturesVisibilityMode.VISIBLE_ONLY:f=this._forVisibleFeaturesOfNode(d,a);break;case y.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA:f=this._forAllFeaturesOfNodeInClippingArea(d,a)}return f===y.ForAllFeaturesReturnType.EXIT})};e._forAllFeaturesOfNode=function(a,b){let c=y.ForAllFeaturesReturnType.CONTINUE;const d=a.featureIds;for(let f=0;f<d.length&&(c=b(d[f],
f,a),c!==y.ForAllFeaturesReturnType.EXIT);f++);return c};e._forVisibleFeaturesOfNode=function(a,b){let c=y.ForAllFeaturesReturnType.CONTINUE;const d=a.featureIds;this._collection.forEachVisibleComponent(a.objectHandle,f=>{c=b(d[f],f,a);return c===y.ForAllFeaturesReturnType.CONTINUE});return c};e._forAllFeaturesOfNodeInClippingArea=function(a,b){if(g.isNone(this._renderClippingArea))return this._forAllFeaturesOfNode(a,b);var c=this._boundingRectNodeTest(a,this._renderClippingArea);if(c===t.MbsIntersectResult.OUTSIDE)return y.ForAllFeaturesReturnType.CONTINUE;
if(c===t.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(a,b);c=y.ForAllFeaturesReturnType.CONTINUE;const d=a.featureIds,f=t.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(a.objectHandle));for(let h=0;h<d.length;h++){if(!this._boundingRectFeatureTest(a,h,f))continue;const l=b(d[h],h,a);if(l===y.ForAllFeaturesReturnType.EXIT)return l}return c};e._createAttributes=function(a,b){const c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);b=g.isSome(b.attributeInfo)&&
b.attributeInfo.attributeData;if(g.isSome(b))for(const d of Object.keys(b))c[d]=t.getCachedAttributeValue(b[d],a);return c};e._createGraphic=function(a,b){return this._createLayerGraphic(this._createAttributes(a,b))};e.highlight=function(a){const b=this._highlights;"number"===typeof a?a=[a]:a instanceof ea?a=[a]:a instanceof Wa&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof ea){const c=this.i3slayer.fieldsIndex,d=this._getObjectIdField();a=a.map(l=>oa.attributeLookup(c,l.attributes,
d));const {set:f,handle:h}=b.acquireSet();b.setFeatureIds(f,a);return h}if("number"===typeof a[0]){const {set:c,handle:d}=b.acquireSet();b.setFeatureIds(c,a);return d}}return Hb};e.resetHighlights=function(){g.destroyMaybe(this._highlights);this._highlights=new pb({collection:this._collection,forAllFeatures:a=>this._forAllFeatures(a,null,y.ForAllFeaturesVisibilityMode.ALL),forAllFeaturesOfNode:(a,b)=>this._forAllFeaturesOfNode(a,b)})};e._visibleGeometryChanged=function(a,b){this._elevationProvider&&
(this._elevationProvider.objectChanged(a.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=Za.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(a,b))};e.getNodeOpacityByIndex=function(a){a=this._nodeId2Meta.get(a);return this.getNodeOpacity(a)};e.getNodeOpacity=function(a){return g.isSome(a)?this._collection.getMaterial(a.objectHandle).objectOpacity:0};e.isNodeFullyFadedIn=
function(a){return this._crossfadeHelper.isNodeFullyFadedIn(a)};e.getNodeCrossfadeMetaData=function(a){return this._nodeId2Meta.get(a)};e.markNodeToRemove=function(a){this._controller&&this._controller.markNodeToRemove(a)};e.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};e.foreachCrossfadeNode=function(a){this._nodeId2Meta.forEach((b,c)=>a(c,b))};e.fadeNode=function(a,b,c){if(this.nodeCrossfadingEnabled){var d=this._nodeId2Meta.get(a);g.isSome(d)&&this._crossfadeHelper.fadeNode(a,
d,b,c)}};e.setNodeOpacityByIndex=function(a,b){a=this._nodeId2Meta.get(a);g.isSome(a)&&this._setNodeOpacity(a,b)};e._setNodeOpacity=function(a,b){this._collection.updateMaterial(a.objectHandle,c=>c.objectOpacity=b);this._setNodeEdgeOpacity(a,b)};e._setNodeEdgeOpacity=function(a,b){!g.isNone(this._edgeView)&&a.cachedEdgeMaterials&&(ca(a.cachedEdgeMaterials,b),a=a.objectHandle,this._edgeView.hasObject(a)&&this._edgeView.updateAllComponentOpacities(a,b).catch(c=>O(c,this.i3slayer.title)))};e.updateNodeModificationStatus=
function(a){var b=a.length;if(this.hasModifications&&!(0>=b)&&!0===this._i3sWasmLoaded){b=this.uid;var c=Bb(a);if(g.isSome(c)){fa.filterObbsForModificationsSync({context:b,buffer:c.buffer});const d=new Float64Array(c.buffer);a.forAll((f,h)=>{h=fa.interpretObbModificationResults(d[h]);f.imModificationImpact=h;h!==ma.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(f.index)})}}};e.notifyUpdate=function(){this.notifyChange("updating")};e.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};
e.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||g.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||g.isSome(this._elevationTask)&&this._elevationTask.running};e.trackSnappingSources=function(a){const b={events:a,fetchEdgeLocations:async(c,d,f)=>{c=this._nodeId2Meta.get(c);if(g.isNone(c))throw Error("invalid-node");const {origin:h,
buffer:l}=await this._collection.extractEdgeInformation(c.objectHandle,d,f);this._snappingLocationsApplyElevation(c,l,h);return{type:"components",objectIds:c.featureIds,locations:l,origin:h}},remove:()=>{Ua.removeUnordered(this._snappingSourcesTrackers,b)}};this._snappingSourcesTrackers.push(b);this._nodeId2Meta.forEach((c,d)=>{g.isNone(c)||(c=this._controller.getRenderMbs(c.node),g.isSome(c)&&a.add(d,c))});return b};e._snappingLocationsApplyElevation=function(a,b,c){if(a.elevationOffsets&&this.elevationInfo.mode!==
x.ElevationMode.Absolute){var d=b.position0,f=b.position1;b=b.componentIndex;var h=W.create(),l=W.create(),n=(m,q)=>{M.add(m,m,c);this.view.renderCoordsHelper.worldUpAtPosition(m,l);M.add(m,m,M.scale(l,l,q));M.subtract(m,m,c)};for(let m=0;m<d.count;m++){const q=a.elevationOffsets[b.get(m)];d.getVec(m,h);n(h,q);d.setVec(m,h);f.getVec(m,h);n(h,q);f.setVec(m,h)}}};e._updateSnappingSources=function(a,b){const {index:c}=a.node;a=this._controller.getRenderMbs(a.node);if(!g.isNone(a))for(const d of this._snappingSourcesTrackers)b!==
I.REMOVE&&b!==I.UPDATE||d.events.remove(c),b!==I.ADD&&b!==I.UPDATE||d.events.add(c,a)};Q._createClass(r,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",get:function(){return null}},
{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return t.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?N.TextureUsage.AllTexturesPBR:N.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?N.TextureUsage.GeometryTexturesPBR:N.TextureUsage.GeometryTextures}},
{key:"elevationOffset",get:function(){const a=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){const b=wa.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),c=Ba.getMetersPerUnit(a.unit);return g.unwrapOr(a.offset,0)*c/b}return 0}},{key:"elevationInfo",get:function(){const a=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==a)return{mode:x.ElevationMode.Absolute,offset:0};var b=wa.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);
const c=Ba.getMetersPerUnit(a.unit);b=g.unwrapOr(a.offset,0)*c/b;switch(a.mode){case "absolute-height":return{mode:x.ElevationMode.Absolute,offset:b};case "relative-to-ground":return{mode:x.ElevationMode.RelativeToGround,offset:b};case "on-the-ground":return{mode:x.ElevationMode.OnTheGround,offset:0};default:return{mode:x.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return Z.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",
get:function(){const a=0===(this.supportedTextureEncodings&N.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&a}},{key:"usedMemory",get:function(){let a=g.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(b=>a+=g.isSome(b)?b.node.memory:0);this._nodeId2MetaReloading.forEach(b=>a+=g.isSome(b)?b.node.memory:0);return a}},{key:"unloadedMemory",get:function(){return(g.isSome(this._controller)?this._controller.unloadedMemoryEstimate:
0)+(g.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"_supportsNodeCrossFading",get:function(){return!this.view?._stage?.renderer.shadowsEnabled}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},
{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"_usePBR",get:function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}},{key:"performanceInfo",get:function(){const a={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/
1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.unloadedMemory/1048576).toFixed(1)+"MB"};g.isSome(this._memCache)&&(a.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a}},{key:"test",
get:function(){const a=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const b=[];a._forAllFeatures(c=>{b.push(c);return y.ForAllFeaturesReturnType.CONTINUE},null,y.ForAllFeaturesVisibilityMode.VISIBLE_ONLY);b.sort((c,d)=>c-d);return b},get numNodes(){return a._nodeId2Meta.size},get loadedNodes(){return Array.from(a._nodeId2Meta.keys()).sort((b,c)=>b-c)}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&g.isSome(this._layerClippingArea)||
this._modifications&&0<this._modifications.length}}]);return r}(k);u.__decorate([v.property()],k.prototype,"_hasLoadedPBRTextures",void 0);u.__decorate([v.property()],k.prototype,"_asyncModuleLoading",void 0);u.__decorate([v.property()],k.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);u.__decorate([v.property()],k.prototype,"view",void 0);u.__decorate([v.property()],k.prototype,"i3slayer",void 0);u.__decorate([v.property()],k.prototype,"_controller",void 0);u.__decorate([v.property()],
k.prototype,"_labeler",void 0);u.__decorate([v.property()],k.prototype,"updating",void 0);u.__decorate([v.property()],k.prototype,"suspended",void 0);u.__decorate([v.property()],k.prototype,"holeFilling",void 0);u.__decorate([v.property(xb.updatingProgress)],k.prototype,"updatingProgress",void 0);u.__decorate([v.property()],k.prototype,"updatingProgressValue",null);u.__decorate([v.property()],k.prototype,"hasTexturesOrVertexColors",null);u.__decorate([v.property()],k.prototype,"rendererTextureUsage",
null);u.__decorate([v.property()],k.prototype,"elevationOffset",null);u.__decorate([v.property()],k.prototype,"elevationInfo",null);u.__decorate([v.property({type:Boolean})],k.prototype,"slicePlaneEnabled",void 0);u.__decorate([v.property()],k.prototype,"supportedTextureEncodings",null);u.__decorate([v.property()],k.prototype,"uncompressedTextureDownsamplingEnabled",null);u.__decorate([v.property({type:[kb]})],k.prototype,"_modifications",void 0);u.__decorate([v.property()],k.prototype,"_elevationTask",
void 0);u.__decorate([v.property({readOnly:!0})],k.prototype,"_usePBR",null);return k=u.__decorate([$a.subclass("esri.views.3d.layers.I3SMeshView3D")],k)};Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});