// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(u,l,x,h,y,z,B,C,D,E,m,F,w,G,H,v,I,A,J,p,K,L,n,q){v=function(e){function g(a,b){a=r.call(this,a,null,b,M);a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}l._inherits(g,e);var r=l._createSuper(g);e=g.prototype;e.doLoad=async function(){this._material=new q.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._material)};e.destroy=function(){l._get(l._getPrototypeOf(g.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);
this._material=null};e._perInstanceMaterialParameters=function(a){const b=this._materialParameters;b.screenOffset=a.screenOffset||z.ZEROS;b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};e._defaultElevationInfoNoZ=function(){return N};e.createGraphics3DGraphic=function(a){const b=a.renderingInfo;a=a.graphic;const c=this.setGraphicElevationContext(a,new F.ElevationContext,b.elevationOffset||0);var d=b.symbol;const k="on-the-ground"===this._elevationContext.mode&&("cim"===d.type||!d.symbolLayers.some(f=>
"object"===f.type||"text"===f.type));if("label-3d"!==d.type&&k||"point-3d"===d.type&&d.symbolLayers.every(f=>"text"===f.type&&!D.textSymbolLayerSupportsVerticalOffset(f)))return null;d=I.computeCentroid(a.geometry);return h.isNone(d)?null:this._createAs3DShape(d,c,b,a.uid)};e.layerOpacityChanged=function(){h.isSome(this._material)&&this._material.setParameters(this._materialParameters)};e.layerElevationInfoChanged=function(a,b,c){c=m.elevationModeChangeUpdateType(g.elevationModeChangeTypes,c,this._elevationContext.mode);
if(c!==m.SymbolUpdateType.UPDATE)return c;a.forEach(d=>{const k=b(d);h.isSome(k)&&this.updateGraphicElevationContext(d.graphic,k)});return c};e.slicePlaneEnabledChanged=function(){if(h.isNone(this._material))return!0;this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};e.physicalBasedRenderingChanged=function(){return!0};e.setGraphicElevationContext=function(a,b,c=0){a=l._get(l._getPrototypeOf(g.prototype),"setGraphicElevationContext",this).call(this,a,b);a.addOffsetRenderUnits(c);
return a};e.updateGraphicElevationContext=function(a,b){this.setGraphicElevationContext(a,b.elevationContext,h.isSome(b.metadata)?b.metadata.elevationOffset:0);b.needsElevationUpdates=m.needsElevationUpdates2D(b.elevationContext.mode)};e.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:J.emptySymbolComplexity.memory}};e._createVertexData=function(a){const {translation:b,centerOffset:c}=a;a=b?new p.Attribute([b[0],b[1],b[2]],
3,!0):new p.Attribute([0,0,0],3,!0);const d=c?new p.Attribute([c[0],c[1],c[2],c[3]],4,!0):new p.Attribute([0,0,0,1],4,!0);return[[n.VertexAttribute.POSITION,a],[n.VertexAttribute.NORMAL,new p.Attribute([0,0,1],3,!0)],[n.VertexAttribute.AUXPOS1,d]]};e._getOrCreateMaterial=function(a){const b=this._perInstanceMaterialParameters(a),c=q.LineCalloutMaterial.uniqueMaterialIdentifier(b);if(h.isSome(this._material)&&c===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(h.isSome(a.materialCollection)){let d=
a.materialCollection.get(c);h.isNone(d)&&(d=new q.LineCalloutMaterial(b),a.materialCollection.add(c,d));return{material:d,isUnique:!1}}return{material:new q.LineCalloutMaterial(b),isUnique:!0}};e._createAs3DShape=function(a,b,c,d){var k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:d,layerUid:this._context.layer.uid}),f=this._getOrCreateMaterial(c);k=new L.Geometry(f.material,this._createVertexData(c),O,null,K.ContentObjectType.Point,k);d=A.createStageObject(this._context,a,
k,b,d);if(h.isNone(d))return null;f=new G.Graphics3DObject3DGraphicLayer(this,d.object,[k],f.isUnique?[f.material]:null,null,E.perObjectElevationAligner,b);f.metadata=new H.Graphics3DObjectMetadata(c.elevationOffset);f.alignedSampledElevation=d.sampledElevation;f.needsElevationUpdates=m.needsElevationUpdates2D(b.mode);A.extendPointGraphicElevationContext(f,a,this._context.elevationProvider);return f};l._createClass(g,[{key:"_materialParameters",get:function(){const a=new q.Parameters;var b=this.symbol,
c=b.callout;a.color=h.isSome(c.color)?x.toUnitRGBA(c.color):[0,0,0,0];a.color[3]*=this._getLayerOpacity();a.size=y.pt2px(c.size||0);if(b.verticalOffset){const {screenLength:d,minWorldLength:k,maxWorldLength:f}=b.verticalOffset;a.verticalOffset={screenLength:y.pt2px(d),minWorldLength:k||0,maxWorldLength:h.isSome(f)?f:Infinity}}a.borderColor=h.isSome(c.border)&&h.isSome(c.border.color)?x.toUnitRGBA(c.border.color):null;c="object"===b.symbolLayers.getItemAt(0).type;b="label-3d"===b.type;a.occlusionTest=
!c;a.shaderPolygonOffset=c?0:void 0;a.depthHUDAlignStart=b;a.hasSlicePlane=this._context.slicePlaneEnabled;a.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return a}}]);return g}(v.Graphics3DSymbolLayer);v.elevationModeChangeTypes={definedChanged:m.SymbolUpdateType.UPDATE,staysOnTheGround:m.SymbolUpdateType.UPDATE,onTheGroundChanged:m.SymbolUpdateType.RECREATE};var t=[0];const O=[[n.VertexAttribute.POSITION,t],[n.VertexAttribute.NORMAL,
t],[n.VertexAttribute.AUXPOS1,t]],N={mode:"relative-to-ground",offset:0},M={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};t=l._createClass(function(e,g,r=B.create(),a=C.create(),b=z.create(),c="world",d=0,k=null){this.renderer=e;this.symbol=g;this.translation=r;this.centerOffset=a;this.screenOffset=b;this.centerOffsetUnits=c;this.elevationOffset=d;this.materialCollection=k});w=function(e){function g(){return r.apply(this,arguments)}l._inherits(g,e);var r=l._createSuper(g);return l._createClass(g)}(w);
u.Graphics3DLineCalloutSymbolLayer=v;u.LineCalloutCreationContext=w;u.LineCalloutSymbolLayerRenderingInfo=t;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});