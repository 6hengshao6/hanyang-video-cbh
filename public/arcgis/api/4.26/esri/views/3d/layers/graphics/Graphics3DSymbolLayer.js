// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),function(t,n,p,B,y,C,h,D,E,u,F,G,v,H,I,J){function q(c,f){c=c?f.attributes[c]:0;return null!=c&&isFinite(c)?c:0}function z(c){const f=
{color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};c&&"visualVariables"in c&&c.visualVariables&&c.visualVariables.forEach(l=>{switch(l.type){case "color":f.color=!0;if(l.stops)for(let a=0;a<l.stops.length;a++){const b=l.stops[a].color;b&&(f.opacity=!0,1>b.a&&(f.opacityAlwaysOpaque=!1))}break;case "opacity":f.opacity=!0;f.opacityAlwaysOpaque=!1;break;case "size":f.size=!0}});return f}const m=C.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");y=function(c){function f(a,b,d,g){var e=
l.call(this,d.schedule);e.symbol=a;e.symbolLayer=b;e._context=d;e._elevationInfoOverride=null;e._ignoreDrivers=!1;e._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};e.complexity=null;e.logger=m;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};w.set(n._assertThisInitialized(e),!0);x.set(n._assertThisInitialized(e),!0);e._renderPriority=g.renderPriority;e._renderPriorityStep=g.renderPriorityStep;e._elevationContext=new F.ElevationContext;e.complexity=e.computeComplexity();
e._ignoreDrivers=g.ignoreDrivers;e._ignoreDrivers||(e._drivenProperties=z(e._context.renderer));e._updateElevationContext();return e}n._inherits(f,c);var l=n._createSuper(f);c=f.prototype;c.getCachedSize=function(){return null};c._drivenPropertiesChanged=function(a){if(this._ignoreDrivers)return!1;const b=this._drivenProperties;a=z(a);return a.color!==b.color||a.opacity!==b.opacity||a.opacityAlwaysOpaque!==b.opacityAlwaysOpaque||a.size!==b.size};c._logGeometryCreationWarnings=function(a,b,d,g){const e=
"polygons"in a?a.polygons:null,k=`${g} geometry failed to be created`;let r=null;a.projectionSuccess?!this._logGeometryValidationWarnings(b,d,g)&&e&&0===e.length&&"rings"===d&&0<b.length&&2<b[0].length&&(r=`${k} (filled rings should use clockwise winding - try reversing the order of vertices)`):r=`${k} (failed to project geometry to view spatial reference)`;r&&m.warnOncePerTick(r)};c._logGeometryValidationWarnings=function(a,b,d){d=`${d} geometry failed to be created`;return!a.length||1===a.length&&
!a[0].length?(m.warnOncePerTick(`${d} (no ${b} were defined)`),!0):Array.isArray(a)&&Array.isArray(a[0])?!1:(m.warnOncePerTick(`${d} (${b} should be defined as a 2D array)`),!0)};c._validateGeometry=function(a,b=null,d=null){return h.isSome(b)&&!b.includes(a.type)?(this.logger.warn("unsupported geometry type for "+d+` symbol: ${a.type}`),!1):"point"!==a.type||isFinite(a.x)&&isFinite(a.y)?!0:(m.warn("point coordinate is not a valid number, graphic skipped"),!1)};c._defaultElevationInfoNoZ=function(){return K};
c._defaultElevationInfoZ=function(){return L};c._updateElevationContext=function(){h.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};
c.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};c.getGeometryElevationMode=function(a,b=this.getDefaultElevationInfo(a)){return this._elevationContext.mode||b.mode};c.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};c.setGraphicElevationContext=function(a,b){var d=h.unwrap(a.geometry);const g=this.getDefaultElevationInfo(d);b.unit=null!=this._elevationContext.unit?this._elevationContext.unit:
g.unit;b.mode=this.getGeometryElevationMode(d,g);b.offsetMeters=h.unwrapOr(this._elevationContext.meterUnitOffset,h.unwrapOr(g.offset,0));if(d=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===b.mode)b.mode="relative-to-ground",b.offsetMeters=0;b.updateFeatureExpressionInfoContext(d?G.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return b};c.prepareSymbolLayerPatch=function(a){};c.updateGeometry=function(a,b){return!1};c.onRemoveGraphic=function(a){};
c._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const a=this._context.layer.opacity;return null==a?1:a};c._getCombinedOpacity=function(a,b=A){let d=1;this.draped||(d*=this._getLayerOpacity());if(this._drivenProperties.opacity)return d;h.isSome(a)?d*=a.a:b.hasIntrinsicColor||(d=0);return d};c._getCombinedOpacityAndColor=function(a,b=A){b=this._getCombinedOpacity(a,b);if(this._drivenProperties.color)return v.mixinColorAndOpacity(null,
b);a=h.isSome(a)?B.toUnitRGB(a):D.ONES;return v.mixinColorAndOpacity(a,b)};c._getVertexOpacityAndColor=function(a,b=null){a=v.mixinColorAndOpacity(this._drivenProperties.color?a.color:null,this._drivenProperties.opacity?a.opacity:null);h.isSome(b)&&(a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b);return a};c.isFastUpdatesEnabled=function(){return null!=this._fastUpdates};c.computeComplexity=function(){return J.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};c.globalPropertyChanged=function(a,b,d){switch(a){case "opacity":return this.layerOpacityChanged(b,
d),!0;case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(b,d,a)===u.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,d);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}};c.updateGraphics3DGraphicElevationInfo=function(a,b,d){let g=
u.SymbolUpdateType.UPDATE;a.forEach(e=>{const k=b(e);h.isSome(k)?(this.setGraphicElevationContext(e.graphic,k.elevationContext),k.needsElevationUpdates=d(k.elevationContext.mode)):g=u.SymbolUpdateType.RECREATE});return g};c.applyRendererDiff=function(a,b){return H.ApplyRendererDiffResult.Recreate_Symbol};c.getFastUpdateAttrValues=function(a){if(!this._fastUpdates)return null;const b=this._fastUpdates.visualVariables,d=b.size?q(b.size.field,a):0,g=b.color?q(b.color.field,a):0;a=b.opacity?q(b.opacity.field,
a):0;return E.fromValues(d,g,a,0)};c.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&m.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};c.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??
null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}};n._createClass(f,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"pixelRatioChanged",get:function(){return p.__classPrivateFieldGet(this,w,"f")},set:function(a){p.__classPrivateFieldSet(this,w,a,"f")}},{key:"skipHighSymbolLodsChanged",
get:function(){return p.__classPrivateFieldGet(this,x,"f")},set:function(a){p.__classPrivateFieldSet(this,x,a,"f")}},{key:"draped",get:function(){return this._draped}}]);return f}(I.Loadable);var w=new WeakMap;var x=new WeakMap;const K={mode:"on-the-ground",offset:0,unit:"meters"},L={mode:"absolute-height",offset:0,unit:"meters"},A={hasIntrinsicColor:!1};t.Graphics3DSymbolLayer=y;t.getAttributeValue=q;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});