// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/layerUtils ./LayerView3D ./TiledLayerView3D ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(k,
l,q,p,e,r,m,f,A,B,t,u,v,w,x,y){f=function(d){function g(){var b=z.apply(this,arguments);b.type="wmts-3d";return b}k._inherits(g,d);var z=k._createSuper(g);d=g.prototype;d._getCompatibleTileInfoMatrixSet=function(b,a=!1){const c=u.getTileMaxtrixSetFromActiveLayer(this.layer);if(e.isSome(c)){if(q.isCollection(c))return c.find(h=>{h=b(h);e.isSome(h)&&(a?p.getLogger(this.declaredClass).error("The selected tile matrix set is not compatible with the view",h):this.addResolvingPromise(Promise.reject(h)));
return null==h});const n=b(c);e.isSome(n)&&(a?p.getLogger(this.declaredClass).error("The selected tile matrix set is not compatible with the view",n):this.addResolvingPromise(Promise.reject(n)));return c}return null};d.initialize=function(){this._getCompatibleTileInfoMatrixSet(a=>this._getTileInfoSupportError(a.tileInfo,a.fullExtent));const b=r.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const a=this._getCompatibleTileInfoMatrixSet(c=>this._getTileInfoError(c.tileInfo,c.fullExtent));
e.isNone(a)||(null!==a.id&&this.layer.activeLayer.tileMatrixSetId!==a.id&&(this.layer.activeLayer.tileMatrixSetId=a.id),a.tileInfo&&(this.tileInfo=a.tileInfo),this.layer.fullExtent=a.fullExtent)});this.addResolvingPromise(b);this.when(()=>this._postInitialize())};d.refresh=function(){this.emit("data-changed")};d.canResume=function(){if(!k._get(k._getPrototypeOf(g.prototype),"canResume",this).call(this))return!1;const b=this.layer.activeLayer.tileMatrixSet;return e.isSome(b)&&!this._getTileInfoError(b.tileInfo,
b.fullExtent)};d.doRefresh=async function(){this.suspended||this.emit("data-changed")};d._postInitialize=function(){this.updatingHandles.add(()=>this.layer?.activeLayer?.styleId,()=>this.refresh());this.updatingHandles.add(()=>this.layer?.activeLayer,b=>{const a=this._getCompatibleTileInfoMatrixSet(c=>this._getTileInfoError(c.tileInfo,c.fullExtent),!0);e.isSome(a)&&null!==a.id&&b.tileMatrixSetId!==a.id&&(this.layer.activeLayer.tileMatrixSetId=a.id);this.notifyChange("suspended");this.canResume()&&
this.refresh()})};d._getTileInfoError=function(b,a){return this._getTileInfoSupportError(b,a)||this._getTileInfoCompatibilityError(b,this.view.basemapTerrain.tilingScheme)};k._createClass(g,[{key:"hasMixedImageFormats",get:function(){return!0}}]);return g}(y(w.TiledLayerView3D(v.LayerView3D(x))));l.__decorate([m.property({readOnly:!0})],f.prototype,"hasMixedImageFormats",null);l.__decorate([m.property()],f.prototype,"layer",void 0);l.__decorate([m.property()],f.prototype,"suspended",void 0);return f=
l.__decorate([t.subclass("esri.views.3d.layers.WMTSLayerView3d")],f)});