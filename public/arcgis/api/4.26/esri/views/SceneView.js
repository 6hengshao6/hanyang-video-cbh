// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,c,w,n,x,m,l,g,f){function d(q){return{operations:q,value:q.create()}}function e(q,y,B=d(q)){B.operations=q;q.copy(y,B.value);return B}function k(q,y,B,D){return q.operations.setAltitudeAt(q.value,y,B,D)}const u=
2**50,p=w.create(),h={operations:null,value:null},r=w.create();a.altitudeAt=function(q,y){return q.operations.altitudeAt(q.value,y)};a.axisAt=function(q,y,B,D){return q.operations.axisAt(q.value,y,B,D)};a.closestPoint=function(q,y,B){return q.operations.closestPoint(q.value,y,B)};a.closestPointOnSilhouette=function(q,y,B){return q.operations.closestPointOnSilhouette(q.value,y,B)};a.coordinateSystemFromOneAxisAndNormalVector=function(q,y,B,D,z){c.copy(B,q);c.copy(r,y);c.normalize(r,r);c.cross(D,r,
B);c.cross(z,D,B)};a.create=function(q){const {value:y,operations:B}=q;return{operations:B,value:B.create(y)}};a.createFromOperations=d;a.createGlobal=function(q){return e(f.sphere,f.fromValues(0,0,0,n.getReferenceEllipsoid(q).radius))};a.createLocal=function(){return e(g.boundedPlane,g.fromValues([0,0,0],[u,0,0],[0,u,0]))};a.distanceToSilhouette=function(q,y){return q.operations.distanceToSilhouette(q.value,y)};a.elevate=function(q,y,B){return q.operations.elevate(q.value,y,B.value)};a.fromValues=
e;a.intersectRay=function(q,y,B){return q.operations.intersectRay(q.value,y,B)};a.intersectRayClosestSilhouette=function(q,y,B){return q.operations.intersectRayClosestSilhouette(q.value,y,B)};a.intersectsRay=function(q,y){return q.operations.intersectRay(q.value,y,null)};a.normalAt=function(q,y,B){return q.operations.axisAt(q.value,y,l.Axis.Z,B)};a.renderSRFromViewSR=function(q,y){return q?m.getSphericalPCPF(y):y.isGeographic?x.PlateCarree:y};a.setAltitudeAt=k;a.setAltitudeOfTransformation=function(q,
y,B,D){y!==D&&b.copy(D,y);c.set(p,D[12],D[13],D[14]);k(q,p,B,p);D[12]=p[0];D[13]=p[1];D[14]=p[2];return D};a.setExtent=function(q,y,B){q.operations.setExtent(q.value,y,B.value);return B};a.vectorCoordinates=function(q,y,B,D,z){z[0]=c.dot(q,y);z[1]=c.dot(q,B);z[2]=c.dot(q,D);return z};a.wrap=function(q,y){h.operations=q;h.value=y;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference",
"./support/spatialReferenceUtils"],function(a,b,c,w){const n=new c(b.SphericalECEFSpatialReferenceLike),x=new c(b.SphericalPCPFMarsLike),m=new c(b.SphericalPCPFMoonLike);b=new c(b.WGS84ECEFSpatialReferenceLike);a.SphericalECEFSpatialReference=n;a.SphericalPCPFMars=x;a.SphericalPCPFMoon=m;a.WGS84ECEFSpatialReference=b;a.getSphericalPCPF=function(l){return l&&(w.isMars(l)||w.equals(l,x))?x:l&&(w.isMoon(l)||w.equals(l,m))?m:n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],
function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e){function k(h,
r){return r?u[h].valueToClassName[r].split(" "):[]}const u={widthBreakpoint:{getValue(h){const r=h.viewSize[0];h=h.breakpoints;const q=this.values;return r<=h.xsmall?q.xsmall:r<=h.small?q.small:r<=h.medium?q.medium:r<=h.large?q.large:q.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(h){const r=h.viewSize[1];h=h.breakpoints;const q=this.values;return r<=h.xsmall?q.xsmall:r<=h.small?q.small:r<=h.medium?q.medium:r<=h.large?q.large:q.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(h){h=h.viewSize;const r=this.values;return h[1]>=h[0]?r.portrait:r.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},p={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
h=>{h=function(r){function q(...B){B=y.call(this,...B);B._breakpointsHandles=new n;B.orientation=null;B.widthBreakpoint=null;B.heightBreakpoint=null;B.breakpoints=p;return B}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.initialize=function(){this._breakpointsHandles.add(m.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),m.initial))};r.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=x.destroyMaybe(this._breakpointsHandles))};
r._updateClassNames=function(){if(this.container){var B=w.acquire(),D=w.acquire(),z=!1,v;for(v in u){const A=this[v],t=u[v].getValue({viewSize:this.size,breakpoints:this.breakpoints});A!==t&&(z=!0,this[v]=t,k(v,A).forEach(C=>D.push(C)),k(v,t).forEach(C=>B.push(C)))}z&&(this._applyClassNameChanges(B,D),w.release(B),w.release(D))}};r._applyClassNameChanges=function(B,D){const z=this.container;z&&(D.forEach(v=>z.classList.remove(v)),B.forEach(v=>z.classList.add(v)))};r._removeActiveClassNames=function(){const B=
this.container;if(B)for(var D in u)k(D,this[D]).forEach(z=>B.classList.remove(z))};b._createClass(q,[{key:"breakpoints",set:function(B){var D=this._get("breakpoints");if(B!==D){D=(D=B)&&D.xsmall<D.small&&D.small<D.medium&&D.medium<D.large;if(!D){const z=JSON.stringify(p,null,2);console.warn("provided breakpoints are not valid, using defaults:"+z)}B=D?B:p;this._set("breakpoints",{...B})}}}]);return q}(h);c.__decorate([l.property()],h.prototype,"breakpoints",null);c.__decorate([l.property()],h.prototype,
"orientation",void 0);c.__decorate([l.property()],h.prototype,"widthBreakpoint",void 0);c.__decorate([l.property()],h.prototype,"heightBreakpoint",void 0);return h=c.__decorate([e.subclass("esri.views.BreakpointsOwner")],h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){function h(q){q&&(w.empty(q),q.parentNode&&q.parentNode.removeChild(q))}const r=[0,0];a.DOMContainer=q=>{q=function(y){function B(...z){var v=D.call(this,...z);v._freqInfo={freq:16,time:750};v._overlayRenderTaskHandle=null;v.height=0;v.overlay=null;v.position=null;v.resizing=!1;v.root=null;v.surface=null;v.suspended=!0;v.ui=null;v.userContent=null;v.width=0;v.widthBreakpoint=null;if(0===z.length||void 0===z[0]?.popup)v.popup=new p({view:b._assertThisInitialized(v)});
v.addHandles([m.watch(()=>v.cursor,A=>{const {surface:t}=b._assertThisInitialized(v);t&&t.setAttribute("data-cursor",A)}),m.watch(()=>v.interacting,A=>{const {surface:t}=b._assertThisInitialized(v);t&&t.setAttribute("data-interacting",A.toString())})]);return v}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.initialize=function(){this.addHandles(m.watch(()=>this.ui,(z,v)=>this._handleUIChange(z,v)));this._wireUI(this.ui);this.addHandles([this.on("focus",()=>this.notifyChange("focused")),
this.on("blur",()=>this.notifyChange("focused"))])};y.destroy=function(){this.destroyed||(this.ui=x.destroyMaybe(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)};y.blur=function(){this.surface&&this.surface.blur()};y.focus=function(){this.surface&&this.surface.focus()};y.pageToContainer=function(z,v,A){const t=this.position;z-=t?t[0]:0;v-=t?t[1]:0;A?(A[0]=z,A[1]=v):A=[z,v];return A};y.containerToPage=function(z,v,A){const t=this.position;z+=t?t[0]:0;v+=t?t[1]:
0;A?(A[0]=z,A[1]=v):A=[z,v];return A};y._handleUIChange=function(z,v){v&&(this.removeHandles("ui"),v.destroy());z&&this._wireUI(z);this._set("ui",z)};y._wireUI=function(z){this.removeHandles("ui");z&&(z.view=this,this.addHandles([m.watch(()=>this.root,v=>{if(v){const A=document.createElement("div");v.appendChild(A);v=A}else v=null;z.container=v},m.initial),m.watch(()=>this.popup,(v,A)=>{A&&z.remove(A,"popup");v&&(v.view=z.view,z.add(v,{key:"popup",position:"manual"}))},m.initial)],"ui"))};y._stopMeasuring=
function(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)};y._startMeasuring=function(){const z=this._freqInfo;z.freq=16;z.time=750;this.addHandles([(()=>{const v=()=>{z.freq=16;z.time=750};window.addEventListener("resize",v);return{remove(){window.removeEventListener("resize",v)}}})(),l.addFrameTask({prepare:v=>{const A=this._measure(),t=this._freqInfo;t.time+=v.deltaTime;A&&(t.freq=16,this._get("resizing")||this._set("resizing",!0));t.time<t.freq||(t.time=0,this._position()||
A?t.freq=16:t.freq=Math.min(750,2*t.freq),!A&&512<=t.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};y._measure=function(){var z=this.container;const v=z?z.clientWidth:0;z=z?z.clientHeight:0;if(0===v||0===z)return this.suspended||this._set("suspended",!0),!1;const A=this.width,t=this.height;if(v===A&&z===t)return this.suspended&&this._set("suspended",!1),!1;this._set("width",v);this._set("height",z);this.suspended&&this._set("suspended",!1);
this.emit("resize",{oldWidth:A,oldHeight:t,width:v,height:z});return!0};y._position=function(){var z=this.container;const v=this.position;var A;if(A=z)A=(z.ownerDocument||window.document).defaultView,z=z.getBoundingClientRect(),r[0]=z.left+(A?.pageXOffset??0),r[1]=z.top+(A?.pageYOffset??0),A=r;z=A;return z?v&&z[0]===v[0]&&z[1]===v[1]?!1:(this._set("position",[z[0],z[1]]),!0):!1};y.forceDOMReadyCycle=function(){};b._createClass(B,[{key:"container",get:function(){return this._get("container")??null},
set:function(z){const v=this._get("container"),A=w.byId(z);A||"string"!==typeof z||n.getLogger(this.declaredClass).error("#container",`element with id '${z}' not found`);if(v!==A)if(this.removeHandles("dom-size"),this._stopMeasuring(),v&&(v.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(h(this.root),this._set("root",null)),this.userContent&&
(w.reparent(this.userContent,v),h(this.userContent),this._set("userContent",null))),A){A.classList.add("esri-view");z=document.createElement("div");z.className="esri-view-user-storage";w.reparent(A,z);A.appendChild(z);this._set("userContent",z);z=document.createElement("div");z.className="esri-view-root";A.insertBefore(z,A.firstChild);this._set("root",z);var t=document.createElement("div");t.className="esri-view-surface";t.setAttribute("role","application");t.tabIndex=0;z.appendChild(t);this._set("surface",
t);var C=new u;z.appendChild(C.surface);this._set("overlay",C);this.addHandles(m.watch(()=>C.needsRender,E=>{this._overlayRenderTaskHandle=E&&!this._overlayRenderTaskHandle?l.addFrameTask({render:()=>this.overlay?.render()}):x.removeMaybe(this._overlayRenderTaskHandle)}));this.forceDOMReadyCycle();this.addHandles(m.watch(()=>this.size,E=>{const [F,H]=E;F>=document.body.clientWidth||H>=document.body.clientHeight?t.classList.add("esri-view-surface--inset-outline"):t.classList.remove("esri-view-surface--inset-outline")},
m.initial),"dom-size");this._set("container",A);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const z=document.activeElement===this.surface;return document.hasFocus()&&z}},{key:"popup",set:function(z){const v=this._get("popup");v&&v!==z&&v.destroy();this._set("popup",z)}},{key:"size",get:function(){return[this.width,this.height]}}]);return B}(q);
c.__decorate([g.property()],q.prototype,"container",null);c.__decorate([g.property({readOnly:!0})],q.prototype,"focused",null);c.__decorate([g.property({readOnly:!0})],q.prototype,"height",void 0);c.__decorate([g.property({type:p})],q.prototype,"popup",null);c.__decorate([g.property({type:u})],q.prototype,"overlay",void 0);c.__decorate([g.property({readOnly:!0})],q.prototype,"position",void 0);c.__decorate([g.property({readOnly:!0})],q.prototype,"resizing",void 0);c.__decorate([g.property({readOnly:!0})],
q.prototype,"root",void 0);c.__decorate([g.property({value:null,readOnly:!0})],q.prototype,"size",null);c.__decorate([g.property({readOnly:!0})],q.prototype,"surface",void 0);c.__decorate([g.property({readOnly:!0})],q.prototype,"suspended",void 0);c.__decorate([g.property()],q.prototype,"ui",void 0);c.__decorate([g.property({readOnly:!0})],q.prototype,"userContent",void 0);c.__decorate([g.property({readOnly:!0})],q.prototype,"width",void 0);c.__decorate([g.property()],q.prototype,"widthBreakpoint",
void 0);return q=c.__decorate([k.subclass("esri.views.DOMContainer")],q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){c=function(k){function u(){var h=p.apply(this,arguments);h.items=new w;h._watchUpdatingTracking=new f.WatchUpdatingTracking;h._callbacks=new Map;h._projector=e.createProjector();h._hiddenProjector=e.createProjector();return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.initialize=function(){const h=document.createElement("div");h.className="esri-overlay-surface";this._set("surface",h);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");h.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const q of r.added){const y=()=>q.render();this._callbacks.set(q,y);this._projector.append(this.surface,y)}for(const q of r.removed)r=this._projector.detach(this._callbacks.get(q)),this.surface.removeChild(r.domNode),this._callbacks.delete(q)})};k.addItem=function(h){this.items.add(h)};k.removeItem=function(h){this.items.remove(h)};k.destroy=function(){this.items.removeAll();
this._callbacks.forEach(h=>this._projector.detach(h));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};k.render=function(){this._projector.renderNow()};k.computeBoundingRect=function(h){const r=this._hiddenSurface,q=this._hiddenProjector;let y;const B=()=>y=h.render();q.append(r,B);q.renderNow();const D={left:0,top:0,right:0,bottom:0};if(y&&y.domNode){const z=y.domNode.getBoundingClientRect();D.left=z.left;D.top=z.top;D.right=z.right;D.bottom=z.bottom}for(q.detach(B);r.firstChild;)r.removeChild(r.firstChild);
return D};k.overlaps=function(h,r){h=this.computeBoundingRect(h);r=this.computeBoundingRect(r);return Math.max(h.left,r.left)<=Math.min(h.right,r.right)&&Math.max(h.top,r.top)<=Math.min(h.bottom,r.bottom)};k.prepare=async function(){await document.fonts.load(this._fontString()).catch(()=>{})};k.renderCanvas=function(h){if(this.items.some(q=>q.visible)){var r=h.getContext("2d");r.save();r.font=this._fontString();this.items.forEach(q=>{r.save();q.renderCanvas(r);r.restore()});r.restore()}};k._fontString=
function(){return`10px ${getComputedStyle(this.surface).fontFamily}`};a._createClass(u,[{key:"needsRender",get:function(){return 0<this.items.length}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some(h=>h.visible)}}]);return u}(c);b.__decorate([n.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"items",void 0);b.__decorate([n.property({readOnly:!0})],
c.prototype,"needsRender",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"updating",null);return c=b.__decorate([g.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/widgets/Popup":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/resources ./Feature/support/FeatureContentMixin ./Popup/actionUtils ./Popup/css ./Popup/PopupViewModel ./support/componentsUtils ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../support/themeUtils ../intl/substitute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R){function O(G,P){return void 0===P?`${"esri-popup"}__${G}`:`${"esri-popup"}__${G}-${P}`}const J={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},M={closeButton:!0,featureNavigation:!0};w=function(G){function P(N,S){var Q=U.call(this,N,S);Q._blurClose=!1;Q._blurContainer=!1;Q._containerNode=null;Q._mainContainerNode=null;Q._featureMenuNode=null;Q._actionsMenuNode=null;Q._focusClose=!1;Q._focusContainer=!1;Q._focusDockButton=
!1;Q._focusFeatureMenuButton=!1;Q._focusActionsMenuButton=!1;Q._focusFirstFeature=!1;Q._focusFirstAction=!1;Q._handles=new m;Q._pointerOffsetInPx=16;Q._spinner=null;Q._feature=null;Q._featureMenuIntersectionObserverNode=null;Q._featureMenuViewportNode=null;Q._rootFlowItemNode=null;Q._featureMenuIntersectionObserverCallback=([W])=>{W?.isIntersecting&&null!=Q.viewModel.featurePage&&Q.viewModel.featurePage++};Q._featureMenuIntersectionObserver=new IntersectionObserver(Q._featureMenuIntersectionObserverCallback,
{root:window.document});Q._displaySpinnerThrottled=d.throttle(()=>Q._displaySpinner(),0);Q._exitRelatedRecordsActions=new WeakMap;Q._featureSelectionActions=new WeakMap;Q._flowItems=new n;Q.alignment="auto";Q.collapsed=!1;Q.collapseEnabled=!0;Q.dockEnabled=!1;Q.featureMenuOpen=!1;Q.headingLevel=2;Q.maxInlineActions=3;Q.messages=null;Q.messagesCommon=null;Q.spinnerEnabled=!0;Q.viewModel=new A;Q.visibleElements={...M};Q._handleOpenRelatedFeature=W=>{Q._openRelatedFeature(W)};Q._addSelectedFeatureIndexHandle();
Q.addHandles([f.watch(()=>Q.viewModel?.screenLocation,()=>Q._positionContainer()),f.watch(()=>[Q.viewModel?.active,Q.dockEnabled],()=>Q._toggleScreenLocationEnabled()),f.watch(()=>Q.viewModel?.screenLocation,(W,V)=>{!!W!==!!V&&Q.reposition()}),f.watch(()=>[Q.viewModel?.view?.padding,Q.viewModel?.view?.size,Q.viewModel?.active,Q.viewModel?.location,Q.alignment],()=>Q.reposition()),f.watch(()=>Q.spinnerEnabled,W=>Q._spinnerEnabledChange(W)),f.watch(()=>Q.viewModel?.view?.size,(W,V)=>Q._updateDockEnabledForViewSize(W,
V)),f.watch(()=>Q.viewModel?.view,(W,V)=>Q._viewChange(W,V)),f.watch(()=>Q.viewModel?.view?.ready,(W,V)=>Q._viewReadyChange(W??!1,V??!1)),f.watch(()=>[Q.viewModel?.waitingForResult,Q.viewModel?.location],()=>{Q._hideSpinner();Q._displaySpinnerThrottled()}),f.watch(()=>Q.selectedFeatureWidget,()=>Q._destroyFlowItemWidgets()),f.watch(()=>[Q.selectedFeatureWidget?.viewModel?.title,Q.selectedFeatureWidget?.viewModel?.state],()=>Q._setTitleFromFeatureWidget()),f.watch(()=>[Q.selectedFeatureWidget?.viewModel?.content,
Q.selectedFeatureWidget?.viewModel?.state],()=>Q._setContentFromFeatureWidget()),f.when(()=>!Q.collapsed,()=>{"xsmall"===Q.viewModel?.view?.widthBreakpoint&&Q.viewModel.active&&Q.collapseEnabled&&Q.viewModel.centerAtLocation()}),f.on(()=>Q.viewModel?.allActions,"change",()=>Q._watchActions()),f.watch(()=>Q.viewModel?.allActions,()=>Q._watchActions(),f.initial),f.watch(()=>Q.viewModel?.featureViewModels,()=>Q._featureMenuViewportScrollTop()),f.on(()=>Q._flowItems,"change",()=>{Q.notifyChange("_activeFlowItemWidget");
Q.scheduleRender()}),f.watch(()=>[Q._activeFlowItemWidget?.viewModel?.state,Q._activeFlowItemWidget?.viewModel?.title],()=>Q.scheduleRender())]);return Q}b._inherits(P,G);var U=b._createSuper(P);G=P.prototype;G.loadDependencies=function(){return t.loadCalciteComponents({action:()=>new Promise((N,S)=>a(["../chunks/calcite-action"],N,S)),flow:()=>new Promise((N,S)=>a(["../chunks/calcite-flow"],N,S)),"flow-item":()=>new Promise((N,S)=>a(["../chunks/calcite-flow-item"],N,S)),icon:()=>new Promise((N,S)=>
a(["../chunks/calcite-icon"],N,S)),tooltip:()=>new Promise((N,S)=>a(["../chunks/calcite-tooltip"],N,S))})};G.destroy=function(){this._destroyFlowItemWidgets();this._destroySelectedFeatureWidget();this._destroySpinner();this._handles?.destroy();this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver?.disconnect()};G.castVisibleElements=function(N){return{...M,...N}};G.blur=function(){const {active:N}=this.viewModel;N||l.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active.");
this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};G.clear=function(){return this.viewModel.clear()};G.close=function(){this.visible=!1};G.fetchFeatures=function(N,S){return this.viewModel.fetchFeatures(N,S)};G.focus=function(){const {active:N}=this.viewModel;N||l.getLogger(this.declaredClass).warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};G.next=
function(){return this.viewModel.next()};G.open=function(N){this._handles.remove("selected-index");const S={collapsed:N?!!N.collapsed:!1,actionsMenuOpen:N?!!N.actionsMenuOpen:!1,featureMenuOpen:N?!!N.featureMenuOpen:!1};"xsmall"===this.viewModel?.view?.widthBreakpoint&&(S.collapsed=!0);this.set(S);this.viewModel.open(N);this._shouldFocus(N);this._addSelectedFeatureIndexHandle()};G.previous=function(){return this.viewModel.previous()};G.reposition=function(){this.renderNow();this._positionContainer();
this._setCurrentAlignment()};G.triggerAction=function(N){return this.viewModel.triggerAction(N)};G.render=function(){const {actionsMenuOpen:N,dockEnabled:S,featureMenuVisible:Q,dividedActions:W,currentAlignment:V,currentDockPosition:T}=this,{active:X}=this.viewModel,{menuActions:Z}=W,Y=this.selectedFeature?.layer?.title,aa=this.selectedFeature?.layer?.id;return K.tsx("div",{class:this.classes(v.CSS.base,{[v.CSS.alignTopCenter]:"top-center"===V,[v.CSS.alignBottomCenter]:"bottom-center"===V,[v.CSS.alignTopLeft]:"top-left"===
V,[v.CSS.alignBottomLeft]:"bottom-left"===V,[v.CSS.alignTopRight]:"top-right"===V,[v.CSS.alignBottomRight]:"bottom-right"===V,[v.CSS.isDocked]:X&&S,[v.CSS.shadow]:X&&!S,[v.CSS.isDockedTopLeft]:"top-left"===T,[v.CSS.isDockedTopCenter]:"top-center"===T,[v.CSS.isDockedTopRight]:"top-right"===T,[v.CSS.isDockedBottomLeft]:"bottom-left"===T,[v.CSS.isDockedBottomCenter]:"bottom-center"===T,[v.CSS.isDockedBottomRight]:"bottom-right"===T,[v.CSS.isFeatureMenuOpen]:Q,[v.CSS.isActionsMenuOpen]:X&&1<Z.length&&
N}),role:"presentation","data-layer-title":Y,"data-layer-id":aa,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},X?[this.renderMainContainer(),this.renderPointer()]:null)};G.renderLoadingIcon=function(){return K.tsx("span",{"aria-hidden":"true",class:this.classes(v.CSS.icon,v.CSS.iconLoading,v.CSS.rotating)})};G.renderNavigationLoading=function(){const {messagesCommon:N}=this;return this.viewModel.pendingPromisesCount?K.tsx("div",{key:O("loading-container"),role:"presentation",
class:v.CSS.loadingContainer,"aria-label":N.loading,title:N.loading},this.renderLoadingIcon()):null};G.renderPreviousIcon=function(){const N=I.isRTL(this.container);return K.tsx("span",{"aria-hidden":"true",class:this.classes(v.CSS.icon,{[v.CSS.iconRightTriangleArrow]:N,[v.CSS.paginationPreviousIconRTL]:N,[v.CSS.iconLeftTriangleArrow]:!N,[v.CSS.paginationPreviousIconLTR]:!N})})};G.renderPreviousButton=function(){const {messages:N}=this;return K.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,
onkeydown:this._previous,class:this.classes(v.CSS.button,v.CSS.paginationPrevious),"aria-label":N.previous,title:N.previous},this.renderPreviousIcon())};G.renderNextIcon=function(){const N=I.isRTL(this.container);return K.tsx("span",{"aria-hidden":"true",class:this.classes(v.CSS.icon,{[v.CSS.iconLeftTriangleArrow]:N,[v.CSS.paginationNextIconRTL]:N,[v.CSS.iconRightTriangleArrow]:!N,[v.CSS.paginationNextIconLTR]:!N})})};G.renderNextButton=function(){const {messages:N}=this;return K.tsx("div",{role:"button",
tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(v.CSS.button,v.CSS.paginationNext),"aria-label":N.next,title:N.next},this.renderNextIcon())};G.renderFeatureMenuButton=function(){const {featureMenuOpen:N,featureMenuId:S,messagesCommon:Q}=this,{featureCount:W,selectedFeatureIndex:V}=this.viewModel;return K.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,
class:this.classes(v.CSS.button,v.CSS.featureMenuButton),"aria-haspopup":"true","aria-controls":S,"aria-expanded":N.toString(),"aria-label":Q.menu,title:Q.menu},this._getPageText(W,V))};G.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]};G.renderDockIcon=function(){const {dockEnabled:N}=this,S=this._wouldDockTo();return K.tsx("span",{"aria-hidden":"true",class:this.classes({[v.CSS.iconUndock]:N,
[v.CSS.iconDock]:!N,[v.CSS.iconDockToRight]:!N&&("top-right"===S||"bottom-right"===S),[v.CSS.iconDockToLeft]:!N&&("top-left"===S||"bottom-left"===S),[v.CSS.iconDockToTop]:!N&&"top-center"===S,[v.CSS.iconDockToBottom]:!N&&"bottom-center"===S},v.CSS.icon)})};G.renderDockButton=function(){const {dockEnabled:N,messages:S}=this,Q=N?S.undock:S.dock;return"xsmall"!==this.viewModel?.view?.widthBreakpoint&&this.dockOptions?.buttonEnabled?K.tsx("div",{role:"button","aria-label":Q,title:Q,tabIndex:0,bind:this,
onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(v.CSS.button,v.CSS.buttonDock)},this.renderDockIcon()):null};G.renderTitle=function(){const {title:N}=this.viewModel,{titleId:S,collapsible:Q,contentCollapsed:W,messagesCommon:V}=this;var T={[v.CSS.headerContainerButton]:Q};const X=K.tsx(C.Heading,{level:this.headingLevel,class:v.CSS.headerTitle,innerHTML:N??""});T=Q?K.tsx("button",{key:`${N}--collapsible`,
id:S,title:W?V.expand:V.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(v.CSS.headerContainer,T),"aria-expanded":W?"false":"true",onclick:this._toggleCollapsed,type:"button"},X,K.tsx("calcite-icon",{class:v.CSS.collapseIcon,key:"collapse-icon",icon:W?"chevron-down":"chevron-up",scale:"m"})):K.tsx("div",{key:N??"title",id:S,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(v.CSS.headerContainer,T)},X);return N?T:null};G.renderCloseIcon=
function(){return K.tsx("span",{"aria-hidden":"true",class:this.classes(v.CSS.icon,v.CSS.iconClose)})};G.renderCloseButton=function(){const {visibleElements:N,messagesCommon:S}=this;return N.closeButton?K.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:v.CSS.button,"aria-label":S.close,title:S.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};G.renderHeader=function(){return K.tsx("header",
{class:v.CSS.header},this.renderTitle(),K.tsx("div",{class:v.CSS.headerButtons},this.renderDockButton(),this.renderCloseButton()))};G.renderContentContainer=function(){const {contentId:N,hasContent:S,contentCollapsed:Q,_flowItems:W}=this,{content:V}=this.viewModel,T=W.toArray(),X={[v.CSS.contentHasFlows]:!!T.length};return S&&!Q?K.tsx("div",{key:V??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:N,class:this.classes(v.CSS.content,X)},K.tsx("calcite-flow",{bind:this},K.tsx("calcite-flow-item",
{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:I.storeNode,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),T.map(Z=>this.renderFlowItem(Z))),T.map(Z=>this.renderFlowItemTooltips(Z))):null};G.renderFlowItem=function(N){const {messages:S}=this,Q=L.isDarkTheme(),W="graphic"in N&&!N.isTable;return K.tsx("calcite-flow-item",{bind:this,class:this.classes({[v.CSS.calciteThemeDark]:!Q,[v.CSS.calciteThemeLight]:Q}),heading:N.title??"",description:this._getFlowItemDescription(N),
onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${N.viewModel.uid}`},K.tsx("calcite-action",{class:v.CSS.actionExit,icon:"move-up",label:S?.exitRelatedRecords,text:S?.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:V=>this._storeExitRelatedRecordsAction(N,V),onclick:this._destroyFlowItemWidgets}),W?K.tsx("calcite-action",{class:v.CSS.actionSelectFeature,icon:"zoom-to-object",label:S?.selectFeature,text:S?.selectFeature,slot:"header-actions-end",bind:this,afterCreate:V=>
this._storeFeatureSelectionAction(N,V),onclick:()=>this._handleOpenRelatedFeature(N)}):null,K.tsx("div",{class:this.classes(v.CSS.contentFlowItem,{[v.CSS.calciteThemeDark]:Q,[v.CSS.calciteThemeLight]:!Q})},N.render()))};G.renderFlowItemTooltips=function(N){const {messages:S,_exitRelatedRecordsActions:Q,_featureSelectionActions:W}=this,V=L.isDarkTheme(),T=W.get(N);return[K.tsx("calcite-tooltip",{class:this.classes({[v.CSS.calciteThemeDark]:!V,[v.CSS.calciteThemeLight]:V}),key:`exit-related-records-tooltip-${N.viewModel.uid}`,
label:S?.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:Q.get(N),placement:"top"},S?.exitRelatedRecords),T?K.tsx("calcite-tooltip",{class:this.classes({[v.CSS.calciteThemeDark]:!V,[v.CSS.calciteThemeLight]:V}),key:`select-related-record-tooltip-${N.viewModel.uid}`,label:S?.selectFeature,overlayPositioning:"fixed",referenceElement:T,placement:"top"},S?.selectFeature):null]};G.renderActionsMenuButton=function(){const {actionsMenuId:N,actionsMenuButtonId:S,actionsMenuOpen:Q,dividedActions:W,
messagesCommon:V}=this,T=Q?V.close:V.open,{menuActions:X}=W;return X.length?K.tsx("div",{key:O("actions-menu-button"),class:this.classes(v.CSS.button,v.CSS.actionsMenuButton),role:"button",id:S,"aria-haspopup":"true","aria-controls":Q?N:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":T,title:T},K.tsx("span",{"aria-hidden":"true",class:v.CSS.iconActionsMenu})):
null};G.renderMenuActions=function(){const {actionsMenuId:N,actionsMenuButtonId:S,actionsMenuOpen:Q,dividedActions:W}=this,{menuActions:V}=W;return V.length&&Q?K.tsx("ul",{id:N,role:"menu","aria-labelledby":S,key:O("actions"),class:v.CSS.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},V.toArray().map(T=>this.renderAction({action:T,type:"menu-item"}))):null};G.renderInlineActions=function(){const {inlineActions:N}=
this.dividedActions;return N.length?N.toArray().map(S=>this.renderAction({action:S,type:"inline"})):[]};G.renderInlineActionsContainer=function(){const {inlineActions:N,menuActions:S}=this.dividedActions,Q=!!N.length,W=!!S.length;return Q||W?K.tsx("div",{key:"inline-actions-container","data-inline-actions":Q.toString(),"data-menu-actions":W.toString(),class:v.CSS.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};G.renderNavigation=function(){return this.featureNavigationVisible?
K.tsx("section",{key:O("navigation"),class:this.classes(v.CSS.navigation)},this.renderNavigationButtons()):null};G.renderFooter=function(){const {featureNavigationVisible:N,dividedActions:S}=this,{inlineActions:Q,menuActions:W}=S,V=!!Q.length,T={[v.CSS.footerHasPagination]:N,[v.CSS.footerHasActions]:V,[v.CSS.footerHasActionsMenu]:!!W.length};return N||V?K.tsx("div",{key:O("feature-buttons"),class:this.classes(v.CSS.footer,T)},this.renderInlineActionsContainer(),this.renderNavigation()):null};G.renderFeatureMenuContainer=
function(){var {messages:N}=this;const {featureViewModels:S,isLoadingFeature:Q}=this.viewModel;N=R.substitute(N.selectedFeatures,{total:S.length});return K.tsx("section",{key:O("menu"),class:v.CSS.featureMenu},K.tsx("strong",{class:v.CSS.featureMenuHeader},N),K.tsx("nav",{bind:this,class:v.CSS.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:I.storeNode},this.renderFeatureMenu(),K.tsx("div",{class:v.CSS.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),
Q?K.tsx("div",{class:v.CSS.featureMenuLoader},this.renderLoadingIcon()):null))};G.renderPointer=function(){return this.dockEnabled?null:K.tsx("div",{key:O("pointer"),class:v.CSS.pointer,role:"presentation"},K.tsx("div",{class:this.classes(v.CSS.pointerDirection,v.CSS.shadow)}))};G.renderMainContainer=function(){const {dockEnabled:N,currentAlignment:S,currentDockPosition:Q,titleId:W,contentId:V,collapsible:T,hasContent:X,contentCollapsed:Z,visibleElements:Y}=this,{title:aa}=this.viewModel,ia="bottom-left"===
S||"bottom-center"===S||"bottom-right"===S||"top-left"===Q||"top-center"===Q||"top-right"===Q,na="top-left"===S||"top-center"===S||"top-right"===S||"bottom-left"===Q||"bottom-center"===Q||"bottom-right"===Q;return K.tsx("div",{class:this.classes(v.CSS.main,v.CSS.widget,{[v.CSS.shadow]:N,[v.CSS.isCollapsible]:T,[v.CSS.isCollapsed]:Z}),tabIndex:Y.closeButton?void 0:-1,role:"dialog","aria-labelledby":aa?W:"","aria-describedby":X&&!Z?V:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},ia?this.renderFooter():null,ia?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),na?this.renderFooter():null,na?this.renderFeatureMenuContainer():null)};G.renderContent=function(){const N=this.viewModel?.content;return N?"string"===typeof N?K.tsx("div",{class:B.CSS.contentNode,key:N,innerHTML:N}):this.renderNodeContent(N):null};G.renderActionText=function(N){return K.tsx("span",{key:"text",class:v.CSS.actionText},N)};
G.renderActionIcon=function(N){const S=this._getActionClass(N),Q=this._getActionImage(N),W={[v.CSS.iconLoading]:N.active,[v.CSS.rotating]:N.active,[v.CSS.icon]:!!S,[v.CSS.actionImage]:!N.active&&!!Q};S&&(W[S]=!N.active);return K.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(v.CSS.icon,W),styles:this._getIconStyles(Q)})};G.renderAction=function(N){const {action:S,type:Q}=N;N=this._getActionTitle(S);const W={[v.CSS.action]:"toggle"!==S.type,[v.CSS.actionToggle]:"toggle"===S.type,[v.CSS.actionToggleOn]:"toggle"===
S.type&&S.value,[v.CSS.buttonDisabled]:S.disabled},V=[this.renderActionIcon(S),this.renderActionText(N)];N="menu-item"===Q?K.tsx("li",{key:S.uid,role:"menuitem",tabIndex:0,title:N,"aria-label":N,class:this.classes(v.CSS.button,W),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":S.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},V):K.tsx("div",{key:S.uid,role:"button",tabIndex:0,title:N,"aria-label":N,class:this.classes(v.CSS.button,W),onkeyup:this._handleActionMenuItemKeyup,
bind:this,"data-action-uid":S.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},V);return S.visible?N:null};G.renderFeatureMenuItem=function(N,S){const {messages:Q,messagesCommon:W}=this,{selectedFeatureIndex:V,selectedFeatureViewModel:T}=this.viewModel;var X=N===T;const Z={[v.CSS.featureMenuSelected]:X};X=X?K.tsx("span",{key:O(`feature-menu-selected-feature-${V}`),title:Q.selectedFeature,"aria-label":Q.selectedFeature,class:v.CSS.iconCheckMark}):null;N=K.tsx("span",{innerHTML:N.title||
W.untitled});return K.tsx("li",{role:"menuitem",tabIndex:-1,key:O(`feature-menu-feature-${V}`),class:this.classes(Z,v.CSS.featureMenuItem),bind:this,"data-feature-index":S,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},K.tsx("span",{class:v.CSS.featureMenuTitle},N,X))};G.renderFeatureMenu=function(){const {featureMenuId:N}=
this,{featureViewModels:S}=this.viewModel;return 1<S.length?K.tsx("ol",{class:v.CSS.featureMenuList,id:N,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},S.filter(Q=>!!Q.graphic).map((Q,W)=>this.renderFeatureMenuItem(Q,W))):null};G._storeFeatureSelectionAction=function(N,S){this._featureSelectionActions.set(N,S);this.scheduleRender()};G._storeExitRelatedRecordsAction=function(N,S){this._exitRelatedRecordsActions.set(N,
S);this.scheduleRender()};G._getFlowItemDescription=function(N){return"featureCountDescription"in N?N.featureCountDescription:N.viewModel.description??""};G._openRelatedFeature=async function(N){await N.viewModel.updateGeometry();N=N.graphic;var S=N?.geometry;g.isNone(S)||g.isNone(N)||(this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:S}),S=z.getPointFromGeometry(S),this.open({features:[N],location:g.isSome(S)?S:void 0}))};G._destroyFlowItemWidgets=function(){this._flowItems.removeAll().forEach(N=>
{"showAllEnabled"in N.viewModel&&(N.viewModel.showAllEnabled=!1);N.viewModel=null;N.destroy()})};G._handleBackClick=function(){const N=this._flowItems.pop();N&&(this._exitRelatedRecordsActions.delete(N),this._featureSelectionActions.delete(N),"showAllEnabled"in N.viewModel&&(N.viewModel.showAllEnabled=!1),N&&(N.viewModel=null,N.destroy()))};G._getActionTitle=function(N){const {messages:S,selectedFeature:Q,messagesCommon:W}=this,{id:V}=N,T=Q?.attributes,X=N.title??"";return(N="zoom-to-feature"===V?
R.substitute(X,{messages:S}):"remove-selected-feature"===V?R.substitute(X,{messages:W}):"zoom-to-clustered-features"===V?R.substitute(X,{messages:S}):"browse-clustered-features"===V?R.substitute(X,{messages:S}):N.title)&&T?R.substitute(N,T):N??""};G._getActionClass=function(N){var {selectedFeature:S}=this;S=S?.attributes;const {className:Q,image:W}=N;return(N=W||Q?Q:v.CSS.iconDefaultAction)&&S?R.substitute(N,S):N??""};G._getActionImage=function(N){var {selectedFeature:S}=this;S=S?.attributes;({image:N}=
N);return N&&S?R.substitute(N,S):N??""};G._createFeatureUpdatedAnimation=function(){return I.cssTransition("enter",v.CSS.hasFeatureUpdated)};G._getInlineActionCount=function(){const {maxInlineActions:N,featureNavigationVisible:S}=this;if("number"!==typeof N)return null;const Q=Math.round(N);return Math.max(S?Q-1:Q,0)};G._watchActions=function(){const {allActions:N}=this.viewModel;this.notifyChange("dividedActions");this._handles.remove("actions");N&&N.forEach(S=>{this._handles.add(f.watch(()=>[S.uid,
S.active,S.className,S.disabled,S.id,S.title,S.image,S.visible],()=>this.scheduleRender()),"actions")})};G._divideActions=function(){var {allActions:N}=this.viewModel;N=N.filter(V=>V.visible);const S=this._getInlineActionCount(),Q=null===S,W=0===S;return{inlineActions:Q?N.slice(0):W?new n:N.slice(0,S),menuActions:Q?new n:W?N.slice(0):N.slice(S)}};G._featureMenuOpenChanged=function(N){N?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};G._actionsMenuOpenChanged=function(N){N?this._focusFirstAction=
!0:this._focusActionsMenuButton=!0};G._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:N,messagesCommon:S}=this;N&&(this.viewModel.title="error"===N.viewModel?.state?S.errorMessage:N.viewModel?.title||"")};G._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:N}=this;N&&(this.viewModel.content=N)};G._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};
G._featureMenuIntersectionObserverCreated=function(N){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(N);this._featureMenuIntersectionObserverNode=N};G._handleFeatureMenuKeyup=function(N){"Escape"===x.eventKey(N)&&(N.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};G._handleActionMenuKeyup=function(N){"Escape"===x.eventKey(N)&&(N.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};
G._setActiveFeature=function(N){const {viewModel:S}=this;S.activeFeature=S.features[N.currentTarget["data-feature-index"]]||null};G._removeActiveFeature=function(){this.viewModel.activeFeature=null};G._handleFeatureMenuItemKeyup=function(N){const S=x.eventKey(N);var {_featureMenuNode:Q}=this;const W=N.currentTarget["data-feature-index"];if(Q){Q=Q.querySelectorAll("li");var V=Q.length;"ArrowUp"===S?(N.stopPropagation(),Q[(W-1+V)%V].focus()):"ArrowDown"===S?(N.stopPropagation(),Q[(W+1+V)%V].focus()):
"Home"===S?(N.stopPropagation(),Q[0].focus()):"End"===S&&(N.stopPropagation(),Q[Q.length-1].focus())}};G._handleActionMenuItemKeyup=function(N){const S=x.eventKey(N);var {_actionsMenuNode:Q}=this;const W=N.currentTarget.dataset.actionUid;var {menuActions:V}=this.dividedActions;V=V.findIndex(X=>X.uid===W);if(Q){Q=Q.querySelectorAll("li");var T=Q.length;"ArrowUp"===S?(N.stopPropagation(),Q[(V-1+T)%T].focus()):"ArrowDown"===S?(N.stopPropagation(),Q[(V+1+T)%T].focus()):"Home"===S?(N.stopPropagation(),
Q[0].focus()):"End"===S&&(N.stopPropagation(),Q[Q.length-1].focus())}};G._handleMainKeyup=function(N){const S=x.eventKey(N);"ArrowLeft"===S&&(N.stopPropagation(),this.previous());"ArrowRight"===S&&(N.stopPropagation(),this.next())};G._spinnerEnabledChange=function(N){this._destroySpinner();N&&(N=this.get("viewModel.view"),this._createSpinner(N))};G._hideSpinner=function(){const {_spinner:N}=this;N&&(N.location=null,N.hide())};G._displaySpinner=function(){const {_spinner:N}=this;if(N){var {location:S,
waitingForResult:Q}=this.viewModel;Q&&S?N.show({location:S}):N.hide()}};G._getIconStyles=function(N){return{"background-image":N?`url(${N})`:""}};G._shouldFocus=async function(N){N?.shouldFocus&&(await f.whenOnce(()=>!0===this.viewModel?.active),this.focus())};G._addSelectedFeatureIndexHandle=function(){const N=f.watch(()=>this.viewModel?.selectedFeatureIndex,(S,Q)=>this._selectedFeatureIndexUpdated(S,Q));this._handles.add(N,"selected-index")};G._selectedFeatureIndexUpdated=function(N,S){const {featureCount:Q}=
this;Q&&N!==S&&-1!==N&&(this._destroyFlowItemWidgets(),this.featureMenuOpen=this.actionsMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))};G._destroySelectedFeatureWidget=function(){const {_feature:N}=this;N&&(N.viewModel=null,N&&!N.destroyed&&N.destroy());this._feature=null};G._isScreenLocationWithinView=function(N,S){return-1<N.x&&-1<N.y&&N.x<=S.width&&N.y<=S.height};G._isOutsideView=function(N){const {popupHeight:S,
popupWidth:Q,screenLocation:W,side:V,view:T}=N;if(isNaN(Q)||isNaN(S)||!T||!W)return!1;N=T.padding;return"right"===V&&W.x+Q/2>T.width-N.right||"left"===V&&W.x-Q/2<N.left||"top"===V&&W.y-S<N.top||"bottom"===V&&W.y+S>T.height-N.bottom?!0:!1};G._calculateAutoAlignment=function(N){if("auto"!==N)return N;const {_pointerOffsetInPx:S,_containerNode:Q,_mainContainerNode:W,viewModel:V}=this,{screenLocation:T,view:X}=V;if(g.isNone(T)||!X||!Q)return"top-center";if(!this._isScreenLocationWithinView(T,X))return this._get("currentAlignment")||
"top-center";var Z=(N=W?window.getComputedStyle(W,null):null)?parseInt(N.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,Y=N?parseInt(N.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:aa,width:ia}=Q.getBoundingClientRect();N=ia+S;const na=Math.max(aa,Z,Y)+S;Z=this._isOutsideView({popupHeight:na,popupWidth:N,screenLocation:T,side:"right",view:X});Y=this._isOutsideView({popupHeight:na,popupWidth:N,screenLocation:T,side:"left",view:X});const ba=this._isOutsideView({popupHeight:na,
popupWidth:N,screenLocation:T,side:"top",view:X});N=this._isOutsideView({popupHeight:na,popupWidth:N,screenLocation:T,side:"bottom",view:X});return Y?ba?"bottom-right":"top-right":Z?ba?"bottom-left":"top-left":ba?N?"top-center":"bottom-center":"top-center"};G._callCurrentAlignment=function(N){return"function"===typeof N?N.call(this):N};G._getCurrentAlignment=function(){const {alignment:N,dockEnabled:S}=this;return S||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(N)))};
G._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};G._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};G._calculatePositionResult=function(N){const S=["left","right"];I.isRTL(this.container)&&S.reverse();return N.replace(/leading/gi,S[0]).replace(/trailing/gi,S[1])};G._callDockPosition=function(N){return"function"===typeof N?N.call(this):N};G._getDockPosition=function(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))};
G._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};G._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};G._calculateAutoDockPosition=function(N){if("auto"!==N)return N;var S=this.viewModel?.view;N=I.isRTL(this.container)?"top-left":"top-right";if(!S)return N;var Q=S.padding||{left:0,right:0,top:0,bottom:0};Q=S.width-Q.left-Q.right;({breakpoints:S}=S);return S&&Q<=S.xsmall?"bottom-center":N};G._positionContainer=
function(N=this._containerNode){N&&(this._containerNode=N);if(this._containerNode){({screenLocation:N}=this.viewModel);var {width:S}=this._containerNode.getBoundingClientRect();(N=this._calculatePositionStyle(N,S))&&Object.assign(this._containerNode.style,N)}};G._calculateFullWidth=function(N){const {currentAlignment:S,_pointerOffsetInPx:Q}=this;return"top-left"===S||"bottom-left"===S||"top-right"===S||"bottom-right"===S?N+Q:N};G._calculateAlignmentPosition=function(N,S,Q,W){const {currentAlignment:V,
_pointerOffsetInPx:T}=this;if(Q){var {padding:X}=Q;W/=2;var Z=Q.height-S;Q=Q.width-N;if("bottom-center"===V)return{top:S+T-X.top,left:N-W-X.left};if("top-left"===V)return{bottom:Z+T-X.bottom,right:Q+T-X.right};if("bottom-left"===V)return{top:S+T-X.top,right:Q+T-X.right};if("top-right"===V)return{bottom:Z+T-X.bottom,left:N+T-X.left};if("bottom-right"===V)return{top:S+T-X.top,left:N+T-X.left};if("top-center"===V)return{bottom:Z+T-X.bottom,left:N-W-X.left}}};G._calculatePositionStyle=function(N,S){const {dockEnabled:Q,
view:W}=this;if(W){if(Q)return{left:"",top:"",right:"",bottom:""};if(!g.isNone(N)&&S&&(S=this._calculateFullWidth(S),N=this._calculateAlignmentPosition(N.x,N.y,W,S)))return{top:void 0!==N.top?`${N.top}px`:"auto",left:void 0!==N.left?`${N.left}px`:"auto",bottom:void 0!==N.bottom?`${N.bottom}px`:"auto",right:void 0!==N.right?`${N.right}px`:"auto"}}};G._viewChange=function(N,S){N&&S&&(this.close(),this.clear())};G._viewReadyChange=function(N,S){N?(N=this.get("viewModel.view"),this._wireUpView(N)):S&&
(this.close(),this.clear())};G._wireUpView=function(N){this._destroySpinner();if(N){var {spinnerEnabled:S}=this;S&&this._createSpinner(N);this._setDockEnabledForViewSize(this.dockOptions)}};G._dockingThresholdCrossed=function(N,S,Q){const [W,V]=N,[T,X]=S,{width:Z=0,height:Y=0}=Q??{};return W<=Z&&T>Z||W>Z&&T<=Z||V<=Y&&X>Y||V>Y&&X<=Y};G._updateDockEnabledForViewSize=function(N,S){if(N&&S){var Q=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},W=Q.left+Q.right,V=Q.top+Q.bottom;Q=[];
var T=[];Q[0]=N[0]-W;Q[1]=N[1]-V;T[0]=S[0]-W;T[1]=S[1]-V;({dockOptions:N}=this);this._dockingThresholdCrossed(Q,T,N.breakpoint)&&this._setDockEnabledForViewSize(N);this._setCurrentDockPosition()}};G._focusDockButtonNode=function(N){this._focusDockButton&&(this._focusDockButton=!1,N.focus())};G._closeButtonNodeUpdated=function(N){this._focusClose?(this._focusClose=!1,N.focus()):this._blurClose&&(this._blurClose=!1,N.blur())};G._mainContainerNodeUpdated=function(N){this._mainContainerNode=N;this._focusContainer?
(this._focusContainer=!1,N.focus()):this._blurContainer&&(this._blurContainer=!1,N.blur())};G._featureMenuNodeUpdated=function(N){(this._featureMenuNode=N)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,N=N.querySelectorAll("li"),N.length&&N[0].focus())};G._actionsMenuNodeUpdated=function(N){(this._actionsMenuNode=N)&&this._focusFirstAction&&(this._focusFirstAction=!1,N=N.querySelectorAll("li"),N.length&&N[0].focus())};G._focusFeatureMenuButtonNode=function(N){this._focusFeatureMenuButton&&
(this._focusFeatureMenuButton=!1,N.focus())};G._focusActionsMenuButtonNode=function(N){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,N.focus())};G._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)};G._toggleScreenLocationEnabled=function(){const {dockEnabled:N,viewModel:S}=this;S&&(S.screenLocationEnabled=S.active&&!N)};G._shouldDockAtCurrentViewSize=function(N){N=N.breakpoint;var S=this.viewModel?.view?.ui;if(!S)return!1;
const {width:Q,height:W}=S;if(isNaN(Q)||isNaN(W)||!N)return!1;S=N.hasOwnProperty("width")&&Q<=(N.width??0);N=N.hasOwnProperty("height")&&W<=(N.height??0);return S||N};G._setDockEnabledForViewSize=function(N){N.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(N))};G._getPageText=function(N,S){return this.featureNavigationVisible?R.substitute(this.messages.pageText,{index:S+1,total:N}):null};G._destroySpinner=function(){const {_spinner:N,view:S}=this;N&&(S&&S.ui&&S.ui.remove(N,"popup-spinner"),
N.destroy(),this._spinner=null)};G._createSpinner=function(N){N&&(this._spinner=new q({view:N}),N.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};G._toggleCollapsed=function(){this.collapsed=!this.collapsed};G._close=function(){this.close();this.view&&this.view.focus()};G._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};G._toggleFeatureMenu=function(){const N=!this.featureMenuOpen;this._featureMenuOpenChanged(N);this.actionsMenuOpen=
!1;this.featureMenuOpen=N};G._toggleActionsMenu=function(){const N=!this.actionsMenuOpen;this._actionsMenuOpenChanged(N);this.featureMenuOpen=!1;this.actionsMenuOpen=N};G._triggerAction=function(N){const S=N.currentTarget.dataset.actionUid;var {allActions:Q}=this.viewModel;N=Q.findIndex(W=>W.uid===S);(Q=Q.getItemAt(N))&&"toggle"===Q.type&&(Q.value=!Q.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(N)};G._selectFeature=function(N){N=N.currentTarget["data-feature-index"];isNaN(N)||(this.viewModel.selectedFeatureIndex=
N);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};G._next=function(){this.next()};G._previous=function(){this.previous()};b._createClass(P,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},
{key:"hasContent",get:function(){const {selectedFeatureWidget:N,viewModel:S}=this;if(!N)return!!S?.content;var Q=N.viewModel;if(Q?.waitingForContent||"error"===Q?.state)return!0;Q=Q?.content;return Array.isArray(Q)?!!Q.length:!!Q}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&null!=this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",
get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"_activeFlowItemWidget",get:function(){const {_flowItems:N}=this;return N.getItemAt(N.length-1)||null}},{key:"actions",get:function(){return this.viewModel.actions},set:function(N){this.viewModel.actions=N}},{key:"actionsMenuOpen",get:function(){return this.viewModel.active?
this._get("actionsMenuOpen"):!1},set:function(N){this._set("actionsMenuOpen",!!N)}},{key:"autoCloseEnabled",get:function(){return this.viewModel.autoCloseEnabled},set:function(N){this.viewModel.autoCloseEnabled=N}},{key:"autoOpenEnabled",get:function(){return this.viewModel.autoOpenEnabled},set:function(N){this.viewModel.autoOpenEnabled=N}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(N){this.viewModel.defaultPopupTemplateEnabled=
N}},{key:"content",get:function(){return this.viewModel.content},set:function(N){this.viewModel.content=N}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||J},set:function(N){var S={...J};const Q=this.viewModel?.view?.breakpoints;var W={};Q&&(W.width=Q.xsmall,W.height=Q.xsmall);N={...S,...N};S={...S.breakpoint,...W};({breakpoint:W}=
N);"object"===typeof W?N.breakpoint={...S,...W}:W&&(N.breakpoint=S);this._set("dockOptions",N);this._setCurrentDockPosition();this.reposition()}},{key:"featureCount",get:function(){return this.viewModel.featureCount}},{key:"features",get:function(){return this.viewModel.features},set:function(N){this.viewModel.features=N}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(N){this.viewModel.goToOverride=N}},{key:"highlightEnabled",get:function(){return this.viewModel.highlightEnabled},
set:function(N){this.viewModel.highlightEnabled=N}},{key:"location",get:function(){return this.viewModel.location},set:function(N){this.viewModel.location=N}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(N){this._overrideIfSome("label",N)}},{key:"promises",get:function(){return this.viewModel.promises},set:function(N){this.viewModel.promises=N}},{key:"selectedFeature",get:function(){return this.viewModel.selectedFeature}},{key:"selectedFeatureIndex",get:function(){return this.viewModel.selectedFeatureIndex},
set:function(N){this.viewModel.selectedFeatureIndex=N}},{key:"selectedFeatureWidget",get:function(){const {_feature:N,visibleElements:S,headingLevel:Q,_flowItems:W}=this,{selectedFeatureViewModel:V}=this.viewModel,T={...S,title:!1};if(!V)return null;N?(N.viewModel=V,N.visibleElements=T):this._feature=new r({flowItems:W,headingLevel:Q+1,viewModel:V,visibleElements:T});return this._feature}},{key:"title",get:function(){return this.viewModel.title},set:function(N){this.viewModel.title=N}},{key:"updateLocationEnabled",
get:function(){return this.viewModel.updateLocationEnabled},set:function(N){this.viewModel.updateLocationEnabled=N}},{key:"view",get:function(){return this.viewModel.view},set:function(N){this.viewModel.view=N}},{key:"visible",get:function(){return this.viewModel.visible},set:function(N){this.viewModel.visible=N}}]);return P}(D.FeatureContentMixin(y));c.__decorate([e.property({readOnly:!0})],w.prototype,"actionsMenuId",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"actionsMenuButtonId",
null);c.__decorate([e.property({readOnly:!0})],w.prototype,"featureMenuId",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"titleId",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"contentId",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"hasContent",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"featureNavigationVisible",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"collapsible",null);c.__decorate([e.property({readOnly:!0})],w.prototype,
"featureMenuVisible",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"contentCollapsed",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"dividedActions",null);c.__decorate([e.property({readOnly:!0,dependsOn:["_flowItems.length"]})],w.prototype,"_activeFlowItemWidget",null);c.__decorate([e.property()],w.prototype,"actions",null);c.__decorate([e.property()],w.prototype,"actionsMenuOpen",null);c.__decorate([e.property()],w.prototype,"alignment",void 0);c.__decorate([e.property()],
w.prototype,"autoCloseEnabled",null);c.__decorate([e.property()],w.prototype,"autoOpenEnabled",null);c.__decorate([e.property()],w.prototype,"defaultPopupTemplateEnabled",null);c.__decorate([e.property()],w.prototype,"content",null);c.__decorate([e.property()],w.prototype,"collapsed",void 0);c.__decorate([e.property()],w.prototype,"collapseEnabled",void 0);c.__decorate([e.property({readOnly:!0})],w.prototype,"currentAlignment",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"currentDockPosition",
null);c.__decorate([e.property()],w.prototype,"dockOptions",null);c.__decorate([e.property()],w.prototype,"dockEnabled",void 0);c.__decorate([e.property({readOnly:!0})],w.prototype,"featureCount",null);c.__decorate([e.property()],w.prototype,"featureMenuOpen",void 0);c.__decorate([e.property()],w.prototype,"features",null);c.__decorate([e.property()],w.prototype,"goToOverride",null);c.__decorate([e.property()],w.prototype,"headingLevel",void 0);c.__decorate([e.property()],w.prototype,"highlightEnabled",
null);c.__decorate([e.property()],w.prototype,"location",null);c.__decorate([e.property()],w.prototype,"label",null);c.__decorate([e.property()],w.prototype,"maxInlineActions",void 0);c.__decorate([e.property(),F.messageBundle("esri/widgets/Popup/t9n/Popup")],w.prototype,"messages",void 0);c.__decorate([e.property(),F.messageBundle("esri/t9n/common")],w.prototype,"messagesCommon",void 0);c.__decorate([e.property()],w.prototype,"promises",null);c.__decorate([e.property({readOnly:!0})],w.prototype,
"selectedFeature",null);c.__decorate([e.property()],w.prototype,"selectedFeatureIndex",null);c.__decorate([e.property({readOnly:!0})],w.prototype,"selectedFeatureWidget",null);c.__decorate([e.property()],w.prototype,"spinnerEnabled",void 0);c.__decorate([e.property()],w.prototype,"title",null);c.__decorate([e.property()],w.prototype,"updateLocationEnabled",null);c.__decorate([e.property()],w.prototype,"view",null);c.__decorate([e.property({type:A}),H.vmEvent(["triggerAction","trigger-action"])],w.prototype,
"viewModel",void 0);c.__decorate([e.property()],w.prototype,"visible",null);c.__decorate([e.property()],w.prototype,"visibleElements",void 0);c.__decorate([k.cast("visibleElements")],w.prototype,"castVisibleElements",null);c.__decorate([E.accessibleHandler()],w.prototype,"_close",null);c.__decorate([E.accessibleHandler()],w.prototype,"_toggleDockEnabled",null);c.__decorate([E.accessibleHandler()],w.prototype,"_toggleFeatureMenu",null);c.__decorate([E.accessibleHandler()],w.prototype,"_toggleActionsMenu",
null);c.__decorate([E.accessibleHandler()],w.prototype,"_triggerAction",null);c.__decorate([E.accessibleHandler()],w.prototype,"_selectFeature",null);c.__decorate([E.accessibleHandler()],w.prototype,"_next",null);c.__decorate([E.accessibleHandler()],w.prototype,"_previous",null);return w=c.__decorate([h.subclass("esri.widgets.Popup")],w)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(b,c,w,n){let x=null,m=1E3;"number"===typeof c?(m=c,n=w):(x=c??null,m=w);let l=
0,g;const f=()=>{l=0;b.apply(n,g)};c=(...d)=>{x&&x.apply(n,d);g=d;m?l||(l=setTimeout(f,m)):f()};c.remove=()=>{l&&(clearTimeout(l),l=0)};c.forceUpdate=()=>{l&&(clearTimeout(l),f())};c.hasPendingUpdates=()=>!!l;return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureRelationship ./Feature/FeatureViewModel ./Feature/resources ./Feature/support/FeatureContentMixin ./support/componentsUtils ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){var E;const F={title:!0,content:!0,lastEditedInfo:!0};w=E=function(H){function K(L,R){L=I.call(this,L,R);L._contentWidgets=[];L.flowItems=null;L.headingLevel=2;L.messages=null;L.messagesCommon=null;L.messagesURIUtils=null;L.visibleElements={...F};L.viewModel=new q;return L}b._inherits(K,H);var I=b._createSuper(K);H=K.prototype;H.initialize=function(){this.addHandles(n.watch(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),
n.initial))};H.loadDependencies=function(){return D.loadCalciteComponents({notice:()=>new Promise((L,R)=>a(["../chunks/calcite-notice"],L,R))})};H.destroy=function(){this._destroyContentWidgets()};H.castVisibleElements=function(L){return{...F,...L}};H.render=function(){var {state:L}=this.viewModel;L=t.tsx("div",{class:y.CSS.container,key:"container"},this.renderTitle(),"error"===L?this.renderError():"loading"===L?this.renderLoading():this.renderContentContainer());return t.tsx("div",{class:this.classes(y.CSS.base,
y.CSS.esriWidget)},L)};H.setActiveMedia=function(L,R){return this.viewModel.setActiveMedia(L,R)};H.nextMedia=function(L){return this.viewModel.nextMedia(L)};H.previousMedia=function(L){return this.viewModel.previousMedia(L)};H.renderError=function(){const {messagesCommon:L,messages:R,visibleElements:O}=this;return t.tsx("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},O.title?t.tsx("div",{key:"error-title",slot:"title"},L.errorMessage):null,t.tsx("div",{key:"error-message",
slot:"message"},R.loadingError))};H.renderLoading=function(){return t.tsx("div",{key:"loading-container",class:y.CSS.loadingSpinnerContainer},t.tsx("span",{class:this.classes(y.CSS.iconLoading,y.CSS.spinner)}))};H.renderContentContainer=function(){const {visibleElements:L}=this;return L.content?t.tsx("div",{class:y.CSS.main},[this.renderContent(),this.renderLastEditInfo()]):null};H.renderTitle=function(){const {visibleElements:L,title:R}=this;return L.title?t.tsx(z.Heading,{level:this.headingLevel,
class:y.CSS.title,innerHTML:R}):null};H.renderContent=function(){var L=this.viewModel.content;return L?Array.isArray(L)?L.length?t.tsx("div",{class:y.CSS.contentNode,key:"content-content-elements"},L.map(this.renderContentElement,this)):null:"string"===typeof L?(L=this._contentWidgets[0],!L||L.destroyed?null:t.tsx("div",{class:y.CSS.contentNode,key:"content-content"},L.render())):this.renderNodeContent(L):null};H.renderContentElement=function(L,R){const {visibleElements:O}=this;if("boolean"!==typeof O.content&&
!O.content?.[L.type])return null;switch(L.type){case "attachments":return this.renderAttachments(R);case "custom":return this.renderCustom(L,R);case "fields":return this.renderFields(R);case "media":return this.renderMedia(R);case "text":return this.renderText(L,R);case "expression":return this.renderExpression(R);case "relationship":return this.renderRelationship(R);default:return null}};H.renderAttachments=function(L){const R=this._contentWidgets[L];if(!R||R.destroyed)return null;const {state:O,
attachmentInfos:J}=R.viewModel;return"loading"===O||0<J.length?t.tsx("div",{key:this._buildKey("attachments-element",L),class:this.classes(y.CSS.contentElement)},R.render()):null};H.renderRelationship=function(L){const R=this._contentWidgets[L];return R&&!R.destroyed&&this.flowItems?t.tsx("div",{key:this._buildKey("relationship-element",L),class:y.CSS.contentElement},R.render()):null};H.renderExpression=function(L){const R=this._contentWidgets[L];return!R||R.destroyed?null:t.tsx("div",{key:this._buildKey("expression-element",
L),class:y.CSS.contentElement},R.render())};H.renderCustom=function(L,R){({creator:L}=L);const O=this._contentWidgets[R];return!O||O.destroyed?null:L?t.tsx("div",{key:this._buildKey("custom-element",R),class:y.CSS.contentElement},O.render()):null};H.renderFields=function(L){const R=this._contentWidgets[L];return!R||R.destroyed?null:t.tsx("div",{key:this._buildKey("fields-element",L),class:y.CSS.contentElement},R.render())};H.renderMedia=function(L){const R=this._contentWidgets[L];return!R||R.destroyed?
null:t.tsx("div",{key:this._buildKey("media-element",L),class:y.CSS.contentElement},R.render())};H.renderLastEditInfo=function(){const {visibleElements:L,messages:R}=this;var {lastEditInfo:O}=this.viewModel;if(!O||!L.lastEditedInfo)return null;const {date:J,user:M}=O;O=C.substitute("edit"===O.type?M?R.lastEditedByUser:R.lastEdited:M?R.lastCreatedByUser:R.lastCreated,{date:J,user:M});return t.tsx("div",{key:"edit-info-element",class:this.classes(y.CSS.lastEditedInfo,y.CSS.contentElement)},O)};H.renderText=
function(L,R){const O=this._contentWidgets[R];return!O||O.destroyed?null:L.text?t.tsx("div",{key:this._buildKey("text-element",R),class:this.classes(y.CSS.contentElement,y.CSS.text)},O.render()):null};H._buildKey=function(L,...R){const O=this.get("viewModel.graphic.uid")||"0";R=R.join("-");return`${L}__${O}-${R}`};H._destroyContentWidget=function(L){L&&(L.viewModel=null,!L.destroyed&&L.destroy())};H._destroyContentWidgets=function(){this.removeHandles("relationship-handles");this._contentWidgets.forEach(L=>
this._destroyContentWidget(L));this._contentWidgets=[]};H._addFeatureRelationshipHandles=function(L){const {flowItems:R,visibleElements:O}=this;this.addHandles([n.on(()=>L,"select-record",({featureViewModel:J})=>{R&&(J.abilities={relationshipContent:!0},R.push(new E({flowItems:R,viewModel:J,visibleElements:O})))}),n.on(()=>L,"show-all-records",()=>{if(R){var {viewModel:J}=L;J.showAllEnabled=!0;J=new r({visibleElements:{title:!1,description:!1},viewModel:J});this._addFeatureRelationshipHandles(J);
R.push(J)}})],"relationship-handles")};H._setupContentWidgets=function(){this._destroyContentWidgets();const {headingLevel:L,visibleElements:R}=this;var O=this.get("viewModel.content");const {contentViewModels:J}=this.viewModel;Array.isArray(O)?O.forEach((M,G)=>{"attachments"===M.type&&(this._contentWidgets[G]=new e({displayType:M.displayType,headingLevel:R.title?L+1:L,viewModel:J[G]}));"fields"===M.type&&(this._contentWidgets[G]=new p({viewModel:J[G]}));"media"===M.type&&(this._contentWidgets[G]=
new h({viewModel:J[G]}));"text"===M.type&&(this._contentWidgets[G]=new k({viewModel:J[G]}));"custom"===M.type&&(this._contentWidgets[G]=new k({viewModel:J[G]}));"expression"===M.type&&(this._contentWidgets[G]=new u({viewModel:J[G]}));"relationship"===M.type&&(M=new r({viewModel:J[G]}),this._addFeatureRelationshipHandles(M),this._contentWidgets[G]=M)},this):(O=J[0])&&!O.destroyed&&(this._contentWidgets[0]=new k({viewModel:O}));this.scheduleRender()};b._createClass(K,[{key:"graphic",get:function(){return this.viewModel.graphic},
set:function(L){this.viewModel.graphic=L}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(L){this.viewModel.defaultPopupTemplateEnabled=L}},{key:"isTable",get:function(){return this.viewModel.isTable}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(L){this._overrideIfSome("label",L)}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(L){this.viewModel.spatialReference=
L}},{key:"title",get:function(){return this.viewModel.title}},{key:"map",get:function(){return this.viewModel.map},set:function(L){this.viewModel.map=L}},{key:"view",get:function(){return this.viewModel.view},set:function(L){this.viewModel.view=L}}]);return K}(B.FeatureContentMixin(d));c.__decorate([x.property()],w.prototype,"graphic",null);c.__decorate([x.property()],w.prototype,"defaultPopupTemplateEnabled",null);c.__decorate([x.property()],w.prototype,"flowItems",void 0);c.__decorate([x.property()],
w.prototype,"headingLevel",void 0);c.__decorate([x.property({readOnly:!0})],w.prototype,"isTable",null);c.__decorate([x.property()],w.prototype,"label",null);c.__decorate([x.property(),A.messageBundle("esri/widgets/Feature/t9n/Feature")],w.prototype,"messages",void 0);c.__decorate([x.property(),A.messageBundle("esri/t9n/common")],w.prototype,"messagesCommon",void 0);c.__decorate([x.property(),A.messageBundle("esri/widgets/support/t9n/uriUtils")],w.prototype,"messagesURIUtils",void 0);c.__decorate([x.property()],
w.prototype,"spatialReference",null);c.__decorate([x.property({readOnly:!0})],w.prototype,"title",null);c.__decorate([x.property()],w.prototype,"visibleElements",void 0);c.__decorate([m.cast("visibleElements")],w.prototype,"castVisibleElements",null);c.__decorate([x.property()],w.prototype,"map",null);c.__decorate([x.property()],w.prototype,"view",null);c.__decorate([x.property({type:q})],w.prototype,"viewModel",void 0);return w=E=c.__decorate([f.subclass("esri.widgets.Feature")],w)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){n=function(p){function h(q,y){q=r.call(this,q,y);q._featureElementInfo=null;q.attachmentsWidget=new g;q.headingLevel=2;q.viewModel=new d;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.initialize=function(){this._featureElementInfo=new e;this.addHandles([c.watch(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),c.initial),c.watch(()=>this.viewModel,q=>this.attachmentsWidget.viewModel=
q,c.initial)])};p.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo?.destroy()};p.render=function(){const {attachmentsWidget:q}=this;return u.tsx("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),q?.render())};p._setupFeatureElementInfo=function(){const {description:q,title:y,headingLevel:B}=this;this._featureElementInfo?.set({description:q,title:y,headingLevel:B})};a._createClass(h,[{key:"description",get:function(){return this.viewModel.description},
set:function(q){this.viewModel.description=q}},{key:"displayType",get:function(){return this.attachmentsWidget.displayType},set:function(q){this.attachmentsWidget.displayType=q}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(q){this.viewModel.graphic=q}},{key:"title",get:function(){return this.viewModel.title},set:function(q){this.viewModel.title=q}}]);return h}(f);b.__decorate([w.property({readOnly:!0})],n.prototype,"attachmentsWidget",void 0);b.__decorate([w.property()],
n.prototype,"description",null);b.__decorate([w.property()],n.prototype,"displayType",null);b.__decorate([w.property()],n.prototype,"graphic",null);b.__decorate([w.property()],n.prototype,"headingLevel",void 0);b.__decorate([w.property()],n.prototype,"title",null);b.__decorate([w.property({type:d})],n.prototype,"viewModel",void 0);return n=b.__decorate([l.subclass("esri.widgets.Feature.FeatureAttachments")],n)})},"esri/widgets/Attachments":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/maybe ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/componentsUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){const B={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},D=window.CSS;f=function(z){function v(t,C){t=A.call(this,t,C);t.displayType="auto";t.messages=null;t.messagesUnits=null;t.selectedFile=null;t.submitting=!1;t.viewModel=null;t.visibleElements={...B};t._supportsImageOrientation=D&&D.supports&&D.supports("image-orientation","from-image");t._addAttachmentForm=
null;t._updateAttachmentForm=null;return t}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.initialize=function(){this.viewModel||(this.viewModel=new u);this.addHandles([x.on(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),x.on(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),x.watch(()=>this.viewModel?.mode,()=>this._modeChanged(),x.initial)])};z.loadDependencies=function(){return h.loadCalciteComponents({icon:()=>new Promise((t,C)=>a(["../chunks/calcite-icon"],
t,C))})};z.castVisibleElements=function(t){return{...B,...t}};z.addAttachment=function(){const {_addAttachmentForm:t,viewModel:C}=this;this._set("submitting",!0);this._set("error",null);return C.addAttachment(t).then(E=>{this._set("submitting",!1);this._set("error",null);C.mode="view";return E}).catch(E=>{this._set("submitting",!1);this._set("error",new w("attachments:add-attachment",this.messages.addErrorMessage,E));throw E;})};z.deleteAttachment=function(t){const {viewModel:C}=this;this._set("submitting",
!0);this._set("error",null);return C.deleteAttachment(t).then(E=>{this._set("submitting",!1);this._set("error",null);C.mode="view";return E}).catch(E=>{this._set("submitting",!1);this._set("error",new w("attachments:delete-attachment",this.messages.deleteErrorMessage,E));throw E;})};z.updateAttachment=function(){const {viewModel:t}=this,{_updateAttachmentForm:C}=this;this._set("submitting",!0);this._set("error",null);return t.updateAttachment(C).then(E=>{this._set("submitting",!1);this._set("error",
null);t.mode="view";return E}).catch(E=>{this._set("submitting",!1);this._set("error",new w("attachments:update-attachment",this.messages.updateErrorMessage,E));throw E;})};z.addFile=function(){const t=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);this.viewModel.mode="view";return t};z.updateFile=function(){const {viewModel:t}=this,C=t.updateFile(this.selectedFile,this._updateAttachmentForm,t.activeFileInfo);t.mode="view";return C};z.deleteFile=function(t){t=this.viewModel.deleteFile(t||
this.viewModel.activeFileInfo?.file);this.viewModel.mode="view";return t};z.render=function(){const {submitting:t,viewModel:C}=this,{state:E}=C;return y.tsx("div",{class:this.classes("esri-attachments","esri-widget")},t?this.renderProgressBar():null,"loading"===E?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};z.renderErrorMessage=function(){const {error:t,visibleElements:C}=this;return t&&C.errorMessage?y.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},
t.message):null};z.renderAttachments=function(){const {activeFileInfo:t,mode:C,activeAttachmentInfo:E}=this.viewModel;return"add"===C?this.renderAddForm():"edit"===C?this.renderDetailsForm(E||t):this.renderAttachmentContainer()};z.renderLoading=function(){return y.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},y.tsx("div",{class:"esri-attachments__loader"}))};z.renderProgressBar=function(){return this.visibleElements.progressBar?y.tsx("div",{class:"esri-attachments__progress-bar",
key:"progress-bar"}):null};z.renderAddForm=function(){const {submitting:t,selectedFile:C}=this;var E=t||!C,F=this.visibleElements.cancelAddButton?y.tsx("button",{type:"button",bind:this,disabled:t,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",t&&"esri-button--disabled")},this.messages.cancel):null;E=this.visibleElements.addSubmitButton?y.tsx("button",{type:"submit",disabled:E,class:this.classes("esri-button","esri-button--secondary",
"esri-button--small","esri-button--half",{["esri-button--disabled"]:E})},this.messages.add):null;const H=C?y.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},C.name):null;F=y.tsx("form",{bind:this,afterCreate:r.storeNode,afterRemoved:r.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},y.tsx("fieldset",{class:"esri-attachments__file-fieldset"},H,y.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},
C?this.messages.changeFile:this.messages.selectFile,y.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),E,F);return y.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},F)};z.renderDetailsForm=function(t){const {visibleElements:C,viewModel:E,selectedFile:F,submitting:H}=this;var {abilities:K}=E,I=H||!F;let L;if(F){var R=F.type;L=F.name;var O=F.size}else if(t&&"file"in t)R=t.file.type,L=t.file.name,
O=t.file.size;else if(t&&"contentType"in t){R=t.contentType;L=t.name;O=t.size;var J=t.url}var M=K.editing&&K.operations?.delete&&C.deleteButton?y.tsx("button",{key:"delete-button",type:"button",disabled:H,bind:this,onclick:P=>this._submitDeleteAttachment(P,t),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{["esri-button--disabled"]:H})},this.messages.delete):void 0;I=K.editing&&K.operations?.update&&C.updateButton?y.tsx("button",{disabled:I,
key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:I})},this.messages.update):void 0;const G=this.visibleElements.cancelUpdateButton?y.tsx("button",{disabled:H,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:H})},this.messages.cancel):void 0;K=K.editing&&K.operations?.update?
y.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},y.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},L),y.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,y.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0;O=y.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},y.tsx("label",
null,m.formatFileSize(this.messagesUnits,O??0)));R=y.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},y.tsx("label",null,R));J=n.isSome(J)?y.tsx("a",{class:"esri-attachments__item-link",href:J,rel:"noreferrer",target:"_blank"},this.renderImageMask(t,400),y.tsx("div",{class:"esri-attachments__item-link-overlay"},y.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},y.tsx("calcite-icon",{icon:"launch"})))):this.renderImageMask(t,400);M=y.tsx("form",{bind:this,
afterCreate:r.storeNode,afterRemoved:r.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:P=>this._submitUpdateAttachment(P,t)},y.tsx("div",{class:"esri-attachments__metadata"},O,R),K,y.tsx("div",{class:"esri-attachments__actions"},M,G,I));return y.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},J,M)};z.renderImageMask=function(t,C){return t?"file"in t?this.renderGenericImageMask(t.file.name,t.file.type):this.renderImageMaskForAttachment(t,C):null};z.renderGenericImageMask=
function(t,C){var {supportsResizeAttachments:E}=this.viewModel;C=p.getIconPath(C);E={["esri-attachments__image--resizable"]:E};return y.tsx("div",{class:this.classes("esri-attachments__item-mask--icon","esri-attachments__item-mask")},y.tsx("img",{title:t,alt:t,src:C,class:this.classes(E,"esri-attachments__image")}))};z.renderImageMaskForAttachment=function(t,C){var {supportsResizeAttachments:E}=this.viewModel;if(!t)return null;const {contentType:F,name:H,url:K}=t;if(!E||!p.isSupportedImage(F))return this.renderGenericImageMask(H,
F);t=(t=this._getCSSTransform(t))?{transform:t,"image-orientation":"none"}:{};C=`${K}${K?.includes("?")?"\x26":"?"}w=${C}`;E={["esri-attachments__image--resizable"]:E};return y.tsx("div",{class:this.classes("esri-attachments__item-mask")},y.tsx("img",{styles:t,alt:H,title:H,src:C,class:this.classes(E,"esri-attachments__image")}))};z.renderFile=function(t){const {file:C}=t;return y.tsx("li",{class:"esri-attachments__item",key:C},y.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",
title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(t),type:"button"},this.renderImageMask(t),y.tsx("label",{class:"esri-attachments__label"},y.tsx("span",{class:"esri-attachments__filename"},C.name||this.messages.noTitle),y.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",r.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}))))};z.renderAttachmentInfo=function({attachmentInfo:t,displayType:C}){const {viewModel:E,
effectiveDisplayType:F}=this,{abilities:H,supportsResizeAttachments:K}=E,{contentType:I,name:L,url:R}=t;C=this.renderImageMask(t,"list"===C?48:400);var O=H.editing?y.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",r.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;O="preview"===F&&K&&p.isSupportedImage(I)?null:y.tsx("label",{class:"esri-attachments__label"},y.tsx("span",{class:"esri-attachments__filename"},L||this.messages.noTitle),O);C=[C,
O];C=H.editing?y.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":t.id,onclick:()=>this._startEditAttachment(t),type:"button"},C):y.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:R??void 0,target:"_blank"},C);return y.tsx("li",{class:"esri-attachments__item",key:t},C)};z.renderAttachmentContainer=function(){const {effectiveDisplayType:t,
viewModel:C,visibleElements:E}=this,{attachmentInfos:F,abilities:H,fileInfos:K}=C;var I=!!F?.length;const L=!!K?.length,R={["esri-attachments__container--list"]:"preview"!==t,["esri-attachments__container--preview"]:"preview"===t},O=H.editing&&H.operations?.add&&E.addButton?y.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},y.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon",
"esri-icon-plus")}),this.messages.add):void 0,J=I?y.tsx("ul",{key:"attachments-list",class:"esri-attachments__items"},F.toArray().map(G=>this.renderAttachmentInfo({attachmentInfo:G,displayType:t}))):void 0,M=L?y.tsx("ul",{key:"file-list",class:"esri-attachments__items"},K.toArray().map(G=>this.renderFile(G))):void 0;I=L||I?void 0:y.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return y.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",
R)},J,M,I,O)};z._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};z._handleFileInputChange=function(t){t=(t=t.target)&&t.files&&t.files.item(0);this._set("selectedFile",t)};z._submitDeleteAttachment=function(t,C){t.preventDefault();C&&("file"in C?this.deleteFile(C.file):C&&this.deleteAttachment(C))};z._submitAddAttachment=function(t){t.preventDefault();this.viewModel.filesEnabled?this.addFile():this.addAttachment()};z._submitUpdateAttachment=function(t,C){t.preventDefault();
C&&"file"in C?this.updateFile():this.updateAttachment()};z._startEditAttachment=function(t){const {viewModel:C}=this;C.activeFileInfo=null;C.activeAttachmentInfo=t;C.mode="edit"};z._startEditFile=function(t){const {viewModel:C}=this;C.activeAttachmentInfo=null;C.activeFileInfo=t;C.mode="edit"};z._startAddAttachment=function(){this.viewModel.mode="add"};z._cancelForm=function(t){t.preventDefault();this.viewModel.mode="view"};z._getCSSTransform=function(t){({orientationInfo:t}=t);return!this._supportsImageOrientation&&
t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""};b._createClass(v,[{key:"abilities",get:function(){return this.viewModel.abilities},set:function(t){this.viewModel.abilities=t}},{key:"effectiveDisplayType",get:function(){const {displayType:t}=this;return t&&"auto"!==t?t:this.viewModel.supportsResizeAttachments?"preview":"list"}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(t){this.viewModel.graphic=t}},{key:"label",get:function(){return this.messages?.widgetLabel??
""},set:function(t){this._overrideIfSome("label",t)}}]);return v}(k);c.__decorate([l.property()],f.prototype,"abilities",null);c.__decorate([l.property()],f.prototype,"displayType",void 0);c.__decorate([l.property({readOnly:!0})],f.prototype,"effectiveDisplayType",null);c.__decorate([l.property()],f.prototype,"graphic",null);c.__decorate([l.property()],f.prototype,"label",null);c.__decorate([l.property(),q.messageBundle("esri/widgets/Attachments/t9n/Attachments")],f.prototype,"messages",void 0);c.__decorate([l.property(),
q.messageBundle("esri/core/t9n/Units")],f.prototype,"messagesUnits",void 0);c.__decorate([l.property({readOnly:!0})],f.prototype,"selectedFile",void 0);c.__decorate([l.property({readOnly:!0})],f.prototype,"submitting",void 0);c.__decorate([l.property({readOnly:!0})],f.prototype,"error",void 0);c.__decorate([l.property({type:u})],f.prototype,"viewModel",void 0);c.__decorate([l.property()],f.prototype,"visibleElements",void 0);c.__decorate([g.cast("visibleElements")],f.prototype,"castVisibleElements",
null);return f=c.__decorate([e.subclass("esri.widgets.Attachments")],f)})},"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./Cyclical ./mathUtils ./maybe ./string ./unitUtils ../intl/number".split(" "),function(a,b,c,w,n,x,m,l){function g(p,h,r){return p.units[h][r]}function f(p,h,r,q=2,y="abbr"){return`${l.formatNumber(h,{minimumFractionDigits:q,maximumFractionDigits:q,signDisplay:0<h?"never":"exceptZero"})} ${g(p,r,y)}`}function d(p,h,r,q=2,y="abbr"){return`${l.formatNumber(h,
{minimumFractionDigits:q,maximumFractionDigits:q,signDisplay:"exceptZero"})} ${g(p,r,y)}`}function e(p,h){const r=JSON.stringify(h);let q=k.get(r);q||(q=new Intl.NumberFormat("en-US",h),k.set(r,q));return/\-?\+?360/.test(q.format(p))?0:p}const k=new Map,u=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(p,h,r,q,y){y=n.unwrapOr(y,2);var B=c.cyclicalDegrees,D=B.normalize;a:if(p=m.convertUnit(p,h,"degrees"),r===q)r=p;else{switch(q){case "arithmetic":r=-p+90;break a;case "geographic":r=-p-90;break a}r=
void 0}B=D.call(B,r,0,!0);y={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:y,minimumFractionDigits:y,signDisplay:0<B?"never":"exceptZero"};B=e(B,y);return l.formatNumber(B,y)};a.formatDMS=function(p,h,r=2){p=m.convertUnit(p,h,"degrees");h=p-Math.floor(p);p-=h;h*=60;let q=h-Math.floor(h);h-=q;q*=60;return`${p.toFixed()}\u00b0 ${h.toFixed()}' ${q.toFixed(r)}"`};a.formatDecimal=f;a.formatFileSize=function(p,h){let r=0===h?0:Math.floor(Math.log(h)/Math.log(b.ByteSizeUnit.KILOBYTES));
r=w.clamp(r,0,u.length-1);h=l.formatNumber(h/b.ByteSizeUnit.KILOBYTES**r,{maximumFractionDigits:2});return x.replace(p.units.bytes[u[r]],{fileSize:h})};a.formatImperialArea=function(p,h,r,q=2,y="abbr"){const B=m.preferredImperialAreaUnit(h,r);return f(p,m.convertUnit(h,r,B),B,q,y)};a.formatImperialLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredImperialLengthUnit(h,r);return f(p,m.convertUnit(h,r,B),B,q,y)};a.formatImperialRelativeLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredImperialLengthUnit(h,
r);return d(p,m.convertUnit(h,r,B),B,q,y)};a.formatImperialRelativeVerticalLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredImperialVerticalLengthUnit(h,r);return d(p,m.convertUnit(h,r,B),B,q,y)};a.formatImperialVerticalLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredImperialVerticalLengthUnit(h,r);return f(p,m.convertUnit(h,r,B),B,q,y)};a.formatMetricArea=function(p,h,r,q=2,y="abbr"){const B=m.preferredMetricAreaUnit(h,r);return f(p,m.convertUnit(h,r,B),B,q,y)};a.formatMetricLength=
function(p,h,r,q=2,y="abbr"){const B=m.preferredMetricLengthUnit(h,r);return f(p,m.convertUnit(h,r,B),B,q,y)};a.formatMetricRelativeLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredMetricLengthUnit(h,r);return d(p,m.convertUnit(h,r,B),B,q,y)};a.formatMetricRelativeVerticalLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredMetricVerticalLengthUnit(h,r);return d(p,m.convertUnit(h,r,B),B,q,y)};a.formatMetricVerticalLength=function(p,h,r,q=2,y="abbr"){const B=m.preferredMetricVerticalLengthUnit(h,
r);return f(p,m.convertUnit(h,r,B),B,q,y)};a.formatRelativeAngleDegrees=function(p,h,r,q,y){r!==q&&(p=-p);y=n.unwrapOr(y,2);r={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:y,minimumFractionDigits:y,signDisplay:"exceptZero"};p=m.convertUnit(p,h,"degrees")%360;p=e(p,r);return l.formatNumber(p,r)};a.formatRelativeDecimal=d;a.unitName=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Collection ../../core/Error ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){const r={editing:!1,operations:{add:!0,update:!0,delete:!0}},q=n.ofType(u);w=function(y){function B(z){var v=D.call(this,z);v._getAttachmentsPromise=null;v._attachmentLayer=null;v.abilities={...r};v.activeAttachmentInfo=null;v.activeFileInfo=null;v.attachmentInfos=new q;v.fileInfos=new n;v.graphic=null;v.mode="view";v.filesEnabled=!1;v.addHandles(l.watch(()=>v.graphic,()=>v._graphicChanged(),l.initial));return v}a._inherits(B,y);var D=a._createSuper(B);y=
B.prototype;y.destroy=function(){this.graphic=this._attachmentLayer=null};y.castAbilities=function(z){return{...r,...z}};y.getAttachments=async function(){const {_attachmentLayer:z,attachmentInfos:v}=this;if(!z||"function"!==typeof z.queryAttachments)throw new x("invalid-layer","getAttachments(): A valid layer is required.");const A=this._getObjectId();var t=new p({objectIds:[A],returnMetadata:!0});const C=[];this._getAttachmentsPromise=t=z.queryAttachments(t).then(E=>E[A]||C).catch(()=>C);this.notifyChange("state");
t=await t;v.removeAll();t.length&&v.addMany(t);this._getAttachmentsPromise=null;this.notifyChange("state");return t};y.addAttachment=async function(z,v=this.graphic){const {_attachmentLayer:A,attachmentInfos:t,abilities:C}=this;if(!v)throw new x("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:v});if(!z)throw new x("invalid-attachment","addAttachment(): An attachment is required.",{attachment:z});if(!C.operations?.add)throw new x("invalid-abilities","addAttachment(): add abilities are required.");
if(!A||"function"!==typeof A.addAttachment)throw new x("invalid-layer","addAttachment(): A valid layer is required.");z=await A.addAttachment(v,z).then(E=>this._queryAttachment(E.objectId,v));t.add(z);return z};y.deleteAttachment=async function(z){const {_attachmentLayer:v,attachmentInfos:A,graphic:t,abilities:C}=this;if(!z)throw new x("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:z});if(!C.operations?.delete)throw new x("invalid-abilities","deleteAttachment(): delete abilities are required.");
if(!v||"function"!==typeof v.deleteAttachments)throw new x("invalid-layer","deleteAttachment(): A valid layer is required.");if(!t)throw new x("invalid-graphic","deleteAttachment(): A graphic is required.");const E=await v.deleteAttachments(t,[z.id]).then(()=>z);A.remove(E);return E};y.updateAttachment=async function(z,v=this.activeAttachmentInfo){const {_attachmentLayer:A,attachmentInfos:t,graphic:C,abilities:E}=this;if(!z)throw new x("invalid-attachment","updateAttachment(): An attachment is required.",
{attachment:z});if(!v)throw new x("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:v});if(!E.operations?.update)throw new x("invalid-abilities","updateAttachment(): Update abilities are required.");const F=t.findIndex(H=>H===v);if(!A||"function"!==typeof A.updateAttachment)throw new x("invalid-layer","updateAttachment(): A valid layer is required.");if(!C)throw new x("invalid-graphic","updateAttachment(): A graphic is required.");z=await A.updateAttachment(C,
v.id,z).then(H=>this._queryAttachment(H.objectId));t.splice(F,1,z);return z};y.commitFiles=async function(){await Promise.all(this.fileInfos.items.map(z=>this.addAttachment(z.form)));this.fileInfos.removeAll();return this.getAttachments()};y.addFile=function(z,v){if(!z||!v)return null;z={file:z,form:v};this.fileInfos.add(z);return z};y.updateFile=function(z,v,A=this.activeFileInfo){if(!z||!v||!A)return null;const t=this.fileInfos.findIndex(C=>A===C);-1<t&&this.fileInfos.splice(t,1,{file:z,form:v});
return this.fileInfos.items[t]};y.deleteFile=function(z){const v=this.fileInfos.find(A=>A.file===z);return v?(this.fileInfos.remove(v),v):null};y._queryAttachment=async function(z,v){const {_attachmentLayer:A}=this;if(!z||!A?.queryAttachments)throw new x("invalid-attachment-id","Could not query attachment.");const t=this._getObjectId(v);z=new p({objectIds:[t],attachmentsWhere:`AttachmentId=${z}`,returnMetadata:!0});return A.queryAttachments(z).then(C=>C[t][0])};y._getObjectId=function(z=this.graphic){return z?.getObjectId()??
null};y._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};y._setAttachmentLayer=function(){var {graphic:z}=this;this._attachmentLayer=(z=h.getSourceLayer(z))?"scene"===z.type&&m.isSome(z.associatedLayer)?z.associatedLayer:z:null};a._createClass(B,[{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){var {graphic:z}=this;if(!z)return!1;z=z.layer||
z.sourceLayer;return z?.loaded&&"capabilities"in z&&z.capabilities&&"operations"in z.capabilities&&"supportsResizeAttachments"in z.capabilities.operations&&z.capabilities.operations.supportsResizeAttachments||!1}}]);return B}(w);b.__decorate([g.property()],w.prototype,"abilities",void 0);b.__decorate([f.cast("abilities")],w.prototype,"castAbilities",null);b.__decorate([g.property()],w.prototype,"activeAttachmentInfo",void 0);b.__decorate([g.property()],w.prototype,"activeFileInfo",void 0);b.__decorate([g.property({readOnly:!0,
type:q})],w.prototype,"attachmentInfos",void 0);b.__decorate([g.property()],w.prototype,"fileInfos",void 0);b.__decorate([g.property({type:c})],w.prototype,"graphic",void 0);b.__decorate([g.property()],w.prototype,"mode",void 0);b.__decorate([g.property({readOnly:!0})],w.prototype,"state",null);b.__decorate([g.property()],w.prototype,"filesEnabled",void 0);b.__decorate([g.property({readOnly:!0})],w.prototype,"supportsResizeAttachments",null);return w=b.__decorate([k.subclass("esri.widgets.Attachments.AttachmentsViewModel")],
w)})},"esri/rest/query/support/AttachmentInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/exifUtils".split(" "),function(a,b,c,w,n,x,m,l,g){var f;const d={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,
rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};c=f=function(e){function k(p){p=u.call(this,p);p.contentType=null;p.exifInfo=null;p.id=null;p.globalId=null;p.keywords=null;p.name=null;p.parentGlobalId=null;p.parentObjectId=null;p.size=null;p.url=null;return p}a._inherits(k,e);var u=a._createSuper(k);k.prototype.clone=function(){return new f({contentType:this.contentType,
exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})};a._createClass(k,[{key:"orientationInfo",get:function(){var {exifInfo:p}=this;p=g.getExifValue({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:p});return d[p]||null}}]);return k}(c.JSONSupport);b.__decorate([w.property({type:String})],c.prototype,"contentType",void 0);b.__decorate([w.property()],c.prototype,
"exifInfo",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"orientationInfo",null);b.__decorate([w.property({type:n.Integer})],c.prototype,"id",void 0);b.__decorate([w.property({type:String})],c.prototype,"globalId",void 0);b.__decorate([w.property({type:String})],c.prototype,"keywords",void 0);b.__decorate([w.property({type:String})],c.prototype,"name",void 0);b.__decorate([w.property({json:{read:!1}})],c.prototype,"parentGlobalId",void 0);b.__decorate([w.property({json:{read:!1}})],
c.prototype,"parentObjectId",void 0);b.__decorate([w.property({type:n.Integer})],c.prototype,"size",void 0);b.__decorate([w.property({json:{read:!1}})],c.prototype,"url",void 0);return c=f=b.__decorate([l.subclass("esri.layers.support.AttachmentInfo")],c)})},"esri/layers/support/exifUtils":function(){define(["exports"],function(a){function b(c){const {tagName:w,tags:n}=c;return n&&w?(c=n.find(x=>x.name===w))&&c.value||null:null}a.getExifValue=function(c){const {exifInfo:w,exifName:n,tagName:x}=c;
return w&&n&&x?(c=w.find(m=>m.name===n))?b({tagName:x,tags:c.tags}):null:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),function(a,b,c,w,n,
x,m,l,g,f,d){function e(T){return T?G.test(T):!1}function k(T,X){if(!e(X)||!T)return null;const Z=X.replace(G,"").toLowerCase();let Y=null;T.some(aa=>aa.name.toLowerCase()===Z?(Y=aa,!0):!1);return Y}function u(T,X){return(X=p(X,T))?X.name:T}function p(T,X){return T&&"function"===typeof T.getField&&X?T.getField(X)??null:null}function h({formattedAttributes:T,template:X,fieldInfoMap:Z}){return`${n.replace(n.replace(X,Y=>{const aa=Z.get(Y.toLowerCase());return`{${aa&&aa.fieldName||Y}}`}),T).replace(O,
"")}`.trim()}function r(T,X,Z=!1){const Y=X[T];"string"===typeof Y&&(Z=(Z?encodeURIComponent(Y):Y).replace(M,"%27"),X[T]=Z)}function q(T,X=!1){const Z={...T};Object.keys(Z).forEach(Y=>r(Y,Z,X));return Z}function y(T,X){return T.replace(J,(Z,Y,aa)=>(Z=p(X,aa))?`{${Z.name}}`:Y)}function B(T,X,Z){return(T=y(T,Z))?T.replace(N,(Y,aa,ia)=>{aa=`${aa||ia}`.trim();return n.replace(Y,q(X,aa&&"{"!==aa[0]||!1))}):T}function D(T,X){var Z=X.fieldName,Y=z(X.fieldInfos,Z)?.clone();const aa=X.preventPlacesFormatting;
X=X.layer;var ia=p(X,Z);Y&&"date"===ia?.type&&(ia=Y.format||new f,ia.dateFormat=ia.dateFormat||"short-date-short-time",ia.dateTimeFormatOptions=!X?.layer&&"feature"===X?.type&&X.datesInUnknownTimezone||X?.layer&&"map-image"===X.layer?.type&&X.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,Y.format=ia);Y=Y&&Y.format;if("string"===typeof T&&l.isRasterPixelValueField(Z)&&Y)return Y.formatRasterPixelValue(T);"string"!==typeof T||!Y||null!=Y.dateFormat||null==Y.places&&null==Y.digitSeparator||(Z=Number(T),
isNaN(Z)||(T=Z));return"string"===typeof T||null==T||null==Y?t(T):aa?m.formatNumber(T,{...m.convertNumberFormatToIntlOptions(Y),minimumFractionDigits:0,maximumFractionDigits:20}):Y.format(T)}function z(T,X){if(T&&T.length&&X){var Z=X.toLowerCase(),Y=void 0;T.some(aa=>aa.fieldName&&aa.fieldName.toLowerCase()===Z?(Y=aa,!0):!1);return Y}}function v({fieldName:T,graphic:X,layer:Z}){if(H(T)||!Z||"function"!==typeof Z.getFeatureType)return null;const {typeIdField:Y}=Z;return Y&&T===Y?(T=Z.getFeatureType(X))?
T.name:null:null}function A({fieldName:T,value:X,graphic:Z,layer:Y}){return H(T)||!Y||"function"!==typeof Y.getFieldDomain?null:(T=Z&&Y.getFieldDomain(T,{feature:Z}))&&"coded-value"===T.type?T.getName(X):null}function t(T){return"string"===typeof T?T.replace(P,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):T}function C(T){const {value:X,fieldName:Z,fieldInfos:Y,fieldInfoMap:aa,layer:ia,graphic:na}=T;return null==X?"":(T=A({fieldName:Z,value:X,graphic:na,layer:ia}))||(T=v({fieldName:Z,graphic:na,layer:ia}))?
T:aa.get(Z.toLowerCase())?D(X,{fieldInfos:Y||Array.from(aa.values()),fieldName:Z,layer:ia}):(T=ia&&ia.fieldsIndex)&&T.isDateField(Z)?x.formatDate(X,Q):t(X)}async function E(T,X){const {layer:Z,graphic:Y,outFields:aa,objectIds:ia,returnGeometry:na,spatialReference:ba}=T;T=ia[0];if("number"!==typeof T&&"string"!==typeof T)return R.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:Z,graphic:Y,objectId:T,requiredFields:aa}),null;if(!g.getEffectiveLayerCapabilities(Z)?.operations?.supportsQuery)return R.warn("The specified layer cannot be queried. The following fields will not be available.",
{layer:Z,graphic:Y,requiredFields:aa,returnGeometry:na}),null;T=Z.createQuery();T.objectIds=ia;T.outFields=aa?.length?aa:[Z.objectIdField];T.returnGeometry=!!na;T.returnZ=!!na;T.returnM=!!na;T.outSpatialReference=ba;return(await Z.queryFeatures(T,X)).features[0]}async function F(T){if(!T.expressionInfos?.length)return!1;var X=await d.loadArcade();({arcadeUtils:{hasGeometryFunctions:X}}=X);return X(T)}function H(T=""){return T?T.includes("relationships/"):!1}function K({attributes:T,graphic:X,relatedInfo:Z,
fieldInfos:Y,fieldInfoMap:aa,layer:ia}){T&&X&&Z&&Object.keys(X.attributes).forEach(na=>{var ba=(ba={layerId:Z.relation.id.toString(),fieldName:na},`${"relationships/"}${ba.layerId}/${ba.fieldName}`);T[ba]=C({fieldName:ba,fieldInfos:Y,fieldInfoMap:aa,layer:ia,value:X.attributes[na],graphic:X})})}function I({attributes:T,relatedInfo:X,fieldInfoMap:Z,fieldInfos:Y,layer:aa}){T&&X&&(X.relatedFeatures&&X.relatedFeatures&&X.relatedFeatures.forEach(ia=>K({attributes:T,graphic:ia,relatedInfo:X,fieldInfoMap:Z,
fieldInfos:Y,layer:aa})),X.relatedStatsFeatures&&X.relatedStatsFeatures&&X.relatedStatsFeatures.forEach(ia=>K({attributes:T,graphic:ia,relatedInfo:X,fieldInfoMap:Z,fieldInfos:Y,layer:aa})))}function L(T,X,Z){return T.find(Y=>Y!==X&&"feature"===Y.type&&Y.url===X.url&&Y.layerId===Z.relatedTableId)}const R=c.getLogger("esri.widgets.Feature.support.featureUtils"),O=/href=(""|'')/gi,J=/(\{([^\{\r\n]+)\})/g,M=/'/g,G=/^\s*expression\//i,P=/(\n)/gi,U=/[\u00A0-\u9999<>&]/gim,N=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,
S=/^(?:mailto:|tel:)/,Q=x.convertDateFormatToIntlOptions("short-date-short-time"),W=T=>{if(!T)return!1;T=T.toUpperCase();return T.includes("CURRENT_TIMESTAMP")||T.includes("CURRENT_DATE")||T.includes("CURRENT_TIME")},V=({layer:T,method:X,query:Z,definitionExpression:Y})=>{T.capabilities?.query?.supportsCacheHint&&"attachments"!==X&&(T=w.isSome(Z.where)?Z.where:null,X=w.isSome(Z.geometry)?Z.geometry:null,W(Y)||W(T)||"extent"===X?.type||"tile"===Z.resultType||(Z.cacheHint=!0))};a.applyTextFormattingHTML=
t;a.createfieldInfoMap=function(T,X){const Z=new Map;if(!T)return Z;T.forEach(Y=>{const aa=u(Y.fieldName,X);Y.fieldName=aa;Z.set(aa.toLowerCase(),Y)});return Z};a.findRelatedLayer=function(T,X,Z){return T&&X&&Z?L(T.allLayers,X,Z)||L(T.allTables,X,Z):null};a.fixTokens=y;a.formatAttributes=function({fieldInfos:T,attributes:X,layer:Z,graphic:Y,fieldInfoMap:aa,relatedInfos:ia}){const na={};ia?.forEach(ba=>I({attributes:na,relatedInfo:ba,fieldInfoMap:aa,fieldInfos:T,layer:Z}));X&&Object.keys(X).forEach(ba=>
{na[ba]=C({fieldName:ba,fieldInfos:T,fieldInfoMap:aa,layer:Z,value:X[ba],graphic:Y})});return na};a.formatEditInfo=function(T,X){const {creatorField:Z,creationDateField:Y,editorField:aa,editDateField:ia}=T;if(X){T=X[ia];if("number"===typeof T)return X=X[aa],{type:"edit",date:x.formatDate(T,Q),user:X};T=X[Y];return"number"===typeof T?(X=X[Z],{type:"create",date:x.formatDate(T,Q),user:X}):null}};a.formatValueToFieldInfo=D;a.getAllFieldInfos=function(T){const X=[];if(!T)return X;const {fieldInfos:Z,
content:Y}=T;Z&&X.push(...Z);if(!Y||!Array.isArray(Y))return X;Y.forEach(aa=>{"fields"===aa.type&&(aa=aa&&aa.fieldInfos)&&X.push(...aa)});return X};a.getFieldInfo=z;a.getFieldInfoLabel=function(T,X){return(X=k(X,T?.fieldName))?X.title||null:T?T.label||T.fieldName:null};a.getFixedFieldName=u;a.getFixedFieldNames=function(T,X){return T&&T.map(Z=>u(Z,X))};a.getSourceLayer=function(T){if(!w.isNone(T))return T.get("sourceLayer")||T.get("layer")};a.graphicCallback=async function(T,X){return"function"===
typeof T?T.call(null,X):T};a.htmlEntities=function(T){return T.replace(U,X=>`&#${X.charCodeAt(0)};`)};a.isExpressionField=e;a.isRelatedField=H;a.preLayerQueryCallback=({query:T,layer:X,method:Z})=>{V({layer:X,method:Z,query:T,definitionExpression:`${X.definitionExpression} ${X.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:T,layer:X,method:Z})=>{V({layer:X,method:Z,query:T,definitionExpression:`${X.definitionExpression} ${X.serviceDefinitionExpression}`})};a.querySourceLayer=
E;a.queryUpdatedFeature=async function({graphic:T,popupTemplate:X,layer:Z,spatialReference:Y},aa){if(Z&&X&&("function"===typeof Z.load&&await Z.load(aa),T.attributes)){var ia=T.attributes[Z.objectIdField];if(null!=ia){ia=[ia];var na=await X.getRequiredFields(Z.fieldsIndex),ba=l.featureHasFields(na,T);na=ba?[]:na;X=X.returnGeometry||await F(X);if(!ba||X)if(Z=await E({layer:Z,graphic:T,outFields:na,objectIds:ia,returnGeometry:X,spatialReference:Y},aa))Z.geometry&&(T.geometry=Z.geometry),Z.attributes&&
(T.attributes={...T.attributes,...Z.attributes})}}};a.shouldOpenInNewTab=function(T=""){if(T)return!S.test(T.trim().toLowerCase())};a.substituteAttributes=h;a.substituteFieldsInLinksAndAttributes=function({attributes:T,globalAttributes:X,layer:Z,text:Y,expressionAttributes:aa,fieldInfoMap:ia}){return Y?h({formattedAttributes:X,template:B(Y,{...X,...aa,...T},Z),fieldInfoMap:ia}):""};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports",
"../../../assets"],function(a,b){a.getIconPath=function(c){const w=b.getAssetUrl("esri/themes/base/images/files/");return c?"text/plain"===c?`${w}text-32.svg`:"application/pdf"===c?`${w}pdf-32.svg`:"text/csv"===c?`${w}csv-32.svg`:"application/gpx+xml"===c?`${w}gpx-32.svg`:"application/x-dwf"===c?`${w}cad-32.svg`:"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?`${w}code-32.svg`:"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===
c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?`${w}zip-32.svg`:c.includes("image/")?`${w}image-32.svg`:c.includes("audio/")?`${w}sound-32.svg`:c.includes("video/")?`${w}video-32.svg`:c.includes("msexcel")||c.includes("ms-excel")||c.includes("spreadsheetml")?`${w}excel-32.svg`:c.includes("msword")||c.includes("ms-word")||
c.includes("wordprocessingml")?`${w}word-32.svg`:c.includes("powerpoint")||c.includes("presentationml")?`${w}report-32.svg`:`${w}generic-32.svg`:`${w}generic-32.svg`};a.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,b,c,w,n,x,m,l){w=function(g){function f(e){e=d.call(this,e);e.description=null;e.title=null;return e}a._inherits(f,g);var d=a._createSuper(f);return a._createClass(f)}(l);b.__decorate([c.property()],w.prototype,"description",void 0);b.__decorate([c.property()],w.prototype,"title",void 0);return w=b.__decorate([m.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],w)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){w=function(e){function k(p,h){p=u.call(this,p,h);p.description=null;p.headingLevel=2;p.title=null;return p}a._inherits(k,e);var u=a._createSuper(k);e=k.prototype;e.render=function(){return d.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};e.renderTitle=function(){const {title:p}=this;return p?d.tsx(g.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},p):null};e.renderDescription=function(){const {description:p}=
this;return p?d.tsx("div",{key:"description",class:"esri-feature-element-info__description"},p):null};return a._createClass(k)}(l);b.__decorate([c.property()],w.prototype,"description",void 0);b.__decorate([c.property()],w.prototype,"headingLevel",void 0);b.__decorate([c.property()],w.prototype,"title",void 0);return w=b.__decorate([m.subclass("esri.widgets.Feature.support.FeatureElementInfo")],w)})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./widgetUtils",
"./jsxFactory"],function(a,b,c,w){const n={heading:"esri-widget__heading"};a.CSS=n;a.Heading=function({level:x,class:m,...l},g){x=b.clamp(Math.ceil(x),1,6);return w.tsx(`h${x}`,{...l,class:c.classes(n.heading,m),role:"heading","aria-level":String(x)},g)};a.incrementHeadingLevel=function(x,m=1){return b.clamp(Math.ceil(x+m),1,6)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){w=function(k){function u(h,r){h=p.call(this,h,r);h.viewModel=null;h._addTargetToAnchors=q=>{Array.from(q.querySelectorAll("a")).forEach(y=>{f.shouldOpenInNewTab(y.href)&&!y.hasAttribute("target")&&y.setAttribute("target","_blank")})};return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.renderLoading=function(){return e.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},e.tsx("div",{class:"esri-feature-content__loader"}))};k.renderCreated=
function(){const h=this.viewModel?.created;return h?h instanceof HTMLElement?e.tsx("div",{key:h,bind:h,afterCreate:this._attachToNode}):d.isWidget(h)?e.tsx("div",{key:h},!h.destroyed&&h.render()):e.tsx("div",{key:h,innerHTML:h,afterCreate:this._addTargetToAnchors}):null};k.render=function(){return e.tsx("div",{class:"esri-feature-content"},"loading"===this.viewModel?.state?this.renderLoading():this.renderCreated())};k._attachToNode=function(h){h.appendChild(this)};a._createClass(u,[{key:"creator",
get:function(){return this.viewModel?.creator},set:function(h){this.viewModel&&(this.viewModel.creator=h)}},{key:"graphic",get:function(){return this.viewModel?.graphic},set:function(h){this.viewModel&&(this.viewModel.graphic=h)}}]);return u}(l);b.__decorate([c.property()],w.prototype,"creator",null);b.__decorate([c.property()],w.prototype,"graphic",null);b.__decorate([c.property({type:g})],w.prototype,"viewModel",void 0);return w=b.__decorate([m.subclass("esri.widgets.Feature.FeatureContent")],w)})},
"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e){w=function(k){function u(h){var r=
p.call(this,h);r._loadingPromise=null;r.created=null;r.creator=null;r.destroyer=null;r.graphic=null;r.handles.add(x.watch(()=>r.creator,q=>{r._destroyContent();r._createContent(q)},x.initial));return r}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.destroy=function(){this._destroyContent()};k._destroyContent=function(){const {created:h,graphic:r,destroyer:q}=this;h&&r&&(e.graphicCallback(q,{graphic:r}).catch(()=>null),this._set("created",null))};k._createContent=async function(h){var r=
this.graphic;r&&h&&(this._loadingPromise=h=e.graphicCallback(h,{graphic:r}).catch(()=>null),this.notifyChange("state"),r=await h,h===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r)))};a._createClass(u,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return u}(n.HandleOwnerMixin(w));b.__decorate([m.property({readOnly:!0})],w.prototype,"created",void 0);b.__decorate([m.property()],w.prototype,"creator",void 0);b.__decorate([m.property()],
w.prototype,"destroyer",void 0);b.__decorate([m.property({type:c})],w.prototype,"graphic",void 0);b.__decorate([m.property({readOnly:!0})],w.prototype,"state",null);return w=b.__decorate([d.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],w)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){n=function(h){function r(y,B){y=q.call(this,y,B);y._contentWidget=null;y.viewModel=new k;return y}a._inherits(r,h);var q=a._createSuper(r);h=r.prototype;h.initialize=function(){this.addHandles(c.watch(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),c.initial))};h.destroy=function(){this._destroyContentWidget()};h.renderLoading=function(){return p.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},p.tsx("span",
{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};h.render=function(){const {state:y}=this.viewModel;return p.tsx("div",{class:"esri-feature-expression"},"loading"===y?this.renderLoading():"disabled"===y?null:this._contentWidget?.render())};h._destroyContentWidget=function(){const {_contentWidget:y}=this;y&&(y.viewModel=null,y.destroy());this._contentWidget=null};h._setupExpressionWidget=function(){const {contentElementViewModel:y,contentElement:B}=
this.viewModel,D=B?.type;this._destroyContentWidget();this._contentWidget=y?"fields"===D?new d({viewModel:y}):"media"===D?new e({viewModel:y}):"text"===D?new f({viewModel:y}):null:null;this.scheduleRender()};return a._createClass(r)}(g);b.__decorate([w.property({type:k})],n.prototype,"viewModel",void 0);return n=b.__decorate([l.subclass("esri.widgets.Feature.FeatureExpression")],n)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){n=function(h){function r(y,B){y=q.call(this,y,B);y._featureElementInfo=null;y.viewModel=new f;y.messages=null;y.messagesURIUtils=null;return y}a._inherits(r,h);var q=a._createSuper(r);h=r.prototype;h.initialize=function(){this._featureElementInfo=new d;this.addHandles(c.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),c.initial))};h.destroy=function(){this._featureElementInfo?.destroy()};h.renderFieldInfo=function(y,
B){var {attributes:D}=this.viewModel;const z=y.fieldName,v=y.label||z;D=D?null==D[z]?"":D[z]:"";y=!(!y.format||!y.format.dateFormat);D="number"!==typeof D||y?e.autoLink(this.messagesURIUtils,D):this._forceLTR(D);y={["esri-feature-fields__field-data--date"]:y};return p.tsx("tr",{key:`fields-element-info-row-${z}-${B}`},p.tsx("th",{key:`fields-element-info-row-header-${z}-${B}`,class:"esri-feature-fields__field-header",innerHTML:v}),p.tsx("td",{key:`fields-element-info-row-data-${z}-${B}`,class:this.classes("esri-feature-fields__field-data",
y),innerHTML:D}))};h.renderFields=function(){const {formattedFieldInfos:y}=this.viewModel;return y?.length?p.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},p.tsx("tbody",null,y.map((B,D)=>this.renderFieldInfo(B,D)))):null};h.render=function(){return p.tsx("div",{class:"esri-feature-fields"},this._featureElementInfo?.render(),this.renderFields())};h._setupFeatureElementInfo=function(){const {description:y,title:B}=this;this._featureElementInfo?.set({description:y,title:B})};
h._forceLTR=function(y){return`&lrm;${y}`};a._createClass(r,[{key:"attributes",get:function(){return this.viewModel.attributes},set:function(y){this.viewModel.attributes=y}},{key:"description",get:function(){return this.viewModel.description},set:function(y){this.viewModel.description=y}},{key:"expressionInfos",get:function(){return this.viewModel.expressionInfos},set:function(y){this.viewModel.expressionInfos=y}},{key:"fieldInfos",get:function(){return this.viewModel.fieldInfos},set:function(y){this.viewModel.fieldInfos=
y}},{key:"title",get:function(){return this.viewModel.title},set:function(y){this.viewModel.title=y}}]);return r}(g);b.__decorate([w.property()],n.prototype,"attributes",null);b.__decorate([w.property()],n.prototype,"description",null);b.__decorate([w.property()],n.prototype,"expressionInfos",null);b.__decorate([w.property()],n.prototype,"fieldInfos",null);b.__decorate([w.property()],n.prototype,"title",null);b.__decorate([w.property({type:f,nonNullable:!0})],n.prototype,"viewModel",void 0);b.__decorate([w.property(),
u.messageBundle("esri/widgets/Feature/t9n/Feature")],n.prototype,"messages",void 0);b.__decorate([w.property(),u.messageBundle("esri/widgets/support/t9n/uriUtils")],n.prototype,"messagesURIUtils",void 0);return n=b.__decorate([l.subclass("esri.widgets.Feature.FeatureFields")],n)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){c=function(e){function k(p){p=u.call(this,p);p.attributes=null;p.expressionInfos=null;p.description=null;p.fieldInfos=null;p.title=null;return p}a._inherits(k,e);var u=a._createSuper(k);a._createClass(k,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:p,fieldInfos:h}=this,r=[];h?.forEach(q=>{if(!q.hasOwnProperty("visible")||q.visible)q=q.clone(),q.label=d.getFieldInfoLabel(q,p),r.push(q)});return r}}]);return k}(c);b.__decorate([w.property()],c.prototype,
"attributes",void 0);b.__decorate([w.property({type:[g]})],c.prototype,"expressionInfos",void 0);b.__decorate([w.property()],c.prototype,"description",void 0);b.__decorate([w.property({type:[f]})],c.prototype,"fieldInfos",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"formattedFieldInfos",null);b.__decorate([w.property()],c.prototype,"title",void 0);return c=b.__decorate([l.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],c)})},"esri/widgets/support/uriUtils":function(){define(["exports",
"../../core/string"],function(a,b){function c(n){let x=null;w.some(m=>{m.pattern.test(n)&&(x=m);return!!x});return x}const w=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(n,x){if("string"!==typeof x||!x)return x;const m=c(x);if(!m)return x;const l=x.match(m.pattern);
n=b.replace(b.replace(m.label,{messages:n,hierPart:l&&l[2]}),{appName:m.appName});return x.replace(m.pattern,`<a${m.target?` target="${m.target}"`:""} href="$1"${"_blank"===m.target?' rel\x3d"noreferrer"':""}>${n}</a>`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){x=function(B){function D(v,A){var t=z.call(this,v,A);t._refreshTimer=null;t._refreshIntervalInfo=null;t._featureElementInfo=null;t.viewModel=new e;t.messages=null;t._getChartDependencies=async C=>{const E=await p.loadChartsModule(),{destroyed:F,viewModel:H}=a._assertThisInitialized(t);if(!F&&H&&C){var {activeMediaInfo:K}=H,I=await t._getRendererColors(E);t._renderChart({chartDiv:C,mediaInfo:K,chartsModule:E,colorMap:I})}};return t}a._inherits(D,B);var z=
a._createSuper(D);B=D.prototype;B.initialize=function(){this._featureElementInfo=new k;this.addHandles([w.watch(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),w.initial),w.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),w.initial)])};B.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo?.destroy()};B.render=function(){return q.tsx("div",{bind:this,class:"esri-feature-media",
onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this.renderMedia())};B.renderMedia=function(){const {formattedMediaInfoCount:v}=this.viewModel;return v?q.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};B.renderImageMediaInfo=function(v){var {_refreshIntervalInfo:A}=this;const {activeMediaInfoIndex:t,formattedMediaInfoCount:C}=this.viewModel,{value:E,
refreshInterval:F,altText:H,title:K,type:I}=v,{sourceURL:L,linkURL:R}=E;v=u.shouldOpenInNewTab(R??void 0)?"_blank":"_self";const O="_blank"===v?"noreferrer":"";A=F?A:null;A=q.tsx("img",{alt:H||K,key:`media-${I}-${t}-${C}-${A?A.timestamp:0}`,src:(A?A.sourceURL:L)??void 0});return(R?q.tsx("a",{title:K,href:R,rel:O,target:v},A):null)??A};B.renderChartMediaInfo=function(v){const {activeMediaInfoIndex:A,formattedMediaInfoCount:t}=this.viewModel;return q.tsx("div",{key:`media-${v.type}-${A}-${t}`,bind:this,
class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};B.renderMediaInfoType=function(){const {activeMediaInfo:v}=this.viewModel;return v?"image"===v.type?this.renderImageMediaInfo(v):v.type.includes("chart")?this.renderChartMediaInfo(v):null:null};B.renderMediaInfo=function(){var {activeMediaInfo:v}=this.viewModel;if(!v)return null;const A=v.title?q.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:v.title}):null;v=v.caption?q.tsx("div",{key:"media-caption",
class:"esri-feature-media__item-caption",innerHTML:v.caption}):null;return q.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},q.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),A,v)};B.renderMediaPageButton=function(v){if(2>this.viewModel.formattedMediaInfoCount)return null;const A=(v="previous"===v)?this.messages.previous:this.messages.next,t=v?this.classes("esri-feature-media__button","esri-feature-media__previous"):
this.classes("esri-feature-media__button","esri-feature-media__next"),C=v?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),E=v?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");
return q.tsx("button",{type:"button",key:v?"media-previous":"media-next",title:A,"aria-label":A,tabIndex:0,class:t,bind:this,onclick:v?this._previous:this._next},q.tsx("span",{"aria-hidden":"true",class:C}),q.tsx("span",{"aria-hidden":"true",class:E}))};B._setupFeatureElementInfo=function(){const {description:v,title:A}=this;this._featureElementInfo?.set({description:v,title:A})};B._next=function(){this.viewModel.next()};B._previous=function(){this.viewModel.previous()};B._getRenderer=function(){const {isAggregate:v,
layer:A}=this.viewModel;return v&&A?.featureReduction&&"renderer"in A.featureReduction?A.featureReduction.renderer:A?.renderer};B._getRendererColors=async function(v){const {am4core:A}=v,t=new Map;v=this._getRenderer();if(!v)return t;const C=await f.getColorsFromRenderer(v);C.delete("default");if(!Array.from(C.values()).every(E=>1===E?.length))return t;t.set("default-line-value",A.color({r:50,g:50,b:50,a:1}));Array.from(C.keys()).forEach(E=>{E&&t.set(E,A.color(C.get(E)?.[0].toCss(!0)))});return t};
B._handleMediaKeyup=function(v){const A=c.eventKey(v);"ArrowLeft"===A&&(v.stopPropagation(),this.viewModel.previous());"ArrowRight"===A&&(v.stopPropagation(),this.viewModel.next())};B._renderChart=function(v){const {abilities:A}=this.viewModel,{chartsModule:t,chartDiv:C,mediaInfo:E,colorMap:F}=v,{value:H,type:K}=E,{am4core:I}=t,L=p.getColorSet(I);y.isDarkTheme()&&I.useTheme(t.am4themes_dark);const R=window.matchMedia("(prefers-reduced-motion: reduce)");A.chartAnimation&&!R.matches?I.useTheme(t.am4themes_animated):
I.unuseTheme(t.am4themes_animated);I.useTheme(function(O){O instanceof I.ColorSet&&L&&(O.list=L)});v="pie-chart"===K?this._createPieChart(v):this._createXYChart(v);C.setAttribute("aria-label",E.altText||E.title);v.data=H.series.map(O=>({tooltip:O.tooltip,value:O.value,color:F.get(O.fieldName)})).filter(O=>"pie-chart"===K?null!=O.value&&0<O.value:!0)};B._customizeChartTooltip=function(v,A){v&&(v.label.wrap=!0,v.label.maxWidth=200,v.autoTextColor=!1,v.getFillFromObject=!1,v.label.fill=A.color("#ffffff"),
v.background.fill=A.color({r:0,g:0,b:0,a:.7}))};B._createPieChart=function(v){const {chartDiv:A,chartsModule:t}=v,{am4core:C,am4charts:E}=t;v=C.create(A,E.PieChart);v.rtl=h.isRTL(this.container);const F=v.series.push(new E.PieSeries);F.labels.template.disabled=!0;F.ticks.template.disabled=!0;F.dataFields.value="value";F.dataFields.category="tooltip";this._customizeChartTooltip(F.tooltip,C);F.slices.template.propertyFields.fill="color";F.slices.template.propertyFields.stroke="color";return v};B._getMinSeriesValue=
function(v){let A=0;v.forEach(t=>A=Math.min(t.value,A));return A};B._createColumnChart=function(v,A){const {chartsModule:t,mediaInfo:C}=A;({value:A}=C);const {am4core:E,am4charts:F}=t;var H=v.xAxes.push(new F.CategoryAxis);H.dataFields.category="tooltip";H.renderer.labels.template.disabled=!0;const K=H.tooltip;this._customizeChartTooltip(K,E);K.events.on("sizechanged",()=>{K.dy=-K.contentHeight});H=v.yAxes.push(new F.ValueAxis);const I=H.renderer.labels.template;H.renderer.minLabelPosition=.05;H.renderer.maxLabelPosition=
.95;H.min=this._getMinSeriesValue(A.series);this._customizeChartTooltip(H.tooltip,E);I.wrap=!0;H=v.series.push(new F.ColumnSeries);H.dataFields.valueY="value";H.dataFields.categoryX="tooltip";H.columns.template.propertyFields.fill="color";H.columns.template.propertyFields.stroke="color";v.cursor=new F.XYCursor;15<A.series.length&&(v.scrollbarX=new E.Scrollbar)};B._createBarChart=function(v,A){const {chartsModule:t,mediaInfo:C}=A;({value:A}=C);const {am4core:E,am4charts:F}=t;var H=v.yAxes.push(new F.CategoryAxis);
H.dataFields.category="tooltip";H.renderer.inversed=!0;H.renderer.labels.template.disabled=!0;const K=H.tooltip;this._customizeChartTooltip(K,E);K.events.on("sizechanged",()=>{K.dx=K.contentWidth});H=v.xAxes.push(new F.ValueAxis);const I=H.renderer.labels.template;H.renderer.minLabelPosition=.05;H.renderer.maxLabelPosition=.95;H.min=this._getMinSeriesValue(A.series);this._customizeChartTooltip(H.tooltip,E);I.wrap=!0;H=v.series.push(new F.ColumnSeries);H.dataFields.valueX="value";H.dataFields.categoryY=
"tooltip";H.columns.template.propertyFields.fill="color";H.columns.template.propertyFields.stroke="color";v.cursor=new F.XYCursor;15<A.series.length&&(v.scrollbarY=new E.Scrollbar)};B._createLineChart=function(v,A){const {chartsModule:t,mediaInfo:C,colorMap:E}=A;({value:A}=C);const {am4core:F,am4charts:H}=t;var K=v.xAxes.push(new H.CategoryAxis);K.dataFields.category="tooltip";K.renderer.labels.template.disabled=!0;const I=K.tooltip;this._customizeChartTooltip(I,F);I.events.on("sizechanged",()=>{I.dy=
-I.contentHeight});K=v.yAxes.push(new H.ValueAxis);var L=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(A.series);this._customizeChartTooltip(K.tooltip,F);L.wrap=!0;K=v.series.push(new H.LineSeries);K.dataFields.categoryX="tooltip";K.dataFields.valueY="value";K.strokeWidth=1;if(L=E.get("default-line-value"))K.stroke=L;K=K.bullets.push(new H.CircleBullet);K.propertyFields.fill="color";K.propertyFields.stroke="color";v.cursor=
new H.XYCursor;15<A.series.length&&(v.scrollbarX=new F.Scrollbar)};B._createXYChart=function(v){const {chartDiv:A,chartsModule:t,mediaInfo:C}=v,{type:E}=C,{am4core:F,am4charts:H}=t,K=F.create(A,H.XYChart);K.rtl=h.isRTL(this.container);"column-chart"===E&&this._createColumnChart(K,v);"bar-chart"===E&&this._createBarChart(K,v);"line-chart"===E&&this._createLineChart(K,v);return K};B._clearMediaRefreshTimer=function(){const {_refreshTimer:v}=this;v&&(clearTimeout(v),this._refreshTimer=null)};B._updateMediaInfoTimestamp=
function(v){const A=Date.now();this._refreshIntervalInfo={timestamp:A,sourceURL:v&&this._getImageSource(v,A)};this.scheduleRender()};B._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:v}=this.viewModel;v&&"image"===v.type&&v.refreshInterval&&this._setRefreshTimeout(v)};B._setRefreshTimeout=function(v){const {refreshInterval:A,value:t}=v;A&&(v=6E4*A,this._updateMediaInfoTimestamp(t.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(t.sourceURL)},
v))};B._getImageSource=function(v,A){const t=v.includes("?")?"\x26":"?",[C,E=""]=v.split("#");return`${C}${t}timestamp=${A}${E?"#":""}${E}`};a._createClass(D,[{key:"attributes",get:function(){return this.viewModel.attributes},set:function(v){this.viewModel.attributes=v}},{key:"activeMediaInfoIndex",get:function(){return this.viewModel.activeMediaInfoIndex},set:function(v){this.viewModel.activeMediaInfoIndex=v}},{key:"description",get:function(){return this.viewModel.description},set:function(v){this.viewModel.description=
v}},{key:"fieldInfoMap",get:function(){return this.viewModel.fieldInfoMap},set:function(v){this.viewModel.fieldInfoMap=v}},{key:"layer",get:function(){return this.viewModel.layer},set:function(v){this.viewModel.layer=v}},{key:"mediaInfos",get:function(){return this.viewModel.mediaInfos},set:function(v){this.viewModel.mediaInfos=v}},{key:"popupTemplate",get:function(){return this.viewModel.popupTemplate},set:function(v){this.viewModel.popupTemplate=v}},{key:"relatedInfos",get:function(){return this.viewModel.relatedInfos},
set:function(v){this.viewModel.relatedInfos=v}},{key:"title",get:function(){return this.viewModel.title},set:function(v){this.viewModel.title=v}}]);return D}(d);b.__decorate([n.property()],x.prototype,"attributes",null);b.__decorate([n.property()],x.prototype,"activeMediaInfoIndex",null);b.__decorate([n.property()],x.prototype,"description",null);b.__decorate([n.property()],x.prototype,"fieldInfoMap",null);b.__decorate([n.property()],x.prototype,"layer",null);b.__decorate([n.property()],x.prototype,
"mediaInfos",null);b.__decorate([n.property()],x.prototype,"popupTemplate",null);b.__decorate([n.property()],x.prototype,"relatedInfos",null);b.__decorate([n.property()],x.prototype,"title",null);b.__decorate([n.property({type:e})],x.prototype,"viewModel",void 0);b.__decorate([n.property(),r.messageBundle("esri/widgets/Feature/t9n/Feature")],x.prototype,"messages",void 0);return x=b.__decorate([g.subclass("esri.widgets.Feature.FeatureMedia")],x)})},"esri/renderers/support/utils":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../core/maybe ../../intl/date ./numberUtils ../visualVariables/support/ColorStop ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){async function e(y,B,D){w.getOrCreateMapValue(y,B,()=>[]).push(...D)}function k(y){let B=y.minValue,D=y.maxValue;const z=y.isFirstBreak?"":h.gt+" ";y="percent-of-total"===y.normalizationType?h.pct:"";B=null==B?"":m.format(B);D=null==D?"":m.format(D);return z+B+y+" "+h.ld+" "+D+y}function u(y,B){return"normalizationField"in y&&y.normalizationField?{type:"normalized-field",field:y.field,normalizationField:y.normalizationField}:"field"in y&&y.field?{type:"field",field:y.field}:
"valueExpression"in y&&y.valueExpression?{type:"expression",expression:y.valueExpression,title:y.valueExpressionTitle,returnType:B}:null}const p=c.getLogger("esri.renderers.support.utils"),h={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},r={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},q={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",
month:"long-month-day-year",year:"year"};c=x.convertDateFormatToIntlOptions("short-date");a.calculateDateFormatInterval=function(y){y=y.map(A=>new Date(A));const B=y.length;let D=Infinity,z=null;for(let A=0;A<B-1;A++){const t=y[A];let C=Infinity,E=null;for(let F=A+1;F<B;F++){var v=y[F];v=t.getFullYear()!==v.getFullYear()&&"year"||t.getMonth()!==v.getMonth()&&"month"||t.getDate()!==v.getDate()&&"day"||t.getHours()!==v.getHours()&&"hour"||t.getMinutes()!==v.getMinutes()&&"minute"||t.getSeconds()!==
v.getSeconds()&&"second"||"millisecond";const H=r[v];H<C&&(C=H,E=v)}C<D&&(D=C,z=E)}return z};a.createClassBreakLabel=k;a.createColorStops=function(y){const {values:B,colors:D,labelIndexes:z,isDate:v,dateFormatOptions:A}=y;return B.map((t,C)=>{var E=null;if(!z||z.includes(C)){let F;if(F=v?x.formatDate(t,A):m.format(t))E="",0===C?E=h.lt+" ":C===B.length-1&&(E=h.gt+" "),E+=F}return new l({value:t,color:D[C],label:E})})};a.createUniqueValueLabel=function(y){const {value:B,domain:D,fieldInfo:z,dateFormatInterval:v}=
y;y=String(B);const A=D&&"codedValues"in D&&D.codedValues?D.getName(B):null;A?y=A:"number"===typeof B&&(y=z&&"date"===z.type?x.formatDate(B,v&&x.convertDateFormatToIntlOptions(q[v])):m.format(B));return y};a.getAttribute=u;a.getAttributes=function(y,B){const D=[];if("class-breaks"===y.type||"heatmap"===y.type)D.push(u(y,"number"));else if("unique-value"===y.type){var z=y.authoringInfo;if(z&&"relationship"===z.type){if(z.field1&&z.field2){var v=z.field2.field;const A=z.field2.normalizationField;D.push(u({field:z.field1.field,
normalizationField:z.field1.normalizationField}));D.push(u({field:v,normalizationField:A}))}}else v=y.uniqueValueInfos?.[0],z=null,v&&v.value&&(v=typeof y.uniqueValueInfos[0].value,"string"===v||"number"===v)&&(z=v),D.push(u(y,z)),[y.field2,y.field3].forEach(A=>A&&D.push({type:"field",field:A}))}else"attributes"in y&&y.attributes?.forEach(A=>D.push(u(A,"number")));(y=B?B(y):"visualVariables"in y?y.visualVariables:null)&&y.forEach(A=>D.push(u(A,"number")));return b.unique(D.filter(n.isSome),(A,t)=>
"field"===A.type&&"field"===t.type?A.field===t.field:"normalized-field"===A.type&&"normalized-field"===t.type?A.field===t.field&&A.normalizationField===t.normalizationField:"expression"===A.type&&"expression"===t.type?A.expression===t.expression:!1)};a.getColorsFromRenderer=async function(y){const B=new Map;if(!y)return B;if("visualVariables"in y&&y.visualVariables){var D=y.visualVariables.filter(v=>"color"===v.type);for(var z of D)D=(await f.getRampStops(z)??[]).map(v=>v.color),await e(B,z.field||
z.valueExpression,D)}if("heatmap"===y.type)z=d.getHeatmapRampStops(y).map(v=>v.color),await e(B,y.field||y.valueExpression,z);else if("pie-chart"===y.type){for(const v of y.attributes)await e(B,v.field||v.valueExpression,[v.color]);await e(B,"default",[y?.othersCategory?.color,g.getColorFromSymbol(y.backgroundFillSymbol,null)])}else if("dot-density"===y.type){for(const v of y.attributes)await e(B,v.field||v.valueExpression,[v.color]);await e(B,"default",[y.backgroundColor])}else if("unique-value"===
y.type)if("predominance"===y.authoringInfo?.type)for(const v of y.uniqueValueInfos??[])await e(B,v.value.toString(),[g.getColorFromSymbol(v.symbol,null)]);else{z=(y.uniqueValueInfos??[]).map(E=>g.getColorFromSymbol(E.symbol,null));const {field:v,field2:A,field3:t,valueExpression:C}=y;(v||C)&&await e(B,v||C,z);A&&await e(B,A,z);t&&await e(B,t,z)}else if("class-breaks"===y.type){z=y.classBreakInfos.map(t=>g.getColorFromSymbol(t.symbol,null));const {field:v,valueExpression:A}=y;await e(B,v??A,z)}else"simple"===
y.type&&await e(B,"default",[g.getColorFromSymbol(y.symbol,null)]);"defaultSymbol"in y&&y.defaultSymbol&&await e(B,"default",[g.getColorFromSymbol(y.defaultSymbol,null)]);B.forEach((v,A)=>{v=b.unique(v.filter(Boolean),(t,C)=>JSON.stringify(t)===JSON.stringify(C));B.set(A,v)});return B};a.setLabelsForClassBreaks=function(y){const B=y.classBreakInfos,D=y.normalizationType;let z=[];if(B&&B.length)if("standard-deviation"===y.classificationMethod)p.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");
else if(y.round){z.push(B[0].minValue);for(const v of B)z.push(v.maxValue);z=m.round(z);B.forEach((v,A)=>{v.label=k({minValue:0===A?z[0]:z[A],maxValue:z[A+1],isFirstBreak:0===A,normalizationType:D})})}else B.forEach((v,A)=>{v.label=k({minValue:v.minValue,maxValue:v.maxValue,isFirstBreak:0===A,normalizationType:D})})};a.timelineDateFormatOptions=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/numberUtils":function(){define(["exports","../../intl","../../intl/number"],
function(a,b,c){function w(d,e){return d-e}function n(d,e){let k;k=Number(d.toFixed(e));k<d?d=k+1/10**e:(d=k,k-=1/10**e);k=Number(k.toFixed(e));d=Number(d.toFixed(e));return[k,d]}function x(d,e,k,u,p){d=l(d,e,k,u);e=null==d.next||d.next<=p;return(null==d.previous||d.previous<=p)&&e||d.previous+d.next<=2*p}function m(d){d=String(d);var e=d.match(g);if(e&&e[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(d.toLowerCase().includes("e")&&(e=d.split("e"),d=e[0],e=e[1],
d&&e)){d=Number(d);e=Number(e);const k=0<e;k||(e=Math.abs(e));d=m(d);k?(d.integer+=e,d.fractional=e>d.fractional?0:d.fractional-e):(d.fractional+=e,d.integer=e>d.integer?1:d.integer-e);return d}return{integer:0,fractional:0}}function l(d,e,k,u){const p={previous:null,next:null};if(null!=k){const h=d-k;p.previous=Math.floor(Math.abs(100*(e-k-h)/h))}null!=u&&(d=u-d,p.next=Math.floor(Math.abs(100*(u-e-d)/d)));return p}const g=/^-?(\d+)(\.(\d+))?$/i,f={maximumFractionDigits:20};a.format=function(d){return c.formatNumber(d,
f)};a.numDigits=m;a.percentChange=l;a.round=function(d,e={}){d=d.slice(0);const {tolerance:k=2,strictBounds:u=!1,indexes:p=d.map((r,q)=>q)}=e;p.sort(w);for(e=0;e<p.length;e++){const r=p[e],q=d[r],y=0===r?null:d[r-1],B=r===d.length-1?null:d[r+1],D=m(q).fractional;if(D){let z=0,v=!1;for(var h=void 0;z<=D&&!v;)h=n(q,z),h=u&&0===e?h[1]:h[0],v=x(q,h,y,B,k),z++;v&&(d[r]=h)}}return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(A){A=A.symbolLayers;if(!A)return null;let t=null;A.forEach(C=>{if("object"!==C.type||null==C.resource?.href)t="water"===C.type?m.unwrap(C.color):m.isSome(C.material)?m.unwrap(C.material.color):null});return t?new c(t):null}function u(A,t){if(null==t||null==A)return A;A=A.toRgba();A[3]*=t;return new c(A)}function p(A,t,C){if(A=A.symbolLayers){var E=F=>{F=m.isSome(F)?F:null;t=t??F??(null!=C?v:null);return u(t,C)};A.forEach(F=>{if("object"!==F.type||null==
F.resource?.href||t)if("water"===F.type)F.color=E(F.color);else{var H=m.isSome(F.material)?F.material.color:null;H=E(H);m.isNone(F.material)?F.material=new e.Symbol3DMaterial({color:H}):F.material.color=H;null!=C&&"outline"in F&&m.isSome(F.outline)&&m.isSome(F.outline.color)&&(F.outline.color=u(F.outline.color,C))}})}}async function h(A,t){(A=A.symbolLayers)&&await n.forEach(A,async C=>r(C,t))}async function r(A,t){switch(A.type){case "extrude":A.size="number"===typeof t[2]?t[2]:0;break;case "icon":case "line":case "text":t=
q(t);m.isSome(t)&&(A.size=t);break;case "path":const C=B(t,g.ONES,[A.width,void 0,A.height]);A.width=z(t[0],A.width,1,C);A.height=z(t[2],A.height,1,C);break;case "object":await y(A,t)}}function q(A){for(const t of A)if("number"===typeof t)return t;return null}async function y(A,t){const {resourceSize:C,symbolSize:E}=await D(A),F=B(t,C,E);A.width=z(t[0],E[0],C[0],F);A.depth=z(t[1],E[1],C[1],F);A.height=z(t[2],E[2],C[2],F)}function B(A,t,C){for(let E=0;3>E;E++){const F=A[E];switch(F){case "symbol-value":return A=
C[E],null!=A?A/t[E]:1;case "proportional":break;default:if(F&&t[E])return F/t[E]}}return 1}async function D(A){const t=await (await new Promise((I,L)=>a(["./symbolLayerUtils"],I,L))).computeObjectLayerResourceSize(A,10),{width:C,height:E,depth:F}=A;A=[C,F,E];let H=1;for(var K=0;3>K;K++){const I=A[K];if(null!=I){H=I/t[K];break}}for(K=0;3>K;K++)null==A[K]&&(A[K]=t[K]*H);return{resourceSize:t,symbolSize:A}}function z(A,t,C,E){switch(A){case "proportional":return C*E;case "symbol-value":return null!=
t?t:C;default:return A}}const v=new c("white");b.applyColorToSymbol=function(A,t,C){if(A&&(t||null!=C))if(t&&(t=new c(t)),w.isSymbol3D(A))p(A,t,C);else if(w.isSymbol2D(A)){if(t=t??A.color)A.color=u(t,C);null!=C&&"outline"in A&&A.outline&&A.outline.color&&(A.outline.color=u(A.outline.color,C))}};b.applyOpacityToColor=u;b.applyRotationToSymbol=function(A,t,C){A&&null!=t&&(w.isSymbol3D(A)?(A=A.symbolLayers)&&A.forEach(E=>{if(E&&"object"===E.type)switch(C){case "tilt":E.tilt=t;break;case "roll":E.roll=
t;break;default:E.heading=t}}):!w.isSymbol2D(A)||"simple-marker"!==A.type&&"picture-marker"!==A.type&&"text"!==A.type||(A.angle=t))};b.applySizesToSymbol=async function(A,t){if(A&&t){if(w.isSymbol3D(A))return h(A,t);if(w.isSymbol2D(A)&&(t=q(t),!m.isNone(t)))switch(A.type){case "simple-marker":A.size=t;break;case "picture-marker":const C=A.width/A.height;1<C?(A.width=t,A.height=t*C):(A.width=t*C,A.height=t);break;case "simple-line":A.width=t;break;case "text":A.font.size=t}}};b.fetchWebStyleSymbol=
async function(A,t){const C=await A.fetchSymbol(t);return C?C:A.fetchCIMSymbol(t)};b.getCSSFilterFromEffectList=function(A){if(!A)return null;A=A.effects.filter(t=>"bloom"!==t.type).map(t=>t.toJSON());return f.effectFunctionsFromJSON(A)};b.getColorFromSymbol=function(A,t){if(!A)return null;let C=null;w.isSymbol3D(A)?C=k(A):w.isSymbol2D(A)&&(C=A.color?new c(A.color):null);return C?u(C,t):null};b.getIconHref=function(A){return m.unwrapOrThrow(A.resource).href};b.getSymbolOutlineSize=function(A){if(!A)return 0;
if(w.isSymbol3D(A)){{const t=A.symbolLayers&&A.symbolLayers.length;t?(A=A.symbolLayers.getItemAt(t-1),A="outline"in A?m.get(A,"outline","size"):void 0):A=void 0}return m.isSome(A)?A:0}return l.px2pt(d.getStroke(A)?.width)};b.isVolumetricSymbol=function(A){if(m.isNone(A)||!("symbolLayers"in A)||m.isNone(A.symbolLayers))return!1;switch(A.type){case "point-3d":return A.symbolLayers.some(t=>"object"===t.type);case "line-3d":return A.symbolLayers.some(t=>"path"===t.type);case "polygon-3d":return A.symbolLayers.some(t=>
"object"===t.type||"extrude"===t.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(A){return m.isSome(A)&&"polygon-3d"===A.type&&A.symbolLayers.some(t=>"extrude"===t.type)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,b,c,w,n,x,m){function l(d){if(!d)return null;let e=null;switch(d.type){case "simple-fill":case "picture-fill":case "simple-marker":e=
l(d.outline);break;case "simple-line":const k=x.pt2px(d.width);null!=d.style&&"none"!==d.style&&0!==k&&(e={color:d.color,style:f(d.style),width:k,cap:d.cap,join:"miter"===d.join?x.pt2px(d.miterLimit):d.join});break;default:e=null}return e}const g=new n(1E3),f=(()=>{const d={};return e=>{if(d[e])return d[e];const k=e.replace(/-/g,"");return d[e]=k}})();c=new c([128,128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=f;a.getFill=function(d){const e=d.style;let k=null;if(d)switch(d.type){case "simple-marker":"cross"!==
e&&"x"!==e&&(k=d.color);break;case "simple-fill":"solid"===e?k=d.color:"none"!==e&&(k={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${e}.png`),width:5,height:5});break;case "picture-fill":k={type:"pattern",src:d.url,width:x.pt2px(d.width)*d.xscale,height:x.pt2px(d.height)*d.yscale,x:x.pt2px(d.xoffset),y:x.pt2px(d.yoffset)};break;case "text":k=d.color;break;case "cim":k=m.getCIMSymbolColor(d)}return k};a.getPatternUrlWithColor=function(d,e){const k=d+"-"+e;return void 0!==g.get(k)?
Promise.resolve(g.get(k)):w(d,{responseType:"image"}).then(u=>{u=u.data;const p=u.naturalWidth,h=u.naturalHeight,r=document.createElement("canvas");r.width=p;r.height=h;const q=r.getContext("2d");q.fillStyle=e;q.fillRect(0,0,p,h);q.globalCompositeOperation="destination-in";q.drawImage(u,0,0);u=r.toDataURL();g.put(k,u);return u})};a.getStroke=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/ItemCache":function(){define(["../chunks/_rollupPluginBabelHelpers","./MemCache"],
function(a,b){return function(){function c(n,x){this._storage=new b.MemCacheStorage;this._storage.maxSize=n;x&&this._storage.registerRemoveFunc("",x)}var w=c.prototype;w.put=function(n,x){this._storage.put(n,x,1,1)};w.pop=function(n){return this._storage.pop(n)};w.get=function(n){return this._storage.get(n)};w.clear=function(){this._storage.clearAll()};w.destroy=function(){this._storage.destroy()};return a._createClass(c)}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color",
"../cim/utils"],function(a,b,c){function w(e){e=c.toCIMSymbolJSON(e);if("CIMTextSymbol"===e?.type)return e.height??0;let k=0;if(e?.symbolLayers)for(const u of e.symbolLayers)c.isCIMMarker(u)&&null!=u.size&&u.size>k?k=u.size:c.isCIMStroke(u)&&null!=u.width&&u.width>k?k=u.width:c.isCIMFill(u);return k}function n(e,k,u,p){if(e)if("CIMTextSymbol"===e.type)null!=e.height&&(e.height*=k);else{if(u&&e.effects)for(const h of e.effects)l(h,k);if(e.symbolLayers)for(const h of e.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":x(h,
k,p);break;case "CIMPictureStroke":case "CIMSolidStroke":!p?.preserveOutlineWidth&&h.width&&(h.width*=k);break;case "CIMPictureFill":h.height&&(h.height*=k);h.offsetX&&(h.offsetX*=k);h.offsetY&&(h.offsetY*=k);break;case "CIMHatchFill":n(h.lineSymbol,k,!0,{...p,preserveOutlineWidth:!1}),h.offsetX&&(h.offsetX*=k),h.offsetY&&(h.offsetY*=k),h.separation&&(h.separation*=k)}}}function x(e,k,u){if(e&&(e.markerPlacement&&m(e.markerPlacement,k),e.offsetX&&(e.offsetX*=k),e.offsetY&&(e.offsetY*=k),e.anchorPoint&&
"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*k,y:e.anchorPoint.y*k}),e.size=null!=e.size?e.size*k:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const p of e.markerGraphics)e.scaleSymbolsProportionally||n(p.symbol,k,!0,u)}function m(e,k){c.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=k);switch(e.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":e.customEndingOffset&&(e.customEndingOffset*=k);e.offsetAlongLine&&(e.offsetAlongLine*=
k);if(e.placementTemplate&&e.placementTemplate.length){var u=e.placementTemplate.map(p=>p*k);e.placementTemplate=u}break;case "CIMMarkerPlacementAlongLineVariableSize":e.maxRandomOffset&&(e.maxRandomOffset*=k);e.placementTemplate&&e.placementTemplate.length&&(u=e.placementTemplate.map(p=>p*k),e.placementTemplate=u);break;case "CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=k);break;case "CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=k);break;case "CIMMarkerPlacementAtRatioPositions":e.beginPosition&&
(e.beginPosition*=k);e.endPosition&&(e.endPosition*=k);break;case "CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=k);e.offsetY&&(e.offsetY*=k);break;case "CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=k),e.offsetY&&(e.offsetY*=k),e.stepX&&(e.stepX*=k),e.stepY&&(e.stepY*=k)}}function l(e,k){switch(e.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":e.width&&(e.width*=k);break;case "CIMGeometricEffectBuffer":e.size&&(e.size*=k);break;case "CIMGeometricEffectCut":e.beginCut&&
(e.beginCut*=k);e.endCut&&(e.endCut*=k);e.middleCut&&(e.middleCut*=k);break;case "CIMGeometricEffectDashes":e.customEndingOffset&&(e.customEndingOffset*=k);e.offsetAlongLine&&(e.offsetAlongLine*=k);if(e.dashTemplate&&e.dashTemplate.length){const u=e.dashTemplate.map(p=>p*k);e.dashTemplate=u}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":e.length&&(e.length*=k);break;case "CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=k);e.offsetY&&(e.offsetY*=
k);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=k);break;case "CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=k);break;case "CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=k);e.length&&(e.length*=k);e.toWidth&&(e.toWidth*=k);break;case "CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=k),e.period&&(e.period*=k)}}function g(e,k){if(e){var u="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===e.type;if(u?.symbolLayers)for(const p of u.symbolLayers)if(!(p.colorLocked||
e&&(c.isCIMStroke(p)||c.isCIMMarker(p)&&p.markerPlacement&&c.isCIMMarkerStrokePlacement(p.markerPlacement))))switch(p.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":p.tintColor&&f(k,p.tintColor);break;case "CIMVectorMarker":p.markerGraphics?.forEach(h=>{g(h.symbol,k)});break;case "CIMSolidStroke":case "CIMSolidFill":f(k,p.color);break;case "CIMHatchFill":g(p.lineSymbol,k)}}}function f(e,k){for(const u of e)if(u.join(".")===k.join("."))return;e.push(k)}function d(e,k,u){if(e){var p=
"CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===p?.type;if(p?.symbolLayers)for(const h of p.symbolLayers)if(!h.colorLocked){if(e)if(u){if({layersToColor:p}=u,(c.isCIMStroke(h)||c.isCIMMarker(h)&&h.markerPlacement&&c.isCIMMarkerStrokePlacement(h.markerPlacement))&&"fill"===p||c.isCIMFill(h)&&"outline"===p)continue}else if(c.isCIMStroke(h)||c.isCIMMarker(h)&&h.markerPlacement&&c.isCIMMarkerStrokePlacement(h.markerPlacement))continue;p=k.toArray();switch(h.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":h.tintColor=
p;break;case "CIMVectorMarker":h.markerGraphics?.forEach(r=>{d(r.symbol,k,u)});break;case "CIMSolidStroke":case "CIMSolidFill":h.color=p;break;case "CIMHatchFill":d(h.lineSymbol,k,u)}}}}a.applyCIMSymbolColor=function(e,k,u){k instanceof b||(k=new b(k));(e=c.toCIMSymbolJSON(e))&&d(e,k,u)};a.applyCIMSymbolRotation=function(e,k,u=!1){e=c.toCIMSymbolJSON(e);u&&0!==k&&(k=360-k);if("CIMTextSymbol"===e?.type)e.angle=k;else if("CIMPointSymbol"===e?.type&&e.symbolLayers){u=k-(e.angle||0);for(const p of e.symbolLayers)if(c.isCIMMarker(p)){let h=
p.rotation||0;h=p.rotateClockwise?h-u:h+u;p.rotation=h}e.angle=k}};a.getCIMSymbolColor=function(e){e=c.toCIMSymbolJSON(e);const k=[];g(e,k);return k.length?new b(c.fromCIMColor(k[0])):null};a.getCIMSymbolRotation=function(e,k=!1){e=c.toCIMSymbolJSON(e);return"CIMTextSymbol"===e?.type||"CIMPointSymbol"===e?.type?(e=e.angle,null!=e&&0!==e&&k?360-e:e??0):0};a.getCIMSymbolSize=w;a.getCIMSymbolType=function(e){e=c.toCIMSymbolJSON(e);if(!e)return null;switch(e.type){case "CIMPointSymbol":return"CIMPointSymbol";
case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=x;a.scaleCIMSymbol=n;a.scaleCIMSymbolTo=function(e,k,u){if(e){var p=c.toCIMSymbolJSON(e);e=w(e);if(0===e){if(p)if("CIMTextSymbol"===p.type)p.height=k;else if(p.symbolLayers)for(const h of p.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":h.size=k;break;case "CIMPictureStroke":case "CIMSolidStroke":h.width=
k}}else n(p,k/e,!1,u)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(d){let e=d.length;for(;e--;)if(!" /-,\n".includes(d.charAt(e)))return!1;return!0}function w(d,e){const k=[];var u=0;let p=-1;do p=d.indexOf("[",u),p>=u&&(p>u&&(u=d.substr(u,p-u),k.push([u,null,c(u)])),u=p+1,p=d.indexOf("]",u),p>=u&&(p>u&&(u=d.substr(u,p-u),(u=e[u])&&k.push([null,u,!1])),u=p+1));while(-1!==p);u<d.length-1&&
(d=d.substr(u),k.push([d,null,c(d)]));return k}function n(d,e,k){let u="",p=null;for(const h of e){const [r,q,y]=h;if(r)y?p=r:(p&&(u+=p,p=null),u+=r);else if(e=d.attributes[q])p&&(u+=p,p=null),u+=e}return x(u,k)}function x(d,e){"string"!==typeof d&&(d=String(d));switch(e){case "LowerCase":return d.toLowerCase();case "Allcaps":return d.toUpperCase();default:return d}}function m(d){return d?{r:d[0],g:d[1],b:d[2],a:d[3]/255}:{r:0,g:0,b:0,a:0}}function l(d){if(!d)return null;switch(d.type){case "CIMPolygonSymbol":if(d.symbolLayers)for(const e of d.symbolLayers)if(d=
l(e),null!=d)return d;break;case "CIMTextSymbol":return l(d.symbol);case "CIMSolidFill":return d.color}}function g(d){if(d)switch(d.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(d=d.symbolLayers)for(const e of d)if(d=g(e),null!=d)return d;break;case "CIMTextSymbol":return g(d.symbol);case "CIMSolidStroke":case "CIMSolidFill":return d.color}}function f(d){if(d)switch(d.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(d.symbolLayers)for(const e of d.symbolLayers)if(d=f(e),void 0!==d)return d;
break;case "CIMTextSymbol":return f(d.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return d.width}}b.adjustTextCase=x;b.analyzeTextParts=w;b.assignTextValuesFromFeature=n;b.attributesToFields=function(d){return(d?Object.keys(d):[]).map(e=>({name:e,alias:e,type:"string"===typeof d[e]?"esriFieldTypeString":"esriFieldTypeDouble"}))};b.colorToArray=function(d){return[d.r,d.g,d.b,d.a]};b.createLabelOverrideFunction=function(d,e,k){const u=w(e,d);return p=>n(p,u,k)};b.evaluateValueOrFunction=
function(d,e,k,u){return"function"===typeof d?d(e,k,u):d};b.fromCIMColor=m;b.fromCIMFontDecoration=function(d){return d.underline?"underline":d.strikethrough?"line-through":"none"};b.fromCIMFontStyle=function(d){let e="",k="";d&&(d=d.toLowerCase(),d.includes("italic")?e="italic":d.includes("oblique")&&(e="oblique"),d.includes("bold")?k="bold":d.includes("light")&&(k="lighter"));return{style:e,weight:k}};b.fromCIMHorizontalAlignment=function(d){switch(d){default:return"left";case "Right":return"right";
case "Center":return"center";case "Justify":return"center"}};b.fromCIMVerticalAlignment=function(d){switch(d){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};b.getFillColor=l;b.getFontStyle=function(d){if(!d)return"normal";switch(d.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};b.getFontWeight=function(d){if(!d)return"normal";switch(d.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";
case "lighter":return"lighter";default:return"normal"}};b.getStrokeColor=g;b.getStrokeWidth=f;b.getTintColor=d=>d.tintColor?m(d.tintColor):{r:255,g:255,b:255,a:1};b.getValue=(d,e=0)=>null==d||isNaN(d)?e:d;b.importGeometryEngine=function(){return new Promise((d,e)=>a(["../../geometry/geometryEngineJSON"],d,e))};b.isCIMFill=function(d){return null!=d&&("CIMGradientFill"===d.type||"CIMHatchFill"===d.type||"CIMPictureFill"===d.type||"CIMSolidFill"===d.type||"CIMWaterFill"===d.type)};b.isCIMMarker=function(d){return"CIMVectorMarker"===
d.type||"CIMPictureMarker"===d.type||"CIMBarChartMarker"===d.type||"CIMCharacterMarker"===d.type||"CIMPieChartMarker"===d.type||"CIMStackedBarChartMarker"===d.type};b.isCIMMarkerStrokePlacement=function(d){return null!=d&&("CIMMarkerPlacementAlongLineRandomSize"===d.type||"CIMMarkerPlacementAlongLineSameSize"===d.type||"CIMMarkerPlacementAlongLineVariableSize"===d.type||"CIMMarkerPlacementAtExtremities"===d.type||"CIMMarkerPlacementAtMeasuredUnits"===d.type||"CIMMarkerPlacementAtRatioPositions"===
d.type||"CIMMarkerPlacementOnLine"===d.type||"CIMMarkerPlacementOnVertices"===d.type)};b.isCIMStroke=function(d){return"CIMGradientStroke"===d.type||"CIMPictureStroke"===d.type||"CIMSolidStroke"===d.type};b.isGeometryEngineRequired=d=>{if(!d)return!1;for(const e of d)switch(e.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};b.isSVGImage=d=>d.includes("data:image/svg+xml");b.mapCIMSymbolToGeometryType=function(d){if(!d)return null;
switch(d.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};b.resampleHermite=function(d,e,k,u,p,h,r=!0){const q=e/p;k/=h;const y=Math.ceil(q/2),B=Math.ceil(k/2);for(let v=0;v<h;v++)for(let A=0;A<p;A++){const t=4*(A+(r?h-v-1:v)*p);var D=0;let C=0,E=0,F=0,H=0,K=0,I=0;const L=(v+.5)*k;for(let R=Math.floor(v*k);R<(v+1)*k;R++){var z=Math.abs(L-(R+.5))/B;const O=
(A+.5)*q;z*=z;for(let J=Math.floor(A*q);J<(A+1)*q;J++){let M=Math.abs(O-(J+.5))/y;D=Math.sqrt(z+M*M);-1<=D&&1>=D&&(D=2*D*D*D-3*D*D+1,0<D&&(M=4*(J+R*e),I+=D*d[M+3],E+=D,255>d[M+3]&&(D=D*d[M+3]/250),F+=D*d[M],H+=D*d[M+1],K+=D*d[M+2],C+=D))}}u[t]=F/C;u[t+1]=H/C;u[t+2]=K/C;u[t+3]=I/E}};b.toCIMSymbolJSON=function(d){return d.data?.symbol??null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../Color",
"./utils"],function(a,b,c,w){function n(f,d){const e=[],k=f.length-1;5===f.length?e.push(0,2,4):e.push(0,k);return f.map((u,p)=>e.includes(p)?w.createStopLabel(u,p,k,d):null)}async function x(f,d,e){e=new c(e??g);f=(await new Promise((k,u)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],k,u))).getOpacity(d,f);null!=f&&(e.a=f);return e}function m(f,d){const {startIndex:e,endIndex:k,weight:u}=l(f,d);if(e===k)return d[e].color;f=c.blendColors(d[e].color,d[k].color,u);return new c(f)}
function l(f,d){let e=0,k=d.length-1;d.some((u,p)=>{if(f<u.value)return k=p,!0;e=p;return!1});return{startIndex:e,endIndex:k,weight:(f-d[e].value)/(d[k].value-d[e].value)}}const g=new c([64,64,64]);b.getColorFromPointCloudStops=m;b.getRampStops=async function(f,d,e){let k=!1,u=[],p=[];if(f.stops){var h=f.stops;u=h.map(q=>q.value);(k=h.some(q=>!!q.label))&&(p=h.map(q=>q.label))}h=u[u.length-1];if(null==u[0]&&null==h)return null;const r=k?null:n(u,e??!1);return(await Promise.all(u.map(async(q,y)=>{const B=
"opacity"===f.type?await x(q,f,d):(await new Promise((D,z)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],D,z))).getColor(f,q);return{value:q,color:B,label:k?p[y]:r?.[y]??""}}))).reverse()};b.getRampStopsForPointCloud=function(f){let d=!1,e=[],k=[];e=f.map(h=>h.value);(d=f.some(h=>!!h.label))&&(k=f.map(h=>h.label??""));const u=e[e.length-1];if(null==e[0]&&null==u)return null;const p=d?null:n(e,!1);return e.map((h,r)=>{const q=m(h,f);return{value:h,color:q,label:d?k[r]:p?.[r]??
""}}).reverse()};b.getStrectchRampStops=function(f,d){let e=[];if(f&&"multipart"===f.type)f.colorRamps.reverse().forEach((k,u)=>{0===u?e.push({value:d.max,color:new c(k.toColor),label:"high"}):e.push({value:null,color:new c(k.toColor),label:""});u===f.colorRamps.length-1?e.push({value:d.min,color:new c(k.fromColor),label:"low"}):e.push({value:null,color:new c(k.fromColor),label:""})});else{let k,u;f&&"algorithmic"===f.type?(k=f.fromColor,u=f.toColor):(k=[0,0,0,1],u=[255,255,255,1]);e=[{value:d.max,
color:new c(u),label:"high"},{value:d.min,color:new c(k),label:"low"}]}return e};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/utils":function(){define("require exports ../../../symbols ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/SimpleLineSymbol".split(" "),function(a,b,c,w,n,x){async function m(g){if(!("visualVariables"in g&&g.visualVariables))return null;g=g.visualVariables.find(e=>"color"===e.type);if(!g)return null;
var f=null,d=null;if(g.stops){if(1===g.stops.length)return g.stops[0].color;f=g.stops[0].value;d=g.stops[g.stops.length-1].value}f=null!=f&&null!=d?f+(d-f)/2:0;({getColor:d}=await new Promise((e,k)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],e,k)));return d(g,f)??null}const l=w.convertDateFormatToIntlOptions("short-date");b.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"];b.SPECIAL_CHARS_GREATER_THAN="\x3e";b.SPECIAL_CHARS_LESS_THAN="\x3c";b.createStopLabel=function(g,
f,d,e){let k="";0===f?k="\x3c ":f===d&&(k="\x3e ");f=null;f=e?w.formatDate(g,l):n.format(g);return k+f};b.getMedianColor=m;b.getSymbolForFlowRenderer=async function(g,f){const d=g.trailCap,e=g.trailWidth||1;g=f||await m(g)||g.color;return new x({cap:d,color:g,width:e})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(a,b){a.getHeatmapRampStops=function(c){if(!c.colorStops)return[];
const w=[...c.colorStops].filter(x=>0<x.color?.a);let n=w.length-1;if(w&&w[0]){const x=w[n];x&&1!==x.ratio&&(w.push(new b({ratio:1,color:x.color})),n++)}return w.map((x,m)=>{let l="";0===m?l=c.legendOptions?.minLabel||"low":m===n&&(l=c.legendOptions?.maxLabel||"high");return{color:x.color,label:l,ratio:x.ratio}}).reverse()};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){const u={chartAnimation:!0};c=function(p){function h(q){q=r.call(this,q);q.abilities={...u};q.activeMediaInfoIndex=0;q.attributes=null;q.description=null;q.fieldInfoMap=null;q.formattedAttributes=null;q.expressionAttributes=null;q.isAggregate=!1;q.layer=null;q.mediaInfos=null;q.popupTemplate=null;q.relatedInfos=null;q.title=null;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.castAbilities=function(q){return{...u,...q}};p.setActiveMedia=function(q){this._setContentElementMedia(q)};
p.next=function(){this._pageContentElementMedia(1)};p.previous=function(){this._pageContentElementMedia(-1)};p._setContentElementMedia=function(q){const {formattedMediaInfoCount:y}=this;this.activeMediaInfoIndex=(q+y)%y};p._pageContentElementMedia=function(q){const {activeMediaInfoIndex:y}=this;this._setContentElementMedia(y+q)};p._formatMediaInfos=function(){const {mediaInfos:q,layer:y}=this,B=this.attributes??{},D=this.formattedAttributes??{},z=this.expressionAttributes??{},v=this.fieldInfoMap??
new Map;return q?.map(A=>{A=A?.clone();if(!A)return null;A.title=e.substituteFieldsInLinksAndAttributes({attributes:B,fieldInfoMap:v,globalAttributes:D,expressionAttributes:z,layer:y,text:A.title});A.caption=e.substituteFieldsInLinksAndAttributes({attributes:B,fieldInfoMap:v,globalAttributes:D,expressionAttributes:z,layer:y,text:A.caption});A.altText=e.substituteFieldsInLinksAndAttributes({attributes:B,fieldInfoMap:v,globalAttributes:D,expressionAttributes:z,layer:y,text:A.altText});if("image"===
A.type){var {value:t}=A;this._setImageValue({value:t,formattedAttributes:D,layer:y});return A.value.sourceURL?A:void 0}return"pie-chart"===A.type||"line-chart"===A.type||"column-chart"===A.type||"bar-chart"===A.type?({value:t}=A,this._setChartValue({value:t,chartType:A.type,attributes:B,formattedAttributes:D,layer:y,expressionAttributes:z}),A):null}).filter(w.isSome)??[]};p._setImageValue=function(q){const y=this.fieldInfoMap??new Map,{value:B,formattedAttributes:D,layer:z}=q,{linkURL:v,sourceURL:A}=
B;A&&(q=e.fixTokens(A,z),B.sourceURL=e.substituteAttributes({formattedAttributes:D,template:q,fieldInfoMap:y}));v&&(q=e.fixTokens(v,z),B.linkURL=e.substituteAttributes({formattedAttributes:D,template:q,fieldInfoMap:y}))};p._setChartValue=function(q){const {value:y,attributes:B,formattedAttributes:D,chartType:z,layer:v,expressionAttributes:A}=q,{popupTemplate:t,relatedInfos:C}=this,{fields:E,normalizeField:F}=y;y.fields=e.getFixedFieldNames(E,v);F&&(y.normalizeField=e.getFixedFieldName(F,v));if(E.some(K=>
!!(null!=D[K]||e.isRelatedField(K)&&C?.size))){var H=t?.fieldInfos??[];E.forEach(K=>{e.isRelatedField(K)?y.series=[...y.series,...this._getRelatedChartInfos({fieldInfos:H,fieldName:K,formattedAttributes:D,chartType:z,value:y})]:(K=this._getChartOption({value:y,attributes:B,chartType:z,formattedAttributes:D,expressionAttributes:A,fieldName:K,fieldInfos:H}),y.series.push(K))})}};p._getRelatedChartInfos=function(q){const {fieldInfos:y,fieldName:B,formattedAttributes:D,chartType:z,value:v}=q,A=[],t=k.getRelatedFieldInfo(B);
q=t&&this.relatedInfos?.get(t.layerId.toString());if(!q)return A;const {relatedFeatures:C,relation:E}=q;if(!E||!C)return A;({cardinality:q}=E);C.forEach(F=>{const {attributes:H}=F;H&&Object.keys(H).forEach(K=>{K===t.fieldName&&A.push(this._getChartOption({value:v,attributes:H,formattedAttributes:D,fieldName:B,chartType:z,relatedFieldName:K,hasMultipleRelatedFeatures:1<C?.length,fieldInfos:y}))})});return"one-to-many"===q||"many-to-many"===q?A:[A[0]]};p._getTooltip=function({label:q,value:y,chartType:B}){return"pie-chart"===
B?`${q}`:`${q}: ${y}`};p._getChartOption=function(q){const {value:y,attributes:B,formattedAttributes:D,expressionAttributes:z,fieldName:v,relatedFieldName:A,fieldInfos:t,chartType:C,hasMultipleRelatedFeatures:E}=q;var F=this.layer,H=this.fieldInfoMap??new Map;const {normalizeField:K,tooltipField:I}=y;q=K?e.isRelatedField(K)?B[k.getRelatedFieldInfo(K).fieldName]:B[K]:null;var L=e.isExpressionField(v)&&z&&void 0!==z[v]?z[v]:A&&void 0!==B[A]?B[A]:void 0!==B[v]?B[v]:D[v];q=new d({fieldName:v,value:void 0===
L?null:L&&q?L/q:L});if(e.isRelatedField(v))return F=H.get(v.toLowerCase()),L=I&&H.get(I.toLowerCase()),H=F?.fieldName??v,L=E&&I?k.getRelatedFieldInfo(I).fieldName:L?.fieldName??I,q.tooltip=this._getTooltip({label:E&&L?B[L]:D[L]??F?.label??F?.fieldName??A,value:E&&A?B[A]:D[H],chartType:C}),q;H=e.getFieldInfo(t,v);F=e.getFixedFieldName(v,F);H=I&&void 0!==D[I]?D[I]:e.getFieldInfoLabel(H||new f({fieldName:F}),this.popupTemplate?.expressionInfos);q.tooltip=this._getTooltip({label:H,value:D[F],chartType:C});
return q};a._createClass(h,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return h}(c);b.__decorate([n.property()],c.prototype,"abilities",void 0);b.__decorate([x.cast("abilities")],c.prototype,"castAbilities",null);b.__decorate([n.property()],c.prototype,"activeMediaInfoIndex",
void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"activeMediaInfo",null);b.__decorate([n.property()],c.prototype,"attributes",void 0);b.__decorate([n.property()],c.prototype,"description",void 0);b.__decorate([n.property()],c.prototype,"fieldInfoMap",void 0);b.__decorate([n.property()],c.prototype,"formattedAttributes",void 0);b.__decorate([n.property()],c.prototype,"expressionAttributes",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"formattedMediaInfos",null);b.__decorate([n.property()],
c.prototype,"isAggregate",void 0);b.__decorate([n.property()],c.prototype,"layer",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"formattedMediaInfoCount",null);b.__decorate([n.property()],c.prototype,"mediaInfos",void 0);b.__decorate([n.property()],c.prototype,"popupTemplate",void 0);b.__decorate([n.property()],c.prototype,"relatedInfos",void 0);b.__decorate([n.property()],c.prototype,"title",void 0);return c=b.__decorate([g.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],
c)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../core/has ../../../layers/support/source/DataLayerSource ../../../rest/query/executeQueryJSON ../../../config ../../../kernel ../../../core/arrayUtils ../../../core/urlUtils ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/featureConversionUtils ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/normalizeUtils ../../../core/pbf ../../../rest/support/FeatureSet ../../../rest/support/Query ../../../rest/query/support/AttachmentInfo ../../../rest/support/AttachmentQuery ../../../geometry ../../../rest/support/RelationshipQuery ../../../rest/support/TopFeaturesQuery ../../../rest/support/StatisticDefinition ./featureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R){function O(W,V){if(!V.relationships)return null;let T=null;({relationships:V}=V);V.some(X=>X.id===parseInt(W,10)?(T=X,!0):!1);return T}function J({originRelationship:W,relationships:V,layerId:T}){let X=null;V&&V.some(Z=>{`${Z.relatedTableId}`===T&&Z.id===W?.id&&(X=Z);return!!X});return X}function M(W,V){V=V.toLowerCase();for(const T in W)if(T.toLowerCase()===V)return W[T];return null}function G(W,V,T,X){const Z=new K;Z.outFields=
["*"];Z.relationshipId="number"===typeof V.id?V.id:parseInt(V.id,10);Z.objectIds=[W.attributes[T.objectIdField]];return T.queryRelatedFeatures?.(Z,X)??Promise.resolve({})}function P(W,V,T){let X=0;const Z=[];for(;X<V.length;)Z.push(`${W} IN (${V.slice(X,T+X)})`),X+=T;return Z.join(" OR ")}async function U(W,V,T,X){var Z=T.layerId.toString();const {layerInfo:Y,relation:aa,relatedFields:ia,outStatistics:na,url:ba,sourceSpatialReference:ea}=V;if(!Y||!aa)return null;Z=J({originRelationship:aa,relationships:Y.relationships,
layerId:Z});if(Z?.relationshipTableId&&Z.keyFieldInRelationshipTable){T=(await G(W,Z,T,X))[W.attributes[T.objectIdField]];if(!T)return null;const ja=T.features.map(ka=>ka.attributes[Y.objectIdField]);if(na?.length&&Y.supportsStatistics)return V=new C,V.where=P(Y.objectIdField,ja,1E3),V.outFields=ia,V.outStatistics=na,V.sourceSpatialReference=ea,V={features:Promise.resolve(T),statsFeatures:g.executeQueryJSON(ba,V)},n.eachAlways(V)}return(Z=Z?.keyField)?(T=x.isNumericField(N(Y.fields,Z)),W=M(W.attributes,
aa.keyField),Z=T?`${Z}=${W}`:`${Z}='${W}'`,W=g.executeQueryJSON(ba,new C({where:Z,outFields:V.relatedFields,sourceSpatialReference:ea}),X),V=V.outStatistics&&0<V.outStatistics.length&&Y.supportsStatistics?g.executeQueryJSON(ba,new C({where:Z,outFields:V.relatedFields,outStatistics:V.outStatistics,sourceSpatialReference:ea}),X):null,X={features:W},V&&(X.statsFeatures=V),n.eachAlways(X)):null}function N(W,V){if(null!=W){V=V.toLowerCase();for(const T of W)if(T&&T.name.toLowerCase()===V)return T}return null}
const S=w.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Q=new Map;a.createRelatedInfo=function(W,V){if(W=O(W,V))return{url:`${V.url}/${W.relatedTableId}`,sourceSpatialReference:V.spatialReference,relation:W,relatedFields:[],outStatistics:[]}};a.getDestinationRelation=J;a.getRelatedFieldInfo=function(W){if(!R.isRelatedField(W))return null;const [V,T]=W.split("/").slice(1);return{layerId:V,fieldName:T}};a.queryLayerInfos=function({relatedInfos:W,layer:V},T){const X={};W.forEach((Z,Y)=>
{({relation:Z}=Z);if(!Z)throw Y=new c("relation-required","A relation is required on a layer to retrieve related records."),S.error(Y),Y;({relatedTableId:Z}=Z);if("number"!==typeof Z)throw Y=new c("A related table ID is required on a layer to retrieve related records."),S.error(Y),Y;Z=`${V.url}/${Z}`;const aa=Q.get(Z),ia=aa??b(Z,{query:{f:"json"},signal:T&&T.signal});aa||Q.set(Z,ia);X[Y]=ia});return n.whenOrAbort(n.eachAlways(X),T)};a.queryRelatedFeatures=function({graphic:W,relatedInfos:V,layer:T},
X){const Z={};V.forEach((Y,aa)=>{Y.layerInfo&&(Z[aa]=U(W,Y,T,X))});return n.eachAlways(Z)};a.setRelatedFeatures=function(W,V){if(V&&W){var {features:T,statsFeatures:X}=W;W=T&&T.value;V.relatedFeatures=W?W.features:[];W=X&&X.value;V.relatedStatsFeatures=W?W.features:[]}};a.updateRelatedInfo=function({relatedInfo:W,fieldName:V,fieldInfo:T}){W.relatedFields?.push(V);T.statisticType&&(V=new L({statisticType:T.statisticType,onStatisticField:V,outStatisticFieldName:V}),W.outStatistics?.push(V))};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/chartUtils":function(){define(["require","exports","../../intl","../../core/has","../../intl/locale"],function(a,b,c,w,n){function x(d){if(!d)return"en-us";if(l.has(d.toLowerCase()))return d.toLowerCase();d=d.split("-")[0].toLowerCase();let e=null;for(const k of l.keys())if(k.startsWith(d)){e=k;break}return e||"en-us"}c="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var m=[{name:"default",colors:[].concat(c.slice(30,39),c.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const l=new Map([["ar",()=>(new Promise((d,e)=>a(["../../chunks/ar"],d,e))).then(d=>d.ar)],["bg-bg",()=>(new Promise((d,
e)=>a(["../../chunks/bg_BG"],d,e))).then(d=>d.bg_BG)],["bs-ba",()=>(new Promise((d,e)=>a(["../../chunks/bs_BA"],d,e))).then(d=>d.bs_BA)],["ca-es",()=>(new Promise((d,e)=>a(["../../chunks/ca_ES"],d,e))).then(d=>d.ca_ES)],["cs-cz",()=>(new Promise((d,e)=>a(["../../chunks/cs_CZ"],d,e))).then(d=>d.cs_CZ)],["da-dk",()=>(new Promise((d,e)=>a(["../../chunks/da_DK"],d,e))).then(d=>d.da_DK)],["de-de",()=>(new Promise((d,e)=>a(["../../chunks/de_DE"],d,e))).then(d=>d.de_DE)],["de-ch",()=>(new Promise((d,e)=>
a(["../../chunks/de_CH"],d,e))).then(d=>d.de_CH)],["el-gr",()=>(new Promise((d,e)=>a(["../../chunks/el_GR"],d,e))).then(d=>d.el_GR)],["en-us",()=>(new Promise((d,e)=>a(["../../chunks/en_US"],d,e))).then(d=>d.en_US)],["en-ca",()=>(new Promise((d,e)=>a(["../../chunks/en_CA"],d,e))).then(d=>d.en_CA)],["es-es",()=>(new Promise((d,e)=>a(["../../chunks/es_ES"],d,e))).then(d=>d.es_ES)],["et-ee",()=>(new Promise((d,e)=>a(["../../chunks/et_EE"],d,e))).then(d=>d.et_EE)],["fi-fi",()=>(new Promise((d,e)=>a(["../../chunks/fi_FI"],
d,e))).then(d=>d.fi_FI)],["fr-fr",()=>(new Promise((d,e)=>a(["../../chunks/fr_FR"],d,e))).then(d=>d.fr_FR)],["he-il",()=>(new Promise((d,e)=>a(["../../chunks/he_IL"],d,e))).then(d=>d.he_IL)],["hr-hr",()=>(new Promise((d,e)=>a(["../../chunks/hr_HR"],d,e))).then(d=>d.hr_HR)],["hu-hu",()=>(new Promise((d,e)=>a(["../../chunks/hu_HU"],d,e))).then(d=>d.hu_HU)],["id-id",()=>(new Promise((d,e)=>a(["../../chunks/id_ID"],d,e))).then(d=>d.id_ID)],["it-it",()=>(new Promise((d,e)=>a(["../../chunks/it_IT"],d,e))).then(d=>
d.it_IT)],["ja-jp",()=>(new Promise((d,e)=>a(["../../chunks/ja_JP"],d,e))).then(d=>d.ja_JP)],["ko-kr",()=>(new Promise((d,e)=>a(["../../chunks/ko_KR"],d,e))).then(d=>d.ko_KR)],["lt-lt",()=>(new Promise((d,e)=>a(["../../chunks/lt_LT"],d,e))).then(d=>d.lt_LT)],["lv-lv",()=>(new Promise((d,e)=>a(["../../chunks/lv_LV"],d,e))).then(d=>d.lv_LV)],["nb-no",()=>(new Promise((d,e)=>a(["../../chunks/nb_NO"],d,e))).then(d=>d.nb_NO)],["nl-nl",()=>(new Promise((d,e)=>a(["../../chunks/nl_NL"],d,e))).then(d=>d.nl_NL)],
["pl-pl",()=>(new Promise((d,e)=>a(["../../chunks/pl_PL"],d,e))).then(d=>d.pl_PL)],["pt-br",()=>(new Promise((d,e)=>a(["../../chunks/pt_BR"],d,e))).then(d=>d.pt_BR)],["pt-pt",()=>(new Promise((d,e)=>a(["../../chunks/pt_PT"],d,e))).then(d=>d.pt_PT)],["ro-ro",()=>(new Promise((d,e)=>a(["../../chunks/ro_RO"],d,e))).then(d=>d.ro_RO)],["ru-ru",()=>(new Promise((d,e)=>a(["../../chunks/ru_RU"],d,e))).then(d=>d.ru_RU)],["sk-sk",()=>(new Promise((d,e)=>a(["../../chunks/sk_SK"],d,e))).then(d=>d.sk_SK)],["sl-sl",
()=>(new Promise((d,e)=>a(["../../chunks/sl_SL"],d,e))).then(d=>d.sl_SL)],["sr-rs",()=>(new Promise((d,e)=>a(["../../chunks/sr_RS"],d,e))).then(d=>d.sr_RS)],["sv-se",()=>(new Promise((d,e)=>a(["../../chunks/sv_SE"],d,e))).then(d=>d.sv_SE)],["th-th",()=>(new Promise((d,e)=>a(["../../chunks/th_TH"],d,e))).then(d=>d.th_TH)],["tr-tr",()=>(new Promise((d,e)=>a(["../../chunks/tr_TR"],d,e))).then(d=>d.tr_TR)],["uk-ua",()=>(new Promise((d,e)=>a(["../../chunks/uk_UA"],d,e))).then(d=>d.uk_UA)],["vi-vn",()=>
(new Promise((d,e)=>a(["../../chunks/vi_VN"],d,e))).then(d=>d.vi_VN)],["zh-cn",()=>(new Promise((d,e)=>a(["../../chunks/zh_Hans"],d,e))).then(d=>d.zh_Hans)],["zh-hk",()=>(new Promise((d,e)=>a(["../../chunks/zh_Hant"],d,e))).then(d=>d.zh_Hant)],["zh-tw",()=>(new Promise((d,e)=>a(["../../chunks/zh_Hant"],d,e))).then(d=>d.zh_Hant)]]);let g=null,f=null;b.getChartLocale=x;b.getColorSet=function(d,e="default"){const k=m.find(u=>u.name===e);return k?k.colors.map(u=>d.color(u)):null};b.loadChartsModule=async function(d=
n.getLocale()){d=x(d);if(g&&d===f)return g;g=(new Promise((e,k)=>a(["../../chunks/index2"],e,k))).then(e=>e.index);f=d;try{const [e,k]=await Promise.all([g,l.get(f)()]);f===d&&(e.am4core.options.defaultLocale=k.default);e.am4core.options.suppressWarnings=!0;e.am4core.options.autoDispose=!0}catch{return f=g=null}return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/RelationshipContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){w=function(C){function E(H){var K=F.call(this,H);K._abortController=null;K.expressionInfo=null;K.graphic=null;K.contentElement=null;K.contentElementViewModel=null;K.interceptor=null;K.view=null;K._cancelQuery=()=>{const {_abortController:I}=a._assertThisInitialized(K);I&&I.abort();K._abortController=null};K._createVM=()=>{var I=K.contentElement?.type;K.contentElementViewModel?.destroy();I="fields"===I?new v:"media"===I?new A:"text"===I?new z:
null;K._set("contentElementViewModel",I)};K._compile=async()=>{K._cancelQuery();const I=new AbortController;K._abortController=I;await K._compileExpression();K._abortController===I&&(K._abortController=null)};K._compileThrottled=m.throttle(K._compile,1,a._assertThisInitialized(K));K._compileExpression=async()=>{const {expressionInfo:I,graphic:L,interceptor:R,spatialReference:O,map:J,view:M,_abortController:G}=a._assertThisInitialized(K);if(I&&L&&O&&J){var P=await t.loadArcadeUtils();if(G===K._abortController)if((P=
await t.createCompiledExpression({arcadeUtils:P,expressionInfo:I,graphic:L,interceptor:R,map:J,spatialReference:O,view:M}))&&"esri.arcade.Dictionary"===P.declaredClass){P=await P.castAsJsonAsync(G?.signal);var U=P?.type;P="media"===U?q.fromJSON(P):"text"===U?B.fromJSON(P):"fields"===U?r.fromJSON(P):null;K._set("contentElement",P)}else K._set("contentElement",null)}else K._set("contentElement",null)};K.handles.add([x.watch(()=>[K.expressionInfo,K.graphic,K.map,K.spatialReference,K.view],()=>K._compileThrottled(),
x.initial),x.watch(()=>[K.contentElement],()=>K._createVM(),x.initial)]);return K}a._inherits(E,C);var F=a._createSuper(E);E.prototype.destroy=function(){this._cancelQuery();this.contentElementViewModel?.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(E,[{key:"spatialReference",get:function(){return this.view?.spatialReference??null},set:function(H){this._override("spatialReference",H)}},{key:"state",get:function(){const {_abortController:H,contentElement:K,
contentElementViewModel:I}=this;return H?"loading":K||I?"ready":"disabled"}},{key:"map",get:function(){return this.view?.map??null},set:function(H){this._override("map",H)}}]);return E}(n.HandleOwnerMixin(w));b.__decorate([l.property()],w.prototype,"_abortController",void 0);b.__decorate([l.property({type:D})],w.prototype,"expressionInfo",void 0);b.__decorate([l.property({type:c})],w.prototype,"graphic",void 0);b.__decorate([l.property({readOnly:!0})],w.prototype,"contentElement",void 0);b.__decorate([l.property({readOnly:!0})],
w.prototype,"contentElementViewModel",void 0);b.__decorate([l.property()],w.prototype,"interceptor",void 0);b.__decorate([l.property()],w.prototype,"spatialReference",null);b.__decorate([l.property({readOnly:!0})],w.prototype,"state",null);b.__decorate([l.property()],w.prototype,"map",null);b.__decorate([l.property()],w.prototype,"view",void 0);return w=b.__decorate([e.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],w)})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),
function(a,b,c,w,n,x){function m(p){return`<ul class="esri-widget__list">${p.map(h=>`<li>${"string"===typeof h?x.applyTextFormattingHTML(x.htmlEntities(h)):h}</li>`).join("")}</ul>`}function l(p){return`<table class="esri-widget__table">${p.keys().map(h=>{var r=p.field(h);r="string"===typeof r?x.applyTextFormattingHTML(x.htmlEntities(r)):r;return`<tr><th>${h}</th><td>${r}</td></tr>`}).join("")}</table>`}function g({aggregatedFeatures:p,arcadeUtils:h,featureSetVars:r,context:q,viewInfo:y,map:B,graphic:D,
interceptor:z}){r.forEach(v=>{v=v.toLowerCase();var A=y.sr;const t={map:B,spatialReference:A,interceptor:z};"$map"===v&&(q.vars[v]=h.convertMapToFeatureSetCollection(t));"$layer"===v&&(q.vars[v]=h.convertFeatureLayerToFeatureSet({layer:D.sourceLayer,spatialReference:A,interceptor:z}));"$datastore"===v&&(q.vars[v]=h.convertServiceUrlToWorkspace({url:D.sourceLayer.url,spatialReference:A,interceptor:z}));if("$aggregatedfeatures"===v){A=D.layer;const {fields:C,objectIdField:E,geometryType:F,spatialReference:H,
displayField:K}=A;A=new n({fields:C,objectIdField:E,geometryType:F,spatialReference:H,displayField:K,...("feature"===A.type?{templates:A.templates,typeIdField:A.typeIdField,types:A.types}:null),source:p});q.vars[v]=h.convertFeatureLayerToFeatureSet({layer:A,spatialReference:H,interceptor:z})}})}function f(){return new Promise((p,h)=>a(["../../../support/arcadeUtils"],p,h))}async function d({graphic:p,view:h}){const {isAggregate:r,layer:q}=p;if(!r||!q||"2d"!==h?.type)return[];h=await h.whenLayerView(q);
if(!("createQuery"in h&&"queryFeatures"in h))return[];const y=h.createQuery();p=p.getObjectId();y.aggregateIds=null!=p?[p]:[];({features:p}=await h.queryFeatures(y));return p}async function e({expressionInfo:p,arcadeUtils:h,interceptor:r,spatialReference:q,map:y,graphic:B,view:D}){if(!p||!p.expression)return null;const z=h.createSyntaxTree(p.expression),v=k.filter(t=>h.hasVariable(z,t));[D]=await Promise.all([d({graphic:B,view:D}),h.loadScriptDependencies(z,!0,v)]);const A=h.getViewInfo({spatialReference:q});
q=h.createExecContext(B,A);q.interceptor=r;q.useAsync=!0;g({aggregatedFeatures:D,arcadeUtils:h,featureSetVars:v,context:q,viewInfo:A,map:y,graphic:B,interceptor:r});r=h.createFunction(z,q);return h.executeAsyncFunction(r,q).catch(t=>u.error("arcade-execution-error",{error:t,graphic:B,expressionInfo:p}))}const k=["$datastore","$map","$layer","$aggregatedfeatures"],u=c.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");b.createCompiledExpression=e;b.createCompiledExpressions=async function({expressionInfos:p,
spatialReference:h,graphic:r,interceptor:q,map:y,view:B}){if(!p||!p.length)return{};const D=await f(),z={};for(const v of p)z[`expression/${v.name}`]=e({expressionInfo:v,arcadeUtils:D,interceptor:q,spatialReference:h,map:y,graphic:r,view:B});p=await w.eachAlways(z);h={};for(const v in p)r=p[v].value,r="string"===typeof r?x.applyTextFormattingHTML(x.htmlEntities(r)):Array.isArray(r)?m(r):"esri.arcade.Dictionary"===r?.declaredClass?l(r):r,h[v]=r;return h};b.loadArcadeUtils=f;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureRelationship":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureRelationship/FeatureRelationshipViewModel ./support/FeatureElementInfo ../support/componentsUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){const D={title:!0,description:!0};w=function(z){function v(t,C){var E=A.call(this,t,C);E._featureElementInfo=null;E._relatedFeatureIntersectionObserverNode=null;E._relatedFeatureIntersectionObserver=new IntersectionObserver(([F])=>{F?.isIntersecting&&E._increaseFeaturePage()},{root:window.document});E.headingLevel=2;E.viewModel=new u;E.messages=null;E.messagesCommon=null;E.visibleElements={...D};E._increaseFeaturePage=()=>{const {state:F,showAllEnabled:H,
relatedFeatures:K,featuresPerPage:I,featurePage:L}=E.viewModel;"ready"===F&&H&&K.length>=I*L&&E.viewModel.featurePage++};return E}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.initialize=function(){this._featureElementInfo=new p;this.addHandles([m.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),m.initial),m.watch(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),
m.on(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])};z.loadDependencies=function(){return h.loadCalciteComponents({icon:()=>new Promise((t,C)=>a(["../../chunks/calcite-icon"],t,C)),list:()=>new Promise((t,C)=>a(["../../chunks/calcite-list"],t,C)),"list-item":()=>new Promise((t,C)=>a(["../../chunks/calcite-list-item"],t,C)),notice:()=>new Promise((t,C)=>a(["../../chunks/calcite-notice"],t,C))})};z.destroy=function(){this._unobserveRelatedFeatureObserver();
this._featureElementInfo=n.destroyMaybe(this._featureElementInfo)};z.castVisibleElements=function(t){return{...D,...t}};z.renderStickyLoading=function(){return"querying"===this.viewModel.state?y.tsx("div",{key:"sticky-loader",class:"esri-feature__sticky-loading-container"},this.renderLoadingIcon()):null};z.renderLoadingIcon=function(){return y.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})};z.renderLoading=function(){return y.tsx("div",
{key:"loading-container",class:"esri-feature__loading-container"},this.renderLoadingIcon())};z.renderShowAllIconNode=function(){return y.tsx("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})};z.renderChevronIconNode=function(){const t=r.isRTL(this.container)?"chevron-left":"chevron-right";return y.tsx("calcite-icon",{scale:"s",icon:t,slot:"content-end"})};z.renderRelatedFeature=function(t){var {itemDescriptionFieldName:C}=this.viewModel;const E=t.title;t.description=C&&t.formattedAttributes?.global[C];
C="loading"===t.state;return y.tsx("calcite-list-item",{key:t.uid,label:C?`${this.messagesCommon?.loading}\u2026`:E,description:C?"\u2026":t.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:t})},this.renderChevronIconNode())};z.renderShowAllListItem=function(){return this.displayShowAllButton?y.tsx("calcite-list-item",{key:"show-all-item",label:this.messages?.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},
this.renderShowAllIconNode()):null};z.renderNoRelatedFeaturesMessage=function(){return y.tsx("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},y.tsx("div",{slot:"message"},this.messages?.noRelatedFeatures))};z.renderFeatureObserver=function(){return y.tsx("div",{key:"feature-observer",class:"esri-feature__feature-observer",bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})};z.renderList=function(){const {relatedFeatureViewModels:t}=
this.viewModel;return y.tsx("calcite-list",null,t.toArray().map(C=>this.renderRelatedFeature(C)),this.renderShowAllListItem())};z.renderRelatedFeatures=function(){const {displayListItems:t}=this,{state:C}=this.viewModel;return y.tsx("div",{key:"list-container",class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===C})},t?this.renderList():"ready"===C?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())};
z.renderRelationshipNotFound=function(){return y.tsx("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},y.tsx("div",{slot:"message"},this.messages?.relationshipNotFound))};z.render=function(){const {state:t}=this.viewModel;return y.tsx("div",{class:this.classes("esri-feature-relationship","esri-widget")},this._featureElementInfo?.render(),"loading"===t?this.renderLoading():"disabled"===t?this.renderRelationshipNotFound():this.renderRelatedFeatures())};
z._setupRelatedFeatureViewModels=function(){const {relatedFeatureViewModels:t}=this.viewModel;this.removeHandles("related-feature-viewmodels");t?.forEach(C=>{this.addHandles(m.watch(()=>[C.title,C.state],()=>this.scheduleRender(),m.initial),"related-feature-viewmodels")});this.scheduleRender()};z._setupFeatureElementInfo=function(){const {headingLevel:t,visibleElements:C}=this,E=C.description&&this.description,F=C.title&&this.title;this._featureElementInfo?.set({description:E,title:F,headingLevel:t})};
z._handleRelatedFeatureObserverChange=async function(){this._unobserveRelatedFeatureObserver();const {state:t,showAllEnabled:C}=this.viewModel;await x.after(0);this._relatedFeatureIntersectionObserverNode&&"ready"===t&&C&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)};z._relatedFeatureIntersectionObserverCreated=function(t){this._relatedFeatureIntersectionObserverNode=t};z._unobserveRelatedFeatureObserver=function(){this._relatedFeatureIntersectionObserverNode&&
this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)};b._createClass(v,[{key:"displayShowAllButton",get:function(){const {showAllEnabled:t,featureCount:C,displayCount:E}=this.viewModel;return!t&&!!C&&(C>E||0===E)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||0<this.viewModel.relatedFeatureViewModels.length}},{key:"description",get:function(){return this.viewModel.description},set:function(t){this.viewModel.description=t}},{key:"featureCountDescription",
get:function(){const {messages:t}=this,{featureCount:C}=this.viewModel;return B.substitute(1===C?t?.numberRecord:t?.numberRecords,{number:C})}},{key:"title",get:function(){return this.viewModel.title},set:function(t){this.viewModel.title=t}}]);return v}(k);c.__decorate([l.property()],w.prototype,"_relatedFeatureIntersectionObserverNode",void 0);c.__decorate([l.property({readOnly:!0})],w.prototype,"displayShowAllButton",null);c.__decorate([l.property({readOnly:!0})],w.prototype,"displayListItems",
null);c.__decorate([l.property()],w.prototype,"description",null);c.__decorate([l.property({readOnly:!0})],w.prototype,"featureCountDescription",null);c.__decorate([l.property()],w.prototype,"headingLevel",void 0);c.__decorate([l.property()],w.prototype,"title",null);c.__decorate([l.property({type:u})],w.prototype,"viewModel",void 0);c.__decorate([l.property(),q.messageBundle("esri/widgets/Feature/t9n/Feature")],w.prototype,"messages",void 0);c.__decorate([l.property(),q.messageBundle("esri/t9n/common")],
w.prototype,"messagesCommon",void 0);c.__decorate([l.property()],w.prototype,"visibleElements",void 0);c.__decorate([g.cast("visibleElements")],w.prototype,"castVisibleElements",null);return w=c.__decorate([e.subclass("esri.widgets.Feature.FeatureRelationship")],w)})},"esri/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/Clonable ../../../core/Collection ../../../core/HandleOwner ../../../core/Identifiable ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../rest/support/RelationshipQuery ../support/featureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){w=function(B){function D(v){var A=z.call(this,v);A._queryAbortController=null;A._queryPageAbortController=null;A._queryFeatureCountAbortController=null;A.featuresPerPage=10;A.description=null;A.graphic=null;A.layer=null;A.map=null;A.orderByFields=null;A.featureCount=0;A.relationshipId=null;A.showAllEnabled=!1;A.title=null;A._cancelQuery=()=>{const {_queryAbortController:t}=a._assertThisInitialized(A);t&&t.abort();A._queryAbortController=null};A._cancelQueryFeatureCount=
()=>{const {_queryFeatureCountAbortController:t}=a._assertThisInitialized(A);t&&t.abort();A._queryFeatureCountAbortController=null};A._cancelQueryPage=()=>{const {_queryPageAbortController:t}=a._assertThisInitialized(A);t&&t.abort();A._queryPageAbortController=null};A._queryController=async()=>{A._cancelQuery();const t=new AbortController;A._queryAbortController=t;await f.ignoreAbortErrors(A._query());A._queryAbortController===t&&(A._queryAbortController=null)};A._queryFeatureCountController=async()=>
{A._cancelQueryFeatureCount();const t=new AbortController;A._queryFeatureCountAbortController=t;await f.ignoreAbortErrors(A._queryFeatureCount());A._queryFeatureCountAbortController===t&&(A._queryFeatureCountAbortController=null)};A._queryPageController=async()=>{const t=new AbortController;A._queryPageAbortController=t;await f.ignoreAbortErrors(A._queryPage());A._queryPageAbortController===t&&(A._queryPageAbortController=null)};A._queryThrottled=e.throttle(A._queryController,100,a._assertThisInitialized(A));
A._queryFeatureCountThrottled=e.throttle(A._queryFeatureCountController,100,a._assertThisInitialized(A));A._queryPageThrottled=e.throttle(A._queryPageController,100,a._assertThisInitialized(A));A._query=async()=>{const {_queryAbortController:t,relatedFeatures:C}=a._assertThisInitialized(A);A._destroyRelatedFeatureViewModels();A.featurePage=1;C.removeAll();C.addMany(A._sliceFeatures(await A._queryRelatedFeatures({signal:t?.signal})))};A.handles.add([d.watch(()=>[A.displayCount,A.graphic,A.layer,A.map,
A.orderByFieldsFixedCasing,A.relationshipId,A.featuresPerPage,A.showAllEnabled,A.canQuery,A.featureCount],()=>A._queryThrottled(),d.initial),d.watch(()=>[A.featurePage,A.showAllEnabled],()=>A._queryPageThrottled()),d.watch(()=>[A.layer,A.relationshipId,A.objectId,A.canQuery],()=>A._queryFeatureCountThrottled())]);return A}a._inherits(D,B);var z=a._createSuper(D);B=D.prototype;B.destroy=function(){this._destroyRelatedFeatureViewModels();this.relatedFeatures.removeAll();this._cancelQuery();this._cancelQueryFeatureCount();
this._cancelQueryPage()};B._destroyRelatedFeatureViewModels=function(){this.relatedFeatureViewModels?.forEach(v=>!v.destroyed&&v.destroy());this.relatedFeatureViewModels.removeAll()};B._queryFeatureCount=async function(){const {layer:v,relatedLayer:A,relationshipId:t,objectId:C,_queryFeatureCountAbortController:E,canQuery:F,supportsCacheHint:H}=this;await v?.load();await A?.load();if(F&&v&&A){var K=A.createQuery();K=new q({cacheHint:H,relationshipId:t,returnGeometry:!1,objectIds:[C],where:g.unwrapOrValue(K.where,
void 0)});K=await v.queryRelatedFeaturesCount(K,{signal:E?.signal});this._set("featureCount",K[C]||0)}else this._set("featureCount",0)};B._sliceFeatures=function(v){const {showAllEnabled:A,displayCount:t}=this;return A?v:t?v.slice(0,t):[]};B._queryPage=async function(){const {relatedFeatures:v,featurePage:A,showAllEnabled:t,_queryPageAbortController:C}=this;!t||2>A||v.addMany(await this._queryRelatedFeatures({signal:C?.signal}))};B._queryRelatedFeatures=async function(v){const {orderByFieldsFixedCasing:A,
showAllEnabled:t,featuresPerPage:C,displayCount:E,layer:F,relationshipId:H,featurePage:K,featureCount:I,relatedLayer:L,supportsCacheHint:R}=this,{canQuery:O,objectId:J}=this;if(!O||!F||!L)return[];var M=t?((K-1)*C+I)%I:0;const G=t?C:E;var P=L.objectIdField;P=[...A.map(S=>S.field),P].filter(g.isSome);const U=A.map(S=>`${S.field} ${S.order}`),N=L.createQuery();M=new q({orderByFields:U,start:M,num:G,outFields:P,cacheHint:R,relationshipId:H,returnGeometry:!1,objectIds:[J],where:g.unwrapOrValue(N.where,
void 0)});v=(await F.queryRelatedFeatures(M,{signal:v?.signal}))[J]?.features||[];v.forEach(S=>{S.sourceLayer=L;S.layer=L});return v};a._createClass(D,[{key:"featurePage",get:function(){return this._get("featurePage")},set:function(v){const {featuresPerPage:A,featureCount:t}=this;this._set("featurePage",Math.min(Math.max(v,1),Math.ceil(t/A)||1))}},{key:"orderByFieldsFixedCasing",get:function(){const {orderByFields:v,relatedLayer:A}=this;return v&&A?.loaded?v.map(t=>{const C=t.clone();C.field=y.getFixedFieldName(t.field,
A);return C}):v??[]}},{key:"supportsCacheHint",get:function(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}},{key:"canQuery",get:function(){const v=this.layer?.capabilities?.queryRelated;return!!this.relatedLayer&&!!this.relationship&&"number"===typeof this.relationshipId&&"number"===typeof this.objectId&&!!v?.supportsCount&&!!v?.supportsPagination}},{key:"itemDescriptionFieldName",get:function(){return this.orderByFieldsFixedCasing[0]?.field||null}},{key:"displayCount",get:function(){return this._get("displayCount")},
set:function(v){this._set("displayCount",Math.min(Math.max(v,0),10))}},{key:"objectId",get:function(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}},{key:"objectIdField",get:function(){return this.layer?.objectIdField||null}},{key:"relatedFeatures",get:function(){return this._get("relatedFeatures")||new x}},{key:"relatedLayer",get:function(){const {layer:v,map:A,relationship:t}=this;return v?.loaded&&A&&t?y.findRelatedLayer(A,v,t)??null:null}},{key:"relationship",
get:function(){const {relationshipId:v,layer:A}=this;return"number"===typeof v?A?.relationships?.find(({id:t})=>t===v)??null:null}},{key:"relatedFeatureViewModels",get:function(){return this._get("relatedFeatureViewModels")||new x}},{key:"state",get:function(){const {_queryAbortController:v,_queryFeatureCountAbortController:A,_queryPageAbortController:t,canQuery:C}=this;return A?"loading":v||t?"querying":C?"ready":"disabled"}}]);return D}(n.ClonableMixin(l.IdentifiableMixin(m.HandleOwnerMixin(w))));
b.__decorate([k.property()],w.prototype,"_queryAbortController",void 0);b.__decorate([k.property()],w.prototype,"_queryPageAbortController",void 0);b.__decorate([k.property()],w.prototype,"_queryFeatureCountAbortController",void 0);b.__decorate([k.property({value:1})],w.prototype,"featurePage",null);b.__decorate([k.property()],w.prototype,"featuresPerPage",void 0);b.__decorate([k.property({readOnly:!0})],w.prototype,"orderByFieldsFixedCasing",null);b.__decorate([k.property({readOnly:!0})],w.prototype,
"supportsCacheHint",null);b.__decorate([k.property({readOnly:!0})],w.prototype,"canQuery",null);b.__decorate([k.property()],w.prototype,"description",void 0);b.__decorate([k.property({readOnly:!0})],w.prototype,"itemDescriptionFieldName",null);b.__decorate([k.property({value:3})],w.prototype,"displayCount",null);b.__decorate([k.property({type:c})],w.prototype,"graphic",void 0);b.__decorate([k.property()],w.prototype,"layer",void 0);b.__decorate([k.property()],w.prototype,"map",void 0);b.__decorate([k.property({readOnly:!0})],
w.prototype,"objectId",null);b.__decorate([k.property({readOnly:!0})],w.prototype,"objectIdField",null);b.__decorate([k.property()],w.prototype,"orderByFields",void 0);b.__decorate([k.property({readOnly:!0})],w.prototype,"relatedFeatures",null);b.__decorate([k.property({readOnly:!0})],w.prototype,"relatedLayer",null);b.__decorate([k.property({readOnly:!0})],w.prototype,"relationship",null);b.__decorate([k.property()],w.prototype,"featureCount",void 0);b.__decorate([k.property({readOnly:!0})],w.prototype,
"relatedFeatureViewModels",null);b.__decorate([k.property()],w.prototype,"relationshipId",void 0);b.__decorate([k.property()],w.prototype,"showAllEnabled",void 0);b.__decorate([k.property()],w.prototype,"state",null);b.__decorate([k.property()],w.prototype,"title",void 0);return w=b.__decorate([r.subclass("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],w)})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Identifiable ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./FeatureRelationship/FeatureRelationshipViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E){var F;const H={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};n=F=function(K){function I(R){var O=L.call(this,R);O._handles=new x;O._error=null;O._featureAbortController=null;O._graphicChangedThrottled=e.throttle(O._graphicChanged,1,a._assertThisInitialized(O));O._expressionAttributes=null;O._graphicExpressionAttributes=null;O.abilities=
{...H};O.content=null;O.contentViewModels=[];O.description=null;O.defaultPopupTemplateEnabled=!1;O.formattedAttributes=null;O.lastEditInfo=null;O.relatedInfos=new Map;O.title="";O.view=null;O._isAllowedContentType=J=>{const {abilities:M}=a._assertThisInitialized(O);return"attachments"===J.type&&!!M.attachmentsContent||"custom"===J.type&&!!M.customContent||"fields"===J.type&&!!M.fieldsContent||"media"===J.type&&!!M.mediaContent||"text"===J.type&&!!M.textContent||"expression"===J.type&&!!M.expressionContent||
"relationship"===J.type&&!!M.relationshipContent};O._handles.add(d.watch(()=>[O.graphic,O._effectivePopupTemplate,O.abilities],()=>O._graphicChangedThrottled(),d.initial));return O}a._inherits(I,K);var L=a._createSuper(I);K=I.prototype;K.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=null;this._destroyContentViewModels();this.relatedInfos.clear()};K.castAbilities=function(R){return{...H,...R}};K.setActiveMedia=function(R,O){R=this.contentViewModels[R];
R instanceof v&&R.setActiveMedia(O)};K.nextMedia=function(R){R=this.contentViewModels[R];R instanceof v&&R.next()};K.previousMedia=function(R){R=this.contentViewModels[R];R instanceof v&&R.previous()};K.updateGeometry=async function(){const {graphic:R,spatialReference:O,_sourceLayer:J}=this;await J?.load();var M=J?.objectIdField;M&&R&&J&&(M=R?.attributes?.[M],null!=M&&(M=[M],!R.geometry&&(M=(await C.querySourceLayer({layer:J,graphic:R,outFields:[],objectIds:M,returnGeometry:!0,spatialReference:O}))?.geometry)))&&
(R.geometry=M)};K._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};K._graphicChanged=async function(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:R}=this;if(R){var O=new AbortController;this._featureAbortController=O;try{await this._queryFeature({signal:O.signal})}catch(J){f.isAbortError(J)||(this._error=J,l.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:J,
graphic:R,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===O&&(this._featureAbortController=null)}};K._cancelFeatureQuery=function(){const {_featureAbortController:R}=this;R&&R.abort();this._featureAbortController=null};K._compileContentElement=function(R,O){if("attachments"===R.type)return this._compileAttachments(R,O);if("custom"===R.type)return this._compileCustom(R,O);if("fields"===R.type)return this._compileFields(R,O);if("media"===R.type)return this._compileMedia(R,
O);if("text"===R.type)return this._compileText(R,O);if("expression"===R.type)return this._compileExpression(R,O);if("relationship"===R.type)return this._compileRelationship(R,O)};K._compileContent=function(R){this._destroyContentViewModels();if(this.graphic)return Array.isArray(R)?R.filter(this._isAllowedContentType).map((O,J)=>this._compileContentElement(O,J)).filter(g.isSome):"string"===typeof R?this._compileText(new q({text:R}),0).text:R};K._destroyContentViewModels=function(){this._handles?.remove("relationship-view-models");
this._handles?.remove("content-view-models");this.contentViewModels.forEach(R=>R&&!R.destroyed&&R.destroy());this._set("contentViewModels",[])};K._matchesFeature=function(R,O){R=R?.graphic?.getObjectId();O=O?.getObjectId();return g.isSome(R)&&g.isSome(O)&&R===O};K._setRelatedFeaturesViewModels=function({relatedFeatureViewModels:R,relatedFeatures:O,map:J}){const {view:M,spatialReference:G}=this;O?.filter(Boolean).forEach(P=>{R.find(U=>this._matchesFeature(U,P))||R.add(new F({abilities:{relationshipContent:!1},
map:J,view:M,spatialReference:G,graphic:P}))});R.forEach(P=>{O?.find(U=>this._matchesFeature(P,U))||R.remove(P)})};K._setExpressionContentVM=function(R,O){const J=this.formattedAttributes,{contentElement:M,contentElementViewModel:G}=R;R=M?.type;G&&R&&("fields"===R&&(this._createFieldsFormattedAttributes({contentElement:M,contentElementIndex:O,formattedAttributes:J}),G.set(this._createFieldsVMParams(M,O))),"media"===R&&(this._createMediaFormattedAttributes({contentElement:M,contentElementIndex:O,formattedAttributes:J}),
G.set(this._createMediaVMParams(M,O))),"text"===R&&G.set(this._createTextVMParams(M)))};K._compileRelationship=function(R,O){const {displayCount:J,orderByFields:M,relationshipId:G,title:P,description:U}=R,{_sourceLayer:N,graphic:S,map:Q}=this,W=new A({displayCount:J,graphic:S,orderByFields:M,relationshipId:G,layer:N,map:Q,...this._compileTitleAndDesc({title:P,description:U})});this.contentViewModels[O]=W;this._handles.add(d.on(()=>W.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(W)),
"relationship-view-models");return R};K._compileExpression=function(R,O){const {expressionInfo:J}=R,{graphic:M,map:G,spatialReference:P,view:U}=this,N=new D({expressionInfo:J,graphic:M,interceptor:F.interceptor,map:G,spatialReference:P,view:U});this.contentViewModels[O]=N;this._handles.add(d.watch(()=>N.contentElementViewModel,()=>this._setExpressionContentVM(N,O),d.initial),"content-view-models");return R};K._compileAttachments=function(R,O){const {graphic:J}=this,{description:M,title:G}=R;this.contentViewModels[O]=
new y({graphic:J,...this._compileTitleAndDesc({title:G,description:M})});return R};K._compileCustom=function(R,O){const {graphic:J}=this,{creator:M,destroyer:G}=R;this.contentViewModels[O]=new B({graphic:J,creator:M,destroyer:G});return R};K._compileTitleAndDesc=function({title:R,description:O}){const {_fieldInfoMap:J,_sourceLayer:M,graphic:G,formattedAttributes:P}=this,U=G?.attributes,N=this._expressionAttributes,S=P.global;return{title:C.substituteFieldsInLinksAndAttributes({attributes:U,fieldInfoMap:J,
globalAttributes:S,expressionAttributes:N,layer:M,text:R}),description:C.substituteFieldsInLinksAndAttributes({attributes:U,fieldInfoMap:J,globalAttributes:S,expressionAttributes:N,layer:M,text:O})}};K._createFieldsVMParams=function(R,O){const J=this._effectivePopupTemplate,M=this.formattedAttributes,G={...M?.global,...M?.content[O]};O=(R?.fieldInfos||J?.fieldInfos)?.filter(({fieldName:N})=>C.isExpressionField(N)||C.isRelatedField(N)||G.hasOwnProperty(N));const {description:P,title:U}=R;return{attributes:G,
expressionInfos:J?.expressionInfos,fieldInfos:O,...this._compileTitleAndDesc({title:U,description:P})}};K._compileFields=function(R,O){const J=R.clone();R=new z(this._createFieldsVMParams(R,O));this.contentViewModels[O]=R;J.fieldInfos=R.formattedFieldInfos.slice(0);return J};K._createMediaVMParams=function(R,O){const {abilities:J,graphic:M,_fieldInfoMap:G,_effectivePopupTemplate:P,relatedInfos:U,_sourceLayer:N,_expressionAttributes:S}=this,Q=this.formattedAttributes,W=M?.attributes??{},{description:V,
mediaInfos:T,title:X}=R;return{abilities:{chartAnimation:J.chartAnimation},activeMediaInfoIndex:R.activeMediaInfoIndex||0,attributes:W,isAggregate:M?.isAggregate,layer:N,fieldInfoMap:G,formattedAttributes:{...Q?.global,...Q?.content[O]},expressionAttributes:S,mediaInfos:T,popupTemplate:P,relatedInfos:U,...this._compileTitleAndDesc({title:X,description:V})}};K._compileMedia=function(R,O){const J=R.clone();R=new v(this._createMediaVMParams(R,O));J.mediaInfos=R.formattedMediaInfos.slice(0);this.contentViewModels[O]=
R;return J};K._createTextVMParams=function(R){const {graphic:O,_fieldInfoMap:J,_sourceLayer:M,_expressionAttributes:G}=this;R&&R.text&&(R.text=C.substituteFieldsInLinksAndAttributes({attributes:O?.attributes??{},fieldInfoMap:J,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:G,layer:M,text:R.text}));return{graphic:O,creator:R.text}};K._compileText=function(R,O){R=R.clone();this.contentViewModels[O]=new B(this._createTextVMParams(R));return R};K._compileLastEditInfo=function(){const {_effectivePopupTemplate:R,
_sourceLayer:O,graphic:J}=this;if(R){var {lastEditInfoEnabled:M}=R,G=O?.editFieldsInfo;if(M&&G)return C.formatEditInfo(G,J?.attributes)}};K._compileTitle=function(R){const {_fieldInfoMap:O,_sourceLayer:J,graphic:M,_expressionAttributes:G}=this;return C.substituteFieldsInLinksAndAttributes({attributes:M?.attributes??{},fieldInfoMap:O,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:G,layer:J,text:R})};K._getTitle=async function(){const {_effectivePopupTemplate:R,graphic:O}=
this;return O?C.graphicCallback(R?.title,{graphic:O}):null};K._getContent=async function(){const {_effectivePopupTemplate:R,graphic:O}=this;return O?C.graphicCallback(R?.content,{graphic:O}):null};K._queryFeature=async function(R){const {_featureAbortController:O,_sourceLayer:J,graphic:M,_effectivePopupTemplate:G}=this,P=this.map,U=this.view,N=this.spatialReference;if(O===this._featureAbortController&&M){await C.queryUpdatedFeature({graphic:M,popupTemplate:G,layer:J,spatialReference:N},R);var {content:{value:S},
title:{value:Q}}=await f.eachAlways({content:this._getContent(),title:this._getTitle()});({expressionAttributes:{value:R}}=await f.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(R),expressionAttributes:t.createCompiledExpressions({expressionInfos:G?.expressionInfos,spatialReference:N,graphic:M,map:P,interceptor:F.interceptor,view:U})}));O===this._featureAbortController&&M&&(this._expressionAttributes=R,this._graphicExpressionAttributes={...M.attributes,...R},this._set("formattedAttributes",
this._createFormattedAttributes(S)),this._set("title",this._compileTitle(Q)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(S)||null))}};K._createMediaFormattedAttributes=function({contentElement:R,contentElementIndex:O,formattedAttributes:J}){const {_effectivePopupTemplate:M,graphic:G,relatedInfos:P,_sourceLayer:U,_fieldInfoMap:N,_graphicExpressionAttributes:S}=this;J.content[O]=C.formatAttributes({fieldInfos:M?.fieldInfos,graphic:G,attributes:{...S,
...R.attributes},layer:U,fieldInfoMap:N,relatedInfos:P})};K._createFieldsFormattedAttributes=function({contentElement:R,contentElementIndex:O,formattedAttributes:J}){if(R.fieldInfos){const {graphic:M,relatedInfos:G,_sourceLayer:P,_fieldInfoMap:U,_graphicExpressionAttributes:N}=this;J.content[O]=C.formatAttributes({fieldInfos:R.fieldInfos,graphic:M,attributes:{...N,...R.attributes},layer:P,fieldInfoMap:U,relatedInfos:G})}};K._createFormattedAttributes=function(R){const {_effectivePopupTemplate:O,graphic:J,
relatedInfos:M,_sourceLayer:G,_fieldInfoMap:P,_graphicExpressionAttributes:U}=this,N={global:C.formatAttributes({fieldInfos:O?.fieldInfos,graphic:J,attributes:U,layer:G,fieldInfoMap:P,relatedInfos:M}),content:[]};Array.isArray(R)&&R.forEach((S,Q)=>{"fields"===S.type&&this._createFieldsFormattedAttributes({contentElement:S,contentElementIndex:Q,formattedAttributes:N});"media"===S.type&&this._createMediaFormattedAttributes({contentElement:S,contentElementIndex:Q,formattedAttributes:N})});return N};
K._checkForRelatedFeatures=function(R){const {graphic:O,_effectivePopupTemplate:J}=this;return this._queryRelatedInfos(O,C.getAllFieldInfos(J),R)};K._queryRelatedInfos=async function(R,O,J){const {relatedInfos:M,_sourceLayer:G}=this;M.clear();const P=g.isSome(G?.associatedLayer)?await G?.associatedLayer.load(J):G;if(P&&R){var U=O.filter(Q=>Q&&C.isRelatedField(Q.fieldName));if(U&&U.length){O.forEach(Q=>this._configureRelatedInfo(Q,P));var N=await E.queryLayerInfos({relatedInfos:M,layer:P},J);Object.keys(N).forEach(Q=>
{const W=M.get(Q.toString());Q=N[Q]?.value;W&&Q&&(W.layerInfo=Q.data)});var S=await E.queryRelatedFeatures({graphic:R,relatedInfos:M,layer:P},J);Object.keys(S).forEach(Q=>{E.setRelatedFeatures(S[Q]?.value,M.get(Q.toString()))})}}};K._configureRelatedInfo=function(R,O){const {relatedInfos:J}=this,M=E.getRelatedFieldInfo(R.fieldName);if(M){var {layerId:G,fieldName:P}=M;G&&(O=J.get(G.toString())||E.createRelatedInfo(G,O))&&(E.updateRelatedInfo({relatedInfo:O,fieldName:P,fieldInfo:R}),this.relatedInfos.set(G,
O))}};a._createClass(I,[{key:"_effectivePopupTemplate",get:function(){return g.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return C.createfieldInfoMap(C.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return C.getSourceLayer(this.graphic)}},{key:"isTable",get:function(){return this._sourceLayer?.isTable||!1}},{key:"state",get:function(){return this.graphic?
this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(R){this._set("graphic",R?R.clone():null)}},{key:"spatialReference",get:function(){return this.view?.spatialReference??null},set:function(R){this._override("spatialReference",R)}},{key:"map",get:function(){return this.view?.map||null},set:function(R){this._override("map",R)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return I}(m.IdentifiableMixin(n));n.interceptor=
new w.FeatureSetQueryInterceptor(C.preLayerQueryCallback,C.preRequestCallback);b.__decorate([k.property()],n.prototype,"_error",void 0);b.__decorate([k.property()],n.prototype,"_featureAbortController",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"_effectivePopupTemplate",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"_fieldInfoMap",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"_sourceLayer",null);b.__decorate([k.property()],n.prototype,"abilities",void 0);
b.__decorate([u.cast("abilities")],n.prototype,"castAbilities",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"content",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"contentViewModels",void 0);b.__decorate([k.property()],n.prototype,"description",void 0);b.__decorate([k.property({type:Boolean})],n.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"isTable",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"state",
null);b.__decorate([k.property({readOnly:!0})],n.prototype,"formattedAttributes",void 0);b.__decorate([k.property({type:c,value:null})],n.prototype,"graphic",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"lastEditInfo",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"relatedInfos",void 0);b.__decorate([k.property()],n.prototype,"spatialReference",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"title",void 0);b.__decorate([k.property()],n.prototype,"map",null);
b.__decorate([k.property({readOnly:!0})],n.prototype,"waitingForContent",null);b.__decorate([k.property()],n.prototype,"view",void 0);return n=F=b.__decorate([r.subclass("esri.widgets.FeatureViewModel")],n)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,w){this.preLayerQueryCallback=c;this.preRequestCallback=w;this.preLayerQueryCallback||(this.preLayerQueryCallback=n=>
{});this.preRequestCallback||(this.preLayerQueryCallback=n=>{})});a.FeatureSetQueryInterceptor=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/resources":function(){define(["exports"],function(a){a.CSS={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",
btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../resources ../../support/widget ../../support/jsxFactory".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e){a.FeatureContentMixin=
k=>{k=function(u){function p(){var r=h.apply(this,arguments);r.renderNodeContent=q=>d.isWidget(q)&&!q.destroyed?e.tsx("div",{class:f.CSS.contentNode,key:q},q.render()):q instanceof HTMLElement?e.tsx("div",{class:f.CSS.contentNode,key:q,bind:q,afterCreate:r._attachToNode}):d.hasDomNode(q)?e.tsx("div",{class:f.CSS.contentNode,key:q,bind:q.domNode,afterCreate:r._attachToNode}):null;return r}b._inherits(p,u);var h=b._createSuper(p);p.prototype._attachToNode=function(r){r.appendChild(this)};return b._createClass(p)}(k);
return k=c.__decorate([g.subclass("esri.widgets.Feature.ContentMixin")],k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ./support/jsxFactory".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){m=function(p){function h(q,y){q=r.call(this,q,y);q._animationDelay=500;q._animationPromise=null;q.viewModel=new e;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.initialize=function(){this.addHandles(n.watch(()=>this.visible,q=>this._visibleChange(q)))};p.destroy=function(){this._animationPromise=null};p.show=function(q){const {location:y,promise:B}=q??{};y&&(this.viewModel.location=y);this.visible=!0;q=()=>this.hide();B&&B.catch(()=>{}).then(q)};
p.hide=function(){this.visible=!1};p.render=function(){var {visible:q}=this,{screenLocation:y}=this.viewModel;y=!!y;q={["esri-spinner--start"]:q&&y,["esri-spinner--finish"]:!q&&y};y=this._getPositionStyles();return u.tsx("div",{class:this.classes("esri-spinner",q),styles:y})};p._visibleChange=function(q){if(q)this.viewModel.screenLocationEnabled=!0;else{var y=w.after(this._animationDelay);this._animationPromise=y;y.catch(()=>{}).then(()=>{this._animationPromise===y&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};p._getPositionStyles=function(){const {screenLocation:q,view:y}=this.viewModel;if(c.isNone(y)||c.isNone(q))return{};const {padding:B}=y;return{left:`${q.x-B.left}px`,top:`${q.y-B.top}px`}};a._createClass(h,[{key:"location",get:function(){return this.viewModel.location},set:function(q){this.viewModel.location=q}},{key:"view",get:function(){return this.viewModel.view},set:function(q){this.viewModel.view=q}},{key:"visible",get:function(){return this.viewModel.visible},
set:function(q){this.viewModel.visible=q}}]);return h}(d);b.__decorate([x.property()],m.prototype,"location",null);b.__decorate([x.property()],m.prototype,"view",null);b.__decorate([x.property({type:e})],m.prototype,"viewModel",void 0);b.__decorate([x.property()],m.prototype,"visible",null);return m=b.__decorate([f.subclass("esri.widgets.Spinner")],m)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),
function(a,b,c,w,n,x,m,l){w=function(g){function f(e){e=d.call(this,e);e.visible=!1;return e}a._inherits(f,g);var d=a._createSuper(f);return a._createClass(f)}(l);b.__decorate([c.property()],w.prototype,"visible",void 0);return w=b.__decorate([m.subclass("esri.widgets.CompassViewModel")],w)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){const e=Symbol("anchorHandles");c=function(u){function p(r){var q=h.call(this,r);q[k]=new w;q.location=null;q.screenLocationEnabled=!1;q.view=null;q[e].add([x.when(()=>n.applySome(q.screenLocationEnabled?q.view:null,y=>[y.size,"3d"===y.type?y.camera:y.viewpoint]),()=>q.notifyChange("screenLocation")),x.watch(()=>q.screenLocation,(y,B)=>{n.isSome(y)&&n.isSome(B)&&q.emit("view-change")})]);return q}a._inherits(p,u);var h=a._createSuper(p);p.prototype.destroy=function(){this.view=
null;this[e]=n.destroyMaybe(this[e])};a._createClass(p,[{key:"screenLocation",get:function(){const {location:r,view:q,screenLocationEnabled:y}=this;return y&&n.isSome(r)&&n.isSome(q)&&q.ready?q.toScreen?.(r):null}}]);return p}(c.EventedAccessor);var k=e;b.__decorate([m.property()],c.prototype,"location",void 0);b.__decorate([m.property()],c.prototype,"screenLocation",null);b.__decorate([m.property()],c.prototype,"screenLocationEnabled",void 0);b.__decorate([m.property()],c.prototype,"view",void 0);
return c=b.__decorate([d.subclass("esri.widgets.support.AnchorElementViewModel")],c)})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ./actions".split(" "),function(a,b,c,w,n,x){function m(u){const {selectedFeature:p,location:h,view:r}=u;return r?"3d"===r.type?p??h??null:u.get("selectedFeature.geometry")||h:null}function l(u){return!!u&&u.isAggregate&&"cluster"===u.sourceLayer?.featureReduction?.type}async function g(u,
p){if("3d"!==p?.type||!u||"esri.Graphic"!==u.declaredClass)return!0;if((p=p.getViewForGraphic(u))&&"whenGraphicBounds"in p){let h;try{h=await p.whenGraphicBounds(u,{useViewElevation:!0})}catch(r){}return!h||!h.boundingBox||h.boundingBox[0]===h.boundingBox[3]&&h.boundingBox[1]===h.boundingBox[4]&&h.boundingBox[2]===h.boundingBox[5]}return!0}async function f(u){const {location:p,selectedFeature:h,view:r,zoomFactor:q}=u,y=m(u);if(!r||!y)throw u=new b("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",
{target:y,view:r}),k.error(u),u;const B=r.scale/q,D=u.selectedFeature?.geometry??p,z=w.isSome(D)&&"point"===D.type&&await g(h,r);x.zoomToFeature.active=!0;x.zoomToFeature.disabled=!0;try{await u.zoomTo({target:{target:y,scale:z?B:void 0}})}catch(v){const A=new b("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:h});k.error(A)}finally{x.zoomToFeature.active=!1,x.zoomToFeature.disabled=!1,u.zoomToLocation=null,z&&(u.location=D)}}async function d(u){const {selectedFeature:p,
view:h}=u;if("2d"!==h?.type)throw u=new b("zoomToCluster:invalid-view","View must be 2d MapView.",{view:h}),k.error(u),u;if(!p||!l(p))throw u=new b("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:p}),k.error(u),u;const [r,q]=await e(h,p);x.zoomToClusteredFeatures.active=!0;x.zoomToClusteredFeatures.disabled=!0;const {extent:y}=await r.queryExtent(q);await u.zoomTo({target:y});x.zoomToClusteredFeatures.active=!1;x.zoomToClusteredFeatures.disabled=
!1}async function e(u,p){u=await u.whenLayerView(p.sourceLayer);const h=u.createQuery();p=p.getObjectId();h.aggregateIds=null!=p?[p]:[];return[u,h]}const k=c.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=async function(u){const {selectedFeature:p,view:h}=u;if(h&&p){var [r,q]=await e(h,p);x.browseClusteredFeatures.active=!0;x.browseClusteredFeatures.disabled=!0;({features:u}=await r.queryFeatures(q));x.browseClusteredFeatures.active=!1;x.browseClusteredFeatures.disabled=
!1;h.popup?.open({features:[p].concat(u),featureMenuOpen:!0})}};a.displayClusterExtent=async function(u){const {view:p,selectedFeature:h}=u;if(p&&h){var [r,q]=await e(p,h),{extent:y}=await r.queryExtent(q);u.selectedClusterBoundaryFeature.geometry=y;p.graphics.add(u.selectedClusterBoundaryFeature)}};a.getPointFromGeometry=function(u){if(w.isNone(u))return null;switch(u.type){case "point":return u;case "extent":return u.center;case "polygon":return u.centroid;case "multipoint":case "polyline":return u.extent?.center;
default:return null}};a.getSelectedTarget=m;a.isClusterFeature=l;a.removeClusteredFeaturesForBrowsing=function(u){const p=u.features.filter(h=>l(h));p.length&&(u.features=p)};a.triggerAction=u=>{const {event:p,view:h}=u;({action:u}=p);var r=h&&h.popup;if(!u)return Promise.reject(new b("trigger-action:missing-arguments","Event has no action"));if(!r)return Promise.reject(new b("trigger-action:missing-arguments","view.popup is missing"));const {disabled:q,id:y}=u;if(!y)return Promise.reject(new b("trigger-action:invalid-action",
"action.id is missing"));if(q)return Promise.reject(new b("trigger-action:invalid-action","Action is disabled"));if(y===x.zoomToFeature.id)return f(r.viewModel).catch(n.throwIfNotAbortError);if(y===x.zoomToClusteredFeatures.id)return d(r.viewModel);if(y===x.browseClusteredFeatures.id)return r.featureMenuOpen=!r.featureMenuOpen,r.viewModel.browseClusterEnabled=!r.viewModel.browseClusterEnabled,Promise.resolve();r.viewModel.browseClusterEnabled=!1;if(y===x.removeSelectedFeature.id){r.close();({selectedFeature:u}=
r);if(!u)return Promise.reject(new b(`trigger-action:${x.removeSelectedFeature.id}`,"selectedFeature is required",{selectedFeature:u}));({sourceLayer:r}=u);r?r.remove(u):h.graphics.remove(u)}return Promise.resolve()};a.zoomToClusterExtent=d;a.zoomToLocation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,b){const c=new b({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),
w=new b({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),n=new b({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});b=new b({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[c,w,b,n];a.browseClusteredFeatures=b;a.removeSelectedFeature=w;a.zoomToClusteredFeatures=n;a.zoomToFeature=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/widgets/Popup/css":function(){define(["exports"],function(a){a.CSS={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",
iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",
isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",
isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:"esri-popup__footer",
footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",
actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",actionExit:"esri-popup__action--exit",actionSelectFeature:"esri-popup__action--select-feature",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",
paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",
featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button",collapseIcon:"esri-popup__collapse-icon"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../layers/LayerConstants ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../symbols/SimpleFillSymbol ../../geometry/Point".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L){const R=x.ofType({key:"type",defaultKeyValue:"button",base:B,typeMap:{button:D,toggle:z}});c=function(O){function J(G){G=M.call(this,G);G._handles=new l;G._pendingPromises=new Set;G._fetchFeaturesController=null;G._highlightSelectedFeaturePromise=null;G._highlightActiveFeaturePromise=null;G._selectedClusterFeature=null;G.featurePage=null;G.actions=new R;G.activeFeature=null;G.defaultPopupTemplateEnabled=!1;G.autoCloseEnabled=
!1;G.autoOpenEnabled=!0;G.browseClusterEnabled=!1;G.content=null;G.featuresPerPage=20;G.featureViewModelAbilities=null;G.featureViewModels=[];G.highlightEnabled=!0;G.includeDefaultActions=!0;G.selectedClusterBoundaryFeature=new w({symbol:new I({outline:{width:1.5,color:"cyan"},style:"none"})});G.title=null;G.updateLocationEnabled=!1;G.view=null;G.visible=!1;G.zoomFactor=4;G.zoomToLocation=null;return G}a._inherits(J,O);var M=a._createSuper(J);O=J.prototype;O.initialize=function(){this._handles.add([d.watch(()=>
[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),d.watch(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),d.watch(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),d.watch(()=>this.view?.animation?.state,G=>this._animationStateChange(G)),d.watch(()=>this.location,G=>this._locationChange(G)),d.watch(()=>this.selectedFeature,
G=>this._selectedFeatureChange(G)),d.watch(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),d.watch(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),d.watch(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",G=>F.triggerAction({event:G,view:this.view})),d.when(()=>!this.waitingForResult,()=>this._waitingForResultChange(),
d.sync),d.watch(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),d.watch(()=>this.view?.scale,()=>this._viewScaleChange()),d.when(()=>!this.visible,()=>this.browseClusterEnabled=!1),d.watch(()=>this.browseClusterEnabled,G=>G?this.enableClusterBrowsing():this.disableClusterBrowsing())])};O.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};O.centerAtLocation=
function(){const {view:G}=this,P=F.getSelectedTarget(this);return P&&G?this.callGoTo({target:{target:P,scale:G.scale}}):Promise.reject(new m("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:P,view:G}))};O.zoomTo=function(G){return this.callGoTo(G)};O.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})};O.fetchFeatures=function(G,P){const {view:U}=this;if(!U||!G)throw new m("fetch-features:invalid-screenpoint-or-view",
"Cannot fetch features without a screenPoint and view.",{screenPoint:G,view:U});return U.fetchPopupFeatures(G,{event:P&&P.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:P&&P.signal})};O.open=function(G){G={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...G,visible:!0};var {fetchFeatures:P}=G;delete G.fetchFeatures;P&&this._setFetchFeaturesPromises(G.location);P=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const U of P)delete G[U];this.set(G)};O.triggerAction=
function(G){(G=this.allActions.getItemAt(G))&&!G.disabled&&this.emit("trigger-action",{action:G})};O.next=function(){this.selectedFeatureIndex+=1;return this};O.previous=function(){--this.selectedFeatureIndex;return this};O.disableClusterBrowsing=function(){F.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};O.enableClusterBrowsing=async function(){const {view:G,selectedFeature:P}=this;"2d"!==G?.type?g.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",
P):F.isClusterFeature(P)?(await F.displayClusterExtent(this),await F.browseAggregateFeatures(this)):g.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",P)};O._animationStateChange=function(G){this.zoomToLocation||(E.zoomToFeature.disabled="waiting-for-target"===G)};O._clearBrowsedClusterGraphics=function(){const G=this.view?.graphics;G&&(G.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&
G.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};O._viewScaleChange=function(){F.isClusterFeature(this.selectedFeature)?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])};O._locationChange=function(G){const {selectedFeature:P,updateLocationEnabled:U}=this;U&&G&&(!P||P.geometry)&&this.centerAtLocation()};O._selectedFeatureIndexChange=
function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};O._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};O._setGraphicOnFeatureViewModels=function(){const {features:G,featureCount:P,featurePage:U,featuresPerPage:N,featureViewModels:S}=this;if(null!==U){var Q=((U-1)*N+P)%P;S.slice(Q,Q+N).forEach((W,V)=>{W&&!W.graphic&&(W.graphic=G[Q+V])})}};O._selectedFeatureChange=async function(G){const {location:P,updateLocationEnabled:U,
view:N}=this;G&&N&&(this.browseClusterEnabled?(this._selectedClusterFeature&&(N.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),F.isClusterFeature(G)||(G.symbol=await v.getDisplayedSymbol(G),this._selectedClusterFeature=G,N.graphics.add(this._selectedClusterFeature))):!U&&P||!G.geometry?U&&!G.geometry&&this.centerAtLocation().then(()=>{const S=N.center?.clone();S&&(this.location=S)}):this.location=f.unwrap(F.getPointFromGeometry(G.geometry)))};O._waitingForResultChange=
function(){!this.featureCount&&this.promises&&(this.visible=!1)};O._setFetchFeaturesPromises=function(G){return this._fetchFeaturesWithController(this._getScreenPoint(G||this.location)).then(P=>{const {clientOnlyGraphics:U,promisesPerLayerView:N}=P;P=Promise.resolve(U);const S=N.map(Q=>Q.promise);this.promises=[P,...S]})};O._destroyFeatureVMs=function(){this.featureViewModels.forEach(G=>G&&!G.destroyed&&G.destroy());this._set("featureViewModels",[])};O._updateFeatureVMs=function(){const {selectedFeature:G,
features:P,featureViewModels:U}=this;F.isClusterFeature(G)||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(P&&P.length){var N=U.slice(0),S=[];P.forEach((Q,W)=>{if(Q){var V=null;N.some((T,X)=>{T&&T.graphic===Q&&(V=T,N.splice(X,1));return!!V});if(V)S[W]=V;else{const T=new C({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:this.view?.spatialReference,graphic:Q===G?Q:null,map:this.view?.map,view:this.view});S[W]=T}}});
N.forEach(Q=>Q&&!Q.destroyed&&Q.destroy());this._set("featureViewModels",S)}};O._getScreenPoint=function(G){const {view:P}=this;return P&&G&&"function"===typeof P.toScreen?P.toScreen(G):null};O._autoOpenEnabledChange=function(){const {_handles:G,autoOpenEnabled:P}=this;G.remove("auto-fetch-features");if(P&&this.view){const U=this.view.on("click",N=>{"mouse"===N.pointerType&&0!==N.button||this._fetchFeaturesAndOpen(N)},A.ViewEventPriorities.WIDGET);G.add(U,"auto-fetch-features")}};O._cancelFetchingFeatures=
function(){const G=this._fetchFeaturesController;G&&G.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};O._fetchFeaturesWithController=function(G,P){this._cancelFetchingFeatures();const U=new AbortController,{signal:N}=U;this._fetchFeaturesController=U;this.notifyChange("waitingForResult");G=this.fetchFeatures(G,{signal:N,event:P});G.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return G};O._fetchFeaturesAndOpen=
function(G){const {screenPoint:P,mapPoint:U}=G,{view:N}=this;this._fetchFeaturesWithController(P,G).then(S=>{const {clientOnlyGraphics:Q,promisesPerLayerView:W,location:V}=S,T=[Promise.resolve(Q),...W.map(X=>X.promise)];N?.popup?.open({location:V||U,promises:T});return S})};O._updatePendingPromises=function(G){G&&this._pendingPromises.has(G)&&(this._pendingPromises.delete(G),this.notifyChange("pendingPromisesCount"))};O._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};O._getLayerView=
async function(G,P){await G.when();return G.whenLayerView(P)};O._getHighlightLayer=function(G){const {layer:P,sourceLayer:U}=G;return U&&"layer"in U&&U.layer?U.layer:"map-notes"===U?.type||"subtype-group"===U?.type?U:P};O._getHighlightTarget=function(G,P){P="imagery"===P.type?void 0:"objectIdField"in P?P.objectIdField||y.fallbackObjectIDAttribute:null;const U=G.attributes;return U&&P&&U[P]||G};O._highlightActiveFeature=async function(){this._handles.remove("highlight-active-feature");const {highlightEnabled:G,
view:P,activeFeature:U,visible:N}=this;if(U&&P&&G&&N){var S=this._getHighlightLayer(U);if(S&&S instanceof q){var Q=this._getLayerView(P,S);this._highlightActiveFeaturePromise=Q;var W=await Q;W&&t.highlightsSupported(W)&&this._highlightActiveFeaturePromise===Q&&this.activeFeature&&this.highlightEnabled&&(S=W.highlight(this._getHighlightTarget(U,S)),this._handles.add(S,"highlight-active-feature"))}}};O._highlightSelectedFeature=async function(){this._handles.remove("highlight-selected-feature");const {selectedFeature:G,
highlightEnabled:P,view:U,visible:N}=this;if(G&&U&&P&&N){var S=this._getHighlightLayer(G);if(S&&S instanceof q){var Q=this._getLayerView(U,S);this._highlightSelectedFeaturePromise=Q;var W=await Q;W&&t.highlightsSupported(W)&&this._highlightSelectedFeaturePromise===Q&&this.selectedFeature&&this.highlightEnabled&&this.visible&&(S=W.highlight(this._getHighlightTarget(G,S)),this._handles.add(S,"highlight-selected-feature"))}}};O._updateFeatures=function(G){const {features:P}=this;G&&G.length&&(P.length?
(G=G.filter(U=>!P.includes(U)),this.features=P.concat(G)):this.features=G)};a._createClass(J,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(G=>G.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){const G=this._get("allActions")||new R;G.removeAll();const {actions:P,defaultActions:U,defaultPopupTemplateEnabled:N,includeDefaultActions:S,selectedFeature:Q}=this;var W=S?U.concat(P):P;const V=Q&&
("function"===typeof Q.getEffectivePopupTemplate&&Q.getEffectivePopupTemplate(N)||Q.popupTemplate),T=V&&V.actions;(W=V&&V.overwriteActions?T:T?T.concat(W):W)&&W.filter(Boolean).forEach(X=>G.add(X));return G}},{key:"defaultActions",get:function(){const G=this._get("defaultActions")||new R;G.removeAll();G.addMany(F.isClusterFeature(this.selectedFeature)?[E.zoomToClusteredFeatures.clone(),E.browseClusteredFeatures.clone()]:[E.zoomToFeature.clone()]);return G}},{key:"featureCount",get:function(){return this.features.length}},
{key:"features",get:function(){return this._get("features")||[]},set:function(G){G=G||[];this._set("features",G);const {pendingPromisesCount:P,promiseCount:U,selectedFeatureIndex:N}=this,S=U&&G.length;S&&P&&-1===N?this.selectedFeatureIndex=0:S&&-1!==N||(this.selectedFeatureIndex=G.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(G){let P=G;const U=this.view?.spatialReference?.isWebMercator;G&&G?.spatialReference?.isWGS84&&U&&(P=r.geographicToWebMercator(G));
this._set("location",P)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(G){this._pendingPromises.clear();this.features=[];Array.isArray(G)&&G.length?(this._set("promises",G),G=G.slice(0),G.forEach(P=>
{this._pendingPromises.add(P);P.then(U=>{this._pendingPromises.has(P)&&this._updateFeatures(U);this._updatePendingPromises(P)},()=>this._updatePendingPromises(P))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){const {features:G,selectedFeatureIndex:P}=this;return-1===P?null:G[P]||null}},{key:"selectedFeatureIndex",get:function(){const G=this._get("selectedFeatureIndex");return"number"===typeof G?G:-1},set:function(G){const {featureCount:P}=
this;G=isNaN(G)||-1>G||!P?-1:(G+P)%P;this.activeFeature=null;this._set("selectedFeatureIndex",G)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]);return J}(K.GoToMixin(H));b.__decorate([e.property()],c.prototype,"featurePage",void 0);b.__decorate([e.property()],c.prototype,"isLoadingFeature",null);b.__decorate([e.property({type:R})],c.prototype,"actions",
void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"active",null);b.__decorate([e.property()],c.prototype,"activeFeature",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"allActions",null);b.__decorate([e.property({type:Boolean})],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([e.property()],c.prototype,"autoCloseEnabled",void 0);b.__decorate([e.property()],c.prototype,"autoOpenEnabled",void 0);b.__decorate([e.property()],c.prototype,"browseClusterEnabled",void 0);
b.__decorate([e.property()],c.prototype,"content",void 0);b.__decorate([e.property({type:R,readOnly:!0})],c.prototype,"defaultActions",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"featureCount",null);b.__decorate([e.property()],c.prototype,"features",null);b.__decorate([e.property()],c.prototype,"featuresPerPage",void 0);b.__decorate([e.property()],c.prototype,"featureViewModelAbilities",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"featureViewModels",void 0);b.__decorate([e.property()],
c.prototype,"highlightEnabled",void 0);b.__decorate([e.property()],c.prototype,"includeDefaultActions",void 0);b.__decorate([e.property({type:L})],c.prototype,"location",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"pendingPromisesCount",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"selectedClusterBoundaryFeature",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"waitingForResult",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"promiseCount",null);
b.__decorate([e.property()],c.prototype,"promises",null);b.__decorate([e.property({value:null,readOnly:!0})],c.prototype,"selectedFeature",null);b.__decorate([e.property({value:-1})],c.prototype,"selectedFeatureIndex",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"selectedFeatureViewModel",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([e.property()],c.prototype,"title",void 0);b.__decorate([e.property()],c.prototype,"updateLocationEnabled",void 0);
b.__decorate([e.property()],c.prototype,"view",void 0);b.__decorate([e.property()],c.prototype,"visible",void 0);b.__decorate([e.property()],c.prototype,"zoomFactor",void 0);b.__decorate([e.property()],c.prototype,"zoomToLocation",void 0);b.__decorate([e.property()],c.prototype,"centerAtLocation",null);return c=b.__decorate([h.subclass("esri.widgets.Popup.PopupViewModel")],c)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils ../../widgets/Legend/styles/support/relationshipUtils ../../widgets/Legend/support/relationshipRampUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){function e(r,q){if(q&&(r.style.filter=g.getCSSFilterFromEffectList(q),q=q.effects))for(const y of q)if("drop-shadow"===y?.type){0>y.offsetX?r.style.marginLeft=`${Math.abs(y.offsetX)}px`:r.style.marginRight=`${y.offsetX}px`;break}}async function k(r,q){switch(r.type){case "web-style":var {previewWebStyleSymbol:y}=await new Promise((B,D)=>a(["./previewWebStyleSymbol"],B,D));return y(r,k,q);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:y}=
await new Promise((B,D)=>a(["./previewSymbol3D"],B,D)),y(r,q);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:y}=await new Promise((B,D)=>a(["./previewSymbol2D"],B,D)),y(r,q);case "cim":return{previewCIMSymbol:y}=await new Promise((B,D)=>a(["./previewCIMSymbol"],B,D)),y(r,q)}}function u(r){return r&&"opacity"in r?r.opacity*u(r.parent):1}let p=null;const h=[255,255,255];b.getDisplayedColor=async function(r,q){if(r){var y=
u(r.layer||r.sourceLayer);if(w.isSome(r.symbol)&&(!w.isSome(q)||!0!==q.ignoreGraphicSymbol))return r="web-style"===r.symbol.type?await g.fetchWebStyleSymbol(r.symbol,q):r.symbol.clone(),g.getColorFromSymbol(r,y);var B=w.isSome(q)&&q.renderer||r.get("layer.renderer")||r.get("sourceLayer.renderer"),D=await B.getSymbolAsync(r,q);if(D){D="web-style"===D.type?await g.fetchWebStyleSymbol(D,q):D.clone();var z=g.getColorFromSymbol(D,y);if(!("visualVariables"in B)||"visualVariables"in B&&!B.visualVariables||
"visualVariables"in B&&!B.visualVariables?.length)return z;B.arcadeRequiredForVisualVariables&&(w.isNone(q)||w.isNone(q.arcade))&&(q={...w.unwrap(q)},q.arcade=await n.loadArcade());D=await new Promise((t,C)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],t,C));var v=[],A=[];for(const t of B.visualVariables)switch(t.type){case "color":v.push(t);break;case "opacity":A.push(t)}B=(B=0<v.length?v[v.length-1]:null)?D.getColor(B,r,q):z;r=(z=0<A.length?A[A.length-1]:null)?D.getOpacity(z,
r,q):null;null!=y&&(r=null!=r?r*y:y);return B?g.applyOpacityToColor(B,r):null}}};b.getDisplayedSymbol=async function(r,q){if(r){var y=r.sourceLayer,B=(w.isSome(q)&&(q.useSourceLayer??!1)?y:r.layer)??y;y=u(B);if(w.isSome(r.symbol)&&(!w.isSome(q)||!0!==q.ignoreGraphicSymbol))return r="web-style"===r.symbol.type?await g.fetchWebStyleSymbol(r.symbol,{...q,cache:w.isSome(q)?q.webStyleCache:null}):r.symbol.clone(),g.applyColorToSymbol(r,null,y),r;var D=(w.isSome(q)?q.renderer:null)??(B&&"renderer"in B?
B.renderer:null);if(B=D&&"getSymbolAsync"in D?await D.getSymbolAsync(r,q):null){B="web-style"===B.type?await B.fetchSymbol({...q,cache:w.isSome(q)?q.webStyleCache:null}):B.clone();if(!(D&&"visualVariables"in D&&D.visualVariables&&D.visualVariables.length))return g.applyColorToSymbol(B,null,y),B;"arcadeRequiredForVisualVariables"in D&&D.arcadeRequiredForVisualVariables&&(w.isNone(q)||w.isNone(q.arcade))&&(q={...w.unwrap(q)},q.arcade=await n.loadArcade());var z=await new Promise((F,H)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],
F,H)),v=[],A=[],t=[],C=[];for(var E of D.visualVariables)switch(E.type){case "color":v.push(E);break;case "opacity":A.push(E);break;case "rotation":C.push(E);break;case "size":E.target||t.push(E)}E=(E=!!v.length&&v[v.length-1])?z.getColor(E,r,q):null;A=(A=!!A.length&&A[A.length-1])?z.getOpacity(A,r,q):null;null!=y&&(A=null!=A?A*y:y);g.applyColorToSymbol(B,E,A);t.length&&(y=z.getAllSizes(t,r,q),await g.applySizesToSymbol(B,y));for(const F of C)g.applyRotationToSymbol(B,z.getRotationAngle(F,r,q),F.axis);
return B}}};b.renderColorRampPreviewHTML=function(r,q={}){var y="horizontal"===q.align;const B=q.width??(y?75:24),D=q.height??(y?24:75);var z=q.gradient??!0,v=window.devicePixelRatio,A=B*v,t=D*v;v=document.createElement("canvas");v.width=A;v.height=t;v.style.width=`${B}px`;v.style.height=`${D}px`;const C=v.getContext("2d");var E=y?A:0;const F=y?0:t;if(z){const H=C.createLinearGradient(0,0,E,F);y=r.length;const K=1===y?0:1/(y-1);r.forEach((I,L)=>H.addColorStop(L*K,I.toString()));C.fillStyle=H;C.fillRect(0,
0,A,t)}else{A=y?A/r.length:A;t=y?t:t/r.length;E=z=0;for(const H of r)C.fillStyle=H.toString(),C.fillRect(z,E,A,t),z=y?z+A:0,E=y?0:E+t}r=document.createElement("div");r.style.width=`${B}px`;r.style.height=`${D}px`;e(r,q?.effectList);r.appendChild(v);return r};b.renderDotDensityPreviewHTML=function(r,q,y){const {backgroundColor:B,outline:D,dotSize:z}=r;y=y&&y.swatchSize||m.SymbolSizeDefaults.size;const v=Math.round(y*y/z**2*.8),A=window.devicePixelRatio;r=document.createElement("canvas");const t=y*
A;r.width=t;r.height=t;r.style.width=`${r.width/A}px`;r.style.height=`${r.height/A}px`;const C=r.getContext("2d");B&&(C.fillStyle=B.toCss(!0),C.fillRect(0,0,t,t),C.fill());C.fillStyle=q.toCss(!0);if(p&&p.length/2===v)for(q=0;q<2*v;q+=2)C.fillRect(p[q],p[q+1],z*A,z*A),C.fill();else for(p=[],q=0;q<2*v;q+=2){const E=Math.floor(Math.random()*(t-0+1)),F=Math.floor(Math.random()*(t-0+1));p.push(E,F);C.fillRect(E,F,z*A,z*A);C.fill()}D&&(D.color&&(C.strokeStyle=D.color.toCss(!0)),C.lineWidth=D.width,C.strokeRect(0,
0,t,t));y=new Image(y,y);y.src=r.toDataURL();return y};b.renderPieChartPreviewHTML=function(r,q={}){const y=q.radius||40;var B=2*Math.PI*y,D=r.length;const z=B/D,v=[],A=x.getStroke(q.outline);null!=A?.width&&(A.width*=2);(A||q.backgroundColor)&&v.push({shape:{type:"circle",cx:y,cy:y,r:y},fill:q.backgroundColor,stroke:A,offset:[0,0]});const t=q.values,C=t&&t.length===D&&100===t.reduce((F,H)=>F+H,0),E=[0];for(let F=0;F<D;F++){let H=null;C&&(H=t[F]*B/100,E.push(H+E[F]));v.push({shape:{type:"circle",
cx:y,cy:y,r:y/2},fill:[0,0,0,0],stroke:{width:y,dashArray:`${(H??z)/2} ${B}`,dashoffset:`-${C?E[F]/2:z/2*F}`,color:r[F]},offset:[0,0]})}D=null;r=2*y+(A?.width||0);if(B=q.holePercentage)A&&v.push({shape:{type:"circle",cx:y,cy:y,r:y*B},fill:null,stroke:A,offset:[0,0]}),D=r/2,D=[[{shape:{type:"circle",cx:D,cy:D,r:D},fill:h,stroke:A?{...A,color:h}:null,offset:[0,0]},{shape:{type:"circle",cx:D,cy:D,r:y*B},fill:[0,0,0],stroke:null,offset:[0,0]}]];return l.renderSymbol([v],[r,r],{effectView:q.effectList,
ignoreStrokeWidth:!0,masking:D,rotation:-90})};b.renderPreviewHTML=k;b.renderRelationshipRampPreviewHTML=function(r,q={}){const y=r?.authoringInfo;if("relationship"!==y?.type||!y?.numClasses||!r.uniqueValueInfos)return null;const {focus:B,numClasses:D}=y,z=d.getRelationshipRampElement({focus:B,numClasses:D,infos:r.uniqueValueInfos});r=q&&q.node||document.createElement("div");l.renderOnce(r,()=>f.renderRelationshipRamp(z,q.id||"relationship",q.opacity||1,q.effectList));return r};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,b){function c(w,n){return Math.round(Math.min(Math.max(w+191.25*n,0),255))}a.SymbolSizeDefaults=void 0;(function(w){w[w.size=22]="size";w[w.lineWidth=50]="lineWidth";w[w.maxSize=120]="maxSize";w[w.maxOutlineSize=80]="maxOutlineSize";w[w.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(w,n){if(null==
w)return new b;if("type"in w&&("linear"===w.type||"pattern"===w.type))return w;w=new b(w);return new b([c(w.r,n),c(w.g,n),c(w.b,n),w.a])};a.adjustColorComponentBrightness=c;a.getConeShapes=function(w,n){let x=n?a.SymbolSizeDefaults.tallSymbolWidth:w;n=n?4:6;x=x<=a.SymbolSizeDefaults.size?x-.5*n:x-n;n=.15*x;const m=x;w-=n;return[{type:"ellipse",cx:.5*x,cy:w,rx:.5*x,ry:n},{type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,w]},{command:"L",values:[0,w]},{command:"Z",values:[]}]}]};
a.getCubeShapes=function(w,n){let x=n?a.SymbolSizeDefaults.tallSymbolWidth:w;var m=n?4:6;m=x=x<=a.SymbolSizeDefaults.size?x-.5*m:x-m;n=n?.35*x:.5*x;return[{type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,.5*n]},{command:"L",values:[.5*m,n]},{command:"L",values:[0,.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*m,n]},{command:"L",values:[.5*m,w]},{command:"L",values:[0,w-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.5*m,n]},{command:"L",values:[.5*m,w]},{command:"L",values:[m,w-.5*n]},{command:"L",values:[m,.5*n]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(w,n){var x=n?a.SymbolSizeDefaults.tallSymbolWidth:w;n=n?4:6;x=x<=a.SymbolSizeDefaults.size?x-.5*n:x-n;n=.5*x;const m=.15*x;w-=m;return[{type:"ellipse",cx:.5*x,cy:w,rx:n,ry:m},{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[0,w]},{command:"L",values:[x,w]},{command:"L",values:[x,m]},{command:"Z",values:[]}]},{type:"ellipse",
cx:.5*x,cy:m,rx:n,ry:m}]};a.getDiamondShapes=function(w){var n=w;n=n<a.SymbolSizeDefaults.size?n-2:n-4;const x=Math.floor(w/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[n,.5*w-x]},{command:"L",values:[.45*n-x,.5*w+x]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[.45*n-x,.5*w+x]},{command:"L",values:[0,.5*w-x]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*w-x]},{command:"L",values:[.45*
n-x,.5*w+x]},{command:"L",values:[.45*n,w]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*n,w]},{command:"L",values:[n,.5*w-x]},{command:"L",values:[.45*n-x,.5*w+x]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=function(w){const n=a.SymbolSizeDefaults.size;w*=.5;return[{type:"path",path:[{command:"M",values:[0,.35*n]},{command:"L",values:[.3*n,.7*n]},{command:"L",values:[.3*n,.7*n+w]},{command:"L",values:[0,.7*n+w-.35*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.3*n,.7*n]},{command:"L",values:[.3*n,.7*n+w]},{command:"L",values:[n,w]},{command:"L",values:[n,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*n,0]},{command:"L",values:[n,0]},{command:"L",values:[.3*n,.7*n]},{command:"L",values:[0,.35*n]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(w){let n=w;n=n<a.SymbolSizeDefaults.size?n-3:n-6;const x=.15*n,m=n;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[.5*
m,w-x]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*n,cy:0,rx:.5*n,ry:x}]};a.getPathSymbolShapes=function(w,n,x){var m=a.SymbolSizeDefaults.size;let l=m,g=m;1>w?l*=.75:1<w&&(g*=1.25);w=m;n&&x&&(l=g=w=m=0);return[{type:"path",path:[{command:"M",values:[w,0]},{command:"L",values:[x?w:.875*w,0]},{command:"L",values:[x?l-.5*w:0,g-.5*m]},{command:"L",values:[l-.5*w,g-.5*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[w,0]},{command:"L",values:[w,n?0:.125*m]},{command:"L",values:[l-
.5*w,n?g-.5*m:m]},{command:"L",values:[l-.5*w,g-.5*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l-.5*w,g-.5*m]},{command:"L",values:[x?l-.5*w:0,g-.5*m]},{command:"L",values:[x?l-.5*w:0,n?g-.5*m:m]},{command:"L",values:[l-.5*w,n?g-.5*m:m]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(w){var n=w;n=n<a.SymbolSizeDefaults.size?n-1:n-2;return[{type:"path",path:[{command:"M",values:[.45*w,0]},{command:"L",values:[w,n]},{command:"L",values:[.45*w,.6*n]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*w,0]},{command:"L",values:[.45*w,.6*n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[.45*w,.6*n]},{command:"L",values:[w,n]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},
{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/renderUtils":function(){define("exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../libs/maquette/projection ../../libs/maquette/projector ./svgUtils ./utils".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(u,p){k.append(u,p);k.detach(p)}function e(u,p,h){return u?c(u,{responseType:"image"}).then(r=>{r=r.data;const q=r.width,y=r.height,B=q/y;let D=p;h&&(D=Math.min(D,Math.max(q,y)));return{image:r,width:1>=B?Math.ceil(D*B):D,height:1>=B?D:Math.ceil(D/B)}}):Promise.reject(new n("renderUtils: imageDataSize","href not provided."))}const k=l.createProjector();a.renderOnce=d;a.renderSymbol=function(u,p,h){const r=Math.ceil(p[0]),q=Math.ceil(p[1]);if(!u.some(y=>!!y.length))return null;
p=h&&h.node||document.createElement("div");null!=h.opacity&&(p.style.opacity=h.opacity.toString());null!=h.effectView&&(p.style.filter=f.getCSSFilterFromEffectList(h.effectView));d(p,()=>g.renderSVG(u,r,q,h));return p};a.tintImageWithColor=function(u,p,h,r,q){return e(u,p,q).then(y=>{const B=y.width??p,D=y.height??p;var z;if(z=y.image)z=h&&"ignore"!==r?"multiply"===r&&255===h.r&&255===h.g&&255===h.b&&1===h.a?!1:!0:!1;if(z){var v=y.image.width,A=y.image.height;x("edge")&&/\.svg$/i.test(u)&&(--v,--A);
z=Math.ceil(B);var t=Math.ceil(D);var C=document.createElement("canvas");C.width=z;C.height=t;C.style.width=z+"px";C.style.height=t+"px";C=C.getContext("2d");C.clearRect(0,0,z,t);z=C;z.drawImage(y.image,0,0,v,A,0,0,B,D);t=z.getImageData(0,0,B,D);C=[h.r/255,h.g/255,h.b/255,h.a];const F=w.toHSV(h);for(let H=0;H<t.data.length;H+=4){y=t.data;v=H;A=C;var E=F;switch(r){case "multiply":y[v]*=A[0];y[v+1]*=A[1];y[v+2]*=A[2];y[v+3]*=A[3];break;default:const K=w.toHSV({r:y[v],g:y[v+1],b:y[v+2]});K.h=E.h;K.s=
E.s;K.v=K.v/100*E.v;E=w.toRGB(K);y[v]=E.r;y[v+1]=E.g;y[v+2]=E.b;y[v+3]*=A[3]}}z.putImageData(t,0,0);u=z.canvas.toDataURL("image/png")}else(z=b.id&&b.id.findCredential(u))&&z.token&&(y=u.includes("?")?"\x26":"?",u=`${u}${y}token=${z.token}`);return{url:u,width:B,height:D}}).catch(()=>({url:u,width:p,height:p}))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports"],function(a){function b(f,d){const e=[];let k,u;if(f[0].length!==d.length)throw Error("dimensions do not match");
const p=f.length,h=f[0].length;let r=0;for(k=0;k<p;k++){for(u=r=0;u<h;u++)r+=f[k][u]*d[u];e.push(r)}return e}function c(f){f=[f.r/255,f.g/255,f.b/255].map(d=>.04045>=d?d/12.92:((d+.055)/1.055)**2.4);f=b(l,f);return{x:100*f[0],y:100*f[1],z:100*f[2]}}function w(f){f=b(g,[f.x/100,f.y/100,f.z/100]).map(d=>Math.min(1,Math.max(.0031308>=d?12.92*d:1.055*d**(1/2.4)-.055,0)));return{r:Math.round(255*f[0]),g:Math.round(255*f[1]),b:Math.round(255*f[2])}}function n(f){f=[f.x/95.047,f.y/100,f.z/108.883].map(d=>
d>(6/29)**3?d**(1/3):1/3*(29/6)**2*d+4/29);return{l:116*f[1]-16,a:500*(f[0]-f[1]),b:200*(f[1]-f[2])}}function x(f){const d=f.l;f=[(d+16)/116+f.a/500,(d+16)/116,(d+16)/116-f.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*f[0],y:100*f[1],z:108.883*f[2]}}function m(f){if("r"in f&&"g"in f&&"b"in f)return f;if("l"in f&&"c"in f&&"h"in f){var d=f.c,e=f.h;return w(x({l:f.l,a:d*Math.cos(e),b:d*Math.sin(e)}))}if("l"in f&&"a"in f&&"b"in f)return w(x(f));if("x"in f&&"y"in f&&"z"in f)return w(f);
if("h"in f&&"s"in f&&"v"in f){e=(f.h+360)%360/60;d=f.v/100*255;f=f.s/100*d;const k=f*(1-Math.abs(e%2-1));switch(Math.floor(e)){case 0:e={r:f,g:k,b:0};break;case 1:e={r:k,g:f,b:0};break;case 2:e={r:0,g:f,b:k};break;case 3:e={r:0,g:k,b:f};break;case 4:e={r:k,g:0,b:f};break;case 5:case 6:e={r:f,g:0,b:k};break;default:e={r:0,g:0,b:0}}e.r=Math.round(e.r+d-f);e.g=Math.round(e.g+d-f);e.b=Math.round(e.b+d-f);return e}return f}const l=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],g=[[3.2406,
-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.darken=function(f,d){f=n(c(f));f.l*=1-d;return w(x(f))};a.toHSV=function(f){if("h"in f&&"s"in f&&"v"in f)return f;var d=m(f);f=d.r;const e=d.g,k=d.b;d=Math.max(f,e,k);const u=d-Math.min(f,e,k);f=0===u?0:d===f?(e-k)/u%6:d===e?(k-f)/u+2:(f-e)/u+4;0>f&&(f+=6);return{h:60*f,s:100*(0===u?0:u/d),v:100/255*d}};a.toLAB=function(f){return"l"in f&&"a"in f&&"b"in f?f:n(c(m(f)))};a.toLCH=function(f){if(!("l"in f&&"c"in f&&"h"in f)){var d=n(c(m(f)));
f=d.l;var e=d.a;const k=d.b;d=Math.sqrt(e*e+k*k);e=Math.atan2(k,e);e=0<e?e:e+2*Math.PI;f={l:f,c:d,h:e}}return f};a.toRGB=m;a.toXYZ=function(f){return"x"in f&&"y"in f&&"z"in f?f:c(m(f))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/svgUtils":function(){define("exports ../../Color ../../core/has ../../core/maybe ../../chunks/mat2df32 ../../chunks/mat2d ../../widgets/support/widgetUtils ../../widgets/support/jsxFactory".split(" "),function(a,b,c,w,n,x,m,l){function g(J,
M){J*=R/180;return Math.abs(M*Math.sin(J))+Math.abs(M*Math.cos(J))}function f(J){return J.map(M=>`${M.command} ${M.values.join(" ")}`).join(" ").trim()}function d(J,M,G,P){if(J){if("circle"===J.type)return l.tsx("circle",{fill:M,"fill-rule":"evenodd",stroke:G.color,"stroke-width":G.width,"stroke-linecap":G.cap,"stroke-linejoin":G.join,"stroke-dasharray":G.dashArray,"stroke-dashoffset":G.dashOffset,"stroke-miterlimit":"4",cx:J.cx,cy:J.cy,r:J.r});if("ellipse"===J.type)return l.tsx("ellipse",{fill:M,
"fill-rule":"evenodd",stroke:G.color,"stroke-width":G.width,"stroke-linecap":G.cap,"stroke-linejoin":G.join,"stroke-dasharray":G.dashArray,"stroke-miterlimit":"4",cx:J.cx,cy:J.cy,rx:J.rx,ry:J.ry});if("rect"===J.type)return l.tsx("rect",{fill:M,"fill-rule":"evenodd",stroke:G.color,"stroke-width":G.width,"stroke-linecap":G.cap,"stroke-linejoin":G.join,"stroke-dasharray":G.dashArray,"stroke-miterlimit":"4",x:J.x,y:J.y,width:J.width,height:J.height});if("image"===J.type)return l.tsx("image",{href:J.src,
x:J.x,y:J.y,width:J.width,height:J.height,preserveAspectRatio:"none"});if("path"===J.type)return J="string"!==typeof J.path?f(J.path):J.path,l.tsx("path",{fill:M,"fill-rule":"evenodd",stroke:G.color,"stroke-width":G.width,"stroke-linecap":G.cap,"stroke-linejoin":G.join,"stroke-dasharray":G.dashArray,"stroke-miterlimit":"4",d:J});if("text"===J.type)return w.assertIsSome(P),l.tsx("text",{"dominant-baseline":P.dominantBaseline,fill:M,"fill-rule":"evenodd",stroke:G.color,"stroke-width":G.width,"stroke-linecap":G.cap,
"stroke-linejoin":G.join,"stroke-dasharray":G.dashArray,"stroke-miterlimit":"4","text-anchor":P.align,"text-decoration":P.decoration,kerning:P.kerning,rotate:P.rotate,"text-rendering":E,"font-style":P.font.style,"font-variant":P.font.variant,"font-weight":P.font.weight,"font-size":P.font.size,"font-family":P.font.family,x:J.x,y:J.y},J.text)}return null}function e(J){const M={fill:"none",pattern:null,linearGradient:null};if(J)if("type"in J&&"pattern"===J.type){var G=`patternId-${++t}`;M.fill=`url(#${G})`;
M.pattern={id:G,x:J.x,y:J.y,width:J.width,height:J.height,image:{x:0,y:0,width:J.width,height:J.height,href:J.src}}}else"type"in J&&"linear"===J.type?(G=`linearGradientId-${++C}`,M.fill=`url(#${G})`,M.linearGradient={id:G,x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,stops:J.colors.map(P=>({offset:P.offset,color:P.color&&(new b(P.color)).toString()}))}):J&&(J=new b(J),M.fill=J.toString());return M}function k(J){const M={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(J&&(null!=J.width&&
(M.width=J.width),J.cap&&(M.cap=J.cap),J.join&&(M.join=J.join.toString()),J.color&&(M.color=(new b(J.color)).toString()),J.dashArray&&(M.dashArray=J.dashArray),J.dashArray&&(M.dashOffset=J.dashoffset),J.style)){let G=null;J.style in L&&(G=L[J.style]);if(Array.isArray(G)){G=G.slice(0);const P=J.width??0;for(let U=0;U<G.length;++U)G[U]*=P;if("butt"!==J.cap){for(J=0;J<G.length;J+=2)G[J]-=P,1>G[J]&&(G[J]=1);for(J=1;J<G.length;J+=2)G[J]+=P}G=G.join(",")}M.dashArray=G}return M}function u(J,M){const G={align:null,
decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(J){const P=J.alignBaseline;G.align=J.align;G.dominantBaseline="baseline"===P?"auto":"top"===P?"text-top":"bottom"===P?"hanging":P;G.decoration=J.decoration;G.kerning=J.kerning?"auto":"0";G.rotate=J.rotated?"90":"0";w.assertIsSome(M);G.font.style=M.style||"normal";G.font.variant=M.variant||"normal";G.font.weight=M.weight||"normal";G.font.size=M.size&&M.size.toString()||"10pt";G.font.family=
M.family||"serif"}return G}function p(J){const {pattern:M,linearGradient:G}=J;return M?l.tsx("pattern",{id:M.id,patternUnits:"userSpaceOnUse",x:M.x,y:M.y,width:M.width,height:M.height},l.tsx("image",{x:M.image.x,y:M.image.y,width:M.image.width,height:M.image.height,href:M.image.href})):G?(J=G.stops.map((P,U)=>l.tsx("stop",{key:`${U}-stop`,offset:P.offset,"stop-color":P.color})),l.tsx("linearGradient",{id:G.id,gradientUnits:"userSpaceOnUse",x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2},J)):null}function h(J,M){if(!J)return null;
const G=[];for(const P of J){const {shape:U,fill:N,stroke:S,font:Q}=P;J=e(N);const W=k(S),V="text"===U.type?u(U,Q):null;(J=d(U,J.fill,W,V))&&G.push(J)}return l.tsx("mask",{id:M,maskUnits:"userSpaceOnUse"},l.tsx("g",null,G))}function r(J,M,G,P,U){x.scale(J,x.identity(J),[M,G]);J[4]=J[4]*M-P*M+P;J[5]=J[5]*G-U*G+U;return J}function q(J,M){if(K&&"left"in K){null!=K.left&&K.left>J&&(K.left=J);if(null==K.right||K.right<J)K.right=J;if(null==K.top||K.top>M)K.top=M;if(null==K.bottom||K.bottom<M)K.bottom=M}else K=
{left:J,bottom:M,right:J,top:M}}function y(J){const M=J.args,G=M.length;switch(J.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(J=0;J<G;J+=2)q(M[J],M[J+1]);I.x=M[G-2];I.y=M[G-1];break;case "H":for(J=0;J<G;++J)q(M[J],I.y);I.x=M[G-1];break;case "V":for(J=0;J<G;++J)q(I.x,M[J]);I.y=M[G-1];break;case "m":J=0;"x"in I||(q(I.x=M[0],I.y=M[1]),J=2);for(;J<G;J+=2)q(I.x+=M[J],I.y+=M[J+1]);break;case "l":case "t":for(J=0;J<G;J+=2)q(I.x+=M[J],I.y+=M[J+1]);break;case "h":for(J=0;J<G;++J)q(I.x+=
M[J],I.y);break;case "v":for(J=0;J<G;++J)q(I.x,I.y+=M[J]);break;case "c":for(J=0;J<G;J+=6)q(I.x+M[J],I.y+M[J+1]),q(I.x+M[J+2],I.y+M[J+3]),q(I.x+=M[J+4],I.y+=M[J+5]);break;case "s":case "q":for(J=0;J<G;J+=4)q(I.x+M[J],I.y+M[J+1]),q(I.x+=M[J+2],I.y+=M[J+3]);break;case "A":for(J=0;J<G;J+=7)q(M[J+5],M[J+6]);I.x=M[G-2];I.y=M[G-1];break;case "a":for(J=0;J<G;J+=7)q(I.x+=M[J+5],I.y+=M[J+6])}}function B(J,M,G){const P=F[J.toLowerCase()];"number"===typeof P&&(P?M.length>=P&&(J={action:J,args:M.slice(0,M.length-
M.length%P)},G.push(J),y(J)):(J={action:J,args:[]},G.push(J),y(J)))}function D(J){const M={x:0,y:0,width:0,height:0};if("circle"===J.type)M.x=J.cx-J.r,M.y=J.cy-J.r,M.width=2*J.r,M.height=2*J.r;else if("ellipse"===J.type)M.x=J.cx-J.rx,M.y=J.cy-J.ry,M.width=2*J.rx,M.height=2*J.ry;else if("image"===J.type||"rect"===J.type)M.x=J.x,M.y=J.y,M.width=J.width,M.height=J.height;else if("path"===J.type){var G=w.unwrapOrThrow;{const N=("string"!==typeof J.path?f(J.path):J.path).match(H),S=[];K={};I={};if(N){J=
"";var P=[],U=N.length;for(let Q=0;Q<U;++Q){const W=N[Q],V=parseFloat(W);isNaN(V)?(J&&B(J,P,S),P=[],J=W):P.push(V)}B(J,P,S);J={x:0,y:0,width:0,height:0};K&&"left"in K&&(J.x=K.left,J.y=K.top,J.width=K.right-K.left,J.height=K.bottom-K.top)}else J=null}G=G.call(w,J);M.x=G.x;M.y=G.y;M.width=G.width;M.height=G.height}return M}function z(J){const M={x:0,y:0,width:0,height:0};let G=null,P=Number.NEGATIVE_INFINITY,U=Number.NEGATIVE_INFINITY;for(const N of J)G?(G.x=Math.min(G.x,N.x),G.y=Math.min(G.y,N.y),
P=Math.max(P,N.x+N.width),U=Math.max(U,N.y+N.height)):(G=M,G.x=N.x,G.y=N.y,P=N.x+N.width,U=N.y+N.height);G&&(G.width=P-G.x,G.height=U-G.y);return G}function v(J,M,G,P,U,N,S,Q,W){var V=(S&&N?g(N,M):M)/2,T=(S&&N?g(N,G):G)/2;if(W){var X=W[0];W=W[1];V=(S&&N?g(N,X):X)/2;T=(S&&N?g(N,W):W)/2}X=J.width+P;var Z=J.height+P;W=n.create();S=n.create();var Y=!1;if(U&&0!==X&&0!==Z){U=M!==G?M/G:X/Z;Y=M>G?M:G;let aa=1,ia=1;isNaN(Y)||(1<U?(aa=Y/X,ia=Y/U/Z):(ia=Y/Z,aa=Y*U/X));x.multiply(S,S,r(W,aa,ia,V,T));Y=!0}U=J.x+
(X-P)/2;J=J.y+(Z-P)/2;P=x.multiply;V-=U;T-=J;V=x.translate(W,x.identity(W),[V,T]);P.call(x,S,S,V);!Y&&(X>M||Z>G)&&(V=X/M>Z/G,M=(V?M:G)/(V?X:Z),x.multiply(S,S,r(W,M,M,U,J)));N&&(M=x.multiply,G=N%360*Math.PI/180,x.rotate(W,x.identity(W),G),N=Math.cos(G),G=Math.sin(G),X=W[4],Z=W[5],W[4]=X*N-Z*G+J*G-U*N+U,W[5]=Z*N+X*G-U*G-J*N+J,M.call(x,S,S,W));Q&&(N=x.multiply,M=Q[0],Q=Q[1],Q=x.translate(W,x.identity(W),[M,Q]),N.call(x,S,S,Q));return`matrix(${S[0]},${S[1]},${S[2]},${S[3]},${S[4]},${S[5]})`}function A(J,
M,G){J=J?.effects.find(Q=>"bloom"===Q.type);if(!J)return null;const {strength:P,radius:U}=J;J=0<P?U:0;const N=(P+J)*M,S=4*P+1;return l.tsx("filter",{id:`bloom${G}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},l.tsx("feMorphology",{operator:"dilate",radius:(P+.5*J)*5**(M/100)*(.4+M/100),in:"SourceGraphic",result:"dilate"}),l.tsx("feGaussianBlur",{in:"dilate",stdDeviation:N/25,result:"blur"}),l.tsx("feGaussianBlur",{in:"blur",stdDeviation:N/50,result:"intensityBlur"}),
l.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},l.tsx("feFuncR",{type:"linear",slope:S}),l.tsx("feFuncG",{type:"linear",slope:S}),l.tsx("feFuncB",{type:"linear",slope:S})),l.tsx("feMerge",null,l.tsx("feMergeNode",{in:"intensityBlur"}),l.tsx("feMergeNode",{in:"intensityBrightness"}),l.tsx("feGaussianBlur",{stdDeviation:P/10})))}let t=0,C=0;m=c("android");const E=c("chrome")||m&&4<=m?"auto":"optimizeLegibility",F={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},H=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;
let K={},I={};const L={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},R=Math.PI;let O=1;a.computeBBox=z;a.generateFillAttributes=e;a.generateStrokeAttributes=k;a.generateTextAttributes=u;a.getBoundingBox=D;a.getTransformMatrix=v;a.renderDef=p;a.renderSVG=function(J,M,G,P={}){const U=[],N=[],S=++O,Q=A(P.effectView,M,S);var W=null;Q&&(W=P.effectView?.effects.find(Y=>
"bloom"===Y.type),W=(W.strength?W.strength+W.radius/2:0)/3,W=[Math.max(M+M*W,10),Math.max(G+G*W,10)]);for(let Y=0;Y<J.length;Y++){var V=J[Y];const aa=[];var T=[],X=0,Z=0;let ia=0;for(const na of V){const {shape:ba,fill:ea,stroke:ja,font:ka,offset:da}=na;P.ignoreStrokeWidth||(X+=ja&&ja.width||0);V=e(ea);const ha=k(ja),ca="text"===ba.type?u(ba,ka):null;U.push(p(V));aa.push(d(ba,V.fill,ha,ca));T.push(D(ba));da&&(Z+=da[0],ia+=da[1])}T=w.unwrapOrThrow(z(T));X=v(T,M,G,X,P.scale??!1,P.rotation,P.useRotationSize??
!1,[Z,ia],W);Z=null;P.masking&&(Z=`mask-${Y}`,U.push(h(P.masking[Y],Z)),Z=`url(#${Z})`);N.push(Z?l.tsx("g",{mask:Z},l.tsx("g",{transform:X},aa)):l.tsx("g",{transform:X},aa))}P.useRotationSize&&P.rotation&&(M=g(P.rotation,M),G=g(P.rotation,G));Q&&(w.assertIsSome(W),M=W[0],G=W[1]);return l.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:M,height:G,style:"display: block;"},Q,l.tsx("defs",null,U),Q?l.tsx("g",{filter:`url(#bloom${S})`},N):N)};a.renderShape=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const g=new Float32Array(6);g[0]=1;g[3]=1;return g}function c(g){const f=new Float32Array(6);f[0]=g[0];f[1]=g[1];f[2]=g[2];f[3]=g[3];f[4]=g[4];f[5]=g[5];return f}function w(g,f,d,e,k,u){const p=new Float32Array(6);p[0]=g;p[1]=f;p[2]=d;p[3]=e;p[4]=k;p[5]=u;return p}function n(g,f){return new Float32Array(g,f,6)}function x(g,f,d,e){const k=f[e];f=f[e+1];g[e]=d[0]*k+d[2]*f+d[4];g[e+1]=d[1]*k+d[3]*f+d[5]}
function m(g,f,d,e=0,k=0,u=2){for(k=k||f.length/u;e<k;e++)x(g,f,d,e*u)}const l=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:n,fromValues:w,transform:x,transformMany:m},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.mat2df32=l;a.transform=x;a.transformMany=m})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function c(A,t){A[0]=t[0];A[1]=t[1];A[2]=t[2];A[3]=t[3];A[4]=t[4];A[5]=t[5];return A}function w(A){A[0]=
1;A[1]=0;A[2]=0;A[3]=1;A[4]=0;A[5]=0;return A}function n(A,t,C,E,F,H,K){A[0]=t;A[1]=C;A[2]=E;A[3]=F;A[4]=H;A[5]=K;return A}function x(A,t){const C=t[0],E=t[1],F=t[2],H=t[3],K=t[4];t=t[5];let I=C*H-E*F;if(!I)return null;I=1/I;A[0]=H*I;A[1]=-E*I;A[2]=-F*I;A[3]=C*I;A[4]=(F*t-H*K)*I;A[5]=(E*K-C*t)*I;return A}function m(A){return A[0]*A[3]-A[1]*A[2]}function l(A,t,C){const E=t[0],F=t[1],H=t[2],K=t[3],I=t[4];t=t[5];const L=C[0],R=C[1],O=C[2],J=C[3],M=C[4];C=C[5];A[0]=E*L+H*R;A[1]=F*L+K*R;A[2]=E*O+H*J;A[3]=
F*O+K*J;A[4]=E*M+H*C+I;A[5]=F*M+K*C+t;return A}function g(A,t,C){const E=t[0],F=t[1],H=t[2],K=t[3],I=t[4];t=t[5];const L=Math.sin(C);C=Math.cos(C);A[0]=E*C+H*L;A[1]=F*C+K*L;A[2]=E*-L+H*C;A[3]=F*-L+K*C;A[4]=I;A[5]=t;return A}function f(A,t,C){const E=t[1],F=t[2],H=t[3],K=t[4],I=t[5],L=C[0];C=C[1];A[0]=t[0]*L;A[1]=E*L;A[2]=F*C;A[3]=H*C;A[4]=K;A[5]=I;return A}function d(A,t,C){const E=t[0],F=t[1],H=t[2],K=t[3],I=t[4];t=t[5];const L=C[0];C=C[1];A[0]=E;A[1]=F;A[2]=H;A[3]=K;A[4]=E*L+H*C+I;A[5]=F*L+K*C+
t;return A}function e(A,t){const C=Math.sin(t);t=Math.cos(t);A[0]=t;A[1]=C;A[2]=-C;A[3]=t;A[4]=0;A[5]=0;return A}function k(A,t){A[0]=t[0];A[1]=0;A[2]=0;A[3]=t[1];A[4]=0;A[5]=0;return A}function u(A,t){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=t[0];A[5]=t[1];return A}function p(A){return"mat2d("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+")"}function h(A){return Math.sqrt(A[0]**2+A[1]**2+A[2]**2+A[3]**2+A[4]**2+A[5]**2+1)}function r(A,t,C){A[0]=t[0]+C[0];A[1]=t[1]+C[1];A[2]=t[2]+C[2];A[3]=t[3]+
C[3];A[4]=t[4]+C[4];A[5]=t[5]+C[5];return A}function q(A,t,C){A[0]=t[0]-C[0];A[1]=t[1]-C[1];A[2]=t[2]-C[2];A[3]=t[3]-C[3];A[4]=t[4]-C[4];A[5]=t[5]-C[5];return A}function y(A,t,C){A[0]=t[0]*C;A[1]=t[1]*C;A[2]=t[2]*C;A[3]=t[3]*C;A[4]=t[4]*C;A[5]=t[5]*C;return A}function B(A,t,C,E){A[0]=t[0]+C[0]*E;A[1]=t[1]+C[1]*E;A[2]=t[2]+C[2]*E;A[3]=t[3]+C[3]*E;A[4]=t[4]+C[4]*E;A[5]=t[5]+C[5]*E;return A}function D(A,t){return A[0]===t[0]&&A[1]===t[1]&&A[2]===t[2]&&A[3]===t[3]&&A[4]===t[4]&&A[5]===t[5]}function z(A,
t){const C=A[0],E=A[1],F=A[2],H=A[3],K=A[4];A=A[5];const I=t[0],L=t[1],R=t[2],O=t[3],J=t[4];t=t[5];const M=b.getEpsilon();return Math.abs(C-I)<=M*Math.max(1,Math.abs(C),Math.abs(I))&&Math.abs(E-L)<=M*Math.max(1,Math.abs(E),Math.abs(L))&&Math.abs(F-R)<=M*Math.max(1,Math.abs(F),Math.abs(R))&&Math.abs(H-O)<=M*Math.max(1,Math.abs(H),Math.abs(O))&&Math.abs(K-J)<=M*Math.max(1,Math.abs(K),Math.abs(J))&&Math.abs(A-t)<=M*Math.max(1,Math.abs(A),Math.abs(t))}const v=Object.freeze(Object.defineProperty({__proto__:null,
add:r,copy:c,determinant:m,equals:z,exactEquals:D,frob:h,fromRotation:e,fromScaling:k,fromTranslation:u,identity:w,invert:x,mul:l,multiply:l,multiplyScalar:y,multiplyScalarAndAdd:B,rotate:g,scale:f,set:n,str:p,sub:q,subtract:q,translate:d},Symbol.toStringTag,{value:"Module"}));a.add=r;a.copy=c;a.determinant=m;a.equals=z;a.exactEquals=D;a.frob=h;a.fromRotation=e;a.fromScaling=k;a.fromTranslation=u;a.identity=w;a.invert=x;a.mat2d=v;a.mul=l;a.multiply=l;a.multiplyScalar=y;a.multiplyScalarAndAdd=B;a.rotate=
g;a.scale=f;a.set=n;a.str=p;a.sub=q;a.subtract=q;a.translate=d})},"esri/widgets/Legend/styles/support/relationshipUtils":function(){define(["exports","../../../../symbols/support/svgUtils","../../../../symbols/support/utils","../../../support/widgetUtils","../../../support/jsxFactory"],function(a,b,c,w,n){function x(g,f,d){const e=`${d}_arrowStart`;d=`${d}_arrowEnd`;g="left"===g;const k={markerStart:null,markerEnd:null};switch(f){case "HL":g?k.markerStart=`url(#${d})`:k.markerEnd=`url(#${e})`;break;
case "LL":k.markerStart=`url(#${d})`;break;case "LH":g?k.markerEnd=`url(#${e})`:k.markerStart=`url(#${d})`;break;default:k.markerEnd=`url(#${e})`}return k}function m(g,f,d,e,k=60){const {focus:u,numClasses:p,colors:h,rotation:r}=g;g=!!u;const q=Math.sqrt(k**2+k**2)+(g?0:5),y=[],B=[];var D=[],z=(k||75)/p;for(var v=0;v<p;v++){var A=v*z;for(var t=0;t<p;t++){var C=t*z,E=b.generateFillAttributes(h[v][t]);const F=b.generateStrokeAttributes(null);C={type:"rect",x:C,y:A,width:z,height:z};const H=b.renderDef(E);
H&&y.push(H);(E=b.renderShape(C,E.fill,F,null))&&B.push(E);D.push(b.getBoundingBox(C))}}z=null;g||(z="margin: -15px -15px -18px -15px");v=x("left",u,f);A=x("right",u,f);t=b.computeBBox(D);D=b.getTransformMatrix(t,q,q,0,!1,r,!1);t=b.getTransformMatrix(t,q,q,0,!1,g?-45:null,!1);d={filter:c.getCSSFilterFromEffectList(e)??void 0,opacity:null==d?"":`${d}`};return n.tsx("div",{styles:d,class:g?l.diamondMidColRamp:l.squareTableCell},n.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:q,height:q,style:z},
n.tsx("defs",null,n.tsx("marker",{id:`${f}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n.tsx("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),n.tsx("marker",{id:`${f}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n.tsx("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),y),n.tsx("g",{transform:D},B),n.tsx("g",{transform:t},
n.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":v.markerStart,"marker-end":v.markerEnd,x1:-10,y1:k-15,x2:-10,y2:15}),n.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":A.markerStart,"marker-end":A.markerEnd,x1:15,y1:k+10,x2:k-15,y2:k+10}))))}const l={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",
diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",
squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};a.renderRelationshipRamp=function(g,f,d,e){const {focus:k,labels:u}=g,p=!!k;g=m(g,f,d,e);f={justifyContent:"center"};d=w.isRTL();return p?n.tsx("div",{class:l.diamondContainer,styles:f},n.tsx("div",{class:l.diamondLeftCol},d?u.right:u.left),n.tsx("div",{class:l.diamondMidCol},n.tsx("div",{class:l.diamondMidColLabel},u.top),g,n.tsx("div",
{class:l.diamondMidColLabel},u.bottom)),n.tsx("div",{class:l.diamondRightCol},d?u.left:u.right)):n.tsx("div",{class:l.squareTable},n.tsx("div",{class:l.squareTableRow},n.tsx("div",{class:w.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelRightBottom)},d?u.top:u.left),n.tsx("div",{class:l.squareTableCell}),n.tsx("div",{class:w.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelLeftBottom)},d?u.left:u.top)),n.tsx("div",{class:l.squareTableRow},n.tsx("div",{class:l.squareTableCell}),
g,n.tsx("div",{class:l.squareTableCell})),n.tsx("div",{class:l.squareTableRow},n.tsx("div",{class:w.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelRightTop)},d?u.right:u.bottom),n.tsx("div",{class:l.squareTableCell}),n.tsx("div",{class:w.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelLeftTop)},d?u.bottom:u.right)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define(["exports","../../../core/lang",
"../../../symbols/support/gfxUtils","../../../symbols/support/previewSymbol3D"],function(a,b,c,w){function n(f){if(f){var {type:d}=f;return d.includes("3d")?w.getSymbolLayerFill(f.symbolLayers.getItemAt(0)):"simple-line"===d||"simple-marker"===f.type&&("x"===f.style||"cross"===f.style)?(f=c.getStroke(f))&&f.color:c.getFill(f)}}function x(f,d){const e=d.HH.label,k=d.LL.label,u=d.HL.label;d=d.LH.label;switch(f){case "HH":return{top:e,bottom:k,left:u,right:d};case "HL":return{top:u,bottom:d,left:k,right:e};
case "LL":return{top:k,bottom:e,left:d,right:u};case "LH":return{top:d,bottom:u,left:e,right:k};default:return{top:e,bottom:k,left:u,right:d}}}function m(f){let d=l[f];f&&null==d&&(d=l.HH);return d||0}const l={HH:315,HL:45,LL:135,LH:225},g={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};a.getRelationshipRampColors2D=function(f,d){const e=[],k=f.length**.5;
f=b.clone(f);var u=(d||"HH").split("");d=u[0];for(u="H"===u[1];f.length;){const p=[];for(;p.length<k;)p.push(f.shift());u&&p.reverse();e.push(p)}"L"===d&&e.reverse();return e};a.getRelationshipRampElement=function(f){const {focus:d,infos:e,numClasses:k}=f;var u=g[k];const p={};e.forEach(h=>{p[h.value]={label:h.label,fill:n(h.symbol)}});f=[];for(let h=0;h<k;h++){const r=[];for(let q=0;q<k;q++)r.push(p[u[h][q]].fill);f.push(r)}u=x(d,p);return{type:"relationship-ramp",numClasses:k,focus:d,colors:f,labels:u,
rotation:m(d)}};a.getRotationAngleForFocus=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewSymbol3D":function(){define("exports ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./utils ./webStyleSymbolUtils".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,
p,h){function r(P){const U=P.outline;var N=m.isSome(P.material)?P.material.color:null;N=m.isSome(N)?N.toHex():null;if(m.isNone(U)||"pattern"in U&&m.isSome(U.pattern)&&"style"===U.pattern.type&&"none"===U.pattern.style)return"fill"===P.type&&"#ffffff"===N?{color:"#bdc3c7",width:.75}:null;P=g.pt2px(U.size)||0;return{color:"rgba("+(m.isSome(U.color)?U.color.toRgba():"255,255,255,1")+")",width:Math.min(P,J),style:"pattern"in U&&m.isSome(U.pattern)&&"style"===U.pattern.type?f.dekebabifyLineStyle(U.pattern.style):
null,join:"butt",cap:"patternCap"in U?U.patternCap:"butt"}}function q(P,U){var N=U&&U.resource;N=N&&N.href;if(P.thumbnail&&P.thumbnail.url)return Promise.resolve(P.thumbnail.url);if(N&&"object"!==U.type)return Promise.resolve(p.getIconHref(U));const S=b.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");return P.styleOrigin&&(P.styleOrigin.styleName||P.styleOrigin.styleUrl)?h.resolveWebStyleSymbol(P.styleOrigin,{portal:P.styleOrigin.portal},"webRef").catch(Q=>Q).then(Q=>Q?.thumbnail?.url||
S):Promise.resolve(S)}function y(P,U=1){const N=P.a;P=c.toHSV(P);const {r:S,g:Q,b:W}=c.toRGB({h:P.h,s:P.s/U,v:100-(100-P.v)/U});return[S,Q,W,N]}function B(P){return"water"===P.type?m.isNone(P.color)?null:P.color:m.isNone(P.material)||m.isNone(P.material.color)?null:P.material.color}function D(P,U=0){var N=B(P);if(!N){if("fill"===P.type)return null;U=k.adjustColorComponentBrightness(f.defaultThematicColor.r,U);return[U,U,U,100]}P=N.toRgba();for(N=0;3>N;N++)P[N]=k.adjustColorComponentBrightness(P[N],
U);return P}async function z(P,U){P=P.style;return"none"===P?null:{type:"pattern",x:0,y:0,src:await f.getPatternUrlWithColor(b.getAssetUrl(`esri/symbols/patterns/${P}.png`),U.toCss(!0)),width:5,height:5}}function v(P){return P.outline?r(P):{color:"rgba(0, 0, 0, 1)",width:1.5}}function A(P,U){P=B(P);if(!P)return null;let N;N="rgba("+(k.adjustColorComponentBrightness(P.r,U)+",");N+=k.adjustColorComponentBrightness(P.g,U)+",";N+=k.adjustColorComponentBrightness(P.b,U)+",";return N+P.a+");"}function t(P,
U){U=A(P,U);if(!U)return{};if("pattern"in P&&m.isSome(P.pattern)&&"style"===P.pattern.type&&"none"===P.pattern.style)return null;const N=Math.min(P.size?g.pt2px(P.size):.75,J);return{color:U,width:N,style:"pattern"in P&&m.isSome(P.pattern)&&"style"===P.pattern.type?f.dekebabifyLineStyle(P.pattern.style):null,cap:"cap"in P?P.cap:null,join:"join"in P?"miter"===P.join?g.pt2px(2):P.join:null}}function C(P,U,N){N=null!=N?.75*N:0;return{type:"linear",x1:N?.25*N:0,y1:N?.5*N:0,x2:N||4,y2:N?.5*N:4,colors:[{color:P,
offset:0},{color:U,offset:1}]}}function E(P){const U=P.depth,N=P.height;P=P.width;return 0!==P&&0!==U&&0!==N&&P===U&&null!=P&&null!=N&&P<N}function F(P,U,N){const S=[];if(!P)return S;switch(P.type){case "icon":switch(P.resource&&P.resource.primitive||d.defaultPrimitive){case "circle":S.push({shape:{type:"circle",cx:0,cy:0,r:.5*U},fill:D(P,0),stroke:r(P)});break;case "square":S.push({shape:{type:"path",path:[{command:"M",values:[0,U]},{command:"L",values:[0,0]},{command:"L",values:[U,0]},{command:"L",
values:[U,U]},{command:"Z",values:[]}]},fill:D(P,0),stroke:r(P)});break;case "triangle":S.push({shape:{type:"path",path:[{command:"M",values:[0,U]},{command:"L",values:[.5*U,0]},{command:"L",values:[U,U]},{command:"Z",values:[]}]},fill:D(P,0),stroke:r(P)});break;case "cross":S.push({shape:{type:"path",path:[{command:"M",values:[.5*U,0]},{command:"L",values:[.5*U,U]},{command:"M",values:[0,.5*U]},{command:"L",values:[U,.5*U]}]},stroke:v(P)});break;case "x":S.push({shape:{type:"path",path:[{command:"M",
values:[0,0]},{command:"L",values:[U,U]},{command:"M",values:[U,0]},{command:"L",values:[0,U]}]},stroke:v(P)});break;case "kite":S.push({shape:{type:"path",path:[{command:"M",values:[0,.5*U]},{command:"L",values:[.5*U,0]},{command:"L",values:[U,.5*U]},{command:"L",values:[.5*U,U]},{command:"Z",values:[]}]},fill:D(P,0),stroke:r(P)})}break;case "object":switch(P.resource&&P.resource.primitive||e.defaultPrimitive){case "cone":var Q=D(P,0);P=D(P,-.6);P=C(Q,P,N?G:U);U=k.getConeShapes(U,N);S.push({shape:U[0],
fill:P});S.push({shape:U[1],fill:P});break;case "inverted-cone":N=D(P,0);P=D(P,-.6);P=C(N,P,U);U=k.getInvertedConeShapes(U);S.push({shape:U[0],fill:P});S.push({shape:U[1],fill:N});break;case "cube":U=k.getCubeShapes(U,N);S.push({shape:U[0],fill:D(P,0)});S.push({shape:U[1],fill:D(P,-.3)});S.push({shape:U[2],fill:D(P,-.5)});break;case "cylinder":Q=D(P,0);const W=D(P,-.6);Q=C(Q,W,N?G:U);U=k.getCylinderShapes(U,N);S.push({shape:U[0],fill:Q});S.push({shape:U[1],fill:Q});S.push({shape:U[2],fill:D(P,0)});
break;case "diamond":U=k.getDiamondShapes(U);S.push({shape:U[0],fill:D(P,-.3)});S.push({shape:U[1],fill:D(P,0)});S.push({shape:U[2],fill:D(P,-.3)});S.push({shape:U[3],fill:D(P,-.7)});break;case "sphere":N=D(P,0);P=D(P,-.6);P=C(N,P);P.x1=0;P.y1=0;P.x2=.25*U;P.y2=.25*U;S.push({shape:{type:"circle",cx:0,cy:0,r:.5*U},fill:P});break;case "tetrahedron":U=k.getTetrahedronShapes(U),S.push({shape:U[0],fill:D(P,-.3)}),S.push({shape:U[1],fill:D(P,0)}),S.push({shape:U[2],fill:D(P,-.6)})}}return S}function H(P){return(P=
"number"===typeof P?.size?P?.size:null)?g.pt2px(P):null}function K(P,U){const N=H(U),S=U?.maxSize?g.pt2px(U.maxSize):null,Q=U?.disableUpsampling??!1,W=P.symbolLayers,V=[];let T=0,X=0;const Z=W.getItemAt(W.length-1);let Y;Z&&"icon"===Z.type&&(Y=Z.size&&g.pt2px(Z.size));W.forEach(aa=>{if("icon"===aa.type||"object"===aa.type){var ia="icon"===aa.type?aa.size&&g.pt2px(aa.size):0,na=N||ia?Math.ceil(Math.min(N||ia,S||O)):R;if(aa&&aa.resource&&aa.resource.href){var ba=q(P,aa).then(ea=>{const ja=aa.get("material.color");
var ka="icon"===aa.type?"multiply":"tint";return u.tintImageWithColor(ea,na,ja,ka,Q)}).then(ea=>{const ja=ea.width,ka=ea.height;T=Math.max(T,ja);X=Math.max(X,ka);return[{shape:{type:"image",x:0,y:0,width:ja,height:ka,src:ea.url},fill:null,stroke:null}]});V.push(ba)}else ba=na,"icon"===aa.type&&Y&&N&&(ba=ia/Y*na),ia="tall"===U?.symbolConfig||U?.symbolConfig?.isTall||("object"===aa.type?E(aa):!1),T=Math.max(T,ia?G:ba),X=Math.max(X,ba),V.push(Promise.resolve(F(aa,ba,ia)))}});return l.eachAlways(V).then(aa=>
{const ia=[];aa.forEach(na=>{na.value?ia.push(na.value):na.error&&x.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",na.error)});return u.renderSymbol(ia,[T,X],{node:U&&U.node,scale:!1,opacity:U&&U.opacity})})}function I(P,U){const N=P.symbolLayers,S=[];P=p.isVolumetricSymbol(P);const Q=H(U),W=(U&&U.maxSize?g.pt2px(U.maxSize):null)||J;let V=0,T=0,X;N.forEach((Z,Y)=>{if(Z&&("line"===Z.type||"path"===Z.type)){var aa=[];switch(Z.type){case "line":var ia=t(Z,0);
if(m.isNone(ia))break;var na=ia&&ia.width||0;0===Y&&(X=na);Z=Math.min(Q||na,W);Y=0===Y?Z:Q?na/X*Z:Z;na=Y>M/2?2*Y:M;T=Math.max(T,Y);V=Math.max(V,na);ia.width=Y;aa.push({shape:{type:"path",path:[{command:"M",values:[0,.5*T]},{command:"L",values:[V,.5*T]}]},stroke:ia});break;case "path":ia=Math.min(Q||R,W);Y=D(Z,0);na=D(Z,-.2);var ba=A(Z,-.4);ba=ba?{color:ba,width:1}:{};if("quad"===Z.profile){const ea=Z.width;Z=Z.height;Z=k.getPathSymbolShapes(ea&&Z?ea/Z:1,0===Z,0===ea);ba={...ba,join:"bevel"};aa.push({shape:Z[0],
fill:na,stroke:ba});aa.push({shape:Z[1],fill:na,stroke:ba});aa.push({shape:Z[2],fill:Y,stroke:ba})}else aa.push({shape:k.shapes.pathSymbol3DLayer[0],fill:na,stroke:ba}),aa.push({shape:k.shapes.pathSymbol3DLayer[1],fill:Y,stroke:ba});V=T=Math.max(T,ia)}S.push(aa)}});return Promise.resolve(u.renderSymbol(S,[V,T],{node:U&&U.node,scale:P,opacity:U&&U.opacity}))}async function L(P,U){const N="mesh-3d"===P.type;P=P.symbolLayers;var S=H(U);const Q=U&&U.maxSize?g.pt2px(U.maxSize):null;S=S||R;const W=[];let V=
0,T=0;var X=!1;for(let ba=0;ba<P.length;ba++){var Z=P.getItemAt(ba);const ea=[];if(!N||"fill"===Z.type){var Y=k.shapes.fill[0];switch(Z.type){case "fill":var aa=r(Z);X=Math.min(S,Q||O);V=Math.max(V,X);T=Math.max(T,X);X=!0;var ia=D(Z,0),na="pattern"in Z?Z.pattern:null;Z=B(Z);!N&&m.isSome(na)&&"style"===na.type&&"solid"!==na.style&&Z&&(ia=await z(na,Z));ea.push({shape:Y,fill:ia,stroke:aa});break;case "line":Z=t(Z,0);if(m.isNone(Z))break;Z={stroke:Z,shape:Y};V=Math.max(V,R);T=Math.max(T,R);ea.push(Z);
break;case "extrude":Y={join:"round",width:1,...t(Z,-.4)};aa=D(Z,0);Z=D(Z,-.2);ia=Math.min(S,Q||O);na=k.getExtrudeSymbolShapes(ia);Y.width=1;ea.push({shape:na[0],fill:Z,stroke:Y});ea.push({shape:na[1],fill:Z,stroke:Y});ea.push({shape:na[2],fill:aa,stroke:Y});Z=.7*R+.5*ia;V=Math.max(V,R);T=Math.max(T,Z);break;case "water":X=m.unwrapOrThrow(B(Z)),Z=y(X),Y=y(X,2),aa=y(X,3),ia=k.getWaterSymbolShapes(),X=!0,ea.push({shape:ia[0],fill:Z}),ea.push({shape:ia[1],fill:Y}),ea.push({shape:ia[2],fill:aa}),Z=Math.min(S,
Q||O),V=Math.max(V,Z),T=Math.max(T,Z)}W.push(ea)}}return u.renderSymbol(W,[V,T],{node:U&&U.node,scale:X,opacity:U&&U.opacity})}const R=k.SymbolSizeDefaults.size,O=k.SymbolSizeDefaults.maxSize,J=k.SymbolSizeDefaults.maxOutlineSize,M=k.SymbolSizeDefaults.lineWidth,G=k.SymbolSizeDefaults.tallSymbolWidth;a.getPatternDescriptor=z;a.getSizeFromOptions=H;a.getSymbolLayerFill=D;a.previewSymbol3D=function(P,U){if(0===P.symbolLayers.length)return Promise.reject(new n("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));
switch(P.type){case "point-3d":return K(P,U);case "line-3d":return I(P,U);case "polygon-3d":case "mesh-3d":return L(P,U)}return Promise.reject(new n("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/maybe ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(p,h,r,q,y){var B=p.data;const D=r&&n.isSome(r.portal)?r.portal:m.getDefault(),z={portal:D,url:x.urlToObject(p.baseUrl),origin:"portal-item"};B=B.items.find(E=>E.name===h);if(!B)return Promise.reject(new w("symbolstyleutils:symbol-name-not-found",`The symbol name '${h}' could not be found`,{symbolName:h}));let v=l.fromJSON(d.symbolUrlFromStyleItem(B,q),z),A=B.thumbnail?.href??null;const t=B.thumbnail&&B.thumbnail.imageData;c.isDevEnvironment()&&(v=c.adjustStaticAGOUrl(v)??
"",A=c.adjustStaticAGOUrl(A));const C={portal:D,url:x.urlToObject(x.removeFile(v)),origin:"portal-item"};return d.requestJSON(v,y).then(E=>{E="cimRef"===q?d.makeCIMSymbolRef(E.data):E.data;if((E=g.fromJSON(E,C))&&b.isSymbol3D(E)){if(A){const F=l.fromJSON(A,z);E.thumbnail=new e.Thumbnail({url:F})}else t&&(E.thumbnail=new e.Thumbnail({url:`data:image/png;base64,${t}`}));p.styleUrl?E.styleOrigin=new f({portal:r.portal,styleUrl:p.styleUrl,name:h}):p.styleName&&(E.styleOrigin=new f({portal:r.portal,styleName:p.styleName,
name:h}))}return E})}function u(p,h,r){const q=d.Style2DUrlTemplate.replace(/\{SymbolName\}/gi,p),y=n.isSome(h.portal)?h.portal:m.getDefault();return d.requestJSON(q,r).then(B=>{B=d.makeCIMSymbolRef(B.data);return g.fromJSON(B,{portal:y,url:x.urlToObject(x.removeFile(q)),origin:"portal-item"})})}a.fetchSymbolFromStyle=k;a.resolveWebStyleSymbol=function(p,h,r,q){const y=p.name;return n.isNone(y)?Promise.reject(new w("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
p.styleName&&"Esri2DPointSymbolsStyle"===p.styleName?u(y,h,q):d.fetchStyle(p,h,q).then(B=>k(n.unwrapOrThrow(B),y,h,r,q))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,c=/^qaext.arcgis.com$/,w=/^[\w-]*\.mapsdevext.arcgis.com$/,n=/^[\w-]*\.mapsqa.arcgis.com$/,x=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,w,n];a.adjustStaticAGOUrl=function(m,l){return m?
(l=l||globalThis.location.hostname)?null!=l.match(b)||null!=l.match(w)?m.replace("static.arcgis.com","staticdev.arcgis.com"):null!=l.match(c)||null!=l.match(n)?m.replace("static.arcgis.com","staticqa.arcgis.com"):m:m:m};a.isDevEnvironment=function(m){m=m||globalThis.location.hostname;return x.some(l=>null!=m?.match(l))};a.isTelemetryDevEnvironment=function(m){m=m||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(x).some(l=>null!=m?.match(l))};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports","../../core/maybe"],function(a,b){a.extractSafeScaleBounds=function(c){c=c.effectiveScaleRange;return{minScale:c?.minScale??0,maxScale:c?.maxScale??0}};a.highlightsSupported=function(c){return c&&"function"===typeof c.highlight};a.isScaleRangeActive=function(c,w){return b.isSome(c)&&0<c||b.isSome(w)&&0<w};a.occludeesSupported=function(c){return c&&"function"===typeof c.maskOccludee};a.scaleBoundsPredicate=function(c,
w,n){return b.isNone(c)||c>n&&(0===w||c<w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g){a.GoToMixin=f=>{f=function(d){function e(...u){u=k.call(this,
...u);u.goToOverride=null;u.view=null;return u}b._inherits(e,d);var k=b._createSuper(e);e.prototype.callGoTo=function(u){const {view:p}=this;w.assertIsSome(p);return this.goToOverride?this.goToOverride(p,u):p.goTo(u.target,u.options)};return b._createClass(e)}(f);c.__decorate([n.property()],f.prototype,"goToOverride",void 0);c.__decorate([n.property()],f.prototype,"view",void 0);return f=c.__decorate([g.subclass("esri.widgets.support.GoTo")],f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e){c=function(k){function u(h){h=p.call(this,h);h._handles=new n;h.view=null;h.layerViews=new w;
return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.initialize=function(){this._handles.add(x.when(()=>this.view?.map?.ground,h=>h.load()));this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};k.destroy=function(){this._set("view",null);this._handles&&(this._handles.destroy(),this._handles=null)};k._layerViewsAfterChangesHandler=function(){this._handles.remove("updating");this._handles.add(this.layerViews.map(h=>x.watch(()=>h.updating,()=>
this._updateUpdating(),x.sync)).toArray(),"updating");this._updateUpdating()};k._updateUpdating=function(){this.notifyChange("updating")};a._createClass(u,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new e({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(h=>h.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);
return u}(c);b.__decorate([m.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([m.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([m.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([m.property({type:w,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"suspended",null);return c=b.__decorate([d.subclass("esri.views.GroundView")],c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){c=function(h){function r(y){y=q.call(this,y);y.demResolution={min:-1,max:-1};y.noDataValue=p.ELEVATION_NODATA_VALUE;return y}a._inherits(r,h);var q=a._createSuper(r);h=r.prototype;h.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};h.elevationAt=function(y,B){if(n.isNone(this.extent)||!k.extentContainsXYZ(this.extent,y,B)){const D=n.isSome(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:
null;w.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${y}, ${B}) is outside of the sampler extent (${D})`);return this.noDataValue}return n.unwrapOr(this.view.elevationProvider?.getElevation(y,B,0,this.spatialReference,"ground"),this.noDataValue)};h.queryElevation=function(y){return u.updateGeometryElevation(y.clone(),this)};a._createClass(r,[{key:"extent",get:function(){const y=this.view.basemapTerrain;if(null==y||n.isNone(y.extent)||n.isNone(y.spatialReference))return null;
const B=e.toExtent(y.extent,y.spatialReference);B.zmin=y.visibleElevationBounds.min;B.zmax=y.visibleElevationBounds.max;return B}},{key:"spatialReference",get:function(){return n.unwrapOr(this.view.basemapTerrain?.spatialReference,d.WGS84)}}]);return r}(c.EventedAccessor);b.__decorate([x.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([x.property()],
c.prototype,"spatialReference",null);b.__decorate([x.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(r,q){const y=e(r,q.spatialReference);if(!y)return null;switch(r.type){case "point":r.z=q.elevationAt(y.x,y.y);break;case "polyline":p.spatialReference=y.spatialReference;var B=r.hasM&&!r.hasZ;for(var D=0;D<r.paths.length;D++){var z=r.paths[D],v=y.paths[D];for(let A=0;A<z.length;A++){const t=z[A],C=v[A];p.x=C[0];p.y=C[1];B&&(t[3]=t[2]);t[2]=q.elevationAt(p.x,p.y)}}r.hasZ=!0;break;case "multipoint":p.spatialReference=y.spatialReference;B=r.hasM&&!r.hasZ;for(D=
0;D<r.points.length;D++)z=r.points[D],v=y.points[D],p.x=v[0],p.y=v[1],B&&(z[3]=z[2]),z[2]=q.elevationAt(p.x,p.y);r.hasZ=!0}return r}function e(r,q){if(x.isNone(r))return null;const y=r.spatialReference;if(y.equals(q))return r;(r=g.project(r,q))||k.error(`Cannot project geometry spatial reference (wkid:${y.wkid}) to elevation sampler spatial reference (wkid:${q.wkid})`);return r}const k=n.getLogger("esri.layers.support.ElevationSampler");c=function(){function r(){}var q=r.prototype;q.queryElevation=
function(y){return d(y.clone(),this)};q.on=function(){return h};q.projectIfRequired=function(y,B){return e(y,B)};return b._createClass(r)}();let u=function(r){function q(B,D,z){var v=y.call(this);v.tile=B;v.noDataValue=z;z=B.tile.extent;v.extent=l.toExtent(z,D.spatialReference);v.extent.zmin=B.zmin;v.extent.zmax=B.zmax;v._aaExtent=z;z=m.getMetersPerUnitForSR(D.spatialReference);B=D.lodAt(B.tile.level).resolution*z;v.demResolution={min:B,max:B};return v}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;
r.contains=function(B){B=this.projectIfRequired(B,this.spatialReference);return x.isNone(B)?!1:this.containsAt(B.x,B.y)};r.containsAt=function(B,D){return l.containsXY(this._aaExtent,B,D)};r.elevationAt=function(B,D){if(!this.containsAt(B,D)){const z=this.extent;k.warn("#elevationAt()",`Point used to sample elevation (${B}, ${D}) is outside of the sampler extent (${`${z.xmin}, ${z.ymin}, ${z.xmax}, ${z.ymax}`})`);return this.noDataValue}return x.unwrapOr(this.tile.sample(B,D),this.noDataValue)};b._createClass(q,
[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return q}(c);w=function(r){function q(B,D,z){var v=y.call(this);let A;"number"===typeof D?(v.noDataValue=D,A=null):(A=D,v.noDataValue=z);v.samplers=A?B.map(t=>new u(t,A,v.noDataValue)):B;if(B=v.samplers[0]){v.extent=B.extent.clone();const {min:t,max:C}=B.demResolution;v.demResolution={min:t,max:C};for(B=1;B<v.samplers.length;B++)D=v.samplers[B],v.extent.union(D.extent),v.demResolution.min=Math.min(v.demResolution.min,
D.demResolution.min),v.demResolution.max=Math.max(v.demResolution.max,D.demResolution.max)}else v.extent=l.toExtent(l.create(),A.spatialReference),v.demResolution={min:0,max:0};return v}b._inherits(q,r);var y=b._createSuper(q);q.prototype.elevationAt=function(B,D){for(const z of this.samplers)if(z.containsAt(B,D))return z.elevationAt(B,D);k.warn("#elevationAt()",`Point used to sample elevation (${B}, ${D}) is outside of the sampler`);return this.noDataValue};b._createClass(q,[{key:"spatialReference",
get:function(){return this.extent.spatialReference}}]);return q}(c);const p=new f,h={remove(){}};a.ElevationSamplerBase=c;a.MultiTileElevationSampler=w;a.TileElevationSampler=u;a.updateGeometryElevation=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,w){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const n=c.create();
w.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,n);c=c.create([-180,-90,180,90]);let x=3;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=c;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=2;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
a.WEBMERCATOR_WORLD_EXTENT=n;a.getElevationDesiredResolutionLevel=function(m){return 4>m?3:x};a.test={setElevationDesiredMaxUpscalingDistance(m){x=null==m?3:m}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(){return new w("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}c=function(){function y(D){var z=y.checkUnsupported(D);if(x.isSome(z))throw z;D=x.unwrap(D);this.spatialReference=D.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=g.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[D.origin.x,D.origin.y];
this.pixelSize=D.size[0];this.dpi=D.dpi;var v=D.lods.reduce((C,E,F)=>{E.level<C.min&&(C.min=E.level,C.minIndex=F);C.max=Math.max(C.max,E.level);return C},{min:Infinity,minIndex:0,max:-Infinity}),A=D.lods[v.minIndex];const t=2**A.level;z=A.resolution*t;A=A.scale*t;this.levels=Array(v.max+1);for(v=0;v<this.levels.length;v++)this.levels[v]={resolution:z,scale:A,tileSize:[z*D.size[0],z*D.size[1]]},z/=2,A/=2}var B=y.prototype;B.clone=function(){return new y(this.toTileInfo())};B.toTileInfo=function(){return new p({dpi:this.dpi,
origin:new h({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((D,z)=>new u({level:z,scale:D.scale,resolution:D.resolution}))})};B.getExtent=function(D,z,v,A){var t=this.levels[D];D=t.tileSize[0];t=t.tileSize[1];A[0]=this.origin[0]+v*D;A[2]=this.origin[0]+(v+1)*D;A[3]=this.origin[1]-z*t;A[1]=this.origin[1]-(z+1)*t};B.convertExtentToRadians=function(D,z){this._isWebMercator?(z[0]=
k.x2lon(D[0]),z[1]=k.y2lat(D[1]),z[2]=k.x2lon(D[2]),z[3]=k.y2lat(D[3])):this._isGCS&&(z[0]=n.deg2rad(D[0]),z[1]=n.deg2rad(D[1]),z[2]=n.deg2rad(D[2]),z[3]=n.deg2rad(D[3]))};B.getExtentGeometry=function(D,z,v,A=new l){this.getExtent(D,z,v,q);A.spatialReference=this.spatialReference;A.xmin=q[0];A.ymin=q[1];A.xmax=q[2];A.ymax=q[3];A.zmin=void 0;A.zmax=void 0;return A};B.ensureMaxLod=function(D){if(null==D)return!1;for(var z=!1;this.levels.length<=D;){z=this.levels[this.levels.length-1];const v=z.resolution/
2;this.levels.push({resolution:v,scale:z.scale/2,tileSize:[v*this.pixelSize,v*this.pixelSize]});z=!0}return z};B.capMaxLod=function(D){this.levels.length>D+1&&(this.levels.length=D+1)};B.getMaxLod=function(){return this.levels.length-1};B.scaleAtLevel=function(D){return this.levels[0].scale/2**D};B.levelAtScale=function(D){const z=this.levels[0].scale;return D>=z?0:Math.log(z/D)*Math.LOG2E};B.resolutionAtLevel=function(D){return this.levels[0].resolution/2**D};B.compatibleWith=function(D){if(!(D instanceof
y)){if(y.checkUnsupported(D))return!1;D=new y(D)}if(!D.spatialReference.equals(this.spatialReference)||D.pixelSize!==this.pixelSize)return!1;const z=Math.min(this.levels.length,D.levels.length)-1,v=this.levels[z].resolution;let A=.5*v;if(!n.floatEqualAbsolute(D.origin[0],this.origin[0],A)||!n.floatEqualAbsolute(D.origin[1],this.origin[1],A))return!1;A=.5*v/2**z/this.pixelSize*12;return n.floatEqualAbsolute(v,D.levels[z].resolution,A)};B.rootTilesInExtent=function(D,z=null,v=Infinity){const A=[],t=
this.levels[0].tileSize;if(x.isNone(D)||0===t[0]||0===t[1])return A;y.computeRowColExtent(D,t,this.origin,q);D=q[1];let C=q[3],E=q[0],F=q[2];var H=F-E;const K=C-D;H*K>v&&(v=Math.floor(Math.sqrt(v)),K>v&&(D=D+Math.floor(.5*K)-Math.floor(.5*v),C=D+v),H>v&&(E=E+Math.floor(.5*H)-Math.floor(.5*v),F=E+v));for(v=D;v<C;v++)for(H=E;H<F;H++)A.push([0,v,H]);x.isSome(z)&&(z[0]=this.origin[0]+E*t[0],z[1]=this.origin[1]-C*t[1],z[2]=this.origin[0]+F*t[0],z[3]=this.origin[1]-D*t[1]);return A};y.computeRowColExtent=
function(D,z,v,A){const t=.001*(D[2]-D[0]+(D[3]-D[1]));A[0]=Math.max(0,Math.floor((D[0]+t-v[0])/z[0]));A[2]=Math.max(0,Math.ceil((D[2]-t-v[0])/z[0]));A[1]=Math.max(0,Math.floor((v[1]-D[3]+t)/z[1]));A[3]=Math.max(0,Math.ceil((v[1]-D[1]-t)/z[1]))};y.isPowerOfTwo=function(D){D=D.lods;const z=D[0].resolution*2**D[0].level;return!D.some(v=>!n.floatEqualRelative(v.resolution,z/2**v.level))};y.hasGapInLevels=function(D){D=D.lods.map(z=>z.level);D.sort((z,v)=>z-v);for(let z=1;z<D.length;z++)if(D[z]!==D[0]+
z)return!0;return!1};y.tileSizeSupported=function(D){const z=D.size[1];return z===D.size[0]&&0===(z&z-1)&&128<=z&&512>=z};y.hasOriginPerLODs=function(D){const z=D.origin;return D.lods.some(v=>null!=v.origin&&(v.origin[0]!==z.x||v.origin[1]!==z.y))};y.getMissingTileInfoError=function(){return new w("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};y.checkUnsupported=function(D){return x.isNone(D)?r():1>D.lods.length?new w("tilingscheme:generic","Tiling scheme must have at least one level"):
y.isPowerOfTwo(D)?y.hasGapInLevels(D)?new w("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):y.tileSizeSupported(D)?y.hasOriginPerLODs(D)?new w("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new w("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new w("tilingscheme:power-of-two","Tiling scheme must be power of two")};y.fromExtent=function(D,z){const v=D[2]-D[0],A=D[3]-D[1],t=
m.getMetersPerUnitForSR(z),C=1.2*Math.max(v,A);D=new y(new p({size:[256,256],origin:new h({x:D[0]-.5*(C-v),y:D[3]+.5*(C-A)}),lods:[new u({level:0,resolution:C/256,scale:1/(256/96*.0254/(C*t))})],spatialReference:z}));D.ensureMaxLod(20);return D};y.makeWebMercatorAuxiliarySphere=function(D){const z=new y(y.WebMercatorAuxiliarySphereTileInfo);z.ensureMaxLod(D);return z};y.makeGCSWithTileSize=function(D,z=256,v=16){const A=256/z;D=new y(new p({size:[z,z],origin:new h({x:-180,y:90,spatialReference:D}),
spatialReference:D,lods:[new u({level:0,resolution:.703125*A,scale:2.95497598570834E8*A})]}));D.ensureMaxLod(v);return D};b._createClass(y,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return y}();c.WebMercatorAuxiliarySphereTileInfo=new p({size:[256,256],origin:new h({x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:f.WebMercator}),spatialReference:f.WebMercator,lods:[new u({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});
c.WebMercatorAuxiliarySphere=c.makeWebMercatorAuxiliarySphere(19);const q=d.create();a.TilingScheme=c;a.getMissingTileInfoError=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){var g;c=g=function(f){function d(k){k=e.call(this,k);k.cols=null;k.level=0;k.levelValue=null;k.origin=null;k.resolution=0;k.rows=null;k.scale=0;return k}a._inherits(d,f);var e=a._createSuper(d);d.prototype.clone=function(){return new g({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return a._createClass(d)}(c.JSONSupport);b.__decorate([w.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},
"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);b.__decorate([w.property({type:n.Integer,json:{write:!0}})],c.prototype,"level",void 0);b.__decorate([w.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);b.__decorate([w.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);b.__decorate([w.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);b.__decorate([w.property({json:{write:!0,
origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0);b.__decorate([w.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=g=b.__decorate([l.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){var D;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});w=D=function(z){function v(t){t=A.call(this,t);t.dpi=96;t.format=null;t.origin=null;t.minScale=0;t.maxScale=0;t.size=null;t.spatialReference=null;return t}a._inherits(v,z);var A=a._createSuper(v);v.create=
function(t={}){const {resolutionFactor:C=1,scales:E,size:F=256,spatialReference:H=p.WebMercator,numLODs:K=24}=t;if(!r.isValid(H)){t=[];if(E)for(var I=0;I<E.length;I++){var L=E[I];t.push(new y({level:I,scale:L,resolution:L}))}else for(I=5E-4,L=K-1;0<=L;L--)t.unshift(new y({level:L,scale:I,resolution:I})),I*=2;return new D({dpi:96,lods:t,origin:new u(0,0,H),size:[F,F],spatialReference:H})}I=r.getInfo(H);t=t.origin?new u({x:t.origin.x,y:t.origin.y,spatialReference:H}):I?new u({x:I.origin[0],y:I.origin[1],
spatialReference:H}):new u({x:0,y:0,spatialReference:H});I=1/(39.37*x.getMetersPerUnitForSR(H)*96);L=[];if(E)for(var R=0;R<E.length;R++){var O=E[R];L.push(new y({level:R,scale:O,resolution:O*I}))}else{var J=r.isGeographic(H)?512/F*5.916575275917094E8:256/F*5.91657527591555E8;R=Math.ceil(K/C);L.push(new y({level:0,scale:J,resolution:J*I}));for(O=1;O<R;O++)J/=2**C,L.push(new y({level:O,scale:J,resolution:J*I}))}return new D({dpi:96,lods:L,origin:t,size:[F,F],spatialReference:H})};z=v.prototype;z.readOrigin=
function(t,C){return u.fromJSON({spatialReference:C.spatialReference,...t})};z.readSize=function(t,C){return[C.cols,C.rows]};z.writeSize=function(t,C){C.cols=t[0];C.rows=t[1]};z.zoomToScale=function(t){const C=this.scales;if(0>=t)return C[0];if(t>=C.length-1)return C[C.length-1];const E=Math.floor(t);return C[E]/(C[E]/C[E+1])**(t-E)};z.scaleToZoom=function(t){const C=this.scales,E=C.length-1;let F=0;for(;F<E;F++){const H=C[F],K=C[F+1];if(H<=t)break;if(K===t)return F+1;if(H>t&&K<t)return F+Math.log(H/
t)/Math.log(H/K)}return F};z.snapScale=function(t,C=.95){t=this.scaleToZoom(t);return t%Math.floor(t)>=C?this.zoomToScale(Math.ceil(t)):this.zoomToScale(Math.floor(t))};z.tileAt=function(t,C,E,F){var H=this.lodAt(t);if(!H)return null;let K;if("number"===typeof C)K=C,C=E;else{if(r.equals(C.spatialReference,this.spatialReference))K=C.x,C=C.y;else{F=q.project(C,this.spatialReference);if(n.isNone(F))return null;K=F.x;C=F.y}F=E}E=H.resolution*this.size[0];H=H.resolution*this.size[1];F||(F=new B.TileKey(null,
0,0,0,h.create()));F.level=t;F.row=Math.floor((this.origin.y-C)/H+.001);F.col=Math.floor((K-this.origin.x)/E+.001);this.updateTileInfo(F);return F};z.updateTileInfo=function(t,C=D.ExtrapolateOptions.NONE){var E=this.lodAt(t.level);E||C!==D.ExtrapolateOptions.POWER_OF_TWO||(C=this.lods[this.lods.length-1],C.level<t.level&&(E=C));if(E){var F=t.level-E.level;C=E.resolution*this.size[0]/2**F;E=E.resolution*this.size[1]/2**F;t.id=`${t.level}/${t.row}/${t.col}`;t.extent||(t.extent=h.create());t.extent[0]=
this.origin.x+t.col*C;t.extent[1]=this.origin.y-(t.row+1)*E;t.extent[2]=t.extent[0]+C;t.extent[3]=t.extent[1]+E}};z.upsampleTile=function(t){const C=this._upsampleLevels[t.level];if(!C||-1===C.parentLevel)return!1;t.level=C.parentLevel;t.row=Math.floor(t.row/C.factor+.001);t.col=Math.floor(t.col/C.factor+.001);this.updateTileInfo(t);return!0};z.getTileBounds=function(t,C){var E=this.lodAt(C.level);if(null==E)return null;var {resolution:F}=E;E=F*this.size[0];F*=this.size[1];t[0]=this.origin.x+C.col*
E;t[1]=this.origin.y-(C.row+1)*F;t[2]=t[0]+E;t[3]=t[1]+F;return t};z.lodAt=function(t){return this._levelToLOD?.[t]??null};z.clone=function(){return D.fromJSON(this.write({}))};z.getOrCreateCompatible=function(t,C){if(256===this.size[0]&&256===this.size[1])return 256===t?this:null;const E=[],F=this.lods.length;for(let H=0;H<F;H++){const K=this.lods[H];E.push(new y({level:K.level,scale:K.scale,resolution:K.resolution*C}))}return new D({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,
origin:this.origin,spatialReference:this.spatialReference,lods:E})};z._initializeUpsampleLevels=function(){const t=this.lods;this._upsampleLevels=[];let C=null;for(let E=0;E<t.length;E++){const F=t[E];this._upsampleLevels[F.level]={parentLevel:C?C.level:-1,factor:C?C.resolution/F.resolution:0};C=F}};a._createClass(v,[{key:"isWrappable",get:function(){const {spatialReference:t,origin:C}=this;if(t&&C){const E=r.getInfo(t);return t.isWrappable&&!!E&&Math.abs(E.origin[0]-C.x)<=E.dx}return!1}},{key:"lods",
set:function(t){let C=0,E=0;const F=[],H=this._levelToLOD={};t&&(C=-Infinity,E=Infinity,t.forEach(K=>{F.push(K.scale);C=K.scale>C?K.scale:C;E=K.scale<E?K.scale:E;H[K.level]=K}));this._set("scales",F);this._set("minScale",C);this._set("maxScale",E);this._set("lods",t);this._initializeUpsampleLevels()}}]);return v}(w.JSONSupport);b.__decorate([m.property({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0);b.__decorate([m.property({type:Number,json:{write:!0}})],w.prototype,"dpi",
void 0);b.__decorate([m.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0);b.__decorate([m.property({readOnly:!0})],w.prototype,"isWrappable",null);b.__decorate([m.property({type:u,json:{write:!0}})],w.prototype,"origin",void 0);b.__decorate([d.reader("origin")],w.prototype,"readOrigin",null);b.__decorate([m.property({type:[y],value:null,json:{write:!0}})],w.prototype,"lods",null);b.__decorate([m.property({readOnly:!0})],
w.prototype,"minScale",void 0);b.__decorate([m.property({readOnly:!0})],w.prototype,"maxScale",void 0);b.__decorate([m.property({readOnly:!0})],w.prototype,"scales",void 0);b.__decorate([m.property({cast:z=>Array.isArray(z)?z:"number"===typeof z?[z,z]:[256,256]})],w.prototype,"size",void 0);b.__decorate([d.reader("size",["rows","cols"])],w.prototype,"readSize",null);b.__decorate([k.writer("size",{cols:{type:l.Integer},rows:{type:l.Integer}})],w.prototype,"writeSize",null);b.__decorate([m.property({type:p,
json:{write:!0}})],w.prototype,"spatialReference",void 0);w=D=b.__decorate([e.subclass("esri.layers.support.TileInfo")],w);(function(z){z=z.ExtrapolateOptions||(z.ExtrapolateOptions={});z[z.NONE=0]="NONE";z[z.POWER_OF_TWO=1]="POWER_OF_TWO"})(w||(w={}));return w})},"esri/layers/support/TileKey":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,w,n,x,m){this.id=c;this.level=w;this.row=n;this.col=x;this.extent=m});a.TileKey=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/Error ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){a.PopupView=e=>{e=function(k){function u(){return p.apply(this,arguments)}b._inherits(u,k);var p=b._createSuper(u);k=u.prototype;k.fetchPopupFeatures=
async function(h,r){await this.when();const {location:q,queryArea:y,layerViewsAndGraphics:B,clientOnlyGraphics:D}=await this._prepareFetchPopupFeatures(h,r);h=Promise.resolve(D);r=this._queryLayerPopupFeatures(y,B,r);const z=r.map(v=>v.promise);h=n.eachAlwaysValues([h,...z]).then(v=>Array.from(new Set(v.flat())));return{location:q,clientOnlyGraphics:D,allGraphicsPromise:h,promisesPerLayerView:r}};k._queryLayerPopupFeatures=function(h,r,q){return r.map(({layerView:y,graphics:B})=>{B={clientGraphics:B,
event:w.isSome(q)?q.event:void 0,signal:w.isSome(q)?q.signal:void 0,defaultPopupTemplateEnabled:w.isSome(q)?!!q.defaultPopupTemplateEnabled:!1};B=y.fetchPopupFeatures(h,B);return{layerView:y,promise:B}})};k._isValidPopupGraphic=function(h,r){return h&&!!h.getEffectivePopupTemplate(w.isSome(r)&&r.defaultPopupTemplateEnabled)};k._prepareFetchPopupFeatures=async function(h,r){const {clientGraphics:q,queryArea:y,location:B}=await this._popupHitTestGraphics(h,r);h=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:D,
clientOnlyGraphics:z}=this._graphicsPerFetchPopupLayerView(q,h);return{clientOnlyGraphics:z,layerViewsAndGraphics:D,queryArea:y,location:B}};k._popupHitTestGraphics=async function(h,r){var q=await this.popupHitTest(h);h=q.mapPoint;q=q.results.filter(B=>"graphic"===B.type&&this._isValidPopupGraphic(B.graphic,r));const y=q.length?q[0].mapPoint:null;return{clientGraphics:q.map(B=>B.graphic),queryArea:h,location:h||y}};k._getFetchPopupLayerViews=function(){const h=[];this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&
h.push(r)});w.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&h.push(this.graphicsView);return h.reverse()};k._isValidPopupLayerView=function(h){return w.isSome(h)&&(!("layer"in h)||!h.suspended)&&"fetchPopupFeatures"in h};k._graphicsPerFetchPopupLayerView=function(h,r){const q=[],y=new Map;r=r.map(B=>{const D=[];"layer"in B?y.set(B.layer,D):y.set(B.graphics,D);return{layerView:B,graphics:D}});for(const B of h)(h=y.get(B.layer)||y.get(B.sourceLayer)||null)?h.push(B):q.push(B);
return{layerViewsAndGraphics:r,clientOnlyGraphics:q}};return b._createClass(u)}(e);return e=c.__decorate([d.subclass("esri.views.PopupView")],e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,b,c,w){const n=g=>Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"})),x=()=>new Promise((g,f)=>a(["./layers/TileLayerView3D"],
d=>g(n(d)),f)),m=()=>new Promise((g,f)=>a(["./layers/ElevationLayerView3D"],d=>g(n(d)),f)),l={"base-dynamic":()=>new Promise((g,f)=>a(["./layers/BaseDynamicLayerView3D"],d=>g(n(d)),f)),"base-elevation":m,"base-tile":x,"bing-maps":x,"building-scene":()=>new Promise((g,f)=>a(["./layers/BuildingSceneLayerView3D"],d=>g(n(d)),f)),csv:()=>new Promise((g,f)=>a(["./layers/CSVLayerView3D"],d=>g(n(d)),f)),dimension:()=>new Promise((g,f)=>a(["./layers/DimensionLayerView3D"],d=>g(n(d)),f)),elevation:m,feature:()=>
new Promise((g,f)=>a(["./layers/FeatureLayerView3D"],d=>g(n(d)),f)),geojson:()=>new Promise((g,f)=>a(["./layers/GeoJSONLayerView3D"],d=>g(n(d)),f)),graphics:()=>new Promise((g,f)=>a(["./layers/GraphicsLayerView3D"],d=>g(n(d)),f)),group:()=>new Promise((g,f)=>a(["../layers/GroupLayerView"],d=>g(n(d)),f)),imagery:()=>new Promise((g,f)=>a(["./layers/ImageryLayerView3D"],d=>g(n(d)),f)),"integrated-mesh":()=>new Promise((g,f)=>a(["./layers/IntegratedMeshLayerView3D"],d=>g(n(d)),f)),"line-of-sight":()=>
new Promise((g,f)=>a(["./layers/LineOfSightLayerView3D"],d=>g(n(d)),f)),"map-image":()=>new Promise((g,f)=>a(["./layers/MapImageLayerView3D"],d=>g(n(d)),f)),media:()=>new Promise((g,f)=>a(["./layers/MediaLayerView3D"],d=>g(n(d)),f)),"ogc-feature":()=>new Promise((g,f)=>a(["./layers/OGCFeatureLayerView3D"],d=>g(n(d)),f)),"open-street-map":x,"oriented-imagery":()=>new Promise((g,f)=>a(["./layers/FeatureLayerView3D"],d=>g(n(d)),f)),"point-cloud":()=>new Promise((g,f)=>a(["./layers/PointCloudLayerView3D"],
d=>g(n(d)),f)),voxel:()=>new Promise((g,f)=>a(["./layers/VoxelLayerView3D"],d=>g(n(d)),f)),route:()=>new Promise((g,f)=>a(["./layers/RouteLayerView3D"],d=>g(n(d)),f)),scene:g=>null==g.profile||"mesh-pyramids"===g.profile?new Promise((f,d)=>a(["./layers/SceneLayerView3D"],e=>f(n(e)),d)):new Promise((f,d)=>a(["./layers/SceneLayerGraphicsView3D"],e=>f(n(e)),d)),stream:()=>new Promise((g,f)=>a(["./layers/StreamLayerView3D"],d=>g(n(d)),f)),tile:x,"imagery-tile":()=>new Promise((g,f)=>a(["./layers/ImageryTileLayerView3D"],
d=>g(n(d)),f)),"vector-tile":()=>new Promise((g,f)=>a(["./layers/VectorTileLayerView3D"],d=>g(n(d)),f)),wcs:()=>new Promise((g,f)=>a(["./layers/ImageryTileLayerView3D"],d=>g(n(d)),f)),"web-tile":x,wfs:()=>new Promise((g,f)=>a(["./layers/WFSLayerView3D"],d=>g(n(d)),f)),wms:()=>new Promise((g,f)=>a(["./layers/WMSLayerView3D"],d=>g(n(d)),f)),wmts:()=>new Promise((g,f)=>a(["./layers/WMTSLayerView3D"],d=>g(n(d)),f)),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,
"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:g=>w.isSome(l[g.type]),importLayerView:g=>{var f=l[g.type];if(w.isNone(f))throw g=g.declaredClass?g.declaredClass.slice(g.declaredClass.lastIndexOf(".")+1):"Unknown",f=g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new c(`${f}:view-not-supported`,`${g} is not supported in 3D`);return f(g)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(){const q=f.createResolver();q.promise.catch(()=>{});return q}const p=q=>Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));var h;(function(q){q[q.PENDING=0]="PENDING";q[q.CREATED=1]="CREATED"})(h||(h={}));var r;(function(q){q[q.ADDED=0]="ADDED";q[q.REMOVED=1]="REMOVED"})(r||(r={}));m=function(q){function y(D){D=B.call(this,D);D._allAnalysisViews=new n;D._creatingViewCount=0;D._items=new Map;D._scheduledUpdateHandle=
null;D._attachedToViewResolver=u();D._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return D}b._inherits(y,q);var B=b._createSuper(y);q=y.prototype;q.destroy=function(){this._disconnectOwners();this._attachedToViewResolver.reject(f.createAbortError("AnalysisViewManager was destroyed"))};q.attach=function(){this._connectOwners();this._attachedToViewResolver.resolve()};q.detach=function(){this._disconnectOwners();
this._attachedToViewResolver.reject(f.createAbortError());this._attachedToViewResolver=u()};q.whenAnalysisView=async function(D){await this._attachedToViewResolver.promise;const z=this._items.get(D);if(g.isNone(z)||z.state.list===r.REMOVED)throw new x("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:D});return z.createAnalysisViewTask.promise};q._connectOwners=function(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")};q._disconnectOwners=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};q._connectAnalysesCollection=function(D){for(const A of D)this._addAnalysis(A);const z=D.on("after-add",A=>this._addAnalysis(A.item)),v=D.on("after-remove",A=>this._removeAnalysis(A.item));return{remove:()=>{z.remove();v.remove();for(const A of D)this._removeAnalysis(A)}}};q._addAnalysis=function(D){const z=this._items.get(D);if(null==z){const v={state:{view:h.PENDING,
list:r.ADDED},analysis:D,view:null,createAnalysisViewTask:null};this._items.set(D,v);v.createAnalysisViewTask=w.createTask(A=>this._createAnalysisViewPromise(v,A))}else z.state.list=r.ADDED};q._removeAnalysis=function(D){D=this._items.get(D);null==D?l.getLogger(this.declaredClass).error("Trying to remove analysis which was not added"):(D.state.list=r.REMOVED,this._scheduleUpdate())};q._scheduleUpdate=function(){g.isSome(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=d.schedule(()=>this._update()))};
q._update=function(){this._scheduledUpdateHandle=g.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(D=>{if(D.state.list===r.REMOVED)switch(this._items.delete(D.analysis),D.state.view){case h.PENDING:D.createAnalysisViewTask=g.abortMaybe(D.createAnalysisViewTask);break;case h.CREATED:g.isSome(D.view)&&(this._allAnalysisViews.remove(D.view),D.view=g.destroyMaybe(D.view),D.createAnalysisViewTask=null)}})};q._createAnalysisViewPromise=async function(D,z){var v=D.analysis;const A=v.type,t=
this._analysisModules[A];this._creatingViewCount+=1;if(g.isNone(t.module))try{t.module=await this._loadAnalysisModule(A)}catch(C){throw--this._creatingViewCount,C;}if(f.isAborted(z))throw--this._creatingViewCount,f.createAbortError("AnalysisView creation aborted");v=new t.module.default({analysis:v,view:this.view});try{await v.when()}catch(C){throw--this._creatingViewCount,C;}if(f.isAborted(z))throw--this._creatingViewCount,v.destroy(),f.createAbortError("AnalysisView creation aborted");D.view=v;
D.state.view=h.CREATED;this._allAnalysisViews.add(v);--this._creatingViewCount;return v};q._loadAnalysisModule=function(D){switch(D){case "area-measurement":return new Promise((z,v)=>a(["./AreaMeasurementAnalysisView3D"],A=>z(p(A)),v));case "dimension":return new Promise((z,v)=>a(["./DimensionAnalysisView3D"],A=>z(p(A)),v));case "direct-line-measurement":return new Promise((z,v)=>a(["./DirectLineMeasurementAnalysisView3D"],A=>z(p(A)),v));case "line-of-sight":return new Promise((z,v)=>a(["./LineOfSightAnalysisView3D"],
A=>z(p(A)),v));case "slice":return new Promise((z,v)=>a(["./SliceAnalysisView3D"],A=>z(p(A)),v))}};b._createClass(y,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(D=>D.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);return y}(m.HandleOwner);c.__decorate([e.property()],m.prototype,"updating",null);c.__decorate([e.property({constructOnly:!0})],m.prototype,"view",void 0);c.__decorate([e.property()],
m.prototype,"_allAnalysisViews",void 0);c.__decorate([e.property()],m.prototype,"_creatingViewCount",void 0);return m=c.__decorate([k.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],m)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){a.Constraints=function(k){function u(){var h=p.apply(this,arguments);h.tilt=new e.TiltConstraint;h.altitude=new f.AltitudeConstraint;h.clipDistance=new d.ClipDistanceConstraint;return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(w);c.__decorate([n.property({type:e.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);c.__decorate([n.property({type:f.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);c.__decorate([n.property({type:d.ClipDistanceConstraint})],
a.Constraints.prototype,"clipDistance",void 0);a.Constraints=c.__decorate([g.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,w,n,x,m,l,g,f){a.AltitudeConstraint=function(d){function e(){var u=k.apply(this,arguments);u.min=f.earthAltitudeConstraint.min;u.max=f.earthAltitudeConstraint.max;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w);c.__decorate([n.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([n.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){a.Constraints=function(q){function y(D){D=B.call(this,D);D.collision=new r;D.distance=Infinity;D.minimumPoiDistance=4;D.tilt=null;return D}b._inherits(y,q);var B=b._createSuper(y);q=y.prototype;q.clampAltitude=function(D){return this.altitude?x.clamp(D,this.altitude.min,this.altitude.max):D};q.clampTilt=function(D,z){if(!this.tilt)return z;D=this.tilt(D);return x.clamp(z,D.min,D.max)};q.clampDistance=function(D){return Math.min(D,this.distance)};q.createDefaultTilt=
function(){return this.mode===k.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};q.createConstantMaxTilt=function(D){return(z,v=h)=>{v.min=p.min;v.max=D;return v}};q._createDefaultTiltLocal=function(){const D=this.collision.enabled?u.makePiecewiseLinearFunction([[4E3,p.max],[1E4,x.deg2rad(88)],[6E6,x.deg2rad(88)]]):()=>p.max;return(z,v=h)=>{v.min=p.min;v.max=D(z);return v}};q._createDefaultTiltGlobal=function(){const D=this.collision.enabled?u.makePiecewiseLinearFunction([[4E3,
p.max],[5E4,x.deg2rad(88)],[6E6,x.deg2rad(88)],[2E7,p.min]]):u.makePiecewiseLinearFunction([[3E5,p.max],[3E6,x.deg2rad(88)],[6E6,x.deg2rad(88)],[2E7,p.min]]);return(z,v=h)=>{v.min=p.min;v.max=D(z);return v}};b._createClass(y,[{key:"altitude",get:function(){return this.mode===k.ViewingMode.Local?null:this._get("altitude")||null},set:function(D){this.mode===k.ViewingMode.Local?n.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",D)}}]);return y}(w);
c.__decorate([m.property()],a.Constraints.prototype,"altitude",null);c.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([m.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([m.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([m.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([d.subclass("esri.views.3d.state.Constraints")],
a.Constraints);l={min:-2E5,max:4*e.earth.radius};const p={min:x.deg2rad(.5),max:x.deg2rad(179.5)},h={min:0,max:0};let r=function(q){function y(){var D=B.apply(this,arguments);D.enabled=!0;D.elevationMargin=5;return D}b._inherits(y,q);var B=b._createSuper(y);return b._createClass(y)}(w);c.__decorate([m.property({type:Boolean})],r.prototype,"enabled",void 0);c.__decorate([m.property({type:Number})],r.prototype,"elevationMargin",void 0);r=c.__decorate([d.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],
r);a.TiltDefault=p;a.earthAltitudeConstraint=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,
m,l,g){a.ClipDistanceConstraint=function(f){function d(){var k=e.apply(this,arguments);k.mode="auto";return k}b._inherits(d,f);var e=b._createSuper(d);f=d.prototype;f.castNear=function(k){return Math.max(1E-8,k)};f.castFar=function(k){return Math.max(1E-8,k)};f.autoUpdate=function(k,u){"auto"===this.mode&&(this._get("near")!==k&&this._set("near",k),this._get("far")!==u&&this._set("far",u))};b._createClass(d,[{key:"near",get:function(){return this._get("near")},set:function(k){this._set("near",k);
k>=this._get("far")&&(this.far=k+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(k){this._set("far",k);k<=this._get("near")&&(this.near=k-1E-9);this.mode="manual"}}]);return d}(w);c.__decorate([n.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([x.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([n.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);
c.__decorate([x.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);c.__decorate([n.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([g.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){var e=n.rad2deg(d.TiltDefault.min),k=n.rad2deg(d.TiltDefault.max);a.TiltConstraint=function(u){function p(){var r=h.apply(this,arguments);r.mode="auto";return r}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.castMax=function(r){return n.clamp(r,e,k)};u.autoUpdate=function(r){"auto"===this.mode&&this._get("max")!==r&&this._set("max",r)};b._createClass(p,[{key:"max",get:function(){return this._get("max")},set:function(r){this._set("max",r);this.mode="manual"}}]);
return p}(w);c.__decorate([x.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([x.property({type:Number,value:k})],a.TiltConstraint.prototype,"max",null);c.__decorate([m.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([f.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){var h;k=h=function(r){function q(B){B=y.call(this,B);B.atmosphere=new f.SceneViewAtmosphere;B.lighting=new d;B.cachedCameraTrackingEnabled=null;return B}a._inherits(q,r);var y=a._createSuper(q);q.fromWebsceneEnvironment=function(B){B=B.cloneConstructProperties();return new h({...B,lighting:B.lighting?"virtual"===B.lighting.type?e.fromWebsceneLighting(B.lighting):d.fromWebsceneLighting(B.lighting):void 0})};r=q.prototype;r.castLighting=function(B){return this._convertLighting(B)};
r.applyLighting=function(B){this.lighting=this._convertLighting(B)};r._convertLighting=function(B){return B?B instanceof d||B instanceof e?B:B instanceof u?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(B):new d({...B.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):B instanceof p?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B):new e({...B.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):
l.ensureOneOfType(g.lightingTypes,B):new d};r.clone=function(){return new h({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:w.clone(this.background)})};r.cloneWithWebsceneEnvironment=function(B){return new h({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:w.clone(this.background),
...B.cloneConstructProperties(),lighting:this._getLighting(B)})};r._getLighting=function(B){switch(B.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B.lighting):d.fromWebsceneLighting(B.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B.lighting):e.fromWebsceneLighting(B.lighting);default:return c.neverReached(B.lighting),d.fromWebsceneLighting(B.lighting)}};return a._createClass(q)}(k);
b.__decorate([n.property({type:f.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],k.prototype,"atmosphere",void 0);b.__decorate([n.property({nonNullable:!0})],k.prototype,"lighting",void 0);b.__decorate([x.cast("lighting")],k.prototype,"castLighting",null);return k=h=b.__decorate([m.subclass("esri.views.3d.environment.SceneViewEnvironment")],k)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",
defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,c,w,n,x,m,l,g,f){var d;c=d=function(k){function u(h){h=p.call(this,h);h.cameraTrackingEnabled=!0;h.ambientOcclusionEnabled=!1;h.waterReflectionEnabled=!1;h.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var r=(new Date).getFullYear();r=new Date("March 15, "+r+" 12:00:00 UTC");h._set("defaultDate",r);h._set("date",r);return h}a._inherits(u,k);var p=a._createSuper(u);u.fromWebsceneLighting=function(h){return new d(h.cloneConstructProperties())};k=u.prototype;k.autoUpdate=
function(h,r){const q=d.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=r.hours;this.positionTimezoneInfo.minutes=r.minutes;this.positionTimezoneInfo.seconds=r.seconds;r=null;w.isSome(h)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(h.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(h.getTime()))));const y=d.calculateTimezoneOffset(this.positionTimezoneInfo);q!==y&&(e.target=
this,e.timezoneOffset=y,this.emit("timezone-will-change",e));if(w.isSome(h))return isNaN(h.getTime())||r!==h.getTime()};k.clone=function(){const h=this._get("date")===this._get("defaultDate"),r=new d({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});h&&r._set("date",r._get("defaultDate"));r.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;
r.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;r.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;r.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return r};k.cloneWithWebsceneLighting=function(h){const r=this.clone();null!=h.date&&(r.date=h.date);r.directShadowsEnabled=h.directShadowsEnabled;r.displayUTCOffset=h.displayUTCOffset;return r};k.cloneNonPersistentConstructProperties=function(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,
cameraTrackingEnabled:this.cameraTrackingEnabled}};a._createClass(u,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(h){const r=this._get("date")===this._get("defaultDate");h=new Date(h.getTime());this._set("defaultDate",h);r&&this._set("date",h)}},{key:"date",set:function(h){null!=h&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(h.getTime())))}}]);return u}(c.EventedMixin(f));b.__decorate([n.property({type:Boolean})],c.prototype,
"cameraTrackingEnabled",void 0);b.__decorate([n.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([n.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);b.__decorate([n.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([n.property({type:Date})],c.prototype,"date",null);c=d=b.__decorate([g.subclass("esri.views.3d.environment.SunLighting")],c);(function(k){k.calculateTimezoneOffset=function({hours:u,minutes:p,seconds:h}){return Math.round(u+
p/60+h/3600)}})(c||(c={}));const e={target:null,timezoneOffset:0};return c})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(a,b,c,w,n,x,m,l,g,f){var d;c=d=function(e){function k(p){p=
u.call(this,p);p.type="sun";p.date=null;p.directShadowsEnabled=!1;p.displayUTCOffset=null;return p}a._inherits(k,e);var u=a._createSuper(k);e=k.prototype;e.readDate=function(p,h){return null!=h.datetime&&new Date(h.datetime)||null};e.writeDate=function(p,h,r){h[r]=p.getTime()};e.readDirectShadowsEnabled=function(p,h){return!!h.directShadows};e.writedirectShadowsEnabled=function(p,h,r){p&&(h[r]=p)};e.writeDisplayUTCOffset=function(p,h){null!=p&&(h.displayUTCOffset=p)};e.clone=function(){return new d(this.cloneConstructProperties())};
e.cloneConstructProperties=function(){const p={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(p.date=new Date(this.date.getTime()));return p};return a._createClass(k)}(c.JSONSupport);b.__decorate([w.property({readOnly:!0,type:["sun"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([w.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([l.reader("date",
["datetime"])],c.prototype,"readDate",null);b.__decorate([f.writer("date")],c.prototype,"writeDate",null);b.__decorate([w.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([l.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([f.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);b.__decorate([w.property({type:Number,json:{write:!0}})],
c.prototype,"displayUTCOffset",void 0);b.__decorate([f.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=d=b.__decorate([g.subclass("esri.webscene.SunLighting")],c)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;c=f=function(d){function e(u){u=k.call(this,u);u.ambientOcclusionEnabled=!1;u.waterReflectionEnabled=!1;u.cameraTrackingEnabled=!0;return u}a._inherits(e,d);var k=a._createSuper(e);d=e.prototype;d.clone=function(){return new f({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})};e.fromWebsceneLighting=function(u){return new f(u.cloneConstructProperties())};
d.cloneWithWebsceneLighting=function(u){const p=this.clone();p.directShadowsEnabled=u.directShadowsEnabled;return p};d.cloneNonPersistentConstructProperties=function(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}};return a._createClass(e)}(c.EventedMixin(g));b.__decorate([w.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([w.property({type:Boolean})],
c.prototype,"waterReflectionEnabled",void 0);b.__decorate([w.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);return c=f=b.__decorate([l.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){var g;c=g=function(f){function d(k){k=e.call(this,k);k.type="virtual";k.directShadowsEnabled=!1;return k}a._inherits(d,f);var e=a._createSuper(d);f=d.prototype;f.clone=function(){return new g(this.cloneConstructProperties())};f.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return a._createClass(d)}(c.JSONSupport);b.__decorate([w.property({readOnly:!0,type:["virtual"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([w.property({type:Boolean,
json:{default:!1,name:"directShadows",write:!0}})],c.prototype,"directShadowsEnabled",void 0);return c=g=b.__decorate([l.subclass("esri.webscene.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;a.SceneViewAtmosphere=f=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);e.prototype.clone=function(){return new f({quality:this.quality})};b._createClass(e,[{key:"quality",set:function(u){["low","high"].includes(u)&&this._set("quality",u)}}]);return e}(w);c.__decorate([n.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=f=c.__decorate([g.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){var p;const h=n.getLogger("esri.webscene.Environment");n=(r,q,y)=>({enabled:!y||!y.isPresentation});c=p=function(r){function q(B){B=y.call(this,B);B.lighting=new e;B.background=null;B.atmosphereEnabled=!0;B.starsEnabled=!0;return B}a._inherits(q,r);var y=a._createSuper(q);r=q.prototype;r.clone=function(){return new p(this.cloneConstructProperties())};r.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?k.prototype.clone.call(this.lighting):
e.prototype.clone.call(this.lighting),background:w.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};a._createClass(q,[{key:"weather",set:function(B){f.validateWeatherType(B?.type,h)&&this._set("weather",B)}}]);return q}(c.JSONSupport);b.__decorate([x.property({types:d.lightingTypes,nonNullable:!0,json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([x.property(u.backgroundProperty)],c.prototype,"background",void 0);
b.__decorate([x.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:n}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([x.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:n}}})],c.prototype,"starsEnabled",void 0);b.__decorate([x.property({types:f.weatherTypes,nonNullable:!0,json:{write:!0},value:new g})],c.prototype,"weather",null);return c=p=b.__decorate([l.subclass("esri.webscene.Environment")],c)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;c=f=function(d){function e(u){u=k.call(this,u);u.type="sunny";u.cloudCover=.5;return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return a._createClass(e)}(c.JSONSupport);b.__decorate([l.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([g.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,w,n,x){b={key:"type",base:x,typeMap:{sunny:x,cloudy:b,rainy:w,snowy:n,foggy:c}};const m=Object.keys(b.typeMap);a.validateWeatherType=function(l,g){return m.includes(l)?!0:(g.error(`"${l}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g){var f;c=f=function(d){function e(u){u=k.call(this,
u);u.type="cloudy";u.cloudCover=.5;return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return a._createClass(e)}(c.JSONSupport);b.__decorate([l.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([g.subclass("esri.views.3d.environment.CloudyWeather")],c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;c=f=function(d){function e(u){u=k.call(this,u);u.type="foggy";u.fogStrength=.5;return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({fogStrength:this.fogStrength})};return a._createClass(e)}(c.JSONSupport);b.__decorate([l.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"fogStrength",void 0);return c=f=b.__decorate([g.subclass("esri.views.3d.environment.FoggyWeather")],
c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g){var f;c=f=function(d){function e(u){u=k.call(this,u);u.type="rainy";
u.cloudCover=.5;u.precipitation=.5;return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})};return a._createClass(e)}(c.JSONSupport);b.__decorate([l.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],c.prototype,"precipitation",void 0);return c=f=b.__decorate([g.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;c=f=function(d){function e(u){u=k.call(this,u);u.type="snowy";u.cloudCover=.5;u.precipitation=.5;u.snowCover="disabled";return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return a._createClass(e)}(c.JSONSupport);b.__decorate([l.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,
range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);b.__decorate([w.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],c.prototype,"snowCover",void 0);return c=f=b.__decorate([g.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],
function(a,b,c){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(w){return(n,x,m)=>{if(!n)return n;for(const l in w.typeMap)if(n.type===l)return x=new w.typeMap[l],x.read(n,m),x}}(b),write:{overridePolicy:(w,n,x)=>
({enabled:!x||!x.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l){c=function(g){function f(e){return d.call(this,
e)}a._inherits(f,g);var d=a._createSuper(f);f.prototype.clone=function(){};return a._createClass(f)}(c.JSONSupport);b.__decorate([w.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([l.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){var e;n={...f.colorAndTransparencyProperty,nonNullable:!0};d=e=function(k){function u(h){h=p.call(this,h);h.type="color";h.color=new c([0,0,0,1]);return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.clone=function(){return new e(this.cloneProperties())};k.cloneProperties=function(){return{color:this.color.clone()}};return a._createClass(u)}(d);b.__decorate([l.enumeration({color:"color"},{readOnly:!0})],d.prototype,"type",void 0);b.__decorate([w.property(n)],
d.prototype,"color",void 0);return d=e=b.__decorate([g.subclass("esri.webscene.background.ColorBackground")],d)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){a.SceneViewEnvironmentManager=function(R){function O(){var M=J.call(this);M._referencePointUpdateDelay=200;M._referencePointUpdateInterval=3E3;M._referencePointUpdateDistThreshold=1E6;M._referencePosUpdateQuery=null;M._referencePosMapCoordsRequested=null;M._viewHandles=new x;M._preserveAbsoluteDateTime=!1;M._trackingEnabled=!1;M._referencePosResetPreserveAbsoluteTime=!1;M._referencePosUpdateTimer=null;M._referencePosMapCoords=null;M._mainLight=
new t.MainLight;M._ambientLight=new t.AmbientLight;M._moonLight=new t.FillLight;M.disableQueries=!1;M._disableWeather=!1;M._renderer=null;M._referencePosWGS84Comparable=null;M._resetReferencePosition();return M}b._inherits(O,R);var J=b._createSuper(O);R=O.prototype;R.destroy=function(){this.disconnectView();this._viewHandles.destroy()};R.connectView=function(M){if(!this._renderer){this._renderer=new D.EnvironmentRenderer({view:M});var G=()=>this._updateRenderParameters(),P=()=>this._cameraHandler();
this._viewHandles.add([g.watch(()=>M.environment.lighting,U=>this._updateLightingHandler(U),g.sync),g.watch(()=>"virtual"!==M.environment.lighting.type?M.environment.lighting.date:null,U=>this._lightingDateHandler(U),g.sync),g.watch(()=>M.stationary,()=>this._interactingStationaryHandler()),g.watch(()=>M.environment.lighting.directShadowsEnabled,G,g.sync),g.watch(()=>M.environment.lighting.ambientOcclusionEnabled,G,g.sync),g.watch(()=>M.environment.lighting.waterReflectionEnabled,G,g.sync),g.watch(()=>
M.environment.background?.color,G,g.sync),g.watch(()=>M.spatialReference,()=>this._resetReferencePosition(!0),g.sync),g.watch(()=>M.environment.weather.type,()=>this._updateLighting(null,A.Update.Faded),g.sync),g.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,A.Update.Faded),g.sync),g.watch(()=>M.viewingMode,()=>this._resetReferencePosition(!0),g.syncAndInitial),g.watch(()=>"virtual"!==M.environment.lighting.type?M.environment.lighting.cameraTrackingEnabled:!1,U=>this._updateCameraTracking(U),
g.syncAndInitial),g.watch(()=>M.state.camera,P,g.syncAndInitial),g.watch(()=>this.disableQueries,P)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};R.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=m.destroyMaybe(this._renderer)};R._updateLightingHandler=function(M){this._updateCameraTracking("virtual"!==M.type?M.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==M.type?
M.date:null);this._updateRenderParameters()};R._updateCameraTracking=function(M){(this._trackingEnabled=M)?this._cameraHandler():(M=this._view.environment.lighting,"virtual"!==M?.type&&(M.positionTimezoneInfo.autoUpdated=!1))};R._lightingDateHandler=function(M){const G=this._view.environment.lighting;if("virtual"===G?.type)this._updateLighting();else if(M){if(!G.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!q.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var P=
this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(P)){this._requestReferencePositionUpdate(P);return}}this._preupdateTracking(M);m.isSome(this._referencePosWGS84Comparable)&&(P=z.positionToTimezoneInfo(this._referencePosWGS84Comparable,K),m.isSome(P)&&(G.autoUpdate(null,P),this._trackingEnabled&&(G.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(M)}};R._preupdateTracking=function(M){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&
this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(M)};R._cameraHandler=function(M=null){var G=this._view;G.ready&&(G=G.stateManager.camera)&&(this._cameraHandlerClientSide(G,M)||this._cameraHandlerServerSide(G))};R._cameraHandlerClientSide=function(M,G){const P=y.isEarth(this._view.spatialReference);if(P&&!q.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;M=M.position;m.isNone(this._referencePosWGS84Comparable)&&
(this._referencePosWGS84Comparable=h.create());P?q.projectPointToWGS84ComparableLonLat(M,this._referencePosWGS84Comparable):p.set(this._referencePosWGS84Comparable,M.longitude??0,M.latitude??0,M.z??0);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,G)||this._updateLighting(G);return!0};R._cameraHandlerServerSide=function(M){M=M.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(M))&&
this._requestReferencePositionUpdate(M,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(M.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};R._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};R._updateLighting=function(M,G=A.Update.Immediate){var P=this._view;M=M||("virtual"===P.environment.lighting.type?null:P.environment.lighting.date);var U=this._referencePosWGS84Comparable;
const N=m.isSome(U)?E:F;var S=this.weatherVisible?P.environment.weather.type:"disabled";m.isSome(U)?v.computeColorAndIntensity(M,U,P.state.viewingMode,S,P.state.camera,N):"virtual"===P.environment.lighting.type&&v.computeVirtualLightDirection(P.state.camera,P.state.viewingMode,N.direct.directionToLightSource);M=this._mainLight;P=N.direct;p.scale(M.intensity,P.color,P.intensity*Math.PI);p.copy(M.direction,P.directionToLightSource);M.specularStrength=N.specularStrength;M.environmentStrength=N.environmentStrength;
U=this._ambientLight;p.scale(U.intensity,N.ambient.color,N.ambient.intensity);S=this._moonLight;p.lerp(S.intensity,I,L,N.globalFactor);p.scale(S.intensity,S.intensity,(1-.5*N.globalFactor)*(1-.4*N.noonFactor*(1-N.globalFactor)));p.copy(S.direction,P.directionToLightSource);this._renderer.updateLightSources([M,U,S],N.noonFactor,N.globalFactor,G);this._updateRenderParameters()};R._autoUpdateTimezone=function(M,G=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||
m.isNone(M))return!1;const P=H;P.setTime((G||this._view.environment.lighting.date).getTime());M=z.positionToTimezoneInfo(M,K);if(m.isNone(M))return!1;var U=this._view.environment.lighting.positionTimezoneInfo;if(!U.autoUpdated)U=M;else if(U.hours===M.hours&&U.minutes===M.minutes&&U.seconds===M.seconds)return!1;const N=P.getUTCHours()-(M.hours-U.hours),S=P.getUTCMinutes()-(M.minutes-U.minutes);U=P.getUTCSeconds()-(M.seconds-U.seconds);P.setUTCHours(N);P.setUTCMinutes(S);P.setUTCSeconds(U);return G?
!1:this._view.environment.lighting.autoUpdate(P,M)};R._updateRenderParameters=function(){const M=this._view._stage;if(M){var G=m.mapOr(this._referencePosWGS84Comparable,!0,U=>v.computeShadowsEnabled(U[2],this._view.state.viewingMode)),P=this._view.environment.background;P=P instanceof C?{type:"color",color:r.fromArray(w.toUnitRGBA(P.color))}:{type:"color",color:r.fromValues(0,0,0,1)};M.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&G,background:P,environment:this._view.environment,
weatherVisible:this._view.environmentManager.weatherVisible})}};R._resetReferencePosition=function(M=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");M&&this._cameraHandler()};R._requestReferencePositionUpdate=function(M,G=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(M):
this._referencePosMapCoordsRequested=M.clone(),this._referencePosResetPreserveAbsoluteTime=!!G,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const P=this._referencePosUpdateQuery=l.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===P)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==P)}).catch(N=>{"mapcoordshelper:missing-geometry-service"===N.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===
P&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),U=this._referencePosUpdateTimer=l.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===U&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};R._doReferencePositionUpdateQuery=async function(M){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const G=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);M()||isNaN(G[0])||isNaN(G[1])||(M=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=G[0],this._referencePosWGS84Comparable[1]=G[1],this._referencePosWGS84Comparable[2]=M):this._referencePosWGS84Comparable=[G[0],G[1],M],this._referencePosChanged())};R._executePendingReferencePositionUpdate=function(){const M=this._referencePosMapCoordsRequested;M&&this._requestReferencePositionUpdate(M,this._referencePosResetPreserveAbsoluteTime)};R._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};R._exceedsReferencePosDistThreshold=function(M){return this._referencePosMapCoords?(M=this._referencePosMapCoords.distance(M),this._view.mapCoordsHelper&&(M*=this._view.mapCoordsHelper.unitInMeters),M>this._referencePointUpdateDistThreshold):!0};R._cancelReferencePosUpdates=function(){const M=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return M};b._createClass(O,[{key:"_view",
get:function(){return this._renderer?.view}},{key:"updating",get:function(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}},{key:"weatherEnabled",get:function(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===B.ViewingMode.Global&&y.isEarth(this._view.spatialReference)}},{key:"weatherVisible",get:function(){return this.weatherEnabled&&this._renderer?.weatherVisible}},
{key:"referencePositionWGS84Comparable",get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const M=this;return{get renderer(){return M._renderer},set referencePointUpdateInterval(G){M._referencePointUpdateInterval=G},set referencePointUpdateDistThreshold(G){M._referencePointUpdateDistThreshold=G},set referencePosUpdateTimer(G){M._referencePosUpdateTimer=G},set referencePointUpdateDelay(G){M._referencePointUpdateDelay=G},set disableWeather(G){M._disableWeather=G}}}}]);
return O}(n.EventedAccessor);c.__decorate([f.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",
null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([u.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const E=new v.ColorAndIntensity,F=new v.ColorAndIntensity,
H=new Date,K={hours:0,minutes:0,seconds:0},I=h.fromValues(.22,.22,.33),L=h.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsCompositionParameters ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ./SimpleAtmosphere ./SimpleHaze ./Stars ./weather ./weatherUtils ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/lib/RenderFeature ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M){var G;const P=[J.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,J.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=G=function(W){function V(X){X=T.call(this,X);X._context=null;X._atmosphere=null;X._hqAtmosphere=null;X._oldWeatherParameters=new U;X._newWeatherParameters=new U;X._fadedWeatherParameters=new U;X._weatherParameters=X._newWeatherParameters;return X}b._inherits(V,W);var T=b._createSuper(V);
W=V.prototype;W.initialize=function(){this.view._stage.addRenderPlugin(P,this)};W.destroy=function(){this.removeHandles();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)};W.updateAnimation=function(X){return m.isSome(this._precipitation)?this._precipitation.update(X):!1};W.initializeRenderContext=function(X=null){this._context=X;X=()=>this._setNeedsRender();this.addHandles([l.when(()=>this.view?.basemapTerrain,()=>this._updateBasemapTerrain(),l.syncAndInitial),
l.watch(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),Z=>this._updateAtmosphere(Z),l.syncAndInitial),l.watch(()=>this._stars,X),l.watch(()=>this._precipitation,X),l.watch(()=>this._clouds,()=>this._updateWeather(),l.initial),l.watch(()=>this._fog,()=>this._updateFogHaze(),l.initial),l.watch(()=>this._simpleHaze,()=>this._updateFogHaze(),l.initial),l.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},
l.sync),l.watch(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),l.syncAndInitial),l.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},l.syncAndInitial)])};W.uninitializeRenderContext=function(){this._context=null;this._atmosphere=m.destroyMaybe(this._atmosphere);this._hqAtmosphere=m.destroyMaybe(this._hqAtmosphere);this._set("_stars",m.destroyMaybe(this._stars));this._set("_precipitation",m.destroyMaybe(this._precipitation));this._set("_clouds",m.destroyMaybe(this._clouds));
this._set("_cloudsComposition",m.destroyMaybe(this._cloudsComposition));this._set("_fog",m.destroyMaybe(this._fog));this._set("_simpleHaze",m.destroyMaybe(this._simpleHaze))};W.prepareRender=function(X){X.bindParameters.cloudsFade.data=z.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&(L.updateWeatherFading(X.bindParameters.cloudsFade,X.bindParameters.camera,this.view.state.mode,X.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(X.bindParameters),
X.bindParameters.cloudsFade.renderingStage===z.CloudsRenderingStages.FINISHED&&m.isSome(this._clouds)&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),X.bindParameters.cloudsFade.data=null))};W.render=function(X){if(X.output===R.ShaderOutput.Color)switch(X.bindParameters.slot){case J.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:m.isSome(this._stars)&&this._stars.render(X);m.isSome(this.atmosphere)&&(this.atmosphere.render(X),m.isSome(this._cloudsComposition)&&
m.isSome(X.bindParameters.cloudsFade.data)&&(this.weatherVisible&&m.isSome(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(X)),L.weatherFadingNeedsRender(X.bindParameters.cloudsFade)&&m.isSome(this._context)&&this._context.requestRender());break;case J.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(m.isSome(this.atmosphere)&&(this.atmosphere.renderHaze(X,this._weatherParameters.haze.amount),0<this._weatherParameters.haze.amount&&this._atmosphereType!==q.AtmosphereType.Realistic&&
m.isSome(this._simpleHaze)&&this._simpleHaze.render(X,this._weatherParameters.haze),0<this._weatherParameters.fog.amount&&m.isSome(this._fog)&&this._fog.render(X,this._weatherParameters.fog),m.isSome(this._precipitation))){const Z=this.view.environment.weather;"rainy"!==Z.type&&"snowy"!==Z.type||this._precipitation.render(X,Z.precipitation,Z.type)}}};W.updateLightSources=function(X,Z,Y,aa){if(m.isSome(this._context)){const ia=this._context.renderContext;ia.bindParameters.oldLighting.copyFrom(ia.bindParameters.lighting);
ia.bindParameters.newLighting.noonFactor=Z;ia.bindParameters.newLighting.globalFactor=Y;ia.bindParameters.newLighting.set(X);aa===M.Update.Faded||ia.bindParameters.weatherFading?ia.bindParameters.fadeLighting(0):ia.bindParameters.fadeLighting(1);this._context.requestRender()}};W._updateWeatherFading=function(X){if(X.weatherFading){var Z=X.cloudsFade;Z.fadeIn.stage===D.FadeInStages.FADE_IN?(X.fadeLighting(Z.fadeIn.factor),this._fadeWeather(Z.fadeIn.factor)):Z.fadeInOut.stage===D.FadeInOutStages.FADE_IN?
(X.fadeLighting(Z.fadeInOut.factor),this._fadeWeather(Z.fadeInOut.factor)):Z.crossFade.enabled?(X.fadeLighting(Z.crossFade.factor),this._fadeWeather(Z.crossFade.factor)):(X.fadeLighting(0),this._fadeWeather(0))}};W._fadeWeather=function(X){const {_newWeatherParameters:Z,_oldWeatherParameters:Y}=this;1<=X?this._weatherParameters=Z:(this._fadedWeatherParameters.lerp(Y,Z,X),this._weatherParameters=this._fadedWeatherParameters)};W._updateWeather=function(){const X=this._weatherUpdateParameters;m.isNone(X)||
m.isNone(this._clouds)||(this._clouds.applyPreset(A.cloudPresets[X.type],X.weatherAdjustment),this._setNeedsRender())};W._setNeedsRender=function(){m.isSome(this._context)&&this._context.requestRender()};W._updateFogHaze=function(){const X=this._weatherUpdateParameters;if(!(m.isNone(this._fog)||m.isNone(this._simpleHaze)||m.isNone(X)||m.isNone(this._context))){var Z=this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(X.type){case "foggy":this._newWeatherParameters.fog.strength=
x.lerp(3E-5,.005,X.weatherAdjustment**3);k.copy(this._newWeatherParameters.fog.color,S);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=0;this._newWeatherParameters.haze.amount=this._atmosphereType===q.AtmosphereType.Realistic?1:0;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=x.lerp(4E-6,2E-4,(X.effect??0)**3);k.copy(this._newWeatherParameters.fog.color,N);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=
0;this._newWeatherParameters.haze.amount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=x.lerp(4E-6,2E-4,(X.effect??0)**3);k.copy(this._newWeatherParameters.fog.color,S);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=0;this._newWeatherParameters.haze.amount=this._atmosphereType===q.AtmosphereType.Realistic?1:0;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,
this._newWeatherParameters.haze.strength=4E-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}Z.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}};W._updateAtmosphere=function(X){X=this._selectAtmosphereType(X);if(m.isSome(this._atmosphere)?this._atmosphere.type!==X:X!==q.AtmosphereType.None){this._atmosphere=m.destroyMaybe(this._atmosphere);this._hqAtmosphere=m.destroyMaybe(this._hqAtmosphere);var Z=this._getAtmosphereClass(X);Z&&m.isSome(this._context)&&(this._atmosphere=
new Z(this.view,this._context),X===q.AtmosphereType.Simple&&(this._hqAtmosphere=new y.ChapmanAtmosphere(this.view,this._context)));this._setNeedsRender();this._updateBasemapTerrain()}};W._getAtmosphereClass=function(X){switch(X){case q.AtmosphereType.Realistic:return y.ChapmanAtmosphere;case q.AtmosphereType.Panoramic:return C.PanoramicAtmosphere;case q.AtmosphereType.Simple:return F;default:case q.AtmosphereType.None:return null}};W._selectAtmosphereType=function(X){const {enabled:Z,quality:Y,viewingMode:aa}=
X;return!Z||h.isMoon(this.view.spatialReference)?q.AtmosphereType.None:aa===r.ViewingMode.Local?q.AtmosphereType.Panoramic:m.isSome(this._context)&&"high"===Y&&y.ChapmanAtmosphere.isSupported(this._context)&&h.isEarth(this.view.spatialReference)?q.AtmosphereType.Realistic:q.AtmosphereType.Simple};W._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===q.AtmosphereType.Simple)};b._createClass(V,[{key:"atmosphere",get:function(){return m.isSome(this._hqAtmosphere)&&
this.view._stage.renderer.isFeatureEnabled(O.RenderFeature.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}},{key:"_atmosphereType",get:function(){return m.isSome(this.atmosphere)?this.atmosphere.type:q.AtmosphereType.None}},{key:"canRender",get:function(){return!!this.view.basemapTerrain?.renderer.canRender||"global"!==this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return this._atmosphereType===q.AtmosphereType.Realistic}},{key:"updating",get:function(){return m.isSome(this._stars)&&
this._stars.updating||m.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return k.length(this.view.state.camera.eye)-p.getReferenceEllipsoid(this.view.spatialReference).radius<=I.weatherHeightLimit}},{key:"_stars",get:function(){const X=this.view,Z=X.environment?.starsEnabled??!1,Y=this._get("_stars");return!Z||m.isNone(this._context)?(m.destroyMaybe(Y),null):m.isSome(Y)?Y:new K.Stars({view:X,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const X=
this._get("_precipitation");if(!this._precipitationEnabled||m.isNone(this._context))return m.destroyMaybe(X),null;const Z=this.view,Y=this._context;if(m.isSome(X)&&X.context===Y)return X;m.destroyMaybe(X);return new E.Precipitation({context:Y,view:Z})}},{key:"_clouds",get:function(){const X=this._get("_clouds");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(X),null;if(m.isSome(X))return X;const Z=this.view,Y=this._context;m.destroyMaybe(X);return new v.CloudsGenerator({context:Y,
view:Z,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudsComposition",get:function(){const X=this._get("_cloudsComposition");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(X),null;const Z=this.view.state.viewingMode,Y=this._context.renderContext.rctx,aa=p.getReferenceEllipsoid(this.view.spatialReference).radius;if(m.isSome(X)&&X.viewingMode===Z&&X.planetRadius===aa)return X;m.destroyMaybe(X);return new B.CloudsComposition({rctx:Y,viewingMode:Z,planetRadius:aa,requestRender:()=>
this._setNeedsRender()})}},{key:"_fog",get:function(){const X=this._get("_fog");return!this.weatherEnabled||m.isNone(this._context)?(m.destroyMaybe(X),null):m.isSome(X)?X:new t.Fog({context:this._context,view:this.view})}},{key:"_simpleHaze",get:function(){const X=this._get("_simpleHaze");return!this.weatherEnabled||m.isNone(this._context)?(m.destroyMaybe(X),null):m.isSome(X)?X:new H.SimpleHaze({context:this._context,view:this.view})}},{key:"weatherEnabled",get:function(){return!!this.view?.environmentManager?.weatherEnabled}},
{key:"_precipitationEnabled",get:function(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}},{key:"_weatherUpdateParameters",get:function(){const X=this.weatherEnabled?this.view.environment.weather:null;return m.isNone(X)?null:"rainy"===X.type||"snowy"===X.type?{type:X.type,weatherAdjustment:X.cloudCover,effect:X.precipitation}:{type:X.type,weatherAdjustment:"foggy"===X.type?X.fogStrength:X.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,
clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:X=>{Q=G.prototype._getAtmosphereClass;G.prototype._getAtmosphereClass=X},restoreGetAtmosphereClass:()=>{G.prototype._getAtmosphereClass=Q}}}}]);return V}(w);c.__decorate([g.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([g.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"atmosphere",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_atmosphereType",null);c.__decorate([g.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([g.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([g.property()],a.EnvironmentRenderer.prototype,"_atmosphere",void 0);
c.__decorate([g.property()],a.EnvironmentRenderer.prototype,"_hqAtmosphere",void 0);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_stars",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,
"_fog",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_simpleHaze",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);c.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=G=c.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],
a.EnvironmentRenderer);let U=function(){function W(){this.fog=new t.FogParameters;this.haze=new H.HazeParameters}var V=W.prototype;V.copyFrom=function(T){this.fog.amount=T.fog.amount;this.haze.amount=T.haze.amount;this.fog.strength=T.fog.strength;this.haze.strength=T.haze.strength;k.copy(this.fog.color,T.fog.color)};V.lerp=function(T,X,Z){this.fog.amount=x.lerp(T.fog.amount,X.fog.amount,Z);this.haze.amount=x.lerp(T.haze.amount,X.haze.amount,Z);this.fog.strength=x.lerp(T.fog.strength,X.fog.strength,
Z);this.haze.strength=x.lerp(T.haze.strength,X.haze.strength,Z);k.lerp(this.fog.color,T.fog.color,X.fog.color,Z)};return b._createClass(W)}();const N=u.fromValues(.5,.5,.5),S=u.fromValues(1.5,1.5,1.5);let Q;a.WeatherParameters=U;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=void 0;var b=a.AtmosphereType||(a.AtmosphereType={});b[b.Simple=0]="Simple";b[b.Realistic=1]="Realistic";b[b.Panoramic=
2]="Panoramic";b[b.None=3]="None";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec4 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){let q=function(){function y(D,z){this._view=D;this.type=d.AtmosphereType.Realistic;this._handles=new c;this._passParameters=new k.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=f.earth.radius;this._fadeHaze=0;this._updateRadius(f.earth.radius);D=z.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([x.watch(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),
x.watch(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const v=new u.ChapmanAtmosphereTechniqueConfiguration;v.haze=!1;this._atmosphereTechnique=z.techniqueRepository.acquire(k.ChapmanAtmosphereTechnique,v);v.haze=!0;this._atmosphereHazeTechnique=z.techniqueRepository.acquire(k.ChapmanAtmosphereTechnique,v);this._vao=h.createQuadVAO(D,p.Pos2Tex)}var B=y.prototype;B.destroy=function(){this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();
this._vao.dispose();this._handles.destroy()};B.render=function(D){this._render(D,this._atmosphereTechnique,D.offscreenRenderingHelper.depthTexture)};B.renderHaze=function(D,z){this._fadeHaze=z;this._render(D,this._atmosphereHazeTechnique,D.offscreenRenderingHelper.linearDepthTexture)};B._render=function(D,z,v){if(!n.isNone(v)){this._update(D.bindParameters.camera);this._passParameters.depthTex=v;var A=D.rctx.bindTechnique(z,this._passParameters,D.bindParameters);D.offscreenRenderingHelper.renderDepthDetached(()=>
this._renderCommon(A,D))}};B._renderCommon=function(D,z){n.isNone(this._vao)||(z.rctx.bindVAO(this._vao),D.assertCompatibleVertexAttributeLocations(this._vao),z.rctx.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4))};B._adjustRadiusForTesselation=function(D){return D*Math.cos(Math.PI/16/16)};B._updateRootTileElevationBounds=function(){const D=this._view.basemapTerrain.rootTileElevationBounds.min;D!==this._rootTileElevationMin&&(this._rootTileElevationMin=D,this._lowerBoundEarthRadius=f.earth.radius,
this._updateVisibleElevationBounds())};B._updateVisibleElevationBounds=function(){const D=this._adjustRadiusForTesselation(f.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);D<this._lowerBoundEarthRadius&&this._updateRadius(D)};B._updateRadius=function(D){this._lowerBoundEarthRadius=D;m.set(this._passParameters.radii,D,D+e.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*D-e.innerAtmosphereDepth)*e.innerAtmosphereDepth)};B._update=function(D){if(!n.isNone(D)){D=
l.squaredLength(D.eye);var z=Math.sqrt(D),v=D-this._passParameters.radii[1]*this._passParameters.radii[1],A=w.clamp((z-this._passParameters.radii[0])/e.atmosphereHeight,0,1);g.set(this._passParameters.heightParameters,z,D,v,A);this._passParameters.altitudeFade=e.computeInnerAltitudeFade(z-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=w.lerp(w.lerp(.6,1,w.smoothstep(9500,10500,z-f.earth.radius)),1,this._fadeHaze)}};y.isSupported=function(D){return D.renderContext.rctx.capabilities.depthTexture};
return b._createClass(y)}();a.ChapmanAtmosphere=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){m=function(u){function p(){var r=h.apply(this,arguments);r.heightParameters=n.create();r.radii=w.create();r.innerFadeDistance=0;r.altitudeFade=0;r.hazeStrength=1;return r}c._inherits(p,u);var h=c._createSuper(p);return c._createClass(p)}(m.NoParameters);g=function(u){function p(){return h.apply(this,arguments)}c._inherits(p,u);var h=c._createSuper(p);u=p.prototype;u.initializeProgram=function(r){return new d.Program(r.rctx,p.shader.get().build(this.configuration),
f.Default3D)};u.initializePipeline=function(){return this.configuration.haze?k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:k.defaultColorWriteParams}):k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams})};
return c._createClass(p)}(g.ShaderTechnique);g.shader=new l.ReloadableShaderModule(x.ChapmanAtmosphere,()=>new Promise((u,p)=>a(["./ChapmanAtmosphere.glsl"],u,p)));b.ChapmanAtmospherePassParameters=m;b.ChapmanAtmosphereTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){function y(A){const t=new h.ShaderBuilder;t.attributes.add(q.VertexAttribute.POSITION,"vec2");t.include(x.TextureCoordinateAttribute,{textureCoordinateType:x.TextureCoordinateAttributeType.Default});t.varyings.add("worldRay","vec3");t.varyings.add("eyeDir","vec3");const {vertex:C,fragment:E}=t;C.uniforms.add([new p.Matrix4PassUniform("inverseProjectionMatrix",(F,H)=>H.camera.inverseProjectionMatrix),new p.Matrix4PassUniform("inverseViewMatrix",(F,H)=>
b.invertOrIdentity(v,H.camera.viewMatrix))]);C.code.add(u.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);E.uniforms.add([new f.Float2PassUniform("radii",F=>F.radii),new d.Float3PassUniform("cameraPosition",(F,H)=>H.camera.eye),new e.Float4PassUniform("heightParameters",F=>F.heightParameters),new k.FloatPassUniform("innerFadeDistance",F=>F.innerFadeDistance),new k.FloatPassUniform("altitudeFade",F=>F.altitudeFade),new r.Texture2DPassUniform("depthTex",F=>F.depthTex),new k.FloatPassUniform("hazeStrength",F=>F.hazeStrength)]);E.constants.add("betaRayleigh","vec3",B);E.constants.add("betaCombined","vec3",
z);E.constants.add("betaMie","float",3.996E-6);E.constants.add("scaleHeight","float",n.rayLeighScaleHeight*n.atmosphereHeight);g.addMainLightDirection(E);t.include(l.Gamma);A.haze&&(E.include(m.ReadLinearDepth),E.uniforms.add(new f.Float2PassUniform("nearFar",(F,H)=>H.camera.nearFar)));E.code.add(u.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);E.code.add(u.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);E.code.add(u.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);E.code.add(u.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${A.haze?u.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${A.haze?u.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${A.haze?"":u.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${A.haze?u.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:u.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${A.haze?u.glsl`
          vec4 depthSample = texture(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:u.glsl`
          float depthSample = texture(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            fragColor = vec4(0);
            return;
          }`}

      ${A.haze?u.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:u.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${A.haze?"":u.glsl`
          if (depthSample == 1.0) {
            fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
          }`}
    }
  `);return t}const B=w.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),D=w.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),z=w.fromValues(parseFloat(Number(B[0]+D[0]).toFixed(6)),parseFloat(Number(B[1]+D[1]).toFixed(6)),parseFloat(Number(B[2]+D[2]).toFixed(6))),v=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:B,
build:y},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=c;a.betaRayleigh=B;a.build=y})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,w){a.TextureCoordinateAttributeType=void 0;(function(n){n[n.None=0]="None";n[n.Default=1]="Default";n[n.Atlas=2]="Atlas";n[n.Compressed=3]="Compressed";n[n.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(n,x){switch(x.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:n.attributes.add(w.VertexAttribute.UV0,"vec2");n.varyings.add("vuv0","vec2");n.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:n.attributes.add(w.VertexAttribute.UV0,"vec2");n.varyings.add("vuv0","vec2");n.vertex.code.add(c.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:n.attributes.add(w.VertexAttribute.UV0,"vec2");n.varyings.add("vuv0","vec2");n.attributes.add(w.VertexAttribute.UVREGION,"vec4");n.varyings.add("vuvRegion","vec4");n.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(x.textureCoordinateType);case a.TextureCoordinateAttributeType.None:n.vertex.code.add(c.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(w,...n){let x="";for(let m=0;m<n.length;m++)x+=w[m]+n[m];return x+=
w[w.length-1]}b=b._createClass(function(){});(function(w){w.int=function(n){return Math.round(n).toString()};w.float=function(n){return n.toPrecision(8)}})(c||(c={}));a.NoParameters=b;a.glsl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.NORMALCOMPRESSED="normalCompressed";b.UV0=
"uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL=
"profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0=
"position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced";Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(w){w.include(b.RgbaFloatEncoding);w.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,c){function w(x){x.uniforms.add(new b.Float3PassUniform("mainLightDirection",(m,l)=>l.lighting.mainLight.direction))}function n(x){x.uniforms.add(new b.Float3PassUniform("mainLightIntensity",(m,l)=>l.lighting.mainLight.intensity))}a.MainLighting=
function(x){w(x.fragment);n(x.fragment);x.fragment.code.add(c.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=w;a.addMainLightIntensity=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"vec3",w.BindType.Pass,(f,d,e)=>f.setUniform3fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);
a.Float3PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../shaderTechnique/BindType"],function(a,b,c,w){let n=function(){function x(m,l,g,f,d=null){this.name=m;this.type=l;this.arraySize=d;this.bind={[w.BindType.Pass]:null,[w.BindType.Draw]:null};c.isSome(g)&&c.isSome(f)&&(this.bind[g]=f)}x.prototype.equals=
function(m){return this.type===m.type&&this.name===m.name&&this.arraySize===m.arraySize};return b._createClass(x)}();a.Uniform=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"vec2",w.BindType.Pass,(f,d,e)=>f.setUniform2fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Float2PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"vec4",w.BindType.Pass,(f,d,e)=>f.setUniform4fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Float4PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],
function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"float",w.BindType.Pass,(f,d,e)=>f.setUniform1f(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.FloatPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,
g){return m.call(this,l,"mat4",w.BindType.Pass,(f,d,e)=>f.setUniformMatrix4fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Matrix4PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error","../../../../../core/Logger","../../../../../core/maybe"],function(a,b,c,w,n){const x=
w.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");w=function(){function p(){this._includedModules=new Map}p.prototype.include=function(h,r){if(this._includedModules.has(h)){const q=this._includedModules.get(h);if(q!==r){x.error("Trying to include shader module multiple times with different sets of options.");r=new Set;for(const y of Object.keys(q))q[y]!==h[y]&&r.add(y);for(const y of Object.keys(h))q[y]!==h[y]&&r.add(y);r.forEach(y=>console.error(`  ${y}: current ${q[y]} new ${h[y]}`))}}else this._includedModules.set(h,
r),h(this.builder,r)};return b._createClass(p)}();let m=function(p){function h(){var q=r.apply(this,arguments);q.vertex=new f;q.fragment=new f;q.attributes=new d;q.varyings=new e;q.extensions=new k;q.constants=new u;return q}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.generate=function(q){const y=this.extensions.generateSource(q),B=this.attributes.generateSource(q),D=this.varyings.generateSource(q);var z="vertex"===q?this.vertex:this.fragment;const v=z.uniforms.generateSource(),A=z.code.generateSource();
q="vertex"===q?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n\nout vec4 fragColor;";z=this.constants.generateSource().concat(z.constants.generateSource());return`#version 300 es\n${y.join("\n")}\n\n${q}\n\n${z.join("\n")}\n\n${v.join("\n")}\n\n${B.join("\n")}\n\n${D.join("\n")}\n\n${A.join("\n")}`};p.generateBind=function(q,y){const B=
new Map;this.vertex.uniforms.entries.forEach(v=>{const A=v.bind[q];n.isSome(A)&&B.set(v.name,A)});this.fragment.uniforms.entries.forEach(v=>{const A=v.bind[q];n.isSome(A)&&B.set(v.name,A)});const D=Array.from(B.values()),z=D.length;return(v,A,t)=>{for(let C=0;C<z;++C)D[C](y,v,A,t)}};b._createClass(h,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}}]);return h}(w),l=function(){function p(){this._entries=new Map}var h=p.prototype;
h.add=function(r){if(!Array.isArray(r))return this._add(r);for(const q of r)this._add(q)};h.get=function(r){return this._entries.get(r)};h._add=function(r){if(n.isNone(r))x.error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(r.name)&&!this._entries.get(r.name).equals(r))throw new c(`Duplicate uniform name ${r.name} for different uniform type`);this._entries.set(r.name,r)}};h.generateSource=function(){return Array.from(this._entries.values()).map(r=>n.isSome(r.arraySize)?
`uniform ${r.type} ${r.name}[${r.arraySize}];`:`uniform ${r.type} ${r.name};`)};b._createClass(p,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return p}(),g=function(){function p(){this._entries=[]}var h=p.prototype;h.add=function(r){this._entries.push(r)};h.generateSource=function(){return this._entries};return b._createClass(p)}(),f=function(p){function h(){var q=r.apply(this,arguments);q.uniforms=new l;q.code=new g;q.constants=new u;return q}b._inherits(h,p);var r=
b._createSuper(h);b._createClass(h,[{key:"builder",get:function(){return this}}]);return h}(w),d=function(){function p(){this._entries=[]}var h=p.prototype;h.add=function(r,q){this._entries.push([r,q])};h.generateSource=function(r){return"fragment"===r?[]:this._entries.map(q=>`in ${q[1]} ${q[0]};`)};return b._createClass(p)}(),e=function(){function p(){this._entries=[]}var h=p.prototype;h.add=function(r,q){this._entries.push([r,q])};h.generateSource=function(r){return this._entries.map(q=>"vertex"===
r?`out ${q[1]} ${q[0]};`:`in ${q[1]} ${q[0]};`)};return b._createClass(p)}(),k=function(){function p(){this._entries=new Set}var h=p.prototype;h.add=function(r){this._entries.add(r)};h.generateSource=function(r){const q="vertex"===r?p.ALLOWLIST_VERTEX:p.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(y=>q.includes(y)).map(y=>`#extension ${y} : enable`)};return b._createClass(p)}();k.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];k.ALLOWLIST_VERTEX=[];let u=
function(){function p(){this._entries=new Set}var h=p.prototype;h.add=function(r,q,y){let B="ERROR_CONSTRUCTOR_STRING";switch(q){case "float":B=p._numberToFloatStr(y);break;case "int":B=p._numberToIntStr(y);break;case "bool":B=y.toString();break;case "vec2":B=`vec2(${p._numberToFloatStr(y[0])},                            ${p._numberToFloatStr(y[1])})`;break;case "vec3":B=`vec3(${p._numberToFloatStr(y[0])},                            ${p._numberToFloatStr(y[1])},                            ${p._numberToFloatStr(y[2])})`;
break;case "vec4":B=`vec4(${p._numberToFloatStr(y[0])},                            ${p._numberToFloatStr(y[1])},                            ${p._numberToFloatStr(y[2])},                            ${p._numberToFloatStr(y[3])})`;break;case "ivec2":B=`ivec2(${p._numberToIntStr(y[0])},                             ${p._numberToIntStr(y[1])})`;break;case "ivec3":B=`ivec3(${p._numberToIntStr(y[0])},                             ${p._numberToIntStr(y[1])},                             ${p._numberToIntStr(y[2])})`;
break;case "ivec4":B=`ivec4(${p._numberToIntStr(y[0])},                             ${p._numberToIntStr(y[1])},                             ${p._numberToIntStr(y[2])},                             ${p._numberToIntStr(y[3])})`;break;case "mat2":case "mat3":case "mat4":B=`${q}(${Array.prototype.map.call(y,D=>p._numberToFloatStr(D)).join(", ")})`}this._entries.add(`const ${q} ${r} = ${B};`);return this};p._numberToIntStr=function(r){return r.toFixed(0)};p._numberToFloatStr=function(r){return Number.isInteger(r)?
r.toFixed(1):r.toString()};h.generateSource=function(){return Array.from(this._entries)};return b._createClass(p)}();a.Code=g;a.Includes=w;a.ShaderBuilder=m;a.Stage=f;a.Uniforms=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,
l,"sampler2D",w.BindType.Pass,(f,d,e)=>f.bindTexture(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Texture2DPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x,m){this._module=x;this._loadModule=m}var n=w.prototype;n.get=function(){return this._module};
n.reload=async function(){return this._module=await this._loadModule()};return b._createClass(w)}();a.ReloadableShaderModule=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,c,w){let n=function(){function x(l,g,f){this.release=f;this.initializeConfiguration(l,g);this._configuration=
g.snapshot();this._program=this.initializeProgram(l);this._pipeline=this.initializePipeline(l.rctx.capabilities)}var m=x.prototype;m.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._configuration=null};m.reload=function(l){c.disposeMaybe(this._program);this._program=this.initializeProgram(l);this._pipeline=this.initializePipeline(l.rctx.capabilities)};m.bindPipelineState=function(l,g=null,f){l.setPipelineState(this.getPipelineState(g,f))};m.ensureAttributeLocations=
function(l){this.program.assertCompatibleVertexAttributeLocations(l)};m.getPipelineState=function(l,g){return this._pipeline};m.initializeConfiguration=function(l,g){};b._createClass(x,[{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.compiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},{key:"primitiveType",get:function(){return w.PrimitiveType.TRIANGLES}}]);return x}();
a.ShaderTechnique=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";
b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=
775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));
a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]=
"FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=
514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=
void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||
(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";
b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=
33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=
33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";
b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||
(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=
5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";
b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";
b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget=
{}));a.TargetType=void 0;(function(b){b[b.TEXTURE=0]="TEXTURE";b[b.RENDER_BUFFER=1]="RENDER_BUFFER";b[b.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=void 0;(function(b){b[b.NONE=0]="NONE";b[b.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";b[b.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));
a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=
36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]=
"COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=
33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=
37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";
b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";
b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]=
"INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=
37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=
37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,
7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../core/shaderTechnique/BindType ../../../webgl/checkWebGLError".split(" "),function(a,b,c,w,n,x){let m=function(){function l(f,
d,e){this._context=f;this._locations=e;this._textures=new Map;this._freeTextureUnits=new w({deallocator:null});this._glProgram=f.programCache.acquire(d.generate("vertex"),d.generate("fragment"),e);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=d.generateBind(n.BindType.Pass,this);this.bindDraw=d.generateBind(n.BindType.Draw,this);this._fragmentUniforms=x.webglDebugEnabled()?d.fragmentUniforms:null}var g=l.prototype;g.dispose=function(){this._glProgram.dispose()};
g.setUniform1b=function(f,d){this._glProgram.setUniform1i(f,d?1:0)};g.setUniform1i=function(f,d){this._glProgram.setUniform1i(f,d)};g.setUniform1f=function(f,d){this._glProgram.setUniform1f(f,d)};g.setUniform2fv=function(f,d){this._glProgram.setUniform2fv(f,d)};g.setUniform3fv=function(f,d){this._glProgram.setUniform3fv(f,d)};g.setUniform4fv=function(f,d){this._glProgram.setUniform4fv(f,d)};g.setUniformMatrix3fv=function(f,d){this._glProgram.setUniformMatrix3fv(f,d)};g.setUniformMatrix4fv=function(f,
d){this._glProgram.setUniformMatrix4fv(f,d)};g.setUniform1fv=function(f,d){this._glProgram.setUniform1fv(f,d)};g.setUniform1iv=function(f,d){this._glProgram.setUniform1iv(f,d)};g.setUniform2iv=function(f,d){this._glProgram.setUniform3iv(f,d)};g.setUniform3iv=function(f,d){this._glProgram.setUniform3iv(f,d)};g.setUniform4iv=function(f,d){this._glProgram.setUniform4iv(f,d)};g.assertCompatibleVertexAttributeLocations=function(f){f.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};
g.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};g.bindTexture=function(f,d){if(c.isNone(d)||null==d.glName){if(d=this._textures.get(f))this._context.bindTexture(null,d.unit),this._freeTextureUnit(d),this._textures.delete(f);return null}let e=this._textures.get(f);null==e?(e=this._allocTextureUnit(d),this._textures.set(f,e)):e.texture=d;this._context.useProgram(this);this.setUniform1i(f,e.unit);this._context.bindTexture(d,e.unit);return e.unit};g.rebindTextures=function(){this._context.useProgram(this);
this._textures.forEach((f,d)=>{this._context.bindTexture(f.texture,f.unit);this.setUniform1i(d,f.unit)});c.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(f=>{"sampler2D"!==f.type&&"samplerCube"!==f.type||this._textures.has(f.name)||console.error(`Texture sampler ${f.name} has no bound texture`)})};g._allocTextureUnit=function(f){return{texture:f,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};g._freeTextureUnit=function(f){this._freeTextureUnits.push(f.unit)};
b._createClass(l,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"compiled",get:function(){return this._glProgram.compiled}}]);return l}();a.Program=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,c,w){function n(l,g){switch(g){case l.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case l.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case l.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case l.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case l.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case l.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const x=w.getLogger("esri.views.webgl.checkWebGLError"),m=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(l){if(m){const g=l.getError();g&&(l=n(l,g),x.error(new b("webgl-error","WebGL error occured",{message:l,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=m;a.webglDebugEnabled=function(){return m};a.webglValidateShadersEnabled=function(){return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c,w){function n(O){return t.intern(O)}function x(O){return C.intern(O)}function m(O){return E.intern(O)}function l(O){return F.intern(O)}function g(O){return H.intern(O)}function f(O){return K.intern(O)}function d(O){return I.intern(O)}function e(O){return L.intern(O)}function k(O){return"["+O.join(",")+"]"}function u(O){return O?k([O.srcRgb,O.srcAlpha,O.dstRgb,O.dstAlpha,O.opRgb,O.opAlpha,O.color.r,
O.color.g,O.color.b,O.color.a]):null}function p(O){return O?k([O.face,O.mode]):null}function h(O){return O?k([O.factor,O.units]):null}function r(O){return O?k([O.func]):null}function q(O){return O?k([O.function.func,O.function.ref,O.function.mask,O.operation.fail,O.operation.zFail,O.operation.zPass]):null}function y(O){return O?k([O.zNear,O.zFar]):null}function B(O){return O?k([O.r,O.g,O.b,O.a]):null}function D(O){return O?k([O.mask]):null}const z={face:w.Face.BACK,mode:w.CullMode.CCW},v={face:w.Face.FRONT,
mode:w.CullMode.CCW};var A=function(){function O(J,M){this._makeKey=J;this._makeRef=M;this._interns=new Map}O.prototype.intern=function(J){if(!J)return null;const M=this._makeKey(J),G=this._interns;G.has(M)||G.set(M,this._makeRef(J));return G.get(M)??null};return b._createClass(O)}();const t=new A(u,O=>({__tag:"Blending",...O})),C=new A(p,O=>({__tag:"Culling",...O})),E=new A(h,O=>({__tag:"PolygonOffset",...O})),F=new A(r,O=>({__tag:"DepthTest",...O})),H=new A(q,O=>({__tag:"StencilTest",...O})),K=
new A(y,O=>({__tag:"DepthWrite",...O})),I=new A(B,O=>({__tag:"ColorWrite",...O})),L=new A(D,O=>({__tag:"StencilWrite",...O})),R=new A(function(O){return O?k([u(O.blending),p(O.culling),h(O.polygonOffset),r(O.depthTest),q(O.stencilTest),y(O.depthWrite),B(O.colorWrite),D(O.stencilWrite)]):null},O=>({blending:n(O.blending),culling:x(O.culling),polygonOffset:m(O.polygonOffset),depthTest:l(O.depthTest),stencilTest:g(O.stencilTest),depthWrite:f(O.depthWrite),colorWrite:d(O.colorWrite),stencilWrite:e(O.stencilWrite)}));
A=function(){function O(M){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=M}var J=O.prototype;J.setPipeline=function(M){if(this._pipelineInvalid||M!==this._pipeline)this._setBlending(M.blending),this._setCulling(M.culling),this._setPolygonOffset(M.polygonOffset),this._setDepthTest(M.depthTest),this._setStencilTest(M.stencilTest),
this._setDepthWrite(M.depthWrite),this._setColorWrite(M.colorWrite),this._setStencilWrite(M.stencilWrite),this._pipeline=M;this._pipelineInvalid=!1};J.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};J.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};J.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};J.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};J.invalidateStencilTest=
function(){this._pipelineInvalid=this._stencilTestInvalid=!0};J.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};J.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};J.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};J._setBlending=function(M){this._blending=this._setSubState(M,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};J._setCulling=function(M){this._culling=
this._setSubState(M,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};J._setPolygonOffset=function(M){this._polygonOffset=this._setSubState(M,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};J._setDepthTest=function(M){this._depthTest=this._setSubState(M,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};J._setStencilTest=function(M){this._stencilTest=
this._setSubState(M,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};J._setDepthWrite=function(M){this._depthWrite=this._setSubState(M,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};J._setColorWrite=function(M){this._colorWrite=this._setSubState(M,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};J._setStencilWrite=function(M){this._stencilWrite=
this._setSubState(M,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};J._setSubState=function(M,G,P,U){if(P||M!==G)U(M),this._pipelineInvalid=!0;return M};return b._createClass(O)}();a.StateTracker=A;a.backFaceCullingParams=z;a.cullingParams=O=>O===c.CullFaceOptions.Back?z:O===c.CullFaceOptions.Front?v:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=v;a.makeBlending=
n;a.makeColorWrite=d;a.makeCulling=x;a.makeDepthTest=l;a.makeDepthWrite=f;a.makePipelineState=function(O){return R.intern(O)};a.makePolygonOffset=m;a.makeStencilTest=g;a.makeStencilWrite=e;a.separateBlendingParams=function(O,J,M,G,P=w.BlendOperation.ADD,U=w.BlendOperation.ADD,N=[0,0,0,0]){return{srcRgb:O,srcAlpha:J,dstRgb:M,dstAlpha:G,opRgb:P,opAlpha:U,color:{r:N[0],g:N[1],b:N[2],a:N[3]}}};a.simpleBlendingParams=function(O,J,M=w.BlendOperation.ADD,G=[0,0,0,0]){return{srcRgb:O,srcAlpha:O,dstRgb:J,
dstAlpha:J,opRgb:M,opAlpha:M,color:{r:G[0],g:G[1],b:G[2],a:G[3]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||
(a.DepthTestFunction={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits=
{}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PowerOfTwoResizeMode=void 0;(function(b){b[b.STRETCH=1]="STRETCH";b[b.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";
b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));a.TextureEncodingMimeType=void 0;(function(b){b.DDS_ENCODING="image/vnd-ms.dds";b.KTX2_ENCODING="image/ktx2";b.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){let n=function(x){function m(){var g=l.apply(this,arguments);g.haze=!1;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter()],n.prototype,"haze",void 0);a.ChapmanAtmosphereTechniqueConfiguration=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(w){function n(){var m=x.call(this);m._key="";m._keyDirty=!1;m._parameterBits=m._parameterBits?m._parameterBits.map(()=>0):[];m._parameterNames||(m._parameterNames=[]);return m}b._inherits(n,w);var x=b._createSuper(n);n.prototype.snapshot=
function(){const m=this._parameterNames,l={key:this.key};for(const g of m)l[g]=this[g];return l};b._createClass(n,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return n}(c.NoParameters);a.ShaderTechniqueConfiguration=c;a.parameter=function(w={}){return(n,x)=>{n._parameterNames=n._parameterNames??[];n._parameterNames.push(x);if(null!=w.constValue)Object.defineProperty(n,x,{get(){return w.constValue}});
else{const m=n._parameterNames.length-1,l=Math.ceil(Math.log2(w.count||2)),g=n._parameterBits??[0];let f=0;for(;16<g[f]+l;)f++,f>=g.length&&g.push(0);n._parameterBits=g;const d=g[f],e=(1<<l)-1<<d;g[f]+=l;Object.defineProperty(n,x,{get(){return this[m]},set(k){if(this[m]!==k&&(this[m]=k,this._keyDirty=!0,this._parameterBits[f]=this._parameterBits[f]&~e|+k<<d&e,"number"!==typeof k&&"boolean"!==typeof k))throw Error("Configuration value for "+x+" must be boolean or number, got "+typeof k);}})}}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,w){const n=[new w.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],x=[new w.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,20),new w.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],m=[new w.VertexElementDescriptor(b.VertexAttribute.POSITION,
3,c.DataType.FLOAT,0,32),new w.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,c.DataType.FLOAT,12,32),new w.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],l=[new w.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new w.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],g=[new w.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];b=[new w.VertexElementDescriptor(b.VertexAttribute.POSITION,
2,c.DataType.FLOAT,0,16),new w.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,8,16)];a.Pos2=g;a.Pos2Tex=b;a.Pos3=n;a.Pos3Col=l;a.Pos3NormalTex=m;a.Pos3Tex=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,w,n,x,m,l=!1,g=0){this.name=c;this.count=w;this.type=n;this.offset=x;this.stride=m;this.normalized=l;this.divisor=
g});a.VertexElementDescriptor=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,b,c,w,n,x,m){a.createColorTexture=function(l,g,f=4){const d=new Uint8Array(f*f*4);for(let e=0;e<d.length;e+=4)d[e]=255*g[0],d[e+1]=255*g[1],d[e+2]=255*g[2],d[e+
3]=255*g[3];return new m.Texture(l,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.NEAREST,width:f,height:f},d)};a.createEmptyDepthTexture=function(l){return new m.Texture(l,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(l,g=4){return new m.Texture(l,
{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.NEAREST,width:g,height:g})};a.createQuadVAO=function(l,g=c.Pos2,f=b.Default3D,d=-1,e=1){let k=null;switch(g){case c.Pos2Tex:k=new Float32Array([d,d,0,0,e,d,1,0,d,e,0,1,e,e,1,1]);break;default:k=new Float32Array([d,d,e,d,d,e,e,e])}return new w.VertexArrayObject(l,f,{geometry:g},{geometry:n.BufferObject.createVertex(l,x.Usage.STATIC_DRAW,k)})};a.createScreenSizeTriangleVAO=
function(l,g=c.Pos2,f=b.Default3D){const d=new Float32Array([-1,-1,3,-1,-1,3]);return new w.VertexArrayObject(l,f,{geometry:g},{geometry:n.BufferObject.createVertex(l,x.Usage.STATIC_DRAW,d)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/VertexArrayObject"],function(a,b,c){c=function(w){function n(){return x.apply(this,arguments)}b._inherits(n,
w);var x=b._createSuper(n);return b._createClass(n)}(c.VertexArrayObject);a.VertexArrayObject=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),function(a,b,c,w,n,x){const m=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function l(f,d,e,k,u=null){this._context=f;this._locations=d;this._layout=e;this._buffers=
k;this._indexBuffer=u;this._glName=null;this._initialized=!1;f.instanceCounter.increment(n.ResourceType.VertexArrayObject,this)}var g=l.prototype;g.dispose=function(f=!0){if(this._context){if(this._glName){const d=this._context?.capabilities?.vao;d?(d.deleteVertexArray(this._glName),this._glName=null):m.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(f){for(const d in this._buffers)this._buffers[d]?.dispose(),delete this._buffers[d];this._indexBuffer=w.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(n.ResourceType.VertexArrayObject,
this);this._context=w.nullifyNonNullableForDispose(this._context)}else(this._glName||f&&0<Object.getOwnPropertyNames(this._buffers).length)&&m.warn("Leaked WebGL VAO")};g.initialize=function(){if(!this._initialized){var f=this._context.capabilities.vao;if(f){const d=f.createVertexArray();f.bindVertexArray(d);this._bindLayout();f.bindVertexArray(null);this._glName=d}this._initialized=!0}};g.bind=function(){this.initialize();const f=this._context.capabilities.vao;f?f.bindVertexArray(this.glName):(this._context.bindVAO(null),
this._bindLayout())};g._bindLayout=function(){const {_buffers:f,_layout:d,_indexBuffer:e}=this;f||m.error("Vertex buffer dictionary is empty!");const k=this._context.gl;for(const u in f){const p=f[u];p||m.error("Vertex buffer is uninitialized!");const h=d[u];h||m.error("Vertex element descriptor is empty!");x.bindVertexBufferLayout(this._context,this._locations,p,h)}w.isSome(e)&&(this._context.capabilities.vao?k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))};g.unbind=function(){this.initialize();
const f=this._context.capabilities.vao;f?f.bindVertexArray(null):this._unbindLayout()};g._unbindLayout=function(){const {_buffers:f,_layout:d}=this;f||m.error("Vertex buffer dictionary is empty!");for(const e in f){const k=f[e];k||m.error("Vertex buffer is uninitialized!");x.unbindVertexBufferLayout(this._context,this._locations,k,d[e])}w.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(l,[{key:"glName",get:function(){return this._glName}},{key:"context",
get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((f,d)=>f+this._buffers[d].size,w.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return l}();a.VertexArrayObject=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,b,c,w){function n(l){return l[0].stride}function x(l){switch(l){case w.PixelFormat.ALPHA:case w.PixelFormat.LUMINANCE:case w.PixelFormat.RED:case w.PixelFormat.RED_INTEGER:case w.SizedPixelFormat.R8:case w.SizedPixelFormat.R8I:case w.SizedPixelFormat.R8UI:case w.SizedPixelFormat.R8_SNORM:case w.RenderbufferFormat.STENCIL_INDEX8:return 1;case w.PixelFormat.LUMINANCE_ALPHA:case w.PixelFormat.RG:case w.PixelFormat.RG_INTEGER:case w.SizedPixelFormat.RGBA4:case w.SizedPixelFormat.R16F:case w.SizedPixelFormat.R16I:case w.SizedPixelFormat.R16UI:case w.SizedPixelFormat.RG8:case w.SizedPixelFormat.RG8I:case w.SizedPixelFormat.RG8UI:case w.SizedPixelFormat.RG8_SNORM:case w.SizedPixelFormat.RGB565:case w.SizedPixelFormat.RGB5_A1:case w.RenderbufferFormat.DEPTH_COMPONENT16:return 2;
case w.PixelFormat.DEPTH_COMPONENT:case w.PixelFormat.RGB:case w.PixelFormat.RGB_INTEGER:case w.SizedPixelFormat.RGB8:case w.SizedPixelFormat.RGB8I:case w.SizedPixelFormat.RGB8UI:case w.SizedPixelFormat.RGB8_SNORM:case w.SizedPixelFormat.SRGB8:case w.RenderbufferFormat.DEPTH_COMPONENT24:return 3;case w.PixelFormat.DEPTH_STENCIL:case w.PixelFormat.RGBA:case w.PixelFormat.RGBA_INTEGER:case w.SizedPixelFormat.RGBA8:case w.SizedPixelFormat.R32F:case w.SizedPixelFormat.R11F_G11F_B10F:case w.SizedPixelFormat.RG16F:case w.SizedPixelFormat.R32I:case w.SizedPixelFormat.R32UI:case w.SizedPixelFormat.RG16I:case w.SizedPixelFormat.RG16UI:case w.SizedPixelFormat.RGBA8I:case w.SizedPixelFormat.RGBA8UI:case w.SizedPixelFormat.RGBA8_SNORM:case w.SizedPixelFormat.SRGB8_ALPHA8:case w.SizedPixelFormat.RGB9_E5:case w.SizedPixelFormat.RGB10_A2UI:case w.SizedPixelFormat.RGB10_A2:case w.RenderbufferFormat.DEPTH_STENCIL:case w.RenderbufferFormat.DEPTH_COMPONENT32F:case w.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case w.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case w.SizedPixelFormat.RGB16F:case w.SizedPixelFormat.RGB16I:case w.SizedPixelFormat.RGB16UI:return 6;case w.SizedPixelFormat.RG32F:case w.SizedPixelFormat.RG32I:case w.SizedPixelFormat.RG32UI:case w.SizedPixelFormat.RGBA16F:case w.SizedPixelFormat.RGBA16I:case w.SizedPixelFormat.RGBA16UI:return 8;case w.SizedPixelFormat.RGB32F:case w.SizedPixelFormat.RGB32I:case w.SizedPixelFormat.RGB32UI:return 12;case w.SizedPixelFormat.RGBA32F:case w.SizedPixelFormat.RGBA32I:case w.SizedPixelFormat.RGBA32UI:return 16;
case w.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case w.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case w.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case w.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case w.CompressedTextureFormat.COMPRESSED_R11_EAC:case w.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case w.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case w.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case w.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case w.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case w.CompressedTextureFormat.COMPRESSED_RG11_EAC:case w.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case w.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case w.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function m(l){if(c.isNone(l))return 0;if("descriptor"in l)return l.glName?m(l.descriptor):0;const g=l.internalFormat||"pixelFormat"in l&&l.pixelFormat;if(!g)return 0;const f="hasMipmap"in l&&l.hasMipmap?1.3:1;l=l.width*l.height;return x(g)*l*f}a.bindVertexBufferLayout=
function(l,g,f,d,e=0){const k=l.gl,u=l.capabilities.instancing;l.bindBuffer(f);for(const p of d)if(l=g.get(p.name),void 0===l&&console.error(`There is no location for vertex attribute '${p.name}' defined.`),f=e*p.stride,4>=p.count)k.vertexAttribPointer(l,p.count,p.type,p.normalized,p.stride,p.offset+f),k.enableVertexAttribArray(l),0<p.divisor&&u&&u.vertexAttribDivisor(l,p.divisor);else if(9===p.count)for(d=0;3>d;d++)k.vertexAttribPointer(l+d,3,p.type,p.normalized,p.stride,p.offset+12*d+f),k.enableVertexAttribArray(l+
d),0<p.divisor&&u&&u.vertexAttribDivisor(l+d,p.divisor);else if(16===p.count)for(d=0;4>d;d++)k.vertexAttribPointer(l+d,4,p.type,p.normalized,p.stride,p.offset+16*d+f),k.enableVertexAttribArray(l+d),0<p.divisor&&u&&u.vertexAttribDivisor(l+d,p.divisor);else console.error("Unsupported vertex attribute element count: "+p.count)};a.getBytesPerElementFormat=x;a.getErrorString=function(l){l=l.gl;switch(l.getError()){case l.NO_ERROR:return null;case l.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case l.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case l.INVALID_OPERATION:return"The specified command is not allowed for the current state";case l.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case l.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case l.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=m;a.getStride=n;a.unbindVertexBufferLayout=
function(l,g,f,d){const e=l.gl,k=l.capabilities.instancing;l.bindBuffer(f);for(const u of d)if(f=g.get(u.name),4>=u.count)e.disableVertexAttribArray(f),u.divisor&&0<u.divisor&&k&&k.vertexAttribDivisor(f,0);else if(9===u.count)for(d=0;3>d;d++)e.disableVertexAttribArray(f+d),u.divisor&&0<u.divisor&&k&&k.vertexAttribDivisor(f+d,0);else if(16===u.count)for(d=0;4>d;d++)e.disableVertexAttribArray(f+d),u.divisor&&0<u.divisor&&k&&k.vertexAttribDivisor(f+d,0);else console.error("Unsupported vertex attribute element count: "+
u.count);l.unbindBuffer(w.BufferType.ARRAY_BUFFER)};a.vertexCount=function(l,g){return l.vertexBuffers[g].size/n(l.layout[g])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(a,b,c,w,n,x,m,l,g){const f=w.getLogger("esri.views.webgl.BufferObject");
w=function(){function d(k,u,p,h){this._context=k;this.bufferType=u;this.usage=p;this._glName=null;this._size=-1;this._indexType=void 0;k.instanceCounter.increment(g.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();m.checkWebGLError(this._context.gl);h&&this.setData(h)}d.createIndex=function(k,u,p){return new d(k,g.BufferType.ELEMENT_ARRAY_BUFFER,u,p)};d.createVertex=function(k,u,p){return new d(k,g.BufferType.ARRAY_BUFFER,u,p)};d.createUniform=function(k,u,p){if(k.type!==
l.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new d(k,g.BufferType.UNIFORM_BUFFER,u,p)};d.createPixelPack=function(k,u=g.Usage.STREAM_READ,p){if(k.type!==l.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");k=new d(k,g.BufferType.PIXEL_PACK_BUFFER,u);p&&k.setSize(p);return k};d.createPixelUnpack=function(k,u=g.Usage.STREAM_DRAW,p){if(k.type!==l.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");
return new d(k,g.BufferType.PIXEL_UNPACK_BUFFER,u,p)};var e=d.prototype;e.dispose=function(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(g.ResourceType.BufferObject,this),this._context=n.nullifyNonNullableForDispose(this._context)):this._glName&&f.warn("Leaked WebGL buffer object")};e.setSize=function(k,u=null){0>=k&&f.error("Buffer size needs to be positive!");if(this.bufferType===g.BufferType.ELEMENT_ARRAY_BUFFER&&
n.isSome(u))switch(this._indexType=u,u){case g.DataType.UNSIGNED_SHORT:k*=2;break;case g.DataType.UNSIGNED_INT:k*=4}this._setBufferData(k)};e.setData=function(k){if(k){var u=k.byteLength;this.bufferType===g.BufferType.ELEMENT_ARRAY_BUFFER&&(x.isUint16Array(k)&&(u/=2,this._indexType=g.DataType.UNSIGNED_SHORT),x.isUint32Array(k)&&(u/=4,this._indexType=g.DataType.UNSIGNED_INT));this._setBufferData(u,k)}};e._setBufferData=function(k,u=null){this._size=k;const p=this._context.getBoundVAO();this._isVAOAware&&
this._context.bindVAO(null);this._context.bindBuffer(this);const h=this._context.gl;n.isSome(u)?h.bufferData(this.bufferType,u,this.usage):h.bufferData(this.bufferType,k,this.usage);m.checkWebGLError(h);this._isVAOAware&&this._context.bindVAO(p)};e.setSubData=function(k,u,p,h){if(k){(0>u||u*k.BYTES_PER_ELEMENT>=this.byteSize)&&f.error("offset is out of range!");p>=h&&f.error("end must be bigger than start!");(u+(h-p))*k.BYTES_PER_ELEMENT>this.byteSize&&f.error("An attempt to write beyond the end of the buffer!");
var r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var q=this._context.gl;this._context.type===l.ContextType.WEBGL2?q.bufferSubData(this.bufferType,u*k.BYTES_PER_ELEMENT,k,p,h-p):(p=0===p&&h===k.length?k:k.subarray(p,h),q.bufferSubData(this.bufferType,u*k.BYTES_PER_ELEMENT,p));m.checkWebGLError(q);this._isVAOAware&&this._context.bindVAO(r)}};e.getSubData=function(k,u=0,p,h){if(this._context.type!==l.ContextType.WEBGL2)f.error("Get buffer subdata is supported in WebGL2 only!");
else if(0>p||0>h)f.error("Problem getting subdata: offset and length were less than zero!");else{var r=c.isArrayLike(k)?k.BYTES_PER_ELEMENT:1;r*((p??0)+(h??0))>k.byteLength?f.error("Problem getting subdata: offset and length exceeded destination size!"):(u+r*(h??0)>this.byteSize&&f.warn("Potential problem getting subdata: requested data exceeds buffer size!"),r=this._context.gl,this._context.bindBuffer(this,g.BufferType.COPY_READ_BUFFER),r.getBufferSubData(g.BufferType.COPY_READ_BUFFER,u,k,p,h),this._context.unbindBuffer(g.BufferType.COPY_READ_BUFFER))}};
e.getSubDataAsync=async function(k,u=0,p,h){this._context.type!==l.ContextType.WEBGL2?f.error("Get buffer subdata is supported in WebGL2 only!"):(await this._context.clientWaitAsync(),this.getSubData(k,u,p,h))};b._createClass(d,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===g.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===g.DataType.UNSIGNED_INT?
4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===g.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===g.BufferType.ARRAY_BUFFER}}]);return d}();a.BufferObject=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/context-util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,b,c){function w(l){const g=b("esri-force-webgl");if(g===a.ContextType.WEBGL1||g===a.ContextType.WEBGL2)return[g];switch(l){case "2d":return b("mac")&&
b("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function n(l,g,f={}){if(!window.WebGLRenderingContext)return m(l,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),null;g=x(l,g,f);c.isNone(g)&&m(l,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');
return g}function x(l,g,f={}){g=g===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let d=null;for(const e of g){try{d=l.getContext(e,f)}catch(k){}if(d)break}return d}function m(l,g){(l=l.parentNode)&&(l.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+g+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}
a.ContextType=void 0;(function(l){l[l.WEBGL1=1]="WEBGL1";l[l.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=x;a.createContextOrErrorHTML=function(l,g,f={}){for(l=w(l);1<l.length;){const d=x(g,l.shift(),f);if(c.isSome(d))return d}return n(g,l.shift(),f)};a.getContextTypes=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums".split(" "),
function(a,b,c,w,n,x,m,l){function g(u){return n.isSome(u)&&"type"in u&&"compressed"===u.type}function f(u){var p;if(p=n.isSome(u)&&!g(u))p=!(n.isSome(u)&&"byteLength"in u);return p}function d(u){return u===l.TextureType.TEXTURE_3D||u===l.TextureType.TEXTURE_2D_ARRAY}function e(u,p,h,r=1){p=Math.max(p,h);u===l.TextureType.TEXTURE_3D&&(p=Math.max(p,r));return Math.round(Math.log(p)/Math.LN2)+1}const k={target:l.TextureType.TEXTURE_2D,samplingMode:l.TextureSamplingMode.LINEAR,wrapMode:l.TextureWrapMode.REPEAT,
flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1};c=function(){function u(h,r,q=null){this._context=h;this.type="texture";this._glName=null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;h.instanceCounter.increment(l.ResourceType.Texture,this);this._descriptor={...k,...r};for(const y in k)void 0===this._descriptor[y]&&(this._descriptor[y]=k[y]);if(h.type!==m.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=
!1),d(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");this._descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(q):this.setData(q)}var p=u.prototype;p.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(l.ResourceType.Texture,this))};p.release=function(){this.dispose()};p.resize=function(h,r){const q=
this._descriptor;if(q.width!==h||q.height!==r){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");q.width=h;q.height=r;this._descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};p._setDataCubeMap=function(h=null){for(let r=l.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;r<=l.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(h,r)};p.setData=function(h){this._setData(h)};p._setData=function(h,r){if(this._context&&this._context.gl){var q=
this._context.gl;this._glName||(this._glName=q.createTexture());void 0===h&&(h=null);var y=this._descriptor,B=r??y.target,D=d(B);null===h&&(y.width=y.width||4,y.height=y.height||4,D&&(y.depth=y.depth??1));r=this._context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);u._validateTexture(this._context,y);this._configurePixelStorage();x.checkWebGLError(q);var z=y.pixelFormat,v=y.internalFormat??this._deriveInternalFormat(z,y.dataType);if(f(h)){z=
h.width;let A=h.height;h instanceof HTMLVideoElement&&(z=h.videoWidth,A=h.videoHeight);y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(B,v,y.hasMipmap,z,A,1);this._texImage(B,0,v,z,A,1,h);x.checkWebGLError(q);y.hasMipmap&&this.generateMipmap();void 0===y.width&&(y.width=z);void 0===y.height&&(y.height=A);D&&void 0===y.depth&&(y.depth=1)}else{const {width:A,height:t,depth:C}=y;if(null==A||null==t)throw Error("Width and height must be specified!");if(D&&null==C)throw Error("Depth must be specified!");
y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(B,v,y.hasMipmap,A,t,C);q.DEPTH24_STENCIL8&&v===q.DEPTH_STENCIL&&(v=q.DEPTH24_STENCIL8);if(g(h)){const E=h.levels;h=e(B,A,t,C);D=Math.min(h-1,E.length-1);n.isSome(this._context.gl2)?q.texParameteri(y.target,this._context.gl2.TEXTURE_MAX_LEVEL,D):y.hasMipmap=y.hasMipmap&&h===E.length;const F=v;if(!(F in l.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((H,K,I,
L)=>{this._compressedTexImage(B,H,F,K,I,L,E[Math.min(H,E.length-1)])},D)}else n.isSome(h)?(this._texImage(B,0,v,A,t,C,h),x.checkWebGLError(q),y.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((E,F,H,K)=>{this._texImage(B,E,v,F,H,K,null);x.checkWebGLError(q)})}u._applySamplingMode(q,this._descriptor);u._applyWrapMode(q,this._descriptor);u._applyAnisotropicFilteringParameters(this._context,this._descriptor);x.checkWebGLError(q);this._context.bindTexture(r,u.TEXTURE_UNIT_FOR_UPDATES)}};p.updateData=
function(h,r,q,y,B,D,z=0){D||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const v=this._context.gl,A=this._descriptor,{pixelFormat:t,dataType:C,target:E,isImmutable:F}=A,H=A.internalFormat??this._deriveInternalFormat(t,C);if(F&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const K=this._context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES,!0);(0>r||0>q||y>A.width||B>
A.height||r+y>A.width||q+B>A.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();if(z){if(n.isNone(this._context.gl2)){console.error("Webgl2 must be enabled to use dataRowOffset!");return}v.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,z)}f(D)?n.isSome(this._context.gl2)?this._context.gl2.texSubImage2D(E,h,r,q,y,B,t,C,D):v.texSubImage2D(E,h,r,q,t,C,D):g(D)?v.compressedTexSubImage2D(E,h,r,q,y,B,H,D.levels[h]):v.texSubImage2D(E,h,r,q,y,B,t,C,D);
if(z){if(n.isNone(this._context.gl2)){console.error("Webgl2 must be enabled to use dataRowOffset!");return}v.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(K,u.TEXTURE_UNIT_FOR_UPDATES)};p.updateData3D=function(h,r,q,y,B,D,z,v){v||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const A=this._context.gl2;if(n.isNone(A))throw Error("3D textures are not supported in WebGL1");const t=this._descriptor,
{pixelFormat:C,dataType:E,isImmutable:F,target:H}=t,K=t.internalFormat??this._deriveInternalFormat(C,E);if(F&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");d(H)||console.warn("Attempting to set 3D texture data on a non-3D texture");const I=this._context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);(0>r||0>q||0>y||B>t.width||D>t.height||z>t.depth||r+B>t.width||q+D>t.height||y+z>t.depth)&&console.error("An attempt to update out of bounds of the texture!");
this._configurePixelStorage();g(v)?(v=v.levels[h],A.compressedTexSubImage3D(H,h,r,q,y,B,D,z,K,v)):A.texSubImage3D(H,h,r,q,y,B,D,z,C,E,v);this._context.bindTexture(I,u.TEXTURE_UNIT_FOR_UPDATES)};p.generateMipmap=function(){const h=this._descriptor;if(!h.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=h.hasMipmap=!0;u._validateTexture(this._context,h)}h.samplingMode===l.TextureSamplingMode.LINEAR?(this._samplingModeDirty=
!0,h.samplingMode=l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):h.samplingMode===l.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,h.samplingMode=l.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(h.target);this._context.bindTexture(r,u.TEXTURE_UNIT_FOR_UPDATES)};p.setSamplingMode=function(h){h!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=
h,this._samplingModeDirty=!0)};p.setWrapMode=function(h){h!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=h,u._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)};p.applyChanges=function(){const h=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(u._applySamplingMode(h,r),this._samplingModeDirty=!1);this._wrapModeDirty&&(u._applyWrapMode(h,r),this._wrapModeDirty=!1)};p._deriveInternalFormat=function(h,r){if(this._context.type===m.ContextType.WEBGL1)return h;
switch(r){case l.PixelType.FLOAT:switch(h){case l.PixelFormat.RGBA:return l.SizedPixelFormat.RGBA32F;case l.PixelFormat.RGB:return l.SizedPixelFormat.RGB32F;default:throw Error("Unable to derive format");}case l.PixelType.UNSIGNED_BYTE:switch(h){case l.PixelFormat.RGBA:return l.SizedPixelFormat.RGBA8;case l.PixelFormat.RGB:return l.SizedPixelFormat.RGB8}default:return h}};p._configurePixelStorage=function(){const h=this._context.gl,{unpackAlignment:r,flipped:q,preMultiplyAlpha:y}=this._descriptor;
h.pixelStorei(h.UNPACK_ALIGNMENT,r);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,q?1:0);h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y?1:0)};p._texStorage=function(h,r,q,y,B,D){const z=this._context.gl2;if(n.isNone(z))throw Error("Immutable textures are not supported in WebGL1");if(!(r in l.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){q=q?e(h,y,B,D):1;if(d(h)){if(null==D)throw Error("Missing depth dimension for 3D texture upload");
z.texStorage3D(h,q,r,y,B,D)}else z.texStorage2D(h,q,r,y,B);this._wasImmutablyAllocated=!0}};p._texImage=function(h,r,q,y,B,D,z){const v=this._context.gl;let A=null;const t=this._context.type===m.ContextType.WEBGL2,C=d(h),{isImmutable:E,pixelFormat:F,dataType:H}=this._descriptor;t&&(A=v);if(!t&&f(z))v.texImage2D(h,0,q,F,H,z);else if(E){if(n.isSome(z))if(C){if(null==D)throw Error("Missing depth dimension for 3D texture upload");A.texSubImage3D(h,r,0,0,0,y,B,D,F,H,z)}else v.texSubImage2D(h,r,0,0,y,B,
F,H,z)}else if(z=n.unwrap(z),C){if(null==D)throw Error("Missing depth dimension for 3D texture upload");A.texImage3D(h,r,q,y,B,D,0,F,H,z)}else v.texImage2D(h,r,q,y,B,0,F,H,z)};p._compressedTexImage=function(h,r,q,y,B,D,z){const v=this._context.gl;let A=null;const t=d(h),C=this._descriptor.isImmutable;if(t){if(this._context.type!==m.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");A=v}if(C){if(n.isSome(z))if(t){if(null==D)throw Error("Missing depth dimension for 3D texture upload");
A.compressedTexSubImage3D(h,r,0,0,0,y,B,D,q,z)}else v.compressedTexSubImage2D(h,r,0,0,y,B,q,z)}else if(t){if(null==D)throw Error("Missing depth dimension for 3D texture upload");A.compressedTexImage3D(h,r,q,y,B,D,0,z)}else v.compressedTexImage2D(h,r,q,y,B,0,z)};p._forEachMipmapLevel=function(h,r=Infinity){let {width:q,height:y,depth:B,hasMipmap:D,target:z}=this._descriptor;const v=z===l.TextureType.TEXTURE_3D;if(null==q||null==y||v&&null==B)throw Error("Missing texture dimensions for mipmap calculation");
for(let A=0;;++A){h(A,q,y,B);if(!D||1===q&&1===y&&(!v||1===B)||A>=r)break;q=Math.max(1,q>>1);y=Math.max(1,y>>1);v&&(B=Math.max(1,B>>1))}};u._validateTexture=function(h,r){(null!=r.width&&0>r.width||null!=r.height&&0>r.height||null!=r.depth&&0>r.depth)&&console.error("Negative dimension parameters are not allowed!");h=h.type===m.ContextType.WEBGL2;const q=null!=r.width&&w.isPowerOfTwo(r.width)&&null!=r.height&&w.isPowerOfTwo(r.height);h||!r.isImmutable&&!d(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");
h||q||("number"===typeof r.wrapMode?r.wrapMode!==l.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(r.wrapMode.s!==l.TextureWrapMode.CLAMP_TO_EDGE||r.wrapMode.t!==l.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};u._applySamplingMode=function(h,r){let q=r.samplingMode,y=r.samplingMode;if(q===
l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||q===l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)q=l.TextureSamplingMode.LINEAR,r.hasMipmap||(y=l.TextureSamplingMode.LINEAR);else if(q===l.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||q===l.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)q=l.TextureSamplingMode.NEAREST,r.hasMipmap||(y=l.TextureSamplingMode.NEAREST);h.texParameteri(r.target,h.TEXTURE_MAG_FILTER,q);h.texParameteri(r.target,h.TEXTURE_MIN_FILTER,y)};u._applyWrapMode=function(h,r){"number"===typeof r.wrapMode?
(h.texParameteri(r.target,h.TEXTURE_WRAP_S,r.wrapMode),h.texParameteri(r.target,h.TEXTURE_WRAP_T,r.wrapMode)):(h.texParameteri(r.target,h.TEXTURE_WRAP_S,r.wrapMode.s),h.texParameteri(r.target,h.TEXTURE_WRAP_T,r.wrapMode.t))};u._applyAnisotropicFilteringParameters=function(h,r){const q=h.capabilities.textureFilterAnisotropic;q&&h.gl.texParameterf(r.target,q.TEXTURE_MAX_ANISOTROPY,r.maxAnisotropy??1)};b._createClass(u,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},
{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return u}();c.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){a.CloudsComposition=function(h){function r(y){var B=q.call(this,y);B._technique=new d.CloudsCompositionTechnique(y);B._vao=k.createQuadVAO(y.rctx);return B}b._inherits(r,h);var q=b._createSuper(r);h=r.prototype;h.destroy=function(){this._technique=n.releaseMaybe(this._technique);this._vao=n.disposeMaybe(this._vao)};h.render=function(y){var B=y.bindParameters.cloudsFade;n.isNone(this._vao)||n.isNone(B.data)||(this._technique.compiled?(B=y.rctx.bindTechnique(this._technique,
p,y.bindParameters),y.rctx.bindVAO(this._vao),B.assertCompatibleVertexAttributeLocations(this._vao),y.rctx.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4)):this.requestRender())};return b._createClass(r)}(w);c.__decorate([x.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([x.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([x.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);c.__decorate([x.property({constructOnly:!0})],
a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=c.__decorate([f.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const p=new e.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){x=function(e){function k(p){var h;return h=u.call(this,p,new m.ShaderTechniqueConfiguration,()=>h.destroy())}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new g.Program(p.rctx,k.shader.get().build(),l.Default3D)};e.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE),depthTest:{func:f.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWriteParams})};return c._createClass(k)}(x.ShaderTechnique);x.shader=new n.ReloadableShaderModule(w.CloudsCompositionShader,()=>new Promise((e,k)=>a(["./CloudsComposition.glsl"],e,k)));b.CloudsCompositionTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(){const y=new p.ShaderBuilder;y.attributes.add(h.VertexAttribute.POSITION,"vec2");y.varyings.add("worldRay","vec3");const {vertex:B,fragment:D}=y;B.uniforms.add([new u.Matrix4PassUniform("inverseProjectionMatrix",(z,v)=>v.camera.inverseProjectionMatrix),new u.Matrix4PassUniform("inverseViewMatrix",(z,v)=>b.invertOrIdentity(q,v.camera.viewMatrix))]);B.code.add(k.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);D.include(f.ColorConversion);D.include(d.RgbaFloatEncoding);y.include(w.EvaluateAmbientLighting,{pbrMode:m.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});y.include(l.PiUtils);y.include(n.Gamma);y.include(x.MainLighting);y.include(g.CloudsParallaxShading,{instancedDoublePrecision:!1});D.uniforms.add([new e.Float3PassUniform("cameraPosition",(z,v)=>v.camera.eye)]);D.code.add(k.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return y}const q=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=c;a.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,w,n,x,m,l,g){const f=c.create(),d=n.create();a.EvaluateAmbientLighting=function(e,k){e=e.fragment;const u=void 0!==k.lightingSphericalHarmonicsOrder?k.lightingSphericalHarmonicsOrder:2;0===u?(e.uniforms.add(new m.Float3PassUniform("lightingAmbientSH0",(p,h)=>b.set(f,h.lighting.sh.r[0],h.lighting.sh.g[0],h.lighting.sh.b[0]))),e.code.add(g.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===u?(e.uniforms.add([new l.Float4PassUniform("lightingAmbientSH_R",(p,h)=>w.set(d,h.lighting.sh.r[0],h.lighting.sh.r[1],h.lighting.sh.r[2],h.lighting.sh.r[3])),new l.Float4PassUniform("lightingAmbientSH_G",(p,h)=>w.set(d,h.lighting.sh.g[0],h.lighting.sh.g[1],h.lighting.sh.g[2],h.lighting.sh.g[3])),new l.Float4PassUniform("lightingAmbientSH_B",(p,h)=>w.set(d,h.lighting.sh.b[0],h.lighting.sh.b[1],h.lighting.sh.b[2],h.lighting.sh.b[3]))]),e.code.add(g.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===u&&(e.uniforms.add([new m.Float3PassUniform("lightingAmbientSH0",(p,h)=>b.set(f,h.lighting.sh.r[0],h.lighting.sh.g[0],h.lighting.sh.b[0])),new l.Float4PassUniform("lightingAmbientSH_R1",(p,h)=>w.set(d,h.lighting.sh.r[1],h.lighting.sh.r[2],h.lighting.sh.r[3],h.lighting.sh.r[4])),new l.Float4PassUniform("lightingAmbientSH_G1",(p,h)=>w.set(d,h.lighting.sh.g[1],h.lighting.sh.g[2],h.lighting.sh.g[3],h.lighting.sh.g[4])),new l.Float4PassUniform("lightingAmbientSH_B1",(p,h)=>w.set(d,h.lighting.sh.b[1],
h.lighting.sh.b[2],h.lighting.sh.b[3],h.lighting.sh.b[4])),new l.Float4PassUniform("lightingAmbientSH_R2",(p,h)=>w.set(d,h.lighting.sh.r[5],h.lighting.sh.r[6],h.lighting.sh.r[7],h.lighting.sh.r[8])),new l.Float4PassUniform("lightingAmbientSH_G2",(p,h)=>w.set(d,h.lighting.sh.g[5],h.lighting.sh.g[6],h.lighting.sh.g[7],h.lighting.sh.g[8])),new l.Float4PassUniform("lightingAmbientSH_B2",(p,h)=>w.set(d,h.lighting.sh.b[5],h.lighting.sh.b[6],h.lighting.sh.b[7],h.lighting.sh.b[8]))]),e.code.add(g.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),k.pbrMode!==x.PBRMode.Normal&&k.pbrMode!==x.PBRMode.Schematic||e.code.add(g.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){c=c.fromValues(0,.6,.2);a.PBRMode=void 0;(function(e){e[e.Disabled=0]="Disabled";e[e.Normal=1]="Normal";e[e.Schematic=2]="Schematic";e[e.Water=3]="Water";e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";e[e.Terrain=5]="Terrain";e[e.TerrainWithWater=6]="TerrainWithWater";e[e.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));d=function(e){function k(){return u.apply(this,arguments)}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(d.GLTextureMaterialBindParameters);
a.PBRBindParameters=d;a.PBRSchematicMRRValues=c;a.PhysicallyBasedRenderingParameters=function(e,k){const u=e.fragment,p=k.hasMetallicRoughnessTexture||k.hasEmissionTexture||k.hasOcclusionTexture;k.pbrMode===a.PBRMode.Normal&&p&&e.include(w.VertexTextureCoordinates,k);k.pbrMode===a.PBRMode.Schematic?u.code.add(m.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):k.pbrMode===a.PBRMode.Disabled?u.code.add(m.glsl`float getBakedOcclusion() { return 1.0; }`):k.pbrMode===a.PBRMode.Normal&&(u.code.add(m.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),e=k.pbrTextureBindType,k.hasMetallicRoughnessTexture&&(u.uniforms.add(e===f.BindType.Pass?new g.Texture2DPassUniform("texMetallicRoughness",h=>h.textureMetallicRoughness):new l.Texture2DDrawUniform("texMetallicRoughness",h=>h.textureMetallicRoughness)),u.code.add(m.glsl`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),k.hasEmissionTexture&&(u.uniforms.add(e===f.BindType.Pass?new g.Texture2DPassUniform("texEmission",h=>h.textureEmissive):new l.Texture2DDrawUniform("texEmission",h=>h.textureEmissive)),u.code.add(m.glsl`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),k.hasOcclusionTexture?(u.uniforms.add(e===f.BindType.Pass?new g.Texture2DPassUniform("texOcclusion",h=>h.textureOcclusion):new l.Texture2DDrawUniform("texOcclusion",h=>h.textureOcclusion)),u.code.add(m.glsl`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):u.code.add(m.glsl`float getBakedOcclusion() { return 1.0; }`),u.uniforms.add(e===f.BindType.Pass?[new x.Float3PassUniform("emissionFactor",h=>h.emissiveFactor),new x.Float3PassUniform("mrrFactors",h=>h.mrrFactors)]:[new n.Float3DrawUniform("emissionFactor",h=>h.emissiveFactor),new n.Float3DrawUniform("mrrFactors",h=>h.mrrFactors)]),u.code.add(m.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${k.hasMetallicRoughnessTexture?m.glsl`applyMetallnessAndRoughness(${k.hasMetallicRoughnessTextureTransform?m.glsl`metallicRoughnessUV`:"vuv0"});`:""}

      ${k.hasEmissionTexture?m.glsl`applyEmission(${k.hasEmissiveTextureTransform?m.glsl`emissiveUV`:"vuv0"});`:""}

      ${k.hasOcclusionTexture?m.glsl`applyOcclusion(${k.hasOcclusionTextureTransform?m.glsl`occlusionUV`:"vuv0"});`:""}
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,w,n){a.VertexTextureCoordinates=function(x,m){x.include(c.TextureCoordinateAttribute,m);switch(m.textureCoordinateType){case c.TextureCoordinateAttributeType.Default:case c.TextureCoordinateAttributeType.Compressed:x.fragment.code.add(n.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);break;case c.TextureCoordinateAttributeType.Atlas:x.include(w.TextureAtlasLookup);x.fragment.code.add(n.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);break;default:b.neverReached(m.textureCoordinateType);case c.TextureCoordinateAttributeType.None:case c.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.fragment.code.add(b.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"vec3",w.BindType.Draw,(f,d,e,k)=>f.setUniform3fv(l,g(d,e,k)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Float3DrawUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"sampler2D",w.BindType.Draw,(f,d,e)=>f.bindTexture(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Texture2DDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,c,w,n,x,m){m=function(g){function f(e){var k=d.call(this,e);k._numLoading=0;k._disposed=!1;k._textureRepository=e.textureRep;k._textureId=e.textureId;k._acquire(e.textureId,u=>k._texture=u);k._acquire(e.normalTextureId,
u=>k._textureNormal=u);k._acquire(e.emissiveTextureId,u=>k._textureEmissive=u);k._acquire(e.occlusionTextureId,u=>k._textureOcclusion=u);k._acquire(e.metallicRoughnessTextureId,u=>k._textureMetallicRoughness=u);return k}b._inherits(f,g);var d=b._createSuper(f);g=f.prototype;g.dispose=function(){this._texture=c.releaseMaybe(this._texture);this._textureNormal=c.releaseMaybe(this._textureNormal);this._textureEmissive=c.releaseMaybe(this._textureEmissive);this._textureOcclusion=c.releaseMaybe(this._textureOcclusion);
this._textureMetallicRoughness=c.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};g.ensureResources=function(e){return 0===this._numLoading?x.ResourceState.LOADED:x.ResourceState.LOADING};g.updateTexture=function(e){if(c.isNone(this._texture)||e!==this._texture.id)this._texture=c.releaseMaybe(this._texture),this._textureId=e,this._acquire(this._textureId,k=>this._texture=k)};g._acquire=function(e,k){c.isNone(e)?k(null):(e=this._textureRepository.acquire(e),w.isPromiseLike(e)?(++this._numLoading,
e.then(u=>{this._disposed?(c.releaseMaybe(u),k(null)):k(u)}).finally(()=>--this._numLoading)):k(e))};b._createClass(f,[{key:"textureBindParameters",get:function(){return new l(c.isSome(this._texture)?this._texture.glTexture:null,c.isSome(this._textureNormal)?this._textureNormal.glTexture:null,c.isSome(this._textureEmissive)?this._textureEmissive.glTexture:null,c.isSome(this._textureOcclusion)?this._textureOcclusion.glTexture:null,c.isSome(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:
null)}}]);return f}(m);let l=function(g){function f(e=null,k=null,u=null,p=null,h=null){var r=d.call(this);r.texture=e;r.textureNormal=k;r.textureEmissive=u;r.textureOcclusion=p;r.textureMetallicRoughness=h;return r}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(n.NoParameters);a.GLTextureMaterial=m;a.GLTextureMaterialBindParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./basicInterfaces"],function(a,b){return function(){function c(n){this._material=n.material;this._techniqueRepository=n.techniqueRep;this._output=n.output}var w=c.prototype;w.dispose=function(){this._techniqueRepository.release(this._technique)};w.ensureTechnique=function(n,x){return this._technique=this._techniqueRepository.releaseAndAcquire(n,this._material.getConfiguration(this._output,x),this._technique)};w.ensureResources=function(n){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",
get:function(){return this._technique}},{key:"_stippleTextureRepository",get:function(){return this._techniqueRepository.constructionContext.stippleTextureRepository}}]);return c}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsCompositionParameters ../../../../environment/CloudsData ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){a.CloudsParallaxShading=function(u){u=u.fragment;u.uniforms.add([new e.Matrix4PassUniform("rotationMatrixClouds",(p,h)=>h.cloudsFade.parallax.transform),new e.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(p,h)=>h.cloudsFade.parallaxNew.transform),new g.Float3PassUniform("anchorPosition",(p,h)=>h.cloudsFade.parallax.anchorPointClouds),new g.Float3PassUniform("anchorPositionCrossFade",(p,h)=>h.cloudsFade.parallaxNew.anchorPointClouds),new f.FloatPassUniform("cloudsHeight",
(p,h)=>h.cloudsFade.parallax.cloudsHeight),new f.FloatPassUniform("radiusCurvatureCorrectionFactor",(p,h)=>h.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new f.FloatPassUniform("totalFadeInOut",(p,h)=>h.cloudsFade.fadeInOut.stage===n.FadeInOutStages.FINISHED?h.cloudsFade.fadeInOutHeight.factor+1-h.cloudsFade.fadeIn.factor:h.cloudsFade.fadeInOutHeight.factor+1-h.cloudsFade.fadeInOut.factor),new f.FloatPassUniform("crossFadeAnchorFactor",(p,h)=>b.clamp(h.cloudsFade.crossFade.factor,0,1)),new k.TextureCubePassUniform("cubeMap",
(p,h)=>c.isSome(h.cloudsFade.data)&&c.isSome(h.cloudsFade.data.cubeMap)?h.cloudsFade.data.cubeMap.colorTexture:null),new l.BooleanPassUniform("crossFade",(p,h)=>h.cloudsFade.crossFade.enabled),new l.BooleanPassUniform("readChannelsRG",(p,h)=>h.cloudsFade.readChannels===x.CloudsTextureChannels.RG),new l.BooleanPassUniform("fadeTextureChannels",(p,h)=>h.cloudsFade.renderingStage===x.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)]);u.constants.add("planetRadius","float",w.earth.radius);u.code.add(d.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);u.code.add(d.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);u.code.add(d.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);m.addMainLightDirection(u);m.addMainLightIntensity(u);u.code.add(d.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);u.code.add(d.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);u.code.add(d.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);u.code.add(d.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);u.code.add(d.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionParameters":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat4f64","../../../chunks/vec3f64","./CloudsData"],function(a,b,c,w,n){let x=function(){function l(){this.readChannels=n.CloudsTextureChannels.RG;this.renderingStage=n.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=w.create();this.isCameraPositionFinal=
!0;this.parallax=new m;this.parallaxNew=new m;this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3};this.fadeInOut={stage:a.FadeInOutStages.FINISHED,factor:1,distanceThresholdFactor:.6};this.fadeIn={stage:a.FadeInStages.FINISHED,factor:1,distanceThresholdFactor:2};this.fadeInOutHeight={stage:a.FadeHeightStages.FINISHED,factor:-1}}b._createClass(l,[{key:"isFading",get:function(){return this.fadeInOut.stage===a.FadeInOutStages.FADE_OUT||this.fadeInOut.stage===a.FadeInOutStages.FADE_IN||this.fadeIn.stage===
a.FadeInStages.FADE_IN||this.fadeInOutHeight.stage!==a.FadeHeightStages.FINISHED||this.renderingStage===n.CloudsRenderingStages.FADING_TEXTURE_CHANNELS}}]);return l}();a.FadeInStages=void 0;(function(l){l[l.FINISHED=0]="FINISHED";l[l.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";l[l.FADE_IN=2]="FADE_IN"})(a.FadeInStages||(a.FadeInStages={}));a.FadeInOutStages=void 0;(function(l){l[l.FINISHED=0]="FINISHED";l[l.FADE_OUT=1]="FADE_OUT";l[l.SWITCH=2]="SWITCH";l[l.FADE_IN=3]="FADE_IN"})(a.FadeInOutStages||(a.FadeInOutStages=
{}));a.FadeHeightStages=void 0;(function(l){l[l.FINISHED=0]="FINISHED";l[l.HEIGHT_FADE=1]="HEIGHT_FADE"})(a.FadeHeightStages||(a.FadeHeightStages={}));let m=b._createClass(function(){this.anchorPointClouds=w.create();this.cloudsHeight=1E5;this.radiusCurvatureCorrectionFactor=0;this.transform=c.create()});a.CloudsFadeParameters=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports","../../../core/maybe"],function(a,b){a.CloudsRenderingStages=
void 0;(function(c){c[c.RENDERING=0]="RENDERING";c[c.FINISHED_RENDERING=1]="FINISHED_RENDERING";c[c.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS";c[c.SWITCH_CHANNELS=3]="SWITCH_CHANNELS";c[c.FINISHED=4]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(c){c[c.RG=0]="RG";c[c.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(c){return b.isSome(c)&&!c.running};a.isReadyCloudsData=function(c){return b.isSome(c)&&
b.isSome(c.cubeMap)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"bool",w.BindType.Pass,(f,d,e)=>f.setUniform1b(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.BooleanPassUniform=c;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"samplerCube",w.BindType.Pass,(f,d,e)=>f.bindTexture(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.TextureCubePassUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I){a.CloudsGenerator=function(J){function M(P){P=G.call(this,P);P._handles=new n;P._techniques=[];P._techniqueConfiguration=new t.CloudsTechniqueConfiguration;P._bindParameters=new E.BindParameters(null,null,null);P._passParameters=new D.CloudsPassParameters;P._drawParameters=new D.CloudsDrawParameters;P._weatherTile=q.create();P._weatherTileCount=128;P._faceIndex=0;P._tileIndex=0;P.coverage=x.lerp(v.cloudPresets.default.coverage[0],
v.cloudPresets.default.coverage[1],.5);P.density=x.lerp(v.cloudPresets.default.density[0],v.cloudPresets.default.density[1],.5);P.absorption=x.lerp(v.cloudPresets.default.absorption[0],v.cloudPresets.default.absorption[1],.5);P.cloudSize=x.lerp(v.cloudPresets.default.cloudSize[0],v.cloudPresets.default.cloudSize[1],.5);P.detailSize=x.lerp(v.cloudPresets.default.detailSize[0],v.cloudPresets.default.detailSize[1],.5);P.smoothness=x.lerp(v.cloudPresets.default.smoothness[0],v.cloudPresets.default.smoothness[1],
.5);P.cloudHeight=x.lerp(v.cloudPresets.default.cloudHeight[0],v.cloudPresets.default.cloudHeight[1],.5);P.raymarchingSteps=v.cloudPresets.default.raymarchingSteps;P._viewMatrix=h.create();P._dirty=!1;P.running=!1;return P}b._inherits(M,J);var G=b._createSuper(M);J=M.prototype;J._getTechnique=function(P){const U=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,N=U===z.CloudsTextureChannels.RG?2*P:2*P+1,S=this._techniques[N];if(S)return S;this._techniqueConfiguration.writeTextureChannels=
U;this._techniqueConfiguration.steps=P;this._techniques[N]=new A.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[N]};J.updateWeatherTile=function(){var P=this.view.camera.position.latitude,U=this.view.camera.position.longitude;null!=P&&null!=U&&(r.set(this._weatherTile,(P+90)/180,(U+180)/360),P=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*
this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-P)*this._weatherTile[1]),U=P=0,m.isSome(this.view.environment)&&"virtual"!==this.view.environment.lighting.type&&m.isSome(this.view.environment.lighting.date)&&(U=new Date(this.view.environment.lighting.date),U.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),P=31*U.getUTCMonth()+U.getUTCDate(),U=U.getUTCFullYear()),this._weatherTile[0]=
(this._weatherTile[0]+P)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+U%100)%(4*this._weatherTileCount),r.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())};J.initialize=function(){this._vao=F.createQuadVAO(this.context.renderContext.rctx);const P=B.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*P.radius;this.setDirty();this.updateWeatherTile();this._handles.add([this.view.resourceController.scheduler.registerTask(H.TaskPriority.CLOUDS_GENERATOR,
this),l.watch(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),l.initial)])};J.destroy=function(){this._handles.destroy();this._techniques.forEach(P=>m.releaseMaybe(P));this._frameBufferCube=m.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao=m.disposeMaybe(this._vao);this._passParameters.noiseTexture=m.destroyMaybe(this._passParameters.noiseTexture)};J._ensureNoiseTexture=
function(){m.isSome(this._passParameters.noiseTexture)||(this._passParameters.noiseTexture=new C.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return m.isSome(this._passParameters.noiseTexture.textureAtlas)};J._ensureFrameBufferCube=function(P){m.isNone(this._frameBufferCube)&&(this._frameBufferCube=new I.FramebufferObject(this.context.renderContext.rctx,{colorTarget:K.TargetType.CUBEMAP,width:P,height:P},{target:K.TextureType.TEXTURE_CUBE_MAP,
pixelFormat:K.PixelFormat.RGBA,dataType:K.PixelType.UNSIGNED_BYTE,wrapMode:K.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:K.TextureSamplingMode.LINEAR,hasMipmap:!1,width:P,height:P}));return this._frameBufferCube};J.destroyFrameBufferCube=function(){this._frameBufferCube=m.disposeMaybe(this._frameBufferCube)};J.applyPreset=function(P,U){const N=P.median,S=Q=>{const W=x.lerp(Q[0],Q[1],N);return.5>U?x.lerp(Q[0],W,2*U):x.lerp(W,Q[1],2*(U-.5))};this.coverage=S(P.coverage);this.density=S(P.density);this.absorption=
S(P.absorption);this.cloudSize=S(P.cloudSize);this.detailSize=S(P.detailSize);this.smoothness=S(P.smoothness);this.cloudHeight=S(P.cloudHeight);this.raymarchingSteps=P.raymarchingSteps};J.setDirty=function(){this._dirty=this.running=!0};J.runTask=function(P){if(m.isNone(this._vao))this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=z.CloudsRenderingStages.FINISHED_RENDERING,P.madeProgress();else{0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=
this.raymarchingSteps,this.updateWeatherTile(),r.copy(this._passParameters.weatherTile,this._weatherTile));var U=this._getTechnique(this._passParameters.raymarchingSteps);if(!U.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return H.Task.YIELD;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=z.CloudsRenderingStages.RENDERING,
this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);var N=this.context.renderContext.rctx,S=N.bindTechnique(U,this._passParameters,this._bindParameters);N.bindVAO(this._vao);S.assertCompatibleVertexAttributeLocations(this._vao);
var Q=N.getViewport();U=U.configuration.cubeMapSize;var W=U/this._tilesPerFace;N.setViewport(0,this._tileIndex*W,U,W);U=this._ensureFrameBufferCube(U);N.bindFramebuffer(U);p.targetTo(this._viewMatrix,O,L[this._faceIndex],R[this._faceIndex]);u.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix);U.setColorTextureTarget(K.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex);S.bindDraw(this._drawParameters,this._bindParameters,this._passParameters);N.gl.drawArrays(N.gl.TRIANGLE_STRIP,0,4);
N.gl.flush();N.setViewport(Q.x,Q.y,Q.width,Q.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=z.CloudsRenderingStages.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);P.madeProgress();return H.Task.YIELD}};b._createClass(M,[{key:"_tilesPerFace",get:function(){switch(this._techniqueConfiguration.steps){case t.RayMarchingSteps.SIXTEEN:return 1;
case t.RayMarchingSteps.HUNDRED:return 4;case t.RayMarchingSteps.COUNT:case t.RayMarchingSteps.TWOHUNDRED:return 8}}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return M}(w);c.__decorate([g.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);c.__decorate([g.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);c.__decorate([g.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([g.property()],
a.CloudsGenerator.prototype,"coverage",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"density",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"detailSize",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"smoothness",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);
c.__decorate([g.property()],a.CloudsGenerator.prototype,"raymarchingSteps",void 0);c.__decorate([g.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=c.__decorate([k.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const L=[y.fromValues(1,0,0),y.fromValues(-1,0,0),y.fromValues(0,1,0),y.fromValues(0,-1,0),y.fromValues(0,0,1)],R=[y.fromValues(0,1,0),y.fromValues(0,1,0),y.fromValues(0,0,-1),y.fromValues(0,0,1),y.fromValues(0,1,0)],O=y.zeros();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Clouds.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ../core/maybe ./mat3f64 ./vec2 ./vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){function q(v){const A=new h.ShaderBuilder;A.include(d.ScreenSpacePass,!1);const t=A.fragment;t.uniforms.add([new k.FloatPassUniform("cloudRadius",C=>C.cloudRadius),new k.FloatPassUniform("power",C=>c.lerp(35,120,C.absorption)),new k.FloatPassUniform("sigmaE",C=>1+C.absorption),new k.FloatPassUniform("density",C=>c.lerp(0,.3,C.density)),new k.FloatPassUniform("cloudSize",C=>c.lerp(0,.02,Math.max(.01,1-C.cloudSize))),new k.FloatPassUniform("detailSize",C=>
c.lerp(0,.2,Math.max(.01,1-C.detailSize))),new k.FloatPassUniform("smoothness",C=>c.lerp(0,.5,1-C.smoothness)),new k.FloatPassUniform("cloudHeight",C=>c.lerp(0,1500,C.cloudHeight)),new k.FloatPassUniform("coverage",C=>C.coverage),new p.Matrix3DrawUniform("view",C=>C.viewMatrix),new r.Texture2DPassUniform("cloudShapeTexture",C=>w.isSome(C.noiseTexture)?C.noiseTexture.textureAtlas:null),new e.Float2PassUniform("cloudVariables",C=>x.set(D,C.coverage,C.absorption))]);t.constants.add("halfCubeMapSize",
"float",.5*v.cubeMapSize);t.code.add(u.glsl`
    const int STEPS = ${v.steps===g.RayMarchingSteps.SIXTEEN?u.glsl`16`:v.steps===g.RayMarchingSteps.HUNDRED?u.glsl`100`:u.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);t.code.add(u.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${u.glsl.float(f.ATLAS_SIZE)};
      const float dataWidth = ${u.glsl.float(f.ATLAS_SIZE)};
      const float tileRows = ${u.glsl.float(f.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${u.glsl.float(f.TILE_SIZE)}, ${u.glsl.float(f.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${u.glsl.float(f.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${u.glsl.float(f.WEATHER_MAP_SCALE)} * p) / ${u.glsl.float(f.ATLAS_SIZE)} + 0.5);

      return texture(cloudShapeTexture, uv).a;
    }
    `);t.code.add(u.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);t.code.add(u.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);t.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
t.code.add(u.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);t.code.add(u.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);t.code.add(u.glsl`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return A}let y=function(v){function A(){var C=t.apply(this,arguments);C.cloudRadius=0;C.cloudSize=0;C.detailSize=0;C.absorption=0;C.density=0;C.smoothness=0;C.cloudHeight=0;C.coverage=0;C.raymarchingSteps=l.cloudPresets.default.raymarchingSteps;C.weatherTile=m.create();return C}b._inherits(A,v);var t=b._createSuper(A);return b._createClass(A)}(u.NoParameters),B=function(v){function A(){var C=t.apply(this,arguments);C.viewMatrix=n.create();return C}b._inherits(A,v);var t=b._createSuper(A);return b._createClass(A)}(u.NoParameters);
const D=m.create(),z=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:B,CloudsPassParameters:y,build:q},Symbol.toStringTag,{value:"Module"}));a.Clouds=z;a.CloudsDrawParameters=B;a.CloudsPassParameters=y;a.build=q})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./CloudsTechniqueConfiguration"],function(a,b,c){b=b._createClass(function(n,x,m,l,g,f,d,e,k=.5){this.coverage=n;this.density=x;this.absorption=m;
this.cloudSize=l;this.detailSize=g;this.smoothness=f;this.cloudHeight=d;this.raymarchingSteps=e;this.median=k});const w=new b([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],c.RayMarchingSteps.SIXTEEN);c={sunny:w,cloudy:new b([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],c.RayMarchingSteps.TWOHUNDRED,.6),rainy:new b([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],c.RayMarchingSteps.TWOHUNDRED,.4),snowy:new b([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],c.RayMarchingSteps.HUNDRED,
.65),foggy:new b([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],c.RayMarchingSteps.SIXTEEN),default:w};a.CloudPresets=b;a.cloudPresets=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ./CloudsData ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),function(a,b,c,w,n,x){a.RayMarchingSteps=
void 0;(function(l){l[l.SIXTEEN=0]="SIXTEEN";l[l.HUNDRED=1]="HUNDRED";l[l.TWOHUNDRED=2]="TWOHUNDRED";l[l.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));let m=function(l){function g(){var d=f.apply(this,arguments);d.steps=a.RayMarchingSteps.SIXTEEN;d.writeTextureChannels=n.CloudsTextureChannels.RG;return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(x.ShaderTechniqueConfiguration);c.__decorate([x.parameter({count:a.RayMarchingSteps.COUNT})],m.prototype,"steps",
void 0);c.__decorate([x.parameter({constValue:w("esri-mobile")?1024:2048})],m.prototype,"cubeMapSize",void 0);c.__decorate([x.parameter()],m.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const c=Math.ceil(Math.sqrt(b)),w=(b+2)*c;a.ATLAS_SIZE=w;a.TEXTURE_SCALE=b/128;
a.TILE_ROWS=c;a.TILE_SIZE=b;a.WEATHER_MAP_SCALE=w/1560;a.WEATHER_MAP_SIZE=1E5;a.WEATHER_TILE_SIZE=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(w,n=!0){w.attributes.add(c.VertexAttribute.POSITION,"vec2");n&&w.varyings.add("uv","vec2");w.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${n?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"mat3",w.BindType.Draw,(f,d,e)=>f.setUniformMatrix3fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Matrix3DrawUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){m=function(e){function k(p,
h){var r;return r=u.call(this,p,h,()=>r.destroy())}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new g.Program(p.rctx,k.shader.get().build(this.configuration),l.Default3D)};e.initializePipeline=function(){return d.makePipelineState({blending:d.simpleBlendingParams(f.BlendFactor.CONSTANT_COLOR,f.BlendFactor.ONE_MINUS_CONSTANT_COLOR,f.BlendOperation.ADD,this.configuration.writeTextureChannels===n.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:f.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWriteParams})};return c._createClass(k)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(w.Clouds,()=>new Promise((e,k)=>a(["./Clouds.glsl"],e,k)));b.CloudsTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){a.NoiseTextureAtlas=function(y){function B(z){var v=D.call(this,z);v._needsRender=!0;v._passParameters=new e.NoiseTextureAtlasPassParameters;v._frameBuffer=new q.FramebufferObject(z.context.renderContext.rctx,{colorTarget:r.TargetType.TEXTURE,width:u.ATLAS_SIZE,height:u.ATLAS_SIZE},{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:r.TextureSamplingMode.LINEAR,
hasMipmap:!1,width:u.ATLAS_SIZE,height:u.ATLAS_SIZE});v._vao=h.createQuadVAO(z.context.renderContext.rctx);return v}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y._setDirty=function(){this._needsRender=!0};y.updateWeatherMap=function(z){if(this._passParameters.weatherTile[0]!==z[0]||this._passParameters.weatherTile[1]!==z[1])d.copy(this._passParameters.weatherTile,z),this._setDirty()};y.destroy=function(){this._fullTechniqueCached=n.releaseMaybe(this._fullTechniqueCached);this._weatherMapTechniqueCached=
n.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=n.disposeMaybe(this._frameBuffer);this._vao=n.disposeMaybe(this._vao)};y._render=function(z){if(n.isNone(this._vao)||n.isNone(this._frameBuffer))return null;var v=z===k.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;z=this.context.renderContext.rctx;const A=z.getViewport();z.setViewport(0,0,u.ATLAS_SIZE,u.ATLAS_SIZE);z.bindFramebuffer(this._frameBuffer);v=z.bindTechnique(v,this._passParameters,null);z.bindVAO(this._vao);
v.assertCompatibleVertexAttributeLocations(this._vao);z.gl.drawArrays(z.gl.TRIANGLE_STRIP,0,4);z.setViewport(A.x,A.y,A.width,A.height);this._needsRender=!1;return this._frameBuffer.colorTexture};b._createClass(B,[{key:"_techniqueRepository",get:function(){return this.context.techniqueRepository}},{key:"textureAtlas",get:function(){n.isSome(this._texture)?n.isSome(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(k.NoiseTextureRenderMode.WeatherMap)):
n.isSome(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(k.NoiseTextureRenderMode.Full));return this._texture}},{key:"_fullTechnique",get:function(){if(n.isNone(this._fullTechniqueCached)){const z=new k.NoiseTextureAtlasTechniqueConfiguration;z.mode=k.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(p.NoiseTextureAtlasTechnique,z)}return this._fullTechniqueCached}},{key:"_weatherMapTechnique",get:function(){if(n.isNone(this._weatherMapTechniqueCached)){const z=
new k.NoiseTextureAtlasTechniqueConfiguration;z.mode=k.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(p.NoiseTextureAtlasTechnique,z)}return this._weatherMapTechniqueCached}}]);return B}(w);c.__decorate([x.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);c.__decorate([x.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=c.__decorate([f.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(k){const u=new g.ShaderBuilder;u.include(x.ScreenSpacePass,!1);u.fragment.code.add(l.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);k.mode===w.NoiseTextureRenderMode.Full&&u.fragment.code.add(l.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${l.glsl.float(n.TILE_ROWS)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${l.glsl.float(8)});

      float worley0 = worley(p, ${l.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${l.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${l.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${l.glsl.float(2)});
      float worley1 = worley(p, ${l.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${l.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${l.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);u.fragment.uniforms.add(new m.Float2PassUniform("weatherTile",p=>p.weatherTile));u.fragment.code.add(l.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${l.glsl.float(n.WEATHER_TILE_SIZE)});

      // Get global coordinates of p
      p += weatherTile * ${l.glsl.float(n.WEATHER_TILE_SIZE)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${l.glsl.float(n.WEATHER_MAP_SIZE)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);u.fragment.code.add(l.glsl`void main() {`);k.mode===w.NoiseTextureRenderMode.Full&&u.fragment.code.add(l.glsl`
        float padWidth = 1.0;
        float paddedSize = ${l.glsl.float(n.TILE_SIZE)} + 2.0 * padWidth;
        float tileCount = ${l.glsl.float(n.TILE_ROWS)} * ${l.glsl.float(n.TILE_ROWS)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${l.glsl.float(n.TILE_SIZE)};
          }

          if (startPadY) {
            pixel.y += ${l.glsl.float(n.TILE_SIZE)};
          }

          if (endPadX) {
            pixel.x -= ${l.glsl.float(n.TILE_SIZE)};
          }

          if (endPadY) {
            pixel.y -= ${l.glsl.float(n.TILE_SIZE)};
          }

          uv = vec2(pixel.xy / ${l.glsl.float(n.TILE_SIZE)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${l.glsl.float(n.TILE_SIZE)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${l.glsl.float(n.TILE_ROWS)} * ${l.glsl.float(n.TILE_ROWS)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${l.glsl.float(n.TILE_ROWS)} * ${l.glsl.float(n.TILE_ROWS)});
        p = p_;
        p.z /= (${l.glsl.float(n.TILE_ROWS)} * ${l.glsl.float(n.TILE_ROWS)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);u.fragment.code.add(l.glsl`
      vec2 mapUV = ${l.glsl.float(n.WEATHER_TILE_SIZE)} * (gl_FragCoord.xy / ${l.glsl.float(n.ATLAS_SIZE)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${k.mode===w.NoiseTextureRenderMode.Full?l.glsl`fragColor.ba = vec2(0.0, map);`:l.glsl`fragColor = vec4(map);`};
    }
  `);return u}let d=function(k){function u(){var h=p.apply(this,arguments);h.weatherTile=c.fromValues(0,0);return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(l.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:d,build:f},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=e;a.NoiseTextureAtlasPassParameters=d;a.build=f})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){a.NoiseTextureRenderMode=void 0;(function(x){x[x.Full=0]="Full";x[x.WeatherMap=1]="WeatherMap";x[x.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));let n=function(x){function m(){var g=l.apply(this,arguments);g.mode=a.NoiseTextureRenderMode.Full;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter({count:a.NoiseTextureRenderMode.COUNT})],
n.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){m=function(e){function k(){return u.apply(this,arguments)}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new g.Program(p.rctx,k.shader.get().build(this.configuration),l.Default3D)};e.initializePipeline=function(){return d.makePipelineState({blending:this.configuration.mode===n.NoiseTextureRenderMode.Full?d.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO):d.separateBlendingParams(f.BlendFactor.ZERO,f.BlendFactor.ONE,
f.BlendFactor.ONE,f.BlendFactor.ZERO),depthTest:{func:f.CompareFunction.ALWAYS},colorWrite:d.defaultColorWriteParams})};return c._createClass(k)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(w.NoiseTextureAtlas,()=>new Promise((e,k)=>a(["./NoiseTextureAtlas.glsl"],e,k)));b.NoiseTextureAtlasTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){function e(y){return null!=y&&"type"in y&&"texture"===y.type}function k(y){return null!=y&&"type"in y&&"renderbuffer"===y.type}function u(y){return e(y)||null!=y&&"pixelFormat"in y}function p(y,B){y.target!==l.TextureType.TEXTURE_2D&&y.target!==l.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==B.width&&0<=B.width&&void 0!==B.height&&0<=B.height?B.width===y.width&&B.height===y.height||console.error("Color attachment texture must match the framebuffer's!"):
(B.width=y.width,B.height=y.height)}function h(y,B){void 0!==B.width&&0<=B.width&&void 0!==B.height&&0<=B.height?B.width===y.width&&B.height===y.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(B.width=y.width,B.height=y.height)}function r(y){return y.descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?l.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:l.TextureType.TEXTURE_2D}let q=function(){function y(D,z,v=null,A=null){this._context=D;this._stencilAttachment=this._depthAttachment=
this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=null;this._initialized=!1;this._desc={...z};D.instanceCounter.increment(l.ResourceType.FramebufferObject,this);if(w.isSome(v))for(Array.isArray(v)||(v=[v]),D=0;D<v.length;++D){z=v[D];const t=l.ColorAttachment.COLOR_ATTACHMENT0+D;let C;u(z)?(e(z)?(C=z.descriptor,this._colorAttachments.set(t,z)):(C=z,this._colorAttachments.set(t,new f.Texture(this._context,C))),p(C,this._desc)):(k(z)?(C=z.descriptor,this._colorAttachments.set(t,
z)):(C=z,this._colorAttachments.set(t,new g.Renderbuffer(this._context,C))),h(C,this._desc));this._validateColorAttachmentPoint(t)}w.isSome(A)&&(u(A)?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),e(A)?(v=A.descriptor,this._depthStencilTexture=A):(v=A,this._depthStencilTexture=new f.Texture(this._context,v)),p(v,this._desc)):(k(A)?v=A.descriptor:(v=A,A=new g.Renderbuffer(this._context,v)),D=this._desc.depthStencilTarget??
l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,D===l.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=A:D===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER||D===l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=A:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=D,h(v,this._desc)))}var B=y.prototype;B.dispose=function(){if(this._desc){var D=
this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(D);this._context.instanceCounter.decrement(l.ResourceType.FramebufferObject,this);this._desc=null}};B.getColorTexture=function(D){return(D=this._colorAttachments.get(D))&&e(D)?D:null};B.attachColorTexture=function(D,z=l.ColorAttachment.COLOR_ATTACHMENT0){D&&(this._validateColorAttachmentPoint(z),
p(D.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(D.glName,z)),this._colorAttachments.set(z,D))};B.detachColorTexture=function(D=l.ColorAttachment.COLOR_ATTACHMENT0){const z=this._colorAttachments.get(D);if(e(z))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,D)),this._colorAttachments.delete(D),z};B.setColorTextureTarget=function(D,z=l.ColorAttachment.COLOR_ATTACHMENT0){const v=
this._colorAttachments.get(z);e(v)&&this._framebufferTexture2D(v.glName,z,D)};B.attachDepthStencilTexture=function(D){if(!w.isNone(D)){var z=D.descriptor;z.pixelFormat!==l.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");z.dataType!==l.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
p(z,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(D.glName,l.DepthStencilAttachment));this._depthStencilTexture=D}};B.detachDepthStencilTexture=function(){const D=this._depthStencilTexture;D&&this._initialized&&(this._context.bindFramebuffer(this),
this._framebufferTexture2D(null,l.DepthStencilAttachment));this._depthStencilTexture=null;return D};B.attachDepthStencilBuffer=function(D){if(!w.isNone(D)){var z=D.descriptor;z.internalFormat!==l.RenderbufferFormat.DEPTH_STENCIL&&z.internalFormat!==l.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");h(z,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=z.internalFormat===l.RenderbufferFormat.DEPTH_STENCIL?l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:
l.DepthStencilTargetType.DEPTH_RENDER_BUFFER;this._initialized&&(this._context.bindFramebuffer(this),z=this._context.gl,z.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?z.DEPTH_ATTACHMENT:z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,D.glName));this._depthAttachment=D}};B.detachDepthStencilBuffer=function(){const D=this._context.gl,z=this._depthAttachment;z&&this._initialized&&(this._context.bindFramebuffer(this),D.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,
this._desc.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?D.DEPTH_ATTACHMENT:D.DEPTH_STENCIL_ATTACHMENT,D.RENDERBUFFER,null));this._depthAttachment=null;return z};B.detachAll=function(){this._colorAttachments.forEach((D,z)=>this._detachColorAttachment(z));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};B.copyToTexture=function(D,z,v,A,t,C,E){(0>D||0>z||0>t||0>C)&&console.error("Offsets cannot be negative!");(0>=v||0>=A)&&console.error("Copy width and height must be greater than zero!");
var F=this._desc;const H=E.descriptor;E.descriptor.target!==l.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==F?.width||null==F?.height||null==H?.width||null==H?.height||D+v>F.width||z+A>F.height||t+v>H.width||C+A>H.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");F=this._context;E=F.bindTexture(E,f.Texture.TEXTURE_UNIT_FOR_UPDATES);F.setActiveTexture(f.Texture.TEXTURE_UNIT_FOR_UPDATES);F.bindFramebuffer(this);
F.gl.copyTexSubImage2D(l.TextureType.TEXTURE_2D,0,t,C,D,z,v,A);F.bindTexture(E,f.Texture.TEXTURE_UNIT_FOR_UPDATES)};B.readPixels=function(D,z,v,A,t,C,E){(0>=v||0>=A)&&console.error("Copy width and height must be greater than zero!");E||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(D,z,v,A,t,C,E)};B.readPixelsAsync=async function(D,z,v,A,t,C,E){if(this._context.type!==m.ContextType.WEBGL2)x.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),
this.readPixels(D,z,v,A,t,C,E);else{var F=this._context.gl,H=n.BufferObject.createPixelPack(this._context,l.Usage.STREAM_READ,E.byteLength);this._context.bindBuffer(H);this._context.bindFramebuffer(this);F.readPixels(D,z,v,A,t,C,0);this._context.unbindBuffer(l.BufferType.PIXEL_PACK_BUFFER);await H.getSubDataAsync(E);H.dispose()}};B.resize=function(D,z){const v=this._desc;if(v.width!==D||v.height!==z)if(v.width=D,v.height=z,this._initialized){this._colorAttachments.forEach(A=>{A&&A.resize(D,z)});if(null!=
this._depthStencilTexture)this._depthStencilTexture.resize(D,z);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(D,z),this._stencilAttachment&&this._stencilAttachment.resize(D,z);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else this._colorAttachments.forEach(A=>{A&&A.resize(D,z)}),this._depthStencilTexture&&this._depthStencilTexture.resize(D,z)};B.initializeAndBind=function(D=l.FramebufferTarget.FRAMEBUFFER){const z=
this._context.gl;if(this._initialized)z.bindFramebuffer(D,this.glName);else{this._glName&&z.deleteFramebuffer(this._glName);var v=this._context,A=z.createFramebuffer(),t=this._desc,C=t.colorTarget??l.TargetType.RENDER_BUFFER,E=t.width??1,F=t.height??1;z.bindFramebuffer(D,A);0===this._colorAttachments.size&&(C===l.TargetType.TEXTURE||C===l.TargetType.CUBEMAP?this._colorAttachments.set(l.ColorAttachment.COLOR_ATTACHMENT0,new f.Texture(v,{target:this.descriptor.colorTarget===l.TargetType.CUBEMAP?l.TextureType.TEXTURE_CUBE_MAP:
l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:t.width,height:t.height})):(C=new g.Renderbuffer(v,{internalFormat:l.SizedPixelFormat.RGBA4,width:E,height:F}),this._colorAttachments.set(l.ColorAttachment.COLOR_ATTACHMENT0,C)));this._colorAttachments.forEach((H,K)=>{H&&(e(H)?this._framebufferTexture2D(H.glName,K,r(H),D):z.framebufferRenderbuffer(D,K,z.RENDERBUFFER,H.glName))});
C=t.depthStencilTarget??l.DepthStencilTargetType.NONE;switch(C){case l.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new g.Renderbuffer(v,{internalFormat:t.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?l.RenderbufferFormat.DEPTH_COMPONENT16:l.RenderbufferFormat.DEPTH_STENCIL,width:E,height:F}));z.framebufferRenderbuffer(D,C===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?z.DEPTH_ATTACHMENT:
z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,this._depthAttachment.glName);break;case l.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new g.Renderbuffer(v,{internalFormat:l.RenderbufferFormat.STENCIL_INDEX8,width:E,height:F}));z.framebufferRenderbuffer(D,z.STENCIL_ATTACHMENT,z.RENDERBUFFER,this._stencilAttachment.glName);break;case l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(v.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
this._depthStencilTexture=new f.Texture(v,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.DEPTH_STENCIL,dataType:l.PixelType.UNSIGNED_INT_24_8,samplingMode:l.TextureSamplingMode.NEAREST,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:E,height:F})),this._framebufferTexture2D(this._depthStencilTexture.glName,z.DEPTH_STENCIL_ATTACHMENT,r(this._depthStencilTexture),D)}x.webglDebugEnabled()&&z.checkFramebufferStatus(D)!==z.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=
A;this._initialized=!0}};B._framebufferTexture2D=function(D,z=l.ColorAttachment.COLOR_ATTACHMENT0,v=l.TextureType.TEXTURE_2D,A=l.FramebufferTarget.FRAMEBUFFER,t=0){this._context.gl.framebufferTexture2D(A,z,v,D,t)};B._detachColorAttachment=function(D){x.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const z=this._context.gl,v=this._colorAttachments.get(D);e(v)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,
D)):this._initialized&&(this._context.bindFramebuffer(this),z.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,D,z.RENDERBUFFER,null));this._colorAttachments.delete(D);return v};B._disposeColorAttachments=function(){this._colorAttachments.forEach((D,z)=>{this._detachColorAttachment(z);D.dispose()});this._colorAttachments.clear()};B._disposeDepthStencilAttachments=function(){const D=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),D.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,
this._desc.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?D.DEPTH_ATTACHMENT:D.DEPTH_STENCIL_ATTACHMENT,D.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),D.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,D.STENCIL_ATTACHMENT,D.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),
this._framebufferTexture2D(null,D.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};B._validateColorAttachmentPoint=function(D){if(-1===y._MAX_COLOR_ATTACHMENTS){const z=this._context.capabilities.drawBuffers;y._MAX_COLOR_ATTACHMENTS=z?this._context.gl.getParameter(z.MAX_COLOR_ATTACHMENTS):1}D-=l.ColorAttachment.COLOR_ATTACHMENT0;D+1>y._MAX_COLOR_ATTACHMENTS&&c.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${D+
1}. Implementation supports up to ${y._MAX_COLOR_ATTACHMENTS} color attachments`)};b._createClass(y,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const D=this._colorAttachments.get(l.ColorAttachment.COLOR_ATTACHMENT0);return D&&e(D)?D:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(l.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||
this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width??0}},{key:"height",get:function(){return this._desc.height??0}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((D,[,z])=>D+d.getGpuMemoryUsage(z),0)+d.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return y}();q._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=q;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util","./enums"],function(a,b,c,w,n){let x=function(){function m(g,f){this._context=g;this._desc=f;this.type="renderbuffer";this._context.instanceCounter.increment(n.ResourceType.Renderbuffer,this);g=this._context.gl;this.glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:d,height:e,internalFormat:k,multisampled:u}=f;
if(u){if(this._context.type!==w.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");g.renderbufferStorageMultisample(g.RENDERBUFFER,this.samples,k,d,e)}else g.renderbufferStorage(g.RENDERBUFFER,k,d,e)}var l=m.prototype;l.resize=function(g,f){const d=this._desc;if(d.width!==g||d.height!==f)d.width=g,d.height=f,g=this._context.gl,this._context.bindRenderbuffer(this),d.multisampled?g.renderbufferStorageMultisample(g.RENDERBUFFER,this.samples,d.internalFormat,d.width,
d.height):g.renderbufferStorage(g.RENDERBUFFER,d.internalFormat,d.width,d.height)};l.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.ResourceType.Renderbuffer,this),this._context=c.nullifyNonNullableForDispose(this._context))};b._createClass(m,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const g=this._desc.samples,f=this._context.parameters.maxSamples;return g?Math.min(g,f):f}}]);return m}();
a.Renderbuffer=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f64 ../../environment/CloudsCompositionParameters ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=function(){function k(u,p,h){this.shadowMap=u;this.ssaoHelper=p;this.slicePlane=h;this.slot=g.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=f.TransparencyPassType.NONE;this._camera=new l.Camera;this._inverseViewport=c.create();this.oldLighting=new d.SceneLighting;this.newLighting=new d.SceneLighting;this._fadedLighting=new d.SceneLighting;this._lighting=this.newLighting;this.ssr=new m.SSRUniforms;this.multipassTerrain=
new x.MultipassTerrainUniforms;this.multipassGeometry=new n.MultipassGeometryUniforms;this.overlays=[];this.cloudsFade=new w.CloudsFadeParameters}k.prototype.fadeLighting=function(u){const {oldLighting:p,newLighting:h}=this;1<=u?this._lighting=h:(this._fadedLighting.lerpLighting(p,h,u),this._lighting=this._fadedLighting)};b._createClass(k,[{key:"camera",get:function(){return this._camera},set:function(u){this._camera=this.ssr.camera=u;this._inverseViewport[0]=1/u.fullViewport[2];this._inverseViewport[1]=
1/u.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",get:function(){return this._lighting===this._fadedLighting}}]);return k}();a.BindParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x){b=b._createClass(function(){this.enabled=!1});a.MultipassGeometryUniforms=b;a.multipassGeometryTest=function(m){m.include(c.ReadLinearDepth);m.uniforms.add([new x.Texture2DPassUniform("geometryDepthTexture",(l,g)=>g.multipassGeometry.linearDepthTexture),new w.Float2PassUniform("nearFar",(l,g)=>g.camera.nearFar)]);m.code.add(n.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,w,n,x){b=b._createClass(function(){this.cullAboveGround=this.enabled=!1});a.MultipassTerrainUniforms=b;a.multipassTerrainTest=
function(m,l){l.hasMultipassTerrain&&(m.fragment.include(c.ReadLinearDepth),m.fragment.uniforms.add(new x.Texture2DPassUniform("terrainDepthTexture",(g,f)=>f.multipassTerrain.linearDepthTexture)),m.fragment.uniforms.add(new w.Float2PassUniform("nearFar",(g,f)=>f.camera.nearFar)),m.fragment.uniforms.add(new w.Float2PassUniform("inverseViewport",(g,f)=>f.inverseViewport)),m.fragment.code.add(n.glsl`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${l.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat4f64 ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,
b,c,w,n,x,m,l,g){b=b._createClass(function(){this.enabled=!1;this.fadeFactor=1;this.reprojectionMatrix=c.create()});a.SSRUniforms=b;a.ScreenSpaceReflections=function(f,d){f=f.fragment;f.include(w.ReadLinearDepth);f.uniforms.add(new n.Float2PassUniform("nearFar",(e,k)=>k.camera.nearFar));f.uniforms.add(new g.Texture2DPassUniform("depthMap",(e,k)=>k.linearDepthTexture));f.uniforms.add(new l.Matrix4PassUniform("proj",(e,k)=>k.ssr.camera.projectionMatrix));f.uniforms.add(new x.FloatPassUniform("invResolutionHeight",
(e,k)=>1/k.ssr.camera.height));f.uniforms.add(new l.Matrix4PassUniform("reprojectionMatrix",(e,k)=>k.ssr.reprojectionMatrix));f.code.add(m.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${d.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";
b[b.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=12]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=14]="HUD_MATERIAL";b[b.LABEL_MATERIAL=
15]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=16]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=18]="DRAPED_MATERIAL";b[b.DRAPED_WATER=19]="DRAPED_WATER";b[b.VOXEL=20]="VOXEL";b[b.MAX_SLOTS=21]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=void 0;var b=a.TransparencyPassType||(a.TransparencyPassType={});b[b.Color=
0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,c,w,n,x,m){let l=b._createClass(function(){this.color=n.create();this.intensity=
1}),g=b._createClass(function(){this.direction=n.create();this.ambient=new l;this.diffuse=new l}),f=function(){function e(){this._shOrder=2;this._legacy=new g;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new x.SphericalHarmonicsAmbientLight;this._mainLight=new x.MainLight(n.create(),n.fromValues(1,0,0),!1)}var k=e.prototype;k.set=function(u){m.combineLights(u,this._shOrder,this._mainLight,this._sphericalHarmonics);w.copy(this._legacy.direction,this._mainLight.direction);u=1/Math.PI;
this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*u;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*u;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*u;w.scale(this._legacy.diffuse.color,this._mainLight.intensity,u);w.copy(d,this._legacy.diffuse.color);w.scale(d,d,.4*this.globalFactor);w.add(this._legacy.ambient.color,this._legacy.ambient.color,d)};k.copyFrom=function(u){this._sphericalHarmonics.r=Array.from(u.sh.r);this._sphericalHarmonics.g=
Array.from(u.sh.g);this._sphericalHarmonics.b=Array.from(u.sh.b);w.copy(this._mainLight.direction,u.mainLight.direction);w.copy(this._mainLight.intensity,u.mainLight.intensity);this._mainLight.castShadows=u.mainLight.castShadows;this._mainLight.specularStrength=u.mainLight.specularStrength;this._mainLight.environmentStrength=u.mainLight.environmentStrength;this.globalFactor=u.globalFactor;this.noonFactor=u.noonFactor};k.lerpLighting=function(u,p,h){w.lerp(this._mainLight.intensity,u.mainLight.intensity,
p.mainLight.intensity,h);this._mainLight.environmentStrength=c.lerp(u.mainLight.environmentStrength,p.mainLight.environmentStrength,h);this._mainLight.specularStrength=c.lerp(u.mainLight.specularStrength,p.mainLight.specularStrength,h);w.copy(this._mainLight.direction,p.mainLight.direction);this._mainLight.castShadows=p.mainLight.castShadows;this.globalFactor=c.lerp(u.globalFactor,p.globalFactor,h);this.noonFactor=c.lerp(u.noonFactor,p.noonFactor,h);if(u.sh.r.length===p.sh.r.length)for(let r=0;r<
p.sh.r.length;r++)this._sphericalHarmonics.r[r]=c.lerp(u.sh.r[r],p.sh.r[r],h),this._sphericalHarmonics.g[r]=c.lerp(u.sh.g[r],p.sh.g[r],h),this._sphericalHarmonics.b[r]=c.lerp(u.sh.b[r],p.sh.b[r],h);else for(u=0;u<p.sh.r.length;u++)this._sphericalHarmonics.r[u]=p.sh.r[u],this._sphericalHarmonics.g[u]=p.sh.g[u],this._sphericalHarmonics.b[u]=p.sh.b[u]};b._createClass(e,[{key:"legacy",get:function(){return this._legacy}},{key:"sh",get:function(){return this._sphericalHarmonics}},{key:"mainLight",get:function(){return this._mainLight}}]);
return e}();const d=n.create();a.SceneLighting=f;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64"],function(a,b,c){let w=b._createClass(function(m=c.create()){this.intensity=m}),n=b._createClass(function(m=c.create(),l=c.fromValues(.57735,.57735,.57735)){this.intensity=m;this.direction=l}),x=b._createClass(function(m=
c.create(),l=c.fromValues(.57735,.57735,.57735),g=!0,f=1,d=1){this.intensity=m;this.direction=l;this.castShadows=g;this.specularStrength=f;this.environmentStrength=d});b=b._createClass(function(){this.r=[0];this.g=[0];this.b=[0]});a.AmbientLight=w;a.FillLight=n;a.MainLight=x;a.SphericalHarmonicsAmbientLight=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(a,b,c,w,n,x){function m(B){return(B+1)*(B+1)}function l(B){return b.clamp(Math.floor(Math.sqrt(B)-1),0,2)}function g(B,D,z){const v=B[0],A=B[1];B=B[2];z=z||[];z.length=m(D);0<=D&&(z[0]=.28209479177);1<=D&&(z[1]=.4886025119*v,z[2]=.4886025119*B,z[3]=.4886025119*A);2<=D&&(z[4]=1.09254843059*v*A,z[5]=1.09254843059*A*B,z[6]=.31539156525*(3*B*B-1),z[7]=1.09254843059*v*B,z[8]=.54627421529*(v*v-A*A));return z}function f(B,D){B=m(B);D=D||{r:[],g:[],b:[]};D.r.length=D.g.length=D.b.length=B;for(let z=
0;z<B;z++)D.r[z]=D.g[z]=D.b[z]=0;return D}function d(B,D){const z=l(D.r.length);for(const v of B)c.negate(q,v.direction),g(q,z,h),n.elementwiseProduct(h,y),n.scalarProduct(h,v.intensity[0],r),n.add(D.r,r),n.scalarProduct(h,v.intensity[1],r),n.add(D.g,r),n.scalarProduct(h,v.intensity[2],r),n.add(D.b,r);return D}function e(B,D){g(q,0,h);for(const z of B)D.r[0]+=h[0]*y[0]*z.intensity[0]*4*Math.PI,D.g[0]+=h[0]*y[0]*z.intensity[1]*4*Math.PI,D.b[0]+=h[0]*y[0]*z.intensity[2]*4*Math.PI;return D}const k=[],
u=[],p=[],h=[0],r=[0],q=w.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(B,D,z,v){f(D,v);c.set(z.intensity,0,0,0);D=!1;k.length=0;u.length=0;p.length=0;for(const A of B)A instanceof x.MainLight&&!D?(c.copy(z.direction,A.direction),c.copy(z.intensity,A.intensity),z.specularStrength=A.specularStrength,z.environmentStrength=A.environmentStrength,z.castShadows=A.castShadows,D=!0):A instanceof x.MainLight||A instanceof x.FillLight?k.push(A):
A instanceof x.AmbientLight?u.push(A):A instanceof x.SphericalHarmonicsAmbientLight&&p.push(A);d(k,v);e(u,v);for(const A of p)n.add(v.r,A.r),n.add(v.g,A.g),n.add(v.b,A.b)};a.computeCoefficients=g;a.initSHCoefficients=f;a.numberOfCoefficients=m;a.orderFromNumberOfCoefficients=l;a.projectAmbientLights=e;a.projectFillLights=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,c,w){w=
w||b;w.length=b.length;for(let n=0;n<b.length;n++)w[n]=b[n]+c[n];return w};a.dotProduct=function(b,c){let w=0;for(let n=0;n<b.length;n++)w+=b[n]*c[n];return w};a.elementwiseProduct=function(b,c,w){w=w||b;w.length=b.length;for(let n=0;n<b.length;n++)w[n]=b[n]*c[n];return w};a.scalarProduct=function(b,c,w){w=w||b;w.length=b.length;for(let n=0;n<b.length;n++)w[n]=b[n]*c;return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/FogHaze.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){a.Fog=function(v){function A(C){var E=t.call(this,C);E._passParameters=new p.FogHazePassParameters;E._vao=y.createQuadVAO(C.context.renderContext.rctx,q.Pos2Tex);E._technique=C.context.techniqueRepository.acquire(h.FogTechnique,new h.FogHazeTechniqueConfiguration);C=k.getReferenceEllipsoid(C.view.spatialReference);E._planetRadius=C.radius;E._atmosphereRadius=C.radius+u.atmosphereHeight;return E}b._inherits(A,v);var t=b._createSuper(A);v=A.prototype;
v.destroy=function(){this._technique.release();this._vao.dispose()};v.render=function(C,E){this._update(C,E);if(!(0>=this._passParameters.fogAmount)){var F=this._technique;if(F.compiled){var H=C.offscreenRenderingHelper;H.renderDepthDetached(()=>{this._passParameters.depthTexture=H.depthTexture;const K=C.rctx.bindTechnique(F,this._passParameters,C.bindParameters);this._renderFog(K,C)})}else this.context.requestRender()}};v._renderFog=function(C,E){E=E.rctx;E.bindVAO(this._vao);C.assertCompatibleVertexAttributeLocations(this._vao);
E.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,0,4)};v._update=function(C,E){var F=C.bindParameters.camera;d.normalize(D,F.eye);C=Math.max(0,d.dot(D,C.bindParameters.lighting.mainLight.direction));const H=E.color;d.scale(z,H,.1);d.lerp(this._passParameters.fogColor,z,H,C);F=d.length(F.eye);this._passParameters.atmosphereC=F*F-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-n.smoothstep(.95*r.weatherHeightLimit,1*r.weatherHeightLimit,Math.abs(F-this._planetRadius)))*E.amount;
this._passParameters.fogStrength=E.strength};A.isSupported=function(C){return C.capabilities.depthTexture};b._createClass(A,[{key:"strength",get:function(){return this._passParameters.fogStrength},set:function(C){this._passParameters.fogStrength=C}}]);return A}(w);c.__decorate([x.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([x.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);a.Fog=c.__decorate([f.subclass("esri.views.3d.environment.Fog")],a.Fog);c=b._createClass(function(){this.color=
e.create();this.amount=this.strength=0});const D=e.create(),z=e.create();a.FogParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/FogHaze.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(B){const D=new u.ShaderBuilder;D.attributes.add(h.VertexAttribute.POSITION,"vec2");D.include(x.TextureCoordinateAttribute,{textureCoordinateType:x.TextureCoordinateAttributeType.Default});D.varyings.add("worldRay","vec3");D.varyings.add("eyeDir","vec3");const {vertex:z,fragment:v}=D;z.uniforms.add([new k.Matrix4PassUniform("inverseProjectionMatrix",(A,t)=>t.camera.inverseProjectionMatrix),new k.Matrix4PassUniform("inverseViewMatrix",(A,t)=>c.invertOrIdentity(y,
t.camera.viewMatrix))]);z.code.add(e.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);v.uniforms.add(new d.FloatPassUniform("atmosphereC",A=>A.atmosphereC));v.uniforms.add(new f.Float3PassUniform("cameraPosition",(A,t)=>t.camera.eye));v.uniforms.add(new g.Float2PassUniform("nearFar",(A,t)=>t.camera.nearFar));v.uniforms.add(new p.Texture2DPassUniform("depthTex",A=>A.depthTexture));v.uniforms.add(new d.FloatPassUniform("fogStrength",A=>B.haze?A.hazeStrength:A.fogStrength));v.uniforms.add(new d.FloatPassUniform("fogAmount",A=>B.haze?A.hazeAmount:A.fogAmount));v.uniforms.add(new f.Float3PassUniform("fogColor",
A=>B.haze?A.hazeColor:A.fogColor));D.include(l.Gamma);v.include(m.ReadLinearDepth);v.code.add(e.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);v.code.add(e.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);v.code.add(e.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${B.haze?e.glsl`
          if(terrainDepth == -1.0){
            fragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return D}let q=function(B){function D(){var v=z.apply(this,arguments);v.fogColor=n.create();v.hazeColor=n.create();v.fogStrength=4E-6;v.hazeStrength=4E-6;v.atmosphereC=1;v.fogAmount=0;v.hazeAmount=0;return v}b._inherits(D,B);var z=b._createSuper(D);return b._createClass(D)}(e.NoParameters);const y=w.create();w=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:q,build:r},Symbol.toStringTag,{value:"Module"}));a.FogHazePassParameters=q;a.Haze=w;a.build=r})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/FogHaze.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){m=function(k){function u(){return p.apply(this,arguments)}c._inherits(u,k);var p=c._createSuper(u);k=u.prototype;k.initializeProgram=function(h){return new f.Program(h.rctx,u.shader.get().build(this.configuration),g.Default3D)};k.initializePipeline=function(){return this.configuration.haze?e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO,d.BlendFactor.ONE_MINUS_SRC_COLOR,d.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams}):
e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ZERO,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})};return c._createClass(u)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(n.Haze,()=>new Promise((k,u)=>a(["./FogHaze.glsl"],k,u)));n=function(k){function u(){var h=p.apply(this,arguments);h.haze=!1;return h}c._inherits(u,k);var p=c._createSuper(u);return c._createClass(u)}(l.ShaderTechniqueConfiguration);
w.__decorate([l.parameter()],n.prototype,"haze",void 0);b.FogHazeTechniqueConfiguration=n;b.FogTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){let D=function(){function A(C,E){this.type=x.AtmosphereType.Panoramic;this._configuration=new g.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new m.SimpleAtmospherePassParameters;this._configuration.geometry=g.SimpleAtmosphereGeometry.Cylinder;this._technique=E.techniqueRepository.acquire(l.SimpleAtmosphereTechnique,this._configuration);C=E.renderContext.rctx;this._vao=this._createVertexArrayObject(C);this._vaoCount=B.vertexCount(this._vao,
"geometry");this._passParameters.texture=new y.Texture(C,{pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.LINEAR,flipped:!0,width:1,height:512},f.earthAtmosphereTextureSimple)}var t=A.prototype;t.destroy=function(){this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()};t.render=function(C){const E=C.rctx,F=E.bindTechnique(this._technique,this._passParameters,
C.bindParameters);var H=z;w.copy(H,C.bindParameters.camera.viewMatrix);H[12]=0;H[13]=0;H[14]=0;H[15]=1;F.setUniformMatrix4fv("view",z);E.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);E.drawArrays(q.PrimitiveType.TRIANGLES,0,this._vaoCount)};t.renderHaze=function(){return!1};t._createVertexArrayObject=function(C){var E=u.createPolySphereData(1,2,!1);const F=E.indices[0][1];E=E.vertexAttributes[0][1];for(var H=0;H<F.length;H+=3){var K=F[H];F[H]=F[H+2];F[H+2]=K}E=E.data;H=
v.createBuffer(F.length);K=H.position;for(let I=0;I<F.length;++I){const L=3*F[I];K.set(I,0,E[L]);K.set(I,1,E[L+1]);K.set(I,2,E[L+2])}return new p.VertexArrayObject(C,k.Default3D,{geometry:d.glLayout(v)},{geometry:r.BufferObject.createVertex(C,q.Usage.STATIC_DRAW,H.buffer)})};return b._createClass(A)}();const z=n.create(),v=e.newLayout().vec3f(h.VertexAttribute.POSITION);a.PanoramicAtmosphere=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ./vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){function h(B){const D=new k.ShaderBuilder,{vertex:z,fragment:v}=D;m.addMainLightDirection(z);B.geometry===n.SimpleAtmosphereGeometry.Underground?(D.attributes.add(p.VertexAttribute.POSITION,"vec2"),D.varyings.add("color","vec4"),z.uniforms.add([new g.Float3PassUniform("cameraPosition",(A,t)=>t.camera.eye),new f.FloatPassUniform("undergroundFadeAlpha",A=>A.undergroundFadeAlpha)]),z.code.add(d.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),v.code.add(d.glsl`void main() {
fragColor = color;
}`)):(D.include(x.Transform,B),D.attributes.add(p.VertexAttribute.POSITION,"vec3"),D.varyings.add("vtc","vec2"),D.varyings.add("falloff","float"),B=B.geometry===n.SimpleAtmosphereGeometry.Cylinder,z.uniforms.add([new e.Matrix4PassUniform("proj",(A,t)=>t.camera.projectionMatrix),new e.Matrix4PassUniform("view",(A,t)=>t.camera.viewMatrix)]),B||(D.varyings.add("innerFactor","float"),z.uniforms.add(new g.Float3PassUniform("silCircleCenter",A=>A.silhouette.center)),z.uniforms.add(new g.Float3PassUniform("silCircleV1",
A=>A.silhouette.v1)),z.uniforms.add(new g.Float3PassUniform("silCircleV2",A=>A.silhouette.v2)),z.uniforms.add(new l.Float2PassUniform("texV",A=>A.texV)),z.uniforms.add(new f.FloatPassUniform("innerScale",A=>A.innerScale))),z.code.add(d.glsl`
		void main(void) {
      ${B?d.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:d.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${d.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${d.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),v.uniforms.add(new u.Texture2DPassUniform("tex",A=>A.texture)),B||v.uniforms.add(new f.FloatPassUniform("altitudeFade",A=>A.altitudeFade)),v.code.add(d.glsl`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${B?d.glsl`fragColor = atmosphereColor;`:d.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return D}let r=function(B){function D(){var v=z.apply(this,arguments);v.texV=c.create();v.altitudeFade=0;v.innerScale=0;v.undergroundFadeAlpha=0;v.silhouette=new q;return v}b._inherits(D,B);var z=b._createSuper(D);return b._createClass(D)}(d.NoParameters),q=b._createClass(function(){this.center=w.create();this.v1=w.create();this.v2=w.create()});const y=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:q,SimpleAtmospherePassParameters:r,build:h},Symbol.toStringTag,{value:"Module"}));
a.SilhouetteCircle=q;a.SimpleAtmosphere=y;a.SimpleAtmospherePassParameters=r;a.build=h})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,c,w,n){a.SimpleAtmosphereGeometry=void 0;(function(x){x[x.Cone=0]="Cone";x[x.Cylinder=1]="Cylinder";x[x.Underground=
2]="Underground";x[x.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));n=function(x){function m(){var g=l.apply(this,arguments);g.geometry=a.SimpleAtmosphereGeometry.Cone;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(n.DefaultTechniqueConfiguration);c.__decorate([w.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],n.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w,n){let x=function(m){function l(){return g.apply(this,arguments)}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({constValue:!0})],x.prototype,
"hasSliceHighlight",void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"instancedDoublePrecision",void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"hasModelTransformation",void 0);c.__decorate([n.parameter({constValue:w.BindType.Pass})],x.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports",
"./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,b,c){a.Transform=function(w,n){b.addCalculateLinearDepth(w);n.hasModelTransformation?(w.vertex.code.add(c.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),w.vertex.code.add(c.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`)):(w.vertex.code.add(c.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),w.vertex.code.add(c.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,c,w,n){function x(g){g.varyings.add("linearDepth","float")}function m(g){g.vertex.uniforms.add(new w.Float2PassUniform("nearFar",(f,d)=>d.camera.nearFar))}function l(g){g.vertex.code.add(n.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(g,f){const {vertex:d}=g;switch(f.output){case b.ShaderOutput.Color:if(f.receiveShadows){x(g);d.code.add(n.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.Depth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:g.include(c.VertexPosition,f);x(g);m(g);l(g);d.code.add(n.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}d.code.add(n.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=l;a.addLinearDepth=x;a.addNearFar=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.ShadowHighlight=4]="ShadowHighlight";b[b.ShadowExcludeHighlight=
5]="ShadowExcludeHighlight";b[b.Highlight=6]="Highlight";b[b.Alpha=7]="Alpha";b[b.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor";b[b.COUNT=9]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){let p=function(r){function q(){var B=y.apply(this,arguments);B.transformWorldFromViewTH=x.create();B.transformWorldFromViewTL=x.create();B.transformViewFromCameraRelativeRS=c.create();B.transformProjFromView=w.create();return B}b._inherits(q,r);var y=b._createSuper(q);return b._createClass(q)}(d.NoParameters),h=function(r){function q(){var B=y.apply(this,arguments);B.transformWorldFromModelRS=c.create();B.transformWorldFromModelTH=n.create();B.transformWorldFromModelTL=
n.create();return B}b._inherits(q,r);var y=b._createSuper(q);return b._createClass(q)}(d.NoParameters);a.VertexPosition=function(r,q){r.include(m.PositionAttribute);const y=r.vertex;y.include(l.DoublePrecision,q);r.varyings.add("vPositionWorldCameraRelative","vec3");r.varyings.add("vPosition_view","vec3");y.uniforms.add([new f.Float3PassUniform("transformWorldFromViewTH",B=>B.transformWorldFromViewTH),new f.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL),new k.Matrix3PassUniform("transformViewFromCameraRelativeRS",
B=>B.transformViewFromCameraRelativeRS),new u.Matrix4PassUniform("transformProjFromView",B=>B.transformProjFromView),new e.Matrix3DrawUniform("transformWorldFromModelRS",B=>B.transformWorldFromModelRS),new g.Float3DrawUniform("transformWorldFromModelTH",B=>B.transformWorldFromModelTH),new g.Float3DrawUniform("transformWorldFromModelTL",B=>B.transformWorldFromModelTL)]);y.code.add(d.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);y.code.add(d.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${q.spherical?d.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:d.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);r.fragment.uniforms.add(new f.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL));y.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);r.fragment.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=h;a.VertexPositionPassParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(w){w.attributes.add(c.VertexAttribute.POSITION,"vec3");w.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DoublePrecision=function({code:c},w){w.doublePrecisionRequiresObfuscation?c.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):c.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"mat3",w.BindType.Pass,(f,d,e)=>f.setUniformMatrix3fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Matrix3PassUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,
b,c,w,n,x,m,l,g,f,d){m=function(e){function k(){return u.apply(this,arguments)}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new g.Program(p.rctx,k.shader.get().build(this.configuration),l.Default3D)};e.initializePipeline=function(){return this.configuration.geometry===n.SimpleAtmosphereGeometry.Cylinder?d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),
culling:d.backFaceCullingParams,depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return c._createClass(k)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(w.SimpleAtmosphere,()=>new Promise((e,k)=>a(["./SimpleAtmosphere.glsl"],
e,k)));b.SimpleAtmosphereTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,
0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,
0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,
15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,
5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,
8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,
37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,
98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,
85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,
74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,
200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,
175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,
255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],
function(a,b,c){const w={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(n,x=0){const m=n.stride;return n.fieldNames.filter(l=>{l=n.fields.get(l).optional;return!(l&&l.glPadding)}).map(l=>{const g=n.fields.get(l),f=g.constructor.ElementCount;var d=w[g.constructor.ElementType];if(!d)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(l,
f,d,g.offset,m,!(!g.optional||!g.optional.glNormalized),x)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,b,c,w){let n=function(){function m(g,f){this.layout=g;this.buffer="number"===typeof f?new ArrayBuffer(f*g.stride):f;for(const d of g.fieldNames)f=
g.fields.get(d),this[d]=new f.constructor(this.buffer,f.offset,this.stride)}var l=m.prototype;l.getField=function(g,f){return(g=this[g])&&g.elementCount===f.ElementCount&&g.elementType===f.ElementType?g:null};l.slice=function(g,f){return new m(this.layout,this.buffer.slice(g*this.stride,f*this.stride))};l.copyFrom=function(g,f,d,e){const k=this.stride;0===k%4?(g=new Uint32Array(g.buffer,f*k,e*k/4),(new Uint32Array(this.buffer,d*k,e*k/4)).set(g)):(g=new Uint8Array(g.buffer,f*k,e*k),(new Uint8Array(this.buffer,
d*k,e*k)).set(g))};b._createClass(m,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return m}(),x=function(){function m(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var l=m.prototype;l.vec2f=function(g,f){this._appendField(g,c.BufferViewVec2f,f);return this};l.vec2f64=function(g,f){this._appendField(g,c.BufferViewVec2f64,f);return this};l.vec3f=
function(g,f){this._appendField(g,c.BufferViewVec3f,f);return this};l.vec3f64=function(g,f){this._appendField(g,c.BufferViewVec3f64,f);return this};l.vec4f=function(g,f){this._appendField(g,c.BufferViewVec4f,f);return this};l.vec4f64=function(g,f){this._appendField(g,c.BufferViewVec4f64,f);return this};l.mat3f=function(g,f){this._appendField(g,c.BufferViewMat3f,f);return this};l.mat3f64=function(g,f){this._appendField(g,c.BufferViewMat3f64,f);return this};l.mat4f=function(g,f){this._appendField(g,
c.BufferViewMat4f,f);return this};l.mat4f64=function(g,f){this._appendField(g,c.BufferViewMat4f64,f);return this};l.vec4u8=function(g,f){this._appendField(g,c.BufferViewVec4u8,f);return this};l.f32=function(g,f){this._appendField(g,c.BufferViewFloat,f);return this};l.f64=function(g,f){this._appendField(g,c.BufferViewFloat64,f);return this};l.u8=function(g,f){this._appendField(g,c.BufferViewUint8,f);return this};l.u16=function(g,f){this._appendField(g,c.BufferViewUint16,f);return this};l.i8=function(g,
f){this._appendField(g,c.BufferViewInt8,f);return this};l.vec2i8=function(g,f){this._appendField(g,c.BufferViewVec2i8,f);return this};l.vec2i16=function(g,f){this._appendField(g,c.BufferViewVec2i16,f);return this};l.vec2u8=function(g,f){this._appendField(g,c.BufferViewVec2u8,f);return this};l.vec4u16=function(g,f){this._appendField(g,c.BufferViewVec4u16,f);return this};l.u32=function(g,f){this._appendField(g,c.BufferViewUint32,f);return this};l._appendField=function(g,f,d){const e=f.ElementCount*
w.elementTypeSize(f.ElementType);this.fields.set(g,{size:e,constructor:f,offset:this.stride,optional:d});this.stride+=e;this.fieldNames.push(g)};l.alignTo=function(g){this.stride=Math.floor((this.stride+g-1)/g)*g;return this};l.hasField=function(g){return this.fieldNames.includes(g)};l.createBuffer=function(g){return new n(this,g)};l.createView=function(g){return new n(this,g)};l.clone=function(){const g=new m;g.stride=this.stride;g.fields=new Map;this.fields.forEach((f,d)=>g.fields.set(d,f));g.fieldNames=
this.fieldNames.slice();g.BufferType=this.BufferType;return g};return b._createClass(m)}();a.InterleavedBuffer=n;a.InterleavedLayout=x;a.newLayout=function(){return new x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,b,c,w,n,x,m,l){let g=function(U){function N(Q,
W=0,V,T){Q=S.call(this,Float32Array,Q,W,V,T);Q.elementType="f32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);g.ElementType="f32";let f=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float32Array,Q,W,V,T);Q.elementType="f32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=
function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);f.ElementType="f32";let d=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float32Array,Q,W,V,T);Q.elementType="f32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);
d.ElementType="f32";let e=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float32Array,Q,W,V,T);Q.elementType="f32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);e.ElementType="f32";let k=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float32Array,Q,W,V,T);Q.elementType="f32";return Q}b._inherits(N,
U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(c.BufferViewMat3Impl);k.ElementType="f32";c=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float64Array,Q,W,V,T);Q.elementType="f64";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,
Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(c.BufferViewMat3Impl);c.ElementType="f64";let u=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float32Array,Q,W,V,T);Q.elementType="f32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(w.BufferViewMat4Impl);u.ElementType="f32";w=function(U){function N(Q,
W=0,V,T){Q=S.call(this,Float64Array,Q,W,V,T);Q.elementType="f64";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(w.BufferViewMat4Impl);w.ElementType="f64";let p=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float64Array,Q,W,V,T);Q.elementType="f64";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=
function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);p.ElementType="f64";let h=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float64Array,Q,W,V,T);Q.elementType="f64";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+
Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);h.ElementType="f64";let r=function(U){function N(Q,W=0,V,T){Q=S.call(this,Float64Array,Q,W,V,T);Q.elementType="f64";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);r.ElementType="f64";let q=function(U){function N(Q,W=0,V,T){Q=S.call(this,
Float64Array,Q,W,V,T);Q.elementType="f64";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);q.ElementType="f64";let y=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint8Array,Q,W,V,T);Q.elementType="u8";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,
Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);y.ElementType="u8";let B=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint8Array,Q,W,V,T);Q.elementType="u8";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);
B.ElementType="u8";let D=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint8Array,Q,W,V,T);Q.elementType="u8";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);D.ElementType="u8";let z=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint8Array,Q,W,V,T);Q.elementType="u8";return Q}b._inherits(N,
U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);z.ElementType="u8";let v=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint16Array,Q,W,V,T);Q.elementType="u16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,
Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);v.ElementType="u16";let A=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint16Array,Q,W,V,T);Q.elementType="u16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);A.ElementType="u16";let t=function(U){function N(Q,
W=0,V,T){Q=S.call(this,Uint16Array,Q,W,V,T);Q.elementType="u16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);t.ElementType="u16";let C=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint16Array,Q,W,V,T);Q.elementType="u16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=
function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);C.ElementType="u16";let E=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint32Array,Q,W,V,T);Q.elementType="u32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};
return b._createClass(N)}(n.BufferViewScalarImpl);E.ElementType="u32";let F=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint32Array,Q,W,V,T);Q.elementType="u32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);F.ElementType="u32";let H=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint32Array,
Q,W,V,T);Q.elementType="u32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);H.ElementType="u32";let K=function(U){function N(Q,W=0,V,T){Q=S.call(this,Uint32Array,Q,W,V,T);Q.elementType="u32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,
Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);K.ElementType="u32";let I=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int8Array,Q,W,V,T);Q.elementType="i8";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);
I.ElementType="i8";let L=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int8Array,Q,W,V,T);Q.elementType="i8";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);L.ElementType="i8";let R=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int8Array,Q,W,V,T);Q.elementType="i8";return Q}b._inherits(N,
U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);R.ElementType="i8";let O=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int8Array,Q,W,V,T);Q.elementType="i8";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,
Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);O.ElementType="i8";let J=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int16Array,Q,W,V,T);Q.elementType="i16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);J.ElementType="i16";let M=function(U){function N(Q,
W=0,V,T){Q=S.call(this,Int16Array,Q,W,V,T);Q.elementType="i16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);M.ElementType="i16";let G=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int16Array,Q,W,V,T);Q.elementType="i16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=
function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);G.ElementType="i16";let P=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int16Array,Q,W,V,T);Q.elementType="i16";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};
return b._createClass(N)}(l.BufferViewVec4Impl);P.ElementType="i16";n=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int32Array,Q,W,V,T);Q.elementType="i32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(n.BufferViewScalarImpl);n.ElementType="i32";x=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int32Array,Q,
W,V,T);Q.elementType="i32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(x.BufferViewVec2Impl);x.ElementType="i32";m=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int32Array,Q,W,V,T);Q.elementType="i32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,
Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(m.BufferViewVec3Impl);m.ElementType="i32";l=function(U){function N(Q,W=0,V,T){Q=S.call(this,Int32Array,Q,W,V,T);Q.elementType="i32";return Q}b._inherits(N,U);var S=b._createSuper(N);N.prototype.slice=function(Q,W){return this.sliceBuffer(N,Q,W)};N.fromTypedArray=function(Q,W){return new N(Q.buffer,Q.byteOffset,W,Q.byteOffset+Q.byteLength)};return b._createClass(N)}(l.BufferViewVec4Impl);
l.ElementType="i32";a.BufferViewFloat=g;a.BufferViewFloat64=p;a.BufferViewInt16=J;a.BufferViewInt32=n;a.BufferViewInt8=I;a.BufferViewMat3f=k;a.BufferViewMat3f64=c;a.BufferViewMat4f=u;a.BufferViewMat4f64=w;a.BufferViewUint16=v;a.BufferViewUint32=E;a.BufferViewUint8=y;a.BufferViewVec2f=f;a.BufferViewVec2f64=h;a.BufferViewVec2i16=M;a.BufferViewVec2i32=x;a.BufferViewVec2i8=L;a.BufferViewVec2u16=A;a.BufferViewVec2u32=F;a.BufferViewVec2u8=B;a.BufferViewVec3f=d;a.BufferViewVec3f64=r;a.BufferViewVec3i16=
G;a.BufferViewVec3i32=m;a.BufferViewVec3i8=R;a.BufferViewVec3u16=t;a.BufferViewVec3u32=H;a.BufferViewVec3u8=D;a.BufferViewVec4f=e;a.BufferViewVec4f64=q;a.BufferViewVec4i16=P;a.BufferViewVec4i32=l;a.BufferViewVec4i8=O;a.BufferViewVec4u16=C;a.BufferViewVec4u32=K;a.BufferViewVec4u8=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x,
m,l=0,g,f){this.TypedArrayConstructor=x;this.elementCount=9;x=this.TypedArrayConstructor;void 0===g&&(g=9*x.BYTES_PER_ELEMENT);const d=0===m.byteLength?0:l;this.typedBuffer=null==f?new x(m,d):new x(m,d,(f-l)/x.BYTES_PER_ELEMENT);this.typedBufferStride=g/x.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=w.prototype;n.sliceBuffer=function(x,m,l=this.count-m){m=this.typedBuffer.byteOffset+
m*this.stride;return new x(this.buffer,m,this.stride,m+l*this.stride)};n.getMat=function(x,m){x*=this.typedBufferStride;for(let l=0;9>l;l++)m[l]=this.typedBuffer[x++];return m};n.setMat=function(x,m){x*=this.typedBufferStride;for(let l=0;9>l;l++)this.typedBuffer[x++]=m[l]};n.get=function(x,m){return this.typedBuffer[x*this.typedBufferStride+m]};n.set=function(x,m,l){this.typedBuffer[x*this.typedBufferStride+m]=l};n.copyFrom=function(x,m,l){const g=this.typedBuffer,f=m.typedBuffer;x*=this.typedBufferStride;
m=l*m.typedBufferStride;for(l=0;9>l;++l)g[x++]=f[m++]};b._createClass(w,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return w}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x,m,l=0,g,f){this.TypedArrayConstructor=x;this.elementCount=16;x=this.TypedArrayConstructor;
void 0===g&&(g=16*x.BYTES_PER_ELEMENT);const d=0===m.byteLength?0:l;this.typedBuffer=null==f?new x(m,d):new x(m,d,(f-l)/x.BYTES_PER_ELEMENT);this.typedBufferStride=g/x.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=w.prototype;n.sliceBuffer=function(x,m,l=this.count-m){m=this.typedBuffer.byteOffset+m*this.stride;return new x(this.buffer,m,this.stride,m+l*this.stride)};n.getMat=
function(x,m){x*=this.typedBufferStride;for(let l=0;16>l;l++)m[l]=this.typedBuffer[x++];return m};n.setMat=function(x,m){x*=this.typedBufferStride;for(let l=0;16>l;l++)this.typedBuffer[x++]=m[l]};n.get=function(x,m){return this.typedBuffer[x*this.typedBufferStride+m]};n.set=function(x,m,l){this.typedBuffer[x*this.typedBufferStride+m]=l};n.copyFrom=function(x,m,l){const g=this.typedBuffer,f=m.typedBuffer;x*=this.typedBufferStride;m=l*m.typedBufferStride;for(l=0;16>l;++l)g[x++]=f[m++]};b._createClass(w,
[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return w}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x,m,l=0,g,f){this.TypedArrayConstructor=x;this.elementCount=1;x=this.TypedArrayConstructor;void 0===g&&(g=x.BYTES_PER_ELEMENT);const d=0===m.byteLength?
0:l;this.typedBuffer=null==f?new x(m,d):new x(m,d,(f-l)/x.BYTES_PER_ELEMENT);this.stride=g;this.typedBufferStride=g/x.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}var n=w.prototype;n.sliceBuffer=function(x,m,l=this.count-m){m=this.typedBuffer.byteOffset+m*this.stride;return new x(this.buffer,m,this.stride,m+l*this.stride)};n.get=function(x){return this.typedBuffer[x*this.typedBufferStride]};n.set=function(x,m){this.typedBuffer[x*this.typedBufferStride]=m};
b._createClass(w,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return w}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let w=function(){function n(m,l,g=0,f,d){this.TypedArrayConstructor=m;this.elementCount=2;m=this.TypedArrayConstructor;void 0===f&&(f=2*
m.BYTES_PER_ELEMENT);const e=0===l.byteLength?0:g;this.typedBuffer=null==d?new m(l,e):new m(l,e,(d-g)/m.BYTES_PER_ELEMENT);this.typedBufferStride=f/m.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var x=n.prototype;x.sliceBuffer=function(m,l,g=this.count-l){l=this.typedBuffer.byteOffset+l*this.stride;return new m(this.buffer,l,this.stride,l+g*this.stride)};x.getVec=function(m,l){m*=
this.typedBufferStride;return c.set(l,this.typedBuffer[m],this.typedBuffer[m+1])};x.setVec=function(m,l){m*=this.typedBufferStride;this.typedBuffer[m++]=l[0];this.typedBuffer[m]=l[1]};x.get=function(m,l){return this.typedBuffer[m*this.typedBufferStride+l]};x.set=function(m,l,g){this.typedBuffer[m*this.typedBufferStride+l]=g};x.setValues=function(m,l,g){m*=this.typedBufferStride;this.typedBuffer[m++]=l;this.typedBuffer[m]=g};x.copyFrom=function(m,l,g){const f=this.typedBuffer,d=l.typedBuffer;m*=this.typedBufferStride;
l=g*l.typedBufferStride;f[m++]=d[l++];f[m]=d[l]};b._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();w.ElementCount=2;a.BufferViewVec2Impl=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,b,c){let w=function(){function n(m,l,g=0,f,d){this.TypedArrayConstructor=m;this.elementCount=3;
m=this.TypedArrayConstructor;void 0===f&&(f=3*m.BYTES_PER_ELEMENT);const e=0===l.byteLength?0:g;this.typedBuffer=null==d?new m(l,e):new m(l,e,(d-g)/m.BYTES_PER_ELEMENT);this.typedBufferStride=f/m.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var x=n.prototype;x.sliceBuffer=function(m,l,g=this.count-l){l=this.typedBuffer.byteOffset+l*this.stride;return new m(this.buffer,l,this.stride,
l+g*this.stride)};x.getVec=function(m,l){m*=this.typedBufferStride;return c.set(l,this.typedBuffer[m],this.typedBuffer[m+1],this.typedBuffer[m+2])};x.setVec=function(m,l){m*=this.typedBufferStride;this.typedBuffer[m++]=l[0];this.typedBuffer[m++]=l[1];this.typedBuffer[m]=l[2]};x.get=function(m,l){return this.typedBuffer[m*this.typedBufferStride+l]};x.set=function(m,l,g){this.typedBuffer[m*this.typedBufferStride+l]=g};x.setValues=function(m,l,g,f){m*=this.typedBufferStride;this.typedBuffer[m++]=l;this.typedBuffer[m++]=
g;this.typedBuffer[m]=f};x.copyFrom=function(m,l,g){const f=this.typedBuffer,d=l.typedBuffer;m*=this.typedBufferStride;l=g*l.typedBufferStride;f[m++]=d[l++];f[m++]=d[l++];f[m]=d[l]};b._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();w.ElementCount=3;a.BufferViewVec3Impl=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/vec4"],function(a,b,c){let w=function(){function n(m,l,g=0,f,d){this.TypedArrayConstructor=m;this.start=g;this.elementCount=4;m=this.TypedArrayConstructor;void 0===f&&(f=4*m.BYTES_PER_ELEMENT);const e=0===l.byteLength?0:g;this.typedBuffer=null==d?new m(l,e):new m(l,e,(d-g)/m.BYTES_PER_ELEMENT);this.typedBufferStride=f/m.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var x=n.prototype;x.sliceBuffer=function(m,l,g=this.count-l){l=this.typedBuffer.byteOffset+l*this.stride;return new m(this.buffer,l,this.stride,l+g*this.stride)};x.getVec=function(m,l){m*=this.typedBufferStride;return c.set(l,this.typedBuffer[m++],this.typedBuffer[m++],this.typedBuffer[m++],this.typedBuffer[m])};x.setVec=function(m,l){m*=this.typedBufferStride;this.typedBuffer[m++]=l[0];this.typedBuffer[m++]=l[1];this.typedBuffer[m++]=l[2];this.typedBuffer[m]=l[3]};x.get=function(m,l){return this.typedBuffer[m*
this.typedBufferStride+l]};x.set=function(m,l,g){this.typedBuffer[m*this.typedBufferStride+l]=g};x.setValues=function(m,l,g,f,d){m*=this.typedBufferStride;this.typedBuffer[m++]=l;this.typedBuffer[m++]=g;this.typedBuffer[m++]=f;this.typedBuffer[m]=d};x.copyFrom=function(m,l,g){const f=this.typedBuffer,d=l.typedBuffer;m*=this.typedBufferStride;l=g*l.typedBufferStride;f[m++]=d[l++];f[m++]=d[l++];f[m++]=d[l++];f[m]=d[l]};b._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);
return n}();w.ElementCount=4;a.BufferViewVec4Impl=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;
case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(X,Z,Y){function aa(ea,ja){ea>ja&&([ea,ja]=[ja,ea]);const ka=ea.toString()+"."+ja.toString();if(ba[ka])return ba[ka];let da=ia.length;ia.length+=3;D.add(ia,3*ea,ia,3*ja,ia,da);D.scale(ia,da,X/D.length(ia,da));da/=3;return ba[ka]=da}let ia;Y?(ia=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],Y=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(Y=X*(1+Math.sqrt(5))/2,ia=[-X,Y,0,X,Y,0,-X,-Y,0,X,-Y,0,0,-X,Y,0,X,Y,0,-X,-Y,0,X,-Y,Y,0,-X,Y,0,X,-Y,0,-X,-Y,0,
X],Y=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var na=0;na<ia.length;na+=3)D.scale(ia,na,X/D.length(ia,na));let ba={};for(na=0;na<Z;na++){const ea=Y.length,ja=Array(4*ea);for(let ka=0;ka<ea;ka+=3){const da=Y[ka],ha=Y[ka+1],ca=Y[ka+2],fa=aa(da,ha),ma=aa(ha,ca),qa=aa(ca,da),wa=4*ka;ja[wa]=da;ja[wa+1]=fa;ja[wa+2]=qa;ja[wa+3]=ha;ja[wa+4]=ma;ja[wa+5]=fa;ja[wa+6]=ca;ja[wa+7]=qa;ja[wa+8]=ma;ja[wa+9]=fa;ja[wa+10]=
ma;ja[wa+11]=qa}Y=ja;ba={}}Z=m.floatArrayFrom(ia);for(na=0;na<Z.length;na+=3)D.normalize(Z,na);Y=[[h.VertexAttribute.POSITION,Y],[h.VertexAttribute.NORMAL,Y]];return{vertexAttributes:[[h.VertexAttribute.POSITION,new d.Attribute(m.floatArrayFrom(ia),3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(Z,3,!0)]],indices:Y}}function q(X,Z,Y,aa,ia,na,ba=w.fromValues(0,0,0)){var ea=Z.length,ja=m.newFloatArray(Y.length*ea*3+(6*aa.length||0));const ka=m.newFloatArray(Y.length*ea*3+(aa?6:0)),da=[],ha=[];let ca=
0;var fa=0;const ma=w.create(),qa=w.create(),wa=w.create(),xa=w.create(),pa=w.create(),ra=w.create(),va=w.create(),Ba=n.create(),Aa=w.create(),Ha=w.create(),Ka=w.create(),Pa=w.create(),Ra=w.create(),Sa=g.create();c.set(Aa,0,1,0);c.subtract(qa,Y[1],Y[0]);c.normalize(qa,qa);na?(c.add(Ba,Y[0],ba),c.normalize(wa,Ba)):c.set(wa,0,0,1);B(qa,wa,Aa,Aa,pa,wa,.99619469809);c.copy(xa,wa);c.copy(Pa,pa);for(var La=0;La<aa.length;La++)c.scale(ra,pa,aa[La][0]),c.scale(Ba,wa,aa[La][2]),c.add(ra,ra,Ba),c.add(ra,ra,
Y[0]),ja[ca++]=ra[0],ja[ca++]=ra[1],ja[ca++]=ra[2];ka[fa++]=-qa[0];ka[fa++]=-qa[1];ka[fa++]=-qa[2];for(La=0;La<ia.length;La++)da.push(0<ia[La][0]?ia[La][0]:-ia[La][0]-1+aa.length),da.push(0<ia[La][1]?ia[La][1]:-ia[La][1]-1+aa.length),da.push(0<ia[La][2]?ia[La][2]:-ia[La][2]-1+aa.length),ha.push(0),ha.push(0),ha.push(0);La=aa.length;const Ua=aa.length-1;for(let Xa=0;Xa<Y.length;Xa++){let la=!1;0<Xa&&(c.copy(ma,qa),Xa<Y.length-1?(c.subtract(qa,Y[Xa+1],Y[Xa]),c.normalize(qa,qa)):la=!0,c.add(Ha,ma,qa),
c.normalize(Ha,Ha),c.add(Ka,Y[Xa-1],xa),g.fromPositionAndNormal(Y[Xa],Ha,Sa),g.intersectRay(Sa,f.wrap(Ka,ma),Ba)?(c.subtract(Ba,Ba,Y[Xa]),c.normalize(wa,Ba),c.cross(pa,Ha,wa),c.normalize(pa,pa)):B(Ha,xa,Pa,Aa,pa,wa,.99619469809),c.copy(xa,wa),c.copy(Pa,pa));na&&(c.add(Ba,Y[Xa],ba),c.normalize(Ra,Ba));for(let Ta=0;Ta<ea;Ta++)if(c.scale(ra,pa,Z[Ta][0]),c.scale(Ba,wa,Z[Ta][1]),c.add(ra,ra,Ba),c.normalize(va,ra),ka[fa++]=va[0],ka[fa++]=va[1],ka[fa++]=va[2],c.add(ra,ra,Y[Xa]),ja[ca++]=ra[0],ja[ca++]=ra[1],
ja[ca++]=ra[2],!la){var Za=(Ta+1)%ea;da.push(La+Ta);da.push(La+ea+Ta);da.push(La+Za);da.push(La+Za);da.push(La+ea+Ta);da.push(La+ea+Za);for(Za=0;6>Za;Za++)ha.push(da[da.length-6+Za]-Ua)}La+=ea}Z=Y[Y.length-1];for(Y=0;Y<aa.length;Y++)c.scale(ra,pa,aa[Y][0]),c.scale(Ba,wa,aa[Y][1]),c.add(ra,ra,Ba),c.add(ra,ra,Z),ja[ca++]=ra[0],ja[ca++]=ra[1],ja[ca++]=ra[2];aa=fa/3;ka[fa++]=qa[0];ka[fa++]=qa[1];ka[fa++]=qa[2];ea=La-ea;for(fa=0;fa<ia.length;fa++)da.push(0<=ia[fa][0]?La+ia[fa][0]:-ia[fa][0]-1+ea),da.push(0<=
ia[fa][2]?La+ia[fa][2]:-ia[fa][2]-1+ea),da.push(0<=ia[fa][1]?La+ia[fa][1]:-ia[fa][1]-1+ea),ha.push(aa),ha.push(aa),ha.push(aa);ia=[[h.VertexAttribute.POSITION,da],[h.VertexAttribute.NORMAL,ha]];ja=[[h.VertexAttribute.POSITION,new d.Attribute(ja,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(ka,3,!0)]];return new u.Geometry(X,ja,ia)}function y(X,Z,Y,aa,ia){if(Math.abs(c.dot(Z,X))>ia)return!1;c.cross(Y,X,Z);c.normalize(Y,Y);c.cross(aa,Y,X);c.normalize(aa,aa);return!0}function B(X,Z,Y,aa,ia,na,ba){return y(X,
Z,ia,na,ba)||y(X,Y,ia,na,ba)||y(X,aa,ia,na,ba)}const D=e.Vec3Compact,z=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],v=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=[0,0,1,0,1,1,0,1],t=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],C=Array(36);for(e=0;6>e;e++)for(var E=0;6>E;E++)C[6*e+E]=e;const F=Array(36);for(e=0;6>e;e++)F[6*e]=0,F[6*e+1]=1,F[6*e+2]=2,F[6*e+3]=2,F[6*e+4]=3,F[6*e+5]=0;const H=[[-.5,0,-.5],[.5,0,-.5],
[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],K=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],I=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],L=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e=w.fromValues(-.5,0,-.5);E=w.fromValues(.5,0,-.5);const R=w.fromValues(0,0,.5),O=w.fromValues(0,.5,0),J=w.create(),M=w.create(),G=w.create(),P=w.create(),U=w.create();c.subtract(J,e,O);c.subtract(M,e,E);c.cross(G,J,M);c.normalize(G,G);c.subtract(J,E,O);c.subtract(M,E,R);c.cross(P,J,M);c.normalize(P,
P);c.subtract(J,R,O);c.subtract(M,R,e);c.cross(U,J,M);c.normalize(U,U);const N=[e,E,R,O],S=[0,-1,0,G[0],G[1],G[2],P[0],P[1],P[2],U[0],U[1],U[2]],Q=[0,1,2,3,1,0,3,2,1,3,0,2],W=[0,0,0,1,1,1,2,2,2,3,3,3],V=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],T=w.create();a.cgToGIS=function(X,Z=X){var Y=X.vertexAttributes;X=Y.get(h.VertexAttribute.POSITION).data;if(Y=Y.get(h.VertexAttribute.NORMAL).data){var aa=Z.getMutableAttribute(h.VertexAttribute.NORMAL).data;for(let ia=0;ia<Y.length;ia+=3){const na=Y[ia+1];aa[ia+
1]=-Y[ia+2];aa[ia+2]=na}}if(X)for(Z=Z.getMutableAttribute(h.VertexAttribute.POSITION).data,Y=0;Y<X.length;Y+=3)aa=X[Y+1],Z[Y+1]=-X[Y+2],Z[Y+2]=aa};a.createBoxGeometry=function(X,Z){Array.isArray(Z)||(Z=[Z,Z,Z]);const Y=Array(24);for(let aa=0;8>aa;aa++)Y[3*aa]=z[aa][0]*Z[0],Y[3*aa+1]=z[aa][1]*Z[1],Y[3*aa+2]=z[aa][2]*Z[2];return new u.Geometry(X,[[h.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(v,3)],[h.VertexAttribute.UV0,new d.Attribute(A,2)]],[[h.VertexAttribute.POSITION,
t],[h.VertexAttribute.NORMAL,C],[h.VertexAttribute.UV0,F]])};a.createConeGeometry=function(X,Z,Y,aa,ia,na=!0,ba=!0){let ea=0;var ja=w.fromValues(0,ea,0),ka=w.fromValues(0,ea+Z,0),da=w.fromValues(0,-1,0),ha=w.fromValues(0,1,0);ia&&(ea=Z,ka=w.fromValues(0,0,0),ja=w.fromValues(0,ea,0),da=w.fromValues(0,1,0),ha=w.fromValues(0,-1,0));ja=[ka,ja];da=[da,ha];ha=aa+2;ka=Math.sqrt(Z*Z+Y*Y);if(ia)for(ia=aa-1;0<=ia;ia--){var ca=2*Math.PI/aa*ia,fa=w.fromValues(Math.cos(ca)*Y,ea,Math.sin(ca)*Y);ja.push(fa);ca=
w.fromValues(Z*Math.cos(ca)/ka,-Y/ka,Z*Math.sin(ca)/ka);da.push(ca)}else for(ia=0;ia<aa;ia++)ca=2*Math.PI/aa*ia,fa=w.fromValues(Math.cos(ca)*Y,ea,Math.sin(ca)*Y),ja.push(fa),ca=w.fromValues(Z*Math.cos(ca)/ka,Y/ka,Z*Math.sin(ca)/ka),da.push(ca);Z=[];Y=[];if(na){for(na=3;na<ja.length;na++)Z.push(1),Z.push(na-1),Z.push(na),Y.push(0),Y.push(0),Y.push(0);Z.push(ja.length-1);Z.push(2);Z.push(1);Y.push(0);Y.push(0);Y.push(0)}if(ba){for(ba=3;ba<ja.length;ba++)Z.push(ba),Z.push(ba-1),Z.push(0),Y.push(ba),
Y.push(ba-1),Y.push(1);Z.push(0);Z.push(2);Z.push(ja.length-1);Y.push(1);Y.push(2);Y.push(da.length-1)}ba=m.newFloatArray(3*ha);for(na=0;na<ha;na++)ba[3*na]=ja[na][0],ba[3*na+1]=ja[na][1],ba[3*na+2]=ja[na][2];ja=m.newFloatArray(3*ha);for(na=0;na<ha;na++)ja[3*na]=da[na][0],ja[3*na+1]=da[na][1],ja[3*na+2]=da[na][2];da=[[h.VertexAttribute.POSITION,Z],[h.VertexAttribute.NORMAL,Y]];ja=[[h.VertexAttribute.POSITION,new d.Attribute(ba,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(ja,3,!0)]];return new u.Geometry(X,
ja,da)};a.createCylinderGeometry=function(X,Z,Y,aa,ia,na,ba){ia=ia?w.clone(ia):w.fromValues(1,0,0);na=na?w.clone(na):w.fromValues(0,0,0);ba??(ba=!0);var ea=w.create();c.normalize(ea,ia);var ja=w.create();c.scale(ja,ea,Math.abs(Z));var ka=w.create();c.scale(ka,ja,-.5);c.add(ka,ka,na);const da=w.fromValues(0,1,0);.2>Math.abs(1-c.dot(ea,da))&&c.set(da,0,0,1);const ha=w.create();c.cross(ha,ea,da);c.normalize(ha,ha);c.cross(da,ha,ea);const ca=2*aa+(ba?2:0),fa=aa+(ba?2:0);Z=m.newFloatArray(3*ca);na=m.newFloatArray(3*
fa);ia=m.newFloatArray(2*ca);const ma=Array(3*aa*(ba?4:2)),qa=Array(3*aa*(ba?4:2));ba&&(Z[3*(ca-2)]=ka[0],Z[3*(ca-2)+1]=ka[1],Z[3*(ca-2)+2]=ka[2],ia[2*(ca-2)]=0,ia[2*(ca-2)+1]=0,Z[3*(ca-1)]=Z[3*(ca-2)]+ja[0],Z[3*(ca-1)+1]=Z[3*(ca-2)+1]+ja[1],Z[3*(ca-1)+2]=Z[3*(ca-2)+2]+ja[2],ia[2*(ca-1)]=1,ia[2*(ca-1)+1]=1,na[3*(fa-2)]=-ea[0],na[3*(fa-2)+1]=-ea[1],na[3*(fa-2)+2]=-ea[2],na[3*(fa-1)]=ea[0],na[3*(fa-1)+1]=ea[1],na[3*(fa-1)+2]=ea[2]);ea=0;const wa=w.create(),xa=w.create();for(let Ba=0;Ba<aa;Ba++){var pa=
2*Math.PI/aa*Ba;c.scale(wa,da,Math.sin(pa));c.scale(xa,ha,Math.cos(pa));c.add(wa,wa,xa);na[3*Ba]=wa[0];na[3*Ba+1]=wa[1];na[3*Ba+2]=wa[2];c.scale(wa,wa,Y);c.add(wa,wa,ka);Z[3*Ba]=wa[0];Z[3*Ba+1]=wa[1];Z[3*Ba+2]=wa[2];ia[2*Ba]=Ba/aa;ia[2*Ba+1]=0;Z[3*(Ba+aa)]=Z[3*Ba]+ja[0];Z[3*(Ba+aa)+1]=Z[3*Ba+1]+ja[1];Z[3*(Ba+aa)+2]=Z[3*Ba+2]+ja[2];ia[2*(Ba+aa)]=Ba/aa;ia[2*Ba+1]=1;pa=(Ba+1)%aa;var ra=ea++,va=Ba;ma[ra]=Ba;qa[ra]=va;ra=ea++;va=Ba;ma[ra]=Ba+aa;qa[ra]=va;ra=ea++;va=pa;ma[ra]=pa;qa[ra]=va;ra=ea++;va=pa;
ma[ra]=pa;qa[ra]=va;ra=ea++;va=Ba;ma[ra]=Ba+aa;qa[ra]=va;ra=ea++;va=pa;ma[ra]=pa+aa;qa[ra]=va}if(ba){for(Y=0;Y<aa;Y++)ba=(Y+1)%aa,ja=ea++,ka=fa-2,ma[ja]=ca-2,qa[ja]=ka,ja=ea++,ka=fa-2,ma[ja]=Y,qa[ja]=ka,ja=ea++,ka=fa-2,ma[ja]=ba,qa[ja]=ka;for(Y=0;Y<aa;Y++)ba=(Y+1)%aa,ja=ea++,ka=fa-1,ma[ja]=Y+aa,qa[ja]=ka,ja=ea++,ka=fa-1,ma[ja]=ca-1,qa[ja]=ka,ja=ea++,ka=fa-1,ma[ja]=ba+aa,qa[ja]=ka}aa=[[h.VertexAttribute.POSITION,ma],[h.VertexAttribute.NORMAL,qa],[h.VertexAttribute.UV0,ma]];Z=[[h.VertexAttribute.POSITION,
new d.Attribute(Z,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(na,3,!0)],[h.VertexAttribute.UV0,new d.Attribute(ia,2,!0)]];return new u.Geometry(X,Z,aa)};a.createDiamondGeometry=function(X,Z){Array.isArray(Z)||(Z=[Z,Z,Z]);const Y=Array(18);for(let aa=0;6>aa;aa++)Y[3*aa]=H[aa][0]*Z[0],Y[3*aa+1]=H[aa][1]*Z[1],Y[3*aa+2]=H[aa][2]*Z[2];return new u.Geometry(X,[[h.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(K,3)]],[[h.VertexAttribute.POSITION,I],[h.VertexAttribute.NORMAL,
L]])};a.createExtrudedTriangle=function(X,Z,Y,aa,ia,na=0){const ba=Array(18);Z=[[-Y,na,ia/2],[aa,na,ia/2],[0,Z+na,ia/2],[-Y,na,-ia/2],[aa,na,-ia/2],[0,Z+na,-ia/2]];for(Y=0;6>Y;Y++)ba[3*Y]=Z[Y][0],ba[3*Y+1]=Z[Y][1],ba[3*Y+2]=Z[Y][2];return new u.Geometry(X,[[h.VertexAttribute.POSITION,new d.Attribute(ba,3,!0)]],[[h.VertexAttribute.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])};a.createPathExtrusionGeometry=q;a.createPointGeometry=function(X,Z,Y,aa,ia,na,ba,ea,ja=null){Y=Y?[Y[0],Y[1],
Y[2]]:[0,0,0];Z=Z?[Z[0],Z[1],Z[2]]:[0,0,1];ba=ba||[0,0];aa=aa?[255*aa[0],255*aa[1],255*aa[2],3<aa.length?255*aa[3]:255]:[255,255,255,255];ia=b.isSome(ia)&&2===ia.length?ia:[1,1];ba=[[h.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(Z,3,!0)],[h.VertexAttribute.UV0,new d.Attribute(ba,ba.length)],[h.VertexAttribute.COLOR,new d.Attribute(aa,4,!0)],[h.VertexAttribute.SIZE,new d.Attribute(ia,2)]];null!=na&&ba.push([h.VertexAttribute.AUXPOS1,new d.Attribute([na[0],
na[1],na[2],na[3]],4)]);null!=ea&&ba.push([h.VertexAttribute.AUXPOS2,new d.Attribute([ea[0],ea[1],ea[2],ea[3]],4)]);return new u.Geometry(X,ba,null,null,k.ContentObjectType.Point,ja)};a.createPolySphereData=r;a.createPolySphereGeometry=function(X,Z,Y,aa){const {vertexAttributes:ia,indices:na}=r(Z,Y,aa);return new u.Geometry(X,ia,na)};a.createPolylineGeometry=function(X,Z,Y,aa){p.assert(1<Z.length,"createPolylineGeometry(): polyline needs at least 2 points");p.assert(3===Z[0].length,"createPolylineGeometry(): malformed vertex");
p.assert(null==Y||Y.length===Z.length,"createPolylineGeometry: need same number of points and normals");p.assert(null==Y||3===Y[0].length,"createPolylineGeometry(): malformed normal");var ia=x.newDoubleArray(3*Z.length);const na=Array(2*(Z.length-1));var ba=0,ea=0;for(var ja=0;ja<Z.length;ja++){for(var ka=0;3>ka;ka++)ia[ba++]=Z[ja][ka];0<ja&&(na[ea++]=ja-1,na[ea++]=ja)}ba=[];ea=[];ba.push([h.VertexAttribute.POSITION,na]);ea.push([h.VertexAttribute.POSITION,new d.Attribute(ia,3,!0)]);if(Y){ia=m.newFloatArray(3*
Y.length);ja=0;for(ka=0;ka<Z.length;ka++)for(let da=0;3>da;da++)ia[ja++]=Y[ka][da];ba.push([h.VertexAttribute.NORMAL,na]);ea.push([h.VertexAttribute.NORMAL,new d.Attribute(ia,3,!0)])}aa&&(ea.push([h.VertexAttribute.COLOR,new d.Attribute(aa,4)]),ba.push([h.VertexAttribute.COLOR,l.getContinuousIndexArray(aa.length/4)]));return new u.Geometry(X,ea,ba,null,k.ContentObjectType.Line)};a.createSphereGeometry=function(X,Z,Y,aa,ia={uv:!0}){var na=-Math.PI,ba=2*Math.PI,ea=-Math.PI/2,ja=Math.PI;Y=Math.max(3,
Math.floor(Y));const ka=Math.max(2,Math.floor(aa));var da=(Y+1)*(ka+1);aa=m.newFloatArray(3*da);const ha=m.newFloatArray(3*da);da=m.newFloatArray(2*da);const ca=[];var fa=0;for(var ma=0;ma<=ka;ma++){const wa=[],xa=ma/ka,pa=ea+xa*ja,ra=Math.cos(pa);for(let va=0;va<=Y;va++){const Ba=va/Y;var qa=na+Ba*ba;const Aa=Math.cos(qa)*ra,Ha=Math.sin(pa);qa=-Math.sin(qa)*ra;aa[3*fa]=Aa*Z;aa[3*fa+1]=Ha*Z;aa[3*fa+2]=qa*Z;ha[3*fa]=Aa;ha[3*fa+1]=Ha;ha[3*fa+2]=qa;da[2*fa]=Ba;da[2*fa+1]=xa;wa.push(fa);++fa}ca.push(wa)}Z=
[];for(na=0;na<ka;na++)for(ba=0;ba<Y;ba++)ea=ca[na][ba],ja=ca[na][ba+1],fa=ca[na+1][ba+1],ma=ca[na+1][ba],0===na?(Z.push(ea),Z.push(fa),Z.push(ma)):na===ka-1?(Z.push(ea),Z.push(ja),Z.push(fa)):(Z.push(ea),Z.push(ja),Z.push(fa),Z.push(fa),Z.push(ma),Z.push(ea));Y=[[h.VertexAttribute.POSITION,Z],[h.VertexAttribute.NORMAL,Z]];aa=[[h.VertexAttribute.POSITION,new d.Attribute(aa,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(ha,3,!0)]];ia.uv&&(aa.push([h.VertexAttribute.UV0,new d.Attribute(da,2,!0)]),
Y.push([h.VertexAttribute.UV0,Z]));ia.offset&&(Y[0][0]=h.VertexAttribute.OFFSET,aa[0][0]=h.VertexAttribute.OFFSET,Y.push([h.VertexAttribute.POSITION,l.getZeroIndexArray(Z.length)]),aa.push([h.VertexAttribute.POSITION,new d.Attribute(Float64Array.from(ia.offset),3,!0)]));return new u.Geometry(X,aa,Y)};a.createSquareGeometry=function(X,Z=V){var Y=Array(12);for(var aa=0;4>aa;aa++)for(let ia=0;3>ia;ia++)Y[3*aa+ia]=Z[aa][ia];Z=[0,1,2,2,3,0];aa=[0,0,0,0,0,0];Z=[[h.VertexAttribute.POSITION,Z],[h.VertexAttribute.NORMAL,
aa],[h.VertexAttribute.UV0,Z],[h.VertexAttribute.COLOR,aa]];Y=[[h.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute([0,0,1],3,!0)],[h.VertexAttribute.UV0,new d.Attribute([0,0,1,0,1,1,0,1],2,!0)],[h.VertexAttribute.COLOR,new d.Attribute([255,255,255,255],4,!0)]];return new u.Geometry(X,Y,Z)};a.createTetrahedronGeometry=function(X,Z){Array.isArray(Z)||(Z=[Z,Z,Z]);const Y=Array(12);for(let aa=0;4>aa;aa++)Y[3*aa]=N[aa][0]*Z[0],Y[3*aa+1]=N[aa][1]*Z[1],Y[3*aa+2]=
N[aa][2]*Z[2];return new u.Geometry(X,[[h.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[h.VertexAttribute.NORMAL,new d.Attribute(S,3)]],[[h.VertexAttribute.POSITION,Q],[h.VertexAttribute.NORMAL,W]])};a.createTubeGeometry=function(X,Z,Y,aa,ia,na){aa=aa||10;ia=null!=ia?ia:!0;p.assert(1<Z.length);const ba=[],ea=[];for(let ja=0;ja<aa;ja++){ba.push([0,-ja-1,-((ja+1)%aa)-1]);const ka=ja/aa*2*Math.PI;ea.push([Math.cos(ka)*Y,Math.sin(ka)*Y])}return q(X,ea,Z,[[0,0,0]],ba,ia,na)};a.makeOrthoBasisDirUpFallback=
B;a.transformInPlace=function(X,Z){X=X.getMutableAttribute(h.VertexAttribute.POSITION).data;for(let Y=0;Y<X.length;Y+=3)c.set(T,X[Y],X[Y+1],X[Y+2]),c.transformMat4(T,T,Z),X[Y]=T[0],X[Y+1]=T[1],X[Y+2]=T[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.doubleArrayFrom=function(c){return(b.isArray(c)?c.length:c.byteLength/8)<=b.NATIVE_ARRAY_MAX_SIZE?Array.from(c):new Float64Array(c)};
a.doubleSubArray=function(c,w,n){return Array.isArray(c)?c.slice(w,w+n):c.subarray(w,w+n)};a.newDoubleArray=function(c,w=!1){return c<=b.NATIVE_ARRAY_MAX_SIZE?w?Array(c).fill(0):Array(c):new Float64Array(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.floatArrayFrom=function(c){return(b.isArray(c)?c.length:c.byteLength/8)<=b.NATIVE_ARRAY_MAX_SIZE?Array.from(c):new Float32Array(c)};
a.floatSubArray=function(c,w,n){return Array.isArray(c)?c.slice(w,w+n):c.subarray(w,w+n)};a.newFloatArray=function(c,w=!1){return c<=b.NATIVE_ARRAY_MAX_SIZE?w?Array(c).fill(0):Array(c):new Float32Array(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){let c=(()=>{const m=new Uint32Array(131072);for(let l=0;l<m.length;++l)m[l]=l;return m})();const w=[0],n=(()=>{const m=new Uint16Array(65536);
for(let l=0;l<m.length;++l)m[l]=l;return m})();let x=new Uint16Array(65536);a.compactIndices=function(m){if(b.isArray(m)){if(m.length<b.NATIVE_ARRAY_MAX_SIZE)return m;for(const l of m)if(65536<=l)return new Uint32Array(m);return new Uint16Array(m)}if(m.length<b.NATIVE_ARRAY_MAX_SIZE)return Array.from(m);if(m.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return m;for(const l of m)if(65536<=l)return m;return new Uint16Array(m)};a.getContinuousIndexArray=function(m){if(1===m)return w;if(m<b.NATIVE_ARRAY_MAX_SIZE)return Array.from(new Uint16Array(n.buffer,
0,m));if(m<n.length)return new Uint16Array(n.buffer,0,m);if(m>c.length){c=new Uint32Array(Math.max(2*c.length,m));for(let l=0;l<c.length;l++)c[l]=l}return new Uint32Array(c.buffer,0,m)};a.getZeroIndexArray=function(m){if(1===m)return w;if(m<b.NATIVE_ARRAY_MAX_SIZE)return Array(m).fill(0);m>x.length&&(x=new Uint16Array(Math.max(2*x.length,m)));return new Uint16Array(x.buffer,0,m)};a.newIndexArray=function(m){return m<=b.NATIVE_ARRAY_MAX_SIZE?Array(m):65536>=m?new Uint16Array(m):new Uint32Array(m)};
a.newIntArray=function(m){return m<=b.NATIVE_ARRAY_MAX_SIZE?Array(m):new Uint32Array(m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,w,n=!1,x=w){this.data=c;this.size=w;this.exclusive=n;this.stride=x});a.Attribute=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],
function(a){a.Vec3Compact=void 0;(function(b){b.length=function(c,w){const n=c[w],x=c[w+1];c=c[w+2];return Math.sqrt(n*n+x*x+c*c)};b.normalize=function(c,w){var n=c[w];const x=c[w+1],m=c[w+2];n=1/Math.sqrt(n*n+x*x+m*m);c[w]*=n;c[w+1]*=n;c[w+2]*=n};b.scale=function(c,w,n){c[w]*=n;c[w+1]*=n;c[w+2]*=n};b.add=function(c,w,n,x,m,l=w){m=m||c;m[l]=c[w]+n[x];m[l+1]=c[w+1]+n[x+1];m[l+2]=c[w+2]+n[x+2]};b.subtract=function(c,w,n,x,m,l=w){m=m||c;m[l]=c[w]-n[x];m[l+1]=c[w+1]-n[x+1];m[l+2]=c[w+2]-n[x+2]}})(a.Vec3Compact||
(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Mesh=2]="Mesh";b[b.Line=3]="Line";b[b.Point=4]="Point";b[b.Material=5]="Material";b[b.Texture=6]="Texture";b[b.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../geometry/support/Indices ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){f=function(r){function q(B,D,z=[],v=null,A=d.ContentObjectType.Mesh,t=null,C=-1){var E=y.call(this);E.material=B;E.mapPositions=v;E.type=A;E.objectAndLayerIdColor=t;E.edgeIndicesLength=C;E.visible=!0;E._vertexAttributes=new Map;E._indices=new Map;E._boundingInfo=null;for(const [F,H]of D)H&&E._vertexAttributes.set(F,{...H});if(null==z||0===z.length){B=E._vertexAttributes.values().next().value;B=null==B?0:B.data.length/B.size;D=x.getContinuousIndexArray(B);
E.edgeIndicesLength=0>E.edgeIndicesLength?B:E.edgeIndicesLength;for(const F of E._vertexAttributes.keys())E._indices.set(F,D)}else for(const [F,H]of z)H&&(E._indices.set(F,x.compactIndices(H)),F===p.VertexAttribute.POSITION&&(E.edgeIndicesLength=0>E.edgeIndicesLength?E._indices.get(F).length:E.edgeIndicesLength));return E}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.instantiate=function(B={}){const D=new q(B.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,
this.edgeIndicesLength);this._vertexAttributes.forEach((z,v)=>{z.exclusive=!1;D._vertexAttributes.set(v,z)});this._indices.forEach((z,v)=>D._indices.set(v,z));D._boundingInfo=this._boundingInfo;D.transformation=B.transformation||this.transformation;return D};r.getMutableAttribute=function(B){let D=this._vertexAttributes.get(B);D&&!D.exclusive&&(D={...D,exclusive:!0,data:m.cloneAttributeData(D.data)},this._vertexAttributes.set(B,D));return D};r.setAttributeData=function(B,D){const z=this._vertexAttributes.get(B);
z&&this._vertexAttributes.set(B,{...z,exclusive:!0,data:D})};r.computeAttachmentOrigin=function(B){return(this.type===d.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(B):this.type===d.ContentObjectType.Line?this._computeAttachmentOriginLines(B):this._computeAttachmentOriginPoints(B))?(c.isSome(this._transformation)&&n.transformMat4(B,B,this._transformation),!0):!1};r._computeAttachmentOriginTriangles=function(B){const D=this.indices.get(p.VertexAttribute.POSITION),z=this.vertexAttributes.get(p.VertexAttribute.POSITION);
return e.computeAttachmentOriginTriangles(z,D,B)};r._computeAttachmentOriginLines=function(B){const D=this.vertexAttributes.get(p.VertexAttribute.POSITION),z=this.indices.get(p.VertexAttribute.POSITION);var v=e.computeAttachmentOriginLines,A;if(A=z)A=this.material.parameters,A="isClosed"in A&&A.isClosed?z?2<z.length:6<D.data.length:!1;return v.call(e,D,z,A,B)};r._computeAttachmentOriginPoints=function(B){const D=this.indices.get(p.VertexAttribute.POSITION),z=this.vertexAttributes.get(p.VertexAttribute.POSITION);
return e.computeAttachmentOriginPoints(z,D,B)};r.invalidateBoundingInfo=function(){this._boundingInfo=null};r._calculateBoundingInfo=function(){const B=this.indices.get(p.VertexAttribute.POSITION),D=this.vertexAttributes.get(p.VertexAttribute.POSITION);if(!B||0===B.length||!D)return null;const z=this.type===d.ContentObjectType.Mesh?3:1;u.assert(0===B.length%z,"Indexing error: "+B.length+" not divisible by "+z);const v=x.getContinuousIndexArray(B.length/z);return new g.BoundingInfo(v,z,B,D)};r.addHighlight=
function(){const B=new k.Object3DStateID(l.Object3DState.Highlight);this.highlights=h.addObject3DStateID(this.highlights,B);return B};r.removeHighlight=function(B){this.highlights=h.removeObject3DStateID(this.highlights,B)};b._createClass(q,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const B=this._indices.values().next().value;return B?B.length:0}},{key:"faceCount",get:function(){return this.indexCount/
3}},{key:"boundingInfo",get:function(){c.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}},{key:"transformation",get:function(){return c.unwrapOr(this._transformation,w.IDENTITY)},set:function(B){this._transformation=B&&B!==w.IDENTITY?w.clone(B):null}},{key:"shaderTransformation",get:function(){return c.isSome(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}},{key:"shaderTransformer",get:function(){return this._shaderTransformer},
set:function(B){this._shaderTransformer=B}},{key:"hasVolatileTransformation",get:function(){return c.isSome(this._shaderTransformer)}}]);return q}(f.ContentObject);a.Geometry=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,b){a.cloneAttributeData=function(c){if(c.length<b.NATIVE_ARRAY_MAX_SIZE)return Array.from(c);if(b.isArray(c))return Float64Array.from(c);
switch(c.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(c);case 2:return Uint16Array.from(c);case 4:return Float32Array.from(c);default:case 8:return Float64Array.from(c)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Util".split(" "),function(a,b,c,w,n,x){let m=function(){function g(f,
d,e,k){this.primitiveIndices=f;this._numIndexPerPrimitive=d;this.indices=e;this.position=k;this._children=void 0;x.assert(1<=f.length);x.assert(0===e.length%this._numIndexPerPrimitive);x.assert(e.length>=f.length*this._numIndexPerPrimitive);x.assert(3===k.size||4===k.size);const {data:u,size:p}=k;var h=f.length;d=p*e[this._numIndexPerPrimitive*f[0]];l.clear();l.push(d);k=n.fromValues(u[d],u[d+1],u[d+2]);var r=n.clone(k);for(var q=0;q<h;++q){var y=this._numIndexPerPrimitive*f[q];for(let B=0;B<this._numIndexPerPrimitive;++B){d=
p*e[y+B];l.push(d);let D=u[d];k[0]=Math.min(D,k[0]);r[0]=Math.max(D,r[0]);D=u[d+1];k[1]=Math.min(D,k[1]);r[1]=Math.max(D,r[1]);D=u[d+2];k[2]=Math.min(D,k[2]);r[2]=Math.max(D,r[2])}}this.bbMin=k;this.bbMax=r;f=w.lerp(n.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(r[0]-k[0],r[1]-k[1]),r[2]-k[2]);e=this.radius*this.radius;for(k=0;k<l.length;++k)d=l.getItemAt(k),r=u[d]-f[0],h=u[d+1]-f[1],d=u[d+2]-f[2],q=r*r+h*h+d*d,q<=e||(q=Math.sqrt(q),y=.5*(q-this.radius),this.radius+=y,e=this.radius*
this.radius,q=y/q,f[0]+=r*q,f[1]+=h*q,f[2]+=d*q);this.center=f;l.clear()}g.prototype.getChildren=function(){if(this._children||1>=w.squaredDistance(this.bbMin,this.bbMax))return this._children;var f=w.lerp(n.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length;const e=new Uint8Array(d),k=Array(8);for(var u=0;8>u;++u)k[u]=0;const {data:p,size:h}=this.position;for(u=0;u<d;++u){var r=0;const y=this._numIndexPerPrimitive*this.primitiveIndices[u];var q=h*this.indices[y];let B=p[q],D=p[q+1],
z=p[q+2];for(let v=1;v<this._numIndexPerPrimitive;++v){q=h*this.indices[y+v];const A=p[q],t=p[q+1];q=p[q+2];A<B&&(B=A);t<D&&(D=t);q<z&&(z=q)}B<f[0]&&(r|=1);D<f[1]&&(r|=2);z<f[2]&&(r|=4);e[u]=r;++k[r]}f=0;for(u=0;8>u;++u)0<k[u]&&++f;if(!(2>f)){f=Array(8);for(u=0;8>u;++u)f[u]=0<k[u]?new Uint32Array(k[u]):void 0;for(u=0;8>u;++u)k[u]=0;for(u=0;u<d;++u)r=e[u],f[r][k[r]++]=this.primitiveIndices[u];this._children=[];for(d=0;8>d;++d)void 0!==f[d]&&this._children.push(new g(f[d],this._numIndexPerPrimitive,
this.indices,this.position));return this._children}};g.prune=function(){l.prune()};return b._createClass(g)}();const l=new c({deallocator:null});a.BoundingInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,w,n){function x(g,f){if(!g)throw f=f||"Assertion",new l(`${f} at ${Error(f).stack}`);
}const m=n.create();let l=function(){function g(f){this.message=f}g.prototype.toString=function(){return`AssertException: ${this.message}`};return b._createClass(g)}();a.assert=x;a.isTranslationMatrix=function(g){return 1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&1===g[10]&&0===g[11]&&1===g[15]};a.logWithBase=function(g,f){return Math.log(g)/Math.log(f)};a.project=function(g,f,d,e,k){m[0]=g[0];m[1]=g[1];m[2]=g[2];m[3]=1;w.transformMat4(m,m,f);
2<k.length&&(k[2]=-m[2]);w.transformMat4(m,m,d);x(0!==m[3]);k[0]=m[0]/m[3];k[1]=m[1]/m[3];k[2]=m[2]/m[3];k[0]=(.5*k[0]+.5)*e[2]+e[0];k[1]=(.5*k[1]+.5)*e[3]+e[1]};a.rayBoxTest=function(g,f,d,e){let k,u=(d[0]-g[0])/f[0],p=(e[0]-g[0])/f[0];u>p&&(k=u,u=p,p=k);let h=(d[1]-g[1])/f[1],r=(e[1]-g[1])/f[1];h>r&&(k=h,h=r,r=k);if(u>r||h>p)return!1;h>u&&(u=h);r<p&&(p=r);d=(d[2]-g[2])/f[2];g=(e[2]-g[2])/f[2];d>g&&(k=d,d=g,g=k);if(u>g||d>p)return!1;g<p&&(p=g);return 0>p?!1:!0};a.rayRay2D=function(g,f,d,e,k,u=c.create()){const p=
(e[k]-d[k])*(f[0]-g[0])-(e[0]-d[0])*(f[k]-g[k]);if(0===p)return!1;d=((e[0]-d[0])*(g[k]-d[k])-(e[k]-d[k])*(g[0]-d[0]))/p;u[0]=g[0]+d*(f[0]-g[0]);u[1]=g[k]+d*(f[k]-g[k]);return!0};a.setMatrixTranslation3=function(g,f,d,e){g[12]=f;g[13]=d;g[14]=e};a.verify=function(g,f){g||console.warn("Verify failed: "+(f||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/uid"],function(a,b,c){let w=function(){function n(){this.id=c.generateUID()}n.prototype.unload=function(){};return b._createClass(n)}();a.ContentObject=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,b,c,w){const n=c.create(),x=c.create(),m=c.create(),l=c.create();a.computeAttachmentOriginLines=
function(g,f,d,e){if(!g)return!1;b.set(e,0,0,0);b.set(l,0,0,0);let k=0,u=0;const {size:p,data:h}=g;g=f?f.length-1:h.length/p-1;d=g+(d?2:0);for(let y=0;y<d;y+=2){var r=y<g?y:g,q=y<g?y+1:0;r=(f?f[r]:r)*p;q=(f?f[q]:q)*p;n[0]=h[r];n[1]=h[r+1];n[2]=h[r+2];x[0]=h[q];x[1]=h[q+1];x[2]=h[q+2];b.scale(n,b.add(n,n,x),.5);q=b.dist(n,x);0<q?(b.add(e,e,b.scale(n,n,q)),k+=q):0===k&&(b.add(l,l,n),u++)}return 0!==k?(b.scale(e,e,1/k),!0):0!==u?(b.scale(e,l,1/u),!0):!1};a.computeAttachmentOriginPoints=function(g,f,
d){if(!g||!f)return!1;const {size:e,data:k}=g;b.set(d,0,0,0);g=-1;let u=0;for(let p=0;p<f.length;p++){const h=f[p]*e;g!==h&&(d[0]+=k[h],d[1]+=k[h+1],d[2]+=k[h+2],u++);g=h}1<u&&b.scale(d,d,1/u);return 0<u};a.computeAttachmentOriginTriangles=function(g,f,d){if(!g||!f)return!1;const {size:e,data:k}=g;b.set(d,0,0,0);b.set(l,0,0,0);let u=g=0;for(let h=0;h<f.length-2;h+=3){var p=f[h]*e;const r=f[h+1]*e,q=f[h+2]*e;b.set(n,k[p],k[p+1],k[p+2]);b.set(x,k[r],k[r+1],k[r+2]);b.set(m,k[q],k[q+1],k[q+2]);(p=w.areaPoints3d(n,
x,m))?(b.add(n,n,x),b.add(n,n,m),b.scale(n,n,1/3*p),b.add(d,d,n),g+=p):(b.add(l,l,n),b.add(l,l,x),b.add(l,l,m),u+=3)}return 0===u&&0===g?!1:0!==g?(b.scale(d,d,1/g),!0):0!==u?(b.scale(d,l,1/u),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,w,n,x){function m(u){return u?{p0:w.clone(u.p0),p1:w.clone(u.p1),
p2:w.clone(u.p2)}:{p0:w.create(),p1:w.create(),p2:w.create()}}function l(u,p,h,r=m()){c.copy(r.p0,u);c.copy(r.p1,p);c.copy(r.p2,h);return r}function g(u,p,h){return.5*Math.abs((p[0]-u[0])*(h[1]-u[1])-(p[1]-u[1])*(h[0]-u[0]))}const f=new b.ObjectStack(n.create),d=new b.ObjectStack(()=>m()),e=w.create(),k=w.create();a.area2d=function(u){return g(u.p0,u.p1,u.p2)};a.areaPoints2d=g;a.areaPoints3d=function(u,p,h){c.subtract(e,p,u);c.subtract(k,h,u);return c.length(c.cross(e,e,k))/2};a.copy=function(u,p=
m()){return l(u.p0,u.p1,u.p2,p)};a.create=m;a.distance2=function(u,p){var h=u.p0,r=u.p1;u=u.p2;const q=c.subtract(x.sv3d.get(),r,h),y=c.subtract(x.sv3d.get(),u,r),B=c.subtract(x.sv3d.get(),h,u),D=c.subtract(x.sv3d.get(),p,h);var z=c.subtract(x.sv3d.get(),p,r),v=c.subtract(x.sv3d.get(),p,u);const A=c.cross(q,q,B),t=c.dot(c.cross(x.sv3d.get(),q,A),D);z=c.dot(c.cross(x.sv3d.get(),y,A),z);v=c.dot(c.cross(x.sv3d.get(),B,A),v);if(0<t&&0<z&&0<v)return p=c.dot(A,D),p*p/c.dot(A,A);h=n.distance2(n.fromValues(h,
q,f.get()),p);r=n.distance2(n.fromValues(r,y,f.get()),p);p=n.distance2(n.fromValues(u,B,f.get()),p);return Math.min(h,r,p)};a.fromValues=l;a.intersectRay=function(u,p,h){const {direction:r,origin:q}=p,{p0:y,p1:B,p2:D}=u;var z=B[0]-y[0],v=B[1]-y[1],A=B[2]-y[2];u=D[0]-y[0];p=D[1]-y[1];const t=D[2]-y[2];var C=r[1]*t-p*r[2],E=r[2]*u-t*r[0];const F=r[0]*p-u*r[1];var H=z*C+v*E+A*F;if(-1E-5<H&&1E-5>H)return!1;H=1/H;const K=q[0]-y[0],I=q[1]-y[1],L=q[2]-y[2];C=H*(K*C+I*E+L*F);if(0>C||1<C)return!1;E=I*A-v*
L;A=L*z-A*K;z=K*v-z*I;v=H*(r[0]*E+r[1]*A+r[2]*z);if(0>v||1<C+v)return!1;h&&(c.scale(h,r,H*(u*E+p*A+t*z)),c.add(h,q,h));return!0};a.wrap=function(u,p,h){const r=d.get();r.p0=u;r.p1=p;r.p2=h;return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/uid"],function(a,b,c){b=b._createClass(function(w){this.channel=w;this.id=c.generateUID()});a.Object3DStateID=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports","../../../../../core/maybe","../../../../../chunks/vec3f64","../../../../webgl/doublePrecisionUtils"],function(a,b,c,w){const n=c.create(),x=new Float32Array(6);a.addObject3DStateID=function(m,l){b.isNone(m)&&(m=[]);m.push(l);return m};a.encodeDoubleVec3=function(m,l,g,f,d){n[0]=m.get(l,0);n[1]=m.get(l,1);n[2]=m.get(l,2);w.encodeDoubleArray(n,x,3);g.set(d,
0,x[0]);f.set(d,0,x[1]);g.set(d,1,x[2]);f.set(d,1,x[3]);g.set(d,2,x[4]);f.set(d,2,x[5])};a.removeObject3DStateID=function(m,l){if(b.isNone(m))return null;m=m.filter(g=>g!==l);return 0===m.length?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(c,w,n){for(let x=0;x<n;++x)w[x]=c[2*x]+c[2*x+1]};a.encodeDoubleArray=function(c,w,n){for(let x=
0;x<n;++x)w[2*x]=c[x],w[2*x+1]=c[x]-w[2*x]};a.encodeDoubleHi=function(c,w){const n=c.length;for(let x=0;x<n;++x)b[0]=c[x],w[x]=b[0];return w};a.encodeDoubleLo=function(c,w){const n=c.length;for(let x=0;x<n;++x)b[0]=c[x],b[1]=c[x]-b[0],w[x]=b[1];return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A){a.Precipitation=function(E){function F(K){var I=H.call(this,K);I._numParticles=25E4;I._rainSpeed=.1;I._snowSpeed=.01;I._passParameters=new p.PrecipitationPassParameters;I._animation=new y.AnimationTimer;I._updatingTracking=new k.WatchUpdatingTracking;I._passParameters.time=0;I._passParameters.radius=u.getReferenceEllipsoid(K.view.spatialReference).radius;I._techniqueRepository=K.context.techniqueRepository;return I}b._inherits(F,E);var H=b._createSuper(F);
E=F.prototype;E.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechniqueCached=x.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=x.releaseMaybe(this._rainTechniqueCached);this._vao=x.disposeMaybe(this._vao);this._instanceIdBuffer=x.disposeMaybe(this._instanceIdBuffer)};E.update=function(K){return this._animation.advance(K)};E.render=function(K,I,L){const R="rainy"===L?this._rainTechnique:this._snowTechnique;if(R.compiled){var O=K.rctx;this._ensureResources(O);
x.isNone(R)||x.isNone(this._vao)||x.isNone(this._instanceIdBuffer)||(x.isSome(K.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-K.bindParameters.cloudsFade.fadeInOutHeight.factor),0>=this._passParameters.opacity||(I=.5>I?n.lerp(0,.35,2*I):n.lerp(.35,1,2*(I-.5)),this._passParameters.time=("rainy"===L?this._rainSpeed:this._snowSpeed)*m.secondsFromMilliseconds(this._animation.time)%1E5,K=O.bindTechnique(R,this._passParameters,K.bindParameters),O.bindVAO(this._vao),K.assertCompatibleVertexAttributeLocations(this._vao),
A.bindVertexBufferLayout(O,p.attributeLocations,this._instanceIdBuffer,C,0),O.capabilities.instancing?.drawArraysInstanced(v.PrimitiveType.TRIANGLES,0,3,this._numParticles*I),A.unbindVertexBufferLayout(O,p.attributeLocations,this._instanceIdBuffer,C)))}else this.context.requestRender()};E._ensureResources=function(K){x.isNone(this._vao)&&(this._vao=this._createVertexArrayObject(K));x.isNone(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(K))};E._createInstanceIndices=
function(K){const I=[];for(let L=0;L<this._numParticles;L++)I.push(L);return z.BufferObject.createVertex(K,v.Usage.STATIC_DRAW,new Float32Array(I))};E._createVertexArrayObject=function(K){const I=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new B.VertexArrayObject(K,p.attributeLocations,{geometry:r.glLayout(t)},{geometry:z.BufferObject.createVertex(K,v.Usage.STATIC_DRAW,I)})};b._createClass(F,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"_rainTechnique",get:function(){if(x.isNone(this._rainTechniqueCached)){const K=
new h.PrecipitationTechniqueConfiguration;K.type=h.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(p.PrecipitationTechnique,K)}return this._rainTechniqueCached}},{key:"_snowTechnique",get:function(){if(x.isNone(this._snowTechniqueCached)){const K=new h.PrecipitationTechniqueConfiguration;K.type=h.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(p.PrecipitationTechnique,K)}return this._snowTechniqueCached}}]);return F}(w);c.__decorate([l.property({constructOnly:!0})],
a.Precipitation.prototype,"context",void 0);c.__decorate([l.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([l.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);c.__decorate([l.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([e.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const t=q.newLayout().vec3f(D.VertexAttribute.POSITION),C=r.glLayout(q.newLayout().f32(D.VertexAttribute.INSTANCEFEATUREATTRIBUTE),
1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){n=function(k){function u(){var h=p.apply(this,arguments);h.time=0;h.radius=1;h.width=500;h.opacity=1;return h}c._inherits(u,k);var p=c._createSuper(u);return c._createClass(u)}(n.NoParameters);m=function(k){function u(){return p.apply(this,arguments)}c._inherits(u,k);var p=c._createSuper(u);k=u.prototype;k.initializeProgram=function(h){return new l.Program(h.rctx,u.shader.get().build(this.configuration),e)};k.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.ONE,
f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return c._createClass(u)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(w.Precipitation,()=>new Promise((k,u)=>a(["./Precipitation.glsl"],k,u)));const e=new Map([[g.VertexAttribute.POSITION,0],[g.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=n;b.PrecipitationTechnique=m;b.attributeLocations=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec3 ./vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(h){const r=new g.ShaderBuilder;r.attributes.add(f.VertexAttribute.POSITION,"vec3");r.attributes.add(f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");r.vertex.uniforms.add(new n.Float3PassUniform("cameraPosition",(q,y)=>y.camera.eye));r.vertex.uniforms.add(new n.Float3PassUniform("offset",(q,y)=>{y=y.camera.eye;var B=.5*q.width;const D=1/q.width;B=b.floor(e,b.set(e,(y[0]+B)*D,(y[1]+B)*D,(y[2]+B)*D));return b.sub(B,y,b.scale(B,B,q.width))}));r.vertex.uniforms.add(new x.FloatPassUniform("width",
q=>q.width));r.vertex.uniforms.add(new l.Matrix4PassUniform("proj",(q,y)=>y.camera.projectionMatrix));r.vertex.uniforms.add(new l.Matrix4PassUniform("view",(q,y)=>y.camera.viewMatrix));r.vertex.uniforms.add(new x.FloatPassUniform("time",q=>q.time));r.varyings.add("vUv","vec2");r.vertex.code.add(m.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${h.type===w.PrecipitationType.Rain?m.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:m.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);r.fragment.uniforms.add([new x.FloatPassUniform("opacity",q=>q.opacity),new n.Float3PassUniform("particleColor",(q,y)=>{q=h.type===w.PrecipitationType.Rain?p:u;const B=b.scale(e,q,.7);b.normalize(k,y.camera.eye);y=Math.max(0,b.dot(k,y.lighting.mainLight.direction));return b.lerp(B,B,q,y)})]);r.fragment.code.add(m.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${h.type===w.PrecipitationType.Rain?m.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:m.glsl`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `);return r}const e=c.create(),k=c.create(),u=c.fromValues(1,1,1),p=c.fromValues(.85,.85,.85);c=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.Precipitation=c;a.build=d})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){a.PrecipitationType=void 0;
(function(x){x[x.Rain=0]="Rain";x[x.Snow=1]="Snow";x[x.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));let n=function(x){function m(){var g=l.apply(this,arguments);g.type=a.PrecipitationType.Rain;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter({count:a.PrecipitationType.COUNT})],n.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/time"],function(a,b,c,w){let n=function(){function m(){this.enabled=!0;this._time=w.Milliseconds(0)}m.prototype.advance=function({deltaTime:l,fixedTime:g}){if(c.isSome(g)){if(this._time===g)return!1;this._time=g;return!0}this._time=w.Milliseconds(this._time+l);return 0!==l};b._createClass(m,[{key:"time",get:function(){return this._time}}]);
return m}(),x=b._createClass(function(m,l){this.deltaTime=m;this.fixedTime=l});a.AnimationTimer=n;a.Parameters=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ../../../geometry/support/spatialReferenceUtils ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I){function L(U,N,S,Q,W){const V=l.length(U),T=Q*Math.sqrt(V*V-Q*Q)/V,X=W.v1,Z=W.v2;l.scale(W.center,U,Math.sqrt(Q*Q-T*T)/V);l.cross(X,U,N);1>l.squaredLength(X)&&l.cross(X,U,S);l.scale(X,X,T/l.length(X));l.cross(Z,X,U);l.scale(Z,Z,T/l.length(Z));return T}const R=-u.innerAtmosphereDepth,O=B.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);B=function(){function U(S,Q){this.view=S;this.type=k.AtmosphereType.Simple;
this._passParameters=new p.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;this._isMars=e.isMars(S.spatialReference);S=f.getReferenceEllipsoid(S.spatialReference);this._planetRadius=S.radius;this._outerRimWidth=S.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+R)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=
this._texV1-this._texV0;this._techniqueRepository=Q.techniqueRepository;S=Q.renderContext.rctx;this._cameraChangeHandle=w.watch(()=>this.view.state?.camera,()=>Q.requestRender(),w.syncAndInitial);this._vao=this._createRibbon(S);this._vaoCount=I.vertexCount(this._vao,"geometry");this._fadeVao=A.createQuadVAO(S);this._fadeVaoCount=I.vertexCount(this._fadeVao,"geometry");this._passParameters.texture=new K.Texture(S,{pixelFormat:H.PixelFormat.RGBA,dataType:H.PixelType.UNSIGNED_BYTE,wrapMode:H.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:H.TextureSamplingMode.LINEAR,flipped:!0,width:1,height:512},this._isMars?q.marsAtmosphereTextureSimple:y.earthAtmosphereTextureSimple);S=new r.SimpleAtmosphereTechniqueConfiguration;S.geometry=r.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(h.SimpleAtmosphereTechnique,S);S.geometry=r.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(h.SimpleAtmosphereTechnique,S)}var N=U.prototype;N.destroy=function(){this._coneTechnique.release();
this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);this._fadeVao.dispose();this._vao.dispose()};N.render=function(S){this._update(S.bindParameters.camera);const Q=S.rctx;1>this._passParameters.undergroundFadeAlpha&&(Q.bindTechnique(this._coneTechnique,this._passParameters,S.bindParameters),Q.bindVAO(this._vao),Q.drawArrays(H.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&
(Q.bindTechnique(this._undergroundTechnique,this._passParameters,S.bindParameters),Q.bindVAO(this._fadeVao),Q.drawArrays(H.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))};N.renderHaze=function(){};N._update=function(S){var Q=g.create();const W=this._planetRadius;var V=l.length(S.eye);const T=V-W;this._passParameters.undergroundFadeAlpha=0>T?Math.min(-T/5E3,1):0;var X=W+R,Z=W+Math.max(50,T);this._passParameters.innerScale=Z*Z/(Math.sqrt(Z*Z-W*W)*Math.sqrt(Z*Z-X*X)+W*X)-1;this._passParameters.altitudeFade=
u.computeInnerAltitudeFade(T);l.scale(Q,S.eye,(W+50)/V);L(Q,S.center,S.up,W,this._passParameters.silhouette);Q=this._computeScreenRimWidth(S,Q,S.up,this._passParameters.silhouette);V=O(T);X=this._texV0+.001953125*this._texVScale;Z=this._texV0+Q*V*this._texVScale;50<T&&(L(S.eye,S.center,S.up,W,this._passParameters.silhouette),S=this._computeScreenRimWidth(S,S.eye,S.up,this._passParameters.silhouette),S=b.clamp((S-1.5)/(Q-1.5),0,1),X=this._texV0+.001953125*S*this._texVScale,Z=this._texV0+b.lerp(this._texV1,
Q*V,S)*this._texVScale);m.set(this._passParameters.texV,X,Z)};N._createRibbon=function(S){const Q=d.newFloatArray(1155),W=new Uint32Array(1920);Q[0]=0;Q[1]=0;Q[2]=-1;for(var V=0;128>V;V++){var T=9*V+3;Q[T]=V;Q[T+1]=this._innerRimFactor;Q[T+2]=-1;Q[T+3]=V;Q[T+4]=this._middleRimFactor;Q[T+5]=0;Q[T+6]=V;Q[T+7]=this._outerRimFactor;Q[T+8]=1;T=3*V+1;var X=127===V?1:T+3,Z=15*V;W[Z]=T;W[Z+1]=T+1;W[Z+2]=X+1;W[Z+3]=X+1;W[Z+4]=X;W[Z+5]=T;W[Z+6]=T+1;W[Z+7]=T+2;W[Z+8]=X+2;W[Z+9]=X+2;W[Z+10]=X+1;W[Z+11]=T+1;W[Z+
12]=T;W[Z+13]=X;W[Z+14]=0}V=P.createBuffer(W.length);T=V.position;for(X=0;X<W.length;++X)Z=3*W[X],T.set(X,0,Q[Z]),T.set(X,1,Q[Z+1]),T.set(X,2,Q[Z+2]);return new C.VertexArrayObject(S,v.Default3D,{geometry:D.glLayout(P)},{geometry:F.BufferObject.createVertex(S,H.Usage.STATIC_DRAW,V.buffer)})};N._computeScreenRimWidth=function(S,Q,W,V){l.add(M,V.center,V.v2);l.scale(G,M,this._outerRimFactor);n.lookAt(J,Q,M,W);t.project(M,J,S.projectionMatrix,S.viewport,M);t.project(G,J,S.projectionMatrix,S.viewport,
G);return l.distance(M,G)/S.height};return a._createClass(U)}();const J=x.create(),M=g.create(),G=g.create(),P=z.newLayout().vec3f(E.VertexAttribute.POSITION);return B})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,
7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,
9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,
5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,
9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,
29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,
129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,
24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,
78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,
30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,
72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,
202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,
97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleHaze":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/FogHaze.glsl ./FogTechnique ./SimpleHazeTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){a.SimpleHaze=function(t){function C(F){var H=E.call(this,F);H._passParameters=new p.FogHazePassParameters;H._vao=B.createQuadVAO(F.context.renderContext.rctx,y.Pos2Tex);var K=k.getReferenceEllipsoid(F.view.spatialReference);H._planetRadius=K.radius;H._atmosphereRadius=K.radius+u.atmosphereHeight;K=new h.FogHazeTechniqueConfiguration;K.haze=!0;H._hazeTechnique=F.context.techniqueRepository.acquire(r.SimpleHazeTechnique,K);return H}b._inherits(C,t);
var E=b._createSuper(C);t=C.prototype;t.destroy=function(){this._hazeTechnique.release();this._vao.dispose()};t.render=function(F,H){if(0!==this.view.basemapTerrain.baseOpacity&&(this._update(F,H),!(0>=this._passParameters.hazeAmount))){var K=this._hazeTechnique;if(K.compiled){var I=F.offscreenRenderingHelper;I.renderDepthDetached(()=>{this._passParameters.depthTexture=I.depthTexture;const L=F.rctx.bindTechnique(K,this._passParameters,F.bindParameters);this._renderSimpleHaze(L,F)})}else this.context.requestRender()}};
t._renderSimpleHaze=function(F,H){H=H.rctx;H.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);H.drawArrays(D.PrimitiveType.TRIANGLE_STRIP,0,4)};t._update=function(F,H){var K=F.bindParameters.camera;d.normalize(v,K.eye);F=Math.max(0,d.dot(v,F.bindParameters.lighting.mainLight.direction));const I=z;d.scale(A,I,0);d.lerp(this._passParameters.hazeColor,A,I,F);K=d.length(K.eye);this._passParameters.atmosphereC=K*K-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.hazeAmount=
(1-n.smoothstep(.7*q.weatherHeightLimit,1*q.weatherHeightLimit,Math.abs(K-this._planetRadius)))*H.amount;this._passParameters.fogStrength=H.strength};C.isSupported=function(F){return F.capabilities.depthTexture};b._createClass(C,[{key:"strength",get:function(){return this._passParameters.hazeStrength},set:function(F){this._passParameters.hazeStrength=F}}]);return C}(w);c.__decorate([x.property({constructOnly:!0})],a.SimpleHaze.prototype,"context",void 0);c.__decorate([x.property({constructOnly:!0})],
a.SimpleHaze.prototype,"view",void 0);a.SimpleHaze=c.__decorate([f.subclass("esri.views.3d.environment.SimpleHaze")],a.SimpleHaze);c=b._createClass(function(){this.amount=this.strength=0});const z=e.fromValues(.24,.44,.8),v=e.create(),A=e.create();a.HazeParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleHazeTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/FogHaze.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f){x=function(d){function e(){return k.apply(this,arguments)}c._inherits(e,d);var k=c._createSuper(e);d=e.prototype;d.initializeProgram=function(u){return new l.Program(u.rctx,e.shader.get().build(this.configuration),m.Default3D)};d.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ZERO,g.BlendFactor.ONE_MINUS_SRC_COLOR,g.BlendFactor.ONE),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(x.ShaderTechnique);
x.shader=new n.ReloadableShaderModule(w.Haze,()=>new Promise((d,e)=>a(["./FogHaze.glsl"],d,e)));b.SimpleHazeTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/WatchUpdatingTracking ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E){a.Stars=function(R){function O(M){M=J.call(this,M);M._loadDataTask=null;M._numPoints=0;M._renderParameter=new B.StarPassParameters;M._updatingTracking=new y.WatchUpdatingTracking;return M}b._inherits(O,R);var J=b._createSuper(O);R=O.prototype;R.initialize=function(){this._loadDataTask=this._createLoadDataTask()};R.destroy=function(){this._loadDataTask=g.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();this._numPoints=0;
this._technique=g.releaseMaybe(this._technique);this._vao=g.disposeMaybe(this._vao)};R.render=function(M){const {rctx:G}=M;this._ensureResources(G);g.isNone(this._technique)||g.isNone(this._vao)||(this._technique.compiled?(M=G.bindTechnique(this._technique,this._renderParameter,M.bindParameters),G.bindVAO(this._vao),M.assertCompatibleVertexAttributeLocations(this._vao),G.drawArrays(E.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())};R._ensureResources=function(M){if(!g.isSome(this._technique)&&
!g.isNone(L)){this._technique=new B.StarsTechnique({rctx:M,viewingMode:this.view.state.viewingMode});this._numPoints=L.byteLength/9;var G=new Float32Array(L,0,2*this._numPoints),P=new Uint8Array(L,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(M,G,P,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,U=>this._update(U),d.initial)}};R._computeDayDuration=function(M){const G=new Date(M.getFullYear(),
0,1,11,58,56),P=new Date(M.getFullYear()+1,0,1,11,58,55);return(+M-+G)/(+P-+G)};R._update=function(M){if(M){var G=M.getHours()/12,P=M.getMinutes()/60*(2/24),U=M.getSeconds()/60*(2/1440);G=(G+P+U-.9972222)%2;M=2*this._computeDayDuration(M);P=r.copy(this._renderParameter.modelMatrix,K);r.rotateZ(P,P,-M*Math.PI);r.multiply(P,H,P);r.rotateZ(P,P,-G*Math.PI);this.requestRender()}};R._hexToRGB=function(M){return[parseInt(M.substring(0,2),16),parseInt(M.substring(2,4),16),parseInt(M.substring(4,6),16)]};
R._unpackUint8Attributes=function(M){return 192<=M?[2.9,M-192]:160<=M?[2.5,M-160]:128<=M?[2,M-128]:96<=M?[1.5,M-96]:64<=M?[1,M-64]:32<=M?[.7,M-32]:[.4,M]};R._createVertexArrayObject=function(M,G,P,U){const N=I.createBuffer(U),S=N.position,Q=N.color,W=N.size;for(let X=0;X<U;X++){var V=G[2*X],T=G[2*X+1];S.set(X,0,-Math.cos(V)*Math.sin(T));S.set(X,1,-Math.sin(V)*Math.sin(T));S.set(X,2,-Math.cos(T));V=this._unpackUint8Attributes(P[X]);T=this._hexToRGB(F[V[1]]);Q.set(X,0,255*T[0]);Q.set(X,1,255*T[1]);
Q.set(X,2,255*T[2]);Q.set(X,3,255);W.set(X,V[0])}return new A.VertexArrayObject(M,v.Default3D,{geometry:D.glLayout(I)},{geometry:C.BufferObject.createVertex(M,E.Usage.STATIC_DRAW,N.buffer)})};R._createLoadDataTask=function(){if(g.isSome(L))return null;const M=x.createTask(async G=>{({data:G}=await w.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:G}));this._verifyStarData(G);L=G});M.promise.catch(G=>{f.isAbortError(G)||l.getLogger(this.declaredClass).error(G)}).then(()=>
{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return M};R._verifyStarData=function(M){if(!M)throw new m("stars:no-data-received","Failed to create stars because star catalogue is missing");M=M.byteLength/9;if(0!==M%1||5E4<M||5E3>M)throw new m("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(O,[{key:"updating",get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return g.isSome(this._loadDataTask)&&
!this._loadDataTask.finished}}]);return O}(n);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([e.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([e.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([e.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=c.__decorate([h.subclass("esri.views.3d.environment.Stars")],
a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),H=q.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),K=q.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),I=z.newLayout().vec3f(t.VertexAttribute.POSITION).vec4u8(t.VertexAttribute.COLOR).f32(t.VertexAttribute.SIZE);
let L=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){x=function(u){function p(){var r=h.apply(this,arguments);r.modelMatrix=w.create();return r}c._inherits(p,u);var h=c._createSuper(p);return c._createClass(p)}(x.NoParameters);l=function(u){function p(r){var q;return q=h.call(this,r,new g.ShaderTechniqueConfiguration,()=>q.destroy())}c._inherits(p,u);var h=c._createSuper(p);u=p.prototype;u.initializeProgram=function(r){return new d.Program(r.rctx,p.shader.get().build(),f.Default3D)};u.initializePipeline=function(){return k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,
e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams})};return c._createClass(p)}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(n.Stars,()=>new Promise((u,p)=>a(["./Stars.glsl"],u,p)));b.StarPassParameters=x;b.StarsTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(){const k=new g.ShaderBuilder;k.attributes.add(f.VertexAttribute.POSITION,"vec3");k.attributes.add(f.VertexAttribute.COLOR,"vec4");k.attributes.add(f.VertexAttribute.SIZE,"float");k.varyings.add("vcolor","vec4");k.varyings.add("vsize","float");k.vertex.uniforms.add([new l.Matrix4PassUniform("transform",(u,p)=>{b.copy(e,p.camera.projectionMatrix);e[10]=2.4E-7-1;e[11]=-1;e[14]=(2.4E-7-2)*p.camera.near;b.multiply(e,e,p.camera.viewMatrix);return b.multiply(e,e,
u.modelMatrix)}),new n.Float4PassUniform("viewport",(u,p)=>p.camera.fullViewport),new x.FloatPassUniform("pixelRatio",(u,p)=>p.camera.pixelRatio)]);k.include(w.AlignPixel);k.vertex.code.add(m.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);k.fragment.code.add(m.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`);return k}const e=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.Stars=c;a.build=d})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AlignPixel=function(c){const w=b.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,n=b.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(w);c.vertex.code.add(n);c.fragment.code.add(w);c.fragment.code.add(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/weatherUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsCompositionParameters ./CloudsData ./weather ../../support/RenderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(q,y,B,D){const z=q.fadeInOutHeight,v=z.stage===g.FadeHeightStages.FINISHED?B:q.startTimeHeightFade;0!==D?(D=(B-v)/(1*D),z.factor+=y?-D:D):z.factor=y?0:1;q.startTimeHeightFade=B;z.factor=b.clamp(z.factor,0,1);z.stage=g.FadeHeightStages.HEIGHT_FADE}const u=n.fromValues(0,0,1),p=m.create(),h=n.create(),r=n.create();a.updateWeatherFading=function(q,y,B,D,z){q.renderingStage===f.CloudsRenderingStages.FINISHED_RENDERING&&(q.renderingStage=f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS);
const v=w.length(y.eye);0>q.fadeInOutHeight.factor&&(q.fadeInOutHeight.factor=v-l.earth.radius>d.weatherHeightLimit?1:0);q.isCameraPositionFinal=w.equals(q.cameraPositionLastFrame,y.eye);w.normalize(h,y.eye);w.scale(h,h,l.earth.radius);const A=q.parallax;0===A.anchorPointClouds[0]&&0===A.anchorPointClouds[1]&&0===A.anchorPointClouds[2]&&w.copy(A.anchorPointClouds,h);var t=w.length(w.subtract(r,A.anchorPointClouds,h));let C=!0;if(t>q.fadeIn.distanceThresholdFactor*A.cloudsHeight||q.fadeIn.stage!==
g.FadeInStages.FINISHED)B=q.parallax.anchorPointClouds,q.fadeIn.stage===g.FadeInStages.FINISHED&&(q.fadeIn.factor=0,w.copy(B,h),q.fadeIn.stage=g.FadeInStages.CHANGE_ANCHOR,q.crossFade.enabled=!1,q.fadeInOut.stage=g.FadeInOutStages.FINISHED),q.fadeIn.stage===g.FadeInStages.CHANGE_ANCHOR&&q.isCameraPositionFinal&&(f.ensureClouds(q.data)&&q.renderingStage!==f.CloudsRenderingStages.RENDERING||q.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(w.copy(B,h),q.fadeIn.stage=g.FadeInStages.FADE_IN,
q.startTime=D,q.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(q.renderingStage=f.CloudsRenderingStages.SWITCH_CHANNELS)),1>q.fadeIn.factor&&q.fadeIn.stage===g.FadeInStages.FADE_IN?q.fadeIn.factor=z?b.clamp((D-q.startTime)/(1*z),0,1):1:1<=q.fadeIn.factor&&q.fadeIn.stage===g.FadeInStages.FADE_IN&&(q.fadeIn.stage=g.FadeInStages.FINISHED,q.fadeIn.factor=1);else if(t>q.fadeInOut.distanceThresholdFactor*A.cloudsHeight||q.fadeInOut.stage!==g.FadeInOutStages.FINISHED){{const {fadeInOut:E,
crossFade:F}=q;E.stage===g.FadeInOutStages.FINISHED&&(q.startTime=D,E.factor=1,E.stage=g.FadeInOutStages.FADE_OUT);0<E.factor&&E.stage===g.FadeInOutStages.FADE_OUT?E.factor=z?1-b.clamp((D-q.startTime)/(.5*z),0,1):0:(0>=E.factor&&E.stage===g.FadeInOutStages.FADE_OUT&&(E.factor=0,w.copy(q.parallax.anchorPointClouds,h)),0>=E.factor&&E.stage===g.FadeInOutStages.FADE_OUT&&q.isCameraPositionFinal&&(E.factor=0,E.stage=g.FadeInOutStages.SWITCH,q.crossFade.enabled=!1,F.factor=1),E.stage===g.FadeInOutStages.SWITCH&&
(f.ensureClouds(q.data)&&q.renderingStage!==f.CloudsRenderingStages.RENDERING||q.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(q.startTime=D,E.factor=0,E.stage=g.FadeInOutStages.FADE_IN,w.copy(q.parallax.anchorPointClouds,h),q.crossFade.enabled=!1,F.factor=1,q.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(q.renderingStage=f.CloudsRenderingStages.SWITCH_CHANNELS)),1>E.factor&&E.stage===g.FadeInOutStages.FADE_IN?E.factor=z?b.clamp((D-q.startTime)/(1*z),0,1):
1:1<=E.factor&&E.stage===g.FadeInOutStages.FADE_IN&&(E.stage=g.FadeInOutStages.FINISHED,E.factor=1))}}else if(t>q.crossFade.distanceThresholdFactor*A.cloudsHeight||q.crossFade.enabled||q.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS){B=(B!==e.RenderState.IDLE||!f.ensureClouds(q.data))&&q.renderingStage!==f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS;{({crossFade:t}=q);const E=q.parallax.anchorPointClouds;if(!q.crossFade.enabled||B)w.copy(q.parallaxNew.anchorPointClouds,h),q.startTime=
D,t.factor=0,q.crossFade.enabled=!0;1>t.factor&&q.crossFade.enabled?t.factor=z?b.clamp((D-q.startTime)/(1.3*z),0,1):1:1<=t.factor&&q.crossFade.enabled&&(q.crossFade.enabled=!1,t.factor=1,w.copy(E,q.parallaxNew.anchorPointClouds),q.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(q.renderingStage=f.CloudsRenderingStages.SWITCH_CHANNELS))}}else C=!1;B=v-l.earth.radius;(B>1.7*d.weatherHeightLimit||B<-d.weatherHeightLimit)&&1>q.fadeInOutHeight.factor?q.fadeInOutHeight.factor=1:(B>d.weatherHeightLimit||
B<-.35*d.weatherHeightLimit)&&1>q.fadeInOutHeight.factor?k(q,!1,D,z):B<d.weatherHeightLimit&&B>-.35*d.weatherHeightLimit&&0<q.fadeInOutHeight.factor?k(q,!0,D,z):q.fadeInOutHeight.stage=g.FadeHeightStages.FINISHED;q.renderingStage===f.CloudsRenderingStages.SWITCH_CHANNELS&&(q.readChannels=1-q.readChannels,q.renderingStage=f.CloudsRenderingStages.FINISHED);A.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(v*v-l.earth.radius*l.earth.radius,0))/v;m.fromPoints(u,A.anchorPointClouds,p);c.rotate(A.transform,
x.IDENTITY,p[3],m.axis(p));C&&({parallaxNew:D}=q,m.fromPoints(u,D.anchorPointClouds,p),c.rotate(D.transform,x.IDENTITY,p[3],m.axis(p)));w.copy(q.cameraPositionLastFrame,y.eye)};a.weatherFadingNeedsRender=function(q){return q.crossFade.enabled||q.fadeInOut.stage!==g.FadeInOutStages.FINISHED||q.fadeIn.stage!==g.FadeInStages.FINISHED||q.fadeInOutHeight.stage!==g.FadeHeightStages.FINISHED||q.renderingStage!==f.CloudsRenderingStages.FINISHED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/axisAngleDegrees":function(){define(["exports","../../core/mathUtils","../../chunks/quat","../../chunks/quatf64","../../chunks/vec3"],function(a,b,c,w,n){function x(u=f){return[u[0],u[1],u[2],u[3]]}function m(u,p,h,r,q=x()){q[0]=u;q[1]=p;q[2]=h;q[3]=r;return q}function l(u){return b.deg2rad(u[3])}function g(u,p){u[3]=p;return u}const f=[0,0,1,0],d=w.create(),e=w.create(),k=x();a.UP=f;a.angle=function(u){return u[3]};a.angleRad=l;a.axis=function(u){return u};a.compose=function(u,
p,h=x()){c.setAxisAngle(d,u,l(u));c.setAxisAngle(e,p,l(p));c.multiply(d,e,d);return g(h,b.rad2deg(c.getAxisAngle(h,d)))};a.copy=function(u,p=x()){return m(u[0],u[1],u[2],u[3],p)};a.create=x;a.fromAxisAndAngle=function(u,p,h=x()){n.copy(h,u);h[3]=p;return h};a.fromPoints=function(u,p,h=x()){n.cross(h,u,p);n.normalize(h,h);h[3]=-n.angle(u,p);return h};a.fromValues=m;a.setAngle=g;a.wrap=function(u,p,h,r){return m(u,p,h,r,k)};a.wrapAxisAngle=function(u,p){return m(u[0],u[1],u[2],p,k)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=0]="Immediate";b[b.Faded=1]="Faded";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(N,S,Q){S===d.ViewingMode.Global?g.normalize(G,N.eye):g.set(G,0,0,1);g.scale(P,N.viewForward,-1);S=k.angle(P,G);const W=Math.max(S-.5,0);n.fromRotation(M,-Math.max(.25,S-.25-.85*W/(W+1)),N.viewRight);g.transformMat4(Q,P,M);g.add(Q,Q,g.scale(U,N.viewRight,.2));g.normalize(Q,Q)}function p(N,S,Q,W){const V=z,T=n.identity(D);if(Q===d.ViewingMode.Global)e.SunCalc.getPosition(N,0,0,V),g.set(W,0,0,-1),n.rotateX(T,T,-V.azimuth),n.rotateY(T,T,-V.altitude);else{var X=
q.planarDirection;Q=X.globalAngles;X=(Math.abs(S[2])-X.localAltitude)/(X.globalAltitude-X.localAltitude);X=c.clamp(X,0,1);1>X?(e.SunCalc.getPosition(N,S[1],S[0],V),V.azimuth=(1-X)*V.azimuth+X*Q.azimuth,V.altitude=(1-X)*V.altitude+X*Q.altitude):(V.azimuth=Q.azimuth,V.altitude=Q.altitude);g.set(W,0,-1,0);n.rotateZ(T,T,-V.azimuth);n.rotateX(T,T,-V.altitude)}g.transformMat4(W,W,T)}function h(N){switch(N){case "disabled":case "sunny":return new y(1,1);case "cloudy":return new y(1,1);case "rainy":return new y(.4,
1.2);case "snowy":return new y(.5,1.3);case "foggy":return new y(.2,1.6)}}function r(N,S){const Q=(N[0]+N[1]+N[2])/3;N[0]+=(Q-N[0])*S;N[1]+=(Q-N[1])*S;N[2]+=(Q-N[2])*S}const q={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let y=b._createClass(function(N,S){this.direct=N;this.ambient=
S});const B=f.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);b=b._createClass(function(){this.ambient={color:f.fromValues(1,1,1),intensity:.55};this.direct={color:f.fromValues(1,1,1),intensity:.55,directionToLightSource:f.clone(B)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1});const D=x.create(),z={azimuth:0,altitude:0},v=f.fromValues(.01,.01,.01),A=f.fromValues(1,.6,.5),t=f.fromValues(1,.98,.98),C=f.fromValues(1,1,1),E=f.fromValues(.8,
.8,1),F=f.fromValues(.8,.8,1),H=f.fromValues(.98,.98,1),K=f.fromValues(1,1,1),I=l.fromValues(.01,q.local.ambientAtNight),L=l.fromValues(q.local.directAtTwilight,q.local.ambientAtTwilight),R=l.fromValues(.9*q.local.directAtNoon,q.local.ambientAtNoon),O=l.fromValues(q.local.directAtNoon,q.local.ambientAtNoon),J=new Date(0),M=x.create(),G=f.create(),P=f.create(),U=f.create();a.ColorAndIntensity=b;a.computeColorAndIntensity=function(N,S,Q,W,V,T){g.set(T.ambient.color,1,1,1);T.ambient.intensity=q.global.ambient;
g.set(T.direct.color,1,1,1);T.direct.intensity=q.global.direct;var X=c.clamp((Math.abs(S[2])-q.local.altitude)/(q.global.altitude-q.local.altitude),0,1);T.globalFactor=X;var Z;w.isSome(N)&&(Z=e.SunCalc.getTimes(N,S[1],S[0]));if(1>X){if(w.isSome(N)){var Y=Z;var aa=N.valueOf();if(Y.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN){var ia=aa-36E5*(N.getHours()+48)-6E4*N.getMinutes();Y=ia+432E6}else Y.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(ia=aa-2,Y=aa-1):(ia=Y.sunrise.valueOf(),
Y=Y.sunset.valueOf());var na=Y-ia;var ba=ia+na/2,ea=na/4;const ja=ba-ea;ea=ba+ea;na*=.06;const ka=ia-na/2,da=ia+na/2,ha=Y-na/2,ca=Y+na/2;ia=l.create();na=f.create();Y=f.create();aa<ka||aa>ca?(m.copy(ia,I),g.copy(na,v),g.copy(Y,E)):aa<da?(aa=(aa-ka)/(da-ka),m.lerp(ia,I,L,aa),g.lerp(na,v,A,aa),g.lerp(Y,E,F,aa)):aa<ja?(aa=(aa-da)/(ja-da),m.lerp(ia,L,R,aa),g.lerp(na,A,t,aa),g.lerp(Y,F,H,aa)):aa<ba?(aa=(aa-ja)/(ba-ja),m.lerp(ia,R,O,aa),g.lerp(na,t,C,aa),g.lerp(Y,H,K,aa)):aa<ea?(aa=(aa-ba)/(ea-ba),m.lerp(ia,
O,R,aa),g.lerp(na,C,t,aa),g.lerp(Y,K,H,aa)):aa<ha?(aa=(aa-ea)/(ha-ea),m.lerp(ia,R,L,aa),g.lerp(na,t,A,aa),g.lerp(Y,H,F,aa)):aa<ca&&(aa=(aa-ha)/(ca-ha),m.lerp(ia,L,I,aa),g.lerp(na,A,v,aa),g.lerp(Y,F,E,aa));aa=0;switch(W){case "rainy":case "foggy":aa=.5;break;case "snowy":aa=.5}0<aa&&(r(na,aa),r(Y,aa));ba=h(W);aa=ia[0]*ba.direct;ia=ia[1]*ba.ambient}else Y=h(W),aa=q.local.directAtNoon*Y.direct,na=f.fromValues(1,1,1),ia=q.local.ambientAtNoon*Y.ambient,Y=f.fromValues(1,1,1);g.lerp(T.ambient.color,Y,T.ambient.color,
X);T.ambient.intensity=c.lerp(ia,T.ambient.intensity,X);g.lerp(T.direct.color,na,T.direct.color,X);T.direct.intensity=c.lerp(aa,T.direct.intensity,X);T.specularStrength="rainy"===W||"snowy"===W||"foggy"===W?0:1;T.environmentStrength="rainy"===W?.7:"snowy"===W||"foggy"===W?.75:1}w.isSome(N)?(W=N.valueOf(),Z.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN?(X=W-36E5*(N.getHours()+48)-6E4*N.getMinutes(),Z=X+432E6):Z.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(X=W-2,Z=W-1):(X=Z.sunrise.valueOf(),
Z=Z.sunset.valueOf()),W=1-c.clamp(Math.abs(W-(X+(Z-X)/2))/432E5,0,1)):W=1;T.noonFactor=W;w.isSome(N)?p(N,S,Q,T.direct.directionToLightSource):u(V,Q,T.direct.directionToLightSource)};a.computeDirectionsOverTime=function(N,S,Q,W,V){N=N.getTime();S=S.getTime()-N;S=Math.floor(S/Q)+1;const T=Array(S);for(let X=0;X<S;++X)J.setTime(N+Q*X),T[X]=f.create(),p(J,W,V,T[X]);return T};a.computeShadowsEnabled=function(N,S){return S===d.ViewingMode.Global?!0:Math.abs(N)<q.planarDirection.localAltitude};a.computeVirtualLightDirection=
u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var b={};(function(c){(function(w){w=w();void 0!==w&&(c.exports=w)})(function(){function w(t){return new Date(864E5*(t+.5-2440588))}function n(t,C){return q(u(t)*p(z)-h(C)*u(z),p(t))}function x(t,C){return r(u(C)*p(z)+p(C)*u(z)*u(t))}function m(t,C,E){return q(u(t),p(t)*u(C)-h(E)*p(C))}function l(t,C,E){return r(u(C)*u(E)+p(C)*p(E)*p(t))}function g(t){return B*(1.9148*
u(t)+.02*u(2*t)+3E-4*u(3*t))}function f(t,C){t=B*(357.5291+.98560028*t);var E=g(t);t=t+E+102.9372*B+k;C||(C={dec:0,ra:0});C.dec=x(t,0);C.ra=n(t,0);return C}function d(t,C,E){return 2451545+t+.0053*u(C)-.0069*u(2*E)}function e(t){var C=B*(134.963+13.064993*t),E=B*(93.272+13.22935*t);t=B*(218.316+13.176396*t)+6.289*B*u(C);E=5.128*B*u(E);C=385001-20905*p(C);return{ra:n(t,E),dec:x(t,E),dist:C}}var k=Math.PI,u=Math.sin,p=Math.cos,h=Math.tan,r=Math.asin,q=Math.atan2,y=Math.acos,B=k/180,D={dec:0,ra:0},z=
23.4397*B,v={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,C,E,F){E=B*-E;C*=B;var H=t.valueOf()/864E5-.5+2440588-2451545;t=f(H,D);E=B*(280.16+360.9856235*H)-E-t.ra;F||(F={azimuth:0,altitude:0});F.azimuth=m(E,C,t.dec);F.altitude=l(E,C,t.dec);return F}},A=[[-.83,"sunrise","sunset"]];v.addTime=function(t,C,E){A.push([t,C,E])};v.getTimes=function(t,C,E){function F(U){var N=K,S=O;U=y((u(U)-u(N)*u(S))/(p(N)*p(S)));return d(9E-4+(U+H)/(2*k)+I,L,R)}var H=B*-E,K=B*C,I=Math.round(t.valueOf()/
864E5-.5+2440588-2451545-9E-4-H/(2*k));t=9E-4+(0+H)/(2*k)+I;var L=B*(357.5291+.98560028*t);C=g(L);var R=L+C+102.9372*B+k,O=x(R,0);t=d(t,L,R);C={solarNoon:w(t),nadir:w(t-.5),polarException:v.PolarException.NORMAL};var J;E=0;for(J=A.length;E<J;E+=1){var M=A[E];var G=F(M[0]*B);var P=t-(G-t);C[M[1]]=w(P);C[M[2]]=w(G)}C.polarException=function(U){U=(u(U)-u(K)*u(O))/(p(K)*p(O));return-1>U?v.PolarException.MIDNIGHT_SUN:1<U?v.PolarException.POLAR_NIGHT:v.PolarException.NORMAL}(A[0][0]*B);return C};v.getMoonPosition=
function(t,C,E){E=B*-E;C*=B;var F=t.valueOf()/864E5-.5+2440588-2451545;t=e(F);E=B*(280.16+360.9856235*F)-E-t.ra;F=l(E,C,t.dec);F+=.017*B/h(F+10.26*B/(F+5.1*B));return{azimuth:m(E,C,t.dec),altitude:F,distance:t.dist}};v.getMoonFraction=function(t){var C=t.valueOf()/864E5-.5+2440588-2451545;t=f(C);C=e(C);t=y(u(t.dec)*u(C.dec)+p(t.dec)*p(C.dec)*p(t.ra-C.ra));t=q(149598E3*u(t),C.dist-149598E3*p(t));return(1+p(t))/2};return v})})({get exports(){return b},set exports(c){b=c}});a.SunCalc=b})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I){c=function(R){function O(){var M=J.apply(this,arguments);M._handles=new w;return M}a._inherits(O,R);var J=a._createSuper(O);R=O.prototype;R.destroy=function(){this._handles=n.destroyMaybe(this._handles);this.disconnect()};R.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager=n.destroyMaybe(this._inputManager)};R.connect=function(){const M=this.view;this._source=new v.BrowserEventSource(this.view.surface,
M.input);var G=[new E.ImmediateDoubleClick,new F.PointerClickHoldAndDrag,new H.SingleAndDoubleClick,new C.Drag(this.view.navigation),new K.VerticalTwoFingerDrag];this._inputManager=G=new A.InputManager({eventSource:this._source,recognizers:G});G.installHandlers("prevent-context-menu",[new t.PreventContextMenu],A.ViewEventPriorities.INTERNAL);this._modeDragPan=new q.PinchAndPanNavigation(M,"primary");this._modeDragRotate=new k.DragRotate(M,"secondary",I.PivotPoint.CENTER);this._modeDragZoom=new u.DragZoom(M,
"tertiary");G.installHandlers("navigation",[new y.PointerDownCancelAnimation(M),new e.DoubleClickZoom(M),new p.GamepadNavigation(M),new h.KeyboardNavigation(M,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new r.MouseWheelZoom(M),new D.SingleKeyResetTilt(M,"p"),new B.SingleKeyResetHeading(M,"n"),new k.DragRotate(M,"primary",I.PivotPoint.EYE,["b"]),new k.DragRotate(M,"secondary",
I.PivotPoint.CENTER,["b"]),new q.PinchAndPanNavigation(M,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new z.TwoFingerTilt(M)],A.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(G);this._updateMode();this._handles.add(x.watch(()=>this.view.navigation?.browserTouchPanEnabled,P=>{this._source.browserTouchPanningEnabled=!P},x.initial))};R._updateMode=function(){var M=this.primaryDragAction;if(M=L.get(this.mode)?.get(M))this._modeDragPan&&(this._modeDragPan.pointerAction=
M.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=M.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=M.zoom)};a._createClass(O,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(M){"pan"!==M&&"rotate"!==M||M===this._get("primaryDragAction")||(this._set("primaryDragAction",M),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(M){"default"!==M&&"pro"!==M||M===this._get("mode")||(this._set("mode",
M),this._updateMode())}},{key:"hasPendingInputs",get:function(){return!!this._inputManager?.hasPendingInputs}},{key:"latestPointerType",get:function(){return this._inputManager?.latestPointerType}},{key:"latestPointerLocation",get:function(){return this._inputManager?.latestPointerLocation}},{key:"multiTouchActive",get:function(){return this._inputManager?.multiTouchActive??!1}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,
modeDragZoom:this._modeDragZoom}}}]);return O}(c);b.__decorate([m.property()],c.prototype,"view",void 0);b.__decorate([m.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([m.property({value:"default"})],c.prototype,"mode",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"hasPendingInputs",null);b.__decorate([m.property()],c.prototype,"latestPointerType",null);b.__decorate([m.property()],c.prototype,"latestPointerLocation",null);b.__decorate([m.property()],c.prototype,
"multiTouchActive",null);b.__decorate([m.property()],c.prototype,"_inputManager",void 0);c=b.__decorate([d.subclass("esri.views.3d.input.SceneInputManager")],c);const L=new Map;b=new Map;m=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});m.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});m.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});L.set("default",b);L.set("pro",m);return c})},
"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,w,n,x,m){x=function(l){function g(d,e){var k=f.call(this,!0);k._view=d;k.registerIncoming("double-click",e,u=>k._handleDoubleClick(u));return k}b._inherits(g,l);var f=
b._createSuper(g);g.prototype._handleDoubleClick=function(d){const e=d.data;if(m.eventMatchesPointerAction(e,"primary")){const k=this._view.state.isGlobal?new w.ZoomStepController({view:this._view,mode:"animation"}):new n.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(k);k.zoomStep(Math.log(.5)/Math.log(.6),c.createScreenPointArray(e.x,e.y));d.stopPropagation()}};return b._createClass(g)}(x.InputHandler);a.DoubleClickZoom=x;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F){a.ZoomStepController=function(I){function L(){var O=R.apply(this,arguments);O._zoomLocation=u.create();O._tmpCamera=new C.Camera;O._tmpViewDir=u.create();O._tmpRayDir={origin:u.create(),direction:u.create()};O._targetOnSphere=u.create();O._tmpCenter=u.create();O._constraintOptions={selection:q.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:y.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new C.Camera,interactionDirection:null,
tiltMode:D.TiltMode.TUMBLE};O._sphere=h.create();return O}b._inherits(L,I);var R=b._createSuper(L);I=L.prototype;I.initialize=function(){this._intersector=E.newIntersector(this.view.state.viewingMode)};I.zoomStep=function(O,J){if(this.active){var M=this.view.state,{interactionStartCamera:G}=this._constraintOptions;G&&(this.animation.finished?G.copyFrom(M.camera):this.animation.cameraAt(1,G));var P=G=!1;this.intersectionHelper.intersectScreen(J,this._zoomLocation,0===this.view.map.ground.opacity?v.contentIntersectorOptions:
{})&&(G=0<O,P=!0);this._tmpCamera.copyFrom(M.camera);G?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:k.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,O,this._zoomLocation,J,P);this.begin(this._tmpCamera)}};I.animationSettings=function(){return{duration:x.Milliseconds(600),
easing:F.outExpo}};I._updateCamera=function(O,J,M,G,P){var U=p.getReferenceEllipsoid(this.view.spatialReference);U=v.decideNavigationMode(O,G,U);var N=Math.abs(this.view.camera.position.z);k.normalize(K,O.eye);k.scale(K,K,-1);A.fromScreenAtEye(O,G,this._tmpRayDir);k.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const S=w.clamp(Math.min(v.ZOOM_DISTANCE_MODIFIER,1/Math.abs(k.dot(K,this._tmpRayDir.direction)))*N,v.ZOOM_MIN_DISTANCE_MODIFIER,v.ZOOM_MAX_DISTANCE_MODIFIER);if(U===v.NavigationMode.Horizontal){J=
.6**J;this._sphere[3]=k.length(M);k.subtract(this._tmpViewDir,O.center,O.eye);P=Math.min(k.length(this._tmpViewDir),S);U=P*J;1>=J&&4>U&&(U=4,J=U/P);if(1E-6>Math.abs(P-U))return;P=k.length(O.center);this._sphere[3]!==P&&(O.center=k.scale(H,O.center,(this._sphere[3]+J*(P-this._sphere[3]))/P));k.scale(this._tmpViewDir,this._tmpViewDir,-J);O.eye=k.add(H,O.center,this._tmpViewDir);r.applyAll(this.view,O,this._constraintOptions);1E-12<k.squaredDistance(M,O.center)&&t.intersectScreen(this._sphere,O,G,this._targetOnSphere)&&
v.panToPosition(this._sphere,O,M,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{U=.6**Math.abs(J);N=0<J?1:-1;k.subtract(this._tmpViewDir,M,O.eye);const Q=k.length(this._tmpViewDir);G=this.view._stage.renderView.getMinimalDepthForArea(null,G[0],G[1],this.view.state.camera,60);G=n.isSome(G)?G:S;G=P&&0<J?Math.min(G,Q):G;k.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,G);k.add(M,this._tmpRayDir.origin,this._tmpRayDir.direction);M=G*U;P=Math.max(4,1.01*O.nearFar[0]);
0<J&&M<P&&(M=P,U=M/G);if(1E-6>Math.abs(G-M))return;k.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,N*(1-U));O.eye=k.add(H,O.eye,this._tmpRayDir.direction);O.center=k.add(H,O.center,this._tmpRayDir.direction)}B.applySurfaceCollisionConstraint(this.view,O)};return b._createClass(L)}(z.PointToPointAnimationController);a.ZoomStepController=c.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const H=u.create(),K=u.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){function z(pa,ra,va){va=x.fromRotation(r.sm4d.get(),va[3],e.axis(va));w.isNone(va)||x.exactEquals(va,m.IDENTITY)||(f.subtract(ha,pa.eye,ra),f.transformMat4(ha,ha,va),pa.eye=f.add(ha,ha,ra),f.subtract(ha,pa.center,ra),f.transformMat4(ha,ha,va),pa.center=f.add(ha,ha,ra),pa.up=f.transformMat4(ha,pa.up,va))}function v(pa,ra,va,Ba){return Math.sin(pa/f.length(ra))*(va+Ba.radius)}function A(pa,ra,va,Ba){va=q.fromScreenAtEye(ra,va,wa);if(w.isNone(va))return!1;
p.closestPointOnSilhouette(pa,va,U);return p.intersectRay(pa,va,Ba)?f.squaredDistance(U,va.origin)<f.squaredDistance(Ba,va.origin)?(f.copy(Ba,U),!1):!0:(f.subtract(N,ra.eye,ra.center),f.normalize(N,N),u.fromNormalAndOffset(N,-f.dot(f.normalize(N,N),U),S),u.intersectRay(S,va,Ba),!1)}function t(pa,ra,va,Ba,Aa,Ha){var Ka=0;f.cross(ma,pa,ra);f.subtract(ca,pa,ra);f.length(pa)<=Aa||!Ba.aboveGround?(f.cross(va,ca,Ba.eye),Ka=f.dot(pa,ra)/(f.length(pa)*f.length(ra)),.9999>Ka?Ka=c.acosClamped(Ka):(pa=f.length(f.cross(d.create(),
pa,ra))/(f.length(pa)*f.length(ra)),Ka=c.asinClamped(pa)),Ha=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ha)),0,G)),Ka=-Ka-Math.max(0,f.length(ra)-Aa)/(Ha*Aa)):(f.subtract(Q,Ba.eye,Ba.center),f.cross(va,ca,Q),Ka=-f.length(ca)/Aa);f.normalize(va,va);f.scale(va,va,f.length(ma));return Ka}function C(pa,ra,va,Ba){Ba=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ba)),0,G));ra=ra>va?-(ra-va)/(Ba*va):ra<-va?Math.PI-(ra+va)/(Ba*va):c.acosClamped(ra/va);return((pa>va?-(pa-va)/(Ba*va):pa<-va?Math.PI-
(pa+va)/(Ba*va):c.acosClamped(pa/va))-ra)*va}function E(pa,ra,va,Ba,Aa,Ha,Ka,Pa,Ra,Sa){Pa=C(pa[2],ra[2],Ha[3],Pa);ra=Ra?C(pa[0],ra[0],Ha[3],180):ra[0]-pa[0];pa=Math.sin(Ka)*ra-Math.cos(Ka)*Pa;Ka=Math.cos(Ka)*ra+Math.sin(Ka)*Pa;f.normalize(ha,Aa);Aa=Ra?pa/Math.sqrt(Math.abs(Ha[3]**2-f.dot(va,ha)**2)):pa/Ha[3];va=Ka/Math.sqrt(Math.abs(Ha[3]**2-f.dot(va,Ba)**2));l.set(Sa,Aa,va)}function F(pa,ra,va,Ba,Aa,Ha,Ka,Pa,Ra,Sa){f.cross(ma,pa,ra);k.coordinateSystemFromOneAxisAndNormalVector(Ha.up,Ha.eye,X,Z,Y);
k.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ha.eye,W,V,T);f.copy(va,V);f.copy(Ba,W);f.normalize(va,va);f.scale(va,va,f.length(ma));k.vectorCoordinates(pa,f.normalize(Z,Z),f.normalize(Y,Y),f.normalize(X,X),aa);k.vectorCoordinates(ra,Z,Y,X,ia);E(aa,ia,pa,W,V,Ka,Pa,Ra,Sa,Aa)}function H(pa,ra,va,Ba,Aa,Ha,Ka){x.fromRotation(ea,Aa,Ba);x.fromRotation(ja,Ka,Ha);x.multiply(ka,ea,ja);f.subtract(ra,pa,va);f.transformMat4(ra,ra,ka);f.add(ra,ra,va)}function K(pa,ra,va,Ba,Aa,Ha){x.fromRotation(ea,Ba,va);
x.fromRotation(ja,Ha,Aa);x.multiply(ka,ea,ja);f.subtract(ha,pa.eye,ra);f.transformMat4(ha,ha,ka);pa.eye=f.add(ha,ha,ra);f.subtract(ha,pa.center,ra);f.transformMat4(ha,ha,ka);pa.center=f.add(ha,ha,ra);f.subtract(ha,pa.up,ra);f.transformMat4(ha,ha,ka);pa.up=f.add(ha,ha,ra)}function I(pa,ra,va,Ba,Aa,Ha){return(Math.abs(Ba)>Math.PI-M.Angle||Math.abs(Ba)<M.Angle)&&(Math.abs(pa[2])<va*M.Pole||Math.abs(ra)>va)&&Ha.aboveGround&&Aa<M.Tilt}function L(pa,ra,va,Ba,Aa,Ha){Ha?(e.fromPoints(va,Ba,ba),z(ra,pa,ba)):
(va=t(va,Ba,qa,ra,pa[3],Aa),z(ra,pa,e.wrapAxisAngle(qa,va)))}function R(pa,ra,va,Ba,Aa,Ha,Ka){const Pa=Ka?20:1;f.copy(da,Ba);fa.copyFrom(ra);let Ra;for(let Sa=0;Sa<Pa&&1E-12<f.squaredDistance(va,da);Sa++)if(Ba=f.squaredDistance(va,da),F(va,da,V,W,na,fa,pa,Aa,Ha,Ka),K(fa,pa,W,na[1],V,na[0]),H(da,da,pa,W,na[1],V,na[0]),Ra=f.squaredDistance(va,da),Ra<Ba||0===Sa)ra.copyFrom(fa);else break}a.SpherePickPointFallback=void 0;(function(pa){pa[pa.Ellipsoid=0]="Ellipsoid";pa[pa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||
(a.SpherePickPointFallback={}));D={exclude:new Set([D.TERRAIN_ID])};const O=n.createScreenPointArray();a.NavigationMode=void 0;(function(pa){pa[pa.Vertical=0]="Vertical";pa[pa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const J={Elevation:3E4,Angle:c.deg2rad(16)},M={Pole:.95,Angle:c.deg2rad(18),Tilt:45},G=c.deg2rad(80),P=d.create(),U=d.create(),N=d.create(),S=u.create(),Q=d.create(),W=d.create(),V=d.create(),T=d.create(),X=d.create(),Z=d.create(),Y=d.create(),aa=d.create(),
ia=d.create(),na=g.create(),ba=e.create(),ea=m.create(),ja=m.create(),ka=m.create(),da=d.create(),ha=d.create(),ca=d.create(),fa=new B.Camera,ma=d.create(),qa=d.create(),wa={origin:d.create(),direction:d.create()},xa={origin:d.create(),direction:d.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.MIN_HEIGHT_LIMIT=50;a.PAN_DISTANCE_MODIFIER=5;a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=M;a.ROTATE_PIVOT_DISTANCE_MODIFIER=5;a.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER=10;a.ROTATE_SCREEN_PIXEL_AREA=90;
a.SCREEN_PIXEL_AREA=80;a.TiltThresholdPanningSpeed=G;a.VerticalPanTresholds=J;a.ZOOM_DISTANCE_MODIFIER=8;a.ZOOM_MAX_DISTANCE_MODIFIER=1508E5;a.ZOOM_MIN_DISTANCE_MODIFIER=200;a.applyPanPlanar=function(pa,ra,va){f.subtract(P,va,ra);pa.eye=f.subtract(ha,pa.eye,P);pa.center=f.subtract(ha,pa.center,P)};a.applyPanSphericalDirectRotation=L;a.applyPanSphericalPreserveHeading=R;a.applyRotation=z;a.applyRotationWithTwoAxes=K;a.applyZoomOnSphere=function(pa,ra,va){ra.getScreenCenter(O);y.intersectScreen(pa,
ra,O,ha)&&(ra.center=ha);pa=ra.distance;va*=pa;1E-6>Math.abs(pa-va)||(va=f.scale(r.sv3d.get(),ra.viewForward,va),ra.eye=f.subtract(ha,ra.center,va))};a.applyZoomToPoint=function(pa,ra,va,Ba){const Aa=r.sv3d.get();va=1-va;f.subtract(Aa,ra,pa.eye);const Ha=f.length(Aa);let Ka=Ha*(1-va);0<=va&&Ka<Ba&&(Ka=Ba,va=-(Ka-Ha)/Ha);1E-6>Math.abs(Ha-Ka)||(f.scale(Aa,Aa,va),pa.eye=f.add(ha,pa.eye,Aa),pa.center=f.lerp(ha,pa.center,ra,va))};a.centroid=function(pa,ra){f.set(ra,0,0,0);for(const va of pa)f.add(ra,ra,
va);f.scale(ra,ra,1/pa.length)};a.contentIntersectorOptions=D;a.decideNavigationMode=function(pa,ra,va){if(f.length(pa.eye)-va.radius>J.Elevation)return a.NavigationMode.Horizontal;q.fromScreenAtEye(pa,ra,xa);return-Math.sign(pa.relativeElevation)*(.5*Math.PI+h.angle(pa.eye,xa.direction))<J.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(pa,ra,va,Ba){return u.intersectRay(pa,q.fromScreen(ra,va,wa),Ba)};a.intersectPlaneFromScreenPointAtEye=function(pa,
ra,va,Ba){return u.intersectRay(pa,q.fromScreenAtEye(ra,va,wa),Ba)};a.lengthFromPoints=C;a.normalizeCoordinate=function(pa,ra,va){va[0]=ra[0]/(pa.fullWidth/pa.pixelRatio);va[1]=ra[1]/(pa.fullHeight/pa.pixelRatio);return va};a.normalizeRotationDelta=function(pa){for(;pa>Math.PI;)pa-=2*Math.PI;for(;pa<-Math.PI;)pa+=2*Math.PI;return pa};a.offSurfaceTiltToEyeTiltGlobal=function(pa,ra,va,Ba){return v(Math.PI/2,ra,va,Ba)+(pa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=v;a.panMotionToRotationMatrix=function(pa,
ra,va,Ba,Aa,Ha,Ka,Pa,Ra){if(I(pa.center,f.dot(pa.up,pa.center),f.length(pa.center),-b.cyclicalPI.normalize(c.deg2rad(Ha)),Ka,ra))switch(pa=-b.cyclicalPI.normalize(c.deg2rad(Aa)),{eye:Aa}=ra,k.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Aa,W,V,T),Aa=va.translation[0]*Ba.pan,Ha="zoom"===Ra.mode?0:va.translation[1]*Ba.pan,ra=Math.max(Math.sqrt(Math.abs(1-f.dot(ra.center,W)**2/f.length(ra.center)**2)),.5),Ka=-Math.cos(pa)*Ha+Math.sin(pa)*Aa,x.rotate(Pa.pan.matrix,Pa.pan.matrix,(Math.sin(pa)*Ha+
Math.cos(pa)*Aa)/ra,W),Pa.pan.enabled=!0,Ra.mode){case "pan":x.rotate(Pa.pan.matrix,Pa.pan.matrix,Ka,V);Pa.pan.enabled=!0;break;case "zoom":Pa.zoom=-va.translation[1]*Ba.zoom}else{const {eye:Sa,viewRight:La}=ra;ra=f.cross(r.sv3d.get(),La,Sa);pa=va.translation[0]*Ba.pan;0!==pa&&(x.rotate(Pa.pan.matrix,Pa.pan.matrix,-pa,ra),Pa.pan.enabled=!0);switch(Ra.mode){case "pan":va=va.translation[1]*Ba.pan;0!==va&&(x.rotate(Pa.pan.matrix,Pa.pan.matrix,va,La),Pa.pan.enabled=!0);break;case "zoom":Pa.zoom=-va.translation[1]*
Ba.zoom}}};a.panToPosition=function(pa,ra,va,Ba,Aa,Ha,Ka){I(va,f.dot(ra.up,va),pa[3],-b.cyclicalPI.normalize(c.deg2rad(Aa)),Ha,ra)?R(pa,ra,va,Ba,-b.cyclicalPI.normalize(c.deg2rad(Aa)),Ha,Ka):L(pa,ra,va,Ba,Ha,Ka)};a.pickPointAndInitSphere=function(pa,ra,va,Ba,Aa,Ha){const Ka=d.create(),Pa=p.create();let Ra=!0,Sa=!0;pa.intersectScreen(va,Ka,Ha)?Pa[3]=f.length(Ka):(Sa=!1,Pa[3]=ra.aboveGround&&Aa!==a.SpherePickPointFallback.Ellipsoid?Math.max(f.length(ra.center),.9*Ba.radius):f.length(ra.eye)-ra.relativeElevation,
Aa===a.SpherePickPointFallback.Silhouette?A(Pa,ra,va,Ka):Ra=y.intersectScreen(Pa,ra,va,Ka));return{sphere:Pa,scenePickPoint:Ra?Ka:null,hasGeometryIntersection:Sa}};a.preserveHeadingThreshold=I;a.rotatePointAroundTwoAxes=H;a.rotationAngleAndAxisDirectRotation=t;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=E;a.sphereOrPlanePointFromScreenPoint=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,b,c,w,n,x){function m(k=f){return[k[0],k[1],k[2],k[3]]}function l(k,u,p,h,r=m()){r[0]=k;r[1]=u;r[2]=p;r[3]=h;return r}function g(k,u){k[3]=u;return k}const f=[0,0,1,0],d=c.create(),e=c.create();a.UP=f;a.angle=function(k){return k[3]};a.axis=function(k){return k};a.compose=function(k,u,p){b.setAxisAngle(d,k,k[3]);b.setAxisAngle(e,u,u[3]);b.multiply(d,e,d);return g(p,b.getAxisAngle(p,d))};a.copy=function(k,u=m()){return l(k[0],k[1],k[2],k[3],u)};a.create=m;a.fromAxisAndAngle=function(k,u){const p=
m();w.copy(p,k);p[3]=u;return p};a.fromPoints=function(k,u,p){w.cross(p,k,u);w.normalize(p,p);p[3]=n.angle(k,u);return p};a.fromValues=l;a.setAngle=g;a.wrap=function(k,u,p,h){return l(k,u,p,h,x.sv4d.get())};a.wrapAxisAngle=function(k,u){return l(k[0],k[1],k[2],u,x.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,c,w,n,x){function m(g,f,d){const e=c.castRenderScreenPointArray3(w.copy(x.sv3d.get(),f));e[2]=0;if(!g.unprojectFromRenderScreen(e,d.origin))return null;f=c.castRenderScreenPointArray3(w.copy(x.sv3d.get(),f));f[2]=1;g=g.unprojectFromRenderScreen(f,x.sv3d.get());if(b.isNone(g))return null;n.subtract(d.direction,g,d.origin);return d}function l(g,f,d){n.copy(d.origin,g.eye);f=n.set(x.sv3d.get(),f[0],f[1],1);g=g.unprojectFromRenderScreen(f,x.sv3d.get());if(b.isNone(g))return null;n.subtract(d.direction,
g,d.origin);return d}a.fromRender=m;a.fromRenderAtEye=l;a.fromScreen=function(g,f,d){return m(g,g.screenToRender(f,c.castRenderScreenPointArray3(x.sv3d.get())),d)};a.fromScreenAtEye=function(g,f,d){return l(g,g.screenToRender(f,c.castRenderScreenPointArray3(x.sv3d.get())),d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,c,
w){const n=b.create();a.intersectScreen=function(x,m,l,g){m=w.fromScreenAtEye(m,l,n);return c.intersectRay(x,m,g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){a.ZoomStepController=function(E){function F(){var K=H.apply(this,arguments);K._zoomLocation=u.create();K._tmpCamera=new D.Camera;K._tmpRayDir=u.create();K._tmpCenter=u.create();K._constraintOptions={selection:h.ConstraintTypes.ALL,interactionType:r.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new D.Camera,interactionDirection:null,tiltMode:q.TiltMode.TUMBLE};return K}b._inherits(F,E);var H=b._createSuper(F);E=F.prototype;
E.zoomStep=function(K,I){if(this.active){var L=this.view.state,{interactionStartCamera:R}=this._constraintOptions;R&&(this.animation.finished?R.copyFrom(L.camera):this.animation.cameraAt(1,R));this._tmpCamera.copyFrom(L.camera);R=z.newIntersector(this.view.state.viewingMode);L=!1;0<K?(L=this.intersectionHelper.intersectScreenFreePointFallback(I,this._zoomLocation,0===this.view.map.ground.opacity?B.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,R,this._tmpCenter)&&
(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,R,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:k.copy(this._zoomLocation,this._tmpCamera.center);K=.6**K;I=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,I[0],I[1],this.view.state.camera,60);k.subtract(C,this._tmpCamera.eye,this._zoomLocation);k.normalize(C,C);R=w.clamp(Math.min(B.ZOOM_DISTANCE_MODIFIER,1/Math.abs(k.dot(t,C)))*Math.abs(this.view.camera.position.z),
B.ZOOM_MIN_DISTANCE_MODIFIER,B.ZOOM_MAX_DISTANCE_MODIFIER);if(I=n.isSome(I)?I:R)if(R=u.create(),k.subtract(R,this._zoomLocation,this._tmpCamera.eye),I<k.length(R)||!L)k.normalize(R,R),k.add(this._zoomLocation,this._tmpCamera.eye,k.scale(R,R,I));this._updateCamera(this._tmpCamera,K,this._zoomLocation);this.begin(this._tmpCamera)}};E.animationSettings=function(){return{duration:x.Milliseconds(600),easing:v.outExpo}};E._updateCamera=function(K,I,L){k.subtract(this._tmpRayDir,L,K.eye);const R=k.length(this._tmpRayDir);
let O=R*I;const J=Math.max(4,1.01*K.nearFar[0]);0!==O&&(1>=I&&O<J&&(O=J,I=O/R),1E-6>Math.abs(R-O)||(k.scale(this._tmpRayDir,this._tmpRayDir,I),K.eye=k.subtract(A,L,this._tmpRayDir),K.center=k.lerp(A,K.center,L,1-I),p.applyAll(this.view,K,this._constraintOptions)))};return b._createClass(F)}(y.PointToPointAnimationController);a.ZoomStepController=c.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const A=u.create(),t=u.fromValues(0,0,1),C=u.create();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&
2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,w,n,x){n=function(m){function l(f,d,e,k){var u=g.call(this,!0);u._view=f;u.pointerAction=d;
u._pivot=e;u.registerIncoming("drag",k,p=>u._handleDrag(p));return u}b._inherits(l,m);var g=b._createSuper(l);l.prototype._handleDrag=function(f){const d=f.data;if(!(1<d.pointers.size)&&x.eventMatchesMousePointerAction(f.data,this.pointerAction)){var e=c.createScreenPointArray(d.center.x,d.center.y);switch(d.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new w.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);
this._cameraController.begin(e);break;case "update":this._cameraController&&this._cameraController.update(e);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}f.stopPropagation()}};return b._createClass(l)}(n.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>w.PivotPoint});a.DragRotate=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){a.PivotPoint=void 0;(function(F){F[F.CENTER=0]="CENTER";F[F.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(F){function H(I){I=K.call(this,I);I.pivot=a.PivotPoint.CENTER;I._rotScale=0;I._lastPoint=p.create();I._tmpWorldUp=r.create();I._tmpViewDir=r.create();I._tmpRotCurPoint=p.create();I._tmpTransf=k.create();I._tmpAxis=r.create();I._tmpPivotPoint=r.create();I._pivotPos=r.create();I._constraintOptions={selection:B.ConstraintTypes.ALL,
interactionType:D.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE};return I}b._inherits(H,F);var K=b._createSuper(H);F=H.prototype;F.initialize=function(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};F.begin=function(I){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:h.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=D.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=
z.TiltMode.LOOK_AROUND;this._constraintOptions.selection=B.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const L=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?t.contentIntersectorOptions:{});L||h.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(I,L);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=D.InteractionType.TUMBLE;this._constraintOptions.tiltMode=z.TiltMode.TUMBLE;
this._constraintOptions.selection=B.ConstraintTypes.ALL&~B.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=this.startCamera;t.normalizeCoordinate(this.startCamera,I,this._lastPoint)}};F._constrainPivotPoint=function(I,L){const R=this.startCamera,O=r.create();h.subtract(O,this._pivotPos,R.eye);const J=h.length(O);var M=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(R.eye,E);M=Math.max(Math.min(t.ROTATE_PIVOT_DISTANCE_MODIFIER,1/Math.abs(h.dot(E,
R.viewForward)))*M,t.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER);L&&(M=Math.min(J,M));var G=q.getReferenceEllipsoid(this.view.spatialReference),P=x.createScreenPointArray(R.width/R.pixelRatio*.5,R.height/R.pixelRatio*.5);G=t.decideNavigationMode(this.startCamera,P,G);P=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,R.fullWidth/R.pixelRatio*.5,R.fullHeight/R.pixelRatio*.5,R,2.5*t.ROTATE_SCREEN_PIXEL_AREA,t.ROTATE_SCREEN_PIXEL_AREA);I=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,
I[0],I[1],R,t.ROTATE_SCREEN_PIXEL_AREA);if(n.isSome(P)||n.isSome(I))P=n.unwrapOr(P,I),I=n.isNone(I)||G===t.NavigationMode.Horizontal?P:I,M=P>I?I:P,M=L?Math.min(M,J):M;h.normalize(O,O);h.copy(this._pivotPos,h.add(this._tmpPivotPoint,R.eye,h.scale(this._tmpPivotPoint,O,M)))};F.update=function(I){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,I,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=
this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,I,this.currentCamera.eye,this._pivotPos)}y.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}};F.end=function(){this.active&&this.finishController()};F._applyRotation=function(I,L,R,O){this.view.renderCoordsHelper.worldUpAtPosition(O,this._tmpWorldUp);t.normalizeCoordinate(I,L,this._tmpRotCurPoint);L=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let J=(this._tmpRotCurPoint[0]-
this._lastPoint[0])*this._rotScale;h.subtract(this._tmpViewDir,R,O);R=h.length(this._tmpViewDir);R=w.acosClamped(h.dot(this._tmpViewDir,this._tmpWorldUp)/R);if(this.pivot===a.PivotPoint.EYE){const M=.5*Math.PI-R,G=.495*Math.PI;L=M-Math.max(-G,Math.min(G,M+-.5*L))}L=w.clamp(L+R,v.TiltDefault.min,v.TiltDefault.max)-R;h.cross(this._tmpAxis,I.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(J=-J);e.fromRotation(this._tmpTransf,J,this._tmpWorldUp);e.rotate(this._tmpTransf,this._tmpTransf,L,this._tmpAxis);
h.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);I.up=h.transformMat4(C,I.up,this._tmpTransf);h.add(C,O,this._tmpViewDir);u.copy(this._lastPoint,this._tmpRotCurPoint);return C};b._createClass(H,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return H}(A.InteractiveController);c.__decorate([m.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=c.__decorate([d.subclass("esri.views.3d.state.controllers.RotateController")],
a.RotateController);const C=r.create(),E=r.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){a.InteractiveController=function(e){function k(){var p=u.apply(this,arguments);p.startCamera=new d.Camera;p.currentCamera=new d.Camera;p._lastInteraction=0;return p}b._inherits(k,e);var u=b._createSuper(k);e=k.prototype;e.stepController=function(p,h){h.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(h)};e.onControllerStart=function(p){this.state=f.State.Running;this.startCamera.copyFrom(p);this.currentCamera.copyFrom(p)};e.onControllerEnd=function(p){p.copyViewFrom(this.currentCamera)};
e.commitCamera=function(){this._lastInteraction=performance.now();setTimeout(()=>this.notifyChange("isInteractive"),g.INTERACTING_TIMEOUT);this.view.state.updateCamera(p=>this.stepController(0,p));this.steppingFinished&&this.finishController()};b._createClass(k,[{key:"isInteractive",get:function(){return performance.now()-this._lastInteraction<g.INTERACTING_TIMEOUT}}]);return k}(f.CameraController);c.__decorate([w.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);c.__decorate([w.property()],
a.InteractiveController.prototype,"_lastInteraction",void 0);a.InteractiveController=c.__decorate([l.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,w,n,x,m){x=function(l){function g(d,e,k){var u=f.call(this,!0);u._view=d;u.pointerAction=e;u.registerIncoming("drag",k,p=>u._handleDrag(p));return u}b._inherits(g,l);var f=b._createSuper(g);g.prototype._handleDrag=function(d){const e=d.data;if(!(1<e.pointers.size)&&m.eventMatchesMousePointerAction(d.data,this.pointerAction)){var k=c.createScreenPointArray(e.center.x,e.center.y);switch(e.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=
null);this._cameraController=this._view.state.isGlobal?new w.ZoomController({view:this._view}):new n.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(k);break;case "update":this._cameraController&&this._cameraController.update(k);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}d.stopPropagation()}};return b._createClass(g)}(x.InputHandler);a.DragZoom=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E){a.ZoomController=function(K){function I(){var R=L.apply(this,arguments);R._pickPoint=h.create();R._tmpP0=u.create();R._panAxisAngle=q.create();R._tmpRayDir=h.create();R._tmpRayDirPick=h.create();R._targetOnSphere=h.create();R._navMode=C.NavigationMode.Horizontal;R._tmpRay={origin:h.create(),direction:h.create()};R.dragBeginPoint=x.createScreenPointArray();R._normalizedAnchorPoint=u.create();R._constraintOptions={selection:D.ConstraintTypes.ALL_EXCEPT_COLLISION,
interactionType:z.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};R._sphere=y.create();R._hasPickPoint=!1;return R}b._inherits(I,K);var L=b._createSuper(I);K=I.prototype;K.begin=function(R){if(this.active){k.copy(this.dragBeginPoint,R);C.normalizeCoordinate(this.startCamera,R,this._normalizedAnchorPoint);var O=r.getReferenceEllipsoid(this.view.spatialReference),J=C.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,
R,O,C.SpherePickPointFallback.Ellipsoid,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});this._navMode=C.decideNavigationMode(this.startCamera,R,O);if(this._navMode===C.NavigationMode.Horizontal)this._hasPickPoint=!!J.scenePickPoint,this._pickPoint=n.unwrapOr(J.scenePickPoint,this._pickPoint),this._sphere=J.sphere;else{E.fromScreenAtEye(this.startCamera,R,this._tmpRay);p.normalize(this._tmpRay.direction,this._tmpRay.direction);let M;n.isSome(J.scenePickPoint)&&(p.subtract(this._tmpRayDirPick,
this.startCamera.eye,J.scenePickPoint),M=p.length(this._tmpRayDirPick));O=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,H);O=w.clamp(Math.min(C.PIVOT_DISTANCE_MODIFIER,1/Math.abs(p.dot(H,this._tmpRay.direction)))*O,C.DISTANCE_CLAMP_VALUES[0],C.DISTANCE_CLAMP_VALUES[1]);R=this.view._stage.renderView.getMinimalDepthForArea(null,R[0],R[1],this.view.state.camera,C.SCREEN_PIXEL_AREA);O=n.isSome(R)?R:O;O=null!=M?Math.min(O,M):O;this._hasPickPoint=
!0;p.scale(this._tmpRay.direction,this._tmpRay.direction,O);p.add(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}};K.update=function(R){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===C.NavigationMode.Horizontal){p.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var O=p.length(this._tmpRayDir);
C.normalizeCoordinate(this.currentCamera,R,this._tmpP0);var J=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),M=O*2**J;const G=this.view.state.constraints.minimumPoiDistance;0>J&&M<G&&(M=G);if(1E-6>Math.abs(O-M))return;this._hasPickPoint&&M<O&&(J=1-(1-M/O)*(1-this._sphere[3]/p.length(this.currentCamera.center)),this.currentCamera.center=p.scale(F,this.currentCamera.center,J));p.scale(this._tmpRayDir,this._tmpRayDir,-M/O);this.currentCamera.eye=p.add(F,this.currentCamera.center,this._tmpRayDir);
this._constraintOptions.interactionFactor=B.pixelDistanceToInteractionFactor(k.distance(this.dragBeginPoint,R));B.applyAll(this.view,this.currentCamera,this._constraintOptions);this._hasPickPoint&&(C.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),q.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),C.applyRotation(this.currentCamera,this._sphere,this._panAxisAngle))}else{O=p.length(this._tmpRay.direction);C.normalizeCoordinate(this.currentCamera,
R,this._tmpP0);R=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);M=O*2**R;J=this.view.state.constraints.minimumPoiDistance;0>R&&M<J&&(M=J);if(1E-6>Math.abs(O-M))return;p.scale(this._tmpRayDir,this._tmpRay.direction,1-M/O);this.currentCamera.eye=p.add(F,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=p.add(F,this.currentCamera.center,this._tmpRayDir)}v.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}};K.end=function(){this.active&&this.finishController()};
b._createClass(I,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return I}(t.InteractiveController);a.ZoomController=c.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const F=h.create(),H=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){a.ZoomController=function(C){function E(){var H=F.apply(this,arguments);H._tmpP=h.create();H._tmpDir=h.create();H._tmpN=h.create();H._tmpP0=u.create();H._tmpPoi=h.create();H._tmpRayDir=h.create();H.dragBeginPoint=x.createScreenPointArray();H._normalizedAnchorPoint=u.create();H._constraintOptions={selection:y.ConstraintTypes.ALL,interactionType:B.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:h.create(),
tiltMode:D.TiltMode.TUMBLE};H._plane=r.create();return H}b._inherits(E,C);var F=b._createSuper(E);C=E.prototype;C.begin=function(H){if(this.active){k.copy(this.dragBeginPoint,H);v.normalizeCoordinate(this.startCamera,H,this._normalizedAnchorPoint);var K=this._intersectionHelper.intersectScreenFreePointFallback(H,this._tmpP,0===this.view.map.ground.opacity?v.contentIntersectorOptions:{});p.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var I=p.length(this._tmpDir);p.normalize(this._tmpDir,
this._tmpDir);var L=Math.abs(this.view.camera.position.z);L=w.clamp(Math.min(v.PIVOT_DISTANCE_MODIFIER,1/Math.abs(p.dot(t,this._tmpDir)))*L,v.DISTANCE_CLAMP_VALUES[0],v.DISTANCE_CLAMP_VALUES[1]);H=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,H[0],H[1],this.view.state.camera,v.SCREEN_PIXEL_AREA);L=n.isSome(H)?H:L;L=K?Math.min(L,I):L;p.scale(this._tmpDir,this._tmpDir,L);p.add(this._tmpP,this.startCamera.eye,this._tmpDir);p.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);
p.normalize(this._tmpN,this._tmpN);0>this._tmpN[1]&&p.negate(this._tmpN,this._tmpN);r.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane);this._constraintOptions.interactionStartCamera=this.startCamera}};C.update=function(H){if(this.active){v.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||p.copy(this._tmpPoi,this.currentCamera.center);v.normalizeCoordinate(this.currentCamera,H,this._tmpP0);var K=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);
k.copy(this._normalizedAnchorPoint,this._tmpP0);p.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var I=p.length(this._tmpRayDir),L=I*(1-K);this._constraintOptions.interactionDirection&&(p.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),p.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(K)/I));var R=this.view.state.constraints.minimumPoiDistance;0<=K&&L<R&&(L=R,K=-(L-I)/I);1E-6>Math.abs(I-L)||(p.scale(this._tmpRayDir,
this._tmpRayDir,K),this.currentCamera.eye=p.add(A,this.currentCamera.eye,this._tmpRayDir),p.lerp(A,this.currentCamera.center,this._tmpPoi,K),A[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],A[2]):Math.min(this.startCamera.center[2],A[2]),this.currentCamera.center=A,this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(k.distance(this.dragBeginPoint,H)),q.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}};
C.end=function(){this.active&&this.finishController()};b._createClass(E,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return E}(z.InteractiveController);a.ZoomController=c.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const A=h.create(),t=h.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,b,c,w,n,x){x=function(m){function l(f){var d=g.call(this,!0);d._view=f;d._watchHandles=new c;d._handle=d.registerIncoming("gamepad",e=>d._handleEventGamepad(e));d._handle.pause();return d}b._inherits(l,m);var g=b._createSuper(l);m=l.prototype;m.onInstall=function(f){b._get(b._getPrototypeOf(l.prototype),"onInstall",this).call(this,f);this._watchHandles.add([w.watch(()=>this._view.navigation.gamepad.enabled,d=>{d?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&
(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},w.initial),w.watch(()=>this._view.navigation.gamepad.device,d=>{this._cameraControllerGamepad&&d&&this._cameraControllerGamepad.gamepadDevice!==d&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])};m.onUninstall=function(){this._watchHandles.removeAll();b._get(b._getPrototypeOf(l.prototype),"onUninstall",this).call(this)};m._handleEventGamepad=function(f){var d=this._view.navigation.gamepad.device;
if(!d||f.data.device===d)if((d=this._cameraControllerGamepad&&this._cameraControllerGamepad.active)||n.GamepadKeyboardController.activatesFor(this._view,f.data))d||(d=new n.GamepadKeyboardController({view:this._view,gamepadDevice:f.data.device}),this._view.state.switchCameraController(d)&&(this._cameraControllerGamepad=d)),this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===f.data.device&&this._cameraControllerGamepad.handleEventGamepad(f.data)};
return b._createClass(l)}(x.InputHandler);a.GamepadNavigation=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I){a.GamepadKeyboardController=function(N){function S(W){W=Q.call(this,W);W._filteredSurfaceElevation=0;W._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};W._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];W._tmpCamera=new K.Camera;W._headingStart=0;W._constraintOptions={selection:D.ConstraintTypes.ALL,interactionType:z.InteractionType.NONE,interactionStartCamera:new K.Camera,interactionFactor:0,interactionDirection:null,
tiltMode:v.TiltMode.LOOK_AROUND};return W}b._inherits(S,N);var Q=b._createSuper(S);N=S.prototype;N.handleEventGamepad=function(W){const V=I.extractTransformation(W,this.view.navigation.gamepad,this._transformation);("end"===W.action||I.isZeroTransformation(V))&&this.finishController()};N.activateDirection=function(W){this._keysButtonState[W]=1;I.extractTransformationKeyboard(this._keysButtonState,this._transformation)};N.deactivateDirection=function(W){this._keysButtonState[W]=0;W=I.extractTransformationKeyboard(this._keysButtonState,
this._transformation);I.isZeroTransformation(W)&&this.finishController()};N.onControllerStart=function(W){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;b._get(b._getPrototypeOf(S.prototype),"onControllerStart",this).call(this,W)};N._updateFilteredSurfaceElevation=function(W){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*W};N.stepController=function(W,
V){this._updateStartHeading();this._updateFilteredSurfaceElevation(W);this.currentCamera.copyViewFrom(V);this._updateCameraCenter();this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);this._calculateControlTransformation(W,this.currentCamera,M);this._applyDisabledMovementTypes(M);this._applyPan(M.pan);this._applyRotate(M.rotate);this._applyZoom(M.zoom);this._applyAscend(M.ascend);this._constraintOptions.interactionType=z.InteractionType.NONE;this._constraintOptions.selection=
D.ConstraintTypes.COLLISION;B.applyAll(this.view,this.currentCamera,this._constraintOptions);b._get(b._getPrototypeOf(S.prototype),"stepController",this).call(this,W,V)};N._updateStartHeading=function(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)};N._applyRotate=function(W){if(W.enabled){var V=this.currentCamera;k.subtract(G,V.center,V.eye);k.transformMat4(G,G,W.matrix);V.center=k.add(G,G,V.eye);V.up=k.transformMat4(G,V.up,W.matrix);this._constraintOptions.interactionType=
z.InteractionType.LOOK_AROUND;this._constraintOptions.selection=D.ConstraintTypes.ALL_EXCEPT_COLLISION;B.applyAll(this.view,V,this._constraintOptions)}};N._applyPan=function(W,V=this.currentCamera){W.enabled&&(V.eye=k.transformMat4(G,V.eye,W.matrix),V.center=k.transformMat4(G,V.center,W.matrix),this.view.state.isGlobal&&(V.up=k.transformMat4(G,V.up,W.matrix)),this._constraintOptions.interactionType=z.InteractionType.PAN,this._constraintOptions.selection=D.ConstraintTypes.ALL,B.applyAll(this.view,
V,this._constraintOptions))};N._applyZoom=function(W){if(W){var V=this.currentCamera.viewForward;this.currentCamera.eye=k.add(G,this.currentCamera.eye,k.scale(y.sv3d.get(),V,W));k.copy(P,V);k.negate(P,P);this._constraintOptions.interactionDirection=P;this._constraintOptions.interactionType=z.InteractionType.ZOOM;this._constraintOptions.selection=D.ConstraintTypes.ALL_EXCEPT_COLLISION;B.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};
N._applyAscend=function(W){if(W){var V=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,y.sv3d.get());this._constraintOptions.interactionDirection=k.copy(P,V);this.view.state.isGlobal?(V=k.length(this.currentCamera.eye),W=(V+W)/V,this.currentCamera.eye=k.scale(G,this.currentCamera.eye,W),this.currentCamera.center=k.scale(G,this.currentCamera.center,W)):(W=k.scale(y.sv3d.get(),V,W),this.currentCamera.eye=k.add(G,this.currentCamera.eye,W),this.currentCamera.center=k.add(G,this.currentCamera.center,
W));this._updateCameraCenter();this._constraintOptions.interactionType=z.InteractionType.ASCEND;this._constraintOptions.selection=D.ConstraintTypes.COLLISION;B.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=D.ConstraintTypes.ALL_EXCEPT_COLLISION;B.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};N._calculateControlTransformation=function(W,V,T){T.zoom=0;T.ascend=
0;T.pan.enabled=!1;d.identity(T.pan.matrix);T.rotate.enabled=!1;d.identity(T.rotate.matrix);W=this._computeVelocities(W);this.view.state.isLocal?this._calculateControlTransformationLocal(W,V,T):this._calculateControlTransformationGlobal(W,V,T)};N._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,G)};N._calculateControlTransformationLocal=
function(W,V,T){const {viewRight:X,viewForward:Z}=V,Y=this._transformation;var aa=this.view.navigation.gamepad,ia=k.set(y.sv3d.get(),Z[0],Z[1],0);k.normalize(ia,ia);var na=Y.translation[0]*W.pan;0!==na&&(na=k.scale(y.sv3d.get(),X,na),d.translate(T.pan.matrix,T.pan.matrix,na),T.pan.enabled=!0);switch(aa.mode){case "pan":aa=-Y.translation[1]*W.pan;0!==aa&&(ia=k.scale(y.sv3d.get(),ia,aa),d.translate(T.pan.matrix,T.pan.matrix,ia),T.pan.enabled=!0);T.zoom=Y.zoom*W.zoom;break;case "zoom":T.zoom=(-Y.translation[1]+
Y.zoom)*W.zoom;break;default:w.neverReached(aa.mode)}T.ascend=Y.translation[2]*W.ascend;ia=-Y.heading*W.rotate;0!==ia&&(d.rotate(T.rotate.matrix,T.rotate.matrix,ia,this.view.renderCoordsHelper.worldUpAtPosition(V.eye,y.sv3d.get())),T.rotate.enabled=!0);W=Y.tilt*W.rotate;V=E.viewAngle(this.view.renderCoordsHelper,V.center,V.eye);if(V=n.clamp(V+W,A.TiltDefault.min,A.TiltDefault.max)-V)d.rotate(T.rotate.matrix,T.rotate.matrix,V,X),T.rotate.enabled=!0};N._calculateControlTransformationGlobal=function(W,
V,T){const {eye:X,viewRight:Z}=V,Y=this._transformation;var aa=this.view.navigation.gamepad,ia=k.cross(y.sv3d.get(),Z,X);k.normalize(ia,ia);k.negate(ia,ia);C.panMotionToRotationMatrix(this.startCamera,V,Y,W,this.view.camera.heading,this._headingStart,this.view.camera.tilt,T,aa);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(M.pan,this._tmpCamera);aa=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;T.ascend=Y.translation[2]*W.ascend;ia=-Y.heading*W.rotate;0!==
ia&&(d.rotate(T.rotate.matrix,T.rotate.matrix,ia,this._tmpCamera.eye),T.rotate.enabled=!0);V=this._clampTiltDeltaGlobalToValidRange(Y.tilt*W.rotate,V.ray,aa);0!==V&&(d.rotate(T.rotate.matrix,T.rotate.matrix,V,this._tmpCamera.viewRight),T.rotate.enabled=!0);T.zoom+=Y.zoom*W.zoom};N._clampTiltDeltaGlobalToValidRange=function(W,V,T){const X=p.getReferenceEllipsoid(this.view.spatialReference),Z=C.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.min,V.origin,T,X);var Y=0;let aa=0;Y=y.sv3d.get();this.view.renderCoordsHelper.intersectManifold(V,
T,Y)?(Y=E.viewAngle(this.view.renderCoordsHelper,Y,V.origin),Y=C.onSurfaceTiltToEyeTiltGlobal(Y,V.origin,T,X),aa=C.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,V.origin,T,X)):(r.closestPointOnSilhouette(r.fromRadius(r.tmpSphere,T+X.radius),V,Y),Y=-q.angle(V.direction,Y),Y=C.offSurfaceTiltToEyeTiltGlobal(Y,V.origin,T,X),aa=C.offSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,V.origin,T,X));return n.clamp(Y+W,Z,aa)-Y};N._getPointAbsoluteSurfaceElevation=function(W,V,T){const {renderCoordsHelper:X}=this.view,
Z=X.getAltitude(W);V+=Math.abs(Z-V);X.setAltitude(T,V,W);return V};N._clampedDistanceToSurface=function(W,V){const {renderCoordsHelper:T}=this.view,{camera:X}=this.view.state;var {direction:Z}=F.headingTiltToDirectionUp(this.view,V,0,80,U);Z=T.intersectManifoldClosestSilhouette(h.wrap(V,Z),W,y.sv3d.get());Z=k.distance(V,Z);W=T.intersectManifoldClosestSilhouette(h.wrap(V,k.direction(y.sv3d.get(),V,X.center)),W,y.sv3d.get());V=k.distance(V,W);return Math.min(Z,V)};N._computeHeadingRotateRadius=function(W){const {renderCoordsHelper:V,
state:T}=this.view,{camera:X,isGlobal:Z}=T;var Y=V.intersectManifoldClosestSilhouette(X.ray,this._filteredSurfaceElevation,y.sv3d.get());if(Z){const aa=k.subtract(y.sv3d.get(),W,Y);Y=k.length(aa);k.scale(aa,aa,1/Y);W=k.normalize(y.sv3d.get(),W);W=n.acosClamped(k.dot(W,aa));return Y*Math.sin(Math.min(R,W))}W=k.copy(y.sv3d.get(),W);V.setAltitude(W,this._filteredSurfaceElevation);return k.distance(Y,W)};N._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};N._computeVelocities=
function(W){var V=this._filteredSurfaceElevation,T=V+p.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:X,isGlobal:Z}=this.view.state;var Y=y.sv3d.get();const aa=this._getPointAbsoluteSurfaceElevation(X.eye,V,Y);var ia=this._clampedDistanceToSurface(V,Y);const na=X.width/2,ba=.75*X.width,ea=.75*X.width;var ja=ia*Math.tan(.5*X.fovX)/na;T=ja/T;Y=ja/this._computeHeadingRotateRadius(Y);ja=(Z?T:ja)*ba*W;V=aa-V;V=Math.max(this._minimumAscendVelocity()*W,2**(ba*W/na)*V-V);ia=2**(ba*
W/na)*ia-ia;W*=n.clamp(Y*ea,O,J);return{pan:ja,ascend:V,zoom:ia,rotate:W}};N._applyDisabledMovementTypes=function(W){!x.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(W.zoom=this.disableMovements.zoom?0:W.zoom,W.ascend=this.disableMovements.ascend?0:W.ascend,W.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&d.identity(W.pan.matrix),W.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&
d.identity(W.rotate.matrix))};S.activatesFor=function(W,V){W=I.extractTransformation(V,W.navigation.gamepad,L);return!("end"===V.action||I.isZeroTransformation(W))};return b._createClass(S)}(t.InteractiveController);c.__decorate([m.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([m.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([f.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
a.GamepadKeyboardController);const L={translation:[0,0,0],heading:0,tilt:0,zoom:0},R=n.deg2rad(80),O=n.deg2rad(30),J=n.deg2rad(80),M={zoom:0,ascend:0,pan:{enabled:!1,matrix:e.create()},rotate:{enabled:!1,matrix:e.create()}},G=u.create(),P=u.create(),U=H.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function c(w){let n=w*w;0>w&&(n*=-1);return n}a.extractTransformation=
function(w,n,x){const m=w.state;w=w.device;n="forward-down"===n.tiltDirection?1:-1;"standard"===w.deviceType?(x.translation[0]=c(m.axes[0]),x.translation[1]=c(m.axes[1]),x.translation[2]=c(m.buttons[7])-c(m.buttons[6]),x.heading=c(m.axes[2]),x.tilt=c(m.axes[3])):"spacemouse"===w.deviceType&&(x.translation[0]=1.2*c(m.axes[0]),x.translation[1]=1.2*c(m.axes[1]),x.translation[2]=2*-c(m.axes[2]),x.heading=1.2*c(m.axes[5]),x.tilt=1.2*c(m.axes[3]));x.tilt*=n;b.scale(x.translation,x.translation,1);return x};
a.extractTransformationKeyboard=function(w,n){n.translation[0]=w[1]-w[0];n.translation[1]=w[3]-w[2];n.translation[2]=w[4]-w[5];n.heading=w[7]-w[6];n.tilt=w[8]-w[9];n.zoom=w[10]-w[11];return n};a.isZeroTransformation=function(w){return 0===w.translation[0]&&0===w.translation[1]&&0===w.translation[2]&&0===w.heading&&0===w.tilt&&0===w.zoom};a.resetTransformation=function(w){w.translation[0]=0;w.translation[1]=0;w.translation[2]=0;w.heading=0;w.tilt=0;return w};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,w,n){var x;(function(m){m[m.LEFT=0]="LEFT";m[m.RIGHT=1]="RIGHT";m[m.FORWARD=2]="FORWARD";m[m.BACKWARD=3]="BACKWARD";m[m.UP=4]="UP";m[m.DOWN=5]="DOWN";m[m.HEADINGLEFT=6]="HEADINGLEFT";m[m.HEADINGRIGHT=7]="HEADINGRIGHT";m[m.TILTUP=8]="TILTUP";
m[m.TILTDOWN=9]="TILTDOWN";m[m.ZOOMIN=10]="ZOOMIN";m[m.ZOOMOUT=11]="ZOOMOUT"})(x||(x={}));n=function(m){function l(f,d){var e=g.call(this,!0);e._view=f;e._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};e._keyToNumber={[d.left]:x.LEFT,[d.right]:x.RIGHT,[d.forward]:x.FORWARD,[d.backward]:x.BACKWARD,[d.up]:x.UP,[d.down]:x.DOWN,[d.headingLeft]:x.HEADINGLEFT,[d.headingRight]:x.HEADINGRIGHT,[d.tiltUp]:x.TILTUP,[d.tiltDown]:x.TILTDOWN,[d.zoomIn]:x.ZOOMIN,[d.zoomOut]:x.ZOOMOUT};
e.registerIncoming("key-down",null,k=>e._handleKeyDown(k));e.registerIncoming("key-up",null,k=>e._handleKeyUp(k));e.registerIncoming("blur",null,()=>e._handleBlur());return e}b._inherits(l,m);var g=b._createSuper(l);m=l.prototype;m._handleKeyDown=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var d=this._keyToNumber[f.data.key];null!=d&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new w.GamepadKeyboardController({view:this._view,
disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(d),f.stopPropagation()))}};m._handleBlur=function(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)};m._handleKeyUp=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var d=this._keyToNumber[f.data.key];
null!=d&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(d),f.stopPropagation())}};return b._createClass(l)}(n.InputHandler);a.KeyboardNavigation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,b,c,w,n,x){x=function(m){function l(f,d){var e=g.call(this,!0);e._view=f;e.registerIncoming("mouse-wheel",d,k=>e._handleMouseWheel(k));return e}b._inherits(l,m);var g=b._createSuper(l);l.prototype._handleMouseWheel=function(f){if(this._view.navigation.mouseWheelZoomEnabled){var d=f.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new w.ZoomStepController({view:this._view,mode:"interaction"}):new n.ZoomStepController({view:this._view,
mode:"interaction"}),this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*d.deltaY,c.createScreenPointArray(d.x,d.y));f.preventDefault();f.stopPropagation()}};return b._createClass(l)}(x.InputHandler);a.MouseWheelZoom=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,w,n,x){n=function(m){function l(f,d,e){var k=g.call(this,!0);k._view=f;k.pointerAction=d;k._lastEndTimestamp=0;k._lastTimestamp=0;k.registerIncoming("drag",e,u=>k._handleDrag(u));return k}b._inherits(l,m);var g=b._createSuper(l);m=l.prototype;m._handleDrag=function(f){if("mouse"!==f.data.pointerType||x.eventMatchesMousePointerAction(f.data,this.pointerAction)){var d=f.timestamp-this._lastEndTimestamp;d=this._momentum&&this._momentum.active&&40>d;switch(f.data.action){case "start":case "update":if(d)break;
this._controller&&this._controller.active?2<f.data.timestamp-this._lastTimestamp&&(this._controller.update(f.data),this._lastTimestamp=f.timestamp):this._startController(f);break;case "end":case "removed":this._endController(f,!0);break;case "added":this._endController(f,!1),this._startController(f)}f.stopPropagation()}};m._endController=function(f,d){this._controller&&this._controller.active&&(this._lastEndTimestamp=f.timestamp,f=this._controller.end(f.data),d&&f&&(this._momentum=f,this._view.state.switchCameraController(this._momentum)));
this._controller=null};m._startController=function(f){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(f.data);this._lastTimestamp=f.timestamp};m._createController=function(){return this._view.state.isGlobal?new c.PinchAndPanController({view:this._view}):new w.PinchAndPanController({view:this._view})};return b._createClass(l)}(n.InputHandler);a.PinchAndPanNavigation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G){a.PinchAndPanController=function(P){function U(){var S=N.apply(this,arguments);S._smoothRotation=new t.ExponentialFalloff(.05);S._rotationAxis=h.create();S._beginAngle=0;S._beginHeading=0;S._panningPlane=y.create();S._beginRadius=0;S._smoothScaling=new t.ExponentialFalloff(.05);S._zoomCenterScreen=m.createScreenPointArray();S._zoomMomentumEstimator=new G.ZoomMomentumEstimator;S._rotationMomentumEstimator=new M.RotationMomentumEstimator;
S._panSphericalMomentumEstimator=new J.PanSphericalMomentumEstimator;S._panPlanarMomentumEstimator=new O.PanPlanarMomentumEstimator;S._adjustedSphere=B.create();S._tmp3d=h.create();S._tmpScreenPointArray=m.createScreenPointArray();S._beginScreenPoint=m.createScreenPointArray();S._beginScenePoint=h.create();S._screenPickPoint=m.createScreenPointArray();S._scenePickPoint=h.create();S._mode=L.NavigationMode.Horizontal;S._sphere=B.create();S._pointerCount=0;S._tmpInteractionDirection=h.create();S._constraintOptions=
{selection:z.ConstraintTypes.ALL,interactionType:v.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new R.Camera,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};return S}b._inherits(U,P);var N=b._createSuper(U);P=U.prototype;P.begin=function(S){if(this.active){var Q=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=Q;this._rotationMomentumEstimator.enabled=Q;this._panPlanarMomentumEstimator.enabled=Q;this._panSphericalMomentumEstimator.enabled=Q;this._beginHeading=
-w.cyclicalPI.normalize(n.deg2rad(this.view.camera.heading));this._beginRadius=S.radius;this._pointerCount=S.pointers.size;this._beginAngle=S.angle;this._smoothRotation.reset();m.screenPointObjectToArray(S.center,this._screenPickPoint);u.copy(this._beginScreenPoint,this._screenPickPoint);Q=r.getReferenceEllipsoid(this.view.spatialReference);var W=L.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,Q,L.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?
L.contentIntersectorOptions:{});x.isNone(W.scenePickPoint)||(this._scenePickPoint=W.scenePickPoint,this._sphere=W.sphere,p.copy(this._beginScenePoint,this._scenePickPoint),this._mode=L.decideNavigationMode(this.startCamera,this._screenPickPoint,Q),this._mode===L.NavigationMode.Vertical&&this._preparePlanarPanMode(S,W.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}};P.update=function(S){if(this.active){this.currentCamera.copyFrom(this.startCamera);
var Q=1<S.pointers.size;this._mode===L.NavigationMode.Horizontal?(Q&&this._zoomSpherical(S),this._panningSpherical(S),Q&&this._rotateSpherical(S)):(Q&&this._zoomPlanar(S),this._panningPlanar(S),Q&&this._rotatePlanar(S));this.commitCamera()}};P.end=function(S){S.pointers.size===this._pointerCount&&this.update(S);this.finishController();if(S=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===L.NavigationMode.Horizontal?new I.ZoomSphericalMomentumController({view:this.view,momentum:S,
screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new K.ZoomPlanarMomentumController({view:this.view,momentum:S,zoomCenter:this._beginScenePoint});if(S=this._rotationMomentumEstimator.evaluateMomentum())return new H.RotationMomentumController({view:this.view,momentum:S,center:this._sphere,axis:this._rotationAxis});if(this._mode===L.NavigationMode.Horizontal){if(S=this._panSphericalMomentumEstimator.evaluateMomentum())return new F.PanSphericalMomentumController({view:this.view,
momentum:S})}else if(S=this._panPlanarMomentumEstimator.evaluateMomentum())return new E.PanPlanarMomentumController({view:this.view,momentum:S});return null};P._preparePlanarPanMode=function(S,Q){var W=p.negate(this._tmp3d,this.startCamera.viewForward);y.fromPositionAndNormal(this._scenePickPoint,W,this._panningPlane);var V=m.createScreenPointArray(this._screenPickPoint[0],0);W=h.create();var T=p.length(this.startCamera.eye);this._adjustedSphere[3]=T<this._sphere[3]?T-100:this._sphere[3];L.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,
this.startCamera,V,W);V=m.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(W,V);W=h.create();V=h.create();T=h.create();p.subtract(W,this._scenePickPoint,this.currentCamera.eye);const X=p.length(W);p.normalize(W,W);var Z=L.PAN_DISTANCE_MODIFIER*Math.max(Math.abs(this.view.camera.position.z),L.MIN_HEIGHT_LIMIT);const Y=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,L.SCREEN_PIXEL_AREA);Z=x.isSome(Y)?
Y:Z;Z=Q?Math.min(Z,X):Z;p.copy(T,p.add(V,this.currentCamera.eye,p.scale(V,W,Z)));this._panningPlane[3]=-p.dot(y.normal(this._panningPlane),T);this.startCamera.center=p.add(V,this.startCamera.eye,p.scale(V,this.startCamera.viewForward,Z));S=m.screenPointObjectToArray(S.center,this._tmpScreenPointArray);L.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,S,this._beginScenePoint)};P._zoomSpherical=function(S){const Q=this._beginRadius/S.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(S.radius,
40),120);this._smoothScaling.update(Q);L.applyZoomOnSphere(this._sphere,this.currentCamera,this._smoothScaling.value);m.screenPointObjectToArray(S.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*S.timestamp);this._constraintOptions.interactionType=v.InteractionType.ZOOM;this._constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(S.radius-this._beginRadius);D.applyAll(this.view,this.currentCamera,this._constraintOptions)};P._panningSpherical=
function(S){const Q=m.screenPointObjectToArray(S.center,this._tmpScreenPointArray);L.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,Q,this._tmp3d);L.preserveHeadingThreshold(this._beginScenePoint,p.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(L.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(Q,
this._tmp3d,.001*S.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(L.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(Q,this._tmp3d,.001*S.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=v.InteractionType.PAN;this._constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(u.distance(this._screenPickPoint,
Q));D.applyAll(this.view,this.currentCamera,this._constraintOptions)};P._rotateSpherical=function(S){p.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||p.negate(this._rotationAxis,this._rotationAxis);var Q=this._smoothRotation.value,W=L.normalizeRotationDelta(S.angle-Q);Q+=W;this._smoothRotation.gain=.00125*Math.min(Math.max(S.radius,40),120);this._smoothRotation.update(Q);W=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(W,.001*S.timestamp);
L.applyRotation(this.currentCamera,this._sphere,q.wrapAxisAngle(this._rotationAxis,W));this._constraintOptions.interactionType=v.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(S.radius*Q);D.applyAll(this.view,this.currentCamera,this._constraintOptions)};P._panningPlanar=function(S){const Q=m.screenPointObjectToArray(S.center,this._tmpScreenPointArray);L.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,Q,this._tmp3d)&&(L.applyPanPlanar(this.currentCamera,
this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(Q,this._tmp3d,.001*S.timestamp),this._constraintOptions.interactionType=v.InteractionType.PAN,this._constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(u.distance(this._beginScreenPoint,Q)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),D.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=
null)};P._zoomPlanar=function(S){const Q=this._beginRadius/S.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(S.radius,40),120);this._smoothScaling.update(Q);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*S.timestamp);L.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=v.InteractionType.ZOOM;this._constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(S.radius-
this._beginRadius);D.applyAll(this.view,this.currentCamera,this._constraintOptions)};P._rotatePlanar=function(S){p.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||p.negate(this._rotationAxis,this._rotationAxis);var Q=this._smoothRotation.value;let W=S.angle-Q;W=L.normalizeRotationDelta(W);this._smoothRotation.gain=.00125*Math.min(Math.max(S.radius,40),120);this._smoothRotation.update(Q+W);Q=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(Q,
.001*S.timestamp);L.applyRotation(this.currentCamera,this._sphere,q.wrapAxisAngle(this._rotationAxis,Q));this._constraintOptions.interactionType=v.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(S.radius*Q);D.applyAll(this.view,this.currentCamera,this._constraintOptions)};b._createClass(U,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return U}(C.InteractiveController);a.PinchAndPanController=c.__decorate([k.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._gain=x}var n=w.prototype;n.reset=function(x){this._value=x};n.update=function(x){this._value=void 0===this._value?x:this._gain*x+(1-this._gain)*this._value};b._createClass(w,[{key:"gain",set:function(x){this._gain=x}},{key:"value",get:function(){return void 0===
this._value?0:this._value}}]);return w}();a.ExponentialFalloff=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){a.PanPlanarMomentumController=function(u){function p(r){r=h.call(this,r);r.interactionType=d.InteractionType.PAN;r._tmpPan=f.create();return r}b._inherits(p,u);var h=b._createSuper(p);p.prototype.momentumStep=function(r,q){r=this.momentum.value(r);g.scale(this._tmpPan,this.momentum.direction,r);q.eye=g.subtract(k,q.eye,this._tmpPan);q.center=g.subtract(k,q.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan};return b._createClass(p)}(e.MomentumController);
c.__decorate([w.property({constructOnly:!0})],a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const k=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){a.MomentumController=function(r){function q(){var B=y.apply(this,arguments);B._beginCamera=new h.Camera;B._elapsedTimeSec=0;B.constraintOptions={selection:e.ConstraintTypes.ALL,interactionType:k.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new h.Camera,interactionDirection:null,tiltMode:u.TiltMode.TUMBLE};return B}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.initialize=function(){this.constraintOptions.interactionType=this.interactionType;
this.viewAnimation=new f};r.onControllerStart=function(B){this._beginCamera.copyFrom(B);this.constraintOptions.interactionStartCamera=this._beginCamera;b._get(b._getPrototypeOf(q.prototype),"onControllerStart",this).call(this,B)};r.stepController=function(B,D){D.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=B;this.momentumStep(this._elapsedTimeSec,D);d.applyAll(this.view,D,this.constraintOptions)};b._createClass(q,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this._elapsedTimeSec)}}]);
return q}(p.AnimationController);a.MomentumController=c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){const u=f.create(),p=f.create();a.PanSphericalMomentumController=function(h){function r(y){y=q.call(this,y);y.interactionType=d.InteractionType.PAN;return y}b._inherits(r,h);var q=b._createSuper(r);r.prototype.momentumStep=function(y,B){const D=this.momentum.value1(y);y=this.momentum.value2(y);g.copy(p,B.eye);g.normalize(p,p);g.cross(this.momentum.axis2,p,this.momentum.axis1);k.applyRotationWithTwoAxes(B,u,this.momentum.axis1,D,this.momentum.axis2,y)};return b._createClass(r)}(e.MomentumController);
c.__decorate([w.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){a.RotationMomentumController=function(u){function p(r){r=h.call(this,r);r.interactionType=d.InteractionType.TUMBLE;return r}b._inherits(p,u);var h=b._createSuper(p);p.prototype.momentumStep=function(r,q){r=this.momentum.value(r);k.applyRotation(q,this.center,f.wrapAxisAngle(this.axis,r))};b._createClass(p,[{key:"center",set:function(r){this._set("center",g.clone(r))}},{key:"axis",set:function(r){this._set("axis",g.clone(r))}}]);return p}(e.MomentumController);c.__decorate([w.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([w.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([w.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){a.ZoomPlanarMomentumController=function(u){function p(r){r=h.call(this,r);r.interactionType=d.InteractionType.ZOOM;r.constraintOptions.interactionDirection=f.create();return r}b._inherits(p,u);var h=b._createSuper(p);p.prototype.momentumStep=function(r,q){const {interactionDirection:y}=this.constraintOptions;y&&(g.copy(y,q.eye),r=this.momentum.valueDelta(0,r),k.applyZoomToPoint(q,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),g.direction(y,q.eye,
y))};b._createClass(p,[{key:"zoomCenter",set:function(r){this._set("zoomCenter",f.clone(r))}}]);return p}(e.MomentumController);c.__decorate([w.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([w.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){a.ZoomSphericalMomentumController=function(r){function q(B){B=y.call(this,B);B.interactionType=u.InteractionType.ZOOM;B.radius=0;B._tmpSceneCenter=f.create();B._tmpZoomAxisAngle=d.create();B._sphere=e.create();return B}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.initialize=function(){this._sphere[3]=this.radius};r.momentumStep=function(B,D){B=this.momentum.valueDelta(0,B);h.applyZoomOnSphere(this._sphere,D,B);this.constraintOptions.interactionType=
u.InteractionType.ZOOM;k.applyAll(this.view,D,this.constraintOptions);h.sphereOrPlanePointFromScreenPoint(this._sphere,D,this.screenCenter,this._tmpSceneCenter);d.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);h.applyRotation(D,this._sphere,this._tmpZoomAxisAngle);this.constraintOptions.interactionType=u.InteractionType.PAN};b._createClass(q,[{key:"screenCenter",set:function(B){this._set("screenCenter",w.createScreenPointArray(B[0],B[1]))}},{key:"sceneCenter",set:function(B){this._set("sceneCenter",
f.clone(B))}}]);return q}(p.MomentumController);c.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,w,n,x){let m=function(l){function g(d,e,k,u,p){d=f.call(this,d,e,k);d._sceneVelocity=
u;d.direction=p;return d}b._inherits(g,l);var f=b._createSuper(g);g.prototype.value=function(d){return b._get(b._getPrototypeOf(g.prototype),"valueFromInitialVelocity",this).call(this,this._sceneVelocity,d)};return b._createClass(g)}(x.Momentum);x=function(){function l(f=300,d=12,e=.84){this._minimumInitialVelocity=f;this._stopVelocity=d;this._friction=e;this.enabled=!0;this._time=new n.FilteredFiniteDifference(.6);this._screen=[new n.FilteredFiniteDifference(.4),new n.FilteredFiniteDifference(.4)];
this._scene=[new n.FilteredFiniteDifference(.6),new n.FilteredFiniteDifference(.6),new n.FilteredFiniteDifference(.6)];this._tmpDirection=w.create()}var g=l.prototype;g.add=function(f,d,e){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(e)||(this._screen[0].update(f[0]),this._screen[1].update(f[1]),this._scene[0].update(d[0]),this._scene[1].update(d[1]),this._scene[2].update(d[2]),this._time.update(e))};g.reset=function(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();
this._scene[1].reset();this._scene[2].reset();this._time.reset()};g.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var f=this._screen[0].filteredDelta,d=this._screen[1].filteredDelta;f=null==f||null==d?0:Math.sqrt(f*f+d*d);d=this._time.filteredDelta;f=null==d||null==f?0:f/d;return Math.abs(f)<this._minimumInitialVelocity?null:this.createMomentum(f,this._stopVelocity,this._friction)};g.createMomentum=function(f,d,e){c.set(this._tmpDirection,
this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const k=c.length(this._tmpDirection);0<k&&c.scale(this._tmpDirection,this._tmpDirection,1/k);const u=this._time.filteredDelta;return new m(f,d,e,null==u?0:k/u,this._tmpDirection)};return b._createClass(l)}();a.PanPlanarMomentum=m;a.PanPlanarMomentumEstimator=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function w(x){this._gain=x;this.filteredDelta=this.lastValue=void 0}var n=w.prototype;n.update=function(x){if(this.hasLastValue()){const m=this.computeDelta(x);this._updateDelta(m)}this.lastValue=x};n.reset=function(){this.filteredDelta=this.lastValue=void 0};n.hasLastValue=function(){return void 0!==this.lastValue};n.hasFilteredDelta=function(){return void 0!==this.filteredDelta};n.computeDelta=function(x){return void 0===this.lastValue?NaN:x-this.lastValue};n._updateDelta=
function(x){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*x:x};return b._createClass(w)}();a.FilteredFiniteDifference=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x,m,l){this._initialVelocity=x;this._stopVelocity=m;this._friction=l;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}var n=w.prototype;n.isFinished=function(x){return x>this.duration};n.value=function(x){return this.valueFromInitialVelocity(this._initialVelocity,x)};n.valueDelta=function(x,m){const l=this.value(x);return this.value(x+m)-l};n.valueFromInitialVelocity=function(x,m){m=Math.min(m,this.duration);const l=1-this.friction;return x*(l**m-1)/Math.log(l)};b._createClass(w,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);
return w}();a.Momentum=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(a,b,c,w,n,x,m,l,g){let f=function(d){function e(u,p,h,r,q,y=0,B){u=k.call(this,u,p,h);u._angularVelocity1=r;u.axis1=q;u.angularVelocity2=
y;u.axis2=B;return u}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.value1=function(u){return b._get(b._getPrototypeOf(e.prototype),"valueFromInitialVelocity",this).call(this,this._angularVelocity1,u)};d.value2=function(u){return b._get(b._getPrototypeOf(e.prototype),"valueFromInitialVelocity",this).call(this,this.angularVelocity2,u)};return b._createClass(e)}(g.Momentum);g=function(){function d(k=300,u=12,p=.84){this._minimumInitialVelocity=k;this._stopVelocity=u;this._friction=p;this.enabled=
!0;this._tmpAxis1=n.create();this._tmpAxis2=n.create();this._tmpAngles=c.create();this._time=new m.FilteredFiniteDifference(.3);this._screen=[new m.FilteredFiniteDifference(.4),new m.FilteredFiniteDifference(.4)];this._angle1=new l.FilteredValue(.6);this._angle2=new l.FilteredValue(.6);this._axis1=n.create();this._axis2=n.create();this._lastScene=n.create()}var e=d.prototype;e.addMomentumDirectRotation=function(k,u,p,h,r,q){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(p))return;
h=x.rotationAngleAndAxisDirectRotation(this._lastScene,u,this._tmpAxis2,h,r,q);this._angle2.update(0);1E-5>w.squaredLength(this._tmpAxis2)?h=0:w.normalize(this._axis1,this._tmpAxis2);this._angle1.update(h);w.copy(this._lastScene,u)}this._screen[0].update(k[0]);this._screen[1].update(k[1]);this._time.update(p)}};e.addMomentumPreserveHeading=function(k,u,p,h,r,q,y){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(p))return;x.rotationAnglesAndAxesHeadingPreserving(this._lastScene,
u,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,h,r,q,y,!1);1E-5>w.squaredLength(this._tmpAxis2)?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),w.normalize(this._axis1,this._tmpAxis1),w.normalize(this._axis2,this._tmpAxis2));w.copy(this._lastScene,u)}this._screen[0].update(k[0]);this._screen[1].update(k[1]);this._time.update(p)}};e.reset=function(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();
this._angle2.reset();this._time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var k=this._screen[0].filteredDelta,u=this._screen[1].filteredDelta;k=null==k||null==u?null:Math.sqrt(k*k+u*u);u=this._time.filteredDelta;k=null==k||null==u?0:k/u;return Math.abs(k)<this._minimumInitialVelocity?null:this.createMomentum(k,this._stopVelocity,this._friction)};e.createMomentum=function(k,u,p){const h=this._time.filteredDelta,r=this._angle1.filteredValue,
q=this._angle2.filteredValue;return new f(k,u,p,null==h||null==r?0:r/h,this._axis1,null==h||null==q?0:q/h,this._axis2)};return b._createClass(d)}();a.PanSphericalMomentum=f;a.PanSphericalMomentumEstimator=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._gain=x}var n=w.prototype;n.update=function(x){this.filteredValue=void 0!==
this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*x:x};n.reset=function(){this.filteredValue=void 0};b._createClass(w,[{key:"hasFilteredValue",get:function(){return void 0!==this.filteredValue}}]);return w}();a.FilteredValue=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(w){function n(m=3,l=.01,g=
.95,f=12){return x.call(this,m,l,g,f)}b._inherits(n,w);var x=b._createSuper(n);n.prototype.add=function(m,l){const g=this.value.lastValue;if(null!=g){for(m-=g;m>Math.PI;)m-=2*Math.PI;for(;m<-Math.PI;)m+=2*Math.PI;m=g+m}b._get(b._getPrototypeOf(n.prototype),"add",this).call(this,m,l)};return b._createClass(n)}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,c,w,n){let x=function(){function m(g=2.5,f=.01,d=.95,e=12){this._minimumInitialVelocity=g;this._stopVelocity=f;this._friction=d;this._maxVelocity=e;this.enabled=!0;this.value=new w.FilteredFiniteDifference(.8);this.time=new w.FilteredFiniteDifference(.3)}var l=m.prototype;l.add=function(g,f){if(this.enabled&&null!=f){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(f))return;if(this.value.hasFilteredDelta()){const d=
this.value.computeDelta(g);0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(f);this.value.update(g)}};l.reset=function(){this.value.reset();this.time.reset()};l.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let g=this.value.filteredDelta/this.time.filteredDelta;g=c.clamp(g,-this._maxVelocity,this._maxVelocity);return Math.abs(g)<this._minimumInitialVelocity?null:this.createMomentum(g,this._stopVelocity,this._friction)};
l.createMomentum=function(g,f,d){return new n.Momentum(g,f,d)};return b._createClass(m)}();a.MomentumEstimator=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,b,c,w){let n=function(x){function m(g,f,d){return l.call(this,g,f,d)}b._inherits(m,x);var l=b._createSuper(m);x=m.prototype;x.value=function(g){g=b._get(b._getPrototypeOf(m.prototype),
"value",this).call(this,g);return Math.exp(g)};x.valueDelta=function(g,f){const d=b._get(b._getPrototypeOf(m.prototype),"value",this).call(this,g);g=b._get(b._getPrototypeOf(m.prototype),"value",this).call(this,g+f);return Math.exp(g-d)};return b._createClass(m)}(c.Momentum);c=function(x){function m(g=2.5,f=.01,d=.95,e=12){return l.call(this,g,f,d,e)}b._inherits(m,x);var l=b._createSuper(m);x=m.prototype;x.add=function(g,f){b._get(b._getPrototypeOf(m.prototype),"add",this).call(this,Math.log(g),f)};
x.createMomentum=function(g,f,d){return new n(g,f,d)};return b._createClass(m)}(w.MomentumEstimator);a.ZoomMomentum=n;a.ZoomMomentumEstimator=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I){const L=p.fromValues(0,0,1);var R=16/180*Math.PI;a.PinchAndPanController=function(O){function J(){var G=M.apply(this,arguments);G._rotationValueSmooth=new z.ExponentialFalloff(.05);G._scalingValueSmooth=new z.ExponentialFalloff(.05);G._planeHorizontal=r.create();G._planeVertical=r.create();G._rotationMomentumEstimator=new K.RotationMomentumEstimator;G._panMomentumEstimator=new H.PanPlanarMomentumEstimator(300,12,.9);G._zoomMomentumEstimator=
new I.ZoomMomentumEstimator;G._beginRadius=0;G._beginCenter=p.create();G._beginAngle=0;G._tmpPoints=[];G._panMode=E.NavigationMode.Horizontal;G._beginCenterScreen=x.createScreenPointArray();G._tmpCentroid3d=p.create();G._tmpCentroid2d=x.createScreenPointArray();G._tmp2d=x.createScreenPointArray();G._pointerCount=0;G._constraintOptions={selection:y.ConstraintTypes.ALL,interactionType:B.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new F.Camera,interactionDirection:null,tiltMode:D.TiltMode.TUMBLE};
return G}b._inherits(J,O);var M=b._createSuper(J);O=J.prototype;O.begin=function(G){if(this.active){var P=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=P;this._rotationMomentumEstimator.enabled=P;this._panMomentumEstimator.enabled=P;this._beginRadius=G.radius;this._pointerCount=G.pointers.size;this._beginAngle=G.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();x.screenPointObjectToArray(G.center,this._beginCenterScreen);r.fromNormalAndOffset(L,0,
this._planeHorizontal);var U=p.create();P=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,U,0===this.view.map.ground.opacity?E.contentIntersectorOptions:{});var N=p.create();u.negate(N,this.startCamera.viewForward);var S=p.create();u.copy(S,L);var Q=u.dot(N,S);this._panMode=w.asinClamped(0>Q?-Q:Q)>=R?E.NavigationMode.Horizontal:E.NavigationMode.Vertical;var W=Math.min(E.PAN_DISTANCE_MODIFIER,1/Math.abs(u.dot(S,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),
E.MIN_HEIGHT_LIMIT);r.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,U);this.startCamera.aboveGround||r.negate(this._planeHorizontal,this._planeHorizontal);var V=p.create(),T=p.create(),X=p.create();u.subtract(V,U,this.currentCamera.eye);var Z=u.length(V);u.normalize(V,V);this._panMode===E.NavigationMode.Vertical?(u.scale(S,S,Q),u.subtract(this._planeVertical,N,S),u.normalize(this._planeVertical,this._planeVertical),r.setOffsetFromPoint(this._planeVertical,this._planeVertical,U),U=
this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,E.SCREEN_PIXEL_AREA),W=n.isSome(U)?U:W,W=P?Math.min(W,Z):W,u.copy(X,u.add(T,this.currentCamera.eye,u.scale(T,V,W))),this._planeVertical[3]=-u.dot(this._planeVertical,X),this._computePlanePoints(G.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(u.copy(X,u.add(T,this.currentCamera.eye,u.scale(T,V,P?Z:W))),this._planeHorizontal[3]=-u.dot(r.normal(this._planeHorizontal),
X),this._computePlanePoints(G.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints));E.centroid(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}};O.update=function(G){if(this.active){this.currentCamera.copyFrom(this.startCamera);var P=1<G.pointers.size,U=this._panMode===E.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,N=this._beginCenter;if(P){var S=this._beginRadius/G.radius;this._scalingValueSmooth.gain=
.001875*Math.min(Math.max(G.radius,40),120);this._scalingValueSmooth.update(S);E.applyZoomToPoint(this.currentCamera,N,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*G.timestamp);this._constraintOptions.interactionType=B.InteractionType.ZOOM;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Math.abs(G.radius-this._beginRadius));q.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(G.pointers,
U,this.currentCamera,this._tmpPoints);E.centroid(this._tmpPoints,this._tmpCentroid3d);x.screenPointObjectToArray(G.center,this._tmpCentroid2d);E.applyPanPlanar(this.currentCamera,N,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*G.timestamp);this._constraintOptions.interactionType=B.InteractionType.PAN;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(k.distance(this._beginCenterScreen,this._tmpCentroid2d));q.applyAll(this.view,
this.currentCamera,this._constraintOptions);P&&(P=this._planeHorizontal,U=this._rotationValueSmooth.value,S=E.normalizeRotationDelta(G.angle-U),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(G.radius,40),120),this._rotationValueSmooth.update(U+S),U=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(U,.001*G.timestamp),E.applyRotation(this.currentCamera,N,h.wrapAxisAngle(P,U)),this._constraintOptions.interactionType=B.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=
q.pixelDistanceToInteractionFactor(Math.abs(G.radius*U)),q.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}};O.end=function(G){G.pointers.size===this._pointerCount&&this.update(G);this.finishController();return(G=this._zoomMomentumEstimator.evaluateMomentum())?new C.ZoomPlanarMomentumController({view:this.view,momentum:G,zoomCenter:this._beginCenter}):(G=this._rotationMomentumEstimator.evaluateMomentum())?new t.RotationMomentumController({view:this.view,momentum:G,
center:this._beginCenter,axis:r.normal(this._planeHorizontal)}):(G=this._panMomentumEstimator.evaluateMomentum())?new A.PanPlanarMomentumController({view:this.view,momentum:G}):null};O._computePlanePoints=function(G,P,U,N){N.length=G.size;const S=this._tmp2d;let Q=0;G.forEach(W=>{S[0]=W.x;S[1]=W.y;void 0===N[Q]&&(N[Q]=p.create());E.intersectPlaneFromScreenPointAtEye(P,U,S,N[Q]);Q+=1});return N};b._createClass(J,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return J}(v.InteractiveController);a.PinchAndPanController=c.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(w){function n(m,l){var g=x.call(this,!0);g.view=m;g.registerIncoming("pointer-down",
l,()=>g.view.state.stopActiveCameraController());return g}b._inherits(n,w);var x=b._createSuper(n);return b._createClass(n)}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(w){function n(m,l,g){l=x.call(this,l,g);l.view=m;return l}b._inherits(n,w);var x=b._createSuper(n);
n.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return b._createClass(n)}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(w){function n(m,l){var g=x.call(this,!0);g.key=m;g.registerIncoming("key-down",l,f=>g._handleKeyDown(f));return g}b._inherits(n,
w);var x=b._createSuper(n);n.prototype._handleKeyDown=function(m){m.data.key===this.key&&(this.activate(),m.stopPropagation())};return b._createClass(n)}(c.InputHandler);a.SingleKey=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(w){function n(m,l,g){l=x.call(this,l,g);l.view=m;return l}b._inherits(n,w);var x=b._createSuper(n);
n.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return b._createClass(n)}(c.SingleKey);a.SingleKeyResetTilt=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,c,w,n){n=function(x){function m(g,f=!1){var d=l.call(this,!0);d._view=
g;d._invert=f;d.registerIncoming("vertical-two-finger-drag",e=>d._handleTwoFinger(e));return d}b._inherits(m,x);var l=b._createSuper(m);m.prototype._handleTwoFinger=function(g){const f=c.createScreenPointArray(0,g.data.delta*(this._invert?-1:1));switch(g.data.action){case "begin":this._cameraController?.end();this._cameraController=new w.RotateController({view:this._view,pivot:w.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(f);break;
case "update":this._cameraController?.update(f);break;case "end":this._cameraController?.end(),this._cameraController=null}};return b._createClass(m)}(n.InputHandler);a.TwoFingerTilt=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(a,b,c,w,n,x,m){const l=c("edge"),g=c("chrome"),
f=c("ff"),d=c("safari");c=function(){function k(p,h){this._input=h;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=p;p.getAttribute("tabindex")||p.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,
"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new x.GamepadSource(p,this._input);this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}var u=k.prototype;u.destroy=function(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(p=>{this._releasePointerCaptureSafe(p)});
this._gamepadSource=w.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};u.setPointerCapture=function(p,h){h?(this._element.setPointerCapture(p.pointerId),this._activePointerCaptures.add(p.pointerId)):(this._releasePointerCaptureSafe(p.pointerId),this._activePointerCaptures.delete(p.pointerId))};u._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};u._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};u._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");
this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};u._releasePointerCaptureSafe=function(p){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(p)||this._element.releasePointerCapture(p)}catch(h){}};u._updateNormalizedPointerLikeEvent=function(p,h){p=m.createScreenPointFromNativeEvent(this._element,p);k.test.disableSubpixelCoordinates&&(p.x=Math.round(p.x),p.y=Math.round(p.y));h.x=p.x;h.y=
p.y;return h};u._handleKey=function(p,h){const r=n.eventKey(h);r&&"key-up"===p&&this._keyDownState.delete(r);h={native:h,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&"key-down"===p&&this._keyDownState.add(h.key);this._callback(p,h)};u._handlePointer=function(p,h){h=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,pointerType:h.pointerType,button:h.button,buttons:h.buttons,eventId:this._eventId++});this._callback(p,h)};u._handlePointerPreventDefault=function(p,h){const r=this._updateNormalizedPointerLikeEvent(h,
{native:h,x:0,y:0,pointerType:h.pointerType,button:h.button,buttons:h.buttons,eventId:this._eventId++});h.preventDefault();this._callback(p,r)};u._handleMouseWheel=function(p,h){let r=h.deltaY;switch(h.deltaMode){case 0:l&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}l?r*=.7:g||d?r*=.6:f&&(r*=1.375);const q=Math.abs(r);100<q&&(r=r/q*200/(1+Math.exp(-.02*(q-100))));h=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,deltaY:r});this._callback(p,h)};
u._handlePointerCaptureLost=function(p,h){this._activePointerCaptures.delete(h.pointerId);this._handleDefault(p,h)};u._handleDefault=function(p,h){const r={native:h};h.preventDefault();this._callback(p,r)};u._preventAltKeyDefault=function(p){"Alt"===p.key&&p.preventDefault()};u._preventMultiTouchPanning=function(p){1<p.touches.length&&p.preventDefault()};b._createClass(k,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(p){this._browserTouchPanningEnabled=
p;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(p){this._callback=p}},{key:"activeEvents",set:function(p){for(const h in this._active)p&&p.has(h)||(this._element.removeEventListener(e[h],this._active[h]),delete this._active[h]);p&&p.forEach(h=>{if(!this._active[h]&&e[h]){const r=(this._eventHandlers[h]||this._handleDefault).bind(this,h);this._element.addEventListener(e[h],r);this._active[h]=r}});this._gamepadSource.hasEventListeners=p?.has("gamepad")??
!1}}]);return k}();c.test={disableSubpixelCoordinates:!1};const e={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,w,n){let x=function(){function m(g,f){this._element=g;this._input=f;this._hasEventListeners=!1;this._onConnectGamepad=d=>{this._connectGamepad(d.gamepad)};this._onDisconnectGamepad=d=>{d=d.gamepad;const e=d.index,k=this._inputDevices[e];k&&(this._emitGamepadEvent(d,n.extractState(k),
!1),this._inputDevices.splice(e,1),this._latestUpdate.splice(e,1),this._input.gamepad.devices.remove(k),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;g=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&g)this._forEachGamepad(d=>this._connectGamepad(d)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}
var l=m.prototype;l.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};l._connectGamepad=function(g){const f=new w(g);"unknown"!==f.deviceType&&(this._inputDevices[g.index]=f,this._input.gamepad.devices.add(f));this.ensurePollingState()};l.ensurePollingState=function(){this._eventsEnabled?this._startPolling():this._stopPolling()};l._startPolling=
function(){null==this._frameTask&&(this._frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};l._stopPolling=function(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=[])};l._readGamepadState=function(){const g=document.hasFocus(),f=this._element.contains(document.activeElement),d="document"===this._input.gamepad.enabledFocusMode&&!g||"view"===this._input.gamepad.enabledFocusMode&&!f;this._forEachGamepad(e=>{var k=this._inputDevices[e.index];
if(k){var u=this._latestUpdate[e.index];k=n.extractState(k);var p=d||n.stateIdle(k);u&&(u.timestamp===e.timestamp||!u.active&&p||n.stateEqual(u.state,k))||this._emitGamepadEvent(e,k,!p)}})};l._forEachGamepad=function(g){const f=window.navigator.getGamepads();for(let d=0;d<f.length;d++){const e=f[d];this._validate(e)&&g(e)}};l._emitGamepadEvent=function(g,f,d){var e=this._latestUpdate[g.index];if((e=e&&e.active)||d)this._latestUpdate[g.index]={timestamp:g.timestamp,state:f,active:d},this._callback&&
this._callback({device:this._inputDevices[g.index],state:f,action:!e&&d?"start":e&&d?"update":"end"})};l._validate=function(g){if(!g||!g.connected)return!1;for(let f=0;f<g.axes.length;f++)if(isNaN(g.axes[f]))return!1;return!0};b._createClass(m,[{key:"hasEventListeners",set:function(g){this._hasEventListeners!==g&&(this._hasEventListeners=g,this.ensurePollingState())}},{key:"_eventsEnabled",get:function(){return this.supported&&0<this._inputDevices.length&&this._hasEventListeners}},{key:"onEvent",
set:function(g){this._callback=g}}]);return m}();a.GamepadSource=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const c=b.native;return c?{buttons:c.buttons.map(w=>w.pressed?w.value||1:0),axes:c.axes.map(w=>{{var n=b.axisThreshold;const x=Math.abs(w);w=x<n?0:Math.sign(w)*(x-n)/(1-n)}return w})}:{buttons:[],axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||
b.buttons.length!==c.buttons.length)return!1;for(var w=0;w<b.axes.length;w++)if(b.axes[w]!==c.axes[w])return!1;for(w=0;w<b.buttons.length;w++)if(b.buttons[w]!==c.buttons[w])return!1;return!0};a.stateIdle=function(b){for(var c=0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../InputHandler"],function(a,b,c){c=function(w){function n(){var m=x.call(this,!0);m.registerIncoming("context-menu",l=>{l.data.native.preventDefault()});return m}b._inherits(n,w);var x=b._createSuper(n);return b._createClass(n)}(c.InputHandler);a.PreventContextMenu=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),
function(a,b,c,w,n,x){function m(d){const e=[];d.forEach(k=>{e.push(c.createScreenPoint(k.event.x,k.event.y))});return x.fitCircleLSQ(e)}function l(d){const e=m(d);let k=0;d.forEach(u=>{var p=f(u,e);for(p-=u.lastAngle;p>Math.PI;)p-=2*Math.PI;for(;p<-Math.PI;)p+=2*Math.PI;p=u.lastAngle+p;u.lastAngle=p;k+=p-u.initialAngle});k/=d.size||1;return{angle:k,radius:e.radius,center:e.center}}function g(d){const e=new Map;d.forEach((k,u)=>e.set(u,k.event));return e}function f(d,e){d=d.event;return Math.atan2(d.y-
e.center.y,d.x-e.center.x)}n=function(d){function e(u){var p=k.call(this,!1);p._navigationTouch=u;p._startStateModifiers=new Set;p._activePointerMap=new Map;p._isDragging=!1;p._isCurrentDragSuppressed=!1;p._drag=p.registerOutgoing("drag");p.registerIncoming("pointer-drag",p._handlePointerDrag.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-up",p._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-capture-lost",p._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(p)));
p.registerIncoming("pointer-cancel",p._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(p)));return p}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d._createPayload=function(u,p,h,r){return{action:u,pointerType:this._pointerType,button:this._mouseButton,buttons:p.buttons,timestamp:r,pointers:g(this._activePointerMap),pointer:p,angle:h.angle,radius:h.radius,center:h.center}};d._addPointer=function(u){var p=u.native.pointerId;const h=l(this._activePointerMap).angle;u={event:u,initialAngle:0,
lastAngle:0};this._activePointerMap.set(p,u);p=f(u,m(this._activePointerMap));u.initialAngle=p;u.lastAngle=p;this._updatePointerAngles(h)};d._updatePointer=function(u){if(!u||null!=u.x||null!=u.y){var p=this._activePointerMap.get(u.native.pointerId);p?p.event=u:this._addPointer(u)}};d._removePointer=function(u){const p=l(this._activePointerMap).angle;this._activePointerMap.delete(u);this._updatePointerAngles(p)};d._updatePointerAngles=function(u){const p=l(this._activePointerMap);this._activePointerMap.forEach(h=>
{h.initialAngle=f(h,p)-u;h.lastAngle=f(h,p)-u})};d._emitEvent=function(u,p,h){const r=l(this._activePointerMap);this._drag.emit(this._createPayload(u,p,r,h),void 0,this._startStateModifiers)};d._handlePointerUpAndPointerLost=function(u){const p=u.data.native.pointerId,h=w.Milliseconds(u.timestamp);this._activePointerMap.get(p)&&(1===this._activePointerMap.size?(this._updatePointer(u.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",u.data,h),this._isCurrentDragSuppressed=this._isDragging=
!1,this._removePointer(p)):(this._removePointer(p),this._emitEvent("removed",u.data,w.Milliseconds(u.timestamp))))};d._handlePointerDrag=function(u){const p=u.data,h=p.currentEvent,r=w.Milliseconds(u.timestamp);switch(p.action){case "start":case "update":this._isDragging?this._activePointerMap.has(h.native.pointerId)?(this._updatePointer(h),!this._isCurrentDragSuppressed&&this._emitEvent("update",h,r)):(this._addPointer(h),this._emitEvent("added",h,r),this._isCurrentDragSuppressed=this._isSuppressed):
(this._updatePointer(h),this._pointerType=u.data.startEvent.pointerType,this._mouseButton=u.data.startEvent.button,this._startStateModifiers=u.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",h,r))}};b._createClass(e,[{key:"_isSuppressed",get:function(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}]);return e}(n.InputHandler);
a.Button=void 0;(function(d){d[d.Left=0]="Left";d[d.Middle=1]="Middle";d[d.Right=2]="Right";d[d.Back=3]="Back";d[d.Forward=4]="Forward";d[d.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,w){const n=w.x-c.x;c=w.y-c.y;return Math.sqrt(n*n+c*c)};a.fitCircleLSQ=function(c,w){w?(w.radius=
0,w.center.x=0,w.center.y=0):w={radius:0,center:b.createScreenPoint()};if(0===c.length)return w;if(1===c.length)return w.center.x=c[0].x,w.center.y=c[0].y,w;if(2===c.length){const [h,r]=c,[q,y]=[r.x-h.x,r.y-h.y];w.radius=Math.sqrt(q*q+y*y)/2;w.center.x=(h.x+r.x)/2;w.center.y=(h.y+r.y)/2;return w}let n=0,x=0;for(w=0;w<c.length;w++)n+=c[w].x,x+=c[w].y;n/=c.length;x/=c.length;var m=c.map(h=>h.x-n),l=c.map(h=>h.y-x);let g=w=0;var f=0,d=0,e=0,k=0,u=0;for(var p=0;p<m.length;p++){const h=m[p],r=l[p],q=h*
h,y=r*r;w+=q;g+=y;f+=h*r;d+=q*h;e+=y*r;k+=h*y;u+=r*q}m=w;l=f;p=g;d=.5*(d+k);e=.5*(e+u);u=m*p-f*l;k=(d*p-e*l)/u;e=(m*e-f*d)/u;u=b.createScreenPoint(k+n,e+x);return{radius:Math.sqrt(k*k+e*e+(w+g)/c.length),center:u}};a.getPointerId=function(c){({native:c}=c);const {pointerId:w,button:n,pointerType:x}=c;return"mouse"===x?`${w}:${n}`:`${x}`};a.manhattanDistance=function(c,w){return Math.abs(w.x-c.x)+Math.abs(w.y-c.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(a,b,c,w,n,x){w=function(m){function l(f=n.DefaultParameters.maximumDoubleClickDelay,d=n.DefaultParameters.maximumDoubleClickDistance,e=n.DefaultParameters.maximumDoubleTouchDelay,k=n.DefaultParameters.maximumDoubleTouchDistance,u=c.clock){var p=g.call(this,!1);p._maximumDoubleClickDelay=f;p._maximumDoubleClickDistance=d;p._maximumDoubleTouchDelay=e;p._maximumDoubleTouchDistance=k;p._clock=u;p._pointerState=new Map;p._immediateDoubleClick=p.registerOutgoing("immediate-double-click");p.registerIncoming("pointer-down",
p._handlePointerDown.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-up",p._handlePointerUp.bind(b._assertThisInitialized(p)));return p}b._inherits(l,m);var g=b._createSuper(l);m=l.prototype;m.onUninstall=function(){this._pointerState.forEach(f=>{f.immediateDoubleClick&&f.immediateDoubleClick.timeoutHandle.remove()});b._get(b._getPrototypeOf(l.prototype),"onUninstall",this).call(this)};m._handlePointerDown=function(f){f=f.data;const d=x.getPointerId(f);this._pointerState.has(d)||(this._pointerState.set(d,
{downButton:f.native.button,immediateDoubleClick:null}),this.startCapturingPointer(f.native))};m._handlePointerUp=function(f){const d=f.data;var e=x.getPointerId(d);if((e=this._pointerState.get(e))&&e.downButton===d.native.button){const k=e.immediateDoubleClick;if(k){k.timeoutHandle.remove();const u="touch"===f.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;x.manhattanDistance(k,f.data)>u?this._startImmediateDoubleClick(f,e):(this._immediateDoubleClick.emit(f.data,
void 0,k.modifiers),this._removeState(d))}else this._startImmediateDoubleClick(f,e)}};m._startImmediateDoubleClick=function(f,d){d.immediateDoubleClick={x:f.data.x,y:f.data.y,modifiers:f.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(f.data),"touch"===f.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}};m._removeState=function(f){const d=x.getPointerId(f);this._pointerState.delete(d);this.stopCapturingPointer(f.native);this.refreshHasPendingInputs()};
return b._createClass(l)}(w.InputHandler);a.ImmediateDoubleClick=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),function(a,b,c,w,n,x,m){const l={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};
x=function(g){function f(e=l.maximumDoubleClickDelay,k=l.maximumDoubleClickDistance,u=l.maximumDoubleTouchDelay,p=l.maximumDoubleTouchDistance,h=c.clock){var r=d.call(this,!1);r._maximumDoubleClickDelay=e;r._maximumDoubleClickDistance=k;r._maximumDoubleTouchDelay=u;r._maximumDoubleTouchDistance=p;r._clock=h;r._pointerState=new Map;r._click=r.registerOutgoing("click");r._doubleClick=r.registerOutgoing("double-click");r.registerIncoming("immediate-click",r._handleImmediateClick.bind(b._assertThisInitialized(r)));
r.registerIncoming("pointer-down",r._handlePointerDown.bind(b._assertThisInitialized(r)));return r}b._inherits(f,g);var d=b._createSuper(f);g=f.prototype;g.onUninstall=function(){this._pointerState.forEach(e=>e.doubleClickTimer=n.removeMaybe(e.doubleClickTimer))};g._clearDoubleClickTimer=function(e,k){const u=this._pointerState.get(e);u&&(u.doubleClickTimer=n.removeMaybe(u.doubleClickTimer),k&&this._click.emit(u.event.data,void 0,u.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())};
g._doubleClickTimeoutExceeded=function(e){const k=this._pointerState.get(e);1===k.pointerDownCount&&this._click.emit(k.event.data,void 0,k.event.modifiers);k.doubleClickTimer=null;this._pointerState.delete(e);this.refreshHasPendingInputs()};g._getPointerId=function(e){const {pointerId:k,pointerType:u,button:p}=e.native;return"mouse"===u?`${k}:${p}`:`${u}`};g._handleImmediateClick=function(e){const k=e.data;var {pointerType:u}=k.native;const p=this._getPointerId(k);if(this._pointerState.has(p)){var h=
this._pointerState.get(p),{data:r,modifiers:q}=h.event;u="touch"===u?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;m.manhattanDistance(r,k)>u?(this._clearDoubleClickTimer(p,!0),this._startClick(e)):(this._clearDoubleClickTimer(p,!1),2===h.pointerDownCount&&this._doubleClick.emit(r,void 0,q))}else this._startClick(e)};g._handlePointerDown=function(e){e=m.getPointerId(e.data);if(e=this._pointerState.get(e))e.pointerDownCount+=1};g._startClick=function(e){var {data:k}=e;const {native:{pointerType:u}}=
k,p=m.getPointerId(k);k=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(p),"touch"===u?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(p,{event:e,doubleClickTimer:k,pointerDownCount:1});this.refreshHasPendingInputs()};b._createClass(f,[{key:"hasPendingInputs",get:function(){return w.someMap(this._pointerState,e=>null!=e.doubleClickTimer)}}]);return f}(x.InputHandler);a.DefaultParameters=l;a.SingleAndDoubleClick=x;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/maybe ../InputHandler ./support".split(" "),function(a,b,c,w,n,x){const m={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};n=function(l){function g(d=m.maximumClickDelay,e=m.movementUntilMouseDrag,k=m.movementUntilPenDrag,u=m.movementUntilTouchDrag,p=m.holdDelay,
h=c.clock){var r=f.call(this,!1);r._maximumClickDelay=d;r._movementUntilMouseDrag=e;r._movementUntilPenDrag=k;r._movementUntilTouchDrag=u;r._holdDelay=p;r._clock=h;r._pointerState=new Map;r._pointerDrag=r.registerOutgoing("pointer-drag");r._immediateClick=r.registerOutgoing("immediate-click");r._pointerHold=r.registerOutgoing("hold");r.registerIncoming("pointer-down",r._handlePointerDown.bind(b._assertThisInitialized(r)));r.registerIncoming("pointer-up",q=>{r._handlePointerLoss(q,"pointer-up")});
r.registerIncoming("pointer-capture-lost",q=>{r._handlePointerLoss(q,"pointer-capture-lost")});r.registerIncoming("pointer-cancel",q=>{r._handlePointerLoss(q,"pointer-cancel")});r._moveHandle=r.registerIncoming("pointer-move",r._handlePointerMove.bind(b._assertThisInitialized(r)));r._moveHandle.pause();return r}b._inherits(g,l);var f=b._createSuper(g);l=g.prototype;l.onUninstall=function(){this._pointerState.forEach(d=>{d.holdTimeout=w.removeMaybe(d.holdTimeout)});b._get(b._getPrototypeOf(g.prototype),
"onUninstall",this).call(this)};l._handlePointerDown=function(d){const e=d.data,k=e.native.pointerId;var u=null;0===this._pointerState.size&&(u=this._clock.setTimeout(()=>{const p=this._pointerState.get(k);p&&(p.isDragging||(this._pointerHold.emit(p.previousEvent,void 0,d.modifiers),p.holdEmitted=!0),p.holdTimeout=null)},this._holdDelay));u={startEvent:e,previousEvent:e,startTimestamp:d.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:u,modifiers:new Set};this._pointerState.set(k,u);
this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(d)};l._createPointerDragData=function(d,e,k){return{action:d,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:k}};l._handlePointerMove=function(d){const e=d.data,k=this._pointerState.get(e.native.pointerId);if(k){if(k.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",k,e),void 0,k.modifiers);else{const u=x.euclideanDistance(e,k.startEvent),p=this._getDragThreshold(e.native.pointerType);
u>p&&this._startDragging(d)}k.previousEvent=e}};l._getDragThreshold=function(d){switch(d){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}};l._startDragging=function(d){const e=d.data,k=e.native.pointerId;this._pointerState.forEach(u=>{null!=u.holdTimeout&&(u.holdTimeout.remove(),u.holdTimeout=null);u.isDragging||(u.modifiers=d.modifiers,u.isDragging=!0,k===u.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",
u,e)):this._pointerDrag.emit(this._createPointerDragData("start",u,u.previousEvent),d.timestamp))})};l._handlePointerLoss=function(d,e){const k=d.data,u=k.native.pointerId,p=this._pointerState.get(u);p&&(null!=p.holdTimeout&&(p.holdTimeout.remove(),p.holdTimeout=null),p.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",p,"pointer-up"===e?k:p.previousEvent),void 0,p.modifiers):"pointer-up"===e&&p.downButton===k.native.button&&d.timestamp-p.startTimestamp<=this._maximumClickDelay&&
!p.holdEmitted&&this._immediateClick.emit(k),this._pointerState.delete(u),this.stopCapturingPointer(k.native),0===this._pointerState.size&&this._moveHandle.pause())};return b._createClass(g)}(n.InputHandler);a.DefaultParameters=m;a.PointerClickHoldAndDrag=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,
b,c,w){w=function(n){function x(l=20,g=40){var f=m.call(this,!1);f._threshold=l;f._maxDelta=g;f._state="ready";f._emittedArtificalEnd2=!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDrag=f.registerOutgoing("drag");f._dragEventSeparator=new c.DragEventSeparator({start:(d,e)=>f._observeStart(d,e),update:(d,e,k)=>f._observeUpdate(d,e,k),end:(d,e)=>f._observeEnd(e)});f.registerIncoming("drag",d=>f._dragEventSeparator.handle(d));return f}b._inherits(x,n);var m=b._createSuper(x);
n=x.prototype;n._observeStart=function(l,g){1===l&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:g.data.button,buttons:g.data.buttons,pointerType:g.data.pointerType,timestamp:g.data.timestamp,pointers:g.data.pointers,pointer:g.data.pointer,angle:g.data.angle,radius:g.data.radius,center:g.data.center}),g.stopPropagation());this._state=2===l?"ready":"failed"};n._observeUpdate=function(l,g,f){"failed"!==this._state&&2===l&&("active"===this._state?
(this._vertical.emit({delta:g.data.center.y-this._thresholdReachedCenter.y,action:"update"}),g.stopPropagation()):this._checkMovementWithinLimits(g.data,f.data)?this._checkVerticalThresholdReached(g.data,f.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=g.data.center,this._artificalDrag.emit({action:"end",button:g.data.button,buttons:g.data.buttons,pointerType:g.data.pointerType,timestamp:g.data.timestamp,pointers:g.data.pointers,pointer:g.data.pointer,angle:g.data.angle,
radius:g.data.radius,center:g.data.center}),this._vertical.emit({delta:g.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),g.stopPropagation()):this._state="failed")};n._observeEnd=function(l){"active"===this._state&&(this._vertical.emit({delta:l.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",l.stopPropagation())};n._checkMovementWithinLimits=function(l,g){let f=-Infinity,d=Infinity,e=-Infinity,k=Infinity;for(const {x:q,y}of g.pointers.values())f=Math.max(f,
q),d=Math.min(d,q),e=Math.max(e,y),k=Math.min(k,y);let u=-Infinity,p=Infinity,h=-Infinity,r=Infinity;for(const {x:q,y}of l.pointers.values())u=Math.max(u,q),p=Math.min(p,q),h=Math.max(h,y),r=Math.min(r,y);return Math.abs(l.center.x-g.center.x)<this._threshold&&Math.abs(u-p-(f-d))<=this._maxDelta&&Math.abs(h-r-(e-k))<=this._maxDelta};n._checkVerticalThresholdReached=function(l,g){let f=Math.abs(l.center.y-g.center.y);l.pointers.forEach((d,e)=>{e=g.pointers.get(e);f=Math.min(f,Math.abs(d.y-e.y))});
return f>=this._threshold};b._createClass(x,[{key:"failed",get:function(){return"failed"===this._state}}]);return x}(w.InputHandler);a.VerticalTwoFingerDrag=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._callbacks=x;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=()=>!0)}var n=w.prototype;n.handle=
function(x){const m=x.data,l=m.pointers.size;switch(m.action){case "start":this._currentCount=l;this._emitStart(x);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=l;this._emitStart(x);break;case "update":this._emitUpdate(x);break;case "removed":this._startEvent&&this._emitEnd(this._previousEvent);this._currentCount=l;this._emitStart(x);break;case "end":this._emitEnd(x),this._currentCount=0}this._previousEvent=x};n._emitStart=function(x){this._startEvent=x;this._callbacks.condition?.(this._currentCount,
x)&&this._callbacks.start(this._currentCount,x,this._startEvent)};n._emitUpdate=function(x){this._callbacks.condition?.(this._currentCount,x)&&this._callbacks.update(this._currentCount,x,this._startEvent)};n._emitEnd=function(x){this._callbacks.condition?.(this._currentCount,x)&&this._callbacks.end(this._currentCount,x,this._startEvent);this._startEvent=null};return b._createClass(w)}();a.DragEventSeparator=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){function y(D){D=D.layer;return!(!D||!D.featureReduction||"selection"!==D.featureReduction.type)}function B(D){(D=D.graphics3DGraphics)&&D.forEach(z=>z.clearVisibilityFlag(h.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(D){function z(){var A=v.apply(this,arguments);A._handles=new w;A._contexts=new Map;A._viewState=new p.DeconflictorViewState;A.visibilityGroup=h.VisibilityGroup.GRAPHIC;A._iconMarginFactor=-.1;return A}b._inherits(z,D);var v=
b._createSuper(z);D=z.prototype;D.initialize=function(){this._handles.add([m.watch(()=>this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),m.watch(()=>this.view?.map?.ground?.opacity,(A,t)=>{1!==A&&1!==t||this.setDirty()}),m.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},m.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(q.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new r.LabelDeconflictor({view:this.view,
parent:this})};D.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};D.setDirty=function(){0<this._contexts.size&&(b._get(b._getPrototypeOf(z.prototype),"setDirty",this).call(this),this._labels.setDirty())};D.runTask=function(A){b._get(b._getPrototypeOf(z.prototype),"runTask",this).call(this,A);this.running||this._labels.setDirty()};D.setInitialIconVisibilityFlag=function(A,t){A=!(this._graphicSupportsDeconfliction(t)&&
y(A));t.setVisibilityFlag(h.VisibilityFlag.DECONFLICTION,A,h.VisibilityGroup.GRAPHIC)};D._updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};D._updateSlicePlane=function(){const A=this.view?this.view.slicePlane:null;x.isSome(A)&&u.transform(A,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=x.isSome(A)};D._slicePlaneChanged=function(){n.someMap(this._contexts,(A,t)=>
t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};D.addGraphicsOwner=function(A){const t=this._getGraphicsContext(A);return{addGraphic:C=>this._addGraphic(A,t,C),removeGraphic:C=>this._removeGraphic(t,C),labelingInfoChange:()=>this._labels.enabledChanged(A,t),featureReductionChange:()=>this.enabledChanged(A,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(A,t),clear:()=>t.forEach(C=>this._removeGraphic(t,C.graphics3DGraphic))}};D.removeGraphicsOwner=function(A){const t=this._contexts.get(A);
t&&(t.forEach(C=>this._removeGraphic(t,C.graphics3DGraphic)),this._contexts.delete(A),this.setDirty())};D._addGraphic=function(A,t,C){const E=C.graphic.uid;C=new p.DeconflictorGraphic(C,A.symbolCreationContext.slicePlaneEnabled);t.set(E,C);y(A)&&this.addToActiveGraphics(C);A.labelsEnabled&&this._labels.addToActiveGraphics(C)};D._removeGraphic=function(A,t){t=t.graphic.uid;const C=A.get(t);C&&(this.removeFromActiveGraphics(C),this._labels.removeFromActiveGraphics(C),A.delete(t),this.setDirty())};D.enabledChanged=
function(A,t){const C=y(A);C||B(A);this.modifyGraphics(t,C)};D._slicePlaneEnabledChanged=function(A,t){const C=A.symbolCreationContext.slicePlaneEnabled;t.forEach(E=>E.slicePlaneEnabled=C);this.setDirty()};D.getGraphicsLayers=function(A){return A.layers};D._graphicSupportsDeconfliction=function(A){if(A.isDraped)return!1;A=A.layers;if(!A||!A.length)return!1;for(const t of A)if(this.layerSupportsDeconfliction(t))return!0;return!1};D._getGraphicsContext=function(A){var t=this._contexts.get(A);if(t)return t;
t=new Map;this._contexts.set(A,t);this.setDirty();return t};b._createClass(z,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(A){this._iconMarginFactor=A;this.setDirty()}}]);return z}(p.Deconflictor);a.GraphicsDeconflictor=c.__decorate([k.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L){function*R(ia){if(Map.prototype.entries){ia=ia.entries();for(let na=ia.next();!na.done;na=ia.next())yield na.value[1]}else yield*ia.values()}function*O(ia,na,ba){na.clear();ia.forEach((ja,ka)=>{const da=na.pushNew();da.id=ka;da.visible=ja.graphics3DGraphic.hasVisibilityFlag(C.VisibilityFlag.DECONFLICTION,ba);da.prio=ja.info?ja.info[ba].distance:Number.MAX_VALUE});yield;const ea=na.iterableSort((ja,ka)=>ja.visible!==ka.visible?
ja.visible?-1:1:ja.prio!==ka.prio?ja.prio-ka.prio:ja.id-ka.id);for(let ja=ea.next();!ja.done;ja=ea.next())yield;na.forAll(ja=>{const ka=ia.get(ja.id);ka&&(ia.delete(ja.id),ia.set(ja.id,ka))});na.clear()}const J=r.create(),M=y.create(),G=y.create(),P=r.create(),U=u.create(),N=A.create(),S=v.create(),Q=r.create(),W=D.create();let V=b._createClass(function(){this.aabr=D.create();this.distance=0;this.visible=this.culled=!1});g=b._createClass(function(ia,na){this.graphics3DGraphic=ia;this.slicePlaneEnabled=
na;this.info={}});a.State=void 0;(function(ia){ia[ia.Idle=0]="Idle";ia[ia.Process=1]="Process";ia[ia.Sort=2]="Sort";ia[ia.Deconflict=3]="Deconflict";ia[ia.NumStates=4]="NumStates"})(a.State||(a.State={}));let T=function(){function ia(){this.camera=new F.Camera;this.slicePlane=z.create();this.slicePlaneEnabled=!1}ia.prototype.copyFrom=function(na){this.camera.copyFrom(na.camera);z.copy(na.slicePlane,this.slicePlane);this.slicePlaneEnabled=na.slicePlaneEnabled};return b._createClass(ia)}();a.Deconflictor=
function(ia){function na(ea){ea=ba.call(this,ea);ea._dirty=!1;ea._runningViewState=new T;ea._state=a.State.Idle;ea._active=new Map;ea._visible=new Map;ea._iterators=new Z;ea._accBinsNumX=15;ea._accBinsNumY=20;ea._accBinsSizeX=0;ea._accBinsSizeY=0;ea._accBins=null;ea.accNumTests=0;return ea}b._inherits(na,ia);var ba=b._createSuper(na);ia=na.prototype;ia.destroy=function(){this._active.clear();this._visible.clear();this._iterators=null};ia.setDirty=function(){!this._dirty&&0<this._active.size&&(this._dirty=
!0,this.notifyChange("updating"))};ia.runTask=function(ea){switch(this._state){case a.State.Idle:this._startUpdate(),ea.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ea))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ea))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ea))break;default:t.drawAccelerationStruct(this,this._visible),this._state=a.State.Idle,this.notifyChange("updating")}};
ia.modifyGraphics=function(ea,ja){ja?ea.forEach(ka=>this.addToActiveGraphics(ka)):ea.forEach(ka=>this.removeFromActiveGraphics(ka));this.setDirty()};ia.layerSupportsDeconfliction=function(ea){if(x.isNone(ea)||"object3d"!==ea.type)return!1;ea=ea.stageObject;return 1===(ea?ea.geometries.length:0)&&ea?.geometries[0]?.material instanceof I.HUDMaterial?!0:!1};ia._startUpdate=function(){t.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:ea,fullHeight:ja}=
this._runningViewState.camera;this._initBins(ea,ja);this._resetIterators()};ia.addToActiveGraphics=function(ea){ea.info[this.visibilityGroup]=new V;this._active.set(ea.graphics3DGraphic.graphic.uid,ea);this.setDirty()};ia.removeFromActiveGraphics=function(ea){this._visible.delete(ea.graphics3DGraphic.graphic.uid);const ja=ea.graphics3DGraphic;ja.destroyed||ja.clearVisibilityFlag(C.VisibilityFlag.DECONFLICTION,this.visibilityGroup);delete ea.info[this.visibilityGroup];this._active.delete(ea.graphics3DGraphic.graphic.uid);
this.setDirty()};ia._processActiveGraphics=function(ea){const ja=this._ensureActiveGraphicsIterator(),ka=k.invertOrIdentity(U,this._runningViewState.camera.projectionMatrix),da="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?N:null;let ha=0;x.isSome(da)&&(h.transformMat4(da,r.ZEROS,this._runningViewState.camera.viewMatrix),da[3]=B.getReferenceEllipsoid(this.view.spatialReference).radius,ha=A.distanceToSilhouette(da,r.ZEROS));for(;!ea.done;){ea.madeProgress();
var ca=ja.next();if(!0===ca.done)return this._resetActiveGraphicsIterator(),!0;const fa=(ca=ca.value)&&ca.info[this.visibilityGroup];fa&&(this._collectGraphics3DGraphics(ca,ka,da,ha),fa.culled?this._visible.delete(ca.graphics3DGraphic.graphic.uid):this._visible.set(ca.graphics3DGraphic.graphic.uid,ca))}return!1};ia._sortVisibleGraphics=function(ea){const ja=this._ensureSortGraphicsIterator();for(;!ea.done;){const ka=ja.next();ea.madeProgress();if(!0===ka.done)return this._resetSortGraphicsIterator(),
!0}return!1};ia._deconflictVisibleGraphics=function(ea){const ja=this._ensureVisibleGraphicsIterator(),ka=this.visibilityGroup===C.VisibilityGroup.LABEL;for(;!ea.done;){ea.madeProgress();var da=ja.next();if(!0===da.done)return this._resetVisibleGraphicsIterator(),!0;da=da.value;const ca=da.info[this.visibilityGroup];if(ca&&!ca.culled){var ha=da.graphics3DGraphic;(ha=(!ka||ha.isVisible())&&!this._isConflicted(da))&&this._addToBins(da);ca.visible=ha;this._setGraphicVisibility(da,ha);t.drawPoly(ca,ha)}}return!1};
ia._resetIterators=function(){this._iterators.active=null;this._iterators.visible=null;this._iterators.sort=null};ia._ensureActiveGraphicsIterator=function(){this._iterators.active||(this._iterators.active=R(this._active));return this._iterators.active};ia._resetActiveGraphicsIterator=function(){this._iterators.active=null};ia._ensureVisibleGraphicsIterator=function(){this._iterators.visible||(this._iterators.visible=R(this._visible));return this._iterators.visible};ia._resetVisibleGraphicsIterator=
function(){this._iterators.visible=null};ia._ensureSortGraphicsIterator=function(){this._iterators.sort||(this._iterators.sort=O(this._visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort};ia._resetSortGraphicsIterator=function(){this._iterators.sort=null};ia._collectGraphics3DGraphics=function(ea,ja,ka,da){var ha=ea.graphics3DGraphic;if(!ha.destroyed){var ca=ea.info[this.visibilityGroup];if(ha.isVisible(C.VisibilityGroup.GRAPHIC,C.VisibilityFlag.DECONFLICTION)){var fa=
this.getGraphicsLayers(ha);D.empty(ca.aabr);ha=null;for(const ma of fa)if(this.layerSupportsDeconfliction(ma)){fa=ma.stageObject.geometries[0].material;if(x.isNone(ha)){ha=aa;this._getProjectionInfo(ma,ja,ha);if(ha.isOutsideScreen||this._isCulledBySlice(ea,J)||x.isSome(ka)&&this._isCulledByHorizon(ha,ka,da)){ca.culled=!0;return}!E.TESTS_DISABLE_OPTIMIZATIONS&&ca.visible&&(ha.distance*=.7)}this._expandBoundingRect(ca,ma,fa,ha)}x.isNone(ha)?ca.culled=!0:(ca.distance=ha.distance,ca.culled=!1)}else ca.culled=
!0}};ia._getProjectionInfo=function(ea,ja,ka){const da=this._runningViewState.camera;ea=ea.stageObject;var ha=ea.geometries[0];const ca=ha.material;var fa=A.getCenter(ea.boundingVolumeWorldSpace.bounds);h.transformMat4(J,fa,da.viewMatrix);fa=ha.vertexAttributes;ha=fa.get(K.VertexAttribute.NORMAL).data;fa=fa.get(K.VertexAttribute.AUXPOS1).data;ca.applyShaderOffsetsView(J,ha,ea.transformation,fa,da,ka.scaleInfo,J);q.set(M,J[0],J[1],J[2],1);q.transformMat4(G,M,da.projectionMatrix);h.scale(ka.positionNDC,
G,1/G[3]);ca.applyShaderOffsetsNDC(ka.positionNDC,fa,da,ka.positionNDC,P);ka.distanceWithoutPolygonOffset=da.depthNDCToWorld(P[2]);ka.distance=P[2]===ka.positionNDC[2]?ka.distanceWithoutPolygonOffset:da.depthNDCToWorld(ka.positionNDC[2]);q.set(G,ka.positionNDC[0],ka.positionNDC[1],ka.positionNDC[2],1);q.transformMat4(M,G,ja);q.scale(M,M,1/M[3]);h.set(ka.positionView,J[0],J[1],J[2])};ia._isCulledByHorizon=function(ea,ja,ka){h.copy(S.direction,ea.positionView);h.set(S.origin,0,0,0);return A.intersectRay(ja,
S,Q)?ea.distanceWithoutPolygonOffset>ka:!1};ia._isCulledBySlice=function(ea,ja){return ea.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&z.extrusionContainsPoint(this._runningViewState.slicePlane,ja)};ia._expandBoundingRect=function(ea,ja,ka,{positionNDC:da,scaleInfo:ha}){const ca=this._runningViewState.camera;ja=ja.getScreenSize(Y);H.applyPrecomputedScaleFactor(ja,ha.factor,ja);ja[0]*=ca.pixelRatio;ja[1]*=ca.pixelRatio;ka=D.offset(ka.calculateRelativeScreenBounds(ja,ha.factorAlignment.scale,
W),n.lerp(0,ca.fullWidth,.5+.5*da[0]),n.lerp(0,ca.fullHeight,.5+.5*da[1]));da=this.iconMarginFactor;0!==da&&(da*=Math.min(D.width(ka),D.height(ka)),ka[0]-=da,ka[1]-=da,ka[2]+=da,ka[3]+=da);D.expand(ea.aabr,ka,ea.aabr)};ia._isConflicted=function(ea){const ja=ea.graphics3DGraphic.graphic.uid;ea=ea.info[this.visibilityGroup];for(let ka=Math.floor(ea.aabr[0]/this._accBinsSizeX);ka<=Math.floor(ea.aabr[2]/this._accBinsSizeX);ka++)if(!(0>ka||ka>=this._accBinsNumX))for(let da=Math.floor(ea.aabr[1]/this._accBinsSizeY);da<=
Math.floor(ea.aabr[3]/this._accBinsSizeY);da++){if(0>da||da>=this._accBinsNumY)continue;const ha=this._accBins[ka][da];for(let ca=0;ca<ha.length;ca++){const fa=ha.data[ca],ma=fa.info[this.visibilityGroup];if(ma&&ma.visible&&fa.graphics3DGraphic.graphic.uid!==ja&&(this.accNumTests++,D.intersects(ma.aabr,ea.aabr)))return!0}}return!1};ia._initBins=function(ea,ja){if(null==this._accBins){this._accBins=[];for(var ka=0;ka<this._accBinsNumX;ka++){this._accBins.push([]);var da=this._accBins[this._accBins.length-
1];for(let ha=0;ha<this._accBinsNumY;ha++)da.push(new m)}}else for(ka=0;ka<this._accBinsNumX;ka++)for(da=0;da<this._accBinsNumY;da++)this._accBins[ka][da].clear();this._accBinsSizeX=ea/this._accBinsNumX;this._accBinsSizeY=ja/this._accBinsNumY;this.accNumTests=0};ia._addToBins=function(ea){var ja=ea.info[this.visibilityGroup],ka=Math.floor(ja.aabr[0]/this._accBinsSizeX);const da=Math.floor(ja.aabr[2]/this._accBinsSizeX),ha=Math.floor(ja.aabr[1]/this._accBinsSizeY);for(ja=Math.floor(ja.aabr[3]/this._accBinsSizeY);ka<=
da;ka++)if(!(0>ka||ka>=this._accBinsNumX))for(let ca=ha;ca<=ja;ca++)0>ca||ca>=this._accBinsNumY||this._accBins[ka][ca].push(ea)};ia._setGraphicVisibility=function(ea,ja){ea=ea.graphics3DGraphic;ea.destroyed||(ea.setVisibilityFlag(C.VisibilityFlag.DECONFLICTION,ja,this.visibilityGroup),this.visibilityGroup===C.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ea,ja))};b._createClass(na,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},
{key:"updating",get:function(){return this._state!==a.State.Idle||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ea=this._state/a.State.NumStates;return this._dirty?.5*ea:ea}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return na}(w);c.__decorate([l.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([l.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);
a.Deconflictor=c.__decorate([e.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);let X=b._createClass(function(){}),Z=b._createClass(function(ia=null,na=null,ba=null){this.active=ia;this.visible=na;this.sort=ba;this.sortArray=new m({allocator:ea=>ea||new X})});const Y=p.create(),aa=new (function(){function ia(){this.positionView=r.create();this.positionNDC=r.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=new L.ScaleInfo}b._createClass(ia,[{key:"isOutsideScreen",
get:function(){const na=this.positionNDC;return-1>na[0]||-1>na[1]||-1>na[2]||1<=na[0]||1<=na[1]}}]);return ia}());a.DeconflictorGraphic=g;a.DeconflictorViewState=T;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(d,e,k,u,p){l&&(l(),l=null);const h=g.height,r=f;r.beginPath();r.lineWidth=1;r.strokeStyle=p;r.moveTo(d,h-k);r.lineTo(e,h-k);r.stroke();r.lineTo(e,
h-u);r.stroke();r.lineTo(e,h-k);r.stroke();r.lineTo(d,h-k);r.stroke();r.lineTo(d,h-k);r.stroke();r.closePath()}let w=!1,n=!1,x=!1,m=!1,l=null,g,f;a.drawAccelerationStruct=function(d,e){if(n&&f){l&&(l(),l=null);var k=f,u=0;for(let p=0;p<d.accBinsNumX;p++)for(let h=0;h<d.accBinsNumY;h++){const r=d.accBins[p][d.accBinsNumY-1-h];u+=r.length;const q=p*d.accBinsSizeX,y=(p+1)*d.accBinsSizeX,B=h*d.accBinsSizeY,D=(h+1)*d.accBinsSizeY;k.fillText(r.length.toFixed(),q+5,B+15);c(q,y,B,D,"blue")}k.fillText("total totalShownLabels: "+
u,70,40);k.fillText("total visible labels: "+e.size,70,50);k.fillText("total numTests: "+d.accNumTests,70,30)}};a.drawPoly=function(d,e){w&&(e&&x||!e&&m)&&c(d.aabr[0],d.aabr[2],d.aabr[1],d.aabr[3],e?"green":"red")};a.prepare=function(d){x=b.DECONFLICTOR_SHOW_VISIBLE;m=b.DECONFLICTOR_SHOW_INVISIBLE;w=x||m;n=b.DECONFLICTOR_SHOW_GRID;l=null;w||n?l=()=>{null==g&&(g=document.createElement("canvas"),g.setAttribute("id","canvas2d"),d.surface.parentElement.style.position="relative",d.surface.parentElement.appendChild(g));
var {state:e}=d;const {camera:k,pixelRatio:u}=e,{width:p,height:h}=k;e=h*u;g.setAttribute("width",`${p*u}px`);g.setAttribute("height",`${e}px`);g.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${p}px;height:${h}px`);f=g.getContext("2d");f.clearRect(0,0,p,h);f.font="12px Arial"}:g&&(g.parentElement.removeChild(g),g=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){c=function(g){function f(){var e=d.apply(this,arguments);e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.DECONFLICTOR_SHOW_VISIBLE=!1;e.DECONFLICTOR_SHOW_INVISIBLE=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.TEXT_SHOW_BASELINE=!1;e.TEXT_SHOW_BORDER=!1;e.OVERLAY_DRAW_DEBUG_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.SHOW_POI=!1;e.TESTS_DISABLE_OPTIMIZATIONS=!1;e.TESTS_DISABLE_FAST_UPDATES=!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=
!1;e.TERRAIN_TILE_TREE_SHOW_TILES=!1;e.I3S_TREE_SHOW_TILES=!1;e.I3S_SHOW_MODIFICATIONS=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;e.LINE_WIREFRAMES=!1;return e}a._inherits(f,g);var d=a._createSuper(f);return a._createClass(f)}(c);b.__decorate([w.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([w.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([w.property()],
c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([w.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([w.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([w.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([w.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([w.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([w.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([w.property()],
c.prototype,"SHOW_POI",void 0);b.__decorate([w.property()],c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([w.property()],c.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([w.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([w.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([w.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([w.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);
b.__decorate([w.property()],c.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([w.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([w.property()],c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([w.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([w.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([w.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=b.__decorate([l.subclass("esri.views.3d.support.DebugFlags")],
c);return new c})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=0]="GRAPHIC";b[b.LABEL=1]="LABEL";b[b._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(b){b[b.USER_SETTING=0]="USER_SETTING";b[b.SCALE_RANGE=1]="SCALE_RANGE";b[b.FILTER=2]="FILTER";b[b.DECONFLICTION=3]="DECONFLICTION";b[b._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,w){function n(e,k,u){const p=u.parameters;u=u.paddingPixelsOverride;f.scale=Math.min(p.divisor/(k-p.offset),1);f.factor=Math.abs(e*e*e);f.minPixelSize=p.minPixelSize;f.paddingPixels=u;return f}function x(e,k){return 0===e?k.minPixelSize:k.minPixelSize*(1+2*
k.paddingPixels/e)}function m(e,k){return Math.max(c.lerp(e*k.scale,e,k.factor),x(e,k))}let l=function(){function e(u,p,h,r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},q){this._viewingMode=u;this._description=p;this._ellipsoidRadius=h;this.parameters=r;this._paddingPixelsOverride=q;this._viewingMode===w.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):
(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}var k=e.prototype;k.update=function(u){if(this.parameters&&this.parameters.camera.fovY===u.fovY&&this.parameters.camera.distance===u.distance)return!1;this._calculateParameters(u,this._ellipsoidRadius,this.parameters);return!0};k.overridePadding=function(u){return u!==this.paddingPixelsOverride?new e(this._viewingMode,this._description,
this._ellipsoidRadius,this.parameters,u):this};k._calculateParameters=function(u,p,h){const {scaleStart:r,scaleFallOffRange:q,minPixelSize:y}=this._description,{fovY:B,distance:D}=u;var z=this._calculateCurvatureDependentParameters(u,p);p=this._coverageCompensation(u,p,z);const {tiltAngle:v,scaleFallOffFactor:A}=z,t=Math.sin(v)*D,C=.5*Math.PI-v-B*(.5-r*p);z=t/Math.cos(C);p=(z-t/Math.cos(C+B*q*p)*A)/(1-A);h.camera.fovY=u.fovY;h.camera.distance=u.distance;h.offset=p;h.divisor=z-p;h.minPixelSize=y;return h};
k._calculateCurvatureDependentParametersLocal=function(u,p,h=d){h.tiltAngle=this._description.curvatureDependent.min.tiltAngle;h.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return h};k._calculateCurvatureDependentParametersGlobal=function(u,p,h=d){const r=this._description.curvatureDependent;u=1+u.distance/p;u=Math.sqrt(u*u-1);const [q,y]=[r.min.curvature,r.max.curvature];u=c.clamp((u-q)/(y-q),0,1);const [B,D]=[r.min,r.max];h.tiltAngle=c.lerp(B.tiltAngle,D.tiltAngle,
u);h.scaleFallOffFactor=c.lerp(B.scaleFallOffFactor,D.scaleFallOffFactor,u);return h};k._surfaceCoverageCompensationLocal=function(u,p,h){return(u.fovY-h.tiltAngle)/u.fovY};k._surfaceCoverageCompensationGlobal=function(u,p,h){const r=p*p;h=h.tiltAngle+.5*Math.PI;const {fovY:q,distance:y}=u;u=y*y+r-2*Math.cos(h)*y*p;const B=Math.sqrt(u);return(Math.acos(Math.sqrt(u-r)/B)-Math.asin(p/(B/Math.sin(h)))+.5*q)/q};b._createClass(e,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels}}]);return e}();const g={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={scale:0,factor:0,minPixelSize:0,paddingPixels:0},d={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(e,k,u=[0,0]){k=Math.min(Math.max(k.scale,x(e[1],k)/Math.max(1E-5,e[1])),1);u[0]=e[0]*k;u[1]=e[1]*
k;return u};a.applyScaleFactor=m;a.getLabelSettings=function(e,k){const {curvatureDependent:u,scaleStart:p,scaleFallOffRange:h}=g;return new l(e,{curvatureDependent:{min:{curvature:u.min.curvature,tiltAngle:u.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:u.max.curvature,tiltAngle:u.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:p,scaleFallOffRange:h,minPixelSize:14},k)};a.getSettings=function(e,k){return new l(e,g,k)};a.precomputeScaleFactor=function(e,k,u,p){e=n(e,k,u);e.minPixelSize=0;
e.paddingPixels=0;e=m(1,e);p.scale=e;p.factor=0;p.minPixelSize=u.parameters.minPixelSize;p.paddingPixels=u.paddingPixelsOverride};a.scale=function(e,k,u,p){return m(e,n(k,u,p))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R){function O(ha,ca,fa,ma=U){f.copy(ma,ha.anchorPosition);ma[0]*=-ca[0];ma[1]*=-ca[1];ma[0]+=ha.screenOffset[0]*fa;ma[1]+=ha.screenOffset[1]*fa;return ma}function J(ha,ca,fa,ma,qa,wa,xa,pa){ca=ca-qa-(0<pa[0]?ma[0]*pa[0]:0);let ra=ca+ma[0]+2*qa;fa=fa-qa-(0<pa[1]?ma[1]*pa[1]:0);qa=fa+ma[1]+2*qa;pa=xa.distanceFieldBoundingBox;xa.textureIsSignedDistanceField&&n.isSome(pa)&&(ca+=ma[0]*pa[0],fa+=ma[1]*pa[1],ra-=ma[0]*(1-pa[2]),qa-=
ma[1]*(1-pa[3]),ca-=wa,ra+=wa,fa-=wa,qa+=wa);return ha[0]>ca&&ha[0]<ra&&ha[1]>fa&&ha[1]<qa}let M=function(ha){function ca(ma){ma=fa.call(this,ma,new ea);ma._configuration=new R.HUDMaterialTechniqueConfiguration;return ma}b._inherits(ca,ha);var fa=b._createSuper(ca);ha=ca.prototype;ha.getConfiguration=function(ma,qa){this._configuration.output=ma;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=
!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?D.HUDSpace.Screen:D.HUDSpace.World;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.isDraped=this.parameters.isDraped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;
this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=qa.slot===A.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(ma===B.ShaderOutput.Color||ma===B.ShaderOutput.Alpha);ma===B.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!q.LABELS_SHOW_BORDER);ma===B.ShaderOutput.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion);this._configuration.depthEnabled=
this.parameters.depthEnabled;this._configuration.transparencyPassType=qa.transparencyPassType;this._configuration.hasMultipassGeometry=qa.multipassGeometry.enabled;this._configuration.hasMultipassTerrain=qa.multipassTerrain.enabled;this._configuration.cullAboveGround=qa.multipassTerrain.cullAboveGround;return this._configuration};ha.intersect=function(ma,qa,wa,xa,pa,ra){if(wa.options.selectionMode&&wa.options.hud&&ma.visible){xa=this.parameters;var va=pa=1;x.fromMat4(T,qa);if(n.isSome(ma.shaderTransformer)){va=
ma.shaderTransformer(ia);pa=va[0];va=va[5];var Ba=T,Aa=Ba[0],Ha=Ba[1],Ka=Ba[2],Pa=Ba[3],Ra=Ba[4],Sa=Ba[5],La=Ba[6],Ua=Ba[7],Za=Ba[8],Xa=1/Math.sqrt(Aa*Aa+Ha*Ha+Ka*Ka);const la=1/Math.sqrt(Pa*Pa+Ra*Ra+Sa*Sa),Ta=1/Math.sqrt(La*La+Ua*Ua+Za*Za);Ba[0]=Aa*Xa;Ba[1]=Ha*Xa;Ba[2]=Ka*Xa;Ba[3]=Pa*la;Ba[4]=Ra*la;Ba[5]=Sa*la;Ba[6]=La*Ta;Ba[7]=Ua*Ta;Ba[8]=Za*Ta}Ba=ma.vertexAttributes.get(E.VertexAttribute.POSITION);Aa=ma.vertexAttributes.get(E.VertexAttribute.SIZE);Ha=ma.vertexAttributes.get(E.VertexAttribute.NORMAL);
ma=ma.vertexAttributes.get(E.VertexAttribute.AUXPOS1);C.assert(3<=Ba.size);Ka=wa.point;Pa=wa.camera;Ra=I.calculateAnchorPosForRendering(xa);pa*=Pa.pixelRatio;va*=Pa.pixelRatio;Sa="screen"===this.parameters.centerOffsetUnits;for(La=0;La<Ba.data.length/Ba.size;La++)Ua=La*Ba.size,e.set(N,Ba.data[Ua],Ba.data[Ua+1],Ba.data[Ua+2]),e.transformMat4(N,N,qa),Ua=La*Aa.size,na[0]=Aa.data[Ua]*pa,na[1]=Aa.data[Ua+1]*va,e.transformMat4(N,N,Pa.viewMatrix),Ua=La*ma.size,e.set(Y,ma.data[Ua],ma.data[Ua+1],ma.data[Ua+
2]),Sa||(N[0]+=Y[0],N[1]+=Y[1],0!==Y[2]&&(Ua=Y[2],e.normalize(Y,N),e.subtract(N,N,e.scale(Y,Y,Ua)))),Ua=La*Ha.size,e.set(S,Ha.data[Ua],Ha.data[Ua+1],Ha.data[Ua+2]),this._normalAndViewAngle(S,T,Pa,aa),this._applyVerticalOffsetTransformationView(N,aa,Pa,P),Pa.applyProjection(N,Q),-1<Q[0]&&(Q[0]=Math.floor(Q[0]),Q[1]=Math.floor(Q[1]),Sa&&(Y[0]||Y[1])&&(Q[0]+=Y[0],0!==Y[1]&&(Q[1]+=t.applyScaleFactor(Y[1],P.factorAlignment)),Pa.unapplyProjection(Q,N)),Q[0]+=this.parameters.screenOffset[0],Q[1]+=this.parameters.screenOffset[1],
t.applyPrecomputedScaleFactor(na,P.factor,na),Ua=1*Pa.pixelRatio,Za=0,xa.textureIsSignedDistanceField&&(Za=xa.outlineSize*Pa.pixelRatio/2),Ka&&J(Ka,Q[0],Q[1],na,Ua,Za,xa,Ra)&&(Za=wa.ray,e.transformMat4(V,N,l.invert(Z,Pa.viewMatrix)),Q[0]=Ka[0],Q[1]=Ka[1],Pa.unprojectFromRenderScreen(Q,N)&&(Ua=k.create(),e.copy(Ua,Za.direction),Xa=1/e.length(Ua),e.scale(Ua,Ua,Xa),Za=e.distance(Za.origin,N)*Xa,ra(Za,Ua,-1,!0,1,V))))}};ha.intersectDraped=function(ma,qa,wa,xa,pa,ra){qa=ma.vertexAttributes.get(E.VertexAttribute.POSITION);
wa=ma.vertexAttributes.get(E.VertexAttribute.SIZE);const va=this.parameters,Ba=I.calculateAnchorPosForRendering(va);let Aa=1;var Ha=1;n.isSome(ma.shaderTransformer)&&(Ha=ma.shaderTransformer(ia),Aa=Ha[0],Ha=Ha[5]);Aa*=ma.screenToWorldRatio;Ha*=ma.screenToWorldRatio;const Ka=2*ma.screenToWorldRatio;for(let Sa=0;Sa<qa.data.length/qa.size;Sa++){var Pa=Sa*qa.size;const La=qa.data[Pa];Pa=qa.data[Pa+1];var Ra=Sa*wa.size;na[0]=wa.data[Ra]*Aa;na[1]=wa.data[Ra+1]*Ha;Ra=0;va.textureIsSignedDistanceField&&(Ra=
va.outlineSize*ma.screenToWorldRatio/2);J(xa,La,Pa,na,Ka,Ra,va,Ba)&&pa(ra.dist,ra.normal,-1,!1)}};ha.createBufferWriter=function(){return new da(this)};ha._normalAndViewAngle=function(ma,qa,wa,xa){p.isMat4(qa)&&(qa=x.fromMat4(X,qa));e.transformMat3(xa.normal,ma,qa);e.transformMat4(xa.normal,xa.normal,wa.viewInverseTransposeMatrix);xa.cosAngle=e.dot(W,ba);return xa};ha._updateScaleInfo=function(ma,qa,wa){const xa=this.parameters;n.isSome(xa.screenSizePerspective)?t.precomputeScaleFactor(wa,qa,xa.screenSizePerspective,
ma.factor):(ma.factor.scale=1,ma.factor.factor=0,ma.factor.minPixelSize=0,ma.factor.paddingPixels=0);n.isSome(xa.screenSizePerspectiveAlignment)?t.precomputeScaleFactor(wa,qa,xa.screenSizePerspectiveAlignment,ma.factorAlignment):(ma.factorAlignment.factor=ma.factor.factor,ma.factorAlignment.scale=ma.factor.scale,ma.factorAlignment.minPixelSize=ma.factor.minPixelSize,ma.factorAlignment.paddingPixels=ma.factor.paddingPixels)};ha.applyShaderOffsetsView=function(ma,qa,wa,xa,pa,ra,va){qa=this._normalAndViewAngle(qa,
wa,pa,aa);this._applyVerticalGroundOffsetView(ma,qa,pa,va);this._applyVerticalOffsetTransformationView(va,qa,pa,ra);this._applyPolygonOffsetView(va,qa,xa[3],pa,va);this._applyCenterOffsetView(va,xa,va);return va};ha.applyShaderOffsetsNDC=function(ma,qa,wa,xa,pa){this._applyCenterOffsetNDC(ma,qa,wa,xa);n.isSome(pa)&&e.copy(pa,xa);this._applyPolygonOffsetNDC(xa,qa,wa,xa);return xa};ha._applyPolygonOffsetView=function(ma,qa,wa,xa,pa){var ra=xa.aboveGround?1:-1;wa=Math.sign(wa);0===wa&&(wa=ra);ra*=wa;
if(0>=this.parameters.shaderPolygonOffset)return e.copy(pa,ma);qa=w.clamp(Math.abs(qa.cosAngle),.01,1);xa=1-Math.sqrt(1-qa*qa)/qa/xa.viewport[2];0<ra?e.scale(pa,ma,xa):e.scale(pa,ma,1/xa);return pa};ha._applyVerticalGroundOffsetView=function(ma,qa,wa,xa){const pa=e.length(ma),ra=wa.aboveGround?1:-1;wa=.5*wa.computeRenderPixelSizeAtDist(pa);qa=e.scale(N,qa.normal,ra*wa);e.add(xa,ma,qa);return xa};ha._applyVerticalOffsetTransformationView=function(ma,qa,wa,xa){const pa=this.parameters;if(!pa.verticalOffset||
!pa.verticalOffset.screenLength){if(pa.screenSizePerspective||pa.screenSizePerspectiveAlignment){var ra=e.length(ma);this._updateScaleInfo(xa,ra,qa.cosAngle)}else xa.factor.scale=1,xa.factorAlignment.scale=1;return ma}ra=e.length(ma);const va=n.unwrapOr(pa.screenSizePerspectiveAlignment,pa.screenSizePerspective);wa=K.verticalOffsetAtDistance(wa,ra,pa.verticalOffset,qa.cosAngle,va);this._updateScaleInfo(xa,ra,qa.cosAngle);e.scale(qa.normal,qa.normal,wa);return e.add(ma,ma,qa.normal)};ha._applyCenterOffsetView=
function(ma,qa,wa){const xa="screen"!==this.parameters.centerOffsetUnits;wa!==ma&&e.copy(wa,ma);xa&&(wa[0]+=qa[0],wa[1]+=qa[1],qa[2]&&(e.normalize(S,wa),e.add(wa,wa,e.scale(S,S,qa[2]))));return wa};ha._applyCenterOffsetNDC=function(ma,qa,wa,xa){const pa="screen"!==this.parameters.centerOffsetUnits;xa!==ma&&e.copy(xa,ma);pa||(xa[0]+=qa[0]/wa.fullWidth*2,xa[1]+=qa[1]/wa.fullHeight*2);return xa};ha._applyPolygonOffsetNDC=function(ma,qa,wa,xa){const pa=this.parameters.shaderPolygonOffset;ma!==xa&&e.copy(xa,
ma);pa&&(ma=wa.aboveGround?1:-1,xa[2]-=(ma*Math.sign(qa[3])||ma)*pa);return xa};ha.requiresSlot=function(ma,qa){if(qa===B.ShaderOutput.Color||qa===B.ShaderOutput.Alpha||qa===B.ShaderOutput.Highlight||qa===B.ShaderOutput.ObjectAndLayerIdColor){if(ma===A.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:wa,occlusionTest:xa}=this.parameters;return ma===(wa?A.RenderSlot.LABEL_MATERIAL:A.RenderSlot.HUD_MATERIAL)||xa&&ma===A.RenderSlot.OCCLUSION_PIXELS}return!1};ha.createGLMaterial=function(ma){return new G(ma)};
ha.calculateRelativeScreenBounds=function(ma,qa,wa=h.create()){O(this.parameters,ma,qa,wa);wa[2]=wa[0]+ma[0];wa[3]=wa[1]+ma[1];return wa};return b._createClass(ca)}(v.Material),G=function(ha){function ca(ma){return fa.call(this,{...ma,...ma.material.parameters})}b._inherits(ca,ha);var fa=b._createSuper(ca);ha=ca.prototype;ha.selectProgram=function(ma){return this.ensureTechnique(L.HUDMaterialTechnique,ma)};ha.beginSlot=function(ma){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);
return this.selectProgram(ma)};return b._createClass(ca)}(z.GLTextureMaterial);const P=new F.ScaleInfo,U=d.create(),N=k.create(),S=k.create(),Q=u.create(),W=k.create(),V=k.create(),T=m.create(),X=m.create(),Z=g.create(),Y=k.create(),aa={normal:W,cosAngle:0},ia=g.create(),na=[0,0],ba=k.fromValues(0,0,1);let ea=function(ha){function ca(){var ma=fa.apply(this,arguments);ma.renderOccluded=v.RenderOccludedFlag.Occlude;ma.color=u.fromValues(1,1,1,1);ma.texCoordScale=[1,1];ma.polygonOffset=!1;ma.anchorPosition=
d.fromValues(.5,.5);ma.screenOffset=[0,0];ma.shaderPolygonOffset=1E-5;ma.textureIsSignedDistanceField=!1;ma.outlineColor=u.fromValues(1,1,1,1);ma.outlineSize=0;ma.vvSizeEnabled=!1;ma.vvSize=null;ma.vvColor=null;ma.vvOpacity=null;ma.vvSymbolAnchor=null;ma.vvSymbolRotationMatrix=null;ma.hasSlicePlane=!1;ma.pixelSnappingEnabled=!0;ma.occlusionTest=!0;ma.binaryHighlightOcclusion=!0;ma.centerOffsetUnits="world";ma.drawInSecondSlot=!1;ma.depthEnabled=!0;ma.isDraped=!1;return ma}b._inherits(ca,ha);var fa=
b._createSuper(ca);return b._createClass(ca)}(z.GLTextureMaterialBindParameters);const ja=y.newLayout().vec3f(E.VertexAttribute.POSITION).vec3f(E.VertexAttribute.NORMAL).vec2f(E.VertexAttribute.UV0).vec4u8(E.VertexAttribute.COLOR).vec2f(E.VertexAttribute.SIZE).vec4f(E.VertexAttribute.AUXPOS1).vec4f(E.VertexAttribute.AUXPOS2),ka=ja.clone().vec4u8(E.VertexAttribute.OBJECTANDLAYERIDCOLOR);let da=function(){function ha(fa){this._material=fa;this.vertexBufferLayout=c("enable-feature:objectAndLayerId-rendering")?
ka:ja}var ca=ha.prototype;ca.allocate=function(fa){return this.vertexBufferLayout.createBuffer(fa)};ca.elementCount=function(fa){return 6*fa.indices.get(E.VertexAttribute.POSITION).length};ca.write=function(fa,ma,qa,wa,xa){H.writePosition(qa.indices.get(E.VertexAttribute.POSITION),qa.vertexAttributes.get(E.VertexAttribute.POSITION).data,fa,wa.position,xa,6);H.writeNormal(qa.indices.get(E.VertexAttribute.NORMAL),qa.vertexAttributes.get(E.VertexAttribute.NORMAL).data,ma,wa.normal,xa,6);fa=qa.vertexAttributes.get(E.VertexAttribute.UV0).data;
var pa;if(null==fa||4>fa.length){fa=this._material.parameters;var ra=pa=0;var va=fa.texCoordScale[0];var Ba=fa.texCoordScale[1]}else pa=fa[0],ra=fa[1],va=fa[2],Ba=fa[3];va=Math.min(1.99999,va+1);Ba=Math.min(1.99999,Ba+1);fa=qa.indices.get(E.VertexAttribute.POSITION).length;ma=xa;var Aa=wa.uv0;for(var Ha=0;Ha<fa;++Ha)Aa.set(ma,0,pa),Aa.set(ma,1,ra),ma+=1,Aa.set(ma,0,va),Aa.set(ma,1,ra),ma+=1,Aa.set(ma,0,va),Aa.set(ma,1,Ba),ma+=1,Aa.set(ma,0,va),Aa.set(ma,1,Ba),ma+=1,Aa.set(ma,0,pa),Aa.set(ma,1,Ba),
ma+=1,Aa.set(ma,0,pa),Aa.set(ma,1,ra),ma+=1;H.writeColor(qa.indices.get(E.VertexAttribute.COLOR),qa.vertexAttributes.get(E.VertexAttribute.COLOR).data,4,wa.color,xa,6);pa=qa.indices.get(E.VertexAttribute.SIZE);ra=qa.vertexAttributes.get(E.VertexAttribute.SIZE).data;fa=pa.length;va=wa.size;ma=xa;for(Ba=0;Ba<fa;++Ba){Aa=ra[2*pa[Ba]];Ha=ra[2*pa[Ba]+1];for(let Ka=0;6>Ka;++Ka)va.set(ma,0,Aa),va.set(ma,1,Ha),ma+=1}qa.indices.get(E.VertexAttribute.AUXPOS1)&&qa.vertexAttributes.get(E.VertexAttribute.AUXPOS1)?
H.writeBufferVec4(qa.indices.get(E.VertexAttribute.AUXPOS1),qa.vertexAttributes.get(E.VertexAttribute.AUXPOS1).data,wa.auxpos1,xa,6):H.writeBufferVec4Zeros(wa.auxpos1,xa,6*fa);qa.indices.get(E.VertexAttribute.AUXPOS2)&&qa.vertexAttributes.get(E.VertexAttribute.AUXPOS2)?H.writeBufferVec4(qa.indices.get(E.VertexAttribute.AUXPOS2),qa.vertexAttributes.get(E.VertexAttribute.AUXPOS2).data,wa.auxpos2,xa,6):H.writeBufferVec4Zeros(wa.auxpos2,xa,6*fa);n.isSome(qa.objectAndLayerIdColor)&&qa.indices.get(E.VertexAttribute.POSITION)&&
(fa=qa.indices.get(E.VertexAttribute.POSITION).length,wa=wa.getField(E.VertexAttribute.OBJECTANDLAYERIDCOLOR,r.BufferViewVec4u8),H.writeObjectAndLayerIdColor(qa.objectAndLayerIdColor,wa,fa,xa,6))};return b._createClass(ha)}();a.HUDMaterial=M;a.Parameters=ea;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(w){return w instanceof Float32Array&&16<=w.length}function c(w){return Array.isArray(w)&&
16<=w.length}a.isMat4=function(w){return b(w)||c(w)};a.isMat4f32=b;a.isMat4f64=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ./HUDUniforms ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f){a.HUDSpace=void 0;(function(d){d[d.World=0]="World";d[d.Screen=1]="Screen";d[d.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(d,e){d.include(w.ScreenSizePerspective);d.attributes.add(f.VertexAttribute.POSITION,"vec3");d.attributes.add(f.VertexAttribute.NORMAL,"vec3");d.attributes.add(f.VertexAttribute.AUXPOS1,"vec4");d=d.vertex;n.addProjViewLocalOrigin(d,e);n.addCameraPosition(d,e);d.uniforms.add([new x.Float4PassUniform("viewport",(k,u)=>u.camera.fullViewport),
new m.FloatPassUniform("polygonOffset",k=>k.shaderPolygonOffset),new m.FloatPassUniform("cameraGroundRelative",(k,u)=>u.camera.aboveGround?1:-1),new m.FloatPassUniform("renderTransparentlyOccludedHUD",(k,u)=>u.renderTransparentlyOccludedHUD===c.HUDTransparencyRenderStyle.Occluded?1:u.renderTransparentlyOccludedHUD===c.HUDTransparencyRenderStyle.NotOccluded?0:.75),new g.Texture2DPassUniform("hudVisibilityTexture",(k,u)=>u.hudVisibilityTexture)]);e.hasVerticalOffset&&b.addVerticalOffset(d);d.constants.add("smallOffsetAngle",
"float",.984807753012208);d.code.add(l.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);d.code.add(l.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);e.isDraped&&!e.hasVerticalOffset||n.addViewNormal(d);e.isDraped||(d.uniforms.add(new m.FloatPassUniform("perDistancePixelRatio",(k,u)=>Math.tan(u.camera.fovY/2)/(u.camera.fullViewport[2]/2))),d.code.add(l.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`));e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen&&d.uniforms.add(new m.FloatPassUniform("pixelRatio",(k,u)=>u.camera.pixelRatio));e.hasScreenSizePerspective&&w.addScreenSizePerspectiveAlignment(d);d.code.add(l.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective?e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${e.hasVerticalOffset?l.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?l.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?e.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);d.code.add(l.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,w,n,x,m){function l(f){f.uniforms.add(new x.Float4PassUniform("verticalOffset",(d,e)=>{const {minWorldLength:k,maxWorldLength:u,
screenLength:p}=d.verticalOffset;return b.set(g,p*(e.camera.pixelRatio||1),Math.tan(.5*e.camera.fovY)/(.5*e.camera.fullViewport[3]),k,u)}))}const g=c.create();a.VerticalOffset=function(f,d){const e=f.vertex;d.hasVerticalOffset?(l(e),d.hasScreenSizePerspective&&(f.include(w.ScreenSizePerspective),w.addScreenSizePerspectiveAlignment(e),n.addCameraPosition(f.vertex,d)),e.code.add(m.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${d.spherical?m.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:m.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${d.hasScreenSizePerspective?m.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:m.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):e.code.add(m.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec4","../../../../../../chunks/vec4f64","../../shaderModules/Float4PassUniform","../../shaderModules/interfaces"],function(a,b,c,w,n){function x(l){return b.set(m,l.parameters.divisor,
l.parameters.offset,l.parameters.minPixelSize,l.paddingPixelsOverride)}const m=c.create();a.ScreenSizePerspective=function(l){l.vertex.code.add(n.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);l.vertex.code.add(n.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);l.vertex.code.add(n.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);l.vertex.code.add(n.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);l.vertex.code.add(n.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);l.vertex.code.add(n.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);l.vertex.code.add(n.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(l){l.uniforms.add(new w.Float4PassUniform("screenSizePerspective",g=>x(g.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(l){l.uniforms.add(new w.Float4PassUniform("screenSizePerspectiveAlignment",g=>x(g.screenSizePerspectiveAlignment||g.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g){const f=c.create(),d=n.create();a.addCameraPosition=function(e,k){k.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",n.ZEROS):e.uniforms.add(new x.Float3DrawUniform("cameraPosition",(u,p)=>w.set(d,p.camera.viewInverseTransposeMatrix[3]-u.origin[0],p.camera.viewInverseTransposeMatrix[7]-u.origin[1],p.camera.viewInverseTransposeMatrix[11]-u.origin[2])))};a.addProjViewLocalOrigin=function(e,k){k.instancedDoublePrecision?e.uniforms.add([new g.Matrix4PassUniform("proj",
(u,p)=>p.camera.projectionMatrix),new g.Matrix4PassUniform("view",(u,p)=>b.translate(f,p.camera.viewMatrix,w.set(d,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]))),new m.Float3PassUniform("localOrigin",(u,p)=>w.set(d,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]))]):e.uniforms.add([new g.Matrix4PassUniform("proj",(u,p)=>p.camera.projectionMatrix),new l.Matrix4DrawUniform("view",
(u,p)=>b.translate(f,p.camera.viewMatrix,u.origin)),new x.Float3DrawUniform("localOrigin",u=>u.origin)])};a.addViewNormal=function(e){e.uniforms.add(new g.Matrix4PassUniform("viewNormal",(k,u)=>u.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,
w){c=function(n){function x(l,g){return m.call(this,l,"mat4",w.BindType.Draw,(f,d,e)=>f.setUniformMatrix4fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Matrix4DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparencyRenderStyle=void 0;var b=a.HUDTransparencyRenderStyle||(a.HUDTransparencyRenderStyle={});b[b.Occluded=
0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,b,c,w,n,
x,m,l,g,f){m=function(d){function e(u,p){var h=k.call(this);h.type=l.ContentObjectType.Material;h.supportsEdges=!1;h._visible=!0;h._renderPriority=0;h._insertOrder=0;h._vertexAttributeLocations=g.Default3D;h._pp0=w.fromValues(0,0,1);h._pp1=w.fromValues(0,0,0);h._parameters=f.copyParameters(u,p);h.validateParameters(h._parameters);return h}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.dispose=function(){};d.update=function(u){return!1};d.setParameters=function(u,p=!0){f.updateParameters(this._parameters,
u)&&(this.validateParameters(this._parameters),p&&this.parametersChanged())};d.validateParameters=function(u){};d.shouldRender=function(u){return this.isVisible()&&this.isVisibleForOutput(u.output)&&0!==(this.renderOccluded&u.renderOccludedMask)};d.isVisibleForOutput=function(u){return!0};d.isVisible=function(){return this._visible};d.parametersChanged=function(){c.isSome(this.repository)&&this.repository.materialChanged(this)};d.intersectDraped=function(u,p,h,r,q,y){this._pp0[0]=this._pp1[0]=r[0];
this._pp0[1]=this._pp1[1]=r[1];return this.intersect(u,p,h,this._pp0,this._pp1,q)};b._createClass(e,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(u){u!==this._visible&&(this._visible=u,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(u){u!==this._renderPriority&&(this._renderPriority=u,
this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(u){u!==this._insertOrder&&(this._insertOrder=u,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return e}(m.ContentObject);x=function(d){function e(u,p,h){p=k.call(this,p,h);p.camera=u;return p}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(x.Parameters);a.RenderOccludedFlag=void 0;(function(d){d[d.Occlude=1]="Occlude";
d[d.Transparent=2]="Transparent";d[d.OccludeAndTransparent=4]="OccludeAndTransparent";d[d.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";d[d.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));n=function(d){function e(){var u=k.apply(this,arguments);u.renderOccluded=a.RenderOccludedFlag.Occlude;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(n.NoParameters);a.Material=m;a.MaterialParameters=n;a.UpdateParameters=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){function e(t,C,E,F,H,K){if(!w.isNone(t)){var I=
p(C,E,D);m.setMin(B,t.bbMin);m.setMax(B,t.bbMax);w.isSome(H)&&H.applyToAabb(B);if(h(B,C,I,F)){const {primitiveIndices:L,indices:R,position:O}=t;I=L?L.length:R.length/3;if(1E3<I&&(t=t.getChildren(),void 0!==t)){for(const J of t)e(J,C,E,F,H,K);return}k(C,E,0,I,R,O,L,H,K)}}}function k(t,C,E,F,H,K,I,L,R){if(I){const {data:ba,stride:ea}=K;K=t[0];var O=t[1];t=t[2];var J=C[0]-K,M=C[1]-O;for(C=C[2]-t;E<F;++E){var G=I[E],P=3*G,U=ea*H[P++],N=ba[U++],S=ba[U++],Q=ba[U];U=ea*H[P++];var W=ba[U++],V=ba[U++],T=ba[U];
U=ea*H[P];P=ba[U++];var X=ba[U++];U=ba[U];w.isSome(L)&&([N,S,Q]=L.applyToVertex(N,S,Q,E),[W,V,T]=L.applyToVertex(W,V,T,E),[P,X,U]=L.applyToVertex(P,X,U,E));W-=N;V-=S;T-=Q;P-=N;X-=S;U-=Q;var Z=M*U-X*C,Y=C*P-U*J;const ja=J*X-P*M;var aa=W*Z+V*Y+T*ja;if(!(Math.abs(aa)<=Number.EPSILON)){N=K-N;S=O-S;Q=t-Q;Z=N*Z+S*Y+Q*ja;if(0<aa){if(0>Z||Z>aa)continue}else if(0<Z||Z<aa)continue;Y=S*T-V*Q;Q=Q*W-T*N;S=N*V-W*S;N=J*Y+M*Q+C*S;if(0<aa){if(0>N||Z+N>aa)continue}else if(0<N||Z+N<aa)continue;Q=(P*Y+X*Q+U*S)/aa;0<=
Q&&(W=u(W,V,T,P,X,U,z),R(Q,W,G,!1))}}}else{var {data:ia,stride:na}=K;I=t[0];K=t[1];O=t[2];t=C[0]-I;J=C[1]-K;M=C[2]-O;for(let ba=E,ea=3*E;ba<F;++ba)if(P=na*H[ea++],S=ia[P++],Q=ia[P++],T=ia[P],P=na*H[ea++],C=ia[P++],E=ia[P++],G=ia[P],P=na*H[ea++],W=ia[P++],V=ia[P++],P=ia[P],w.isSome(L)&&([S,Q,T]=L.applyToVertex(S,Q,T,ba),[C,E,G]=L.applyToVertex(C,E,G,ba),[W,V,P]=L.applyToVertex(W,V,P,ba)),C-=S,E-=Q,G-=T,W-=S,V-=Q,P-=T,U=J*P-V*M,N=M*W-P*t,aa=t*V-W*J,X=C*U+E*N+G*aa,!(Math.abs(X)<=Number.EPSILON)){S=I-
S;Q=K-Q;T=O-T;U=S*U+Q*N+T*aa;if(0<X){if(0>U||U>X)continue}else if(0<U||U<X)continue;N=Q*G-E*T;T=T*C-G*S;Q=S*E-C*Q;S=t*N+J*T+M*Q;if(0<X){if(0>S||U+S>X)continue}else if(0<S||U+S<X)continue;T=(W*N+V*T+P*Q)/X;0<=T&&(C=u(C,E,G,W,V,P,z),R(T,C,ba,!1))}}}function u(t,C,E,F,H,K,I){n.set(v,t,C,E);n.set(A,F,H,K);n.cross(I,v,A);n.normalize(I,I);return I}function p(t,C,E){return n.set(E,1/(C[0]-t[0]),1/(C[1]-t[1]),1/(C[2]-t[2]))}function h(t,C,E,F){return r(t,C,E,F,Infinity)}function r(t,C,E,F,H){var K=(t[0]-
F-C[0])*E[0],I=(t[3]+F-C[0])*E[0];let L=Math.min(K,I);K=Math.max(K,I);I=(t[1]-F-C[1])*E[1];const R=(t[4]+F-C[1])*E[1];K=Math.min(K,Math.max(I,R));if(0>K)return!1;L=Math.max(L,Math.min(I,R));if(L>K)return!1;I=(t[2]-F-C[2])*E[2];t=(t[5]+F-C[2])*E[2];K=Math.min(K,Math.max(I,t));if(0>K)return!1;L=Math.max(L,Math.min(I,t));return L>K?!1:L<H}function q(t,C){C=C?q(C):{};for(const E in t){let F=t[E];F&&F.forEach&&(F=y(F));null==F&&E in C||(C[E]=F)}return C}function y(t){const C=[];t.forEach(E=>C.push(E));
return C}const B=m.create(),D=x.create(),z=x.create(),v=x.create(),A=x.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=p;a.computeNormal=u;a.copyParameters=q;a.intersectAabbInvDir=h;a.intersectAabbInvDirBefore=r;a.intersectTriangleGeometry=function(t,C,E,F,H,K){t.visible&&(t.boundingInfo?(f.assert(t.type===l.ContentObjectType.Mesh),e(t.boundingInfo,E,F,C.tolerance,H,K)):(C=t.indices.get(d.VertexAttribute.POSITION),t=t.vertexAttributes.get(d.VertexAttribute.POSITION),
k(E,F,0,C.length/3,C,t,void 0,H,K)))};a.intersectTriangles=k;a.updateParameters=function(t,C){let E=!1;for(const F in C){const H=C[F];void 0!==H&&(Array.isArray(H)?null===t[F]?(t[F]=H.slice(),E=!0):b.update(t[F],H)&&(E=!0):t[F]!==H&&(E=!0,t[F]=H))}return E};a.verticalOffsetAtDistance=function(t,C,E,F,H){let K=(E.screenLength||0)*t.pixelRatio;w.isSome(H)&&(K=g.scale(K,F,C,H));return c.clamp(K*Math.tan(.5*t.fovY)/(.5*t.fullHeight)*C,E.minWorldLength||0,null!=E.maxWorldLength?E.maxWorldLength:Infinity)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(){this.factor=new w;this.factorAlignment=new w}),w=b._createClass(function(){this.paddingPixels=this.minPixelSize=this.factor=this.scale=0});a.ScaleFactor=w;a.ScaleInfo=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../geometry/support/buffer/BufferView ../../lib/Util ../../lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x){function m(p,h,r,q){const y=r.typedBuffer;r=r.typedBufferStride;const B=p.length;q*=r;for(let D=0;D<B;++D){const z=2*p[D];y[q]=h[z];y[q+1]=h[z+1];q+=r}}function l(p,h,r,q,y){const B=r.typedBuffer;r=r.typedBufferStride;const D=p.length;q*=r;if(null==y||1===y)for(y=0;y<D;++y){var z=3*p[y];B[q]=h[z];B[q+1]=h[z+1];B[q+2]=h[z+2];q+=r}else for(z=0;z<D;++z){const v=3*p[z];for(let A=0;A<y;++A)B[q]=h[v],B[q+1]=h[v+1],B[q+2]=h[v+2],q+=r}}function g(p,h,r,q,y=1){const B=r.typedBuffer;r=
r.typedBufferStride;const D=p.length;q*=r;if(1===y)for(y=0;y<D;++y){var z=4*p[y];B[q]=h[z];B[q+1]=h[z+1];B[q+2]=h[z+2];B[q+3]=h[z+3];q+=r}else for(z=0;z<D;++z){const v=4*p[z];for(let A=0;A<y;++A)B[q]=h[v],B[q+1]=h[v+1],B[q+2]=h[v+2],B[q+3]=h[v+3],q+=r}}function f(p,h,r,q,y,B=1){if(r){var D=q.typedBuffer;q=q.typedBufferStride;var z=p.length,v=r[0],A=r[1],t=r[2],C=r[4],E=r[5],F=r[6],H=r[8],K=r[9],I=r[10],L=r[12],R=r[13],O=r[14];y*=q;var J=0,M=0,G=0;r=c.hasIdentityRotation(r)?P=>{J=h[P]+L;M=h[P+1]+R;
G=h[P+2]+O}:P=>{const U=h[P],N=h[P+1];P=h[P+2];J=v*U+C*N+H*P+L;M=A*U+E*N+K*P+R;G=t*U+F*N+I*P+O};if(1===B)for(B=0;B<z;++B)r(3*p[B]),D[y]=J,D[y+1]=M,D[y+2]=G,y+=q;else for(let P=0;P<z;++P){r(3*p[P]);for(let U=0;U<B;++U)D[y]=J,D[y+1]=M,D[y+2]=G,y+=q}}else l(p,h,q,y,B)}function d(p,h,r,q,y,B=1){if(r){var D=q.typedBuffer;q=q.typedBufferStride;var z=p.length,v=r[0],A=r[1],t=r[2],C=r[4],E=r[5],F=r[6],H=r[8],K=r[9],I=r[10],L=!c.isOrthoNormal(r);y*=q;var R=0,O=0,J=0;r=c.hasIdentityRotation(r)?G=>{R=h[G];O=
h[G+1];J=h[G+2]}:G=>{const P=h[G],U=h[G+1];G=h[G+2];R=v*P+C*U+H*G;O=A*P+E*U+K*G;J=t*P+F*U+I*G};if(1===B)if(L)for(B=0;B<z;++B)r(3*p[B]),L=R*R+O*O+J*J,.999999>L&&1E-6<L?(L=1/Math.sqrt(L),D[y]=R*L,D[y+1]=O*L,D[y+2]=J*L):(D[y]=R,D[y+1]=O,D[y+2]=J),y+=q;else for(B=0;B<z;++B)r(3*p[B]),D[y]=R,D[y+1]=O,D[y+2]=J,y+=q;else for(let G=0;G<z;++G){r(3*p[G]);if(L){var M=R*R+O*O+J*J;.999999>M&&1E-6<M&&(M=1/Math.sqrt(M),R*=M,O*=M,J*=M)}for(M=0;M<B;++M)D[y]=R,D[y+1]=O,D[y+2]=J,y+=q}}else l(p,h,q,y,B)}function e(p,
h,r,q,y,B=1){if(r){var D=q.typedBuffer;q=q.typedBufferStride;var z=p.length,v=r[0],A=r[1],t=r[2],C=r[4],E=r[5],F=r[6],H=r[8],K=r[9],I=r[10];r=!c.isOrthoNormal(r);y*=q;if(1===B)for(B=0;B<z;++B){var L=4*p[B],R=h[L],O=h[L+1],J=h[L+2];L=h[L+3];var M=v*R+C*O+H*J,G=A*R+E*O+K*J;R=t*R+F*O+I*J;r&&(O=M*M+G*G+R*R,.999999>O&&1E-6<O&&(O=1/Math.sqrt(O),M*=O,G*=O,R*=O));D[y]=M;D[y+1]=G;D[y+2]=R;D[y+3]=L;y+=q}else for(L=0;L<z;++L){M=4*p[L];O=h[M];J=h[M+1];const P=h[M+2];M=h[M+3];G=v*O+C*J+H*P;R=A*O+E*J+K*P;O=t*O+
F*J+I*P;r&&(J=G*G+R*R+O*O,.999999>J&&1E-6<J&&(J=1/Math.sqrt(J),G*=J,R*=J,O*=J));for(J=0;J<B;++J)D[y]=G,D[y+1]=R,D[y+2]=O,D[y+3]=M,y+=q}}else g(p,h,q,y,B)}function k(p,h,r,q,y,B=1){var D=q.typedBuffer,z=q.typedBufferStride,v=p.length;y*=z;if(r===h.length&&4===r)for(D[y]=h[0],D[y+1]=h[1],D[y+2]=h[2],D[y+3]=h[3],p=new Uint32Array(q.typedBuffer.buffer,q.start),z/=4,y/=4,h=p[y],y+=z,v*=B,D=1;D<v;++D)p[y]=h,y+=z;else if(1===B)if(4===r)for(B=0;B<v;++B)r=4*p[B],D[y]=h[r],D[y+1]=h[r+1],D[y+2]=h[r+2],D[y+3]=
h[r+3],y+=z;else for(B=0;B<v;++B)r=3*p[B],D[y]=h[r],D[y+1]=h[r+1],D[y+2]=h[r+2],D[y+3]=255,y+=z;else if(4===r)for(r=0;r<v;++r){q=4*p[r];for(var A=0;A<B;++A)D[y]=h[q],D[y+1]=h[q+1],D[y+2]=h[q+2],D[y+3]=h[q+3],y+=z}else for(r=0;r<v;++r)for(q=3*p[r],A=0;A<B;++A)D[y]=h[q],D[y+1]=h[q+1],D[y+2]=h[q+2],D[y+3]=255,y+=z}function u(p,h,r,q,y=1){const B=h.typedBuffer;h=h.typedBufferStride;q*=h;if(1===y)for(y=0;y<r;++y)B[q]=p[0],B[q+1]=p[1],B[q+2]=p[2],B[q+3]=p[3],q+=h;else for(let D=0;D<r;++D)for(let z=0;z<
y;++z)B[q]=p[0],B[q+1]=p[1],B[q+2]=p[2],B[q+3]=p[3],q+=h}a.writeBufferFloat=function(p,h,r,q,y=1){const B=r.typedBuffer;r=r.typedBufferStride;const D=p.length;q*=r;if(1===y)for(y=0;y<D;++y)B[q]=h[p[y]],q+=r;else for(let z=0;z<D;++z){const v=h[p[z]];for(let A=0;A<y;A++)B[q]=v,q+=r}};a.writeBufferMat3f=function(p,h,r,q){const y=r.typedBuffer;r=r.typedBufferStride;const B=p.length;q*=r;for(let D=0;D<B;++D){const z=9*p[D];for(let v=0;9>v;++v)y[q+v]=h[z+v];q+=r}};a.writeBufferMat4f=function(p,h,r,q){const y=
r.typedBuffer;r=r.typedBufferStride;const B=p.length;q*=r;for(let D=0;D<B;++D){const z=16*p[D];for(let v=0;16>v;++v)y[q+v]=h[z+v];q+=r}};a.writeBufferVec2=m;a.writeBufferVec3=l;a.writeBufferVec4=g;a.writeBufferVec4Zeros=function(p,h,r){const q=p.typedBuffer;p=p.typedBufferStride;h*=p;for(let y=0;y<r;++y)q[h]=0,q[h+1]=0,q[h+2]=0,q[h+3]=0,h+=p};a.writeColor=k;a.writeDefaultAttributes=function(p,h,r,q,y,B){for(const v of h.fieldNames){h=p.vertexAttributes.get(v);var D=p.indices.get(v);if(h&&D)switch(v){case x.VertexAttribute.POSITION:n.assert(3===
h.size);var z=y.getField(v,w.BufferViewVec3f);n.assert(!!z,`No buffer view for ${v}`);z&&f(D,h.data,r,z,B);break;case x.VertexAttribute.NORMAL:n.assert(3===h.size);z=y.getField(v,w.BufferViewVec3f);n.assert(!!z,`No buffer view for ${v}`);z&&d(D,h.data,q,z,B);break;case x.VertexAttribute.UV0:n.assert(2===h.size);z=y.getField(v,w.BufferViewVec2f);n.assert(!!z,`No buffer view for ${v}`);z&&m(D,h.data,z,B);break;case x.VertexAttribute.COLOR:case x.VertexAttribute.SYMBOLCOLOR:n.assert(3===h.size||4===
h.size);z=y.getField(v,w.BufferViewVec4u8);n.assert(!!z,`No buffer view for ${v}`);z&&k(D,h.data,h.size,z,B);break;case x.VertexAttribute.TANGENT:n.assert(4===h.size);z=y.getField(v,w.BufferViewVec4f);n.assert(!!z,`No buffer view for ${v}`);z&&e(D,h.data,q,z,B);break;case x.VertexAttribute.PROFILERIGHT:case x.VertexAttribute.PROFILEUP:case x.VertexAttribute.PROFILEVERTEXANDNORMAL:case x.VertexAttribute.FEATUREVALUE:n.assert(4===h.size),z=y.getField(v,w.BufferViewVec4f),n.assert(!!z,`No buffer view for ${v}`),
z&&g(D,h.data,z,B)}else v===x.VertexAttribute.OBJECTANDLAYERIDCOLOR&&b.isSome(p.objectAndLayerIdColor)&&(h=p.indices.get(x.VertexAttribute.POSITION),n.assert(!!h,`No buffer view for ${v}`),h&&(h=h.length,D=y.getField(v,w.BufferViewVec4u8),u(p.objectAndLayerIdColor,D,h,B)))}};a.writeNormal=d;a.writeObjectAndLayerIdColor=u;a.writePosition=f;a.writeTangent=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/support/engineContent/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){function E(I){const L=new v.ShaderBuilder;var R=I.signedDistanceFieldEnabled;L.include(f.AlignPixel);L.include(d.HUD,I);L.include(l.SliceDraw,I);if(I.occlusionPass)return L.include(e.HUDOcclusionPass,I),L;const {vertex:O,fragment:J}=L;L.include(q.ScreenSizePerspective);J.include(r.RgbaFloatEncoding);J.include(h.ColorConversion);L.include(u.VisualVariables,I);L.include(g.ObjectAndLayerIdColor,I);L.varyings.add("vcolor","vec4");L.varyings.add("vtc",
"vec2");L.varyings.add("vsize","vec2");I.binaryHighlightOcclusionEnabled&&L.varyings.add("voccluded","float");O.uniforms.add([new B.Float4PassUniform("viewport",(P,U)=>U.camera.fullViewport),new y.Float2PassUniform("screenOffset",(P,U)=>c.set(H,2*P.screenOffset[0]*U.camera.pixelRatio,2*P.screenOffset[1]*U.camera.pixelRatio)),new y.Float2PassUniform("anchorPosition",P=>F(P)),new B.Float4PassUniform("materialColor",P=>P.color),new D.FloatPassUniform("pixelRatio",(P,U)=>U.camera.pixelRatio)]);R&&(O.uniforms.add(new B.Float4PassUniform("outlineColor",
P=>P.outlineColor)),J.uniforms.add([new B.Float4PassUniform("outlineColor",P=>0<P.outlineColor[3]&&0<P.outlineSize?P.outlineColor:n.ZEROS),new D.FloatPassUniform("outlineSize",P=>0<P.outlineColor[3]&&0<P.outlineSize?P.outlineSize:0)]));I.hasScreenSizePerspective&&(q.addScreenSizePerspective(O),q.addScreenSizePerspectiveAlignment(O));(I.debugDrawLabelBorder||I.binaryHighlightOcclusionEnabled)&&L.varyings.add("debugBorderCoords","vec4");L.attributes.add(C.VertexAttribute.UV0,"vec2");L.attributes.add(C.VertexAttribute.COLOR,
"vec4");L.attributes.add(C.VertexAttribute.SIZE,"vec2");L.attributes.add(C.VertexAttribute.AUXPOS2,"vec4");O.code.add(z.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${I.hasScreenSizePerspective?z.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:z.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${I.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${I.occlusionTestEnabled||I.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${I.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var M=z.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const G=I.pixelSnappingEnabled?R?z.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:z.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:z.glsl`posProj += quadOffset;`;O.uniforms.add(new y.Float2PassUniform("textureCoordinateScaleFactor",P=>b.isSome(P.texture)&&b.isSome(P.texture.descriptor.textureCoordinateScaleFactor)?P.texture.descriptor.textureCoordinateScaleFactor:w.ONES));O.code.add(z.glsl`
    ${I.occlusionTestEnabled?"if (visible) {":""}
    ${M}
    ${I.vvColor?"vcolor \x3d interpolateVVColor(auxpos2.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${I.output===m.ShaderOutput.ObjectAndLayerIdColor?z.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${z.glsl.float(p.symbolAlphaCutoff)};
    ${R?`alphaDiscard = alphaDiscard && outlineColor.a < ${z.glsl.float(p.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${G}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${I.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${I.occlusionTestEnabled?z.glsl`} else { vtc = vec2(0.0);
      ${I.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);J.uniforms.add(new A.Texture2DPassUniform("tex",P=>P.texture));M=I.debugDrawLabelBorder?z.glsl`(isBorder > 0.0 ? 0.0 : ${z.glsl.float(p.defaultMaskAlphaCutoff)})`:z.glsl.float(p.defaultMaskAlphaCutoff);R=z.glsl`
    ${I.debugDrawLabelBorder?z.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${R?z.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${z.glsl.float(x.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${M} ||
          fillPixelColor.a + outlinePixelColor.a < ${z.glsl.float(p.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${M}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:z.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${M}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${I.debugDrawLabelBorder?z.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;I.output===m.ShaderOutput.Alpha&&J.code.add(z.glsl`
      void main() {
        ${R}
        fragColor = vec4(fragColor.a);
      }
      `);I.output===m.ShaderOutput.ObjectAndLayerIdColor&&J.code.add(z.glsl`
      void main() {
        ${R}
        outputObjectAndLayerIdColor();
      }
      `);I.output===m.ShaderOutput.Color&&J.code.add(z.glsl`
    void main() {
      ${R}
      ${I.transparencyPassType===t.TransparencyPassType.FrontFace?"fragColor.rgb /\x3d fragColor.a;":""}
    }
    `);I.output===m.ShaderOutput.Highlight&&(L.include(k.OutputHighlight,I),J.code.add(z.glsl`
    void main() {
      ${R}
      ${I.binaryHighlightOcclusionEnabled?z.glsl`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return L}function F(I,L=H){if(I.textureIsSignedDistanceField){var R=I.anchorPosition;I=I.distanceFieldBoundingBox;b.isSome(I)?c.set(L,R[0]*(I[2]-I[0])+I[0],R[1]*(I[3]-I[1])+I[1]):c.set(L,0,0)}else c.copy(L,I.anchorPosition);return L}const H=w.create(),K=Object.freeze(Object.defineProperty({__proto__:null,build:E,calculateAnchorPosForRendering:F},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=K;a.build=E;a.calculateAnchorPosForRendering=F})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,c,w,n){function x(y,B=128,D=.5*B,z=0){switch(y){case "circle":return m(B,D);case "square":return l(B,D);case "cross":return f(B,D,z);case "x":return d(B,D,z);case "kite":return g(B,D);case "triangle":return e(B,D);case "arrow":return k(B,D);default:return m(B,D)}}function m(y,B){const D=y/2-.5;return q(y,h(D,D,B/2))}function l(y,B){return u(y,B,!1)}function g(y,B){return u(y,B,
!0)}function f(y,B,D=0){return p(y,B,!1,D)}function d(y,B,D=0){return p(y,B,!0,D)}function e(y,B){return q(y,r(y/2,B,B/2))}function k(y,B){const D=B/2,z=y/2,v=.8*B,A=h(z,(y-B)/2-v,Math.sqrt(v*v+D*D)),t=r(z,B,D);return q(y,(C,E)=>Math.max(t(C,E),-A(C,E)))}function u(y,B,D){D&&(B/=Math.SQRT2);return q(y,(z,v)=>{z=z-.5*y+.25;v=-v+.5*y-.75;if(D){const A=(z+v)/Math.SQRT2;v=(v-z)/Math.SQRT2;z=A}return Math.max(Math.abs(z),Math.abs(v))-.5*B})}function p(y,B,D,z=0){B-=z;D&&(B*=Math.SQRT2);const v=.5*B;return q(y,
(A,t)=>{A-=.5*y;t=-t+.5*y-1;if(D){const C=(A+t)/Math.SQRT2;t=(t-A)/Math.SQRT2;A=C}A=Math.abs(A);t=Math.abs(t);A=A>t?A>v?Math.sqrt((A-v)*(A-v)+t*t):t:t>v?Math.sqrt(A*A+(t-v)*(t-v)):A;return A-=z/2})}function h(y,B,D){return(z,v)=>{z-=y;v-=B;return Math.sqrt(z*z+v*v)-D}}function r(y,B,D){const z=Math.sqrt(B*B+D*D);return(v,A)=>{A=A-y+B/2+.75;return Math.max((B*(Math.abs(v-y)-D)+D*A)/z,-A)}}function q(y,B){const D=new Uint8Array(4*y*y);for(let z=0;z<y;z++)for(let v=0;v<y;v++){const A=v+y*z;let t=B(v,
z);t=t/y+.5;c.packFloatRGBA(t,D,4*A)}return D}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=k;a.createCircle=m;a.createCross=f;a.createKite=g;a.createSquare=l;a.createTexture=function(y,B=128,D=.5*B,z=0){y=x(y,B,D,z);return new w.Texture(y,{mipmap:!1,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},width:B,height:B,components:4,noUnpackFlip:!0})};a.createTriangle=e;a.createX=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports",
"./mathUtils"],function(a,b){function c(m,l=0){let g=0;for(let f=0;4>f;f++)g+=m[l+f]*n[f];return g}const w=[1,256,65536,16777216],n=[1/256,1/65536,1/16777216,1/4294967296],x=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(m,l,g=0){m=b.clamp(m,0,x);for(let e=0;4>e;e++){var f=Math,d=m*w[e];l[g+e]=f.floor.call(f,256*(d-Math.floor(d)))}};a.unpackFloatRGBA=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ../../../../chunks/TextureOnly.glsl ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/context-util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){h=function(E){function F(K,I){var L=H.call(this);L._data=K;L.type=r.ContentObjectType.Texture;L._glTexture=null;L._powerOfTwoStretchInfo=null;L._loadingPromise=null;L._loadingController=null;L.events=new n;L._passParameters=new k.TextureOnlyPassParameters;L.params=I||{};L.params.mipmap=!1!==L.params.mipmap;L.params.noUnpackFlip=L.params.noUnpackFlip||!1;L.params.preMultiplyAlpha=L.params.preMultiplyAlpha||!1;L.params.wrap=L.params.wrap||
{s:z.TextureWrapMode.REPEAT,t:z.TextureWrapMode.REPEAT};L.params.powerOfTwoResizeMode=L.params.powerOfTwoResizeMode||u.PowerOfTwoResizeMode.STRETCH;L.estimatedTexMemRequired=F._estimateTexMemRequired(L._data,L.params);L._startPreload();return L}b._inherits(F,E);var H=b._createSuper(F);E=F.prototype;E._startPreload=function(){const K=this._data;m.isNone(K)||(K instanceof HTMLVideoElement?this._startPreloadVideoElement(K):K instanceof HTMLImageElement&&this._startPreloadImageElement(K))};E._startPreloadVideoElement=
function(K){if(!(f.isBlobProtocol(K.src)||"auto"===K.preload&&K.crossOrigin)){K.preload="auto";K.crossOrigin="anonymous";const I=!K.paused;K.src=K.src;if(I&&K.autoplay){const L=()=>{K.removeEventListener("canplay",L);K.play()};K.addEventListener("canplay",L)}}};E._startPreloadImageElement=function(K){f.isDataProtocol(K.src)||f.isBlobProtocol(K.src)||K.crossOrigin||(K.crossOrigin="anonymous",K.src=K.src)};F._getDataDimensions=function(K){return K instanceof HTMLVideoElement?{width:K.videoWidth,height:K.videoHeight}:
K};F._estimateTexMemRequired=function(K,I){if(m.isNone(K))return 0;if(g.isArrayBuffer(K)||g.isUint8Array(K))return I.encoding===u.TextureEncodingMimeType.KTX2_ENCODING?p.estimateMemoryKTX2(K,!!I.mipmap):I.encoding===u.TextureEncodingMimeType.BASIS_ENCODING?p.estimateMemoryBasis(K,!!I.mipmap):K.byteLength;const {width:L,height:R}=K instanceof Image||K instanceof ImageData||K instanceof HTMLCanvasElement||K instanceof HTMLVideoElement?F._getDataDimensions(K):I;return(I.mipmap?4/3:1)*L*R*(I.components||
4)||0};E.dispose=function(){this._data=void 0};E._createDescriptor=function(K){return{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:z.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?K.parameters.maxMaxAnisotropy:
1)}};E.load=function(K,I){if(m.isSome(this._glTexture))return this._glTexture;if(m.isSome(this._loadingPromise))return this._loadingPromise;const L=this._data;return m.isNone(L)?this._glTexture=new A.Texture(K,this._createDescriptor(K),null):"string"===typeof L?this._loadFromURL(K,I,L):L instanceof Image?this._loadFromImageElement(K,I,L):L instanceof HTMLVideoElement?this._loadFromVideoElement(K,I,L):L instanceof ImageData||L instanceof HTMLCanvasElement?this._loadFromImage(K,L,I):(g.isArrayBuffer(L)||
g.isUint8Array(L))&&this.params.encoding===u.TextureEncodingMimeType.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(K,L)):(g.isArrayBuffer(L)||g.isUint8Array(L))&&this.params.encoding===u.TextureEncodingMimeType.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(K,L)):(g.isArrayBuffer(L)||g.isUint8Array(L))&&this.params.encoding===u.TextureEncodingMimeType.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(K,L)):g.isUint8Array(L)?this._loadFromPixelData(K,L):g.isArrayBuffer(L)?this._loadFromPixelData(K,
new Uint8Array(L)):null};E.frameUpdate=function(K,I,L){if(!(this._data instanceof HTMLVideoElement)||m.isNone(this._glTexture)||this._data.readyState<C.HAVE_CURRENT_DATA||L===this._data.currentTime)return L;if(m.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:R,vao:O,sourceTexture:J}=this._powerOfTwoStretchInfo;J.setData(this._data);this._drawStretchedTexture(K,I,R,O,J,this._glTexture)}else{const {videoWidth:R,videoHeight:O}=this._data,{width:J,height:M}=this._glTexture.descriptor;R!==J||
O!==M?this._glTexture.updateData(0,0,0,Math.min(R,J),Math.min(O,M),this._data):this._glTexture.setData(this._data)}this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this.params.updateCallback&&this.params.updateCallback();return this._data.currentTime};E._loadFromDDSData=function(K,I){return this._glTexture=q.createDDSTexture(K,this._createDescriptor(K),I)};E._loadFromKTX2=function(K,I){return this._loadAsync(()=>p.createTextureKTX2(K,this._createDescriptor(K),I).then(L=>this._glTexture=
L))};E._loadFromBasis=function(K,I){return this._loadAsync(()=>p.createTextureBasis(K,this._createDescriptor(K),I).then(L=>this._glTexture=L))};E._loadFromPixelData=function(K,I){B.assert(0<this.params.width&&0<this.params.height);const L=this._createDescriptor(K);L.pixelFormat=1===this.params.components?z.PixelFormat.LUMINANCE:3===this.params.components?z.PixelFormat.RGB:z.PixelFormat.RGBA;L.width=this.params.width;L.height=this.params.height;return this._glTexture=new A.Texture(K,L,I)};E._loadFromURL=
function(K,I,L){return this._loadAsync(async R=>{const O=await d.requestImage(L,{signal:R});l.throwIfAborted(R);return this._loadFromImage(K,O,I)})};E._loadFromImageElement=function(K,I,L){return L.complete?this._loadFromImage(K,L,I):this._loadAsync(async R=>{const O=await e.loadImageAsync(L,L.src,!1,R);l.throwIfAborted(R);return this._loadFromImage(K,O,I)})};E._loadFromVideoElement=function(K,I,L){return L.readyState>=C.HAVE_CURRENT_DATA?this._loadFromImage(K,L,I):this._loadFromVideoElementAsync(K,
I,L)};E._loadFromVideoElementAsync=function(K,I,L){return this._loadAsync(R=>new Promise((O,J)=>{const M=()=>{L.removeEventListener("loadeddata",G);L.removeEventListener("error",P);m.removeMaybe(U)},G=()=>{L.readyState>=C.HAVE_CURRENT_DATA&&(M(),O(this._loadFromImage(K,L,I)))},P=N=>{M();J(N||new w("Failed to load video"))};L.addEventListener("loadeddata",G);L.addEventListener("error",P);const U=l.onAbort(R,()=>P(l.createAbortError()))}))};E._loadFromImage=function(K,I,L){const R=F._getDataDimensions(I);
this.params.width=R.width;this.params.height=R.height;const O=this._createDescriptor(K);O.pixelFormat=3===this.params.components?z.PixelFormat.RGB:z.PixelFormat.RGBA;if(this._requiresPowerOfTwo(K,O)&&(!x.isPowerOfTwo(R.width)||!x.isPowerOfTwo(R.height)))return this._glTexture=this._makePowerOfTwoTexture(K,I,R,O,L);O.width=R.width;O.height=R.height;return this._glTexture=new A.Texture(K,O,I)};E._loadAsync=function(K){const I=new AbortController;this._loadingController=I;const L=K(I.signal);this._loadingPromise=
L;K=()=>{this._loadingController===I&&(this._loadingController=null);this._loadingPromise===L&&(this._loadingPromise=null)};L.then(K,K);return L};E._requiresPowerOfTwo=function(K,I){var L=z.TextureWrapMode.CLAMP_TO_EDGE;L="number"===typeof I.wrapMode?I.wrapMode===L:I.wrapMode.s===L&&I.wrapMode.t===L;return K.type===D.ContextType.WEBGL1&&(I.hasMipmap||!L)};E._makePowerOfTwoTexture=function(K,I,L,R,O){const {width:J,height:M}=L;L=x.nextHighestPowerOfTwo(J);const G=x.nextHighestPowerOfTwo(M);R.width=
L;R.height=G;let P;switch(this.params.powerOfTwoResizeMode){case u.PowerOfTwoResizeMode.PAD:R.textureCoordinateScaleFactor=[J/L,M/G];P=new A.Texture(K,R);P.updateData(0,0,0,J,M,I);break;case u.PowerOfTwoResizeMode.STRETCH:case null:case void 0:P=this._stretchToPowerOfTwo(K,I,R,O());break;default:c.neverReached(this.params.powerOfTwoResizeMode)}R.hasMipmap&&P.generateMipmap();return P};E._stretchToPowerOfTwo=function(K,I,L,R){const O=new A.Texture(K,L),J=new v.FramebufferObject(K,{colorTarget:z.TargetType.TEXTURE,
depthStencilTarget:z.DepthStencilTargetType.NONE},O);I=new A.Texture(K,{target:z.TextureType.TEXTURE_2D,pixelFormat:L.pixelFormat,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:z.TextureSamplingMode.LINEAR,flipped:!!L.flipped,maxAnisotropy:8,preMultiplyAlpha:L.preMultiplyAlpha},I);L=y.createQuadVAO(K);const M=K.getBoundFramebufferObject();this._drawStretchedTexture(K,R,J,L,I,O);this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:L,sourceTexture:I,framebuffer:J}:
(L.dispose(!0),I.dispose(),J.detachColorTexture(),J.dispose());K.bindFramebuffer(M);return O};E._drawStretchedTexture=function(K,I,L,R,O,J){this._passParameters.texture=O;K.bindFramebuffer(L);L=K.getViewport();K.setViewport(0,0,J.descriptor.width,J.descriptor.height);K.bindTechnique(I,this._passParameters,null);K.bindVAO(R);K.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,t.vertexCount(R,"geometry"));K.bindFramebuffer(null);K.setViewport(L.x,L.y,L.width,L.height);this._passParameters.texture=null};E.unload=
function(){if(m.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:K,vao:I,sourceTexture:L}=this._powerOfTwoStretchInfo;I.dispose(!0);L.dispose();K.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}m.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);if(m.isSome(this._loadingController)){const K=this._loadingController;this._loadingPromise=this._loadingController=null;K.abort()}this.events.emit("unloaded")};b._createClass(F,[{key:"width",get:function(){return this.params.width}},
{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",get:function(){return this._data instanceof HTMLVideoElement}}]);return F}(h.ContentObject);var C;(function(E){E[E.HAVE_NOTHING=0]="HAVE_NOTHING";E[E.HAVE_METADATA=1]="HAVE_METADATA";E[E.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";E[E.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";E[E.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(C||(C={}));a.Texture=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(a,b){a.requestImage=async function(c,w){({data:c}=await b(c,{responseType:"image",...w}));return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l){function g(){const e=new m.ShaderBuilder;e.include(w.ScreenSpacePass);e.fragment.uniforms.add([new l.Texture2DPassUniform("tex",k=>k.texture),new n.Float4PassUniform("uColor",k=>k.color)]);e.fragment.code.add(x.glsl`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`);return e}let f=function(e){function k(){var p=u.apply(this,arguments);p.color=c.fromValues(1,1,1,1);return p}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(x.NoParameters);const d=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:f,build:g},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=d;a.TextureOnlyPassParameters=f;a.build=g})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m){async function l(){b.isNone(u)&&(u=c.getBasisTranscoder(),k=await u);return u}function g(p,h,r,q,y){h=m.getBytesPerElementFormat(h?n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(r*q*h*(y&&1<p?(4**p-1)/(3*4**(p-1)):1))}function f(p){return 1<=p.getNumImages()&&!p.isUASTC()}function d(p){return 1<=p.getFaces()&&p.isETC1S()}function e(p,h,r,q,y,B,D,z){const {compressedTextureETC:v,compressedTextureS3TC:A}=p.capabilities,
[t,C]=v?q?[w.TextureFormat.ETC2_RGBA,n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[w.TextureFormat.ETC1_RGB,n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:A?q?[w.TextureFormat.BC3_RGBA,n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[w.TextureFormat.BC1_RGB,n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[w.TextureFormat.RGBA32,n.PixelFormat.RGBA];q=h.hasMipmap?r:Math.min(1,r);r=[];for(let E=0;E<q;E++)r.push(new Uint8Array(D(E,t))),z(E,t,r[E]);D=1<r.length;return new x.Texture(p,
{...h,samplingMode:D?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR,hasMipmap:D,internalFormat:C,width:y,height:B},{type:"compressed",levels:r})}let k=null,u=null;a.createTextureBasis=async function(p,h,r){b.isNone(k)&&(k=await l());const q=new k.BasisFile(new Uint8Array(r));if(!f(q))return null;q.startTranscoding();p=e(p,h,q.getNumLevels(0),q.getHasAlpha(),q.getImageWidth(0,0),q.getImageHeight(0,0),(y,B)=>q.getImageTranscodedSizeInBytes(0,y,B),(y,B,D)=>q.transcodeImage(D,
0,y,B,0,0));q.close();q.delete();return p};a.createTextureKTX2=async function(p,h,r){b.isNone(k)&&(k=await l());const q=new k.KTX2File(new Uint8Array(r));if(!d(q))return null;q.startTranscoding();p=e(p,h,q.getLevels(),q.getHasAlpha(),q.getWidth(),q.getHeight(),(y,B)=>q.getImageTranscodedSizeInBytes(y,0,0,B),(y,B,D)=>q.transcodeImage(D,y,0,0,B,0,-1,-1));q.close();q.delete();return p};a.estimateMemoryBasis=function(p,h){if(b.isNone(k))return p.byteLength;p=new k.BasisFile(new Uint8Array(p));h=f(p)?
g(p.getNumLevels(0),p.getHasAlpha(),p.getImageWidth(0,0),p.getImageHeight(0,0),h):0;p.close();p.delete();return h};a.estimateMemoryKTX2=function(p,h){if(b.isNone(k))return p.byteLength;p=new k.KTX2File(new Uint8Array(p));h=d(p)?g(p.getLevels(),p.getHasAlpha(),p.getWidth(),p.getHeight(),h):0;p.close();p.delete();return h};a.loadBasis=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],
function(a,b,c,w){let n;b.getBasisTranscoder=function(){if(w.isNone(n)){const x=m=>c.getAssetUrl(`esri/libs/basisu/${m}`);n=(new Promise((m,l)=>a(["../../chunks/basis_transcoder"],m,l))).then(m=>m.basis_transcoder).then(({default:m})=>m({locateFile:x}).then(l=>{l.initializeBasis();delete l.then;return l}))}return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||
(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";
b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,b,c,w,n,x){function m(k){return k.charCodeAt(0)+(k.charCodeAt(1)<<
8)+(k.charCodeAt(2)<<16)+(k.charCodeAt(3)<<24)}function l(k,u){var p=new Int32Array(k,0,31);if(542327876!==p[0])return g.error("Invalid magic number in DDS header"),null;if(!(p[20]&4))return g.error("Unsupported format, must contain a FourCC code"),null;var h=p[21];let r;switch(h){case f:h=8;r=n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case d:h=16;r=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:h=16;r=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;
break;default:return g.error("Unsupported FourCC code:",String.fromCharCode(h&255,h>>8&255,h>>16&255,h>>24&255)),null}let q=1,y=p[4],B=p[3];if(0!==(y&3)||0!==(B&3))g.warn("Rounding up compressed texture size to nearest multiple of 4."),y=y+3&-4,B=B+3&-4;const D=y,z=B;p[2]&131072&&!1!==u&&(q=Math.max(1,p[7]));1===q||c.isPowerOfTwo(y)&&c.isPowerOfTwo(B)||(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),q=1);let v=p[1]+4;const A=[];for(let t=0;t<q;++t)p=(y+3>>2)*(B+3>>2)*h,u=
new Uint8Array(k,v,p),A.push(u),v+=p,y=Math.max(1,y>>1),B=Math.max(1,B>>1);return{textureData:{type:"compressed",levels:A},internalFormat:r,width:D,height:z}}const g=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),f=m("DXT1"),d=m("DXT3"),e=m("DXT5");a.createDDSTexture=function(k,u,p){const {textureData:h,internalFormat:r,width:q,height:y}=w.unwrapOrThrow(l(p,u.hasMipmap??!1));u.samplingMode=1<h.levels.length?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR;u.hasMipmap=
1<h.levels.length;u.internalFormat=r;u.width=q;u.height=y;return new x.Texture(k,u,h)};a.createDDSTextureData=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(z,v,A){if(v.hasSlicePlane){v.hasSliceInVertexProgram&&z.vertex.uniforms.add(A);z.fragment.uniforms.add(A);A=f.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var t=f.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;t=v.hasSliceHighlight?f.glsl`
        ${t}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:f.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;v.hasSliceInVertexProgram&&z.vertex.code.add(A);z.fragment.code.add(A);z.fragment.code.add(t)}else A=f.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,v.hasSliceInVertexProgram&&z.vertex.code.add(A),z.fragment.code.add(A)}function e(z,v,A){return z.instancedDoublePrecision?x.set(q,A.camera.viewInverseTransposeMatrix[3],A.camera.viewInverseTransposeMatrix[7],A.camera.viewInverseTransposeMatrix[11]):v.slicePlaneLocalOrigin}function k(z,v){return c.isSome(z)?x.subtract(y,v.origin,z):v.origin}function u(z,v,A){return z.hasSliceTranslatedView?c.isSome(v)?w.translate(D,A.camera.viewMatrix,v):A.camera.viewMatrix:
null}function p(z,v,A){if(c.isNone(A.slicePlane))return m.ZEROS;const t=e(z,v,A);v=k(t,A.slicePlane);z=u(z,t,A);return c.isSome(z)?x.transformMat4(y,v,z):v}function h(z,v,A,t){if(c.isNone(t)||c.isNone(A.slicePlane))return m.ZEROS;const C=e(z,v,A);v=k(C,A.slicePlane);z=u(z,C,A);return c.isSome(z)?(x.add(B,t,v),x.transformMat4(y,v,z),x.transformMat4(B,B,z),x.subtract(B,B,y)):t}let r=function(z){function v(t){var C=A.call(this);C.slicePlaneLocalOrigin=t;return C}b._inherits(v,z);var A=b._createSuper(v);
return b._createClass(v)}(f.NoParameters);const q=m.create(),y=m.create(),B=m.create(),D=n.create();a.SliceDraw=function(z,v){d(z,v,[new l.Float3DrawUniform("slicePlaneOrigin",(A,t)=>p(v,A,t)),new l.Float3DrawUniform("slicePlaneBasis1",(A,t)=>h(v,A,t,c.unwrap(t.slicePlane)?.basis1)),new l.Float3DrawUniform("slicePlaneBasis2",(A,t)=>h(v,A,t,c.unwrap(t.slicePlane)?.basis2))])};a.SlicePass=function(z,v){d(z,v,[new g.Float3PassUniform("slicePlaneOrigin",(A,t)=>p(v,A,t)),new g.Float3PassUniform("slicePlaneBasis1",
(A,t)=>h(v,A,t,c.unwrap(t.slicePlane)?.basis1)),new g.Float3PassUniform("slicePlaneBasis2",(A,t)=>h(v,A,t,c.unwrap(t.slicePlane)?.basis2))])};a.SlicePlaneParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,w){a.ObjectAndLayerIdColor=function(n,x){const m=x.output===
b.ShaderOutput.ObjectAndLayerIdColor;x=x.objectAndLayerIdColorInstanced;m&&(n.varyings.add("objectAndLayerIdColorVarying","vec4"),x?n.attributes.add(w.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):n.attributes.add(w.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));n.vertex.code.add(c.glsl`
     void forwardObjectAndLayerIdColor() {
      ${m?x?c.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:c.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:c.glsl``} }`);n.fragment.code.add(c.glsl`
      void outputObjectAndLayerIdColor() {
        ${m?c.glsl`fragColor = objectAndLayerIdColorVarying;`:c.glsl``} }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../shading/MultipassGeometryTest.glsl ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,w,n,x,m){a.HUDOcclusionPass=
function(l,g){const {vertex:f,fragment:d}=l;g.hasMultipassGeometry&&f.include(c.multipassGeometryTest);g.hasMultipassTerrain&&l.varyings.add("depth","float");f.code.add(x.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${g.hasMultipassGeometry?x.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${g.hasMultipassTerrain?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);g.hasMultipassTerrain&&d.include(b.ReadLinearDepth);g.hasMultipassTerrain&&d.uniforms.add([new m.Texture2DPassUniform("terrainDepthTexture",(e,k)=>k.multipassTerrain.linearDepthTexture),new n.Float2PassUniform("nearFar",(e,k)=>k.camera.nearFar)]);d.include(w.RgbaFloatEncoding);d.code.add(x.glsl`
  void main() {
    fragColor = vec4(1);
    ${g.hasMultipassTerrain?x.glsl`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,w){const n=b.fromValues(1,1,0,1),x=b.fromValues(1,0,1,1);a.OutputHighlight=function(m){m.fragment.uniforms.add(new w.Texture2DPassUniform("depthTex",(l,g)=>g.highlightDepthTexture));m.fragment.constants.add("occludedHighlightFlag",
"vec4",n).add("unoccludedHighlightFlag","vec4",x);m.fragment.code.add(c.glsl`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTex, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)};a.occludedHighlightFlag=n;a.unoccludedHighlightFlag=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,w,n,x,m,l){a.VisualVariables=function(g,f){const {vertex:d,attributes:e}=g;f.hasVvInstancing&&(f.vvSize||f.vvColor)&&e.add(m.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");f.vvSize?(d.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",k=>k.vvSize.minSize)),d.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",k=>k.vvSize.maxSize)),d.uniforms.add(new b.Float3PassUniform("vvSizeOffset",k=>k.vvSize.offset)),d.uniforms.add(new b.Float3PassUniform("vvSizeFactor",k=>k.vvSize.factor)),
d.uniforms.add(new x.Matrix3PassUniform("vvSymbolRotationMatrix",k=>k.vvSymbolRotationMatrix)),d.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",k=>k.vvSymbolAnchor)),d.code.add(n.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),d.code.add(n.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${f.hasVvInstancing?n.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):d.code.add(n.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);f.vvColor?(d.constants.add("vvColorNumber","int",l.vvColorNumber),d.uniforms.add([new w.FloatsPassUniform("vvColorValues",k=>k.vvColor.values,l.vvColorNumber),new c.Float4sPassUniform("vvColorColors",k=>k.vvColor.colors,l.vvColorNumber)]),d.code.add(n.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${f.hasVvInstancing?n.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):d.code.add(n.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g,f){return m.call(this,l,"vec4",w.BindType.Pass,(d,e,k)=>d.setUniform4fv(l,g(e,k)),f)}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);
a.Float4sPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g,f){return m.call(this,l,"float",w.BindType.Pass,(d,e,k)=>d.setUniform1fv(l,g(e,k)),f)}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.FloatsPassUniform=
c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../layers/support/FastSymbolUpdates","../lib/Material"],function(a,b,c,w){c=function(n){function x(){var l=m.apply(this,arguments);l.renderOccluded=w.RenderOccludedFlag.Occlude;return l}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.VisualVariablesParameters);a.VisualVariablePassParameters=
c;a.vvColorNumber=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(S){return null!==S&&void 0!==S}function p(S){return"number"===typeof S}function h(S){return"string"===typeof S}function r(S,Q){S&&S.push(Q)}function q(S,Q,W,V=l.create()){S=S||0;Q=Q||0;W=W||0;0!==S&&m.rotateZ(V,V,-S/180*Math.PI);0!==Q&&m.rotateX(V,V,Q/180*Math.PI);0!==W&&m.rotateY(V,V,W/180*Math.PI);return V}function y(S,Q,W,V,T){const X=S.minSize,Z=S.maxSize;if(S.expression)return r(T,"Could not convert size info: expression not supported"),!1;if(S.useSymbolValue)return S=
V.symbolSize[W],Q.minSize[W]=S,Q.maxSize[W]=S,Q.offset[W]=Q.minSize[W],Q.factor[W]=0,Q.type[W]=a.FastSizeType.DefinedSize,!0;if(u(S.field)){if(u(S.stops)){if(2===S.stops.length&&p(S.stops[0].size)&&p(S.stops[1].size))return B(S.stops[0].size,S.stops[1].size,S.stops[0].value,S.stops[1].value,Q,W),Q.type[W]=a.FastSizeType.DefinedSize,!0;r(T,"Could not convert size info: stops only supported with 2 elements");return!1}if(p(X)&&p(Z)&&u(S.minDataValue)&&u(S.maxDataValue))return B(X,Z,S.minDataValue,S.maxDataValue,
Q,W),Q.type[W]=a.FastSizeType.DefinedSize,!0;if(null!=d.meterIn[S.valueUnit])return Q.minSize[W]=-Infinity,Q.maxSize[W]=Infinity,Q.offset[W]=0,Q.factor[W]=1/d.meterIn[S.valueUnit],Q.type[W]=a.FastSizeType.DefinedSize,!0;if("unknown"===S.valueUnit)return r(T,"Could not convert size info: proportional size not supported"),!1;r(T,"Could not convert size info: scale-dependent size not supported");return!1}if(!u(S.field)){if(S.stops&&S.stops[0]&&p(S.stops[0].size))return Q.minSize[W]=S.stops[0].size,Q.maxSize[W]=
S.stops[0].size,Q.offset[W]=Q.minSize[W],Q.factor[W]=0,Q.type[W]=a.FastSizeType.DefinedSize,!0;if(p(X))return Q.minSize[W]=X,Q.maxSize[W]=X,Q.offset[W]=X,Q.factor[W]=0,Q.type[W]=a.FastSizeType.DefinedSize,!0}r(T,"Could not convert size info: unsupported variant of sizeInfo");return!1}function B(S,Q,W,V,T,X){V=0<Math.abs(V-W)?(Q-S)/(V-W):0;T.minSize[X]=0<V?S:Q;T.maxSize[X]=0<V?Q:S;T.offset[X]=S-W*V;T.factor[X]=V}function D(S,Q,W,V){if(S.normalizationField||S.valueRepresentation)return r(V,"Could not convert size info: unsupported property"),
null;var T=S.field;if(null!=T&&!h(T))return r(V,"Could not convert size info: field is not a string"),null;if(!Q.size)Q.size=new I(S.field);else if(S.field)if(!Q.size.field)Q.size.field=S.field;else if(S.field!==Q.size.field)return r(V,"Could not convert size info: multiple fields in use"),null;switch(S.axis){case "width":return(T=y(S,Q.size,0,W,V))?Q:null;case "height":return(T=y(S,Q.size,2,W,V))?Q:null;case "depth":return(T=y(S,Q.size,1,W,V))?Q:null;case "width-and-depth":return(T=y(S,Q.size,0,
W,V))&&y(S,Q.size,1,W,V),T?Q:null;case null:case void 0:case "all":return(T=(T=(T=y(S,Q.size,0,W,V))&&y(S,Q.size,1,W,V))&&y(S,Q.size,2,W,V))?Q:null;default:return r(V,`Could not convert size info: unknown axis "${S.axis}""`),null}}function z(S,Q,W){for(let V=0;3>V;++V){let T=Q.unitInMeters;S.type[V]===a.FastSizeType.DefinedSize&&(T*=Q.modelSize[V],S.type[V]=a.FastSizeType.DefinedScale);S.minSize[V]/=T;S.maxSize[V]/=T;S.offset[V]/=T;S.factor[V]/=T}if(S.type[0]!==a.FastSizeType.Undefined)Q=0;else if(S.type[1]!==
a.FastSizeType.Undefined)Q=1;else if(S.type[2]!==a.FastSizeType.Undefined)Q=2;else return r(W,"No size axis contains a valid size or scale"),!1;for(W=0;3>W;++W)S.type[W]===a.FastSizeType.Undefined&&(S.minSize[W]=S.minSize[Q],S.maxSize[W]=S.maxSize[Q],S.offset[W]=S.offset[Q],S.factor[W]=S.factor[Q],S.type[W]=S.type[Q]);return!0}function v(S,Q,W){S[4*Q]=W.r/255;S[4*Q+1]=W.g/255;S[4*Q+2]=W.b/255;S[4*Q+3]=W.a}function A(S,Q,W){if(S.normalizationField)return r(W,"Could not convert color info: unsupported property"),
null;if(h(S.field))if(S.stops){if(8<S.stops.length)return r(W,"Could not convert color info: too many color stops"),null;Q.color=new L(S.field);S=S.stops;for(W=0;8>W;++W){const V=S[Math.min(W,S.length-1)];Q.color.values[W]=V.value;v(Q.color.colors,W,V.color)}}else return r(W,"Could not convert color info: missing stops or colors"),null;else if(S.stops&&0<=S.stops.length)for(S=S.stops&&0<=S.stops.length&&S.stops[0].color,Q.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},W=0;8>W;W++)Q.color.values[W]=Infinity,v(Q.color.colors,W,S);else return r(W,"Could not convert color info: no field and no colors/stops"),null;return Q}function t(S,Q,W){if(S.normalizationField)return r(W,"Could not convert opacity info: unsupported property"),null;if(h(S.field))if(S.stops){if(8<S.stops.length)return r(W,"Could not convert opacity info: too many opacity stops"),null;Q.opacity=new R(S.field);S=S.stops;for(W=0;8>W;++W){const V=S[Math.min(W,
S.length-1)];Q.opacity.values[W]=V.value;Q.opacity.opacityValues[W]=V.opacity}}else return r(W,"Could not convert opacity info: missing stops or opacities"),null;else if(S.stops&&0<=S.stops.length)for(S=S.stops&&0<=S.stops.length?S.stops[0].opacity:0,Q.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},W=0;8>W;W++)Q.opacity.values[W]=Infinity,Q.opacity.opacityValues[W]=S;else return r(W,"Could not convert opacity info: no field and no opacities/stops"),null;return Q}function C(S,
Q,W){S=2===W&&"arithmetic"===S.rotationType;Q.offset[W]=S?90:0;Q.factor[W]=S?-1:1;Q.type[W]=1}function E(S,Q,W){if(!h(S.field))return r(W,"Could not convert rotation info: field is not a string"),null;if(!Q.rotation)Q.rotation={field:S.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(S.field)if(!Q.rotation.field)Q.rotation.field=S.field;else if(S.field!==Q.rotation.field)return r(W,"Could not convert rotation info: multiple fields in use"),null;switch(S.axis){case "tilt":return C(S,Q.rotation,
0),Q;case "roll":return C(S,Q.rotation,1),Q;case null:case void 0:case "heading":return C(S,Q.rotation,2),Q;default:return r(W,`Could not convert rotation info: unknown axis "${S.axis}""`),null}}function F(S,Q,W){if(!S)return null;const V=S.reduce((T,X)=>{if(!T)return T;if(X.valueExpression)return r(W,"Could not convert visual variables: arcade expressions not supported"),null;switch(X.type){case "size":return Q.supportsSize?D(X,T,Q,W):T;case "color":return Q.supportsColor?A(X,T,W):T;case "opacity":return Q.supportsOpacity?
t(X,T,W):null;case "rotation":return Q.supportsRotation?E(X,T,W):T;default:return null}},new O);return 0<S.length&&V&&!V.size&&!V.color&&!V.opacity&&!V.rotation||V&&V.size&&!z(V.size,Q,W)?null:V}function H(S,Q,W){if(!!S!==!!Q||S&&S.field!==Q?.field)return!1;if(S&&"rotation"===W)for(W=0;3>W;W++)if(S.type[W]!==Q.type[W]||S.offset[W]!==Q.offset[W]||S.factor[W]!==Q.factor[W])return!1;return!0}function K(S,Q){S=new G(S);S.vvSize&&(S.vvSymbolAnchor=Q.anchor,m.identity(N),q(Q.rotation[2],Q.rotation[0],Q.rotation[1],
N),S.vvSymbolRotationMatrix=S.vvSymbolRotationMatrix||x.create(),n.fromMat4(S.vvSymbolRotationMatrix,N));return S}a.FastSizeType=void 0;(function(S){S[S.Undefined=0]="Undefined";S[S.DefinedSize=1]="DefinedSize";S[S.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(S){S[S.Undefined=0]="Undefined";S[S.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));c=b._createClass(function(S){this.field=S});let I=function(S){function Q(V){V=
W.call(this,V);V.minSize=[0,0,0];V.maxSize=[0,0,0];V.offset=[0,0,0];V.factor=[0,0,0];V.type=[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined];return V}b._inherits(Q,S);var W=b._createSuper(Q);return b._createClass(Q)}(c),L=function(S){function Q(V){V=W.call(this,V);V.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];V.values=[0,0,0,0,0,0,0,0];return V}b._inherits(Q,S);var W=b._createSuper(Q);return b._createClass(Q)}(c),R=function(S){function Q(V){V=
W.call(this,V);V.values=[0,0,0,0,0,0,0,0];V.opacityValues=[0,0,0,0,0,0,0,0];return V}b._inherits(Q,S);var W=b._createSuper(Q);return b._createClass(Q)}(c);c=function(S){function Q(V){V=W.call(this,V);V.offset=[0,0,0];V.factor=[1,1,1];V.type=[0,0,0];return V}b._inherits(Q,S);var W=b._createSuper(Q);return b._createClass(Q)}(c);let O=b._createClass(function(){this.rotation=this.opacity=this.color=this.size=null}),J=b._createClass(function(S=[1,1,1],Q=[1,1,1],W=1,V=[0,0,0],T=[1,1,1],X=[0,0,0]){this.modelSize=
S;this.symbolSize=Q;this.unitInMeters=W;this.anchor=V;this.scale=T;this.rotation=X;this.supportsRotation=this.supportsColor=this.supportsSize=!0;this.supportsOpacity=!1}),M=b._createClass(function(S,Q,W){this.visualVariables=S;this.materialParameters=Q;this.requiresShaderTransformation=W}),G=function(S){function Q(V=null){var T=W.call(this);T.vvSymbolAnchor=null;T.vvSymbolRotationMatrix=null;T.vvSize=V?.size??null;T.vvColor=V?.color??null;T.vvOpacity=V?.opacity??null;return T}b._inherits(Q,S);var W=
b._createSuper(Q);return b._createClass(Q)}(k.NoParameters);const P=l.create(),U=f.create(),N=l.create();a.ConvertOptions=J;a.FastColorInfo=L;a.FastOpacityInfo=R;a.FastRotationInfo=c;a.FastSizeInfo=I;a.FastSymbolUpdatesState=M;a.FastVisualVariables=O;a.VisualVariablesParameters=G;a.convertVisualVariables=F;a.evaluateModelTransform=function(S,Q,W){if(!S.vvSize)return W;m.copy(P,W);W=S.vvSymbolRotationMatrix;m.set(N,W[0],W[1],W[2],0,W[3],W[4],W[5],0,W[6],W[7],W[8],0,0,0,0,1);m.multiply(P,P,N);for(W=
0;3>W;++W)U[W]=w.clamp(S.vvSize.offset[W]+Q[0]*S.vvSize.factor[W],S.vvSize.minSize[W],S.vvSize.maxSize[W]);m.scale(P,P,U);m.translate(P,P,S.vvSymbolAnchor);return P};a.evaluateModelTransformScale=function(S,Q,W){if(Q.vvSize)for(let V=0;3>V;++V)S[V]=w.clamp(Q.vvSize.offset[V]+W[0]*Q.vvSize.factor[V],Q.vvSize.minSize[V],Q.vvSize.maxSize[V]);else g.set(S,1,1,1)};a.getMaterialParameters=K;a.initFastSymbolUpdatesState=function(S,Q){return!S||e.TESTS_DISABLE_FAST_UPDATES?null:(S=F(S.visualVariables,Q))?
new M(S,K(S,Q),!!S.size):null};a.updateFastSymbolUpdatesState=function(S,Q,W){if(!Q||!S)return!1;const V=S.visualVariables;Q=F(Q.visualVariables,W);if(!(Q&&H(V.size,Q.size,"size")&&H(V.color,Q.color,"color")&&H(V.rotation,Q.rotation,"rotation")&&H(V.opacity,Q.opacity,"opacity")))return!1;S.visualVariables=Q;S.materialParameters=K(Q,W);S.requiresShaderTransformation=!!Q.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],
function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){m=function(r){function q(){return y.apply(this,arguments)}c._inherits(q,r);var y=c._createSuper(q);r=q.prototype;r.initializeConfiguration=function(B,D){D.spherical=B.viewingMode===w.ViewingMode.Global};r.initializeProgram=function(B){return new f.Program(B.rctx,q.shader.get().build(this.configuration),l.Default3D)};r._setPipelineState=function(B){const D=this.configuration,z=B===d.TransparencyPassType.NONE;var v=B===d.TransparencyPassType.FrontFace;const A=this.configuration.hasPolygonOffset?
p:null;v=(z||v)&&D.output!==n.ShaderOutput.Highlight?D.depthEnabled||D.occlusionPass?u.defaultDepthWriteParams:null:null;return u.makePipelineState({blending:D.output===n.ShaderOutput.Color||D.output===n.ShaderOutput.Alpha||D.output===n.ShaderOutput.Highlight?z?h:g.oitBlending(B):null,depthTest:{func:k.CompareFunction.LEQUAL},depthWrite:v,colorWrite:u.defaultColorWriteParams,polygonOffset:A})};r.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};
c._createClass(q,[{key:"primitiveType",get:function(){return this.configuration.occlusionPass?k.PrimitiveType.POINTS:k.PrimitiveType.TRIANGLES}}]);return q}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(e.HUDMaterial,()=>new Promise((r,q)=>a(["./HUDMaterial.glsl"],r,q)));const p={factor:0,units:-4},h=u.simpleBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports",
"./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,w){const n=w.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),x=w.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),m=w.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),l={factor:-1,units:-2};a.OITPolygonOffset=l;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=m;a.blendingColor=x;a.blendingDefault=
n;a.getOITPolygonOffset=function(g){return g?l:null};a.oitBlending=function(g){return g===b.TransparencyPassType.FrontFace?null:g===b.TransparencyPassType.Alpha?m:x};a.oitDepthTest=function(g,f=c.CompareFunction.LESS){return g===b.TransparencyPassType.NONE||g===b.TransparencyPassType.FrontFace?f:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(g){return g===b.TransparencyPassType.FrontFace?w.defaultDepthWriteParams:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l){l=function(g){function f(){var e=d.apply(this,arguments);e.output=w.ShaderOutput.Color;e.screenCenterOffsetUnitsEnabled=n.HUDSpace.World;e.transparencyPassType=m.TransparencyPassType.NONE;e.spherical=!1;e.occlusionTestEnabled=!0;e.signedDistanceFieldEnabled=!1;e.vvSize=!1;e.vvColor=!1;e.hasVerticalOffset=!1;e.hasScreenSizePerspective=!1;e.debugDrawLabelBorder=!1;e.binaryHighlightOcclusionEnabled=!0;e.hasSlicePlane=!1;e.hasPolygonOffset=!1;e.depthEnabled=!0;e.pixelSnappingEnabled=
!0;e.isDraped=!1;e.hasMultipassGeometry=!1;e.hasMultipassTerrain=!1;e.cullAboveGround=!1;e.occlusionPass=!1;e.objectAndLayerIdColorInstanced=!1;return e}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(l.DefaultTechniqueConfiguration);c.__decorate([x.parameter({count:w.ShaderOutput.COUNT})],l.prototype,"output",void 0);c.__decorate([x.parameter({count:n.HUDSpace.COUNT})],l.prototype,"screenCenterOffsetUnitsEnabled",void 0);c.__decorate([x.parameter({count:m.TransparencyPassType.COUNT})],
l.prototype,"transparencyPassType",void 0);c.__decorate([x.parameter()],l.prototype,"spherical",void 0);c.__decorate([x.parameter()],l.prototype,"occlusionTestEnabled",void 0);c.__decorate([x.parameter()],l.prototype,"signedDistanceFieldEnabled",void 0);c.__decorate([x.parameter()],l.prototype,"vvSize",void 0);c.__decorate([x.parameter()],l.prototype,"vvColor",void 0);c.__decorate([x.parameter()],l.prototype,"hasVerticalOffset",void 0);c.__decorate([x.parameter()],l.prototype,"hasScreenSizePerspective",
void 0);c.__decorate([x.parameter()],l.prototype,"debugDrawLabelBorder",void 0);c.__decorate([x.parameter()],l.prototype,"binaryHighlightOcclusionEnabled",void 0);c.__decorate([x.parameter()],l.prototype,"hasSlicePlane",void 0);c.__decorate([x.parameter()],l.prototype,"hasPolygonOffset",void 0);c.__decorate([x.parameter()],l.prototype,"depthEnabled",void 0);c.__decorate([x.parameter()],l.prototype,"pixelSnappingEnabled",void 0);c.__decorate([x.parameter()],l.prototype,"isDraped",void 0);c.__decorate([x.parameter()],
l.prototype,"hasMultipassGeometry",void 0);c.__decorate([x.parameter()],l.prototype,"hasMultipassTerrain",void 0);c.__decorate([x.parameter()],l.prototype,"cullAboveGround",void 0);c.__decorate([x.parameter()],l.prototype,"occlusionPass",void 0);c.__decorate([x.parameter()],l.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([x.parameter({constValue:!0})],l.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([x.parameter({constValue:!1})],l.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){a.LabelDeconflictor=function(k){function u(h){h=p.call(this,h);h.visibilityGroup=f.VisibilityGroup.LABEL;h.iconMarginFactor=0;h._lastDeconfliction=0;return h}b._inherits(u,k);var p=b._createSuper(u);k=u.prototype;k.runTask=function(h){if(this.parent.running)return e.Task.YIELD;const r=performance.now();if(h.state!==d.RenderState.IDLE&&2E3>r-this._lastDeconfliction)return e.Task.YIELD;b._get(b._getPrototypeOf(u.prototype),"runTask",this).call(this,h);this.state===
g.State.Idle&&(this._lastDeconfliction=r)};k.enabledChanged=function(h,r){this.modifyGraphics(r,h.labelsEnabled)};k.getGraphicsLayers=function(h){return h.labelLayers};b._createClass(u,[{key:"viewState",get:function(){return this.parent.viewState}}]);return u}(g.Deconflictor);c.__decorate([w.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([l.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./CreateLabelParameters ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L){function R(P){return!0===P.labelsVisible&&!!P.labelingInfo?.some(U=>!!U.symbol)}let O=b._createClass(function(P,U){this.labelingContext=P;this.graphics3DGraphic=U;this.textInitialized=this.rendered=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]}),J=b._createClass(function(P,U,N,S,Q){this.labelClass=P;this.graphics3DSymbol=U;this.graphics3DCalloutSymbolLayer=N;this.textRenderParameters=
S;this.labelFunction=Q;this.calloutSymbolLayerIndex=0}),M=b._createClass(function(P,U,N,S,Q,W,V){this.layer=P;this.graphics3DCore=U;this.scaleVisibility=N;this.emptySymbolLabelSupported=S;this.elevationInfoOverride=Q;this.disablePlacement=W;this.active=V;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new I.WebGLLayer({pickable:!0,disableOctree:!0},P.uid)});a.Labeler=function(P){function U(S){S=N.call(this,
S);S._dirty=!1;S._labels=new Map;S._labelsToAdd=new Map;S._labelsToRemove=new Map;S._labelingContexts=[];return S}b._inherits(U,P);var N=b._createSuper(U);P=U.prototype;P.setup=function(){this.dispose();this._handles=new x;this._handles.add([d.watch(()=>this.view.state?.camera,()=>this.setDirty()),d.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(L.TaskPriority.LABELER,this)]);this._textTextureAtlas=new K.TextTextureAtlas({view:this.view});
this._hudMaterialCollection=new E.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new E.MaterialCollection(this.view._stage)};P.dispose=function(){this._handles=g.destroyMaybe(this._handles);this._textTextureAtlas=g.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=g.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=g.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();
this._labelsToRemove.clear()};P._activateLabelingContext=function(S){S.graphics.forEach((Q,W)=>{const V=new O(S,Q);this._labels.set(W,V);S.labelsToInitialize.set(W,V);Q.setVisibilityFlag(D.VisibilityFlag.USER_SETTING,!0,D.VisibilityGroup.LABEL)});S.active=!0};P._deactivateLabelingContext=function(S){S.graphics.forEach((Q,W)=>{Q.setVisibilityFlag(D.VisibilityFlag.USER_SETTING,!1,D.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(Q,!1);this._labels.delete(W)});S.active=!1};P._addLabelTextureToAtlas=
function(S){for(const Q of S.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const W=S.textRenderers[Q._labelIndex];g.isSome(W)&&this._textTextureAtlas.addTextTexture(W,Q.stageObject)}S.rendered=!0};P._removeLabelTextureFromAtlas=function(S){for(const Q of S.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const W=S.textRenderers[Q._labelIndex];g.isSome(W)&&this._textTextureAtlas.removeTextTexture(W,Q.stageObject)}S.rendered=!1};P.runTask=function(S){this._updateLabels(S);!this._dirty&&
this.deconflictor.running&&this.deconflictor.runTask(S);return L.Task.YIELD};P._updateLabels=function(S){if(this._dirty){this._dirty=!1;for(const Q of this._labelingContexts)if(Q.active){if(!Q.labelClassContexts||!Q.labelClassContexts.length){if(null===Q.labelClassContexts){this._deactivateLabelingContext(Q);continue}this._createLabelClassContext(Q);if(Q.labelClassPromise&&Q.labelClassAbortController){this._dirty=!0;continue}if(!Q.labelClassContexts||!Q.labelClassContexts.length)continue}l.someMap(Q.labelsToInitialize,
(W,V)=>{this._ensureGraphics3DResources(W)&&(this._labels.set(V,W),this.deconflictor.setDirty(),S.madeProgress());if(W.visible&&W.textInitialized||!W.visible&&W.hasGraphics3DResources)Q.labelsToInitialize.delete(V),S.madeProgress();return S.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(Q=>this._removeLabelTextureFromAtlas(Q));this._labelsToAdd.forEach(Q=>this._addLabelTextureToAtlas(Q));this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};P._createLabelClassContextAsync=
async function(S){const Q=S.labelClassAbortController?.signal;await S.layer.when?.();f.throwIfAborted(Q);S.scaleVisibility&&S.scaleVisibility.updateScaleRangeActive();const W=S.graphics3DCore;var V=W.layer;(V=V.labelingInfo&&V.labelingInfo.filter(T=>!!T.symbol))&&0!==V.length&&(await n.forEach(V,async(T,X)=>{var Z=T.symbol;const Y=A.getGraphics3DSymbol(W.getOrCreateGraphics3DSymbol(Z));if(g.isNone(Y))m.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");else{await Y.load();
f.throwIfAborted(Q);var aa=null;y.hasCalloutSupport(Z)&&Z.hasVisibleCallout()&&(aa=z.make(Z,W.symbolCreationContext),await aa.load(),f.throwIfAborted(Q));Z=await n.result(q.createLabelFunction(T,S.layer.fieldsIndex,this.view.spatialReference));f.throwIfAborted(Q);if(!0===Z.ok){const ia=await this._createTextRenderParameters(Y.symbol);f.throwIfAborted(Q);S.labelClassContexts[X]=new J(T,Y,aa,ia,Z.value)}else m.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${Z.error}`)}}),
f.throwIfAborted(Q))};P._createLabelClassContext=async function(S){g.isNone(S.labelClassPromise)&&(S.labelClassPromise=this._createLabelClassContextAsync(S).catch(Q=>{if(f.isAbortError(Q))throw Q;S.labelClassContexts.length=0}).then(()=>{S.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return S.labelClassPromise};P._createTextRenderParameters=async function(S){return(S=S.symbolLayers.getItemAt(0))&&"text"===S.type?H.TextRenderParameters.fromSymbol(S,
this.view.state.rasterPixelRatio):null};P._destroyLabelClassContext=function(S){for(var Q of S.labelClassContexts)--Q.graphics3DSymbol.referenced;Q=S.labelClassAbortController;S.labelClassAbortController=new AbortController;g.abortMaybe(Q);S.labelClassContexts.length=0;S.labelClassPromise=null;this.notifyChange("updating")};P._createTextSymbolGraphic=function(S,Q,W,V,T){S=new B.CreateLabelParameters(W.verticalOffset,C.horizontalPlacementFromAnchor(W.anchor),C.verticalPlacementFromAnchor(W.anchor),
S.text,W.translation,W.elevationOffset,W.centerOffset,W.screenOffset,W.centerOffsetUnits,S.displayWidth,S.displayHeight);G.graphic=Q;G.renderingInfo=null;G.layer=V;return T.createLabel(G,S,this._hudMaterialCollection,this._textTextureAtlas)};P._createLineCalloutGraphic=function(S,Q,W,V,T){G.graphic=S;G.layer=T;G.renderingInfo=new v.LineCalloutSymbolLayerRenderingInfo(null,Q,V.translation,V.centerOffset,V.screenOffset,V.centerOffsetUnits,V.elevationOffset,this._calloutMaterialCollection);return W.createGraphics3DGraphic(G)};
P._ensureGraphics3DResources=function(S){if(S.hasGraphics3DResources)return!1;const Q=S.graphics3DGraphic;if(Q.destroyed)return!1;this._ensureTextTextureResources(S);const W=S.labelingContext,V=W.labelClassContexts;if(!V||0===V.length||!W.emptySymbolLabelSupported&&0===Q.layers.length)return!1;var T=!1,X=Q.graphic;const Z=W.layer;var Y=R(W.layer);const aa=this.view._stage;for(let na=0;na<V.length;na++){const ba=S.textRenderers[na],ea=S.textLabelPlacements[na];if(g.isNone(ba)||g.isNone(ea))continue;
const ja=V[na];var ia=ja.graphics3DSymbol;const ka=ia.symbol&&"label-3d"===ia.symbol.type?ia.symbol:null;if(ia=ia.symbolLayers[0]){ia.setElevationInfoOverride(W.elevationInfoOverride);T=this._createTextSymbolGraphic(ba,X,ea,Z,ia);if(g.isNone(T))return!1;T._labelClass=ja.labelClass;T._labelIndex=na;Q.addLabelGraphic(T,aa,W.stageLayer);Q.setVisibilityFlag(D.VisibilityFlag.USER_SETTING,Y,D.VisibilityGroup.LABEL);Q.clearVisibilityFlag(D.VisibilityFlag.SCALE_RANGE,D.VisibilityGroup.LABEL);Q.setVisibilityFlag(D.VisibilityFlag.DECONFLICTION,
!1,D.VisibilityGroup.LABEL);T=!0;(Y=ja.graphics3DCalloutSymbolLayer)&&ea.hasLabelVerticalOffset&&(Y.setElevationInfoOverride(W.elevationInfoOverride),X=this._createLineCalloutGraphic(X,ka,Y,ea,Z),g.isSome(X)&&(ja.calloutSymbolLayerIndex=Q.labelLayers.length,Q.addLabelGraphic(X,aa,W.stageLayer)));break}}W.scaleVisibility&&T&&W.scaleVisibility.updateGraphicLabelScaleVisibility(Q);return S.hasGraphics3DResources=!0};P._destroyGraphics3DResources=function(S){const Q=S.labelingContext.labelClassContexts;
for(const W of S.graphics3DGraphic.labelLayers){if(null==W._labelClass)continue;const V=Q[W._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=V)V.onRemoveGraphic(W)}S.graphics3DGraphic.clearLabelGraphics();S.hasGraphics3DResources=!1};P._ensureTextTextureResources=function(S){if(!S.textInitialized){var Q=S.labelingContext,W=Q.labelClassContexts;if(W&&0!==W.length){var V=S.graphics3DGraphic.graphic;for(let Z=0;Z<W.length;Z++){const Y=W[Z];S.textRenderers[Z]=null;S.textLabelPlacements[Z]=null;
if(!Y.textRenderParameters)continue;var T=Y.labelFunction;let aa;if("arcade"===T.type)try{const ia=T.needsHydrationToEvaluate()?r.hydrateGraphic(V,Q.layer):V;aa=T.evaluate(ia)}catch(ia){aa=null}else aa=T.evaluate(V);if(!g.isNone(aa)&&""!==aa&&!/^\s+$/.test(aa)&&(T=Y.graphics3DSymbol,T.symbolLayers[0]&&(T=t.get({graphics3DGraphic:S.graphics3DGraphic,labelSymbol:"label-3d"===T.symbol?.type?T.symbol:null,labelClass:Y.labelClass,disablePlacement:Q.disablePlacement}),!g.isNone(T)))){var X=C.horizontalPlacementFromAnchor(T.anchor);
X=C.textRenderAlignmentFromHorizontalPlacement(X);S.textRenderers[Z]=new F.TextRenderer(aa,X,Y.textRenderParameters);S.textLabelPlacements[Z]=T}}S.textInitialized=!0}}};P._destroyTextTextureResources=function(S){S.textInitialized=!1;S.textRenderers.length=0;S.textLabelPlacements.length=0};P._addGraphic=function(S,Q){const W=Q.graphic.uid;S.graphics.set(W,Q);S.active&&(Q=new O(S,Q),this._labels.set(W,Q),S.labelsToInitialize.set(W,Q));this.setDirty();this.deconflictor.setDirty()};P._removeGraphic=function(S,
Q){Q=Q.graphic.uid;const W=this._labels.get(Q);S.graphics.delete(Q);W&&(this._destroyGraphic(W,Q),S.labelsToInitialize.delete(Q),this.setDirty(),this.deconflictor.setDirty())};P._destroyGraphic=function(S,Q){this._labels.has(Q)&&(this._labels.delete(Q),this._labelsToAdd.delete(Q),this._labelsToRemove.delete(Q));S.textInitialized&&(this._removeLabelTextureFromAtlas(S),this._destroyTextTextureResources(S));S.hasGraphics3DResources&&this._destroyGraphics3DResources(S)};P._labelingInfoChange=async function(S,
Q){if(Q)for(const W of Q){if(Q=S.graphics.get(W))this._removeGraphic(S,Q),this._addGraphic(S,Q)}else return this._visibilityInfoChange(S),this._resetLabels(S),this._createLabelClassContext(S)};P._globalPropertyChanged=function(S,Q){for(const W of Q.labelClassContexts){const V=new Map;Q.graphics.forEach(T=>V.set(T.graphic.uid,T));g.unwrap(W.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(S,V,T=>T.labelLayers[0]);W.graphics3DCalloutSymbolLayer&&W.graphics3DCalloutSymbolLayer.globalPropertyChanged(S,
V,T=>T.labelLayers[W.calloutSymbolLayerIndex])}};P._visibilityInfoChange=function(S){const Q=R(S.layer);Q&&!S.active&&this._activateLabelingContext(S);!Q&&S.active&&this._deactivateLabelingContext(S);this.setDirty()};P._resetAllLabels=function(){for(const S of this._labelingContexts)this._resetLabels(S)};P._resetLabels=function(S){S.graphics.forEach((Q,W)=>{if(Q=this._labels.get(W))this._destroyGraphic(Q,W),Q.visible=!1,Q.rendered=!1,S.labelsToInitialize.set(W,Q)});this._destroyLabelClassContext(S);
this.setDirty();this.deconflictor.setDirty()};P._findLabelingContext=function(S){for(const Q of this._labelingContexts)if(Q.graphics3DCore===S)return Q;return null};P.addGraphicsOwner=function(S,Q,W){const V=W&&W.emptySymbolLabelSupported||!1,T=W&&W.elevationInfoOverride||null;W=W&&W.disablePlacement||null;if(!this._findLabelingContext(S)){var X=S.layer,Z=new M(X,S,Q,V,T,W,R(X));this.view._stage.add(Z.stageLayer);this._labelingContexts.push(Z);this.setDirty();return{addGraphic:Y=>this._addGraphic(Z,
Y),removeGraphic:Y=>this._removeGraphic(Z,Y),featureReductionChange:()=>{},layerLabelsEnabled:()=>R(Z.layer),labelingInfoChange:Y=>this._labelingInfoChange(Z,Y),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Z),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Z),visibilityInfoChange:()=>this._visibilityInfoChange(Z),reset:()=>this._resetLabels(Z),clear:()=>{}}}};P.removeGraphicsOwner=function(S){const Q=this._findLabelingContext(S);Q&&(S=this._labelingContexts.indexOf(Q),
this._labelingContexts.splice(S,1),Q.graphics.forEach(W=>this._removeGraphic(Q,W)),this.view._stage.remove(Q.stageLayer),this.setDirty())};P.setLabelGraphicVisibility=function(S,Q){S=S.graphic.uid;const W=this._labels.get(S);W&&W.visible!==Q&&(Q&&!W.rendered?(this._labelsToAdd.set(S,W),this._labelsToRemove.delete(S),W.textInitialized||W.labelingContext.labelsToInitialize.set(S,W)):!Q&&W.rendered&&(this._labelsToRemove.set(S,W),this._labelsToAdd.delete(S)),W.visible=Q,this.setDirty())};P.setDirty=
function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};b._createClass(U,[{key:"running",get:function(){return this.view.ready&&(this._dirty||this.deconflictor.running)}},{key:"updating",get:function(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(S=>!!S.labelClassPromise&&!!S.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;
const S=0<this._labelingContexts.length?this._labelingContexts.reduce((Q,W)=>Q+(W.labelClassPromise&&W.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*S+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}}]);return U}(w);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],
a.Labeler.prototype,"deconflictor",void 0);c.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([h.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const G=new v.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=R;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures ../../geometry/SpatialReference".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(B){return"declaredClass"in B}function e(B){return"declaredClass"in B}function k(B){return"declaredClass"in B}function u(B){return x.isNone(B)?null:d(B)?B:l.fromJSON(p(B))}function p(B){const {wkid:D,wkt:z,latestWkid:v}=B.spatialReference,A={wkid:D,wkt:z,latestWkid:v};switch(B.type){case "point":const {x:t,y:C,z:E,m:F}=B;return{x:t,y:C,z:E,m:F,spatialReference:A};case "polygon":const {rings:H,hasZ:K,hasM:I}=B;return{rings:h(H),hasZ:K,hasM:I,spatialReference:A};
case "polyline":const {paths:L,hasZ:R,hasM:O}=B;return{paths:h(L),hasZ:R,hasM:O,spatialReference:A};case "extent":const {xmin:J,xmax:M,ymin:G,ymax:P,zmin:U,zmax:N,mmin:S,mmax:Q,hasZ:W,hasM:V}=B;return{xmin:J,xmax:M,ymin:G,ymax:P,zmin:U,zmax:N,mmin:S,mmax:Q,hasZ:W,hasM:V,spatialReference:A};case "multipoint":const {points:T,hasZ:X,hasM:Z}=B;return{points:y(T)?r(T):T,hasZ:X,hasM:Z,spatialReference:A}}}function h(B){return q(B)?B.map(D=>r(D)):B}function r(B){return B.map(D=>Array.from(D))}function q(B){for(const D of B)if(0!==
D.length)return y(D);return!1}function y(B){return 0<B.length&&(m.isFloat32Array(B[0])||m.isFloat64Array(B[0]))}a.clonePoint=function(B,D){if(!B)return null;if(e(B)){if(null==D)return B.clone();if(e(D))return D.copy(B)}null!=D?(D.x=B.x,D.y=B.y,D.spatialReference=B.spatialReference,B.hasZ?(D.z=B.z,D.hasZ=B.hasZ):(D.z=void 0,D.hasZ=!1),B.hasM?(D.m=B.m,D.hasM=!0):(D.m=void 0,D.hasM=!1)):(D=g.makeDehydratedPoint(B.x,B.y,B.z,B.spatialReference),B.hasM&&(D.m=B.m,D.hasM=!0));return D};a.hydrateGeometry=
u;a.hydrateGraphic=function(B,D){return B?k(B)?B:new c({layer:D,sourceLayer:D,visible:B.visible,symbol:n.clone(B.symbol),attributes:n.clone(B.attributes),geometry:u(B.geometry)}):null};a.hydratedSpatialReference=function(B){const {wkid:D,wkt:z,latestWkid:v}=B;return f.fromJSON({wkid:D,wkt:z,latestWkid:v})};a.isHydratedGeometry=d;a.isHydratedGraphic=k;a.isHydratedPoint=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(r,q,y){if(n.isNone(r))return null;switch(q){case "point":return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:null!=r.z,hasM:null!=r.m,type:"point",spatialReference:y};case "polyline":return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:y};case "polygon":return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:y};case "multipoint":return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:y}}}
function h(r){if(n.isNone(r))return 0;let q=32;switch(r.type){case "point":q+=42;break;case "polyline":case "polygon":var y=0;const B=2+(r.hasZ?1:0)+(r.hasM?1:0);r="polyline"===r.type?r.paths:r.rings;for(const D of r)y+=D.length;q+=8*y*B+64;q+=128*y;q=q+34+32*(r.length+1);break;case "multipoint":y=r.points.length;q+=8*y*(2+(r.hasZ?1:0)+(r.hasM?1:0))+64;q+=128*y;q=q+34+32;break;case "extent":q+=98;r.hasM&&(q+=32);r.hasZ&&(q+=32);break;case "mesh":q+=x.estimateSize(r.vertexAttributes.position),q+=x.estimateSize(r.vertexAttributes.normal),
q+=x.estimateSize(r.vertexAttributes.uv),q+=x.estimateSize(r.vertexAttributes.tangent)}return q}w=b._createClass(function(r,q,y){this.uid=r;this.geometry=q;this.attributes=y;this.visible=!0;this.centroid=this.objectId=null});b=b._createClass(function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null});a.equals=
u.equals;a.DehydratedFeatureClass=w;a.DehydratedFeatureSetClass=b;a.computeAABB=function(r,q){g.empty(q);"mesh"===r.type&&(r=r.extent);switch(r.type){case "point":q[0]=q[3]=r.x;q[1]=q[4]=r.y;r.hasZ&&(q[2]=q[5]=r.z);break;case "polyline":for(var y=0;y<r.paths.length;y++)g.expandWithNestedArray(q,r.paths[y],!!r.hasZ);break;case "polygon":for(y=0;y<r.rings.length;y++)g.expandWithNestedArray(q,r.rings[y],!!r.hasZ);break;case "multipoint":g.expandWithNestedArray(q,r.points,!!r.hasZ);break;case "extent":q[0]=
r.xmin,q[1]=r.ymin,q[3]=r.xmax,q[4]=r.ymax,null!=r.zmin&&(q[2]=r.zmin),null!=r.zmax&&(q[5]=r.zmax)}};a.computeAABR=function(r,q){f.empty(q);"mesh"===r.type&&(r=r.extent);switch(r.type){case "point":q[0]=q[2]=r.x;q[1]=q[3]=r.y;break;case "polyline":for(var y=0;y<r.paths.length;y++)f.expandWithNestedArray(q,r.paths[y]);break;case "polygon":for(y=0;y<r.rings.length;y++)f.expandWithNestedArray(q,r.rings[y]);break;case "multipoint":f.expandWithNestedArray(q,r.points);break;case "extent":q[0]=r.xmin,q[1]=
r.ymin,q[2]=r.xmax,q[3]=r.ymax}};a.estimateGeometryObjectSize=h;a.estimateSize=function(r){let q;q=32+c.estimateAttributesObjectSize(r.attributes);return q=q+3+(8+h(r.geometry))};a.fromFeatureSetJSON=function(r){const q=e.featureGeometryTypeKebabDictionary.fromJSON(r.geometryType),y=l.fromJSON(r.spatialReference),B=r.transform,D=r.features.map(z=>{var v=r.objectIdFieldName;z={uid:m.generateUID(),objectId:v&&z.attributes?z.attributes[v]:null,attributes:z.attributes,geometry:p(z.geometry,q,y),visible:!0};
v=z.geometry;if(n.isSome(v)&&B)switch(v.type){case "point":z.geometry=d.unquantizePoint(B,v,v,v.hasZ,v.hasM);break;case "multipoint":z.geometry=d.unquantizeMultipoint(B,v,v,!!v.hasZ,!!v.hasM);break;case "polygon":z.geometry=d.unquantizePolygon(B,v,v,!!v.hasZ,!!v.hasM);break;case "polyline":z.geometry=d.unquantizePolyline(B,v,v,!!v.hasZ,!!v.hasM);break;case "extent":z.geometry=v;break;case "mesh":z.geometry=v}return z});return{geometryType:q,features:D,spatialReference:y,fields:r.fields?.map(z=>k.fromJSON(z))??
[],objectIdFieldName:r.objectIdFieldName,globalIdFieldName:r.globalIdFieldName,geohashFieldName:r.geohashFieldName,geometryProperties:r.geometryProperties,hasZ:r.hasZ,hasM:r.hasM,exceededTransferLimit:r.exceededTransferLimit,transform:null}};a.fromJSONGeometry=p;a.getObjectId=function(r,q){return null!=r.objectId?r.objectId:r.attributes&&q?r.attributes[q]:null};a.hasGeometry=function(r){return n.isSome(r.geometry)};a.hasVertices=function(r){if(n.isNone(r))return!1;switch(r.type){case "extent":case "point":return!0;
case "polyline":for(const q of r.paths)if(0<q.length)return!0;return!1;case "polygon":for(const q of r.rings)if(0<q.length)return!0;return!1;case "multipoint":return 0<r.points.length;case "mesh":return!r.loaded||0<r.vertexAttributes.position.length}};a.makeDehydratedPoint=function(r,q,y,B){return{x:r,y:q,z:y,hasZ:null!=y,hasM:!1,spatialReference:B,type:"point"}};a.numVertices=function(r){if(n.isNone(r))return 0;switch(r.type){case "point":return 1;case "polyline":var q=0;for(var y of r.paths)q+=
y.length;return q;case "polygon":y=0;for(q of r.rings)y+=q.length;return y;case "multipoint":return r.points.length;case "extent":return 2;case "mesh":return(r=r.vertexAttributes&&r.vertexAttributes.position)?r.length/3:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","../../core/maybe","./jsonUtils"],function(a,b,c){function w({scale:E,translate:F},H){return Math.round((H-F[0])/E[0])}function n({scale:E,translate:F},
H){return Math.round((F[1]-H)/E[1])}function x(E,F,H){const K=[];let I,L,R,O;for(let J=0;J<H.length;J++){const M=H[J];if(0<J){if(R=w(E,M[0]),O=n(E,M[1]),R!==I||O!==L)K.push(F(M,R-I,O-L)),I=R,L=O}else I=w(E,M[0]),L=n(E,M[1]),K.push(F(M,I,L))}return 0<K.length?K:null}function m(E,F,H,K){return x(E,H?K?C:t:K?t:A,F)}function l(E,F,H,K){const I=[];H=H?K?C:t:K?t:A;for(K=0;K<F.length;K++){const L=x(E,H,F[K]);L&&3<=L.length&&I.push(L)}return I.length?I:null}function g(E,F,H,K){const I=[];H=H?K?C:t:K?t:A;
for(K=0;K<F.length;K++){const L=x(E,H,F[K]);L&&2<=L.length&&I.push(L)}return I.length?I:null}function f({scale:E,translate:F},H){return H*E[0]+F[0]}function d({scale:E,translate:F},H){return F[1]-H*E[1]}function e(E,F,H){const K=Array(H.length);if(!H.length)return K;const [I,L]=E.scale;let R=f(E,H[0][0]);E=d(E,H[0][1]);K[0]=F(H[0],R,E);for(let O=1;O<H.length;O++){const J=H[O];R+=J[0]*I;E-=J[1]*L;K[O]=F(J,R,E)}return K}function k(E,F,H){const K=Array(H.length);for(let I=0;I<H.length;I++)K[I]=e(E,F,
H[I]);return K}function u(E,F,H,K){return e(E,H?K?C:t:K?t:A,F)}function p(E,F,H,K){return k(E,H?K?C:t:K?t:A,F)}function h(E,F,H,K){return k(E,H?K?C:t:K?t:A,F)}function r(E,F,H){let [K,I]=H[0],L=Math.min(K,F[0]),R=Math.min(I,F[1]),O=Math.max(K,F[2]);F=Math.max(I,F[3]);for(let J=1;J<H.length;J++){const [M,G]=H[J];K+=M;I+=G;0>M&&(L=Math.min(L,K));0<M&&(O=Math.max(O,K));0>G?R=Math.min(R,I):0<G&&(F=Math.max(F,I))}E[0]=L;E[1]=R;E[2]=O;E[3]=F;return E}function q(E,F){if(!F.length)return null;E[0]=E[1]=Number.POSITIVE_INFINITY;
E[2]=E[3]=Number.NEGATIVE_INFINITY;for(let H=0;H<F.length;H++)r(E,E,F[H]);return E}function y(E,F,H,K,I){F.xmin=w(E,H.xmin);F.ymin=n(E,H.ymin);F.xmax=w(E,H.xmax);F.ymax=n(E,H.ymax);F!==H&&(K&&(F.zmin=H.zmin,F.zmax=H.zmax),I&&(F.mmin=H.mmin,F.mmax=H.mmax));return F}function B(E,F,H,K,I){F.points=m(E,H.points,K,I)??[];return F}function D(E,F,H,K,I){F.x=w(E,H.x);F.y=n(E,H.y);F!==H&&(K&&(F.z=H.z),I&&(F.m=H.m));return F}function z(E,F,H,K,I){E=l(E,H.rings,K,I);if(!E)return null;F.rings=E;return F}function v(E,
F,H,K,I){E=g(E,H.paths,K,I);if(!E)return null;F.paths=E;return F}const A=(E,F,H)=>[F,H],t=(E,F,H)=>[F,H,E[2]],C=(E,F,H)=>[F,H,E[2],E[3]];a.equals=function(E,F){if(E===F||null==E&&null==F)return!0;if(null==E||null==F)return!1;let H,K,I,L;E&&"upperLeft"===E.originPosition?(H=E.translate[0],K=E.translate[1],E=E.scale[0]):(H=b.isSome(E.extent)?E.extent.xmin:0,K=b.isSome(E.extent)?E.extent.ymax:0,E=E.tolerance);F&&"upperLeft"===F.originPosition?(I=F.translate[0],L=F.translate[1],F=F.scale[0]):(I=b.isSome(F.extent)?
F.extent.xmin:0,L=b.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);return H===I&&K===L&&E===F};a.getQuantizedBoundsCoordsArray=r;a.getQuantizedBoundsCoordsArrayArray=q;a.getQuantizedBoundsPaths=function(E){return q([0,0,0,0],E)};a.getQuantizedBoundsPoints=function(E){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return r(F,F,E)};a.getQuantizedBoundsRings=function(E){return q([0,0,0,0],E)};a.quantizeBounds=function(E,F,H){F[0]=w(E,H[0]);
F[3]=n(E,H[1]);F[2]=w(E,H[2]);F[1]=n(E,H[3]);return F};a.quantizeExtent=y;a.quantizeGeometry=function(E,F){return E&&F?c.isPoint(F)?D(E,{},F,!1,!1):c.isPolyline(F)?v(E,{},F,!1,!1):c.isPolygon(F)?z(E,{},F,!1,!1):c.isMultipoint(F)?B(E,{},F,!1,!1):c.isExtent(F)?y(E,{},F,!1,!1):null:null};a.quantizeMultipoint=B;a.quantizePaths=g;a.quantizePoint=D;a.quantizePoints=m;a.quantizePolygon=z;a.quantizePolyline=v;a.quantizeRings=l;a.quantizeX=w;a.quantizeY=n;a.toQuantizationTransform=function(E){return E?{originPosition:"upper-left"===
E.originPosition?"upperLeft":"lower-left"===E.originPosition?"lowerLeft":E.originPosition,scale:E.tolerance?[E.tolerance,E.tolerance]:[1,1],translate:b.isSome(E.extent)?[E.extent.xmin,E.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(E,F,H){return H?(F[0]=f(E,H[0]),F[1]=d(E,H[3]),F[2]=f(E,H[2]),F[3]=d(E,H[1]),F):[f(E,F[0]),d(E,F[3]),f(E,F[2]),d(E,F[1])]};a.unquantizeCoordsArray=e;a.unquantizeCoordsArrayArray=k;a.unquantizeExtent=function(E,F,H,K,I){F.xmin=f(E,H.xmin);F.ymin=d(E,H.ymin);F.xmax=
f(E,H.xmax);F.ymax=d(E,H.ymax);F!==H&&(K&&(F.zmin=H.zmin,F.zmax=H.zmax),I&&(F.mmin=H.mmin,F.mmax=H.mmax));return F};a.unquantizeMultipoint=function(E,F,H,K,I){b.isSome(H)&&(F.points=u(E,H.points,K,I));return F};a.unquantizePaths=p;a.unquantizePoint=function(E,F,H,K,I){if(b.isNone(H))return F;F.x=f(E,H.x);F.y=d(E,H.y);F!==H&&(K&&(F.z=H.z),I&&(F.m=H.m));return F};a.unquantizePoints=u;a.unquantizePolygon=function(E,F,H,K,I){b.isSome(H)&&(F.rings=h(E,H.rings,K,I));return F};a.unquantizePolyline=function(E,
F,H,K,I){b.isSome(H)&&(F.paths=p(E,H.paths,K,I));return F};a.unquantizeRings=h;a.unquantizeX=f;a.unquantizeY=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/maybe","../../geometry/support/spatialReferenceUtils"],function(a,b,c,w){function n(f,d){if(f===d)return!0;if(null==f||null==d||f.length!==d.length)return!1;for(let e=0;e<f.length;e++){const k=f[e],u=d[e];if(k.length!==
u.length)return!1;for(let p=0;p<k.length;p++)if(k[p]!==u[p])return!1}return!0}function x(f,d){if(f===d)return!0;if(null==f||null==d||f.length!==d.length)return!1;for(let e=0;e<f.length;e++)if(!n(f[e],d[e]))return!1;return!0}function m(f,d){return f===d||c.isSome(f)&&c.isSome(d)&&w.equals(f.spatialReference,d.spatialReference)&&f.x===d.x&&f.y===d.y&&f.z===d.z&&f.m===d.m}function l(f,d){if(f===d)return!0;if(c.isNone(f)||c.isNone(d)||f.type!==d.type)return!1;switch(f.type){case "point":return m(f,d);
case "extent":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:w.equals(f.spatialReference,d.spatialReference)?f.xmin===d.xmin&&f.ymin===d.ymin&&f.zmin===d.zmin&&f.xmax===d.xmax&&f.ymax===d.ymax&&f.zmax===d.zmax:!1,f;case "polyline":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:w.equals(f.spatialReference,d.spatialReference)?x(f.paths,d.paths):!1,f;case "polygon":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:w.equals(f.spatialReference,d.spatialReference)?x(f.rings,d.rings):!1,f;case "multipoint":return f=
f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:w.equals(f.spatialReference,d.spatialReference)?n(f.points,d.points):!1,f;case "mesh":return!1}}function g(f,d){if(f===d)return!0;if(!f||!d)return!1;const e=Object.keys(f),k=Object.keys(d);if(e.length!==k.length)return!1;for(const u of e)if(f[u]!==d[u])return!1;return!0}a.equals=function(f,d){return f===d?!0:null!=f&&null!=d&&f.objectId===d.objectId&&l(f.geometry,d.geometry)&&g(f.attributes,d.attributes)?!0:!1};a.pointEquals=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../core/maybe ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(a,b,c,w,n,x,m,l,g,f){function d(p,h){if(null==p)return"";const r=h.domain;if(r)if("codedValue"===r.type||"coded-value"===r.type)for(var q of r.codedValues){if(q.code===p)return q.name}else if("range"===r.type){q=+p;const y="range"in r?r.range[1]:
r.maxValue;if(("range"in r?r.range[0]:r.minValue)<=q&&q<=y)return r.name}"date"===h.type||"esriFieldTypeDate"===h.type?p=x.formatDate(p,x.convertDateFormatToIntlOptions("short-date")):l.isNumericField(h)&&(p=m.formatNumber(+p));return p||""}const e=w.getLogger("esri.layers.support.labelFormatUtils"),k={type:"simple",evaluate(){return null}},u={getAttribute(p,h){return p.field(h)}};b.createLabelFunction=async function(p,h,r){if(!p||!p.symbol||!h)return k;const q=p.where,y=g.getLabelExpression(p);p=
q?await new Promise((B,D)=>a(["../../core/sql/WhereClause"],B,D)):null;if("arcade"===y.type){const B=await f.createLabelExpression(y.expression,r,h);if(n.isNone(B))return k;r={type:"arcade",evaluate(D){try{const z=B.evaluate({$feature:"attributes"in D?B.repurposeFeature(D):D});if(null!=z)return z.toString()}catch(z){e.error(new c("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:D,expression:y}))}return null},needsHydrationToEvaluate(){return null==
g.getSingleFieldArcadeExpression(y.expression)}}}else r={type:"simple",evaluate(B){return y.expression.replace(/{[^}]*}/g,D=>{var z=D.slice(1,-1);z=h.get(z);if(!z)return D;D=null;"attributes"in B?B&&B.attributes&&(D=B.attributes[z.name]):D=B.field(z.name);return null==D?"":d(D,z)})}};if(q){let B;try{B=p.WhereClause.create(q,h)}catch(z){return e.error(new c("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:q,error:z})),k}const D=r.evaluate;r.evaluate=z=>{const v=
"attributes"in z?void 0:u;try{if(B.testFeature(z,v))return D(z)}catch(A){e.error(new c("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:q,feature:z,error:A}))}return null}}return r};b.formatField=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/CreateLabelParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c=null,w="center",n="center",
x=null,m=[0,0,0],l=0,g=[0,0,0,1],f=[0,0],d="world",e=0,k=0){this.verticalOffset=c;this.horizontalPlacement=w;this.verticalPlacement=n;this.text=x;this.translation=m;this.elevationOffset=l;this.centerOffset=g;this.screenOffset=f;this.centerOffsetUnits=d;this.displayWidth=e;this.displayHeight=k});a.CreateLabelParameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger",
"../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,c,w){const n=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),x={line:w.Graphics3DLineCalloutSymbolLayer};a.make=function(m,l){if(!c.hasCalloutSupport(m))return n.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${m.type}' does not support callouts`),null;if(!m.callout)return null;const g=x[m.callout.type];return g?new g(m,l):(n.error("Graphics3DCalloutSymbolLayerFactory#make",
`unknown or unsupported callout type ${m.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A){h=function(H){function K(L,R){L=I.call(this,L,null,R,F);L._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};L.ensureDrapedStatus(!1);return L}b._inherits(K,H);var I=b._createSuper(K);H=K.prototype;H.doLoad=async function(){this._material=new A.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._material)};H.destroy=function(){b._get(b._getPrototypeOf(K.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);
this._material=null};H._perInstanceMaterialParameters=function(L){const R=this._materialParameters;R.screenOffset=L.screenOffset||x.ZEROS;R.centerOffsetUnits=L.centerOffsetUnits||"world";return R};H._defaultElevationInfoNoZ=function(){return E};H.createGraphics3DGraphic=function(L){const R=L.renderingInfo;L=L.graphic;const O=this.setGraphicElevationContext(L,new e.ElevationContext,R.elevationOffset||0);var J=R.symbol;const M="on-the-ground"===this._elevationContext.mode&&("cim"===J.type||!J.symbolLayers.some(G=>
"object"===G.type||"text"===G.type));if("label-3d"!==J.type&&M||"point-3d"===J.type&&J.symbolLayers.every(G=>"text"===G.type&&!g.textSymbolLayerSupportsVerticalOffset(G)))return null;J=r.computeCentroid(L.geometry);return w.isNone(J)?null:this._createAs3DShape(J,O,R,L.uid)};H.layerOpacityChanged=function(){w.isSome(this._material)&&this._material.setParameters(this._materialParameters)};H.layerElevationInfoChanged=function(L,R,O){O=d.elevationModeChangeUpdateType(K.elevationModeChangeTypes,O,this._elevationContext.mode);
if(O!==d.SymbolUpdateType.UPDATE)return O;L.forEach(J=>{const M=R(J);w.isSome(M)&&this.updateGraphicElevationContext(J.graphic,M)});return O};H.slicePlaneEnabledChanged=function(){if(w.isNone(this._material))return!0;this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};H.physicalBasedRenderingChanged=function(){return!0};H.setGraphicElevationContext=function(L,R,O=0){L=b._get(b._getPrototypeOf(K.prototype),"setGraphicElevationContext",this).call(this,L,R);L.addOffsetRenderUnits(O);
return L};H.updateGraphicElevationContext=function(L,R){this.setGraphicElevationContext(L,R.elevationContext,w.isSome(R.metadata)?R.metadata.elevationOffset:0);R.needsElevationUpdates=d.needsElevationUpdates2D(R.elevationContext.mode)};H.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:y.emptySymbolComplexity.memory}};H._createVertexData=function(L){const {translation:R,centerOffset:O}=L;L=R?new B.Attribute([R[0],R[1],R[2]],
3,!0):new B.Attribute([0,0,0],3,!0);const J=O?new B.Attribute([O[0],O[1],O[2],O[3]],4,!0):new B.Attribute([0,0,0,1],4,!0);return[[v.VertexAttribute.POSITION,L],[v.VertexAttribute.NORMAL,new B.Attribute([0,0,1],3,!0)],[v.VertexAttribute.AUXPOS1,J]]};H._getOrCreateMaterial=function(L){const R=this._perInstanceMaterialParameters(L),O=A.LineCalloutMaterial.uniqueMaterialIdentifier(R);if(w.isSome(this._material)&&O===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(w.isSome(L.materialCollection)){let J=
L.materialCollection.get(O);w.isNone(J)&&(J=new A.LineCalloutMaterial(R),L.materialCollection.add(O,J));return{material:J,isUnique:!1}}return{material:new A.LineCalloutMaterial(R),isUnique:!0}};H._createAs3DShape=function(L,R,O,J){var M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:J,layerUid:this._context.layer.uid}),G=this._getOrCreateMaterial(O);M=new z.Geometry(G.material,this._createVertexData(O),C,null,D.ContentObjectType.Point,M);J=q.createStageObject(this._context,L,
M,R,J);if(w.isNone(J))return null;G=new u.Graphics3DObject3DGraphicLayer(this,J.object,[M],G.isUnique?[G.material]:null,null,f.perObjectElevationAligner,R);G.metadata=new p.Graphics3DObjectMetadata(O.elevationOffset);G.alignedSampledElevation=J.sampledElevation;G.needsElevationUpdates=d.needsElevationUpdates2D(R.mode);q.extendPointGraphicElevationContext(G,L,this._context.elevationProvider);return G};b._createClass(K,[{key:"_materialParameters",get:function(){const L=new A.Parameters;var R=this.symbol,
O=R.callout;L.color=w.isSome(O.color)?c.toUnitRGBA(O.color):[0,0,0,0];L.color[3]*=this._getLayerOpacity();L.size=n.pt2px(O.size||0);if(R.verticalOffset){const {screenLength:J,minWorldLength:M,maxWorldLength:G}=R.verticalOffset;L.verticalOffset={screenLength:n.pt2px(J),minWorldLength:M||0,maxWorldLength:w.isSome(G)?G:Infinity}}L.borderColor=w.isSome(O.border)&&w.isSome(O.border.color)?c.toUnitRGBA(O.border.color):null;O="object"===R.symbolLayers.getItemAt(0).type;R="label-3d"===R.type;L.occlusionTest=
!O;L.shaderPolygonOffset=O?0:void 0;L.depthHUDAlignStart=R;L.hasSlicePlane=this._context.slicePlaneEnabled;L.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return L}}]);return K}(h.Graphics3DSymbolLayer);h.elevationModeChangeTypes={definedChanged:d.SymbolUpdateType.UPDATE,staysOnTheGround:d.SymbolUpdateType.UPDATE,onTheGroundChanged:d.SymbolUpdateType.RECREATE};var t=[0];const C=[[v.VertexAttribute.POSITION,t],[v.VertexAttribute.NORMAL,
t],[v.VertexAttribute.AUXPOS1,t]],E={mode:"relative-to-ground",offset:0},F={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};t=b._createClass(function(H,K,I=m.create(),L=l.create(),R=x.create(),O="world",J=0,M=null){this.renderer=H;this.symbol=K;this.translation=I;this.centerOffset=L;this.screenOffset=R;this.centerOffsetUnits=O;this.elevationOffset=J;this.materialCollection=M});k=function(H){function K(){return I.apply(this,arguments)}b._inherits(K,H);var I=b._createSuper(K);return b._createClass(K)}(k);
a.Graphics3DLineCalloutSymbolLayer=h;a.LineCalloutCreationContext=k;a.LineCalloutSymbolLayerRenderingInfo=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(z,v,A,t,C){let E=!1;var F=z.shaderTransformation;v=v.requiresSampledElevationInfo;r[0]=F[12];r[1]=F[13];r[2]=F[14];z.invalidateBoundingInfo();var H=z.getMutableAttribute(k.VertexAttribute.POSITION);F=H.data;H=H.size;const K=F.length/H;z=new d.SamplePosition(z.mapPositions,A);let I=0,L=0;for(let R=0;R<K;R++){q[0]=F[I];q[1]=F[I+1];q[2]=F[I+2];t(z,D);v&&(L+=D.sampledElevation);if(f.TESTS_DISABLE_OPTIMIZATIONS)F[I]=z.array[z.offset],F[I+1]=z.array[z.offset+
1],F[I+2]=D.z,m.projectBuffer(F,A,I,F,C.spatialReference,I,1),F[I]-=r[0],F[I+1]-=r[1],F[I+2]-=r[2],E=!0;else{h[0]=F[I]+r[0];h[1]=F[I+1]+r[1];h[2]=F[I+2]+r[2];C.setAltitude(h,D.z);F[I]=h[0]-r[0];F[I+1]=h[1]-r[1];F[I+2]=h[2]-r[2];const O=.01/C.unitInMeters;if(Math.abs(q[0]-F[I])>=O||Math.abs(q[1]-F[I+1])>=O||Math.abs(q[2]-F[I+2])>=O)E=!0}I+=H;z.offset+=3}return{update:E,averageGeometrySampledElevation:L/K}}const p=w.create(),h=x.create(),r=x.create(),q=x.create(),y=w.create(),B=x.create(),D=new l.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(z,v,A,t,C){var E=z.graphics3DSymbolLayer.lodRenderer;if(b.isNone(E))return 0;A=v.centerPointInElevationSR;t(A,D);v="absolute-height"!==v.mode?D.sampledElevation:0;t=E.instanceData;z=z.instanceIndex;t.getGlobalTransform(z,y);E=n.set(B,y[12],y[13],y[14]);f.TESTS_DISABLE_OPTIMIZATIONS?(h[0]=A.x,h[1]=A.y,h[2]=D.z,m.computeTranslationToOriginAndRotation(A.spatialReference,h,y,C.spatialReference)&&t.setGlobalTransform(z,y)):C.setAltitudeOfTransformation(D.z,y);
C=.01/C.unitInMeters;(f.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(y[12]-E[0])>=C||Math.abs(y[13]-E[1])>=C||Math.abs(y[14]-E[2])>=C)&&t.setGlobalTransform(z,y);return v};a.perObjectElevationAligner=function(z,v,A,t,C){z=z.stageObject;const E=v.centerPointInElevationSR;A=0;z.metadata?.usesVerticalDistanceToGround?(t(E,D),g.updateVertexAttributeAuxpos1w(z,D.verticalDistanceToGround),A=D.sampledElevation):(t(E,D),"absolute-height"!==v.mode&&(A=D.sampledElevation));v=c.copy(p,z.transformation);t=n.set(B,v[12],
v[13],v[14]);f.TESTS_DISABLE_OPTIMIZATIONS?(h[0]=E.x,h[1]=E.y,h[2]=D.z,m.computeTranslationToOriginAndRotation(E.spatialReference,h,v,C.spatialReference)&&(z.transformation=v)):C.setAltitudeOfTransformation(D.z,v);C=.01/C.unitInMeters;if(Math.abs(v[12]-t[0])>=C||Math.abs(v[13]-t[1])>=C||Math.abs(v[14]-t[2])>=C)z.transformation=v;return A};a.perVertexElevationAligner=function(z,v,A,t,C){z=z.stageObject;const E=z.geometries;let F=0;for(const H of E){if(!e.isGeometryWithMapPositions(H))continue;const {update:K,
averageGeometrySampledElevation:I}=u(H,v,A,t,C);F+=I;K&&z.geometryVertexAttrsUpdated(H)}return F/E.length};a.sharedGeometryElevationAligner=function(z,v,A,t,C){z=z.stageObject;const E=z.geometries;if(0===E.length)return 0;let F=0,H=null,K=0,I=!1;for(const L of E){if(!e.isGeometryWithMapPositions(L))continue;const R=L.vertexAttributes.get(k.VertexAttribute.POSITION);if(R!==H){const {update:O,averageGeometrySampledElevation:J}=u(L,v,A,t,C);K=J;H=R;I=O}I&&z.geometryVertexAttrsUpdated(L);F+=K}return F/
E.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),function(a,b,c,w,n,x,m,l,g,f){function d(h,r,q,y,B){const D=
(l.isDehydratedPoint(h)?h.z:f.isSamplePosition(h)?h.array[h.offset+2]:h[2])||0;switch(q.mode){case "on-the-ground":q=c.unwrapOr(f.getElevationAtPoint(r,h,"ground"),0);B.verticalDistanceToGround=0;B.sampledElevation=q;B.z=q;break;case "relative-to-ground":h=c.unwrapOr(f.getElevationAtPoint(r,h,"ground"),0);q=q.geometryZWithOffset(D,y);B.verticalDistanceToGround=q;B.sampledElevation=h;B.z=q+h;break;case "relative-to-scene":h=c.unwrapOr(f.getElevationAtPoint(r,h,"scene"),0);q=q.geometryZWithOffset(D,
y);B.verticalDistanceToGround=q;B.sampledElevation=h;B.z=q+h;break;case "absolute-height":q=q.geometryZWithOffset(D,y);y=c.unwrapOr(f.getElevationAtPoint(r,h,"ground"),0);B.verticalDistanceToGround=q-y;B.sampledElevation=y;B.z=q;break;default:B.z=0}}b=b._createClass(function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0});a.SymbolUpdateType=void 0;(function(h){h[h.NONE=0]="NONE";h[h.UPDATE=1]="UPDATE";h[h.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const e=
{"absolute-height":{applyElevationAlignmentBuffer:function(h,r,q,y,B,D,z,v){D=v.calculateOffsetRenderUnits(z);v=v.featureExpressionInfoContext;r*=3;y*=3;for(z=0;z<B;++z){const A=h[r+1],t=h[r+2];q[y]=h[r];q[y+1]=A;q[y+2]=null==v?t+D:D;r+=3;y+=3}return 0},requiresAlignment:function(h){const r=h.featureExpressionInfoContext;return 0!==h.meterUnitOffset||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(h,r,q,y,B,D){let z=0;const v=D.spatialReference;r*=3;y*=3;for(let A=0;A<B;++A){const t=
h[r],C=h[r+1],E=c.unwrapOr(D.getElevation(t,C,h[r+2],v,"ground"),0);z+=E;q[y]=t;q[y+1]=C;q[y+2]=E;r+=3;y+=3}return z/B},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(h,r,q,y,B,D,z,v){let A=0;z=v.calculateOffsetRenderUnits(z);v=v.featureExpressionInfoContext;const t=D.spatialReference;r*=3;y*=3;for(let C=0;C<B;++C){const E=h[r],F=h[r+1],H=h[r+2],K=c.unwrapOr(D.getElevation(E,F,H,t,"ground"),0);A+=K;q[y]=E;q[y+1]=F;q[y+2]=null==v?H+K+z:K+z;r+=3;y+=3}return A/
B},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(h,r,q,y,B,D,z,v){let A=0;z=v.calculateOffsetRenderUnits(z);v=v.featureExpressionInfoContext;const t=D.spatialReference;r*=3;y*=3;for(let C=0;C<B;++C){const E=h[r],F=h[r+1],H=h[r+2],K=c.unwrapOr(D.getElevation(E,F,H,t,"scene"),0);A+=K;q[y]=E;q[y+1]=F;q[y+2]=null==v?H+K+z:K+z;r+=3;y+=3}return A/B},requiresAlignment:()=>!0}},k=n.create(),u=new b,p=x.create();a.SampleElevationInfo=b;a.applyElevationAlignmentForHUD=
function(h,r,q,y,B){d(r,q,B,y,u);g.updateVertexAttributeAuxpos1w(h,u.verticalDistanceToGround);q=u.sampledElevation;B=w.copy(k,h.transformation);p[0]=r.x;p[1]=r.y;p[2]=u.z;m.computeTranslationToOriginAndRotation(r.spatialReference,p,B,y.spatialReference)?h.transformation=B:console.warn("Could not locate symbol object properly, it might be misplaced");return q};a.applyPerVertexElevationAlignment=function(h,r,q,y,B,D,z,v,A,t,C){const E=e[C.mode];let F=0;if(m.projectBuffer(h,r,q,y,A.spatialReference,
B,v)&&(E.requiresAlignment(C)?(F=E.applyElevationAlignmentBuffer(y,B,D,z,v,A,t,C),h=D,B=z):h=y,m.projectBuffer(h,A.spatialReference,B,D,t.spatialReference,z,v)))return F};a.elevationModeChangeUpdateType=function(h,r,q){return null==r||null==q?h.definedChanged:"on-the-ground"===r&&"on-the-ground"===q?h.staysOnTheGround:r===q||"on-the-ground"!==r&&"on-the-ground"!==q?a.SymbolUpdateType.UPDATE:h.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(h,r,q,y){d(h,r,q,y,u);return u.z};a.evaluateElevationInfoAtPoint=
d;a.needsElevationUpdates2D=function(h){return"relative-to-ground"===h||"relative-to-scene"===h};a.needsElevationUpdates3D=function(h){return"absolute-height"!==h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(B){var D=B.paths[0];if(!D||0===D.length)return null;D=k.getPointOnPath(D,k.getPathLength(D)/2);return u.makeDehydratedPoint(D[0],D[1],D[2],B.spatialReference)}function q(B,D,z){z=z?B:p.clonePoint(B);return D&&B?g.projectPoint(B,z,D)?z:null:z}function y(B){if(Array.isArray(B)){for(const D of B)if(!y(D))return!1;return!0}return null==B||0<=B}a.computeCentroid=function(B,D){if("point"===B.type)return q(B,D,!1);if(p.isHydratedGeometry(B))switch(B.type){case "extent":return q(B.center,
D,!1);case "polygon":return q(B.centroid,D,!1);case "polyline":return q(r(B),D,!0);case "mesh":return q(B.origin,D,!1)}else switch(B.type){case "extent":return B=u.makeDehydratedPoint(.5*(B.xmax+B.xmin),.5*(B.ymax+B.ymin),null!=B.zmin&&null!=B.zmax&&isFinite(B.zmin)&&isFinite(B.zmax)?.5*(B.zmax+B.zmin):void 0,B.spatialReference),q(B,D,!0);case "polygon":var z=B.rings[0];z&&0!==z.length?(z=e.ringsCentroid(B.rings,!!B.hasZ),B=u.makeDehydratedPoint(z[0],z[1],z[2],B.spatialReference)):B=null;return q(B,
D,!0);case "polyline":return q(r(B),D,!0)}};a.computeObjectRotation=function(B,D,z,v=n.create()){B=B||0;D=D||0;z=z||0;0!==B&&w.rotateZ(v,v,-B/180*Math.PI);0!==D&&w.rotateX(v,v,D/180*Math.PI);0!==z&&w.rotateY(v,v,z/180*Math.PI);return v};a.computeObjectScale=function(B=x.ONES,D,z,v=1){const A=Array(3);if(b.isNone(D)||b.isNone(z))A[0]=1,A[1]=1,A[2]=1;else{let C=0;for(let E=2;0<=E;E--){const F=B[E];let H;const K=null!=F,I=0===E&&!t&&!K,L=z[E];"symbol-value"===F||I?H=0!==L?D[E]/L:1:K&&"proportional"!==
F&&isFinite(F)&&(H=0!==L?F/L:1);if(null!=H){var t=A[E]=H;C=Math.max(C,Math.abs(H))}}for(B=2;0<=B;B--)null==A[B]?A[B]=t:0===A[B]&&(A[B]=.001*C)}for(t=2;0<=t;t--)A[t]/=v;return x.fromArray(A)};a.demResolutionForBoundingBox=function(B,D,z){if(null!=z.minDemResolution)return z.minDemResolution;const v=c.getMetersPerUnitForSR(D),A=f.width(B)*v,t=f.depth(B)*v;B=f.height(B)*(D.isGeographic?1:v);return 0===A&&0===t&&0===B?z.minDemResolutionForPoints:.01*Math.max(A,t,B)};a.enlargeExtent=function(B,D,z,v=0){if(B){D||
(D=d.create());let A=.5*B.width*(z-1);z=.5*B.height*(z-1);B.width<1E-7*B.height?A+=z/20:B.height<1E-7*B.width&&(z+=A/20);m.set(D,B.xmin-A-v,B.ymin-z-v,B.xmax+A+v,B.ymax+z+v);return D}return null};a.isValidSize=y;a.mixinColorAndOpacity=function(B,D){const z=l.clone(l.ONES);b.isSome(B)&&(z[0]=B[0],z[1]=B[1],z[2]=B[2]);b.isSome(D)?z[3]=D:b.isSome(B)&&3<B.length&&(z[3]=B[3]);return z};a.overrideColor=function(B,D,z,v,A,t=[0,0,0,0]){for(let C=0;3>C;++C)b.isSome(B)&&null!=B[C]?t[C]=B[C]:b.isSome(z)&&null!=
z[C]?t[C]=z[C]:t[C]=A[C];b.isSome(D)?t[3]=D:b.isSome(v)?t[3]=v:t[3]=A[3];return t};a.updateVertexAttributeAuxpos1w=function(B,D){for(let z=0;z<B.geometries.length;++z){const v=B.geometries[z].getMutableAttribute(h.VertexAttribute.AUXPOS1);v&&v.data[3]!==D&&(v.data[3]=D,B.geometryVertexAttrsUpdated(B.geometries[z]))}};a.validateSymbolLayerSize=function(B){return y(null!=B.isPrimitive?[B.width,B.depth,B.height]:B)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Geometry"],function(a,b,c,w){w=function(n){function x(){return m.apply(this,arguments)}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(w.Geometry);a.GeometryWithMapPositions=w;a.isGeometryWithMapPositions=function(n){return c.isSome(n.mapPositions)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,c,w,n){let x=function(){function m(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var l=m.prototype;l.reset=function(){this.mode=
null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};l.addOffsetRenderUnits=function(g){this._renderUnitOffset+=g};l.geometryZWithOffset=function(g,f){f=this.calculateOffsetRenderUnits(f);return null!=this.featureExpressionInfoContext?f:g+f};l.calculateOffsetRenderUnits=function(g){let f=this._meterUnitOffset;const d=this.featureExpressionInfoContext;null!=d&&(f+=n.execute(d)*this._metersPerElevationInfoUnit);return f/g.unitInMeters+this._renderUnitOffset};
l.setFromElevationInfo=function(g){this.mode=g.mode;this.unit=w.supportsUnit(g.unit)?g.unit:"meters";this.offsetElevationInfoUnits=c.unwrapOr(g.offset,0)};l.updateFeatureExpressionInfoContext=function(g,f,d){if(c.isNone(g))this._featureExpressionInfoContext=null;else{var e=g&&g.arcade;e&&c.isSome(f)&&c.isSome(d)?(this._featureExpressionInfoContext=n.clone(g),n.setContextFeature(this._featureExpressionInfoContext,n.createFeature(e.modules,f,d))):this._featureExpressionInfoContext=g}};m.fromElevationInfo=
function(g){const f=new m;c.isSome(g)&&f.setFromElevationInfo(g);return f};b._createClass(m,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(g){this._unit=g;this._metersPerElevationInfoUnit=w.getMetersPerUnit(g)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(g){this._meterUnitOffset=
g;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(g){this._meterUnitOffset=g*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return m}();a.ElevationContext=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,
b,c,w,n){const x=b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(m){return{cachedResult:m.cachedResult,arcade:m.arcade?{func:m.arcade.func,context:m.arcade.modules.arcadeUtils.createExecContext(null,{sr:m.arcade.context.spatialReference}),modules:m.arcade.modules}:null}};a.createContext=async function(m,l,g,f){m=m&&m.expression;if("string"!==typeof m)return null;var d="0"===m?0:null;if(null!=d)return{cachedResult:d};d=await n.loadArcade();c.throwIfAborted(g);
g=d.arcadeUtils;m=g.createSyntaxTree(m);return g.dependsOnView(m)?(null!=f&&f.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:g.createFunction(m),context:g.createExecContext(null,{sr:l}),modules:d}}};a.createContextWithoutExpressionSupport=function(m){m=m&&m.expression;return"string"===typeof m&&(m="0"===m?0:null,null!=m)?{cachedResult:m}:null};a.createFeature=function(m,l,g){return m.arcadeUtils.createFeature(l.attributes,l.geometry,g)};
a.execute=function(m){if(null!=m){if(null!=m.cachedResult)return m.cachedResult;var l=m.arcade;l=l?.modules.arcadeUtils.executeFunction(l.func,l.context);"number"!==typeof l&&(l=m.cachedResult=0);return l}return 0};a.extractExpressionInfo=function(m,l=!1){const g=(m=m&&m.featureExpressionInfo)&&m.expression;l||"0"===g||(m=null);return m??null};a.setContextFeature=function(m,l){null!=m&&null==m.cachedResult&&(l&&m.arcade?(l._geometry&&(l._geometry=w.hydrateGeometry(l._geometry)),m.arcade.modules.arcadeUtils.updateExecContext(m.arcade.context,
l)):x.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(a){return a._createClass(function(b,c,w){this.graphic=b;this.renderingInfo=c;this.layer=w})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(B){return B.isVisible()?B.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}let u=b._createClass(function(B,D,z){this.baseMaterial=B;this.edgeMaterials=D;this.properties=z}),p=function(){function B(z,v,A,t,C,E,F,H=null){this.graphics3DSymbolLayer=z;this.stageObject=v;this._uniqueGeometries=A;this._uniqueMaterials=t;this._sharedResource=C;this.elevationAligner=E;this.elevationContext=F;this._edgeState=H;this.type=
"object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}var D=B.prototype;D.initialize=function(z,v){this._stageLayer=v;this._stage=z;z.addMany(this._uniqueMaterials);z.addMany(this._uniqueGeometries);z.add(this.stageObject)};D.destroy=function(){var z=this._stage;this._stageLayer&&(z.removeMany(this._uniqueMaterials),z.removeMany(this._uniqueGeometries));z.remove(this.stageObject);
this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);z=this._stage.renderer.ensureEdgeView();z.hasObject(this.stageObject)&&z.removeObject(this.stageObject);this.stageObject.dispose();c.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};D.layerOpacityChanged=function(z,v){if(!c.isNone(this._edgeState)){var A=k(this._edgeState.baseMaterial),t=!1;for(const C of this._edgeState.edgeMaterials)C.objectTransparency!==
A&&(C.objectTransparency=A,t=!0);t&&this._resetEdgeObject(v);this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[z])}};D.slicePlaneEnabledChanged=function(z,v){c.isNone(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:z},!v),this._edgeState.properties.hasSlicePlane=z)};D.setVisibility=function(z){if(null!=this._stage&&this._visible!==z&&(this._visible=z,this.stageObject.visible=
z,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),c.isSome(this._edgeState))){const v=this._stage.renderer.ensureEdgeView();v.hasObject(this.stageObject)?v.updateObjectVisibility(this.stageObject,z):z&&this._addOrUpdateEdgeObject(v,!1)}};D.alignWithElevation=function(z,v,A,t){null!=this.elevationAligner&&(c.isSome(A)&&g.setContextFeature(this.elevationContext.featureExpressionInfoContext,A),this.alignedSampledElevation=this.elevationAligner(this,
this.elevationContext,c.unwrap(z.spatialReference),(C,E)=>l.evaluateElevationInfoAtPoint(C,z,this.elevationContext,v,E),v),this._resetEdgeObject(t))};D.alignWithAbsoluteElevation=function(z,v,A){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(t,C)=>{C.sampledElevation=z;C.verticalDistanceToGround=0;C.z=z},v);this._resetEdgeObject(A)};D.getCenterObjectSpace=function(z=n.create()){return w.copy(z,m.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};D.getBoundingBoxObjectSpace=
function(z=x.create()){const v=this.stageObject.boundingVolumeObjectSpace;x.setMin(z,v.min);x.setMax(z,v.max);return z};D.computeAttachmentOrigin=function(z){if(this.useObjectOriginAsAttachmentOrigin){var v=this.stageObject.transformation;z.render.origin[0]+=v[12];z.render.origin[1]+=v[13];z.render.origin[2]+=v[14];z.render.num++}else for(v of this.stageObject.geometries)v.computeAttachmentOrigin(q)&&(w.transformMat4(q,q,this.stageObject.transformation),w.add(z.render.origin,z.render.origin,q),z.render.num++)};
D.getProjectedBoundingBox=async function(z,v,A,t,C){C=this.getBoundingBoxObjectSpace(C);var E=y,F=x.isPoint(C)?1:E.length;for(var H=0;H<F;H++){const K=E[H];r[0]=C[K[0]];r[1]=C[K[1]];r[2]=C[K[2]];w.transformMat4(r,r,this.stageObject.transformation);h[3*H]=r[0];h[3*H+1]=r[1];h[3*H+2]=r[2]}if(!z(h,0,F))return null;x.empty(C);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());for(E=0;E<3*F;E+=3){for(H=0;3>H;H++)C[H]=Math.min(C[H],h[E+H]),C[H+3]=Math.max(C[H+3],h[E+H]);
z&&A.push({location:h.slice(E,E+3),screenSpaceBoundingRect:z})}if(v&&v.service&&"absolute-height"!==this.elevationContext.mode){x.center(C,q);A="relative-to-scene"===this.elevationContext.mode?"scene":"ground";F=0;if(v.useViewElevation)F=c.unwrapOr(v.service.getElevation(q[0],q[1],A),0);else try{const K=f.demResolutionForBoundingBox(C,v.service.spatialReference,v);F=c.unwrapOr(await v.service.queryElevation(q[0],q[1],t,K,A),0)}catch(K){}x.offset(C,0,0,-this.alignedSampledElevation+F)}return C};D.addObjectState=
function(z,v){z===d.Object3DState.Highlight&&v.addObject(this.stageObject,this.stageObject.highlight());z===d.Object3DState.MaskOccludee&&v.addObject(this.stageObject,this.stageObject.maskOccludee())};D.removeObjectState=function(z){z.removeObject(this.stageObject)};D._resetEdgeObject=function(z){if(!c.isNone(this._edgeState)){var v=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(v,z):v.removeObject(this.stageObject)}};D._addOrUpdateEdgeObject=function(z,v){const A=
this._edgeState;if(!c.isNone(A)){var t=k(A.baseMaterial);for(const C of A.edgeMaterials)C.objectTransparency=t;z.addOrUpdateObject3D(this.stageObject,A.edgeMaterials,A.properties,!v).then(()=>this._stageLayer?.sync())}};b._createClass(B,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return B}();const h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=n.create(),q=
n.create(),y=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=p;a.Object3DEdgeState=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe"],function(a,b,c){b=b._createClass(function(w,n=null){this.labelText=n;this.elevationOffset=c.unwrapOr(w,0)});a.Graphics3DObjectMetadata=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(t,C){t=t?C.attributes[t]:0;return null!=t&&isFinite(t)?t:0}function q(t){const C={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(E=>{switch(E.type){case "color":C.color=!0;if(E.stops)for(let F=0;F<E.stops.length;F++){const H=E.stops[F].color;H&&(C.opacity=!0,1>H.a&&(C.opacityAlwaysOpaque=!1))}break;case "opacity":C.opacity=!0;C.opacityAlwaysOpaque=!1;break;case "size":C.size=
!0}});return C}const y=x.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(t){function C(F,H,K,I){var L=E.call(this,K.schedule);L.symbol=F;L.symbolLayer=H;L._context=K;L._elevationInfoOverride=null;L._ignoreDrivers=!1;L._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};L.complexity=null;L.logger=y;L._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};B.set(b._assertThisInitialized(L),!0);D.set(b._assertThisInitialized(L),!0);L._renderPriority=
I.renderPriority;L._renderPriorityStep=I.renderPriorityStep;L._elevationContext=new d.ElevationContext;L.complexity=L.computeComplexity();L._ignoreDrivers=I.ignoreDrivers;L._ignoreDrivers||(L._drivenProperties=q(L._context.renderer));L._updateElevationContext();return L}b._inherits(C,t);var E=b._createSuper(C);t=C.prototype;t.getCachedSize=function(){return null};t._drivenPropertiesChanged=function(F){if(this._ignoreDrivers)return!1;const H=this._drivenProperties;F=q(F);return F.color!==H.color||
F.opacity!==H.opacity||F.opacityAlwaysOpaque!==H.opacityAlwaysOpaque||F.size!==H.size};t._logGeometryCreationWarnings=function(F,H,K,I){const L="polygons"in F?F.polygons:null,R=`${I} geometry failed to be created`;let O=null;F.projectionSuccess?!this._logGeometryValidationWarnings(H,K,I)&&L&&0===L.length&&"rings"===K&&0<H.length&&2<H[0].length&&(O=`${R} (filled rings should use clockwise winding - try reversing the order of vertices)`):O=`${R} (failed to project geometry to view spatial reference)`;
O&&y.warnOncePerTick(O)};t._logGeometryValidationWarnings=function(F,H,K){K=`${K} geometry failed to be created`;return!F.length||1===F.length&&!F[0].length?(y.warnOncePerTick(`${K} (no ${H} were defined)`),!0):Array.isArray(F)&&Array.isArray(F[0])?!1:(y.warnOncePerTick(`${K} (${H} should be defined as a 2D array)`),!0)};t._validateGeometry=function(F,H=null,K=null){return m.isSome(H)&&!H.includes(F.type)?(this.logger.warn("unsupported geometry type for "+K+` symbol: ${F.type}`),!1):"point"!==F.type||
isFinite(F.x)&&isFinite(F.y)?!0:(y.warn("point coordinate is not a valid number, graphic skipped"),!1)};t._defaultElevationInfoNoZ=function(){return z};t._defaultElevationInfoZ=function(){return v};t._updateElevationContext=function(){m.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),
this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};t.getDefaultElevationInfo=function(F){return F.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};t.getGeometryElevationMode=function(F,H=this.getDefaultElevationInfo(F)){return this._elevationContext.mode||H.mode};t.setElevationInfoOverride=function(F){this._elevationInfoOverride=F;this._updateElevationContext()};t.setGraphicElevationContext=function(F,
H){var K=m.unwrap(F.geometry);const I=this.getDefaultElevationInfo(K);H.unit=null!=this._elevationContext.unit?this._elevationContext.unit:I.unit;H.mode=this.getGeometryElevationMode(K,I);H.offsetMeters=m.unwrapOr(this._elevationContext.meterUnitOffset,m.unwrapOr(I.offset,0));if(K=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===H.mode)H.mode="relative-to-ground",H.offsetMeters=0;H.updateFeatureExpressionInfoContext(K?e.zeroContext:this._elevationContext.featureExpressionInfoContext,
F,this._context.layer);return H};t.prepareSymbolLayerPatch=function(F){};t.updateGeometry=function(F,H){return!1};t.onRemoveGraphic=function(F){};t._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const F=this._context.layer.opacity;return null==F?1:F};t._getCombinedOpacity=function(F,H=A){let K=1;this.draped||(K*=this._getLayerOpacity());if(this._drivenProperties.opacity)return K;
m.isSome(F)?K*=F.a:H.hasIntrinsicColor||(K=0);return K};t._getCombinedOpacityAndColor=function(F,H=A){H=this._getCombinedOpacity(F,H);if(this._drivenProperties.color)return k.mixinColorAndOpacity(null,H);F=m.isSome(F)?w.toUnitRGB(F):l.ONES;return k.mixinColorAndOpacity(F,H)};t._getVertexOpacityAndColor=function(F,H=null){F=k.mixinColorAndOpacity(this._drivenProperties.color?F.color:null,this._drivenProperties.opacity?F.opacity:null);m.isSome(H)&&(F[0]*=H,F[1]*=H,F[2]*=H,F[3]*=H);return F};t.isFastUpdatesEnabled=
function(){return null!=this._fastUpdates};t.computeComplexity=function(){return h.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};t.globalPropertyChanged=function(F,H,K){switch(F){case "opacity":return this.layerOpacityChanged(H,K),!0;case "elevationInfo":return F=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(H,K,F)===f.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(H,K);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();
case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}};t.updateGraphics3DGraphicElevationInfo=function(F,H,K){let I=f.SymbolUpdateType.UPDATE;F.forEach(L=>{const R=H(L);m.isSome(R)?(this.setGraphicElevationContext(L.graphic,R.elevationContext),R.needsElevationUpdates=K(R.elevationContext.mode)):I=f.SymbolUpdateType.RECREATE});return I};t.applyRendererDiff=function(F,H){return u.ApplyRendererDiffResult.Recreate_Symbol};t.getFastUpdateAttrValues=
function(F){if(!this._fastUpdates)return null;const H=this._fastUpdates.visualVariables,K=H.size?r(H.size.field,F):0,I=H.color?r(H.color.field,F):0;F=H.opacity?r(H.opacity.field,F):0;return g.fromValues(K,I,F,0)};t.ensureDrapedStatus=function(F){if(null==this._draped)return this._draped=F,!0;F!==this.draped&&y.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};t.test=function(){return{drivenProperties:this._drivenProperties,
getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}};b._createClass(C,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"pixelRatioChanged",get:function(){return c.__classPrivateFieldGet(this,
B,"f")},set:function(F){c.__classPrivateFieldSet(this,B,F,"f")}},{key:"skipHighSymbolLodsChanged",get:function(){return c.__classPrivateFieldGet(this,D,"f")},set:function(F){c.__classPrivateFieldSet(this,D,F,"f")}},{key:"draped",get:function(){return this._draped}}]);return C}(p.Loadable);var B=new WeakMap;var D=new WeakMap;const z={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},A={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=n;a.getAttributeValue=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.Recreate_Symbol=0]="Recreate_Symbol";b[b.Recreate_Graphics=1]="Recreate_Graphics";b[b.Fast_Update=2]="Fast_Update";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,c,w){let n=function(){function x(l){this.schedule=l;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}var m=x.prototype;m.destroy=function(){this.abortLoad()};m.load=function(l,g){if(this._loadStatus===a.LoadStatus.LOADED)return l&&l(),c.unwrapOr(this._loader,Promise.resolve());if(this._loadStatus===a.LoadStatus.FAILED)return g&&
g(this._loadError),c.unwrapOr(this._loader,Promise.resolve());c.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},f=>{this._loadError=f;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!w.isAbortError(f)&&this.logger&&f.message&&this.logger.warn(f.message);throw f;}));this._loader.then(l,g).catch(()=>{});return this._loader};m.abortLoad=function(){c.isSome(this._abortController)?
this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};b._createClass(x,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return x}();a.LoadStatus=void 0;(function(x){x[x.LOADING=0]="LOADING";x[x.LOADED=1]="LOADED";x[x.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(r){let q=0,y=0,B=0,D=!1,z=0;const v={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const A of r)c.isNone(A)||(q+=A.primitivesPerFeature,y+=A.primitivesPerCoordinate,B+=A.drawCallsPerFeature,v.bytesPerFeature+=A.memory.bytesPerFeature,v.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,v.bytesPerCoordinate+=A.memory.bytesPerCoordinate,v.resourceBytes+=
A.memory.resourceBytes,v.draped.bytesPerFeature+=A.memory.bytesPerFeature,v.draped.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,v.draped.bytesPerCoordinate+=A.memory.bytesPerCoordinate,D=D||A.estimated,++z);return{primitivesPerFeature:q,primitivesPerCoordinate:y,drawCallsPerFeature:B,estimated:D,memory:v,numComplexities:z}}function d(r,q){const y=e(r,q);var B=m.hasEdges(q)?2:0;switch(q.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:B,estimated:!1,
memory:y};case "fill":return"mesh-3d"===r.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:B,estimated:!1,memory:y}:c.isSome(q.outline)&&0<q.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:y}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:y};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:y};case "line":return{primitivesPerFeature:-2,
primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:y};case "object":return q.resource&&q.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:y}:{...k(q.resource&&q.resource.primitive||w.defaultPrimitive),memory:y};case "path":var D=r=0;switch(q.profile){case "circle":r=n.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS;break;case "quad":r=4;break;default:b.neverReached(q.profile);return}switch(q.join??"simple"){case "round":D=n.PATH_NUM_ROUND_JOIN_SUBDIVISIONS;
break;case "miter":case "bevel":D=1;break;default:return}B=2*r;D=r*D*2;let z=-2*D-B;switch(q.cap){case "none":break;case "butt":case "square":z+=2*(r-1);break;case "round":z+=2*(r*(n.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS-1)*2+r);break;default:return}return{primitivesPerFeature:z,primitivesPerCoordinate:D+B,drawCallsPerFeature:0,estimated:!1,memory:y};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:y}}}function e(r,q){r=
"point-3d"===r.type;switch(q.type){case "extrude":return q.edges&&0<q.edges.size?h.EXTRUDE_EDGES:h.EXTRUDE;case "fill":return c.isSome(q.outline)&&0<q.outline.size?h.FILL_OUTLINE:h.FILL;case "water":return h.FILL;case "line":return"round"===q.join?h.LINE_ROUND:h.LINE_MITER;case "path":switch(q.join){case "round":switch(q.profile){case "circle":return h.PATH_ROUND_CIRCLE;case "quad":return h.PATH_ROUND_QUAD;default:b.neverReached(q.profile);return}case "miter":case "bevel":switch(q.profile){case "circle":return h.PATH_MITER_CIRCLE;
case "quad":return h.PATH_MITER_QUAD;default:b.neverReached(q.profile);return}case "simple":return;default:return}case "object":return r?h.OBJECT_POINT:h.OBJECT_POLYGON;case "icon":case "text":return r?h.ICON_POINT:h.ICON_POLYGON}}function k(r){var q=p[r];if(q)return q;q=x.primitiveLodResources(r,null);q={primitivesPerFeature:g.geometriesFromLodLevelResources(q.levels[0]).reduce((y,B)=>y+B.indices.get(l.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};
return p[r]=q}const u={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},p={},h={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,
bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,
bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,
bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,
bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,
resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,
resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,
resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}};a.averageSymbolComplexities=function(r){r=f(r);0<r.numComplexities&&(r.primitivesPerFeature/=r.numComplexities,r.primitivesPerCoordinate/=r.numComplexities,r.drawCallsPerFeature/=r.numComplexities,r.memory.bytesPerFeature/=r.numComplexities,r.memory.bytesPerFeatureLabel/=r.numComplexities,r.memory.bytesPerCoordinate/=r.numComplexities,r.memory.resourceBytes/=r.numComplexities,
r.memory.draped.bytesPerFeature/=r.numComplexities,r.memory.draped.bytesPerFeatureLabel/=r.numComplexities,r.memory.draped.bytesPerCoordinate/=r.numComplexities);return r};a.defaultSymbolComplexity=function(r){if("web-style"===r.type)return u;const q=r.symbolLayers.toArray().map(y=>d(r,y));return f(q)};a.defaultSymbolLayerComplexity=d;a.defaultSymbolLayerMemoryComplexity=e;a.emptySymbolComplexity=u;a.memoryEstimators=h;a.totalSymbolComplexities=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],function(a){a.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.PATH_NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(a,
b,c,w){const n=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(x){switch(x){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(x,m){const l=(g,f,d=!1)=>({levels:g.map(e=>{const k=f(e.tesselation);d&&c.cgToGIS(k);return{components:[new w.LodComponentResources(k)],faceCount:k.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});
switch(x){case "sphere":return l([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],g=>c.createPolySphereGeometry(m,.5,g,!0));case "cube":return l([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(m,1));case "cone":return l(n,g=>c.createConeGeometry(m,1,.5,g,!1),!0);case "inverted-cone":return l(n,g=>c.createConeGeometry(m,1,.5,g,!0),
!0);case "cylinder":return l(n,g=>c.createCylinderGeometry(m,1,.5,g,[0,0,1],[0,0,.5]));case "tetrahedron":return l([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(m,1),!0);case "diamond":return l([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(m,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/arrayUtils","../../../../../core/maybe"],function(a,b,c,w){b=b._createClass(function(n,x=null){this.geometry=n;this.textures=x});a.LodComponentResources=b;a.geometriesFromLodLevelResources=function(n){n=n.components.map(x=>x.geometry);return c.unique(n)};a.geometriesFromLodResources=function(n){const x=[];n.levels.forEach(m=>{m.components.forEach(l=>{x.push(l.geometry)})});return c.unique(x)};a.materialsFromLodResources=function(n){const x=[];n.levels.forEach(m=>m.components.forEach(l=>
x.push(l.geometry.material)));return c.unique(x)};a.texturesFromLodResources=function(n){const x=[];n.levels.forEach(m=>{m.components.forEach(l=>{w.isSome(l.textures)&&x.push(...l.textures)})});return c.unique(x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,w,n,x,m,l){function g(k,u){if(w.isNone(k))return null;const p=w.isSome(k.color)?x.fromArray(b.toUnitRGBA(k.color)):x.fromValues(0,0,0,0),h=n.pt2px(k.size),r=n.pt2px(k.extensionLength);switch(k.type){case "solid":return f({color:p,size:h,extensionLength:r,...u});case "sketch":return{...e,color:p,size:h,extensionLength:r,...u,type:"sketch"}}}function f(k){return{...d,...k,type:"solid"}}const d={color:x.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:l.Transparency.OPAQUE,
hasSlicePlane:!1},e={color:x.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:l.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(k,u){return g(k&&k.enabled&&k.edges||null,u)};a.createMaterialFromEdges=g;a.createSolidEdgeMaterial=f;a.hasEdges=function(k){return k&&k.enabled&&(m.isExtrudeSymbol3DLayer(k)||m.isFillSymbol3DLayer(k))&&w.isSome(k.edges)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,c,w,n,x,m,l,g,f){const d=c.create();a.createStageObject=function(e,k,u,p,h,r){var q=e.clippingExtent;w.projectPointToVector(k,d,e.elevationProvider.spatialReference);if(b.isSome(q)&&!n.containsPoint(q,d))return null;w.projectPointToVector(k,d,e.renderCoordsHelper.spatialReference);q=e.localOriginFactory.getOrigin(d);h=new f.Object3D({castShadow:!1,metadata:{layerUid:e.layer.uid,graphicUid:h,usesVerticalDistanceToGround:!0}});u.shaderTransformer=r;u.localOrigin=q;h.addGeometry(u);e=l.applyElevationAlignmentForHUD(h,
k,e.elevationProvider,e.renderCoordsHelper,p);return{object:h,sampledElevation:e}};a.extendPointGraphicElevationContext=function(e,k,u){e=e.elevationContext;u=u.spatialReference;w.projectPointToVector(k,d,u);e.centerPointInElevationSR=m.makeDehydratedPoint(d[0],d[1],k.hasZ?d[2]:0,b.isSome(u)?u:null)};a.placePointOnGeometry=function(e){switch(e.type){case "point":return e;case "polygon":case "extent":return g.computeCentroid(e);case "polyline":var k=e.paths[0];if(!k||0===k.length)break;k=x.getPointOnPath(k,
x.getPathLength(k)/2);return m.makeDehydratedPoint(k[0],k[1],k[2],e.spatialReference);case "mesh":return e.origin}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){function h(z,v,A){var t=z.bbMin;z=z.bbMax;if(w.hasIdentityRotation(A))for(A=x.set(y,A[12],A[13],A[14]),x.add(B,t,A),x.add(D,z,A),t=0;3>t;++t)v.min[t]=Math.min(v.min[t],B[t]),v.max[t]=Math.max(v.max[t],D[t]);else if(x.transformMat4(B,t,A),x.exactEquals(t,z))for(t=0;3>t;++t)v.min[t]=Math.min(v.min[t],B[t]),v.max[t]=Math.max(v.max[t],B[t]);else{x.transformMat4(D,z,A);for(var C=0;3>C;++C)v.min[C]=Math.min(v.min[C],B[C],D[C]),v.max[C]=Math.max(v.max[C],B[C],D[C]);
for(C=0;3>C;++C){x.copy(B,t);x.copy(D,z);B[C]=z[C];D[C]=t[C];x.transformMat4(B,B,A);x.transformMat4(D,D,A);for(let E=0;3>E;++E)v.min[E]=Math.min(v.min[E],B[E],D[E]),v.max[E]=Math.max(v.max[E],B[E],D[E])}}}d=function(z){function v(t={}){var C=A.call(this);C.type=e.ContentObjectType.Object;C._geometries=[];C._transformation=n.create();C._bvObjectSpace=new q;C._bvWorldSpace=new q;C._bvDirty=!0;C._hasVolatileTransformation=!1;C._visible=!0;C.castShadow=null!=t.castShadow?t.castShadow:!0;C.metadata=t.metadata;
C.metadata&&C.metadata.isElevationSource&&(C.metadata.lastValidElevationBB=new r);t=t.geometries;c.isSome(t)&&(C._geometries=Array.from(t));return C}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.dispose=function(){this._geometries.length=0};z.addGeometry=function(t){t.visible=this._visible;this._geometries.push(t);this._hasVolatileTransformation=this._hasVolatileTransformation||t.hasVolatileTransformation;this._emit("objectGeometryAdded",{object:this,geometry:t});this._invalidateBoundingVolume()};
z.removeGeometry=function(t){if(t=this._geometries.splice(t,1)[0])this._emit("objectGeometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume()};z.removeAllGeometries=function(){for(;0<this._geometries.length;)this.removeGeometry(0)};z.geometryVertexAttrsUpdated=function(t){this._emit("objectGeometryUpdated",{object:this,geometry:t});this._invalidateBoundingVolume()};z.maskOccludee=function(){const t=new k.Object3DStateID(f.Object3DState.MaskOccludee);for(const C of this._geometries)C.occludees=
p.addObject3DStateID(C.occludees,t);this._emit("occlusionChanged",this);return t};z.removeOcclude=function(t){for(const C of this._geometries)C.occludees=p.removeObject3DStateID(C.occludees,t);this._emit("occlusionChanged",this)};z.highlight=function(){const t=new k.Object3DStateID(f.Object3DState.Highlight);for(const C of this._geometries)C.highlights=p.addObject3DStateID(C.highlights,t);this._emit("highlightChanged",this);return t};z.removeHighlight=function(t){for(const C of this._geometries)C.highlights=
p.removeObject3DStateID(C.highlights,t);this._emit("highlightChanged",this)};z.getCombinedStaticTransformation=function(t,C){return w.multiply(C,this.transformation,t.transformation)};z._getCombinedShaderTransformation=function(t){return w.multiply(n.create(),this.transformation,t.shaderTransformation)};z.hasVolativeTransformation=function(){return this._hasVolatileTransformation};z._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();
for(var t of this._geometries){var C=t.boundingInfo;c.isSome(C)&&(h(C,this._bvObjectSpace,t.shaderTransformation),h(C,this._bvWorldSpace,this._getCombinedShaderTransformation(t)))}x.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);x.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);t=m.create();C=m.create();var E=g.maxScale(this.transformation);for(const I of this._geometries){var F=I.boundingInfo;if(!c.isNone(F)){var H=I.shaderTransformation,
K=g.maxScale(H);x.transformMat4(t,F.center,H);H=x.distance(t,this._bvObjectSpace.bounds);F=F.radius*K;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],H+F);x.transformMat4(C,t,this.transformation);K=x.distance(C,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],K+F*E)}}this._bvDirty=!1}};z._invalidateBoundingVolume=function(){this._bvDirty=!0;c.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};
z._emit=function(t,C){c.isSome(this._parentLayer)&&this._parentLayer.events.emit(t,C)};b._createClass(v,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._transformation},set:function(t){w.copy(this._transformation,t);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(t){u.assert(null==this._parentLayer||null==t,"Object3D can only be added to a single Layer");
this._parentLayer=t}},{key:"visible",get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(const C of this._geometries)C.visible=this._visible;this._emit("visibilityChanged",this)}}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const t=this;return{hasGeometry:C=>t._geometries.includes(C),
getGeometryIndex:C=>t._geometries.indexOf(C)}}}]);return v}(d.ContentObject);let r=function(){function z(){this.min=m.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=m.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}z.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return b._createClass(z)}(),q=function(z){function v(){var t=A.apply(this,arguments);t.bounds=l.create();return t}b._inherits(v,z);
var A=b._createSuper(v);v.prototype.init=function(){x.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);x.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);l.clear(this.bounds)};return b._createClass(v)}(r);const y=m.create(),B=m.create(),D=m.create();a.Object3D=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f32 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){let h=function(z){function v(t){t=A.call(this,t,new q);t._configuration=new p.LineCalloutTechniqueConfiguration;t._uniqueMaterialIdentifier=v.uniqueMaterialIdentifier(t.parameters);return t}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.getPassParameters=function(){return this.parameters};z.getConfiguration=function(t,C){t=C?.slot!==d.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=
c.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=c.isSome(this.parameters.screenSizePerspective);this._configuration.depthHudEnabled=t;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?l.HUDSpace.Screen:l.HUDSpace.World;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasMultipassGeometry=C.multipassGeometry.enabled;
return this._configuration};z.intersect=function(){};z.requiresSlot=function(t,C){if(C===m.ShaderOutput.Color)switch(t){case d.RenderSlot.LINE_CALLOUTS:case d.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};z.createGLMaterial=function(t){return new r(t)};z.createBufferWriter=function(){return new D};z.validateParameters=function(t){t=v.uniqueMaterialIdentifier(t);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)};v.uniqueMaterialIdentifier=function(t){return JSON.stringify({screenOffset:t.screenOffset||
[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})};b._createClass(v,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return v}(f.Material),r=function(z){function v(){return A.apply(this,arguments)}b._inherits(v,z);var A=b._createSuper(v);v.prototype.beginSlot=function(t){return this.ensureTechnique(u.LineCalloutTechnique,t)};return b._createClass(v)}(g),q=function(z){function v(){var t=A.apply(this,arguments);t.screenOffset=n.ZEROS;t.color=[0,0,0,1];t.size=
1;t.occlusionTest=!1;t.shaderPolygonOffset=1E-5;t.depthHUDAlignStart=!1;t.centerOffsetUnits="world";t.hasSlicePlane=!1;return t}b._inherits(v,z);var A=b._createSuper(v);return b._createClass(v)}(f.MaterialParameters);const y=x.newLayout().vec3f(e.VertexAttribute.POSITION).vec3f(e.VertexAttribute.NORMAL).vec2f(e.VertexAttribute.UV0).vec4f(e.VertexAttribute.AUXPOS1),B=[w.fromValues(0,0),w.fromValues(1,0),w.fromValues(0,1),w.fromValues(1,0),w.fromValues(1,1),w.fromValues(0,1)];let D=function(){function z(){this.vertexBufferLayout=
y}var v=z.prototype;v.allocate=function(A){return this.vertexBufferLayout.createBuffer(A)};v.elementCount=function(A){return 6*A.indices.get(e.VertexAttribute.POSITION).length};v.write=function(A,t,C,E,F){k.writePosition(C.indices.get(e.VertexAttribute.POSITION),C.vertexAttributes.get(e.VertexAttribute.POSITION).data,A,E.position,F,6);k.writeNormal(C.indices.get(e.VertexAttribute.NORMAL),C.vertexAttributes.get(e.VertexAttribute.NORMAL).data,t,E.normal,F,6);k.writeBufferVec4(C.indices.get(e.VertexAttribute.AUXPOS1),
C.vertexAttributes.get(e.VertexAttribute.AUXPOS1).data,E.auxpos1,F,6);for(A=0;A<B.length;++A)E.uv0.setVec(F+A,B[A])};return b._createClass(z)}();a.LineCalloutMaterial=h;a.Parameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(p){const h=new Float32Array(2);h[0]=p[0];h[1]=p[1];return h}function w(p,h){const r=new Float32Array(2);r[0]=p;r[1]=h;return r}function n(p,
h){return new Float32Array(p,h,2)}function x(){return b()}function m(){return w(1,1)}function l(){return w(1,0)}function g(){return w(0,1)}const f=b(),d=m(),e=l(),k=g(),u=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:e,UNIT_Y:k,ZEROS:f,clone:c,create:b,createView:n,fromValues:w,ones:m,unitX:l,unitY:g,zeros:x},Symbol.toStringTag,{value:"Module"}));a.ONES=d;a.UNIT_X=e;a.UNIT_Y=k;a.ZEROS=f;a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.ones=m;a.unitX=l;a.unitY=g;a.vec2f32=u;
a.zeros=x})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){x=function(e){function k(){return u.apply(this,arguments)}c._inherits(k,
e);var u=c._createSuper(k);e=k.prototype;e.initializeConfiguration=function(p,h){h.spherical=p.viewingMode===w.ViewingMode.Global};e.initializeProgram=function(p){return new l.Program(p.rctx,k.shader.get().build(this.configuration),m.Default3D)};e.setPipelineState=function(p){p=p?f.CompareFunction.ALWAYS:f.CompareFunction.LESS;return this.configuration.depthHudEnabled?d.makePipelineState({depthTest:{func:p},depthWrite:d.defaultDepthWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.ONE,
f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:p},colorWrite:d.defaultColorWriteParams})};e.initializePipeline=function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)};return c._createClass(k)}(x.ShaderTechnique);x.shader=new n.ReloadableShaderModule(g.LineCallout,()=>new Promise((e,k)=>a(["./LineCallout.glsl"],e,k)));b.LineCalloutTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(B){const D=new p.ShaderBuilder;D.include(m.AlignPixel);D.include(l.HUD,B);D.include(x.SliceDraw,B);D.attributes.add(h.VertexAttribute.UV0,"vec2");const {vertex:z,fragment:v}=D;z.uniforms.add([new e.Float4PassUniform("viewport",(A,t)=>t.camera.fullViewport),new k.FloatPassUniform("lineSize",(A,t)=>Math.ceil(A.size)*t.camera.pixelRatio),new d.Float2PassUniform("pixelToNDC",(A,t)=>c.set(y,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])),new k.FloatPassUniform("borderSize",
(A,t)=>b.isSome(A.borderColor)?t.camera.pixelRatio:0),new d.Float2PassUniform("screenOffset",(A,t)=>c.set(y,A.screenOffset[0]*t.camera.pixelRatio,A.screenOffset[1]*t.camera.pixelRatio))]);D.varyings.add("coverageSampling","vec4");D.varyings.add("lineSizes","vec2");B.hasMultipassGeometry&&D.varyings.add("depth","float");B.hasScreenSizePerspective&&f.addScreenSizePerspectiveAlignment(z);z.code.add(u.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${B.occlusionTestEnabled?u.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${B.hasScreenSizePerspective?u.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:u.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${B.hasMultipassGeometry?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${B.depthHudEnabled?B.depthHudAlignStartEnabled?u.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:u.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${B.hasScreenSizePerspective?u.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:u.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);v.uniforms.add([new e.Float4PassUniform("uColor",A=>q(A.color)),new e.Float4PassUniform("borderColor",A=>q(A.borderColor))]);B.hasMultipassGeometry&&(v.include(g.multipassGeometryTest,B),v.uniforms.add(new d.Float2PassUniform("inverseViewport",(A,t)=>t.inverseViewport)));v.code.add(u.glsl`
    void main() {
      ${B.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${B.depthHudEnabled?u.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:u.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return D}function q(B){return b.isSome(B)?B:n.ZEROS}const y=w.create();w=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.LineCallout=w;a.build=r})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x){x=function(m){function l(){var f=g.apply(this,arguments);f.screenCenterOffsetUnitsEnabled=w.HUDSpace.World;f.spherical=!1;f.occlusionTestEnabled=!0;f.hasVerticalOffset=!1;f.hasScreenSizePerspective=!1;f.depthHudEnabled=!1;f.depthHudAlignStartEnabled=!1;f.hasSlicePlane=!1;f.hasMultipassGeometry=!1;return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(x.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:w.HUDSpace.COUNT})],x.prototype,"screenCenterOffsetUnitsEnabled",
void 0);c.__decorate([n.parameter()],x.prototype,"spherical",void 0);c.__decorate([n.parameter()],x.prototype,"occlusionTestEnabled",void 0);c.__decorate([n.parameter()],x.prototype,"hasVerticalOffset",void 0);c.__decorate([n.parameter()],x.prototype,"hasScreenSizePerspective",void 0);c.__decorate([n.parameter()],x.prototype,"depthHudEnabled",void 0);c.__decorate([n.parameter()],x.prototype,"depthHudAlignStartEnabled",void 0);c.__decorate([n.parameter()],x.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],
x.prototype,"hasMultipassGeometry",void 0);c.__decorate([n.parameter({constValue:!0})],x.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"isDraped",void 0);a.LineCalloutTechniqueConfiguration=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(w){return w instanceof
c?w.graphics3DSymbol:w instanceof b?w:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),function(a,b,c,w,n,x,m,l,g,f){const d={renderPriority:0,renderPriorityStep:1,
ignoreDrivers:!1};return function(e){function k(p,h,r){var q=u.call(this,h.schedule);q._symbol=p;q._context=h;q._backgroundLayers=r;q._destroyed=!1;q.symbolLayers=[];q.referenced=0;q._extentPadding=0;return q}a._inherits(k,e);var u=a._createSuper(k);e=k.prototype;e.doLoad=async function(p){let h=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(h=this._backgroundLayers.concat(h));const r=h.length;for(;this.symbolLayers.length<h.length;)this.symbolLayers.push(null);this.symbolLayers.length=
h.length;const q=[];for(let B=0;B<r;B++){var y=h.getItemAt(B);if(!1===y.enabled)continue;d.renderPriority=1-(1+B)/r;d.renderPriorityStep=1/r;d.ignoreDrivers=y._ignoreDrivers;const D=m.make(this.symbol,y,this._context,d);(y=w.onAbortOrThrow(p,()=>{this.symbolLayers[B]=null;D.destroy()}))&&q.push(y);this.symbolLayers[B]=D}await b.forEach(this.symbolLayers,async(B,D)=>{if(c.isSome(B))try{await B.load(),this._extentPadding+=Math.max(this._extentPadding,B.extentPadding)}catch{this.symbolLayers[D]=null}});
q.forEach(B=>B.remove());w.throwIfAborted(p);if(this.symbolLayers.length&&!this.symbolLayers.some(B=>!!B))throw Error();};e.getSymbolLayerSize=function(p){p=this.symbolLayers[p];return c.isSome(p)?p.getCachedSize():null};e.createGraphics3DGraphic=function(p,h){const r=p.graphic,q=Array(this.symbolLayers.length);for(let y=0;y<this.symbolLayers.length;y++){const B=this.symbolLayers[y];q[y]=c.isSome(B)?B.createGraphics3DGraphic(p):null}return new n(r,h||this,q,p.layer,this._context.arcade||this._context.featureExpressionInfoContext&&
this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};e.globalPropertyChanged=function(p,h){const r=this.symbolLayers.length;for(let q=0;q<r;q++){const y=this.symbolLayers[q],B=D=>{D=D.layers[q];return D instanceof x.Graphics3DObject3DGraphicLayer?D:null};if(c.isSome(y)&&!y.globalPropertyChanged(p,h,B))return!1}return!0};e.applyRendererDiff=function(p,h){return this.loadStatus!==g.LoadStatus.LOADED?l.ApplyRendererDiffResult.Recreate_Symbol:
this.symbolLayers.reduce((r,q)=>r!==l.ApplyRendererDiffResult.Recreate_Symbol&&c.isSome(q)?Math.min(r,q.applyRendererDiff(p,h)):r,l.ApplyRendererDiffResult.Fast_Update)};e.prepareSymbolPatch=function(p){if(this.loadStatus!==g.LoadStatus.FAILED&&"partial"===p.diff.type){var h=p.diff.diff;if(h.symbolLayers&&"partial"===h.symbolLayers.type){var r=h.symbolLayers.diff;this.symbolLayers.forEach((q,y)=>{if(!c.isNone(q)){var B=r[y];if(B){const D={diff:B,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};
q.prepareSymbolLayerPatch(D);p.symbolStatePatches.push(...D.symbolLayerStatePatches);D.graphics3DGraphicPatches.length&&p.graphics3DGraphicPatches.push((z,v)=>{const A=z.layers[y];c.isSome(A)&&D.graphics3DGraphicPatches.forEach(t=>t(A,v))})}}})}}};e.updateGeometry=function(p,h){for(let r=0;r<this.symbolLayers.length;r++){const q=this.symbolLayers[r];if(c.isNone(q))continue;const y=p.layers[r];if(c.isNone(y)||!q.updateGeometry(y,h))return!1}return!0};e.onRemoveGraphic=function(p){for(let h=0;h<this.symbolLayers.length;h++){const r=
this.symbolLayers[h];if(c.isNone(r))continue;const q=p.layers[h];if(c.isSome(q))r.onRemoveGraphic(q)}};e.getFastUpdateStatus=function(){let p=0,h=0,r=0;this.symbolLayers.forEach(q=>{c.isNone(q)||(q.loadStatus===g.LoadStatus.LOADING?p++:q.isFastUpdatesEnabled()?r++:h++)});return{loading:p,slow:h,fast:r}};e.queryForSnapping=async function(p,h,r,q){var y=this.symbolLayers.filter(c.isSome).filter(B=>c.isSome(B.queryForSnapping)).map(B=>B.queryForSnapping(p,h,r,q));y=await Promise.all(y);w.throwIfAborted(q);
return y.flat()};e.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{a._get(a._getPrototypeOf(k.prototype),"destroy",this).call(this);for(const p of this.symbolLayers)c.isSome(p)&&p.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(k,[{key:"symbol",get:function(){return this._symbol},set:function(p){this._symbol=p;p.symbolLayers.forEach((h,r)=>{r=this.symbolLayers[r];c.isSome(r)&&(r.symbol=p,r.symbolLayer=h)})}},
{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some(p=>c.isSome(p)&&p.queryForSnapping)}},{key:"complexity",get:function(){return f.totalSymbolComplexities(this.symbolLayers.map(p=>c.isSome(p)?p.complexity:null))}},{key:"destroyed",get:function(){return this._destroyed}}]);return k}(g.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){const y=new n(Array,D=>e.set(D,e.ZERO),null,10,5),B=k.create();return function(){function D(v,A,t,C,E){this.graphic=v;this.graphics3DSymbol=A;this.layers=t;this._labelLayers=[];this._auxiliaryLayers=[];var F=r.VisibilityFlag._COUNT;const H=Array(r.VisibilityGroup._COUNT);for(let K=0;K<H.length;K++)H[K]=Array(F);this._visibilityFlags=H;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=
!1;++A.referenced;this._featureExpressionFeature=E?q.createFeature(E,v,C):null;for(const K of t)w.isSome(K)&&(this.isElevationSource=this.isElevationSource||K.isElevationSource)}var z=D.prototype;z.initialize=function(v,A){this._layer=A;this._stage=v;this._forEachSymbolLayerGraphic(t=>{t.initialize(v,A);t.setVisibility(this.isVisible())})};z.destroy=function(){this._forEachSymbolLayerGraphic(v=>v.destroy());this._auxiliaryLayers=this.layers=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=
null};z.clearLabelGraphics=function(){this._forEachLabelGraphic(v=>v.destroy());this._labelLayers.length=0};z.addLabelGraphic=function(v,A,t){this._labelLayers.push(v);v.initialize(A,t);v.setVisibility(this.isVisible(r.VisibilityGroup.LABEL))};z.addAuxiliaryGraphic=function(v){this._auxiliaryLayers.push(v);this._layer&&(v.initialize(this._stage,this._layer),v.setVisibility(this.isVisible()))};z.isVisible=function(v=r.VisibilityGroup.GRAPHIC,A){for(let t=0;t<=v;t++){const C=this._visibilityFlags[t];
for(let E=0;E<C.length;++E)if(!1===C[E]&&E!==A)return!1}return!0};z.hasVisibilityFlag=function(v,A){return null!=this._visibilityFlags[A][v]};z.setVisibilityFlag=function(v,A,t){const C=this.isVisible(t);this._visibilityFlags[t][v]=A;const E=this.isVisible(t);if(C===E)return!1;if(t===r.VisibilityGroup.LABEL)this._forEachLabelGraphic(F=>F.setVisibility(E));else{this._forEachSymbolLayerGraphic(H=>H.setVisibility(E));const F=this.isVisible(r.VisibilityGroup.LABEL);this._forEachLabelGraphic(H=>H.setVisibility(F))}return!0};
z.clearVisibilityFlag=function(v,A=r.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(v,void 0,A)};z.computeExtent=function(v){if(!this._extent){var A=this.graphic.geometry;if(w.isNone(A))return!1;this._extent=k.create();p.computeAABR(A,this._extent);A=A.spatialReference;if(!u.equals(A,v)&&!d.projectBoundingRect(this._extent,A,this._extent,v))return this._extent=null,!1}return!0};z.getAsOptimizedGeometry=function(v,A){if(w.isSome(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===
v&&this._optimizedGeometry.hasM===A)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,v,A);this._optimizedGeometry.hasZ=v;this._optimizedGeometry.hasM=A;return this._optimizedGeometry.geometry};z._convertGraphicToOptimizedGeometry=function(v,A,t){v=v.geometry;if("mesh"===v.type||"extent"===v.type)v=f.fromExtent("mesh"===v.type?v.extent:v);return h.convertFromGeometry(v,A,t)};z.computeAttachmentOrigin=function(){const v={render:{origin:g.create(),
num:0},draped:{origin:m.create(),num:0}};for(const A of this.layers)w.isNone(A)||A.computeAttachmentOrigin(v);1<v.render.num&&l.scale(v.render.origin,v.render.origin,1/v.render.num);1<v.draped.num&&x.scale(v.draped.origin,v.draped.origin,1/v.draped.num);return v};z.getProjectedBoundingBox=async function(v,A,t,C,E){E||(E={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});E.boundingBox?e.empty(E.boundingBox):E.boundingBox=e.empty();E.requiresDrapedElevation=!1;await b.forEach(this.layers,
async F=>{if(!w.isNone(F)){var H="draped"===F.type?A:v,K=y.acquire();F=await F.getProjectedBoundingBox(H,t,E.screenSpaceObjects,C,K);isFinite(F[2])&&isFinite(F[5])||(E.requiresDrapedElevation=!0);F&&e.expandWithAABB(E.boundingBox,K);y.release(K)}});return e.allFinite(E.boundingBox)||k.allFinite(e.toRect(E.boundingBox,B))?E:null};z.needsElevationUpdates=function(){for(const v of this.layers)if(w.isSome(v)&&("object3d"===v.type||"lod-instance"===v.type)&&v.needsElevationUpdates)return!0;for(const v of this._labelLayers)if(v&&
v.needsElevationUpdates)return!0;return!1};z.alignWithElevation=function(v,A,t){this._forEachRenderedGraphic(C=>{"object3d"!==C.type&&"lod-instance"!==C.type||C.alignWithElevation(v,A,this._featureExpressionFeature,t)})};z.alignWithAbsoluteElevation=function(v,A,t){this._forEachRenderedGraphic(C=>{"object3d"===C.type&&C.alignWithAbsoluteElevation(v,A,t)})};z.addObjectStateSet=function(v,A){this._forEachSymbolLayerGraphic(t=>t.addObjectState(v,A))};z.removeObjectState=function(v){this._forEachSymbolLayerGraphic(A=>
A.removeObjectState(v))};z._forEachGraphicList=function(v,A){v.forEach(t=>t&&A(t))};z._forEachSymbolLayerGraphic=function(v){this._forEachGraphicList(this.layers,v);this._forEachGraphicList(this._auxiliaryLayers,v)};z._forEachLabelGraphic=function(v){this._forEachGraphicList(this._labelLayers,v)};z._forEachRenderedGraphic=function(v){this._forEachSymbolLayerGraphic(v);this._forEachLabelGraphic(v)};a._createClass(D,[{key:"labelLayers",get:function(){return this._labelLayers}},{key:"extent",get:function(){return this._extent}},
{key:"destroyed",get:function(){return null==this.layers}},{key:"isDraped",get:function(){let v=!1;this._forEachSymbolLayerGraphic(A=>{"draped"===A.type&&(v=!0)});return v}},{key:"usedMemory",get:function(){let v=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(A=>{const t=A.graphics3DSymbolLayer.complexity;w.isNone(t)||(A="draped"===A.type?t.memory.draped:t.memory,v+=A.bytesPerFeature,A.bytesPerCoordinate&&(v+=p.numVertices(this.graphic.geometry)*A.bytesPerCoordinate))});
return v}}]);return D}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){const e={icon:w.Graphics3DIconSymbolLayer,object:m.Graphics3DObjectSymbolLayer,
line:n.Graphics3DLineSymbolLayer,path:l.Graphics3DPathSymbolLayer,fill:g.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:f.Graphics3DTextSymbolLayer,water:d.Graphics3DWaterSymbolLayer},k={"mesh-3d":{fill:x.Graphics3DMeshFillSymbolLayer}};a.make=function(u,p,h,r){const q=k[u.type]&&k[u.type][p.type]||e[p.type];return q?new q(u,p,h,r):(b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${p.type}`),
null)};a.setSymbolClass=function(u,p){e[u]=p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/Indices ../../../../chunks/vec32 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S){function Q(qa,wa,xa,pa,ra,va){const Ba=q.getZeroIndexArray(wa.length);ra=[[N.VertexAttribute.POSITION,new O.Attribute(pa.positions,3,!0)],[N.VertexAttribute.NORMAL,new O.Attribute(pa.normals,3,!0)],[N.VertexAttribute.COLOR,new O.Attribute(ra,4,!0)],[N.VertexAttribute.SIZE,new O.Attribute(pa.heights,1,!0)]];return new G.Geometry(qa,ra,[[N.VertexAttribute.POSITION,wa],[N.VertexAttribute.NORMAL,wa],[N.VertexAttribute.COLOR,
Ba]],pa.elevation,M.ContentObjectType.Mesh,va,xa)}function W(qa,wa,xa,pa,ra,va,Ba,Aa,Ha,Ka,Pa,Ra,Sa){let La=0;var Ua=2*pa.count,Za=pa.index,Xa=pa.count,la=xa.length/3,Ta=Ua;k.copy(da,Ra);const Ma=0<Pa?1:-1;Ua=3*Za;let fb=0;Za=3*fb;let ya=Xa;Ra=3*ya;for(let oa=0;oa<Xa;++oa)Sa&&(da[0]=qa[Ua],da[1]=qa[Ua+1],da[2]=qa[Ua+2],k.normalize(da,da)),ra[Za]=qa[Ua],ra[Za+1]=qa[Ua+1],ra[Za+2]=qa[Ua+2],va[Za]=wa[Ua],va[Za+1]=wa[Ua+1],va[Za+2]=wa[Ua+2],Ba[Za]=-Ma*da[0],Ba[Za+1]=-Ma*da[1],Ba[Za+2]=-Ma*da[2],Aa[fb]=
0,ra[Ra]=qa[Ua]+Pa*da[0],ra[Ra+1]=qa[Ua+1]+Pa*da[1],ra[Ra+2]=qa[Ua+2]+Pa*da[2],va[Ra]=wa[Ua],va[Ra+1]=wa[Ua+1],va[Ra+2]=wa[Ua+2],Ba[Ra]=Ma*da[0],Ba[Ra+1]=Ma*da[1],Ba[Ra+2]=Ma*da[2],Aa[ya]=Pa,Za+=3,Ra+=3,Ua+=3,fb+=1,ya+=1;Za=Ua=0;Ra=3*Ta;qa=0>Pa?fa:ca;wa=0>Pa?ca:fa;for(Sa=0;Sa<la;++Sa)Ka[Za]=xa[Ua+qa[0]],Ka[Za+1]=xa[Ua+qa[1]],Ka[Za+2]=xa[Ua+qa[2]],Ha[Ra]=xa[Ua+wa[0]]+Xa,Ha[Ra+1]=xa[Ua+wa[1]]+Xa,Ha[Ra+2]=xa[Ua+wa[2]]+Xa,Za+=3,Ra+=3,Ua+=3;xa=2*pa.count;Ua=0;T(ra,va,Aa,Ba,La,pa.pathLengths[0],pa.count,
xa,Ha,Ua,Pa);xa+=4*pa.pathLengths[0];Ua+=2*pa.pathLengths[0];La+=pa.pathLengths[0];for(Ka=1;Ka<pa.pathLengths.length;++Ka)T(ra,va,Aa,Ba,La,pa.pathLengths[Ka],pa.count,xa,Ha,Ua,Pa),xa+=4*pa.pathLengths[Ka],Ua+=2*pa.pathLengths[Ka],La+=pa.pathLengths[Ka]}function V(qa,wa,xa,pa,ra,va,Ba){pa[va]=pa[Ba];Ba*=3;va*=3;qa[va]=qa[Ba];qa[va+1]=qa[Ba+1];qa[va+2]=qa[Ba+2];wa[va]=wa[Ba];wa[va+1]=wa[Ba+1];wa[va+2]=wa[Ba+2];xa[va]=ra[0];xa[va+1]=ra[1];xa[va+2]=ra[2]}function T(qa,wa,xa,pa,ra,va,Ba,Aa,Ha,Ka,Pa){let Ra=
ra,Sa=ra+1,La=ra+Ba,Ua=ra+Ba+1,Za=Aa,Xa=Aa+1,la=Aa+2*va;Aa=Aa+2*va+1;0>Pa&&(Ra=ra+Ba+1,Ua=ra);Ka*=3;for(let ua=0;ua<va;++ua){ua===va-1&&(0<Pa?(Sa=ra,Ua=ra+Ba):(Sa=ra,Ra=ra+Ba));var Ta=qa,Ma=Ra,fb=Sa,ya=La,oa=Y;Ma*=3;fb*=3;ya*=3;k.set(aa,Ta[Ma++],Ta[Ma++],Ta[Ma++]);k.set(ia,Ta[fb++],Ta[fb++],Ta[fb++]);k.set(na,Ta[ya++],Ta[ya++],Ta[ya++]);k.subtract(ba,ia,aa);k.subtract(ea,na,aa);k.cross(oa,ea,ba);k.normalize(oa,oa);V(qa,wa,pa,xa,Y,Za,Ra);V(qa,wa,pa,xa,Y,Xa,Sa);V(qa,wa,pa,xa,Y,la,La);V(qa,wa,pa,xa,
Y,Aa,Ua);Ha[Ka++]=Za;Ha[Ka++]=la;Ha[Ka++]=Aa;Ha[Ka++]=Za;Ha[Ka++]=Aa;Ha[Ka++]=Xa;Ra++;Sa++;La++;Ua++;Za+=2;Xa+=2;la+=2;Aa+=2}}function X(qa,wa,xa,pa,ra){qa=qa.stageObject;const va=qa.geometries,Ba=va.length;wa="absolute-height"!==wa.mode;let Aa=0;const Ha=qa.transformation,Ka=d.invertOrIdentity(e.create(),Ha);for(let Pa=0;Pa<Ba;Pa+=2){const Ra=va[Pa];if(!P.isGeometryWithMapPositions(Ra))continue;const Sa=Ra.getMutableAttribute(N.VertexAttribute.POSITION).data,La=Ra.vertexAttributes.get(N.VertexAttribute.SIZE).data,
Ua=new L.SamplePosition(Ra.mapPositions),Za=Sa.length/3;let Xa=0,la=!1,Ta=0;for(let Ma=0;Ma<Za;Ma++){ja[0]=Sa[Xa];ja[1]=Sa[Xa+1];ja[2]=Sa[Xa+2];pa(Ua,ha);wa&&(Ta+=ha.sampledElevation);I.TESTS_DISABLE_OPTIMIZATIONS?(k.set(ka,Ua.array[Ua.offset],Ua.array[Ua.offset+1],ha.z+La[Xa/3]),x.isSome(xa)&&ra.toRenderCoords(ka,xa,ka)):(k.set(ka,Sa[Xa],Sa[Xa+1],Sa[Xa+2]),k.transformMat4(ka,ka,Ha),ra.setAltitude(ka,ha.z+La[Xa/3]));k.transformMat4(ka,ka,Ka);Sa[Xa]=ka[0];Sa[Xa+1]=ka[1];Sa[Xa+2]=ka[2];const fb=.01/
ra.unitInMeters;if(Math.abs(ja[0]-Sa[Xa])>=fb||Math.abs(ja[1]-Sa[Xa+1])>=fb||Math.abs(ja[2]-Sa[Xa+2])>=fb)la=!0;Ua.offset+=3;Xa+=3}la&&(Ra.invalidateBoundingInfo(),qa.geometryVertexAttrsUpdated(va[Pa]),va[Pa+1].invalidateBoundingInfo(),qa.geometryVertexAttrsUpdated(va[Pa+1]));Aa+=Ta/Za}return Aa/Ba}const Z=["polygon","extent"];c=function(qa){function wa(pa,ra,va,Ba){pa=xa.call(this,pa,ra,va,Ba);pa.ensureDrapedStatus(!1);return pa}b._inherits(wa,qa);var xa=b._createSuper(wa);qa=wa.prototype;qa.doLoad=
async function(){if(!this._drivenProperties.size){var pa=E.validateSymbolLayerSize(this._getSymbolSize());if(pa)throw new w("graphics3dextrudesymbollayer:invalid-size",pa);}pa=x.get(this.symbolLayer,"material","color");var ra=this._getCombinedOpacityAndColor(pa);pa=u.fromArray(ra);ra=ra[3];const va=1>ra||this.needsDrivenTransparentPass;pa={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:pa,ambient:pa,opacity:ra,transparent:va,cullFace:va?J.CullFaceOptions.None:J.CullFaceOptions.Back,
hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new S.DefaultMaterial(pa);this._bottomMaterial=new S.DefaultMaterial({...pa,cullFace:J.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)};qa.destroy=function(){b._get(b._getPrototypeOf(wa.prototype),"destroy",this).call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};
qa.createGraphics3DGraphic=function(pa){const ra=pa.graphic;if(!this._validateGeometry(ra.geometry,Z,this.symbolLayer.type))return null;const va=this._getVertexOpacityAndColor(pa.renderingInfo,255),Ba=this.setGraphicElevationContext(ra,new A.ElevationContext);return this._createAs3DShape(ra,pa.renderingInfo,va,Ba,ra.uid)};qa.layerOpacityChanged=function(pa,ra){var va=x.get(this.symbolLayer,"material","color");va=this._getCombinedOpacity(va);const Ba=1>va||this.needsDrivenTransparentPass;this._material.setParameters({opacity:va,
transparent:Ba});this._bottomMaterial.setParameters({opacity:va,transparent:Ba});const Aa=this._getLayerOpacity();pa.forEach(Ha=>{Ha=ra(Ha);x.isSome(Ha)&&Ha.layerOpacityChanged(Aa,this._context.isAsync)})};qa.layerElevationInfoChanged=function(pa,ra){return this.updateGraphics3DGraphicElevationInfo(pa,ra,v.needsElevationUpdates3D)};qa.slicePlaneEnabledChanged=function(pa,ra){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
pa.forEach(va=>{va=ra(va);x.isSome(va)&&va.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};qa.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};qa._getExtrusionSize=function(pa){pa=pa.size&&this._drivenProperties.size?D.getDriverAxisSizeValue(pa.size,2)??
0:this._getSymbolSize();return pa/=this._context.renderCoordsHelper.unitInMeters};qa.applyRendererDiff=function(pa,ra){return this._drivenPropertiesChanged(ra)?F.ApplyRendererDiffResult.Recreate_Symbol:F.ApplyRendererDiffResult.Recreate_Graphics};qa.queryForSnapping=async function(pa,ra,va,Ba){ra=this._getExtrusionSize(va)*this._context.renderCoordsHelper.unitInMeters/m.getMetersPerVerticalUnitForSR(ra);const {objectId:Aa,target:Ha}=pa;va=n.clone(Ha);va.z=(va.z??0)+ra;switch(pa.type){case "edge":const {start:Ka,
end:Pa}=pa;pa=n.clone(Ka);Ba=n.clone(Pa);pa.z=(pa.z??0)+ra;Ba.z=(Ba.z??0)+ra;return[B.makeEdgeCandidate(Aa,va,Infinity,pa,Ba)];case "vertex":return[B.makeVertexCandidate(Aa,va,Infinity),B.makeEdgeCandidate(Aa,Ha,Infinity,Ha,va)];default:return[]}};qa._getSymbolSize=function(){return this.symbolLayer.size??1};qa._createAs3DShape=function(pa,ra,va,Ba,Aa){var Ha=H.geometryAsPolygon(pa.geometry);if(x.isNone(Ha))return null;if(0===Ha.rings.length||!Ha.rings.some(ua=>0<ua.length))return this._logGeometryValidationWarnings(Ha.rings,
"rings","ExtrudeSymbol3DLayer"),null;pa=R.geometryToRenderInfo(Ha,this._context.elevationProvider,this._context.renderCoordsHelper,Ba);this._logGeometryCreationWarnings(pa,Ha.rings,"rings","ExtrudeSymbol3DLayer");var Ka=E.computeCentroid(Ha);if(x.isNone(Ka))return null;var Pa=[];const Ra=h.create(),Sa=e.create(),La=u.create(),Ua=this._context.renderCoordsHelper.viewingMode===z.ViewingMode.Global;Ua||this._context.renderCoordsHelper.worldUpAtPosition(null,La);p.computeTranslationToOriginAndRotation(Ha.spatialReference,
[Ka.x,Ka.y,0],Sa,this._context.renderCoordsHelper.spatialReference);Ha=e.create();d.invert(Ha,Sa);Ka=f.create();g.normalFromMat4(Ka,Ha);const {polygons:Za,mapPositions:Xa,position:la}=pa;for(const ua of Za){var Ta=ua.count;if(this._context.clippingExtent&&(h.empty(Ra),h.expandWithBuffer(Ra,ua.mapPositions),!h.intersectsClippingArea(Ra,this._context.clippingExtent)))continue;var Ma=l.earcut(ua.mapPositions,ua.holeIndices,3);if(0===Ma.length)continue;var fb=Ma.length,ya=6*Ta;Ta=q.newIndexArray(ya+fb);
fb=q.newIndexArray(fb);var oa=r.newDoubleArray(3*ya);const Da=r.newDoubleArray(3*ya),Ia=r.newDoubleArray(3*ya);ya=r.newDoubleArray(ya);const Na=this._getExtrusionSize(ra);W(la,Xa,Ma,ua,oa,Ia,Da,ya,Ta,fb,Na,La,Ua);y.transformMat4(oa,oa,Ha);y.transformMat3(Da,Da,Ka);Ma=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Aa,layerUid:this._context.layer.uid});oa=new ma(oa,Ia,Da,ya);Pa.push(Q(this._material,Ta,Ta.length-fb.length,oa,va,Ma),Q(this._bottomMaterial,fb,0,oa,va,Ma))}if(0===
Pa.length)return null;ra=new U.Object3D({geometries:Pa,metadata:{layerUid:this._context.layer.uid,graphicUid:Aa,isElevationSource:!0}});ra.transformation=Sa;va=K.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});va=x.isSome(va)?{baseMaterial:this._material,edgeMaterials:[va],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null;Pa=new t.Graphics3DObject3DGraphicLayer(this,ra,Pa,null,null,X,Ba,va);Pa.alignedSampledElevation=pa.sampledElevation;Pa.needsElevationUpdates=
v.needsElevationUpdates3D(Ba.mode);return Pa};return b._createClass(wa)}(C.Graphics3DSymbolLayer);const Y=u.create(),aa=u.create(),ia=u.create(),na=u.create(),ba=u.create(),ea=u.create(),ja=u.create(),ka=u.create(),da=u.create(),ha=new v.SampleElevationInfo,ca=[0,2,1],fa=[0,1,2];let ma=b._createClass(function(qa,wa,xa,pa){this.positions=qa;this.elevation=wa;this.normals=xa;this.heights=pa});a.Graphics3DExtrudeSymbolLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],
function(a){var b={};(function(c){(function(w){w=w();void 0!==w&&(c.exports=w)})(function(){function w(t,C,E){E=E||2;var F=C&&C.length,H=F?C[0]*E:t.length,K=n(t,0,H,E,!0),I=[];if(!K||K.next===K.prev)return I;var L;if(F){var R=K;var O=E;K=[];var J;F=0;for(J=C.length;F<J;F++){var M=C[F]*O;var G=F<J-1?C[F+1]*O:t.length;M=n(t,M,G,O,!1);M===M.next&&(M.steiner=!0);G=K;var P=G.push,U=M,N=M;do{if(U.x<N.x||U.x===N.x&&U.y<N.y)N=U;U=U.next}while(U!==M);P.call(G,N)}K.sort(g);for(F=0;F<K.length;F++)O=K[F],C=R,
(R=d(O,C))?(J=B(R,O),O=x(R,R.next),J=f(J),x(J,J.next),O=f(O),R=f(C===R?O:C)):R=C,R=x(R,R.next);K=R}if(t.length>80*E){var S=L=t[0];var Q=F=t[1];for(O=E;O<H;O+=E)C=t[O],R=t[O+1],C<S&&(S=C),R<Q&&(Q=R),C>L&&(L=C),R>F&&(F=R);L=Math.max(L-S,F-Q);L=0!==L?1/L:0}m(K,I,E,S,Q,L);return I}function n(t,C,E,F,H){if(H===0<A(t,C,E,F))for(H=C;H<E;H+=F)var K=D(H,t[H],t[H+1],K);else for(H=E-F;H>=C;H-=F)K=D(H,t[H],t[H+1],K);K&&p(K,K.next)&&(t=K.next,z(K),K=t);return K}function x(t,C){if(!t)return t;C||(C=t);do{var E=
!1;if(t.steiner||!p(t,t.next)&&0!==u(t.prev,t,t.next))t=t.next;else{C=t.prev;z(t);t=C;if(t===t.next)break;E=!0}}while(E||t!==C);return C}function m(t,C,E,F,H,K,I){if(t){if(!I&&K){var L=t,R=L;do null===R.z&&(R.z=e(R.x,R.y,F,H,K)),R.prevZ=R.prev,R=R.nextZ=R.next;while(R!==L);R.prevZ.nextZ=null;R.prevZ=null;L=R;var O,J,M,G,P=1;do{R=L;var U=L=null;for(J=0;R;){J++;var N=R;for(O=M=0;O<P&&(M++,N=N.nextZ,N);O++);for(G=P;0<M||0<G&&N;)0!==M&&(0===G||!N||R.z<=N.z)?(O=R,R=R.nextZ,M--):(O=N,N=N.nextZ,G--),U?U.nextZ=
O:L=O,O.prevZ=U,U=O;R=N}U.nextZ=null;P*=2}while(1<J)}for(L=t;t.prev!==t.next;){R=t.prev;N=t.next;if(K)U=l(t,F,H,K);else a:if(U=t,J=U.prev,M=U,P=U.next,0<=u(J,M,P))U=!1;else{for(O=U.next.next;O!==U.prev;){if(k(J.x,J.y,M.x,M.y,P.x,P.y,O.x,O.y)&&0<=u(O.prev,O,O.next)){U=!1;break a}O=O.next}U=!0}if(U)C.push(R.i/E),C.push(t.i/E),C.push(N.i/E),z(t),L=t=N.next;else if(t=N,t===L){if(!I)m(x(t),C,E,F,H,K,1);else if(1===I){t=x(t);I=C;L=E;R=t;do N=R.prev,U=R.next.next,!p(N,U)&&h(N,R,R.next,U)&&y(N,U)&&y(U,N)&&
(I.push(N.i/L),I.push(R.i/L),I.push(U.i/L),z(R),z(R.next),R=t=U),R=R.next;while(R!==t);t=x(R);m(t,C,E,F,H,K,2)}else if(2===I)a:{I=t;do{for(L=I.next.next;L!==I.prev;){if(R=I.i!==L.i){U=U=U=U=void 0;R=I;N=L;if(U=R.next.i!==N.i&&R.prev.i!==N.i){b:{U=R;do{if(U.i!==R.i&&U.next.i!==R.i&&U.i!==N.i&&U.next.i!==N.i&&h(U,U.next,R,N)){U=!0;break b}U=U.next}while(U!==R);U=!1}U=!U}if(U){if(U=y(R,N)&&y(N,R)){U=R;J=!1;M=(R.x+N.x)/2;P=(R.y+N.y)/2;do U.y>P!==U.next.y>P&&U.next.y!==U.y&&M<(U.next.x-U.x)*(P-U.y)/(U.next.y-
U.y)+U.x&&(J=!J),U=U.next;while(U!==R);U=J}U=U&&(u(R.prev,R,N.prev)||u(R,N.prev,N))||p(R,N)&&0<u(R.prev,R,R.next)&&0<u(N.prev,N,N.next)}R=U}if(R){t=B(I,L);I=x(I,I.next);t=x(t,t.next);m(I,C,E,F,H,K);m(t,C,E,F,H,K);break a}L=L.next}I=I.next}while(I!==t)}break}}}}function l(t,C,E,F){var H=t.prev,K=t.next;if(0<=u(H,t,K))return!1;var I=H.x>t.x?H.x>K.x?H.x:K.x:t.x>K.x?t.x:K.x,L=H.y>t.y?H.y>K.y?H.y:K.y:t.y>K.y?t.y:K.y,R=e(H.x<t.x?H.x<K.x?H.x:K.x:t.x<K.x?t.x:K.x,H.y<t.y?H.y<K.y?H.y:K.y:t.y<K.y?t.y:K.y,C,
E,F);C=e(I,L,C,E,F);E=t.prevZ;for(F=t.nextZ;E&&E.z>=R&&F&&F.z<=C;){if(E!==t.prev&&E!==t.next&&k(H.x,H.y,t.x,t.y,K.x,K.y,E.x,E.y)&&0<=u(E.prev,E,E.next))return!1;E=E.prevZ;if(F!==t.prev&&F!==t.next&&k(H.x,H.y,t.x,t.y,K.x,K.y,F.x,F.y)&&0<=u(F.prev,F,F.next))return!1;F=F.nextZ}for(;E&&E.z>=R;){if(E!==t.prev&&E!==t.next&&k(H.x,H.y,t.x,t.y,K.x,K.y,E.x,E.y)&&0<=u(E.prev,E,E.next))return!1;E=E.prevZ}for(;F&&F.z<=C;){if(F!==t.prev&&F!==t.next&&k(H.x,H.y,t.x,t.y,K.x,K.y,F.x,F.y)&&0<=u(F.prev,F,F.next))return!1;
F=F.nextZ}return!0}function g(t,C){return t.x-C.x}function f(t){if(t.next.prev===t)return t;let C=t;do{const E=C.next;if(E.prev===C||E===C||E===t)break;C=E}while(1);return C}function d(t,C){var E=C,F=t.x,H=t.y,K=-Infinity;do{if(H<=E.y&&H>=E.next.y&&E.next.y!==E.y){var I=E.x+(H-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(I<=F&&I>K){K=I;if(I===F){if(H===E.y)return E;if(H===E.next.y)return E.next}var L=E.x<E.next.x?E:E.next}}E=E.next}while(E!==C);if(!L)return null;if(F===K)return L;C=L;I=L.x;var R=L.y,O=Infinity;
E=L;do{if(F>=E.x&&E.x>=I&&F!==E.x&&k(H<R?F:K,H,I,R,H<R?K:F,H,E.x,E.y)){var J=Math.abs(H-E.y)/(F-E.x);var M;if((M=y(E,t))&&!(M=J<O)&&(M=J===O)&&!(M=E.x>L.x)&&(M=E.x===L.x)){M=L;var G=E;M=0>u(M.prev,M,G.prev)&&0>u(G.next,M,M.next)}M&&(L=E,O=J)}E=E.next}while(E!==C);return L}function e(t,C,E,F,H){t=32767*(t-E)*H;C=32767*(C-F)*H;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;return(t|t<<1)&1431655765|((C|C<<1)&1431655765)<<1}
function k(t,C,E,F,H,K,I,L){return 0<=(H-I)*(C-L)-(t-I)*(K-L)&&0<=(t-I)*(F-L)-(E-I)*(C-L)&&0<=(E-I)*(K-L)-(H-I)*(F-L)}function u(t,C,E){return(C.y-t.y)*(E.x-C.x)-(C.x-t.x)*(E.y-C.y)}function p(t,C){return t.x===C.x&&t.y===C.y}function h(t,C,E,F){var H=q(u(t,C,E)),K=q(u(t,C,F)),I=q(u(E,F,t)),L=q(u(E,F,C));return H!==K&&I!==L||0===H&&r(t,E,C)||0===K&&r(t,F,C)||0===I&&r(E,t,F)||0===L&&r(E,C,F)?!0:!1}function r(t,C,E){return C.x<=Math.max(t.x,E.x)&&C.x>=Math.min(t.x,E.x)&&C.y<=Math.max(t.y,E.y)&&C.y>=
Math.min(t.y,E.y)}function q(t){return 0<t?1:0>t?-1:0}function y(t,C){return 0>u(t.prev,t,t.next)?0<=u(t,C,t.next)&&0<=u(t,t.prev,C):0>u(t,C,t.prev)||0>u(t,t.next,C)}function B(t,C){var E=new v(t.i,t.x,t.y),F=new v(C.i,C.x,C.y),H=t.next,K=C.prev;t.next=C;C.prev=t;E.next=H;H.prev=E;F.next=E;E.prev=F;K.next=F;F.prev=K;return F}function D(t,C,E,F){t=new v(t,C,E);F?(t.next=F.next,t.prev=F,F.next.prev=t,F.next=t):(t.prev=t,t.next=t);return t}function z(t){t.next.prev=t.prev;t.prev.next=t.next;t.prevZ&&
(t.prevZ.nextZ=t.nextZ);t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function v(t,C,E){this.i=t;this.x=C;this.y=E;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function A(t,C,E,F){for(var H=0,K=E-F;C<E;C+=F)H+=(t[K]-t[C])*(t[C+1]+t[K+1]),K=C;return H}w.deviation=function(t,C,E,F){var H=C&&C.length,K=Math.abs(A(t,0,H?C[0]*E:t.length,E));if(H){H=0;for(var I=C.length;H<I;H++)K-=Math.abs(A(t,C[H]*E,H<I-1?C[H+1]*E:t.length,E))}for(H=C=0;H<F.length;H+=3){I=F[H]*E;var L=F[H+1]*E,R=F[H+2]*E;C+=
Math.abs((t[I]-t[R])*(t[L+1]-t[I+1])-(t[I]-t[L])*(t[R+1]-t[I+1]))}return 0===K&&0===C?0:Math.abs((C-K)/K)};w.flatten=function(t){for(var C=t[0][0].length,E={vertices:[],holes:[],dimensions:C},F=0,H=0;H<t.length;H++){for(var K=0;K<t[H].length;K++)for(var I=0;I<C;I++)E.vertices.push(t[H][K][I]);0<H&&(F+=t[H-1].length,E.holes.push(F))}return E};return w})})({get exports(){return b},set exports(c){b=c}});a.earcut=b})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],
function(a,b){function c(k,u,p){w(k.typedBuffer,u.typedBuffer,p,k.typedBufferStride,u.typedBufferStride)}function w(k,u,p,h=3,r=h){if(k.length/h!==Math.ceil(u.length/r))return b.mathLogger.error("source and destination buffers need to have the same number of elements"),k;const q=k.length/h,y=p[0],B=p[1],D=p[2],z=p[4],v=p[5],A=p[6],t=p[8],C=p[9],E=p[10],F=p[12],H=p[13];p=p[14];let K=0,I=0;for(let L=0;L<q;L++){const R=u[K],O=u[K+1],J=u[K+2];k[I]=y*R+z*O+t*J+F;k[I+1]=B*R+v*O+C*J+H;k[I+2]=D*R+A*O+E*J+
p;K+=r;I+=h}return k}function n(k,u,p){x(k.typedBuffer,u.typedBuffer,p,k.typedBufferStride,u.typedBufferStride)}function x(k,u,p,h=3,r=h){if(k.length/h!==Math.ceil(u.length/r))b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var q=k.length/h,y=p[0],B=p[1],D=p[2],z=p[3],v=p[4],A=p[5],t=p[6],C=p[7];p=p[8];var E=0,F=0;for(let H=0;H<q;H++){const K=u[E],I=u[E+1],L=u[E+2];k[F]=y*K+z*I+t*L;k[F+1]=B*K+v*I+C*L;k[F+2]=D*K+A*I+p*L;E+=r;F+=h}}}function m(k,u,
p){l(k.typedBuffer,u,p,k.typedBufferStride)}function l(k,u,p,h=3){const r=Math.min(k.length/h,u.count),q=u.typedBuffer;u=u.typedBufferStride;let y=0,B=0;for(let D=0;D<r;D++)k[B]=p*q[y],k[B+1]=p*q[y+1],k[B+2]=p*q[y+2],y+=u,B+=h}function g(k,u){f(k.typedBuffer,u.typedBuffer,k.typedBufferStride,u.typedBufferStride)}function f(k,u,p=3,h=p){const r=Math.min(k.length/p,u.length/h);let q=0,y=0;for(let D=0;D<r;D++){const z=u[q],v=u[q+1],A=u[q+2];var B=z*z+v*v+A*A;0<B&&(B=1/Math.sqrt(B),k[y]=B*z,k[y+1]=B*
v,k[y+2]=B*A);q+=h;y+=p}}function d(k,u,p){const h=Math.min(k.count,u.count),r=k.typedBuffer;k=k.typedBufferStride;const q=u.typedBuffer;u=u.typedBufferStride;let y=0,B=0;for(let D=0;D<h;D++)r[B]=q[y]>>p,r[B+1]=q[y+1]>>p,r[B+2]=q[y+2]>>p,y+=u,B+=k}const e=Object.freeze(Object.defineProperty({__proto__:null,normalize:f,normalizeView:g,scale:l,scaleView:m,shiftRight:d,transformMat3:x,transformMat3View:n,transformMat4:w,transformMat4View:c},Symbol.toStringTag,{value:"Module"}));a.normalize=f;a.normalizeView=
g;a.scale=l;a.scaleView=m;a.shiftRight=d;a.transformMat3=x;a.transformMat3View=n;a.transformMat4=w;a.transformMat4View=c;a.vec3=e})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,b){b=b.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(b,c,w,n,
x,m=!1){return{objectId:b,target:c,distance:w,type:"edge",start:n,end:x,draped:m}};a.makeVertexCandidate=function(b,c,w){return{objectId:b,target:c,distance:w,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,b,c,w){function n(m,l){if(!m||m.symbol)return null;l=l&&l.renderer;return m&&c.isSome(l)&&l.getObservationRenderer?
l.getObservationRenderer(m):l}async function x(m,l){if(c.isSome(m.symbol))return m.symbol;const g=n(m,l);return c.isSome(g)?g.getSymbolAsync(m,l):null}a.getDriverAxisSizeValue=function(m,l=0){m=m[l];return"number"===typeof m&&isFinite(m)?m:null};a.getDriverAxisSizeValueAny=function(m){for(let l=0;3>l;l++){const g=m[l];if("number"===typeof g)return isFinite(g)?g:0}return 0};a.getRenderer=n;a.getRenderingInfo=function(m,l){const g=n(m,l);if(c.isSome(m.symbol))var f=m.symbol;else f=n(m,l),f=c.isSome(f)&&
"dot-density"!==f.type?f.getSymbol(m,l):null;if(c.isNone(f))return null;f={renderer:g,symbol:f};if(c.isNone(g)||!("visualVariables"in g)||!g.visualVariables)return f;l=w.getVisualVariableValues(g,m,l)??[];m=["proportional","proportional","proportional"];for(const {variable:d,value:e}of l)switch(d.type){case "color":f.color=e.toRgba();break;case "size":if("outline"===d.target)f.outlineSize=e;else switch(l=d.useSymbolValue?"symbol-value":e,d.axis){case "width":m[0]=l;break;case "depth":m[1]=l;break;
case "height":m[2]=l;break;case "width-and-depth":m[0]=m[1]=l;break;default:m[0]=m[1]=m[2]=l}break;case "opacity":f.opacity=e;break;case "rotation":switch(d.axis){case "tilt":f.tilt=e;break;case "roll":f.roll=e;break;default:f.heading=e}}if("proportional"!==m[0]||"proportional"!==m[1]||"proportional"!==m[2])f.size=m;return f};a.getRenderingInfoAsync=async function(m,l){var g=n(m,l),f=await x(m,l);if(!f)return null;f={renderer:g,symbol:f};if(!(g&&"visualVariables"in g&&g.visualVariables))return f;
l=w.getVisualVariableValues(g,m,l)??[];m=["proportional","proportional","proportional"];for(const {variable:d,value:e}of l)"color"===d.type?f.color=b.toUnitRGBA(e):"size"===d.type?"outline"===d.target?f.outlineSize=e:(l=d.axis,g=d.useSymbolValue?"symbol-value":e,"width"===l?m[0]=g:"depth"===l?m[1]=g:"height"===l?m[2]=g:m[0]="width-and-depth"===l?m[1]=g:m[1]=m[2]=g):"opacity"===d.type?f.opacity=e:"rotation"===d.type&&"tilt"===d.axis?f.tilt=e:"rotation"===d.type&&"roll"===d.axis?f.roll=e:"rotation"===
d.type&&(f.heading=e);if(isFinite(m[0])||isFinite(m[1])||isFinite(m[2]))f.size=m;return f};a.getSymbolAsync=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/maybe ../../../../geometry/support/Indices ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){b=b._createClass(function(e,k,u){this.renderData=e;this.layerUid=k;this.graphicUid=u;this.outGeometries=[]});a.PolygonCreationDataBase=b;a.createColorGeometry=function(e){const k=[[g.VertexAttribute.POSITION,e.indices]],u=[[g.VertexAttribute.POSITION,new x.Attribute(e.attributeData.position,3,!0)]];w.isSome(e.attributeData.color)&&(u.push([g.VertexAttribute.COLOR,new x.Attribute(e.attributeData.color,4,!0)]),k.push([g.VertexAttribute.COLOR,n.getZeroIndexArray(e.indices.length)]));
w.isSome(e.attributeData.uvMapSpace)&&(u.push([g.VertexAttribute.UVMAPSPACE,new x.Attribute(e.attributeData.uvMapSpace,4,!0)]),k.push([g.VertexAttribute.UVMAPSPACE,e.indices]));w.isSome(e.attributeData.boundingRect)&&(u.push([g.VertexAttribute.BOUNDINGRECT,new x.Attribute(e.attributeData.boundingRect,9,!0)]),k.push([g.VertexAttribute.BOUNDINGRECT,e.indices]));return new l.Geometry(e.material,u,k,e.mapPositions,m.ContentObjectType.Mesh,e.attributeData.objectAndLayerIdColor)};a.createWaterGeometry=
function(e){const k=[[g.VertexAttribute.POSITION,e.indices],[g.VertexAttribute.UV0,e.indices]],u=[[g.VertexAttribute.POSITION,new x.Attribute(e.attributeData.position,3,!0)],[g.VertexAttribute.UV0,new x.Attribute(e.attributeData.uv0,2,!0)]];return new l.Geometry(e.material,u,k,e.mapPositions)};a.geometryAsPolygon=function(e){switch(e.type){case "extent":if(e instanceof f)return d.fromExtent(e);break;case "polygon":return e}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,c,w,n,x,m,l){function g(h,r,q=null){return h.filter(({count:y})=>1<y).map(({index:y,count:B})=>{const D=3*y,z=3*B;return c.isSome(q)?new e(y,
B,n.doubleSubArray(r,D,z),n.doubleSubArray(q,D,z)):new d(y,B,n.doubleSubArray(r,D,z))})}function f(h,r,q=null){const y=(c.isSome(q),[]);for(const {index:B,count:D,holeIndices:z,pathLengths:v}of h){if(1>=D)continue;h=3*B;const A=3*D,t=z.map(C=>C-B);h=c.isSome(q)?new k(B,D,n.doubleSubArray(r,3*B,3*D),n.doubleSubArray(q,h,A),t,v):new u(B,D,n.doubleSubArray(r,3*B,3*D),t,v);y.push(h)}return y}let d=b._createClass(function(h,r,q){this.index=h;this.count=r;this.position=q}),e=function(h){function r(y,B,
D,z){y=q.call(this,y,B,D);y.mapPositions=z;return y}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(d),k=function(h){function r(y,B,D,z,v,A){y=q.call(this,y,B,D,z);y.holeIndices=v;y.pathLengths=A;return y}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(e),u=function(h){function r(y,B,D,z,v){y=q.call(this,y,B,D);y.holeIndices=z;y.pathLengths=v;return y}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(d),p=b._createClass(function(h,r,q,y,B,D){this.position=
h;this.mapPositions=r;this.polygons=q;this.outlines=y;this.projectionSuccess=B;this.sampledElevation=D});a.PolygonRenderInfo=p;a.PolygonVertexData=k;a.PolygonVertexDataDraped=u;a.geometryToRenderInfo=function(h,r,q,y){const B=x.pathsToTriangulationInfo(h.rings,!!h.hasZ,x.CounterClockwiseMode.CCW_IS_HOLE),D=n.newDoubleArray(B.position.length);h=m.applyPerVertexElevationAlignment(B.position,h.spatialReference,0,D,0,B.position,0,B.position.length/3,r,q,y);r=null!=h;return new p(B.position,D,f(B.polygons,
B.position,D),g(B.outlines,B.position,D),r,h)};a.geometryToRenderInfoDraped=function(h,r){const q=x.pathsToTriangulationInfo(h.rings,!1,x.CounterClockwiseMode.CCW_IS_HOLE);h=w.projectBuffer(q.position,h.spatialReference,0,q.position,r,0,q.position.length/3);for(r=2;r<q.position.length;r+=3)q.position[r]=l.DRAPED_Z;return{position:q.position,polygons:f(q.polygons,q.position),outlines:g(q.outlines,q.position),projectionSuccess:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./coordsUtils ./DoubleArray ./Indices ./meshUtils/deduplicate".split(" "),
function(a,b,c,w,n,x){function m(f,d,e){if(1===f.length)return f[0];d=w.newDoubleArray(d);e=Array(e);let k=0,u=0,p=0;for(const h of f){for(f=0;f<h.position.length;f++)d[k++]=h.position[f];for(const r of h.faces)e[u++]=r+p;p=k/3}return{position:d,faces:n.compactIndices(e)}}function l(f,d,e){const k=f.length,u=Array(k),p=Array(k),h=Array(k);let r=0,q=0,y=0;var B=0;for(var D=0;D<k;++D)B+=f[D].length;B=w.newDoubleArray(3*B);D=0;for(let t=k-1;0<=t;t--){var z=f[t],v=e===a.CounterClockwiseMode.CCW_IS_HOLE?
!c.isClockwise(z,!1,!1):!1;if(v&&1!==k)u[r++]=z;else{var A=z.length;for(let C=0;C<r;++C)A+=u[C].length;A={index:D,pathLengths:Array(r+1),count:A,holeIndices:Array(r)};A.pathLengths[0]=z.length;0<z.length&&(h[y++]={index:D,count:z.length});D=v?g(z,z.length-1,-1,B,D,z.length,d):g(z,0,1,B,D,z.length,d);for(z=0;z<r;++z)v=u[z],A.holeIndices[z]=D,A.pathLengths[z+1]=v.length,0<v.length&&(h[y++]={index:D,count:v.length}),D=g(v,0,1,B,D,v.length,d);r=0;0<A.count&&(p[q++]=A)}}for(f=0;f<r;++f)e=u[f],0<e.length&&
(h[y++]={index:D,count:e.length}),D=g(e,0,1,B,D,e.length,d);p.length=q;h.length=y;return{position:B,polygons:p,outlines:h}}function g(f,d,e,k,u,p,h){u*=3;for(let r=0;r<p;++r){const q=f[d];k[u++]=q[0];k[u++]=q[1];k[u++]=h?q[2]:0;d+=e}return u/3}a.CounterClockwiseMode=void 0;(function(f){f[f.NONE=0]="NONE";f[f.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=l;a.triangulate=function(f){f=l(f.rings,f.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);
const d=[];let e=0,k=0;for(var u of f.polygons){const h=u.index,r=w.doubleSubArray(f.position,3*h,3*u.count);var p=u.holeIndices.map(q=>q-h);p=n.compactIndices(b.earcut(r,p,3));d.push({position:r,faces:p});e+=r.length;k+=p.length}u=m(d,e,k);f=Array.isArray(u.position)?x.deduplicate(u.position,3,{originalIndices:u.faces}):x.deduplicate(u.position.buffer,6,{originalIndices:u.faces});u.position=w.doubleArrayFrom(new Float64Array(f.buffer));u.faces=f.indices;return u};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(a,b,c){let w=null;a.deduplicate=function(n,x,m){var l=Array.isArray(n),g=l?n.length/x:n.byteLength/(4*x),f=l?n:new Uint32Array(n,0,g*x),d=m?.minReduction??0;const e=(n=m?.originalIndices||null)?n.length:0;var k=m?.componentOffsets||null;m=0;if(k)for(var u=0;u<k.length-1;u++){var p=k[u+1]-k[u];p>m&&(m=p)}else m=g;var h=Math.floor(1.1*m)+1;if(null==w||w.length<
2*h)w=new Uint32Array(b.nextHighestPowerOfTwo(2*h));for(m=0;m<2*h;m++)w[m]=0;m=0;const r=(p=!!k&&!!n)?e:g;u=c.newIndexArray(g);var q=new Uint32Array(e),y=0!==d?Math.ceil(7.84*1.96/(d*d)*d*(1-d)):r,B=1,D=k?k[1]:r;for(let C=0;C<r;C++){if(C===y){var z=1-m/C;if(z+1.96*Math.sqrt(z*(1-z)/C)<d)return null;y*=2}if(C===D){for(D=0;D<2*h;D++)w[D]=0;if(n)for(D=k[B-1];D<k[B];D++)q[D]=u[n[D]];D=k[++B]}z=p?n[C]:C;const E=z*x;var v=0;for(var A=0;A<x;A++)v=f[E+A]+v|0,v=v+(v<<11)+(v>>>2)|0;v>>>=0;A=v%h;let F=m;for(;0!==
w[2*A+1];){if(w[2*A]===v){const H=w[2*A+1]-1;var t=H*x;a:{for(let K=0;K<x;K++)if(f[E+K]!==f[t+K]){t=!1;break a}t=!0}if(t){F=u[H];break}}A++;A>=h&&(A-=h)}F===m&&(w[2*A]=v,w[2*A+1]=z+1,m++);u[z]=F}if(0!==d&&1-m/g<d)return null;if(p){for(g=k[B-1];g<q.length;g++)q[g]=u[n[g]];u=c.compactIndices(q)}l=l?Array(m):new Uint32Array(m*x);m=0;for(y=0;y<r;y++)if(u[y]===m){g=f;d=(p?n[y]:y)*x;k=l;h=m*x;q=x;for(B=0;B<q;B++)k[h+B]=g[d+B];m++}if(n&&!p){x=new Uint32Array(e);for(f=0;f<x.length;f++)x[f]=u[n[f]];u=c.compactIndices(x)}return{buffer:Array.isArray(l)?
l:l.buffer,indices:u,uniqueCount:m}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/SSAOHelper ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../webgl-engine/materials/StippleTextureRepository ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa){a.OverlayRenderer=function(ea){function ja(da){da=ka.call(this,da);da._overlays=null;da._overlayRenderTarget=null;da._hasHighlights=!1;da._rendersOccluded=!1;da._hasWater=!1;da._handles=new x;da._renderers=new Map;da._sortedDrapeSourceRenderersDirty=!1;da._sortedRenderers=new g;da._passParameters=new F.TextureOnlyPassParameters;da._materialRepository=null;da._screenToWorldRatio=1;da._localOriginFactory=
null;da._camera=new K.Camera;da.worldToPCSRatio=1;da.events=new n;da.longitudeCyclical=null;return da}b._inherits(ja,ea);var ka=b._createSuper(ja);ea=ja.prototype;ea.initialize=function(){const da=this.view._stage.renderView,ha=da.waterTextureRepository;this._stippleTextureRepository=new T.StippleTextureRepository(da.renderingContext);this._shaderTechniqueRepository=new H.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:B.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,
waterTextureRepository:ha});this._renderContext=new J.OverlayRenderContext(this._rctx,new G.ShadowMap(this._rctx,this.view.state.viewingMode),new U.SSAOHelper(this.view,this._shaderTechniqueRepository,this._rctx,()=>{}));this._handles.add([f.watch(()=>ha.updating,()=>this.events.emit("content-changed"),f.syncAndInitial),f.watch(()=>this.spatialReference,ca=>this._localOriginFactory=new R.GridLocalOriginFactory(ca),f.syncAndInitial),f.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=
!0)]);this._materialRepository=new I.GLMaterialRepository(da.textureRepository,this._shaderTechniqueRepository,ca=>{0<(ca.renderOccluded&ba)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=M.RenderSlot.DRAPED_MATERIAL;this._bindParameters.highlightDepthTexture=L.createEmptyDepthTexture(this._rctx);this._camera.near=1;this._camera.far=
1E4;this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new V.AmbientLight(y.fromValues(1,1,1))]);this._handles.add(this.view.resourceController.scheduler.registerTask(X.TaskPriority.STAGE,this))};ea.destroy=function(){this._handles.destroy();this._renderers.forEach(da=>da.destroy());
this._renderers.clear();this._debugTextureTechnique=l.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=l.disposeMaybe(this._passParameters.texture);this._bindParameters.highlightDepthTexture=l.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=l.destroyMaybe(this._shaderTechniqueRepository);this._temporaryFBO=l.disposeMaybe(this._temporaryFBO);this._quadVAO=l.disposeMaybe(this._quadVAO);this.disposeOverlays()};ea.createGeometryDrapeSourceRenderer=
function(da){return this.createDrapeSourceRenderer(da,P.SortedRenderGeometryRenderer)};ea.createDrapeSourceRenderer=function(da,ha,ca){const fa=this._renderers.get(da);l.isSome(fa)&&fa.destroy();ha=new ha({...ca,rendererContext:this,drapeSource:da});this._renderers.set(da,ha);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in da&&this._handles.add(f.watch(()=>da.fullOpacity,()=>this.events.emit("content-changed")),da);return ha};ea.removeDrapeSourceRenderer=function(da){if(!l.isNone(da)){var ha=
this._renderers.get(da);l.isNone(ha)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(da),this._handles.remove(da),ha.destroy())}};ea.collectUnusedRenderTargetMemory=function(da){let ha=!1;if(l.isSome(this._overlayRenderTarget))for(const ca of this._overlayRenderTarget.renderTargets){const [fa,ma]=this.overlays;ha=this._overlayRenderTarget.validateUsageForTarget(fa.validTargets[ca.type]||!ma.validTargets[ca.type],ca,da)||ha}return ha};ea.ensureDrapeTargets=function(da){l.isSome(this._overlays)&&
this._overlays.forEach(ha=>ha.hasTargetWithoutRasterImage=d.someSet(da,ca=>ca.drapeTargetType===D.DrapeTargetType.WithoutRasterImage))};ea.ensureDrapeSources=function(da){l.isSome(this._overlays)&&this._overlays.forEach(ha=>{ha.hasDrapedFeatureSource=d.someSet(da,ca=>ca.drapeSourceType===D.DrapeSourceType.Features);ha.hasDrapedRasterSource=d.someSet(da,ca=>ca.drapeSourceType===D.DrapeSourceType.RasterImage)})};ea.ensureOverlays=function(da,ha){l.isNone(this._overlays)&&(this._overlayRenderTarget=
new C.OverlayRenderTarget(this._rctx),this._overlays=[new A.Overlay(v.OverlayIndex.INNER,this._overlayRenderTarget),new A.Overlay(v.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(da);this.ensureDrapeSources(ha)};ea.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=l.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};ea.runTask=function(da){this._processDrapeSources(da,()=>!0)};ea._processDrapeSources=function(da,ha){let ca=
!1;for(const [fa,ma]of this._renderers){if(da.done)break;(fa.destroyed||ha(fa))&&ma.commitChanges()&&(ca=!0,da.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,ca=!0,this._updateSortedDrapeSourceRenderers());ca&&(l.isSome(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())};
ea.processSyncDrapeSources=function(){this._processDrapeSources(X.noBudget,da=>da.updatePolicy===W.UpdatePolicy.SYNC)};ea.updateAnimation=function(da){let ha=!1;this._renderers.forEach(ca=>ha=ca.updateAnimation(da)||ha);return ha};ea.updateDrapeSourceOrder=function(){this._sortedDrapeSourceRenderersDirty=!0};ea.drawTarget=function(da,ha,ca){const fa=da.canvasGeometries;if(0===fa.numViews)return!1;this._screenToWorldRatio=ca*da.mapUnitsPerPixel;const ma=ha.output;if(this.isEmpty||ma===E.ShaderOutput.Highlight&&
!this.hasHighlights||ma===E.ShaderOutput.Normal&&!this.hasWater||!da.hasSomeSizedView())return!1;const qa=ha.fbo;if(!qa.isValid())return!1;const wa=2*da.resolution,xa=da.resolution;qa.resize(wa,xa);const pa=this._rctx;this._camera.pixelRatio=da.pixelRatio*ca;this._renderContext.output=ma;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=ma===E.ShaderOutput.Normal?M.RenderSlot.DRAPED_WATER:
M.RenderSlot.DRAPED_MATERIAL;da.applyViewport(this._rctx);qa.bind(pa);da.index===v.OverlayIndex.INNER&&(pa.setClearColor(0,0,0,0),pa.clearSafe(Z.ClearBufferBit.COLOR_BUFFER_BIT));ha.type===v.RenderTargetType.Occluded&&(this._renderContext.renderOccludedMask=ba);if(z.OVERLAY_DRAW_DEBUG_TEXTURE&&ha.type!==v.RenderTargetType.Occluded)for(ca=0;ca<fa.numViews;ca++)this._setViewParameters(fa.extents[ca],da),this._drawDebugTexture(da.resolution,na[da.index]);0<this._renderers.size&&this._sortedRenderers.forAll(({drapeSource:ra,
renderer:va})=>{if(ha.type!==v.RenderTargetType.ColorNoRasterImage||ra.drapeSourceType!==D.DrapeSourceType.RasterImage){({fullOpacity:ra}=ra);var Ba=l.isSome(ra)&&1>ra&&ma===E.ShaderOutput.Color;Ba&&(this.bindTemporaryFramebuffer(this._rctx,wa,xa),pa.clearSafe(Z.ClearBufferBit.COLOR_BUFFER_BIT));for(let Aa=0;Aa<fa.numViews;Aa++)this._setViewParameters(fa.extents[Aa],da),va.render(this._renderContext);Ba&&l.isSome(this._temporaryFBO)&&(qa.bind(pa),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,
this._temporaryFBO.getTexture(),ra,da.index))}});pa.bindFramebuffer(null);qa.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};ea.bindTemporaryFramebuffer=function(da,ha,ca){l.isNone(this._temporaryFBO)&&(this._temporaryFBO=new t.OverlayFramebufferObject(da,!1));this._temporaryFBO.resize(ha,ca);this._temporaryFBO.bind(da)};ea.reloadShaders=async function(){await this._shaderTechniqueRepository.reloadAll()};ea.notifyContentChanged=function(){this.events.emit("content-changed")};
ea.intersect=function(da,ha,ca,fa){let ma=0;for(const qa of this._renderers.values())ma=qa.intersect?.(da,ha,ca,fa,ma)??ma};ea._updateSortedDrapeSourceRenderers=function(){this._sortedRenderers.clear();if(0!==this._renderers.size){var da=this.view.map.allLayers;this._renderers.forEach((ha,ca)=>{const fa=da.indexOf(ca.layer),ma=0<=fa;this._sortedRenderers.push(new ia(ca,ha,this._renderers.size*(ca.renderGroup??(ma?D.DrapedRenderGroup.MapLayer:D.DrapedRenderGroup.ViewLayer))+(ma?fa:0)))});this._sortedRenderers.sort((ha,
ca)=>ha.index-ca.index)}};ea._setViewParameters=function(da,ha){const ca=this._camera;ca.viewport=[0,0,ha.resolution,ha.resolution];r.ortho(ca.projectionMatrix,0,da[2]-da[0],0,da[3]-da[1],ca.near,ca.far);r.fromTranslation(ca.viewMatrix,[-da[0],-da[1],0])};ea._updateHasWater=function(){const da=m.someMap(this._renderers,ha=>ha.hasWater);da!==this._hasWater&&(this._hasWater=da,this.events.emit("has-water",da))};ea._updateHasHighlights=function(){const da=m.someMap(this._renderers,ha=>ha.hasHighlights);
da!==this._hasHighlights&&(this._hasHighlights=da,this.events.emit("has-highlights",da))};ea._updateRendersOccluded=function(){const da=m.someMap(this._renderers,ha=>ha.rendersOccluded);da!==this._rendersOccluded&&(this._rendersOccluded=da,this.events.emit("renders-occluded",da))};ea._drawDebugTexture=function(da,ha){this._ensureDebugPatternResources(da,da,ha);da=this._rctx;da.bindTechnique(this._debugTextureTechnique,this._passParameters,null);da.bindVAO(this._quadVAO);da.drawArrays(Z.PrimitiveType.TRIANGLE_STRIP,
0,aa.vertexCount(this._quadVAO,"geometry"))};ea._ensureDebugPatternResources=function(da,ha,ca){q.set(this._passParameters.color,ca[0],ca[1],ca[2]);if(!this._passParameters.texture){ca=new Uint8Array(da*ha*4);var fa=0;for(let ma=0;ma<ha;ma++)for(let qa=0;qa<da;qa++){const wa=Math.floor(qa/10),xa=Math.floor(ma/10);2>wa||2>xa||10*wa>da-20||10*xa>ha-20?(ca[fa++]=255,ca[fa++]=255,ca[fa++]=255,ca[fa++]=255):(ca[fa++]=255,ca[fa++]=255,ca[fa++]=255,wa&1&&xa&1?ca[fa++]=qa&1^ma&1?0:255:ca[fa++]=wa&1^xa&1?
0:128)}this._passParameters.texture=new Y.Texture(this._rctx,{target:Z.TextureType.TEXTURE_2D,pixelFormat:Z.PixelFormat.RGBA,dataType:Z.PixelType.UNSIGNED_BYTE,samplingMode:Z.TextureSamplingMode.NEAREST,width:da,height:ha},ca);da=new S.TextureTechniqueConfiguration;da.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(N.TextureTechnique,da);this._quadVAO=L.createQuadVAO(this._rctx)}};b._createClass(ja,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},
{key:"_rctx",get:function(){return this.view._stage.renderView.renderingContext}},{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||m.someMap(this._renderers,da=>da.updating)}},{key:"hasOverlays",get:function(){return l.isSome(this._overlays)&&
l.isSome(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return l.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return l.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"isEmpty",get:function(){return z.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!m.someMap(this._renderers,da=>!da.isEmpty)}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},
{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:da=>this._renderers.get(da)}}}]);return ja}(w);c.__decorate([e.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);c.__decorate([e.property({autoDestroy:!0})],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.OverlayRenderer.prototype,
"_stippleTextureRepository",void 0);c.__decorate([e.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);c.__decorate([e.property()],a.OverlayRenderer.prototype,"isEmpty",null);a.OverlayRenderer=c.__decorate([h.subclass("esri.views.3d.terrain.OverlayRenderer")],
a.OverlayRenderer);let ia=b._createClass(function(ea,ja,ka){this.drapeSource=ea;this.renderer=ja;this.index=ka});const na=[[1,.5,.5],[.5,.5,1]],ba=O.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=ba;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType=
{}));a.DrapedRenderGroup=void 0;(function(b){b[b.MapLayer=0]="MapLayer";b[b.ViewLayer=1]="ViewLayer";b[b.Outline=2]="Outline";b[b.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],
function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=
5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=
void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));a.TileFrustumVisibility=void 0;(function(b){b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),
function(a,b,c,w,n,x){a.OverlaySource=void 0;(function(g){g[g.None=0]="None";g[g.ColorAndWater=1]="ColorAndWater";g[g.Highlight=2]="Highlight";g[g.Occluded=3]="Occluded";g[g.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(a.OverlaySource||(a.OverlaySource={}));let m=function(){function g(d,e){this.index=d;this.renderTargets=e;this._extent=c.create();this.resolution=0;this.renderLocalOrigin=x.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new l;this.hasTargetWithoutRasterImage=
this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=d;this.validTargets=Array(e.renderTargets.length).fill(!1)}var f=g.prototype;f.getValidTexture=function(d){return this.validTargets[d]?this.renderTargets.getTarget(d).getTexture():null};f.getColorTexture=function(d){return(d=d===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(w.RenderTargetType.Color):d===a.OverlaySource.Highlight?this.renderTargets.getTarget(w.RenderTargetType.Highlight):d===a.OverlaySource.ObjectAndLayerIdColor?
this.renderTargets.getTarget(w.RenderTargetType.ObjectAndLayerIdColor):this.renderTargets.getTarget(w.RenderTargetType.Occluded))?d.getTexture():null};f.getColorTextureNoRasterImage=function(){return this._needsColorWithoutRasterImage?this.getValidTexture(w.RenderTargetType.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(w.RenderTargetType.Color):null};f.getNormalTexture=function(d){return(d=d===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(w.RenderTargetType.Water):
null)?d.getTexture():null};f.draw=function(d,e){const k=this.computeRenderTargetValidityBitfield();for(const u of this.renderTargets.renderTargets)this.validTargets[u.type]=u.type!==w.RenderTargetType.ColorNoRasterImage||this._needsColorWithoutRasterImage?d.drawTarget(this,u,e):!1;d=this.computeRenderTargetValidityBitfield();return k^d?n.ValidationState.CHANGED:n.ValidationState.UNCHANGED};f.computeRenderTargetValidityBitfield=function(){const d=this.validTargets;return+d[w.RenderTargetType.Color]|
+d[w.RenderTargetType.ColorNoRasterImage]<<1|+d[w.RenderTargetType.Highlight]<<2|+d[w.RenderTargetType.Water]<<3|+d[w.RenderTargetType.Occluded]<<4};f.setupGeometryViewsCyclical=function(d){this.setupGeometryViewsDirect();var e=.001*d.range;if(this._extent[0]-e<=d.min){const k=this.canvasGeometries.extents[this.canvasGeometries.numViews++];c.offset(this._extent,d.range,0,k)}this._extent[2]+e>=d.max&&(e=this.canvasGeometries.extents[this.canvasGeometries.numViews++],c.offset(this._extent,-d.range,
0,e))};f.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;c.copy(this.canvasGeometries.extents[0],this._extent)};f.hasSomeSizedView=function(){for(let d=0;d<this.canvasGeometries.numViews;d++){const e=this.canvasGeometries.extents[d];if(e[0]!==e[2]&&e[1]!==e[3])return!0}return!1};f.applyViewport=function(d){d.setViewport(this.index===w.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)};b._createClass(g,[{key:"extent",get:function(){return this._extent}},{key:"_needsColorWithoutRasterImage",
get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return g}(),l=b._createClass(function(){this.extents=[c.create(),c.create(),c.create()];this.numViews=0});a.Overlay=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64"],function(a,b,c){let w=b._createClass(function(n,
x){this.vec3=n;this.id=x});a.LocalOrigin=w;a.fromValues=function(n,x,m,l){return new w(c.fromValues(n,x,m),l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,b,c,w,n,x){let m=function(){function l(f,d){this._size=w.create();this._fbo=null;this._fbo=new x.FramebufferObject(f,
{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:d,maxAnisotropy:8,width:0,height:0})}var g=l.prototype;g.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};g.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};g.isValid=function(){return null!==
this._fbo};g.resize=function(f,d){this._size[0]=f;this._size[1]=d;this._fbo.resize(this._size[0],this._size[1])};g.bind=function(f){f.bindFramebuffer(this._fbo)};g.generateMipMap=function(){const f=this._fbo.colorTexture;f.descriptor.hasMipmap&&f.generateMipmap()};g.disposeRenderTargetMemory=function(){this._fbo?.resize(0,0)};b._createClass(l,[{key:"gpuMemoryUsage",get:function(){return this._fbo?.gpuMemoryUsage??0}}]);return l}();a.OverlayFramebufferObject=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ./interfaces ./OverlayFramebufferObject ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),function(a,b,c,w,n,x){let m=b._createClass(function(g,f,d,e=!0){this.output=f;this.type=d;this.valid=!1;this.lastUsed=Infinity;this.fbo=new n.OverlayFramebufferObject(g,e)}),l=function(){function g(d){this.renderTargets=[new m(d,x.ShaderOutput.Color,
w.RenderTargetType.Color),new m(d,x.ShaderOutput.Color,w.RenderTargetType.ColorNoRasterImage),new m(d,x.ShaderOutput.Highlight,w.RenderTargetType.Highlight,!1),new m(d,x.ShaderOutput.Normal,w.RenderTargetType.Water),new m(d,x.ShaderOutput.Color,w.RenderTargetType.Occluded)];c("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new m(d,x.ShaderOutput.ObjectAndLayerIdColor,w.RenderTargetType.ObjectAndLayerIdColor))}var f=g.prototype;f.getTarget=function(d){return this.renderTargets[d].fbo};
f.dispose=function(){for(const d of this.renderTargets)d.fbo.dispose()};f.disposeRenderTargetMemory=function(){for(const d of this.renderTargets)d.fbo.disposeRenderTargetMemory()};f.validateUsageForTarget=function(d,e,k){if(d)e.lastUsed=k;else if(1E3<k-e.lastUsed)e.fbo.disposeRenderTargetMemory(),e.lastUsed=Infinity;else if(Infinity>e.lastUsed)return!0;return!1};b._createClass(g,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((d,e)=>d+e.fbo.gpuMemoryUsage,0)}}]);return g}();
a.OverlayRenderTarget=l;a.RenderTargetDescriptor=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,c,w,n){let x=function(){function g(d){this._context=d;this._perConstructorInstances=new w.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=
-1}var f=g.prototype;f.destroy=function(){this._perConstructorInstances.forEach(d=>d.forEach(e=>e.technique.destroy()));this._perConstructorInstances.clear()};f.acquire=function(d,e=l){const k=e.key;let u=this._perConstructorInstances.get(d,k);if(c.isNone(u)){const p=new d(this._context,e,()=>this.release(p));u=new m(p);this._perConstructorInstances.set(d,k,u)}++u.refCount;return u.technique};f.releaseAndAcquire=function(d,e,k){if(c.isSome(k)){if(e.key===k.key)return k;this.release(k)}return this.acquire(d,
e)};f.release=function(d){c.isNone(d)||this._perConstructorInstances.empty||(d=this._perConstructorInstances.get(d.constructor,d.key),c.isNone(d)||(--d.refCount,0===d.refCount&&(d.refZeroFrame=this._frameCounter)))};f.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((d,e)=>{d.forEach((k,u)=>{0===k.refCount&&k.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(k.technique.destroy(),this._perConstructorInstances.delete(e,u))})})};
f.reloadAll=async function(){const d=[];this._perConstructorInstances.forEach((e,k)=>{d.push((async(u,p)=>{if(p=p.shader)await p.reload(),u.forEach(h=>h.technique.reload(this._context))})(e,k))});await Promise.all(d)};b._createClass(g,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return g}(),m=b._createClass(function(g){this.technique=g;this.refZeroFrame=this.refCount=0});const l=new n.ShaderTechniqueConfiguration;
a.ShaderTechniqueRepository=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),function(a,b,c,w,n,x){let m=function(){function g(d,e,k,u){this._textureRepository=d;this._techniqueRepository=e;this.materialChanged=k;this.requestRender=u;this._id2glMaterialRef=new n.NestedMap}
var f=g.prototype;f.dispose=function(){this._textureRepository.destroy()};f.acquire=function(d,e,k){this._ownMaterial(d);if(!d.requiresSlot(e,k))return null;e=this._id2glMaterialRef.get(k,d.id);w.isNone(e)&&(e=d.createGLMaterial({material:d,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:k}),e=new l(e),this._id2glMaterialRef.set(k,d.id,e));e.ref();return e.glMaterial};f.release=function(d,e){const k=this._id2glMaterialRef.get(e,d.id);w.isSome(k)&&(k.unref(),k.referenced||
(w.disposeMaybe(k.glMaterial),this._id2glMaterialRef.delete(e,d.id)))};f._ownMaterial=function(d){w.isSome(d.repository)&&d.repository!==this&&c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");d.repository=this};return b._createClass(g)}(),l=function(){function g(d){this.glMaterial=d;this._refCnt=0}var f=g.prototype;f.ref=function(){++this._refCnt};f.unref=function(){--this._refCnt;x.assert(0<=this._refCnt)};b._createClass(g,
[{key:"referenced",get:function(){return 0<this._refCnt}}]);return g}();a.GLMaterialRepository=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){let q=function(){function B(z){this._originSR=z;this._origins=new Map;this._objects=new Map;this._gridSize=5E5;this._rootOriginId="root/"+w.generateUID()}var D=B.prototype;D.getOrigin=function(z){var v=this._origins.get(this._rootOriginId);if(null==v){v=u.gridLocalOriginFactory.rootOrigin;if(c.isSome(v))return this._origins.set(this._rootOriginId,e.fromValues(v[0],v[1],v[2],this._rootOriginId)),this.getOrigin(z);z=e.fromValues(z[0]+Math.random()-.5,z[1]+
Math.random()-.5,z[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,z);return z}var A=this._gridSize;const t=Math.round(z[0]/A),C=Math.round(z[1]/A),E=Math.round(z[2]/A),F=`${t}/${C}/${E}`;let H=this._origins.get(F);const K=.5*A;n.subtract(y,z,v.vec3);y[0]=Math.abs(y[0]);y[1]=Math.abs(y[1]);y[2]=Math.abs(y[2]);if(y[0]<K&&y[1]<K&&y[2]<K)return H&&(A=Math.max(...y),n.subtract(y,z,H.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),Math.max(...y)<A)?H:v;H||
(H=e.fromValues(t*A,C*A,E*A,F),this._origins.set(F,H));return H};D._drawOriginBox=function(z,v=m.fromValues(1,1,0,1)){const A=window.view,t=A._stage;var C=v.toString();if(!this._objects.has(C)){this._material=new r.RibbonLineMaterial({width:2,color:v});t.add(this._material);v=new h.WebGLLayer({pickable:!1});var E=new k.Object3D({castShadow:!1});t.add(E);v.add(E);t.add(v);this._objects.set(C,E)}C=this._objects.get(C);v=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];E=v.length;const F=Array(3*E),H=[],K=.5*
this._gridSize;for(let I=0;I<E;I++)F[3*I]=z[0]+(v[I]&1?K:-K),F[3*I+1]=z[1]+(v[I]&2?K:-K),F[3*I+2]=z[2]+(v[I]&4?K:-K),0<I&&H.push(I-1,I);l.projectBuffer(F,this._originSR,0,F,A.renderSpatialReference,0,E);z=new d.Geometry(this._material,[[p.VertexAttribute.POSITION,new g.Attribute(F,3,!0)]],[[p.VertexAttribute.POSITION,H]],null,f.ContentObjectType.Line);t.add(z);C.addGeometry(z)};b._createClass(B,[{key:"test",get:function(){const z=this;return{set gridSize(v){z._gridSize=v}}}}]);return B}();const y=
x.create();a.GridLocalOriginFactory=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={orderedRepackingEnabled:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){m=function(e){function k(p,h=""){var r=u.call(this);r.apiLayerUid=h;r.type=l.ContentObjectType.Layer;r.events=new c;r.sliceable=!1;r._objects=new x;r._objectsAdded=new x;r._stageHandles=new w;r.apiLayerUid=h;r.visible=p?.visible??!0;r.pickable=p?.pickable??!0;r.updatePolicy=p?.updatePolicy??d.UpdatePolicy.ASYNC;r._disableOctree=p?.disableOctree??!1;return r}b._inherits(k,e);var u=b._createSuper(k);e=k.prototype;e.destroy=function(){this.detachStage();this._stage=null};
e.attachStage=function(p){this.detachStage();this._stage=p;for(const h of g.DirtyEventNames)this._stageHandles.add(this.events.on(h,r=>p.handleEvent(h,r)))};e.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};e.add=function(p){this._objects.push(p);p.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:p});n.isSome(this._octree)&&this._objectsAdded.push(p)};e.remove=function(p){this._objects.removeUnordered(p)&&(p.parentLayer=null,this.events.emit("layerObjectRemoved",
{layer:this,object:p}),n.isSome(this._octree)&&(this._objectsAdded.removeUnordered(p)||this._octree.remove([p])))};e.addMany=function(p){this._objects.pushArray(p);for(const h of p)h.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:p});n.isSome(this._octree)&&this._objectsAdded.pushArray(p)};e.removeMany=function(p){const h=[];this._objects.removeUnorderedMany(p,p.length,h);if(0!==h.length){for(const r of h)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,
objects:h});if(n.isSome(this._octree)){for(p=0;p<h.length;)this._objectsAdded.removeUnordered(h[p])?(h[p]=h[h.length-1],--h.length):++p;this._octree.remove(h)}}};e.sync=function(){n.isSome(this._stage)&&this.updatePolicy!==d.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};e.notifyObjectBBChanged=function(p,h){n.isSome(this._octree)&&!this._objectsAdded.includes(p)&&this._octree.update(p,h)};e.getSpatialQueryAccelerator=function(){n.isNone(this._octree)&&50<this._objects.length&&!this._disableOctree?
(this._octree=new f(p=>p.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):n.isSome(this._octree)&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree};e.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};e.invalidateSpatialQueryAccelerator=function(){this._octree=n.destroyMaybe(this._octree);
this._objectsAdded.clear()};b._createClass(k,[{key:"objects",get:function(){return this._objects}}]);return k}(m.ContentObject);a.WebGLLayer=m;a.isWebGLLayer=function(e){return n.isSome(e)&&e.type===l.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved objectGeometryUpdated".split(" ");
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,c,w,n,x,m,l,g,f){function d(J,M,G){G[0]=J[0]+M;G[1]=J[1]+M;G[2]=J[2]+M}function e(J,
M,G,P){if(1===M)J=G(J[0]),g.copy(J,P);else{t[0]=Infinity;t[1]=Infinity;t[2]=Infinity;C[0]=-Infinity;C[1]=-Infinity;C[2]=-Infinity;for(let Q=0;Q<M;Q++){var U=G(J[Q]);if(h(U[3])){var N=t,S=U;N[0]=Math.min(N[0],S[0]-S[3]);N[1]=Math.min(N[1],S[1]-S[3]);N[2]=Math.min(N[2],S[2]-S[3]);N=C;N[0]=Math.max(N[0],U[0]+U[3]);N[1]=Math.max(N[1],U[1]+U[3]);N[2]=Math.max(N[2],U[2]+U[3])}}n.lerp(P,t,C,.5);P[3]=Math.max(C[0]-t[0],C[1]-t[1],C[2]-t[2])/2}}function k(J,M,G){if(!R.length)for(var P=0;8>P;++P)R.push({index:0,
distance:0});for(P=0;8>P;++P){const U=y[P];R.data[P].index=P;R.data[P].distance=p(J,M,U)}R.sort((U,N)=>U.distance-N.distance);for(J=0;8>J;++J)G[J]=R.data[J].index}function u(J,M){let G=Infinity,P;for(let U=0;8>U;++U){const N=p(J,M,B[U]);N<G&&(G=N,P=B[U])}return P}function p(J,M,G){return M*(J[0]*G[0]+J[1]*G[1]+J[2]*G[2])}function h(J){return!isNaN(J)&&-Infinity!==J&&Infinity!==J&&0<J}let r=function(){function J(G,P){this.objectToBoundingSphere=G;this._maximumObjectsPerNode=10;this._maximumDepth=20;
this._degenerateObjects=new Set;this._root=new q;this._objectCount=0;P&&(void 0!==P.maximumObjectsPerNode&&(this._maximumObjectsPerNode=P.maximumObjectsPerNode),void 0!==P.maximumDepth&&(this._maximumDepth=P.maximumDepth))}var M=J.prototype;M.destroy=function(){this._degenerateObjects.clear();q.clearPool();z[0]=null;E.prune();R.prune()};M.add=function(G,P=G.length){this._objectCount+=P;this._grow(G,P);const U=q.acquire();for(let N=0;N<P;N++){const S=G[N];this._isDegenerate(S)?this._degenerateObjects.add(S):
(U.init(this._root),this._add(S,U))}q.release(U)};M.remove=function(G,P=null){this._objectCount-=G.length;const U=q.acquire();for(const N of G)G=b.isSome(P)?P:g.copy(this.objectToBoundingSphere(N),F),h(G[3])?(U.init(this._root),this._remove(N,G,U)):this._degenerateObjects.delete(N);q.release(U);this._shrink()};M.update=function(G,P){if(h(P[3])||!this._isDegenerate(G))z[0]=G,G=z,this.remove(G,P),this.add(G)};M.forEachAlongRay=function(G,P,U){const N=l.wrap(G,P);this._forEachNode(this._root,S=>{if(!this._intersectsNode(N,
S))return!1;S=S.node;S.terminals.forAll(Q=>{this._intersectsObject(N,Q)&&U(Q)});null!==S.residents&&S.residents.forAll(Q=>{this._intersectsObject(N,Q)&&U(Q)});return!0})};M.forEachAlongRayWithVerticalOffset=function(G,P,U,N){const S=l.wrap(G,P);this._forEachNode(this._root,Q=>{if(!this._intersectsNodeWithOffset(S,Q,N))return!1;Q=Q.node;Q.terminals.forAll(W=>{this._intersectsObjectWithOffset(S,W,N)&&U(W)});null!==Q.residents&&Q.residents.forAll(W=>{this._intersectsObjectWithOffset(S,W,N)&&U(W)});return!0})};
M.forEach=function(G){this._forEachNode(this._root,P=>{P=P.node;P.terminals.forAll(G);null!==P.residents&&P.residents.forAll(G);return!0});this._degenerateObjects.forEach(G)};M.forEachDegenerateObject=function(G){this._degenerateObjects.forEach(G)};M.findClosest=function(G,P,U,N=()=>!0,S=Infinity){let Q=Infinity,W=Infinity,V=null;const T=u(G,P),X=Z=>{--S;if(N(Z)){var Y=this.objectToBoundingSphere(Z);if(m.intersectsSphere(U,Y)){var aa=p(G,P,g.getCenter(Y)),ia=aa-Y[3];Y=aa+Y[3];ia<Q&&(Q=ia,W=Y,V=Z)}}};
this._forEachNodeDepthOrdered(this._root,Z=>{if(0>=S||!m.intersectsSphere(U,Z.bounds))return!1;n.scale(A,T,Z.halfSize);n.add(A,A,Z.bounds);if(p(G,P,A)>W)return!1;Z=Z.node;Z.terminals.forAll(Y=>X(Y));null!==Z.residents&&Z.residents.forAll(Y=>X(Y));return!0},G,P);return V};M.forEachInDepthRange=function(G,P,U,N,S,Q,W){let V=-Infinity,T=Infinity;const X={setRange:na=>{U===J.DepthOrder.FRONT_TO_BACK?(V=Math.max(V,na.near),T=Math.min(T,na.far)):(V=Math.max(V,-na.far),T=Math.min(T,-na.near))}};X.setRange(N);
const Z=p(P,U,G),Y=u(P,U),aa=u(P,-U),ia=na=>{if(W(na)){var ba=this.objectToBoundingSphere(na),ea=g.getCenter(ba);ea=p(P,U,ea)-Z;var ja=ea+ba[3];ea-ba[3]>T||ja<V||!m.intersectsSphere(Q,ba)||S(na,X)}};this._forEachNodeDepthOrdered(this._root,na=>{if(!m.intersectsSphere(Q,na.bounds))return!1;n.scale(A,Y,na.halfSize);n.add(A,A,na.bounds);if(p(P,U,A)-Z>T)return!1;n.scale(A,aa,na.halfSize);n.add(A,A,na.bounds);if(p(P,U,A)-Z<V)return!1;na=na.node;na.terminals.forAll(ba=>ia(ba));null!==na.residents&&na.residents.forAll(ba=>
ia(ba));return!0},P,U)};M.forEachNode=function(G){this._forEachNode(this._root,P=>G(P.node,P.bounds,P.halfSize,P.depth))};M.forEachNeighbor=function(G,P){const U=g.getRadius(P),N=g.getCenter(P),S=V=>{const T=this.objectToBoundingSphere(V);var X=g.getRadius(T);X=U+X;return 0>=n.squaredDistance(g.getCenter(T),N)-X*X?G(V):!0};let Q=!0;const W=V=>{Q&&(Q=S(V))};this._forEachNode(this._root,V=>{var T=g.getRadius(V.bounds);T=U+T;if(0<n.squaredDistance(g.getCenter(V.bounds),N)-T*T)return!1;V=V.node;V.terminals.forAll(W);
Q&&null!==V.residents&&V.residents.forAll(W);return Q});Q&&this.forEachDegenerateObject(W)};M._intersectsNode=function(G,P){d(P.bounds,2*-P.halfSize,t);d(P.bounds,2*P.halfSize,C);return f.rayBoxTest(G.origin,G.direction,t,C)};M._intersectsNodeWithOffset=function(G,P,U){d(P.bounds,2*-P.halfSize,t);d(P.bounds,2*P.halfSize,C);U.applyToMinMax(t,C);return f.rayBoxTest(G.origin,G.direction,t,C)};M._intersectsObject=function(G,P){P=this.objectToBoundingSphere(P);return 0<P[3]?g.intersectsRay(P,G):!0};M._intersectsObjectWithOffset=
function(G,P,U){P=this.objectToBoundingSphere(P);return 0<P[3]?g.intersectsRay(U.applyToBoundingSphere(P),G):!0};M._forEachNode=function(G,P){G=q.acquire().init(G);const U=[G];for(;0!==U.length;){G=U.pop();if(P(G)&&!G.isLeaf())for(let N=0;N<G.node.children.length;N++)G.node.children[N]&&U.push(q.acquire().init(G).advance(N));q.release(G)}};M._forEachNodeDepthOrdered=function(G,P,U,N=J.DepthOrder.FRONT_TO_BACK){G=q.acquire().init(G);const S=[G];for(k(U,N,O);0!==S.length;){G=S.pop();if(P(G)&&!G.isLeaf())for(U=
7;0<=U;--U)N=O[U],G.node.children[N]&&S.push(q.acquire().init(G).advance(N));q.release(G)}};M._remove=function(G,P,U){E.clear();P=U.advanceTo(P,(N,S)=>{E.push(N.node);E.push(S)})?U.node.terminals:U.node.residents;P.removeUnordered(G);if(0===P.length)for(G=E.length-2;0<=G&&this._purge(E.data[G],E.data[G+1]);G-=2);};M._nodeIsEmpty=function(G){if(0!==G.terminals.length)return!1;if(null!==G.residents)return 0===G.residents.length;for(let P=0;P<G.children.length;P++)if(G.children[P])return!1;return!0};
M._purge=function(G,P){0<=P&&(G.children[P]=null);return this._nodeIsEmpty(G)?(null===G.residents&&(G.residents=new w({shrink:!0})),!0):!1};M._add=function(G,P){P.advanceTo(this.objectToBoundingSphere(G))?P.node.terminals.push(G):(P.node.residents.push(G),P.node.residents.length>this._maximumObjectsPerNode&&P.depth<this._maximumDepth&&this._split(P))};M._split=function(G){const P=G.node.residents;G.node.residents=null;for(let U=0;U<P.length;U++){const N=q.acquire().init(G);this._add(P.getItemAt(U),
N);q.release(N)}};M._grow=function(G,P){0!==P&&(e(G,P,U=>this.objectToBoundingSphere(U),H),h(H[3])&&!this._fitsInsideTree(H)&&(this._nodeIsEmpty(this._root.node)?(g.copy(H,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize()):(G=this._rootBoundsForRootAsSubNode(H),this._placingRootViolatesMaxDepth(G)?this._rebuildTree(H,G):this._growRootAsSubNode(G),q.release(G))))};M._rebuildTree=function(G,P){n.copy(K,P.bounds);K[3]=P.halfSize;e([G,K],2,U=>
U,I);G=q.acquire().init(this._root);this._root.initFrom(null,I,I[3]);this._root.increaseHalfSize(1.25);this._forEachNode(G,U=>{this.add(U.node.terminals.data,U.node.terminals.length);null!==U.node.residents&&this.add(U.node.residents.data,U.node.residents.length);return!0});q.release(G)};M._placingRootViolatesMaxDepth=function(G){const P=Math.log(G.halfSize/this._root.halfSize)*Math.LOG2E;let U=0;this._forEachNode(this._root,N=>{U=Math.max(U,N.depth);return U+P<=this._maximumDepth});return U+P>this._maximumDepth};
M._rootBoundsForRootAsSubNode=function(G){var P=G[3],U=-Infinity;const N=this._root.bounds,S=this._root.halfSize;for(var Q=0;3>Q;Q++){var W=Math.max(0,Math.ceil((N[Q]-S-(G[Q]-P))/(2*S)));const V=Math.max(0,Math.ceil((G[Q]+P-(N[Q]+S))/(2*S)))+1;U=Math.max(U,2**Math.ceil(Math.log(W+V)*Math.LOG2E));L[Q].min=W;L[Q].max=V}for(G=0;3>G;G++)P=L[G].min,Q=L[G].max,W=(U-(P+Q))/2,P+=Math.ceil(W),Q+=Math.floor(W),v[G]=N[G]-S-P*S*2+(Q+P)*S;U*=S;v[3]=U*D;return q.acquire().initFrom(null,v,U,0)};M._growRootAsSubNode=
function(G){const P=this._root.node;n.copy(H,this._root.bounds);H[3]=this._root.halfSize;this._root.init(G);G.advanceTo(H,null,!0);G.node.children=P.children;G.node.residents=P.residents;G.node.terminals=P.terminals};M._shrink=function(){for(;;){const G=this._findShrinkIndex();if(-1===G)break;this._root.advance(G);this._root.depth=0}};M._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let G=null;const P=this._root.node.children;let U=0,N=0;for(;N<P.length&&
null==G;)U=N++,G=P[U];for(;N<P.length;)if(P[N++])return-1;return U};M._isDegenerate=function(G){G=this.objectToBoundingSphere(G)[3];return!h(G)};M._fitsInsideTree=function(G){const P=this._root.bounds,U=this._root.halfSize;return G[3]<=U&&G[0]>=P[0]-U&&G[0]<=P[0]+U&&G[1]>=P[1]-U&&G[1]<=P[1]+U&&G[2]>=P[2]-U&&G[2]<=P[2]+U};M.toJSON=function(){const {maximumDepth:G,maximumObjectsPerNode:P,_objectCount:U}=this,N=this._nodeToJSON(this._root.node);return{maximumDepth:G,maximumObjectsPerNode:P,objectCount:U,
root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:N}}};M._nodeToJSON=function(G){const P=G.children.map(N=>N?this._nodeToJSON(N):null),U=G.residents?.map(N=>this.objectToBoundingSphere(N));G=G.terminals?.map(N=>this.objectToBoundingSphere(N));return{children:P,residents:U,terminals:G}};J.fromJSON=function(G){const P=new J(U=>U,{maximumDepth:G.maximumDepth,maximumObjectsPerNode:G.maximumObjectsPerNode});P._objectCount=G.objectCount;P._root.initFrom(G.root.node,
G.root.bounds,G.root.halfSize,G.root.depth);return P};a._createClass(J,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return J}(),q=function(){function J(){this.bounds=g.create();
this.halfSize=0;this.initFrom(null,null,0,0)}var M=J.prototype;M.init=function(G){return this.initFrom(G.node,G.bounds,G.halfSize,G.depth)};M.initFrom=function(G,P,U,N=this.depth){this.node=b.isSome(G)?G:J.createEmptyNode();b.isSome(P)&&g.copy(P,this.bounds);this.halfSize=U;this.depth=N;return this};M.increaseHalfSize=function(G){this.halfSize*=G;this.updateBoundsRadiusFromHalfSize()};M.updateBoundsRadiusFromHalfSize=function(){this.bounds[3]=this.halfSize*D};M.advance=function(G){let P=this.node.children[G];
P||(P=J.createEmptyNode(),this.node.children[G]=P);this.node=P;this.halfSize/=2;this.depth++;G=y[G];this.bounds[0]+=G[0]*this.halfSize;this.bounds[1]+=G[1]*this.halfSize;this.bounds[2]+=G[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();return this};M.advanceTo=function(G,P,U=!1){for(;;){if(this.isTerminalFor(G))return P&&P(this,-1),!0;if(this.isLeaf()){if(!U)return P&&P(this,-1),!1;this.node.residents=null}const N=this._childIndex(G);P&&P(this,N);this.advance(N)}};M.isLeaf=function(){return null!=
this.node.residents};M.isTerminalFor=function(G){return G[3]>this.halfSize/2};M._childIndex=function(G){const P=this.bounds;return(P[0]<G[0]?1:0)+(P[1]<G[1]?2:0)+(P[2]<G[2]?4:0)};J.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new w({shrink:!0}),residents:new w({shrink:!0})}};J.acquire=function(){return J._pool.acquire()};J.release=function(G){J._pool.release(G)};J.clearPool=function(){J._pool.prune()};return a._createClass(J)}();q._pool=new c(q);(function(J){J=
J.DepthOrder||(J.DepthOrder={});J[J.FRONT_TO_BACK=1]="FRONT_TO_BACK";J[J.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(r||(r={}));const y=[x.fromValues(-1,-1,-1),x.fromValues(1,-1,-1),x.fromValues(-1,1,-1),x.fromValues(1,1,-1),x.fromValues(-1,-1,1),x.fromValues(1,-1,1),x.fromValues(-1,1,1),x.fromValues(1,1,1)],B=[x.fromValues(-1,-1,-1),x.fromValues(-1,-1,1),x.fromValues(-1,1,-1),x.fromValues(-1,1,1),x.fromValues(1,-1,-1),x.fromValues(1,-1,1),x.fromValues(1,1,-1),x.fromValues(1,1,1)],D=Math.sqrt(3),z=[null],
v=g.create(),A=x.create(),t=x.create(),C=x.create(),E=new w,F=g.create(),H=g.create(),K=g.create(),I=g.create(),L=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],R=new w,O=[0,0,0,0,0,0,0,0];return r})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var b=a.UpdatePolicy||(a.UpdatePolicy={});b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){function E(ja,ka,da,ha,ca){for(let fa=0;fa<ca;fa++)da[ha++]=ja[ka++];return ha}function F(ja,ka,da){ka=ka.get(D.VertexAttribute.POSITION).data;da=da?da.get(D.VertexAttribute.POSITION):null;return ja.isClosed?da?2<da.length:6<ka.length:!1}var H;(function(ja){ja[ja.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ja[ja.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ja[ja.LEFT_CAP_START=-4]="LEFT_CAP_START";ja[ja.LEFT_CAP_END=-5]="LEFT_CAP_END";ja[ja.RIGHT_JOIN_START=
2]="RIGHT_JOIN_START";ja[ja.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ja[ja.RIGHT_CAP_START=4]="RIGHT_CAP_START";ja[ja.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(H||(H={}));let K=function(ja){function ka(ha){ha=da.call(this,ha,new L);ha._configuration=new C.RibbonLineTechniqueConfiguration;ha._vertexAttributeLocations=t.vertexAttributeLocations;ha._layout=ha.createLayout();return ha}b._inherits(ka,ja);var da=b._createSuper(ka);ja=ka.prototype;ja.isClosed=function(ha,ca){return this.parameters.isClosed?ca?2<ca.length:
6<ha.length:!1};ja.getConfiguration=function(ha,ca){this._configuration.output=ha;this._configuration.draped=ca.slot===y.RenderSlot.DRAPED_MATERIAL;ha=x.isSome(this.parameters.stipplePattern)&&ha!==h.ShaderOutput.Highlight;this._configuration.stippleEnabled=ha;this._configuration.stippleOffColorEnabled=ha&&x.isSome(this.parameters.stippleOffColor);this._configuration.stippleScaleWithLineWidth=ha&&this.parameters.stippleScaleWithLineWidth;this._configuration.stipplePreferContinuous=ha&&this.parameters.stipplePreferContinuous;
this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;ha=this._configuration;if(x.isSome(this.parameters.markerParameters)){var fa=this.parameters.markerParameters;fa=fa.anchor===v.LineMarkerAnchor.Tip&&fa.hideOnShortSegments&&"begin-end"===fa.placement&&fa.worldSpace}else fa=!1;ha.applyMarkerOffset=fa;this._configuration.hasPolygonOffset=
this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&x.isSome(this.parameters.innerColor);this._configuration.falloffEnabled=0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil;
this._configuration.transparencyPassType=ca.transparencyPassType;this._configuration.hasMultipassTerrain=ca.multipassTerrain.enabled;this._configuration.cullAboveGround=ca.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration};ja.intersectDraped=function(ha,ca,fa,ma,qa,wa){if(fa.options.selectionMode){ca=ha.vertexAttributes.get(D.VertexAttribute.POSITION).data;fa=ha.vertexAttributes.get(D.VertexAttribute.SIZE);var xa=this.parameters.width;
this.parameters.vvSize?(fa=ha.vertexAttributes.get(D.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],xa*=n.clamp(this.parameters.vvSize.offset[0]+fa*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):fa&&(xa*=fa.data[0]);fa=ma[0];ma=ma[1];ha=(xa/2+4)*ha.screenToWorldRatio;xa=Number.MAX_VALUE;var pa=0;for(let Ha=0;Ha<ca.length-5;Ha+=3){var ra=ca[Ha],va=ca[Ha+1],Ba=fa-ra,Aa=ma-va;ra=ca[Ha+3]-ra;va=ca[Ha+4]-va;const Ka=n.clamp((ra*Ba+va*Aa)/(ra*ra+va*
va),0,1);Ba=ra*Ka-Ba;Aa=va*Ka-Aa;Aa=Ba*Ba+Aa*Aa;Aa<xa&&(xa=Aa,pa=Ha/3)}xa<ha*ha&&qa(wa.dist,wa.normal,pa,!1)}};ja.intersect=function(ha,ca,fa,ma,qa,wa){if(fa.options.selectionMode&&ha.visible)if(B.isTranslationMatrix(ca)){var xa=ha.vertexAttributes;qa=xa.get(D.VertexAttribute.POSITION).data;ma=this.parameters.width;if(this.parameters.vvSize){var pa=xa.get(D.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];ma*=n.clamp(this.parameters.vvSize.offset[0]+pa*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],
this.parameters.vvSize.maxSize[0])}else xa.has(D.VertexAttribute.SIZE)&&(ma*=xa.get(D.VertexAttribute.SIZE).data[0]);var ra=fa.camera,va=P;l.copy(va,fa.point);pa=ma*ra.pixelRatio/2+4*ra.pixelRatio;g.set(Y[0],va[0]-pa,va[1]+pa,0);g.set(Y[1],va[0]+pa,va[1]+pa,0);g.set(Y[2],va[0]+pa,va[1]-pa,0);g.set(Y[3],va[0]-pa,va[1]-pa,0);for(ma=0;4>ma;ma++)if(!ra.unprojectFromRenderScreen(Y[ma],aa[ma]))return;u.fromPoints(ra.eye,aa[0],aa[1],ia);u.fromPoints(ra.eye,aa[1],aa[2],na);u.fromPoints(ra.eye,aa[2],aa[3],
ba);u.fromPoints(ra.eye,aa[3],aa[0],ea);var Ba=Number.MAX_VALUE;ma=0;ha=F(this.parameters,xa,ha.indices)?qa.length-2:qa.length-5;for(xa=0;xa<ha;xa+=3){O[0]=qa[xa]+ca[12];O[1]=qa[xa+1]+ca[13];O[2]=qa[xa+2]+ca[14];var Aa=(xa+3)%qa.length;J[0]=qa[Aa]+ca[12];J[1]=qa[Aa+1]+ca[13];J[2]=qa[Aa+2]+ca[14];if(!(0>u.signedDistance(ia,O)&&0>u.signedDistance(ia,J)||0>u.signedDistance(na,O)&&0>u.signedDistance(na,J)||0>u.signedDistance(ba,O)&&0>u.signedDistance(ba,J)||0>u.signedDistance(ea,O)&&0>u.signedDistance(ea,
J))){ra.projectToRenderScreen(O,U);ra.projectToRenderScreen(J,N);if(0>U[2]&&0<N[2])g.subtract(M,O,J),Aa=ra.frustum,Aa=-u.signedDistance(Aa[e.PlaneIndex.NEAR],O)/g.dot(M,u.normal(Aa[e.PlaneIndex.NEAR])),g.scale(M,M,Aa),g.add(O,O,M),ra.projectToRenderScreen(O,U);else if(0<U[2]&&0>N[2])g.subtract(M,J,O),Aa=ra.frustum,Aa=-u.signedDistance(Aa[e.PlaneIndex.NEAR],J)/g.dot(M,u.normal(Aa[e.PlaneIndex.NEAR])),g.scale(M,M,Aa),g.add(J,J,M),ra.projectToRenderScreen(J,N);else if(0>U[2]&&0>N[2])continue;U[2]=0;
N[2]=0;Aa=k.distance2(k.fromPoints(U,N,W),va);Aa<Ba&&(Ba=Aa,g.copy(S,O),g.copy(Q,J),ma=xa/3)}}ca=fa.rayBegin;fa=fa.rayEnd;Ba<pa*pa&&(qa=Number.MAX_VALUE,k.closestLineSegmentPoint(k.fromPoints(S,Q,W),k.fromPoints(ca,fa,V),G)&&(g.subtract(G,G,ca),qa=g.length(G),g.scale(G,G,1/qa),qa/=g.distance(ca,fa)),wa(qa,G,ma,!1))}else w.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")};ja.createLayout=function(){const ha=p.newLayout().vec3f(D.VertexAttribute.POSITION).f32(D.VertexAttribute.SUBDIVISIONFACTOR).vec2f(D.VertexAttribute.UV0).vec3f(D.VertexAttribute.AUXPOS1).vec3f(D.VertexAttribute.AUXPOS2);
this.parameters.vvSize?ha.f32(D.VertexAttribute.SIZEFEATUREATTRIBUTE):ha.f32(D.VertexAttribute.SIZE);this.parameters.vvColor?ha.f32(D.VertexAttribute.COLORFEATUREATTRIBUTE):ha.vec4f(D.VertexAttribute.COLOR);this.parameters.vvOpacity&&ha.f32(D.VertexAttribute.OPACITYFEATUREATTRIBUTE);c("enable-feature:objectAndLayerId-rendering")&&ha.vec4u8(D.VertexAttribute.OBJECTANDLAYERIDCOLOR);return ha};ja.createBufferWriter=function(){return new R(this._layout,this.parameters)};ja.requiresSlot=function(ha,ca){return ca===
h.ShaderOutput.Color||ca===h.ShaderOutput.Alpha||ca===h.ShaderOutput.Highlight||ca===h.ShaderOutput.Depth||ca===h.ShaderOutput.ObjectAndLayerIdColor?ha===y.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil?ha===y.RenderSlot.OPAQUE_MATERIAL||ha===y.RenderSlot.OCCLUDER_MATERIAL||ha===y.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:ca===h.ShaderOutput.Color||ca===h.ShaderOutput.Alpha?ha===(this.parameters.writeDepth?y.RenderSlot.TRANSPARENT_MATERIAL:
y.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):ha===y.RenderSlot.OPAQUE_MATERIAL:!1};ja.createGLMaterial=function(ha){return new I(ha)};ja.validateParameters=function(ha){"miter"!==ha.join&&(ha.miterLimit=0);x.isSome(ha.markerParameters)&&(ha.markerScale=ha.markerParameters.width/ha.width)};return b._createClass(ka)}(q.Material),I=function(ja){function ka(){var ha=da.apply(this,arguments);ha._stipplePattern=null;return ha}b._inherits(ka,ja);var da=b._createSuper(ka);ja=ka.prototype;ja.dispose=
function(){b._get(b._getPrototypeOf(ka.prototype),"dispose",this).call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};ja._updateOccludeeState=function(ha){ha.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ha.hasOccludees})};ja.beginSlot=function(ha){this._output!==h.ShaderOutput.Color&&this._output!==h.ShaderOutput.Alpha||this._updateOccludeeState(ha);const ca=this._material.parameters.stipplePattern;
this._stipplePattern!==ca&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,ca)),this._stipplePattern=ca);return this.ensureTechnique(t.RibbonLineTechnique,ha)};return b._createClass(ka)}(r),L=function(ja){function ka(){var ha=da.apply(this,arguments);ha.width=0;ha.color=d.ONES;ha.join="miter";ha.cap=C.CapType.BUTT;ha.miterLimit=5;ha.writeDepth=!0;ha.hasPolygonOffset=!1;ha.stippleTexture=null;ha.stippleScaleWithLineWidth=!1;ha.stipplePreferContinuous=!0;ha.markerParameters=
null;ha.markerScale=1;ha.hasSlicePlane=!1;ha.vvFastUpdate=!1;ha.isClosed=!1;ha.falloff=0;ha.innerWidth=0;ha.hasOccludees=!1;ha.wireframe=!1;return ha}b._inherits(ka,ja);var da=b._createSuper(ka);return b._createClass(ka)}(z.VisualVariablePassParameters),R=function(){function ja(da,ha){this._parameters=ha;this.numJoinSubdivisions=0;this.vertexBufferLayout=da;da=ha.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=da;break;case "round":this.numJoinSubdivisions=
A.RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS+da}}var ka=ja.prototype;ka._isClosed=function(da){return F(this._parameters,da.vertexAttributes,da.indices)};ka.allocate=function(da){return this.vertexBufferLayout.createBuffer(da)};ka.elementCount=function(da){var ha=da.indices.get(D.VertexAttribute.POSITION).length/2+1;da=this._isClosed(da);ha=(da?2:4)+((da?ha:ha-1)-(da?0:1))*(2*this.numJoinSubdivisions+4);ha+=2;this._parameters.wireframe&&(ha=2+4*(ha-2));return ha};ka.write=function(da,ha,ca,fa,ma){ha=
T;const qa=X,wa=Z,xa=ca.vertexAttributes.get(D.VertexAttribute.POSITION).data;var pa=ca.indices&&ca.indices.get(D.VertexAttribute.POSITION);const ra=ca.vertexAttributes.get(D.VertexAttribute.DISTANCETOSTART)?.data;pa&&pa.length!==2*(xa.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let va=1,Ba=0;this._parameters.vvSize?Ba=ca.vertexAttributes.get(D.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:ca.vertexAttributes.has(D.VertexAttribute.SIZE)&&(va=ca.vertexAttributes.get(D.VertexAttribute.SIZE).data[0]);
let Aa=[1,1,1,1],Ha=0;this._parameters.vvColor?Ha=ca.vertexAttributes.get(D.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ca.vertexAttributes.has(D.VertexAttribute.COLOR)&&(Aa=ca.vertexAttributes.get(D.VertexAttribute.COLOR).data);const Ka=c("enable-feature:objectAndLayerId-rendering")?ca.objectAndLayerIdColor:null;let Pa=0;this._parameters.vvOpacity&&(Pa=ca.vertexAttributes.get(D.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);pa=xa.length/3;const Ra=new Float32Array(fa.buffer),Sa=c("enable-feature:objectAndLayerId-rendering")?
new Uint8Array(fa.buffer):null,La=this.vertexBufferLayout.stride/4;let Ua=ma*La;ma=Ua;let Za=0;const Xa=ra?(oa,ua,Da)=>Za=ra[Da]:(oa,ua,Da)=>Za+=g.distance(oa,ua),la=c("enable-feature:objectAndLayerId-rendering"),Ta=(oa,ua,Da,Ia,Na,ab,cb)=>{Ra[Ua++]=ua[0];Ra[Ua++]=ua[1];Ra[Ua++]=ua[2];Ra[Ua++]=Ia;Ra[Ua++]=cb;Ra[Ua++]=Na;Ra[Ua++]=oa[0];Ra[Ua++]=oa[1];Ra[Ua++]=oa[2];Ra[Ua++]=Da[0];Ra[Ua++]=Da[1];Ra[Ua++]=Da[2];Ra[Ua++]=this._parameters.vvSize?Ba:va;this._parameters.vvColor?Ra[Ua++]=Ha:(oa=Math.min(4*
ab,Aa.length-4),Ra[Ua++]=Aa[oa],Ra[Ua++]=Aa[oa+1],Ra[Ua++]=Aa[oa+2],Ra[Ua++]=Aa[oa+3]);this._parameters.vvOpacity&&(Ra[Ua++]=Pa);la&&(x.isSome(Ka)&&(Sa[4*Ua]=Ka[0],Sa[4*Ua+1]=Ka[1],Sa[4*Ua+2]=Ka[2],Sa[4*Ua+3]=Ka[3]),Ua++)};Ua+=La;g.set(qa,xa[0],xa[1],xa[2]);da&&g.transformMat4(qa,qa,da);if(ca=this._isClosed(ca)){var Ma=xa.length-3;g.set(ha,xa[Ma],xa[Ma+1],xa[Ma+2]);da&&g.transformMat4(ha,ha,da)}else g.set(wa,xa[3],xa[4],xa[5]),da&&g.transformMat4(wa,wa,da),Ta(qa,qa,wa,1,H.LEFT_CAP_START,0,0),Ta(qa,
qa,wa,1,H.RIGHT_CAP_START,0,0),g.copy(ha,qa),g.copy(qa,wa);Ma=ca?0:1;const fb=ca?pa:pa-1;for(let oa=Ma;oa<fb;oa++){var ya=(oa+1)%pa*3;g.set(wa,xa[ya],xa[ya+1],xa[ya+2]);da&&g.transformMat4(wa,wa,da);Xa(ha,qa,oa);Ta(ha,qa,wa,0,H.LEFT_JOIN_END,oa,Za);Ta(ha,qa,wa,0,H.RIGHT_JOIN_END,oa,Za);ya=this.numJoinSubdivisions;for(let ua=0;ua<ya;++ua){const Da=(ua+1)/(ya+1);Ta(ha,qa,wa,Da,H.LEFT_JOIN_END,oa,Za);Ta(ha,qa,wa,Da,H.RIGHT_JOIN_END,oa,Za)}Ta(ha,qa,wa,1,H.LEFT_JOIN_START,oa,Za);Ta(ha,qa,wa,1,H.RIGHT_JOIN_START,
oa,Za);g.copy(ha,qa);g.copy(qa,wa)}ca?(g.set(wa,xa[3],xa[4],xa[5]),da&&g.transformMat4(wa,wa,da),Za=Xa(ha,qa,fb),Ta(ha,qa,wa,0,H.LEFT_JOIN_END,Ma,Za),Ta(ha,qa,wa,0,H.RIGHT_JOIN_END,Ma,Za)):(Za=Xa(ha,qa,fb),Ta(ha,qa,qa,0,H.LEFT_CAP_END,fb,Za),Ta(ha,qa,qa,0,H.RIGHT_CAP_END,fb,Za));E(Ra,ma+La,Ra,ma,La);Ua=E(Ra,Ua-La,Ra,Ua,La);this._parameters.wireframe&&this._addWireframeVertices(fa,ma,Ua,La)};ka._addWireframeVertices=function(da,ha,ca,fa){const ma=new Float32Array(da.buffer,ca*Float32Array.BYTES_PER_ELEMENT);
da=new Float32Array(da.buffer,ha*Float32Array.BYTES_PER_ELEMENT,ca-ha);ha=0;for(ca=0;ca<da.length-1;ca+=2*fa)ha=E(da,ca,ma,ha,fa),ha=E(da,ca+2*fa,ma,ha,fa),ha=E(da,ca+1*fa,ma,ha,fa),ha=E(da,ca+2*fa,ma,ha,fa),ha=E(da,ca+1*fa,ma,ha,fa),ha=E(da,ca+3*fa,ma,ha,fa)};return b._createClass(ja)}();const O=f.create(),J=f.create(),M=f.create(),G=f.create(),P=f.create(),U=m.createRenderScreenPointArray3(),N=m.createRenderScreenPointArray3(),S=f.create(),Q=f.create(),W=k.create(),V=k.create(),T=f.create(),X=f.create(),
Z=f.create(),Y=[m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3()],aa=[f.create(),f.create(),f.create(),f.create()],ia=u.create(),na=u.create(),ba=u.create(),ea=u.create();a.Parameters=L;a.RibbonLineMaterial=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m){a.LineMarkerSpace=void 0;(function(l){l[l.Draped=0]="Draped";l[l.Screen=1]="Screen";l[l.World=2]="World";l[l.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(l){l[l.Center=0]="Center";l[l.Tip=1]="Tip";l[l.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));m=function(l){function g(){var d=f.apply(this,arguments);d.output=w.ShaderOutput.Color;d.transparencyPassType=x.TransparencyPassType.NONE;d.occluder=!1;d.hasSlicePlane=
!1;d.writeDepth=!1;d.space=a.LineMarkerSpace.Screen;d.hideOnShortSegments=!1;d.hasCap=!1;d.anchor=a.LineMarkerAnchor.Center;d.hasTip=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.hasOccludees=!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(m.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:w.ShaderOutput.COUNT})],m.prototype,"output",void 0);c.__decorate([n.parameter({count:x.TransparencyPassType.COUNT})],m.prototype,
"transparencyPassType",void 0);c.__decorate([n.parameter()],m.prototype,"occluder",void 0);c.__decorate([n.parameter()],m.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],m.prototype,"writeDepth",void 0);c.__decorate([n.parameter({count:a.LineMarkerSpace.COUNT})],m.prototype,"space",void 0);c.__decorate([n.parameter()],m.prototype,"hideOnShortSegments",void 0);c.__decorate([n.parameter()],m.prototype,"hasCap",void 0);c.__decorate([n.parameter({count:a.LineMarkerAnchor.COUNT})],m.prototype,
"anchor",void 0);c.__decorate([n.parameter()],m.prototype,"hasTip",void 0);c.__decorate([n.parameter()],m.prototype,"vvSize",void 0);c.__decorate([n.parameter()],m.prototype,"vvColor",void 0);c.__decorate([n.parameter()],m.prototype,"vvOpacity",void 0);c.__decorate([n.parameter()],m.prototype,"hasOccludees",void 0);c.__decorate([n.parameter()],m.prototype,"hasMultipassTerrain",void 0);c.__decorate([n.parameter()],m.prototype,"cullAboveGround",void 0);c.__decorate([n.parameter({constValue:!0})],m.prototype,
"hasVvInstancing",void 0);c.__decorate([n.parameter({constValue:!0})],m.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){function C(F){const H=new D.ShaderBuilder,{vertex:K,fragment:I}=H,L=F.hasMultipassTerrain&&(F.output===w.ShaderOutput.Color||F.output===w.ShaderOutput.Alpha);H.include(e.PiUtils);H.include(m.RibbonVertexPosition,F);H.include(g.LineStipple,F);const R=F.applyMarkerOffset&&!F.draped;R&&(K.uniforms.add(new q.FloatPassUniform("markerScale",N=>N.markerScale)),H.include(f.MarkerSizing,{space:A.LineMarkerSpace.World}));F.output===w.ShaderOutput.Depth&&
H.include(l.OutputDepth,F);H.include(x.ObjectAndLayerIdColor,F);p.addProjViewLocalOrigin(K,F);K.uniforms.add([new B.Matrix4PassUniform("inverseProjectionMatrix",(N,S)=>S.camera.inverseProjectionMatrix),new h.Float2PassUniform("nearFar",(N,S)=>S.camera.nearFar),new q.FloatPassUniform("miterLimit",N=>"miter"!==N.join?0:N.miterLimit),new r.Float4PassUniform("viewport",(N,S)=>S.camera.fullViewport)]);K.constants.add("LARGE_HALF_FLOAT","float",65500);H.attributes.add(v.VertexAttribute.POSITION,"vec3");
H.attributes.add(v.VertexAttribute.SUBDIVISIONFACTOR,"float");H.attributes.add(v.VertexAttribute.UV0,"vec2");H.attributes.add(v.VertexAttribute.AUXPOS1,"vec3");H.attributes.add(v.VertexAttribute.AUXPOS2,"vec3");H.varyings.add("vColor","vec4");H.varyings.add("vpos","vec3");c.addLinearDepth(H);L&&H.varyings.add("depth","float");const O=F.capType===t.CapType.ROUND,J=F.stippleEnabled&&F.stippleScaleWithLineWidth||O;J&&H.varyings.add("vLineWidth","float");const M=F.stippleEnabled&&F.stippleScaleWithLineWidth;
M&&H.varyings.add("vLineSizeInv","float");const G=F.innerColorEnabled||O;G&&H.varyings.add("vLineDistance","float");const P=F.stippleEnabled&&O,U=F.falloffEnabled||P;U&&H.varyings.add("vLineDistanceNorm","float");O&&(H.varyings.add("vSegmentSDF","float"),H.varyings.add("vReverseSegmentSDF","float"));K.code.add(y.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);K.code.add(y.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);c.addCalculateLinearDepth(H);K.code.add(y.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${L?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);K.uniforms.add(new q.FloatPassUniform("pixelRatio",(N,S)=>S.camera.pixelRatio));K.code.add(y.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${J?y.glsl`vLineWidth = lineWidth;`:""}
      ${M?y.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `);R&&K.code.add(y.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);K.code.add(y.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(F.stippleEnabled||O)&&K.code.add(y.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${O?y.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);K.code.add(y.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);F.roundJoins?K.code.add(y.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${F.stippleEnabled?y.glsl`min(1.0, subdivisionFactor * ${y.glsl.float(1.5)})`:y.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):K.code.add(y.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);K.code.add(y.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${F.capType!==t.CapType.BUTT?y.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);K.code.add(y.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${U||G?y.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${G?y.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${U?y.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);O&&K.code.add(y.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);F.stippleEnabled&&(F.draped?K.uniforms.add(new q.FloatPassUniform("worldToScreenRatio",(N,S)=>1/S.screenToPCSRatio)):K.code.add(y.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),K.code.add(y.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),F.draped?K.code.add(y.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):K.code.add(y.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),K.uniforms.add(new q.FloatPassUniform("stipplePatternPixelSize",N=>g.computePixelSize(N))),K.code.add(y.glsl`
      float patternLength = ${F.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));K.code.add(y.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${F.wireframe&&!F.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);L&&H.include(d.multipassTerrainTest,F);H.include(n.SliceDraw,F);I.include(u.ColorConversion);I.code.add(y.glsl`
  void main() {
    discardBySlice(vpos);
    ${L?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);F.wireframe?I.code.add(y.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(O&&I.code.add(y.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${y.glsl.float(k.symbolAlphaCutoff)}) {
        discard;
      }
    `),P?I.code.add(y.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${y.glsl.float(k.symbolAlphaCutoff)}, stippleCoverage);
      `):I.code.add(y.glsl`float stippleAlpha = getStippleAlpha();`),I.uniforms.add(new r.Float4PassUniform("intrinsicColor",N=>N.color)),F.output!==w.ShaderOutput.ObjectAndLayerIdColor&&I.code.add(y.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),I.code.add(y.glsl`vec4 color = intrinsicColor * vColor;`),F.innerColorEnabled&&(I.uniforms.add(new r.Float4PassUniform("innerColor",N=>b.unwrapOr(N.innerColor,N.color))),I.uniforms.add(new q.FloatPassUniform("innerWidth",(N,S)=>N.innerWidth*
S.camera.pixelRatio)),I.code.add(y.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),I.code.add(y.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),F.falloffEnabled&&(I.uniforms.add(new q.FloatPassUniform("falloff",N=>N.falloff)),I.code.add(y.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));I.code.add(y.glsl`
    ${F.output===w.ShaderOutput.ObjectAndLayerIdColor?y.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${y.glsl.float(k.symbolAlphaCutoff)}) {
      discard;
    }

    ${F.output===w.ShaderOutput.Alpha?y.glsl`fragColor = vec4(finalColor.a);`:""}
    ${F.output===w.ShaderOutput.Color?y.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${F.output===w.ShaderOutput.Color&&F.transparencyPassType===z.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${F.output===w.ShaderOutput.Highlight?y.glsl`fragColor = vec4(1.0);`:""}
    ${F.output===w.ShaderOutput.Depth?y.glsl`outputDepth(linearDepth);`:""}
    ${F.output===w.ShaderOutput.ObjectAndLayerIdColor?y.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return H}const E=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:1,build:C},Symbol.toStringTag,{value:"Module"}));a.RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLine=E;a.build=C})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m){a.RibbonVertexPosition=function(l,g){const f=l.vertex;f.uniforms.add(new w.FloatPassUniform("intrinsicWidth",d=>d.width));g.vvSize?(l.attributes.add(m.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),f.uniforms.add(new c.Float3PassUniform("vvSizeMinSize",d=>d.vvSize.minSize)),f.uniforms.add(new c.Float3PassUniform("vvSizeMaxSize",d=>d.vvSize.maxSize)),f.uniforms.add(new c.Float3PassUniform("vvSizeOffset",d=>d.vvSize.offset)),f.uniforms.add(new c.Float3PassUniform("vvSizeFactor",
d=>d.vvSize.factor)),f.code.add(x.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(l.attributes.add(m.VertexAttribute.SIZE,"float"),f.code.add(x.glsl`float getSize(){
return intrinsicWidth * size;
}`));g.vvOpacity?(l.attributes.add(m.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),f.constants.add("vvOpacityNumber","int",8),f.uniforms.add([new n.FloatsPassUniform("vvOpacityValues",d=>d.vvOpacity.values,8),new n.FloatsPassUniform("vvOpacityOpacities",d=>d.vvOpacity.opacityValues,8)]),f.code.add(x.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):f.code.add(x.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);g.vvColor?(l.include(b.VisualVariables,g),l.attributes.add(m.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),f.code.add(x.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(l.attributes.add(m.VertexAttribute.COLOR,"vec4"),f.code.add(x.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,w){a.OutputDepth=function(n,x){n.fragment.include(c.RgbaFloatEncoding);switch(x.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:n.fragment.code.add(w.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case b.ShaderOutput.Depth:n.fragment.code.add(w.glsl`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../../../../../../core/maybe ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/StippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(a,b,c,w,n,x,
m,l,g,f){function d(u,p){const h=!(p.draped&&p.stipplePreferContinuous),{vertex:r,fragment:q}=u;q.include(c.RgbaFloatEncoding);p.draped||(w.addCameraPosition(r,p),r.uniforms.add(new x.FloatPassUniform("worldToScreenPerDistanceRatio",(y,B)=>1/B.camera.perScreenPixelRatio)),r.code.add(m.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));u.varyings.add("vStippleDistance","float");p.stippleRequiresClamp&&u.varyings.add("vStippleDistanceLimits","vec2");p.stippleRequiresStretchMeasure&&u.varyings.add("vStipplePatternStretch","float");r.code.add(m.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${k};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);r.code.add(m.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);r.code.add(m.glsl`
    if (segmentLengthPseudoScreen >= ${h?"patternLength":"1e4"}) {
  `);r.uniforms.add(new x.FloatPassUniform("pixelRatio",(y,B)=>B.camera.pixelRatio));r.code.add(m.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${p.stippleRequiresStretchMeasure?m.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);q.constants.add("stippleTexturePadding","float",g.STIPPLE_TEXTURE_PADDING);q.uniforms.add(new l.Texture2DPassUniform("stipplePatternTexture",y=>y.stippleTexture));q.uniforms.add([new x.FloatPassUniform("stipplePatternSDFNormalizer",y=>{y=y.stipplePattern;return b.isSome(y)?(Math.floor(.5*(g.computeLongestPattern(y)-1))+.5)/y.pixelRatio:1}),new x.FloatPassUniform("stipplePatternPixelSizeInv",y=>1/e(y))]);q.code.add(m.glsl`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`);q.code.add(m.glsl`
    float getStippleSDF(out bool isClamped) {
      ${p.stippleRequiresClamp?m.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:m.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${p.stippleScaleWithLineWidth?m.glsl`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${p.stippleRequiresStretchMeasure?m.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:m.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${p.stippleScaleWithLineWidth?m.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:m.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);p.stippleOffColorEnabled?(q.uniforms.add(new n.Float4PassUniform("stippleOffColor",y=>f.ensureColor4(y.stippleOffColor))),q.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):q.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function e(u){const p=u.stipplePattern;return b.isSome(p)?g.computeTextureSize(u.stipplePattern)/p.pixelRatio:1}const k=m.glsl.float(.4);a.LineStipple=function(u,p){u.constants.add("stippleAlphaColorDiscard","float",.001);u.constants.add("stippleAlphaHighlightDiscard","float",.5);p.stippleEnabled?d(u,p):u.fragment.code.add(m.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../core/shaderModules/interfaces ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,b,c,w,n,x,m){function l(k){return k.pattern.map(u=>Math.round(u*k.pixelRatio))}
function g(k){if(w.isNone(k))return 1;k=l(k);return Math.floor(k.reduce((u,p)=>u+p))}function f(k){return l(k).reduce((u,p)=>Math.max(u,p))}let d=function(){function k(p){this._rctx=p;this._cache=new Map}var u=k.prototype;u.destroy=function(){this._cache.forEach(p=>w.disposeMaybe(p.stippleTexture));this._cache.clear()};u._acquire=function(p){if(w.isNone(p))return null;const h=this._patternId(p);var r=this._cache.get(h);if(r)return r.refCount++,r;var q=l(p),y=1/p.pixelRatio;r=g(p);p=f(p);const B=(Math.floor(.5*
(p-1))+.5)*y;p=[];let D=1;for(var z of q){for(let C=0;C<z;C++)p.push(D*(Math.min(C,z-1-C)+.5)*y/B*.5+.5);D=-D}z=Math.round(q[0]/2);z=[...p.slice(z),...p.slice(0,z)];r+=2;q=new Uint8Array(4*r);y=4;for(var v of z)c.packFloatRGBA(v,q,y),y+=4;q.copyWithin(0,y-4,y);q.copyWithin(y,4,8);const {encodedData:A,paddedPixels:t}={encodedData:q,paddedPixels:r};v=new e(new m.Texture(this._rctx,{width:t,height:1,internalFormat:x.PixelFormat.RGBA,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE},
A));this._cache.set(h,v);return v};u.release=function(p){if(!w.isNone(p)){p=this._patternId(p);var h=this._cache.get(p);h&&(h.refCount--,0===h.refCount&&(w.isSome(h.stippleTexture)&&h.stippleTexture.dispose(),this._cache.delete(p)))}};u.swap=function(p,h){h=this._acquire(h);this.release(p);return h};u._patternId=function(p){return`${p.pattern.join(",")}-r${p.pixelRatio}`};return b._createClass(k)}(),e=function(k){function u(h){var r=p.call(this);r.stippleTexture=h;r.refCount=1;return r}b._inherits(u,
k);var p=b._createSuper(u);return b._createClass(u)}(n.NoParameters);a.STIPPLE_TEXTURE_PADDING=2;a.StippleTextureRepository=d;a.computeLongestPattern=f;a.computeTextureSize=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../core/maybe","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,w){const n=w.create();a.ensureColor4=function(x){return b.isNone(x)?w.ZEROS:4===x.length?
x:c.set(n,x[0],x[1],x[2],1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../../../core/maybe ../../../../support/engineContent/marker ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),function(a,b,c,w,n,x){a.MarkerSizing=function(m,l){const g=m.vertex;m.constants.add("markerSizePerLineWidth",
"float",c.MARKER_SIZE_PER_LINE_WIDTH);g.uniforms.add(new w.FloatPassUniform("pixelRatio",(f,d)=>d.camera.pixelRatio));b.isNone(g.uniforms.get("markerScale"))&&g.constants.add("markerScale","float",1);g.code.add(n.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);l.space===x.LineMarkerSpace.World&&(g.constants.add("maxSegmentLengthFraction","float",.45),g.uniforms.add(new w.FloatPassUniform("perRenderPixelRatio",(f,d)=>d.camera.perRenderPixelRatio)),g.code.add(n.glsl`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives"],function(a,b){a.MARKER_SIZE_PER_LINE_WIDTH=10;a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.MARKER_TIP_THICKNESS_FACTOR=.25;a.prepareMarkerResources=function(c,w){return c.fromData(`${w}-marker`,()=>b.createTexture(w,64,32,6.4))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m){a.CapType=void 0;(function(l){l[l.BUTT=0]="BUTT";l[l.SQUARE=1]="SQUARE";l[l.ROUND=2]="ROUND";l[l.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));m=function(l){function g(){var d=f.apply(this,arguments);d.output=w.ShaderOutput.Color;d.capType=a.CapType.BUTT;d.transparencyPassType=x.TransparencyPassType.NONE;d.occluder=!1;d.hasSlicePlane=!1;d.hasPolygonOffset=!1;d.writeDepth=!1;d.draped=!1;d.stippleEnabled=!1;d.stippleOffColorEnabled=!1;d.stippleScaleWithLineWidth=!1;d.stipplePreferContinuous=
!0;d.roundJoins=!1;d.applyMarkerOffset=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.falloffEnabled=!1;d.innerColorEnabled=!1;d.hasOccludees=!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;d.wireframe=!1;d.objectAndLayerIdColorInstanced=!1;return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(m.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:w.ShaderOutput.COUNT})],m.prototype,"output",void 0);c.__decorate([n.parameter({count:a.CapType.COUNT})],m.prototype,"capType",
void 0);c.__decorate([n.parameter({count:x.TransparencyPassType.COUNT})],m.prototype,"transparencyPassType",void 0);c.__decorate([n.parameter()],m.prototype,"occluder",void 0);c.__decorate([n.parameter()],m.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],m.prototype,"hasPolygonOffset",void 0);c.__decorate([n.parameter()],m.prototype,"writeDepth",void 0);c.__decorate([n.parameter()],m.prototype,"draped",void 0);c.__decorate([n.parameter()],m.prototype,"stippleEnabled",void 0);c.__decorate([n.parameter()],
m.prototype,"stippleOffColorEnabled",void 0);c.__decorate([n.parameter()],m.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([n.parameter()],m.prototype,"stipplePreferContinuous",void 0);c.__decorate([n.parameter()],m.prototype,"roundJoins",void 0);c.__decorate([n.parameter()],m.prototype,"applyMarkerOffset",void 0);c.__decorate([n.parameter()],m.prototype,"vvSize",void 0);c.__decorate([n.parameter()],m.prototype,"vvColor",void 0);c.__decorate([n.parameter()],m.prototype,"vvOpacity",void 0);
c.__decorate([n.parameter()],m.prototype,"falloffEnabled",void 0);c.__decorate([n.parameter()],m.prototype,"innerColorEnabled",void 0);c.__decorate([n.parameter()],m.prototype,"hasOccludees",void 0);c.__decorate([n.parameter()],m.prototype,"hasMultipassTerrain",void 0);c.__decorate([n.parameter()],m.prototype,"cullAboveGround",void 0);c.__decorate([n.parameter()],m.prototype,"wireframe",void 0);c.__decorate([n.parameter({constValue:!0})],m.prototype,"stippleRequiresClamp",void 0);c.__decorate([n.parameter({constValue:!0})],
m.prototype,"stippleRequiresStretchMeasure",void 0);c.__decorate([n.parameter({constValue:!0})],m.prototype,"hasVvInstancing",void 0);c.__decorate([n.parameter({constValue:!0})],m.prototype,"hasSliceTranslatedView",void 0);c.__decorate([n.parameter()],m.prototype,"objectAndLayerIdColorInstanced",void 0);a.RibbonLineTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){const h=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.SUBDIVISIONFACTOR,1],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.AUXPOS2,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[e.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);x=function(q){function y(){return B.apply(this,arguments)}
c._inherits(y,q);var B=c._createSuper(y);q=y.prototype;q.initializeProgram=function(D){return new l.Program(D.rctx,y.shader.get().build(this.configuration),h)};q._makePipelineState=function(D,z){const v=this.configuration,A=D===d.TransparencyPassType.NONE,t=D===d.TransparencyPassType.FrontFace;return p.makePipelineState({blending:v.output===w.ShaderOutput.Color||v.output===w.ShaderOutput.Alpha?A?m.blendingDefault:m.oitBlending(D):null,depthTest:{func:m.oitDepthTest(D)},depthWrite:A?v.writeDepth?p.defaultDepthWriteParams:
null:m.oitDepthWrite(D),colorWrite:p.defaultColorWriteParams,stencilWrite:v.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:v.hasOccludees?z?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:A||t?v.hasPolygonOffset?r:null:m.OITPolygonOffset})};q.initializePipeline=function(){var D=this.configuration;D.occluder&&(D=D.hasPolygonOffset?r:null,this._occluderPipelineTransparent=p.makePipelineState({blending:m.blendingDefault,polygonOffset:D,depthTest:f.depthCompareAlways,depthWrite:null,
colorWrite:p.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=p.makePipelineState({blending:m.blendingDefault,polygonOffset:D,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:p.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=p.makePipelineState({blending:null,polygonOffset:D,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,
stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};q.getPipelineState=function(D,z){return z?this._occludeePipelineState:this.configuration.occluder?D===g.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:D===g.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:
c._get(c._getPrototypeOf(y.prototype),"getPipelineState",this).call(this,D,z)};c._createClass(y,[{key:"primitiveType",get:function(){return this.configuration.wireframe?u.PrimitiveType.LINES:u.PrimitiveType.TRIANGLE_STRIP}}]);return y}(x.ShaderTechnique);x.shader=new n.ReloadableShaderModule(k.RibbonLine,()=>new Promise((q,y)=>a(["./RibbonLine.glsl"],q,y)));const r={factor:0,units:-4};b.RibbonLineTechnique=x;b.vertexAttributeLocations=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,c){const w={func:c.CompareFunction.LESS},n={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},x={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},
operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},m={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=w;a.renderWhenBitIsNotSet=l=>({function:{func:c.CompareFunction.NOTEQUAL,ref:l,mask:l},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=l=>({function:{func:c.CompareFunction.ALWAYS,ref:l,mask:l},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});
a.stencilBaseAllZerosParams=n;a.stencilToolMaskBaseParams=x;a.stencilToolMaskOccluderParams=m;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),
function(a,b,c,w,n,x,m,l){let g=function(){function e(k,u,p,h=null){this.rctx=k;this.sliceHelper=h;this.lastFrameCamera=new m.Camera;this.output=n.ShaderOutput.Color;this.renderOccludedMask=d;this.bindParameters=new x.BindParameters(u,p,c.isSome(h)?h.plane:null)}e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=d};return b._createClass(e)}(),f=function(e){function k(p,h,r,q,y){p=u.call(this,p,r,q,y);p.offscreenRenderingHelper=h;p.sliceHelper=y;p.time=w.Milliseconds(0);return p}
b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(g);const d=l.RenderOccludedFlag.Occlude|l.RenderOccludedFlag.OccludeAndTransparent|l.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=g;a.RenderContext=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./CascadeCamera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){function z(ia,na){g.set(Z,ia[na],ia[na+3]);return Z}a.SnapshotSlot=void 0;(function(ia){ia[ia.Highlight=0]="Highlight";ia[ia.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));let v=b._createClass(function(){this.camera=new h.CascadeCamera;this.lightMat=l.create()}),A=function(){function ia(ba,ea){this._rctx=ba;this._viewingMode=ea;this._enabled=!1;this._snapshots=[];this._textureSize=0;this._numCascades=1;this._maxNumCascades=4;this._projectionView=
l.create();this._projectionViewInverse=l.create();this._modelViewLight=l.create();this._splitSchemeLambda=0;this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=u.create();this._cascades=[new v,new v,new v,new v];this._lastOrigin=null;this._maxTextureSize=Math.min(c("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}var na=ia.prototype;na.dispose=function(){this.enabled=!1;this.disposeOffscreenBuffers()};na.disposeOffscreenBuffers=function(){this._discardDepthTexture();this._discardAllSnapshots()};
na.getSnapshot=function(ba){return this.enabled?this._snapshots[ba]:null};na.start=function(ba,ea,ja){r.assert(this.enabled);this._textureSize=this._computeTextureSize(ba.fullWidth,ba.fullHeight);this._ensureDepthTexture();const {near:ka,far:da}=this._clampNearFar(ja);this._computeCascadeDistances(da,ka);this._setupMatrices(ba,ea);const {viewMatrix:ha,projectionMatrix:ca}=ba;for(ba=0;ba<this._numCascades;++ba)this._constructCascade(ba,ca,ha,ea);this._lastOrigin=null;this.clear()};na.finish=function(ba){r.assert(this.enabled);
this._rctx.bindFramebuffer(ba)};na.getShadowMapMatrices=function(ba){if(!this._lastOrigin||!d.exactEquals(ba,this._lastOrigin)){this._lastOrigin=this._lastOrigin||e.create();d.copy(this._lastOrigin,ba);for(let ea=0;ea<this._numCascades;++ea){m.translate(J,this._cascades[ea].lightMat,ba);for(let ja=0;16>ja;++ja)M[16*ea+ja]=J[ja]}}return M};na.takeCascadeSnapshotTo=function(ba,ea){r.assert(this.enabled);var ja=this._ensureSnapshot(ea);this._bindFbo();ea=this._rctx;ja=ea.bindTexture(ja,B.Texture.TEXTURE_UNIT_FOR_UPDATES);
ea.gl.copyTexSubImage2D(q.TextureType.TEXTURE_2D,0,ba.camera.viewport[0],ba.camera.viewport[1],ba.camera.viewport[0],ba.camera.viewport[1],ba.camera.viewport[2],ba.camera.viewport[3]);ea.bindTexture(ja,B.Texture.TEXTURE_UNIT_FOR_UPDATES)};na.clear=function(){const ba=this._rctx;this._bindFbo();ba.setClearColor(1,1,1,1);ba.clearSafe(q.ClearBufferBit.COLOR_BUFFER_BIT|q.ClearBufferBit.DEPTH_BUFFER_BIT)};na._computeTextureSize=function(ba,ea){return Math.min(this._maxTextureSize,2*2**Math.round(.5*Math.log(ba*
ba+ea*ea)*Math.LOG2E+.35))};na._ensureDepthTexture=function(){n.isSome(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize||(this._discardDepthTexture(),this._depthTexture=new B.Texture(this._rctx,{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new y.FramebufferObject(this._rctx,
{colorTarget:q.TargetType.TEXTURE,depthStencilTarget:q.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture))};na._ensureSnapshot=function(ba){let ea=this._snapshots[ba];if(n.isSome(ea)&&ea.descriptor.width===this._textureSize)return ea;this._discardSnapshot(ba);ea=new B.Texture(this._rctx,{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.NEAREST,
flipped:!0,width:this._textureSize,height:this._textureSize});return this._snapshots[ba]=ea};na._discardDepthTexture=function(){this._fbo=n.disposeMaybe(this._fbo);this._depthTexture=n.disposeMaybe(this._depthTexture)};na._discardSnapshot=function(ba){this._snapshots[ba]=n.disposeMaybe(this._snapshots[ba])};na._discardAllSnapshots=function(){for(let ba=0;ba<this._snapshots.length;++ba)this._discardSnapshot(ba);this._snapshots.length=0};na._bindFbo=function(){const ba=this._rctx;ba.unbindTexture(this._depthTexture);
ba.bindFramebuffer(this._fbo)};na._constructCascade=function(ba,ea,ja,ka){const da=this._cascades[ba];var ha=-this._cascadeDistances[ba],ca=-this._cascadeDistances[ba+1];ha=(ea[10]*ha+ea[14])/Math.abs(ea[11]*ha+ea[15]);ea=(ea[10]*ca+ea[14])/Math.abs(ea[11]*ca+ea[15]);r.assert(ha<ea);for(ca=0;8>ca;++ca){k.set(C,0===ca%4||3===ca%4?-1:1,0===ca%4||1===ca%4?-1:1,4>ca?ha:ea,1);var fa=E[ca];k.transformMat4(fa,C,this._projectionViewInverse);fa[0]/=fa[3];fa[1]/=fa[3];fa[2]/=fa[3]}d.negate(R,E[0]);da.camera.viewMatrix=
m.translate(t,this._modelViewLight,R);for(ha=0;8>ha;++ha)d.transformMat4(E[ha],E[ha],da.camera.viewMatrix);ha=E[0][2];ea=E[0][2];for(ca=1;8>ca;++ca)ha=Math.min(ha,E[ca][2]),ea=Math.max(ea,E[ca][2]);ha-=200;ea+=200;da.camera.near=-ea;da.camera.far=-ha;ca=da.camera;fa=1/E[0][3];var ma=1/E[4][3];r.assert(fa<ma);fa+=Math.sqrt(fa*ma);var qa=Math.sin(w.acosClamped(ja[2]*ka[0]+ja[6]*ka[1]+ja[10]*ka[2]));ja=E;var wa=fa/qa;ka=F;var xa=H,pa=K;ma=I;fa=L;g.set(G,0,0);for(var ra=0;4>ra;++ra)g.add(G,G,ja[ra]);
g.scale(G,G,.25);g.set(P,0,0);for(ra=4;8>ra;++ra)g.add(P,P,ja[ra]);g.scale(P,P,.25);g.lerp(U[0],ja[4],ja[5],.5);g.lerp(U[1],ja[5],ja[6],.5);g.lerp(U[2],ja[6],ja[7],.5);g.lerp(U[3],ja[7],ja[4],.5);ra=0;var va=g.squaredDistance(U[0],G);for(var Ba=1;4>Ba;++Ba){var Aa=g.squaredDistance(U[Ba],G);Aa<va&&(va=Aa,ra=Ba)}g.subtract(N,U[ra],ja[ra+4]);ra=N[0];N[0]=-N[1];N[1]=ra;g.subtract(S,P,G);0>g.dot(S,N)&&g.negate(N,N);g.lerp(N,N,S,qa);g.normalize(N,N);qa=ra=g.dot(g.subtract(Q,ja[0],G),N);for(va=1;8>va;++va)Ba=
g.dot(g.subtract(Q,ja[va],G),N),Ba<qa?qa=Ba:Ba>ra&&(ra=Ba);g.copy(ka,G);g.scale(Q,N,qa-wa);g.add(ka,ka,Q);Ba=-1;Aa=1;wa=va=0;for(let Ha=0;8>Ha;++Ha){g.subtract(W,ja[Ha],ka);g.normalize(W,W);const Ka=N[0]*W[1]-N[1]*W[0];0<Ka?Ka>Ba&&(Ba=Ka,va=Ha):Ka<Aa&&(Aa=Ka,wa=Ha)}r.verify(0<Ba,"leftArea");r.verify(0>Aa,"rightArea");g.scale(V,N,qa);g.add(V,V,G);g.scale(T,N,ra);g.add(T,T,G);X[0]=-N[1];X[1]=N[0];xa=r.rayRay2D(ka,ja[wa],T,g.add(Q,T,X),1,xa);pa=r.rayRay2D(ka,ja[va],T,Q,1,pa);ma=r.rayRay2D(ka,ja[va],
V,g.add(Q,V,X),1,ma);ja=r.rayRay2D(ka,ja[wa],V,Q,1,fa);r.verify(xa,"rayRay");r.verify(pa,"rayRay");r.verify(ma,"rayRay");r.verify(ja,"rayRay");pa=F;ja=H;ka=I;ma=L;fa=ca.projectionMatrix;g.subtract(Y,ka,ma);g.scale(Y,Y,.5);aa[0]=Y[0];aa[1]=Y[1];aa[2]=0;aa[3]=Y[1];aa[4]=-Y[0];aa[5]=0;aa[6]=Y[0]*Y[0]+Y[1]*Y[1];aa[7]=Y[0]*Y[1]-Y[1]*Y[0];aa[8]=1;aa[6]=-g.dot(z(aa,0),pa);aa[7]=-g.dot(z(aa,1),pa);pa=g.dot(z(aa,0),ka)+aa[6];xa=g.dot(z(aa,1),ka)+aa[7];wa=g.dot(z(aa,0),ma)+aa[6];ma=g.dot(z(aa,1),ma)+aa[7];
pa=-(pa+wa)/(xa+ma);aa[0]+=aa[1]*pa;aa[3]+=aa[4]*pa;aa[6]+=aa[7]*pa;pa=1/(g.dot(z(aa,0),ka)+aa[6]);xa=1/(g.dot(z(aa,1),ka)+aa[7]);aa[0]*=pa;aa[3]*=pa;aa[6]*=pa;aa[1]*=xa;aa[4]*=xa;aa[7]*=xa;aa[2]=aa[1];aa[5]=aa[4];aa[8]=aa[7];aa[7]+=1;pa=g.dot(z(aa,1),ja)+aa[7];xa=g.dot(z(aa,2),ja)+aa[8];wa=g.dot(z(aa,1),ka)+aa[7];ma=g.dot(z(aa,2),ka)+aa[8];pa=-.5*(pa/xa+wa/ma);aa[1]+=aa[2]*pa;aa[4]+=aa[5]*pa;aa[7]+=aa[8]*pa;pa=g.dot(z(aa,1),ja)+aa[7];xa=g.dot(z(aa,2),ja)+aa[8];wa=-xa/pa;aa[1]*=wa;aa[4]*=wa;aa[7]*=
wa;fa[0]=aa[0];fa[1]=aa[1];fa[2]=0;fa[3]=aa[2];fa[4]=aa[3];fa[5]=aa[4];fa[6]=0;fa[7]=aa[5];fa[8]=0;fa[9]=0;fa[10]=1;fa[11]=0;fa[12]=aa[6];fa[13]=aa[7];fa[14]=0;fa[15]=aa[8];ca.projectionMatrix[10]=2/(ha-ea);ca.projectionMatrix[14]=-(ha+ea)/(ha-ea);m.multiply(da.lightMat,da.camera.projectionMatrix,da.camera.viewMatrix);ha=this._textureSize/2;da.camera.viewport=[0===ba%2?0:ha,0===Math.floor(ba/2)?0:ha,ha,ha]};na._setupMatrices=function(ba,ea){m.multiply(this._projectionView,ba.projectionMatrix,ba.viewMatrix);
m.invert(this._projectionViewInverse,this._projectionView);ba=this._viewingMode===p.ViewingMode.Global?ba.eye:d.set(R,0,0,1);m.lookAt(this._modelViewLight,[0,0,0],[-ea[0],-ea[1],-ea[2]],ba)};na._clampNearFar=function(ba){let {near:ea,far:ja}=ba;2>ea&&(ea=2);2>ja&&(ja=2);ea>=ja&&(ea=2,ja=4);return{near:ea,far:ja}};na._computeCascadeDistances=function(ba,ea){this._numCascades=Math.min(1+Math.floor(r.logWithBase(ba/ea,4)),this._maxNumCascades);const ja=(ba-ea)/this._numCascades;ba=(ba/ea)**(1/this._numCascades);
let ka=ea;for(let da=0;da<this._numCascades+1;++da)this._cascadeDistances[da]=w.lerp(ka,ea,this._splitSchemeLambda),ka*=ba,ea+=ja};b._createClass(ia,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"numCascades",get:function(){return this._numCascades}},{key:"cascadeDistances",get:function(){return k.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?
this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}},{key:"maxCascades",get:function(){return this._maxNumCascades},set:function(ba){this._maxNumCascades=w.clamp(Math.floor(ba),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(ba){this._enabled=ba;ba||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&n.isSome(this._depthTexture)}},{key:"cascades",get:function(){for(let ba=0;ba<
this._numCascades;++ba)O[ba]=this._cascades[ba];O.length=this._numCascades;return O}},{key:"gpuMemoryUsage",get:function(){return this._snapshots.reduce((ba,ea)=>ba+D.getGpuMemoryUsage(ea),this._fbo?.gpuMemoryUsage??0)}},{key:"test",get:function(){const ba=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(ea){ba._splitSchemeLambda=ea},get splitSchemeLambda(){return ba._splitSchemeLambda}}}}]);return ia}();const t=l.create(),
C=u.create(),E=[];for(let ia=0;8>ia;++ia)E.push(u.create());const F=f.create(),H=f.create(),K=f.create(),I=f.create(),L=f.create(),R=e.create(),O=[],J=l.create(),M=new Float32Array(64),G=f.create(),P=f.create(),U=[f.create(),f.create(),f.create(),f.create()],N=f.create(),S=f.create(),Q=f.create(),W=f.create(),V=f.create(),T=f.create(),X=f.create(),Z=f.create(),Y=f.create(),aa=x.create();a.ShadowMap=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ./Camera".split(" "),
function(a,b,c,w,n,x,m,l,g,f){a.CascadeCamera=function(d){function e(){var u=k.apply(this,arguments);u._projectionMatrix=g.create();return u}b._inherits(e,d);var k=b._createSuper(e);b._createClass(e,[{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]);return e}(f.Camera);c.__decorate([w.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);c.__decorate([w.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=c.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],
a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../terrain/Intersector ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){function D(A,t,C,E,F,H,K){const I=new u.OverlayTarget(H,K,t);t=L=>{L.set(r.IntersectorType.OVERLAY,I,A.dist,A.normal,A.transformation,C,E)};(null==F.results.min.drapedLayerOrder||C>=F.results.min.drapedLayerOrder)&&(null==F.results.min.dist||F.results.ground.dist<=F.results.min.dist)&&t(F.results.min);F.options.store!==r.StoreResults.MIN&&(null==F.results.max.drapedLayerOrder||C<F.results.max.drapedLayerOrder)&&(null==F.results.max.dist||F.results.ground.dist>
F.results.max.dist)&&t(F.results.max);F.options.store===r.StoreResults.ALL&&(H=h.newIntersectorResult(F.ray),t(H),F.results.all.push(H))}a.SortedRenderGeometryRenderer=function(A){function t(E){E=C.call(this,E);E._pending=new z;E._changes=new p.ChangeSet;E._materialRenderers=new Map;E._sortedMaterialRenderers=new m;E._geometries=new Map;E._hasHighlights=!1;E._hasWater=!1;return E}b._inherits(t,A);var C=b._createSuper(t);A=t.prototype;A.destroy=function(){this._changes.prune();this._materialRenderers.forEach(E=>
E.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();this._geometries.clear();this._pending.clear()};A.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let E=!1,F=!1,H=!1;y.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((K,I)=>{let L=this._materialRenderers.get(I);!L&&0<K.adds.length&&(L=new B.MergedRenderer(this.rctx,this._materialRepository,I),this._materialRenderers.set(I,L),H=F=E=!0);if(L){var R=F||L.hasHighlights,O=H||
L.hasWater;L.modify(K);F=F||R!==L.hasHighlights;H=H||O!==L.hasWater;L.isEmpty&&(this._materialRenderers.delete(I),L.dispose(),E=!0)}});this._changes.clear();E&&this._updateSortedMaterialRenderers();F&&(this._hasHighlights=n.someMap(this._materialRenderers,K=>K.hasHighlights));H&&(this._hasWater=n.someMap(this._materialRenderers,K=>K.hasWater));this.notifyChange("updating");return!0};A.addGeometries=function(E,F){if(0!==E.length){var H=this._validateRenderGeometries(E);for(var K of H)this._geometries.set(K.id,
K);K=this._pending.empty;for(const I of H)this._pending.adds.add(I);K&&this.notifyChange("updating");F===q.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(E)}};A.removeGeometries=function(E,F){const H=this._pending.empty,K=this._pending.adds;for(const I of E)K.has(I)?(this._pending.removed.add(I),K.delete(I)):this._pending.removed.has(I)||this._pending.removes.add(I),this._geometries.delete(x.unwrap(I.id));H&&!this._pending.empty&&this.notifyChange("updating");F===q.DirtyOperation.UPDATE&&
this._notifyGraphicGeometryChanged(E)};A.modifyGeometries=function(E,F){const H=0===this._changes.updates.length;for(const K of E){const I=this._changes.updates.pushNew();I.renderGeometry=this._validateRenderGeometry(K);I.updateType=F}H&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case q.DirtyState.TRANSFORMATION:case q.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(E);case q.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(E)}};A.updateAnimation=
function(E){let F=!1;this._sortedMaterialRenderers.forAll(H=>F=H.updateAnimation(E)||F);return F};A.render=function(E){this._sortedMaterialRenderers.forAll(F=>{if(F.material.shouldRender(E)){const H=F.prepareTechnique(E);x.isSome(H)&&F.render(E,H)}})};A.intersect=function(E,F,H,K,I){this._geometries.forEach(L=>{if(!K||K(L)){this._intersectRenderGeometry(L,H,F,0,E,I);var R=this.rendererContext.longitudeCyclical;R&&(L.boundingSphere[0]-L.boundingSphere[3]<R.min&&this._intersectRenderGeometry(L,H,F,
R.range,E,I),L.boundingSphere[0]+L.boundingSphere[3]>R.max&&this._intersectRenderGeometry(L,H,F,-R.range,E,I));I++}});return I};A._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let E=0;this._materialRenderers.forEach((F,H)=>{H.insertOrder=E++;this._sortedMaterialRenderers.push(F)});this._sortedMaterialRenderers.sort((F,H)=>{const K=H.material.renderPriority-F.material.renderPriority;return 0!==K?K:F.material.insertOrder-H.material.insertOrder})};A._processAddsRemoves=
function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let E=0;E<this._changes.updates.length;)this._pending.has(this._changes.updates.data[E].renderGeometry)?this._changes.updates.removeUnorderedIndex(E):E++;this._pending.clear()};A._intersectRenderGeometry=function(E,F,H,K,I,L){if(E.visible){var R=0;K+=E.transformation[12];R=E.transformation[13];v[0]=H[0]-
K;v[1]=H[1]-R;E.screenToWorldRatio=this.rendererContext.screenToWorldRatio;E.material.intersectDraped(E,null,I,v,(O,J,M)=>{D(F,M,E.material.renderPriority,L,I,E.layerUid,E.graphicUid)},F)}};A._notifyGraphicGeometryChanged=function(E){if(!x.isNone(this.drapeSource.notifyGraphicGeometryChanged))for(const H of E)if(E=H.graphicUid,x.isSome(E)&&E!==F){this.drapeSource.notifyGraphicGeometryChanged(E);var F=E}};A._notifyGraphicVisibilityChanged=function(E){if(!x.isNone(this.drapeSource.notifyGraphicVisibilityChanged))for(const H of E)if(E=
H.graphicUid,x.isSome(E)&&E!==F){this.drapeSource.notifyGraphicVisibilityChanged(E);var F=E}};A._validateRenderGeometries=function(E){for(const F of E)this._validateRenderGeometry(F);return E};A._validateRenderGeometry=function(E){x.isNone(E.localOrigin)&&(E.localOrigin=this._localOriginFactory.getOrigin(E.boundingSphere));return E};b._createClass(t,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"rctx",get:function(){return this.rendererContext.rctx}},
{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return n.someMap(this._materialRenderers,E=>E.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},
{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return t}(w);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,
"_materialRepository",null);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);c.__decorate([l.property({readOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"isEmpty",null);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRenderers",void 0);c.__decorate([l.property()],a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],
a.SortedRenderGeometryRenderer);let z=function(){function A(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var t=A.prototype;t.has=function(C){return this.adds.has(C)||this.removes.has(C)||this.removed.has(C)};t.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(A,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return A}();const v=k.create();Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,b,c,w,n){w=function(x){function m(g,f,d){g=l.call(this,g,f);g.triangleNr=d;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.Graphic3DTarget);a.OverlayTarget=w;a.isOverlayIntersectorResult=function(x){return n.isValidIntersectorResult(x)&&
x.intersector===c.IntersectorType.OVERLAY&&!!x.target};a.isTerrainIntersectorResult=function(x){return n.isValidIntersectorResult(x)&&x.intersector===c.IntersectorType.TERRAIN&&!!x.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray"],function(a,b,c){let w=function(){function m(){this.adds=new c;this.removes=new c;this.updates=new c({allocator:g=>
g||new n,deallocator:g=>{g.renderGeometry=null;return g}})}var l=m.prototype;l.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};l.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};b._createClass(m,[{key:"empty",get:function(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}]);return m}(),n=b._createClass(function(){}),x=b._createClass(function(){this.adds=[];this.removes=[];this.updates=[]});a.ChangeSet=w;a.MaterialChangeSet=
x;a.RenderGeometryUpdate=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITY=1]="VISIBILITY";b[b.GEOMETRY=2]="GEOMETRY";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHT=8]="HIGHLIGHT";
b[b.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.splitRenderGeometryChangeSetByMaterial=function(c){const w=new Map,n=x=>{let m=w.get(x);m||(m=new b.MaterialChangeSet,w.set(x,m));return m};c.removes.forAll(x=>{1<=x.geometry.indexCount&&n(x.material).removes.push(x)});c.adds.forAll(x=>{1<=x.geometry.indexCount&&n(x.material).adds.push(x)});
c.updates.forAll(x=>{1<=x.renderGeometry.geometry.indexCount&&n(x.renderGeometry.material).updates.push(x)});return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../lib/AppleAmdDriverHelper ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/Util ../DrawParameters ../WaterMaterial ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(J,M){let G;if(!J.some(U=>{if(U.numElements<M)return!1;G=U;return!0}))return null;const P=G.from;G.from+=M;G.from>=G.to&&J.removeUnordered(G);return P}function t(J){O.length<J&&(O=new Float32Array(J));return O}function C(J){J*=4;return 262144>J?262144:Math.max(Math.min(262144*Math.ceil(1.5*J/262144),16777216),J)}function E(){O=new Float32Array(2)}let F=function(){function J(G,P,U){this._rctx=G;this._materialRepository=P;this.material=
U;this._dataByOrigin=new Map;this._appleAmdDriverHelper=null;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new k.GLMaterials(this.material,this._materialRepository);this._bufferWriter=U.createBufferWriter();this._vaoCache=new v.VaoCache(G,U.vertexAttributeLocations,f.glLayout(this._bufferWriter.vertexBufferLayout));this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new e.AppleAmdDriverHelper(this._rctx))}var M=J.prototype;M.dispose=function(){this._glMaterials.destroy();
this._dataByOrigin.forEach(G=>G.dispose());this._dataByOrigin.clear();this._vaoCache.dispose();this._appleAmdDriverHelper?.dispose()};M.forEachGeometry=function(G){this._dataByOrigin.forEach(P=>P.buffers.forEach(U=>U.instances.forEach(N=>G(N.geometry))))};M.modify=function(G){this._updateGeometries(G.updates);this._addAndRemoveGeometries(G.adds,G.removes);this._updateDrawCommands()};M._updateGeometries=function(G){const P=this._bufferWriter,U=P.vertexBufferLayout.stride/4;for(const S of G){G=S.renderGeometry;
const Q=this._dataByOrigin.get(G.localOrigin.id)?.findBuffer(G.id);if(n.isNone(Q))break;const W=Q.instances.get(G.id);if(S.updateType&(p.DirtyState.GEOMETRY|p.DirtyState.TRANSFORMATION)){var N=P.elementCount(W.geometry.geometry)*U;N=t(N);const V=P.vertexBufferLayout.createView(N.buffer);this._writeGeometry(G,V,0);Q.vao.vertexBuffers.geometry.setSubData(N,W.from*U,0,W.numElements*U);E()}S.updateType&(p.DirtyState.HIGHLIGHT|p.DirtyState.OCCLUDEE|p.DirtyState.VISIBILITY)&&(Q.drawCommandsDirty=!0)}};
M._computeDeltas=function(G,P){const U=new x.NestedMap;for(var N of G){G=N.localOrigin;if(n.isNone(G))continue;let S=U.get(G.id,null);n.isNone(S)&&(S=new H(G.vec3),U.set(G.id,null,S));S.changes.push(N)}for(const S of P)P=S.localOrigin,n.isNone(P)||(N=this._dataByOrigin.get(P.id)?.findBuffer(S.id),n.isNone(N)||(G=U.get(P.id,N),n.isNone(G)&&(G=new H(P.vec3),U.set(P.id,N,G)),G.changes.push(S)));return U};M._addAndRemoveGeometries=function(G,P){const {_bufferWriter:U,_dataByOrigin:N}=this,S=U.vertexBufferLayout.stride/
4,Q=this._computeDeltas(G,P);Q.forEach((W,V)=>{const T=W.get(null),X=n.isSome(T)?T.changes:[];Q.delete(V,null);let Z=N.get(V);W.forEach((Y,aa)=>{Q.delete(V,aa);if(n.isNone(aa))h.assert(!1,"No VAO for removed geometries");else if(aa.instances.size===Y.changes.length)this._vaoCache.deleteVao(aa.vao),c.removeUnordered(Z.buffers,aa),0===Z.buffers.length&&0===X.length&&N.delete(V);else{var ia=aa.numElements,na=aa.vao.size/4,ba=X.reduce((ja,ka)=>ja+U.elementCount(ka.geometry),0),ea=Y.changes.reduce((ja,
ka)=>ja+U.elementCount(ka.geometry),0);ia=Math.min((ia+ba-ea)*S,4194304);ba=ia>na;65536<ia&&ia<na/2?(Y.changes.forEach(({id:ja})=>aa.deleteInstance(ja)),aa.instances.forEach(({geometry:ja})=>X.push(ja)),this._vaoCache.deleteVao(aa.vao),c.removeUnordered(Z.buffers,aa)):ba?this._applyAndRebuild(aa,X,Y):this._applyRemoves(aa,Y)}});if(0<X.length)for(n.isNone(Z)&&(Z=new z.PerOriginData(T.origin),N.set(V,Z)),Z.buffers.forEach(Y=>this._applyAdds(Y,X));0<X.length;)Z.buffers.push(this._applyAndRebuild(new D.PerBufferData,
X,null))})};M._updateDrawCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(G=>{G.buffers.forEach(P=>{P.drawCommandsDirty&&(P.hasHiddenInstances=!1,P.hasHighlights=!1,P.hasOccludees=!1,w.someMap(P.instances,U=>{P.updateDrawState(U);return P.hasHiddenInstances&&P.hasHighlights&&P.hasOccludees}),P.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));this._hasHighlights=this._hasHighlights||P.hasHighlights;this._hasOccludees=this._hasOccludees||P.hasOccludees})})};
M._applyAndRebuild=function(G,P,U){if(n.isSome(U))for(var N of U.changes)G.deleteInstance(N.id);const S=this._bufferWriter;U=S.vertexBufferLayout.stride;N=U/4;var Q=Math.floor(4194304/N);let W=G.numElements;for(;0<P.length;){const Z=P.pop();var V=S.elementCount(Z.geometry);if(W+V>Q&&0<W){P.push(Z);break}W+=V;V=new B.Instance(Z,0,0);h.assert(null==G.instances.get(Z.id));G.addInstance(Z.id,V)}P=W*N;Q=t(P);const T=S.vertexBufferLayout.createView(Q.buffer);let X=0;G.hasHiddenInstances=!1;G.hasHighlights=
!1;G.hasOccludees=!1;G.instances.forEach((Z,Y)=>{this._writeGeometry(Z.geometry,T,X);const aa=X;X+=S.elementCount(Z.geometry.geometry);G.updateInstance(Y,aa,X);G.updateDrawState(Z)});this._vaoCache.deleteVao(G.vao);G.vao=this._vaoCache.newVao(C(P));G.vao.vertexBuffers.geometry.setSubData(Q,0,0,X*N);E();G.holes.clear();P=G.holes.pushNew();P.from=X;P.to=Math.floor(G.vao.size/U);G.updateDrawCommands(U);return G};M._applyRemoves=function(G,P){if(0!==P.changes.length){for(var U of P.changes){var N=U.id;
if(P=G.instances.get(N)){G.deleteInstance(N);if(N=R.back()){if(N.to===P.from){N.to=P.to;continue}if(N.from===P.to){N.from=P.from;continue}}N=R.pushNew();N.from=P.from;N.to=P.to}}y.mergeAdjacentRanges(R);var S=this._bufferWriter.vertexBufferLayout.stride/4;U=R.reduce((V,T)=>Math.max(V,T.numElements),0)*S;var Q=t(U);Q.fill(0,0,U);var W=G.vao.vertexBuffers.geometry;R.forAll(V=>W.setSubData(Q,V.from*S,0,V.numElements*S));E();G.holes.pushArray(R.data,R.length);R.forAll((V,T)=>R.data[T]=null);R.clear();
G.drawCommandsDirty=!0}};M._applyAdds=function(G,P){if(0!==P.length)if(D.hasVao(G)){var U=this._bufferWriter,N=U.vertexBufferLayout.stride/4,S=G.numElements,Q=P.reduce((na,ba)=>na+U.elementCount(ba.geometry),0);S=Math.min((S+Q)*N,4194304);Q=4*S;if(G.vao.size<C(4128768)&&Q>G.vao.size)this._applyAndRebuild(G,P,null);else{y.mergeAdjacentRanges(G.holes);var W=[];for(var V of P)Q=U.elementCount(V.geometry),Q=A(G.holes,Q),W.push(Q);var T=G.vao.vertexBuffers.geometry,X=0,Z=0,Y=0,aa=t(S),ia=U.vertexBufferLayout.createView(aa.buffer);
P.forEach((na,ba)=>{ba=W[ba];if(!n.isNone(ba)){if(Y!==ba){var ea=Y-Z;0<ea&&T.setSubData(aa,Z*N,0,ea*N);Z=ba;X=0}ea=U.elementCount(na.geometry);this._writeGeometry(na,ia,X);X+=ea;Y=ba+ea;ba=new B.Instance(na,ba,ba+ea);h.assert(null==G.instances.get(na.id));G.addInstance(na.id,ba);G.drawCommandsDirty=!0}});V=Y-Z;0<V&&T.setSubData(aa,Z*N,0,V*N);c.filterInPlace(P,(na,ba)=>n.isNone(W[ba]));E()}}else this._applyAndRebuild(G,P,null)};M._writeGeometry=function(G,P,U){var N=G.localOrigin.vec3;h.setMatrixTranslation3(K,
-N[0],-N[1],-N[2]);N=l.multiply(I,K,G.transformation);l.invert(L,N);l.transpose(L,L);this._bufferWriter.write(N,L,G.geometry,P,U)};M.updateAnimation=function(G){return this.material.update(G)};M.requiresSlot=function(G,P){return this.material.requiresSlot(G,P)};M.prepareTechnique=function(G){const {output:P,bindParameters:U}=G;if(!this.requiresSlot(U.slot,P))return null;const N=P===d.ShaderOutput.Highlight||P===d.ShaderOutput.ShadowHighlight;if(N&&!this._hasHighlights)return null;const S=P===d.ShaderOutput.ShadowExcludeHighlight,
Q=!(N||S);this._appleAmdDriverHelper?.resetIndicesType();for(const V of this._dataByOrigin.values())for(const T of V.buffers){if(N&&!T.hasHighlights)continue;var W=(N?T.drawCommandsHighlight:S&&T.needsMultipleCommands()?T.drawCommandsShadowHighlightRest:T.drawCommandsDefault)||null;const X=Q&&T.drawCommandsOccludees||null;if(W?.length||X?.length)if(W=this._glMaterials.load(G.rctx,U.slot,P),W=n.isSome(W)?W.beginSlot(U):null,n.isSome(W))return W}return null};M.render=function(G,P){const {output:U,bindParameters:N}=
G;G=U===d.ShaderOutput.Highlight||U===d.ShaderOutput.ShadowHighlight;const S=U===d.ShaderOutput.ShadowExcludeHighlight,Q=!(G||S),W=this._rctx;this._appleAmdDriverHelper?.resetIndicesType();W.bindTechnique(P,this.material.parameters,N);for(const V of this._dataByOrigin.values())for(const T of V.buffers){if(G&&!T.hasHighlights)continue;const X=(G?T.drawCommandsHighlight:S&&T.needsMultipleCommands()?T.drawCommandsShadowHighlightRest:T.drawCommandsDefault)||null,Z=Q&&T.drawCommandsOccludees||null;if(X?.length||
Z?.length)P.program.bindDraw(new r.DrawParameters(V.origin),N,this.material.parameters),P.ensureAttributeLocations(T.vao),W.bindVAO(T.vao),X?.length&&(P.bindPipelineState(W,N.slot,!1),X.forAll(Y=>W.drawArrays(P.primitiveType,Y.first,Y.count))),Z?.length&&(P.bindPipelineState(W,N.slot,!0),Z.forAll(Y=>W.drawArrays(P.primitiveType,Y.first,Y.count)))}};b._createClass(J,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},
{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this.material instanceof q.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this.material.renderOccluded!==u.RenderOccludedFlag.Occlude}},{key:"numGeometries",get:function(){let G=0;this._dataByOrigin.forEach(P=>G+=P.buffers.reduce((U,N)=>U+=N.instances.size,0));return G}},{key:"test",get:function(){return{material:this.material,glMaterials:this._glMaterials,
dataByOrigin:this._dataByOrigin}}}]);return J}(),H=b._createClass(function(J){this.origin=J;this.changes=[]});const K=g.create(),I=g.create(),L=g.create(),R=new m({allocator:J=>J||new y.BufferRange,deallocator:null});let O=new Float32Array(65536);a.MergedRenderer=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AppleAmdDriverHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/enums"],
function(a,b,c,w){let n=function(){function x(l){this._rctx=l;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}x.getShaderSources=function(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}};
var m=x.prototype;m._createHelperProgram=function(){const l=x.getShaderSources();return this._rctx.programCache.acquire(l.vertex,l.fragment,new Map([]))};m._createIndexbuffer=function(){return c.BufferObject.createIndex(this._rctx,w.Usage.STATIC_DRAW,new Uint32Array([0]))};m.resetIndicesType=function(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,w.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(w.PrimitiveType.POINTS,
1,w.DataType.UNSIGNED_INT,0))};m.dispose=function(){this._program.dispose();this._indexBuffer.dispose()};return b._createClass(x)}();a.AppleAmdDriverHelper=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./basicInterfaces"],function(a,b,c,w){let n=function(){function x(l,g){this._material=l;this._repository=g;this._map=new Map}var m=x.prototype;
m.destroy=function(){this._map.forEach((l,g)=>{c.isSome(l)&&this._repository.release(this._material,g)})};m.load=function(l,g,f){if(!this._material.requiresSlot(g,f))return null;this._map.has(f)||this._map.set(f,this._repository.acquire(this._material,g,f));g=this._map.get(f);if(c.isSome(g)){if(g.ensureResources(l)===w.ResourceState.LOADED)return g;this._repository.requestRender()}return null};return b._createClass(x)}();a.GLMaterials=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,w){w=function(n){function x(l=c.create()){var g=m.call(this);g.origin=l;g.slicePlaneLocalOrigin=g.origin;return g}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(w.VertexNormalDrawParameters);a.DrawParameters=w;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/compilerUtils ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),function(a,b,c,w,n,x,m,l,g,f){let d=function(k){function u(){var h=
p.apply(this,arguments);h.transformNormalViewFromGlobal=w.create();return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(m.VertexPositionPassParameters),e=function(k){function u(){var h=p.apply(this,arguments);h.transformNormalGlobalFromModel=w.create();h.toMapSpace=n.create();return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(m.VertexPositionDrawParameters);a.VertexNormal=function(k,u){switch(u.normalType){case x.NormalAttributeType.Attribute:case x.NormalAttributeType.CompressedAttribute:k.include(x.NormalAttribute,
u);k.varyings.add("vNormalWorld","vec3");k.varyings.add("vNormalView","vec3");k.vertex.uniforms.add([new g.Matrix3DrawUniform("transformNormalGlobalFromModel",p=>p.transformNormalGlobalFromModel),new f.Matrix3PassUniform("transformNormalViewFromGlobal",p=>p.transformNormalViewFromGlobal)]);k.vertex.code.add(l.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case x.NormalAttributeType.Ground:k.include(m.VertexPosition,u);k.varyings.add("vNormalWorld","vec3");k.vertex.code.add(l.glsl`
        void forwardNormal() {
          vNormalWorld = ${u.spherical?l.glsl`normalize(vPositionWorldCameraRelative);`:l.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case x.NormalAttributeType.ScreenDerivative:k.vertex.code.add(l.glsl`void forwardNormal() {}`);break;default:c.neverReached(u.normalType);case x.NormalAttributeType.COUNT:}};a.VertexNormalDrawParameters=e;a.VertexNormalPassParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../util/DecodeNormal.glsl","../../shaderModules/interfaces",
"../../../lib/VertexAttribute"],function(a,b,c,w,n){a.NormalAttributeType=void 0;(function(x){x[x.Attribute=0]="Attribute";x[x.CompressedAttribute=1]="CompressedAttribute";x[x.Ground=2]="Ground";x[x.ScreenDerivative=3]="ScreenDerivative";x[x.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(x,m){switch(m.normalType){case a.NormalAttributeType.CompressedAttribute:x.include(c.DecodeNormal);x.attributes.add(n.VertexAttribute.NORMALCOMPRESSED,"vec2");x.vertex.code.add(w.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case a.NormalAttributeType.Attribute:x.attributes.add(n.VertexAttribute.NORMAL,"vec3");x.vertex.code.add(w.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalAttributeType.ScreenDerivative:x.fragment.code.add(w.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:b.neverReached(m.normalType);case a.NormalAttributeType.COUNT:case a.NormalAttributeType.Ground:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DecodeNormal=function(c){const w=b.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;c.vertex.code.add(w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){k=function(r){function q(B){B=y.call(this,B,new h);B._configuration=new p.WaterTechniqueConfiguration;B.animation=new m.AnimationTimer;return B}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.getConfiguration=function(B,D){this._configuration.output=B;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;this._configuration.isDraped=this.parameters.isDraped;this._configuration.transparencyPassType=D.transparencyPassType;this._configuration.enableOffset=D.camera.relativeElevation<g.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=D.multipassTerrain.enabled;this._configuration.cullAboveGround=D.multipassTerrain.cullAboveGround;
return this._configuration};r.update=function(B){this.animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(B.camera.relativeElevation,B.camera.distance);B=this.animation.advance(B);this.setParameters({timeElapsed:c.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1);return this.animation.enabled&&B};r.requiresSlot=function(B,D){switch(D){case x.ShaderOutput.Normal:return B===f.RenderSlot.DRAPED_WATER;case x.ShaderOutput.Color:if(this.parameters.isDraped)return B===
f.RenderSlot.DRAPED_MATERIAL;break;case x.ShaderOutput.Alpha:break;case x.ShaderOutput.Highlight:return B===f.RenderSlot.OPAQUE_MATERIAL||B===f.RenderSlot.DRAPED_MATERIAL;default:return!1}D=f.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(D=this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return B===D};r.createGLMaterial=function(B){return new u.WaterGLMaterial(B)};r.createBufferWriter=function(){return new d.DefaultBufferWriter(e.PositionUVLayout)};
return b._createClass(q)}(k.TriangleMaterial);let h=function(r){function q(){var B=y.apply(this,arguments);B.waveStrength=.06;B.waveTextureRepeat=32;B.waveDirection=w.fromValues(1,0);B.waveVelocity=.05;B.flowStrength=.015;B.flowOffset=-.5;B.animationSpeed=.35;B.timeElapsed=0;B.color=n.fromValues(0,0,0,0);B.transparent=!0;B.writeDepth=!0;B.hasSlicePlane=!1;B.isDraped=!1;B.receiveShadows=!0;B.hasScreenSpaceReflections=!1;B.hasCloudsReflections=!1;return B}b._inherits(q,r);var y=b._createSuper(q);return b._createClass(q)}(l.MaterialParameters);
a.WaterMaterial=k;a.WaterMaterialParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(a,b,c,w){let n=function(){function x(l){this.vertexBufferLayout=l}var m=x.prototype;m.allocate=function(l){return this.vertexBufferLayout.createBuffer(l)};m.elementCount=function(l){return l.indices.get(c.VertexAttribute.POSITION).length};
m.write=function(l,g,f,d,e){w.writeDefaultAttributes(f,this.vertexBufferLayout,l,g,d,e)};return b._createClass(x)}();a.DefaultBufferWriter=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],function(a,b,c){const w=b.newLayout().vec3f(c.VertexAttribute.POSITION),n=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0),
x=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR),m=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR),l=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);a.PositionColorLayout=x;a.PositionColorLayoutObjectAndLayerId=b;
a.PositionLayout=w;a.PositionLayoutObjectAndLayerId=m;a.PositionUVLayout=n;a.PositionUVLayoutObjectAndLayerId=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/Material","./internal/MaterialUtil"],function(a,b,c,w){c=function(n){function x(){return m.apply(this,arguments)}b._inherits(x,n);var m=b._createSuper(x);x.prototype.intersect=function(l,
g,f,d,e,k){return w.intersectTriangleGeometry(l,f,d,e,void 0,k)};return b._createClass(x)}(c.Material);a.TriangleMaterial=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,b,c,w,n,x){n=function(m){function l(){return g.apply(this,arguments)}b._inherits(l,
m);var g=b._createSuper(l);m=l.prototype;m._updateShadowState=function(f){f.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:f.shadowMap.enabled})};m._updateSSRState=function(f){f.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:f.ssr.enabled})};m._updateCloudsReflectionState=function(f){f=c.isSome(f.cloudsFade.data);f!==this._material.parameters.hasCloudsReflections&&
this._material.setParameters({hasCloudsReflections:f})};m.ensureResources=function(f){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(f)};m.beginSlot=function(f){this._output===w.ShaderOutput.Color&&(this._updateShadowState(f),this._updateSSRState(f),this._updateCloudsReflectionState(f));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(x.WaterTechnique,f)};return b._createClass(l)}(n);
a.WaterGLMaterial=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){l=function(y){function B(){return D.apply(this,arguments)}c._inherits(B,y);var D=c._createSuper(B);return c._createClass(B)}(l.WaterDistortionPassParameters);f=function(y){function B(){return D.apply(this,arguments)}c._inherits(B,y);var D=c._createSuper(B);y=B.prototype;y.initializeConfiguration=function(z,v){v.spherical=z.viewingMode===n.ViewingMode.Global;v.doublePrecisionRequiresObfuscation=z.rctx.driverTest.doublePrecisionRequiresObfuscation.result};
y.initializeProgram=function(z){return new u.Program(z.rctx,B.shader.get().build(this.configuration),e.Default3D)};y._setPipelineState=function(z){const v=this.configuration,A=z===p.TransparencyPassType.NONE,t=z===p.TransparencyPassType.FrontFace;return q.makePipelineState({blending:v.output!==x.ShaderOutput.Normal&&v.output!==x.ShaderOutput.Highlight&&v.transparent?A?k.blendingDefault:k.oitBlending(z):null,depthTest:{func:k.oitDepthTest(z)},depthWrite:A?v.writeDepth?q.defaultDepthWriteParams:null:
k.oitDepthWrite(z),colorWrite:q.defaultColorWriteParams,polygonOffset:A||t?null:k.getOITPolygonOffset(v.enableOffset)})};y.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return c._createClass(B)}(f.ShaderTechnique);f.shader=new g.ReloadableShaderModule(r.WaterSurface,()=>new Promise((y,B)=>a(["../shaders/WaterSurface.glsl"],y,B)));g=function(y){function B(){var z=D.apply(this,arguments);z.output=x.ShaderOutput.Color;z.transparencyPassType=p.TransparencyPassType.NONE;
z.spherical=!1;z.receiveShadows=!1;z.hasSlicePlane=!1;z.transparent=!1;z.enableOffset=!0;z.writeDepth=!1;z.hasScreenSpaceReflections=!1;z.doublePrecisionRequiresObfuscation=!1;z.hasCloudsReflections=!1;z.isDraped=!1;z.hasMultipassTerrain=!1;z.cullAboveGround=!1;return z}c._inherits(B,y);var D=c._createSuper(B);return c._createClass(B)}(h.DefaultTechniqueConfiguration);w.__decorate([d.parameter({count:x.ShaderOutput.COUNT})],g.prototype,"output",void 0);w.__decorate([d.parameter({count:p.TransparencyPassType.COUNT})],
g.prototype,"transparencyPassType",void 0);w.__decorate([d.parameter()],g.prototype,"spherical",void 0);w.__decorate([d.parameter()],g.prototype,"receiveShadows",void 0);w.__decorate([d.parameter()],g.prototype,"hasSlicePlane",void 0);w.__decorate([d.parameter()],g.prototype,"transparent",void 0);w.__decorate([d.parameter()],g.prototype,"enableOffset",void 0);w.__decorate([d.parameter()],g.prototype,"writeDepth",void 0);w.__decorate([d.parameter()],g.prototype,"hasScreenSpaceReflections",void 0);
w.__decorate([d.parameter()],g.prototype,"doublePrecisionRequiresObfuscation",void 0);w.__decorate([d.parameter()],g.prototype,"hasCloudsReflections",void 0);w.__decorate([d.parameter()],g.prototype,"isDraped",void 0);w.__decorate([d.parameter()],g.prototype,"hasMultipassTerrain",void 0);w.__decorate([d.parameter()],g.prototype,"cullAboveGround",void 0);w.__decorate([d.parameter({constValue:m.PBRMode.Water})],g.prototype,"pbrMode",void 0);w.__decorate([d.parameter({constValue:!0})],g.prototype,"useCustomDTRExponentForWater",
void 0);w.__decorate([d.parameter({constValue:!0})],g.prototype,"highStepCount",void 0);w.__decorate([d.parameter({constValue:!1})],g.prototype,"useFillLights",void 0);b.WaterMaterialPassParameters=l;b.WaterTechnique=f;b.WaterTechniqueConfiguration=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=function(p){function h(){return r.apply(this,arguments)}b._inherits(h,p);var r=b._createSuper(h);return b._createClass(h)}(f.NoParameters);const k=x.create(),u=w.create();a.WaterDistortion=function(p){p.fragment.uniforms.add(new d.Texture2DPassUniform("texWaveNormal",h=>h.waveNormal));p.fragment.uniforms.add(new d.Texture2DPassUniform("texWavePerturbation",h=>h.wavePertubation));p.fragment.uniforms.add([new g.Float4PassUniform("waveParams",h=>n.set(k,h.waveStrength,
h.waveTextureRepeat,h.flowStrength,h.flowOffset)),new l.Float2PassUniform("waveDirection",h=>c.set(u,h.waveDirection[0]*h.waveVelocity,h.waveDirection[1]*h.waveVelocity))]);p.include(m.FoamIntensity);p.fragment.code.add(f.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(C){const E=new D.ShaderBuilder,{vertex:F,fragment:H}=E;r.addProjViewLocalOrigin(F,C);E.include(n.Transform,C);E.attributes.add(v.VertexAttribute.POSITION,"vec3");E.attributes.add(v.VertexAttribute.UV0,"vec2");const K=new q.Float4PassUniform("waterColor",I=>I.color);if(C.output===c.ShaderOutput.Color&&C.isDraped)return E.varyings.add("vpos","vec3"),F.uniforms.add(K),F.code.add(B.glsl`
        void main(void) {
          if (waterColor.a < ${B.glsl.float(p.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),H.uniforms.add(K),H.code.add(B.glsl`void main() {
fragColor = waterColor;
}`),E;if(C.output===c.ShaderOutput.Color||C.output===c.ShaderOutput.Alpha)E.include(f.NormalUtils,C),E.include(b.ForwardLinearDepth,C),E.varyings.add("vuv","vec2"),E.varyings.add("vpos","vec3"),E.varyings.add("vnormal","vec3"),E.varyings.add("vtbnMatrix","mat3"),C.hasMultipassTerrain&&E.varyings.add("depth","float"),F.uniforms.add(K),F.code.add(B.glsl`
      void main(void) {
        if (waterColor.a < ${B.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${C.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${C.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);E.include(g.multipassTerrainTest,C);switch(C.output){case c.ShaderOutput.Alpha:E.include(w.SliceDraw,C);H.uniforms.add(K);H.code.add(B.glsl`
        void main() {
          discardBySlice(vpos);
          ${C.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case c.ShaderOutput.Color:E.include(l.MainLighting);E.include(m.EvaluateAmbientLighting,{pbrMode:d.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});E.include(u.WaterDistortion);E.include(w.SliceDraw,C);E.include(e.ReadShadowMapDraw,C);E.include(k.Water,C);H.uniforms.add([K,new y.FloatPassUniform("timeElapsed",I=>I.timeElapsed),F.uniforms.get("view"),F.uniforms.get("localOrigin")]);r.addCameraPosition(H,C);H.include(h.ColorConversion);l.addMainLightDirection(H);l.addMainLightIntensity(H);
H.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${C.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${C.receiveShadows?B.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${C.transparencyPassType===z.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `);break;case c.ShaderOutput.Normal:E.include(f.NormalUtils,C);E.include(u.WaterDistortion,C);E.include(w.SliceDraw,C);E.varyings.add("vpos","vec3");E.varyings.add("vuv","vec2");F.uniforms.add(K);F.code.add(B.glsl`
        void main(void) {
          if (waterColor.a < ${B.glsl.float(p.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);H.uniforms.add(new y.FloatPassUniform("timeElapsed",I=>I.timeElapsed));H.code.add(B.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case c.ShaderOutput.Highlight:E.include(x.OutputHighlight,C),E.varyings.add("vpos","vec3"),F.uniforms.add(K),F.code.add(B.glsl`
      void main(void) {
        if (waterColor.a < ${B.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),E.include(w.SliceDraw,C),H.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return E}const t=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=t;a.build=A})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(c,w){w.spherical?c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);w.spherical?c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(k){k=k.fragment;k.include(w.RgbaFloatEncoding);k.uniforms.add([new f.Texture2DPassUniform("shadowMapTex",(u,p)=>p.shadowMap.depthTexture),new x.IntegerPassUniform("numCascades",(u,p)=>p.shadowMap.numCascades),new n.Float4PassUniform("cascadeDistances",(u,p)=>p.shadowMap.cascadeDistances)]);k.code.add(m.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}let e=function(k){function u(){var h=p.apply(this,arguments);h.origin=c.create();return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(m.NoParameters);a.ReadShadowMapBindParameters=e;a.ReadShadowMapDraw=function(k,u){u.receiveShadows&&(k.fragment.uniforms.add(new l.Matrix4sDrawUniform("shadowMapMatrix",(p,h)=>h.shadowMap.getShadowMapMatrices(p.origin),4)),d(k))};a.ReadShadowMapPass=function(k,u){u.receiveShadows&&(k.fragment.uniforms.add(new g.Matrix4sPassUniform("shadowMapMatrix",
(p,h)=>h.shadowMap.getShadowMapMatrices(p.origin),4)),d(k))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"int",w.BindType.Pass,(f,d,e)=>f.setUniform1i(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);
a.IntegerPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g,f){return m.call(this,l,"mat4",w.BindType.Draw,(d,e,k)=>d.setUniformMatrix4fv(l,g(e,k)),f)}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Matrix4sDrawUniform=
c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g,f){return m.call(this,l,"mat4",w.BindType.Pass,(d,e,k)=>d.setUniformMatrix4fv(l,g(e,k)),f)}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Matrix4sPassUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,w,n,x,m,l,g,f){a.Water=function(d,e){d.include(w.PhysicallyBasedRenderingWater,
e);d.include(c.Gamma);d.include(b.FoamColor);e.hasCloudsReflections&&d.include(x.CloudsParallaxShading,e);e.hasScreenSpaceReflections&&d.include(n.ScreenSpaceReflections,e);d=d.fragment;d.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod",
"float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);d.code.add(l.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);d.uniforms.add([new m.FloatPassUniform("lightingSpecularStrength",(k,u)=>u.lighting.mainLight.specularStrength),new m.FloatPassUniform("lightingEnvironmentStrength",(k,u)=>u.lighting.mainLight.environmentStrength)]);d.code.add(l.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);e.hasCloudsReflections&&d.code.add(l.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);e.hasScreenSpaceReflections?(d.uniforms.add([new g.Matrix4PassUniform("view",(k,u)=>u.ssr.camera.viewMatrix),new f.Texture2DPassUniform("lastFrameColorTexture",(k,u)=>u.ssr.lastFrameColorTexture),new m.FloatPassUniform("fadeFactorSSR",(k,u)=>u.ssr.fadeFactor)]),d.code.add(l.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):d.code.add(l.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);e.hasCloudsReflections?e.hasScreenSpaceReflections?d.code.add(l.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):d.code.add(l.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):d.code.add(l.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,w,n){a.PhysicallyBasedRendering=function(x,m){const l=x.fragment.code;x.include(w.PiUtils);if(m.pbrMode===c.PBRMode.Normal||m.pbrMode===c.PBRMode.Schematic||m.pbrMode===c.PBRMode.Terrain||
m.pbrMode===c.PBRMode.TerrainWithWater)l.add(n.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),l.add(n.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(m.pbrMode===c.PBRMode.Normal||m.pbrMode===c.PBRMode.Schematic)x.include(b.AnalyticalSkyModel),l.add(n.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),l.add(n.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),l.add(n.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),l.add(n.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(x,m){const l=x.fragment.code;x.include(w.PiUtils);l.add(n.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${m.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);l.add(n.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);l.add(n.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);l.add(n.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);l.add(n.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(n=0,x=0){this.from=n;this.to=x}b._createClass(w,[{key:"numElements",get:function(){return this.to-this.from}}]);return w}();a.BufferRange=c;a.mergeAdjacentRanges=function(w){const n=new Map;w.forAll(m=>n.set(m.from,m));let x=!0;for(;x;)x=!1,w.forEach(m=>
{const l=n.get(m.to);l&&(m.to=l.to,n.delete(l.from),w.removeUnordered(l),x=!0)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./BufferRange"],function(a,b,c,w){w=function(n){function x(l,g,f){g=m.call(this,g,f);g.geometry=l;return g}b._inherits(x,n);var m=b._createSuper(x);b._createClass(x,[{key:"isVisible",get:function(){return this.geometry.visible}},
{key:"hasHighlights",get:function(){return c.isSome(this.geometry.highlights)&&this.isVisible}},{key:"hasOccludees",get:function(){return c.isSome(this.geometry.occludees)}}]);return x}(w.BufferRange);a.Instance=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ./BufferRange ./DrawCommand".split(" "),
function(a,b,c,w,n,x){function m(){return new w({allocator:d=>d||new x.DrawCommand,deallocator:d=>d})}function l(d,e){const k=d.back();null==k?(d=d.pushNew(),d.first=e.from,d.count=e.numElements):k.first+k.count>=e.from?k.count=e.from-k.first+e.numElements:(d=d.pushNew(),d.first=e.from,d.count=e.numElements)}let g=function(){function d(){this._numElements=0;this._instances=new Map;this.holes=new w({allocator:k=>k||new n.BufferRange,deallocator:null});this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=
!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=m();this.drawCommandsHighlight=m();this.drawCommandsOccludees=m();this.drawCommandsShadowHighlightRest=m()}var e=d.prototype;e.addInstance=function(k,u){this.deleteInstance(k);this._instances.set(k,u);this._numElements+=u.numElements};e.deleteInstance=function(k){const u=this._instances.get(k);u&&(this._numElements-=u.numElements,this._instances.delete(k))};e.updateInstance=function(k,u,p){if(k=this._instances.get(k))this._numElements-=k.numElements,
k.from=u,k.to=p,this._numElements+=k.numElements};e.updateDrawState=function(k){k.isVisible?(k.hasHighlights&&(this.hasHighlights=!0),k.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0};e.updateDrawCommands=function(k){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){k=Array.from(this._instances.values()).sort((p,
h)=>p.from===h.from?p.to-h.to:p.from-h.from);for(var u of k)u.isVisible&&(l(u.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,u),l(u.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,u))}else{const p=this.drawCommandsDefault.pushNew();u=this.holes.front();c.isSome(this.vao)&&1===this.holes.length&&u.to===Math.floor(this.vao.size/k)?(p.first=0,p.count=u.from):(p.first=Infinity,p.count=0,this._instances.forEach(h=>{p.first=Math.min(p.first,h.from);p.count=
Math.max(p.count,h.to)}),p.count-=p.first)}};e.needsMultipleCommands=function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances};b._createClass(d,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}}]);return d}(),f=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(g);a.PerBufferData=g;a.PerVaoData=f;a.hasVao=function(d){return c.isSome(d.vao)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(){this.count=this.first=0});a.DrawCommand=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,
b){let c=function(){function w(x){this.origin=x;this.buffers=[]}var n=w.prototype;n.dispose=function(){this.buffers.forEach(x=>x.vao.dispose());this.buffers.length=0};n.findBuffer=function(x){return this.buffers.find(m=>m.instances.has(x))};return b._createClass(w)}();a.PerOriginData=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/MemCache ../../../../../core/uid ../../lib/VertexArrayObject ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l){function g(e,k){if(k===w.RemoveMode.ALL)e.forEach(u=>u.dispose());else return k=e.pop(),e=e.length*k.size,k.dispose(),e}const f=w.MIN_PRIORITY+1;let d=function(){function e(u,p,h){this._rctx=u;this._locations=p;this._layout=h;this._cache=u.newCache(`VaoCache ${n.generateUID()}`,g)}var k=e.prototype;k.dispose=function(){this._cache.destroy()};k.newVao=function(u){var p=u.toString();const h=this._cache.pop(p);if(c.isSome(h)){const r=h.pop();0<h.length&&this._cache.put(p,h,
u*h.length,f);return r}p=new x.VertexArrayObject(this._rctx,this._locations,{geometry:this._layout},{geometry:m.BufferObject.createVertex(this._rctx,l.Usage.STATIC_DRAW)});p.vertexBuffers.geometry.setSize(u);return p};k.deleteVao=function(u){if(c.isNone(u))return null;const p=u.size,h=p.toString(),r=this._cache.pop(h);c.isSome(r)?(r.push(u),this._cache.put(h,r,p*r.length,-1)):this._cache.put(h,[u],p,-1);return null};return b._createClass(e)}();a.VaoCache=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/time ../../../../chunks/vec2 ./glUtil3D ./SSAOBlurTechnique ./SSAONoiseData ./SSAOTechnique ../../../../chunks/SSAO.glsl ../shaders/SSAOParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){let h=function(){function r(y,
B,D,z){this._view=y;this._techniqueRepository=B;this._rctx=D;this._requestRender=z;this._quadVAO=null;this._passParameters=new d.SSAOPassParameters;this._drawParameters=new d.BlurDrawParameters}var q=r.prototype;q.dispose=function(){this.enabled=!1;this._quadVAO=c.disposeMaybe(this._quadVAO)};q.disposeOffscreenBuffers=function(){c.applySome(this._ssaoFBO,y=>y.resize(0,0));c.applySome(this._blur0FBO,y=>y.resize(0,0));c.applySome(this._blur1FBO,y=>y.resize(0,0))};q.render=function(y,B,D,z){if(!(c.isNone(this._enableTime)||
c.isNone(D)||c.isNone(z)||c.isNone(this._ssaoFBO)||c.isNone(this._blur0FBO)||c.isNone(this._blur1FBO)))if(this.active){0===this._enableTime&&(this._enableTime=B);var v=this._rctx,A=y.camera,t=this._view.qualitySettings.fadeDuration;B=0<t?Math.min(t,B-this._enableTime)/t:1;this._passParameters.normalTexture=z;this._passParameters.depthTexture=D;this._passParameters.projScale=1/A.computeRenderPixelSizeAtDist(1);this._passParameters.intensity=2/f.getRadius(A)**6*B;D=A.fullViewport;z=D[2];A=D[3];t=z/
2;var C=A/2;this._ssaoFBO.resize(z,A);this._blur0FBO.resize(t,C);this._blur1FBO.resize(t,C);c.isNone(this._quadVAO)&&(this._quadVAO=x.createQuadVAO(this._rctx));v.bindFramebuffer(this._ssaoFBO);v.setViewport(0,0,z,A);v.bindTechnique(this._ssaoTechnique,this._passParameters,y).bindDraw(this._drawParameters,y,this._passParameters);v.bindVAO(this._quadVAO);var E=p.vertexCount(this._quadVAO,"geometry");v.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,E);var F=v.bindTechnique(this._blurTechnique,this._passParameters,
y);v.setViewport(0,0,t,C);v.bindFramebuffer(this._blur0FBO);this._drawParameters.colorTexture=this._ssaoFBO.colorTexture;n.set(this._drawParameters.blurSize,0,2/A);F.bindDraw(this._drawParameters,y,this._passParameters);v.setViewport(0,0,t,C);v.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,E);v.bindFramebuffer(this._blur1FBO);this._drawParameters.colorTexture=this._blur0FBO.colorTexture;n.set(this._drawParameters.blurSize,2/z,0);F.bindDraw(this._drawParameters,y,this._passParameters);v.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,
0,E);v.setViewport(D[0],D[1],D[2],D[3]);1>B&&this._requestRender()}else this._enableTime=B,this._requestRender()};q._enable=function(){if(!c.isSome(this._enableTime)){var y={target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,samplingMode:e.TextureSamplingMode.LINEAR,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},B={colorTarget:e.TargetType.TEXTURE,depthStencilTarget:e.DepthStencilTargetType.NONE};this._ssaoFBO=new k.FramebufferObject(this._rctx,
B,y);this._blur0FBO=new k.FramebufferObject(this._rctx,B,y);this._blur1FBO=new k.FramebufferObject(this._rctx,B,y);y=Uint8Array.from(atob(l.noiseData),D=>D.charCodeAt(0));this._passParameters.noiseTexture=new u.Texture(this._rctx,{target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGB,dataType:e.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},y);c.isNone(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(g.SSAOTechnique));c.isNone(this._blurTechnique)&&(this._blurTechnique=
this._techniqueRepository.acquire(m.SSAOBlurTechnique));this._enableTime=w.Milliseconds(0);this._requestRender()}};q._disable=function(){this._enableTime=null;this._passParameters.noiseTexture=c.disposeMaybe(this._passParameters.noiseTexture);this._blur1FBO=c.disposeMaybe(this._blur1FBO);this._blur0FBO=c.disposeMaybe(this._blur0FBO);this._ssaoFBO=c.disposeMaybe(this._ssaoFBO)};b._createClass(r,[{key:"enabled",get:function(){return c.isSome(this._enableTime)},set:function(y){y?this._enable():this._disable()}},
{key:"active",get:function(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}},{key:"colorTexture",get:function(){return c.isSome(this._blur1FBO)?this._blur1FBO.colorTexture:null}},{key:"gpuMemoryUsage",get:function(){return(c.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(c.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(c.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);
return r}();a.SSAOHelper=h;a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAOBlur.glsl ../../../webgl/renderState".split(" "),function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,
arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.SSAOBlur,()=>new Promise((f,d)=>a(["../shaders/SSAOBlur.glsl"],f,d)));b.SSAOBlurTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec3 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){function e(){const u=new g.ShaderBuilder,p=u.fragment;u.include(c.ScreenSpacePass);p.include(w.ReadLinearDepth);p.uniforms.add([new d.Texture2DPassUniform("depthMap",h=>h.depthTexture),new f.Texture2DDrawUniform("tex",h=>h.colorTexture),new n.Float2DrawUniform("blurSize",h=>h.blurSize),new m.FloatPassUniform("projScale",(h,r)=>{r=b.distance(r.camera.eye,r.camera.center);return 5E4<r?Math.max(0,h.projScale-(r-5E4)):h.projScale}),new x.Float2PassUniform("nearFar",(h,
r)=>r.camera.nearFar)]);p.code.add(l.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${l.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);p.code.add(l.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${l.glsl.int(4)}; r <= ${l.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `);return u}const k=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=k;a.build=e})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"vec2",w.BindType.Draw,(f,d,e,k)=>f.setUniform2fv(l,g(d,e,k)))}b._inherits(x,n);var m=b._createSuper(x);
return b._createClass(x)}(c.Uniform);a.Float2DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);
f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.SSAO,()=>new Promise((f,d)=>a(["../shaders/SSAO.glsl"],f,d)));b.SSAOTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(){const h=new d.ShaderBuilder,r=h.fragment;h.include(n.ScreenSpacePass);r.include(x.ReadLinearDepth);h.include(m.CameraSpace);r.uniforms.add(new g.FloatPassUniform("radius",(q,y)=>u(y.camera)));r.code.add(f.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`);r.code.add(f.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);r.uniforms.add([new l.Float2PassUniform("nearFar",(q,y)=>y.camera.nearFar),new e.Texture2DPassUniform("normalMap",q=>q.normalTexture),new e.Texture2DPassUniform("depthMap",q=>q.depthTexture),new l.Float2PassUniform("zScale",(q,y)=>m.getZScale(y)),new g.FloatPassUniform("projScale",q=>q.projScale),new e.Texture2DPassUniform("rnm",q=>q.noiseTexture),new l.Float2PassUniform("rnmScale",(q,y)=>c.set(p,y.camera.fullWidth/b.unwrap(q.noiseTexture).descriptor.width,y.camera.fullHeight/b.unwrap(q.noiseTexture).descriptor.height)),
new g.FloatPassUniform("intensity",q=>q.intensity),new l.Float2PassUniform("screenSize",(q,y)=>c.set(p,y.camera.fullWidth,y.camera.fullHeight))]);r.code.add(f.glsl`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${f.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${f.glsl.int(16)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `);return h}function u(h){return Math.max(10,20*h.computeRenderPixelSizeAtDist(Math.abs(4*h.relativeElevation)))}const p=w.create();w=Object.freeze(Object.defineProperty({__proto__:null,build:k,getRadius:u},Symbol.toStringTag,{value:"Module"}));a.SSAO=w;a.build=k;a.getRadius=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,w,n,x,m,l){function g(e){return 0===e.camera.projectionMatrix[11]?b.set(d,0,1):b.set(d,1,0)}const f=n.create(),d=c.create();a.CameraSpace=function(e){e.fragment.uniforms.add(new m.Float4PassUniform("projInfo",(k,u)=>{k=u.camera.projectionMatrix;u=0===k[11]?w.set(f,2/(u.camera.fullWidth*k[0]),2/(u.camera.fullHeight*k[5]),(1+k[12])/k[0],(1+k[13])/k[5]):w.set(f,-2/(u.camera.fullWidth*k[0]),-2/(u.camera.fullHeight*k[5]),(1-k[8])/k[0],(1-k[9])/k[5]);return u}));e.fragment.uniforms.add(new x.Float2PassUniform("zScale",
(k,u)=>g(u)));e.fragment.code.add(l.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getZScale=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/SSAOParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../core/shaderModules/interfaces"],function(a,b,c,w){let n=function(l){function g(){var d=f.apply(this,arguments);d.projScale=1;return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(w.NoParameters),x=function(l){function g(){var d=f.apply(this,
arguments);d.intensity=1;return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(n);w=function(l){function g(){return f.apply(this,arguments)}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(w.NoParameters);let m=function(l){function g(){var d=f.apply(this,arguments);d.blurSize=c.create();return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(w);a.BlurDrawParameters=m;a.BlurPassParameters=n;a.SSAODrawParameters=w;a.SSAOPassParameters=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,c,w,n,x,m,l,g,f){x=function(d){function e(){return k.apply(this,arguments)}c._inherits(e,d);
var k=c._createSuper(e);d=e.prototype;d.initializeProgram=function(u){return new l.Program(u.rctx,e.shader.get().build(),m.Default3D)};d.initializePipeline=function(){return this.configuration.hasAlpha?f.makePipelineState({blending:f.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams}):f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(x.ShaderTechnique);
x.shader=new n.ReloadableShaderModule(w.TextureOnly,()=>new Promise((d,e)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],d,e)));b.TextureTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){let n=function(x){function m(){var g=l.apply(this,
arguments);g.hasAlpha=!1;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter()],n.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){u=function(R){function O(M){M=J.call(this,M,t);M.supportsEdges=!0;M._configuration=new z.DefaultMaterialTechniqueConfiguration;var G=M.parameters;const P=l.newLayout().vec3f(r.VertexAttribute.POSITION).vec3f(r.VertexAttribute.NORMAL),U=G.textureId||G.normalTextureId||G.metallicRoughnessTextureId||G.emissiveTextureId||G.occlusionTextureId;G.hasVertexTangents&&P.vec4f(r.VertexAttribute.TANGENT);U&&P.vec2f(r.VertexAttribute.UV0);G.hasVertexColors&&
P.vec4u8(r.VertexAttribute.COLOR);G.hasSymbolColors&&P.vec4u8(r.VertexAttribute.SYMBOLCOLOR);c("enable-feature:objectAndLayerId-rendering")&&P.vec4u8(r.VertexAttribute.OBJECTANDLAYERIDCOLOR);M._vertexBufferLayout=P;return M}b._inherits(O,R);var J=b._createSuper(O);R=O.prototype;R.isVisibleForOutput=function(M){return M===g.ShaderOutput.Shadow||M===g.ShaderOutput.ShadowExcludeHighlight||M===g.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};R.isVisible=function(){var M=this.parameters;
if(!b._get(b._getPrototypeOf(O.prototype),"isVisible",this).call(this)||0===M.layerOpacity)return!1;const {hasInstancedColor:G,hasVertexColors:P,hasSymbolColors:U,vvColor:N}=M,S="replace"===M.colorMixMode,Q=0<M.opacity;M=M.externalColor&&0<M.externalColor[3];const W=G||N||U;return P&&W?S||Q:P?S?M:Q:W?S||Q:S?M:Q};R.getConfiguration=function(M,G){this._configuration.output=M;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;
this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=w.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=w.isSome(this.parameters.screenSizePerspective);this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;w.isSome(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=
this.parameters.hasSlicePlane?e.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=G.multipassTerrain.enabled;this._configuration.cullAboveGround=G.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=w.isSome(this.parameters.modelTransformation);if(M===g.ShaderOutput.Color||M===g.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=
this.parameters.treeRendering?f.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.WindingOrder:f.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=
G.ssaoHelper.active?this.parameters.receiveSSAO:!1,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?d.PBRMode.Schematic:d.PBRMode.Normal:d.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=G.transparencyPassType,this._configuration.enableOffset=G.camera.relativeElevation<p.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(G),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,
this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};R.hasSnowCover=function(M){return w.isSome(M.weather)&&M.weatherVisible&&"snowy"===M.weather.type&&"enabled"===M.weather.snowCover};R.intersect=function(M,G,P,U,N,
S){if(w.isSome(this.parameters.verticalOffset)){const W=P.camera;n.set(I,G[12],G[13],G[14]);G=null;switch(P.viewingMode){case m.ViewingMode.Global:G=n.normalize(H,I);break;case m.ViewingMode.Local:G=n.copy(H,F)}let V=0;var Q=n.subtract(L,I,W.eye);const T=n.length(Q);Q=n.scale(Q,Q,1/T);let X=null;this.parameters.screenSizePerspective&&(X=n.dot(G,Q));V+=B.verticalOffsetAtDistance(W,T,this.parameters.verticalOffset,X??0,this.parameters.screenSizePerspective);n.scale(G,G,V);n.transformMat3(K,G,P.transform.inverseRotation);
U=n.subtract(C,U,K);N=n.subtract(E,N,K)}B.intersectTriangleGeometry(M,P,U,N,q.getVerticalOffsetObject3D(P.verticalOffset),S)};R.requiresSlot=function(M,G){return G===g.ShaderOutput.Color||G===g.ShaderOutput.Alpha||G===g.ShaderOutput.Depth||G===g.ShaderOutput.Normal||G===g.ShaderOutput.Shadow||G===g.ShaderOutput.ShadowHighlight||G===g.ShaderOutput.ShadowExcludeHighlight||G===g.ShaderOutput.Highlight||G===g.ShaderOutput.ObjectAndLayerIdColor?M===(this.parameters.transparent?this.parameters.writeDepth?
h.RenderSlot.TRANSPARENT_MATERIAL:h.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:h.RenderSlot.OPAQUE_MATERIAL)||M===h.RenderSlot.DRAPED_MATERIAL:!1};R.createGLMaterial=function(M){return new A(M)};R.createBufferWriter=function(){return new y.DefaultBufferWriter(this._vertexBufferLayout)};return b._createClass(O)}(u.Material);let A=function(R){function O(M){return J.call(this,{...M,...M.material.parameters})}b._inherits(O,R);var J=b._createSuper(O);R=O.prototype;R._updateShadowState=function(M){M.shadowMap.enabled!==
this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:M.shadowMap.enabled})};R._updateOccludeeState=function(M){M.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:M.hasOccludees})};R.beginSlot=function(M){if(this._output===g.ShaderOutput.Color||this._output===g.ShaderOutput.Alpha)this._updateShadowState(M),this._updateOccludeeState(M);const G=this._material.parameters;this.updateTexture(G.textureId);const P=
M.camera.viewInverseTransposeMatrix;n.set(G.origin,P[3],P[7],P[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(G.treeRendering?v.RealisticTreeTechnique:D.DefaultMaterialTechnique,M)};return b._createClass(O)}(k.GLTextureMaterial);k=function(R){function O(){var M=J.apply(this,arguments);M.initTextureTransparent=!1;M.treeRendering=!1;M.hasVertexTangents=!1;return M}b._inherits(O,R);var J=b._createSuper(O);return b._createClass(O)}(D.DefaultMaterialPassParameters);
const t=new k,C=x.create(),E=x.create(),F=x.fromValues(0,0,1),H=x.create(),K=x.create(),I=x.create(),L=x.create();a.DefaultGLMaterial=A;a.DefaultMaterial=u;a.DefaultMaterialParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(w){w[w.None=0]="None";
w[w.View=1]="View";w[w.WindingOrder=2]="WindingOrder";w[w.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(w,n){w=w.fragment;w.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(n.doubleSidedMode){case a.NormalsDoubleSidedMode.None:w.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:w.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:w.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(n.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){let A=function(t){function C(){var F=E.apply(this,arguments);F.isSchematic=!1;F.usePBR=!1;F.mrrFactors=w.fromValues(0,1,.5);F.hasVertexColors=!1;F.hasSymbolColors=!1;F.doubleSided=!1;F.doubleSidedType="normal";F.cullFace=u.CullFaceOptions.Back;F.isInstanced=!1;F.hasInstancedColor=!1;F.emissiveFactor=w.fromValues(0,0,0);F.instancedDoublePrecision=!1;F.normalType=l.NormalAttributeType.Attribute;F.receiveSSAO=!0;F.receiveShadows=!0;F.castShadows=
!0;F.shadowMappingEnabled=!1;F.ambient=w.fromValues(.2,.2,.2);F.diffuse=w.fromValues(.8,.8,.8);F.externalColor=n.fromValues(1,1,1,1);F.colorMixMode="multiply";F.opacity=1;F.layerOpacity=1;F.origin=w.create();F.hasSlicePlane=!1;F.hasSliceHighlight=!0;F.offsetTransparentBackfaces=!1;F.vvSize=null;F.vvColor=null;F.vvOpacity=null;F.vvSymbolAnchor=null;F.vvSymbolRotationMatrix=null;F.transparent=!1;F.writeDepth=!0;F.customDepthTest=u.DepthTestFunction.Less;F.textureAlphaMode=u.AlphaDiscardMode.Blend;F.textureAlphaCutoff=
d.defaultMaskAlphaCutoff;F.textureAlphaPremultiplied=!1;F.hasOccludees=!1;F.renderOccluded=h.RenderOccludedFlag.Occlude;return F}c._inherits(C,t);var E=c._createSuper(C);return c._createClass(C)}(f.VertexNormalPassParameters);f=function(t){function C(){var F=E.apply(this,arguments);F.origin=w.create();F.slicePlaneLocalOrigin=F.origin;return F}c._inherits(C,t);var E=c._createSuper(C);return c._createClass(C)}(f.VertexNormalDrawParameters);k=function(t){function C(){return E.apply(this,arguments)}c._inherits(C,
t);var E=c._createSuper(C);t=C.prototype;t.initializeConfiguration=function(F,H){H.spherical=F.viewingMode===x.ViewingMode.Global;H.doublePrecisionRequiresObfuscation=F.rctx.driverTest.doublePrecisionRequiresObfuscation.result;H.textureCoordinateType=H.hasColorTexture||H.hasMetallicRoughnessTexture||H.hasEmissionTexture||H.hasOcclusionTexture||H.hasNormalTexture?g.TextureCoordinateAttributeType.Default:g.TextureCoordinateAttributeType.None;H.objectAndLayerIdColorInstanced=H.instanced};t.initializeProgram=
function(F){return this._initializeProgram(F,C.shader)};t._initializeProgram=function(F,H){return new q.Program(F.rctx,H.get().build(this.configuration),p.Default3D)};t._convertDepthTestFunction=function(F){return F===u.DepthTestFunction.Lequal?z.CompareFunction.LEQUAL:z.CompareFunction.LESS};t._makePipeline=function(F,H){const K=this.configuration,I=F===B.TransparencyPassType.NONE,L=F===B.TransparencyPassType.FrontFace;var R=v.makePipelineState,O=K.output!==m.ShaderOutput.Color&&K.output!==m.ShaderOutput.Alpha||
!K.transparent?null:I?r.blendingDefault:r.oitBlending(F);var J=K.cullFace!==u.CullFaceOptions.None?!0:K.hasSlicePlane?!1:!K.transparent&&!K.doubleSidedMode;return R.call(v,{blending:O,culling:J?v.cullingParams(K.cullFace):null,depthTest:{func:r.oitDepthTest(F,this._convertDepthTestFunction(K.customDepthTest))},depthWrite:I||L?K.writeDepth?v.defaultDepthWriteParams:null:null,colorWrite:v.defaultColorWriteParams,stencilWrite:K.hasOccludees?y.stencilWriteMaskOn:null,stencilTest:K.hasOccludees?H?y.stencilToolMaskBaseParams:
y.stencilBaseAllZerosParams:null,polygonOffset:I||L?null:r.getOITPolygonOffset(K.enableOffset)})};t.initializePipeline=function(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0);return this._makePipeline(this.configuration.transparencyPassType,!1)};t.getPipelineState=function(F,H){return H?this._occludeePipelineState:c._get(c._getPrototypeOf(C.prototype),"getPipelineState",this).call(this,F,H)};return c._createClass(C)}(k.ShaderTechnique);k.shader=new e.ReloadableShaderModule(D.DefaultMaterial,
()=>new Promise((t,C)=>a(["./DefaultMaterial.glsl"],t,C)));b.DefaultMaterialDrawParameters=f;b.DefaultMaterialPassParameters=A;b.DefaultMaterialTechnique=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../core/maybe ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S){function Q(V){const T=new P.ShaderBuilder,{vertex:X,fragment:Z,varyings:Y}=T;L.addProjViewLocalOrigin(X,V);T.include(d.PositionAttribute);Y.add("vpos","vec3");T.include(F.VisualVariables,V);T.include(g.InstancedDoublePrecision,V);T.include(h.VerticalOffset,V);V.hasColorTextureTransform&&T.include(E.colorTextureUV);if(V.output===x.ShaderOutput.Color||V.output===x.ShaderOutput.Alpha)V.hasNormalTextureTransform&&
T.include(E.normalTextureUV),V.hasEmissionTextureTransform&&T.include(E.emissiveTextureUV),V.hasOcclusionTextureTransform&&T.include(E.occlusionTextureUV),V.hasMetallicRoughnessTextureTransform&&T.include(E.metallicRoughnessTextureUV),L.addCameraPosition(X,V),T.include(f.NormalAttribute,V),T.include(l.Transform,V),V.normalType===f.NormalAttributeType.Attribute&&V.offsetBackfaces&&T.include(n.Offset),T.include(q.ComputeNormalTexture,V),T.include(p.VertexNormal,V),V.instancedColor&&T.attributes.add(S.VertexAttribute.INSTANCECOLOR,
"vec4"),Y.add("localvpos","vec3"),T.include(k.TextureCoordinateAttribute,V),T.include(w.ForwardLinearDepth,V),T.include(e.SymbolColor,V),T.include(u.VertexColor,V),X.uniforms.add(new O.Float4PassUniform("externalColor",aa=>aa.externalColor)),Y.add("vcolorExt","vec4"),V.hasMultipassTerrain&&Y.add("depth","float"),V.hasModelTransformation&&X.uniforms.add(new G.Matrix4PassUniform("model",aa=>b.isSome(aa.modelTransformation)?aa.modelTransformation:c.IDENTITY)),X.code.add(M.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${V.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${M.glsl.float(H.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${V.normalType===f.NormalAttributeType.Attribute?M.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${V.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${V.hasModelTransformation?"model,":""} vpos);
          ${V.normalType===f.NormalAttributeType.Attribute&&V.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${V.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${V.hasColorTextureTransform?M.glsl`forwardColorUV();`:""}
        ${V.hasNormalTextureTransform?M.glsl`forwardNormalUV();`:""}
        ${V.hasEmissionTextureTransform?M.glsl`forwardEmissiveUV();`:""}
        ${V.hasOcclusionTextureTransform?M.glsl`forwardOcclusionUV();`:""}
        ${V.hasMetallicRoughnessTextureTransform?M.glsl`forwardMetallicRoughnessUV();`:""}
      }
    `);V.output===x.ShaderOutput.Alpha&&(T.include(m.SliceDraw,V),T.include(K.DiscardOrAdjustAlphaPass,V),T.include(z.multipassTerrainTest,V),Z.uniforms.add([new J.FloatPassUniform("opacity",aa=>aa.opacity),new J.FloatPassUniform("layerOpacity",aa=>aa.layerOpacity)]),V.hasColorTexture&&Z.uniforms.add(new U.Texture2DPassUniform("tex",aa=>aa.texture)),Z.include(I.MixExternalColor),Z.code.add(M.glsl`
      void main() {
        discardBySlice(vpos);
        ${V.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${V.hasColorTexture?M.glsl`
                vec4 texColor = texture(tex, ${V.hasColorTextureTransform?M.glsl`colorUV`:M.glsl`vuv0`});
                ${V.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:M.glsl`vec4 texColor = vec4(1.0);`}
        ${V.hasVertexColors?M.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:M.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `));V.output===x.ShaderOutput.Color&&(T.include(m.SliceDraw,V),T.include(B.EvaluateSceneLighting,V),T.include(y.EvaluateAmbientOcclusion,V),T.include(K.DiscardOrAdjustAlphaPass,V),T.include(V.instancedDoublePrecision?C.ReadShadowMapPass:C.ReadShadowMapDraw,V),T.include(z.multipassTerrainTest,V),L.addCameraPosition(Z,V),Z.uniforms.add([X.uniforms.get("localOrigin"),new R.Float3PassUniform("ambient",aa=>aa.ambient),new R.Float3PassUniform("diffuse",aa=>aa.diffuse),new J.FloatPassUniform("opacity",
aa=>aa.opacity),new J.FloatPassUniform("layerOpacity",aa=>aa.layerOpacity)]),V.hasColorTexture&&Z.uniforms.add(new U.Texture2DPassUniform("tex",aa=>aa.texture)),T.include(t.PhysicallyBasedRenderingParameters,V),T.include(A.PhysicallyBasedRendering,V),Z.include(I.MixExternalColor),T.include(v.Normals,V),B.addAmbientBoostFactor(Z),B.addLightingGlobalFactor(Z),D.addMainLightIntensity(Z),Z.code.add(M.glsl`
      void main() {
        discardBySlice(vpos);
        ${V.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${V.hasColorTexture?M.glsl`
                vec4 texColor = texture(tex, ${V.hasColorTextureTransform?M.glsl`colorUV`:M.glsl`vuv0`});
                ${V.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:M.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${V.normalType===f.NormalAttributeType.ScreenDerivative?M.glsl`
                vec3 normal = screenDerivativeNormal(localvpos);`:M.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${V.pbrMode===t.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${V.receiveShadows?"readShadowMap(vpos, linearDepth)":V.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${V.hasVertexColors?M.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:M.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${V.hasNormalTexture?M.glsl`
                mat3 tangentSpace = ${V.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${V.hasNormalTextureTransform?M.glsl`normalUV`:"vuv0"});`:M.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${V.spherical?M.glsl`normalize(posWorld);`:M.glsl`vec3(0.0, 0.0, 1.0);`}

        ${V.snowCover?M.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${V.pbrMode===t.PBRMode.Normal||V.pbrMode===t.PBRMode.Schematic?M.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${V.snowCover?M.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:M.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${V.transparencyPassType===N.TransparencyPassType.Color?M.glsl`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `));T.include(r.DefaultMaterialAuxiliaryPasses,V);return T}const W=Object.freeze(Object.defineProperty({__proto__:null,build:Q},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=W;a.build=Q})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){let u=function(h){function r(){var y=q.apply(this,arguments);y.instancedDoublePrecision=!1;return y}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(d.ShaderTechniqueConfiguration);c.__decorate([d.parameter()],u.prototype,"instancedDoublePrecision",void 0);const p=n.create();a.InstancedDoubleConfiguration=u;a.InstancedDoublePrecision=function(h,r){r.instanced&&r.instancedDoublePrecision&&(h.attributes.add(e.VertexAttribute.MODELORIGINHI,"vec3"),
h.attributes.add(e.VertexAttribute.MODELORIGINLO,"vec3"),h.attributes.add(e.VertexAttribute.MODEL,"mat3"),h.attributes.add(e.VertexAttribute.MODELNORMAL,"mat3"));h=h.vertex;r.instancedDoublePrecision&&(h.include(m.DoublePrecision,r),h.uniforms.add(new g.Float3DrawUniform("viewOriginHi",(q,y)=>k.encodeDoubleHi(w.set(p,y.camera.viewInverseTransposeMatrix[3],y.camera.viewInverseTransposeMatrix[7],y.camera.viewInverseTransposeMatrix[11]),p))),h.uniforms.add(new g.Float3DrawUniform("viewOriginLo",(q,y)=>
k.encodeDoubleLo(w.set(p,y.camera.viewInverseTransposeMatrix[3],y.camera.viewInverseTransposeMatrix[7],y.camera.viewInverseTransposeMatrix[11]),p))));h.code.add(f.glsl`
    vec3 calculateVPos() {
      ${r.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `);h.code.add(f.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${r.instancedDoublePrecision?f.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);h.code.add(f.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${r.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `);r.output===x.ShaderOutput.Normal&&(l.addViewNormal(h),h.code.add(f.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${r.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `));r.hasVertexTangents&&h.code.add(f.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,c,w,n,x){a.SymbolColor=function(m,l){l.hasSymbolColors?(m.include(b.DecodeSymbolColor),m.attributes.add(n.VertexAttribute.SYMBOLCOLOR,
"vec4"),m.varyings.add("colorMixMode","mediump float"),m.vertex.code.add(w.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(m.fragment.uniforms.add(new c.IntegerPassUniform("colorMixMode",g=>x.colorMixModes[g.colorMixMode])),m.vertex.code.add(w.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(w){w.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,b,c){a.ColorMixModeEnum=void 0;(function(w){w[w.Multiply=1]="Multiply";w[w.Ignore=2]="Ignore";w[w.Replace=3]="Replace";w[w.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(w,n,x){if(c.isNone(w)||n===a.ColorMixModeEnum.Ignore)x[0]=255,x[1]=255,x[2]=
255,x[3]=255;else{var m=b.clamp(Math.round(85*w[3]),0,85);n=0===m||n===a.ColorMixModeEnum.Tint?0:n===a.ColorMixModeEnum.Replace?85:170;x[0]=b.clamp(Math.round(255*w[0]),0,255);x[1]=b.clamp(Math.round(255*w[1]),0,255);x[2]=b.clamp(Math.round(255*w[2]),0,255);x[3]=m+n}};a.parseColorMixMode=function(w){switch(w){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;
default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(w,n){n.hasVertexColors?(w.attributes.add(c.VertexAttribute.COLOR,"vec4"),w.varyings.add("vColor","vec4"),w.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),w.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):
w.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../../../../../../core/maybe ../../../../../../chunks/mat4f64 ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){a.DefaultMaterialAuxiliaryPasses=function(D,z){const {vertex:v,fragment:A}=D,t=z.hasModelTransformation;t&&v.uniforms.add(new q.Matrix4PassUniform("model",E=>b.isSome(E.modelTransformation)?E.modelTransformation:c.IDENTITY));const C=z.hasColorTexture&&z.alphaDiscardMode!==B.AlphaDiscardMode.Opaque;switch(z.output){case n.ShaderOutput.Depth:case n.ShaderOutput.Shadow:case n.ShaderOutput.ShadowHighlight:case n.ShaderOutput.ShadowExcludeHighlight:case n.ShaderOutput.ObjectAndLayerIdColor:h.addProjViewLocalOrigin(v,
z);D.include(m.Transform,z);D.include(f.TextureCoordinateAttribute,z);D.include(u.VisualVariables,z);D.include(e.OutputDepth,z);D.include(x.SliceDraw,z);D.include(g.ObjectAndLayerIdColor,z);w.addNearFar(D);D.varyings.add("depth","float");C&&A.uniforms.add(new y.Texture2DPassUniform("tex",E=>E.texture));v.code.add(r.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${t?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `);D.include(p.DiscardOrAdjustAlphaPass,z);A.code.add(r.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${C?r.glsl`
                    vec4 texColor = texture(tex, ${z.hasColorTextureTransform?r.glsl`colorUV`:r.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${z.output===n.ShaderOutput.ObjectAndLayerIdColor?r.glsl`outputObjectAndLayerIdColor();`:r.glsl`outputDepth(depth);`}
          }
        `);break;case n.ShaderOutput.Normal:h.addProjViewLocalOrigin(v,z);D.include(m.Transform,z);D.include(l.NormalAttribute,z);D.include(d.VertexNormal,z);D.include(f.TextureCoordinateAttribute,z);D.include(u.VisualVariables,z);C&&A.uniforms.add(new y.Texture2DPassUniform("tex",E=>E.texture));D.varyings.add("vPositionView","vec3");v.code.add(r.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${z.normalType===l.NormalAttributeType.Attribute?r.glsl`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${t?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `);D.include(x.SliceDraw,z);D.include(p.DiscardOrAdjustAlphaPass,z);A.code.add(r.glsl`
          void main() {
            discardBySlice(vpos);
            ${C?r.glsl`
                    vec4 texColor = texture(tex, ${z.hasColorTextureTransform?r.glsl`colorUV`:r.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${z.normalType===l.NormalAttributeType.ScreenDerivative?r.glsl`
                vec3 normal = screenDerivativeNormal(vPositionView);`:r.glsl`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case n.ShaderOutput.Highlight:h.addProjViewLocalOrigin(v,z),D.include(m.Transform,z),D.include(f.TextureCoordinateAttribute,z),D.include(u.VisualVariables,z),C&&A.uniforms.add(new y.Texture2DPassUniform("tex",E=>E.texture)),v.code.add(r.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${t?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),D.include(x.SliceDraw,z),D.include(p.DiscardOrAdjustAlphaPass,z),D.include(k.OutputHighlight,z),A.code.add(r.glsl`
          void main() {
            discardBySlice(vpos);
            ${C?r.glsl`
                    vec4 texColor = texture(tex, ${z.hasColorTextureTransform?r.glsl`colorUV`:r.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,c,w,n,x){function m(l,g,f){const d=l.fragment;g.alphaDiscardMode!==x.AlphaDiscardMode.Mask&&g.alphaDiscardMode!==x.AlphaDiscardMode.MaskBlend||
d.uniforms.add(f);switch(g.alphaDiscardMode){case x.AlphaDiscardMode.Blend:return l.include(b.DiscardOrAdjustAlphaBlend);case x.AlphaDiscardMode.Opaque:d.code.add(n.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case x.AlphaDiscardMode.Mask:d.code.add(n.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case x.AlphaDiscardMode.MaskBlend:l.fragment.code.add(n.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(l,g){m(l,g,new c.FloatDrawUniform("textureAlphaCutoff",f=>f.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(l,g){m(l,g,new w.FloatPassUniform("textureAlphaCutoff",
f=>f.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,c){a.DiscardOrAdjustAlphaBlend=function(w){w.fragment.code.add(c.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${c.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"float",w.BindType.Draw,(f,d,e)=>f.setUniform1f(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.FloatDrawUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),function(a,b,c,w,n,x,m,l,g){a.ComputeNormalTexture=function(f,
d){const e=f.fragment;d.hasVertexTangents?(f.attributes.add(g.VertexAttribute.TANGENT,"vec4"),f.varyings.add("vTangent","vec4"),d.doubleSidedMode===w.NormalsDoubleSidedMode.WindingOrder?e.code.add(n.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):e.code.add(n.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):e.code.add(n.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);d.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(f.include(c.VertexTextureCoordinates,d),e.uniforms.add(d.pbrTextureBindType===l.BindType.Pass?new m.Texture2DPassUniform("normalTexture",k=>k.textureNormal):new x.Texture2DDrawUniform("normalTexture",k=>k.textureNormal)),e.code.add(n.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../lib/SSAOHelper"],function(a,b,c,w){a.EvaluateAmbientOcclusion=function(n,x){n=n.fragment;x.receiveAmbientOcclusion?(n.uniforms.add(new c.Texture2DPassUniform("ssaoTex",(m,l)=>l.ssaoHelper.colorTexture)),n.constants.add("blurSizePixelsInverse",
"float",1/w.blurSizePixels),n.code.add(b.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):n.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(p){p.constants.add("ambientBoostFactor","float",e.ambientBoost)}function u(p){p.uniforms.add(new f.FloatPassUniform("lightingGlobalFactor",(h,r)=>r.lighting.globalFactor))}a.EvaluateSceneLighting=function(p,h){const r=p.fragment;p.include(w.EvaluateAmbientOcclusion,h);h.pbrMode!==m.PBRMode.Disabled&&p.include(x.PhysicallyBasedRendering,h);p.include(c.EvaluateAmbientLighting,h);p.include(l.PiUtils);r.code.add(d.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${h.pbrMode===m.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);k(r);u(r);n.addMainLightDirection(r);r.code.add(d.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${h.spherical?d.glsl`normalize(vPosWorld)`:d.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);n.addMainLightIntensity(r);r.code.add(d.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(h.pbrMode){case m.PBRMode.Disabled:case m.PBRMode.WaterOnIntegratedMesh:case m.PBRMode.Water:p.include(n.MainLighting);r.code.add(d.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case m.PBRMode.Normal:case m.PBRMode.Schematic:r.code.add(d.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);r.code.add(d.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);h.useFillLights?r.uniforms.add(new g.BooleanPassUniform("hasFillLights",(q,y)=>y.enableFillLights)):r.constants.add("hasFillLights","bool",!1);r.code.add(d.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);r.uniforms.add([new f.FloatPassUniform("lightingSpecularStrength",(q,y)=>y.lighting.mainLight.specularStrength),new f.FloatPassUniform("lightingEnvironmentStrength",(q,y)=>y.lighting.mainLight.environmentStrength)]);r.code.add(d.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);r.code.add(d.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${h.pbrMode===m.PBRMode.Schematic?d.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:d.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case m.PBRMode.Terrain:case m.PBRMode.TerrainWithWater:p.include(n.MainLighting);r.code.add(d.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:b.neverReached(h.pbrMode);case m.PBRMode.COUNT:}};a.addAmbientBoostFactor=k;a.addLightingGlobalFactor=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/maybe","../../../../../../chunks/mat3f32","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,c,w,n){a.colorTextureUV=function(x){x.vertex.uniforms.add(new n.Matrix3PassUniform("colorTextureTransformMatrix",
m=>b.isSome(m.colorTextureTransformMatrix)?m.colorTextureTransformMatrix:c.create()));x.varyings.add("colorUV","vec2");x.vertex.code.add(w.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.emissiveTextureUV=function(x){x.vertex.uniforms.add(new n.Matrix3PassUniform("emissiveTextureTransformMatrix",m=>b.isSome(m.emissiveTextureTransformMatrix)?m.emissiveTextureTransformMatrix:c.create()));x.varyings.add("emissiveUV","vec2");x.vertex.code.add(w.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.metallicRoughnessTextureUV=function(x){x.vertex.uniforms.add(new n.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",m=>b.isSome(m.metallicRoughnessTextureTransformMatrix)?m.metallicRoughnessTextureTransformMatrix:c.create()));x.varyings.add("metallicRoughnessUV","vec2");x.vertex.code.add(w.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.normalTextureUV=function(x){x.vertex.uniforms.add(new n.Matrix3PassUniform("normalTextureTransformMatrix",m=>b.isSome(m.normalTextureTransformMatrix)?m.normalTextureTransformMatrix:c.create()));x.varyings.add("normalUV","vec2");x.vertex.code.add(w.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.occlusionTextureUV=function(x){x.vertex.uniforms.add(new n.Matrix3PassUniform("occlusionTextureTransformMatrix",m=>b.isSome(m.occlusionTextureTransformMatrix)?m.occlusionTextureTransformMatrix:c.create()));x.varyings.add("occlusionUV","vec2");x.vertex.code.add(w.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const m=new Float32Array(9);m[0]=1;m[4]=1;m[8]=1;return m}function c(m){const l=new Float32Array(9);l[0]=m[0];l[1]=m[1];l[2]=m[2];l[3]=m[3];l[4]=m[4];l[5]=m[5];l[6]=m[6];l[7]=m[7];l[8]=m[8];return l}function w(m,l,g,f,d,e,k,u,p){const h=new Float32Array(9);h[0]=m;h[1]=l;h[2]=g;h[3]=f;h[4]=d;h[5]=e;h[6]=k;h[7]=u;h[8]=p;return h}function n(m,l){return new Float32Array(m,
l,9)}const x=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:n,fromValues:w},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.mat3f32=x})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,w){a.MixExternalColor=function(n){n.include(c.ColorConversion);n.code.add(w.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${w.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${w.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${w.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){e=function(k){function u(){var h=p.apply(this,arguments);h.output=w.ShaderOutput.Color;h.alphaDiscardMode=f.AlphaDiscardMode.Opaque;h.doubleSidedMode=m.NormalsDoubleSidedMode.None;h.pbrMode=l.PBRMode.Disabled;h.cullFace=f.CullFaceOptions.None;h.transparencyPassType=d.TransparencyPassType.NONE;h.normalType=n.NormalAttributeType.Attribute;h.textureCoordinateType=x.TextureCoordinateAttributeType.None;h.customDepthTest=f.DepthTestFunction.Less;h.spherical=!1;h.hasVertexColors=
!1;h.hasSymbolColors=!1;h.hasVerticalOffset=!1;h.hasSlicePlane=!1;h.hasSliceHighlight=!0;h.hasColorTexture=!1;h.hasMetallicRoughnessTexture=!1;h.hasEmissionTexture=!1;h.hasOcclusionTexture=!1;h.hasNormalTexture=!1;h.hasScreenSizePerspective=!1;h.hasVertexTangents=!1;h.hasOccludees=!1;h.hasMultipassTerrain=!1;h.hasModelTransformation=!1;h.offsetBackfaces=!1;h.vvSize=!1;h.vvColor=!1;h.receiveShadows=!1;h.receiveAmbientOcclusion=!1;h.textureAlphaPremultiplied=!1;h.instanced=!1;h.instancedColor=!1;h.objectAndLayerIdColorInstanced=
!1;h.instancedDoublePrecision=!1;h.doublePrecisionRequiresObfuscation=!1;h.writeDepth=!0;h.transparent=!1;h.enableOffset=!0;h.cullAboveGround=!1;h.snowCover=!1;h.hasColorTextureTransform=!1;h.hasEmissionTextureTransform=!1;h.hasNormalTextureTransform=!1;h.hasOcclusionTextureTransform=!1;h.hasMetallicRoughnessTextureTransform=!1;return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(e.DefaultTechniqueConfiguration);c.__decorate([g.parameter({count:w.ShaderOutput.COUNT})],e.prototype,
"output",void 0);c.__decorate([g.parameter({count:f.AlphaDiscardMode.COUNT})],e.prototype,"alphaDiscardMode",void 0);c.__decorate([g.parameter({count:m.NormalsDoubleSidedMode.COUNT})],e.prototype,"doubleSidedMode",void 0);c.__decorate([g.parameter({count:l.PBRMode.COUNT})],e.prototype,"pbrMode",void 0);c.__decorate([g.parameter({count:f.CullFaceOptions.COUNT})],e.prototype,"cullFace",void 0);c.__decorate([g.parameter({count:d.TransparencyPassType.COUNT})],e.prototype,"transparencyPassType",void 0);
c.__decorate([g.parameter({count:n.NormalAttributeType.COUNT})],e.prototype,"normalType",void 0);c.__decorate([g.parameter({count:x.TextureCoordinateAttributeType.COUNT})],e.prototype,"textureCoordinateType",void 0);c.__decorate([g.parameter({count:f.DepthTestFunction.COUNT})],e.prototype,"customDepthTest",void 0);c.__decorate([g.parameter()],e.prototype,"spherical",void 0);c.__decorate([g.parameter()],e.prototype,"hasVertexColors",void 0);c.__decorate([g.parameter()],e.prototype,"hasSymbolColors",
void 0);c.__decorate([g.parameter()],e.prototype,"hasVerticalOffset",void 0);c.__decorate([g.parameter()],e.prototype,"hasSlicePlane",void 0);c.__decorate([g.parameter()],e.prototype,"hasSliceHighlight",void 0);c.__decorate([g.parameter()],e.prototype,"hasColorTexture",void 0);c.__decorate([g.parameter()],e.prototype,"hasMetallicRoughnessTexture",void 0);c.__decorate([g.parameter()],e.prototype,"hasEmissionTexture",void 0);c.__decorate([g.parameter()],e.prototype,"hasOcclusionTexture",void 0);c.__decorate([g.parameter()],
e.prototype,"hasNormalTexture",void 0);c.__decorate([g.parameter()],e.prototype,"hasScreenSizePerspective",void 0);c.__decorate([g.parameter()],e.prototype,"hasVertexTangents",void 0);c.__decorate([g.parameter()],e.prototype,"hasOccludees",void 0);c.__decorate([g.parameter()],e.prototype,"hasMultipassTerrain",void 0);c.__decorate([g.parameter()],e.prototype,"hasModelTransformation",void 0);c.__decorate([g.parameter()],e.prototype,"offsetBackfaces",void 0);c.__decorate([g.parameter()],e.prototype,
"vvSize",void 0);c.__decorate([g.parameter()],e.prototype,"vvColor",void 0);c.__decorate([g.parameter()],e.prototype,"receiveShadows",void 0);c.__decorate([g.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([g.parameter()],e.prototype,"textureAlphaPremultiplied",void 0);c.__decorate([g.parameter()],e.prototype,"instanced",void 0);c.__decorate([g.parameter()],e.prototype,"instancedColor",void 0);c.__decorate([g.parameter()],e.prototype,"objectAndLayerIdColorInstanced",void 0);
c.__decorate([g.parameter()],e.prototype,"instancedDoublePrecision",void 0);c.__decorate([g.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([g.parameter()],e.prototype,"writeDepth",void 0);c.__decorate([g.parameter()],e.prototype,"transparent",void 0);c.__decorate([g.parameter()],e.prototype,"enableOffset",void 0);c.__decorate([g.parameter()],e.prototype,"cullAboveGround",void 0);c.__decorate([g.parameter()],e.prototype,"snowCover",void 0);c.__decorate([g.parameter()],
e.prototype,"hasColorTextureTransform",void 0);c.__decorate([g.parameter()],e.prototype,"hasEmissionTextureTransform",void 0);c.__decorate([g.parameter()],e.prototype,"hasNormalTextureTransform",void 0);c.__decorate([g.parameter()],e.prototype,"hasOcclusionTextureTransform",void 0);c.__decorate([g.parameter()],e.prototype,"hasMetallicRoughnessTextureTransform",void 0);c.__decorate([g.parameter({constValue:!0})],e.prototype,"hasVvInstancing",void 0);c.__decorate([g.parameter({constValue:!1})],e.prototype,
"useCustomDTRExponentForWater",void 0);c.__decorate([g.parameter({constValue:!1})],e.prototype,"supportsTextureAtlas",void 0);c.__decorate([g.parameter({constValue:!0})],e.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,b,c,w,n,x,m,l){m=function(g){function f(){return d.apply(this,arguments)}c._inherits(f,g);var d=c._createSuper(f);g=f.prototype;g.initializeConfiguration=function(e,k){c._get(c._getPrototypeOf(f.prototype),"initializeConfiguration",this).call(this,e,k);k.hasMetallicRoughnessTexture=!1;k.hasEmissionTexture=!1;k.hasOcclusionTexture=!1;k.hasNormalTexture=!1;k.hasModelTransformation=!1;k.normalType=w.NormalAttributeType.Attribute;k.doubleSidedMode=n.NormalsDoubleSidedMode.WindingOrder;k.hasVertexTangents=
!1};g.initializeProgram=function(e){return this._initializeProgram(e,f.shader)};return c._createClass(f)}(m.DefaultMaterialTechnique);m.shader=new x.ReloadableShaderModule(l.RealisticTree,()=>new Promise((g,f)=>a(["./RealisticTree.glsl"],g,f)));b.RealisticTreeTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O){function J(G){const P=new I.ShaderBuilder,{vertex:U,fragment:N,varyings:S}=P;C.addProjViewLocalOrigin(U,G);P.include(g.PositionAttribute);S.add("vpos","vec3");P.include(z.VisualVariables,G);P.include(m.InstancedDoublePrecision,G);P.include(k.VerticalOffset,G);if(G.output===w.ShaderOutput.Color||G.output===w.ShaderOutput.Alpha)C.addCameraPosition(P.vertex,G),P.include(l.NormalAttribute,G),P.include(x.Transform,G),G.offsetBackfaces&&
P.include(c.Offset),G.instancedColor&&P.attributes.add(O.VertexAttribute.INSTANCECOLOR,"vec4"),S.add("vNormalWorld","vec3"),S.add("localvpos","vec3"),G.hasMultipassTerrain&&S.add("depth","float"),P.include(d.TextureCoordinateAttribute,G),P.include(b.ForwardLinearDepth,G),P.include(f.SymbolColor,G),P.include(e.VertexColor,G),U.uniforms.add(new F.Float4PassUniform("externalColor",Q=>Q.externalColor)),S.add("vcolorExt","vec4"),U.code.add(K.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${G.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${K.glsl.float(v.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${G.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${G.hasMultipassTerrain?K.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);G.output===w.ShaderOutput.Alpha&&(P.include(n.SliceDraw,G),P.include(A.DiscardOrAdjustAlphaPass,G),P.include(q.multipassTerrainTest,G),N.uniforms.add([new H.FloatPassUniform("opacity",Q=>Q.opacity),new H.FloatPassUniform("layerOpacity",Q=>Q.layerOpacity)]),G.hasColorTexture&&N.uniforms.add(new L.Texture2DPassUniform("tex",Q=>Q.texture)),N.include(t.MixExternalColor),N.code.add(K.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.hasMultipassTerrain?K.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${G.hasColorTexture?K.glsl`
                vec4 texColor = texture(tex, ${G.hasColorTextureTransform?K.glsl`colorUV`:K.glsl`vuv0`});
                ${G.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:K.glsl`vec4 texColor = vec4(1.0);`}
        ${G.hasVertexColors?K.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:K.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `));G.output===w.ShaderOutput.Color&&(P.include(n.SliceDraw,G),P.include(h.EvaluateSceneLighting,G),P.include(p.EvaluateAmbientOcclusion,G),P.include(A.DiscardOrAdjustAlphaPass,G),P.include(G.instancedDoublePrecision?D.ReadShadowMapPass:D.ReadShadowMapDraw,G),P.include(q.multipassTerrainTest,G),C.addCameraPosition(P.fragment,G),r.addMainLightDirection(N),h.addAmbientBoostFactor(N),h.addLightingGlobalFactor(N),N.uniforms.add([U.uniforms.get("localOrigin"),U.uniforms.get("view"),new E.Float3PassUniform("ambient",
Q=>Q.ambient),new E.Float3PassUniform("diffuse",Q=>Q.diffuse),new H.FloatPassUniform("opacity",Q=>Q.opacity),new H.FloatPassUniform("layerOpacity",Q=>Q.layerOpacity)]),G.hasColorTexture&&N.uniforms.add(new L.Texture2DPassUniform("tex",Q=>Q.texture)),P.include(B.PhysicallyBasedRenderingParameters,G),P.include(y.PhysicallyBasedRendering,G),N.include(t.MixExternalColor),r.addMainLightIntensity(N),N.code.add(K.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.hasMultipassTerrain?K.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${G.hasColorTexture?K.glsl`
                vec4 texColor = texture(tex, ${G.hasColorTextureTransform?K.glsl`colorUV`:K.glsl`vuv0`});
                ${G.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:K.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${G.pbrMode===B.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${G.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":G.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${G.hasVertexColors?K.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:K.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${G.snowCover?K.glsl`albedo = mix(albedo, vec3(1), 0.9);`:K.glsl``}
        ${K.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${G.pbrMode===B.PBRMode.Normal||G.pbrMode===B.PBRMode.Schematic?G.spherical?K.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:K.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:K.glsl``}
        ${G.pbrMode===B.PBRMode.Normal||G.pbrMode===B.PBRMode.Schematic?K.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${G.snowCover?K.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:K.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${G.transparencyPassType===R.TransparencyPassType.Color?K.glsl`fragColor = premultiplyAlpha(fragColor);`:K.glsl``}
      }
    `));P.include(u.DefaultMaterialAuxiliaryPasses,G);return P}const M=Object.freeze(Object.defineProperty({__proto__:null,build:J},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=M;a.build=J})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S){function Q(aa){return l.isNone(aa)?!1:"cross"===aa||"x"===aa}const W=e.create(),V=u.fromValues(0,0,1);n=O.DEFAULT_TEX_SIZE;const T=O.DEFAULT_SYMBOL_SIZE_RATIO,X=[T/2,T/2,1-T/2,1-T/2];n=[n*T,n*T];F=function(aa){function ia(ba,ea,ja,ka){ba=na.call(this,ba,ea,ja,ka);ba._cimLayers=null;ba._cimSymbolMaterials=new Map;ba._cimSymbolTextures=new Map;ba._cimMaterialParametersInfo=null;ba._cimRequiredFields=null;ba._cimScaleFactorOrFunction=
null;ba._size=null;ba._symbolTextureRatio=1;ba._outlineSize=0;ba._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return ba}c._inherits(ia,aa);var na=c._createSuper(ia);aa=ia.prototype;aa.getCachedSize=function(){return{size:this._getIconSize()}};aa.doLoad=async function(ba){this._validateOrThrow();const ea=this._prepareMaterialParameters();var ja=this._getPrimitive();if(l.isSome(ja))this._prepareResourcesPrimitive(ea,ja);else{ja=B.getIconHref(this.symbolLayer);const ka=d.dataComponents(ja);
ka&&"application/json"===ka.mediaType?await this._prepareResourcesCIM(ea,JSON.parse(ka.data),ba):await this._prepareResourcesHref(ea,ja,ba)}};aa._validateOrThrow=function(){if(!this._drivenProperties.size){var ba=H.validateSymbolLayerSize(this._getIconSize());if(ba)throw new m("graphics3diconsymbollayer:invalid-size",ba);}};aa._getIconSize=function(){var ba=this.symbolLayer;ba=Math.round(null!=ba.size?f.pt2px(ba.size):16);return this._drivenProperties.size?Math.max(ba,64):ba};aa._generateTextureCIM=
function(ba){const ea=this._getGraphicHash(ba);let ja=""===ea?null:this._cimSymbolTextures.get(ea);ja||(ba=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,ba,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},void 0,void 0),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",ba.anchorPosition),ja=new U.Texture(ba.imageData,{width:ba.imageData.width,height:ba.imageData.height,powerOfTwoResizeMode:M.PowerOfTwoResizeMode.PAD}),
this._cimSymbolTextures.set(ea,ja),this._context.stage.add(ja));return ja};aa._computeSize=function(ba,ea){ba=ba.width/ba.height;return 1<ba?[ea,Math.round(ea/ba)]:[Math.round(ea*ba),ea]};aa._prepareMaterialParameters=function(){const ba={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ea=this.symbol;if(ea&&"point-3d"===ea.type&&ea.hasVisibleVerticalOffset()){const {screenLength:ja,minWorldLength:ka,maxWorldLength:da}=ea.verticalOffset;ba.verticalOffset=
{screenLength:f.pt2px(ja),minWorldLength:ka||0,maxWorldLength:l.isSome(da)?da:Infinity}}this._context.screenSizePerspectiveEnabled&&(ba.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);ba.occlusionTest=!0;ba.hasSlicePlane=this._context.slicePlaneEnabled;return ba};aa._prepareResourcesPrimitive=function(ba,ea){var ja=this._getOutlineSize();if(Q(ea)&&0===ja)throw Error("Nothing to render");this._outlineSize=ja;ba.color=this._getFillColor();ba.outlineColor=this._getOutlineColor();
ba.outlineSize=this._outlineSize;l.isSome(this._context.sharedResources.textures)&&(ja=this._context.sharedResources.textures.fromData(`${ea}-icon`,()=>O.createTexture(ea)),this._texture=ja.texture,this._releaseTexture=ja,ba.textureId=this._texture.id);ba.textureIsSignedDistanceField=!0;ba.distanceFieldBoundingBox=X;ja=this._getIconSize();this._size=[ja,ja];this._symbolTextureRatio=1/T;this._createMaterialAndAddToStage(ba,this._context.stage)};aa._prepareResourcesHref=async function(ba,ea,ja){this._outlineSize=
this._getOutlineSize();ba.color=this._getFillColor();ba.outlineColor=this._getOutlineColor();ba.outlineSize=this._outlineSize;ba.textureIsSignedDistanceField=!1;const ka=this._getIconSize(),da=ka*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(l.isSome(this._context.sharedResources.textures)){ja=await x.result(this._context.sharedResources.textures.fromUrl(ea,da,{signal:ja}));if(!1===ja.ok)throw g.throwIfAbortError(ja.error),new m("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ea})`);
this._releaseTexture=ja.value;ea=ja.value.texture;this._size=this._computeSize(ea.params,ka);ba.textureId=ea.id}this._createMaterialAndAddToStage(ba,this._context.stage)};aa._prepareResourcesCIM=async function(ba,ea,ja){ea=new S({data:ea});if(!this._context.sharedResources.cimSymbolRasterizer){var ka=(await new Promise((fa,ma)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],fa,ma))).CIMSymbolRasterizer;g.throwIfAborted(ja);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=
new ka(this._context.renderCoordsHelper.spatialReference,!0))}ka=this._context.layer.fields?this._context.layer.fields.map(fa=>fa.toJSON()):null;this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(ea,ka,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ja});let da;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(ea=this._context.renderer,
isNaN(ea.scaleExpression)){const fa=await q.createRendererExpression(ea.scaleExpression,this._context.layer.spatialReference,ka);da=(ma,qa,wa)=>{ma=D(fa,ma,{$view:wa},"esriGeometryPoint",qa);return null!==ma?ma:1}}else var ha=Number(ea.scaleExpression);this._cimScaleFactorOrFunction=ha||da||1;ha=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];g.throwIfAborted(ja);const ca=this._context.layer.fieldsIndex;this._cimRequiredFields=ha.map(fa=>ca.get(fa).name);
this._cimMaterialParametersInfo=ba;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1};aa._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||y.defaultPrimitive};aa._getOutlineSize=function(){var ba=0;ba=this.symbolLayer;
if(l.isSome(ba.outline)&&null!=ba.outline.size)return Math.max(f.pt2px(ba.outline.size),0);ba=this._getPrimitive();ba=Q(ba)?1.5:0;return Math.max(ba,0)};aa._getOutlineColor=function(){const ba=this._getLayerOpacity(),ea=l.get(this.symbolLayer,"outline","color");if(l.isSome(ea)){const ja=w.toUnitRGB(ea);return[ja[0],ja[1],ja[2],ea.a*ba]}return[0,0,0,0]};aa._getFillColor=function(){if(Q(this._getPrimitive()))return z.TRANSPARENT_UNIT;const ba=l.isNone(this._getPrimitive()),ea=l.get(this.symbolLayer,
"material","color");return this._getCombinedOpacityAndColor(ea,{hasIntrinsicColor:ba})};aa._getAnchorPos=function(ba,ea){return"relative"===ba?k.fromValues((ea.x||0)+.5,-(ea.y||0)+.5):ba in I.namedAnchorToHUDMaterialAnchorPos?I.namedAnchorToHUDMaterialAnchorPos[ba]:I.namedAnchorToHUDMaterialAnchorPos.center};aa._createMaterialAndAddToStage=function(ba,ea){(this._fastUpdates=this._cimLayers?null:R.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()))&&Object.assign(ba,
this._fastUpdates.materialParameters);if(this._cimLayers){let ja=l.isSome(ba.textureId)?this._cimSymbolMaterials.get(ba.textureId):null;ja||(ja=new N.HUDMaterial(ba),this._cimSymbolMaterials.set(l.unwrapOr(ba.textureId,0),ja),ea.add(ja));return ja}this._material=new N.HUDMaterial(ba);ea.add(this._material);return this._material};aa._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(ba=>{ba.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,
hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};aa.destroy=function(){c._get(c._getPrototypeOf(ia.prototype),"destroy",this).call(this);this._forEachMaterial(ba=>this._context.stage.remove(ba));this._material=null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(ba=>this._context.stage.remove(ba));this._cimSymbolTextures.clear();this._releaseTexture=l.releaseMaybe(this._releaseTexture)};aa._getScaleFactor=function(ba,ea){if(this._drivenProperties.size&&
ba.size){for(let ja=0;3>ja;ja++){const ka=ba.size[ja];ka&&"symbol-value"!==ka&&"proportional"!==ka&&(ba.size[ja]=f.pt2px(ka))}if("symbol-value"===ba.size[0])return 1;if(isFinite(+ba.size[0]))return+ba.size[0]/ea;if(isFinite(+ba.size[2]))return+ba.size[2]/ea}return 1};aa.createGraphics3DGraphic=function(ba){const ea=ba.graphic;if(!this._validateGeometry(ea.geometry))return null;var ja=[0,0];let ka;if(this._cimLayers){if(!this._cimLayers.length)return null;var da=this._generateTextureCIM(ea);ka=this._createMaterialAndAddToStage({textureId:da.id,
...this._cimMaterialParametersInfo},this._context.stage);ja=[da.params.width,da.params.height]}else ja=this._size,ka=l.unwrap(this._material);da=L.placePointOnGeometry(ea.geometry);if(l.isNone(da))return this.logger.warn(`unsupported geometry type for icon symbol: ${ea.geometry.type}`),null;var ha=ba.renderingInfo;const ca=this._getVertexOpacityAndColor(ha);let fa=1;this._fastUpdates?.visualVariables.size||(fa=this._getScaleFactor(ha,ja[0]>ja[1]?ja[0]:ja[1]));fa*=this._symbolTextureRatio;ja=k.fromValues(ja[0]*
fa,ja[1]*fa);ha=this.setGraphicElevationContext(ea,new t.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ha.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ea,da,ka,ca,ja,ba.layer.uid):this._createAs3DShape(ea,da,ka,ca,ja,ha,ea.uid)};aa.layerOpacityChanged=function(){const ba=this._getFillColor(),ea=this._getOutlineColor();this._forEachMaterial(ja=>{ja.setParameters({color:ba});ja.setParameters({outlineColor:ea})})};aa.layerElevationInfoChanged=
function(ba,ea,ja){const ka=this._elevationContext.mode;ja=A.elevationModeChangeUpdateType(ia.elevationModeChangeTypes,ja,ka);if(ja!==A.SymbolUpdateType.UPDATE)return ja;const da=A.needsElevationUpdates2D(ka)||"absolute-height"===ka;return this.updateGraphics3DGraphicElevationInfo(ba,ea,()=>da)};aa.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(ba=>{ba.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};aa.physicalBasedRenderingChanged=function(){return!0};
aa.applyRendererDiff=function(ba,ea){for(const ja in ba.diff)switch(ja){case "visualVariables":if(R.updateFastSymbolUpdatesState(this._fastUpdates,ea,this._fastVisualVariableConvertOptions()))l.isSome(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters);else return K.ApplyRendererDiffResult.Recreate_Symbol;break;default:return K.ApplyRendererDiffResult.Recreate_Symbol}return K.ApplyRendererDiffResult.Fast_Update};aa._defaultElevationInfoNoZ=function(){return Z};aa._createAs3DShape=
function(ba,ea,ja,ka,da,ha,ca){const fa=this.getFastUpdateAttrValues(ba);ba=fa&&this._fastUpdates?wa=>R.evaluateModelTransform(this._fastUpdates.materialParameters,fa,wa):void 0;const ma=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ca,layerUid:this._context.layer.uid});ka=G.createPointGeometry(ja,V,null,ka,da,Y,null,fa,ma);ca=L.createStageObject(this._context,ea,ka,ha,ca,ba);if(l.isNone(ca))return null;const qa=new E.Graphics3DObject3DGraphicLayer(this,ca.object,[ka],null,null,
v.perObjectElevationAligner,ha);qa.alignedSampledElevation=ca.sampledElevation;qa.needsElevationUpdates=A.needsElevationUpdates2D(ha.mode)||"absolute-height"===ha.mode;qa.getScreenSize=this._createScreenSizeGetter(da,ba);qa.calculateRelativeScreenBounds=wa=>ja.calculateRelativeScreenBounds(qa.getScreenSize(),1,wa);L.extendPointGraphicElevationContext(qa,ea,this._context.elevationProvider);return qa};aa._createAsOverlay=function(ba,ea,ja,ka,da,ha){ja.renderPriority=this._renderPriority;const ca=p.create();
h.projectPointToVector(ea,ca,this._context.overlaySR);ca[2]=J.DRAPED_Z;ea=this._context.clippingExtent;if(l.isSome(ea)&&!r.containsPoint(ea,ca))return null;const fa=this.getFastUpdateAttrValues(ba);ea=fa&&this._fastUpdates?wa=>R.evaluateModelTransform(this._fastUpdates.materialParameters,fa,wa):void 0;const ma=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ba.uid,layerUid:this._context.layer.uid});ka=G.createPointGeometry(ja,V,ca,ka,da,null,null,fa,ma);ba=new P.RenderGeometry(ka,
{layerUid:ha,graphicUid:ba.uid,shaderTransformer:ea});const qa=new C(this,[ba],null,this._context.drapeSourceRenderer);qa.getScreenSize=this._createScreenSizeGetter(da,ea);qa.calculateRelativeScreenBounds=wa=>ja.calculateRelativeScreenBounds(qa.getScreenSize(),1,wa);return qa};aa._createScreenSizeGetter=function(ba,ea){const ja=this._outlineSize+2;if(this._fastUpdates&&ea){const ha=ba[0]/this._symbolTextureRatio,ca=ba[1]/this._symbolTextureRatio;return(fa=k.create())=>{const ma=ea(W);fa[0]=ma[0]*
ha+ja;fa[1]=ma[5]*ca+ja;return fa}}const ka=ba[0]/this._symbolTextureRatio+ja,da=ba[1]/this._symbolTextureRatio+ja;return(ha=k.create())=>{ha[0]=ka;ha[1]=da;return ha}};aa._fastVisualVariableConvertOptions=function(){var ba=Math.max(this._size[0],this._size[1]);const ea=u.fromValues(ba,ba,ba),ja=f.px2pt(1);ba*=ja;ba=u.fromValues(ba,ba,ba);return new R.ConvertOptions(ea,ba,ja)};aa._getGraphicHash=function(ba){let ea="";for(const ja of this._cimRequiredFields)ea+=ja+ba.attributes[ja];return ea};aa._forEachMaterial=
function(ba){l.isSome(this._material)&&ba(this._material);this._cimSymbolMaterials.forEach(ba)};aa.test=function(){return{...c._get(c._getPrototypeOf(ia.prototype),"test",this).call(this),material:this._material}};c._createClass(ia,[{key:"pixelRatioChanged",get:function(){return l.isSome(this._getPrimitive())}}]);return ia}(F.Graphics3DSymbolLayer);F.PRIMITIVE_SIZE=n;F.elevationModeChangeTypes={definedChanged:A.SymbolUpdateType.UPDATE,staysOnTheGround:A.SymbolUpdateType.NONE,onTheGroundChanged:A.SymbolUpdateType.RECREATE};
const Z={mode:"relative-to-ground",offset:0},Y=p.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=F;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../core/maybe","../../../geometry/support/quantizationUtils"],function(a,b,c,w){function n(m){const l={};switch(m){case "esriGeometryPoint":return(g,f,d,e)=>w.unquantizePoint(f,l,g,d,e);case "esriGeometryPolygon":return(g,
f,d,e)=>w.unquantizePolygon(f,l,g,d,e);case "esriGeometryPolyline":return(g,f,d,e)=>w.unquantizePolyline(f,l,g,d,e);case "esriGeometryMultipoint":return(g,f,d,e)=>w.unquantizeMultipoint(f,l,g,d,e);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${m}`)),g=>g}}const x=new Map;return function(m,l,g,f,d){if(c.isNone(m))return null;if(m.referencesGeometry()&&d){const {transform:e,hasZ:k,hasM:u}=d;x.has(f)||x.set(f,n(f));f=
x.get(f)(l.geometry,e,k,u);l={...l,geometry:f}}l=m.repurposeFeature(l);try{return m.evaluate({...g,$feature:l})}catch(e){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){b=b.ZEROS;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,c,w,n,x,m,l,g){let f=function(){function u(h,r,q,y){this.graphics3DSymbolLayer=h;this.renderGeometries=r;this.boundingBox=q;this._drapeSourceRenderer=y;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}var p=u.prototype;p.initialize=function(h){this.stage=h};p.setVisibility=function(h){if(null!=this.stage&&this._visible!==h)if((this._visible=h)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,
g.DirtyOperation.ADD);else if(h||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,g.DirtyState.VISIBILITY)}};p.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,g.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};p.getCenterObjectSpace=function(h=w.create()){return c.set(h,0,0,0)};p.getBoundingBoxObjectSpace=function(h=
n.create()){return n.empty(h)};p.addObjectState=function(h,r){h===l.Object3DState.Highlight&&(this.renderGeometries.forEach(q=>{const y=q.geometry.addHighlight();r.addRenderGeometry(q,y,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,g.DirtyState.HIGHLIGHT))};p.removeObjectState=function(h){this.renderGeometries.forEach(r=>{h.removeRenderGeometry(r)})};p.removeRenderGeometryObjectState=function(h,r){h.geometry.removeHighlight(r);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,
g.DirtyState.HIGHLIGHT)};p.computeAttachmentOrigin=function(h){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(k)&&(h.draped.origin[0]+=k[0],h.draped.origin[1]+=k[1],h.draped.num++)};p.getProjectedBoundingBox=async function(h,r,q,y,B){n.empty(B);for(let D=0;D<this.renderGeometries.length;D++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[D],h,d,q),n.expandWithRect(B,d);if(r){n.center(B,k);let D;h=m.demResolutionForBoundingBox(B,r.service.spatialReference,
r);try{D=await r.service.queryElevation(k[0],k[1],y,h,"ground")}catch(z){}b.isSome(D)&&(B[2]=Math.min(B[2],D),B[5]=Math.max(B[5],D))}return B};p._getRenderGeometryProjectedBoundingRect=function(h,r,q,y){if(this.boundingBox)n.set(e,this.boundingBox);else{h=h.boundingSphere;const B=h[3];e[0]=h[0]-B;e[1]=h[1]-B;e[2]=h[2]-B;e[3]=h[0]+B;e[4]=h[1]+B;e[5]=h[2]+B}r(e,0,2);this.calculateRelativeScreenBounds&&y.push({location:n.center(e),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return n.toRect(e,
q)};return a._createClass(u)}();const d=x.create(),e=n.create(),k=w.create();return f})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,c){const w=Object.freeze({left:0,center:.5,right:1});b=Object.freeze({"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,
1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)});a.anchorFromPlacements=function(n,x){switch(x){case "bottom":return"left"===n?"bottom-left":"right"===n?"bottom-right":"bottom";case "center":return n;case "top":return"left"===n?"top-left":"right"===n?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(n){switch(n){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};
a.horizontalPlacementToAnchorX=w;a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(n){switch(n){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(n){return"middle"===n?"center":n};a.verticalPlacementFromAnchor=function(n){switch(n){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";
case "top-left":case "top":case "top-right":return"top"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,b,c,w,n){function x(u,p,h){u.canvas||(u.canvas=document.createElement("canvas"));u.canvas.width=p;u.canvas.height=h;return u.canvas}let m=function(){function u(h,r,
q,y=2048){this.text=h;this._alignment=r;this._parameters=q;this._maxSize=y;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${h}`;this._lines=h.split(/\r?\n/)}var p=u.prototype;p._getLineXOffset=function(h){switch(this._alignment){case a.TextRenderAlignment.Left:return this._backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[h])/2;case a.TextRenderAlignment.Right:return this.displayWidth-
this._backgroundHorizontalPadding-this._lineWidths[h]}};p.render=function(h,r=0,q=0){h.save();r/=this.renderPixelRatio;q/=this.renderPixelRatio;const y=r,B=q;var D=this._haloSize,z=this._firstLineYOffset;r+=D;q+=z+this._baselinePosition;const v=0<this._haloSize;v&&this._renderHalo(h,y,B,D,z);this._setFontProperties(h,this._renderedFontSize);for(D=0;D<this._lines.length;++D){const A=this._lines[D],t=this._getLineXOffset(D);v&&(h.globalCompositeOperation="destination-out",h.fillStyle="rgb(0, 0, 0)",
this._fillText(h,A,r+t,q),this._renderLineDecoration(h,r+t,q,this._textWidths[D]));h.globalCompositeOperation="source-over";h.fillStyle=this._parameters.textStyle;this._fillText(h,A,r+this._getLineXOffset(D),q);this._renderLineDecoration(h,r+t,q,this._textWidths[D]);q+=this._lineSpacing}if(n.TEXT_SHOW_BASELINE)for(h.strokeStyle="rgb(255, 0, 255, 0.5)",h.setLineDash([2,2]),h.lineWidth=1,r=B+z,q=0;q<this._lines.length;++q)z=r+this._baselinePosition,this._drawLine(h,[y,z],[y+this.displayWidth,z]),r+=
this._lineSpacing;n.TEXT_SHOW_BORDER&&(h.strokeStyle="rgb(255, 0, 255, 0.5)",h.setLineDash([]),h.lineWidth=1,this._drawBox(h,[y,B],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(h,y,B,this._parameters.definition.background.borderRadius*this.renderPixelRatio),h.globalCompositeOperation="destination-over",h.fillStyle=this._parameters.backgroundStyle,h.fill());h.restore()};p._renderLineDecoration=function(h,r,q,y,B=!1){if("none"!==this._parameters.definition.font.decoration&&
0!==y){var D=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":q+=2*D;break;case "line-through":q-=.33*this._baselinePosition}var z=B?this._haloSize:0;h.strokeStyle=B?this._parameters.haloStyle:this._parameters.textStyle;h.lineWidth=this._toRenderUnit(D+2*z);h.beginPath();h.moveTo(this._toRenderUnit(r-z),this._toRenderUnit(q));h.lineTo(this._toRenderUnit(r+y+z),this._toRenderUnit(q));h.stroke()}};p._roundedRect=function(h,r,q,y){r=
this._toRenderUnit(r);q=this._toRenderUnit(q);const B=this.renderedWidth,D=this.renderedHeight;0===y?h.rect(r,q,B,D):(y=c.clamp(y,0,Math.floor(D/2)),h.beginPath(),h.moveTo(r,q+y),h.arcTo(r,q,r+y,q,y),h.lineTo(r+B-y,q),h.arcTo(r+B,q,r+B,q+y,y),h.lineTo(r+B,q+D-y),h.arcTo(r+B,q+D,r+B-y,q+D,y),h.lineTo(r+y,q+D),h.arcTo(r,q+D,r,q+D-y,y),h.closePath())};p._renderHalo=function(h,r,q,y,B){const D=this.renderedWidth,z=this.renderedHeight,v=x(g,Math.max(D,512),Math.max(z,512)),A=v.getContext("2d");A.clearRect(0,
0,D,z);this._setFontProperties(A,this._renderedFontSize);A.fillStyle=this._parameters.haloStyle;A.strokeStyle=this._parameters.haloStyle;var t=3>this._renderedHaloSize;A.lineJoin=t?"miter":"round";t?this._renderHaloEmulated(A,y,B):this._renderHaloNative(A,y,B);B+=this._baselinePosition;for(t=0;t<this._lines.length;++t){const C=this._getLineXOffset(t);this._renderLineDecoration(A,y+C,B,this._textWidths[t],!0);B+=this._lineSpacing}h.globalAlpha=this._parameters.definition.halo.color[3];h.drawImage(v,
0,0,D,z,this._toRenderUnit(r),this._toRenderUnit(q),D,z);h.globalAlpha=1};p._renderHaloEmulated=function(h,r,q){q+=this._baselinePosition;for(let y=0;y<this._lines.length;++y){const B=this._lines[y],D=this._getLineXOffset(y);for(const [z,v]of l)this._fillText(h,B,r+D+this._haloSize*z,q+this._haloSize*v);q+=this._lineSpacing}};p._renderHaloNative=function(h,r,q){const y=2*this._haloSize;q+=this._baselinePosition;for(let B=0;B<this._lines.length;++B){const D=this._lines[B],z=this._getLineXOffset(B);
for(let v=0;5>v;v++)h.lineWidth=this._toRenderUnit((.6+.1*v)*y),this._strokeText(h,D,r+z,q);q+=this._lineSpacing}};p._setFontProperties=function(h,r){h.font=this._parameters.fontString(r);h.textAlign="left";h.textBaseline="alphabetic"};p._toRenderUnit=function(h){return h*this.renderPixelRatio};p._toRoundedRenderUnit=function(h){return Math.round(h*this.renderPixelRatio)};p._fillText=function(h,r,q,y){h.fillText(r,this._toRenderUnit(q),this._toRenderUnit(y))};p._strokeText=function(h,r,q,y){h.strokeText(r,
this._toRenderUnit(q),this._toRenderUnit(y))};p._drawLine=function(h,r,q){h.beginPath();h.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5);h.lineTo(this._toRoundedRenderUnit(q[0])+.5,this._toRoundedRenderUnit(q[1])+.5);h.stroke()};p._drawBox=function(h,r,q){var y=this._toRenderUnit(r[0]);r=this._toRenderUnit(r[1]);var B=this._toRenderUnit(q[0]);const D=this._toRenderUnit(q[1]);q=Math.floor(y)+.5;y=Math.ceil(y+B)-.5;B=Math.floor(r)+.5;r=Math.ceil(r+D)-.5;h.beginPath();
h.moveTo(q,B);h.lineTo(y,B);h.lineTo(y,r);h.lineTo(q,r);h.lineTo(q,B);h.stroke()};b._createClass(u,[{key:"displayWidth",get:function(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this._lineSpacing*(this._lines.length-1)+this._lineHeight+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",
get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}},{key:"_firstLineYOffset",get:function(){return this._backgroundTopPadding+this._haloSize}},{key:"_metrics",get:function(){if(w.isNone(this._metricsCached)){const q=x(g,512,512).getContext("2d");this._setFontProperties(q,this._fontSize);let y=2*this._haloSize;var h=this._parameters.definition.font;if("italic"===
h.style||"oblique"===h.style||"bold"===h.weight||"bolder"===h.weight)y+=.3*q.measureText("A").width;this._textWidths.length=0;let B=this._lineWidths.length=0,D,z,v=0,A=0;this._lines.forEach((t,C)=>{t=q.measureText(t);const E=t.width,F=E+y;this._textWidths.push(E);this._lineWidths.push(F);B=Math.max(B,F);v=Math.max(v,t.actualBoundingBoxAscent);A=Math.max(A,t.actualBoundingBoxDescent);0===C&&(D=t);C===this._lines.length-1&&(z=t)});h=q.font;var r=k.get(h);r||(r=q.measureText(f),r=new e(r.actualBoundingBoxAscent,
r.actualBoundingBoxDescent),k.set(h,r));v=Math.max(v,r.actualBoundingBoxAscent);A=Math.max(A,r.actualBoundingBoxDescent);this._metricsCached=new d(v-(this._hasBackground?D.actualBoundingBoxAscent:v),A-(this._hasBackground?z.actualBoundingBoxDescent:A),v+A,B,v)}return this._metricsCached}},{key:"_lineSpacing",get:function(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_lineHeight",get:function(){return this._metrics.lineHeight}},{key:"_linePadding",
get:function(){return.2*this._lineHeight}},{key:"_baselinePosition",get:function(){return this._metrics.baselinePosition}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},{key:"_backgroundHorizontalPadding",get:function(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}},{key:"_backgroundVerticalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"_backgroundTopPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}},{key:"_backgroundBottomPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}},{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},
{key:"renderPixelRatio",get:function(){if(w.isNone(this._renderPixelRatio)){const h=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this._maxSize?Math.min(h,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):h}return this._renderPixelRatio}},{key:"_displayWidth",get:function(){return this._metrics.displayWidth}}]);return u}();const l=[];for(let u=0;360>u;u+=22.5)l.push([Math.cos(Math.PI*u/180),Math.sin(Math.PI*u/180)]);a.TextRenderAlignment=void 0;(function(u){u[u.Left=
0]="Left";u[u.Center=1]="Center";u[u.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const g={canvas:null},f=(()=>{let u="";for(let p=32;127>p;p++)u+=String.fromCharCode(p);return u})();let d=b._createClass(function(u,p,h,r,q){this.paddingTop=u;this.paddingBottom=p;this.lineHeight=h;this.displayWidth=r;this.baselinePosition=q}),e=b._createClass(function(u,p){this.actualBoundingBoxAscent=u;this.actualBoundingBoxDescent=p});const k=new Map;a.TextRenderer=m;a.getTextHelperCanvas=
x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(a,b,c,w,n,x,m,l,g){let f=function(){function e(u,p={}){this.geometry=u;this.screenToWorldRatio=1;this._transformation=x.create();
this._shaderTransformation=null;this._shaderTransformationDirty=!0;this._boundingSphere=l.create();this._boundingSphereDirty=!0;this.id=w.generateUID();this.layerUid=p.layerUid;this.graphicUid=p.graphicUid;this.shaderTransformer=p.shaderTransformer;this.castShadow=p.castShadow??!1}var k=e.prototype;k.updateTransformation=function(u){u(this._transformation);this._shaderTransformationDirty=this._boundingSphereDirty=!0};k.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};b._createClass(e,
[{key:"transformation",get:function(){return this._transformation}},{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"boundingSphere",get:function(){if(!this._boundingSphereDirty||c.isNone(this.boundingInfo))return this._boundingSphere;m.transformMat4(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation);this._boundingSphere[3]=this.boundingInfo.radius*g.maxScale(this.shaderTransformation);this._boundingSphereDirty=!1;return this._boundingSphere}},{key:"hasShaderTransformation",
get:function(){return c.isSome(this.shaderTransformer)}},{key:"material",get:function(){return this.geometry.material}},{key:"type",get:function(){return this.geometry.type}},{key:"shaderTransformation",get:function(){if(c.isNone(this.shaderTransformer))return this.transformation;if(this._shaderTransformationDirty||!this._shaderTransformation)this._shaderTransformation=n.copy(this._shaderTransformation||x.create(),this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1;return this._shaderTransformation}},
{key:"indices",get:function(){return this.geometry.indices}},{key:"vertexAttributes",get:function(){return this.geometry.vertexAttributes}},{key:"highlights",get:function(){return this.geometry.highlights}},{key:"occludees",get:function(){return this.geometry.occludees}},{key:"visible",get:function(){return this.geometry.visible},set:function(u){this.geometry.visible=u}}]);return e}(),d=function(e){function k(){return u.apply(this,arguments)}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(f);
a.RenderGeometry=f;a.ValidatedRenderGeometry=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/engineContent/marker ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H){const K=["polyline","polygon","extent"];c=function(L){function R(J,M,G,P){J=O.call(this,J,M,G,P);J._vvConvertOptions=new q.ConvertOptions;return J}b._inherits(R,L);var O=b._createSuper(R);L=R.prototype;L.doLoad=async function(){this._vvConvertOptions.supportsOpacity=!0;this._vvConvertOptions.supportsRotation=!1;this._fastUpdates=q.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions);if(!this._drivenProperties.size&&
0>(null!=this.symbolLayer.size?this.symbolLayer.size:x.px2pt(1)))throw new w("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=n.isSome(this.symbolLayer.marker)&&n.isSome(this._context.sharedResources.textures)?D.prepareMarkerResources(this._context.sharedResources.textures,r.parseLineMarkerStyle(this.symbolLayer.marker.style)):null};L._getMaterialParameters=function(J,M=!1){const G=this._getCombinedOpacityAndColor(M&&this._markerColor||this._materialColor);
this._patternHidesLine&&!M&&(G[3]=0);J={width:this._computeMaterialWidth(this.symbolLayer?.size),color:G,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:r.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:J,stipplePattern:C.getStipplePatternForLinePattern(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates?.visualVariables?{...J,...this._fastUpdates.materialParameters}:J};L.destroy=function(){b._get(b._getPrototypeOf(R.prototype),
"destroy",this).call(this);this._forEachMaterial(J=>this._context.stage.remove(J));this._markerMaterialCached=this._wireframeRingMaterialCached=this._wireframeLineMaterialCached=this._ringMaterialCached=this._lineMaterialCached=null;this._markerTexture=n.releaseMaybe(this._markerTexture)};L._getDrivenSize=function(J){return this._drivenProperties.size&&J.size?x.pt2px(g.getDriverAxisSizeValueAny(J.size)):1};L._getSizeFeatureAttributeData=function(J){return this._fastUpdates&&this._fastUpdates.visualVariables.size?
p.getAttributeValue(this._fastUpdates.visualVariables.size.field,J):null};L._getDrivenColor=function(J){const M=m.fromValues(1,1,1,1);this._drivenProperties.color&&J.color&&(M[0]=J.color[0],M[1]=J.color[1],M[2]=J.color[2],0<J.color.length&&(M[3]=J.color[3]));this._drivenProperties.opacity&&J.opacity&&(M[3]=J.opacity);return M};L._getColorFeatureAttributeData=function(J){return this._fastUpdates?.visualVariables.color?p.getAttributeValue(this._fastUpdates.visualVariables.color.field,J):null};L._getOpacityFeatureAttributeData=
function(J){return this._fastUpdates?.visualVariables.opacity?p.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,J):null};L.createGraphics3DGraphic=function(J){const M=J.graphic;if(!this._validateGeometry(M.geometry,K,this.symbolLayer.type))return null;const G=this.setGraphicElevationContext(M,new e.ElevationContext);this.ensureDrapedStatus("on-the-ground"===G.mode);return this.draped?this._createAsOverlay(J,this._context.layer.uid):this._createAs3DShape(J,G,M.uid)};L.applyRendererDiff=
function(J,M){for(const G in J.diff)switch(G){case "visualVariables":const P=this._fastUpdates;if(q.updateFastSymbolUpdatesState(P,M,this._vvConvertOptions))this._forEachMaterial(U=>U.setParameters(P.materialParameters));else return h.ApplyRendererDiffResult.Recreate_Symbol;break;default:return h.ApplyRendererDiffResult.Recreate_Symbol}return h.ApplyRendererDiffResult.Fast_Update};L.prepareSymbolLayerPatch=function(J){if("partial"===J.diff.type){var M=J.diff.diff,G={};"complete"===M.size?.type&&(G.width=
this._computeMaterialWidth(M.size.newValue),delete M.size);"complete"===M.cap?.type&&(G.cap=r.parseCapType(n.unwrapOr(M.cap.newValue,"butt")),delete M.cap);var P=this._prepareMarkerPatch(J,M);this._prepareMaterialPatch(J,M,P);J.symbolLayerStatePatches.push(()=>this._forEachMaterial(U=>U.setParameters(G)))}};L.layerOpacityChanged=function(){this._forEachMaterial((J,M)=>this._updateMaterialLayerOpacity(J,M))};L._forEachMaterial=function(J){n.isSome(this._lineMaterialCached)&&J(this._lineMaterialCached);
n.isSome(this._ringMaterialCached)&&J(this._ringMaterialCached);n.isSome(this._wireframeLineMaterialCached)&&J(this._wireframeLineMaterialCached);n.isSome(this._wireframeRingMaterialCached)&&J(this._wireframeRingMaterialCached);n.isSome(this._markerMaterialCached)&&J(this._markerMaterialCached,!0)};L._updateMaterialLayerOpacity=function(J,M=!1){var G=J.parameters.color;const P=n.get(this.symbolLayer,"material","color");M=this._patternHidesLine&&!M?0:this._getCombinedOpacity(P);G=m.fromValues(G[0],
G[1],G[2],M);J.setParameters({color:G})};L.layerElevationInfoChanged=function(J,M,G){const P=this._elevationContext.mode;G=d.elevationModeChangeUpdateType(R.elevationModeChangeTypes,G,P);if(G!==d.SymbolUpdateType.UPDATE)return G;const U=d.needsElevationUpdates2D(P);return this.updateGraphics3DGraphicElevationInfo(J,M,()=>U)};L.slicePlaneEnabledChanged=function(){const J={hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(M=>M.setParameters(J));return!0};L.physicalBasedRenderingChanged=
function(){return!0};L._getGeometryAsPolygonOrPolyline=function(J){switch(J.type){case "extent":if(J instanceof F)return H.fromExtent(J);break;case "polygon":case "polyline":return J}return null};L._createAs3DShape=function(J,M,G){const P=this._getGeometryAsPolygonOrPolyline(J.graphic.geometry);var U="polygon"===P.type?P.rings:P.paths,N=[];const S=l.create(),Q=z.geometryToRenderInfo(P,this._context.elevationProvider,this._context.renderCoordsHelper,M);this._logGeometryCreationWarnings(Q,U,"polygon"===
P.type?"rings":"paths","LineSymbol3DLayer");for(U=0;U<Q.lines.length;U++){var W=Q.lines[U],V=W.position;W=W.mapPositions;if(n.isSome(this._context.clippingExtent)&&(l.empty(S),l.expandWithBuffer(S,W),!l.intersectsClippingArea(S,this._context.clippingExtent)))continue;V=this._createGeometry("polygon"===P.type?this._ringMaterial:this._lineMaterial,J,V,W,P.type,I.ELEVATED,G);N.push(V);y.LINE_WIREFRAMES&&N.push(V.instantiate({material:"polygon"===P.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));
n.isSome(this._markerMaterial)&&N.push(V.instantiate({material:this._markerMaterial}))}if(0===N.length)return null;J=new v.Object3D({geometries:N,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:G}});N=new u.Graphics3DObject3DGraphicLayer(this,J,N,null,null,f.sharedGeometryElevationAligner,M);N.alignedSampledElevation=Q.sampledElevation;N.needsElevationUpdates=d.needsElevationUpdates2D(M.mode);return N};L._createGeometry=function(J,M,G,P,U,N,S){U="polygon"===U;const Q=this._fastUpdates?.visualVariables.color,
W=this._fastUpdates?.visualVariables.size;S=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:S,layerUid:this._context.layer.uid});return B.createGeometry(J,{overlayInfo:N===I.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:U,mapPositions:P,attributeData:{position:G,size:W?null:this._getDrivenSize(M.renderingInfo),color:Q?null:this._getDrivenColor(M.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(M.graphic),
colorFeature:this._getColorFeatureAttributeData(M.graphic),opacityFeature:this._getOpacityFeatureAttributeData(M.graphic)}},S)};L._createAsOverlay=function(J,M){const G=J.graphic,P=this._getGeometryAsPolygonOrPolyline(G.geometry);var U="polygon"===P.type?P.rings:P.paths;const N="polygon"===P.type?this._ringMaterial:this._lineMaterial;N.renderPriority=this._renderPriority;const S=y.LINE_WIREFRAMES?"polygon"===P.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,Q=this._markerMaterial;
n.isSome(S)&&(S.renderPriority=this._renderPriority-.001);n.isSome(Q)&&(Q.renderPriority=this._renderPriority-.002);const W=[],V=l.create(),T=l.empty();var X=z.geometryToRenderInfoDraped(P,this._context.overlaySR);this._logGeometryCreationWarnings(X,U,"polygon"===P.type?"rings":"paths","LineSymbol3DLayer");for(const Z of X.lines)l.empty(V),l.expandWithBuffer(V,Z.position),l.intersectsClippingArea(V,this._context.clippingExtent)&&(l.expandWithAABB(T,V),U=Y=>{Y=this._createGeometry(Y,J,Z.position,void 0,
P.type,I.DRAPED,G.uid);Y=new A.RenderGeometry(Y,{layerUid:M,graphicUid:G.uid});W.push(Y)},n.isSome(Q)&&(U(Q),X=n.unwrap(this.symbolLayer.marker).placement,"begin"!==X&&"begin-end"!==X||l.expandWithBuffer(V,Z.position,0,1),"end"!==X&&"begin-end"!==X||l.expandWithBuffer(V,Z.position,Z.position.length-3,1)),U(N),y.LINE_WIREFRAMES&&U(S));return new k(this,W,T,this._context.drapeSourceRenderer)};L._computeMaterialWidth=function(J){J=n.unwrapOr(J,x.px2pt(1));return this._drivenProperties.size?this._fastUpdates?.visualVariables.size?
x.pt2px(1):1:x.pt2px(J)};L._prepareMaterialPatch=function(J,M,G){var P=M.material;n.isNone(P)?G.changed&&G.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,J):"collection"!==P.type&&(P="complete"===P.type?n.applySome(P.newValue,U=>U.color):"complete"===P.diff.color?.type?P.diff.color.newValue:null,P=this._getCombinedOpacityAndColor(P),G.useMaterialColor&&this._patchMaterialColor(m.clone(P),this._markerMaterialCached,J),this._patternHidesLine&&
(P[3]=0),this._patchMaterialColor(P,this._lineMaterialCached,J),delete M.material)};L._prepareMarkerPatch=function(J,M){var G=M.marker;if(n.isNone(G)||"partial"!==G.type||n.isSome(G.diff.style)||n.isSome(G.diff.placement)||n.isSome(G.diff.color)&&"complete"!==G.diff.color.type)return{changed:!1,useMaterialColor:n.isNone(this._markerColor)};G=G.diff.color;if(n.isNone(G))return delete M.marker,{changed:!1,useMaterialColor:n.isNone(this._markerColor)};G=n.unwrap(G.newValue);if(n.isNone(G))return delete M.marker,
{changed:!0,useMaterialColor:!0};this._patchMaterialColor(this._getCombinedOpacityAndColor(G),this._markerMaterialCached,J);delete M.marker;return{changed:!0,useMaterialColor:!1}};L._patchMaterialColor=function(J,M,G){n.isNone(M)||G.symbolLayerStatePatches.push(()=>M.setParameters({color:J}))};b._createClass(R,[{key:"_materialColor",get:function(){return n.applySome(this.symbolLayer.material,J=>J.color)}},{key:"_markerColor",get:function(){return n.applySome(this.symbolLayer.marker,J=>J.color)}},
{key:"_lineMaterial",get:function(){n.isNone(this._lineMaterialCached)&&(this._lineMaterialCached=new E.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached));return this._lineMaterialCached}},{key:"_ringMaterial",get:function(){n.isNone(this._ringMaterialCached)&&(this._ringMaterialCached=new E.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached));return this._ringMaterialCached}},{key:"_wireframeLineMaterial",
get:function(){n.isNone(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new E.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached));return this._wireframeLineMaterialCached}},{key:"_wireframeRingMaterial",get:function(){n.isNone(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new E.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached));
return this._wireframeRingMaterialCached}},{key:"_markerMaterial",get:function(){n.isNone(this._markerMaterialCached)&&n.isSome(this.symbolLayer.marker)&&n.isSome(this._markerTexture)&&(this._markerMaterialCached=new t.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached));return this._markerMaterialCached}},{key:"_patternHidesLine",get:function(){const J=
this.symbolLayer.pattern;return n.isSome(J)&&"style"===J.type&&"none"===J.style}}]);return R}(p.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:d.SymbolUpdateType.RECREATE,staysOnTheGround:d.SymbolUpdateType.NONE,onTheGroundChanged:d.SymbolUpdateType.RECREATE};var I;(function(L){L[L.DRAPED=0]="DRAPED";L[L.ELEVATED=1]="ELEVATED"})(I||(I={}));a.Graphics3DLineSymbolLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports",
"../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,b,c){a.parseCapType=function(w){switch(w){case "butt":return c.CapType.BUTT;case "square":return c.CapType.SQUARE;case "round":return c.CapType.ROUND;default:return null}};a.parseLineMarkerStyle=function(w){return"diamond"===w?"kite":w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){const r=n.create(),q=n.create();a.createGeometry=function(y,B,D=null){const z=[],v=[],A=B.mapPositions,{attributeData:{position:t},removeDuplicateStartEnd:C}=B;var E=t.length;E=t[0]===t[E-3]&&t[1]===t[E-2]&&t[2]===t[E-1]&&C;var F=t.length/3-(E?1:0),H=Array(2*(F-1)),K=E?t.slice(0,t.length-3):t,I=0;for(var L=0;L<F-1;L++)H[I++]=L,H[I++]=L+1;v.push([h.VertexAttribute.POSITION,new k.Attribute(K,3,E)]);z.push([h.VertexAttribute.POSITION,H]);F=v[0][1].data;E=d.getZeroIndexArray(z[0][1].length);
b.isSome(B.attributeData.colorFeature)||(v.push([h.VertexAttribute.COLOR,new k.Attribute(b.unwrapOr(B.attributeData.color,x.ONES),4)]),z.push([h.VertexAttribute.COLOR,E]));b.isSome(B.attributeData.sizeFeature)||(v.push([h.VertexAttribute.SIZE,new k.Attribute([b.unwrapOr(B.attributeData.size,1)],1,!0)]),z.push([h.VertexAttribute.SIZE,E]));b.isSome(B.attributeData.normal)&&(v.push([h.VertexAttribute.NORMAL,new k.Attribute(B.attributeData.normal,3)]),z.push([h.VertexAttribute.NORMAL,E]));H=B.attributeData.colorFeature;
b.isNone(H)||(v.push([h.VertexAttribute.COLORFEATUREATTRIBUTE,new k.Attribute([H],1,!0)]),z.push([h.VertexAttribute.COLOR,E]));H=B.attributeData.sizeFeature;b.isNone(H)||(v.push([h.VertexAttribute.SIZEFEATUREATTRIBUTE,new k.Attribute([H],1,!0)]),z.push([h.VertexAttribute.SIZEFEATUREATTRIBUTE,E]));H=B.attributeData.opacityFeature;b.isNone(H)||(v.push([h.VertexAttribute.OPACITYFEATUREATTRIBUTE,new k.Attribute([H],1,!0)]),z.push([h.VertexAttribute.OPACITYFEATUREATTRIBUTE,E]));if(!b.isNone(B.overlayInfo)&&
B.overlayInfo.renderCoordsHelper.viewingMode===e.ViewingMode.Global&&B.overlayInfo.spatialReference.isGeographic){E=g.newDoubleArray(F.length);B=m.getReferenceEllipsoid(B.overlayInfo.spatialReference);for(H=0;H<E.length;H+=3)l.lonLatToWebMercatorComparable(F,H,E,H,B);B=F.length/3;F=f.newFloatArray(B+1);H=r;K=q;L=I=0;w.set(H,E[L++],E[L++],E[L++]);F[0]=0;for(let R=1;R<B+1;++R)R===B&&(L=0),w.set(K,E[L++],E[L++],E[L++]),I+=c.dist(H,K),F[R]=I,[H,K]=[K,H];v.push([h.VertexAttribute.DISTANCETOSTART,new k.Attribute(F,
1,!0)]);z.push([h.VertexAttribute.DISTANCETOSTART,z[0][1]])}return new p.Geometry(y,v,z,A,u.ContentObjectType.Line,D)};a.lineStripsToParameters=function(y,B){if(b.isNone(y)||0===y.length)return[];const D=[];y.forEach(z=>{const v=g.newDoubleArray(3*z.length);z.forEach((A,t)=>{v[3*t]=A[0];v[3*t+1]=A[1];v[3*t+2]=A[2]});D.push({attributeData:{position:v,normal:B},removeDuplicateStartEnd:!1})});return D};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),
function(a,b,c,w,n,x,m){function l(g,f,d=null){const e=[];for(const {index:k,count:u}of g){if(1>=u)continue;g=3*k;const p=3*u;e.push({position:w.doubleSubArray(f,3*k,3*u),mapPositions:b.isSome(d)?w.doubleSubArray(d,g,p):void 0})}return e}a.geometryToRenderInfo=function(g,f,d,e){const {position:k,outlines:u}=n.pathsToTriangulationInfo("polygon"===g.type?g.rings:g.paths,!!g.hasZ,"polygon"===g.type?n.CounterClockwiseMode.CCW_IS_HOLE:n.CounterClockwiseMode.NONE),p=w.newDoubleArray(k.length);g=x.applyPerVertexElevationAlignment(k,
g.spatialReference,0,p,0,k,0,k.length/3,f,d,e);f=null!=g;return{lines:f?l(u,k,p):[],projectionSuccess:f,sampledElevation:g}};a.geometryToRenderInfoDraped=function(g,f){const {position:d,outlines:e}=n.pathsToTriangulationInfo("polygon"===g.type?g.rings:g.paths,!1,"polygon"===g.type?n.CounterClockwiseMode.CCW_IS_HOLE:n.CounterClockwiseMode.NONE);g=c.projectBuffer(d,g.spatialReference,0,d,f,0,d.length/3);for(f=2;f<d.length;f+=3)d[f]=m.DRAPED_Z;return{lines:g?l(e,d):[],projectionSuccess:g}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){let h=function(z){function v(t){t=A.call(this,t,new q);t._vertexAttributeLocations=k.vertexAttributeLocations;t._configuration=new u.LineMarkerTechniqueConfiguration;t._layout=t.createLayout();return t}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.dispose=function(){};z.getConfiguration=function(t,C){this._configuration.output=t;this._configuration.space=C.slot===f.RenderSlot.DRAPED_MATERIAL?u.LineMarkerSpace.Draped:this.parameters.worldSpace?u.LineMarkerSpace.World:
u.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==p.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;
this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.occluder=this.parameters.renderOccluded===g.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=C.transparencyPassType;this._configuration.hasMultipassTerrain=C.multipassTerrain.enabled;this._configuration.cullAboveGround=C.multipassTerrain.cullAboveGround;return this._configuration};z.intersect=function(){};z.createLayout=function(){const t=
x.newLayout().vec3f(d.VertexAttribute.POSITION).vec2f(d.VertexAttribute.UV0).vec3f(d.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&t.vec3f(d.VertexAttribute.NORMAL);this.parameters.vvSize?t.f32(d.VertexAttribute.SIZEFEATUREATTRIBUTE):t.f32(d.VertexAttribute.SIZE);this.parameters.vvColor?t.f32(d.VertexAttribute.COLORFEATUREATTRIBUTE):t.vec4f(d.VertexAttribute.COLOR);this.parameters.vvOpacity&&t.f32(d.VertexAttribute.OPACITYFEATUREATTRIBUTE);return t};z.createBufferWriter=function(){return new y(this._layout,
this.parameters)};z.requiresSlot=function(t,C){return C===m.ShaderOutput.Color||C===m.ShaderOutput.Alpha||C===m.ShaderOutput.Highlight||C===m.ShaderOutput.Depth?t===f.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===g.RenderOccludedFlag.OccludeAndTransparentStencil?t===f.RenderSlot.OPAQUE_MATERIAL||t===f.RenderSlot.OCCLUDER_MATERIAL||t===f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:C===m.ShaderOutput.Color||C===m.ShaderOutput.Alpha?t===(this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:
f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===f.RenderSlot.OPAQUE_MATERIAL:!1};z.createGLMaterial=function(t){return new r(t)};return b._createClass(v)}(g.Material),r=function(z){function v(){return A.apply(this,arguments)}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z._updateParameters=function(t){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(k.LineMarkerTechnique,t)};z._updateOccludeeState=
function(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})};z.beginSlot=function(t){this._output!==m.ShaderOutput.Color&&this._output!==m.ShaderOutput.Alpha||this._updateOccludeeState(t);return this._updateParameters(t)};return b._createClass(v)}(l.GLTextureMaterial),q=function(z){function v(){var t=A.apply(this,arguments);t.width=0;t.color=[1,1,1,1];t.placement="end";t.cap=p.CapType.BUTT;t.anchor=u.LineMarkerAnchor.Center;t.hasTip=
!1;t.worldSpace=!1;t.hideOnShortSegments=!1;t.writeDepth=!0;t.hasSlicePlane=!1;t.vvFastUpdate=!1;t.hasOccludees=!1;return t}b._inherits(v,z);var A=b._createSuper(v);return b._createClass(v)}(e.VisualVariablePassParameters),y=function(){function z(A,t){this.vertexBufferLayout=A;this._parameters=t}var v=z.prototype;v.allocate=function(A){return this.vertexBufferLayout.createBuffer(A)};v.elementCount=function(){return"begin-end"===this._parameters.placement?12:6};v.write=function(A,t,C,E,F){const H=
C.vertexAttributes.get(d.VertexAttribute.POSITION).data,K=H.length/3;let I=[1,0,0];t=C.vertexAttributes.get(d.VertexAttribute.NORMAL);this._parameters.worldSpace&&c.isSome(t)&&(I=t.data);let L=1,R=0;this._parameters.vvSize?R=C.vertexAttributes.get(d.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:C.vertexAttributes.has(d.VertexAttribute.SIZE)&&(L=C.vertexAttributes.get(d.VertexAttribute.SIZE).data[0]);let O=[1,1,1,1],J=0;this._parameters.vvColor?J=C.vertexAttributes.get(d.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:
C.vertexAttributes.has(d.VertexAttribute.COLOR)&&(O=C.vertexAttributes.get(d.VertexAttribute.COLOR).data);let M=0;this._parameters.vvOpacity&&(M=C.vertexAttributes.get(d.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const G=new Float32Array(E.buffer);let P=this.vertexBufferLayout.stride/4*F;const U=(S,Q,W,V)=>{G[P++]=S[0];G[P++]=S[1];G[P++]=S[2];G[P++]=W[0];G[P++]=W[1];G[P++]=Q[0];G[P++]=Q[1];G[P++]=Q[2];this._parameters.worldSpace&&(G[P++]=I[0],G[P++]=I[1],G[P++]=I[2]);this._parameters.vvSize?
G[P++]=R:G[P++]=L;this._parameters.vvColor?G[P++]=J:(S=Math.min(4*V,O.length-4),G[P++]=O[S],G[P++]=O[S+1],G[P++]=O[S+2],G[P++]=O[S+3]);this._parameters.vvOpacity&&(G[P++]=M)};let N;(function(S){S[S.ASCENDING=1]="ASCENDING";S[S.DESCENDING=-1]="DESCENDING"})(N||(N={}));C=(S,Q)=>{const W=w.set(B,H[3*S],H[3*S+1],H[3*S+2]),V=D;let T=S+Q;do w.set(V,H[3*T],H[3*T+1],H[3*T+2]),T+=Q;while(w.equals(W,V)&&0<=T&&T<K);A&&(w.transformMat4(W,W,A),w.transformMat4(V,V,A));U(W,V,[-1,-1],S);U(W,V,[1,-1],S);U(W,V,[1,
1],S);U(W,V,[-1,-1],S);U(W,V,[1,1],S);U(W,V,[-1,1],S)};E=this._parameters.placement;"begin"!==E&&"begin-end"!==E||C(0,N.ASCENDING);"end"!==E&&"begin-end"!==E||C(K-1,N.DESCENDING)};return b._createClass(z)}();const B=n.create(),D=n.create();a.LineMarkerMaterial=h;a.Parameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){const p=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.NORMAL,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);x=function(h){function r(){return q.apply(this,arguments)}c._inherits(r,h);var q=c._createSuper(r);h=r.prototype;h.initializeProgram=function(y){return new l.Program(y.rctx,
r.shader.get().build(this.configuration),p)};h._makePipelineState=function(y,B){const D=this.configuration,z=y===d.TransparencyPassType.NONE;return u.makePipelineState({blending:D.output===w.ShaderOutput.Color||D.output===w.ShaderOutput.Alpha?z?m.blendingDefault:m.oitBlending(y):null,depthTest:{func:m.oitDepthTest(y)},depthWrite:z?D.writeDepth?u.defaultDepthWriteParams:null:m.oitDepthWrite(y),colorWrite:u.defaultColorWriteParams,stencilWrite:D.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:D.hasOccludees?
B?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};h.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=u.makePipelineState({blending:m.blendingDefault,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=u.makePipelineState({blending:m.blendingDefault,depthTest:f.depthCompareAlways,
depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=u.makePipelineState({blending:null,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};h.getPipelineState=function(y,B){return B?this._occludeePipelineState:this.configuration.occluder?y===g.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:y===g.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:c._get(c._getPrototypeOf(r.prototype),"getPipelineState",this).call(this,y,B)};return c._createClass(r)}(x.ShaderTechnique);x.shader=new n.ReloadableShaderModule(k.LineMarker,()=>new Promise((h,r)=>a(["./LineMarker.glsl"],
h,r)));b.LineMarkerTechnique=x;b.vertexAttributeLocations=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(C){const E=new y.ShaderBuilder,F=C.hasMultipassTerrain&&(C.output===w.ShaderOutput.Color||C.output===w.ShaderOutput.Alpha),H=C.space===v.LineMarkerSpace.World;E.include(x.RibbonVertexPosition,C);E.include(l.MarkerSizing,C);C.output===w.ShaderOutput.Depth&&E.include(m.OutputDepth,C);const {vertex:K,fragment:I}=E;I.include(e.RgbaFloatEncoding);k.addProjViewLocalOrigin(K,C);E.attributes.add(z.VertexAttribute.POSITION,"vec3");E.attributes.add(z.VertexAttribute.UV0,
"vec2");E.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");E.varyings.add("vColor","vec4");E.varyings.add("vpos","vec3");E.varyings.add("vUV","vec2");E.varyings.add("vSize","float");c.addLinearDepth(E);F&&E.varyings.add("depth","float");C.hasTip&&E.varyings.add("vLineWidth","float");K.uniforms.add([new u.Float2PassUniform("nearFar",(L,R)=>R.camera.nearFar),new p.Float4PassUniform("viewport",(L,R)=>R.camera.fullViewport)]);K.code.add(r.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);K.code.add(r.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);H?(E.attributes.add(z.VertexAttribute.NORMAL,"vec3"),k.addViewNormal(K),K.constants.add("tiltThreshold","float",.7),K.code.add(r.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):K.code.add(r.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);K.code.add(r.glsl`
      #define vecN ${H?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${H?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${C.anchor===v.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);C.space===v.LineMarkerSpace.Screen&&(K.uniforms.add(new q.Matrix4PassUniform("inverseProjectionMatrix",(L,R)=>R.camera.inverseProjectionMatrix)),K.code.add(r.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),K.code.add(r.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),K.uniforms.add(new h.FloatPassUniform("perScreenPixelRatio",(L,R)=>R.camera.perScreenPixelRatio)),K.code.add(r.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${C.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));K.uniforms.add(new h.FloatPassUniform("pixelRatio",(L,R)=>R.camera.pixelRatio));c.addCalculateLinearDepth(E);K.code.add(r.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`);H?(C.hideOnShortSegments&&K.code.add(r.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),K.code.add(r.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(K.code.add(r.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),C.space===v.LineMarkerSpace.Screen&&K.code.add(r.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));K.code.add(r.glsl`
        ${F?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${H?"":"vUV *\x3d displacedPosScreen.w;"}

        ${C.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);F&&E.include(g.multipassTerrainTest,C);E.include(n.SliceDraw,C);I.uniforms.add([new p.Float4PassUniform("intrinsicColor",L=>L.color),new B.Texture2DPassUniform("tex",L=>L.texture)]);I.include(d.ColorConversion);E.constants.add("texelSize","float",1/b.MARKER_TEXTURE_SIZE);I.code.add(r.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);C.hasTip&&(E.constants.add("relativeMarkerSize","float",b.MARKER_SYMBOL_SIZE/b.MARKER_TEXTURE_SIZE),E.constants.add("relativeTipLineWidth","float",b.MARKER_TIP_THICKNESS_FACTOR),I.code.add(r.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${H?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));E.constants.add("symbolAlphaCutoff","float",f.symbolAlphaCutoff);I.code.add(r.glsl`
  void main() {
    discardBySlice(vpos);
    ${F?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${H?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${C.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${C.output===w.ShaderOutput.ObjectAndLayerIdColor?r.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${C.output===w.ShaderOutput.Alpha?r.glsl`fragColor = vec4(finalColor.a);`:""}
    ${C.output===w.ShaderOutput.Color?r.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${C.output===w.ShaderOutput.Color&&C.transparencyPassType===D.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${C.output===w.ShaderOutput.Highlight?r.glsl`fragColor = vec4(1.0);`:""}
    ${C.output===w.ShaderOutput.Depth?r.glsl`outputDepth(linearDepth);`:""}
  }
  `);return E}const t=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.LineMarker=t;a.build=A})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,b){function c(m,l=2){return b.isNone(m)?m:{pattern:m.slice(),pixelRatio:l}}function w(m){return b.isSome(m)?c(x[m],8):null}const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},x={dash:n.dash,"dash-dot":[...n.dash,
...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null};a.createStipplePattern=c;a.createStipplePatternSimple=function(m,l=2){return{pattern:[m,m],pixelRatio:l}};a.getStipplePatternForLinePattern=
function(m){return b.isSome(m)&&"style"===m.type?w(m.style):null};a.getStipplePatternForPatternStyle=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q){const W=["mesh"];w=function(ka){function da(ca,fa,ma,qa){ca=ha.call(this,ca,fa,ma,qa);ca._materials=new Map;ca._textures=new Map;ca.ensureDrapedStatus(!1);return ca}b._inherits(da,ka);var ha=b._createSuper(da);ka=da.prototype;ka.doLoad=async function(){L.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new S.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new S.NativeLineMaterial({color:[0,
1,1,1]}))};ka.destroy=function(){b._get(b._getPrototypeOf(da.prototype),"destroy",this).call(this);this._context.stage.removeMany(Array.from(this._materials.values(),ca=>ca.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};ka.createGraphics3DGraphic=function(ca){const fa=ca.graphic;if(!this._validateGeometry(fa.geometry,W,"fill on mesh-3d"))return null;const ma=this.setGraphicElevationContext(fa,new E.ElevationContext);return this._createAs3DShape(fa,
ca.renderingInfo,ma,fa.uid)};ka.layerOpacityChanged=function(ca,fa){const ma=this._getLayerOpacity();this._materials.forEach(qa=>{qa.material.setParameters({layerOpacity:ma});const wa=qa.material.parameters;this._setMaterialTransparentParameter(wa,qa);qa.material.setParameters({transparent:wa.transparent})});ca.forEach(qa=>{qa=fa(qa);n.isSome(qa)&&qa.layerOpacityChanged(ma,this._context.isAsync)})};ka.layerElevationInfoChanged=function(ca,fa){return this.updateGraphics3DGraphicElevationInfo(ca,fa,
C.needsElevationUpdates3D)};ka.slicePlaneEnabledChanged=function(ca,fa){this._materials.forEach(ma=>{ma.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});ca.forEach(ma=>{ma=fa(ma);n.isSome(ma)&&ma.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ka.physicalBasedRenderingChanged=function(){const ca=this._usePBR();this._materials.forEach(fa=>fa.material.setParameters({usePBR:ca}));return!0};ka._requiresSymbolVertexColors=function(){return this._drivenProperties.color||
this._drivenProperties.opacity};ka._colorOrTextureUid=function(ca){return n.isNone(ca)?"-":ca instanceof c?ca.toHex():ca.contentHash};ka._materialPropertiesDefault=function(ca,fa){const ma=this._requiresSymbolVertexColors(),qa=!!ca.vertexAttributes.color;ca=!!ca.vertexAttributes.tangent;return{hasSymbolVertexColors:ma,hasVertexColors:qa,hasVertexTangents:ca,uid:`vc:${qa},vt:${ca},vct${fa},svc:${ma}`}};ka._materialProperties=function(ca,fa,ma){ca=this._materialPropertiesDefault(ca,ma);if(!fa.material)return ca;
const {color:qa,colorTexture:wa,normalTexture:xa,doubleSided:pa,alphaCutoff:ra,alphaMode:va}=fa.material;ma=this._colorOrTextureUid(qa);var Ba=this._colorOrTextureUid(wa),Aa=this._colorOrTextureUid(xa);ca.color=qa;ca.colorTexture=wa;ca.normalTexture=xa;ca.uid=`${ca.uid},cmuid:${ma},ctmuid:${Ba},ntmuid:${Aa},ds:${pa},ac:${ra},am:${va}`;if(fa.material instanceof q){const {metallic:Ha,roughness:Ka,metallicRoughnessTexture:Pa,emissiveColor:Ra,emissiveTexture:Sa,occlusionTexture:La}=fa.material;ma=this._colorOrTextureUid(Pa);
Ba=this._colorOrTextureUid(Ra);Aa=this._colorOrTextureUid(Sa);const Ua=this._colorOrTextureUid(La);ca.metallic=Ha;ca.roughness=Ka;ca.metallicRoughnessTexture=Pa;ca.emissiveColor=Ra;ca.emissiveTexture=Sa;ca.occlusionTexture=La;ca.colorTextureTransform=fa.material.colorTextureTransform;ca.normalTextureTransform=fa.material.normalTextureTransform;ca.emissiveTextureTransform=fa.material.emissiveTextureTransform;ca.occlusionTextureTransform=fa.material.occlusionTextureTransform;ca.metallicRoughnessTextureTransform=
fa.material.metallicRoughnessTextureTransform;ca.uid=`${ca.uid},mrm:${Ha},mrr:${Ka},mrt:${ma},emuid:${Ba},etmuid:${Aa},otmuid:${Ua}`}return ca};ka._setInternalColorValueParameters=function(ca,fa){fa.diffuse=c.toUnitRGB(ca);fa.opacity=ca.a};ka._getLoadableTextureResource=function(ca){return ca.data?ca.data:ca.url};ka._getInternalTextureId=function(ca){ca=this._getInternalTexture(ca,O.AlphaDiscardMode.Opaque);return n.isSome(ca)?ca.id:null};ka._getInternalTexture=function(ca,fa){const ma=this._getLoadableTextureResource(ca);
if(!ma)return null;const qa=`${ca.contentHash}/${fa}`;let wa=this._textures.get(qa);wa||(wa=new P.Texture(v.isEncodedMeshTexture(ma)?ma.data:ma,{mipmap:!0,wrap:this._castTextureWrap(ca.wrap),noUnpackFlip:!0,preMultiplyAlpha:v.isEncodedMeshTexture(ma)?!1:fa!==O.AlphaDiscardMode.Opaque,encoding:v.isEncodedMeshTexture(ma)&&n.isSome(ma.encoding)?ma.encoding:void 0}),this._textures.set(qa,wa),this._context.stage.add(wa),this._context.stage.loadImmediate(wa));return wa};ka._castTextureWrap=function(ca=
"repeat"){return"string"===typeof ca?(ca=this._castTextureWrapIndividual(ca),{s:ca,t:ca}):{s:this._castTextureWrapIndividual(ca.horizontal),t:this._castTextureWrapIndividual(ca.vertical)}};ka._castTextureWrapIndividual=function(ca){switch(ca){case "clamp":return Q.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return Q.TextureWrapMode.MIRRORED_REPEAT;default:return Q.TextureWrapMode.REPEAT}};ka._setInternalMaterialParameters=function(ca,fa){n.isSome(ca.color)&&this._setInternalColorValueParameters(ca.color,
fa);if(n.isSome(ca.colorTexture)){const ma=this._getInternalTexture(ca.colorTexture,fa.textureAlphaMode);n.isSome(ma)?(fa.textureId=ma.id,fa.textureAlphaPremultiplied=!!ma.params.preMultiplyAlpha):fa.textureId=void 0}n.isSome(ca.normalTexture)&&(fa.normalTextureId=this._getInternalTextureId(ca.normalTexture));n.isSome(ca.emissiveColor)&&(fa.emissiveFactor=c.toUnitRGB(ca.emissiveColor));n.isSome(ca.emissiveTexture)&&(fa.emissiveTextureId=this._getInternalTextureId(ca.emissiveTexture));n.isSome(ca.occlusionTexture)&&
(fa.occlusionTextureId=this._getInternalTextureId(ca.occlusionTexture));n.isSome(ca.metallicRoughnessTexture)&&(fa.metallicRoughnessTextureId=this._getInternalTextureId(ca.metallicRoughnessTexture));fa.colorTextureTransformMatrix=A.getTransformMatrix(ca.colorTextureTransform);fa.normalTextureTransformMatrix=A.getTransformMatrix(ca.normalTextureTransform);fa.occlusionTextureTransformMatrix=A.getTransformMatrix(ca.occlusionTextureTransform);fa.emissiveTextureTransformMatrix=A.getTransformMatrix(ca.emissiveTextureTransform);
fa.metallicRoughnessTextureTransformMatrix=A.getTransformMatrix(ca.metallicRoughnessTextureTransform)};ka._setExternalMaterialParameters=function(ca){var fa=this._drivenProperties.color;let ma=n.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;fa?ca.externalColor=e.ONES:(fa=n.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,n.isSome(fa)?ca.externalColor=c.toUnitRGBA(fa):(ma=null,ca.externalColor=e.ONES));ma&&(ca.colorMixMode=ma);ca.castShadows=!!this.symbolLayer.castShadows};
ka._hasTransparentVertexColors=function(ca){ca=ca.vertexAttributes.color;if(n.isNone(ca))return!1;for(let fa=3;fa<ca.length;fa+=4)if(255!==ca[fa])return!0;return!1};ka._getOrCreateMaterial=function(ca,fa){var ma=fa.material?.color,qa=fa.material?.colorTexture,wa=fa.material?.alphaMode;const xa="blend"===wa;ma="opaque"!==wa&&(this._hasTransparentVertexColors(ca)||n.isSome(ma)&&1>ma.a||n.isSome(qa)&&qa.transparent||xa);ca=this._materialProperties(ca,fa,ma);if(qa=this._materials.get(ca.uid))return qa.material;
ma={material:null,isComponentTransparent:ma,alphaMode:fa.material?fa.material.alphaMode:"opaque"};qa=null==ca.metallicRoughnessTexture&&null==ca.metallic&&null==ca.roughness;wa={usePBR:this._usePBR(),isSchematic:qa,hasVertexColors:ca.hasVertexColors,hasSymbolColors:ca.hasSymbolVertexColors,hasVertexTangents:ca.hasVertexTangents,ambient:d.ZEROS,diffuse:d.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:O.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,
initTextureTransparent:!0};qa||(wa.mrrFactors=[null!=ca.metallic?ca.metallic:1,null!=ca.roughness?ca.roughness:1,.5]);fa.material&&(wa.doubleSided=fa.material.doubleSided,wa.cullFace=fa.material.doubleSided?O.CullFaceOptions.None:O.CullFaceOptions.Back,wa.textureAlphaCutoff=fa.material.alphaCutoff);this._setExternalMaterialParameters(wa);this._setMaterialTransparentParameter(wa,ma);this._setInternalMaterialParameters(ca,wa);fa=new N.DefaultMaterial(wa);ma.material=fa;this._materials.set(ca.uid,ma);
this._context.stage.add(fa);return fa};ka._usePBR=function(){return this._context.physicalBasedRenderingEnabled};ka._setMaterialTransparentParameter=function(ca,fa){ca.transparent=this.needsDrivenTransparentPass||fa.isComponentTransparent||1>ca.layerOpacity||1>ca.opacity||ca.externalColor&&1>ca.externalColor[3];ca.textureAlphaMode="auto"===fa.alphaMode?ca.transparent?O.AlphaDiscardMode.MaskBlend:O.AlphaDiscardMode.Opaque:"opaque"===fa.alphaMode?O.AlphaDiscardMode.Opaque:"mask"===fa.alphaMode?O.AlphaDiscardMode.Mask:
O.AlphaDiscardMode.Blend};ka._addDebugNormals=function(ca,fa){var ma=fa.length,qa=ca.spatialReference.isGeographic?20015077/180:1;const wa=.1*Math.max(ca.extent.width*qa,ca.extent.height*qa,ca.extent.zmax-ca.extent.zmin);var xa=[];const pa=[];ca=[];qa=[];for(let Ka=0;Ka<ma;Ka++){var ra=fa[Ka],va=ra.vertexAttributes.get(U.VertexAttribute.POSITION),Ba=ra.vertexAttributes.get(U.VertexAttribute.NORMAL);const Pa=ra.indices.get(U.VertexAttribute.POSITION);ra=ra.indices.get(U.VertexAttribute.NORMAL);va=
va.data;Ba=Ba.data;for(let Ra=0;Ra<Pa.length;Ra++){var Aa=3*Pa[Ra];const Sa=3*ra[Ra];for(var Ha=0;3>Ha;Ha++)xa.push(va[Aa+Ha]);for(Ha=0;3>Ha;Ha++)xa.push(va[Aa+Ha]+Ba[Sa+Ha]*wa);pa.push(pa.length);pa.push(pa.length);if(0===Ra%3){this._calculateFaceNormal(va,Pa,Ra,aa);this._getFaceVertices(va,Pa,Ra,X,Z,Y);f.add(X,X,Z);f.add(X,X,Y);f.scale(X,X,1/3);for(Aa=0;3>Aa;Aa++)ca.push(X[Aa]);for(Aa=0;3>Aa;Aa++)ca.push(X[Aa]+aa[Aa]*wa);qa.push(qa.length);qa.push(qa.length)}}}ma=fa[0].transformation;xa=new M.Geometry(this._debugVertexNormalMaterial,
[[U.VertexAttribute.POSITION,new R.Attribute(xa,3,!0)]],[[U.VertexAttribute.POSITION,pa]],null,J.ContentObjectType.Line);fa.push(xa);xa.transformation=ma;ca=new M.Geometry(this._debugFaceNormalMaterial,[[U.VertexAttribute.POSITION,new R.Attribute(ca,3,!0)]],[[U.VertexAttribute.POSITION,qa]],null,J.ContentObjectType.Line);ca.transformation=ma;fa.push(ca)};ka._createAs3DShape=function(ca,fa,ma,qa){ca=ca.geometry;if("mesh"!==ca.type)return null;fa=this._createGeometryInfo(ca,fa,qa);if(n.isNone(fa))return null;
const {geometries:wa,objectTransformation:xa}=fa;L.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ca,wa);qa=new G.Object3D({geometries:wa,metadata:{layerUid:this._context.layer.uid,graphicUid:qa}});qa.transformation=xa;fa=K.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});fa=n.isSome(fa)?new F.Object3DEdgeState(wa[0].material,[fa],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;fa=new F.Graphics3DObject3DGraphicLayer(this,qa,wa,null,null,t.perObjectElevationAligner,
ma,fa);fa.needsElevationUpdates=C.needsElevationUpdates3D(ma.mode);fa.useObjectOriginAsAttachmentOrigin=!0;ma.centerPointInElevationSR=this._getCenterPointInElevationSR(qa);const {elevationProvider:pa,renderCoordsHelper:ra}=this._context;fa.alignedSampledElevation=t.perObjectElevationAligner(fa,ma,pa.spatialReference,(va,Ba)=>C.evaluateElevationInfoAtPoint(va,pa,ma,ra,Ba),ra);return fa};ka._getCenterPointInElevationSR=function(ca){const fa=D.makeDehydratedPoint(0,0,0,n.isSome(this._context.elevationProvider.spatialReference)?
this._context.elevationProvider.spatialReference:null);k.projectVectorToDehydratedPoint([ca.transformation[12],ca.transformation[13],ca.transformation[14]],this._context.renderCoordsHelper.spatialReference,fa);return fa};ka._createComponentNormals=function(ca,fa,ma,qa){switch(ma.shading||"flat"){default:case "source":return this._createComponentNormalsSource(ca,fa,ma,qa);case "flat":return this._createComponentNormalsFlat(ca,qa);case "smooth":return this._createComponentNormalsSmooth(ca,qa)}};ka._createComponentNormalsSource=
function(ca,fa,ma,qa){if(n.isNone(fa))return this._createComponentNormalsFlat(ca,qa);let wa=!1;if(!ma.trustSourceNormals)for(ma=0;ma<qa.length;ma+=3){this._calculateFaceNormal(ca,qa,ma,aa);for(let xa=0;3>xa;xa++){const pa=3*qa[ma+xa];X[0]=fa[pa];X[1]=fa[pa+1];X[2]=fa[pa+2];0>f.dot(aa,X)&&(fa[pa]=-fa[pa],fa[pa+1]=-fa[pa+1],fa[pa+2]=-fa[pa+2],wa=!0)}}return new V(fa,qa,wa)};ka._createComponentNormalsFlat=function(ca,fa){const ma=p.newFloatArray(fa.length),qa=Array(3*fa.length);for(let wa=0;wa<fa.length;wa+=
3){const xa=this._calculateFaceNormal(ca,fa,wa,aa);for(let pa=0;3>pa;pa++)ma[wa+pa]=xa[pa],qa[wa+pa]=wa/3}return new V(ma,qa,!1)};ka._createComponentNormalsSmooth=function(ca,fa){const ma={};for(var qa=0;qa<fa.length;qa+=3){var wa=this._calculateFaceNormal(ca,fa,qa,aa);for(var xa=0;3>xa;xa++){var pa=fa[qa+xa];let ra=ma[pa];ra||(ra={normal:d.create(),count:0},ma[pa]=ra);f.add(ra.normal,ra.normal,wa);ra.count++}}ca=p.newFloatArray(3*fa.length);qa=Array(3*fa.length);for(wa=0;wa<fa.length;wa++){xa=ma[fa[wa]];
1!==xa.count&&(f.normalize(xa.normal,xa.normal),xa.count=1);for(pa=0;3>pa;pa++)ca[3*wa+pa]=xa.normal[pa];qa[wa]=wa}return new V(ca,qa,!1)};ka._getFaceVertices=function(ca,fa,ma,qa,wa,xa){const pa=3*fa[ma],ra=3*fa[ma+1];fa=3*fa[ma+2];qa[0]=ca[pa];qa[1]=ca[pa+1];qa[2]=ca[pa+2];wa[0]=ca[ra];wa[1]=ca[ra+1];wa[2]=ca[ra+2];xa[0]=ca[fa];xa[1]=ca[fa+1];xa[2]=ca[fa+2]};ka._calculateFaceNormal=function(ca,fa,ma,qa){this._getFaceVertices(ca,fa,ma,X,Z,Y);f.subtract(Z,Z,X);f.subtract(Y,Y,X);f.cross(X,Z,Y);f.normalize(qa,
X);return qa};ka._getOrCreateComponents=function(ca){return n.unwrapOr(ca.components,ea)};ka._createPositionBuffer=function(ca,fa){let ma=ca.vertexAttributes.position;const qa=fa.reprojection===ja.ECEF?fa.transformBeforeProject:null;n.isSome(qa)&&(ma=y.transformMat4(new Float64Array(ma.length),ma,qa));if(fa.reprojection===ja.NONE)return fa.needsBufferCopy?new Float64Array(ma):ma;fa=n.isSome(qa)?ma:new Float64Array(ma.length);k.projectBuffer(ma,ca.spatialReference,0,fa,this._context.renderCoordsHelper.spatialReference,
0,ma.length/3);return fa};ka._createNormalBuffer=function(ca,fa,ma){let qa=ca.vertexAttributes.normal;if(n.isNone(qa))return null;var wa=ma.reprojection===ja.ECEF?ma.transformBeforeProject:null;n.isSome(wa)&&(qa=B.transformNormal(qa,new Float32Array(qa.length),wa));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ma.reprojection===ja.NONE)return ma.needsBufferCopy&&ca.vertexAttributes.normal===qa?new Float32Array(qa):qa;ma=ca.vertexAttributes.position;wa=n.isSome(wa)?qa:new Float32Array(qa.length);
return B.projectNormalToPCPF(qa,ma,fa,ca.spatialReference,wa)};ka._createTangentBuffer=function(ca,fa,ma){let qa=ca.vertexAttributes.tangent;if(n.isNone(qa))return null;var wa=ma.reprojection===ja.ECEF?ma.transformBeforeProject:null;n.isSome(wa)&&(qa=B.transformTangent(qa,new Float32Array(qa.length),wa));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ma.reprojection===ja.NONE)return ma.needsBufferCopy&&ca.vertexAttributes.normal===qa?new Float32Array(qa):qa;ma=ca.vertexAttributes.position;
wa=n.isSome(wa)?qa:new Float32Array(qa.length);return B.projectTangentToPCPF(qa,ma,fa,ca.spatialReference,wa)};ka._createColorBuffer=function(ca){return ca.vertexAttributes.color};ka._createSymbolColorBuffer=function(ca){if(this._requiresSymbolVertexColors()){ca=this._getVertexOpacityAndColor(ca);const fa=I.parseColorMixMode(n.get(this.symbolLayer,"material","colorMixMode")),ma=new Uint8Array(4);I.encodeSymbolColor(ca,fa,ma);return ma}return null};ka._createBuffers=function(ca,fa){var ma=ca.vertexAttributes&&
ca.vertexAttributes.position;if(!ma)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var qa=ca.vertexAttributes.normal;const wa=ca.vertexAttributes.uv;var xa=ca.vertexAttributes.tangent;if(n.isSome(qa)&&qa.length!==ma.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(n.isSome(xa)&&xa.length/4!==ma.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),
null;if(n.isSome(wa)&&wa.length/2!==ma.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;xa=this._computeReprojectionInfo(ca);ma=this._createPositionBuffer(ca,xa);qa=this._createColorBuffer(ca);fa=this._createSymbolColorBuffer(fa);const pa=this._createNormalBuffer(ca,ma,xa),ra=this._createTangentBuffer(ca,ma,xa);ca=xa.reprojection===ja.NONE&&n.isSome(xa.objectTransformation)?xa.objectTransformation:this._transformOriginLocal(ca,
ma,pa,ra);xa=xa.reprojection===ja.NONE&&n.isSome(xa.geometryTransformation)?xa.geometryTransformation:g.create();return{positionBuffer:ma,normalBuffer:pa,tangentBuffer:ra,uvBuffer:wa,colorBuffer:qa,symbolColorBuffer:fa,objectTransformation:ca,geometryTransformation:xa}};ka._computeReprojectionInfo=function(ca){var fa=n.isSome(ca.transform);const ma=fa&&ca.transform.geographic?ja.NONE:this._context.renderCoordsHelper.viewingMode===z.ViewingMode.Local?ja.NONE:ja.ECEF;if(fa){if(ma===ja.NONE)return fa=
g.create(),k.computeTranslationToOriginAndRotation(ca.spatialReference,ca.transform.origin,fa,this._context.renderCoordsHelper.spatialReference),ca=g.clone(ca.transform.localMatrix),{reprojection:ma,objectTransformation:fa,geometryTransformation:ca,needsBufferCopy:!1};fa=l.fromTranslation(g.create(),ca.transform.origin);l.multiply(fa,fa,ca.transform.localMatrix);return{reprojection:ma,transformBeforeProject:fa,needsBufferCopy:!0}}return{reprojection:ma,needsBufferCopy:!0}};ka._transformOriginLocal=
function(ca,fa,ma,qa){const wa=this._context.renderCoordsHelper.spatialReference;var xa=ca.anchor;T[0]=xa.x;T[1]=xa.y;T[2]=xa.z;xa=g.create();k.computeTranslationToOriginAndRotation(ca.spatialReference,T,xa,wa);l.invert(ia,xa);y.transformMat4(fa,fa,ia);if(n.isSome(ma)||n.isSome(qa))x.fromMat4(na,xa),x.transpose(na,na),n.isSome(ma)&&y.transformMat3(ma,ma,na),n.isSome(qa)&&y.transformMat3(qa,qa,na,4);return xa};ka._validateFaces=function(ca,fa){ca=ca.vertexAttributes.position.length/3;if(fa=fa.faces){let ma=
-1;for(let qa=0;qa<fa.length;qa++){const wa=fa[qa];wa>ma&&(ma=wa)}if(ca<=ma)return this.logger.warn(`Vertex index ${ma} is out of bounds of the mesh position buffer`),!1}else if(0!==ca%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};ka._getOrCreateFaces=function(ca,fa){return fa.faces??h.getContinuousIndexArray(ca.vertexAttributes.position.length/3)};ka._isOutsideClippingArea=
function(ca){if(!this._context.clippingExtent)return!1;var fa=ca.vertexAttributes&&ca.vertexAttributes.position;if(!fa)return!1;const ma=this._context.elevationProvider.spatialReference,qa=fa.length/3;n.isSome(ma)&&!ca.spatialReference.equals(ma)&&(fa=new Float64Array(fa.length),k.projectBuffer(ca.vertexAttributes.position,ca.spatialReference,0,fa,ma,0,qa));u.empty(ba);u.expandWithBuffer(ba,fa,0,qa);return!u.intersectsClippingArea(ba,this._context.clippingExtent)};ka._createGeometryInfo=function(ca,
fa,ma){if(!k.canProjectWithoutEngine(ca.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(ca))return null;fa=this._createBuffers(ca,fa);if(n.isNone(fa))return null;const {positionBuffer:qa,uvBuffer:wa,colorBuffer:xa,symbolColorBuffer:pa,normalBuffer:ra,tangentBuffer:va,objectTransformation:Ba,geometryTransformation:Aa}=fa;var Ha=this._getOrCreateComponents(ca);
fa=[];let Ka=!1;for(const Sa of Ha){if(!this._validateFaces(ca,Sa))return null;var Pa=this._getOrCreateFaces(ca,Sa);if(0===Pa.length)continue;var Ra=this._createComponentNormals(qa,ra,Sa,Pa);Ra.didFlipNormals&&(Ka=!0);Ha=[[U.VertexAttribute.POSITION,new R.Attribute(qa,3,!0)],[U.VertexAttribute.NORMAL,new R.Attribute(Ra.normals,3,!0)]];Ra=[[U.VertexAttribute.POSITION,Pa],[U.VertexAttribute.NORMAL,Ra.indices]];n.isSome(xa)&&(Ha.push([U.VertexAttribute.COLOR,new R.Attribute(xa,4,!0)]),Ra.push([U.VertexAttribute.COLOR,
Pa]));n.isSome(pa)&&(Ha.push([U.VertexAttribute.SYMBOLCOLOR,new R.Attribute(pa,4,!0)]),Ra.push([U.VertexAttribute.SYMBOLCOLOR,h.getZeroIndexArray(Pa.length)]));n.isSome(wa)&&(Ha.push([U.VertexAttribute.UV0,new R.Attribute(wa,2,!0)]),Ra.push([U.VertexAttribute.UV0,Pa]));n.isSome(va)&&(Ha.push([U.VertexAttribute.TANGENT,new R.Attribute(va,4,!0)]),Ra.push([U.VertexAttribute.TANGENT,Pa]));Pa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ma,layerUid:this._context.layer.uid});const La=
this._getOrCreateMaterial(ca,Sa);Ha=new M.Geometry(La,Ha,Ra,null,J.ContentObjectType.Mesh,Pa);Ha.transformation=Aa;fa.push(Ha)}Ka&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:fa,objectTransformation:Ba}};return b._createClass(da)}(H.Graphics3DSymbolLayer);let V=b._createClass(function(ka,da,ha){this.normals=ka;this.indices=da;this.didFlipNormals=
ha});const T=d.create(),X=d.create(),Z=d.create(),Y=d.create(),aa=d.create(),ia=g.create(),na=m.create(),ba=u.create(),ea=[new r];var ja;(function(ka){ka[ka.NONE=0]="NONE";ka[ka.ECEF=1]="ECEF"})(ja||(ja={}));a.Graphics3DMeshFillSymbolLayer=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){var k;const u=n.getLogger("esri.geometry.support.MeshComponent");c=k=function(p){function h(q){q=r.call(this,q);q.faces=null;q.material=null;q.shading="source";q.trustSourceNormals=!1;return q}a._inherits(h,p);var r=a._createSuper(h);h.from=function(q){return g.ensureClass(k,q)};p=h.prototype;p.castFaces=function(q){return e.castArray(q,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},u)};p.castMaterial=function(q){return q&&"object"===typeof q&&("metallic"in
q||"roughness"in q||"metallicRoughnessTexture"in q)?g.ensureClass(d,q):g.ensureClass(f,q)};p.clone=function(){return new k({faces:w.clone(this.faces),shading:this.shading,material:w.clone(this.material),trustSourceNormals:this.trustSourceNormals})};p.cloneWithDeduplication=function(q,y){q={faces:w.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(q,y):null,trustSourceNormals:this.trustSourceNormals};return new k(q)};return a._createClass(h)}(c.JSONSupport);
b.__decorate([x.property({json:{write:!0}})],c.prototype,"faces",void 0);b.__decorate([m.cast("faces")],c.prototype,"castFaces",null);b.__decorate([x.property({type:f,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([m.cast("material")],c.prototype,"castMaterial",null);b.__decorate([x.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);b.__decorate([x.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=k=b.__decorate([l.subclass("esri.geometry.support.MeshComponent")],
c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){var e;w=e=function(k){function u(h){h=p.call(this,h);h.color=null;h.colorTexture=null;h.normalTexture=
null;h.alphaMode="auto";h.alphaCutoff=.5;h.doubleSided=!0;return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.clone=function(){return this.cloneWithDeduplication(null,new Map)};k.cloneWithDeduplication=function(h,r){const q=n.isSome(h)?h.get(this):null;if(q)return q;r=new e(this.clonePropertiesWithDeduplication(r));n.isSome(h)&&h.set(this,r);return r};k.clonePropertiesWithDeduplication=function(h){return{color:n.isSome(this.color)?this.color.clone():null,colorTexture:n.isSome(this.colorTexture)?
this.colorTexture.cloneWithDeduplication(h):null,normalTexture:n.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(h):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:n.isSome(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:n.isSome(this.normalTextureTransform)?this.normalTextureTransform:null}};return a._createClass(u)}(w.JSONSupport);b.__decorate([x.property({type:c,json:{write:!0}})],
w.prototype,"color",void 0);b.__decorate([x.property({type:d,json:{write:!0}})],w.prototype,"colorTexture",void 0);b.__decorate([x.property({type:d,json:{write:!0}})],w.prototype,"normalTexture",void 0);b.__decorate([x.property({nonNullable:!0,json:{write:!0}})],w.prototype,"alphaMode",void 0);b.__decorate([x.property({nonNullable:!0,json:{write:!0}})],w.prototype,"alphaCutoff",void 0);b.__decorate([x.property({nonNullable:!0,json:{write:!0}})],w.prototype,"doubleSided",void 0);b.__decorate([x.property()],
w.prototype,"colorTextureTransform",void 0);b.__decorate([x.property()],w.prototype,"normalTextureTransform",void 0);return w=e=b.__decorate([f.subclass("esri.geometry.support.MeshMaterial")],w)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){var k;const u=new WeakMap;let p=0;c=k=function(h){function r(y){y=q.call(this,y);y.wrap="repeat";return y}a._inherits(r,h);var q=a._createSuper(r);h=r.prototype;h.writeData=function(y,B,D,z){y instanceof HTMLImageElement?(y={type:"image-element",src:e.toJSON(y.src,z),crossOrigin:y.crossOrigin},B[D]=y):y instanceof HTMLCanvasElement?(y=y.getContext("2d").getImageData(0,0,y.width,y.height),y={type:"canvas-element",imageData:this._encodeImageData(y)},B[D]=y):y instanceof
HTMLVideoElement?(y={type:"video-element",src:e.toJSON(y.src,z),autoplay:y.autoplay,loop:y.loop,muted:y.muted,crossOrigin:y.crossOrigin,preload:y.preload},B[D]=y):y instanceof ImageData&&(y={type:"image-data",imageData:this._encodeImageData(y)},B[D]=y)};h.readData=function(y){switch(y.type){case "image-element":var B=new Image;B.src=y.src;B.crossOrigin=y.crossOrigin;return B;case "canvas-element":return y=this._decodeImageData(y.imageData),B=document.createElement("canvas"),B.width=y.width,B.height=
y.height,B.getContext("2d").putImageData(y,0,0),B;case "image-data":return this._decodeImageData(y.imageData);case "video-element":return B=document.createElement("video"),B.src=y.src,B.crossOrigin=y.crossOrigin,B.autoplay=y.autoplay,B.loop=y.loop,B.muted=y.muted,B.preload=y.preload,B}};h.clone=function(){const y={url:this.url,data:this.data,wrap:this._cloneWrap()};return new k(y)};h.cloneWithDeduplication=function(y){var B=y.get(this);if(B)return B;B=this.clone();y.set(this,B);return B};h._cloneWrap=
function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};h._encodeImageData=function(y){let B="";for(let D=0;D<y.data.length;D++)B+=String.fromCharCode(y.data[D]);return{data:btoa(B),width:y.width,height:y.height}};h._decodeImageData=function(y){const B=atob(y.data),D=new Uint8ClampedArray(B.length);for(let z=0;z<B.length;z++)D[z]=B.charCodeAt(z);return w.wrapImageData(D,y.width,y.height)};h._imageDataContainsTransparent=function(y){for(let B=
3;B<y.data.length;B+=4)if(255!==y.data[B])return!0;return!1};r.from=function(y){return"string"===typeof y?new k({url:y}):y instanceof HTMLImageElement||y instanceof HTMLCanvasElement||y instanceof ImageData||y instanceof HTMLVideoElement?new k({data:y}):m.ensureClass(k,y)};a._createClass(r,[{key:"url",get:function(){return this._get("url")||null},set:function(y){this._set("url",y);y&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(y){this._set("data",
y);y&&this._set("url",null)}},{key:"transparent",get:function(){var y=this.data,B=this.url;return y instanceof HTMLCanvasElement?this._imageDataContainsTransparent(y.getContext("2d").getImageData(0,0,y.width,y.height)):y instanceof ImageData?this._imageDataContainsTransparent(y):B&&(y=B.substr(B.length-4,4).toLowerCase(),B=B.substr(0,15).toLocaleLowerCase(),".png"===y||"data:image/png;"===B)?!0:!1},set:function(y){this._overrideIfSome("transparent",y)}},{key:"contentHash",get:function(){const y="string"===
typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",B=(D="")=>`d:${D},t:${this.transparent},w:${y}`;if(null!=this.url)return B(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return B(this.data.src);u.has(this.data)||u.set(this.data,++p);return B(u.get(this.data))}return B()}}]);return r}(n.JSONSupport);b.__decorate([x.property({type:String,json:{write:e.write}})],c.prototype,"url",
null);b.__decorate([x.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),x.property()],c.prototype,"data",null);b.__decorate([d.writer("data")],c.prototype,"writeData",null);b.__decorate([g.reader("data")],c.prototype,"readData",null);b.__decorate([x.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([x.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([x.property({readOnly:!0})],
c.prototype,"contentHash",null);return c=k=b.__decorate([f.subclass("esri.geometry.support.MeshTexture")],c)})},"esri/core/imageUtils":function(){define(["exports"],function(a){function b(n,x,m){m||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),m=c);return m.getContext("2d").createImageData(n,x)}let c=null,w=!0;a.createEmptyImageData=function(n,x,m){if(!n||!x)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(n,x)}catch(l){w=!1}return b(n,x,
m)};a.wrapImageData=function(n,x,m,l){if(!x||!m)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(n,x,m)}catch(g){w=!1}x=b(x,m,l);x.data.set(n,0);return x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){var e;x=e=function(k){function u(h){h=p.call(this,h);h.emissiveColor=null;h.emissiveTexture=null;h.occlusionTexture=null;h.metallic=1;h.roughness=1;h.metallicRoughnessTexture=null;return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.clone=function(){return this.cloneWithDeduplication(null,new Map)};k.cloneWithDeduplication=function(h,r){const q=w.isSome(h)?h.get(this):null;if(q)return q;r=new e(this.clonePropertiesWithDeduplication(r));w.isSome(h)&&h.set(this,
r);return r};k.clonePropertiesWithDeduplication=function(h){return{...a._get(a._getPrototypeOf(u.prototype),"clonePropertiesWithDeduplication",this).call(this,h),emissiveColor:w.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:w.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(h):null,occlusionTexture:w.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(h):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:w.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(h):null,occlusionTextureTransform:w.isSome(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:w.isSome(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:w.isSome(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}};return a._createClass(u)}(f);b.__decorate([n.property({type:c,json:{write:!0}})],x.prototype,"emissiveColor",
void 0);b.__decorate([n.property({type:d,json:{write:!0}})],x.prototype,"emissiveTexture",void 0);b.__decorate([n.property({type:d,json:{write:!0}})],x.prototype,"occlusionTexture",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],x.prototype,"metallic",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],x.prototype,"roughness",void 0);b.__decorate([n.property({type:d,json:{write:!0}})],x.prototype,"metallicRoughnessTexture",
void 0);b.__decorate([n.property()],x.prototype,"occlusionTextureTransform",void 0);b.__decorate([n.property()],x.prototype,"emissiveTextureTransform",void 0);b.__decorate([n.property()],x.prototype,"metallicRoughnessTextureTransform",void 0);return x=e=b.__decorate([g.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],x)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(p,h,r,q){const {loggerTag:y,stride:B}=h;return 0!==p.length%B?(q.error(y,`Invalid array length, expected a multiple of ${B}`),new r([])):p}function d(p,h,r,q,y){if(!p)return p;if(p instanceof h)return f(p,q,h,y);for(const B of r)if(p instanceof B)return f(new h(p),q,h,y);if(Array.isArray(p))return f(new h(p),q,h,y);r=r.map(B=>`'${B.name}'`);y.error(`Failed to set property, expected one of ${r}, but got ${p.constructor.name}`);return new h([])}function e(p,h,
r){const q=Array(p.length);for(let y=0;y<p.length;y++)q[y]=p[y];h[r]=q}var k;const u=x.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=k=function(p){function h(q){q=r.call(this,q);q.color=null;q.position=new Float64Array(0);q.uv=null;q.normal=null;q.tangent=null;return q}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.castColor=function(q){return d(q,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},u)};p.castPosition=function(q){q&&q instanceof
Float32Array&&u.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return d(q,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},u)};p.castUv=function(q){return d(q,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},u)};p.castNormal=function(q){return d(q,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},u)};p.castTangent=function(q){return d(q,Float32Array,
[Float64Array],{loggerTag:".tangent\x3d",stride:4},u)};p.clone=function(){const q={position:n.clone(this.position),uv:n.clone(this.uv),normal:n.clone(this.normal),tangent:n.clone(this.tangent),color:n.clone(this.color)};return new k(q)};p.clonePositional=function(){const q={position:n.clone(this.position),normal:n.clone(this.normal),tangent:n.clone(this.tangent),uv:this.uv,color:this.color};return new k(q)};return b._createClass(h)}(w.JSONSupport);c.__decorate([m.property({json:{write:e}})],a.MeshVertexAttributes.prototype,
"color",void 0);c.__decorate([l.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([m.property({nonNullable:!0,json:{write:e}})],a.MeshVertexAttributes.prototype,"position",void 0);c.__decorate([l.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([m.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([l.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([m.property({json:{write:e}})],
a.MeshVertexAttributes.prototype,"normal",void 0);c.__decorate([l.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([m.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"tangent",void 0);c.__decorate([l.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=k=c.__decorate([g.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../spatialReferenceEllipsoidUtils ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(v,A,t,C,E,F){if(A){var H=t.count,K=g.getSphericalPCPF(E);if(h(E))for(t=0;t<H;t++)C.getVec(t,y),
A.getVec(t,B),l.computeTranslationToOriginAndRotation(K,y,D,K),c.fromMat4(z,D),v===q.FROM_PCPF&&c.transpose(z,z),x.transformMat3(B,B,z),F.setVec(t,B);else for(E=0;E<H;E++){C.getVec(E,y);A.getVec(E,B);l.computeTranslationToOriginAndRotation(K,y,D,K);c.fromMat4(z,D);var I=d.y2lat(t.get(E,1));I=Math.cos(I);v===q.TO_PCPF&&(I=1/I);z[0]*=I;z[1]*=I;z[2]*=I;z[3]*=I;z[4]*=I;z[5]*=I;v===q.FROM_PCPF&&c.transpose(z,z);x.transformMat3(B,B,z);x.normalize(B,B);F.setVec(E,B)}return F}}function p(v){return h(v)||
v.isWebMercator}function h(v){return v.isWGS84||f.isCGCS2000(v)||f.isMars(v)||f.isMoon(v)}const r=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var q;(function(v){v[v.TO_PCPF=0]="TO_PCPF";v[v.FROM_PCPF=1]="FROM_PCPF"})(q||(q={}));const y=m.create(),B=m.create(),D=n.create(),z=w.create();a.projectFromPCPF=function(v,A,t){l.projectBuffer(v,g.getSphericalPCPF(t),0,A,t,0,v.length/3);return A};a.projectNormalFromPCPF=function(v,A,t,C,E){if(!p(C))return r.error("Cannot convert to spatial reference from PCPF"),
E;u(q.FROM_PCPF,e.BufferViewVec3f.fromTypedArray(v),e.BufferViewVec3f64.fromTypedArray(A),e.BufferViewVec3f64.fromTypedArray(t),C,e.BufferViewVec3f.fromTypedArray(E));return E};a.projectNormalToPCPF=function(v,A,t,C,E){if(!p(C))return r.error("Cannot convert spatial reference to PCPF"),E;u(q.TO_PCPF,e.BufferViewVec3f.fromTypedArray(v),e.BufferViewVec3f64.fromTypedArray(A),e.BufferViewVec3f64.fromTypedArray(t),C,e.BufferViewVec3f.fromTypedArray(E));return E};a.projectTangentFromPCPF=function(v,A,t,
C,E){if(!p(C))return r.error("Cannot convert to spatial reference from PCPF"),E;u(q.FROM_PCPF,e.BufferViewVec3f.fromTypedArray(v,16),e.BufferViewVec3f64.fromTypedArray(A),e.BufferViewVec3f64.fromTypedArray(t),C,e.BufferViewVec3f.fromTypedArray(E,16));for(A=3;A<v.length;A+=4)E[A]=v[A];return E};a.projectTangentToPCPF=function(v,A,t,C,E){if(!p(C))return r.error("Cannot convert spatial reference to PCPF"),E;u(q.TO_PCPF,e.BufferViewVec3f.fromTypedArray(v,4*Float32Array.BYTES_PER_ELEMENT),e.BufferViewVec3f64.fromTypedArray(A),
e.BufferViewVec3f64.fromTypedArray(t),C,e.BufferViewVec3f.fromTypedArray(E,4*Float32Array.BYTES_PER_ELEMENT));for(A=3;A<v.length;A+=4)E[A]=v[A];return E};a.projectToPCPF=function(v,A,t){l.projectBuffer(v,A,0,t,g.getSphericalPCPF(A),0,v.length/3);return t};a.transformNormal=function(v,A,t){c.normalFromMat4(z,t);k.transformMat3(A,v,z);c.isOrthoNormal(z)||k.normalize(A,A);return A};a.transformTangent=function(v,A,t){c.normalFromMat4(z,t);k.transformMat3(A,v,z,4);c.isOrthoNormal(z)||k.normalize(A,A,4);
if(v!==A)for(t=3;t<v.length;t+=4)A[t]=v[t];return A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/basicInterfaces"],function(a,b,c){let w=b._createClass(function(n){this.data=n;this.type="encoded-mesh-texture";this.encoding=c.TextureEncodingMimeType.KTX2_ENCODING});a.EncodedMeshTexture=w;a.imageFromBinaryData=async function(n,x){return x===
c.TextureEncodingMimeType.KTX2_ENCODING?new w(n):new Promise((m,l)=>{const g=new Blob([n],{type:x}),f=URL.createObjectURL(g),d=new Image,e=()=>{URL.revokeObjectURL(f);"decode"in d?d.decode().then(()=>m(d),()=>m(d)).then(u):(m(d),u())},k=p=>{URL.revokeObjectURL(f);l(p);u()},u=()=>{d.removeEventListener("load",e);d.removeEventListener("error",k)};d.addEventListener("load",e);d.addEventListener("error",k);d.src=f})};a.isEncodedMeshTexture=function(n){return"encoded-mesh-texture"===n?.type};a.jsonFromBinaryData=
async function(n){return new Promise((x,m)=>{const l=new Blob([n]),g=new FileReader;g.onload=()=>{x(JSON.parse(g.result))};g.onerror=f=>{m(f)};g.readAsText(l)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../core/maybe","../../../../chunks/mat3f32","../../../../chunks/vec2f32","../../../../chunks/mat3"],function(a,b,c,w,n){a.getTransformMatrix=function(x){if(b.isNone(x))return null;var m=
b.isSome(x.offset)?x.offset:w.ZEROS,l=b.isSome(x.rotation)?x.rotation:0;x=b.isSome(x.scale)?x.scale:w.ONES;m=c.fromValues(1,0,0,0,1,0,m[0],m[1],1);l=c.fromValues(Math.cos(l),-Math.sin(l),0,Math.sin(l),Math.cos(l),0,0,0,1);x=c.fromValues(x[0],0,0,0,x[1],0,0,0,1);const g=c.create();n.multiply(g,l,x);n.multiply(g,m,g);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ./internal/bufferWriterUtils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){var C;(function(Y){Y[Y.START=0]="START";Y[Y.END=1]="END"})(C||(C={}));let E=function(Y){function aa(na){na=ia.call(this,na,new K);na._configuration=new t.NativeLineTechniqueConfiguration;return na}b._inherits(aa,Y);var ia=b._createSuper(aa);Y=aa.prototype;Y.getConfiguration=function(na,ba){this._configuration.output=na;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;
this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.draped=ba.slot===q.RenderSlot.DRAPED_MATERIAL;na=n.isSome(this.parameters.stipplePattern);this._configuration.stippleEnabled=na;this._configuration.stippleOffColorEnabled=na&&n.isSome(this.parameters.stippleOffColor);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous;return this._configuration};Y.intersect=
function(na,ba,ea,ja,ka,da){if(ea.options.selectionMode&&na.visible)if(y.isTranslationMatrix(ba)){ka=na.vertexAttributes.get(B.VertexAttribute.POSITION).data;var ha=ea.camera,ca=S;m.copy(ca,ea.point);l.set(Q[0],ca[0]-2,ca[1]+2,0);l.set(Q[1],ca[0]+2,ca[1]+2,0);l.set(Q[2],ca[0]+2,ca[1]-2,0);l.set(Q[3],ca[0]-2,ca[1]-2,0);for(na=0;4>na;na++)if(!ha.unprojectFromRenderScreen(Q[na],W[na]))return;k.fromPoints(ha.eye,W[0],W[1],V);k.fromPoints(ha.eye,W[1],W[2],T);k.fromPoints(ha.eye,W[2],W[3],X);k.fromPoints(ha.eye,
W[3],W[0],Z);ja=Number.MAX_VALUE;na=0;for(let ma=0;ma<ka.length-5;ma+=3)if(I[0]=ka[ma]+ba[12],I[1]=ka[ma+1]+ba[13],I[2]=ka[ma+2]+ba[14],L[0]=ka[ma+3]+ba[12],L[1]=ka[ma+4]+ba[13],L[2]=ka[ma+5]+ba[14],!(0>k.signedDistance(V,I)&&0>k.signedDistance(V,L)||0>k.signedDistance(T,I)&&0>k.signedDistance(T,L)||0>k.signedDistance(X,I)&&0>k.signedDistance(X,L)||0>k.signedDistance(Z,I)&&0>k.signedDistance(Z,L))){ha.projectToRenderScreen(I,J);ha.projectToRenderScreen(L,M);if(0>J[2]&&0<M[2]){l.subtract(R,I,L);var fa=
ha.frustum;fa=-k.signedDistance(fa[d.PlaneIndex.NEAR],I)/l.dot(R,k.normal(fa[d.PlaneIndex.NEAR]));l.scale(R,R,fa);l.add(I,I,R);ha.projectToRenderScreen(I,J)}else if(0<J[2]&&0>M[2])l.subtract(R,L,I),fa=ha.frustum,fa=-k.signedDistance(fa[d.PlaneIndex.NEAR],L)/l.dot(R,k.normal(fa[d.PlaneIndex.NEAR])),l.scale(R,R,fa),l.add(L,L,R),ha.projectToRenderScreen(L,M);else if(0>J[2]&&0>M[2])continue;J[2]=0;M[2]=0;fa=e.distance2(e.fromPoints(J,M,U),ca);fa<ja&&(ja=fa,l.copy(G,I),l.copy(P,L),na=ma/3)}ba=ea.rayBegin;
ea=ea.rayEnd;4>ja&&(ja=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(G,P,U),e.fromPoints(ba,ea,N),O)&&(l.subtract(O,O,ba),ja=l.length(O),l.scale(O,O,1/ja),ja/=l.distance(ba,ea)),da(ja,O,na,!1))}else c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")};Y.intersectDraped=function(na,ba,ea,ja,ka,da){if(ea.options.selectionMode){ba=na.vertexAttributes.get(B.VertexAttribute.POSITION).data;var ha=na.vertexAttributes.get(B.VertexAttribute.SIZE);
ea=ja[0];ja=ja[1];na=(((ha?ha.data[0]:0)+1)/2+4)*na.screenToWorldRatio;ha=Number.MAX_VALUE;var ca=0;for(let xa=0;xa<ba.length-5;xa+=3){var fa=ba[xa],ma=ba[xa+1],qa=ea-fa,wa=ja-ma;fa=ba[xa+3]-fa;ma=ba[xa+4]-ma;const pa=w.clamp((fa*qa+ma*wa)/(fa*fa+ma*ma),0,1);qa=fa*pa-qa;wa=ma*pa-wa;wa=qa*qa+wa*wa;wa<ha&&(ha=wa,ca=xa/3)}ha<na*na&&ka(da.dist,da.normal,ca,!1)}};Y.requiresSlot=function(na,ba){return(ba===p.ShaderOutput.Color||ba===p.ShaderOutput.Highlight||ba===p.ShaderOutput.ObjectAndLayerIdColor)&&
(na===q.RenderSlot.OPAQUE_MATERIAL||na===q.RenderSlot.DRAPED_MATERIAL)};Y.createGLMaterial=function(na){return new F(na)};Y.createBufferWriter=function(){const na=this.parameters.hasVertexColors?z.PositionColorLayout:z.PositionLayout;return n.isNone(this.parameters.stipplePattern)?new D.DefaultBufferWriter(na):new H(na.clone().vec3f(B.VertexAttribute.AUXPOS1).vec2f(B.VertexAttribute.UV0))};return b._createClass(aa)}(r.Material),F=function(Y){function aa(){var na=ia.apply(this,arguments);na._stipplePattern=
null;return na}b._inherits(aa,Y);var ia=b._createSuper(aa);Y=aa.prototype;Y.dispose=function(){b._get(b._getPrototypeOf(aa.prototype),"dispose",this).call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};Y._updateOccludeeState=function(na){na.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:na.hasOccludees})};Y.beginSlot=function(na){this._output===p.ShaderOutput.Color&&this._updateOccludeeState(na);const ba=
this._material.parameters.stipplePattern;this._stipplePattern!==ba&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,ba)),this._stipplePattern=ba);return this.ensureTechnique(A.NativeLineTechnique,na)};return b._createClass(aa)}(h),H=function(){function Y(ia){this.vertexBufferLayout=ia}var aa=Y.prototype;aa.allocate=function(ia){return this.vertexBufferLayout.createBuffer(ia)};aa.elementCount=function(ia){return ia.indices.get(B.VertexAttribute.POSITION).length};
aa.write=function(ia,na,ba,ea,ja){v.writeDefaultAttributes(ba,this.vertexBufferLayout,ia,na,ea,ja);this._writeAuxpos1(ia,ba,ea,ja);this._writeUV0(ia,ba,ea,ja)};aa._writeAuxpos1=function(ia,na,ba,ea){var ja=ba.getField(B.VertexAttribute.AUXPOS1,u.BufferViewVec3f);ba=na.indices.get(B.VertexAttribute.POSITION);na=na.vertexAttributes.get(B.VertexAttribute.POSITION).data;const ka=ja.typedBufferStride;ja=ja.typedBuffer;ea*=ka;for(let ha=0;ha<ba.length-1;ha+=2)for(const ca of[1,0]){var da=3*ba[ha+ca];const fa=
na[da],ma=na[da+1];da=na[da+2];const qa=ia[1]*fa+ia[5]*ma+ia[9]*da+ia[13],wa=ia[2]*fa+ia[6]*ma+ia[10]*da+ia[14];ja[ea]=ia[0]*fa+ia[4]*ma+ia[8]*da+ia[12];ja[ea+1]=qa;ja[ea+2]=wa;ea+=ka}};aa._writeUV0=function(ia,na,ba,ea){var ja=ba.getField(B.VertexAttribute.UV0,u.BufferViewVec2f),ka=na.indices.get(B.VertexAttribute.POSITION);ba=na.vertexAttributes.get(B.VertexAttribute.POSITION).data;const da=na.vertexAttributes.get(B.VertexAttribute.DISTANCETOSTART)?.data;na=ja.typedBufferStride;ja=ja.typedBuffer;
ea*=na;let ha=0;ja[ea]=C.START;ja[ea+1]=ha;ea+=na;var ca=3*ka[0];ca=l.set(I,ba[ca],ba[ca+1],ba[ca+2]);ia&&l.transformMat4(ca,ca,ia);const fa=L,ma=ka.length-1;let qa=1;const wa=da?(pa,ra,va)=>ha=da[va]:(pa,ra,va)=>ha+=l.distance(pa,ra);for(let pa=1;pa<ma;pa+=2){var xa=3*ka[pa];l.set(fa,ba[xa],ba[xa+1],ba[xa+2]);ia&&l.transformMat4(fa,fa,ia);wa(ca,fa,qa++);for(xa=0;2>xa;++xa)ja[ea]=1-xa,ja[ea+1]=ha,ea+=na;l.copy(ca,fa)}ka=3*ka[ma];l.set(fa,ba[ka],ba[ka+1],ba[ka+2]);ia&&l.transformMat4(fa,fa,ia);wa(ca,
fa,qa);ja[ea]=C.END;ja[ea+1]=ha};return b._createClass(Y)}(),K=function(Y){function aa(){var na=ia.apply(this,arguments);na.color=f.ONES;na.hasVertexColors=!1;na.hasSlicePlane=!1;na.width=1;na.stipplePreferContinuous=!0;na.hasOccludees=!1;na.stippleTexture=null;return na}b._inherits(aa,Y);var ia=b._createSuper(aa);return b._createClass(aa)}(r.MaterialParameters);const I=g.create(),L=g.create(),R=g.create(),O=g.create(),J=x.createRenderScreenPointArray3(),M=x.createRenderScreenPointArray3(),G=g.create(),
P=g.create(),U=e.create(),N=e.create(),S=g.create(),Q=[x.createRenderScreenPointArray3(),x.createRenderScreenPointArray3(),x.createRenderScreenPointArray3(),x.createRenderScreenPointArray3()],W=[g.create(),g.create(),g.create(),g.create()],V=k.create(),T=k.create(),X=k.create(),Z=k.create();a.NativeLineMaterial=E;a.Parameters=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){x=function(k){function u(){return p.apply(this,arguments)}c._inherits(u,k);var p=c._createSuper(u);k=u.prototype;k.initializeProgram=function(h){return new l.Program(h.rctx,u.shader.get().build(this.configuration),m.Default3D)};k.initializePipeline=function(){const h=this.configuration,r=e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),q=(y,B=null,D=null)=>e.makePipelineState({blending:B,
depthTest:g.depthCompareLess,depthWrite:D,colorWrite:e.defaultColorWriteParams,stencilWrite:h.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:h.hasOccludees?y?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null});return h.output===w.ShaderOutput.Color?(this._occludeePipelineState=q(!0,h.transparent||this._stippleEnabled?r:null,e.defaultDepthWriteParams),q(!1,h.transparent||this._stippleEnabled?r:null,e.defaultDepthWriteParams)):q(!1)};k.getPipelineState=function(h,r){return r?this._occludeePipelineState:
c._get(c._getPrototypeOf(u.prototype),"getPipelineState",this).call(this,h,r)};c._createClass(u,[{key:"_stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==w.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return d.PrimitiveType.LINES}}]);return u}(x.ShaderTechnique);x.shader=new n.ReloadableShaderModule(f.NativeLine,()=>new Promise((k,u)=>a(["./NativeLine.glsl"],k,u)));b.NativeLineTechnique=x;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(r){const q=new k.ShaderBuilder,{vertex:y,fragment:B}=q;q.include(w.Transform,r);q.include(n.VertexColor,r);q.include(m.LineStipple,r);g.addProjViewLocalOrigin(y,r);r.stippleEnabled&&(q.attributes.add(u.VertexAttribute.UV0,"vec2"),q.attributes.add(u.VertexAttribute.AUXPOS1,"vec3"),y.uniforms.add(new f.Float4PassUniform("viewport",(D,z)=>z.camera.fullViewport)));q.attributes.add(u.VertexAttribute.POSITION,"vec3");q.varyings.add("vpos","vec3");y.code.add(e.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);r.stippleEnabled&&(y.code.add(e.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),r.draped?y.uniforms.add(new d.FloatPassUniform("worldToScreenRatio",(D,z)=>1/z.screenToPCSRatio)):y.code.add(e.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),y.code.add(e.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),r.draped?y.code.add(e.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):y.code.add(e.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),y.uniforms.add(new d.FloatPassUniform("stipplePatternPixelSize",D=>m.computePixelSize(D))),y.code.add(e.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));y.code.add(e.glsl`}`);r.output===b.ShaderOutput.Highlight&&q.include(x.OutputHighlight,r);q.include(c.SliceDraw,r);B.uniforms.add(new d.FloatPassUniform("alphaCoverage",(D,z)=>Math.min(1,D.width*z.camera.pixelRatio)));r.hasVertexColors||B.uniforms.add(new f.Float4PassUniform("constantColor",D=>D.color));B.code.add(e.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${r.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${r.output===b.ShaderOutput.ObjectAndLayerIdColor?e.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${e.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${r.output===b.ShaderOutput.Color?e.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${r.output===b.ShaderOutput.Highlight?e.glsl`outputHighlight();`:""}
  }
  `);return q}const h=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.NativeLine=h;a.build=p})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,w,n,x){x=function(m){function l(){var f=
g.apply(this,arguments);f.output=w.ShaderOutput.Color;f.hasSlicePlane=!1;f.hasVertexColors=!1;f.transparent=!1;f.draped=!1;f.stippleEnabled=!1;f.stippleOffColorEnabled=!1;f.stipplePreferContinuous=!0;f.hasOccludees=!1;return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(x.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:w.ShaderOutput.COUNT})],x.prototype,"output",void 0);c.__decorate([n.parameter()],x.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],
x.prototype,"hasVertexColors",void 0);c.__decorate([n.parameter()],x.prototype,"transparent",void 0);c.__decorate([n.parameter()],x.prototype,"draped",void 0);c.__decorate([n.parameter()],x.prototype,"stippleEnabled",void 0);c.__decorate([n.parameter()],x.prototype,"stippleOffColorEnabled",void 0);c.__decorate([n.parameter()],x.prototype,"stipplePreferContinuous",void 0);c.__decorate([n.parameter()],x.prototype,"hasOccludees",void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"stippleRequiresClamp",
void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([n.parameter({constValue:!1})],x.prototype,"stippleRequiresStretchMeasure",void 0);a.NativeLineTechniqueConfiguration=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/typedArrayUtil ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G){let P=b._createClass(function(T,X,Z,Y,aa,ia,na,ba,ea,ja,ka,da){this.lodResources=T;this.lodRenderer=X;this.stageResources=Z;this.originalMaterialParameters=Y;this.resourceSize=aa;this.isEsriSymbolResource=ia;this.isWosr=na;this.resourceBoundingBox=ba;this.symbolSize=ea;this.extentPadding=ja;this.physicalBasedRenderingEnabled=ka;this.pivotOffset=da});v=function(T){function X(Y,aa,ia,na){Y=Z.call(this,Y,aa,ia,na);Y._resources=
null;Y._optionalFields=[];Y._instanceIndexToGraphicUid=new Map;Y._hasLoadedPBRTextures=!1;Y._disposeResourceHandles=[];U.set(b._assertThisInitialized(Y),!1);Y.ensureDrapedStatus(!1);Y._hasLoadedPBRTextures=ia.physicalBasedRenderingEnabled;return Y}b._inherits(X,T);var Z=b._createSuper(X);T=X.prototype;T.getCachedSize=function(){const [Y,aa,ia]=x.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:Y,depth:aa,height:ia}};T.doLoad=async function(Y){if(!this._drivenProperties.size&&
A.validateSymbolLayerSize(this.symbolLayer))throw Error();var aa=this.symbolLayer.resource;this._isPrimitive?(aa=aa&&K.isValidPrimitive(aa.primitive)?aa.primitive:r.defaultPrimitive,this._resources=await this._createResourcesForPrimitive(aa,Y)):this._resources=await this._createResourcesForUrl(aa.href,Y);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()};T._setMaterialTransparencyParams=function(Y,aa=x.get(this.symbolLayer,
"material","color")){aa=this._getCombinedOpacity(aa);const ia=1>aa||this.needsDrivenTransparentPass;Y.transparent=ia;Y.opacity=aa;Y.cullFace=ia?R.CullFaceOptions.None:R.CullFaceOptions.Back;return Y};T._createResourcesForPrimitive=async function(Y,aa){var ia=this.symbolLayer;const na=h.create(q.objectSymbolLayerPrimitiveBoundingBox(Y)),ba=k.fromArray(h.size(na)),ea=k.fromArray(q.objectSymbolLayerSizeWithResourceSize(ba,ia)),ja=e.length(ea);var ka={usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0,ambient:k.ONES,diffuse:k.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const da=!!ka.usePBR;this._setMaterialTransparencyParams(ka);const ha=this.symbol;if("point-3d"===ha.type&&ha.verticalOffset){const {screenLength:ca,minWorldLength:fa,maxWorldLength:ma}=ha.verticalOffset;ka.verticalOffset={screenLength:l.pt2px(ca),minWorldLength:fa||0,maxWorldLength:x.isSome(ma)?
ma:Infinity};ka.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ka.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ka.externalColor=u.ONES:(ia=x.isSome(ia.material)?ia.material.color:null,ia=x.isSome(ia)?w.toUnitRGBA(ia):u.ONES,ka.externalColor=ia);this._fastUpdates=L.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(na,ea,ba,x.none));ka.isInstanced=!0;this._fastUpdates?(Object.assign(ka,
this._fastUpdates.materialParameters),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ka.hasInstancedColor=!0,this._optionalFields.push("color"));n("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push("objectAndLayerIdColor");ka=new G.DefaultMaterial(ka);ka=K.primitiveLodResources(Y,ka);if(!ka)throw Error(`Unknown object symbol primitive: ${Y}`);Y=M.materialsFromLodResources(ka).map(ca=>({opacity:1,transparent:ca.parameters.transparent}));ia=await this._createStageResources(ka,
da,aa);aa=await this._createLodRenderer(ka,aa);return new P(ka,aa,ia,Y,ba,!1,!1,na,ea,ja,da,x.none)};T._createResourcesForUrl=async function(Y,aa){var ia={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};(this._fastUpdates=L.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(x.none,
x.none,x.none,x.none)))?(Object.assign(ia.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ia.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push("color"));n("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push("objectAndLayerIdColor");var na=this.symbol;if("point-3d"===na.type&&na.verticalOffset){const {screenLength:ra,minWorldLength:va,maxWorldLength:Ba}=na.verticalOffset;ia.materialParamsMixin.verticalOffset=
{screenLength:l.pt2px(ra),minWorldLength:va||0,maxWorldLength:x.isSome(Ba)?Ba:Infinity};ia.materialParamsMixin.castShadows=!1}ia.signal=aa;ia.usePBR=this._context.physicalBasedRenderingEnabled;ia.skipHighLods=this._context.skipHighSymbolLods;na=ia.usePBR;var ba=await F.fetch(Y,ia);Y=ba.isEsriSymbolResource;ia=ba.isWosr;const ea=E.makeLodResources(ba.lods);ea.levels.sort((ra,va)=>ra.minScreenSpaceRadius-va.minScreenSpaceRadius);const ja=this._context,ka=this._getExternalColorParameters(this.symbolLayer.material);
var da=x.get(this.symbolLayer,"material","color");const ha=this._getCombinedOpacity(da,{hasIntrinsicColor:!0}),ca=this.needsDrivenTransparentPass;var fa=M.materialsFromLodResources(ea);da=M.materialsFromLodResources(ea).map(ra=>({opacity:ra.parameters.opacity||1,transparent:ra.parameters.transparent}));fa.forEach(ra=>{const va=ra.parameters;ra.setParameters(ka);const Ba=va.opacity*ha;ra.setParameters({opacity:Ba,transparent:1>Ba||ca||va.transparent});ja.screenSizePerspectiveEnabled&&ra.setParameters({screenSizePerspective:ja.sharedResources.screenSizePerspectiveSettings})});
ba=ba.referenceBoundingBox;const ma=k.fromArray(h.size(ba)),qa=k.fromArray(ea.levels[0].pivotOffset),wa=k.fromArray(q.objectSymbolLayerSizeWithResourceSize(ma,this.symbolLayer)),xa=e.length(wa),pa=this._fastUpdates;L.updateFastSymbolUpdatesState(pa,this._context.renderer,this._fastVisualVariableConvertOptions(ba,wa,ma,qa))&&fa.forEach(ra=>ra.setParameters(pa.materialParameters));fa=await this._createStageResources(ea,na,aa);aa=await this._createLodRenderer(ea,aa);return new P(ea,aa,fa,da,ma,Y,ia,
ba,wa,xa,na,qa)};T._addDisposeResource=function(Y){this._disposeResourceHandles.push(Y)};T._createStageResources=async function(Y,aa,ia){const na=this._context.stage,ba=M.materialsFromLodResources(Y);aa!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();na.addMany(ba);this._addDisposeResource(()=>na.removeMany(ba));const ea=M.texturesFromLodResources(Y);na.addMany(ea);this._addDisposeResource(()=>na.removeMany(ea));await na.load(ea,ia);m.throwIfAborted(ia);const ja=
M.geometriesFromLodResources(Y);na.addMany(ja);this._addDisposeResource(()=>na.removeMany(ja));return{materials:ba,textures:ea,geometries:ja}};T._createLodRenderer=async function(Y,aa){const ia=this._context.stage,na=this._fastUpdates,ba=new J.LodRenderer({symbol:Y,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:ea=>this._instanceIndexToGraphicUid.get(ea),notifyGraphicGeometryChanged:ea=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(ea)),
notifyGraphicVisibilityChanged:ea=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(ea))},shaderTransformation:na?{applyTransform:(ea,ja,ka)=>{ea.getFeatureAttribute(ja,W);f.copy(ka,L.evaluateModelTransform(na.materialParameters,W,ka))},scaleFactor:(ea,ja,ka)=>{ja.getFeatureAttribute(ka,W);L.evaluateModelTransformScale(ea,na.materialParameters,W)}}:null},this._context.scheduler);ba.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{ia.removeRenderPlugin(ba);
ba.destroy()});await ia.addRenderPlugin(ba.slots,ba,aa);return ba};T._getExternalColorParameters=function(Y){const aa={};this._drivenProperties.color?aa.externalColor=u.ONES:x.isSome(Y)&&x.isSome(Y.color)?aa.externalColor=w.toUnitRGBA(Y.color):(aa.externalColor=u.ONES,aa.colorMixMode="ignore");return aa};T.destroy=function(){b._get(b._getPrototypeOf(X.prototype),"destroy",this).call(this);this._cleanupResources()};T._cleanupResources=function(){this._disposeResourceHandles.forEach(Y=>Y());this._disposeResourceHandles.length=
0;this._resources=null};T.createGraphics3DGraphic=function(Y){const aa=Y.graphic;if(!this._validateGeometry(aa.geometry))return null;const ia=H.placePointOnGeometry(aa.geometry);if(x.isNone(ia))return this.logger.warn(`unsupported geometry type for icon symbol: ${aa.geometry.type}`),null;const na=this.setGraphicElevationContext(aa,new D.ElevationContext);return this._createAs3DShape(aa,ia,Y.renderingInfo,na,aa.uid,Y.layer.uid)};T.notifyDestroyGraphicLayer=function(Y){this._instanceIndexToGraphicUid.delete(Y.instanceIndex)};
T.graphicLayerToGraphicId=function(){return 0};T.layerOpacityChanged=function(){if(!x.isNone(this._resources)){var Y=this._drivenProperties.opacity,aa=!this._isPrimitive,ia=this._resources.stageResources.materials,na=this._resources.originalMaterialParameters;for(let ja=0;ja<ia.length;ja++){const ka=ia[ja];var ba=x.get(this.symbolLayer,"material","color"),ea=na[ja];ba=this._getCombinedOpacity(ba,{hasIntrinsicColor:aa})*ea.opacity;ea=1>ba||Y||ea.transparent;ka.setParameters({opacity:ba,transparent:ea});
this._isPrimitive&&ka.setParameters({cullFace:ea?R.CullFaceOptions.None:R.CullFaceOptions.Back})}}};T.layerElevationInfoChanged=function(Y,aa){return this.updateGraphics3DGraphicElevationInfo(Y,aa,B.needsElevationUpdates3D)};T.slicePlaneEnabledChanged=function(){if(x.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const Y of this._resources.stageResources.materials)Y.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};
T.physicalBasedRenderingChanged=function(){if(x.isNone(this._resources))return!0;const {stageResources:Y,isWosr:aa}=this._resources;for(const ia of Y.materials)this._isPrimitive?ia.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):aa||ia.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0};T.applyRendererDiff=
function(Y,aa){if(x.isNone(this._resources))return t.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:ia},lodRenderer:na,resourceBoundingBox:ba,symbolSize:ea,resourceSize:ja,pivotOffset:ka}=this._resources;for(const da in Y.diff)switch(da){case "visualVariables":if(L.updateFastSymbolUpdatesState(this._fastUpdates,aa,this._fastVisualVariableConvertOptions(ba,ea,ja,ka))){for(const ha of ia)ha.setParameters(this._fastUpdates.materialParameters);na.notifyShaderTransformationChanged()}else return t.ApplyRendererDiffResult.Recreate_Symbol;
break;default:return t.ApplyRendererDiffResult.Recreate_Symbol}return t.ApplyRendererDiffResult.Fast_Update};T.computeComplexity=function(){if(x.isNone(this._resources))return b._get(b._getPrototypeOf(X.prototype),"computeComplexity",this).call(this);var Y=this._resources.lodResources;const aa=M.geometriesFromLodLevelResources(Y.levels[0]).reduce((ba,ea)=>ba+ea.indices.get(O.VertexAttribute.POSITION).length,0)/3,ia=ba=>Array.from(ba.vertexAttributes.values()).reduce((ea,ja)=>ea+g.estimateSize(ja.data),
0)+Array.from(ba.indices.values()).reduce((ea,ja)=>ea+g.estimateSize(ja),0);var na=M.texturesFromLodResources(Y).reduce((ba,ea)=>ba+(ea.params.encoding&&"image/ktx2"===ea.params.encoding?ea.estimatedTexMemRequired:ea.estimatedTexMemRequired/4),0);Y=M.geometriesFromLodResources(Y).reduce((ba,ea)=>ba+ia(ea),0);na+=Y;na={...I.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:na};return{primitivesPerFeature:aa,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:na}};
T._hasLodRenderer=function(){return x.isSome(this._resources)};T._createAs3DShape=function(Y,aa,ia,na,ba,ea){if(!this._hasLodRenderer()||x.isNone(this._resources))return null;Y=this.getFastUpdateAttrValues(Y);const ja=null==this._fastUpdates&&this._hasPerInstanceColor()?A.mixinColorAndOpacity(ia.color,ia.opacity):null;var ka=this._context.clippingExtent;p.projectPointToVector(aa,N,this._context.elevationProvider.spatialReference);if(x.isSome(ka)&&!h.containsPoint(ka,N))return null;ka=this._requiresTerrainElevation(na);
const da=this._computeGlobalTransform(aa,na,Q,V);ia=this._computeLocalTransform(this._resources,this.symbolLayer,ia,S);const ha=this._resources.lodRenderer.instanceData,ca=ha.addInstance();this._instanceIndexToGraphicUid.set(ca,ba);ha.setLocalTransform(ca,ia,!1);ha.setGlobalTransform(ca,da);Y&&ha.setFeatureAttribute(ca,Y);ja&&ha.setColor(ca,ja);x.isSome(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&ha.setObjectAndLayerIdColor(ca,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ba,
layerUid:ea}));ba=new z(this,ca,y.perLodInstanceElevationAligner,na);ka&&(ba.alignedSampledElevation=V.sampledElevation);ba.needsElevationUpdates=B.needsElevationUpdates3D(na.mode);H.extendPointGraphicElevationContext(ba,aa,this._context.elevationProvider);return ba};T._computeGlobalTransform=function(Y,aa,ia,na){B.evaluateElevationInfoAtPoint(Y,this._context.elevationProvider,aa,this._context.renderCoordsHelper,na);N[0]=Y.x;N[1]=Y.y;N[2]=na.z;p.computeTranslationToOriginAndRotation(Y.spatialReference,
N,ia,this._context.renderCoordsHelper.spatialReference);return ia};T._computeLocalTransform=function(Y,aa,ia,na){f.identity(na);this._applyObjectRotation(ia,!1,na);this._applyObjectRotation(aa,!0,na);this._applyObjectScale(Y,ia,na);this._applyAnchor(Y,aa,na);return na};T._applyObjectScale=function(Y,aa,ia){this._fastUpdates?.requiresShaderTransformation||(Y=A.computeObjectScale(this._drivenProperties.size&&aa.size?aa.size:Y.symbolSize,Y.symbolSize,Y.resourceSize,this._context.renderCoordsHelper.unitInMeters),
1===Y[0]&&1===Y[1]&&1===Y[2]||f.scale(ia,ia,Y))};T.prepareSymbolLayerPatch=function(Y){if("partial"===Y.diff.type){var aa=Y.diff.diff;this._preparePatchTransform(Y,aa);this._preparePatchColor(Y,aa)}};T.updateGeometry=function(Y,aa){if(x.isNone(this._resources))return!0;const ia=aa&&H.placePointOnGeometry(aa);if(x.isNone(ia))return!1;aa=this.getGeometryElevationMode(aa);if(Y.elevationContext.mode!==aa)return!1;this._computeGlobalTransform(ia,Y.elevationContext,Q,V);this._requiresTerrainElevation(Y.elevationContext)&&
(Y.alignedSampledElevation=V.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(Y.instanceIndex,Q,!0);H.extendPointGraphicElevationContext(Y,ia,this._context.elevationProvider);return!0};T._preparePatchTransform=function(Y,aa){if((aa.heading||aa.tilt||aa.roll||aa.width||aa.height||aa.depth||aa.anchor||aa.anchorPosition)&&!x.isNone(this._resources)){var ia=(ma,qa,wa)=>x.unwrapOr(null!=ma&&"complete"===ma.type?ma.newValue:qa,wa),na=ia(aa.heading,this.symbolLayer.heading,0),
ba=ia(aa.tilt,this.symbolLayer.tilt,0),ea=ia(aa.roll,this.symbolLayer.roll,0),ja=ia(aa.width,this.symbolLayer.width,void 0),ka=ia(aa.height,this.symbolLayer.height,void 0),da=ia(aa.depth,this.symbolLayer.depth,void 0),ha=ia(aa.anchor,this.symbolLayer.anchor,void 0);ia=ia(aa.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete aa.heading;delete aa.tilt;delete aa.roll;delete aa.width;delete aa.height;delete aa.depth;delete aa.anchor;delete aa.anchorPosition;var ca={heading:na,tilt:ba,roll:ea,
anchor:ha,anchorPosition:ia},fa=this._resources;this.loadStatus===C.LoadStatus.LOADED&&Y.symbolLayerStatePatches.push(()=>{fa.symbolSize=k.fromArray(q.objectSymbolLayerSizeWithResourceSize(fa.resourceSize,{width:ja,height:ka,depth:da,isPrimitive:this.symbolLayer.isPrimitive}))});Y.graphics3DGraphicPatches.push((ma,qa)=>{qa=this._computeLocalTransform(fa,ca,qa,S);fa.lodRenderer.instanceData.setLocalTransform(ma.instanceIndex,qa,!0)})}};T._preparePatchColor=function(Y,aa){if(aa.material&&"partial"===
aa.material.type&&(aa=aa.material.diff,aa.color&&"complete"===aa.color.type&&null!=aa.color.newValue&&null!=aa.color.oldValue)){var ia=aa.color.newValue,na=x.isSome(ia)?w.toUnitRGBA(ia):u.ONES;delete aa.color;var ba=this._resources;x.isNone(ba)||Y.graphics3DGraphicPatches.push(ea=>{this._hasPerInstanceColor()?(ba.lodRenderer.instanceData.setColor(ea.instanceIndex,na),ea=this._setMaterialTransparencyParams({},ia)):ea=this._setMaterialTransparencyParams({externalColor:na},ia);for(const ja of ba.stageResources.materials)ja.setParameters(ea)})}};
T._requiresTerrainElevation=function(Y){return"absolute-height"!==Y.mode};T._applyObjectRotation=function(Y,aa,ia){if(!this._fastUpdates?.requiresShaderTransformation||!aa)return A.computeObjectRotation(Y.heading,Y.tilt,Y.roll,ia)};T._computeAnchor=function(Y,aa,ia){const na=k.create();switch(ia.anchor){case "center":e.copy(na,h.center(Y));e.negate(na,na);break;case "top":aa=h.center(Y);e.set(na,-aa[0],-aa[1],-Y[5]);break;case "bottom":aa=h.center(Y);e.set(na,-aa[0],-aa[1],-Y[2]);break;case "relative":aa=
h.center(Y);Y=h.size(Y);ia=(ia=ia.anchorPosition)?k.fromValues(ia.x,ia.y,ia.z):k.ZEROS;e.multiply(na,Y,ia);e.add(na,na,aa);e.negate(na,na);break;default:x.isSome(aa)?e.negate(na,aa):e.copy(na,k.ZEROS)}return na};T._applyAnchor=function(Y,aa,ia){this._fastUpdates?.requiresShaderTransformation||(Y=this._computeAnchor(Y.resourceBoundingBox,Y.pivotOffset,aa))&&f.translate(ia,ia,Y)};T._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};T._fastVisualVariableConvertOptions=
function(Y,aa,ia,na){const ba=x.isSome(Y)?k.fromArray(h.size(Y)):k.ONES;Y=x.isSome(Y)?this._computeAnchor(Y,na,this.symbolLayer):k.ZEROS;na=this._context.renderCoordsHelper.unitInMeters;ia=A.computeObjectScale(x.isSome(aa)?aa:void 0,aa,ia,na);const ea=k.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new L.ConvertOptions(ba,x.unwrapOr(aa,k.ONES),na,Y,ia,ea)};b._createClass(X,[{key:"extentPadding",get:function(){return x.isSome(this._resources)?this._resources.extentPadding:
0}},{key:"_isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return x.isSome(this._resources)?this._resources.lodRenderer:null}},{key:"skipHighSymbolLodsChanged",get:function(){return c.__classPrivateFieldGet(this,U,"f")},set:function(Y){c.__classPrivateFieldSet(this,U,Y,"f")}}]);return X}(v.Graphics3DSymbolLayer);var U=new WeakMap;const N=k.create(),S=d.create(),Q=d.create(),W=u.create(),V=new B.SampleElevationInfo;
a.Graphics3DObjectSymbolLayer=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=function(){function q(B,D,z,v){this.graphics3DSymbolLayer=B;this.instanceIndex=D;this.elevationAligner=z;this.elevationContext=v;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var y=q.prototype;y.initialize=function(){};y.setVisibility=function(B){const D=this._lodRenderer.instanceData;B!==D.getVisible(this.instanceIndex)&&D.setVisible(this.instanceIndex,B)};y.destroy=function(){null!=
this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};y.alignWithElevation=function(B,D,z){this.elevationAligner&&(l.setContextFeature(this.elevationContext.featureExpressionInfoContext,z),z=this.elevationAligner(this,this.elevationContext,B.spatialReference,(v,A)=>m.evaluateElevationInfoAtPoint(v,B,this.elevationContext,D,A),D),b.isSome(z)&&(this.alignedSampledElevation=z))};y.getCenterObjectSpace=function(B=
n.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,r);return w.transformMat4(B,this._lodRenderer.baseBoundingSphere.center,r)};y.getBoundingBoxObjectSpace=function(B=x.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,r);const D=this._lodRenderer.baseBoundingBox;x.empty(B);for(let z=0;8>z;++z)w.set(u,0===(z&1)?D[0]:D[3],0===(z&2)?D[1]:D[4],0===(z&4)?D[2]:D[5]),w.transformMat4(u,u,r),x.expandWithVec3(B,u);return B};y.computeAttachmentOrigin=
function(B){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,r);B.render.origin[0]+=r[12];B.render.origin[1]+=r[13];B.render.origin[2]+=r[14];B.render.num++};y.getProjectedBoundingBox=async function(B,D,z,v,A){A=this.getBoundingBoxObjectSpace(A);var t=h;const C=x.isPoint(A)?1:t.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,r);for(var E=0;E<C;E++){const F=t[E];u[0]=A[F[0]];u[1]=A[F[1]];u[2]=A[F[2]];w.transformMat4(u,u,r);k[3*E]=u[0];k[3*E+1]=u[1];k[3*
E+2]=u[2]}if(!B(k,0,C))return null;x.empty(A);B=null;this.calculateRelativeScreenBounds&&(B=this.calculateRelativeScreenBounds());for(t=0;t<3*C;t+=3){for(E=0;3>E;E++)A[E]=Math.min(A[E],k[t+E]),A[E+3]=Math.max(A[E+3],k[t+E]);B&&z.push({location:k.slice(t,t+3),screenSpaceBoundingRect:B})}if(D&&(x.center(A,p),"absolute-height"!==this.elevationContext.mode)){let F;z=g.demResolutionForBoundingBox(A,D.service.spatialReference,D);try{F=await D.service.queryElevation(p[0],p[1],v,z,"ground")}catch(H){}b.isSome(F)&&
x.offset(A,0,0,-this.alignedSampledElevation+F)}return A};y.addObjectState=function(B,D){B===f.Object3DState.Highlight&&(B=new d.Object3DStateID(B),this._addHighlightId(B),D.addExternal(z=>{this._removeHighlightId(z)},B))};y.removeObjectState=function(B){this._highlights.forEach(D=>B.remove(D))};y._addHighlightId=function(B){this._highlights.add(B);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};y._removeHighlightId=function(B){this._highlights.delete(B);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(q,[{key:"_lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return q}();const k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=n.create(),p=n.create(),h=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],r=c.create();return e})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../../../core/maybe","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b,c){function w(n){const x=
[];n.stageResources.geometries.forEach(m=>{x.push(new c.LodComponentResources(m,n.stageResources.textures))});return{components:x,minScreenSpaceRadius:b.unwrapOr(n.lodThreshold,0),pivotOffset:n.pivotOffset}}a.makeLodResources=function(n){return{levels:n.map(x=>w(x))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L){function R(G){const P=G.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return P?{fileType:"gltf",url:P[1],specifiedLodIndex:null!=P[4]?Number(P[4]):null}:G.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:G,specifiedLodIndex:null}:{fileType:"unknown",url:G,specifiedLodIndex:null}}function O(G,P,U,N){const S=G.model,Q=[],W=new Map,V=new Map,T=S.lods.length,X=f.empty();S.lods.forEach((Z,Y)=>{const aa=!0===N.skipHighLods&&(1<
T&&0===Y||3<T&&1===Y)||!1===N.skipHighLods&&null!=N.singleLodIndex&&Y!==N.singleLodIndex;if(!aa||0===Y){var ia=new v.ProcessedObjectResource(Z.name,Z.lodThreshold,[0,0,0]);Z.parts.forEach(na=>{const ba=aa?new I.DefaultMaterial({}):J(S,na,ia,P,U,W,V);var ea=c.isSome(ba)?ba:new I.DefaultMaterial({});const ja=na.attributes.position.count,ka=B.convertPrimitiveToTriangles(na.indices||ja,na.primitiveType);var da=d.newFloatArray(3*ja);const {typedBuffer:ha,typedBufferStride:ca}=na.attributes.position;k.transformMat4(da,
ha,na.transform,3,ca);da=[[K.VertexAttribute.POSITION,new C.Attribute(da,3,!0)]];const fa=[[K.VertexAttribute.POSITION,ka]];if(c.isSome(na.attributes.normal)){var ma=d.newFloatArray(3*ja);const {typedBuffer:xa,typedBufferStride:pa}=na.attributes.normal;w.normalFromMat4(M,na.transform);k.transformMat3(ma,xa,M,3,pa);da.push([K.VertexAttribute.NORMAL,new C.Attribute(ma,3,!0)]);fa.push([K.VertexAttribute.NORMAL,ka])}if(c.isSome(na.attributes.tangent)){ma=d.newFloatArray(4*ja);const {typedBuffer:xa,typedBufferStride:pa}=
na.attributes.tangent;w.normalFromMat4(M,na.transform);u.transformMat3(ma,xa,M,4,pa);da.push([K.VertexAttribute.TANGENT,new C.Attribute(ma,4,!0)]);fa.push([K.VertexAttribute.TANGENT,ka])}if(c.isSome(na.attributes.texCoord0)){ma=d.newFloatArray(2*ja);const {typedBuffer:xa,typedBufferStride:pa}=na.attributes.texCoord0;p.normalizeIntegerBuffer(ma,xa,2,pa);da.push([K.VertexAttribute.UV0,new C.Attribute(ma,2,!0)]);fa.push([K.VertexAttribute.UV0,ka])}c.isSome(na.attributes.color)&&(ma=new Uint8Array(4*
ja),4===na.attributes.color.elementCount?na.attributes.color instanceof e.BufferViewVec4f?u.scale(ma,na.attributes.color,255):na.attributes.color instanceof e.BufferViewVec4u8?r.copy(ma,na.attributes.color):na.attributes.color instanceof e.BufferViewVec4u16&&u.scale(ma,na.attributes.color,1/256):(ma.fill(255),na.attributes.color instanceof e.BufferViewVec3f?k.scale(ma,na.attributes.color,255,4):na.attributes.color instanceof e.BufferViewVec3u8?h.copy(ma,na.attributes.color.typedBuffer,4,na.attributes.color.typedBufferStride):
na.attributes.color instanceof e.BufferViewVec3u16&&k.scale(ma,na.attributes.color,1/256,4)),da.push([K.VertexAttribute.COLOR,new C.Attribute(ma,4,!0)]),fa.push([K.VertexAttribute.COLOR,ka]));na={geometry:new F.Geometry(ea,da,fa),vertexCount:ja};const {geometry:qa,vertexCount:wa}=na;na=qa.boundingInfo;c.isSome(na)&&0===Y&&(f.expandWithVec3(X,na.bbMin),f.expandWithVec3(X,na.bbMax));c.isSome(ba)&&(ia.stageResources.geometries.push(qa),ia.numberOfVertices+=wa)});aa||Q.push(ia)}});return{engineResources:Q,
referenceBoundingBox:X}}function J(G,P,U,N,S,Q,W){const V=P.material+(P.attributes.normal?"_normal":"")+(P.attributes.color?"_color":"")+(P.attributes.texCoord0?"_texCoord0":"")+(P.attributes.tangent?"_tangent":""),T=G.materials.get(P.material);var X=c.isSome(P.attributes.texCoord0);const Z=c.isSome(P.attributes.normal);if(c.isNone(T))return null;a:{switch(T.alphaMode){case "BLEND":var Y=E.AlphaDiscardMode.Blend;break a;case "MASK":Y=E.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:Y=
E.AlphaDiscardMode.Opaque;break a}Y=void 0}if(!Q.has(V)){if(X){var aa=(da,ha=!1)=>{if(c.isSome(da)&&!W.has(da)){const ca=G.textures.get(da);if(c.isSome(ca)){const fa=ca.data;W.set(da,new H.Texture(D.isEncodedMeshTexture(fa)?fa.data:fa,{...ca.parameters,preMultiplyAlpha:D.isEncodedMeshTexture(fa)?!1:ha,encoding:D.isEncodedMeshTexture(fa)&&c.isSome(fa.encoding)?fa.encoding:void 0}))}}};aa(T.textureColor,Y!==E.AlphaDiscardMode.Opaque);aa(T.textureNormal);aa(T.textureOcclusion);aa(T.textureEmissive);
aa(T.textureMetallicRoughness)}aa=T.color[0]**(1/L.COLOR_GAMMA);const ia=T.color[1]**(1/L.COLOR_GAMMA),na=T.color[2]**(1/L.COLOR_GAMMA),ba=T.emissiveFactor[0]**(1/L.COLOR_GAMMA),ea=T.emissiveFactor[1]**(1/L.COLOR_GAMMA),ja=T.emissiveFactor[2]**(1/L.COLOR_GAMMA),ka=c.isSome(T.textureColor)&&X?W.get(T.textureColor):null;Q.set(V,new I.DefaultMaterial({...N,transparent:Y===E.AlphaDiscardMode.Blend,customDepthTest:E.DepthTestFunction.Lequal,textureAlphaMode:Y,textureAlphaCutoff:T.alphaCutoff,diffuse:[aa,
ia,na],ambient:[aa,ia,na],opacity:T.opacity,doubleSided:T.doubleSided,doubleSidedType:"winding-order",cullFace:T.doubleSided?E.CullFaceOptions.None:E.CullFaceOptions.Back,hasVertexColors:!!P.attributes.color,hasVertexTangents:!!P.attributes.tangent,normalType:Z?t.NormalAttributeType.Attribute:t.NormalAttributeType.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:c.isSome(ka)?ka.id:void 0,colorMixMode:T.colorMixMode,normalTextureId:c.isSome(T.textureNormal)&&X?W.get(T.textureNormal).id:void 0,
textureAlphaPremultiplied:c.isSome(ka)&&!!ka.params.preMultiplyAlpha,occlusionTextureId:c.isSome(T.textureOcclusion)&&X?W.get(T.textureOcclusion).id:void 0,emissiveTextureId:c.isSome(T.textureEmissive)&&X?W.get(T.textureEmissive).id:void 0,metallicRoughnessTextureId:c.isSome(T.textureMetallicRoughness)&&X?W.get(T.textureMetallicRoughness).id:void 0,emissiveFactor:[ba,ea,ja],mrrFactors:[T.metallicFactor,T.roughnessFactor,N.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:z.getTransformMatrix(T.colorTextureTransform),
normalTextureTransformMatrix:z.getTransformMatrix(T.normalTextureTransform),occlusionTextureTransformMatrix:z.getTransformMatrix(T.occlusionTextureTransform),emissiveTextureTransformMatrix:z.getTransformMatrix(T.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:z.getTransformMatrix(T.metallicRoughnessTextureTransform),...S}))}P=Q.get(V);U.stageResources.materials.push(P);X&&(X=ia=>{c.isSome(ia)&&U.stageResources.textures.push(W.get(ia))},X(T.textureColor),X(T.textureNormal),X(T.textureOcclusion),
X(T.textureEmissive),X(T.textureMetallicRoughness));return P}const M=n.create();a.fetch=async function(G,P){G=R(b.adjustStaticAGOUrl(G));if("wosr"===G.fileType){G=await (P.cache?P.cache.loadWOSR(G.url,P):A.load(G.url,P));const {engineResources:Z,referenceBoundingBox:Y}=A.processLoadResult(G,P);return{lods:Z,referenceBoundingBox:Y,isEsriSymbolResource:!1,isWosr:!0}}const U=await (P.cache?P.cache.loadGLTF(G.url,P,!!P.usePBR):y.loadGLTF(new q.DefaultLoadingContext(P.streamDataRequester),G.url,P,P.usePBR)),
N=c.get(U.model.meta,"ESRI_proxyEllipsoid"),S=U.meta.isEsriSymbolResource&&c.isSome(N)&&U.meta.uri.includes("/RealisticTrees/");if(S&&!U.customMeta.esriTreeRendering){U.customMeta.esriTreeRendering=!0;a:for(let Z=0;Z<U.model.lods.length;++Z){var Q=U.model.lods[Z];for(var W of Q.parts){Q=W.attributes.normal;if(c.isNone(Q))break a;const Y=W.attributes.position,aa=Y.count,ia=g.create(),na=g.create(),ba=g.create(),ea=new Uint8Array(4*aa),ja=new Float64Array(3*aa),ka=x.invert(m.create(),W.transform);let da=
0,ha=0;for(let ca=0;ca<aa;ca++){Y.getVec(ca,na);Q.getVec(ca,ia);l.transformMat4(na,na,W.transform);l.subtract(ba,na,N.center);l.divide(ba,ba,N.radius);const fa=ba[2];var V=l.length(ba);V=Math.min(.45+.55*V*V,1);l.divide(ba,ba,N.radius);null!==ka&&l.transformMat4(ba,ba,ka);l.normalize(ba,ba);Z+1!==U.model.lods.length&&1<U.model.lods.length&&(-1<fa?l.lerp(ba,ba,ia,.2):l.lerp(ba,ba,ia,Math.min(-4*fa-3.8,1)));ja[da]=ba[0];ja[da+1]=ba[1];ja[da+2]=ba[2];da+=3;ea[ha]=255*V;ea[ha+1]=255*V;ea[ha+2]=255*V;
ea[ha+3]=255;ha+=4}W.attributes.normal=new e.BufferViewVec3f(ja);W.attributes.color=new e.BufferViewVec4u8(ea)}}}W=!!P.usePBR;const {engineResources:T,referenceBoundingBox:X}=O(U,U.meta.isEsriSymbolResource?{usePBR:W,isSchematic:!1,treeRendering:S,mrrFactors:[0,1,.2]}:{usePBR:W,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},{...P.materialParamsMixin,treeRendering:S},P.skipHighLods&&null==G.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:G.specifiedLodIndex});return{lods:T,
referenceBoundingBox:X,isEsriSymbolResource:U.meta.isEsriSymbolResource,isWosr:!1}};a.gltfToEngineResources=O;a.parseUrl=R;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(d,e,k){if(d.count!==e.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var u=d.count,p=k[0],h=k[1],r=k[2],q=k[3],y=k[4],B=k[5],D=k[6],z=k[7],v=
k[8],A=k[9],t=k[10],C=k[11],E=k[12],F=k[13],H=k[14];k=k[15];var K=d.typedBuffer;d=d.typedBufferStride;var I=e.typedBuffer;e=e.typedBufferStride;for(let R=0;R<u;R++){const O=R*d;var L=R*e;const J=I[L],M=I[L+1],G=I[L+2];L=I[L+3];K[O]=p*J+y*M+v*G+E*L;K[O+1]=h*J+B*M+A*G+F*L;K[O+2]=r*J+D*M+t*G+H*L;K[O+3]=q*J+z*M+C*G+k*L}}}function w(d,e,k){n(d.typedBuffer,e.typedBuffer,k,d.typedBufferStride,e.typedBufferStride)}function n(d,e,k,u=4,p=u){if(d.length/u!==e.length/p)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var h=d.length/u,r=k[0],q=k[1],y=k[2],B=k[3],D=k[4],z=k[5],v=k[6],A=k[7];k=k[8];var t=0,C=0;for(let E=0;E<h;E++){const F=e[t],H=e[t+1],K=e[t+2],I=e[t+3];d[C]=r*F+B*H+v*K;d[C+1]=q*F+D*H+A*K;d[C+2]=y*F+z*H+k*K;d[C+3]=I;t+=p;C+=u}}}function x(d,e){const k=Math.min(d.count,e.count),u=d.typedBuffer;d=d.typedBufferStride;const p=e.typedBuffer;e=e.typedBufferStride;for(let q=0;q<k;q++){const y=q*d;var h=q*e;const B=p[h],D=p[h+1];h=p[h+2];var r=B*B+D*D+h*h;0<r&&(r=1/Math.sqrt(r),u[y]=r*B,u[y+1]=r*D,
u[y+2]=r*h)}}function m(d,e,k){l(d.typedBuffer,e,k,d.typedBufferStride)}function l(d,e,k,u=4){const p=Math.min(d.length/u,e.count),h=e.typedBuffer;e=e.typedBufferStride;let r=0,q=0;for(let y=0;y<p;y++)d[q]=k*h[r],d[q+1]=k*h[r+1],d[q+2]=k*h[r+2],d[q+3]=k*h[r+3],r+=e,q+=u}function g(d,e,k){const u=Math.min(d.count,e.count),p=d.typedBuffer;d=d.typedBufferStride;const h=e.typedBuffer;e=e.typedBufferStride;for(let r=0;r<u;r++){const q=r*d,y=r*e;p[q]=h[y]>>k;p[q+1]=h[y+1]>>k;p[q+2]=h[y+2]>>k;p[q+3]=h[y+
3]>>k}}const f=Object.freeze(Object.defineProperty({__proto__:null,normalize:x,scale:l,scaleView:m,shiftRight:g,transformMat3:n,transformMat3View:w,transformMat4:c},Symbol.toStringTag,{value:"Module"}));a.normalize=x;a.scale=l;a.scaleView=m;a.shiftRight=g;a.transformMat3=n;a.transformMat3View=w;a.transformMat4=c;a.vec4=f})},"esri/chunks/vec22":function(){define(["exports","../core/typedArrayUtil"],function(a,b){function c(m,l){w(m.typedBuffer,l.typedBuffer,m.typedBufferStride,l.typedBufferStride)}
function w(m,l,g=2,f=g){const d=l.length/2;let e=0,k=0;if(b.isArray(l)||b.isFloat(l))for(var u=0;u<d;++u)m[e]=l[k],m[e+1]=l[k+1],e+=g,k+=f;else if(u=b.maximumValue(l),b.isSigned(l))for(var p=0;p<d;++p)m[e]=Math.max(l[k]/u,-1),m[e+1]=Math.max(l[k+1]/u,-1),e+=g,k+=f;else for(p=0;p<d;++p)m[e]=l[k]/u,m[e+1]=l[k+1]/u,e+=g,k+=f}function n(m,l,g,f){const d=m.typedBuffer,e=m.typedBufferStride;m=f?.count??m.count;f=(f?.dstIndex??0)*e;for(let k=0;k<m;++k)d[f]=l,d[f+1]=g,f+=e}const x=Object.freeze(Object.defineProperty({__proto__:null,
fill:n,normalizeIntegerBuffer:w,normalizeIntegerBufferView:c},Symbol.toStringTag,{value:"Module"}));a.fill=n;a.normalizeIntegerBuffer=w;a.normalizeIntegerBufferView=c;a.vec2=x})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(x,m){c(x.typedBuffer,m.typedBuffer,x.typedBufferStride,m.typedBufferStride)}function c(x,m,l=3,g=l){const f=m.length/g;let d=0,e=0;for(let k=0;k<f;++k)x[d]=m[e],x[d+1]=m[e+1],x[d+2]=m[e+2],d+=l,e+=g}function w(x,m,l,g,f){const d=x.typedBuffer,e=x.typedBufferStride;
x=f?.count??x.count;f=(f?.dstIndex??0)*e;for(let k=0;k<x;++k)d[f]=m,d[f+1]=l,d[f+2]=g,f+=e}const n=Object.freeze(Object.defineProperty({__proto__:null,copy:c,copyView:b,fill:w},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.copyView=b;a.fill=w;a.vec3=n})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(x,m){c(x.typedBuffer,m,x.typedBufferStride)}function c(x,m,l=4){const g=m.typedBuffer,f=m.typedBufferStride;m=m.count;let d=0,e=0;for(let k=0;k<m;++k)x[d]=g[e],x[d+1]=g[e+
1],x[d+2]=g[e+2],x[d+3]=g[e+3],d+=l,e+=f}function w(x,m,l,g,f,d){const e=x.typedBuffer,k=x.typedBufferStride;x=d?.count??x.count;d=(d?.dstIndex??0)*k;for(let u=0;u<x;++u)e[d]=m,e[d+1]=l,e[d+2]=g,e[d+3]=f,d+=k}const n=Object.freeze(Object.defineProperty({__proto__:null,copy:c,copyView:b,fill:w},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.copyView=b;a.fill=w;a.vec4=n})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,c,w,n,x,m,l){let g=function(){function d(k){this._streamDataRequester=k}var e=d.prototype;e.loadJSON=async function(k,u){return this._load("json",k,u)};e.loadBinary=async function(k,u){return l.isDataProtocol(k)?(m.throwIfAborted(u),l.dataToArrayBuffer(k)):this._load("binary",k,u)};e.loadImage=async function(k,u){return this._load("image",k,u)};e._load=async function(k,u,p){if(x.isNone(this._streamDataRequester))return(await c(u,{responseType:f[k]})).data;k=await w.result(this._streamDataRequester.request(u,
k,p));if(!0===k.ok)return k.value;m.throwIfAbortError(k.error);throw new n("",`Request for resource failed: ${k.error}`);};return b._createClass(d)}();const f={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,w,
n,x,m){function l(k){let u=null;k.json.nodes.forEach(p=>{p=p.extras;c.isSome(p)&&(p.ESRI_proxyEllipsoid||p.ESRI_lod)&&(u=p)});return u}async function g(k,u){async function p(B,D){const z=h.nodes[B];B=k.getNodeTransform(B);null!=z.weights&&b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=z.mesh){const v=h.meshes[z.mesh];for(const A of v.primitives)y.push(u(A,B,D,v.name))}for(const v of z.children||[])y.push(p(v,D))}const h=k.json;var r=h.scenes[h.scene||
0].nodes;const q=1<r.length,y=[];for(const B of r)r=h.nodes[B],y.push(p(B,0)),r.extensions&&r.extensions.MSFT_lod&&Array.isArray(r.extensions.MSFT_lod.ids)&&!q&&r.extensions.MSFT_lod.ids.forEach((D,z)=>p(D,z+1));await Promise.all(y)}function f(k,u,p){const h=q=>{const y=`${p}_tex_${q&&q.id}${q&&q.name?"_"+q.name:""}`;q&&!k.textures.has(y)&&(q=n.makeTextureSource(q.data,{wrap:{s:q.wrapS,t:q.wrapT},mipmap:e.includes(q.minFilter),noUnpackFlip:!0}),k.textures.set(y,q));return y},r=`${p}_mat_${u.id}_${u.name}`;
k.materials.has(r)||(u=n.makeMaterialParameters({color:[u.color[0],u.color[1],u.color[2]],opacity:u.color[3],alphaMode:u.alphaMode,alphaCutoff:u.alphaCutoff,doubleSided:u.doubleSided,colorMixMode:u.ESRI_externalColorMixMode,textureColor:u.colorTexture?h(u.colorTexture):void 0,textureNormal:u.normalTexture?h(u.normalTexture):void 0,textureOcclusion:u.occlusionTexture?h(u.occlusionTexture):void 0,textureEmissive:u.emissiveTexture?h(u.emissiveTexture):void 0,textureMetallicRoughness:u.metallicRoughnessTexture?
h(u.metallicRoughnessTexture):void 0,emissiveFactor:[u.emissiveFactor[0],u.emissiveFactor[1],u.emissiveFactor[2]],colorTextureTransform:u.colorTextureTransform,normalTextureTransform:u.normalTextureTransform,occlusionTextureTransform:u.occlusionTextureTransform,emissiveTextureTransform:u.emissiveTextureTransform,metallicRoughnessTextureTransform:u.metallicRoughnessTextureTransform,metallicFactor:u.metallicFactor,roughnessFactor:u.roughnessFactor}),k.materials.set(r,u));return r}let d=0;const e=[m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,
m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST];a.loadGLTF=async function(k,u,p={},h=!0){const r=await x.GLTFResource.load(k,u,p),q=`gltf_${d++}`,y={lods:[],materials:new Map,textures:new Map,meta:l(r)};k=!(!r.json.asset.extras||"symbolResource"!==r.json.asset.extras.ESRI_type);const B=new Map;await g(r,async(z,v,A,t)=>{const C=B.get(A)??0;B.set(A,C+1);var E=void 0!==z.mode?z.mode:m.PrimitiveType.TRIANGLES,F=E===m.PrimitiveType.TRIANGLES||E===m.PrimitiveType.TRIANGLE_STRIP||E===m.PrimitiveType.TRIANGLE_FAN?
E:null;if(c.isNone(F))b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+m.PrimitiveType[E]+"). Skipping primitive.");else if(r.hasPositions(z)){E=r.getPositionData(z,p);var H=r.getMaterial(z,p,h),K=r.hasNormals(z)?r.getNormalData(z,p):null,I=r.hasTangents(z)?r.getTangentData(z,p):null,L=r.hasTextureCoordinates(z)?r.getTextureCoordinates(z,p):null,R=r.hasVertexColors(z)?r.getVertexColors(z,p):null;z=r.getIndexData(z,p);v={transform:w.clone(v),attributes:{position:await E,
normal:K?await K:null,texCoord0:L?await L:null,color:R?await R:null,tangent:I?await I:null},indices:await z,primitiveType:F,material:f(y,await H,q)};F=null;c.isSome(y.meta)&&c.isSome(y.meta.ESRI_lod)&&"screenSpaceRadius"===y.meta.ESRI_lod.metric&&(F=y.meta.ESRI_lod.thresholds[A]);y.lods[A]=y.lods[A]||{parts:[],name:t,lodThreshold:F};y.lods[A].parts[C]=v}else b.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});for(var D of y.lods)D.parts=D.parts.filter(z=>
!!z);D=await r.getLoadedBuffersSize();return{model:y,meta:{isEsriSymbolResource:k,uri:r.uri},customMeta:{},size:D}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,
textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,w={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...w.wrap},noUnpackFlip:!0,mipmap:!1,...w}}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ../../../../core/has ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){function z(F){switch(F.componentType){case D.DataType.BYTE:return new k.BufferViewVec2i8(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case D.DataType.UNSIGNED_BYTE:return new k.BufferViewVec2u8(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case D.DataType.SHORT:return new k.BufferViewVec2i16(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case D.DataType.UNSIGNED_SHORT:return new k.BufferViewVec2u16(F.raw,
F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case D.DataType.UNSIGNED_INT:return new k.BufferViewVec2u32(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case D.DataType.FLOAT:return new k.BufferViewVec2f(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount)}}p=function(){function F(K,I,L,R){this._context=K;this.uri=I;this.json=L;this._glbBuffer=R;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu"];this._baseUri=y.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==L.scenes)throw new c("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==L.meshes)throw new c("gltf-loader-unsupported-feature","Meshes must be defined");if(null==L.nodes)throw new c("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}F.load=async function(K,I,L){if(m.isDataProtocol(I)){var R=m.dataComponents(I);if(R&&"model/gltf-binary"!==R.mediaType)try{const O=JSON.parse(R.isBase64?atob(R.data):R.data);return new F(K,I,O)}catch{}R=m.dataToArrayBuffer(I);if(F._isGLBData(R))return this._fromGLBData(K,I,R)}if(I.endsWith(".gltf"))return L=await K.loadJSON(I,L),new F(K,I,L);R=await K.loadBinary(I,L);if(F._isGLBData(R))return this._fromGLBData(K,I,R);L=await K.loadJSON(I,L);return new F(K,I,L)};F._isGLBData=
function(K){if(null==K)return!1;K=new h.BinaryStreamReader(K);return 4<=K.remainingBytes()&&1179937895===K.readUint32()};F._fromGLBData=async function(K,I,L){L=await F._parseGLBData(L);return new F(K,I,L.json,L.binaryData)};F._parseGLBData=async function(K){const I=new h.BinaryStreamReader(K);if(12>I.remainingBytes())throw new c("gltf-loader-error","GLB binary data is insufficiently large.");var L=I.readUint32(),R=I.readUint32();const O=I.readUint32();if(1179937895!==L)throw new c("gltf-loader-error",
"Magic first 4 bytes do not fit to expected GLB value.");if(K.byteLength<O)throw new c("gltf-loader-error","GLB binary data is smaller than header specifies.");if(2!==R)throw new c("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");K=0;let J,M;for(;8<=I.remainingBytes();){L=I.readUint32();R=I.readUint32();if(0===K){if(1313821514!==R)throw new c("gltf-loader-error","First GLB chunk must be JSON.");if(0>L)throw new c("gltf-loader-error",
"No JSON data found.");J=await B.jsonFromBinaryData(I.readUint8Array(L))}else if(1===K){if(5130562!==R)throw new c("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");M=I.readUint8Array(L)}else w.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");K+=1}if(!J)throw new c("gltf-loader-error","No GLB JSON chunk detected.");return{json:J,binaryData:M}};var H=F.prototype;H.getBuffer=async function(K,I){const L=this.json.buffers[K];
if(null==L.uri){if(null==this._glbBuffer)throw new c("gltf-loader-error","GLB buffer not present");return this._glbBuffer}K=await this._getBufferLoader(K,I);if(K.byteLength!==L.byteLength)throw new c("gltf-loader-error","Buffer byte lengths should match.");return K};H._getBufferLoader=async function(K,I){const L=this._bufferLoaders.get(K);if(L)return L;I=this._context.loadBinary(this._resolveUri(this.json.buffers[K].uri),I).then(R=>new Uint8Array(R));this._bufferLoaders.set(K,I);return I};H.getAccessor=
async function(K,I){if(!this.json.accessors)throw new c("gltf-loader-unsupported-feature","Accessors missing.");K=this.json.accessors[K];if(null==K?.bufferView)throw new c("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(K.type in[r.AttributeType.MAT2,r.AttributeType.MAT3,r.AttributeType.MAT4])throw new c("gltf-loader-unsupported-feature",`AttributeType ${K.type} is not supported`);const L=this.json.bufferViews[K.bufferView];I=await this.getBuffer(L.buffer,I);const R=
C[K.type],O=E[K.componentType],J=R*O,M=L.byteStride||J;return{raw:I.buffer,byteStride:M,byteOffset:I.byteOffset+(L.byteOffset||0)+(K.byteOffset||0),entryCount:K.count,isDenselyPacked:M===J,componentCount:R,componentByteSize:O,componentType:K.componentType,min:K.min,max:K.max,normalized:!!K.normalized}};H.getIndexData=async function(K,I){if(null!=K.indices)if(K=await this.getAccessor(K.indices,I),K.isDenselyPacked)switch(K.componentType){case D.DataType.UNSIGNED_BYTE:return new Uint8Array(K.raw,K.byteOffset,
K.entryCount);case D.DataType.UNSIGNED_SHORT:return new Uint16Array(K.raw,K.byteOffset,K.entryCount);case D.DataType.UNSIGNED_INT:return new Uint32Array(K.raw,K.byteOffset,K.entryCount)}else switch(K.componentType){case D.DataType.UNSIGNED_BYTE:return u.makeDense(this._wrapAccessor(k.BufferViewUint8,K));case D.DataType.UNSIGNED_SHORT:return u.makeDense(this._wrapAccessor(k.BufferViewUint16,K));case D.DataType.UNSIGNED_INT:return u.makeDense(this._wrapAccessor(k.BufferViewUint32,K))}};H.getPositionData=
async function(K,I){if(null==K.attributes.POSITION)throw new c("gltf-loader-unsupported-feature","No POSITION vertex data found.");K=await this.getAccessor(K.attributes.POSITION,I);if(K.componentType!==D.DataType.FLOAT)throw new c("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+D.DataType[K.componentType]);if(3!==K.componentCount)throw new c("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+K.componentCount.toFixed());
return this._wrapAccessor(k.BufferViewVec3f,K)};H.getNormalData=async function(K,I){if(null==K.attributes.NORMAL)throw new c("gltf-loader-error","No NORMAL vertex data found.");K=await this.getAccessor(K.attributes.NORMAL,I);if(K.componentType!==D.DataType.FLOAT)throw new c("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+D.DataType[K.componentType]);if(3!==K.componentCount)throw new c("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+
K.componentCount.toFixed());return this._wrapAccessor(k.BufferViewVec3f,K)};H.getTangentData=async function(K,I){if(null==K.attributes.TANGENT)throw new c("gltf-loader-error","No TANGENT vertex data found.");K=await this.getAccessor(K.attributes.TANGENT,I);if(K.componentType!==D.DataType.FLOAT)throw new c("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+D.DataType[K.componentType]);if(4!==K.componentCount)throw new c("gltf-loader-unsupported-feature",
"TANGENT vertex attribute must have 4 components, but found "+K.componentCount.toFixed());return new k.BufferViewVec4f(K.raw,K.byteOffset,K.byteStride,K.byteOffset+K.byteStride*K.entryCount)};H.getTextureCoordinates=async function(K,I){if(null==K.attributes.TEXCOORD_0)throw new c("gltf-loader-error","No TEXCOORD_0 vertex data found.");K=await this.getAccessor(K.attributes.TEXCOORD_0,I);if(2!==K.componentCount)throw new c("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+
K.componentCount.toFixed());if(K.componentType===D.DataType.FLOAT)return this._wrapAccessor(k.BufferViewVec2f,K);if(!K.normalized)throw new c("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return z(K)};H.getVertexColors=async function(K,I){if(null==K.attributes.COLOR_0)throw new c("gltf-loader-error","No COLOR_0 vertex data found.");K=await this.getAccessor(K.attributes.COLOR_0,I);if(4!==K.componentCount&&3!==K.componentCount)throw new c("gltf-loader-unsupported-feature",
"COLOR_0 attribute must have 3 or 4 components, but found "+K.componentCount.toFixed());if(4===K.componentCount){if(K.componentType===D.DataType.FLOAT)return this._wrapAccessor(k.BufferViewVec4f,K);if(K.componentType===D.DataType.UNSIGNED_BYTE)return this._wrapAccessor(k.BufferViewVec4u8,K);if(K.componentType===D.DataType.UNSIGNED_SHORT)return this._wrapAccessor(k.BufferViewVec4u16,K)}else if(3===K.componentCount){if(K.componentType===D.DataType.FLOAT)return this._wrapAccessor(k.BufferViewVec3f,K);
if(K.componentType===D.DataType.UNSIGNED_BYTE)return this._wrapAccessor(k.BufferViewVec3u8,K);if(K.componentType===D.DataType.UNSIGNED_SHORT)return this._wrapAccessor(k.BufferViewVec3u16,K)}throw new c("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+D.DataType[K.componentType]);};H.hasPositions=function(K){return void 0!==K.attributes.POSITION};H.hasNormals=function(K){return void 0!==K.attributes.NORMAL};H.hasVertexColors=function(K){return void 0!==K.attributes.COLOR_0};
H.hasTextureCoordinates=function(K){return void 0!==K.attributes.TEXCOORD_0};H.hasTangents=function(K){return void 0!==K.attributes.TANGENT};H.getMaterial=async function(K,I,L){var R=K.material?this._materialCache.get(K.material):void 0;if(!R){R=null!=K.material?q.material(this.json.materials[K.material]):q.material();const O=R.pbrMetallicRoughness,J=this.hasVertexColors(K),M=this.getTexture(O.baseColorTexture,I),G=this.getTexture(R.normalTexture,I),P=L?this.getTexture(R.occlusionTexture,I):void 0,
U=L?this.getTexture(R.emissiveTexture,I):void 0;I=L?this.getTexture(O.metallicRoughnessTexture,I):void 0;K=null!=K.material?K.material:-1;R={alphaMode:R.alphaMode,alphaCutoff:R.alphaCutoff,color:O.baseColorFactor,doubleSided:!!R.doubleSided,colorTexture:await M,normalTexture:await G,name:R.name,id:K,occlusionTexture:await P,emissiveTexture:await U,emissiveFactor:R.emissiveFactor,metallicFactor:O.metallicFactor,roughnessFactor:O.roughnessFactor,metallicRoughnessTexture:await I,hasVertexColors:J,ESRI_externalColorMixMode:R.extras.ESRI_externalColorMixMode,
colorTextureTransform:O?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:R.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:R.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:R.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:O?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return R};H.getTexture=async function(K,I){if(K){if(0!==(K.texCoord||0))throw new c("gltf-loader-unsupported-feature",
"Only TEXCOORD with index 0 is supported.");var L=K.index;K=this.json.textures[L];var R=q.textureSampler(null!=K.sampler?this.json.samplers[K.sampler]:{}),O=this._getTextureSourceId(K),J=this.json.images[O],M=await this._loadTextureImageData(L,K,I);return n.getOrCreateMapValue(this._textureCache,L,()=>{const G=U=>33071===U||33648===U||10497===U,P=U=>{throw new c("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${U}`);};return{data:M,wrapS:G(R.wrapS)?R.wrapS:P(R.wrapS),wrapT:G(R.wrapT)?R.wrapT:
P(R.wrapT),minFilter:R.minFilter,name:J.name,id:L}})}};H.getNodeTransform=function(K){if(void 0===K)return v;var I=this._nodeTransformCache.get(K);if(!I){I=this.getNodeTransform(this._getNodeParent(K));const L=this.json.nodes[K];L.matrix?I=g.multiply(f.create(),I,L.matrix):L.translation||L.rotation||L.scale?(I=f.clone(I),L.translation&&g.translate(I,I,L.translation),L.rotation&&(t[3]=d.getAxisAngle(t,L.rotation),g.rotate(I,I,t[3],t)),L.scale&&g.scale(I,I,L.scale)):I=f.clone(I);this._nodeTransformCache.set(K,
I)}return I};H._wrapAccessor=function(K,I){return new K(I.raw,I.byteOffset,I.byteStride,I.byteOffset+I.byteStride*(I.entryCount-1)+I.componentByteSize*I.componentCount)};H._resolveUri=function(K){return m.makeAbsolute(K,this._baseUri)};H._getNodeParent=function(K){return this._nodeParentMap.get(K)};H._checkVersionSupported=function(){const K=l.Version.parse(this.json.asset.version,"glTF");A.validate(K)};H._checkRequiredExtensionsSupported=function(){const K=this.json;if(K.extensionsRequired&&!K.extensionsRequired.every(I=>
this._supportedExtensions.includes(I)))throw new c("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+K.extensionsRequired.join(", "));};H._computeNodeParents=function(){this.json.nodes.forEach((K,I)=>{K.children&&K.children.forEach(L=>{this._nodeParentMap.set(L,I)})})};H._loadTextureImageData=async function(K,I,L){const R=this._textureLoaders.get(K);if(R)return R;I=this._createTextureLoader(I,L);this._textureLoaders.set(K,I);return I};
H._getTextureSourceId=function(K){if(void 0!==K.extensions&&null!==K.extensions.KHR_texture_basisu)return K.extensions.KHR_texture_basisu.source;if(null!==K.source)return K.source;throw new c("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");};H._createTextureLoader=async function(K,I){K=this._getTextureSourceId(K);K=this.json.images[K];if(K.uri)return K.uri.endsWith(".ktx2")?(I=await this._context.loadBinary(this._resolveUri(K.uri),
I),new B.EncodedMeshTexture(new Uint8Array(I))):this._context.loadImage(this._resolveUri(K.uri),I);if(null==K.bufferView)throw new c("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==K.mimeType)throw new c("gltf-loader-unsupported-feature","Image mimeType must be defined.");const L=this.json.bufferViews[K.bufferView];I=await this.getBuffer(L.buffer,I);if(null!=L.byteStride)throw new c("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return B.imageFromBinaryData(new Uint8Array(I.buffer,
I.byteOffset+(L.byteOffset||0),L.byteLength),K.mimeType)};H.getLoadedBuffersSize=async function(){if(this._glbBuffer)return this._glbBuffer.byteLength;const K=await x.eachAlwaysValues(Array.from(this._bufferLoaders.values())),I=await x.eachAlwaysValues(Array.from(this._textureLoaders.values()));return K.reduce((L,R)=>L+(R?.byteLength??0),0)+I.reduce((L,R)=>L+(R?B.isEncodedMeshTexture(R)?R.data.byteLength:R.width*R.height*4:0),0)};return b._createClass(F)}();const v=g.fromXRotation(f.create(),Math.PI/
2),A=new l.Version(2,0,"glTF"),t=e.create(),C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},E={[D.DataType.BYTE]:1,[D.DataType.UNSIGNED_BYTE]:1,[D.DataType.SHORT]:2,[D.DataType.UNSIGNED_SHORT]:2,[D.DataType.FLOAT]:4,[D.DataType.UNSIGNED_INT]:4};a.GLTFResource=p;a.TRANSFORM_GLTF_TO_ENGINE=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","./Error"],function(a,b,c){let w=function(){function n(m,l,g=""){this.major=
m;this.minor=l;this._context=g}var x=n.prototype;x.lessThan=function(m,l){return this.major<m||m===this.major&&this.minor<l};x.since=function(m,l){return!this.lessThan(m,l)};x.validate=function(m){if(this.major!==m.major)throw new c((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:m});};x.clone=function(){return new n(this.major,this.minor,this._context)};
n.parse=function(m,l=""){const [g,f]=m.split(".");var d=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(d))throw new c((l&&l+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:m});if(!f||!f.match||!f.match(d))throw new c((l&&l+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:m});m=parseInt(g,10);d=parseInt(f,10);return new n(m,d,l)};return b._createClass(n)}();a.Version=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/scalar":function(){define(["exports"],function(a){function b(w,n){const x=w.count;n||(n=new w.TypedArrayConstructor(x));for(let m=0;m<x;m++)n[m]=w.get(m);return n}const c=Object.freeze(Object.defineProperty({__proto__:null,makeDense:b},Symbol.toStringTag,{value:"Module"}));a.makeDense=b;a.scalar=c})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._data=x;this._offset4=
0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}var n=w.prototype;n.readUint32=function(){const x=this._offset4;this._offset4+=1;return this._dataUint32[x]};n.readUint8Array=function(x){const m=4*this._offset4;this._offset4+=x/4;return new Uint8Array(this._data,m,x)};n.remainingBytes=function(){return this._data.byteLength-4*this._offset4};return b._createClass(w)}();a.BinaryStreamReader=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],
function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports",
"../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const w={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},n={pbrMetallicRoughness:w,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},x={ESRI_externalColorMixMode:"tint"},m={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};a.material=(l={})=>{const g={...w,...l.pbrMetallicRoughness};var f=
{...x,...l.extras};switch(f.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(f.ESRI_externalColorMixMode),f.ESRI_externalColorMixMode="tint"}return{...n,...l,pbrMetallicRoughness:g,extras:f}};a.textureSampler=l=>({...m,...l});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let c,w;b.replace(/^(.*\/)?([^/]*)$/,(n,x,
m)=>{c=x||"";w=m||"";return""});return{dirPart:c,filePart:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/Indices","../../../webgl/enums"],function(a,b,c,w){a.convertPrimitiveToTriangles=function(n,x){switch(x){case w.PrimitiveType.TRIANGLES:return n="number"===typeof n?c.getContinuousIndexArray(n):b.isUint8Array(n)?new Uint16Array(n):n,n;case w.PrimitiveType.TRIANGLE_STRIP:x=
"number"===typeof n?n:n.length;if(3>x)n=[];else{x-=2;var m=c.newIndexArray(3*x);if("number"===typeof n){n=0;for(var l=0;l<x;l+=1)0===l%2?(m[n++]=l,m[n++]=l+1):(m[n++]=l+1,m[n++]=l),m[n++]=l+2}else{l=0;for(var g=0;g<x;g+=1)0===g%2?(m[l++]=n[g],m[l++]=n[g+1]):(m[l++]=n[g+1],m[l++]=n[g]),m[l++]=n[g+2]}n=m}return n;case w.PrimitiveType.TRIANGLE_FAN:x="number"===typeof n?n:n.length;if(3>x)n=new Uint16Array(0);else{x-=2;m=65536>=x?new Uint16Array(3*x):new Uint32Array(3*x);if("number"===typeof n)for(n=0,
l=0;l<x;++l)m[n++]=0,m[n++]=l+1,m[n++]=l+2;else{l=n[0];g=n[1];var f=0;for(let d=0;d<x;++d){const e=n[d+2];m[f++]=l;m[f++]=g;g=m[f++]=e}}n=m}return n}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(){this.geometries=[];this.materials=[];this.textures=[]});b=b._createClass(function(w,n,x){this.name=w;this.lodThreshold=
n;this.pivotOffset=x;this.stageResources=new c;this.numberOfVertices=0});a.ProcessedObjectResource=b;a.ProcessedObjectStageResources=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){async function B(F,H){const K=m.isSome(H)&&H.streamDataRequester;if(K)return D(F,K,H);F=await c.result(b(F,m.unwrap(H)));if(!0===F.ok)return F.value.data;g.throwIfAbortError(F.error);z(F.error)}async function D(F,H,K){F=await c.result(H.request(F,"json",K));if(!0===F.ok)return F.value;g.throwIfAbortError(F.error);z(F.error.details.url)}function z(F){throw new n("",`Request for object resource failed: ${F}`);}function v(F){const H=e.empty();F.forEach(K=>
{K=K.boundingInfo;m.isSome(K)&&(e.expandWithVec3(H,K.bbMin),e.expandWithVec3(H,K.bbMax))});return H}async function A(F,H){const K=[];for(const R in F){var I=F[R],L=I.images[0].data;if(!L){C.warn("Externally referenced texture data is not yet supported");continue}L=I.encoding+";base64,"+L;const O="/textureDefinitions/"+R,J="rgba"===I.channels?I.alphaChannelUsage||"transparency":"none",M={noUnpackFlip:!0,wrap:{s:y.TextureWrapMode.REPEAT,t:y.TextureWrapMode.REPEAT},preMultiplyAlpha:t(J)!==p.AlphaDiscardMode.Opaque};
I=m.isSome(H)&&H.disableTextures?Promise.resolve(null):k.requestImage(L,H);K.push(I.then(G=>({refId:O,image:G,params:M,alphaChannelUsage:J})))}F=await Promise.all(K);H={};for(const R of F)H[R.refId]=R;return H}function t(F){switch(F){case "mask":return p.AlphaDiscardMode.Mask;case "maskAndTransparency":return p.AlphaDiscardMode.MaskBlend;case "none":return p.AlphaDiscardMode.Opaque;case "transparency":return p.AlphaDiscardMode.Blend;default:return p.AlphaDiscardMode.Blend}}const C=x.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
E=new f.Version(1,2,"wosr");a.createTextureResources=A;a.load=async function(F,H){F=await B(F,H);H=await A(F.textureDefinitions??{},H);let K=0;for(const I in H)if(H.hasOwnProperty(I)){const L=H[I];K+=L?.image?L.image.width*L.image.height*4:0}return{resource:F,textures:H,size:K+w.estimateNestedObjectSize(F)}};a.processLoadResult=function(F,H){const K=[],I=[],L=[],R=new l.NestedMap,O=F.resource;var J=f.Version.parse(O.version||"1.0","wosr");E.validate(J);J=O.model.name;const M=O.model.geometries,G=
O.materialDefinitions??{};F=F.textures;let P=0;const U=new Map;for(let Y=0;Y<M.length;Y++){var N=M[Y],S=N,Q=S.params,W=Q.topology,V=!0;Q.vertexAttributes||(C.warn("Geometry must specify vertex attributes"),V=!1);switch(Q.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:W=Q.faces;if(!W)C.warn("Indexed geometries must specify faces"),V=!1;else if(Q.vertexAttributes)for(const aa in Q.vertexAttributes)(Q=W[aa])&&Q.values?(null!=Q.valueType&&"UInt32"!==Q.valueType&&(C.warn(`Unsupported indexed geometry indices type '${Q.valueType}', only UInt32 is currently supported`),
V=!1),null!=Q.valuesPerElement&&1!==Q.valuesPerElement&&(C.warn(`Unsupported indexed geometry values per element '${Q.valuesPerElement}', only 1 is currently supported`),V=!1)):(C.warn(`Indexed geometry does not specify face indices for '${aa}' attribute`),V=!1);break;default:C.warn(`Unsupported topology '${W}'`),V=!1}S.params.material||(C.warn("Geometry requires material"),V=!1);S=S.params.vertexAttributes;for(const aa in S)S[aa].values||(C.warn("Geometries with externally defined attributes are not yet supported"),
V=!1);if(V){V=N.params;W=V.material;Q=V.texture;S=N.params.vertexAttributes;V=[];for(const aa in S){var T=S[aa];V.push([aa,new u.Attribute(T.values,T.valuesPerElement,!0)])}S=[];if("PerAttributeArray"!==N.params.topology){N=N.params.faces;for(const aa in N)S.push([aa,N[aa].values])}N=Q;if((Q=F&&F[N])&&!U.has(N)){const {image:aa,params:ia}=Q;T=new r.Texture(aa,ia);I.push(T);U.set(N,T)}T=(T=U.get(N))?T.id:void 0;var X=R.get(W,N);if(m.isNone(X)){X=W.substring(W.lastIndexOf("/")+1);X=G[X].params;1===
X.transparency&&(X.transparency=0);var Z=Q&&Q.alphaChannelUsage;Z=0<X.transparency||"transparency"===Z||"maskAndTransparency"===Z;const aa=Q?t(Q.alphaChannelUsage):void 0;Q={ambient:d.fromArray(X.diffuse),diffuse:d.fromArray(X.diffuse),opacity:1-(X.transparency||0),transparent:Z,textureAlphaMode:aa,textureAlphaCutoff:.33,textureId:T,initTextureTransparent:!0,doubleSided:!0,cullFace:p.CullFaceOptions.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:Q?!!Q.params.preMultiplyAlpha:
!1};m.isSome(H)&&H.materialParamsMixin&&Object.assign(Q,H.materialParamsMixin);X=new q.DefaultMaterial(Q);R.set(W,N,X)}L.push(X);V=new h.Geometry(X,V,S);P+=S.position?S.position.length:0;K.push(V)}}return{engineResources:[{name:J,stageResources:{textures:I,materials:L,geometries:K},pivotOffset:O.model.pivotOffset,numberOfVertices:P,lodThreshold:null}],referenceBoundingBox:v(K)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M){function G(Z,Y,aa){const ia=Z.allocateHead();Z=Z.view;R.encodeDoubleVec3(Y.modelOrigin,aa,Z.modelOriginHi,Z.modelOriginLo,ia);Z.model.copyFrom(ia,Y.model,aa);Z.modelNormal.copyFrom(ia,Y.modelNormal,aa);Y.color&&Z.color&&Z.color.copyFrom(ia,Y.color,aa);Y.objectAndLayerIdColor&&Z.objectAndLayerIdColor&&Z.objectAndLayerIdColor.copyFrom(ia,Y.objectAndLayerIdColor,aa);Y.featureAttribute&&Z.featureAttribute&&Z.featureAttribute.copyFrom(ia,
Y.featureAttribute,aa)}function P(Z){let Y=q.newLayout().vec3f(C.VertexAttribute.MODELORIGINHI).vec3f(C.VertexAttribute.MODELORIGINLO).mat3f(C.VertexAttribute.MODEL).mat3f(C.VertexAttribute.MODELNORMAL);n.isSome(Z)&&Z.includes("color")&&(Y=Y.vec4f(C.VertexAttribute.INSTANCECOLOR));n.isSome(Z)&&Z.includes("featureAttribute")&&(Y=Y.vec4f(C.VertexAttribute.INSTANCEFEATUREATTRIBUTE));n.isSome(Z)&&Z.includes("objectAndLayerIdColor")&&(Y=Y.vec4u8(C.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED));return Y}
const U=Z=>{const Y=Z.baseBoundingSphere.radius;Z=Z.levels.map(aa=>aa.minScreenSpaceRadius);return new H.LevelSelector(Y,Z)};a.LodRenderer=function(Z){function Y(ia,na){var ba=aa.call(this,ia);ba.type=z.IntersectorType.LOD;ba.isGround=!1;ba._levels=[];ba._defaultRenderInstanceData=[[]];ba._highlightRenderInstanceData=[[]];ba._allRenderInstanceData=[ba._defaultRenderInstanceData[0],ba._highlightRenderInstanceData[0]];ba._instanceIndex=0;ba._cycleStartIndex=0;ba._slicePlane=!1;ba._camera=new B.Camera;
ba._updateCyclesWithStaticCamera=-1;ba._needFullCycle=!1;ba.slots=[A.RenderSlot.OPAQUE_MATERIAL,A.RenderSlot.TRANSPARENT_MATERIAL];ba.canRender=!0;ba._instanceData=new E.InstanceData({shaderTransformation:ia.shaderTransformation},ia.optionalFields);ba._frameTask=na.registerTask(J.TaskPriority.LOD_RENDERER,b._assertThisInitialized(ba));return ba}b._inherits(Y,Z);var aa=b._createSuper(Y);Z=Y.prototype;Z.initialize=function(){this._instanceBufferLayout=P(this.optionalFields);this._glInstanceBufferLayout=
r.glLayout(this._instanceBufferLayout,1);this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle());this._instanceData.events.on("instance-transform-changed",({index:ia})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(ia)});this._instanceData.events.on("instance-visibility-changed",({index:ia})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(ia)});this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))};
Z.destroy=function(){this._frameTask.remove()};Z.initializeRenderContext=async function(ia,na){this._context=ia;const ba=ia.renderContext.rctx,ea=await Promise.allSettled(this.symbol.levels.map(ka=>{this._defaultRenderInstanceData[0].push(new I.RenderInstanceData(ba,this._instanceBufferLayout));this._highlightRenderInstanceData[0].push(new I.RenderInstanceData(ba,this._instanceBufferLayout));return K.LodLevel.create(ia,ka,na)})),ja=ea.map(ka=>"fulfilled"===ka.status?ka.value:null).filter(n.isSome);
if(x.isAborted(na)||ja.length!==ea.length){ja.forEach(ka=>ka.destroy());x.throwIfAborted(na);for(const ka of ea)if("rejected"===ka.status)throw ka.reason;}this._levels=ja;this._levelSelector=U(this)};Z.uninitializeRenderContext=function(){this._invalidateOctree();this._levels.forEach(ia=>ia.destroy());this._defaultRenderInstanceData[0].forEach(ia=>ia.destroy());this._highlightRenderInstanceData[0].forEach(ia=>ia.destroy())};Z.prepareRender=function(ia){if(!h.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const na=
ia.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(ia.bindParameters.contentCamera);na||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(J.noBudget),this._needFullCycle=!1)}};Z.prepareTechniques=function(ia){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(ia.output))return null;const na=this._getInstanceDatas(ia.output);if(!na)return null;const ba=[];na.forEach(ea=>this.levels.forEach((ja,ka)=>{ja.components.forEach(da=>ba.push(this._beginComponent(ia,
ea[ka],da)))}));return ba};Z.render=function(ia,na){const ba=this._getInstanceDatas(ia.output);if(ba){var ea=0;ia.rctx.bindVAO();ba.forEach(ja=>this.levels.forEach((ka,da)=>{ka.components.forEach(ha=>this._renderComponent(ia,na[ea++],ja[da],ha,da))}))}};Z._getInstanceDatas=function(ia){const na=ia!==y.ShaderOutput.Highlight&&ia!==y.ShaderOutput.ShadowHighlight;ia=ia!==y.ShaderOutput.ShadowExcludeHighlight;return na&&ia?this._allRenderInstanceData:na?this._defaultRenderInstanceData:ia?this._highlightRenderInstanceData:
null};Z.intersect=function(ia,na,ba,ea){if(this.baseMaterial.isVisible()&&!n.isNone(this._octree)){var ja=u.create();k.subtract(ja,ea,ba);var ka=da=>{this._instanceData.getCombinedModelTransform(da,Q);ia.transform.set(Q);k.transformMat4(W,ba,ia.transform.inverse);k.transformMat4(V,ea,ia.transform.inverse);const ha=this._instanceData.getState(da),ca=this._instanceData.getLodLevel(da),fa=this._levels.length;t.assert(0!==(ha&E.StateFlags.ACTIVE),"invalid instance state");t.assert(0<=ca&&ca<fa,"invaid lod level");
this._levels[ca].intersect(ia,na,W,V,da,this.metadata,fa)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(ka):this._octree.forEachAlongRay(ba,ja,ka)}};Z.queryDepthRange=function(ia){return this._queryDepthRangeOctree(ia)};Z.notifyShaderTransformationChanged=function(){this._invalidateOctree();this._requestUpdateCycle()};Z._invalidateOctree=function(){this._octreeCached=n.destroyMaybe(this._octreeCached)};Z._queryDepthRangeOctree=function(ia){if(n.isNone(this._octree))return{near:Infinity,
far:-Infinity};var na=ia.viewForward,ba=this._octree.findClosest(na,v.DepthOrder.FRONT_TO_BACK,ia.frustum);const ea=this._octree.findClosest(na,v.DepthOrder.BACK_TO_FRONT,ia.frustum);if(null==ba||null==ea)return{near:Infinity,far:-Infinity};const ja=ia.eye,ka=this._instanceData.view;ka.boundingSphere.getVec(ba,S);k.subtract(S,S,ja);ba=k.dot(S,na)-S[3];ka.boundingSphere.getVec(ea,S);k.subtract(S,S,ja);na=k.dot(S,na)+S[3];return{near:Math.max(ia.near,ba),far:Math.min(ia.far,na)}};Z._requestUpdateCycle=
function(ia=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;ia&&(this._needFullCycle=!0,this._context.requestRender())};Z._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._allRenderInstanceData.forEach(ia=>ia.forEach(na=>na.startUpdateCycle()))};Z.runTask=function(ia){const {_enableLevelSelection:na,_camera:ba,_levelSelector:ea}=this;this._allRenderInstanceData.forEach(qa=>qa.forEach(wa=>wa.beginUpdate()));const ja=this._instanceData,ka=ja.view;
let da=ja.size;const ha=ja.capacity;let ca=this._instanceIndex;for(let qa=0;qa<da&&!ia.done;++qa){ca===this._cycleStartIndex&&this._startUpdateCycle();const wa=ka.state.get(ca);var fa=0;if(wa&E.StateFlags.ALLOCATED){var ma=ka.lodLevel.get(ca);wa&E.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][ma].freeTail();wa&E.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][ma].freeTail();wa&E.StateFlags.REMOVE?ja.freeInstance(ca):wa&E.StateFlags.VISIBLE?(ma=0,na&&(ka.modelOrigin.getVec(ca,
N),ma=ea.selectLevel(N,ja.getCombinedMedianScaleFactor(ca),ba)),fa=wa&~(E.StateFlags.ACTIVE|E.StateFlags.TRANSFORM_CHANGED),0<=ma&&(wa&E.StateFlags.HIGHLIGHT?(G(this._highlightRenderInstanceData[0][ma],ka,ca),fa|=E.StateFlags.HIGHLIGHT_ACTIVE):(G(this._defaultRenderInstanceData[0][ma],ka,ca),fa|=E.StateFlags.DEFAULT_ACTIVE)),ka.state.set(ca,fa),ka.lodLevel.set(ca,ma)):(fa=wa&~(E.StateFlags.ACTIVE|E.StateFlags.TRANSFORM_CHANGED),ka.state.set(ca,fa));n.isSome(this._octreeCached)&&(ma=!!(wa&E.StateFlags.ACTIVE),
fa=!!(fa&E.StateFlags.ACTIVE),!ma&&fa?this._octreeCached.addInstance(ca):ma&&!fa?this._octreeCached.removeInstance(ca):ma&&fa&&wa&E.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(ca),this._octreeCached.addInstance(ca)));ca=ca+1===ha?0:ca+1;ia.madeProgress()}else ca=ca+1===ha?0:ca+1,da++}this._instanceIndex=ca;this._allRenderInstanceData.forEach(qa=>qa.forEach(wa=>wa.endUpdate()));this._context.requestRender()};Z._beginComponent=function(ia,na,ba){const {bindParameters:ea,rctx:ja,
output:ka}=ia;if(0===na.size||!ba.material.requiresSlot(ea.slot,ia.output))return null;ia=ba.glMaterials.load(ja,ea.slot,ka);return n.isSome(ia)?ia.beginSlot(ea):null};Z._renderComponent=function(ia,na,ba,ea,ja){if(na){var {bindParameters:ka,rctx:da}=ia,ha=da.bindTechnique(na,ea.material.parameters,ka);da.bindVAO(ea.vao);na.ensureAttributeLocations(ea.vao);ha.bindDraw(X,ka,ea.material.parameters);h.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&ia.output===y.ShaderOutput.Color&&(ha.setUniform4fv("externalColor",
T[Math.min(ja,T.length-1)]),ha.setUniform1i("colorMixMode",L.colorMixModes.replace));var ca=da.capabilities.instancing;ia=ba.capacity;ja=ba.headIndex;ha=ba.tailIndex;var fa=ba.firstIndex,ma=this._glInstanceBufferLayout,qa=(wa,xa)=>{M.bindVertexBufferLayout(da,D.Default3D,ba.buffer,ma,wa);ca.drawArraysInstanced(na.primitiveType,0,ea.vertexCount,xa-wa);M.unbindVertexBufferLayout(da,D.Default3D,ba.buffer,ma)};ea.material.parameters.transparent&&null!=fa?ja>ha?(t.assert(fa>=ha&&fa<=ja,"invalid firstIndex"),
qa(fa,ja),qa(ha,fa)):ja<ha&&(fa<=ja?(t.assert(0<=fa&&fa<=ja,"invalid firstIndex"),qa(fa,ja),qa(ha,ia),qa(0,fa)):(t.assert(fa>=ha&&fa<=ia,"invalid firstIndex"),qa(fa,ia),qa(0,ja),qa(ha,fa))):ja>ha?qa(ha,ja):ja<ha&&(qa(0,ja),qa(ha,ia));da.bindVAO(null)}};b._createClass(Y,[{key:"_enableLevelSelection",get:function(){return 1<this.symbol.levels.length}},{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",
get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(ia){this._slicePlane=ia}},{key:"layerUid",get:function(){return this.metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const ia={cpu:0,gpu:0};this._allRenderInstanceData.forEach(na=>
na.forEach(ba=>{ia.cpu+=ba.memoryUsage.cpu;ia.gpu+=ba.memoryUsage.gpu}));return ia}},{key:"renderStats",get:function(){const ia=this._instanceData.size,na=[];this._levels.forEach((ba,ea)=>{ea=this._allRenderInstanceData[0][ea].size+this._allRenderInstanceData[1][ea].size;ba=ba.triangleCount;na.push({renderedInstances:ea,renderedTriangles:ea*ba,trianglesPerInstance:ba})});return{totalInstances:ia,renderedInstances:na.reduce((ba,ea)=>ba+ea.renderedInstances,0),renderedTriangles:na.reduce((ba,ea)=>ba+
ea.renderedTriangles,0),levels:na}}},{key:"needsTransparentPass",get:function(){return this._levels.some(ia=>ia.components.some(na=>na.material.requiresSlot(A.RenderSlot.TRANSPARENT_MATERIAL,y.ShaderOutput.Color)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData[0].some(ia=>0<ia.size)}},{key:"_octree",get:function(){if(n.isNone(this._octreeCached)){const ia=this._instanceData,na=ia.view?.state;if(!na)return null;this._octreeCached=new F.InstanceOctree(ia,this.baseBoundingSphere);
for(let ba=0;ba<ia.capacity;++ba)na.get(ba)&E.StateFlags.ACTIVE&&this._octreeCached.addInstance(ba)}return this._octreeCached}},{key:"running",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}}]);return Y}(w);c.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"symbol",void 0);c.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);c.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"metadata",
void 0);c.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);c.__decorate([m.property()],a.LodRenderer.prototype,"_instanceData",void 0);c.__decorate([m.property()],a.LodRenderer.prototype,"_cycleStartIndex",void 0);c.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"_enableLevelSelection",null);c.__decorate([m.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);c.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,
"running",null);a.LodRenderer=c.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);const N=u.create(),S=p.create(),Q=e.create(),W=u.create(),V=u.create(),T=[p.fromValues(1,0,1,1),p.fromValues(0,0,1,1),p.fromValues(0,1,0,1),p.fromValues(1,1,0,1),p.fromValues(1,0,0,1)],X=new O.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/Evented ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z){a.StateFlags=void 0;(function(F){F[F.ALLOCATED=1]="ALLOCATED";F[F.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";F[F.VISIBLE=4]="VISIBLE";F[F.HIGHLIGHT=8]="HIGHLIGHT";F[F.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";F[F.REMOVE=32]="REMOVE";F[F.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";F[F.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let v=b._createClass(function(F){this.localTransform=F.getField(z.VertexAttribute.LOCALTRANSFORM,q.BufferViewMat4f64);this.globalTransform=
F.getField(z.VertexAttribute.GLOBALTRANSFORM,q.BufferViewMat4f64);this.modelOrigin=F.getField(z.VertexAttribute.MODELORIGIN,q.BufferViewVec3f64);this.model=F.getField(z.VertexAttribute.MODEL,q.BufferViewMat3f);this.modelNormal=F.getField(z.VertexAttribute.MODELNORMAL,q.BufferViewMat3f);this.modelScaleFactors=F.getField(z.VertexAttribute.MODELSCALEFACTORS,q.BufferViewVec2f);this.boundingSphere=F.getField(z.VertexAttribute.BOUNDINGSPHERE,q.BufferViewVec4f64);this.color=F.getField(z.VertexAttribute.COLOR,
q.BufferViewVec4f);this.featureAttribute=F.getField(z.VertexAttribute.FEATUREATTRIBUTE,q.BufferViewVec4f);this.state=F.getField(z.VertexAttribute.STATE,q.BufferViewUint8);this.lodLevel=F.getField(z.VertexAttribute.LODLEVEL,q.BufferViewUint8);this.objectAndLayerIdColor=F.getField(z.VertexAttribute.OBJECTANDLAYERIDCOLOR,q.BufferViewVec4u8)});a.InstanceData=function(F){function H(I,L){I=K.call(this,I);I.events=new n;I._capacity=0;I._size=0;I._next=0;I._buffer=null;I._view=null;let R=B.newLayout().mat4f64(z.VertexAttribute.LOCALTRANSFORM).mat4f64(z.VertexAttribute.GLOBALTRANSFORM).vec4f64(z.VertexAttribute.BOUNDINGSPHERE).vec3f64(z.VertexAttribute.MODELORIGIN).mat3f(z.VertexAttribute.MODEL).mat3f(z.VertexAttribute.MODELNORMAL).vec2f(z.VertexAttribute.MODELSCALEFACTORS);
L.includes("color")&&(R=R.vec4f(z.VertexAttribute.COLOR));L.includes("featureAttribute")&&(R=R.vec4f(z.VertexAttribute.FEATUREATTRIBUTE));R=R.u8(z.VertexAttribute.STATE).u8(z.VertexAttribute.LODLEVEL);L.includes(z.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(R=R.vec4u8(z.VertexAttribute.OBJECTANDLAYERIDCOLOR));R.alignTo(8);I._layout=R;return I}b._inherits(H,F);var K=b._createSuper(H);F=H.prototype;F.addInstance=function(){this._size+1>this._capacity&&this._grow();const I=this._findSlot();this._view.state.set(I,
a.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");return I};F.removeInstance=function(I){const L=this._view.state;D.assert(0<=I&&I<this._capacity&&0!==(L.get(I)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(I,a.StateFlags.ACTIVE)?this._setStateFlags(I,a.StateFlags.REMOVE):this.freeInstance(I);this.events.emit("instances-changed")};F.freeInstance=function(I){const L=this._view.state;D.assert(0<=I&&I<this._capacity&&0!==(L.get(I)&a.StateFlags.ALLOCATED),
"invalid instance handle");L.set(I,0);this._size--};F.setLocalTransform=function(I,L,R=!0){this._view.localTransform.setMat(I,L);R&&this.updateModelTransform(I)};F.getLocalTransform=function(I,L){this._view.localTransform.getMat(I,L)};F.setGlobalTransform=function(I,L,R=!0){this._view.globalTransform.setMat(I,L);R&&this.updateModelTransform(I)};F.getGlobalTransform=function(I,L){this._view.globalTransform.getMat(I,L)};F.updateModelTransform=function(I){const L=this._view;var R=A;const O=t;L.localTransform.getMat(I,
C);L.globalTransform.getMat(I,E);const J=u.multiply(E,E,C);h.set(R,J[12],J[13],J[14]);L.modelOrigin.setVec(I,R);e.fromMat4(O,J);L.model.setMat(I,O);R=y.scaleFromMatrix(A,J);R.sort();L.modelScaleFactors.set(I,0,R[1]);L.modelScaleFactors.set(I,1,R[2]);e.invert(O,O);e.transpose(O,O);L.modelNormal.setMat(I,O);this._setStateFlags(I,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:I})};F.getModelTransform=function(I,L){const R=this._view;R.model.getMat(I,t);R.modelOrigin.getVec(I,
A);L[0]=t[0];L[1]=t[1];L[2]=t[2];L[3]=0;L[4]=t[3];L[5]=t[4];L[6]=t[5];L[7]=0;L[8]=t[6];L[9]=t[7];L[10]=t[8];L[11]=0;L[12]=A[0];L[13]=A[1];L[14]=A[2];L[15]=1};F.applyShaderTransformation=function(I,L){x.isSome(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,I,L)};F.getCombinedModelTransform=function(I,L){this.getModelTransform(I,L);x.isSome(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,I,L);return L};F.getCombinedLocalTransform=function(I,L){this._view.localTransform.getMat(I,
L);x.isSome(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,I,L);return L};F.getCombinedMaxScaleFactor=function(I){let L=this._view.modelScaleFactors.get(I,1);x.isSome(this.shaderTransformation)&&(this.shaderTransformation.scaleFactor(A,this,I),L*=Math.max(A[0],A[1],A[2]));return L};F.getCombinedMedianScaleFactor=function(I){let L=this._view.modelScaleFactors.get(I,0);if(x.isSome(this.shaderTransformation)){this.shaderTransformation.scaleFactor(A,this,I);I=A[0];var R=A[1];
L*=Math.max(Math.min(I,R),Math.min(Math.max(I,R),A[2]))}return L};F.getModel=function(I,L){this._view.model.getMat(I,L)};F.setFeatureAttribute=function(I,L){this._view.featureAttribute.setVec(I,L)};F.getFeatureAttribute=function(I,L){this._view.featureAttribute.getVec(I,L)};F.setColor=function(I,L){this._view.color.setVec(I,L)};F.setObjectAndLayerIdColor=function(I,L){this._view.objectAndLayerIdColor.setVec(I,L)};F.getColor=function(I,L){this._view.color.getVec(I,L)};F.setVisible=function(I,L){L!==
this.getVisible(I)&&(this._setStateFlag(I,a.StateFlags.VISIBLE,L),this.events.emit("instance-visibility-changed",{index:I}))};F.getVisible=function(I){return this._getStateFlag(I,a.StateFlags.VISIBLE)};F.setHighlight=function(I,L){L!==this.getHighlight(I)&&(this._setStateFlag(I,a.StateFlags.HIGHLIGHT,L),this.events.emit("instance-highlight-changed"))};F.getHighlight=function(I){return this._getStateFlag(I,a.StateFlags.HIGHLIGHT)};F.getState=function(I){return this._view.state.get(I)};F.getLodLevel=
function(I){return this._view.lodLevel.get(I)};F.countFlags=function(I){let L=0;for(let R=0;R<this._capacity;++R)this.getState(R)&I&&++L;return L};F._setStateFlags=function(I,L){const R=this._view.state;L|=R.get(I);R.set(I,L)};F._clearStateFlags=function(I,L){const R=this._view.state;L=R.get(I)&~L;R.set(I,L)};F._setStateFlag=function(I,L,R){R?this._setStateFlags(I,L):this._clearStateFlags(I,L)};F._getStateFlag=function(I,L){return!!(this._view.state.get(I)&L)};F._grow=function(){const I=Math.max(1024,
Math.floor(2*this._capacity)),L=this._layout.createBuffer(I);if(this._buffer){const R=new Uint8Array(this._buffer.buffer);(new Uint8Array(L.buffer)).set(R)}this._capacity=I;this._buffer=L;this._view=new v(this._buffer)};F._findSlot=function(){const I=this._view.state;let L=this._next;for(;I.get(L)&a.StateFlags.ALLOCATED;)L=L+1===this._capacity?0:L+1;this._next=L+1===this._capacity?0:L+1;return L};b._createClass(H,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},
{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return H}(w);c.__decorate([m.property({constructOnly:!0})],a.InstanceData.prototype,"shaderTransformation",void 0);c.__decorate([m.property()],a.InstanceData.prototype,"_size",void 0);c.__decorate([m.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=c.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],a.InstanceData);const A=r.create(),
t=k.create(),C=p.create(),E=p.create();a.InstanceDataView=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,c,w,n,x,m){m=function(l){function g(d,e){var k=f.call(this,u=>n.wrap(k._instanceData.view.boundingSphere.getVec(u,
k._tmpSphere)),{maximumDepth:25});k._tmpSphere=n.create();k._tmpMat4=c.create();k._instanceData=d;k._boundingSphere=e;return k}b._inherits(g,l);var f=b._createSuper(g);l=g.prototype;l.addInstance=function(d){const e=this._instanceData.view.boundingSphere,k=this._instanceData.getCombinedModelTransform(d,this._tmpMat4);w.transformMat4(this._tmpSphere,this._boundingSphere.center,k);this._tmpSphere[3]=this._boundingSphere.radius*x.maxScale(k);e.setVec(d,this._tmpSphere);this.add([d])};l.removeInstance=
function(d){this.remove([d])};return b._createClass(g)}(m);a.InstanceOctree=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(n,x){this._worldSpaceRadius=n;this._minScreenSpaceRadii=x}w.prototype.selectLevel=function(n,x,m){n=m.computeScreenPixelSizeAt(n);x=this._worldSpaceRadius*x/n;n=0;for(m=1;m<this._minScreenSpaceRadii.length;++m)x>=
this._minScreenSpaceRadii[m]&&(n=m);return n};return b._createClass(w)}();a.LevelSelector=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),function(a,b,c,w,n,x,m){let l=function(){function g(d,
e){this.minScreenSpaceRadius=d;this.components=e}g.create=async function(d,e,k){const u=await Promise.allSettled(e.components.map(h=>d.controller.schedule(()=>new m.LodComponentData(d,h),k))),p=u.map(h=>"fulfilled"===h.status?h.value:null).filter(c.isSome);if(w.isAborted(k)||p.length!==u.length){p.forEach(h=>h.destroy());w.throwIfAborted(k);for(const h of u)if("rejected"===h.status)throw h.reason;}return new g(e.minScreenSpaceRadius,p)};var f=g.prototype;f.destroy=function(){this.components.forEach(d=>
d.destroy())};f.intersect=function(d,e,k,u,p,h,r){this.components.forEach(q=>q.intersect(d,e,k,u,p,h,this.boundingSphere,r))};b._createClass(g,[{key:"boundingBox",get:function(){if(c.isNone(this._boundingBox)){const d=x.empty();this.components.forEach(e=>{c.isSome(e.boundingInfo)&&(x.expandWithVec3(d,e.boundingInfo.bbMin),x.expandWithVec3(d,e.boundingInfo.bbMax))});this._boundingBox=d}return this._boundingBox}},{key:"boundingSphere",get:function(){if(c.isNone(this._boundingSphere)){const d=this.boundingBox,
e=n.create();x.center(d,e);this._boundingSphere={center:e,radius:.5*x.diameter(d)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((d,e)=>d+e.triangleCount,0)}}]);return g}();a.LodLevel=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=function(){function k(p,h){const r=p.renderContext.rctx;h=h.geometry;this._materialRepository=p.materialRepository;h.material.setParameters({instancedDoublePrecision:!0});p=h.material.createBufferWriter();const q=p.vertexBufferLayout,y=p.elementCount(h),B=p.allocate(y);p.write(null,null,h,B,0);this.geometry=h;this.material=h.material;this.glMaterials=new n.GLMaterials(h.material,this._materialRepository);this.vertexBufferLayout=q;this.vbo=f.BufferObject.createVertex(r,
d.Usage.STATIC_DRAW,B.buffer);this.vao=new l.VertexArrayObject(r,w.Default3D,{geometry:c.glLayout(q)},{geometry:this.vbo});this.vertexCount=y}var u=k.prototype;u.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};u.intersect=function(p,h,r,q,y,B,D,z){const v=this.geometry.id;this.material.intersect(this.geometry,p.transform.transform,p,r,q,(A,t,C,E,F)=>{0<=A&&(null==h||h(p.rayBegin,p.rayEnd,A))&&(C=new g.LodTarget(B.layerUid,B.graphicUid(y),v,C,D,z),(null==p.results.min.drapedLayerOrder||
F>=p.results.min.drapedLayerOrder)&&(null==p.results.min.dist||A<p.results.min.dist)&&p.results.min.set(m.IntersectorType.LOD,C,A,t,p.transform.transform,F),p.options.store!==m.StoreResults.MIN&&(null==p.results.max.drapedLayerOrder||F>=p.results.max.drapedLayerOrder)&&(null==p.results.max.dist||A>p.results.max.dist)&&p.results.max.set(m.IntersectorType.LOD,C,A,t,p.transform.transform,F),p.options.store===m.StoreResults.ALL&&(E=x.newIntersectorResult(p.results.min.ray),E.set(m.IntersectorType.LOD,
C,A,t,p.transform.transform,F),p.results.all.push(E)))})};b._createClass(k,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return k}();a.LodComponentData=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],
function(a,b,c,w,n){w=function(x){function m(g,f,d,e,k,u){var p=l.call(this,g,f);p.layerUid=g;p.graphicUid=f;p.geometryId=d;p.triangleNr=e;p.baseBoundingSphere=k;p.numLodLevels=u;return p}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.Graphic3DTarget);a.LodTarget=w;a.isLodIntersectorResult=function(x){return n.isValidIntersectorResult(x)&&x.intersector===c.IntersectorType.LOD&&!!x.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,w,n,x){let m=b._createClass(function(g){this.modelOriginHi=g.getField(n.VertexAttribute.MODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=g.getField(n.VertexAttribute.MODELORIGINLO,c.BufferViewVec3f);this.model=g.getField(n.VertexAttribute.MODEL,c.BufferViewMat3f);this.modelNormal=g.getField(n.VertexAttribute.MODELNORMAL,c.BufferViewMat3f);this.color=g.getField(n.VertexAttribute.INSTANCECOLOR,c.BufferViewVec4f);this.featureAttribute=g.getField(n.VertexAttribute.INSTANCEFEATUREATTRIBUTE,
c.BufferViewVec4f);this.objectAndLayerIdColor=g.getField(n.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,c.BufferViewVec4u8)}),l=function(){function g(d,e){this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=d;this._instanceBufferLayout=e;this._elementSize=e.stride;this._capacity=1}var f=g.prototype;f.destroy=function(){this._buffer&&this._buffer.destroy()};f.reset=function(){this._tailIndex=this._headIndex=
0;this._firstIndex=null};f.startUpdateCycle=function(){this._captureFirstIndex=!0};f.beginUpdate=function(){w.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};f.endUpdate=function(){w.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};f.allocateHead=function(){w.assert(this._updating,"not updating");
this.isFull&&this._grow();const d=this.headIndex;this._captureFirstIndex&&(this._firstIndex=d,this._captureFirstIndex=!1);this._incrementHead();w.assert(this._headIndex!==this._tailIndex,"invalid pointers");return d};f.freeTail=function(){w.assert(this._updating,"not updating");w.assert(0<this.size,"invalid size");const d=this._tailIndex===this._firstIndex;this._incrementTail();d&&(this._firstIndex=this._tailIndex)};f._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};f._shrink=
function(){this._resize(Math.max(1024,Math.floor(.5*this._capacity)))};f._resize=function(d){w.assert(this._updating,"not updating");if(d!==this._capacity){var e=new x(this._rctx,this._elementSize,d);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const k=this.size,u=this._compactInstances(e);w.assert(u===k,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=u;this._prevHeadIndex=0}this._resized=!0;this._capacity=
d;this._buffer=e;this._view=new m(this._instanceBufferLayout.createView(this._buffer.array))}};f._compactInstances=function(d){const e=this._headIndex,k=this._tailIndex;return k<e?(this._buffer.copyRange(k,e,d),e-k):k>e?(this._buffer.copyRange(k,this._capacity,d),0<e&&this._buffer.copyRange(0,e,d,this._capacity-k),e+(this._capacity-k)):0};f._incrementHead=function(d=1){this._headIndex=(this._headIndex+d)%this._capacity};f._incrementTail=function(d=1){this._tailIndex=(this._tailIndex+d)%this._capacity};
f._transferRange=function(d,e){d<e?this._buffer.transferRange(d,e):d>e&&(0<e&&this._buffer.transferRange(0,e),this._buffer.transferRange(d,this._capacity))};b._createClass(g,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const d=this._headIndex,e=this._tailIndex;return d>=e?d-e:d+this._capacity-e}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},
{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return g}();a.RenderInstanceData=l;a.RenderInstanceDataView=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,c){return function(){function w(x,m,l){this._elementSize=m;this._buffer=b.BufferObject.createVertex(x,c.Usage.STATIC_DRAW);this.resize(l)}var n=w.prototype;n.destroy=function(){this._buffer.dispose()};n.copyRange=function(x,m,l,g=0){x=new Uint8Array(this.array,x*this.elementSize,(m-x)*this.elementSize);(new Uint8Array(l.array,g*this.elementSize)).set(x)};n.transferAll=function(){this._buffer.setData(this._array)};n.transferRange=
function(x,m){x*=this._elementSize;m*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),x,x,m)};n.resize=function(x){const m=x*this._elementSize,l=new ArrayBuffer(m);this._array&&(x>=this._capacity?(new Uint8Array(l)).set(new Uint8Array(this._array)):(new Uint8Array(l)).set((new Uint8Array(this._array)).subarray(0,x*this._elementSize)));this._array=l;this._buffer.setSize(m);this._capacity=x};a._createClass(w,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",
get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return w}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../support/ElevationProvider ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Path ../../webgl-engine/lib/PathBuilder ../../webgl-engine/lib/PathCapBuilder ../../webgl-engine/lib/PathExtruder ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/PathGeometryData ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/PathProfile ../../webgl-engine/lib/PathVertex ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M){function G(Q,W,V){const {origin:T,positions:X}=Q;let Z=Q.offset;switch(W){default:case K.UpVectorAlignment.World:for(const Y of Q.vertices)N[0]=X[Z++]+T[0],N[1]=X[Z++]+T[1],N[2]=X[Z++]+T[2],V.worldUpAtPosition(N,N),Y.setFrameFromUpVector(N);break;case K.UpVectorAlignment.Path:N[0]=X[Z]+T[0],N[1]=X[Z+1]+T[1],N[2]=X[Z+2]+T[2],V.worldUpAtPosition(N,N),L.computeMinimumRotationTangentFrame(Q,N)}}function P(Q,W,V){switch(Q){case "symbol-value":return V;
case "proportional":return W;default:return Q}}const U=["polyline"];c=function(Q){function W(T,X,Z,Y){T=V.call(this,T,X,Z,Y);T._intrinsicSize=g.fromValues(1,1);T._upVectorAlignment=K.UpVectorAlignment.Path;T._stencilWidth=.1;T.ensureDrapedStatus(!1);return T}b._inherits(W,Q);var V=b._createSuper(W);Q=W.prototype;Q.doLoad=async function(){var T=n.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height;const X=n.isSome(this.symbolLayer.height)?this.symbolLayer.height:T;this._vvConvertOptions=
new z.ConvertOptions([1,1,1],[T,1,X],this._context.renderCoordsHelper.unitInMeters);this._vvConvertOptions.supportsOpacity=!0;this._vvConvertOptions.supportsRotation=!1;this._fastUpdates=0<this._context.renderer?.visualVariables?.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):null;var Z=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?K.UpVectorAlignment.World:K.UpVectorAlignment.Path;var Y=this.symbolLayer.profile||
"circle";switch(Y){default:case "circle":this._profile=R.createCircleProfile(q.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=R.creatQuadProfile()}var aa=[0,0];"center"!==Z&&(aa={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[Z],this._profile.translate(aa[0],aa[1]));switch(this.symbolLayer.join){case "round":this._extruder=new H.MiterExtruder(0,q.PATH_NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new H.MiterExtruder(0,1);break;case "miter":this._extruder=
new H.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new H.SimpleExtruder}Z=this.symbolLayer.cap||"butt";switch(Z){case "none":this._startCap=new F.NoCapBuilder;this._endCap=new F.NoCapBuilder;break;default:this._startCap=new F.TriangulationCapBuilder(this._profile,0);this._endCap=new F.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new F.TriangulationCapBuilder(this._profile,-.5);this._endCap=new F.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":Y=
"quad"===Y,this._startCap=new F.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:Y,subdivisions:q.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=new F.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:Y,subdivisions:q.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}Y=n.get(this.symbolLayer,"material","color");aa=this._getCombinedOpacityAndColor(Y);Y=d.fromArray(aa);aa=aa[3];const ia=1>aa||this.needsDrivenTransparentPass;Z={diffuse:Y,ambient:Y,opacity:aa,transparent:ia,hasVertexColors:!1,
hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:ia||"none"===Z?A.CullFaceOptions.None:A.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(l.set(this._intrinsicSize,T,X),!B.isValidSize(this._intrinsicSize[0])||!B.isValidSize(this._intrinsicSize[1])))throw new w("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates&&this._fastUpdates.visualVariables.size||l.scale(this._intrinsicSize,
this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates?(T={...Z,...this._fastUpdates.materialParameters,size:g.fromArray(this._intrinsicSize)},this._material=new M.PathMaterial(T)):(Z.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new J.DefaultMaterial(Z));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)};Q.destroy=function(){b._get(b._getPrototypeOf(W.prototype),
"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null};Q.createGraphics3DGraphic=function(T){const X=T.graphic;if(!this._validateGeometry(X.geometry,U,this.symbolLayer.type))return null;const Z=this.setGraphicElevationContext(X,new h.ElevationContext);return this._createAs3DShape(X,T.renderingInfo,Z,X.uid)};Q.layerOpacityChanged=function(){var T=n.get(this.symbolLayer,"material","color");T=this._getCombinedOpacity(T);this._material.setParameters({opacity:T,transparent:1>
T||this.needsDrivenTransparentPass})};Q.layerElevationInfoChanged=function(T,X){return this.updateGraphics3DGraphicElevationInfo(T,X,p.needsElevationUpdates3D)};Q.slicePlaneEnabledChanged=function(){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};Q.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};Q.applyRendererDiff=function(T,X){for(const Z in T.diff)switch(Z){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,
X,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return D.ApplyRendererDiffResult.Recreate_Symbol;break;default:return D.ApplyRendererDiffResult.Recreate_Symbol}return D.ApplyRendererDiffResult.Fast_Update};Q._getVertexData=function(T){let X=0;const Z=T.paths,Y=[],aa=T.spatialReference,ia=this._context.elevationProvider.spatialReference,na=this._context.renderCoordsHelper.spatialReference;for(var ba of Z)X+=ba.length;ba=u.newDoubleArray(3*X);let ea=
0;for(const ja of Z){Y.push({offset:ea,numVertices:ja.length});for(const ka of ja)ba[ea++]=ka[0],ba[ea++]=ka[1],ba[ea++]=T.hasZ?ka[2]:0}if(n.isSome(ia)&&!aa.equals(ia)&&!e.projectBuffer(ba,aa,0,ba,ia,0,X))return null;n.isSome(ia)&&!ia.equals(na)?(T=u.newDoubleArray(3*X),e.projectBuffer(ba,ia,0,T,na,0,X)):T=u.doubleArrayFrom(ba);return{pathVertexDataInfos:Y,vertexDataES:ba,vertexDataRS:T}};Q._createAs3DShape=function(T,X,Z,Y){var aa=T.geometry;const ia=this._getVertexData(aa);if(null==ia)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0===ia.pathVertexDataInfos.length)return 0!==aa.paths.length&&aa.paths.some(fa=>0<fa.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var na=[];aa=aa.spatialReference;const ba=k.create(),ea=this._context.renderCoordsHelper,ja=new v.SamplePosition(ia.vertexDataES);for(const fa of ia.pathVertexDataInfos){var ka=fa.numVertices;if(2>ka)continue;var da=fa.offset;if(n.isSome(this._context.clippingExtent)&&(k.empty(ba),k.expandWithBuffer(ba,
ia.vertexDataES,da,ka),!k.intersectsClippingArea(ba,this._context.clippingExtent)))continue;var ha=[];ka=da+3*ka;for(var ca=da;ca<ka;ca+=3){ja.offset=ca;const wa=p.evaluateElevationAlignmentAtPoint(ja,this._context.elevationProvider,Z,ea);f.set(N,ia.vertexDataRS[ca],ia.vertexDataRS[ca+1],ia.vertexDataRS[ca+2]);ea.setAltitude(N,wa);ia.vertexDataRS[ca]=N[0];ia.vertexDataRS[ca+1]=N[1];ia.vertexDataRS[ca+2]=N[2];ha.push(O.newPathVertex(this._upVectorAlignment))}da=new C.Path(ha,ia.vertexDataES,ia.vertexDataRS,
da);G(da,this._upVectorAlignment,this._context.renderCoordsHelper);da=new E.PathBuilder(da,this._profile,this._extruder,this._startCap,this._endCap);ha=null;this._fastUpdates?(ca=this._fastUpdates.visualVariables,ha=ca.size?y.getAttributeValue(ca.size.field,T):0,ka=ca.color?y.getAttributeValue(ca.color.field,T):0,ca=ca.opacity?y.getAttributeValue(ca.opacity.field,T):0,ha=new I.FastUpdatePathGeometry(da,ha,ka,ca)):(ha=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(ka=
X.size,ha[0]*=P(ka[0],"symbol-value"===ka[2]?this.symbolLayer.height||0:ka[2],this.symbolLayer.width||0),ha[1]*=P(ka[2],"symbol-value"===ka[0]?this.symbolLayer.width||0:ka[0],this.symbolLayer.height||0)),ka=void 0,this._drivenProperties.color&&(ka=X.color),this._drivenProperties.opacity&&null!=X.opacity&&(ka=ka?[ka[0],ka[1],ka[2],X.opacity]:[1,1,1,X.opacity]),ca=new I.StaticPathGeometry(da),ca.bake(ha),ka&&ca.bakeVertexColors(ka),ha=ca);const {vertexAttributes:ma,indices:qa}=ha.createGeometryData();
ka=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Y,layerUid:this._context.layer.uid});ha=new K.PathGeometry(this._material,ma,qa,ha,aa,this._stencilWidth,ka);ha.transformation=x.translate(m.create(),m.IDENTITY,da.path.origin);na.push(ha)}if(0===na.length)return null;T=new t.Object3D({geometries:na,metadata:{layerUid:this._context.layer.uid,graphicUid:Y}});na=new r.Graphics3DObject3DGraphicLayer(this,T,na,null,null,(fa,ma,qa,wa,xa)=>{ma=this._upVectorAlignment;fa=fa.stageObject;
qa=fa.geometries;var pa=0;for(const Aa of qa){if(!K.isPathGeometry(Aa))continue;const Ha=Aa.path,Ka=Ha.builder.path;var ra=Ka,va=wa,Ba=xa;let Pa=0;const {origin:Ra,vertices:Sa,positions:La,positionsES:Ua}=ra,Za=ra.offset+3*Sa.length;for(let Xa=ra.offset;Xa<Za;Xa+=3)f.set(N,Ua[Xa],Ua[Xa+1],Ua[Xa+2]),va(N,S),Pa+=S.sampledElevation,N[0]=La[Xa]+Ra[0],N[1]=La[Xa+1]+Ra[1],N[2]=La[Xa+2]+Ra[2],Ba.setAltitude(N,S.z),La[Xa]=N[0]-Ra[0],La[Xa+1]=N[1]-Ra[1],La[Xa+2]=N[2]-Ra[2];ra.updatePathVertexInformation();
pa+=Pa/Sa.length;ma!==K.UpVectorAlignment.World&&G(Ka,ma,xa);Ha.onPathChanged(Aa);Aa.invalidateBoundingInfo();fa.geometryVertexAttrsUpdated(Aa)}return pa/qa.length},Z);na.alignedSampledElevation=0;na.needsElevationUpdates=p.needsElevationUpdates3D(Z.mode);return na};return b._createClass(W)}(y.Graphics3DSymbolLayer);const N=d.create(),S=new p.SampleElevationInfo;a.Graphics3DPathSymbolLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Path":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/FloatArray"],function(a,b,c,w,n){let x=function(){function m(l,g,f,d){this.vertices=l;this.positionsES=g;this.offset=d;var e=l.length;d=this.offset+3*Math.floor(e/2);l=f[d];g=f[d+1];d=f[d+2];this.origin=w.fromValues(l,g,d);this.positions=n.newFloatArray(3*e);e=this.offset+3*e;for(let k=this.offset;k<e;k+=3)this.positions[k]=f[k]-l,this.positions[k+1]=f[k+1]-g,this.positions[k+
2]=f[k+2]-d;this.updatePathVertexInformation()}m.prototype.updatePathVertexInformation=function(){const l=this.vertices.length;var g=this.vertices[0];let f=this.offset;const d=this.positions;g.vRight[0]=d[f+3]-d[f];g.vRight[1]=d[f+4]-d[f+1];g.vRight[2]=d[f+5]-d[f+2];f+=3;let e=c.length(g.vRight);g.vMinSiblingLength=e;c.normalize(g.vRight,g.vRight);var k=g;for(g=1;g<l;++g){const u=this.vertices[g];u.vLeft=k.vRight;g<l-1?(u.vRight[0]=d[f+3]-d[f],u.vRight[1]=d[f+4]-d[f+1],u.vRight[2]=d[f+5]-d[f+2],k=
c.length(u.vRight),u.vMinSiblingLength=Math.min(e,k),e=k,c.normalize(u.vRight,u.vRight)):(c.copy(u.vRight,u.vLeft),u.vMinSiblingLength=e);k=u;f+=3}};return b._createClass(m)}();a.Path=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathBuilder":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices"],function(a,b,c,w){let n=function(){function x(l,
g,f,d,e,k={}){this.path=l;this.profile=g;this.extruder=f;this.startCap=d;this.endCap=e;this.options=k;this._extrusionVertexCount=0;d=this.path.vertices.length-2;this.numExtrusionProfiles=f.numProfilesPerJoin()*d+2;this.numVerticesTotal=g.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;g=this.startCap.getNumVertices();this.numVerticesTotal+=g;this.endCap.vertexBufferStart=this.numVerticesTotal;g=this.endCap.getNumVertices();this.numVerticesTotal+=g;this.pathVertexData=
w.newIntArray(1*this.numVerticesTotal);this.profileRightAxes=c.newFloatArray(4*this.numVerticesTotal);this.profileUpAxes=c.newFloatArray(4*this.numVerticesTotal);this.profileVertexAndNormals=c.newFloatArray(4*this.numVerticesTotal);this.positions=c.floatSubArray(l.positions,l.offset,3*l.vertices.length);this._rebuildGeometry();this.buildTopology()}var m=x.prototype;m.emitVertex=function(l,g,f,d,e){const k=4*this._extrusionVertexCount;this.profileRightAxes[k]=g.right[0];this.profileRightAxes[k+1]=
g.right[1];this.profileRightAxes[k+2]=g.right[2];this.profileUpAxes[k]=g.up[0];this.profileUpAxes[k+1]=g.up[1];this.profileUpAxes[k+2]=g.up[2];this.profileVertexAndNormals[k]=f[0];this.profileVertexAndNormals[k+1]=f[1];this.profileVertexAndNormals[k+2]=d[0];this.profileVertexAndNormals[k+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=l;e?(l=this.path.vertices[l],g=l.maxStretchDistance,this.profileRightAxes[k+3]=l.rotationRight[0]*g,this.profileUpAxes[k+3]=l.rotationRight[1]*g):(this.profileRightAxes[k+
3]=0,this.profileUpAxes[k+3]=0);++this._extrusionVertexCount};m.emitCapVertex=function(l,g,f,d,e,k){const u=4*this._extrusionVertexCount;this.profileRightAxes[u]=g.right[0];this.profileRightAxes[u+1]=g.right[1];this.profileRightAxes[u+2]=g.right[2];this.profileRightAxes[u+3]=e;this.profileUpAxes[u]=g.up[0];this.profileUpAxes[u+1]=g.up[1];this.profileUpAxes[u+2]=g.up[2];this.profileUpAxes[u+3]=k;this.profileVertexAndNormals[u]=f[0];this.profileVertexAndNormals[u+1]=f[1];this.profileVertexAndNormals[u+
2]=d[0];this.profileVertexAndNormals[u+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=l;++this._extrusionVertexCount};m._rebuildGeometry=function(){this._extrusionVertexCount=0;const {positions:l,offset:g,vertices:f}=this.path;this.positions=c.floatSubArray(l,g,3*f.length);let d=0;const e=(u,p,h,r,q)=>this.emitCapVertex(d,u,p,h,r,q),k=(u,p,h,r)=>this.emitVertex(d,u,p,h,r);this.startCap.rebuildConnectingProfileGeometry(f[d],this.profile,e);for(d=1;d<f.length-1;++d)this.extruder.extrude(f[d],
this.profile,k);this.endCap.rebuildConnectingProfileGeometry(f[d],this.profile,e);d=0;this.startCap.rebuildCapGeometry(f[d],e);d=f.length-1;this.endCap.rebuildCapGeometry(f[d],e)};m.buildTopology=function(){const l=this.profile.vertices.length,g=this.profile.numSegments,f=this.numExtrusionProfiles-1;var d=g*f*6;this.startCap.indexBufferStart=d;this.startCap.firstProfileVertexIndex=0;d+=this.startCap.getNumIndices();this.endCap.indexBufferStart=d;this.endCap.firstProfileVertexIndex=l*(this.numExtrusionProfiles-
1);const e=[],k=[],u=[];d=(p,h,r)=>{e.push(p);e.push(h);e.push(r);k.push(p);k.push(h);k.push(r);u.push(this.pathVertexData[p]);u.push(this.pathVertexData[h]);u.push(this.pathVertexData[r])};for(let p=0;p<g;++p){const h=this.profile.vertexIndices[2*p],r=this.profile.vertexIndices[2*p+1];for(let q=0;q<f;++q){const y=q*l+h,B=(q+1)*l+r,D=q*l+r;d(y,(q+1)*l+h,B);d(y,B,D)}}this.startCap.buildTopology(this.path.vertices[0],d);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],d);this.vertexIndices=
w.compactIndices(e);this.normalIndices=w.compactIndices(k);this.pathVertexIndices=w.compactIndices(u)};m.onPathChanged=function(){this._rebuildGeometry()};return b._createClass(x)}();a.PathBuilder=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathCapBuilder":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2","../../../../chunks/vec2f64"],function(a,b,c,w){let n=function(){function d(){}d.prototype.rebuildConnectingProfileGeometry=
function(e,k,u){for(let p=0;p<k.vertices.length;++p)u(e.frame,k.vertices[p],k.vertexNormals[p],0,0)};return b._createClass(d)}(),x=function(d){function e(){return k.call(this)}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.getNumVertices=function(){return 0};d.getNumIndices=function(){return 0};d.rebuildCapGeometry=function(){};d.buildTopology=function(){};return b._createClass(e)}(n),m=function(d){function e(u,p=0,h=!1){var r=k.call(this);r.profile=u;r.profilePlaneOffset=p;r.flip=h;return r}
b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.getNumVertices=function(){return this.profile.vertices.length};d.getNumIndices=function(){return 3*this.profile.numSegments};d.rebuildConnectingProfileGeometry=function(u,p,h){for(let r=0;r<p.vertices.length;++r)h(u.frame,p.vertices[r],p.vertexNormals[r],this.profilePlaneOffset,0)};d.rebuildCapGeometry=function(u,p){const h=f;c.set(h,0,0);const r=this.flip?1:-1;for(let q=0;q<this.profile.vertices.length;++q)p(u.frame,this.profile.vertices[q],
h,this.profilePlaneOffset,r)};d.buildTopology=function(u,p){u=this.vertexBufferStart+this.profile.vertexIndices[0];for(let h=1;h<this.profile.numSegments;++h){const r=this.vertexBufferStart+this.profile.vertexIndices[2*h],q=this.vertexBufferStart+this.profile.vertexIndices[2*h+1];this.flip?p(q,r,u):p(u,r,q)}};return b._createClass(e)}(n),l=function(d){function e(u){var p=k.call(this);p.flip=!1;p.sign=0;p.breakNormals=!1;p.numSegments=3;p.profile=u.profile;p.flip=u.flip;p.sign=p.flip?1:-1;p.breakNormals=
u.breakNormals;p.numSegments=u.subdivisions;return p}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.getNumVertices=function(){let u=0;u=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(u+=this.profile.vertices.length);return u+=this.profile.poles.length};d.getNumIndices=function(){let u;u=2*this.profile.numSegments*(this.numSegments-1);for(let p=0;p<this.profile.numSegments;++p)u=this.profile.poleIndices[this.profile.vertexIndices[2*p]]===this.profile.poleIndices[this.profile.vertexIndices[2*
p+1]]?u+1:u+2;return 3*u};d.rebuildCapGeometry=function(u,p){u=u.frame;const h=.5*this.sign,r=g,q=f;c.set(q,0,0);for(var y=0;y<this.profile.poles.length;++y){var B=this.profile.poles[y];B.normal?p(u,B.position,B.normal,h,0):p(u,B.position,q,h,this.sign)}if(this.breakNormals)for(y=0;y<this.profile.vertices.length;++y)p(u,this.profile.vertices[y],this.profile.vertexNormals[y],0,0);for(y=0;y<this.numSegments-1;++y){var D=(1-(y+1)/this.numSegments)*Math.PI*.5;B=Math.sin(D);D=Math.cos(D);for(let z=0;z<
this.profile.vertices.length;++z){const v=this.profile.poles[this.profile.poleIndices[z]];c.subtract(r,this.profile.vertices[z],v.position);c.scale(r,r,B);v.normal?(c.add(r,r,v.position),p(u,r,v.normal,h*D,0)):(c.normalize(q,r),c.scale(q,q,B),c.add(r,r,v.position),p(u,r,q,h*D,this.sign*D))}}};d.buildTopology=function(u,p){u=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const h=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:
this.vertexBufferStart+this.profile.poles.length;for(let r=0;r<this.profile.numSegments;++r){const q=this.profile.vertexIndices[2*r],y=this.profile.vertexIndices[2*r+1],B=this.vertexBufferStart+this.profile.poleIndices[q],D=this.vertexBufferStart+this.profile.poleIndices[y];let z=u+q,v=u+y;for(let A=0;A<this.numSegments-1;++A){const t=h+A*this.profile.vertices.length+q,C=h+A*this.profile.vertices.length+y;this.flip?(p(t,v,z),p(v,t,C)):(p(z,v,t),p(C,t,v));z=t;v=C}this.flip?(p(B,v,z),B!==D&&p(B,D,v)):
(p(z,v,B),B!==D&&p(v,D,B))}};return b._createClass(e)}(n);const g=w.create(),f=w.create();a.NoCapBuilder=x;a.PathCapBuilder=n;a.RoundCapBuilder=l;a.TriangulationCapBuilder=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathExtruder":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64".split(" "),
function(a,b,c,w,n,x,m,l){let g=b._createClass(function(){}),f=function(){function h(){}var r=h.prototype;r.numProfilesPerJoin=function(){return 1};r.extrude=function(q,y,B){for(let D=0;D<y.vertices.length;++D)B(q.frame,y.vertices[D],y.vertexNormals[D],!1)};return b._createClass(h)}(),d=function(){function h(q,y){this.cutoffAngle=q;this.numBendSubdivisions=y}var r=h.prototype;r.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};r.extrude=function(q,y,B){var D=p;const {rotationAngle:z,
rotationRight:v,frame:A}=q;if(Math.abs(z)>=this.cutoffAngle){var t=q.rotationFrameUp;for(var C=0;C<this.numBendSubdivisions+1;++C){c.fromRotation(u,.5*-z+C*z/this.numBendSubdivisions,t);var E=D,F=A,H=u;m.transformMat4(E.up,F.up,H);m.transformMat4(E.right,F.right,H);for(E=0;E<y.vertices.length;++E)0<=n.dot(y.vertices[E],v)*z?B(D,y.vertices[E],y.vertexNormals[E],!1):(F=q.applyMiterStretch(k,y.vertices[E]),B(A,F,y.vertexNormals[E],!0))}}else for(D=0;D<this.numBendSubdivisions+1;++D)for(t=0;t<y.vertices.length;++t)C=
0<=n.dot(y.vertices[t],v)*z,E=q.applyMiterStretch(k,y.vertices[t]),B(A,E,y.vertexNormals[t],!C)};return b._createClass(h)}(),e=b._createClass(function(){this.up=l.create();this.right=l.create()});const k=x.create(),u=w.create(),p=new e;a.Frame2D=e;a.MiterExtruder=d;a.PathExtruder=g;a.SimpleExtruder=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./ContentObjectType",
"./Geometry"],function(a,b,c,w){w=function(n){function x(l,g,f,d,e,k,u){l=m.call(this,l,g,f,null,c.ContentObjectType.Mesh,u);l.path=d;l.geometrySR=e;l.stencilWidth=k;return l}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(w.Geometry);a.UpVectorAlignment=void 0;(function(n){n[n.World=0]="World";n[n.Path=1]="Path"})(a.UpVectorAlignment||(a.UpVectorAlignment={}));a.PathGeometry=w;a.isPathGeometry=function(n){return"path"in n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/PathGeometryData":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ./Attribute ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e){let k=function(){function A(t){this.builder=t}A.prototype.onPathChanged=
function(t){this.builder.onPathChanged()};return b._createClass(A)}(),u=function(A){function t(E){E=C.call(this,E);E.vertexAttributeColor=m.fromValues(255,255,255,255);E.size=[];E.vertexAttributePosition=l.newFloatArray(3*E.builder.numVerticesTotal);E.vertexAttributeNormal=l.newFloatArray(3*E.builder.numVerticesTotal);return E}b._inherits(t,A);var C=b._createSuper(t);A=t.prototype;A.bakeVertexColors=function(E){this.vertexAttributeColor[0]=255*E[0];this.vertexAttributeColor[1]=255*E[1];this.vertexAttributeColor[2]=
255*E[2];this.vertexAttributeColor[3]=255*(3<E.length?E[3]:1)};A.bake=function(E){this.size=E;const {numVerticesTotal:F,pathVertexData:H,path:K,positions:I,profileRightAxes:L,profileUpAxes:R,profileVertexAndNormals:O}=this.builder;for(let P=0;P<F;++P){var J=H[P],M=0===J||J===K.vertices.length-1;J*=3;const U=D;let N=0,S=0;const Q=4*P,W=n.set(z,L[Q],L[Q+1],L[Q+2]),V=n.set(v,R[Q],R[Q+1],R[Q+2]);var G=c.set(r,O[Q]*E[0],O[Q+1]*E[1]);if(M)n.cross(U,V,W),N=L[Q+3]*E[0],S=R[Q+3];else{M=q;const T=y;c.set(M,
L[Q+3],R[Q+3]);const X=c.length(M);c.normalize(M,M);const Z=c.dot(G,M);if(Math.abs(Z)>X){c.set(T,-M[1],M[0]);const Y=c.dot(G,T);c.scale(M,M,X*Math.sign(Z));c.scale(T,T,Y);c.add(G,M,T)}n.set(U,0,0,0)}M=n.set(B,W[0]*G[0]+V[0]*G[1],W[1]*G[0]+V[1]*G[1],W[2]*G[0]+V[2]*G[1]);G=3*P;this.vertexAttributePosition[G]=I[J]+M[0]+U[0]*N;this.vertexAttributePosition[G+1]=I[J+1]+M[1]+U[1]*N;this.vertexAttributePosition[G+2]=I[J+2]+M[2]+U[2]*N;J=c.set(r,O[Q+2],O[Q+3]);this.vertexAttributeNormal[G]=W[0]*J[0]+V[0]*
J[1]+U[0]*S;this.vertexAttributeNormal[G+1]=W[1]*J[0]+V[1]*J[1]+U[1]*S;this.vertexAttributeNormal[G+2]=W[2]*J[0]+V[2]*J[1]+U[2]*S}};A.createGeometryData=function(){const E=this.builder.vertexIndices.length;return new h([[d.VertexAttribute.POSITION,new f.Attribute(this.vertexAttributePosition,3,!0)],[d.VertexAttribute.NORMAL,new f.Attribute(this.vertexAttributeNormal,3,!0)],[d.VertexAttribute.COLOR,new f.Attribute(this.vertexAttributeColor,4)]],[[d.VertexAttribute.POSITION,this.builder.vertexIndices],
[d.VertexAttribute.NORMAL,this.builder.normalIndices],[d.VertexAttribute.COLOR,g.getZeroIndexArray(E)]])};A.onPathChanged=function(E){b._get(b._getPrototypeOf(t.prototype),"onPathChanged",this).call(this,E);this.bake(this.size)};A.intersect=function(E,F,H){const K=this.builder.vertexIndices,I=new f.Attribute(this.vertexAttributePosition,3);e.intersectTriangles(E,F,0,K.length/3,K,I,void 0,void 0,H)};return b._createClass(t)}(k),p=function(A){function t(E,F,H,K){var I=C.call(this,E);I.sizeAttributeValue=
F;I.colorAttributeValue=H;I.opacityAttributeValue=K;I.vvData=null;I.baked=new u(E);I.vvData=l.newFloatArray(4*I.builder.path.vertices.length);for(E=0;E<I.builder.path.vertices.length;++E)I.vvData[4*E]=F,I.vvData[4*E+1]=H,I.vvData[4*E+2]=K,I.vvData[4*E+3]=0===E||E===I.builder.path.vertices.length-1?1:0;return I}b._inherits(t,A);var C=b._createSuper(t);A=t.prototype;A.createGeometryData=function(){return new h([[d.VertexAttribute.POSITION,new f.Attribute(this.builder.positions,3,!0)],[d.VertexAttribute.PROFILERIGHT,
new f.Attribute(this.builder.profileRightAxes,4,!0)],[d.VertexAttribute.PROFILEUP,new f.Attribute(this.builder.profileUpAxes,4,!0)],[d.VertexAttribute.PROFILEVERTEXANDNORMAL,new f.Attribute(this.builder.profileVertexAndNormals,4,!0)],[d.VertexAttribute.FEATUREVALUE,new f.Attribute(this.vvData,4,!0)]],[[d.VertexAttribute.POSITION,this.builder.pathVertexIndices],[d.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[d.VertexAttribute.PROFILEUP,this.builder.vertexIndices],[d.VertexAttribute.PROFILEVERTEXANDNORMAL,
this.builder.vertexIndices],[d.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]])};A.onPathChanged=function(E){b._get(b._getPrototypeOf(t.prototype),"onPathChanged",this).call(this,E);if(E=E.getMutableAttribute(d.VertexAttribute.POSITION))E.data=this.builder.positions};return b._createClass(t)}(k),h=b._createClass(function(A,t){this.vertexAttributes=A;this.indices=t});const r=w.create(),q=w.create(),y=w.create(),B=x.create(),D=x.create(),z=x.create(),v=x.create();a.FastUpdatePathGeometry=
p;a.PathGeometryData=k;a.StaticPathGeometry=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil".split(" "),function(a,b,c,w,n,x,m){const l=w.create();a.computeMinimumRotationTangentFrame=function(g,f){let d=null;const e=g.vertices.length,k=w.create(),
u=w.create(),p=w.create(),h=w.create(),r=w.create(),q=w.create(),y=n.create();let B=g.vertices[0];c.copy(u,f);c.set(k,0,1,0);m.makeOrthoBasisDirUpFallback(B.vRight,u,k,k,p,u,.99619469809);c.copy(B.frame.up,u);c.copy(B.frame.right,p);f=g.positions;let D=g.offset;d=B;for(let v=1;v<e;++v){B=g.vertices[v];c.add(r,B.vLeft,B.vRight);var z=c.length(r);0<z?(z=1/Math.sqrt(z),r[0]*=z,r[1]*=z,r[2]*=z):(r[0]=B.vRight[0],r[1]=B.vRight[1],r[2]=B.vRight[2]);q[0]=f[D]+d.frame.up[0];q[1]=f[D+1]+d.frame.up[1];q[2]=
f[D+2]+d.frame.up[2];D+=3;z=c.set(l,f[D],f[D+1],f[D+2]);n.fromPositionAndNormal(z,r,y);n.intersectRay(y,x.wrap(q,B.vLeft),h)?(h[0]-=f[D],h[1]-=f[D+1],h[2]-=f[D+2],c.normalize(u,h),c.cross(p,r,u),c.normalize(p,p)):m.makeOrthoBasisDirUpFallback(r,d.frame.up,d.frame.right,k,p,u,.99619469809);c.copy(B.frame.up,u);c.copy(B.frame.right,p);d=B}};a.profileSpaceToVertexSpace=function(g,f,d){g[0]=d[0]*f.right[0]+d[1]*f.up[0];g[1]=d[0]*f.right[1]+d[1]*f.up[1];g[2]=d[0]*f.right[2]+d[1]*f.up[2]};a.vertexSpaceToProfileSpace=
function(g,f,d){b.set(g,c.dot(d,f.right),c.dot(d,f.up))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathProfile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64"],function(a,b,c){let w=function(){function n(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[]}var x=n.prototype;x.addVertex=function(m,l){this.vertices.push(c.clone(m));this.vertexNormals.push(c.clone(l));
return this.vertices.length-1};x.addPole=function(m,l=null){this.poles.push({position:c.clone(m),normal:l?c.clone(l):null});return this.poles.length-1};x.addSegment=function(m,l=null){this.vertexIndices.push(m.v0);this.vertexIndices.push(m.v1);l&&(this.poleIndices.push(l.v0),this.poleIndices.push(l.v1))};x.translate=function(m,l){for(const g of this.vertices)g[0]+=m,g[1]+=l;for(const g of this.poles)g.position[0]+=m,g.position[1]+=l};b._createClass(n,[{key:"numSegments",get:function(){return this.vertexIndices.length/
2}}]);return n}();a.PathProfile=w;a.creatQuadProfile=function(){const n=new w,x=c.fromValues(-.5,-.5),m=c.fromValues(.5,-.5),l=c.fromValues(.5,.5),g=c.fromValues(-.5,.5),f=c.fromValues(0,-1),d=c.fromValues(1,0),e=c.fromValues(0,1),k=c.fromValues(-1,0);n.addPole(c.fromValues(0,.5),e);n.addPole(c.fromValues(0,.5));n.addPole(c.fromValues(0,-.5));n.addPole(c.fromValues(0,-.5),f);n.addVertex(x,f);n.addVertex(m,f);n.addSegment({v0:0,v1:1},{v0:3,v1:3});n.addVertex(m,d);n.addVertex(l,d);n.addSegment({v0:2,
v1:3},{v0:2,v1:1});n.addVertex(l,e);n.addVertex(g,e);n.addSegment({v0:4,v1:5},{v0:0,v1:0});n.addVertex(g,k);n.addVertex(x,k);n.addSegment({v0:6,v1:7},{v0:1,v1:2});return n};a.createCircleProfile=function(n=20){const x=new w,m={v0:0,v1:0};x.addPole(c.fromValues(0,0));for(var l=0;l<n;++l){var g=2*l*Math.PI/n,f=Math.cos(g);const d=Math.sin(g);g=c.fromValues(.5*f,.5*d);f=c.fromValues(f,d);x.addVertex(g,f)}for(l=0;l<n-1;++l)x.addSegment({v0:l,v1:l+1},m);x.addSegment({v0:n-1,v1:0},m);return x};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathVertex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./PathExtruder ./PathGeometry".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){let e=function(){function C(){this.vLeft=g.create();this.vRight=g.create();this.vMinSiblingLength=
0;this.frame=new f.Frame2D}C.prototype.setFrameFromUpVector=function(E){l.copy(this.frame.up,E);l.add(v,this.vLeft,this.vRight);l.normalize(v,v);l.scale(z,this.frame.up,l.dot(v,this.frame.up));l.subtract(A,v,z);l.normalize(A,A);l.cross(this.frame.right,A,this.frame.up)};b._createClass(C,[{key:"foldingAngle",get:function(){return Math.PI-this.rotationAngle}}]);return C}(),k=function(C){function E(){return F.apply(this,arguments)}b._inherits(E,C);var F=b._createSuper(E);E.prototype.applyMiterStretch=
function(H,K){var I=this.rotationAngle;if(0>=Math.abs(I))return K;I=c.reciprocalClamped(Math.cos(.5*I));return x.set(H,(1+(I-1))*K[0],K[1])};b._createClass(E,[{key:"rotationFrameUp",get:function(){return this.frame.up}},{key:"rotationRight",get:function(){return m.UNIT_X}},{key:"rotationAngle",get:function(){l.scale(B,this.frame.up,l.dot(this.frame.up,this.vLeft));l.subtract(B,this.vLeft,B);l.negate(B,B);l.normalize(B,B);l.scale(D,this.frame.up,l.dot(this.frame.up,this.vRight));l.subtract(D,this.vRight,
D);l.normalize(D,D);l.cross(y,this.rotationFrameUp,this.vLeft);return Math.sign(l.dot(y,this.vRight))*(Math.PI-c.acosClamped(l.dot(B,D)))}},{key:"maxStretchDistance",get:function(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}}]);return E}(e),u=function(C){function E(){return F.apply(this,arguments)}b._inherits(E,C);var F=b._createSuper(E);E.prototype.applyMiterStretch=function(H,K){var I=this.rotationAngle;if(0===Math.abs(I))return K;I=c.reciprocalClamped(Math.cos(.5*I));
const L=this.rotationRight;I=w.set(t,1+(I-1)*L[0]*L[0],(I-1)*L[0]*L[1],(I-1)*L[0]*L[1],1+(I-1)*L[1]*L[1]);return x.transformMat2(H,K,I)};b._createClass(E,[{key:"rotationFrameUp",get:function(){const H=Math.sign(l.dot(this.frame.right,this.vRight));l.cross(p,this.vRight,this.vLeft);l.scale(p,p,H);return l.normalize(p,p)}},{key:"rotationRight",get:function(){var H=this.rotationFrameUp,K=l.dot(H,this.frame.up);H=l.dot(H,this.frame.right);l.scale(r,this.frame.up,-H);l.scale(q,this.frame.right,K);l.add(r,
r,q);l.normalize(r,r);K=this.frame;H=r;x.set(h,l.dot(H,K.right),l.dot(H,K.up));return h}},{key:"rotationAngle",get:function(){const H=Math.sign(l.dot(this.frame.right,this.vRight));l.negate(y,this.vLeft);return-H*(Math.PI-c.acosClamped(l.dot(y,this.vRight)))}},{key:"maxStretchDistance",get:function(){return Math.abs(this.vMinSiblingLength*c.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}}]);return E}(e);const p=g.create(),h=m.create(),r=g.create(),q=g.create(),y=g.create(),B=g.create(),D=g.create(),
z=g.create(),v=g.create(),A=g.create(),t=n.create();a.PathVertex=e;a.newPathVertex=function(C){switch(C){case d.UpVectorAlignment.World:return new k;case d.UpVectorAlignment.Path:return new u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(t,C){t[0]=C[0];t[1]=C[1];t[2]=C[2];t[3]=C[3];return t}function w(t){t[0]=1;t[1]=0;t[2]=0;t[3]=1;return t}function n(t,C,E,F,H){t[0]=C;t[1]=E;t[2]=F;t[3]=H;return t}
function x(t,C){if(t===C){const E=C[1];t[1]=C[2];t[2]=E}else t[0]=C[0],t[1]=C[2],t[2]=C[1],t[3]=C[3];return t}function m(t,C){const E=C[0],F=C[1],H=C[2];C=C[3];let K=E*C-H*F;if(!K)return null;K=1/K;t[0]=C*K;t[1]=-F*K;t[2]=-H*K;t[3]=E*K;return t}function l(t,C){const E=C[0];t[0]=C[3];t[1]=-C[1];t[2]=-C[2];t[3]=E;return t}function g(t){return t[0]*t[3]-t[2]*t[1]}function f(t,C,E){const F=C[0],H=C[1],K=C[2];C=C[3];const I=E[0],L=E[1],R=E[2];E=E[3];t[0]=F*I+K*L;t[1]=H*I+C*L;t[2]=F*R+K*E;t[3]=H*R+C*E;
return t}function d(t,C,E){const F=C[0],H=C[1],K=C[2];C=C[3];const I=Math.sin(E);E=Math.cos(E);t[0]=F*E+K*I;t[1]=H*E+C*I;t[2]=F*-I+K*E;t[3]=H*-I+C*E;return t}function e(t,C,E){const F=C[1],H=C[2],K=C[3],I=E[0];E=E[1];t[0]=C[0]*I;t[1]=F*I;t[2]=H*E;t[3]=K*E;return t}function k(t,C){const E=Math.sin(C);C=Math.cos(C);t[0]=C;t[1]=E;t[2]=-E;t[3]=C;return t}function u(t,C){t[0]=C[0];t[1]=0;t[2]=0;t[3]=C[1];return t}function p(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function h(t){return Math.sqrt(t[0]**
2+t[1]**2+t[2]**2+t[3]**2)}function r(t,C,E,F){t[2]=F[2]/F[0];E[0]=F[0];E[1]=F[1];E[3]=F[3]-t[2]*E[1];return[t,C,E]}function q(t,C,E){t[0]=C[0]+E[0];t[1]=C[1]+E[1];t[2]=C[2]+E[2];t[3]=C[3]+E[3];return t}function y(t,C,E){t[0]=C[0]-E[0];t[1]=C[1]-E[1];t[2]=C[2]-E[2];t[3]=C[3]-E[3];return t}function B(t,C){return t[0]===C[0]&&t[1]===C[1]&&t[2]===C[2]&&t[3]===C[3]}function D(t,C){const E=t[0],F=t[1],H=t[2];t=t[3];const K=C[0],I=C[1],L=C[2];C=C[3];const R=b.getEpsilon();return Math.abs(E-K)<=R*Math.max(1,
Math.abs(E),Math.abs(K))&&Math.abs(F-I)<=R*Math.max(1,Math.abs(F),Math.abs(I))&&Math.abs(H-L)<=R*Math.max(1,Math.abs(H),Math.abs(L))&&Math.abs(t-C)<=R*Math.max(1,Math.abs(t),Math.abs(C))}function z(t,C,E){t[0]=C[0]*E;t[1]=C[1]*E;t[2]=C[2]*E;t[3]=C[3]*E;return t}function v(t,C,E,F){t[0]=C[0]+E[0]*F;t[1]=C[1]+E[1]*F;t[2]=C[2]+E[2]*F;t[3]=C[3]+E[3]*F;return t}const A=Object.freeze(Object.defineProperty({__proto__:null,LDU:r,add:q,adjoint:l,copy:c,determinant:g,equals:D,exactEquals:B,frob:h,fromRotation:k,
fromScaling:u,identity:w,invert:m,mul:f,multiply:f,multiplyScalar:z,multiplyScalarAndAdd:v,rotate:d,scale:e,set:n,str:p,sub:y,subtract:y,transpose:x},Symbol.toStringTag,{value:"Module"}));a.LDU=r;a.add=q;a.adjoint=l;a.copy=c;a.determinant=g;a.equals=D;a.exactEquals=B;a.frob=h;a.fromRotation=k;a.fromScaling=u;a.identity=w;a.invert=m;a.mat2=A;a.mul=f;a.multiply=f;a.multiplyScalar=z;a.multiplyScalarAndAdd=v;a.rotate=d;a.scale=e;a.set=n;a.str=p;a.sub=y;a.subtract=y;a.transpose=x})},"esri/chunks/mat2f64":function(){define(["exports"],
function(a){function b(){return[1,0,0,1]}function c(m){return[m[0],m[1],m[2],m[3]]}function w(m,l,g,f){return[m,l,g,f]}function n(m,l){return new Float64Array(m,l,4)}const x=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:n,fromValues:w},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.mat2f64=x})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){f=function(y){function B(z){z=D.call(this,z,new q);z.supportsEdges=!0;z._vertexAttributeLocations=p.vertexAttributeLocations;z._configuration=new p.PathTechniqueConfiguration;z._vertexBufferLayout=B.getVertexBufferLayout();return z}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.getConfiguration=function(z,v){this._configuration.output=z;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=
!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(z===m.ShaderOutput.Color||z===m.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?l.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?l.NormalsDoubleSidedMode.WindingOrder:
l.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=v.ssaoHelper.active?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=v.transparencyPassType;this._configuration.hasMultipassTerrain=v.multipassTerrain.enabled;this._configuration.cullAboveGround=v.multipassTerrain.cullAboveGround;return this._configuration};y.isVisibleForOutput=function(z){return z===m.ShaderOutput.Shadow||z===m.ShaderOutput.ShadowExcludeHighlight||
z===m.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};y.isVisible=function(){return b._get(b._getPrototypeOf(B.prototype),"isVisible",this).call(this)&&0<this.parameters.opacity};y.intersect=function(z,v,A,t,C,E){if(d.isPathGeometry(z)){v=z.path;var F=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:I,factor:L,minSize:R,maxSize:O}=this.parameters.vvSize;var H=v.sizeAttributeValue;F[0]*=c.clamp(I[0]+H*L[0],R[0],O[0]);F[1]*=c.clamp(I[2]+H*L[2],
R[2],O[2])}H=Math.max(F[0],F[1]);z=z.boundingInfo;if(w.isNone(z))this._intersectTriangles(v,F,t,C,E);else{z=n.fromValues(z.bbMin[0]-H,z.bbMin[1]-H,z.bbMin[2]-H,z.bbMax[0]+H,z.bbMax[1]+H,z.bbMax[2]+H);H=[C[0]-t[0],C[1]-t[1],C[2]-t[2]];var K=Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]);h.intersectAabbInvDir(z,t,[K/H[0],K/H[1],K/H[2]],A.tolerance)&&this._intersectTriangles(v,F,t,C,E)}}};y._intersectTriangles=function(z,v,A,t,C){z.baked.size&&z.baked.size[0]===v[0]&&z.baked.size[1]===v[1]||z.baked.bake(v);
z.baked.intersect(A,t,C)};y.createBufferWriter=function(){return new u.DefaultBufferWriter(this._vertexBufferLayout)};y.requiresSlot=function(z,v){switch(v){case m.ShaderOutput.Shadow:case m.ShaderOutput.ShadowHighlight:case m.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case m.ShaderOutput.Color:case m.ShaderOutput.Alpha:case m.ShaderOutput.Depth:case m.ShaderOutput.Normal:case m.ShaderOutput.Highlight:case m.ShaderOutput.ObjectAndLayerIdColor:return z===(this.parameters.transparent?
e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.OPAQUE_MATERIAL)||z===e.RenderSlot.DRAPED_MATERIAL;default:return!1}};y.createGLMaterial=function(z){return new r(z)};B.getVertexBufferLayout=function(){return x.newLayout().vec3f(k.VertexAttribute.POSITION).vec4f(k.VertexAttribute.PROFILERIGHT).vec4f(k.VertexAttribute.PROFILEUP).vec4f(k.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(k.VertexAttribute.FEATUREVALUE)};return b._createClass(B)}(f.Material);let r=function(y){function B(){return D.apply(this,
arguments)}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y._updateOccludeeState=function(z){z.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:z.hasOccludees})};y._updateShadowState=function(z){(w.isNone(this.technique)||z.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:z.shadowMap.enabled})};y.beginSlot=function(z){if(this._output===m.ShaderOutput.Color||this._output===m.ShaderOutput.Alpha)this._updateShadowState(z),
this._updateOccludeeState(z);return this.ensureTechnique(p.PathTechnique,z)};return b._createClass(B)}(g),q=function(y){function B(){var z=D.apply(this,arguments);z.doubleSided=!1;z.doubleSidedType="normal";z.receiveSSAO=!0;z.receiveShadows=!1;z.castShadows=!0;z.hasSlicePlane=!1;z.transparent=!1;z.hasOccludees=!1;return z}b._inherits(B,y);var D=b._createSuper(B);return b._createClass(B)}(p.PathPassParameters);a.PathMaterial=f;a.PathMaterialParameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){const z=new Map([[q.VertexAttribute.POSITION,0],[q.VertexAttribute.PROFILERIGHT,1],[q.VertexAttribute.PROFILEUP,2],[q.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[q.VertexAttribute.FEATUREVALUE,4]]);l=function(v){function A(){var C=t.apply(this,arguments);C.ambient=n.fromValues(.2,.2,.2);C.diffuse=n.fromValues(.8,.8,.8);C.specular=n.fromValues(0,0,0);C.opacity=1;return C}c._inherits(A,v);var t=c._createSuper(A);return c._createClass(A)}(l.PathVertexPositionPassParameters);
e=function(v){function A(){return t.apply(this,arguments)}c._inherits(A,v);var t=c._createSuper(A);v=A.prototype;v.initializeConfiguration=function(C,E){E.spherical=C.viewingMode===x.ViewingMode.Global;E.doublePrecisionRequiresObfuscation=C.rctx.driverTest.doublePrecisionRequiresObfuscation.result};v.initializeProgram=function(C){return new p.Program(C.rctx,A.shader.get().build(this.configuration),z)};v.initializePipeline=function(){const C=this.configuration.transparencyPassType,E=this.configuration,
F=C===r.TransparencyPassType.NONE,H=C===r.TransparencyPassType.FrontFace;return D.makePipelineState({blending:E.output!==m.ShaderOutput.Color&&E.output!==m.ShaderOutput.Alpha||!E.transparent?null:F?u.blendingDefault:u.oitBlending(C),culling:E.hasSlicePlane&&!E.transparent&&E.doubleSidedMode!==g.NormalsDoubleSidedMode.None?D.frontFaceCullingParams:null,depthTest:{func:u.oitDepthTest(C)},depthWrite:F||H?D.defaultDepthWriteParams:null,colorWrite:D.defaultColorWriteParams,stencilWrite:E.hasOccludees?
h.stencilWriteMaskOn:null,stencilTest:E.hasOccludees?h.stencilBaseAllZerosParams:null,polygonOffset:F||H?null:u.OITPolygonOffset})};return c._createClass(A)}(e.ShaderTechnique);e.shader=new d.ReloadableShaderModule(B.Path,()=>new Promise((v,A)=>a(["../shaders/Path.glsl"],v,A)));d=function(v){function A(){var C=t.apply(this,arguments);C.output=m.ShaderOutput.Color;C.doubleSidedMode=g.NormalsDoubleSidedMode.None;C.transparencyPassType=r.TransparencyPassType.NONE;C.spherical=!1;C.receiveShadows=!1;C.receiveAmbientOcclusion=
!1;C.vvSize=!1;C.vvColor=!1;C.vvOpacity=!1;C.hasSlicePlane=!1;C.transparent=!1;C.hasOccludees=!1;C.hasMultipassTerrain=!1;C.cullAboveGround=!1;C.doublePrecisionRequiresObfuscation=!1;return C}c._inherits(A,v);var t=c._createSuper(A);return c._createClass(A)}(y.DefaultTechniqueConfiguration);w.__decorate([k.parameter({count:m.ShaderOutput.COUNT})],d.prototype,"output",void 0);w.__decorate([k.parameter({count:g.NormalsDoubleSidedMode.COUNT})],d.prototype,"doubleSidedMode",void 0);w.__decorate([k.parameter({count:r.TransparencyPassType.COUNT})],
d.prototype,"transparencyPassType",void 0);w.__decorate([k.parameter()],d.prototype,"spherical",void 0);w.__decorate([k.parameter()],d.prototype,"receiveShadows",void 0);w.__decorate([k.parameter()],d.prototype,"receiveAmbientOcclusion",void 0);w.__decorate([k.parameter()],d.prototype,"vvSize",void 0);w.__decorate([k.parameter()],d.prototype,"vvColor",void 0);w.__decorate([k.parameter()],d.prototype,"vvOpacity",void 0);w.__decorate([k.parameter()],d.prototype,"hasSlicePlane",void 0);w.__decorate([k.parameter()],
d.prototype,"transparent",void 0);w.__decorate([k.parameter()],d.prototype,"hasOccludees",void 0);w.__decorate([k.parameter()],d.prototype,"hasMultipassTerrain",void 0);w.__decorate([k.parameter()],d.prototype,"cullAboveGround",void 0);w.__decorate([k.parameter()],d.prototype,"doublePrecisionRequiresObfuscation",void 0);w.__decorate([k.parameter({constValue:f.PBRMode.Disabled})],d.prototype,"pbrMode",void 0);w.__decorate([k.parameter({constValue:!0})],d.prototype,"hasVvInstancing",void 0);w.__decorate([k.parameter({constValue:!1})],
d.prototype,"useCustomDTRExponentForWater",void 0);w.__decorate([k.parameter({constValue:!1})],d.prototype,"useFillLights",void 0);b.PathPassParameters=l;b.PathTechnique=e;b.PathTechniqueConfiguration=d;b.vertexAttributeLocations=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=function(k){function u(){var h=p.apply(this,arguments);h.size=c.fromValues(1,1);return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(d.VisualVariablePassParameters);a.PathVertexPosition=function(k,u){const p=f.VertexAttribute.FEATUREVALUE;k.attributes.add(p,"vec4");const h=k.vertex;h.code.add(g.glsl`
  bool isCapVertex() {
    return ${p}.w == 1.0;
  }
  `);h.uniforms.add(new n.Float2PassUniform("size",r=>r.size));u.vvSize?(h.uniforms.add(new x.Float3PassUniform("vvSizeMinSize",r=>r.vvSize.minSize)),h.uniforms.add(new x.Float3PassUniform("vvSizeMaxSize",r=>r.vvSize.maxSize)),h.uniforms.add(new x.Float3PassUniform("vvSizeOffset",r=>r.vvSize.offset)),h.uniforms.add(new x.Float3PassUniform("vvSizeFactor",r=>r.vvSize.factor)),h.code.add(g.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${p}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):h.code.add(g.glsl`vec2 getSize(){
return size;
}`);u.vvOpacity?(h.constants.add("vvOpacityNumber","int",8),h.uniforms.add([new l.FloatsPassUniform("vvOpacityValues",r=>r.vvOpacity.values,8),new l.FloatsPassUniform("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,8)]),h.code.add(g.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${p}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):h.code.add(g.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);u.vvColor?(h.constants.add("vvColorNumber","int",d.vvColorNumber),h.uniforms.add([new l.FloatsPassUniform("vvColorValues",r=>r.vvColor.values,d.vvColorNumber),new m.Float4sPassUniform("vvColorColors",r=>r.vvColor.colors,d.vvColorNumber)]),h.code.add(g.glsl`
    vec4 getColor() {
      float value = ${p}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):h.code.add(g.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);k.include(w.PositionAttribute);k.attributes.add(f.VertexAttribute.PROFILERIGHT,"vec4");k.attributes.add(f.VertexAttribute.PROFILEUP,"vec4");k.attributes.add(f.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");h.code.add(g.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);h.code.add(g.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);h.code.add(g.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);h.code.add(g.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z){function v(t){const C=new D.ShaderBuilder,{vertex:E,fragment:F}=C;r.addProjViewLocalOrigin(E,t);C.varyings.add("vpos","vec3");C.include(x.PathVertexPosition,t);if(t.output===c.ShaderOutput.Color||t.output===c.ShaderOutput.Alpha)C.include(n.Transform,t),C.include(p.ReadShadowMapDraw,t),C.include(b.ForwardLinearDepth,t),C.varyings.add("vnormal","vec3"),C.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&C.varyings.add("depth","float"),E.code.add(B.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);C.include(e.multipassTerrainTest,t);switch(t.output){case c.ShaderOutput.Alpha:C.include(w.SliceDraw,t);F.uniforms.add(new y.FloatPassUniform("opacity",H=>H.opacity));F.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case c.ShaderOutput.Color:C.include(w.SliceDraw,t);C.include(f.EvaluateSceneLighting,t);C.include(g.EvaluateAmbientOcclusion,t);C.include(p.ReadShadowMapDraw,t);C.include(k.Normals,t);r.addCameraPosition(F,t);f.addAmbientBoostFactor(F);f.addLightingGlobalFactor(F);F.uniforms.add([E.uniforms.get("localOrigin"),new q.Float3PassUniform("ambient",H=>H.ambient),new q.Float3PassUniform("diffuse",H=>H.diffuse),new q.Float3PassUniform("specular",H=>H.specular),new y.FloatPassUniform("opacity",
H=>H.opacity)]);F.include(h.ColorConversion);d.addMainLightIntensity(F);F.code.add(B.glsl`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":t.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===z.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
        }
      `);break;case c.ShaderOutput.Depth:case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:C.include(n.Transform,t);b.addNearFar(C);C.varyings.add("depth","float");E.code.add(B.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);C.include(w.SliceDraw,t);C.include(m.OutputDepth,t);F.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case c.ShaderOutput.Normal:C.include(n.Transform,t);C.include(u.NormalUtils,t);r.addViewNormal(E);C.varyings.add("vnormal","vec3");E.code.add(B.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);C.include(w.SliceDraw,t);F.code.add(B.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case c.ShaderOutput.Highlight:C.include(n.Transform,t),C.include(u.NormalUtils,t),C.varyings.add("vnormal","vec3"),E.code.add(B.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),C.include(w.SliceDraw,t),C.include(l.OutputHighlight,t),F.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return C}const A=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.Path=A;a.build=v})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){const E=["polyline","polygon","extent"];u=function(I){function L(O,J,M,G){O=R.call(this,O,J,M,G);O._needsUV=!1;O._hasOutline=!1;return O}b._inherits(L,I);var R=b._createSuper(L);I=L.prototype;I.doLoad=async function(){};I._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};I._ensureFillMaterial=function(){if(!w.isSome(this._material)){var O=w.get(this.symbolLayer,"material","color");O=this._getCombinedOpacityAndColor(O);
this._material=q.createMaterial(this.symbolLayer,{color:O,transparent:1>O[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled,draped:this.draped});this._needsUV=this._material instanceof t.PatternMaterial;this._context.stage.add(this._material)}};I._ensureOutlineMaterial=function(){const O=this.symbolLayer.outline;!w.isSome(this._outlineMaterial)&&this._isValidOutline(O)&&(this._hasOutline=!0,this._outlineMaterial=
(J=>{const M=A.getStipplePatternForLinePattern(O.pattern);return new C.RibbonLineMaterial({width:J,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:M,stippleScaleWithLineWidth:!0,cap:h.parseCapType(O.patternCap||"butt")})})(n.pt2px(O.size)),this._context.stage.add(this._outlineMaterial))};I._isValidOutline=function(O){return w.isSome(O)&&null!=O.size&&0<O.size&&w.isSome(O.color)&&(w.isNone(O.pattern)||"style"!==O.pattern.type||
"none"!==O.pattern.style)};I.destroy=function(){b._get(b._getPrototypeOf(L.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};I.createGraphics3DGraphic=function(O){const J=O.graphic;if(!this._validateGeometry(J.geometry,E,this.symbolLayer.type))return null;O=this._getVertexOpacityAndColor(O.renderingInfo,255);const M=this.setGraphicElevationContext(J,new d.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===M.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(J,O):this._createAs3DShape(J,O,M)};I.layerOpacityChanged=function(){if(w.isSome(this._material)){var O=this._material.parameters.color,J=w.get(this.symbolLayer,"material","color");J=this._getCombinedOpacity(J);this._material.setParameters({color:[O[0],O[1],O[2],J],transparent:1>J||this.needsDrivenTransparentPass})}w.isSome(this._outlineMaterial)&&(O=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[O[0],O[1],O[2],this._getOutlineOpacity()]}))};I.layerElevationInfoChanged=function(O,J,M){const G=this._elevationContext.mode;M=f.elevationModeChangeUpdateType(L.elevationModeChangeTypes,M,G);if(M!==f.SymbolUpdateType.UPDATE)return M;const P=f.needsElevationUpdates2D(G);return this.updateGraphics3DGraphicElevationInfo(O,J,()=>P)};I.slicePlaneEnabledChanged=function(){w.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
w.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};I.physicalBasedRenderingChanged=function(){return!0};I._createAs3DShape=function(O,J,M){const G=r.geometryAsPolygon(O.geometry);if(w.isNone(G))return null;var P=D.geometryToRenderInfo(G,this._context.elevationProvider,this._context.renderCoordsHelper,M);J=new H(P,J,this._context.layer.uid,O.uid);P=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=g.newFloatArray(4*
P,!0),J.boundingRect=l.newDoubleArray(9*P,!0),y.createMapSpaceUVCoords(J.uvMapSpace,J.boundingRect,J.renderData.position,this._context.renderCoordsHelper));J.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(J);this._createAs3DShapeFill(J);this._hasOutline&&this._createAs3DShapeOutline(J);this._logGeometryCreationWarnings(J.renderData,G.rings,"rings","FillSymbol3DLayer");if(0===J.outGeometries.length)return null;O=new z.Object3D({geometries:J.outGeometries,castShadow:!1,
metadata:{layerUid:this._context.layer.uid,graphicUid:O.uid}});O=new k.Graphics3DObject3DGraphicLayer(this,O,J.outGeometries,null,null,q.uvElevationAligner,M);O.alignedSampledElevation=J.renderData.sampledElevation;O.needsElevationUpdates=f.needsElevationUpdates2D(M.mode);return O};I._createAs3DShapeFill=function(O){var J=O.renderData.polygons;for(const {position:M,mapPositions:G,holeIndices:P,index:U,count:N}of J){if(w.isSome(this._context.clippingExtent)&&(m.empty(F),m.expandWithBuffer(F,G),!m.intersectsClippingArea(F,
this._context.clippingExtent)))continue;J=x.earcut(G,P,3);0!==J.length&&(J=r.createColorGeometry({material:w.unwrap(this._material),indices:J,mapPositions:G,attributeData:{position:M,color:O.color,uvMapSpace:this._needsUV?g.floatSubArray(O.uvMapSpace,4*U,4*N):null,boundingRect:this._needsUV?l.doubleSubArray(O.boundingRect,9*U,9*N):null,objectAndLayerIdColor:O.objectAndLayerIdColor}}),O.outGeometries.push(J))}};I._createAs3DShapeOutline=function(O){if(this._hasOutline){var J=O.renderData.outlines;
for(let M=0;M<J.length;++M){const {mapPositions:G,position:P}=J[M];if(w.isSome(this._context.clippingExtent)&&(m.empty(F),m.expandWithBuffer(F,G),!m.intersectsClippingArea(F,this._context.clippingExtent)))continue;const U=B.createGeometry(w.unwrap(this._outlineMaterial),{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:G,attributeData:{position:P}},O.objectAndLayerIdColor);O.outGeometries.push(U)}}};I._createAsOverlay=function(O,J){const M=r.geometryAsPolygon(O.geometry);if(w.isNone(M))return null;
w.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;w.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const G=D.geometryToRenderInfoDraped(M,this._context.overlaySR);O=new K(G,J,this._context.layer.uid,O.uid);J=O.renderData.position.length/3;this._needsUV&&(O.uvMapSpace=g.newFloatArray(4*J,!0),y.createMapSpaceUVCoordsDraped(O.uvMapSpace,O.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));
O.outBoundingBox=m.empty();O.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(O);this._createAsOverlayFill(O);this._hasOutline&&this._createAsOverlayOutline(O);this._logGeometryCreationWarnings(O.renderData,M.rings,"rings","FillSymbol3DLayer");return 0===O.outGeometries.length?null:new e(this,O.outGeometries,O.outBoundingBox,this._context.drapeSourceRenderer)};I._createAsOverlayFill=function(O){var J=O.renderData.polygons;for(const {position:M,holeIndices:G,index:P,count:U}of J){J=
m.empty(F);m.expandWithBuffer(J,M);if(!m.intersectsClippingArea(J,this._context.clippingExtent))continue;const N=x.earcut(M,G,3);0!==N.length&&(m.expandWithAABB(O.outBoundingBox,J),J=r.createColorGeometry({material:w.unwrap(this._material),indices:N,attributeData:{position:M,color:O.color,uvMapSpace:this._needsUV?g.floatSubArray(O.uvMapSpace,4*P,4*U):null,objectAndLayerIdColor:O.objectAndLayerIdColor}}),O.outGeometries.push(new v.RenderGeometry(J,O)))}};I._createAsOverlayOutline=function(O){if(this._hasOutline){var J=
O.renderData.outlines;for(let G=0;G<J.length;++G){var {position:M}=J[G];m.empty(F);m.expandWithBuffer(F,M);m.intersectsClippingArea(F,this._context.clippingExtent)&&(m.expandWithAABB(O.outBoundingBox,F),M=B.createGeometry(w.unwrap(this._outlineMaterial),{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:M}},O.objectAndLayerIdColor),O.outGeometries.push(new v.RenderGeometry(M,O)))}}};I._getOutlineOpacity=
function(){const O=w.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(w.isSome(O)?O.a:0)};I._getOutlineColor=function(){const O=w.get(this.symbolLayer,"outline","color"),J=this._getOutlineOpacity();return p.mixinColorAndOpacity(w.isSome(O)?c.toUnitRGB(O):null,J)};I.test=function(){return{...b._get(b._getPrototypeOf(L.prototype),"test",this).call(this),createAsOverlay:(O,J)=>this._createAsOverlay(O,J),createAs3DShape:(O,J,M)=>this._createAs3DShape(O,J,M)}};return b._createClass(L)}(u.Graphics3DSymbolLayer);
u.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.RECREATE,staysOnTheGround:f.SymbolUpdateType.NONE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const F=m.create();let H=function(I){function L(O,J,M,G){O=R.call(this,O,M,G);O.color=J;return O}b._inherits(L,I);var R=b._createSuper(L);return b._createClass(L)}(r.PolygonCreationDataBase),K=function(I){function L(O,J,M,G){O=R.call(this,O,M,G);O.color=J;return O}b._inherits(L,I);var R=b._createSuper(L);return b._createClass(L)}(r.PolygonCreationDataBase);
a.Graphics3DPolygonFillSymbolLayer=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(a,b,c,w,n,x,m,l,g,f){function d(u){switch(u){case "horizontal":return f.Style.Horizontal;
case "vertical":return f.Style.Vertical;case "cross":return f.Style.Cross;case "forward-diagonal":return f.Style.ForwardDiagonal;case "backward-diagonal":return f.Style.BackwardDiagonal;case "diagonal-cross":return f.Style.DiagonalCross}}function e(u){return u.material instanceof g.PatternMaterial&&!u.material.parameters.draped}function k(u,p){if(e(u)){const h=u.vertexAttributes.get(m.VertexAttribute.POSITION).data,r=u.getMutableAttribute(m.VertexAttribute.UVMAPSPACE).data;u=u.getMutableAttribute(m.VertexAttribute.BOUNDINGRECT).data;
x.createMapSpaceUVCoords(r,u,h,p)}}a.createMaterial=function(u,p){u=u?.pattern??null;if(c.isNone(u))return new l.ColorMaterial(p);if("none"===u.style||"solid"===u.style)return"none"===u.style&&(p.color=w.fromValues(0,0,0,0),p.transparent=!0),new l.ColorMaterial(p);p.style=d(u.style);return new g.PatternMaterial(p)};a.parsePatternStyle=d;a.requiresUVUpdates=e;a.updateMapSpaceUVCoords=k;a.uvElevationAligner=function(u,p,h,r,q){p=n.perVertexElevationAligner(u,p,h,r,q);u=u.stageObject.geometries;for(const y of u)k(y,
q);return p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/plane ../../../ViewingMode".split(" "),function(a,b,c,w,n,x,m,l,g,f,
d,e){function k(K,I,L,R,O,J,M){x.set(K,I*O[0]+L*J[0]+R*M[0],I*O[1]+L*J[1]+R*M[1],I*O[2]+L*J[2]+R*M[2])}const u=m.create(),p=m.create(),h=d.create(),r=m.create(),q=m.create(),y=m.create(),B=n.create(),D=n.create(),z=m.create(),v=m.create(),A=m.create(),t=c.create(),C=m.create(),E=m.create(),F=m.create(),H=m.create();a.createMapSpaceUVCoords=function(K,I,L,R,O=1){x.set(r,1,0,0);x.set(q,0,1,0);x.set(y,0,0,1);x.set(H,0,0,0);for(var J=0;J<L.length-3;J+=3)H[0]+=L[J],H[1]+=L[J+1],H[2]+=L[J+2];x.scale(u,
H,1/(L.length/3-1));J=L.length/3-1;if(d.fromManyPointsSampleAt(L,h,0,Math.floor(J/3),Math.floor(2/3*J))){b.isSome(R)?(R.basisMatrixAtPosition(u,t),x.set(C,t[0],t[1],t[2]),x.set(E,t[4],t[5],t[6]),x.set(F,t[8],t[9],t[10])):(x.set(C,1,0,0),x.set(E,0,1,0),x.set(F,0,0,1));R=d.normal(h);0>x.dot(R,F)&&x.scale(R,R,-1);x.copy(y,R);J=x.dot(R,E);var M=x.dot(R,C);Math.abs(J)<Math.abs(M)?(x.scaleAndAdd(r,C,R,-M),x.normalize(r,r),x.cross(q,r,R),x.normalize(q,q),x.scale(q,q,-1)):(x.scaleAndAdd(q,E,R,-J),x.normalize(q,
q),x.cross(r,q,R),x.normalize(r,r))}w.set(B,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);w.set(D,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(R=0;R<L.length;R+=3)x.set(p,L[R],L[R+1],L[R+2]),J=x.dot(r,p),M=x.dot(q,p),B[0]=Math.min(B[0],J),B[1]=Math.min(B[1],M),D[0]=Math.max(D[0],J),D[1]=Math.max(D[1],M);R=x.dot(y,u);k(z,B[0],B[1],R,r,q,y);k(v,D[0],B[1],R,r,q,y);k(A,B[0],D[1],R,r,q,y);x.subtract(v,v,z);x.scale(v,v,.5);x.subtract(A,A,z);x.scale(A,A,.5);x.add(z,z,v);x.add(z,z,A);R=B[0]-
B[0]%O;J=B[1]-B[1]%O;for(M=0;M<L.length;M+=3){x.set(p,L[M],L[M+1],L[M+2]);var G=M/3,P=4*G;K[P]=(x.dot(r,p)-R)/O;K[P+1]=(x.dot(q,p)-J)/O;K[P+2]=R/O;K[P+3]=J/O;G*=9;for(P=0;3>P;P++)I[G+P]=z[P],I[G+P+3]=v[P],I[G+P+6]=A[P]}};a.createMapSpaceUVCoordsDraped=function(K,I,L,R,O=1){if(L.isGeographic&&R===e.ViewingMode.Global){R=f.newDoubleArray(I.length);var J=I.length;L=l.getReferenceEllipsoid(L);for(var M=0;M<J;M+=3)g.lonLatToWebMercatorComparable(I,M,R,M,L);I=R}w.set(B,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);
for(R=0;R<I.length;R+=3)B[0]=Math.min(B[0],I[R]),B[1]=Math.min(B[1],I[R+1]);R=B[0]-B[0]%O;J=B[1]-B[1]%O;for(L=0;L<I.length;L+=3)M=L/3*4,K[M]=(I[L]-R)/O,K[M+1]=(I[L+1]-J)/O,K[M+2]=R/O,K[M+3]=J/O};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){k=function(q){function y(D){D=B.call(this,D,new r);D.supportsEdges=!0;D._configuration=new p.ColorMaterialTechniqueConfiguration;return D}b._inherits(y,q);var B=b._createSuper(y);q=y.prototype;q.getConfiguration=function(D,z){this._configuration.output=D;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=z.transparencyPassType;this._configuration.enableOffset=z.camera.relativeElevation<g.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=z.multipassTerrain.enabled;this._configuration.cullAboveGround=z.multipassTerrain.cullAboveGround;return this._configuration};
q.requiresSlot=function(D,z){return z===n.ShaderOutput.Color||z===n.ShaderOutput.Alpha||z===n.ShaderOutput.Highlight||z===n.ShaderOutput.Depth&&this.parameters.writeLinearDepth||z===n.ShaderOutput.ObjectAndLayerIdColor?D===f.RenderSlot.DRAPED_MATERIAL?!0:z===n.ShaderOutput.Highlight?D===f.RenderSlot.OPAQUE_MATERIAL:D===(this.parameters.transparent?this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:f.RenderSlot.OPAQUE_MATERIAL):!1};q.createGLMaterial=
function(D){return new h(D)};q.createBufferWriter=function(){return new d.DefaultBufferWriter(c("enable-feature:objectAndLayerId-rendering")?e.PositionColorLayoutObjectAndLayerId:e.PositionColorLayout)};return b._createClass(y)}(k.TriangleMaterial);let h=function(q){function y(){return B.apply(this,arguments)}b._inherits(y,q);var B=b._createSuper(y);q=y.prototype;q._updateOccludeeState=function(D){D.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:D.hasOccludees})};
q.beginSlot=function(D){this._output!==n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||this._updateOccludeeState(D);return this.ensureTechnique(u.ColorMaterialTechnique,D)};return b._createClass(y)}(m),r=function(q){function y(){var D=B.apply(this,arguments);D.color=w.ZEROS;D.transparent=!1;D.writeDepth=!0;D.writeLinearDepth=!1;D.hasVertexColors=!1;D.polygonOffset=!1;D.hasSlicePlane=!1;D.cullFace=x.CullFaceOptions.None;D.hasOccludees=!1;return D}b._inherits(y,q);var B=b._createSuper(y);
return b._createClass(y)}(l.MaterialParameters);a.ColorMaterial=k;a.Parameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){x=function(r){function q(){var B=y.apply(this,arguments);B.color=w.ZEROS;return B}c._inherits(q,r);var y=c._createSuper(q);return c._createClass(q)}(x.NoParameters);l=function(r){function q(){return y.apply(this,arguments)}c._inherits(q,r);var y=c._createSuper(q);r=q.prototype;r.initializeProgram=function(B){return new d.Program(B.rctx,q.shader.get().build(this.configuration),g.Default3D)};r._createPipeline=function(B,D){const z=this.configuration,v=B===k.TransparencyPassType.NONE,
A=B===k.TransparencyPassType.FrontFace;return p.makePipelineState({blending:z.output!==n.ShaderOutput.Color&&z.output!==n.ShaderOutput.Alpha||!z.transparent?null:v?f.blendingDefault:f.oitBlending(B),culling:p.cullingParams(z.cullFace),depthTest:{func:f.oitDepthTest(B)},depthWrite:v||A?z.writeDepth?p.defaultDepthWriteParams:null:null,colorWrite:p.defaultColorWriteParams,stencilWrite:z.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:z.hasOccludees?D?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:
null,polygonOffset:v||A?z.polygonOffset?h:null:f.getOITPolygonOffset(z.enableOffset)})};r.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};r.getPipelineState=function(B,D){return D?this._occludeePipelineState:c._get(c._getPrototypeOf(q.prototype),"getPipelineState",this).call(this,B,D)};return c._createClass(q)}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(u.ColorMaterial,
()=>new Promise((r,q)=>a(["./ColorMaterial.glsl"],r,q)));const h={factor:1,units:1};b.ColorMaterialPassParameters=x;b.ColorMaterialTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){function y(D){const z=new h.ShaderBuilder,{vertex:v,fragment:A,varyings:t}=z;k.addProjViewLocalOrigin(v,D);z.include(n.Transform,D);z.include(m.VertexColor,D);z.include(x.ObjectAndLayerIdColor,D);z.attributes.add(q.VertexAttribute.POSITION,"vec3");t.add("vpos","vec3");const C=D.hasMultipassTerrain&&(D.output===c.ShaderOutput.Color||D.output===c.ShaderOutput.Alpha);C&&t.add("depth","float");var E=D.output===c.ShaderOutput.Depth;E&&(z.include(l.OutputDepth,
D),b.addNearFar(z),b.addLinearDepth(z));v.code.add(p.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${C?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${E?p.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:p.glsl`transformPosition(proj, view, vpos);`}
    }
  `);z.include(w.SliceDraw,D);C&&z.include(f.multipassTerrainTest,D);A.include(e.ColorConversion);A.uniforms.add(new u.Float4PassUniform("eColor",F=>F.color));(E=D.output===c.ShaderOutput.Highlight)&&z.include(g.OutputHighlight,D);A.code.add(p.glsl`
  void main() {
    discardBySlice(vpos);
    ${C?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${D.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${D.output===c.ShaderOutput.ObjectAndLayerIdColor?p.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${p.glsl.float(d.symbolAlphaCutoff)}) {
      discard;
    }

    ${D.output===c.ShaderOutput.Alpha?p.glsl`fragColor = vec4(fColor.a);`:""}

    ${D.output===c.ShaderOutput.Color?p.glsl`fragColor = highlightSlice(fColor, vpos); ${D.transparencyPassType===r.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
    ${E?p.glsl`outputHighlight();`:""};
    ${D.output===c.ShaderOutput.Depth?p.glsl`outputDepth(linearDepth);`:""};
    ${D.output===c.ShaderOutput.ObjectAndLayerIdColor?p.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return z}const B=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=B;a.build=y})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l){l=function(g){function f(){var e=d.apply(this,arguments);e.output=w.ShaderOutput.Color;e.cullFace=x.CullFaceOptions.None;e.transparencyPassType=m.TransparencyPassType.NONE;e.hasSlicePlane=!1;e.hasVertexColors=!1;e.transparent=!1;e.polygonOffset=!1;e.enableOffset=!0;e.writeDepth=!0;e.hasOccludees=!1;e.hasMultipassTerrain=!1;e.cullAboveGround=!1;e.objectAndLayerIdColorInstanced=!1;return e}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(l.DefaultTechniqueConfiguration);
c.__decorate([n.parameter({count:w.ShaderOutput.COUNT})],l.prototype,"output",void 0);c.__decorate([n.parameter({count:x.CullFaceOptions.COUNT})],l.prototype,"cullFace",void 0);c.__decorate([n.parameter({count:m.TransparencyPassType.COUNT})],l.prototype,"transparencyPassType",void 0);c.__decorate([n.parameter()],l.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],l.prototype,"hasVertexColors",void 0);c.__decorate([n.parameter()],l.prototype,"transparent",void 0);c.__decorate([n.parameter()],
l.prototype,"polygonOffset",void 0);c.__decorate([n.parameter()],l.prototype,"enableOffset",void 0);c.__decorate([n.parameter()],l.prototype,"writeDepth",void 0);c.__decorate([n.parameter()],l.prototype,"hasOccludees",void 0);c.__decorate([n.parameter()],l.prototype,"hasMultipassTerrain",void 0);c.__decorate([n.parameter()],l.prototype,"cullAboveGround",void 0);c.__decorate([n.parameter()],l.prototype,"objectAndLayerIdColorInstanced",void 0);a.ColorMaterialTechniqueConfiguration=l;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){h=function(z){function v(t){t=A.call(this,t,new D);t.supportsEdges=!0;t._vertexAttributeLocations=q.vertexAttributeLocations;t._configuration=new q.PatternTechniqueConfiguration;return t}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.getConfiguration=function(t,C){this._configuration.output=t;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.polygonOffset=
this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=C.transparencyPassType;this._configuration.enableOffset=C.camera.relativeElevation<f.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=C.multipassTerrain.enabled;
this._configuration.cullAboveGround=C.multipassTerrain.cullAboveGround;return this._configuration};z.requiresSlot=function(t,C){return C===x.ShaderOutput.Color||C===x.ShaderOutput.Alpha||C===x.ShaderOutput.Highlight||C===x.ShaderOutput.Depth&&this.parameters.writeLinearDepth?t===d.RenderSlot.DRAPED_MATERIAL?!0:C===x.ShaderOutput.Highlight?t===d.RenderSlot.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1};z.createGLMaterial=
function(t){return new y(t)};z.createBufferWriter=function(){const t=n.newLayout().vec3f(k.VertexAttribute.POSITION).vec4u8(k.VertexAttribute.COLOR).vec4f(k.VertexAttribute.UVMAPSPACE);this.parameters.draped||t.mat3f(k.VertexAttribute.BOUNDINGRECT);return new B(t)};return b._createClass(v)}(h.TriangleMaterial);let y=function(z){function v(){return A.apply(this,arguments)}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z._updateParameters=function(t){return this.ensureTechnique(q.PatternTechnique,
t)};z._updateOccludeeState=function(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})};z.beginSlot=function(t){this._output!==x.ShaderOutput.Color&&this._output!==x.ShaderOutput.Alpha||this._updateOccludeeState(t);return this._updateParameters(t)};return b._createClass(v)}(l),B=function(z){function v(){return A.apply(this,arguments)}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.write=function(t,C,E,F,H){for(const I of this.vertexBufferLayout.fieldNames){C=
E.vertexAttributes.get(I);const L=E.indices.get(I);if(C&&L)switch(I){case k.VertexAttribute.POSITION:e.assert(3===C.size);var K=F.getField(I,w.BufferViewVec3f);K&&r.writePosition(L,C.data,t,K,H);break;case k.VertexAttribute.COLOR:e.assert(3===C.size||4===C.size);(K=F.getField(I,w.BufferViewVec4u8))&&r.writeColor(L,C.data,C.size,K,H);break;case k.VertexAttribute.UVMAPSPACE:e.assert(4===C.size);(K=F.getField(I,w.BufferViewVec4f))&&r.writeBufferVec4(L,C.data,K,H);break;case k.VertexAttribute.BOUNDINGRECT:e.assert(9===
C.size),(K=F.getField(I,w.BufferViewMat3f))&&this.writeBoundingRect(L,C.data,t,K,H)}}};z.writeBoundingRect=function(t,C,E,F,H){const K=F.typedBuffer;F=F.typedBufferStride;const I=t.length;H*=F;for(let R=0;R<I;++R){const O=9*t[R];var L=C[O];const J=C[O+1],M=C[O+2];K[H]=E[0]*L+E[4]*J+E[8]*M+E[12];K[H+1]=E[1]*L+E[5]*J+E[9]*M+E[13];K[H+2]=E[2]*L+E[6]*J+E[10]*M+E[14];for(L=3;9>L;++L)K[H+L]=C[O+L];H+=F}};return b._createClass(v)}(u.DefaultBufferWriter),D=function(z){function v(){var t=A.apply(this,arguments);
t.color=c.fromValues(1,1,1,1);t.writeDepth=!0;t.writeLinearDepth=!1;t.polygonOffset=!1;t.hasSlicePlane=!1;t.cullFace=m.CullFaceOptions.None;t.hasOccludees=!1;t.style=p.Style.Cross;t.patternSpacing=10;t.lineWidth=1;t.draped=!0;return t}b._inherits(v,z);var A=b._createSuper(v);return b._createClass(v)}(g.MaterialParameters);a.Parameters=D;a.PatternMaterial=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],
function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){m=function(D){function z(){return v.apply(this,arguments)}c._inherits(z,D);var v=c._createSuper(z);D=z.prototype;D.initializeProgram=function(A){return new d.Program(A.rctx,z.shader.get().build(this.configuration),B)};D._setPipelineState=function(A,t){const C=this.configuration,E=A===k.TransparencyPassType.NONE,F=A===k.TransparencyPassType.FrontFace;return q.makePipelineState({blending:C.output===n.ShaderOutput.Color||C.output===n.ShaderOutput.Alpha?E?
f.blendingDefault:f.oitBlending(A):null,culling:q.cullingParams(C.cullFace),depthTest:{func:f.oitDepthTest(A)},depthWrite:E?C.writeDepth?q.defaultDepthWriteParams:null:f.oitDepthWrite(A),colorWrite:q.defaultColorWriteParams,stencilWrite:C.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?t?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:E||F?C.polygonOffset?y:null:f.getOITPolygonOffset(C.enableOffset)})};D.initializePipeline=function(){this._occludeePipelineState=
this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};D.getPipelineState=function(A,t){return t?this._occludeePipelineState:c._get(c._getPrototypeOf(z.prototype),"getPipelineState",this).call(this,A,t)};return c._createClass(z)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(r.Pattern,()=>new Promise((D,z)=>a(["./Pattern.glsl"],D,z)));const y={factor:1,units:1};x=function(D){function z(){var A=v.apply(this,
arguments);A.output=n.ShaderOutput.Color;A.cullFace=g.CullFaceOptions.None;A.transparencyPassType=k.TransparencyPassType.NONE;A.hasSlicePlane=!1;A.hasVertexColors=!1;A.polygonOffset=!1;A.writeDepth=!0;A.hasOccludees=!1;A.enableOffset=!0;A.hasMultipassTerrain=!1;A.cullAboveGround=!1;return A}c._inherits(z,D);var v=c._createSuper(z);return c._createClass(z)}(p.DefaultTechniqueConfiguration);w.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],x.prototype,"output",void 0);w.__decorate([l.parameter({count:g.CullFaceOptions.COUNT})],
x.prototype,"cullFace",void 0);w.__decorate([l.parameter({count:h.Style.COUNT})],x.prototype,"style",void 0);w.__decorate([l.parameter({count:k.TransparencyPassType.COUNT})],x.prototype,"transparencyPassType",void 0);w.__decorate([l.parameter()],x.prototype,"hasSlicePlane",void 0);w.__decorate([l.parameter()],x.prototype,"hasVertexColors",void 0);w.__decorate([l.parameter()],x.prototype,"polygonOffset",void 0);w.__decorate([l.parameter()],x.prototype,"writeDepth",void 0);w.__decorate([l.parameter()],
x.prototype,"hasOccludees",void 0);w.__decorate([l.parameter()],x.prototype,"patternSpacing",void 0);w.__decorate([l.parameter()],x.prototype,"lineWidth",void 0);w.__decorate([l.parameter()],x.prototype,"enableOffset",void 0);w.__decorate([l.parameter()],x.prototype,"draped",void 0);w.__decorate([l.parameter()],x.prototype,"hasMultipassTerrain",void 0);w.__decorate([l.parameter()],x.prototype,"cullAboveGround",void 0);const B=new Map([[u.VertexAttribute.POSITION,0],[u.VertexAttribute.COLOR,3],[u.VertexAttribute.UVMAPSPACE,
4],[u.VertexAttribute.BOUNDINGRECT,5]]);b.PatternTechnique=m;b.PatternTechniqueConfiguration=x;b.vertexAttributeLocations=B;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){function B(v){const A=new h.ShaderBuilder,t=v.hasMultipassTerrain&&(v.output===c.ShaderOutput.Color||v.output===c.ShaderOutput.Alpha),{vertex:C,fragment:E}=A;e.addProjViewLocalOrigin(C,v);A.include(n.Transform,v);A.include(x.VertexColor,v);v.draped?C.uniforms.add(new u.FloatPassUniform("worldToScreenRatio",(H,K)=>1/K.screenToPCSRatio)):A.attributes.add(q.VertexAttribute.BOUNDINGRECT,"mat3");A.attributes.add(q.VertexAttribute.POSITION,"vec3");A.attributes.add(q.VertexAttribute.UVMAPSPACE,
"vec4");A.varyings.add("vpos","vec3");A.varyings.add("vuv","vec2");t&&A.varyings.add("depth","float");var F=v.style===y.Style.ForwardDiagonal||v.style===y.Style.BackwardDiagonal||v.style===y.Style.DiagonalCross;F&&C.code.add(p.glsl`
      const mat2 rotate45 = mat2(${p.glsl.float(.70710678118)}, ${p.glsl.float(-.70710678118)},
                                 ${p.glsl.float(.70710678118)}, ${p.glsl.float(.70710678118)});
    `);v.draped||(e.addCameraPosition(C,v),C.uniforms.add(new u.FloatPassUniform("worldToScreenPerDistanceRatio",(H,K)=>1/K.camera.perScreenPixelRatio)),C.code.add(p.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),C.code.add(p.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),C.code.add(p.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${p.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));C.code.add(p.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${F?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${F?" * rotate45":""};

      ${v.draped?"":p.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${p.glsl.float(v.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(F=v.output===c.ShaderOutput.Depth)A.include(m.OutputDepth,v),b.addNearFar(A),b.addLinearDepth(A);C.code.add(p.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${t?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${F?p.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:p.glsl`transformPosition(proj, view, vpos);`}
    }
  `);A.include(w.SliceDraw,v);E.include(d.ColorConversion);v.draped&&E.uniforms.add(new u.FloatPassUniform("texelSize",(H,K)=>1/K.camera.pixelRatio));v.output===c.ShaderOutput.Highlight&&A.include(l.OutputHighlight,v);t&&A.include(g.multipassTerrainTest,v);v.output!==c.ShaderOutput.Highlight&&(E.code.add(p.glsl`
      const float lineWidth = ${p.glsl.float(v.lineWidth)};
      const float spacing = ${p.glsl.float(v.patternSpacing)};
      const float spacingINV = ${p.glsl.float(1/v.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),v.draped||E.code.add(p.glsl`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));E.uniforms.add(new k.Float4PassUniform("uColor",H=>H.color));E.code.add(p.glsl`
    void main() {
      discardBySlice(vpos);
      ${t?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${v.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${v.output!==c.ShaderOutput.Highlight?p.glsl`color.a *= ${D(v)};`:""}

      ${v.output===c.ShaderOutput.ObjectAndLayerIdColor?p.glsl`color.a = 1.0;`:""}

      if (color.a < ${p.glsl.float(f.symbolAlphaCutoff)}) {
        discard;
      }

      ${v.output===c.ShaderOutput.Alpha?p.glsl`fragColor = vec4(color.a);`:""}

      ${v.output===c.ShaderOutput.Color?p.glsl`fragColor = color; ${v.transparencyPassType===r.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
      ${v.output===c.ShaderOutput.Highlight?p.glsl`outputHighlight();`:""}
      ${v.output===c.ShaderOutput.Depth?p.glsl`outputDepth(linearDepth);`:""};
    }
  `);return A}function D(v){function A(t){return v.draped?p.glsl`coverage(vuv.${t}, texelSize)`:p.glsl`sampleAA(vuv.${t})`}switch(v.style){case y.Style.ForwardDiagonal:case y.Style.Horizontal:return A("y");case y.Style.BackwardDiagonal:case y.Style.Vertical:return A("x");case y.Style.DiagonalCross:case y.Style.Cross:return p.glsl`
        1.0 - (1.0 - ${A("x")}) * (1.0 - ${A("y")})
      `;default:return"0.0"}}const z=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.Pattern=z;a.build=B})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./CreateLabelParameters ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(H,K,I){H&&H.forEach(L=>{const R=K(L);n.isSome(R)&&I(R,L.graphic)})}function t(H,K){if("baseline"===K.verticalPlacement)return K=q.horizontalPlacementToAnchorX[K.horizontalPlacement],H=n.isSome(H)?H.baselineAnchorY:0,l.fromValues(K,H);H=q.anchorFromPlacements(K.horizontalPlacement,K.verticalPlacement);return q.namedAnchorToHUDMaterialAnchorPos[H]}const C=[0,0,1];h=function(H){function K(L,R,O,J){L=I.call(this,L,R,O,J);L._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};E.set(b._assertThisInitialized(L),!1);L.ensureDrapedStatus(!1);return L}b._inherits(K,H);var I=b._createSuper(K);H=K.prototype;H.doLoad=async function(){if(!this._drivenProperties.size){const L=r.validateSymbolLayerSize(this.symbolLayer.size);if(L)throw new w("graphics3dtextsymbollayer:invalid-size",L);}await this._createTextRenderParameters()};H._createTextRenderParameters=async function(){this._textRenderParameters=await D.TextRenderParameters.fromSymbol(this.symbolLayer,
this._context.graphicsCoreOwner.view.state.rasterPixelRatio)};H.destroy=function(){b._get(b._getPrototypeOf(K.prototype),"destroy",this).call(this)};H.createGraphics3DGraphic=function(L){L=L.graphic;const R=y.placePointOnGeometry(L.geometry);if(n.isNone(R))return this.logger.warn(`unsupported geometry type for text symbol: ${L.geometry.type}`),null;const O=this.symbolLayer.text;if(n.isNone(O)||""===O)return null;var J=g.hasCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:
null;if(n.isSome(J)&&!g.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;J=new f.CreateLabelParameters(J,this.symbolLayer.horizontalAlignment,q.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment));return this._createAs3DShape(L,R,O,J)};H.createLabel=function(L,
R,O,J){L=L.graphic;const M=y.placePointOnGeometry(L.geometry);if(n.isNone(M))return this.logger.warn(`unsupported geometry type for label: ${L.geometry.type}`),null;const G=R.text;return!G||/^\s+$/.test(G)?null:this._createAs3DShape(L,M,G,R,O,J)};H.setGraphicElevationContext=function(L,R,O=0){L=b._get(b._getPrototypeOf(K.prototype),"setGraphicElevationContext",this).call(this,L,R);L.addOffsetRenderUnits(O);return L};H.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};H.layerElevationInfoChanged=function(L,R){A(L,R,(O,J)=>{this.updateGraphicElevationContext(J,O)});return e.SymbolUpdateType.UPDATE};H.slicePlaneEnabledChanged=function(L,R){A(L,R,O=>{for(const J of O.stageObject.geometries)J.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};H.physicalBasedRenderingChanged=function(){return!0};H.updateGraphicElevationContext=function(L,R){const O=R.elevationContext;this.setGraphicElevationContext(L,O,n.isSome(R.metadata)?
R.metadata.elevationOffset:0);R.needsElevationUpdates=e.needsElevationUpdates2D(O.mode)||"absolute-height"===O.mode};H._defaultElevationInfoNoZ=function(){return F};H._createAs3DShape=function(L,R,O,J,M,G){const P=this.setGraphicElevationContext(L,new k.ElevationContext,J.elevationOffset);var U="polyline"===n.get(L.geometry,"type"),N=L.uid;let S=null;L=null;if(n.isNone(G)){var Q=q.textRenderAlignmentFromHorizontalPlacement(J.horizontalPlacement);S=new z(O,Q,this._textRenderParameters);let T=null;
if(n.isSome(this._context.sharedResources.textures)){L=this._context.sharedResources.textures.fromData(S.key,()=>n.unwrap(S).create(),()=>{n.isSome(T)&&T.release()});Q=this._context.stage.renderView.textureRepository.acquire(L.texture.id);if(n.isNone(Q)||x.isPromiseLike(Q))return L.release(),null;T=Q}}Q=t(S,J);Q={occlusionTest:!0,screenOffset:J.screenOffset,anchorPosition:Q,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:J.centerOffsetUnits,drawInSecondSlot:!0};n.isSome(G)?Q.textureId=G.id:n.isSome(L)&&
(Q.textureId=L.texture.id);if(n.isSome(J.verticalOffset)){const {screenLength:T,minWorldLength:X,maxWorldLength:Z}=J.verticalOffset;Q.verticalOffset={screenLength:m.pt2px(T),minWorldLength:X||0,maxWorldLength:n.isSome(Z)?Z:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:T,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources;Q.screenSizePerspective=X.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]);
Q.screenSizePerspectiveAlignment=T}U&&(Q.shaderPolygonOffset=1E-4);Q.hasSlicePlane=this._context.slicePlaneEnabled;n.isSome(M)?(U=JSON.stringify(Q),G=M.get(U),n.isNone(G)&&(G=new v.HUDMaterial(Q),M.add(U,G))):G=new v.HUDMaterial(Q);U=J.translation;Q=n.isSome(S)?l.fromValues(S.displayWidth,S.displayHeight):l.ZEROS;U=B.createPointGeometry(G,C,U,null,Q,J.centerOffset,[0,0],null);N=y.createStageObject(this._context,R,U,P,N);if(n.isNone(N))return null;M=new u.Graphics3DObject3DGraphicLayer(this,N.object,
[U],n.isNone(M)?[G]:null,L,d.perObjectElevationAligner,P);M.alignedSampledElevation=N.sampledElevation;M.needsElevationUpdates=e.needsElevationUpdates2D(P.mode)||"absolute-height"===P.mode;const {displayWidth:W,displayHeight:V}=n.isSome(S)?S:J;M.getScreenSize=(T=l.create())=>{T[0]=W;T[1]=V;return T};O=new p.Graphics3DObjectMetadata(J.elevationOffset,O);M.metadata=O;y.extendPointGraphicElevationContext(M,R,this._context.elevationProvider);return M};b._createClass(K,[{key:"pixelRatioChanged",get:function(){return c.__classPrivateFieldGet(this,
E,"f")},set:function(L){c.__classPrivateFieldSet(this,E,L,"f")}}]);return K}(h.Graphics3DSymbolLayer);var E=new WeakMap;const F={mode:"relative-to-ground",offset:0};a.Graphics3DTextSymbolLayer=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,w,n,x,m){let l=function(){function g(d){this.definition=d;this.key=JSON.stringify(d);this.haloSize=Math.round(d.halo.size);this.textStyle=this._colorToRGBA(d.color);this.haloStyle=this._colorToRGB(d.halo.color);this.backgroundStyle=0!==d.background.color[3]?this._colorToRGBA(d.background.color):null}var f=g.prototype;f.fontString=function(d){const e=this.definition.font;return`${e.style} ${e.weight} ${d}px ${e.family}, sans-serif`};f._colorToRGB=function(d){return`rgb(${d.slice(0,3).map(e=>
Math.floor(255*e)).toString()})`};f._colorToRGBA=function(d){return`rgba(${d.slice(0,3).map(e=>Math.floor(255*e)).toString()},${d[3]})`};g.fromSymbol=async function(d,e){var k=n.get(d,"material","color");const u=n.mapOr(k,m.ZEROS,c.toUnitRGBA);k=n.mapOr(d.size,12,x.pt2px);const p=d.lineHeight,h=n.isSome(d.background)?n.unwrap(c.toUnitRGBA(d.background.color)):m.ZEROS,r={family:n.mapOr(d.font,"sans-serif",y=>y.family),decoration:n.mapOr(d.font,"none",y=>y.decoration),weight:n.mapOr(d.font,"normal",
y=>y.weight),style:n.mapOr(d.font,"normal",y=>y.style)};var q=d.halo;q=n.isSome(q)&&n.isSome(q.color)&&0<q.size?{size:x.pt2px(q.size),color:c.toUnitRGBA(q.color)}:{size:0,color:m.ZEROS};d=new g({color:u,size:k,background:{color:h,padding:n.isSome(d.background)?[.65*k,.5*k]:[0,0],borderRadius:n.isSome(d.background)?.375*k:0},lineSpacingFactor:p,font:r,halo:q,pixelRatio:e});e=d.fontString(k);try{await document.fonts.load(e)}catch(y){w.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${e}'. Some text symbology may be rendered using the default browser font.`)}return d};
return b._createClass(g)}();a.TextRenderParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,w,n){const x={canvas:null};return function(){function m(l,g,f){this._renderer=new c.TextRenderer(l,g,f)}m.prototype.create=function(){const l=c.getTextHelperCanvas(x,this._renderer.renderedWidth,
this._renderer.renderedHeight),g=l.getContext("2d");g.save();this._renderer.render(g,0,0);g.restore();return new w.Texture(l,{wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:b.PowerOfTwoResizeMode.PAD})};a._createClass(m,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}},{key:"displayWidth",
get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return m}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){const C=["polyline","polygon","extent"];y=function(R){function O(M,G,P,U){return J.call(this,M,G,P,U)}b._inherits(O,R);var J=b._createSuper(O);R=O.prototype;R.doLoad=async function(){};R.destroy=function(){b._get(b._getPrototypeOf(O.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null};R.createGraphics3DGraphic=function(M){M=M.graphic;if(!this._validateGeometry(M.geometry,C,this.symbolLayer.type))return null;
const G=this.setGraphicElevationContext(M,new h.ElevationContext);this.ensureDrapedStatus("on-the-ground"===G.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(M):this._createAs3DShape(M,G,M.uid)};R.ensureMaterial=function(){if(!w.isSome(this._material)){var M=new A.WaterMaterialParameters,G=this.symbolLayer.color;w.isSome(G)&&(M.color=c.toUnitRGBA(G));G=this._getCombinedOpacity(G,{hasIntrinsicColor:!0});M.color=[M.color[0],M.color[1],M.color[2],G];M.transparent=1>G||this.needsDrivenTransparentPass;
M.waveDirection=w.isSome(this.symbolLayer.waveDirection)?O.headingVectorFromAngle(this.symbolLayer.waveDirection):l.fromValues(0,0);G=t.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];M.waveStrength=G.waveStrength;M.waveTextureRepeat=G.textureRepeat;M.waveVelocity=G.waveVelocity;M.flowStrength=G.perturbationStrength;M.hasSlicePlane=this._context.slicePlaneEnabled;M.isDraped=this.draped;this._material=new A.WaterMaterial(M);this._context.stage.add(this._material)}};R.layerOpacityChanged=
function(){if(!w.isNone(this._material)){var M=this._material.parameters.color,G=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[M[0],M[1],M[2],G],transparent:1>G||this.needsDrivenTransparentPass})}};R.layerElevationInfoChanged=function(M,G,P){const U=this._elevationContext.mode;P=p.elevationModeChangeUpdateType(O.elevationModeChangeTypes,P,U);if(P!==p.SymbolUpdateType.UPDATE)return P;const N=p.needsElevationUpdates2D(U);return this.updateGraphics3DGraphicElevationInfo(M,
G,()=>N)};R.slicePlaneEnabledChanged=function(){w.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};R.physicalBasedRenderingChanged=function(){return!0};R._createAs3DShape=function(M,G,P){M=B.geometryAsPolygon(M.geometry);if(w.isNone(M))return null;var U=D.geometryToRenderInfo(M,this._context.elevationProvider,this._context.renderCoordsHelper,G);const N=U.position.length/3,S=k.newDoubleArray(2*N);this._createUVCoordsFromVertices(S,U.mapPositions,
N,this._context.elevationProvider.spatialReference);U=new I(U,S);this._create3DShapeGeometries(U);this._logGeometryCreationWarnings(U.renderData,M.rings,"rings","WaterSymbol3DLayer");if(0===U.outGeometries.length)return null;P=new z.Object3D({geometries:U.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:P}});P=new q.Graphics3DObject3DGraphicLayer(this,P,U.outGeometries,null,null,u.perVertexElevationAligner,G);P.alignedSampledElevation=U.renderData.sampledElevation;
P.needsElevationUpdates=p.needsElevationUpdates2D(G.mode);return P};R._createUVCoordsFromVertices=function(M,G,P,U){U=n.getMetersPerUnitForSR(U);e.empty(F);for(var N=0;N<P;N++)m.set(H,G[3*N],G[3*N+1]),e.expandPointInPlace(F,H);g.scale(F,F,U);N=F[1]%O.unitSizeOfTexture;E[0]=F[0]-F[0]%O.unitSizeOfTexture;E[1]=F[1]-N;for(N=0;N<P;N++)M[2*N]=(G[3*N]*U-E[0])/O.unitSizeOfTexture,M[2*N+1]=(G[3*N+1]*U-E[1])/O.unitSizeOfTexture};R._create3DShapeGeometries=function(M){var G=M.renderData.polygons;const P=M.uvCoords;
for(const {count:U,index:N,position:S,mapPositions:Q,holeIndices:W}of G){if(w.isSome(this._context.clippingExtent)&&(d.empty(K),d.expandWithBuffer(K,Q),!d.intersectsClippingArea(K,this._context.clippingExtent)))continue;G=x.earcut(Q,W,3);if(0===G.length)continue;const V=k.doubleSubArray(P,2*N,2*U);G=B.createWaterGeometry({material:w.unwrap(this._material),indices:G,mapPositions:Q,attributeData:{position:S,uv0:V}});M.outGeometries.push(G)}};R._createAsOverlay=function(M){const G=B.geometryAsPolygon(M.geometry);
if(w.isNone(G))return null;w.unwrap(this._material).renderPriority=this._renderPriority;const P=D.geometryToRenderInfoDraped(G,this._context.overlaySR),U=P.position.length/3,N=k.newDoubleArray(2*U);this._createUVCoordsFromVertices(N,P.position,U,this._context.overlaySR);M=new L(P,N,this._context.layer.uid,M.uid);M.outBoundingBox=d.empty();this._createAsOverlayWater(M);this._logGeometryCreationWarnings(M.renderData,G.rings,"rings","WaterSymbol3DLayer");return 0===M.outGeometries.length?null:new r(this,
M.outGeometries,M.outBoundingBox,this._context.drapeSourceRenderer)};R._createAsOverlayWater=function(M){const G=M.uvCoords;var P=M.renderData.polygons;for(const {position:U,holeIndices:N,index:S,count:Q}of P){d.empty(K);d.expandWithBuffer(K,U);if(!d.intersectsClippingArea(K,this._context.clippingExtent))continue;d.expandWithAABB(M.outBoundingBox,K);P=x.earcut(U,N,3);if(0===P.length)continue;const W=k.doubleSubArray(G,2*S,2*Q);P=B.createWaterGeometry({material:w.unwrap(this._material),indices:P,attributeData:{position:U,
uv0:W}});M.outGeometries.push(new v.RenderGeometry(P,M))}};O.headingVectorFromAngle=function(M){const G=l.create();M=f.toRadian(M);G[0]=Math.sin(M);G[1]=Math.cos(M);return G};R.test=function(){return{...b._get(b._getPrototypeOf(O.prototype),"test",this).call(this),create3DShape:M=>this._createAs3DShape(M.graphic,M.elevationContext,M.graphicUid),ensureMaterial:()=>this.ensureMaterial()}};return b._createClass(O)}(y.Graphics3DSymbolLayer);y.unitSizeOfTexture=100;y.elevationModeChangeTypes={definedChanged:p.SymbolUpdateType.RECREATE,
staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE};const E=l.create(),F=e.create(),H=l.create(),K=d.create();let I=function(R){function O(M,G){M=J.call(this,M,null,null);M.uvCoords=G;return M}b._inherits(O,R);var J=b._createSuper(O);return b._createClass(O)}(B.PolygonCreationDataBase),L=function(R){function O(M,G,P,U){M=J.call(this,M,P,U);M.uvCoords=G;return M}b._inherits(O,R);var J=b._createSuper(O);return b._createClass(O)}(B.PolygonCreationDataBase);a.Graphics3DWaterSymbolLayer=
y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,
perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,
waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,w,n){return function(x){function m(g,f,d){f=l.call(this,f);f.symbol=g;f._convert=d;f.symbologySnappingSupported=!1;f.graphics3DSymbol=null;f.referenced=0;return f}a._inherits(m,x);var l=a._createSuper(m);x=m.prototype;x.getSymbolLayerSize=function(g){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(g):null};x.doLoad=async function(g){g=await this.symbol.fetchSymbol({signal:g});g.id=this.symbol.id;this.graphics3DSymbol=
this._convert(g);b.isSome(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()};x.createGraphics3DGraphic=function(g){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(g,this):null};x.globalPropertyChanged=function(g,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(g,f):!1};x.applyRendererDiff=function(g,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(g,f):c.ApplyRendererDiffResult.Recreate_Symbol};
x.prepareSymbolPatch=function(g){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(g)};x.updateGeometry=function(g,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(g,f):!1};x.onRemoveGraphic=function(){};x.getFastUpdateStatus=function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};x.destroy=function(){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=
void 0;a._get(a._getPrototypeOf(m.prototype),"destroy",this).call(this)};a._createClass(m,[{key:"symbolLayers",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:n.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);
return m}(w.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){function e(t){t=f.getGraphics3DSymbol(t.graphics3DGraphic.graphics3DSymbol);return w.isSome(t)?
t.symbol.symbolLayers.getItemAt(0):null}function k(t,C){var E=C.graphics3DGraphic.graphic.geometry;if(w.isNone(E))return null;if(w.isSome(C.disablePlacement))return C.labelClass.labelPlacement?(B.warnOncePerTick(u(t.placement,C.disablePlacement.logEntityDescription)),p(C)):t;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(C.labelClass.labelPlacement)return B.warnOncePerTick(u(t.placement,`'${E}' geometries`)),p(C)}return t}function u(t,C){return`the requested label placement '${t}' is currently unsupported for ${C} in SceneView.`}
function p(t){const C=t.graphics3DGraphic.graphic.geometry;if(w.isNone(C))return null;switch(C.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return t=e(t),w.isSome(t)&&"extrude"===t.type?D["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return D["above-center"];case "mesh":return D["above-center"]}}function h(t,C=v){({graphics3DGraphic:t}=t);t=t.layers[0];(t=
w.isSome(t)?t.stageObject.geometries[0].material:null)&&t instanceof d.HUDMaterial?(t=t.parameters.anchorPosition,C[0]=2*(t[0]-.5),C[1]=2*(t[1]-.5)):(C[0]=0,C[1]=0);return C}function r(t,C,E){E=w.isSome(E)?E.getBoundingBoxObjectSpace(A):A;E=m.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);t.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/2*C.normalizedOffset[0];const F=t.translation[2],H=E[2]/2*C.normalizedOffset[1];t.translation[2]=0;t.elevationOffset=F+H;E=x.length(E);t.centerOffset[2]=E/2*C.normalizedOffset[2]}
function q(t){const C=t.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:F}=t;var H=f.getGraphics3DSymbol(F.graphics3DSymbol);H=w.applySome(H,K=>"point-3d"===K.symbol.type?K.symbol:null);t=D[C]||p(t);if(w.isSome(H)&&H.supportsCallout()&&H.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(H.verticalOffset),anchor:null,normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&(w.isNone(H)||!H.supportsCallout()||!H.verticalOffset||F.isDraped)){a:switch(t.placement){case "above-center":H=
!0;break a;default:H=!1}return H?{placement:"above-center",verticalOffset:y(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,t.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(B.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+C+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(t){const {screenLength:C,minWorldLength:E,maxWorldLength:F}=
t;return{screenLength:C,minWorldLength:E,maxWorldLength:F}}const B=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),D={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",
normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],
"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in b){const C=D[t];b[t].forEach(E=>{D[E]=C})}Object.freeze&&(Object.freeze(D),
Object.keys(D).forEach(t=>{Object.freeze(D[t]);Object.freeze(D[t].normalizedOffset)}));const z=[0,0],v=[0,0],A=g.create();a.get=function(t){var C=q(t);if(w.isNone(C))return null;if(C.anchor)var E=C;else{E=t.labelClass.labelPlacement;var F=D[E],H=F||p(t);E&&!F&&B.warnOncePerTick(`the requested label placement '${E}' is currently unsupported in SceneView.`);E=k(H,t)}if(w.isNone(E))return null;F=!!C.hasLabelVerticalOffset;C={anchor:E.anchor,verticalOffset:C.verticalOffset,screenOffset:n.create(),centerOffset:l.fromValues(0,
0,0,-1),centerOffsetUnits:"world",translation:m.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=t.graphics3DGraphic.graphic.geometry;if(w.isNone(F))t=null;else{switch(F.type){case "point":H=e(t);if(!w.isNone(H))switch(F=t.graphics3DGraphic.layers[0],w.isSome(F)?F.getCenterObjectSpace(C.translation):x.set(C.translation,0,0,0),H.type){case "icon":case "text":({graphics3DGraphic:H}=t);F=w.isSome(F)?F.getScreenSize():null;!H.isDraped&&w.isSome(F)?(t=h(t),z[0]=F[0]/2*(E.normalizedOffset[0]-t[0]),
z[1]=F[1]/2*(E.normalizedOffset[1]-t[1]),C.screenOffset[0]=z[0],C.hasLabelVerticalOffset?(C.centerOffset[1]=z[1],C.centerOffsetUnits="screen"):C.screenOffset[1]=z[1]):C.hasLabelVerticalOffset||"center"===C.anchor||(D[t.labelClass.labelPlacement]&&B.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),C.anchor="center");break;case "object":r(C,E,F)}break;case "polygon":F=e(t);if(!w.isNone(F))switch(F.type){case "extrude":t=t.graphics3DGraphic.layers[0],
w.isSome(t)?(t.getBoundingBoxObjectSpace(A),g.center(A,C.translation),C.translation[2]=g.height(A)/2):x.set(C.translation,0,0,0),r(C,E,t)}break;case "mesh":r(C,E,t.graphics3DGraphic.layers[0])}t=C}return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._stage=x;this._materials=new Map}var n=w.prototype;
n.get=function(x){return this._materials.get(x)};n.add=function(x,m){this._materials.set(x,m);this._stage.add(m)};n.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return b._createClass(w)}();a.MaterialCollection=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./ContentObjectType ./testUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z){let v=b._createClass(function(){this.offset={x:0,y:0};this.uvMinMax=h.create()}),A=b._createClass(function(C,E){this.textId=C;this.textRenderer=E;this.placement=new v;this.rendered=!1});a.TextTextureAtlas=function(C){function E(H){H=F.call(this,H);H.type=r.ContentObjectType.Texture;H.id=g.generateUID();H.events=new n;H._glTexture=null;H._needsClear=!1;H._elementsToAddOrUpdate=new Map;H._elementsToRemove=new Map;H._elementsToRender=new Map;H._elements=
new Map;H._stageObjects=new Map;H.updating=!1;return H}b._inherits(E,C);var F=b._createSuper(E);C=E.prototype;C.initialize=function(){this._stage=this.view._stage;this._canvas=this._create2DCanvas();this._ctx=this._canvas.getContext("2d");this._stage.add(this);const H=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(H);this._update2DCanvasSize();this._resetAtlasCursor()};C.unload=function(){this._glTexture=l.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};
C._createDescriptor=function(H){return{target:D.TextureType.TEXTURE_2D,pixelFormat:D.PixelFormat.RGBA,dataType:D.PixelType.UNSIGNED_BYTE,wrapMode:D.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,samplingMode:D.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:H.parameters.maxMaxAnisotropy}};C.load=function(H){if(l.isSome(this._glTexture))return this._glTexture;this._glTexture=new z.Texture(H,this._createDescriptor(H),this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(B.TaskPriority.TEXT_TEXTURE_ATLAS,
this);this.setDirty();return this._glTexture};C.dispose=function(){this._elementsToRender=this._elementsToRemove=this._elementsToAddOrUpdate=this._elements=null;this._frameWorker=l.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=l.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null};C._create2DCanvas=function(){const H=document.createElement("canvas");H.setAttribute("id","canvas2d");H.setAttribute("style",
"display:none");H.setAttribute("width",(512).toString());H.setAttribute("height",(512).toString());return H};C._update2DCanvasSize=function(){this._canvas.setAttribute("width",this._atlas.size.width.toString());this._canvas.setAttribute("height",this._atlas.size.height.toString())};C._createAtlasRegion=function(H=512){this._atlas={size:{width:H,height:H},cursor:{x:0,y:0},lineHeight:0}};C._computeAtlasResolution=function(H,K){H=Math.max(H,K);H=m.nextHighestPowerOfTwo(H+256);return H=Math.min(H,4096)};
C._resizeAtlas=function(H,K){K=K||H;const I=this._atlas;I.size.width=H;I.size.height=K;l.isSome(this._glTexture)&&this._glTexture.resize(H,K);this._update2DCanvasSize()};C._resetAtlasCursor=function(){const H=this._atlas;H.cursor.x=2;H.cursor.y=4;H.lineHeight=0;this._needsClear=!0};C._getAtlasUsage=function(){const H=this._atlas;return(H.cursor.x+H.cursor.y*H.size.width)/(H.size.width*H.size.height)};C._getExpectedAtlasUsage=function(){const H=this._elementsToRemove.size,K=this._elementsToAddOrUpdate.size,
I=this._elements.size;return this._getAtlasUsage()/I*(I+K-H)};C._addAtlasElement=function(H,K,I,L){const R=this._atlas,{renderedWidth:O,renderedHeight:J}=H.textRenderer;H.placement.offset.x=R.cursor.x;H.placement.offset.y=R.cursor.y;p.set(H.placement.uvMinMax,H.placement.offset.x/R.size.width,1-(H.placement.offset.y+J)/R.size.height,(H.placement.offset.x+O)/R.size.width,1-H.placement.offset.y/R.size.height);R.cursor.x+=I;R.lineHeight=Math.max(R.lineHeight,L);this._elements.set(K,H)};C._removeAtlasElement=
function(H){if(H&&this._elements.has(H.textId)){const K=H.placement.offset;this._ctx.clearRect(K.x,K.y,H.textRenderer.renderedWidth,H.textRenderer.renderedHeight);this._elements.delete(H.textId)}};C._ensureStageObjects=function(H){var K=this._stageObjects.get(H);if(K)return K;K=new Set;this._stageObjects.set(H,K);return K};C._addStageObject=function(H,K){this._ensureStageObjects(H).add(K)};C._removeStageObject=function(H,K){(H=this._stageObjects.get(H))&&H.delete(K)&&(K.geometries[0].setAttributeData(y.VertexAttribute.SIZE,
[0,0]),K.geometryVertexAttrsUpdated(K.geometries[0]))};C._processAddition=function(H,K){const I=this._atlas;var L=H.textId;const R=H.textRenderer.renderedWidth+2,O=H.textRenderer.renderedHeight+2+2;if(I.cursor.x+R<I.size.width&&I.cursor.y+O<I.size.height)this._addAtlasElement(H,L,R,O),this._elementsToRender.set(L,H),this._elementsToAddOrUpdate.delete(L);else if(I.cursor.y+O+I.lineHeight<I.size.height)I.cursor.x=2,I.cursor.y+=I.lineHeight,I.lineHeight=0,this._addAtlasElement(H,L,R,O),this._elementsToRender.set(L,
H),this._elementsToAddOrUpdate.delete(L);else{H=this._getExpectedAtlasUsage();(L=.85<H&&4096>I.size.width)&&this._resizeAtlas(2*I.size.width,2*I.size.height);if(!K||!L&&.95<H&&4096===I.size.width)return this._processRemovals(),t.OK;this._repack();return t.REPACK}return t.OK};C._processRemovals=function(){this._elementsToRemove.forEach((H,K)=>{const I=this._stageObjects.get(K);I&&0!==I.size||this._removeAtlasElement(H);I&&0===I.size&&this._stageObjects.delete(K)});this._elementsToRemove.clear()};C._repack=
function(){this._processRemovals();this._elements.forEach((H,K)=>{H.rendered=!1;this._elementsToAddOrUpdate.set(K,H)});this._elements.clear();this._resetAtlasCursor();this._elementsToRender.clear()};C._processRenderingRequest=function(H){this._ctx.clearRect(H.placement.offset.x,H.placement.offset.y,H.textRenderer.renderedWidth,H.textRenderer.renderedHeight);H.textRenderer.render(this._ctx,H.placement.offset.x,H.placement.offset.y);const K=this._stageObjects.get(H.textId);K&&K.forEach(I=>{I.geometries[0].setAttributeData(y.VertexAttribute.UV0,
H.placement.uvMinMax);I.geometries[0].setAttributeData(y.VertexAttribute.SIZE,[H.textRenderer.displayWidth,H.textRenderer.displayHeight]);I.geometryVertexAttrsUpdated(I.geometries[0])});H.rendered=!0};C.runTask=function(H,K=!0){if(l.isNone(this._glTexture))return B.Task.YIELD;let I=!1;x.someMap(this._elementsToAddOrUpdate,(R,O)=>this._elements.get(O)?.rendered?((R=this._stageObjects.get(O))&&R.forEach(J=>{const M=J.geometries[0],G=this._elements.get(O);M.setAttributeData(y.VertexAttribute.UV0,G.placement.uvMinMax);
M.setAttributeData(y.VertexAttribute.SIZE,[G.textRenderer.displayWidth,G.textRenderer.displayHeight]);J.geometryVertexAttrsUpdated(J.geometries[0])}),this._elementsToAddOrUpdate.delete(O),H.madeProgress(),!1):this._processAddition(this._elementsToAddOrUpdate.get(O),K)===t.REPACK?I=!0:!1);if(I)this.runTask(B.noBudget,!1),H.madeProgress();else{var L=!1;0<this._elementsToRender.size&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1);x.someMap(this._elementsToRender,
(R,O)=>{this._processRenderingRequest(R);this._elementsToRender.delete(O);L=!0;H.madeProgress();return H.done});L&&this._glTexture.setData(this._canvas);this.updating=0<this._elementsToRender.size;!this.updating&&q.textTextureAtlas.orderedRepackingEnabled&&(this.repackOrdered(),H.madeProgress())}};C.addTextTexture=function(H,K){const I=H.key;this._elementsToAddOrUpdate.has(I)||this._elementsToAddOrUpdate.set(I,new A(I,H));this._addStageObject(I,K);this._elementsToRemove.delete(I);this.setDirty()};
C.removeTextTexture=function(H,K){H=H.key;this._elementsToRemove.set(H,this._elements.get(H));this._removeStageObject(H,K)};C.setDirty=function(){this._glTexture&&(this.updating=!0)};C.repackOrdered=function(){if(0!==this._elements.size){var H=[];this._elements.forEach((I,L)=>H.push({element:I,key:L}));var K=!0;for(let I=0;I<H.length-1;I++)if(0<H[I].key.localeCompare(H[I+1].key)){K=!1;break}if(!K||this._elementsToRemove.size){H.sort((I,L)=>I.key.localeCompare(L.key));this._elements.clear();for(const {element:I,
key:L}of H)this._elements.set(L,I);this._repack();this.setDirty()}}};b._createClass(E,[{key:"width",get:function(){return this._atlas.size.width}},{key:"height",get:function(){return this._atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},{key:"test",get:function(){const {_elements:H,_stageObjects:K,_elementsToRemove:I,_atlas:L}=this,R=this;return{elements:H,stageObjects:K,
elementsToRemove:I,atlas:L,resizeAtlas:(O,J)=>R._resizeAtlas(O,J),run:(O,J)=>R.runTask(O,J)}}}]);return E}(w);c.__decorate([f.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([f.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=c.__decorate([u.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],a.TextTextureAtlas);var t;(function(C){C[C.OK=0]="OK";C[C.REPACK=1]="REPACK"})(t||(t={}));Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){a.FeatureTileTree3D=function(v){function A(C){C=t.call(this,C);C.tiles=new n;C.tileSize=512;C._idToTile=new Map;C._handles=new x;C._clients=new Set;C._dirty=!1;C._pendingTiles=null;C._newTiles=new g;return C}b._inherits(A,v);var t=b._createSuper(A);v=A.prototype;v.initialize=function(){this._handles.add([f.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),f.sync),f.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,
this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),f.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(B.TaskPriority.FEATURE_TILE_TREE,this))};v.destroy=function(){this._frameWorker=l.removeMaybe(this._frameWorker);this._handles=l.destroyMaybe(this._handles)};v.addClient=function(){const C=D++;this._clients.add(C);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(C)}};v._removeClient=function(C){this._clients.delete(C);
this._hasClients||this._clear()};v._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(B.noBudget))};v._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};v.runTask=function(C){this._dirty=!1;this._pendingTiles||(this._startUpdate(),l.isSome(this._frameWorker)&&(this._frameWorker.priority=B.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(C);
!this._pendingTiles&&l.isSome(this._frameWorker)&&(this._frameWorker.priority=B.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};v._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new q.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=
this._getRootTiles()):this._clear())};v._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};v._getRootTiles=function(){const {tilingScheme:C}=this;return this._rootTileIds.map(E=>new r.FeatureTileDescriptor3D(E[0],E[1],E[2],C))};v._purgeHorizonTiles=function(C){C.sort((E,F)=>{E=E.measures.screenRect;F=F.measures.screenRect;return E[1]+E[3]-(F[1]+F[3])});h.empty(z);for(let E=0;E<C.length;E++)if(h.expand(z,C.data[E].measures.screenRect,z),10<h.height(z))return C.data.slice(E,
C.length);return[]};v._subdivideTilesForView=function(C){if(this._pendingTiles){for(var {tilingScheme:E}=this;0<this._pendingTiles.length&&!C.done;){const F=this._pendingTiles.pop();C.madeProgress();if(!this._filterExtentRect||h.intersects(this._filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),F.measures.visibility!==r.Visibility.INVISIBLE&&(F.measures.shouldSplit?(E.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):this._newTiles.push(F))}0===this._pendingTiles.length&&
(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};v._updateTiles=function(C){for(var E of this.tiles.items)E.used=!1;C=C.filter(F=>{const H=this._idToTile.get(F.id);H?(H.copyMeasurementsFrom(F),H.used=!0):this._idToTile.set(F.id,F);return!H});E=this.tiles.items.filter(F=>F.used?!1:(this._idToTile.delete(F.id),!0));this.tiles.removeMany(E);this.tiles.addMany(C);this._sortTiles()};v._sortTiles=function(){this.viewState.fixedContentCamera||
this.tiles.sort((C,E)=>C.measures.visibility!==E.measures.visibility?C.measures.visibility===r.Visibility.VISIBLE_ON_SURFACE?-1:1:C.measures.distance-E.measures.distance);this.tiles.forEach((C,E)=>C.loadPriority=E)};b._createClass(A,[{key:"tilingScheme",get:function(){const C=this.tilingSchemeOwner.tilingScheme;return C?C.clone():null}},{key:"filterExtent",set:function(C){if(l.isSome(C)&&!C.spatialReference.equals(this.viewState.spatialReference))m.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var E=this._get("filterExtent");E===C||l.isSome(E)&&C&&E.equals(C)||(C=l.isSome(C)?C.clone():null,this._set("filterExtent",C),this._setDirty())}}},{key:"_filterExtentRect",get:function(){if(l.isNone(this.filterExtent))return null;const C=h.create();y.toBoundingRect(this.filterExtent,C,this.tilingScheme.spatialReference);return C}},{key:"_rootTileIds",get:function(){const {tilingScheme:C}=this;return this._filterExtentRect&&C?C.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}},{key:"suspended",
set:function(C){C!==this._get("suspended")&&(this._set("suspended",C),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return A}(w);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);c.__decorate([d.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);c.__decorate([d.property()],a.FeatureTileTree3D.prototype,"tiles",
void 0);c.__decorate([d.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([d.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_rootTileIds",null);c.__decorate([d.property({value:!1})],a.FeatureTileTree3D.prototype,
"suspended",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([p.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let D=0;const z=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/aaBoundingRect"],function(a,
b,c){let w=function(){function n(m,l,g,f=null){this.lij=[0,0,0];this.extent=c.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:c.create(),distance:0,shouldSplit:!1};this.used=!1;f&&this.acquire(m,l,g,f)}var x=n.prototype;x.acquire=function(m,l,g,f){this.tilingScheme=f;this.id=n.id(m,l,g);this.lij[0]=m;this.lij[1]=l;this.lij[2]=g;f.getExtent(m,l,g,this.extent);this.resolution=f.resolutionAtLevel(m)};x.release=function(){this.tilingScheme=
null};x.getChildren=function(m){const l=this.lij[0]+1,g=2*this.lij[1],f=2*this.lij[2];if(!m)return[new n(l,g,f,this.tilingScheme),new n(l,g+1,f,this.tilingScheme),new n(l,g,f+1,this.tilingScheme),new n(l,g+1,f+1,this.tilingScheme)];m[0].acquire(l,g,f,this.tilingScheme);m[1].acquire(l,g+1,f,this.tilingScheme);m[2].acquire(l,g,f+1,this.tilingScheme);m[3].acquire(l,g+1,f+1,this.tilingScheme);return m};x.copyMeasurementsFrom=function(m){this.measures.visibility=m.measures.visibility;this.measures.shouldSplit=
m.measures.shouldSplit;this.measures.distance=m.measures.distance;c.copy(m.measures.screenRect,this.measures.screenRect)};n.id=function(m,l,g){return`${m}/${l}/${g}`};return b._createClass(n)}();a.Visibility=void 0;(function(n){n[n.INVISIBLE=0]="INVISIBLE";n[n.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";n[n.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){let k=function(){function D(v){this._camera=new e.Camera;this._focusOnMap=[0,0];this._screenRect=x.create();this._tileSize=v.tileSize;this._renderCoordsHelper=v.renderCoordsHelper;this._tilingScheme=v.tilingScheme;this._visibility=new d.FeatureTileVisibility3D(v.renderCoordsHelper)}var z=D.prototype;z.begin=function(v,A,t){this._camera.copyFrom(v);this._surfaceElevation=t;this._focusOnMap[0]=A.x;this._focusOnMap[1]=A.y;x.fromValues(0,0,v.fullWidth,v.fullHeight,this._screenRect);
this._visibility.begin(this._camera,t)};z.end=function(){this._visibility.end()};z.updateTile=function(v){v.measures.visibility=this._visibility.calculate(v);v.measures.distance=x.distance(v.extent,this._focusOnMap);v.measures.visibility!==f.Visibility.INVISIBLE&&this._updateScreenMeasure(v)};z._updateScreenMeasure=function(v){const A=v.measures.screenRect;x.empty(A);let t=0;const C=v.lij[0]+2,E=v.lij[1]<<2,F=v.lij[2]<<2;var H=this._tileSizeWithBias(v);H*=H;for(let K=0;4>K;K++)for(let I=0;4>I;I++)if(t+=
this._computeScreenArea(v,C,E+K,F+I,A),t>H){v.measures.shouldSplit=!0;return}v.measures.shouldSplit=!1};z._tileSizeWithBias=function(v){return v.measures.visibility===f.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize};z._computeScreenArea=function(v,A,t,C,E){this._projectToScreen(A,t,C,v.measures.visibility===f.Visibility.VISIBLE_WHEN_EXTENDED,p);x.empty(u);for(v=0;4>v;v++)x.expandPointInPlace(u,p[v]);x.expand(E,u,E);return g.areaPoints2d(p[0],p[1],p[2])+g.areaPoints2d(p[0],p[2],
p[3])};z._projectToScreen=function(v,A,t,C,E){this._tilingScheme.ensureMaxLod(v);this._tilingScheme.getExtent(v,A,t,h);this._toRenderCoords(h,0,3,q[0]);this._toRenderCoords(h,2,3,q[1]);this._toRenderCoords(h,2,1,q[2]);this._toRenderCoords(h,0,1,q[3]);C&&(this._projectToPlane(q,this._camera.frustum[m.PlaneIndex.NEAR]),this._projectToPlane(q,this._camera.frustum[m.PlaneIndex.TOP]),this._projectToPlane(q,this._camera.frustum[m.PlaneIndex.BOTTOM]));for(v=0;4>v;v++)this._camera.projectToRenderScreen(q[v],
B),this._camera.renderToScreen(B,E[v])};z._projectToPlane=function(v,A){for(var t=0;4>t;t++)y[t]=l.signedDistance(A,v[t]);t=Math.max(y[0],y[1],y[2],y[3]);if(0<t)for(A=w.scale(r,l.normal(A),-t),t=0;4>t;t++)w.add(v[t],v[t],A)};z._toRenderCoords=function(v,A,t,C){r[0]=v[A];r[1]=v[t];r[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(r,this._tilingScheme.spatialReference,C);return C};return b._createClass(D)}();const u=x.create(),p=[c.createScreenPointArray(),c.createScreenPointArray(),
c.createScreenPointArray(),c.createScreenPointArray()],h=x.create(),r=n.create(),q=[n.create(),n.create(),n.create(),n.create()],y=[0,0,0,0],B=c.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){let p=function(){function B(z){this._renderCoordsHelper=z;this._surfaceElevation=0;this._cache=new Map;this._frustum=new k.Frustum(z);this._extendedFrustum=new k.Frustum(z);this._intersector=new u.FrustumExtentIntersection({renderCoordsHelper:z});this._renderCoordsHelper=z}var D=B.prototype;D.begin=function(z,v){this._surfaceElevation=v;this._aboveGround=this._renderCoordsHelper.getAltitude(z.eye)>v;this._frustum.update(z);this._shortenFrustumFarPlane(this._frustum);
this._updateExtendedFrustum(z)};D.end=function(){this._cache.clear()};D.calculate=function(z){if(this._allTilesInvisible)return e.Visibility.INVISIBLE;const v=this._renderCoordsHelper.viewingMode===d.ViewingMode.Global&&2<=z.lij[0]&&6>z.lij[0],A=this._getOrCalculateSingleTileVisibility(z,!v);return A!==e.Visibility.INVISIBLE&&v?this._calculateAggregatedChildrenVisibility(z):A};D._shortenFrustumFarPlane=function(z){var v=k.Frustum.nearFarLineIndices;const A=z.mutablePoints;for(const t of v){const [C,
E]=t;v=A[C];n.subtract(h,A[E],v);n.scale(h,h,.95);n.add(A[E],v,h)}z.updatePoints(A)};D._calculateAggregatedChildrenVisibility=function(z){let v=e.Visibility.INVISIBLE;var A=this._cache.get(z.id);if(null!=A)return A;A=y.acquire();z.getChildren(A);for(const t of A){const C=this.calculate(t);if(C!==e.Visibility.INVISIBLE&&(v=C,C===e.Visibility.VISIBLE_ON_SURFACE))break}y.release(A);this._cache.set(z.id,v);return v};D._getOrCalculateSingleTileVisibility=function(z,v){var A=this._cache.get(z.id);if(null!=
A)return A;A=this._calculateSingleTileVisibility(z);v&&this._cache.set(z.id,A);return A};D._calculateSingleTileVisibility=function(z){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===d.ViewingMode.Global&&12>z.lij[0]){if(this._calculateSingleTileVisibilitySided(z,!1)===e.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(z,!0)}else return this._calculateSingleTileVisibilitySided(z,this._aboveGround)};D._calculateSingleTileVisibilitySided=function(z,v){this._intersector.update(z.extent,
z.tilingScheme.spatialReference,this._surfaceElevation,v);z=m.getReferenceEllipsoid(z.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,z)?this._intersector.isVisibleInFrustum(this._frustum,z,!0)?e.Visibility.VISIBLE_ON_SURFACE:e.Visibility.VISIBLE_WHEN_EXTENDED:e.Visibility.INVISIBLE};D._updateExtendedFrustum=function(z){this._extendedFrustum.update(z);this._shortenFrustumFarPlane(this._extendedFrustum);var v=this._renderCoordsHelper.worldUpAtPosition(z.eye,
h);this._aboveGround||n.negate(v,v);v=c.acosClamped(-n.dot(v,z.viewForward));this._allTilesInvisible=v>(Math.PI+z.fovY)/2;if(!this._allTilesInvisible&&(this._hasExtendedFrustum=v>z.fovY/2)){z=this._extendedFrustumParameters();v=this._extendedFrustum.mutablePoints;for(let A=0;4>A;A++){const t=z.pointIndices[A],C=v[t],E=this._renderCoordsHelper.getAltitude(C);if(z.needsAltitudeAdjustment(E)){this._renderCoordsHelper.worldUpAtPosition(C,h);switch(t){case l.PointIndex.FAR_BOTTOM_LEFT:case l.PointIndex.FAR_TOP_LEFT:case l.PointIndex.NEAR_BOTTOM_LEFT:case l.PointIndex.NEAR_TOP_LEFT:g.projectVector(this._extendedFrustum.planes[l.PlaneIndex.LEFT],
h,h);break;case l.PointIndex.FAR_BOTTOM_RIGHT:case l.PointIndex.FAR_TOP_RIGHT:case l.PointIndex.NEAR_BOTTOM_RIGHT:case l.PointIndex.NEAR_TOP_RIGHT:g.projectVector(this._extendedFrustum.planes[l.PlaneIndex.RIGHT],h,h)}n.scale(h,h,z.direction);this._renderCoordsHelper.intersectInfiniteManifold(f.wrap(C,h),z.zWithMargin,C)}}this._extendedFrustum.updatePoints(v);g.fromPoints(v[l.PointIndex.NEAR_BOTTOM_LEFT],v[l.PointIndex.NEAR_BOTTOM_RIGHT],v[l.PointIndex.NEAR_TOP_RIGHT],r);g.fromPoints(v[l.PointIndex.NEAR_BOTTOM_RIGHT],
v[l.PointIndex.NEAR_TOP_RIGHT],v[l.PointIndex.NEAR_TOP_LEFT],q);0>n.dot(g.normal(r),g.normal(q))&&(z=this._extendedFrustum.mutablePoints,this._aboveGround?[z[l.PointIndex.NEAR_BOTTOM_LEFT],z[l.PointIndex.NEAR_BOTTOM_RIGHT]]=[z[l.PointIndex.NEAR_BOTTOM_RIGHT],z[l.PointIndex.NEAR_BOTTOM_LEFT]]:[z[l.PointIndex.NEAR_TOP_LEFT],z[l.PointIndex.NEAR_TOP_RIGHT]]=[z[l.PointIndex.NEAR_TOP_RIGHT],z[l.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(z))}};D._extendedFrustumParameters=function(){return this._aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};D._extendedFrustumParametersAboveSurface=function(){const z=this._surfaceElevation-1;return{zWithMargin:z,pointIndices:k.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(v){return v>z}}};D._extendedFrustumParametersBelowSurface=function(){const z=this._surfaceElevation+1;return{zWithMargin:z,pointIndices:k.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(v){return v<z}}};
return b._createClass(B)}();const h=x.create(),r=g.create(),q=g.create(),y=new w(Array,B=>{4!==B.length&&(B[0]=new e.FeatureTileDescriptor3D,B[1]=new e.FeatureTileDescriptor3D,B[2]=new e.FeatureTileDescriptor3D,B[3]=new e.FeatureTileDescriptor3D)},B=>{B[0].release();B[1].release();B[2].release();B[3].release()});a.FeatureTileVisibility3D=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){const y=.5*Math.PI,B=y/Math.PI*180;let D=function(){function H(I){this._renderCoordsHelper=I.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:l.create(),direction:l.create()};for(I=0;4>I;I++)this._extent[I]={origin:l.create(),direction:l.create(),cap:{next:null,direction:l.create()}},this._planes[I]=p.create();this._planes[k.PlaneIndex.NEAR]=p.create();this._planes[k.PlaneIndex.FAR]=p.create();this._planesWithoutFar=
this._planes.slice(0,5)}var K=H.prototype;K.update=function(I,L,R,O=!0){const J=this._extent;this._toRenderBoundingExtent(I,L,R);m.add(this._center.origin,J[0].origin,J[2].origin);m.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);O||m.scale(this._center.direction,this._center.direction,-1);for(R=0;4>R;R++){const M=J[R];this._renderCoordsHelper.worldUpAtPosition(M.origin,M.direction);const G=J[3===R?0:R+1];M.cap.next=
G.origin;m.direction(M.cap.direction,M.origin,G.origin);p.fromVectorsAndPoint(M.direction,M.cap.direction,M.origin,this._planes[R]);O||m.scale(M.direction,M.direction,-1)}p.fromVectorsAndPoint(J[0].cap.direction,J[1].cap.direction,J[0].origin,this._planes[k.PlaneIndex.NEAR]);O?p.negate(this._planes[k.PlaneIndex.NEAR],this._planes[k.PlaneIndex.FAR]):(p.copy(this._planes[k.PlaneIndex.FAR],this._planes[k.PlaneIndex.NEAR]),p.negate(this._planes[k.PlaneIndex.NEAR],this._planes[k.PlaneIndex.NEAR]));this._maxSpan=
Math.max(Math.abs(I[0]-I[2]),Math.abs(I[1]-I[3]));this._maxSpanSpatialReference=L;this._minGlobalAltitude=.9*g.getReferenceEllipsoid(this._maxSpanSpatialReference).radius};K.isVisibleInFrustum=function(I,L,R=!1){if(null==I)return!1;if(this._renderCoordsHelper.viewingMode===r.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?B:y*L))return!0;if(null!=I.altitude&&I.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(I)}if(0===this._maxSpan)return L=
this._extent[0],!R&&I.intersectsRay(h.wrap(L.origin,L.direction))?!0:!1;for(L=0;L<this._extent.length;L++){var O=this._extent[L];if(!R&&I.intersectsRay(h.wrap(O.origin,O.direction))||I.intersectsLineSegment(u.fromPoints(O.origin,O.cap.next,F),O.cap.direction))return!0}R=R?this._planes:this._planesWithoutFar;for(L=0;L<I.lines.length;L++)if(O=I.lines[L],q.frustumLineSegment(R,O.origin,O.endpoint,O.direction))return!0;return!1};K._toRenderBoundingExtentGlobal=function(I,L,R){e.center(I,v);v[2]=R;f.computeTranslationToOriginAndRotation(L,
v,A,this._renderCoordsHelper.spatialReference);n.invert(t,A);d.empty(C);for(const {x0:O,x1:J,y0:M,y1:G}of z)for(let P=0;5>P;P++){const U=P/4;v[0]=w.lerp(I[O],I[J],U);v[1]=w.lerp(I[M],I[G],U);v[2]=R;f.projectVectorToVector(v,L,v,this._renderCoordsHelper.spatialReference);m.transformMat4(v,v,t);d.expandWithVec3(C,v)}m.set(this._extent[0].origin,C[0],C[1],C[2]);m.set(this._extent[1].origin,C[3],C[1],C[2]);m.set(this._extent[2].origin,C[3],C[4],C[2]);m.set(this._extent[3].origin,C[0],C[4],C[2]);for(I=
0;4>I;++I)m.transformMat4(this._extent[I].origin,this._extent[I].origin,A)};K._toRenderBoundingExtentLocal=function(I,L,R){f.projectBoundingRect(I,L,E,this._renderCoordsHelper.spatialReference);m.set(this._extent[0].origin,E[0],E[1],R);m.set(this._extent[1].origin,E[2],E[1],R);m.set(this._extent[2].origin,E[2],E[3],R);m.set(this._extent[3].origin,E[0],E[3],R)};K._toRenderBoundingExtent=function(I,L,R){switch(this._renderCoordsHelper.viewingMode){case r.ViewingMode.Global:this._toRenderBoundingExtentGlobal(I,
L,R);break;case r.ViewingMode.Local:this._toRenderBoundingExtentLocal(I,L,R);break;default:c.neverReached(this._renderCoordsHelper.viewingMode)}};K._isVisibleInFrustumGlobal=function(I){if(0>p.signedDistance(I.planes[k.PlaneIndex.NEAR],this._center.origin)&&0>m.dot(this._center.direction,I.direction))return!0;for(let L=0;4>L;L++){const R=this._extent[L];if(0>p.signedDistance(I.planes[k.PlaneIndex.NEAR],R.origin)&&0>m.dot(R.direction,I.direction))return!0}return!1};return b._createClass(H)}();const z=
[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],v=l.create(),A=x.create(),t=x.create(),C=d.create(),E=e.create(),F=u.create();a.FrustumExtentIntersection=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c,w){const n=c.create();a.projectToBoundingBox=function(x,m,l){if(b.isNone(x)||b.isNone(l))return!1;
let g;n[0]=null!=x.xmin?x.xmin:0;n[1]=null!=x.ymin?x.ymin:0;n[2]=null!=x.zmin?x.zmin:0;g=w.projectBuffer(n,x.spatialReference,0,m,l,0,1);n[0]=null!=x.xmax?x.xmax:0;n[1]=null!=x.ymax?x.ymax:0;n[2]=null!=x.zmax?x.zmax:0;g=g&&w.projectBuffer(n,x.spatialReference,0,m,l,3,1);null==x.xmin&&(m[0]=-Infinity);null==x.ymin&&(m[1]=-Infinity);null==x.zmin&&(m[2]=-Infinity);null==x.xmax&&(m[3]=Infinity);null==x.ymax&&(m[4]=Infinity);null==x.zmax&&(m[5]=Infinity);return g};a.toBoundingRect=function(x,m,l){if(b.isNone(x)||
b.isNone(l))return!1;let g;n[0]=null!=x.xmin?x.xmin:0;n[1]=null!=x.ymin?x.ymin:0;n[2]=null!=x.zmin?x.zmin:0;g=w.projectBuffer(n,x.spatialReference,0,n,l,0,1);m[0]=n[0];m[1]=n[1];n[0]=null!=x.xmax?x.xmax:0;n[1]=null!=x.ymax?x.ymax:0;n[2]=null!=x.zmax?x.zmax:0;g=g&&w.projectBuffer(n,x.spatialReference,0,n,l,0,1);m[2]=n[0];m[3]=n[1];null==x.xmin&&(m[0]=-Infinity);null==x.ymin&&(m[1]=-Infinity);null==x.xmax&&(m[2]=Infinity);null==x.ymax&&(m[3]=Infinity);return g};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z){c=function(A){function t(){var E=C.apply(this,arguments);E._propertiesPool=new B.PropertiesPool({camera:D.Camera},a._assertThisInitialized(E));E._lastSeenCameraProjectionValues=new D.Camera;E.mode=z.RenderState.ANIMATING;E.rasterPixelRatio=1;E.contentPixelRatio=1;E.events=new w;E.viewingMode=h.ViewingMode.Global;E._cameraChanged=!1;E._updateQueue=[];E._processingUpdates=!1;return E}a._inherits(t,A);var C=a._createSuper(t);A=t.prototype;A.init=
function(E,F){this._set("viewingMode",E);this._set("spatialReference",F);this._set("constraints",new r.Constraints({mode:this.viewingMode}))};A.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new B.PropertiesPool({camera:D.Camera},this)};A.createInitialCamera=function(){if(this.viewingMode===h.ViewingMode.Global){const E=u.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new D.Camera({eye:k.fromValues(4*E,0,0),center:k.fromValues(E,0,0),
up:k.fromValues(0,0,1)})}else this.camera=new D.Camera({eye:k.fromValues(0,0,100),center:k.fromValues(0,0,0),up:k.fromValues(0,1,0)})};A.switchCameraController=function(E){this.cameraController=E;return E.state!==y.State.Rejected};A.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};A.updateCamera=function(E){this._updateQueue.push(E);this._processUpdateQueue()};A._processUpdateQueue=function(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=
!0;var E=this._updateQueue.shift();v.copyFrom(this._get("camera"));E(v);this.camera=v;this._processingUpdates=!1;this._processUpdateQueue()}};A._cameraProjectionChanged=function(E,F){return E.fov!==F.fov||E.fullViewport[0]!==F.fullViewport[0]||E.fullViewport[1]!==F.fullViewport[1]||E.fullViewport[2]!==F.fullViewport[2]||E.fullViewport[3]!==F.fullViewport[3]||E.padding[D.PaddingSide.TOP]!==F.padding[D.PaddingSide.TOP]||E.padding[D.PaddingSide.RIGHT]!==F.padding[D.PaddingSide.RIGHT]||E.padding[D.PaddingSide.BOTTOM]!==
F.padding[D.PaddingSide.BOTTOM]||E.padding[D.PaddingSide.LEFT]!==F.padding[D.PaddingSide.LEFT]?!0:!1};a._createClass(t,[{key:"animation",get:function(){return this.cameraController instanceof q.AnimationController&&n.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(E){E!==v&&v.copyFrom(E);v.computeUp(this.viewingMode);this.events.emit("before-camera-change",v);E=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,
v)&&(this._lastSeenCameraProjectionValues.copyFrom(v),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!E||!E.equals(v))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(v)),this._cameraChanged=!E||!E.almostEquals(v)){const F=e.afterDispatch(()=>{this._cameraChanged=!1;F.remove()})}}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"contentCamera",get:function(){return n.unwrapOr(this._contentCamera,this.camera)},set:function(E){this._contentCamera=
n.isSome(E)?E.clone():null}},{key:"fixedContentCamera",get:function(){return n.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return this.viewingMode===h.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===h.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},
set:function(E){this.stopActiveCameraController()?(E&&(this.removeHandles("ViewStateHandles"),this.addHandles(x.when(()=>E.state===y.State.Finished||E.state===y.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(F=>E.onControllerEnd(F))},{sync:!0,once:!0}),"ViewStateHandles"),E.onControllerStart(this.camera)),this._set("cameraController",E)):E&&(E.state=y.State.Rejected)}}]);return t}(c);b.__decorate([m.property()],c.prototype,"mode",void 0);b.__decorate([m.property({readOnly:!0,
type:p})],c.prototype,"animation",null);b.__decorate([m.property({type:D.Camera})],c.prototype,"camera",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"pixelRatio",null);b.__decorate([m.property()],c.prototype,"rasterPixelRatio",void 0);b.__decorate([m.property()],c.prototype,"contentPixelRatio",void 0);b.__decorate([m.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([m.property({type:D.Camera})],c.prototype,"contentCamera",null);b.__decorate([m.property({readOnly:!0})],
c.prototype,"fixedContentCamera",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"events",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"isLocal",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"spatialReference",void 0);b.__decorate([m.property()],
c.prototype,"navigating",null);b.__decorate([m.property()],c.prototype,"stationary",null);b.__decorate([m.property()],c.prototype,"_cameraChanged",void 0);b.__decorate([m.property()],c.prototype,"cameraController",null);b=c=b.__decorate([d.subclass("esri.views.3d.state.ViewState")],c);const v=new D.Camera;return b})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){function h(A){B&&B.viewingMode===A||(B=k.newIntersector(A));return B}let r=function(){function A(C,E,F){this.viewingMode=C;this._forEachLayer=E;this._view=F;this._externalIntersectionHandlers=new w;this._tolerance=k.DEFAULT_TOLERANCE;this._tmpRay=g.create();this._tmpRegion=l.create();this._validateHUDIntersector=k.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}var t=A.prototype;t.intersectScreen=function(C,E,F){return this.intersectRay(this._getPickRay(C,
this._tmpRay),h(this.viewingMode),E,F)};t.intersectScreenFreePointFallback=function(C,E,F){return this.intersectRayFreePointFallback(this._getPickRay(C,this._tmpRay),E,F)};t.intersectRayFreePointFallback=function(C,E,F){return this.intersectRay(C,h(this.viewingMode),E,F)||this._intersectRayFreePointLocal(C,E)};t.intersectRay=function(C,E,F,H){E.options.selectionMode=!1;E.options.store=u.StoreResults.MIN;this.computeIntersection(C,E,H);return E.results.min?E.results.min.getIntersectionPoint(F):!1};
t.getCenterRayWithSubpixelOffset=function(C,E,F=.5,H=.5){C.getRenderCenter(v,F,H);v[0]+=.0466;v[1]-=.0123;return e.fromRenderAtEye(C,v,E)};t.intersectIntersectorScreen=function(C,E,F){this.computeIntersection(this._getPickRay(C,this._tmpRay),E,F)};t.intersectToolIntersectorScreen=function(C,E,F){C=this._getPickRay(C,this._tmpRay);this.intersectToolIntersectorRay(C,E,F)};t.intersectToolIntersectorRay=function(C,E,F){E.options.selectionMode=!0;this.computeIntersection(C,E,F);const H=E.results.min;this._view.basemapTerrain&&
this._view.basemapTerrain.opaque||p.isValidIntersectorResult(H)&&H.intersector!==u.IntersectorType.TERRAIN||(E.options.selectionMode=!1,this.computeIntersection(C,E,F))};t.setTolerance=function(C=k.DEFAULT_TOLERANCE){this._tolerance=C};t.addIntersectionHandler=function(C){this._externalIntersectionHandlers.push(C);this._externalIntersectionHandlers.sort((E,F)=>E.type===u.IntersectorType.TERRAIN?1:F.type===u.IntersectorType.TERRAIN?-1:0)};t.removeIntersectionHandler=function(C){null!=this._externalIntersectionHandlers.removeUnordered(C)&&
this._externalIntersectionHandlers.sort((E,F)=>E.type===u.IntersectorType.TERRAIN?1:F.type===u.IntersectorType.TERRAIN?-1:0)};t._getPickRay=function(C,E){return e.fromScreen(this._view.state.camera,C,E)};t._intersectRayFreePointLocal=function(C,E){if(this.viewingMode!==d.ViewingMode.Local||c.isNone(C))return!1;x.add(E,C.origin,x.normalize(f.sv3d.get(),C.direction));return!1};t.intersectElevationFromScreen=function(C,E,F=0,H=null){return this._intersectElevation(this._getPickRay(C,this._tmpRay),E,
F,H)};t._intersectElevation=function(C,E,F=0,H=null){if(c.isNone(C))return null;var K=c.isSome(E)?E.mode:"absolute-height",I=c.isSome(E)?c.unwrapOr(E.offset,0):0,L="on-the-ground"!==K?I+F:0;E=L/this._view.renderCoordsHelper.unitInMeters;if("absolute-height"===K)return this._view.renderCoordsHelper.intersectInfiniteManifold(C,L,z)?(F=this._view.computeMapPointFromVec3d(z),F.z??(F.z=0),F.z-=I,F):null;I=this._view.state.camera;const R=n.castRenderScreenPointArray3(f.sv3d.get());I.projectToRenderScreen(C.origin,
R);L=new D(null,this._forEachLayer);const O=this._view.slicePlane,J=c.isSome(O)?p.sliceFilterPredicate(O):null,M=k.newIntersector(this.viewingMode);M.options.store=u.StoreResults.MIN;M.options.verticalOffset=E;E=C.origin;C=x.add(f.sv3d.get(),E,C.direction);M.reset(E,C,I);M.point=R;const G=c.isSome(H)?"type"in H&&"graphics"===H.type?P=>P.metadata?.layerUid!==H.uid:P=>P.metadata?.graphicUid!==H.uid:null;switch(K){case "relative-to-scene":M.intersect(L.layers,R,this._tolerance,null,P=>(c.isNone(G)||
G(P))&&!!P.metadata?.isElevationSource);this._externalIntersectionHandlers.forAll(P=>{P.type!==u.IntersectorType.I3S&&P.type!==u.IntersectorType.TERRAIN||P.intersect(M,P.slicePlaneEnabled?J:null,M.rayBegin,M.rayEnd,R)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(P=>{P.isGround&&P.intersect(M,P.slicePlaneEnabled?J:null,M.rayBegin,M.rayEnd,R)})}return M.results.min.getIntersectionPoint(z)?(K=this._view.computeMapPointFromVec3d(z),K.z=F,K):null};t.computeIntersection=
function(C,E,F){if(!c.isNone(C)){var H=this._view.state.camera,K=n.castRenderScreenPointArray3(f.sv3d.get());H.projectToRenderScreen(C.origin,K);var I=new D(F,this._forEachLayer);E.options.selectOpaqueTerrainOnly=!F||!("include"in F||"exclude"in F);var L=C.origin,R=x.add(f.sv3d.get(),C.origin,C.direction);E.reset(L,R,H);E.intersect(I.layers,K,this._tolerance);C=this._view.slicePlane;var O=c.isSome(C)?p.sliceFilterPredicate(C):null;E.intersect(I.sliceableLayers,K,this._tolerance,O);var J=F&&(F.requiresGroundFeedback||
F.enableDraped);this._externalIntersectionHandlers.forAll(M=>{var G=M.layerUid;const P=Array.isArray(G);G=P?G:[G];P&&(E.options.filteredLayerUids=[]);let U=!1;for(const N of G)I.filterLayerUid(N)?U=!0:P&&E.options.filteredLayerUids.push(N);E.options.isFiltered=!U;(M.isGround&&J||!E.options.isFiltered)&&M.intersect(E,M.slicePlaneEnabled?O:null,L,R,K)});C=f.sv3d.get();H=this._view.basemapTerrain;if(F&&F.enableDraped&&c.isSome(H.spatialReference)&&E.results.ground.getIntersectionPoint(C)){F=H.overlayManager.renderer;
const M=this._view.renderCoordsHelper.spatialReference,G=f.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(C,G,H.spatialReference);G[2]=c.unwrapOr(this._view.elevationProvider?.getElevation(C[0],C[1],C[2],M,"ground"),0);F.intersect(E,G,E.results.ground,P=>I.filterRenderGeometry(P))}E.sortResults();this._processHUDResults(E)}};t._processHUDResults=function(C){var E=C.results.hud;l.copy(this._tmpRegion,l.NEGATIVE_INFINITY);const F=this._view.state.camera,H=[],K=this._tmpRegion;var I=G=>{const P=
new y(G);F.projectToRenderScreen(G.target.center,P.screenPoint);P.screenPoint[0]=Math.floor(P.screenPoint[0]);P.screenPoint[1]=Math.floor(P.screenPoint[1]);H.push(P);l.expandPointInPlace(K,P.screenPoint)};C.sortResults(E.all);c.isSome(E.min.dist)&&I(E.min);for(var L of E.all)E.min.target.object!==L.target.object&&E.max.target.object!==L.target.object&&I(L);c.isSome(E.max.dist)&&E.max.target.object!==E.min.target.object&&I(E.max);if(H.length){K[0]===K[2]&&(K[2]+=1);K[1]===K[3]&&(K[3]+=1);E=F.fullWidth;
I=F.fullHeight;var R=Math.max(0,K[0]-1),O=Math.max(0,K[1]-1);L=Math.min(l.width(K)+2,E-R);var J=Math.min(l.height(K)+2,I-O),M=new Uint8Array(L*J*4);this._view._stage.renderer.readHUDVisibility(R,O,L,J,M);R=!0;O=c.isNone(C.results.max.dist);J=0;for(const G of H)for(const P of q)if(M[4*(Math.min(G.screenPoint[0]+P[0],E)-K[0]+(Math.min(G.screenPoint[1]+P[1],I)-K[1])*L)]){R&&(C.results.min.copy(G.result),R=!1);O&&C.results.max.copy(G.result);C.options.store===u.StoreResults.ALL&&C.results.all.splice(J++,
0,G.result);break}}};return b._createClass(A)}();const q=(()=>{const A=[];for(let t=-1;1>=t;t++)for(let C=-1;1>=C;C++)A.push([C+1,t+1]);return A})();let y=b._createClass(function(A){this.result=A;this.screenPoint=n.createRenderScreenPointArray3()}),B,D=function(){function A(C,E){this.layers=[];this.sliceableLayers=[];this.include=C?.include;this.exclude=C?.exclude;E(F=>{F.pickable&&this.filterLayerUid(F.apiLayerUid)&&(F.sliceable?this.sliceableLayers:this.layers).push(F)})}var t=A.prototype;t.filterLayerUid=
function(C){const {include:E,exclude:F}=this;return c.isNone(C)?null==E&&null==F:(null==E||E.has(C))&&(null==F||!F.has(C))};t.filterRenderGeometry=function(C){return this.filterLayerUid(C.layerUid)};return b._createClass(A)}();const z=m.create(),v=n.createRenderScreenPointArray3();a.SceneIntersectionHelper=r;a.isIntersectionHandler=function(A){return"object"===typeof A&&"intersect"in A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(h,r,q,y,B,D,z){for(const v of r)r=v.getElevation(q,y,B,D,z),x.isSome(r)&&(h=x.isSome(h)?Math.max(r,h):r);return h}a.CombinedElevationProvider=function(h){function r(y){y=q.call(this,y);y._im=[];y._ground=[];y._scene=[];y._handles=new Map;y.lastElevationQuery=null;y.elevationCacheEnabled=!1;return y}b._inherits(r,h);var q=b._createSuper(r);h=r.prototype;h.destroy=function(){this._elevationQueryCached=x.destroyMaybe(this._elevationQueryCached)};h.enableElevationCache=
function(y){y||(this.lastElevationQuery=null);this.elevationCacheEnabled=y};h.getElevation=function(y,B,D,z,v){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var A=this.lastElevationQuery;if(y===A.x&&B===A.y&&D===A.z&&k.equals(z,A.spatialReference)&&v===A.queryContext)return A.result}A=p(null,this._im,y,B,D,z,v);x.isNone(A)&&(A=p(A,this._ground,y,B,D,z,v));"scene"===v&&(A=p(A,this._scene,y,B,D,z,v));this.elevationCacheEnabled&&(this.lastElevationQuery={x:y,y:B,z:D,spatialReference:z,
queryContext:v,result:A});return A};h.getSphereElevationBounds=function(y,B){let D=Infinity,z=-Infinity;for(const v of[this._im,this._ground,this._scene])v.forEach(A=>{A.getSphereElevationBounds&&(A=A.getSphereElevationBounds(y,B),x.isSome(A)&&(D=Math.min(D,A.min),z=Math.max(z,A.max)))});return{min:D,max:z}};h.queryElevation=function(y,B,D,z,v,A=null,t=0){const C=m.createResolver();this._elevationQuery.queryElevation(y,B,A,t).then(E=>{"scene"===v&&(E=p(E,this._scene,y,B,D,z,v));C.resolve(E)}).catch(E=>
{m.isAbortError(E)?C.reject(E):C.resolve(this.getElevation(y,B,D,z,v))});return C.promise};h.register=function(y,B){this._handles.set(B,B.on("elevation-change",D=>this.emit("elevation-change",D)));this._providersFromContext(y).push(B)};h.unregister=function(y){this._handles.has(y)&&(this._handles.get(y)?.remove(),this._handles.delete(y));for(const B of[this._im,this._ground,this._scene]){const D=B.indexOf(y);-1<D&&B.splice(D,1)}};h._providersFromContext=function(y){switch(y){case "ground":return this._ground;
case "im":return this._im;case "scene":return this._scene}};b._createClass(r,[{key:"spatialReference",get:function(){return this.view?.basemapTerrain?.spatialReference}},{key:"_elevationQuery",get:function(){x.isNone(this._elevationQueryCached)&&(this._elevationQueryCached=new u.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQueryCached}}]);return r}(n.EventedMixin(w));c.__decorate([l.property({constructOnly:!0})],
a.CombinedElevationProvider.prototype,"view",void 0);c.__decorate([l.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=c.__decorate([e.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,c,w,n,x,m,l){c=function(){function f(e,k){this.spatialReference=e;this._view=k}var d=f.prototype;d.getElevation=function(e,k,u){return this._view.elevationProvider.getElevation(e,k,0,this.spatialReference,u)};d.queryElevation=async function(e,k,u,p,h){return this._view.elevationProvider.queryElevation(e,k,0,this.spatialReference,h,u,p)};return b._createClass(f)}();let g=function(){function f(e,k,u,p){this.spatialReference=k;this._getElevationQueryProvider=u;this._queries=[];this._queryOptions=
{...p,ignoreInvisibleLayers:!0};this._frameTask=e.registerTask(m.TaskPriority.ELEVATION_QUERY,this)}var d=f.prototype;d.destroy=function(){this._frameTask.remove()};d.queryElevation=function(e,k,u,p=0){return new Promise((h,r)=>{const q={x:e,y:k,minDemResolution:p,result:{resolve:h,reject:r},signal:u};this._queries.push(q);x.onAbort(u,()=>{w.remove(this._queries,q);r(x.createAbortError())})})};d.runTask=function(e){const k=this._queries;this._queries=[];const u=this._getElevationQueryProvider();if(u){var p=
k.map(y=>[y.x,y.y]),h=k.reduce((y,B)=>Math.min(y,B.minDemResolution),Infinity);p=new l({points:p,spatialReference:this.spatialReference});var r=1<k.length&&k.some(y=>!!y.signal)?new AbortController:null,q=n.isSome(r)?r.signal:k[0].signal;if(n.isSome(r)){let y=0;k.forEach(B=>x.onAbort(B.signal,()=>{y++;B.result.reject(x.createAbortError());y===k.length&&r.abort()}))}u.queryElevation(p,{...this._queryOptions,minDemResolution:h,signal:q}).then(y=>{k.forEach((B,D)=>{n.isSome(B.signal)&&B.signal.aborted?
B.result.reject(x.createAbortError()):B.result.resolve(y.geometry.points[D][2])})}).catch(y=>{k.forEach(B=>B.result.reject(y))})}else k.forEach(y=>y.result.reject());e.madeProgress()};b._createClass(f,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const e=this;return{update:()=>0<e._queries.length&&e.runTask(m.noBudget)}}}]);return f}();a.ElevationQuery=g;a.ViewElevationProvider=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../core/has","../../../core/time"],function(a,b,c){function w(){const x=!!b("esri-mobile"),m=!!b("ios"),l=c.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:c.Milliseconds(0)},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:c.Milliseconds(0)},fadeDuration:c.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:x?
.8:1,polylineLodFactor:x?1.2:1.5,snapshotAvailable:!m,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:l},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:x},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),
textureFadeDuration:l},fadeDuration:l,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:x?600:750,additionalCacheMemory:x?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:x?1.2:2,polylineLodFactor:x?1.2:2,snapshotAvailable:!m,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:c.Milliseconds(0),
lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:l},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),textureFadeDuration:l},fadeDuration:l,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:x?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:x?
1:Infinity}}}let n=function(){function x(){}x.isValidProfile=function(m){return m in x.profiles};x.getDefaultProfile=function(){return b("esri-iPhone")?"low":"medium"};x.apply=function(m,l){m=x.profiles[m];l.graphics3D.maxTotalNumberOfFeatures=m.graphics3D.maxTotalNumberOfFeatures;l.graphics3D.maxTotalNumberOfPrimitives=m.graphics3D.maxTotalNumberOfPrimitives;l.graphics3D.polygonLodFactor=m.graphics3D.polygonLodFactor;l.graphics3D.polylineLodFactor=m.graphics3D.polylineLodFactor;l.graphics3D.snapshotAvailable=
m.graphics3D.snapshotAvailable;l.graphics3D.skipHighSymbolLods=m.graphics3D.skipHighSymbolLods;const g=l.sceneService.object,f=m.sceneService.object;g.lodFactor=f.lodFactor;g.lodCrossfadeinDuration=f.lodCrossfadeinDuration;g.lodCrossfadeoutDuration=f.lodCrossfadeoutDuration;g.lodCrossfadeUncoveredDuration=f.lodCrossfadeUncoveredDuration;l.sceneService.point.lodFactor=m.sceneService.point.lodFactor;l.sceneService.integratedMesh.lodFactor=m.sceneService.integratedMesh.lodFactor;l.sceneService.pointCloud.lodFactor=
m.sceneService.pointCloud.lodFactor;l.sceneService.uncompressedTextureDownsamplingEnabled=m.sceneService.uncompressedTextureDownsamplingEnabled;l.tiledSurface.lodBias=m.tiledSurface.lodBias;l.tiledSurface.angledSplitBias=m.tiledSurface.angledSplitBias;l.tiledSurface.reduceTileLevelDifferences=m.tiledSurface.reduceTileLevelDifferences;l.tiledSurface.textureFadeDuration=m.tiledSurface.textureFadeDuration;l.heatmap.pixelRatio=m.heatmap.pixelRatio;l.heatmap.maxTotalNumberOfFeatures=m.heatmap.maxTotalNumberOfFeatures;
l.fadeDuration=m.fadeDuration;l.antialiasingEnabled=m.antialiasingEnabled;l.physicallyBasedRenderingEnabled=m.physicalBasedRenderingEnabled;l.highQualityTransparency=m.highQualityTransparency;l.memoryLimit=m.memoryLimit;l.additionalCacheMemory=m.additionalCacheMemory;l.frameRate=m.frameRate;l.maximumPixelRatio=m.maximumPixelRatio};return a._createClass(x)}();n.test={reset(){const x=w();for(const m in x)n.profiles[m]=x[m]}};(n||(n={})).profiles=w();return n})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32 ../../../chunks/vec4f64".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){const k=new c([0,255,255]),u=new c([0,0,0]);w=function(p){function h(){var q=r.apply(this,arguments);q.color=k.clone();q.haloColor=null;q.haloOpacity=1;q.fillOpacity=.25;q.shadowOpacity=.4;q.shadowColor=u.clone();q.shadowDifference=.2;return q}a._inherits(h,p);var r=a._createSuper(h);h.toEngineOptions=function(q){const y=c.toUnitRGBA(q.color??k),B=n.isSome(q.haloColor)?c.toUnitRGBA(q.haloColor):y,D=c.toUnitRGBA(q.shadowColor??u),z=q.haloOpacity??1,v=q.fillOpacity??
.25,A=q.shadowOpacity??.4;q=q.shadowDifference??.2;return{color:d.fromValues(y[0],y[1],y[2],y[3]),haloColor:d.fromValues(B[0],B[1],B[2],B[3]),haloOpacity:z,haloOpacityOccluded:.25*z,fillOpacity:v,fillOpacityOccluded:.25*v,shadowOpacity:A,shadowColor:e.fromValues(D[0],D[1],D[2],D[3]),occludedShadowOpacity:A*(1-q)}};return a._createClass(h)}(w);b.__decorate([x.property({type:c})],w.prototype,"color",void 0);b.__decorate([x.property({type:c})],w.prototype,"haloColor",void 0);b.__decorate([x.property()],
w.prototype,"haloOpacity",void 0);b.__decorate([x.property()],w.prototype,"fillOpacity",void 0);b.__decorate([x.property()],w.prototype,"shadowOpacity",void 0);b.__decorate([x.property({type:c})],w.prototype,"shadowColor",void 0);b.__decorate([x.property()],w.prototype,"shadowDifference",void 0);return w=b.__decorate([f.subclass("esri.views.3d.support.HighlightOptions")],w)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(y){const B=
new Float32Array(4);B[0]=y[0];B[1]=y[1];B[2]=y[2];B[3]=y[3];return B}function w(y,B,D,z){const v=new Float32Array(4);v[0]=y;v[1]=B;v[2]=D;v[3]=z;return v}function n(y,B){return new Float32Array(y,B,4)}function x(){return b()}function m(){return w(1,1,1,1)}function l(){return w(1,0,0,0)}function g(){return w(0,1,0,0)}function f(){return w(0,0,1,0)}function d(){return w(0,0,0,1)}const e=b(),k=m(),u=l(),p=g(),h=f(),r=d(),q=Object.freeze(Object.defineProperty({__proto__:null,ONES:k,UNIT_W:r,UNIT_X:u,
UNIT_Y:p,UNIT_Z:h,ZEROS:e,clone:c,create:b,createView:n,fromValues:w,ones:m,unitW:d,unitX:l,unitY:g,unitZ:f,zeros:x},Symbol.toStringTag,{value:"Module"}));a.ONES=k;a.UNIT_W=r;a.UNIT_X=u;a.UNIT_Y=p;a.UNIT_Z=h;a.ZEROS=e;a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.ones=m;a.unitW=d;a.unitX=l;a.unitY=g;a.unitZ=f;a.vec4f32=q;a.zeros=x})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){c=function(){function e(k,u){this.spatialReference=u;this.unitInMeters=n.getMetersPerUnitForSR(this.spatialReference,x.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=m.getGeometryServiceURL(k&&k.get("portalItem")).catch(()=>{throw new w("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}e.prototype.toGeographic=async function(k){var u=await this._geometryServiceURLPromise;let p=
!0;Array.isArray(k[0])&&"number"!==typeof k[0]||(k=[k],p=!1);k=k.map(h=>h instanceof f?h:new f(h,this.spatialReference));k=new g({geometries:k,outSpatialReference:d.WGS84});u=(await l.project(u,k)).map(h=>"point"===h.type?[h.x,h.y]:void 0).filter(h=>!!h);return p?u:u[0]};return b._createClass(e)}();a.MapCoordsHelper=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,w,n,x){async function m(l=null,g){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!l)throw new c("internal:geometry-service-url-not-configured");l="portal"in l?l.portal||w.getDefault():l;await l.load({signal:g});g=l.helperServices?.geometry?.url;if(!g)throw new c("internal:geometry-service-url-not-configured");return g}a.getGeometryServiceURL=m;a.projectGeometry=async function(l,g,f=null,d){f=await m(f,d);const e=new x;e.geometries=[l];e.outSpatialReference=g;if((l=await n.project(f,
e,{signal:d}))&&Array.isArray(l)&&1===l.length)return l[0];throw new c("internal:geometry-service-projection-failed");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(a,b,c,w,n,x,m){const l=c.ensureType(m);a.project=async function(g,f,d){f=l(f);g=n.parseUrl(g);const e=
{...g.query,f:"json",...f.toJSON()},k=f.outSpatialReference,u=w.getJsonType(f.geometries[0]);f=n.asValidOptions(e,d);return b(g.path+"/project",f).then(({data:{geometries:p}})=>x.decodeGeometries(p,u,k))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,w,n,x,m,l,g){c=function(f){function d(k){k=e.call(this,k);k.geometries=[];k.outSpatialReference=null;k.transformation=null;k.transformForward=null;return k}a._inherits(d,f);var e=a._createSuper(d);d.prototype.toJSON=function(){const k=this.geometries.map(h=>h.toJSON()),u=this.geometries[0],p={};p.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());p.inSR=u.spatialReference.wkid||JSON.stringify(u.spatialReference.toJSON());p.geometries=JSON.stringify({geometryType:g.getJsonType(u),
geometries:k});this.transformation&&(p.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(p.transformForward=this.transformForward);return p};return a._createClass(d)}(c.JSONSupport);b.__decorate([w.property()],c.prototype,"geometries",void 0);b.__decorate([w.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([w.property()],c.prototype,"transformation",void 0);b.__decorate([w.property()],c.prototype,
"transformForward",void 0);return c=b.__decorate([l.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g){let f=
function(h){function r(){var y=q.apply(this,arguments);y.minTotalNumberOfFeatures=2E3;y.maxTotalNumberOfFeatures=5E4;y.maxTotalNumberOfPrimitives=17E5;y.snapshotAvailable=!0;y.polygonLodFactor=1;y.polylineLodFactor=1;y.skipHighSymbolLods=!1;return y}a._inherits(r,h);var q=a._createSuper(r);return a._createClass(r)}(c);b.__decorate([n.property()],f.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([n.property()],f.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([n.property()],f.prototype,
"maxTotalNumberOfPrimitives",void 0);b.__decorate([n.property()],f.prototype,"snapshotAvailable",void 0);b.__decorate([n.property()],f.prototype,"polygonLodFactor",void 0);b.__decorate([n.property()],f.prototype,"polylineLodFactor",void 0);b.__decorate([n.property()],f.prototype,"skipHighSymbolLods",void 0);f=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],f);let d=function(h){function r(){var y=q.apply(this,arguments);y.lodFactor=1;return y}a._inherits(r,h);
var q=a._createSuper(r);return a._createClass(r)}(c);b.__decorate([n.property()],d.prototype,"lodFactor",void 0);d=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],d);let e=function(h){function r(){var y=q.apply(this,arguments);y.lodCrossfadeinDuration=w.Milliseconds(0);y.lodCrossfadeoutDuration=w.Milliseconds(0);y.lodCrossfadeUncoveredDuration=w.Milliseconds(0);return y}a._inherits(r,h);var q=a._createSuper(r);return a._createClass(r)}(d);e=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],
e);let k=function(h){function r(){var y=q.apply(this,arguments);y.object=new e;y.point=new d;y.integratedMesh=new d;y.pointCloud=new d;y.uncompressedTextureDownsamplingEnabled=!1;return y}a._inherits(r,h);var q=a._createSuper(r);return a._createClass(r)}(c);b.__decorate([n.property({type:e})],k.prototype,"object",void 0);b.__decorate([n.property({type:d})],k.prototype,"point",void 0);b.__decorate([n.property({type:d})],k.prototype,"integratedMesh",void 0);b.__decorate([n.property({type:d})],k.prototype,
"pointCloud",void 0);b.__decorate([n.property()],k.prototype,"uncompressedTextureDownsamplingEnabled",void 0);k=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],k);let u=function(h){function r(){var y=q.apply(this,arguments);y.lodBias=0;y.angledSplitBias=1;y.reduceTileLevelDifferences=!0;y.textureFadeDuration=w.Milliseconds(400);return y}a._inherits(r,h);var q=a._createSuper(r);return a._createClass(r)}(c);b.__decorate([n.property()],u.prototype,"lodBias",void 0);
b.__decorate([n.property()],u.prototype,"angledSplitBias",void 0);b.__decorate([n.property()],u.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([n.property()],u.prototype,"textureFadeDuration",void 0);u=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],u);let p=function(h){function r(){var y=q.apply(this,arguments);y.pixelRatio=1;y.maxTotalNumberOfFeatures=5E4;return y}a._inherits(r,h);var q=a._createSuper(r);return a._createClass(r)}(c);b.__decorate([n.property()],
p.prototype,"pixelRatio",void 0);b.__decorate([n.property()],p.prototype,"maxTotalNumberOfFeatures",void 0);p=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],p);c=function(h){function r(){var y=q.apply(this,arguments);y.graphics3D=new f;y.sceneService=new k;y.tiledSurface=new u;y.heatmap=new p;y.fadeDuration=w.Milliseconds(400);y.antialiasingEnabled=!0;y.physicallyBasedRenderingEnabled=!1;y.highQualityTransparency=!0;y.memoryLimit=void 0;y.additionalCacheMemory=
void 0;y.frameRate=void 0;y.maximumPixelRatio=Infinity;return y}a._inherits(r,h);var q=a._createSuper(r);return a._createClass(r)}(c);b.__decorate([n.property({type:f})],c.prototype,"graphics3D",void 0);b.__decorate([n.property({type:k})],c.prototype,"sceneService",void 0);b.__decorate([n.property({type:u})],c.prototype,"tiledSurface",void 0);b.__decorate([n.property({type:p})],c.prototype,"heatmap",void 0);b.__decorate([n.property()],c.prototype,"fadeDuration",void 0);b.__decorate([n.property()],
c.prototype,"antialiasingEnabled",void 0);b.__decorate([n.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([n.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([n.property()],c.prototype,"memoryLimit",void 0);b.__decorate([n.property()],c.prototype,"additionalCacheMemory",void 0);b.__decorate([n.property()],c.prototype,"frameRate",void 0);b.__decorate([n.property()],c.prototype,"maximumPixelRatio",void 0);return c=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],
c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../core/libs/gl-matrix-2/types/vec3 ../../../geometry/projection ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){function q(B){if(r.isSpatialReferenceSupported(B,h.ViewingMode.Global))return 1;B=d.renderSRFromViewSR(!1,B);return n.getMetersPerUnitForSR(B)}let y=function(){function B(z,v,A,t){this.viewingMode=z;this.spatialReference=v;this.unitInMeters=A;this._coordinateSystem=t;this._tmpCoordinateSystem=d.create(t)}var D=B.prototype;D.getAltitude=function(z){return d.altitudeAt(this._coordinateSystem,z)};D.setAltitude=function(z,v,A=z){return d.setAltitudeAt(this._coordinateSystem,
A,v,z)};D.setAltitudeOfTransformation=function(z,v){d.setAltitudeOfTransformation(this._coordinateSystem,v,z,v)};D.worldUpAtPosition=function(z,v){return d.normalAt(this._coordinateSystem,z,v)};D.worldBasisAtPosition=function(z,v,A){return d.axisAt(this._coordinateSystem,z,v,A)};D.basisMatrixAtPosition=function(z,v){const A=this.worldBasisAtPosition(z,f.Axis.X,u.sv3d.get()),t=this.worldBasisAtPosition(z,f.Axis.Y,u.sv3d.get());z=this.worldBasisAtPosition(z,f.Axis.Z,u.sv3d.get());x.set(v,A[0],A[1],
A[2],0,t[0],t[1],t[2],0,z[0],z[1],z[2],0,0,0,0,1);return v};D.headingAtPosition=function(z,v){const A=this.worldUpAtPosition(z,u.sv3d.get());z=this.worldBasisAtPosition(z,f.Axis.Y,u.sv3d.get());v=k.angleAroundAxis(v,z,A);return c.rad2deg(v)};D.intersectManifoldClosestSilhouette=function(z,v,A){d.elevate(this._coordinateSystem,v,this._tmpCoordinateSystem);d.intersectRayClosestSilhouette(this._tmpCoordinateSystem,z,A);return A};D.intersectManifold=function(z,v,A){d.elevate(this._coordinateSystem,v,
this._tmpCoordinateSystem);v=u.sv3d.get();return d.intersectRay(this._tmpCoordinateSystem,z,v)?m.copy(A,v):null};D.intersectInfiniteManifold=function(z,v,A){if(this.viewingMode===h.ViewingMode.Global)return this.intersectManifold(z,v,A);d.elevate(this._coordinateSystem,v,this._tmpCoordinateSystem);v=this._tmpCoordinateSystem.value;const t=u.sv3d.get();return e.intersectRay(v.plane,z,t)?m.copy(A,t):null};D.toRenderCoords=function(z,v,A){return p.isDehydratedPoint(z)?g.projectPointToVector(z,v,this.spatialReference):
g.projectVectorToVector(z,v,A,this.spatialReference)};D.fromRenderCoords=function(z,v,A=null){return p.isDehydratedPoint(v)?(w.isSome(A)&&(v.spatialReference=A),g.projectVectorToDehydratedPoint(z,this.spatialReference,v)):l.isVec3(v)?g.projectVectorToVector(z,this.spatialReference,v,A)?v:null:g.projectVectorToPoint(z,this.spatialReference,v)};B.create=function(z,v){switch(z){case h.ViewingMode.Local:return new B(h.ViewingMode.Local,v,n.getMetersPerUnitForSR(v),d.createLocal());case h.ViewingMode.Global:return new B(h.ViewingMode.Global,
v,1,d.createGlobal(v))}};B.renderUnitScaleFactor=function(z,v){return q(z)/q(v)};b._createClass(B,[{key:"extent",set:function(z){z&&d.setExtent(this._coordinateSystem,z,this._coordinateSystem)}}]);return B}();a.RenderCoordsHelper=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/vec3":function(){define(["exports","../../../typedArrayUtil"],function(a,b){function c(n){return b.isFloat32Array(n)&&3<=n.length}function w(n){return(b.isFloat64Array(n)||
Array.isArray(n))&&3<=n.length}a.isVec3=function(n){return c(n)||w(n)};a.isVec3f32=c;a.isVec3f64=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){w=function(y){function B(){var z=D.apply(this,arguments);z.updating=!1;return z}b._inherits(B,y);var D=b._createSuper(B);return b._createClass(B)}(w);c.__decorate([g.property({readOnly:!0})],w.prototype,"updating",void 0);w=c.__decorate([k.subclass("esri.views.3d.support.ResourceControllerMain")],w);let q=function(y){function B(){var z=D.apply(this,arguments);z._immediateTask=r.ImmediateTask;z._normalTask=r.ImmediateTask;z._frameTask=null;return z}b._inherits(B,
y);var D=b._createSuper(B);y=B.prototype;y.initialize=function(){this._scheduler=r.newScheduler();this._memoryController=p.newMemoryController(this.view);this._streamDataLoader=new h.StreamDataLoader;this._streamDataLoader.setup(u.maxDownloadSlots,u.downloadSlotsPerClient,this._scheduler);this.addHandles([x.watch(()=>this.view.state?.mode,z=>{null!=z&&(this._scheduler.state=z)},x.sync),x.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=m.addFrameTask({update:z=>
this._frame(z)});this._immediateTask=this._scheduler.registerTask(r.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);this._normalTask=this._scheduler.registerTask(r.TaskPriority.RESOURCE_CONTROLLER)};y.destroy=function(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=n.removeMaybe(this._frameTask);this._streamDataLoader=n.destroyMaybe(this._streamDataLoader);this._memoryController=n.destroyMaybe(this._memoryController);this._scheduler=n.destroyMaybe(this._scheduler);this.view=null};
y.createStreamDataRequester=function(z){const v=this._streamDataLoader;return{request(A,t,C){return v.request(A,t,z,C)},get busy(){return!v.hasDownloadSlots(z)}}};y._frame=function(z){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(l.secondsFromMilliseconds(z.deltaTime)),!this._scheduler))return;this._scheduler.updateBudget(z)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};y._stationaryChangedHandler=
function(){this.memoryController.resetStableQuality()};b._createClass(B,[{key:"immediate",get:function(){return this._immediateTask}},{key:"normal",get:function(){return this._normalTask}},{key:"updating",get:function(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:z=>
this._streamDataLoader.test.loadQueue.getStatsForType(z)}}}]);return B}(w);c.__decorate([g.property()],q.prototype,"view",void 0);c.__decorate([g.property()],q.prototype,"_scheduler",void 0);c.__decorate([g.property()],q.prototype,"_memoryController",void 0);c.__decorate([g.property()],q.prototype,"_streamDataLoader",void 0);c.__decorate([g.property()],q.prototype,"_immediateTask",void 0);c.__decorate([g.property()],q.prototype,"_normalTask",void 0);c.__decorate([g.property({readOnly:!0})],q.prototype,
"updating",null);q=c.__decorate([k.subclass("esri.views.3d.support.ResourceControllerImpl")],q);a.newResourceController=function(y){return new q({view:y})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=
(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){let u=function(p){function h(q){q=r.call(this,q);q._quality=1;q._usedMemory=0;q._updating=!1;q.minQuality=.1;q._stableQuality=0;q._downscaleMemoryUsed=0;q._canFastRecover=!1;q._memoryPredicted=0;q._cacheStorage=new m.MemCacheStorage;q._warnMemoryUsage=null;q._numQualityChanges=0;q._maxMemory=500;q._additionalCacheMemory=100;return q}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.destroy=function(){this._cacheStorage.destroy()};p.newCache=function(q,y){return new m.MemCache(q,
this._cacheStorage,y)};p.resetStableQuality=function(){this._stableQuality=0};p.disableMemCache=function(){this.additionalCacheMemory=-4096};p.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var q=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(q){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=
0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,q=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=
this._quality,q=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=q}};p._updateQuality=function(q){q=Math.min(Math.max(q,this.minQuality),1);if(q===this._quality)return!1;this._quality=q;++this._numQualityChanges;return!0};p._layersUpdating=function(){return this.view.allLayerViews.some(q=>!!q.updating)};p._updateMemory=function(){let q=0;this.view.basemapTerrain&&(q+=this.view.basemapTerrain.usedMemory);var y=this.view._stage&&this.view._stage.renderView&&
this.view._stage.renderer.edgeView;x.isSome(y)&&(q+=y.usedMemory);let B=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(z=>{if(k.isMemoryManagedView(z)){const v=z.ignoresMemoryFactor?this._quality:1;q+=z.usedMemory*v;B+=z.unloadedMemory*v}});var D=x.isNone(this._warnMemoryUsage)||Math.round(10*q)!==Math.round(10*this._warnMemoryUsage);y=1048576*this.maxMemory;if(q>y&&D){this._warnMemoryUsage=q;D=v=>(v/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const z=Math.round(100*
this._quality);n.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${D(y)} Current: ${D(q)} Projected: ${D(q+B)} Quality: ${z}%`)}this._usedMemory=q/y;this._memoryPredicted=(q+B)/y;this._cacheStorage.maxSize=Math.max(0,y-q+1048576*this.additionalCacheMemory)};b._createClass(h,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(q){null==q||0>=q||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<q&&this._updateQuality(1),this._maxMemory=q)}},{key:"additionalCacheMemory",
get:function(){return this._additionalCacheMemory},set:function(q){null!=q&&0<=q&&(this._additionalCacheMemory=q)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._usedMemory}},{key:"test",get:function(){const q=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const y=q._numQualityChanges;q._numQualityChanges=0;return y}}}}]);return h}(w);c.__decorate([l.property({constructOnly:!0})],
u.prototype,"view",void 0);c.__decorate([l.property()],u.prototype,"maxMemory",null);c.__decorate([l.property()],u.prototype,"additionalCacheMemory",null);c.__decorate([l.property()],u.prototype,"memoryFactor",null);c.__decorate([l.property()],u.prototype,"updating",null);c.__decorate([l.property()],u.prototype,"usedMemory",null);c.__decorate([l.property()],u.prototype,"_quality",void 0);c.__decorate([l.property()],u.prototype,"_usedMemory",void 0);c.__decorate([l.property()],u.prototype,"_updating",
void 0);c.__decorate([l.property()],u.prototype,"_stableQuality",void 0);c.__decorate([l.property()],u.prototype,"_maxMemory",void 0);c.__decorate([l.property()],u.prototype,"_additionalCacheMemory",void 0);u=c.__decorate([e.subclass("esri.views.3d.support.MemoryController")],u);a.newMemoryController=function(p){return new u({view:p})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(a){a.isMemoryManagedView=
function(b){return"usedMemory"in b&&"unloadedMemory"in b&&"ignoresMemoryFactor"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(D){if(2>D.byteLength)return"unknown";D=new Uint8Array(D,0,D.byteLength);return 137===D[0]&&80===D[1]?"image/png":71===D[0]&&73===D[1]?"image/gif":66===D[0]&&77===D[1]?"image/bmp":255===D[0]&&216===D[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(D){function z(){var A=v.apply(this,arguments);A._tasks=new Map;A._onLoadQueue=[];A._doneQueue=[];A.updating=!1;return A}b._inherits(z,D);var v=b._createSuper(z);D=z.prototype;D.setup=function(A,t,
C){this._loadQueue=new u.AsyncWorkerQueue((E,F)=>this._startLoading(E,F),(E,F)=>this._doneLoadingCB(E,F),A,t);C&&(this._frameTask=C.registerTask(h.TaskPriority.STREAM_DATA_LOADER,this))};D.destroy=function(){this._frameTask=g.removeMaybe(this._frameTask);this._tasks.forEach(A=>g.abortMaybe(A.abortController));this._loadQueue=g.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};D.hasDownloadSlots=function(A){return this._loadQueue.hasQuota(A)};D.request=function(A,t,
C,E={}){const F=f.createResolver();F.__signal=g.isSome(E)?E.signal:null;const H=this._createOrUpdateTask(A,t,C,E,F);f.onAbort(E,()=>this._cancelRequest(H,F));return F.promise};D._createTask=function(A,t,C,E,F,H){A=new B(A,t,C,E,F);this._updateTask(A,H);this._tasks.set(F,A);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(A);return A};D._cancelRequest=function(A,t){x.removeUnordered(A.resolvers,t);t.reject(f.createAbortError());0===A.resolvers.length&&(A.status===a.TaskStatus.DOWNLOADING&&
(A.status=a.TaskStatus.CANCELLED,this._loadQueue.cancel(A),A.abortController?.abort(),A.request=null,A.abortController=null),A.status=a.TaskStatus.CANCELLED,this._tasks.delete(A.key),0===this._tasks.size&&this._set("updating",!1))};D._updateTask=function(A,t){A.resolvers.push(t)};D._createOrUpdateTask=function(A,t,C,E,F){const H=`${g.isSome(E)&&E.uid||A}:${t}:${C}`,K=this._tasks.get(H);return K?(this._updateTask(K,F),K):this._createTask(A,E,t,C,H,F)};D._doneLoadingCB=function(A,t){this._loadQueue&&
(p.assert(A.status===a.TaskStatus.DOWNLOADING),A.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:A,err:t}):this._doneLoading(A,t))};D.runTask=function(A){for(;!A.done&&0<this._onLoadQueue.length;){var t=this._onLoadQueue.shift();f.throwIfAborted(t.task.abortController);t.task.abortController=null;t.callback(t.task);A.madeProgress()}for(;!A.done&&0<this._doneQueue.length;)t=this._doneQueue.shift(),t.task.status!==a.TaskStatus.DOWNLOADED&&(t.err=t.err||f.createAbortError()),
this._doneLoading(t.task,t.err),A.madeProgress()};D._doneLoading=function(A,t){if(t&&!f.isAbortError(t)&&0<A.numRetries)--A.numRetries,this._loadQueue.push(A);else{var C=A.result instanceof HTMLImageElement?0:A.resolvers.length;for(const E of A.resolvers)if(t)f.isAbortError(t)?E.reject(t):E.reject(new m("stream-data-loader:request-error",`Failed to request resource at '${A.url}'. ${t}`,{url:A.url,error:t}));else{--C;const F=0>=C?A.result:l.clone(A.result);E.resolve(F)}this._tasks.delete(A.key);0===
this._tasks.size&&this._set("updating",!1)}};D._startLoading=function(A,t){if(A.status===a.TaskStatus.CANCELLED)return!1;A.startTime=performance.now();A.status=a.TaskStatus.DOWNLOADING;let C,E;switch(A.docType){case "binary":E="array-buffer";C=0;break;case "image":E="image";break;case "image+type":E="array-buffer";break;default:E="json"}A.abortController=new AbortController;const F=A.abortController.signal;A.request=w(A.url,{...A.options,responseType:E,timeout:C,signal:F});let H=()=>{};const K=L=>
{A.duration=performance.now()-A.startTime;A.size=L instanceof ArrayBuffer?L.byteLength:A.size||0;A.result=L;this._frameTask?this._onLoadQueue.push({callback:t,task:A}):(A.abortController=null,t(A))},I=L=>{A.status===a.TaskStatus.DOWNLOADING&&t(A,L);H()};if("image+type"!==A.docType)return A.request.then(L=>K(L.data),I),!0;A.request.then(L=>{L=L.data;const R=r(L);E="image";A.size=L.byteLength;if("unknown"===R)A.request=w(A.url,{responseType:E,timeout:C,signal:F}),A.request.then(J=>K(J.data),I);else{L=
new Blob([L],{type:R});var O=window.URL.createObjectURL(L);H=()=>window.URL.revokeObjectURL(O);A.request=w(O,{responseType:E,timeout:C,signal:F});A.request.then(J=>K(new y(J.data,R,H)),I)}},I);return!0};b._createClass(z,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return z}(n);c.__decorate([d.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([k.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const q={numRetries:0};let y=function(){function D(z,v,A){this.image=z;this.type=v;this.release=A}b._createClass(D,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return D}(),B=function(D){function z(A,t,C,E,F){E=v.call(this,E);E.url=A;E.options=t;E.docType=C;E.key=F;E.result=null;E.status=a.TaskStatus.QUEUED;E.request=null;E.abortController=null;E.resolvers=[];E.startTime=0;E.numRetries=q.numRetries;return E}b._inherits(z,D);var v=b._createSuper(z);return b._createClass(z)}(u.BaseTask);
a.TaskStatus=void 0;(function(D){D[D.QUEUED=1]="QUEUED";D[D.DOWNLOADING=2]="DOWNLOADING";D[D.DOWNLOADED=3]="DOWNLOADED";D[D.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=y;a.test=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let w=b._createClass(function(l){this.client=l;this._cancelled=!1;this.duration=
this.size=0}),n=b._createClass(function(l){this.typeWorkerQuota=l;this.tasks=[];this.numWorkers=0;this.statistics=new x}),x=b._createClass(function(){this.speed=this.duration=this.size=this.requests=0}),m=function(){function l(f,d,e,k){this._workerFunc=f;this._callbackFunc=d;this._maxTotalNumWorkers=e;this._totalNumWorkers=0;this._clients=k.map(u=>new n(u))}var g=l.prototype;g.destroy=function(){this._clients.length=0};g.hasQuota=function(f){return(f=this._clients[f])?this._totalNumWorkers<this._maxTotalNumWorkers||
f.numWorkers+f.tasks.length<f.typeWorkerQuota:!1};g.push=function(f){const d=this._clients[f.client];d&&(this._totalNumWorkers<this._maxTotalNumWorkers?(d.numWorkers++,this._totalNumWorkers++,this._workerFunc(f,(e,k)=>this._taskCallback(e,k))):d.tasks.push(f))};g.cancel=function(f){this._taskFinished(f);f._cancelled=!0};g._taskFinished=function(f){const d=this._clients[f.client];this._totalNumWorkers--;d&&(d.numWorkers--,d.statistics.requests++,d.statistics.size+=f.size||0,d.statistics.duration+=
f.duration||0,d.statistics.speed=0<d.statistics.duration?d.statistics.size/d.statistics.duration:0,c.assert(0<=d.numWorkers));this._next()};g._next=function(){for(const f of this._clients)if(f&&f.numWorkers<f.typeWorkerQuota&&this._processQueue(f))return;for(const f of this._clients)if(f&&this._processQueue(f))break};g._processQueue=function(f){for(;0<f.tasks.length;)if(this._workerFunc(f.tasks.shift(),(d,e)=>this._taskCallback(d,e)))return f.numWorkers++,this._totalNumWorkers++,!0;return!1};g._taskCallback=
function(f,d){f._cancelled||(this._callbackFunc(f,d),this._taskFinished(f))};g.getStatsForType=function(f){return(f=this._clients[f])?{quota:f.typeWorkerQuota,workers:f.numWorkers,queueSize:f.tasks.length,requestStats:f.statistics}:null};b._createClass(l,[{key:"test",get:function(){const f=this;return{set workerFunc(d){f._workerFunc=d}}}}]);return l}();a.AsyncWorkerQueue=m;a.BaseTask=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/byteSizeEstimations ../../../core/maybe ../layers/support/MemoryManagedLayerView ./LayerPerformanceInfo ../terrain/terrainUtils".split(" "),
function(a,b,c,w,n,x){return a._createClass(function(m){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];if(c.isSome(m.resourceController)){var l=m.resourceController.memoryController;this.totalMemory=(l.maxMemory??0)*b.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(l.usedMemory*this.totalMemory);this.quality=l.memoryFactor;this.load=m.resourceController.scheduler.load}this.terrainMemory=m.basemapTerrain?.usedMemory??
0;l=m._stage&&m._stage.renderView&&m._stage.renderer.edgeView;this.edgesMemory=c.isSome(l)?l.usedMemory:0;m.allLayerViews.items.forEach(g=>{(w.isMemoryManagedLayerView(g)||x.isSurfaceLayerView(g))&&this.layerPerformanceInfos.push(new n(g,m))});this.layerPerformanceInfos.sort((g,f)=>f.memory-g.memory)})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports","../../support/MemoryManagedView"],function(a,b){a.isMemoryManagedLayerView=function(c){return b.isMemoryManagedView(c)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,b,c){return a._createClass(function(w,n){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=w.layer;this.memory=c.isSurfaceLayerView(w)?n.basemapTerrain.getUsedMemoryForLayerView(w):
w.usedMemory;b.isPerformanceInfoLayerView(w)&&(w=w.performanceInfo,this.displayedNumberOfFeatures=w.displayedNumberOfFeatures,this.maximumNumberOfFeatures=w.maximumNumberOfFeatures,this.totalNumberOfFeatures=w.totalNumberOfFeatures)})})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./interfaces ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(v){return"imagery-tile"===v?.type||"wcs"===v?.type}function e(v){return"imagery-tile-3d"===v?.type}function k(v){return"tile-3d"===v?.type}function u(v){return"vector-tile-3d"===v?.type}function p(v){return"wmts-3d"===v?.type}function h(v){return"elevation-3d"===v?.type}function r(v){return v&&(k(v)||e(v)||u(v)||p(v))}function q(v,A,t,C){return D[C].checkIfTileInfoSupportedForViewSR(v,t,A)}function y(v,A,t){v=n.getTileMaxtrixSetFromActiveLayer(v);if(c.isSome(v))if(b.isCollection(v)){if(v=
v.find(C=>null==q(C.tileInfo,C.fullExtent,A,t)))return{tileInfo:v.tileInfo,fullExtent:v.fullExtent}}else return{tileInfo:v.tileInfo,fullExtent:v.fullExtent};return{tileInfo:null,fullExtent:null}}function B(v){return v.isWGS84||v.isWebMercator||w.isCGCS2000(v)||!w.isEarth(v)}const D={[x.ViewingMode.Global]:f.terrainUtilsSpherical,[x.ViewingMode.Local]:g.terrainUtilsPlanar};a.ENABLE_TERRAIN_INTERNAL_CHECKS=!1;a.ENABLE_WATERPROOFNESS_TESTS=!1;const z={force512VTL:!1};g=[l.NeighborIndex.NORTH,l.NeighborIndex.EAST,
l.NeighborIndex.SOUTH,l.NeighborIndex.WEST];f=[l.NeighborIndex.NORTH_EAST,l.NeighborIndex.SOUTH_EAST,l.NeighborIndex.SOUTH_WEST,l.NeighborIndex.NORTH_WEST];a.almostEquals=function(v,A,t=1E-5){return Math.abs(v-A)<t};a.checkIfTileInfoSupportedForView=q;a.enableTerrainInternalChecks=function(v){a.ENABLE_TERRAIN_INTERNAL_CHECKS=v};a.enableTerrainWaterproofnessChecks=function(v){a.ENABLE_WATERPROOFNESS_TESTS=v;a.ENABLE_TERRAIN_INTERNAL_CHECKS=a.ENABLE_TERRAIN_INTERNAL_CHECKS||v};a.eps=1E-5;a.getLayerWithExtentRange=
function(v){return e(v)?{fullExtent:v.fullExtent,minScale:v.layer.minScale,maxScale:v.layer.maxScale,tilemapCache:null}:v.layer};a.getTileInfoAndExtentFromWMTSLayer=y;a.getTiledLayerInfo=function(v,A,t){var C=null;let E=null;if("wmts"===v?.type)v=y(v,A,t),C=v.tileInfo,E=v.fullExtent;else if(E=d(v)?v.getCompatibleFullExtent(A):v.fullExtent,C=t===x.ViewingMode.Local,d(v))C=v.getCompatibleTileInfo(A,E,C);else if("vector-tile"===v?.type){C=C&&!B(A)||z.force512VTL;const F=v.tileInfo.spatialReference.isGeographic;
C=C?v.tileInfo:v.tileInfo.getOrCreateCompatible(256,F?1:2)}else C=v.tileInfo;return c.isSome(C)&&c.isSome(E)&&null==q(C,E,A,t)?{tileInfo:C,fullExtent:E}:null};a.internalAssert=function(v,A){if(a.ENABLE_TERRAIN_INTERNAL_CHECKS&&!v)throw v=Error().stack?.slice(5),console.warn("Terrain internal: "+(A??"")+" at "+v),Error("Assertion failed"+(A?": "+A:""));};a.isBlendableLayerView=function(v){return v&&(k(v)||p(v)||e(v)||u(v))};a.isEast=function(v){return v===l.NeighborIndex.NORTH_EAST||v===l.NeighborIndex.EAST||
v===l.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=h;a.isGroupLayerView=function(v){return"group"===v?.type};a.isImageryTileLayerView=e;a.isImageryTileRenderInfo=function(v){v=v?.sourceLayerInfo?.data;return c.isSome(v)&&"type"in v&&"raster-tile"===v.type};a.isMapTileLayerView=r;a.isNorth=function(v){return v===l.NeighborIndex.NORTH_EAST||v===l.NeighborIndex.NORTH||v===l.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(v){return v===l.NeighborIndex.NORTH_WEST||v===l.NeighborIndex.NORTH_EAST};
a.isProjectableRasterLayer=d;a.isRasterTileRenderInfo=function(v){v=v?.sourceLayerInfo?.data;return v instanceof HTMLImageElement||v instanceof m.ImageWithType||v instanceof HTMLCanvasElement||v instanceof ImageData};a.isSouth=function(v){return v===l.NeighborIndex.SOUTH_EAST||v===l.NeighborIndex.SOUTH||v===l.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(v){return r(v)||h(v)};a.isTextureTileRenderInfo=function(v){v=v?.sourceLayerInfo?.data;return c.isSome(v)&&"type"in v&&"tile-texture"===
v.type};a.isTileLayerView=k;a.isVectorTileLayerView=u;a.isVectorTileRenderInfo=function(v){v=v?.sourceLayerInfo?.data;return c.isSome(v)&&"type"in v&&"vector-tile"===v.type};a.isWMTSLayerView=p;a.isWest=function(v){return v===l.NeighborIndex.NORTH_WEST||v===l.NeighborIndex.WEST||v===l.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(v){return v===l.NeighborIndex.NORTH_WEST||v===l.NeighborIndex.SOUTH_WEST};a.lij2s=function(v){return"["+v[0]+","+v[1]+","+v[2]+"]"};a.neighborCornerIndices=f;a.neighborEdgeIndices=
g;a.oppositeCorner=function(v){return v===l.NeighborIndex.NORTH_EAST?l.NeighborIndex.SOUTH_WEST:v===l.NeighborIndex.NORTH_WEST?l.NeighborIndex.SOUTH_EAST:v===l.NeighborIndex.SOUTH_WEST?l.NeighborIndex.NORTH_EAST:l.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(v){return v===l.NeighborIndex.NORTH?l.NeighborIndex.SOUTH:v===l.NeighborIndex.EAST?l.NeighborIndex.WEST:v===l.NeighborIndex.SOUTH?l.NeighborIndex.NORTH:l.NeighborIndex.EAST};a.releaseTileData=function(v){c.isSome(v)&&"release"in v&&v.release();
return null};a.test=z;a.useFetchTileForLayer=function(v){return v.fetchTile&&!1!==v.hasOverriddenFetchTile};a.v32s=function(v){return"("+v[0]+","+v[1]+","+v[2]+")"};a.vtlAssumes256PixelSizeAsDefault=B;a.weakAssert=function(v,A){v||console.warn("Terrain: "+A)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(q,y,B=0){q=q.extent;return c.isNone(q)?!1:0===B?m.containsPoint(q,y):m.containsPointWithMargin(q,y,B*Math.min(q[2]-q[0],q[3]-q[1]))}function d(q,y,B,D){w.copy(u,B);u[D]=y[D];D=w.subtract(u,u,y);var z=w.subtract(p,q,y);z=w.dot(z,D);const v=w.dot(D,D);y=0>=z?y:v<=z?B:w.add(u,y,w.scale(D,D,z/v));q=w.subtract(u,q,y);return Math.PI/2-Math.atan(q[2]/Math.sqrt(q[0]*q[0]+q[1]*q[1]))}function e(q,y,B){q=q.extent;if(c.isNone(q))return 0;h[0]=q[0];h[1]=q[1];h[2]=B;r[0]=
q[2];r[1]=q[3];r[2]=B;q=B=Infinity;y[0]<h[0]?B=d(y,h,r,0):y[0]>r[0]&&(B=d(y,r,h,0));y[1]<h[1]?q=d(y,h,r,1):y[1]>r[1]&&(q=d(y,r,h,1));return Math.min(B,q)}function k(q,y,B){if(c.isNone(q))return g.getMissingTileInfoError();if(q.spatialReference.isGeographic&&!x.canProjectToWGS84ComparableLonLat(q.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var D=g.TilingScheme.checkUnsupported(q);if(c.isSome(D))return D;
if(c.isNone(B))return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var z=q.lods;D=z[0].resolution*2**z[0].level;var v=[D*q.size[0],D*q.size[1]];const A=[q.origin.x,q.origin.y];B=m.fromExtent(B);const t=m.create();g.TilingScheme.computeRowColExtent(B,v,A,t);v=(t[2]-t[0])*(t[3]-t[1]);v>l.MAX_ROOT_TILES?(z=z[0].scale*2**z[0].level,D=Math.max((B[3]-B[1])/q.size[1],(B[2]-B[0])/q.size[0])*z/D,B=Math.floor(Math.log(D)/Math.log(10)),D=Math.ceil(D/10**B)*10**B,D=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(z).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+D.toLocaleString()+".",{level0Scale:z,suggestedLevel0Scale:D,requiredNumRootTiles:v,allowedNumRootTiles:l.MAX_ROOT_TILES})):D=null}if(D)return D;q=q.spatialReference;return!c.isSome(y)||q.equals(y)||y.isWGS84&&q.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const u=n.create(),
p=n.create(),h=n.create(),r=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:k,isInsideExtent:f,tiltToExtentEdge:e},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=k;a.isInsideExtent=f;a.terrainUtilsPlanar=n;a.tiltToExtentEdge=e})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,w,n,x){function m(){return!0}function l(){return 0}function g(d,e){if(c.isNone(d))return x.getMissingTileInfoError();const k=d.lods.length-1,u=d.spatialReference,p=w.canProjectToWGS84ComparableLonLat(u)||n.isMars(u)||n.isMoon(u);if(u.isWebMercator){if(!x.TilingScheme.makeWebMercatorAuxiliarySphere(k).compatibleWith(d))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(p){if(!x.TilingScheme.makeGCSWithTileSize(d.spatialReference,
d.size[0],k).compatibleWith(d))return d.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(c.isSome(e)&&!d.spatialReference.equals(e))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const f=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:g,isInsideExtent:m,tiltToExtentEdge:l},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=g;a.isInsideExtent=m;a.terrainUtilsSpherical=f;a.tiltToExtentEdge=l})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){let u=function(){function h(q){this.streamDataRequester=this.textures=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=q.viewState;this._view=q.view;this._pointsOfInterest=q.pointsOfInterest;this.streamDataRequester=q.resourceController.createStreamDataRequester(f.ClientType.SYMBOLOGY);this.objectResourceCache=new g.ObjectResourceCache((B,D)=>q.resourceController.memoryController.newCache(B,D));this.textures=
new d.StreamTextureCollection(this.streamDataRequester,q.view._stage,{preMultiplyAlpha:!0,wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,t:k.TextureWrapMode.CLAMP_TO_EDGE}},q.resourceController.scheduler);const y=l.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=e.getSettings(q.viewingMode,y);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(q.viewingMode,y)}var r=h.prototype;r.destroy=function(){x.destroyMaybe(this.textures);this.streamDataRequester=
this.textures=null};r.addGraphicsOwner=function(q){if(!q)return n.makeHandle();this._graphicsOwners.push(q);const y=m.watch(()=>q.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return n.makeHandle(()=>{y.remove();c.removeUnordered(this._graphicsOwners,q);this._updateScreenSizePerspectiveEnabled()})};r._updateScreenSizePerspectiveEnabled=function(){var q=this._graphicsOwners.some(y=>!0===y.layer?.screenSizePerspectiveEnabled);
q&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new w,q=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([m.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,q,m.sync),this._viewState.events.on("camera-projection-changed",q)]),this._updateScreenSizePerspectiveSettings()):q||(this._screenSizePerspectiveHandles=x.destroyMaybe(this._screenSizePerspectiveHandles))};r._updateScreenSizePerspectiveSettings=function(){p.distance=
this._pointsOfInterest.centerOnSurfaceInfrequent.distance;p.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(p);this.screenSizePerspectiveSettingsLabels.update(p);this._view._stage.renderView.requestRender()};b._createClass(h,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}]);return h}();const p={distance:0,fovY:0};a.SharedSymbolResources=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(a,b,c,w,n,x,m){let l=function(){function g(d){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=d("gltf-resources",()=>{});this._wosrMemCache=d("wosr-resources",()=>{})}var f=g.prototype;f.destroy=function(){this._gltfLoading.forEach(d=>d.abortController.abort());this._wosrLoading.forEach(d=>d.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()};f.loadGLTF=function(d,e,k){const u=k?`gltfPBR:${d}`:`gltf:${d}`,p=this._gltfMemCache.get(u);
return c.isSome(p)?Promise.resolve(p):this._loadOnce(this._gltfLoading,this._gltfMemCache,u,h=>x.loadGLTF(new n.DefaultLoadingContext(h.streamDataRequester),d,h,k),e)};f.loadWOSR=function(d,e){const k=`wosr:${d}:${e.disableTextures}`,u=this._wosrMemCache.get(k);return c.isSome(u)?Promise.resolve(u):this._loadOnce(this._wosrLoading,this._wosrMemCache,k,p=>m.load(d,p),e)};f._loadOnce=async function(d,e,k,u,p){w.throwIfAborted(p);const h=w.onAbort(p,()=>this._abortLoad(d,k));var r=d.get(k);r?r.refCount++:
(r=new AbortController,u=u({...p,signal:r.signal}),r={refCount:1,abortController:r,promise:u},d.set(k,r));try{const q=await r.promise;e.put(k,q,q.size);d.delete(k);w.throwIfAborted(p);return q}finally{c.removeMaybe(h)}};f._abortLoad=function(d,e){const k=d.get(e);c.isSome(k)&&0<--k.refCount||(d.delete(e),c.isSome(k)&&k.abortController.abort())};return b._createClass(g)}();a.ObjectResourceCache=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),
function(a,b,c,w,n,x,m,l){x=function(g){function f(e,k,u,p){k=d.call(this,k,p);k._streamDataRequester=e;k._parameters=u;return k}b._inherits(f,g);var d=b._createSuper(f);g=f.prototype;g.fromUrl=async function(e,k,u){w.throwIfAborted(u);u=c.isSome(u)?u.signal:null;const p=this.makeUid(e,k);var h=this._textureRequests.get(p);if(!h){h=new AbortController;const r=this._streamDataRequester.request(e,"image",{uid:p,signal:h.signal}),q=h={referenceCount:0,texture:null,textureAsync:null,abortController:h};
this._textureRequests.set(p,h);h.textureAsync=r.then(async y=>{y=this._createTexture(e,y,k);q.texture=y;q.abortController=null;this._stage.add(y);await this._stage.load(y);return{uid:p,texture:y,release:()=>this._release(p)}},y=>{q.abortController=null;throw y;})}h.referenceCount++;try{return await w.whenOrAbort(h.textureAsync,u)}catch(r){throw this._release(p),r;}};g._createTexture=function(e,k,u){const p={...this._parameters,powerOfTwoResizeMode:m.PowerOfTwoResizeMode.PAD};if(n.isSVG(e)){if(u||
0===k.width&&0===k.height)e=k.width?k.height/k.width:1,u=u||64,1<e?(k.width=Math.round(u/e),k.height=u):(k.width=u,k.height=Math.round(u*e));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(p.preMultiplyAlpha=!1)}p.width=k.width;p.height=k.height;return new l.Texture(k,p)};return b._createClass(f)}(x.TextureCollection);a.StreamTextureCollection=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H){a.PointsOfInterest=function(O){function J(G){G=M.call(this,G);G._handles=new n;G._tmpRay=p.create();G._centerRayDirty=!0;G._surfaceAltitudeAtCenter=0;G._surfaceAltitudeAtCenterDirty=!0;G._contentAltitudeAtCenter=0;G._contentAltitudeAtCenterDirty=!0;G._propertiesPool=new q.PropertiesPool({renderPointOfView:K},b._assertThisInitialized(G));G.renderPointOfView=u.create();G._pois=[];G._debugCenters=new Map;return G}b._inherits(J,O);var M=
b._createSuper(J);O=J.prototype;O.initialize=function(){const {state:G,basemapTerrain:P,renderCoordsHelper:U,map:N}=this.view;this._surfaceIntersector=C.newIntersector(G.viewingMode);this._surfaceIntersector.options.backfacesTerrain=G.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=E.StoreResults.MIN;this._contentIntersector=C.newIntersector(G.viewingMode);var S=()=>this._estimateSurfaceAltitudeAtCenter();const Q=this.view.resourceController.scheduler,
W=x.unwrap(this.view.basemapTerrain?.elevationQueryCache),V={state:G,scheduler:Q,surface:P,renderCoordsHelper:U};this._set("centerOnSurfaceInfrequent",new D.CenterOnSurface({...V,task:H.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:S}));this._set("centerOnSurfaceFrequent",new D.CenterOnSurface({...V,task:H.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:S}));this._set("centerOnContent",new D.CenterOnSurface({...V,task:H.TaskPriority.POINT_OF_INTEREST_FREQUENT,
estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new B.CameraOnSurface({...V,cache:W,task:H.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:N}));this._set("surfaceGeometryUpdates",new t.SurfaceGeometryUpdates({...V,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new z.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:U}));
this._set("surfaceOrigin",new A.StableSurfaceCenter({cache:W,view:this.view}));this._set("focus",new v.Focus({state:G,scheduler:Q,surface:P,renderCoordsHelper:U,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(T,X)=>this._estimateSurfaceIntersectionAtRenderPoint(T,this.view.state.contentCamera,X)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);S=this.view.graphics;this._debugCenters.set(this.centerOnContent,
new r.PointGraphics(S,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new r.PointGraphics(S,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new r.PointGraphics(S,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new r.PointGraphics(S,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new r.PointGraphics(S,"green","Focus"));this._handles.add([m.watch(()=>G.contentCamera,T=>this._cameraChanged(T),m.sync),m.watch(()=>
P.extent,()=>this._updateCenterPointsOfInterest()),m.when(()=>!P.updating,()=>this._updateCenterPointsOfInterest(),m.sync),m.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),m.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),m.when(()=>h.SHOW_POI,T=>this._setDebug(T),m.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const T of this._pois)T.runTask()};O.destroy=function(){this._setDebug(!1);
this._handles.destroy();this._propertiesPool.destroy();for(const G of this._pois)G.destroy();this.surfaceOrigin.destroy()};O._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const G=this._centerRay;if(x.isNone(G))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(G,this._contentIntersector,I,R)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I):
this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};O._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const G=this._centerRay;if(x.isNone(G))return this._surfaceAltitudeAtCenter;const P=G.origin,U=k.add(I,G.origin,G.direction);this._surfaceIntersector.resetWithRay(G,this.view.state.contentCamera);
this.view.basemapTerrain.intersect(this._surfaceIntersector,null,P,U);this._surfaceIntersector.results.min.getIntersectionPoint(I)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I));return this._surfaceAltitudeAtCenter};O._estimateSurfaceIntersectionAtRenderPoint=function(G,P,U){G=y.fromRenderAtEye(P,G,L);if(x.isNone(G))return null;const N=G.origin,S=k.add(I,G.origin,G.direction);this._surfaceIntersector.resetWithRay(G,P);this.view.basemapTerrain.intersect(this._surfaceIntersector,
null,N,S);return this._surfaceIntersector.results.min.getIntersectionPoint(U)?U:null};O._cameraChanged=function(G){this._updateCenterPointsOfInterest();G=G.eye;k.exactEquals(this.renderPointOfView,G)||this._set("renderPointOfView",k.copy(this._propertiesPool.get("renderPointOfView"),G))};O._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const G of this._pois)G.updateRenderLocation()};O._updateCenterOnContent=
function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};O._setDebug=function(G){if(G)for(const P of this._pois)this._handles.add(m.watch(()=>P.renderLocation,U=>this._debugCenters.get(P)?.show(U,P.renderCoordsHelper.spatialReference),m.initial),"debug");else this._debugCenters.forEach(P=>P.hide()),this._handles.remove("debug")};b._createClass(J,[{key:"updating",get:function(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(G=>G.updating))}},{key:"_centerRay",
get:function(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const G of this._pois)G.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return J}(w);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",
void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([l.property({readOnly:!0})],
a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);c.__decorate([l.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([e.subclass("esri.views.3d.support.PointsOfInterest")],
a.PointsOfInterest);const K=Array,I=u.create(),L=p.create(),R={exclude:new Set([F.TERRAIN_ID])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),function(a,b,c,w,n,x,m,l,g,f){c=
function(){function d(k,u,p=""){this.graphics=k;this._symbol=new m({symbolLayers:[new l({material:{color:u},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new g({text:p,halo:{color:"white",size:1/.75},material:{color:u},size:12})]})}var e=d.prototype;e.show=function(k,u){x.isNone(u)||(this.hide(),k=new f({x:k[0],y:k[1],z:k[2],spatialReference:u}),this._graphic=new w({geometry:k,symbol:this._symbol}),this.graphics.add(this._graphic))};e.hide=function(){x.isSome(this._graphic)&&
(this.graphics.remove(this._graphic),this._graphic=null)};return b._createClass(d)}();a.PointGraphics=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){const B=Array;a.CameraOnSurface=function(z){function v(t){t=A.call(this,t);t._dirty=!1;t._propertiesPool=new r.PropertiesPool({location:u,renderLocation:B},b._assertThisInitialized(t));t._estimatedSurfaceAltitude=0;t._pendingElevationQueryController=null;t.renderLocation=k.create();t._tmpPoint=new u;return t}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const t=()=>this._setDirty();this.handles.add(x.on(()=>this.map?.ground?.layers,"change",t,{onListenerAdd:t,onListenerRemove:t}))}this._updateRenderLocation()};z.destroy=function(){this._cancelPendingRequest();this._propertiesPool=w.destroyMaybe(this._propertiesPool)};z.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};z._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};z._cancelPendingRequest=function(){const t=
this._pendingElevationQueryController;t&&(this._pendingElevationQueryController=null,t.abort(),this.notifyChange("updating"))};z.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),y.Task.YIELD;var t=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,t);t=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===p.ViewingMode.Global&&
(t.isWGS84||t.isWebMercator);let C=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:C.signal,cache:this.cache,minDemResolution:t?1E6:0}).then(E=>this._updateSurfaceAltitude(E.geometry.z??0)).catch(E=>{n.isAbortError(E)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===C&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));C=null});this._pendingElevationQueryController=C;return y.Task.YIELD};z._updateSurfaceAltitude=
function(t){this._estimatedSurfaceAltitude!==t&&(this._estimatedSurfaceAltitude=t,this._updateRenderLocation())};z._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(D,this._estimatedSurfaceAltitude,this._camera.eye);e.exactEquals(this._get("renderLocation"),D)||(this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),D)),this.notifyChange("renderLocation"))};b._createClass(v,[{key:"_camera",get:function(){return this.state.contentCamera}},{key:"location",get:function(){const t=
this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,t,this.state.spatialReference);return t}},{key:"scale",get:function(){const t=this._camera,C=e.distance(t.eye,this.renderLocation);return h.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:t}},C,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);
return v}(q.PointOfInterest);c.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);c.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);c.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);c.__decorate([m.property({readOnly:!0})],
a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);c.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([d.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const D=k.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g,f){a.PointOfInterest=function(d){function e(u){u=k.call(this,u);u.handles=new n;return u}b._inherits(e,d);var k=b._createSuper(e);e.prototype.destroy=function(){this.handles.destroy()};return b._createClass(e)}(w);c.__decorate([x.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([x.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([x.property({constructOnly:!0})],a.PointOfInterest.prototype,
"state",void 0);a.PointOfInterest=c.__decorate([f.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){const D=Array;a.CenterOnSurface=function(t){function C(F){F=E.call(this,F);F._propertiesPool=new q.PropertiesPool({location:u,renderLocation:D},b._assertThisInitialized(F));F._currentSurfaceAltitude=0;F._latestSurfaceAltitude=0;F.distance=0;F.renderLocation=e.create();F.updating=!1;return F}b._inherits(C,t);var E=b._createSuper(C);t=C.prototype;t.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};t.destroy=
function(){this._frameWorker=n.removeMaybe(this._frameWorker);this._propertiesPool=n.destroyMaybe(this._propertiesPool)};t.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};t.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1;return B.Task.YIELD};t._updateRenderLocation=function(){const F=z;let H=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,F);var K=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!H&&K&&(H=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);K=v;H&&this._latestSurfaceAltitudeChangesDistanceSignificantly(F,K)&&(d.copy(F,K),this._currentSurfaceAltitude=this._latestSurfaceAltitude);H?this.distance=d.distance(this._camera.eye,F):(d.scale(F,this._camera.viewForward,this._get("distance")),d.add(F,F,this._camera.eye));d.exactEquals(this._get("renderLocation"),F)||this._set("renderLocation",
d.copy(this._propertiesPool.get("renderLocation"),F))};t._calculateSurfaceIntersection=function(F,H){var K=this._camera;if(!this.renderCoordsHelper.intersectManifold(K.ray,F,H))return!1;if(this.state.isGlobal){const I=k.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;F=I+F;const L=d.squaredLength(K.eye),R=L<F*F,O=d.distance(K.eye,H);R&&O>I/4&&(d.scale(H,K.viewForward,F-Math.sqrt(L)),d.add(H,H,K.eye))}else K=this.surface?.ready?this.surface.extent:null,n.isSome(K)&&p.projectBoundingRect(K,
this.surface?.spatialReference,A,this.renderCoordsHelper.spatialReference)&&(H[0]=w.clamp(H[0],A[0],A[2]),H[1]=w.clamp(H[1],A[1],A[3]));return!0};t._latestSurfaceAltitudeChangesDistanceSignificantly=function(F,H){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==F)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,H)){if(r.TESTS_DISABLE_OPTIMIZATIONS)return!0;const K=this._camera.eye;F=d.distance(K,F);H=d.distance(K,H);if(.05<Math.abs(H-F)/F)return!0}return!1};
b._createClass(C,[{key:"_camera",get:function(){return this.state.contentCamera}},{key:"location",get:function(){const F=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return C}(y.PointOfInterest);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);c.__decorate([x.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([x.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([x.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([x.property()],
a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const z=e.create(),v=e.create(),A=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,b,c,w,n){let x=
function(){function l(f){this._handles=new w;this.events=new c;this._contentLayerViews=f.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",d=>this._layerViewsChanged(d)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}var g=l.prototype;g.destroy=function(){this._handles=n.destroyMaybe(this._handles);this._contentLayerViews.destroy()};g._layerViewsChanged=function(f){f.added.forEach(d=>{"esri.views.3d.layers.SceneLayerView3D"===
d.declaredClass&&this._handles.add(d.on("visible-geometry-changed",()=>this._contentChanged()),d.uid)});f.removed.forEach(d=>this._handles.remove(d.uid))};g._contentChanged=function(){this.events.emit("request-update",m)};return b._createClass(l)}();const m={};a.ContentGeometryUpdates=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){const D=Array;a.Focus=function(t){function C(F){F=E.call(this,F);F._propertiesPool=new r.PropertiesPool({location:p,renderLocation:D},b._assertThisInitialized(F));F._dirty=!0;F.renderLocation=F._propertiesPool.get("renderLocation");return F}b._inherits(C,t);var E=b._createSuper(C);t=C.prototype;t.initialize=function(){this.handles.add([x.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),x.watch(()=>this.state.contentCamera,
()=>this.updateRenderLocation())]);this.scheduler&&this.handles.add(this.scheduler.registerTask(B.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};t.destroy=function(){this._propertiesPool=n.destroyMaybe(this._propertiesPool)};t.runTask=function(){var F=this._get("renderLocation");const H=this.centerOnSurface.renderLocation;var K=this.renderCoordsHelper,I=this.state.contentCamera;this._dirty=!1;K.worldUpAtPosition(H,z);K=Math.max(0,(Math.acos(k.dot(z,I.viewForward))-.5*Math.PI)*(I.aboveGround?1:-1));
if(Number.isNaN(K))return F&&k.equals(F,H)||(F=this._propertiesPool.get("renderLocation"),k.copy(F,H),this._set("renderLocation",F)),B.Task.YIELD;K=1-w.clamp(K/(.5*Math.PI),0,1);K*=K*K;this._calculateScreenHorizontalEdgeOnSurface(A);I=this._propertiesPool.get("renderLocation");k.lerp(I,H,A,K);F&&k.equals(F,I)||this._set("renderLocation",I);return B.Task.YIELD};t._calculateScreenHorizontalEdgeOnSurface=function(F){const H=this.state.contentCamera;var K=H.getRenderCenter(m.createRenderScreenPointArray3());
K[1]=H.aboveGround?H.padding[y.PaddingSide.BOTTOM]:H.fullHeight-H.padding[y.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(K,F))return F;const I=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return H.unprojectFromRenderScreen(K,v)&&(k.subtract(v,v,H.eye),K=k.normalize(v,v),this.renderCoordsHelper.intersectManifold(h.wrap(H.eye,K),I,F))?F:this.renderCoordsHelper.setAltitude(F,I,H.eye)};t.updateRenderLocation=function(){this._dirty=!0};b._createClass(C,
[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",get:function(){const F=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"running",get:function(){return this._dirty}}]);return C}(q.PointOfInterest);c.__decorate([l.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([l.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([l.property({constructOnly:!0})],
a.Focus.prototype,"centerOnSurface",void 0);c.__decorate([l.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([l.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([l.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([l.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([e.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const z=u.create(),
v=u.create(),A=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){a.StableSurfaceCenter=function(r){function q(B){B=y.call(this,B);B.location=null;B._updateController=null;B._handles=new n;return B}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.initialize=function(){this.view.state.isLocal&&(this._handles.add([l.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),l.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())};r.destroy=function(){this._handles.destroy()};
r._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(!this.surfaceView||x.isNone(this.surfaceView.extent)||x.isNone(this.surfaceView.spatialReference))this._set("location",null);else{var B=h.center(this.surfaceView.extent);B=new p({x:B[0],y:B[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(B,
{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(D=>{this._updateController=null;this._set("location",D.geometry)}).catch(D=>{m.isAbortError(D)||D&&"elevation-query:invalid-layer"===D.name||console.error("StableSurfaceCenter failed to update: ",D)})):this._set("location",B)}};b._createClass(q,[{key:"surface",get:function(){return this.view.map?.ground}},{key:"surfaceView",get:function(){return this.view.basemapTerrain}},{key:"renderLocation",get:function(){if(!this.location)return null;
const B=u.create();this.view.renderCoordsHelper.toRenderCoords(this.location,B);return B}}]);return q}(w);c.__decorate([g.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([g.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([g.property()],a.StableSurfaceCenter.prototype,"surface",null);c.__decorate([g.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);c.__decorate([g.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"location",void 0);c.__decorate([g.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([k.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){a.SurfaceGeometryUpdates=function(y){function B(z){z=D.call(this,z);z._tileGeometryUpdateExtent=k.empty();z._tileGeometryUpdateSpatialReference=null;z.events=new n;z.updating=!1;return z}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.initialize=function(){this.addHandles([this.surface.on("elevation-change",z=>this._tileGeometryChanged(z)),this.scheduler.registerTask(u.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};y.runTask=function(){if(!this.updating)return u.Task.YIELD;
this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",p);k.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return u.Task.YIELD};y._tileGeometryChanged=function(z){this._tileGeometryUpdateSpatialReference=x.unwrap(z.spatialReference);k.expand(this._tileGeometryUpdateExtent,z.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};y._furthestCenterOnSurface=
function(){let z=this.centerOnSurfaces[0];for(let v=1;v<this.centerOnSurfaces.length;v++){const A=this.centerOnSurfaces[v];A.distance>z.distance&&(z=A)}return z};y._centerIntersectsExtent=function(z,v){const A=this.state.contentCamera.eye,t=q,C=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(A,h,v);this.renderCoordsHelper.fromRenderCoords(C.renderLocation,r,v);h[0]<r[0]?(t[0]=h[0],t[2]=r[0]):(t[0]=r[0],t[2]=h[0]);h[1]<r[1]?(t[1]=h[1],t[3]=r[1]):(t[1]=r[1],t[3]=h[1]);return k.intersects(t,
z)};b._createClass(B,[{key:"running",get:function(){return this.updating}}]);return B}(w);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([m.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([d.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const p={},h=e.create(),r=e.create(),q=k.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa,ia,na,ba,ea,ja,ka,da,ha,ca,fa,ma,qa,wa,xa,pa,ra,va,Ba,Aa,Ha){function Ka(Ta,Ma){return Ta[0]===Ma[0]&&Ta[1]===Ma[1]&&Ta[2]===Ma[2]}function Pa(Ta){Ta=Ta.children;if(!Ta[0])return!1;for(const Ma of Ta)if(Ma.shouldLoad)return!0;for(const Ma of Ta)if(Pa(Ma))return!0;return!1}function Ra(Ta,Ma,fb){for(const ya of Ta)if(ya.containsPointXY(Ma,fb)){for(Ta=ya;Ta&&!Ta.renderData;)Ta=Ta.children[(Ma>
Ta.extentMidX?1:0)+(fb<Ta.extentMidY?2:0)];return T.sampleElevation(Ma,fb,Ta?.renderData?.geometryState.samplerData??null)}return null}n=function(Ta){function Ma(ya){var oa=fb.call(this,ya);oa._scaleRangeQueries=new ba.ScaleRangeQueries;oa._iteratorPool=new k(wa.IteratorPreorder,ua=>ua.remove=()=>oa._iteratorPool.release(ua));oa._postorderIterator=new wa.IteratorPostorder;oa._hasPendingUpdates=!1;oa._pendingUpdates=0;oa._asyncWorkItems=0;oa._allTilesDirty=!0;oa._allTilesSorted=!0;oa._visibleCached=
!1;oa._usedMemory=null;oa._performanceInfo=new ha;oa._viewChanged=!1;oa._inFrameTask=!1;oa._viewChangeUpdateDirty=!1;oa._eyePosRenderSR=A.create();oa._eyePosSurfaceSR=A.create();oa._splitLimits=new ja.SplitLimits;oa._frustum=I.create();oa._viewProjectionMatrix=z.create();oa._layerViews=[[],[]];oa._layerIndexByUid=[new Map,new Map];oa._basemapLayerViewHandles=new Map;oa._handles=new g;oa._watchUpdatingTracking=new C.WatchUpdatingTracking;oa._frameTask=Ha.ImmediateTask;oa._allTiles=new u;oa._upsampleInfoPool=
new k(pa.UpsampleInfo);oa._rootTilesExtent=K.create();oa.updatingProgress=.5;oa._maxNumUpdating=1;oa.maxTextureScale=1.2;oa._spatialReference=H.WebMercator;oa.visibleElevationBounds=new V.ElevationBounds(Infinity,-Infinity);oa.rootTileElevationBounds=new V.ElevationBounds(Infinity,-Infinity);oa._updatingRootTiles=!1;oa._pendingTilesForElevationUpdateEvent=new Set;oa._pendingTilesToUpdate=new Set;oa.totalGeometryUpdates=0;oa.totalTileUpdates=0;oa.oneBatchPerFrameTask=!0;oa._layerViewsDirty=!1;oa.unloadedMemory=
0;oa.ignoresMemoryFactor=!1;oa._isWebMercator=!1;oa._isWebMercatorOnPlateeCarree=!1;oa.overlayManager=new aa.OverlayManager({...ya,surface:b._assertThisInitialized(oa)});oa._isGlobal=!ya.view?.state?.isLocal;return oa}b._inherits(Ma,Ta);var fb=b._createSuper(Ma);Ta=Ma.prototype;Ta.initialize=function(){this._lercDecoder=G.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new k(ia.PlanarPatch):new k(ea.SphericalPatch);var ya=this.view.resourceController.memoryController;
this._upsampleMapCache=ya.newCache("esri.views.3d.terrain.upsample",ua=>ua.unloadMapData());this._elevationQueryCache=new O.ElevationQueryTileCache(ya.newCache("elevation-query"));this._handles.add([h.watch(()=>this.overlayManager.hasHighlights,ua=>this._renderer.setNeedsHighlight(ua)),h.watch(()=>this.overlayManager.rendersOccluded,ua=>this._renderer.setRenderOccludedOverlay(ua)),h.watch(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager");this._renderer=
new da.TerrainRenderer({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:E.getReferenceEllipsoid(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles});this._handles.add([h.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?Z.TextureUpdate.UNFADED:Z.TextureUpdate.IMMEDIATE)},h.syncAndInitial),h.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?
Z.TextureUpdate.UNFADED:Z.TextureUpdate.IMMEDIATE),h.syncAndInitial),h.watch(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),h.sync),h.watch(()=>this.backgroundColor,ua=>{this._handleLayerViewChanges();this._renderer.updateTileBackground(ua)},h.syncAndInitial),h.watch(()=>this.snapLevel,()=>this._viewChanged=!0,h.sync),h.watch(()=>this.view.pointsOfInterest,ua=>{this._renderer.pointsOfInterest=ua;this._watchUpdatingTracking.removeAll();
ua&&this._watchUpdatingTracking.add(()=>ua.focus.renderLocation,()=>this._allTilesSorted=!1)}),h.watch(()=>N.TERRAIN_TILE_TREE_SHOW_TILES,ua=>{ua&&!this._treeDebugger?(new Promise((Da,Ia)=>a(["../layers/support/TerrainTileTree3DDebugger"],Da,Ia))).then(({TerrainTileTree3DDebugger:Da})=>{!this._treeDebugger&&N.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Da({view:this.view}))}):ua||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},h.initial)]);({spatialReference:ya}=this.view);this._extentHelper=
X.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:ya});const oa=new m({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:ua})=>ua),getChildrenFunction:ua=>ua&&"layers"in ua?ua.layers:null});ya=new xa.TilingSchemeLogic({layers:oa,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:ya});this._set("tilingSchemeLogic",ya);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Q.ClientType.ELEVATION);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Q.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(Ha.TaskPriority.TERRAIN_SURFACE,this);this._handles.add([h.watch(()=>this._extentHelper.stencilEnabledExtents,ua=>this._renderer.setStencilEnabledLayerExtents(ua),h.initial),h.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),h.sync),h.watch(()=>this.extent,()=>this._updateRootTiles(),h.initial),this.view.on("resize",
()=>this._viewChangeUpdate()),h.watch(()=>{const ua=this.view,Da=ua.state;return[this._lodBias,this.lodSnapping,ua.resourceController?.memoryController?.memoryFactor,Da.camera,Da.contentCamera,Da.fixedContentCamera]},()=>this._viewChangeUpdate(),h.syncAndInitial),h.watch(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,ua=>this._renderer.textureFadingEnabled=0<ua,h.initial),h.watch(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,ua=>this._renderer.pbrMode=ua?va.PBRMode.Terrain:
va.PBRMode.Disabled,h.initial),h.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),h.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};Ta.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=e.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);
this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((ya,oa)=>this._unregisterTiledLayerView(oa));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tilePool=e.destroyMaybe(this._tilePool);fa.Tile.prune();this._treeDebugger=e.destroyMaybe(this._treeDebugger);this._renderer=e.destroyMaybe(this._renderer);
this._iteratorPool=e.destroyMaybe(this._iteratorPool);this._set("view",null);this._extentHelper=e.destroyMaybe(this._extentHelper);this._upsampleInfoPool=e.destroyMaybe(this._upsampleInfoPool);P.printAllocations();ma.printAllocations()};Ta.intersect=function(ya,oa,ua,Da){this._renderer.intersect(ya,oa,ua,Da)};Ta.getElevation=function(ya,oa,ua,Da){const Ia=this._rootTiles;if(e.isNone(Ia)||!Ia.length||0===Ia[0].layerInfo[Y.LayerClass.ELEVATION].length)return null;const Na=Sa;Na[0]=ya;Na[1]=oa;Na[2]=
ua;return F.projectVectorToVector(Na,Da,Na,this._spatialReference)?Ra(Ia,Na[0],Na[1]):(f.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)};Ta.getElevations=function(ya,oa,ua){const Da=this._rootTiles;var Ia=Da?Da[0].layerInfo[Y.LayerClass.ELEVATION].length:0;if(e.isNone(Da)||!Da.length||0===Ia)for(ya=0;ya<oa;++ya)ua(ya,null);else for(Ia=0;Ia<oa;++Ia){var Na=3*Ia;Na=Ra(Da,ya[Na],ya[Na+1]);ua(Ia,Na)}};Ta.getScale=
function(ya){if(!this.tilingScheme)return null;if(!F.projectPointToVector(ya,Sa,this.spatialReference))return f.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;ya=this._rootTiles;if(e.isSome(ya))for(var oa of ya)if(oa?.containsPoint(Sa)){for(;oa.children[0]&&!oa.rendered;){ya=oa.children[0].extent;let ua=0;Sa[0]>ya[2]&&(ua+=1);Sa[1]<ya[1]&&(ua+=2);oa=oa.children[ua]}return this._getLodBiasCorrectedScale(oa.level)}return Infinity};
Ta.getSphereElevationBounds=function(ya,oa){Sa[0]=ya[0];Sa[1]=ya[1];Sa[2]=ya[2];Sa[3]=ya[3];if(!F.projectVectorToVector(Sa,oa,Sa,this.tilingScheme?.spatialReference))return f.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let ua=Infinity,Da=-Infinity;const Ia=Na=>{if(Na&&K.intersectsSphere(Na.extent,Sa))if(Na.isLeaf||Na.rendered)ua=Math.min(ua,Na.elevationBounds[0]),Da=Math.max(Da,Na.elevationBounds[1]);
else for(const ab of Na.children)Ia(ab)};ya=this._rootTiles;if(e.isSome(ya))for(const Na of ya)Ia(Na);return{min:ua,max:Da}};Ta.getSphereScale=function(ya,oa){if(!this.tilingScheme)return null;if(!F.projectPointToVector(ya,Sa,this.spatialReference))return f.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Sa[3]=oa;let ua=null;const Da=Ia=>{if(Ia&&K.intersectsSphere(Ia.extent,Sa)){const Na=Ia.children;if(Na[0]&&
!Ia.rendered)for(const ab of Na)Da(ab);else Ia=this._getLodBiasCorrectedScale(Ia.level),ua=null==ua?Ia:Math.min(ua,Ia)}};ya=this._rootTiles;if(e.isSome(ya))for(const Ia of ya)Da(Ia);return ua};Ta.queryVisibleScaleRange=function(ya,oa,ua,Da){oa=oa?this.tilingScheme.levelAtScale(oa):0;ua=ua?this.tilingScheme.levelAtScale(ua):Infinity;const Ia=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(ya,oa+Ia,ua+Ia,Da)};Ta._evaluateTransparency=function(){var ya=this.baseOpacity;const oa=this.overlayManager.renderer.isEmpty;
var ua=this._renderer.transparency;ya=this._allSurfaceLayersTransparent()?oa?da.TransparencyMode.Empty:da.TransparencyMode.TransparentWithDraped:1<=ya&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?da.TransparencyMode.Opaque:da.TransparencyMode.Semitransparent;if(ua=ua!==ya)this._renderer.transparency=ya,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});return ua};Ta._updateTilingScheme=function(){const ya=this.tilingSchemeLogic.tilingScheme;
if(ya!==this.tilingScheme){ca.weakAssert(!!ya,"tiling scheme cannot be reset to undefined");this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var oa=ya?.spatialReference??H.WebMercator;this._spatialReference=oa;this._isWebMercatorOnPlateeCarree=(this._isWebMercator=!!oa?.isWebMercator)&&L.isPlateCarree(this.view?.renderSpatialReference);this._set("tilingScheme",ya);this._updateClippingExtent();ya&&(this._updateTiledLayers(),this._renderer.setTileSize(ya.pixelSize),
this.overlayManager.setSpatialReference(ya.spatialReference),this._updateRootTiles())}};Ta._acquireTile=function(ya,oa,ua,Da){const Ia=this._tilePool.acquire();Ua[0]=ya;Ua[1]=oa;Ua[2]=ua;Ia.init(Ua,Da,this);return Ia};Ta._updateRootTiles=function(){const {extent:ya,tilingScheme:oa}=this;if(oa){var ua=La,Da=oa.rootTilesInExtent(ya,ua,5*ka.MAX_ROOT_TILES);if(e.isSome(this._rootTiles)){if(Da.length>ka.MAX_ROOT_TILES){f.getLogger(this.declaredClass).warn(ka.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const Ia=
this._rootTiles.map(ab=>ab.lij),Na=x.difference(Ia,Da,Ka);this._updatingRootTiles=!0;if(0<Na.removed.length||0<Na.added.length){const ab=this._rootTiles.filter(cb=>-1<Na.removed.findIndex(hb=>Ka(hb,cb.lij))?(this._purgeTile(cb),!1):!0);Na.added.forEach(cb=>ab.push(this._newRootTile(cb)));this._setRootTiles(ab)}}else this._updatingRootTiles=!0,Da.length>ka.MAX_ROOT_TILES&&(f.getLogger(this.declaredClass).warn(ka.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Da=oa.rootTilesInExtent(ya,ua,ka.MAX_ROOT_TILES)),
this._setRootTiles(Da.map(Ia=>this._newRootTile(Ia)));K.equals(ua,this._rootTilesExtent)||(this._rootTilesExtent=K.create(ua));this._visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}};Ta._updateAllTileGeometries=function(){const ya=this._allTiles.filter(oa=>oa.isLoaded&&oa.intersectsClippingArea);ya.forEach(oa=>this._renderer.updateTileGeometryState(oa));
ya.forEach(oa=>oa.renderData.updateNeighborData());this._updateTilesGeometries(ya);this._pendingTilesToUpdate.clear()};Ta._updateTilesGeometries=function(ya){if(0!==ya.length){ya.sort(wa.compareTilesByLij);var oa=this.renderer;ya.forEach(ua=>oa.updateGeometryIfNeeded(ua));ya.forEach(ua=>this._pendingTilesForElevationUpdateEvent.add(ua))}};Ta._shouldSplit=function(ya){return ya.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===qa.TileUpdate.SPLIT};Ta._newRootTile=function(ya){ya=
this._acquireTile(0,ya[1],ya[2],null);this._shouldSplit(ya)&&ya.setPendingUpdate(qa.TileUpdate.SPLIT);this._loadTile(ya);this._markTileToUpdate(ya);this._updateRootTileElevationBounds();return ya};Ta._setRootTiles=function(ya){this._rootTiles=ya;this._allTiles.clear();if(e.isSome(ya)){const oa=this._iteratorPool.acquire();for(oa.reset(ya);!oa.done;)this._allTiles.push(oa.next());oa.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(ya)};Ta._runViewChangeUpdateIfDirty=
function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Ta._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))};Ta._updateClippingStatus=function(ya){ya.updateClippingStatus(this.extent)&&ya.resetPendingUpdate(qa.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(ya)};
Ta._updateTilesVisibility=function(ya){if(!e.isNone(ya)){var oa=wa.hasLoadableSiblings(ya),ua=this.visibleElevationBounds,Da=oa?ua.min:Infinity;oa=oa?ua.max:-Infinity;var Ia=this.extent,Na=this._viewProjectionMatrix;this.setTileTreeDirty();var ab=this._iteratorPool.acquire();for(ab.reset(ya);!ab.done;)ya=ab.next(),ya.updateClippingStatus(Ia)&&ya.resetPendingUpdate(qa.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(ya),ya.setPendingUpdate(qa.TileUpdate.RENDERDATA),ya.computeVisibility(),ya.updateScreenDepth(Na),
ya.renderData&&(Da=Math.min(ya.elevationBounds[0],Da),oa=Math.max(ya.elevationBounds[1],oa));ab.remove();this._allTilesDirty=this._viewChanged=!0;this._batchUpdatePendingTileGeometries();isFinite(Da)&&isFinite(oa)&&(ua.min!==Da||ua.max!==oa)&&(this.visibleElevationBounds=new V.ElevationBounds(Da,oa))}};Ta._updateRootTileElevationBounds=function(){let ya=Infinity,oa=-Infinity;var ua=this._rootTiles;e.isSome(ua)&&ua.forEach(({elevationBounds:Da})=>{ya=Math.min(ya,Da[0]);oa=Math.max(oa,Da[1])});ua=this.rootTileElevationBounds;
if(ua.min!==ya||ua.max!==oa)this.rootTileElevationBounds=new V.ElevationBounds(ya,oa)};Ta._updateViewDependentParameters=function(){const {camera:ya,contentCamera:oa}=this.view.state,ua=Math.tan(.5*oa.fovX),Da=Math.tan(.5*oa.fovY),Ia=this.tilingScheme.pixelSize,Na=2**-this._lodBias*ya.pixelRatio;this._splitLimits.aboveGround=ya.aboveGround;this._splitLimits.fovX=ua;this._splitLimits.fovY=Da;this._splitLimits.relativeWidthLimit=Ia/ya.width*this.maxTextureScale*Na;this._splitLimits.relativeHeightLimit=
Ia/ya.height*this.maxTextureScale*Na;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(e.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=I.create()),I.copy(this._splitLimits.frustum,oa.frustum)):this._splitLimits.frustum=null;I.copy(this._frustum,ya.frustum);D.multiply(this._viewProjectionMatrix,oa.projectionMatrix,oa.viewMatrix);v.copy(this._eyePosRenderSR,
oa.eye);F.projectVectorToVector(ya.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Ta._updateRenderData=function(ya){ya.rendered&&!ya.shouldLoad&&(Pa(ya)?this._loadChildren(ya):ya.isLeaf&&(ya.parent?.shouldLoad??!1)&&this._loadParent(ya))};Ta._updateTileGeometryState=function(ya){ya.updateVisibility();this._renderer.updateTileGeometryState(ya)&&this._markTileToUpdate(ya);this._usedMemory=null};Ta._markAllTileNeighborsForGeometryUpdate=function(ya){const oa=this._pendingTilesToUpdate;
ya.forEachLoadedNeighbor(ua=>{oa.add(ua)})};Ta._updateTileTexture=function(ya,oa){const ua=ya.resetPendingUpdate(qa.TileUpdate.TEXTURE_FADING)?qa.TileUpdate.TEXTURE_FADING:ya.resetPendingUpdate(qa.TileUpdate.TEXTURE_NOFADING)?qa.TileUpdate.TEXTURE_NOFADING:!1;ua&&(this._renderer.updateTileTexture(ya,ua),this._usedMemory=null,oa.madeProgress())};Ta._emitElevationUpdateEventForTiles=function(){const ya=Xa.extent;K.empty(ya);this._pendingTilesForElevationUpdateEvent.forEach(oa=>K.expand(ya,oa.extent,
ya));this._pendingTilesForElevationUpdateEvent.clear();Xa.spatialReference=this.spatialReference;this.emit("elevation-change",Xa)};Ta.runTask=function(ya){this._handleLayerViewChanges(ya);this._frameTask.processQueue(ya);this.renderer.processScaleRangeQueries(this._scaleRangeQueries,ya);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(ya);this._sortTiles(ya);const oa=!this.view.state.fixedContentCamera;this._mergeAndSplit(ya,oa);this._updateElevation(ya);
this._updateTextures(ya);oa||this._mergeAndSplit(ya,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._batchUpdatePendingTileGeometries();this._emitElevationUpdateEventForTiles();ya.done&&ya.hasProgressed&&this.requestUpdate();this.notifyChange("updatingProgressValue")};Ta._updateAllTilesStatus=function(ya){if(this._viewChanged&&this._rootTiles&&!ya.done){this._viewChanged=!1;var oa=this._iteratorPool.acquire();oa.reset(this._rootTiles);for(var ua=this.snapLevel,Da=this._splitLimits,
Ia=this._eyePosRenderSR;!oa.done;){var Na=oa.next(),ab=Na.shouldSplit(Da,Ia,ua);if(ab===qa.TileUpdate.SPLIT)Na.resetPendingUpdate(qa.TileUpdate.MERGE),Na.isLeaf&&(Na.setPendingUpdate(qa.TileUpdate.SPLIT),oa.skipSubtree()),Na.rendered&&Na.setPendingUpdate(qa.TileUpdate.RENDERDATA);else if(Na.resetPendingUpdate(qa.TileUpdate.SPLIT)&&Na.updateAgentSuspension(),ab===qa.TileUpdate.ELEVATION&&Na.updateAgents(Y.LayerClass.ELEVATION),oa.skipSubtree(),!Na.isLeaf){Na.setPendingUpdate(qa.TileUpdate.MERGE);Na.resetPendingUpdate(qa.TileUpdate.SPLIT);
ab=this._iteratorPool.acquire();ab.resetOne(Na);Na=this._viewProjectionMatrix;for(let cb=ab.next();!ab.done;cb=ab.next())this._updateClippingStatus(cb),cb.updateVisibility(),cb.updateScreenDepth(Na);ab.remove()}}oa.remove();this.requestUpdate();!this.shortBatches&&this.oneBatchPerFrameTask||this._batchUpdatePendingTileGeometries();ya.madeProgress()}};Ta._sortTiles=function(ya){ya.done||this._allTilesSorted||(wa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=
!0,this._treeDebugger&&this._treeDebugger.update(),ya.madeProgress())};Ta._markTileToUpdate=function(ya){ca.internalAssert(ya.isLoaded);ya.intersectsClippingArea&&(this._pendingTilesToUpdate.add(ya),this._markAllTileNeighborsForGeometryUpdate(ya))};Ta._batchUpdatePendingTileGeometries=function(){const ya=this._pendingTilesToUpdate;if(0!==ya.size){var oa=Array.from(this._pendingTilesToUpdate.keys()).filter(Ia=>Ia.isLoaded&&Ia.intersectsClippingArea),ua=(Ia,Na)=>{!Na?.isLoaded||!Na.intersectsClippingArea||
Na.level<Ia.level||ya.has(Na)||(ya.add(Na),oa.push(Na),Na.renderData.updateNeighborData())};oa.sort(wa.compareTilesByLij);var Da=oa.length;for(let Ia=0;Ia<Da;++Ia){const Na=oa[Ia];ca.internalAssert(Na.isLoaded);ca.internalAssert(Na.intersectsClippingArea);const ab=Na.renderData;ab.updateNeighborData();const cb=ab._dirtyEdgeResolutions,hb=ab.geometryState.neighborData;for(let ib=0;4>ib;++ib)if(cb&1<<ib){const qb=ab.geometryState.neighborData.edgePeerNeighbors[ib];qb&&qb?.level>=Na.level&&qb.forAllSubtreeOnSide(ca.oppositeEdge(ca.neighborEdgeIndices[ib]),
pb=>pb.isLoaded&&pb.intersectsClippingArea?(ca.internalAssert(ya.has(pb)||0>wa.compareTilesByLij(Na,pb)),ua(Na,pb),!0):!1);ua(Na,hb.cornerPeerNeighbors[ib]);ua(Na,hb.cornerPeerNeighbors[(ib+1)%4])}}ya.clear();this._updateTilesGeometries(oa);ca.ENABLE_TERRAIN_INTERNAL_CHECKS&&ca.ENABLE_WATERPROOFNESS_TESTS&&this.checkAllTilesWaterproofness()}};Ta._mergeAndSplit=function(ya,oa){if(!this.suspended&&!ya.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var ua=!1,Da=this.view.state.fixedContentCamera,
Ia=!1;!ya.done;){Ia=!0;let Na=!1;const ab=!this._allTiles.some(cb=>{if(!ua&&!Da&&!cb.visible)return ya.done;let hb=cb;if(cb.resetPendingUpdate(qa.TileUpdate.MERGE)){if(!oa)return cb.setPendingUpdate(qa.TileUpdate.MERGE),ya.done;for(;hb.parent?.resetPendingUpdate(qa.TileUpdate.MERGE);)hb=hb.parent;this._mergeTile(hb);Na=!0;ya.madeProgress()}else cb.resetPendingUpdate(qa.TileUpdate.SPLIT)&&(this._splitTile(cb),Na=!0,ya.madeProgress());!ya.done&&hb===cb&&cb.resetPendingUpdate(qa.TileUpdate.RENDERDATA)&&
(this._updateRenderData(cb),ya.madeProgress());return ya.done});Na&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(ab)if(!ua)ua=!0;else{if(!Na)break}else this._allTilesDirty=!0}Ia?ya.madeProgress():this._allTilesDirty=!0;!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries();this._sortTiles(ya)}};Ta._updateElevation=function(ya){ya.done||(this._allTiles.some(oa=>{oa.resetPendingUpdate(qa.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(oa),this._updateTileTexture(oa,ya),this.shortBatches&&
this._batchUpdatePendingTileGeometries(),ya.madeProgress());return ya.done}),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())};Ta._updateTextures=function(ya){ya.done||this._allTiles.some(oa=>{this._updateTileTexture(oa,ya);return ya.done})};Ta._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(Ba.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};Ta._getLodBiasCorrectedScale=function(ya){const oa=this.tilingScheme.levels;
ya=d.clamp(ya-this._lodBias,0,oa.length-1);const ua=ya-Math.floor(ya);return oa[Math.floor(ya)].scale*(1-ua)+oa[Math.ceil(ya)].scale*ua};Ta._removeAllTiles=function(){e.isSome(this._rootTiles)&&(this._rootTiles.forEach(ya=>this._purgeTile(ya)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this._visible=!1};Ta._purgeDescendantTiles=function(ya){if(!ya.children[0])return!1;let oa=!1;for(let ua=0;4>ua;++ua)oa=this._purgeTile(ya.children[ua])||oa;ya.unsetChildren();return oa};
Ta._purgeTile=function(ya){const oa=this._purgeDescendantTiles(ya)||ya.rendered;this._allTiles.removeUnordered(ya);this._unloadTile(ya);this._tilePool.release(ya);return oa};Ta._unloadTile=function(ya){this._pendingTilesToUpdate.delete(ya);this._pendingTilesForElevationUpdateEvent.delete(ya);ya.unload(this._renderer)};Ta._splitTile=function(ya){ca.weakAssert(ya.isLeaf,"tile that is already split should not be split again!");const oa=ya.level+1,ua=2*ya.lij[1],Da=2*ya.lij[2];ya.setChildren(this._createTile(oa,
ua,Da,ya),this._createTile(oa,ua,Da+1,ya),this._createTile(oa,ua+1,Da,ya),this._createTile(oa,ua+1,Da+1,ya));ya.setPendingUpdate(qa.TileUpdate.RENDERDATA);ya.updateAgentSuspension();this._allTiles.pushArray(ya.children);this._allTilesDirty=!0;++this._performanceInfo.numSplit};Ta._emitTileScaleChange=function(ya,oa=ya.level){la.spatialReference=this.spatialReference;la.extent=ya.extent;la.scale=this._getLodBiasCorrectedScale(oa);this.emit("scale-change",la)};Ta._createTile=function(ya,oa,ua,Da){ca.weakAssert(!!Da,
"_createTile sanity check");ya=this._acquireTile(ya,oa,ua,Da);ya.updateClippingStatus(this.extent);ya.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(ya)&&ya.setPendingUpdate(qa.TileUpdate.SPLIT);return ya};Ta._mergeTile=function(ya){ca.weakAssert(!ya.hasPendingUpdate(qa.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(ya)&&(ca.weakAssert(!ya.renderData,"_mergeTile sanity check"),this._loadTile(ya),this._markTileToUpdate(ya),this._emitTileScaleChange(ya),this.shortBatches&&
this._batchUpdatePendingTileGeometries());this._allTilesDirty=!0;++this._performanceInfo.numMerged};Ta._loadChildren=function(ya){ca.weakAssert(ya.rendered,"parent should be rendered");this._unloadTile(ya);const oa=ya.children;oa.forEach(ua=>this._loadTile(ua));oa.forEach(ua=>this._pendingTilesToUpdate.add(ua));this._markAllTileNeighborsForGeometryUpdate(ya);this._emitTileScaleChange(ya,ya.level+1);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Ta._loadParent=function(ya){ya=ya.parent;
this._unloadChildren(ya);this._loadTile(ya);this._markTileToUpdate(ya);this._emitTileScaleChange(ya,ya.level);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Ta._unloadChildren=function(ya){ya=ya.children;if(ya[0])for(let oa=0;4>oa;++oa){const ua=ya[oa];this._unloadChildren(ua);this._unloadTile(ua)}};Ta._loadTile=function(ya){ya.load();ya.setPendingUpdate(qa.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(ya)};
Ta._elevationDataArrived=function(ya,oa,ua){ua=new T.ElevationData(ya.lij,ya.extent,ua);ya.dataArrived(oa,Y.LayerClass.ELEVATION,ua);ua=[ya];ya=ya.level;const Da=this._iteratorPool.acquire();for(Da.reset(ua);!Da.done;){const Ia=Da.next();Ia.findElevationBoundsForLayer(oa,ya);Ia.computeElevationBounds()}0===ya&&this._updateRootTileElevationBounds();Da.remove();this._updateTilesVisibility(ua)};Ta._handleLayerViewChanges=function(ya=Ha.noBudget){if(this._layerViewsDirty){var oa=this._layerViewsDirty=
!1,ua=new Set,Da=-1;for(const Na of this.view.allLayerViews.items)if(ua.add(Na.uid),ca.isSurfaceLayerView(Na)||ca.isGroupLayerView(Na))if(this._basemapLayerViewHandles.has(Na.uid)&&!ca.isGroupLayerView(Na)){var Ia=this._layerClassFromLayerView(Na);Ia=this._getLayerIdxByUID(Ia,Na.uid);if(e.isSome(Ia)){if(Ia<Da||e.isNone(Da))oa=!0;Da=Ia}}else this._registerTiledLayerView(Na),Na.layer.loaded&&(oa=!0);this._basemapLayerViewHandles.forEach((Na,ab)=>{ua.has(ab)||(this._unregisterTiledLayerView(ab),oa=!0)});
oa&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();ya.madeProgress()}};Ta._allSurfaceLayersTransparent=function(){let ya=0===this.view.map?.ground?.opacity;for(const oa of this.view.allLayerViews.items)if(ca.isMapTileLayerView(oa)&&!M.isBaseLayer(oa.layer)&&0!==oa.fullOpacity){ya=!1;break}return ya};Ta._hasCompositeBlendMode=function(){for(const ya of this.view.allLayerViews.items)if((ca.isBlendableLayerView(ya)||ca.isGroupLayerView(ya))&&
ra.isCompositeBlendMode(ra.blendModeFromString[ya.layer.blendMode]))return!0;return!1};Ta._layerClassFromLayerView=function(ya){return ca.isElevationLayerView(ya)?Y.LayerClass.ELEVATION:Y.LayerClass.MAP};Ta._registerTiledLayerView=function(ya){const oa=[];(ca.isBlendableLayerView(ya)||ca.isGroupLayerView(ya))&&oa.push(h.watch(()=>ya.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(Z.TextureUpdate.UNFADED)}));if(!ca.isGroupLayerView(ya)){const ua=
this._layerClassFromLayerView(ya);oa.push(h.watch(()=>ya.suspended,()=>this._updateTiledLayers()));oa.push(h.watch(()=>ya.fullOpacity,()=>this._updateTileTextures(Z.TextureUpdate.UNFADED)));oa.push(h.watch(()=>"effectiveScaleRange"in ya.layer?ya.layer.effectiveScaleRange:null,()=>this._restartAllAgents(ua)));oa.push(ya.on("data-changed",()=>{const Da=this._getLayerIdxByUID(ua,ya.uid);e.isSome(Da)&&this._invalidateLayerData(Da,ua)}))}this._unregisterTiledLayerView(ya.uid);this._basemapLayerViewHandles.set(ya.uid,
oa)};Ta._unregisterTiledLayerView=function(ya){const oa=this._basemapLayerViewHandles.get(ya);if(oa){for(const ua of oa)ua.remove();this._basemapLayerViewHandles.delete(ya)}};Ta._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var ya=[[],[]],oa=null;this.view.allLayerViews.forEach(Da=>{if(Da.layer&&!Da.suspended&&ca.isSurfaceLayerView(Da)&&Da.fullExtent){var Ia=this._layerClassFromLayerView(Da);if(Ia===Y.LayerClass.MAP){const Na=Da.displayLevelRange.maxLevel;Infinity!==Na&&
(null===oa||Na>oa)&&(oa=Na)}ya[Ia].push(Da)}});for(const Da of Y.LayerClasses){var ua=this._layerViews[Da];const Ia=ya[Da];Ia.reverse();const Na=Ia.length;let ab=ua.length!==Na;const cb=Array(Na),hb=Array(ua.length);this._layerIndexByUid[Da].clear();for(let ib=0;ib<Na;ib++){this._layerIndexByUid[Da].set(Ia[ib].uid,ib);const qb=ua.indexOf(Ia[ib]);cb[ib]=qb;ib!==qb&&(ab=!0);-1<qb&&(hb[qb]=ib)}if(ab){ua=this._postorderIterator;for(ua.reset(this._rootTiles);!ua.done;)ua.next().modifyLayers(hb,cb,Da);
this._layerViews[Da]=Ia;this._restartAllAgents(Da);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(oa)&&this._viewChangeUpdate()}};Ta._restartAllAgents=function(ya){const oa=this._postorderIterator;for(oa.reset(this._rootTiles);!oa.done;){const ua=oa.next();ua.restartAgents(ya);ya===Y.LayerClass.ELEVATION&&ua.computeElevationBounds()}this._updateRootTileElevationBounds()};Ta.layerViewByIndex=function(ya,oa){return this._layerViews[oa][ya]};Ta.numLayers=function(ya){return this._layerViews[ya].length};
Ta._updateTileTextures=function(ya){this._allTiles.forAll(oa=>{oa.updateAgents(Y.LayerClass.MAP);ya===Z.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(oa,qa.TileUpdate.TEXTURE_NOFADING):oa.updateRenderData(Y.LayerClass.MAP,ya)});this._evaluateTransparency()};Ta._invalidateLayerData=function(ya,oa){this._allTiles.forAll(ua=>ua.removeLayerAgent(ya,oa));this._allTiles.forAll(ua=>ua.invalidateLayerData(ya,oa))};Ta.setTileTreeDirty=function(){this._allTilesDirty=!0};Ta.requestRender=function(ya=
Ba.RenderRequestType.UPDATE){this.renderer.setNeedsRender(ya)};Ta.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Ta.requestTileData=function(ya,oa,ua,Da){const Ia=this.layerViewByIndex(oa,ua);oa=Ia.layer;if(!oa.tilemapCache||ca.isVectorTileLayerView(Ia))return this._requestTileData(ya,ua,Ia,Da);++this._asyncWorkItems;return oa.tilemapCache.fetchAvailability(ya.lij[0],ya.lij[1],ya.lij[2],{...Da,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Na=>{--this._asyncWorkItems;
p.throwIfAborted(Da);p.isAbortError(Na)||this._dataMissing(ya,ua,Ia,{notInTilemap:!0});throw Na;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(ya,ua,Ia,Da),Da.signal))};Ta._requestTileData=function(ya,oa,ua,Da){return oa===Y.LayerClass.ELEVATION?ca.isElevationLayerView(ua)?this._requestElevationTileData(ya,ua,Da):Promise.reject():ca.isMapTileLayerView(ua)?this._requestMapTileData(ya,ua,Da):Promise.reject()};Ta._requestElevationTileData=function(ya,oa,ua){++this._asyncWorkItems;const Da=
ab=>{if(!p.isAborted(ua)){var cb=this._layerIndexByUid[Y.LayerClass.ELEVATION].get(oa.uid);null==cb?f.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",Y.LayerClass.ELEVATION,ya.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(ya,cb,ab))}},Ia=ab=>{p.isAbortError(ab)||(this._dataMissing(ya,Y.LayerClass.ELEVATION,oa,ab),this.requestUpdate())};if(ca.useFetchTileForLayer(oa.layer))return oa.layer.fetchTile(ya.lij[0],ya.lij[1],
ya.lij[2],{noDataValue:ka.ELEVATION_NODATA_VALUE,signal:ua.signal}).then(ab=>{if(p.isAborted(ua))f.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>Da(ab),ua.signal,Ia)},Ia).finally(()=>{--this._asyncWorkItems});const Na=oa.getTileUrl(ya.lij[0],ya.lij[1],ya.lij[2]);return this._elevationDataRequester.request(Na,"binary",ua).then(ab=>this._lercDecoder.decode(ab,
{noDataValue:ka.ELEVATION_NODATA_VALUE},ua.signal)).then(ab=>{ab?Da(new J.ElevationTileData(ab)):Ia(Error("LERC decoding failed"))},Ia).finally(()=>{--this._asyncWorkItems})};Ta._requestMapTileData=function(ya,oa,ua){++this._asyncWorkItems;const Da=(hb,ib)=>{--this._asyncWorkItems;ca.releaseTileData(ib);p.isAborted(ua)||(this._dataMissing(ya,Y.LayerClass.MAP,oa,hb),this.requestUpdate())},Ia=hb=>ib=>Da(ib,hb),Na=hb=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();p.isAborted(ua)?
ca.releaseTileData(hb):this._mapTileDataArrived(ya,oa,hb)},ua.signal,Ia(hb)).catch(Ia(hb)),ab=(hb,ib=null)=>this._frameTask.schedule(()=>Da(hb,ib));if(ca.isVectorTileLayerView(oa)){var cb=oa.schemaHelper.getLevelRowColumn(ya.lij);return oa.fetchTile(cb[0],cb[1],cb[2],ua).then(Na,ab)}if(ca.isImageryTileLayerView(oa))return oa.fetchTile(ya.lij[0],ya.lij[1],ya.lij[2],ua).then(Na,ab);if(ca.isTileLayerView(oa)&&ca.useFetchTileForLayer(oa.layer))return oa.layer.fetchTile(ya.lij[0],ya.lij[1],ya.lij[2],ua).then(hb=>
{p.isAborted(ua)?(f.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),ab(p.createAbortError())):Na(hb)},ab);cb=oa.getTileUrl(ya.lij[0],ya.lij[1],ya.lij[2]);R.isRefreshableLayer(oa.layer)&&oa.layer.refreshTimestamp&&(cb+=`${cb.includes("?")?"\x26":"?"}_ts=${oa.layer.refreshTimestamp}`);return this._mapDataRequester.request(cb,oa.hasMixedImageFormats?"image+type":"image",ua).then(Na,
ab)};Ta._mapTileDataArrived=function(ya,oa,ua){oa=this._getLayerIdxByUID(Y.LayerClass.MAP,oa.uid);e.isSome(oa)?ya.dataArrived(oa,Y.LayerClass.MAP,ua):(ca.releaseTileData(ua),f.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))};Ta._getLayerIdxByUID=function(ya,oa){return this._layerIndexByUid[ya].get(oa)};Ta._dataMissing=function(ya,oa,ua,Da){ua=this._getLayerIdxByUID(oa,ua.uid);e.isSome(ua)?ya.dataMissing(ua,oa,Da):f.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")};
Ta.updateTileOverlayParams=function(ya){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(oa=>{oa.renderData&&this.overlayManager.setTileParameters(oa)}),this._renderer.setNeedsRender(ya))};Ta._recalculateUsedMemory=function(){return this.tilingScheme?this._allTiles.reduce((ya,oa)=>ya+oa.usedMemory,0):null};Ta.getUsedMemoryForLayerView=function(ya){let oa=0;const ua=this._layerClassFromLayerView(ya),Da=this._getLayerIdxByUID(ua,ya.uid);e.isSome(Da)&&this._allTiles.forAll(Ia=>oa+=Ia.getUsedMemoryForLayer(ua,
Da));return oa};Ta.getTile=function(ya){if(e.isNone(ya)||e.isNone(this._rootTiles))return null;const oa=ya.split("/").map(Na=>+Na);if(0===oa[0])return this._rootTiles.find(Na=>Na.lij[1]===oa[1]&&Na.lij[2]===oa[2]);ya=2**oa[0];const ua=Math.floor(oa[1]/ya),Da=Math.floor(oa[2]/ya);let Ia;this._rootTiles.some(Na=>Na.lij[1]===ua&&Na.lij[2]===Da?(Ia=Na,!0):!1);if(Ia){for(ya=1<<oa[0]-1;Ia.lij[0]<oa[0];){let Na=oa[1]&ya?2:0;0<(oa[2]&ya)&&Na++;if(!Ia.children[Na])return null;Ia=Ia.children[Na];ya>>=1}ca.weakAssert(Ia.lij[0]===
oa[0]&&Ia.lij[1]===oa[1]&&Ia.lij[2]===oa[2],"not the right tile?");return Ia}return null};Ta.checkAllTilesWaterproofness=function(){if(ca.ENABLE_WATERPROOFNESS_TESTS){var ya=this._rootTiles;if(!e.isNone(ya)){var oa=Ia=>0<Ia?.renderData?.geometryInfo?.indices?.length,ua=Ia=>{if(Ia.intersectsClippingArea)if(Ia.renderData&&!Ia.renderData.geometryState&&console.error("Tile[",Ia.lij,"] has renderData but not geometryState"),Ia.renderData&&!Ia.renderData.geometryInfo&&console.error("Tile[",Ia.lij,"] has renderData but not geometryInfo"),
!Ia.renderData?.geometryInfo||0<(Ia.renderData.geometryInfo.indices?.length??0)||console.error("Tile[",Ia.lij,"] has renderData but no indices - geometryInfo: ",Ia.renderData.geometryInfo),oa(Ia)){Ia.checkGeometryWaterproofness();for(const cb of Ia.children){var Na=cb,ab=Ia;oa(Na)&&console.error("Tile[",Na.lij,"] has geometry although parent[",ab.lij,"] has geom")}}else if(Ia.isLeaf)console.error("Tile[",Ia.lij,"] has no geometry and no children, from root to leaf");else for(Na of Ia.children)ua(Na)},
Da=Ia=>{const Na=Ia.parent?.visible??!0,ab=Ia.visible;Ia.computeVisibility();const cb=Ia.visible;ab!==cb&&Na&&console.error(" Tile[",Ia.lij,"] has out of date visibility: ",ab," instead of ",cb);if(!Ia.isLeaf)for(const hb of Ia.children)Da(hb)};for(const Ia of ya)ua(Ia),Da(Ia)}}};Ta.isEastEndWrap=function(ya){return this.isGlobal&&ya[2]===this.lijEastEnd(ya[0])-1};Ta.isWestEndWrap=function(ya){return this.isGlobal&&0===ya[2]};Ta.lijEastEnd=function(ya){const oa=e.isSome(this.spatialReference)&&this.spatialReference.isGeographic;
return 2**(ya+(oa?1:0))};Ta.wrapEastWest=function(ya){const oa=this.lijEastEnd(ya[0]),ua=ya[2];return 0<=ua&&ua<oa?ya:this.isGlobal?[ya[0],ya[1],(ua+(0>ua?oa:0))%oa]:null};Ta.enableInternalChecks=function(ya){ca.enableTerrainInternalChecks(ya)};Ta.enableWaterproofnessChecks=function(ya){ca.enableTerrainWaterproofnessChecks(ya)};b._createClass(Ma,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){if(this.lodSnapping===
Z.LODSnapping.ON){var ya=this.view,oa=this.tilingScheme;const ua=ya.pointsOfInterest?.cameraOnSurface?.scale;if(oa&&ua){const Da=ya.state.contentCamera;ya=U.directionToHeadingTilt(ya,Da.eye,Da.viewForward,Da.up).tilt;90<ya&&(ya=180-ya);ya=2*(ya/90)**2;oa=oa.levelAtScale(ua);oa=Math.min(oa-ya,this._splitLimits.maxLod||Infinity);return 0>=oa?null:oa}}return null}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?Z.LODSnapping.ON:Z.LODSnapping.OFF}},
{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:ya}=this,{clippingArea:oa}=this.view;if(e.isNone(oa)||e.isNone(ya))return null;const ua=K.create();ya=S.toBoundingRect(oa,ua,ya)?ua:null;oa=this._get("extent");
return K.equals(ya,oa)?oa:ya}},{key:"rootTilesExtent",get:function(){return this._rootTilesExtent}},{key:"extent",get:function(){const ya=K.intersection(this.groundExtent,this._userClippingExtent,K.create()),oa=this._get("extent");return K.equals(ya,oa)?oa:ya}},{key:"groundExtent",get:function(){return e.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){return this.tilingSchemeLogic?.extent}},{key:"updating",get:function(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}},{key:"running",get:function(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,
this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"baseOpacity",get:function(){return this.view?.map?.ground?.opacity??1},set:function(ya){this.view.map.ground.opacity=ya}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return e.isSome(this._rootTiles)}},{key:"renderOrder",set:function(ya){this._renderer.renderOrder=ya;this._set("renderOrder",ya)}},{key:"rootTiles",get:function(){return this._rootTiles}},{key:"spatialReference",
get:function(){return this.tilingScheme?.spatialReference??null}},{key:"backgroundColor",get:function(){return this.view.map.ground.surfaceColor},set:function(ya){this.view.map.ground.surfaceColor=ya}},{key:"slicePlaneEnabled",set:function(ya){this._renderer.slicePlaneEnabled=ya;this._set("slicePlaneEnabled",ya);this._evaluateTransparency()}},{key:"tilingSchemeLocked",get:function(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}},{key:"velvetOverground",set:function(ya){this._renderer.velvetOverground=
ya;this._set("velvetOverground",ya)}},{key:"wireframe",get:function(){return this._renderer.wireframe},set:function(ya){ya!==this._renderer.wireframe&&(this._renderer.wireframe=ya,this._updateAllTileGeometries())}},{key:"_visible",set:function(ya){ya!==this._visibleCached&&(this._visibleCached=ya,this._renderer.setVisibility(ya),this.suspended=!ya)}},{key:"opaque",get:function(){return this._renderer.transparency===da.TransparencyMode.Opaque}},{key:"suspended",set:function(ya){this._set("suspended",
ya);this._viewChangeUpdate()}},{key:"textureFadeDuration",get:function(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}},{key:"updatingRootTiles",get:function(){return this._updatingRootTiles}},{key:"_lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*ka.MAX_MEMORY_LOD_BIAS}},{key:"shortBatches",get:function(){return this.view.state.mode!==Aa.RenderState.IDLE}},{key:"performanceInfo",get:function(){const ya=
this._performanceInfo;ya.numNodes=this._allTiles.length;ya.numLeaves=ya.numVisible=ya.numRendered=ya.numLoadedPerLevel.length=ya.numRenderedPerLevel.length=0;this._allTiles.forAll(oa=>{oa.isLeaf&&ya.numLeaves++;const ua=oa.level;oa.renderData&&(ya.numLoadedPerLevel[ua]=(ya.numLoadedPerLevel[ua]||0)+1);oa.visible&&(ya.numVisible++,oa.rendered&&(ya.numRenderedPerLevel[ua]=(ya.numRenderedPerLevel[ua]||0)+1,ya.numRendered++))});return ya}},{key:"usedMemory",get:function(){if(!this.tilingScheme)return 0;
e.isNone(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory());return e.isSome(this._usedMemory)?this._usedMemory:0}},{key:"renderPatchBorders",get:function(){return this._renderer.renderPatchBorders},set:function(ya){this._renderer.renderPatchBorders=ya}},{key:"visualizeNormals",get:function(){return this._renderer.visualizeNormals},set:function(ya){this._renderer.visualizeNormals=ya}},{key:"renderingDisabled",get:function(){return this._renderer.renderingDisabled},set:function(ya){this._renderer.renderingDisabled=
ya}},{key:"test",get:function(){const ya=this;return{renderer:ya._renderer,lercDecoder:ya._lercDecoder,forceReload:()=>{e.isSome(ya._rootTiles)&&0<ya._rootTiles.length&&(ya._mergeTile(ya._rootTiles[0]),ya._viewChangeUpdate())},getTiles:()=>ya._allTiles.toArray(),getRenderedTiles(){Za.clear();ya._allTiles.forAll(ua=>{ua.visible&&ua.rendered&&Za.push(ua)});const oa=Za.toArray();wa.sortTiles(ya.renderOrder,oa);return oa},lockTilingScheme(oa,ua){ya._extentHelper.defaultTiledLayersExtent=ua;ya.tilingSchemeLogic.test.lockTilingScheme(oa)}}}},
{key:"isGlobal",get:function(){return this._isGlobal}},{key:"isWebMercator",get:function(){return this._isWebMercator}},{key:"isWebMercatorOnPlateeCarree",get:function(){return this._isWebMercatorOnPlateeCarree}}]);return Ma}(l.EventedMixin(n));c.__decorate([r.property()],n.prototype,"_renderer",void 0);c.__decorate([r.property({constructOnly:!0})],n.prototype,"_scaleRangeQueries",void 0);c.__decorate([r.property({constructOnly:!0})],n.prototype,"view",void 0);c.__decorate([r.property({constructOnly:!0})],
n.prototype,"overlayManager",void 0);c.__decorate([r.property()],n.prototype,"_hasPendingUpdates",void 0);c.__decorate([r.property()],n.prototype,"_asyncWorkItems",void 0);c.__decorate([r.property()],n.prototype,"_allTilesDirty",void 0);c.__decorate([r.property()],n.prototype,"_allTilesSorted",void 0);c.__decorate([r.property()],n.prototype,"_viewChanged",void 0);c.__decorate([r.property()],n.prototype,"_splitLimits",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"_watchUpdatingTracking",
void 0);c.__decorate([r.property()],n.prototype,"_frameTask",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"snapLevel",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"lodSnapping",null);c.__decorate([r.property()],n.prototype,"_userClippingExtent",null);c.__decorate([r.property()],n.prototype,"_rootTilesExtent",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"extent",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"groundExtent",null);c.__decorate([r.property({readOnly:!0})],
n.prototype,"_tilingSchemeExtent",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"updating",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"running",null);c.__decorate([r.property(W.updatingProgress)],n.prototype,"updatingProgress",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"updatingProgressValue",null);c.__decorate([r.property()],n.prototype,"_maxNumUpdating",void 0);c.__decorate([r.property()],n.prototype,"baseOpacity",null);c.__decorate([r.property()],
n.prototype,"hasCompositeBlendMode",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"viewingMode",null);c.__decorate([r.property()],n.prototype,"maxTextureScale",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"ready",null);c.__decorate([r.property({value:na.RenderOrder.FRONT_TO_BACK})],n.prototype,"renderOrder",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"rootTiles",null);c.__decorate([r.property()],n.prototype,"_rootTiles",void 0);c.__decorate([r.property({readOnly:!0})],
n.prototype,"spatialReference",null);c.__decorate([r.property({type:w})],n.prototype,"backgroundColor",null);c.__decorate([r.property({value:!1})],n.prototype,"slicePlaneEnabled",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"tilingScheme",void 0);c.__decorate([r.property({readOnly:!0})],n.prototype,"tilingSchemeLocked",null);c.__decorate([r.property({readOnly:!0})],n.prototype,"tilingSchemeLogic",void 0);c.__decorate([r.property({value:!0})],n.prototype,"velvetOverground",null);c.__decorate([r.property()],
n.prototype,"wireframe",null);c.__decorate([r.property({value:!1})],n.prototype,"suspended",null);c.__decorate([r.property()],n.prototype,"textureFadeDuration",null);c.__decorate([r.property()],n.prototype,"visibleElevationBounds",void 0);c.__decorate([r.property()],n.prototype,"rootTileElevationBounds",void 0);c.__decorate([r.property()],n.prototype,"_layerViewsDirty",void 0);c.__decorate([r.property()],n.prototype,"renderPatchBorders",null);c.__decorate([r.property()],n.prototype,"visualizeNormals",
null);c.__decorate([r.property()],n.prototype,"renderingDisabled",null);c=n=c.__decorate([B.subclass("esri.views.3d.terrain.TerrainSurface")],n);const Sa=t.create(),La=K.create(),Ua=[0,0,0],Za=new u,Xa={spatialReference:null,extent:K.create(),context:"ground"},la={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._store=x}var n=
w.prototype;n.destroy=function(){this._store.destroy()};n.get=function(x){return this._store.get(x)};n.put=function(x,m){this._store.put(x,m,m.values.byteLength+256)};return b._createClass(w)}();a.ElevationQueryTileCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,b,c){let w=function(){function n(x,m,l,g){this._maxValue=this._minValue=this._hasNoDataValues=
null;"pixelData"in x?(this.values=x.pixelData,this.width=x.width,this.height=x.height,this.noDataValue=x.noDataValue):(this.values=x,this.width=m,this.height=l,this.noDataValue=g)}n.prototype._ensureBounds=function(){if(!c.isSome(this._minValue)){var {noDataValue:x,values:m}=this,l=Infinity,g=-Infinity,f=!0;for(const d of m)d===x?this._hasNoDataValues=!0:(l=d<l?d:l,g=d>g?d:g,f=!1);f?this._maxValue=this._minValue=0:(this._minValue=l,this._maxValue=-3E38<g?g:0)}};b._createClass(n,[{key:"hasNoDataValues",
get:function(){c.isNone(this._hasNoDataValues)&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}},{key:"minValue",get:function(){this._ensureBounds();return c.unwrap(this._minValue)}},{key:"maxValue",get:function(){this._ensureBounds();return c.unwrap(this._maxValue)}}]);return n}();a.ElevationTileData=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/maybe","../../core/workers/WorkerHandle"],function(a,b,c,w){let n=function(m){function l(f=null){var d=g.call(this,"LercWorker","_decode",{_decode:e=>[e.buffer]},f,{strategy:"dedicated"});d.schedule=f;d.ref=0;return d}b._inherits(l,m);var g=b._createSuper(l);m=l.prototype;m.decode=function(f,d,e){return f&&0!==f.byteLength?this.invoke({buffer:f,options:d},e):Promise.resolve(null)};m.release=function(){0>=--this.ref&&(x.forEach((f,d)=>{f===this&&x.delete(d)}),this.destroy())};return b._createClass(l)}(w.WorkerHandle);
const x=new Map;a.acquireDecoder=function(m=null){let l=x.get(c.unwrap(m));l||(c.isSome(m)?(l=new n(g=>m.immediate.schedule(g)),x.set(m,l)):(l=new n,x.set(null,l)));++l.ref;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,b,c,w,n,x,m,l){let g=function(){function f(e,k,u,p,h={}){this._mainMethod=
k;this._transferLists=u;this._listeners=[];this._promise=l.open(e,{...h,schedule:p}).then(r=>{if(void 0===this._thread){this._thread=r;this._promise=null;h.hasInitialize&&this.broadcast({},"initialize");for(const q of this._listeners)this._connectListener(q)}else r.close()});this._promise.catch(r=>n.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${r}`))}var d=f.prototype;d.on=function(e,k){const u={removed:!1,eventName:e,callback:k,threadHandle:null};this._listeners.push(u);
this._connectListener(u);return w.makeHandle(()=>{u.removed=!0;c.remove(this._listeners,u);this._thread&&x.isSome(u.threadHandle)&&u.threadHandle.remove()})};d.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}};d.invoke=function(e,k){return this.invokeMethod(this._mainMethod,e,k)};d.invokeMethod=function(e,k,u){if(this._thread){var p=this._transferLists[e];p=p?p(k):[];return this._thread.invoke(e,k,{transferList:p,
signal:u})}return this._promise?this._promise.then(()=>{m.throwIfAborted(u);return this.invokeMethod(e,k,u)}):Promise.reject(null)};d.broadcast=function(e,k){return this._thread?Promise.all(this._thread.broadcast(k,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,k)):Promise.reject()};d._connectListener=function(e){this._thread&&this._thread.on(e.eventName,e.callback).then(k=>{e.removed||(e.threadHandle=k)})};b._createClass(f,[{key:"promise",get:function(){return this._promise}}]);
return f}();a.WorkerHandle=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,c,w,n,x,m,l,g){g=function(d){function e(u,p,h,r,q,y,B,D=null){p=k.call(this,u,p,h,r,q,y,4096,4096);p._memCache=D;p.type=
"vector-tile";p._referenced=0;p._hasSymbolBuckets=!1;p._memoryUsedByLayerData=0;p.layerData=new Map;p.layerCount=0;p.status="loading";p.allSymbolsFadingOut=!1;p.lastOpacityUpdate=0;p.symbols=new Map;p.isCoverage=!1;p.neededForCoverage=!1;p.decluttered=!1;p.invalidating=!1;p.parentTile=null;p.childrenTiles=new Set;p._processed=!1;p._referenced=1;p.styleRepository=B;p.id=u.id;return p}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.setData=function(u){this.changeDataImpl(u);this.requestRender();
this.ready();this.invalidating=!1;this._processed=!0};d.deleteLayerData=function(u){let p=!1;for(const h of u)this.layerData.has(h)&&(u=this.layerData.get(h),this._memoryUsedByLayerData-=u.memoryUsed,u.type===x.BucketType.SYMBOL&&this.symbols.has(h)&&(this.symbols.delete(h),p=!0),u.destroy(),this.layerData.delete(h),this.layerCount--);c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);p&&this.emit("symbols-changed");this.requestRender()};d.processed=
function(){return this._processed};d.hasData=function(){return 0<this.layerCount};d.dispose=function(){"unloaded"!==this.status&&(f.delete(this),e._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};d.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};d.retain=function(){++this._referenced};d.changeDataImpl=function(u){let p=!1;if(u){const {bucketsWithData:h,emptyBuckets:r}=
u;u=this._createRenderBuckets(h);if(r&&0<r.byteLength){const q=new Uint32Array(r);for(const y of q)this._deleteLayerData(y)}for(const [q,y]of u)this._deleteLayerData(q),y.type===x.BucketType.SYMBOL&&(this.symbols.set(q,y.symbols),p=!0),this._memoryUsedByLayerData+=y.memoryUsed,this.layerData.set(q,y),this.layerCount++;c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,h]of this.layerData)h.type===x.BucketType.SYMBOL&&
(this._hasSymbolBuckets=!0);p&&this.emit("symbols-changed")};d.attachWithContext=function(u){this.stage={context:u,trashDisplayObject(p){p.processDetach()},untrashDisplayObject(){return!1}}};d.setTransform=function(u){b._get(b._getPrototypeOf(e.prototype),"setTransform",this).call(this,u);var p=this.resolution/(u.resolution*u.pixelRatio);const h=this.width/this.rangeX*p;p*=this.height/this.rangeY;const r=[0,0];u.toScreen(r,[this.x,this.y]);const q=this.transforms.tileUnitsToPixels;w.identity(q);w.translate(q,
q,r);w.rotate(q,q,Math.PI*u.rotation/180);w.scale(q,q,[h,p,1])};d._createTransforms=function(){return{dvs:n.create(),tileMat3:n.create(),tileUnitsToPixels:n.create()}};e._destroyRenderBuckets=function(u){if(u){var p=new Set;u.forEach(h=>{p.has(h)||(h.destroy(),p.add(h))});u.clear()}};d._createRenderBuckets=function(u){const p=new Map,h=new Map;for(const r of u){u=this._deserializeBucket(r,h);for(const q of u.layerUIDs)p.set(q,u)}return p};d._deserializeBucket=function(u,p){let h=p.get(u);if(h)return h;
switch((new Uint32Array(u))[0]){case x.BucketType.FILL:h=new m.FillRenderBucket(u,this.styleRepository);break;case x.BucketType.LINE:h=new m.LineRenderBucket(u,this.styleRepository);break;case x.BucketType.SYMBOL:h=new m.SymbolRenderBucket(u,this.styleRepository,this);break;case x.BucketType.CIRCLE:h=new m.CircleRenderBucket(u,this.styleRepository)}p.set(u,h);return h};d._deleteLayerData=function(u){if(this.layerData.has(u)){var p=this.layerData.get(u);this._memoryUsedByLayerData-=p.memoryUsed;p.destroy();
this.layerData.delete(u);this.layerCount--}};b._createClass(e,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<l.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<l.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||
"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return e}(g.TiledDisplayObject);const f=new Map;a.VectorTile=g;a.printAllocations=function(){f.forEach((d,e)=>{console.log(`\n${e.key}:`);d[0].forEach(k=>console.log(k));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");d[1].forEach(k=>console.log(k))})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType=
{}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,w,n,x,m,l){let g=function(){function u(h,r){this.layerUIDs=[];this.isDestroyed=!1;this._data=h;this.memoryUsed=h.byteLength;let q=1;h=new Uint32Array(h);this.layerUIDs=[];const y=h[q++];for(let B=0;B<y;B++)this.layerUIDs[B]=h[q++];this.bufferDataOffset=q;r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}var p=u.prototype;p.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};p.prepareForRendering=function(h){c.isNone(this._data)||(this.doPrepareForRendering(h,
this._data,this.bufferDataOffset),this._data=null)};b._createClass(u,[{key:"isPreparedForRendering",get:function(){return c.isNone(this._data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return u}(),f=function(u){function p(r,q){q=h.call(this,r,q);q.type=w.BucketType.LINE;q.lineIndexStart=0;q.lineIndexCount=0;r=new Uint32Array(r);let y=q.bufferDataOffset;q.lineIndexStart=r[y++];q.lineIndexCount=r[y++];const B=r[y++];if(0<B){const D=new Map;for(let z=0;z<B;z++){const v=r[y++],A=
r[y++],t=r[y++];D.set(v,[A,t])}q.patternMap=D}q.bufferDataOffset=y;return q}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.hasData=function(){return 0<this.lineIndexCount};u.triangleCount=function(){return this.lineIndexCount/3};u.doDestroy=function(){c.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();c.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();c.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=
this.lineVertexArrayObject=null;this.memoryUsed=0};u.doPrepareForRendering=function(r,q,y){q=new Uint32Array(q);var B=new Int32Array(q.buffer);const D=q[y++];this.lineVertexBuffer=x.BufferObject.createVertex(r,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,D));y+=D;B=q[y++];this.lineIndexBuffer=x.BufferObject.createIndex(r,m.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*y,B));y+=B;y=this.layer.lineMaterial;this.lineVertexArrayObject=new l.VertexArrayObject(r,y.getAttributeLocations(),y.getLayoutInfo(),
{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return b._createClass(p)}(g),d=function(u){function p(r,q){q=h.call(this,r,q);q.type=w.BucketType.FILL;q.fillIndexStart=0;q.fillIndexCount=0;q.outlineIndexStart=0;q.outlineIndexCount=0;r=new Uint32Array(r);let y=q.bufferDataOffset;q.fillIndexStart=r[y++];q.fillIndexCount=r[y++];q.outlineIndexStart=r[y++];q.outlineIndexCount=r[y++];const B=r[y++];if(0<B){const D=new Map;for(let z=0;z<B;z++){const v=r[y++],A=r[y++],t=r[y++];D.set(v,[A,t])}q.patternMap=
D}q.bufferDataOffset=y;return q}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};u.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};u.doDestroy=function(){c.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();c.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();c.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=
this.fillVertexArrayObject=null;c.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();c.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();c.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};u.doPrepareForRendering=function(r,q,y){q=new Uint32Array(q);var B=new Int32Array(q.buffer),D=q[y++];this.fillVertexBuffer=x.BufferObject.createVertex(r,
m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,D));y+=D;D=q[y++];this.fillIndexBuffer=x.BufferObject.createIndex(r,m.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*y,D));y+=D;D=q[y++];this.outlineVertexBuffer=x.BufferObject.createVertex(r,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,D));y+=D;B=q[y++];this.outlineIndexBuffer=x.BufferObject.createIndex(r,m.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*y,B));y+=B;q=this.layer;y=q.fillMaterial;q=q.outlineMaterial;this.fillVertexArrayObject=new l.VertexArrayObject(r,
y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new l.VertexArrayObject(r,q.getAttributeLocations(),q.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return b._createClass(p)}(g),e=function(u){function p(r,q,y){q=h.call(this,r,q);q.type=w.BucketType.SYMBOL;q.iconPerPageElementsMap=new Map;q.glyphPerPageElementsMap=new Map;q.symbolInstances=[];q.isIconSDF=!1;q.opacityChanged=!1;q.lastOpacityUpdate=
0;q.symbols=[];const B=new Uint32Array(r),D=new Int32Array(r);r=new Float32Array(r);let z=q.bufferDataOffset;q.isIconSDF=!!B[z++];var v=B[z++];for(var A=0;A<v;A++){var t=B[z++],C=B[z++],E=B[z++];q.iconPerPageElementsMap.set(t,[C,E])}v=B[z++];for(A=0;A<v;A++)t=B[z++],C=B[z++],E=B[z++],q.glyphPerPageElementsMap.set(t,[C,E]);v=B[z++];A=B[z++];q.iconOpacity=new Int32Array(v);q.textOpacity=new Int32Array(A);z=n.deserializeSymbols(B,D,r,z,q.symbols,y);q.bufferDataOffset=z;return q}b._inherits(p,u);var h=
b._createSuper(p);u=p.prototype;u.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};u.triangleCount=function(){let r=0;for(const [,q]of this.iconPerPageElementsMap)r+=q[1];for(const [,q]of this.glyphPerPageElementsMap)r+=q[1];return r/3};u.doDestroy=function(){c.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();c.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();c.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();
c.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;c.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();c.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();c.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();c.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=
null;this.memoryUsed=0};u.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var r=c.unwrap(this.iconOpacity),q=c.unwrap(this.iconOpacityBuffer);0<r.length&&r.byteLength===q.size&&q.setSubData(r,0,0,r.length);r=c.unwrap(this.textOpacity);q=c.unwrap(this.textOpacityBuffer);0<r.length&&r.byteLength===q.size&&q.setSubData(r,0,0,r.length)}};u.doPrepareForRendering=function(r,q,y){q=new Uint32Array(q);var B=new Int32Array(q.buffer),D=q[y++];this.iconVertexBuffer=x.BufferObject.createVertex(r,
m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,D));y+=D;D=q[y++];this.iconIndexBuffer=x.BufferObject.createIndex(r,m.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*y,D));y+=D;D=q[y++];this.textVertexBuffer=x.BufferObject.createVertex(r,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,D));y+=D;B=q[y++];this.textIndexBuffer=x.BufferObject.createIndex(r,m.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*y,B));y+=B;this.iconOpacityBuffer=x.BufferObject.createVertex(r,m.Usage.STATIC_DRAW,c.unwrap(this.iconOpacity).buffer);
this.textOpacityBuffer=x.BufferObject.createVertex(r,m.Usage.STATIC_DRAW,c.unwrap(this.textOpacity).buffer);q=this.layer;y=q.iconMaterial;q=q.textMaterial;this.iconVertexArrayObject=new l.VertexArrayObject(r,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new l.VertexArrayObject(r,q.getAttributeLocations(),q.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};
return b._createClass(p)}(g),k=function(u){function p(r,q){q=h.call(this,r,q);q.type=w.BucketType.CIRCLE;q.circleIndexStart=0;q.circleIndexCount=0;r=new Uint32Array(r);let y=q.bufferDataOffset;q.circleIndexStart=r[y++];q.circleIndexCount=r[y++];q.bufferDataOffset=y;return q}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.hasData=function(){return 0<this.circleIndexCount};u.triangleCount=function(){return this.circleIndexCount/3};u.doDestroy=function(){c.isSome(this.circleVertexArrayObject)&&
this.circleVertexArrayObject.dispose();c.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();c.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};u.doPrepareForRendering=function(r,q,y){q=new Uint32Array(q);var B=new Int32Array(q.buffer);const D=q[y++];this.circleVertexBuffer=x.BufferObject.createVertex(r,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,D));y+=D;B=q[y++];
this.circleIndexBuffer=x.BufferObject.createIndex(r,m.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*y,B));y+=B;y=this.layer.circleMaterial;this.circleVertexArrayObject=new l.VertexArrayObject(r,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return b._createClass(p)}(g);a.CircleRenderBucket=k;a.FillRenderBucket=d;a.LineRenderBucket=f;a.RenderBucketBase=g;a.SymbolRenderBucket=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../enums","./core"],function(a,b,c,w){let n=function(){function x(l,g,f){this._rows=Math.ceil(g/f);this._columns=Math.ceil(l/f);this._cellSize=f;this.cells=Array(this._rows);for(l=0;l<this._rows;l++)for(this.cells[l]=Array(this._columns),g=0;g<this._columns;g++)this.cells[l][g]=[]}var m=x.prototype;m.getCell=function(l,g){g=Math.min(Math.max(Math.floor(g/this._cellSize),0),this._rows-1);l=Math.min(Math.max(Math.floor(l/this._cellSize),0),this._columns-
1);return this.cells[g]&&this.cells[g][l]||null};m.getCellSpan=function(l,g,f,d){return[Math.min(Math.max(Math.floor(l/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1)]};b._createClass(x,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);
return x}();a.GridIndex=n;a.deserializeSymbols=function(x,m,l,g,f,d){const e=m[g++];for(let p=0;p<e;p++){const h=new w.VTLSymbol(d);h.xTile=m[g++];h.yTile=m[g++];h.hash=m[g++];h.priority=m[g++];var k=m[g++];for(var u=0;u<k;u++){const r=m[g++],q=m[g++],y=m[g++],B=m[g++],D=!!m[g++],z=m[g++],v=l[g++],A=l[g++],t=m[g++],C=m[g++];h.colliders.push({xTile:r,yTile:q,dxPixels:y,dyPixels:B,hard:D,partIndex:z,width:t,height:C,minLod:v,maxLod:A})}k=x[g++];for(u=0;u<k;u++)h.textVertexRanges.push([x[g++],x[g++]]);
k=x[g++];for(u=0;u<k;u++)h.iconVertexRanges.push([x[g++],x[g++]]);f.push(h)}return g};a.tileCoordChange=function(x,m,l,g,f,d){l-=f;if(0<=l)return(m>>l)+(g-(d<<l))*(x>>l);l=-l;return m-(d-(g<<l))*(x>>l)<<l};a.writeOpacityToBuffers=function(x,m,l){for(const [p,h]of x.symbols){{var g=x,f=m,d=l,e=h;const r=g.layerData.get(p);if(r.type===c.BucketType.SYMBOL){for(const q of e){e=q.unique;var k=void 0;if(q.selectedForRendering){var u=e.parts[0];k=u.startOpacity;u=u.targetOpacity;g.allSymbolsFadingOut=g.allSymbolsFadingOut&&
0===u;k=d?Math.floor(127*k)|u<<7:u?255:0;k|=k<<24|k<<16|k<<8}else k=0;for(const [y,B]of q.iconVertexRanges)for(u=y;u<y+B;u+=4)r.iconOpacity[u/4]=k;q.selectedForRendering?(k=e.parts[1],e=k.startOpacity,k=k.targetOpacity,g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===k,e=d?Math.floor(127*e)|k<<7:k?255:0,k=e<<24|e<<16|e<<8|e):k=0;for(const [y,B]of q.textVertexRanges)for(e=y;e<y+B;e+=4)r.textOpacity[e/4]=k}r.lastOpacityUpdate=f;r.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(w){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=w});b=b._createClass(function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1});a.VTLSymbol=
c;a.VTLUniqueSymbol=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject",
"../../tiling/TileKey"],function(a,b,c,w,n){w=function(x){function m(g,f,d,e,k,u,p=k,h=u){var r=l.call(this);r.triangleCountReportedInDebug=0;r.triangleCount=0;r.texture=null;r.key=new n(g);r.resolution=f;r.x=d;r.y=e;r.width=k;r.height=u;r.rangeX=p;r.rangeY=h;return r}b._inherits(m,x);var l=b._createSuper(m);x=m.prototype;x.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};x.setTransform=function(g){const f=this.resolution/(g.resolution*g.pixelRatio),d=this.transforms.tileMat3,
[e,k]=g.toScreenNoRotation([0,0],[this.x,this.y]);c.set(d,this.width/this.rangeX*f,0,0,0,this.height/this.rangeY*f,0,e,k,1);c.multiply(this.transforms.dvs,g.displayViewMat3,d)};return b._createClass(m)}(w.DisplayObject);a.TiledDisplayObject=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),
function(a,b,c,w,n,x){const m=1/w("mapview-transitions-duration");c=function(l){function g(){var d=f.apply(this,arguments);d._fadeOutResolver=null;d._fadeInResolver=null;d._clips=null;d.computedVisible=!0;d.computedOpacity=1;d.fadeTransitionEnabled=!1;d.inFadeTransition=!1;d._isReady=!1;d._opacity=1;d.parent=null;d._stage=null;d._visible=!0;return d}b._inherits(g,l);var f=b._createSuper(g);l=g.prototype;l._getTransforms=function(){n.isNone(this._transforms)&&(this._transforms=this._createTransforms());
return this._transforms};l.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=x.createResolver();this.requestRender();return this._fadeInResolver.promise};l.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=
null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=x.createResolver();this.requestRender();return this._fadeOutResolver.promise};l.endTransitions=function(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()};l.beforeRender=function(d){this.updateTransitionProperties(d.deltaTime,d.state.scale)};l.afterRender=function(d){this._fadeInResolver&&this.computedOpacity===this.opacity?
(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};l.remove=function(){this.parent?.removeChild(this)};l.setTransform=function(d){};l.processRender=function(d){this.stage&&this.computedVisible&&this.doRender(d)};l.requestRender=function(){this.stage&&this.stage.requestRender()};l.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&
(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};l.updateTransitionProperties=function(d,e){if(this.fadeTransitionEnabled){e=this._fadeOutResolver||!this.visible?0:this.opacity;const k=this.computedOpacity;k===e?this.computedVisible=this.visible:(d*=m,this.computedOpacity=k>e?Math.max(e,k-d):Math.min(e,k+d),this.computedVisible=0<this.computedOpacity,d=e===this.computedOpacity,this.inFadeTransition=!d,d||this.requestRender())}else this.computedOpacity=this.opacity,
this.computedVisible=this.visible};l.onAttach=function(){};l.onDetach=function(){};l.doRender=function(d){};l.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(g,[{key:"clips",get:function(){return this._clips},set:function(d){this._clips=d;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(d){this._opacity!==d&&(this._opacity=Math.min(1,Math.max(d,0)),
this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(d){if(this._stage!==d){var e=this._stage;(this._stage=d)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(d){this._visible!==d&&(this._visible=d,this.requestRender())}}]);return g}(c);a.DisplayObject=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function w(x,m,l,g){this.set(x,m,l,g)}w.getId=function(x,m,l,g){return"object"===typeof x?`${x.level}/${x.row}/${x.col}/${x.world}`:`${x}/${m}/${l}/${g}`};var n=w.prototype;n.acquire=function(x,m,l,g){this.set(x,m,l,g)};n.contains=function(x){const m=x.level-this.level;return 0<=m&&this.row===x.row>>m&&this.col===
x.col>>m&&this.world===x.world};n.equals=function(x){return this.level===x.level&&this.row===x.row&&this.col===x.col&&this.world===x.world};n.clone=function(){return new w(this)};n.release=function(){this.world=this.col=this.row=this.level=0};n.set=function(x,m,l,g){if(null==x)this.world=this.col=this.row=this.level=0;else if("object"===typeof x)this.level=x.level||0,this.row=x.row||0,this.col=x.col||0,this.world=x.world||0;else if("string"===typeof x){const [f,d,e,k]=x.split("/");this.level=parseFloat(f);
this.row=parseFloat(d);this.col=parseFloat(e);this.world=parseFloat(k)}else this.level=+x,this.row=+m,this.col=+l,this.world=+g||0;return this};n.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};n.getParentKey=function(){return 0>=this.level?null:new w(this.level-1,this.row>>1,this.col>>1,this.world)};n.getChildKeys=function(){const x=this.level+1,m=this.row<<1,l=this.col<<1,g=this.world;return[new w(x,m,l,g),new w(x,m,l+1,g),new w(x,m+1,l,g),new w(x,m+1,l+1,g)]};n.compareRowMajor=
function(x){return this.row<x.row?-1:this.row>x.row?1:this.col<x.col?-1:this.col>x.col?1:0};a._createClass(w,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(x){this.set(x)}},{key:"hash",get:function(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return w}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,
value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(n=0,x=0){this.min=n;this.max=x;this.level=0;this.hasNoDataValues=!1}w.prototype.copyFrom=function(n){this.min=n.min;this.max=n.max;this.level=n.level;this.hasNoDataValues=
n.hasNoDataValues};return b._createClass(w)}();a.ElevationBounds=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../layers/support/ElevationSamplerData ../support/mathUtils ./TerrainConst".split(" "),function(a,b,c,w,n,x,m){let l=function(){function f(d,e,k){this.type="elevation";this.level=d[0];this.i=d[1];this.j=d[2];this.extent=
e;this.samplerData=new n.ElevationSamplerData(k,e)}f.prototype.computeMinMaxValue=function(d,e,k,u){u.min=Infinity;u.max=-Infinity;u.hasNoDataValues=!1;d-=this.level;if(0>=d)return u;var p=2**d;if(Math.floor(e/p)!==this.i||Math.floor(k/p)!==this.j)return u;var h=Infinity,r=-Infinity,q=this.samplerData.data.width,y=this.samplerData.data.values,B=.5*m.ELEVATION_NODATA_VALUE;d=(q-1)/p;k=(k-this.j*p)*d;let D=(e-this.i*p)*d;if(1>d){const A=Math.floor(k),t=Math.floor(D);var z=A+t*q;e=y[z];p=y[z+1];var v=
y[z+q];z=y[z+q+1];if(e+p+v+z<B)return h=k-A,B=D-t,r=x.bilerp(e,p,v,z,h,B),q=x.bilerp(e,p,v,z,h+d,B),y=x.bilerp(e,p,v,z,h,B+d),d=x.bilerp(e,p,v,z,h+d,B+d),u.min=Math.min(r,q,y,d),u.max=Math.max(r,q,y,d),u;k=A;D=t;d=1}else k=Math.floor(k),D=Math.floor(D),d=Math.ceil(d);for(e=k;e<=k+d;e++)for(p=D;p<=D+d;p++)v=y[e+p*q],v<B?(h=Math.min(h,v),r=Math.max(r,v)):u.hasNoDataValues=!0;u.min=h;u.max=r;return u};return b._createClass(f)}();const g=.5*m.ELEVATION_NODATA_VALUE;a.ElevationData=l;a.sampleElevation=
function(f,d,e){if(w.isNone(e))return null;for(const r of e){if(!r)continue;var k=r.safeWidth;e=c.clamp(r.dy*(r.y1-d),0,k);k=c.clamp(r.dx*(f-r.x0),0,k);const q=Math.floor(e),y=Math.floor(k);var u=r.data.width,p=q*u+y,h=r.data.values;const B=h[p],D=h[p+1];p+=u;u=h[p];h=h[p+1];if(B+u+D+h<g)return e-=q,k-=y,f=B+(D-B)*k,f+(u+(h-u)*k-f)*e}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(a,b){b=b._createClass(function(c,w){this.data=c;this.safeWidth=.99999999*(c.width-1);this.dx=(c.width-1)/(w[2]-w[0]);this.dy=(c.width-1)/(w[3]-w[1]);this.x0=w[0];this.y1=w[3]});a.ElevationSamplerData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(B,D){return n.isSome(B)&&!B.spatialReference.equals(D)?d.projectWithoutEngine(B,B.spatialReference,D):B}a.ExtentHelper=function(B){function D(v){return z.call(this,v)}b._inherits(D,B);var z=b._createSuper(D);B=D.prototype;B.initialize=function(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};B.destroy=function(){};B._computeStencilEnabledExtents=function(){const v=[];this.layerViews.forEach(A=>{A=
A.layer;"IntegratedMeshLayer"===A.operationalLayerType&&null!=this.viewSpatialReference&&(A=r(A.fullExtent,this.viewSpatialReference),n.isSome(A)&&v.push(e.fromExtent(A)))});return v};b._createClass(D,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);return D}(w);c.__decorate([x.property({readOnly:!0})],
a.ExtentHelper.prototype,"layerViewsExtent",null);c.__decorate([x.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([x.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([x.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([x.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([x.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);c.__decorate([x.property({constructOnly:!0})],
a.ExtentHelper.prototype,"layers",void 0);c.__decorate([x.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([f.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let q=function(B){function D(){return z.apply(this,arguments)}b._inherits(D,B);var z=b._createSuper(D);B=D.prototype;B._computeLayerViewsExtent=function(){return this._globalExtent};B._computeTiledLayersExtent=function(){return this._globalExtent};b._createClass(D,[{key:"_globalExtent",
get:function(){return this.viewSpatialReference.isWebMercator?p.WEBMERCATOR_WORLD_EXTENT:p.GEOGRAPHIC_WORLD_EXTENT}}]);return D}(a.ExtentHelper);q=c.__decorate([f.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],q);let y=function(B){function D(){return z.apply(this,arguments)}b._inherits(D,B);var z=b._createSuper(D);B=D.prototype;B._computeLayerViewsExtent=function(){const v=e.empty(),A=this.viewSpatialReference;this.layerViews.forEach(E=>{const F=E.layer;!E.isResolved()||"graphics"===F.type&&
F.internal||(E=r("fullExtentInLocalViewSpatialReference"in E&&E.fullExtentInLocalViewSpatialReference||E.layer.fullExtent,A),e.expand(v,E,v))});const t=e.allFinite(v)?v:null,C=this._get("layerViewsExtent");return e.equals(t,C)?C:t};B._computeTiledLayersExtent=function(){const v=this.tilingScheme;if(!v)return null;const A=this.viewSpatialReference,t=e.empty();this.layers.forEach(F=>{if(F.loaded&&k.isTiledLayer(F)){const I=h.getTiledLayerInfo(F,A,u.ViewingMode.Local);if(!n.isNone(I)){var {tileInfo:H,
fullExtent:K}=I;n.isSome(H)&&n.isSome(K)&&(h.isProjectableRasterLayer(F)||v.compatibleWith(H)&&K.spatialReference.equals(v.spatialReference))&&e.expand(t,K,t)}}});e.expand(t,this.defaultTiledLayersExtent,t);const C=e.allFinite(t)?t:null,E=this._get("tiledLayersExtent");return e.equals(C,E)?E:C};return b._createClass(D)}(a.ExtentHelper);y=c.__decorate([f.subclass("esri.views.3d.terrain.ExtentHelperLocal")],y);a.create=function(B,D){return B===u.ViewingMode.Global?new q(D):new y(D)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U){const N=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S;a.OverlayManager=function(aa){function ia(ba){ba=na.call(this,ba);ba._handles=new x;ba._spatialReference=null;ba._renderSR=null;ba._overlaySREqualsRenderSR=!0;ba._drapeSources=new Set;ba._drapeTargets=new Set;ba._placementDirty=!1;ba._contentUpdated=!1;ba._drawTexturesDirty=
!1;ba._drawTexturesAnimateDirty=!1;ba._hasUnusedRenderTargets=!1;ba._longitudeCyclical=null;ba._latestOriginId=0;ba._maxResolution=m("esri-mobile")?2048:4096;ba._animationTimeLast=0;ba._removeRenderOverlayCallback=()=>{};return ba}b._inherits(ia,aa);var na=b._createSuper(ia);aa=ia.prototype;aa.initialize=function(){const ba=this.view;this.renderer=new L.OverlayRenderer({view:ba,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=O.newIntersector(this.view.state.viewingMode);
this._groundIntersector.options.backfacesTerrain=!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ja=>ba._stage?.renderer.setParameters({hasOverlayWater:ja})),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),f.watch(()=>[ba.pointsOfInterest?.renderPointOfView,ba.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),f.watch(()=>[ba.state?.pixelRatio,ba.state?.contentPixelRatio],()=>this.setPlacementDirty(),f.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ba.on("resize",()=>this.setPlacementDirty()),ba.resourceController.scheduler.registerTask(U.TaskPriority.OVERLAY,
this),ba._stage.renderView.events.on("force-camera-for-screenshot",ja=>{this._updateOverlays(U.noBudget,ja,R.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,R.RenderRequestType.BACKGROUND,ja.pixelRatio)})]);let ea=ja=>this._renderOverlayCallback(ja);this._removeRenderOverlayCallback=()=>{ea=()=>{}};ba._stage?.renderer.setParameters({renderOverlay:ja=>ea(ja)})};aa._renderOverlayCallback=function(ba){this._contentUpdated=!1;const ea=this.renderer;
ea.processSyncDrapeSources();ea.hasOverlays&&(this._dispatchAnimationUpdate(ba),this._drawOverlayTextures(ea.overlays,R.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()};aa.destroy=function(){this._handles=g.destroyMaybe(this._handles);this._removeRenderOverlayCallback();this.view?._stage?.renderer.setParameters({renderOverlay:()=>{}});g.isSome(S)&&(S.hide(),S=null)};aa.setSpatialReference=function(ba){this._spatialReference=ba;this.renderer.spatialReference=
ba;this._longitudeCyclical=null;const ea=this.view.renderSpatialReference;g.isSome(ba)&&g.isSome(ea)?(this._renderSR=ea,this._overlaySREqualsRenderSR=ba.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=ba.isWebMercator?new n.Cyclical(-2.0037508342787E7,2.0037508342787E7):new n.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};aa.registerDrapeSource=function(ba,
ea,ja){this._drapeSources.add(ba);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ea=this.renderer.createDrapeSourceRenderer(ba,ea,ja);this._updateDrapeSourceExtent(ba);this._setContentDirty();this.notifyChange("running");return ea};aa.registerGeometryDrapeSource=function(ba){return this.registerDrapeSource(ba,G.SortedRenderGeometryRenderer)};aa._updateDrapeSourceExtent=function(ba){2===this.renderer.overlays.length&&g.isSome(ba.setDrapingExtent)&&g.isSome(this._spatialReference)&&
ba.setDrapingExtent(this.renderer.overlays,this._spatialReference)};aa.unregisterDrapeSource=function(ba){this._drapeSources.has(ba)&&(this._drapeSources.delete(ba),this.renderer.removeDrapeSourceRenderer(ba),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};aa.registerDrapeTarget=function(ba){this._drapeTargets.add(ba);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};aa.updateOverlayResult=function(){this.view._stage?.renderer.setParameters({overlays:this.renderer.overlays})};
aa.unregisterDrapeTarget=function(ba){this._drapeTargets.delete(ba);this.renderer.ensureDrapeTargets(this._drapeTargets)};aa._setContentDirty=function(){this.setPlacementDirty();this.setDrawTexturesDirty()};aa.setPlacementDirty=function(){this._placementDirty=!0};aa.runTask=function(ba){return this._updateOverlays(ba,this.view.state.contentCamera,R.RenderRequestType.UPDATE)};aa._updateOverlays=function(ba,ea,ja){if(!this._spatialReference)return U.Task.YIELD;var ka=this._computeOverlayResolution(ea);
this._computeOverlayExtents(ea,ka,V);const da=v.width(V.inner)/v.width(V.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ea=this._updateOverlay(I.OverlayIndex.INNER,V.inner,ka,1*V.pixelRatioAdjustment,V.mapUnitsPerPixel);ka=this._updateOverlay(I.OverlayIndex.OUTER,V.outer,ka,da*V.pixelRatioAdjustment,V.mapUnitsPerPixel);if(ea===Y.EXTENT||ka===Y.EXTENT)this._drapeSources.forEach(ha=>this._updateDrapeSourceExtent(ha)),this.surface.updateTileOverlayParams(ja);ea===Y.NONE&&
ka===Y.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;ba.madeProgress()};aa._computeOverlayResolution=function(ba){const ea=this.view.state.contentPixelRatio;return Math.min(l.nextHighestPowerOfTwo(Math.max(ba.fullWidth/ba.pixelRatio*ea,ba.fullHeight/ba.pixelRatio*ea)+256),this._maxResolution)};aa._updateOverlay=function(ba,ea,ja,ka,da){if(0===this.renderer.overlays.length)return Y.NONE;ba=this.renderer.overlays[ba];const ha=ba.mapUnitsPerPixel;ba.mapUnitsPerPixel=da;ba.pixelRatio=ka;ka=
ba.extent;const ca=H.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ea[2]-ea[0],ea[3]-ea[1],ka[2]-ka[0],ka[3]-ka[1]);if(Math.abs(ka[0]-ea[0])<=ca&&Math.abs(ka[1]-ea[1])<=ca&&Math.abs(ka[2]-ea[2])<=ca&&Math.abs(ka[3]-ea[3])<=ca&&ja===ba.resolution)return ha===da?Y.NONE:Y.RERENDER_ONLY;v.copy(ba.extent,ea);ba.resolution=ja;ea=v.center(ba.extent);ba.renderLocalOrigin=J.fromValues(ea[0],ea[1],0,`OV_${this._latestOriginId++}`);return Y.EXTENT};aa.setTileParameters=function(ba){const ea=ba.renderData.overlay;
if(0<this.renderer.overlays.length){const ja=this.renderer.overlays[I.OverlayIndex.INNER],ka=this.renderer.overlays[I.OverlayIndex.OUTER];ba=ba.extent;this._rectInsideRect(ja.extent,ba)||this._rectanglesOverlap(ba,ja.extent)||this._rectanglesOverlap(ba,ka.extent)?(this._setTileOverlayData(ba,I.OverlayIndex.INNER,ea),this._setTileOverlayData(ba,I.OverlayIndex.OUTER,ea)):(this._clearTileOverlayData(I.OverlayIndex.INNER,ea),this._clearTileOverlayData(I.OverlayIndex.OUTER,ea))}else this._clearTileOverlayData(I.OverlayIndex.INNER,
ea),this._clearTileOverlayData(I.OverlayIndex.OUTER,ea)};aa.overlayPixelSizeInMapUnits=function(ba){if(0===this.renderer.overlays.length)return 0;const ea=this.renderer.overlays[I.OverlayIndex.INNER],ja=this.renderer.overlays[I.OverlayIndex.OUTER];ba=this._pointIsInExtent(ba,ea.extent)?ea:ja;return(ba.extent[2]-ba.extent[0])/ba.resolution};aa._setTileOverlayData=function(ba,ea,ja){if(0!==this.renderer.overlays.length){var ka=this.renderer.overlays[ea].extent,da=v.width(ka),ha=v.height(ka),ca=ba[0];
if(this._longitudeCyclical){ca=this._longitudeCyclical.minimalMonotonic(ka[0],ca);const fa=this._longitudeCyclical.minimalMonotonic(ka[0],ba[2]);ca>fa&&(ca=fa-(ba[2]-ba[0]))}ja.setScale(ea,v.width(ba)/da,v.height(ba)/ha);ja.setOffset(ea,(ca-ka[0])/da,(ba[1]-ka[1])/ha)}};aa._clearTileOverlayData=function(ba,ea){ea.setScale(ba,-1,-1);ea.setOffset(ba,-1,-1)};aa.reloadShaders=async function(){P.removeLoadedShaderModules();await this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask(U.noBudget)};
aa._dispatchAnimationUpdate=function(ba){var ea=d.Milliseconds(ba-this._animationTimeLast);if(ea>=this.surface.view._stage.renderer.animationTimestep||g.isSome(this.view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)ea=d.Milliseconds(ea/this.surface.view._stage.renderer.animationTimeDilation),ea=new M.UpdateParameters(this.view.state.camera,ea,this.view.state.forcedAnimationTime),this.renderer.updateAnimation(ea)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=
ba};aa.setDrawTexturesDirty=function(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()};aa._intersectGroundFromView=function(ba,ea,ja,ka){ja=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ba,Z,ea,ja);if(g.isNone(ja))return!1;ea=ja.origin;ja=r.add(W,ja.origin,ja.direction);this._groundIntersector.reset(ea,ja,ba);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,
null,ea,ja);return this._groundIntersector.results.min.getIntersectionPoint(ka)};aa._findHorizonBasedPointOfInterest=function(ba,ea){var ja=.5;ja=this.view.renderCoordsHelper.getAltitude(ba.eye);const ka=this.view.pointsOfInterest.centerOnSurfaceFrequent;var da=l.clamp(ka.estimatedSurfaceAltitude,ba.aboveGround?-Infinity:ja+1E-5,ba.aboveGround?ja-1E-5:Infinity);ja=ba.aboveGround;if("global"===this.view.viewingMode){var ha=W;t.closestPointOnSilhouette(t.fromRadius(t.tmpSphere,D.getReferenceEllipsoid(this.view.spatialReference).radius+
da),A.wrap(ba.eye,ba.viewForward),ha);r.subtract(ha,ha,ba.eye);da=n.cyclicalPI.normalize(C.angleAroundAxis(ba.viewForward,ha,ba.viewRight))/ba.fovY+.5;ha=0>=da||1<=da?.5:.55;ja=ja?ha*da:da+ha*(1-da)}else da=B.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ba.viewForward[2])),1,0),da=y.transformMat4(da,da,ba.projectionMatrix)[1],da=l.clamp(.5+.5*da,0,1),ja=1===da||0===da?.5:ja?.55*da:1-.55*(1-da);return this._intersectGroundFromView(ba,.5,ja,ea)?r.sqrDist(ea,ba.eye)<ka.distance*ka.distance:!1};aa._computeOverlayExtents=
function(ba,ea,ja){var ka=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,da=q.create();this._findHorizonBasedPointOfInterest(ba,da)||r.copy(da,ka);var ha=Math.max(.1,r.distance(ba.eye,da));ka=F.viewAngle(this.view.renderCoordsHelper,ka,ba.eye);const ca=Math.PI/2-Math.abs(ka-Math.PI/2);H.OVERLAY_SHOW_CENTER?(g.isNone(S)&&(S=new K.PointGraphics(this.view.graphics,"red")),S.show(da,this._renderSR)):g.isSome(S)&&S.hide();this._overlaySREqualsRenderSR||z.projectVectorToVector(da,this._renderSR,
da,this._spatialReference);ka=this.surface.extent;var fa=!this._isSpherical&&g.isSome(this._spatialReference)&&this._spatialReference.isGeographic,ma=fa&&g.isSome(this._spatialReference)?1/D.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ha=ba.perScreenPixelRatio/this.view.state.contentPixelRatio*ha*ma;ja.mapUnitsPerPixel=ha/this._worldToPCSRatio;ha=ea*ha/2;var qa=!1;fa=fa?90:Infinity;this._isSpherical&&g.isSome(ka)&&g.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?
(ha/=Math.cos(E.y2lat(da[1])),fa=ka[3]):(qa=!0,ha/=D.getReferenceEllipsoid(this._spatialReference).metersPerDegree,fa=90),ha>=fa&&(ha=fa,da[1]=0,this._spatialReference.isWebMercator&&(da[0]=0)));ma=1;qa&&(ma=1/Math.max(.2,Math.cos(Math.abs(l.deg2rad(da[1])))),180<ha*ma&&(ma=180/ha),ja.mapUnitsPerPixel*=ma);qa=Math.log(2)/12;ha=Math.exp(Math.round(Math.log(ha)/qa)*qa);const wa=ha*ma;qa=.5*ea/(32*wa);var xa=.5*ea/(32*ha);da[0]=Math.round(da[0]*qa)/qa;da[1]=Math.round(da[1]*xa)/xa;qa=ja.inner;qa[0]=
da[0]-wa;qa[1]=da[1]-ha;qa[2]=da[0]+wa;qa[3]=da[1]+ha;this._isSpherical&&this._shiftExtentToFitBounds(qa,Infinity,fa);xa=ja.outer;6*wa>v.width(ka)?v.copy(xa,g.unwrap(ka)):ca<=.25*Math.PI?(xa[0]=qa[0]-wa,xa[1]=qa[1]-ha,xa[2]=qa[2]+wa,xa[3]=qa[3]+ha):(z.projectVectorToVector(ba.eye,this._renderSR,W,this._spatialReference),h.subtract(Q,da,W),ba=-Math.atan2(Q[1],Q[0])+.125*Math.PI,0>ba&&(ba+=2*Math.PI),y.scale(Q,N[Math.floor(ba/(.25*Math.PI))],2*ha),Q[0]*=ma,Q[2]*=ma,y.add(xa,qa,Q));this._isSpherical?
(xa[0]=this._longitudeCyclical.clamp(xa[0]),xa[2]=this._longitudeCyclical.clamp(xa[2]),xa[1]=Math.max(xa[1],-fa),xa[3]=Math.min(xa[3],fa)):(ba=v.intersection(qa,ka,T),da=v.intersection(xa,ka,X),v.contains(ba,da)&&(xa[2]=xa[0],xa[3]=xa[1]));ea=Math.abs(qa[2]-qa[0])/ea;ja.mapUnitsPerPixel=Math.max(ja.mapUnitsPerPixel,ea);ja.pixelRatioAdjustment=ja.mapUnitsPerPixel/ea};aa._drawOverlayTextures=function(ba,ea,ja=this.view.state.contentPixelRatio){if(0!==ba.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var ka=
this._drawTexturesDirty;this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1;var da=this._drawOverlay(ba[I.OverlayIndex.INNER],ja);ba=this._drawOverlay(ba[I.OverlayIndex.OUTER],ja);da!==R.ValidationState.CHANGED&&ba!==R.ValidationState.CHANGED||this.surface.updateTileOverlayParams(R.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateOverlayResult();ka?(this.surface.requestRender(ea),ea===R.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(R.RenderRequestType.BACKGROUND)}};
aa._drawOverlay=function(ba,ea){this._longitudeCyclical?ba.setupGeometryViewsCyclical(this._longitudeCyclical):ba.setupGeometryViewsDirect();return ba.draw(this.renderer,ea)};aa._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ba=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(ba)}};aa._rectanglesOverlap=function(ba,ea){return g.isNone(ba)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ea[0],
ea[2],ba[0])||this._longitudeCyclical.contains(ea[0],ea[2],ba[2])||this._longitudeCyclical.contains(ba[0],ba[2],ea[0]))&&!(ba[1]>ea[3]||ba[3]<ea[1]):v.intersects(ba,ea)};aa._rectInsideRect=function(ba,ea){return g.isNone(ea)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ba[0],ba[2],ea[0])&&this._longitudeCyclical.contains(ba[0],ba[2],ea[2])&&ea[1]>ba[1]&&ea[3]<ba[3]:v.contains(ba,ea)};aa._pointIsInExtent=function(ba,ea){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ea[0],
ea[2],ba.x)&&ba.y>=ea[1]&&ba.y<=ea[3];const ja=ba.x;ba=ba.y;return ja>ea[0]&&ja<ea[2]&&ba>ea[1]&&ba<ea[3]};aa._shiftExtentToFitBounds=function(ba,ea,ja){let ka=0,da=0;ba[0]<-ea?ka=ba[0]+ea:ba[2]>ea&&(ka=ea-ba[2]);ba[1]<-ja?da=ba[1]+ja:ba[3]>ja&&(da=ja-ba[3]);v.offset(ba,ka,da)};b._createClass(ia,[{key:"running",get:function(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||H.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},
{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return g.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?D.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"suspended",get:function(){return this.surface.suspended}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},
{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask(U.noBudget)}}}]);return ia}(w);c.__decorate([e.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);c.__decorate([e.property()],
a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([e.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([e.property({autoDestroy:!0})],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],
a.OverlayManager.prototype,"surface",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"suspended",null);c.__decorate([e.property()],a.OverlayManager.prototype,"updating",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([p.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const Q=B.create(),W=q.create(),
V={inner:v.create(),outer:v.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},T=v.create(),X=v.create(),Z=A.create();var Y;(function(aa){aa[aa.NONE=0]="NONE";aa[aa.EXTENT=1]="EXTENT";aa[aa.RERENDER_ONLY=2]="RERENDER_ONLY"})(Y||(Y={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){const b=globalThis.require?.modules;if(b){const c=Object.keys(b);for(const w of c)-1!==
w.search(".glsl")&&delete b[w]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./interfaces ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){let u=function(h){function r(y,B,D){var z=q.call(this);z._horizontalScaleFactor=1;z._extentInRenderSR=l.create();void 0!==y&&z.init(y,B,D);return z}b._inherits(r,h);var q=b._createSuper(r);h=r.prototype;h.init=function(y,B,D){b._get(b._getPrototypeOf(r.prototype),"init",this).call(this,y,B,D);y=D.view.renderSpatialReference;D=D.spatialReference;this._horizontalScaleFactor=B=c.isSome(y)&&g.isPlateCarree(y)&&c.isSome(D)&&D.isGeographic?this.ellipsoid.radius*Math.PI/
180:1;D=this._extentInRenderSR;y=this.extent;if(this.surface.isWebMercatorOnPlateeCarree)B=w.fromValues(y[0],y[1],0),n.projectVectorToVector(B,x.WebMercator,B,x.PlateCarree),y=w.fromValues(y[2],y[3],0),n.projectVectorToVector(y,x.WebMercator,y,x.PlateCarree),D[0]=B[0],D[1]=B[1],D[2]=y[0],D[3]=y[1];else for(let z=0;4>z;++z)D[z]=y[z]*B;this.centerAtSeaLevel[0]=.5*(D[0]+D[2]);this.centerAtSeaLevel[1]=.5*(D[1]+D[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(D[2]-D[0],D[3]-D[1]);this._edgeLen2=
this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};h.updateRadiusAndCenter=function(){this._updateCenter();var y=this._extentInRenderSR;const B=.5*(y[2]-y[0]);y=.5*(y[3]-y[1]);this._center[e.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(B*B+y*y),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};h._calculateFrustumVisibilityStatus=function(y){var B=this._aabb();const D=B[0],z=B[1],v=B[2],A=B[3],t=B[4];B=B[5];let C=!0;for(let F=0;6>F;F++){var E=y[F];const H=E[0],K=E[1],I=E[2];E=E[3];if(0<=
H*(0<H?D:A)+K*(0<K?z:t)+I*(0<I?v:B)+E)return f.TileFrustumVisibility.OUTSIDE;C=C&&0>=H*(0>H?D:A)+K*(0>K?z:t)+I*(0>I?v:B)+E}return C?f.TileFrustumVisibility.INSIDE:f.TileFrustumVisibility.INTERSECTS};h._aabb=function(){const y=this._extentInRenderSR;return m.wrap(y[0],y[1],this.elevationBounds[0],y[2],y[3],this.elevationBounds[1])};h.intersectsRay=function(y,B,D,z){p[0]=1/B[0];p[1]=1/B[1];p[2]=1/B[2];return k.intersectAabbInvDirBefore(this._aabb(),y,p,D,z)};h.createGeometry=function(){d.createPlanarGlobePatch(this.renderData,
this._horizontalScaleFactor);this.setMemoryDirty()};h.getDefaultVerticesPerSide=function(){return 9>this.level?3:2};h.updateCornerElevations=function(){d.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)};h.updateEdgeElevations=function(){d.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor)};b._createClass(r,[{key:"horizontalScale",get:function(){return this._horizontalScaleFactor}}]);return r}(e.Tile);const p=w.create();a.PlanarPatch=u;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(O){var J=O.tile;if(J.intersectsClippingArea){var M=O.geometryState,
G=M.numVerticesPerSide,P=G-2;--G;var U=O.geometryInfo,N=U.vertexAttributes,S=N.position,Q=N.uv0;N=N.normalCompressed;var W=J.extent,V=W[0],T=W[2],X=W[1];W=W[3];J=J.ellipsoid.radius;M=M.samplerData;var Z=O.localOrigin;O=Z[0];var Y=Z[1];Z=Z[2];var aa=S.typedBuffer;S=S.typedBufferStride;var ia=1/G;U=U.boundingBox;var na=0;if(1<=P){var ba=X*(1-ia)+W*ia,ea=I.sinLatLUT[1],ja=I.cosLatLUT[1];for(var ka=1;ka<=P;ka++){var da=ka*ia,ha=I.sinLonLUT[ka],ca=I.cosLonLUT[ka],fa=J+m.sampleElevation(V*(1-da)+T*da,ba,
M);ca=-O+fa*ca*ja;ha=-Y+fa*ha*ja;fa=-Z+fa*ea;g.minMaxBoundingBox(ca,ha,fa,U);var ma=(ka-1)*S;aa[ma]=ca;aa[ma+1]=ha;aa[ma+2]=fa;g.encodeUVInBuffer(Q,ka-1,da,ia)}}for(ba=1;ba<=P;ba++){ea=ba*ia;ea=X*(1-ea)+W*ea;ja=I.sinLatLUT[ba];ka=I.cosLatLUT[ba];ha=ba+1;da=ha*ia;ca=X*(1-da)+W*da;fa=I.sinLatLUT[ha];ha=I.cosLatLUT[ha];var qa=I.sinLonLUT[0];ma=I.cosLonLUT[0];var wa=J+m.sampleElevation(V,ea,M);ma=ma*ka*wa-O;qa=qa*ka*wa-Y;wa=ja*wa-Z;var xa=na*S;let Ua=aa[xa],Za=aa[xa+1];xa=aa[xa+2];for(let Xa=1;Xa<=P;Xa++){var pa=
Xa*ia,ra=V*(1-pa)+T*pa,va=I.sinLonLUT[Xa],Ba=I.cosLonLUT[Xa],Aa=0,Ha=0,Ka=0;Xa<P?(Ka=(na+1)*S,Aa=aa[Ka],Ha=aa[Ka+1],Ka=aa[Ka+2]):(Ha=I.sinLonLUT[G],Aa=I.cosLonLUT[G],Ka=J+m.sampleElevation(T,ea,M),Aa=Aa*ka*Ka-O,Ha=Ha*ka*Ka-Y,Ka=ja*Ka-Z);var Pa=ma,Ra=qa,Sa=wa;ma=Ua;qa=Za;wa=xa;Ua=Aa;Za=Ha;xa=Ka;Aa-=Pa;Ha-=Ra;Ka-=Sa;Pa=Ra=Sa=0;if(1<ba)Pa=(na-P)*S,Sa=aa[Pa],Ra=aa[Pa+1],Pa=aa[Pa+2];else{Pa=I.sinLatLUT[0];Ra=I.cosLatLUT[0];var La=J+m.sampleElevation(ra,X,M);Sa=Ba*Ra*La-O;Ra=va*Ra*La-Y;Pa=Pa*La-Z}La=J+
m.sampleElevation(ra,ca,M);const la=Ba*ha*La-O;ra=va*ha*La-Y;La=fa*La-Z;if(ba<P){const Ta=na+P,Ma=Ta*S;aa[Ma]=la;aa[Ma+1]=ra;aa[Ma+2]=La;g.minMaxBoundingBox(la,ra,La,U);g.encodeUVInBuffer(Q,Ta,pa,da)}pa=Sa-la;ra=Ra-ra;Sa=Pa-La;Ba*=ka;va*=ka;Ra=ja;.999>Ra*Ra&&(Ba=Ka*ra-Ha*Sa,va=Aa*Sa-Ka*pa,Ra=Ha*pa-Aa*ra);pa=1/Math.sqrt(Ba*Ba+va*va+Ra*Ra);g.encodeNormalInBuffer(N,na,Ba*pa,va*pa,Ra*pa);++na}}}}function h(O){O.tile.intersectsClippingArea&&(C(O),r(O))}function r(O,J=!1){var M=O.geometryState;const G=
O.geometryInfo,P=M.neighborData,U=O.tile,N=U.level,S=U.extent,Q=U.ellipsoid.radius;var W=U.extentInRadians;const V=W[0],T=W[2],X=W[1];W=W[3];const Z=M.samplerData,Y=S[0],aa=S[2],ia=S[1],na=S[3],ba=q(O),ea=G.boundingBox;M=O.localOrigin;const ja=M[0],ka=M[1],da=M[2];M=G.vertexAttributes;var ha=M.position;const ca=ha.typedBuffer,fa=ha.typedBufferStride,ma=M.uv0;for(let xa=0;4>xa;++xa){const pa=1===xa||3===xa;M=P.edgeResolutions[xa];e.internalAssert(b.isPowerOfTwo(M));const ra=M+1;var qa=d.neighborTileIfLoadedOrSelf(U,
P.edgePeerNeighbors[xa]);if(H(U,qa,xa)){t(O,xa,qa);continue}const va=c.isSome(qa);e.internalAssert(!va||qa.level===U.level);e.internalAssert(!va||0>=u.compareTilesByLij(U,qa));ha=qa?.renderData?.geometryState;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS){var wa=U.surface;if(!qa&&wa&&!wa.updatingRootTiles){const Da=e.neighborEdgeIndices[xa],Ia=U.findNeighborTile(Da,Na=>Na.isLoaded||Na.isLeaf||Na.level===U.level);Ia?Ia.intersectsClippingArea&&(e.internalAssert(!Ia.isLoaded),e.internalAssert(!Ia.isLeaf),e.internalAssert(Ia.level===
N)):e.internalAssert(c.isNone(wa?.rootTiles)||!U.shouldHaveNeighbor(Da))}}const Ba=1===xa?S[2]:S[0],Aa=(qa=qa?.extent)&&pa?1===xa?qa[0]:qa[2]:Ba,Ha=0===xa?S[3]:S[1],Ka=1===xa?1:0,Pa=0===xa?1:0,Ra=1===xa?T:V,Sa=0===xa?W:X,La=Math.sin(Ra),Ua=Math.cos(Ra),Za=Math.sin(Sa),Xa=Math.cos(Sa),la=ha?.samplerData;ha=(Da,Ia,Na)=>m.sampleElevation(Da,Ia,Z);wa=(Da,Ia,Na)=>.5*(m.sampleElevation(Da,Ia,Z)+m.sampleElevation(Na,Ia,la));const Ta=va?wa:ha,Ma=G.outerEdges[xa],fb=J&&3<ra?ra-3:1;ha=c.isSome(Z)&&Z.some(Da=>
null!=Da);wa=c.isSome(la)&&la.some(Da=>null!=Da);const ya=ha||wa,oa=1/M,ua=Ma.index0;e.internalAssert(!qa||e.almostEquals(qa[2]-qa[0],S[2]-S[0]));(()=>{const Da=1===xa?-1:3===xa?1:0,Ia=0===xa?-1:2===xa?1:0,Na=(S[2]-S[0])*oa,ab=Da*Na,cb=Ia*Na,hb=T-V,ib=pa?Da*hb*oa:0,qb=pa?0:Ia*oa,pb=Pa,Lb=pa?Ra+ib:Ra,Tb=pa?Math.sin(Lb):La,tb=pa?Math.cos(Lb):Ua,Cb=pa?Ra-ib:Ra,Ib=pa?Math.sin(Cb):La,bb=pa?Math.cos(Cb):Ua,ob=pa?Sa:ba(pb+qb),Ab=pa?Za:Math.sin(ob),Fa=pa?Xa:Math.cos(ob),Ea=pa?Sa:ba(pb-qb),Va=pa?Za:Math.sin(Ea),
db=pa?Xa:Math.cos(Ea);let ta=0,Ga=0,Oa=0;const Qa=0*oa,Ya=pa?Ba:Y*(1-Qa)+aa*Qa,eb=pa?Aa:Ya,gb=pa?ia*(1-Qa)+na*Qa:Ha,lb=pa?Ra:V*(1-Qa)+T*Qa,kb=pa?La:Math.sin(lb),nb=pa?Ua:Math.cos(lb),ub=pa?ba(Qa):Sa,Jb=pa?Math.sin(ub):Za,Bb=pa?Math.cos(ub):Xa,xb=Q+Ta(Ya,gb,eb);ta=nb*Bb*xb;Ga=kb*Bb*xb;Oa=Jb*xb;let mb=0,vb=0,Eb=0;const wb=1*oa,zb=pa?Ba:Y*(1-wb)+aa*wb,Qb=pa?Aa:zb,Kb=pa?ia*(1-wb)+na*wb:Ha,Ob=pa?Ra:V*(1-wb)+T*wb,Wb=pa?La:Math.sin(Ob),Rb=pa?Ua:Math.cos(Ob),Fb=pa?ba(wb):Sa,Sb=pa?Math.sin(Fb):Za,Yb=pa?Math.cos(Fb):
Xa,dc=Q+Ta(zb,Kb,Qb);mb=Rb*Yb*dc;vb=Wb*Yb*dc;Eb=Sb*dc;for(let yb=1;yb<ra-1;yb+=fb){let fc=0,Db=0,Pb=0;const Xb=(yb+1)*oa,ec=pa?Ba:Y*(1-Xb)+aa*Xb,ic=pa?Aa:ec,mc=pa?ia*(1-Xb)+na*Xb:Ha,nc=pa?Ra:V*(1-Xb)+T*Xb,Bc=pa?La:Math.sin(nc),re=pa?Ua:Math.cos(nc),Yc=pa?ba(Xb):Sa,se=pa?Math.sin(Yc):Za,vd=pa?Math.cos(Yc):Xa,Zc=Q+Ta(ec,mc,ic);fc=re*vd*Zc;Db=Bc*vd*Zc;Pb=se*Zc;const $c=fc,wd=Db,xd=Pb,ad=mb,bd=vb,Cc=Eb;mb=$c;vb=wd;Eb=xd;const yd=ua+yb,Dc=yd*fa,zd=ad-ja,Ad=bd-ka,Bd=Cc-da;ca[Dc]=zd;ca[Dc+1]=Ad;ca[Dc+2]=
Bd;g.minMaxBoundingBox(zd,Ad,Bd,ea);const Cd=yb*oa;g.encodeUVInBuffer(ma,yd,pa?Ka:Cd,pa?Cd:Pa);const te=ta,ue=Ga,cd=Oa;ta=ad;Ga=bd;Oa=Cc;const oc=ad,zc=bd,uc=Cc,Ec=1/Math.sqrt(oc*oc+zc*zc+uc*uc),Dd=uc*Ec;let vc=0,wc=0,xc=0;if(ya&&.999>Dd*Dd){let Fc=0,dd=0,Gc=0;const Hc=0===xa?-1:1;Fc=Hc*($c-te);dd=Hc*(wd-ue);Gc=Hc*(xd-cd);const pc=yb*oa,Ed=pa?Ba:Y*(1-pc)+aa*pc,ve=pa?Aa:Ed,Fd=pa?ia*(1-pc)+na*pc:Ha,Gd=pa?Ra:V*(1-pc)+T*pc,Hd=pa?La:Math.sin(Gd),Id=pa?Ua:Math.cos(Gd),Jd=pa?ba(pc):Sa,Kd=pa?Math.sin(Jd):
Za,Ld=pa?Math.cos(Jd):Xa;let ed=oc,fd=zc,gd=uc;if(va){const hd=Q+m.sampleElevation(ve-ab,Fd-cb,la),we=pa?Ib:Hd,xe=pa?Kd:Va,Md=pa?Ld:db;ed=(pa?bb:Id)*Md*hd;fd=we*Md*hd;gd=xe*hd}const id=Q+m.sampleElevation(Ed+ab,Fd+cb,Z),Nd=pa?Ld:Fa,Od=(pa?tb:Id)*Nd*id,Pd=(pa?Tb:Hd)*Nd*id,Qd=(pa?Kd:Ab)*id;va||(ed=2*oc-Od,fd=2*zc-Pd,gd=2*uc-Qd);const jd=3===xa?-1:1,Rd=jd*(ed-Od),Sd=jd*(fd-Pd),Td=jd*(gd-Qd);vc=Gc*Sd-dd*Td;wc=Fc*Td-Gc*Rd;xc=dd*Rd-Fc*Sd;const kd=1/Math.sqrt(vc*vc+wc*wc+xc*xc);vc*=kd;wc*=kd;xc*=kd}else vc=
oc*Ec,wc=zc*Ec,xc=uc*Ec;Ma.setNormalFromValues(yb,vc,wc,xc)}})()}}function q(O){O=O.tile;if(O.surface.isWebMercator){const M=O.extent,G=O.ellipsoid.radius;return P=>Math.PI/2-2*Math.atan(Math.exp(-(M[1]*(1-P)+M[3]*P)/G))}const J=O.extentInRadians;return M=>J[1]*(1-M)+J[3]*M}function y(O){const J=O.tile;if(J.intersectsClippingArea){var M=O.geometryState,G=M.samplerData,P=O.localOrigin,U=J.surface.isWebMercatorOnPlateeCarree,N=M.clippingArea,S=c.isSome(N)?N:L,Q=J.extent,W=Q[0],V=Q[1],T=Q[2],X=Q[3],
Z=Math.max(W,S[0]),Y=Math.min(T,S[2]),aa=Math.max(V,S[1]),ia=Math.min(X,S[3]),na=J.ellipsoid.radius,ba=J.horizontalScale,ea=M.numVerticesPerSide,ja=ea-1,ka=ea-2,da=O.geometryInfo,ha=da.vertexAttributes,ca=ha.position,fa=ha.uv0,ma=ha.normalCompressed,qa=da.uvRange,wa=qa[0],xa=qa[1],pa=qa[2],ra=qa[3],va=da.boundingBox,Ba=P[0],Aa=P[1],Ha=P[2],Ka=ca.typedBuffer,Pa=ca.typedBufferStride,Ra=0,Sa=b.clamp(V,aa,ia),La=U?(Math.PI/2-2*Math.atan(Math.exp(-Sa/na)))*na:Sa*ba,Ua=1/ja,Za=b.clamp(V*(1-Ua)+X*Ua,aa,
ia),Xa=La,la=U?(Math.PI/2-2*Math.atan(Math.exp(-Za/na)))*na:Za*ba;for(let Ta=1;Ta<=ka;Ta++){const Ma=Ta/ja,fb=b.clamp(V*(1-Ma)+X*Ma,aa,ia),ya=b.clamp(Ma,xa,ra),oa=la,ua=(Ta-1)/ja,Da=b.clamp(V*(1-ua)+X*ua,aa,ia),Ia=Xa,Na=(Ta+1)/ja,ab=b.clamp(V*(1-Na)+X*Na,aa,ia),cb=U?(Math.PI/2-2*Math.atan(Math.exp(-ab/na)))*na:ab*ba,hb=b.clamp(Na,xa,ra);Xa=la;la=cb;const ib=b.clamp(W,Z,Y);let qb=ib*ba,pb=m.sampleElevation(ib,fb,G);const Lb=1/ja,Tb=b.clamp(Lb,wa,pa),tb=b.clamp(W*(1-Tb)+T*Tb,Z,Y);let Cb=Tb,Ib=tb,bb=
tb*ba,ob=m.sampleElevation(tb,fb,G);if(1===Ta){const Ab=bb-Ba,Fa=Xa-Aa,Ea=ob-Ha,Va=0*Pa;Ka[Va]=Ab;Ka[Va+1]=Fa;Ka[Va+2]=Ea;g.minMaxBoundingBox(Ab,Fa,Ea,va);const db=b.clamp(Lb,wa,pa);g.encodeUVInBuffer(fa,Ra,db,ya)}for(let Ab=1;Ab<=ka;Ab++){const Fa=bb,Ea=ob,Va=(Ab+1)/ja,db=b.clamp(Va,wa,pa),ta=b.clamp(W*(1-Va)+T*Va,Z,Y),Ga=Ib;Ib=ta;const Oa=Ra+1,Qa=Oa*Pa;if(1===Ta||Ab===ka){const wb=m.sampleElevation(ta,fb,G),zb=ta*ba,Qb=oa,Kb=wb;if(1===Ta&&Ab<ka){const Ob=zb-Ba,Wb=Qb-Aa,Rb=Kb-Ha;Ka[Qa]=Ob;Ka[Qa+
1]=Wb;Ka[Qa+2]=Rb;g.minMaxBoundingBox(Ob,Wb,Rb,va);g.encodeUVInBuffer(fa,Oa,db,ya)}bb=zb;ob=Kb}else bb=Ka[Qa]+Ba,ob=Ka[Qa+2]+Ha;const Ya=bb,eb=ob,gb=qb,lb=pb;qb=Fa;pb=Ea;const kb=(Ra-ka)*Pa,nb=1===Ta?m.sampleElevation(Ga,Da,G):Ka[kb+2]+Ha,ub=m.sampleElevation(Ga,ab,G);if(Ta<ka){const wb=Ra+ka,zb=wb*Pa,Qb=Fa-Ba,Kb=cb-Aa,Ob=ub-Ha;Ka[zb]=Qb;Ka[zb+1]=Kb;Ka[zb+2]=Ob;g.minMaxBoundingBox(Qb,Kb,Ob,va);const Wb=Cb;Cb=db;g.encodeUVInBuffer(fa,wb,Wb,hb)}const Jb=Ya-gb,Bb=Ia-cb,xb=Bb*(eb-lb),mb=Jb*(nb-ub),vb=
-Bb*Jb,Eb=xb*xb+mb*mb+vb*vb;if(0===Eb)g.encodeNormalInBuffer(ma,Ra,0,0,1);else{const wb=1/Math.sqrt(Eb);g.encodeNormalInBuffer(ma,Ra,xb*wb,mb*wb,vb*wb)}++Ra}}}}function B(O,J){O.tile.intersectsClippingArea&&(C(O),D(O,!1))}function D(O,J){const M=O.geometryState,G=M.neighborData,P=O.tile,U=P.surface,N=P.extent,S=M.clippingArea,Q=c.isSome(S)?S:L,W=N[0],V=N[2],T=N[1],X=N[3],Z=[X>Q[3],V>Q[2],T<Q[1],W<Q[0]],Y=O.geometryInfo,aa=P.horizontalScale,ia=z(U.isWebMercatorOnPlateeCarree,P.ellipsoid.radius,aa),
na=Y.boundingBox,ba=Y.uvRange[0],ea=Y.uvRange[1],ja=Y.uvRange[2],ka=Y.uvRange[3],da=Math.max(W,Q[0]),ha=Math.min(V,Q[2]),ca=Math.max(T,Q[1]),fa=Math.min(X,Q[3]),ma=O.localOrigin,qa=ma[0],wa=ma[1],xa=ma[2],pa=M.samplerData;for(let ra=0;4>ra;++ra){const va=1===ra||3===ra,Ba=G.edgeResolutions[ra];e.internalAssert(b.isPowerOfTwo(Ba));const Aa=Ba+1,Ha=Z[ra],Ka=d.neighborTileIfLoadedOrSelf(P,G.edgePeerNeighbors[ra]);if(!Ha&&H(P,Ka,ra)){t(O,ra,Ka);continue}const Pa=c.isSome(Ka)&&!Ha,Ra=Ka?.renderData?.geometryState;
if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(!Pa||Ka.level===P.level),e.internalAssert(!Pa||0>=u.compareTilesByLij(P,Ka)),P&&!Ka&&!U.updatingRootTiles)){const db=e.neighborEdgeIndices[ra],ta=P.findNeighborTile(db,Ga=>Ga.isLoaded||Ga.isLeaf||Ga.level===P.level);U.updatingRootTiles||(ta?ta.intersectsClippingArea&&(e.internalAssert(!ta.isLoaded),e.internalAssert(!ta.isLeaf),e.internalAssert(ta.level===P.level)):e.internalAssert(c.isNone(U?.rootTiles)||!P.shouldHaveNeighbor(db)))}const Sa=b.clamp(1===
ra?V:W,da,ha),La=b.clamp(0===ra?X:T,ca,fa),Ua=Ra?.samplerData,Za=Y.outerEdges[ra],Xa=J&&3<Aa?Aa-3:1,la=b.clamp(1===ra?1:0,ba,ja),Ta=b.clamp(0===ra?1:0,ea,ka),Ma=(db,ta)=>m.sampleElevation(db,ta,pa),fb=(db,ta)=>.5*(m.sampleElevation(db,ta,Ua)+m.sampleElevation(db,ta,pa)),ya=Pa?fb:Ma,oa=(V-W)/Ba,ua=va?1===ra?oa:-oa:0,Da=va?0:0===ra?oa:-oa,Ia=-ua,Na=-Da;let ab=0,cb=0,hb=0;const ib=0/Ba,qb=va?Sa:b.clamp(W*(1-ib)+V*ib,da,ha),pb=va?b.clamp(T*(1-ib)+X*ib,ca,fa):La,Lb=ya(qb,pb);ab=qb*aa;cb=ia(pb);hb=Lb;let Tb=
0,tb=0,Cb=0;const Ib=1/Ba,bb=va?Sa:b.clamp(W*(1-Ib)+V*Ib,da,ha),ob=va?b.clamp(T*(1-Ib)+X*Ib,ca,fa):La,Ab=ya(bb,ob),Fa=bb*aa,Ea=ia(ob),Va=Ab;Tb=Fa;tb=Ea;Cb=Va;for(let db=1;db<Aa-1;db+=Xa){const ta=db/Ba,Ga=Tb,Oa=tb,Qa=Cb,Ya=va?la:b.clamp(ta,ba,ja),eb=va?b.clamp(ta,ea,ka):Ta,gb=Ga-qa,lb=Oa-wa,kb=Qa-xa;g.minMaxBoundingBox(Ga,lb,kb,na);Za.setVertexFromValuesRawPositionUV(db,gb,lb,kb,Ya,eb);const nb=(db+1)/Ba,ub=va?Sa:b.clamp(W*(1-nb)+V*nb,da,ha),Jb=va?b.clamp(T*(1-nb)+X*nb,ca,fa):La,Bb=ya(ub,Jb);Tb=ub*
aa;tb=ia(Jb);Cb=Bb;const xb=Tb,mb=tb,vb=Cb,Eb=ab,wb=cb,zb=hb;ab=Ga;cb=Oa;hb=Qa;let Qb=0,Kb=0,Ob=0;if(va){const Rb=mb-Oa,Fb=vb-Qa,Sb=wb-Oa,Yb=zb-Qa,dc=b.clamp(T*(1-ta)+X*ta,ca,fa),yb=Sa+Ia,fc=yb*aa,Db=m.sampleElevation(yb,dc,pa),Pb=fc-Ga,Xb=Db-Qa,ec=3===ra?-1:1;Qb=ec*(-Sb+Rb)*Xb;Kb=ec*Pb*(-Yb+Fb);Ob=-ec*Pb*(-Sb+Rb);if(Pa){const ic=Sa+ua,mc=ic*aa,nc=m.sampleElevation(ic,dc,Ua),Bc=mc-Ga;Qb=(-Sb+Rb)*(Xb-(nc-Qa));Kb=(Pb-Bc)*(-Yb+Fb);Ob=-(Pb-Bc)*(-Sb+Rb)}}else{const Rb=xb-Ga,Fb=vb-Qa,Sb=Eb-Ga,Yb=zb-Qa,
dc=b.clamp(W*(1-ta)+V*ta,da,ha),yb=La+Na,fc=m.sampleElevation(dc,yb,pa)-Qa,Db=ia(yb)-Oa,Pb=2===ra?-1:1;Qb=Pb*Db*(-Yb+Fb);Kb=Pb*(-Sb+Rb)*fc;Ob=-Pb*Db*(-Sb+Rb);if(Pa){const Xb=dc,ec=La+Da,ic=ia(ec),mc=m.sampleElevation(Xb,ec,Ua)-Qa,nc=ic-Oa;Qb=(-Db+nc)*(-Yb+Fb);Kb=(-Sb+Rb)*(-fc+mc);Ob=-(-Db+nc)*(-Sb+Rb)}}const Wb=1/Math.sqrt(Qb*Qb+Kb*Kb+Ob*Ob);Za.setNormalFromValues(db,Qb*Wb,Kb*Wb,Ob*Wb)}}}function z(O,J,M){return O?G=>(Math.PI/2-2*Math.atan(Math.exp(-G/J)))*J:G=>G*M}function v(O,J,M,G,P,U){const N=
J-1,S=O.vertexAttributes.count,Q=2*(Math.min(J-2,G[1])-Math.max(1,G[0]))*(Math.min(J-2,P[1])-Math.max(1,P[0])),W=e.neighborEdgeIndices.map((ea,ja)=>0===ja&&P[1]<J-2||1===ja&&G[1]<J-2||2===ja&&1<P[0]||3===ja&&1<G[0]),V=O.outerEdges.reduce((ea,ja,ka)=>ea+(W[ka]?0:N-2+ja.count-1),0),T=M.reduce((ea,ja)=>ea+N*(2*(ja.latitudeResolution-1)+1),0),X=U?2:1,Z=3*(Q+V+T)*X,Y=65536<=S?new Uint32Array(Z):new Uint16Array(Z);let aa=0;const ia=J-2,na=N-2;e.internalAssert(0<=na);const ba=(ea,ja,ka,da,ha,ca)=>{var fa=
ea*ha;ea=ca[fa];const ma=ca[fa+1];fa=ca[fa+2];var qa=ja*ha;ja=ca[qa];const wa=ca[qa+1];qa=ca[qa+2];var xa=ka*ha;ka=ca[xa];const pa=ca[xa+1];xa=ca[xa+2];const ra=da*ha;da=ca[ra];ha=ca[ra+1];ca=ca[ra+2];return(ja-da)*(ja-da)+(wa-ha)*(wa-ha)+(qa-ca)*(qa-ca)>(ea-ka)*(ea-ka)+(ma-pa)*(ma-pa)+(fa-xa)*(fa-xa)};if(U){const ea=(ja,ka,da)=>{Y[aa++]=ja;Y[aa++]=ka;Y[aa++]=ka;Y[aa++]=da;Y[aa++]=da;Y[aa++]=ja;e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(ja<S),e.internalAssert(ka<S),e.internalAssert(da<S),
e.internalAssert(aa<=Z))};(()=>{for(let ja=Math.max(P[0],1)-1;ja<Math.min(P[1],J-2)-1;++ja){const ka=ja*ia;for(let da=Math.max(G[0],1)-1;da<Math.min(G[1],J-2)-1;++da){const ha=ja*ia+da,ca=ha+1,fa=ca+ia,ma=fa-1,qa=ka+da,wa=qa+1,xa=wa+ia;ba(qa,wa,xa,xa-1,O.vertexAttributes.position.typedBufferStride,O.vertexAttributes.position.typedBuffer)?(ea(ha,ca,fa),ea(fa,ma,ha)):(ea(ha,ca,ma),ea(ma,fa,ca))}}})();e.internalAssert(aa===3*Q*X);(()=>{for(let ka=0;4>ka;++ka){const da=aa;if(W[ka])continue;const ha=O.outerEdges[ka],
ca=O.innerEdges[ka];let fa=0,ma=0;const qa=ha.count,wa=ca.count;e.internalAssert(wa===N-1);let xa=0;const pa=1===ka||2===ka?(ra,va,Ba)=>ea(ra,va,Ba):(ra,va,Ba)=>ea(ra,Ba,va);for(;fa<qa-1||ma<wa-1;){const ra=ca.getVertexIndex(ma),va=ha.getVertexIndex(fa);var ja=fa<qa-1;const Ba=ma<wa-1,Aa=ja?N*(fa+.5)/(qa-1):0,Ha=Ba?1+na*(ma+.5)/(wa-1):0;ja&&(!Ba||Aa<=Ha)?(++fa,e.ENABLE_TERRAIN_INTERNAL_CHECKS&&e.internalAssert(fa<qa),ja=ha.getVertexIndex(fa),pa(ra,va,ja)):(++ma,e.ENABLE_TERRAIN_INTERNAL_CHECKS&&e.internalAssert(ma<
wa),ja=ca.getVertexIndex(ma),pa(ra,va,ja));xa++}e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(fa===qa-1),e.internalAssert(ma===wa-1),e.internalAssert(xa===qa+wa-2),e.internalAssert(xa===N-2+ha.count-1),e.internalAssert(aa===da+3*xa*X))}})();e.internalAssert(aa===3*(Q+V)*X);M.forEach(ja=>{var ka=O.outerEdges[ja.connectedOuterEdgeOffset];let da=ka.getVertexIndex(0);ka=ka.stride;for(let ha=0;ha<ja.latitudeResolution;++ha){const ca=0===ha?ja.rowOffset:da+J;for(let fa=0;fa<N;fa++)ea(da,da+1,ca+fa),
ha<ja.latitudeResolution-1&&ea(da+1,ca+fa+1,ca+fa),da+=ka;da=ca;ka=1}})}else(()=>{var ea=Math.max(P[0],1)-1;const ja=Math.min(P[1],J-2)-1,ka=Math.max(G[0],1)-1,da=Math.min(G[1],J-2)-1;for(;ea<ja;++ea){const ha=ea*ia;for(let ca=ka;ca<da;++ca){const fa=ha+ca,ma=fa+1,qa=ma+ia,wa=qa-1;ba(fa,ma,qa,wa,O.vertexAttributes.position.typedBufferStride,O.vertexAttributes.position.typedBuffer)?(Y[aa]=fa,Y[aa+1]=ma,Y[aa+2]=qa,Y[aa+3]=qa,Y[aa+4]=wa,Y[aa+5]=fa):(Y[aa]=fa,Y[aa+1]=ma,Y[aa+2]=wa,Y[aa+3]=wa,Y[aa+4]=
ma,Y[aa+5]=qa);aa+=6}}})(),e.internalAssert(aa===3*Q*X),(()=>{for(let ha=0;4>ha;++ha){if(W[ha])continue;var ea=O.outerEdges[ha],ja=O.innerEdges[ha];let ca=0,fa=0;const ma=ea.count,qa=ja.count;e.internalAssert(qa===N-1);var ka=1===ha||2===ha;const wa=ka?1:2;ka=ka?2:1;const xa=ea.index0;ea=ea.stride;const pa=ja.index0;for(ja=ja.stride;ca<ma-1||fa<qa-1;){const ra=pa+fa*ja,va=xa+ca*ea;var da=ca<ma-1;const Ba=fa<qa-1,Aa=da?N*(ca+.5)/(ma-1):0,Ha=Ba?1+na*(fa+.5)/(qa-1):0;(da=da&&(!Ba||Aa<=Ha))?++ca:++fa;
da=da?va+ea:ra+ja;Y[aa]=ra;Y[aa+wa]=va;Y[aa+ka]=da;aa+=3}}})(),e.internalAssert(aa===3*(Q+V)*X),M.forEach(ea=>{var ja=O.outerEdges[ea.connectedOuterEdgeOffset];let ka=ja.getVertexIndex(0);ja=ja.stride;for(let da=0;da<ea.latitudeResolution;++da){const ha=0===da?ea.rowOffset:ka+J;for(let ca=0;ca<N;ca++){const fa=ha+ca;Y[aa]=ka;Y[aa+1]=ka+1;Y[aa+2]=fa;da<ea.latitudeResolution-1?(Y[aa+3]=ka+1,Y[aa+4]=fa+1,Y[aa+5]=fa,aa+=6):aa+=3;ka+=ja}ka=ha;ja=1}});e.internalAssert(aa===Z);O.indices=Y;O.indexCount=Z}
function A(O,J){const M=O.localOrigin,G=O.geometryInfo;O=O.geometryState.neighborData.edgeResolutions;const P=G.numVerticesPerSide-2,U=G.vertexAttributes;for(let S=0;4>S;++S){var N=0===S||2===S;G.innerEdges[S]=new g.EdgeDescriptor(U,M,(0===S?P-1:0)*P+(1===S?P-1:0),(N?0:1)*P+(N?1:0),P);N=O[S]+1;G.outerEdges[S]=new g.EdgeDescriptor(U,M,J,1,N);J+=N}}function t(O,J,M){var G=(J+2)%4,P=O.tile,U=P.level-M.level;const N=1===J||3===J,S=O.geometryState.neighborData.edgeResolutions[J];e.internalAssert(b.isPowerOfTwo(S));
const Q=S+1;var W=O.geometryInfo;const V=W.boundingBox;var T=W.outerEdges[J];const X=W.uvRange[0],Z=W.uvRange[1],Y=W.uvRange[2];W=W.uvRange[3];const aa=b.clamp(1===J?1:0,X,Y),ia=b.clamp(0===J?1:0,Z,W);var na=M.renderData,ba=na.geometryState,ea=na.geometryInfo.outerEdges[G];J=P.getNeighborEdgeStartVertexIndex(J,M)*S;U=S*2**U;e.internalAssert(ba.neighborData.edgeResolutions[G]===U);e.internalAssert(ea.count-1===U);G=na.localOrigin[0]-O.localOrigin[0];U=na.localOrigin[1]-O.localOrigin[1];O=na.localOrigin[2]-
O.localOrigin[2];var ja=T.attributes;na=T.index0;T=T.stride;ba=ja.position.typedBuffer;M=ja.position.typedBufferStride;P=ja.normalCompressed.typedBuffer;const ka=ja.normalCompressed.typedBufferStride;ja=ja.uv0;var da=ea.attributes;const ha=ea.index0;ea=ea.stride;const ca=da.position.typedBuffer,fa=da.position.typedBufferStride,ma=da.normalCompressed.typedBuffer;da=da.normalCompressed.typedBufferStride;for(let pa=1;pa<Q-1;++pa){const ra=na+T*pa;var qa=ha+ea*(J+pa),wa=ra*M,xa=qa*fa;const va=ca[xa]+
G,Ba=ca[xa+1]+U;xa=ca[xa+2]+O;ba[wa]=va;ba[wa+1]=Ba;ba[wa+2]=xa;g.minMaxBoundingBox(va,Ba,xa,V);wa=ra*ka;qa*=da;P[wa]=ma[qa];P[wa+1]=ma[qa+1];wa=pa/S;qa=N?aa:b.clamp(wa,X,Y);wa=N?b.clamp(wa,Z,W):ia;g.encodeUVInBuffer(ja,ra,qa,wa)}}function C(O){const J=O.geometryState,M=O.localOrigin,G=J.neighborData.cornerNeighborData,P=O.geometryInfo,U=P.outerEdges,N=P.boundingBox,S=O.tile,Q="local"===O.tile.surface.view?.viewingMode,W=S.ellipsoid.radius,V=S.extentInRadians,T=S.horizontalScale;let X=0,Z=0,Y=0;const aa=
()=>{const Ma=O.geometryState.clippingArea,fb=S.extent,ya=c.isSome(Ma)&&(fb[3]>Ma[3]||fb[2]>Ma[2]||fb[1]<Ma[1]||fb[0]<Ma[0]),oa=z(S.surface.isWebMercatorOnPlateeCarree,S.ellipsoid.radius,T);return(ua,Da,Ia)=>{ua=0===ua?xa[0]:xa[2];Da=0===Da?xa[1]:xa[3];ua=ya?b.clamp(ua,Ma[0],Ma[2]):ua;Da=ya?b.clamp(Da,Ma[1],Ma[3]):Da;X=ua*T;Z=oa(Da);Y=Ia}},ia=(Ma,fb,ya)=>{var oa=V[0===fb?1:3];Ma=V[0===Ma?0:2];fb=Math.cos(oa);oa=Math.sin(oa);const ua=Math.sin(Ma);ya=W+ya;X=Math.cos(Ma)*fb*ya;Z=ua*fb*ya;Y=oa*ya},na=
Q?aa():ia;let ba=0,ea=0,ja=0,ka=0,da=0,ha=0,ca=0,fa=0,ma=0;const qa=Q&&O.tile.surface.isWebMercatorOnPlateeCarree,wa=(Ma,fb,ya,oa,ua)=>{var Da=0,Ia=0;let Na=0;Q?(ya=qa?(Math.PI/2-2*Math.atan(Math.exp(-ya/W)))*W:ya*T,Da=fb*T-X,Ia=ya-Z,Na=oa-Y):(Da=q(Ma),Ma=Ma.tile,Ia=Ma.extent,Ma=Ma.extentInRadians,fb=(fb-Ia[0])/(Ia[2]-Ia[0]),fb=Ma[0]*(1-fb)+Ma[2]*fb,Da=Da((ya-Ia[1])/(Ia[3]-Ia[1])),ya=Math.cos(Da),Ma=Math.sin(Da),Ia=Math.sin(fb),oa=W+oa,Da=Math.cos(fb)*ya*oa-X,Ia=Ia*ya*oa-Z,Na=Ma*oa-Y);switch(ua){case 0:ca+=
Da;fa+=Ia;ma+=Na;break;case 1:ka-=Da;da-=Ia;ha-=Na;break;case 2:ca-=Da;fa-=Ia;ma-=Na;break;case 3:ka+=Da,da+=Ia,ha+=Na}},xa=S.extent,pa=J.clippingArea,ra=c.isSome(pa)?pa:L,va=xa[0],Ba=xa[2],Aa=xa[1],Ha=xa[3],Ka=[Ha>ra[3],Ba>ra[2],Aa<ra[1],va<ra[0]],Pa=Math.max(va,ra[0]),Ra=Math.min(Ba,ra[2]),Sa=Math.max(Aa,ra[1]),La=Math.min(Ha,ra[3]),Ua=P.uvRange[0],Za=P.uvRange[1],Xa=P.uvRange[2],la=P.uvRange[3],Ta=Ma=>{Ma=G[Ma].cornerTiles;ea=ba=0;ja=1;var fb=Infinity;for(var ya=0;4>ya;++ya)fb=Math.min(fb,Ma[ya]?.level??
Infinity);for(ya=0;4>ya;++ya){var oa=Ma[ya];R[ya]=oa?.level===fb?oa:null}Ma=1;fb=0;for(ya=0;4>ya;++ya)if(oa=R[ya])Ma=Math.max(Ma,oa?.renderData.geometryState.numVerticesPerSide),fb=oa.extent[2]-oa.extent[0];e.internalAssert(1<Ma);Ma=fb/Ma;for(fb=0;4>fb;++fb){var ua=R[(fb+3)%4],Da=R[fb%4];if(ua||Da){oa=0===fb?1:1===fb?2:2===fb?3:0;var Ia=0===fb?2:1===fb?3:2===fb?0:1;if(ua&&Da){var Na=K[fb][0]*Ma,ab=K[fb][1]*Ma,cb=ua.extent;ya=cb[0===oa||1===oa?2:0]+Na;oa=cb[0===oa||3===oa?3:1]+ab;cb=Da.extent;Na=cb[0===
Ia||1===Ia?2:0]+Na;Ia=cb[0===Ia||3===Ia?3:1]+ab;ua=ua.renderData;ab=Da.renderData;Da=m.sampleElevation(ya,oa,ua.geometryState.samplerData);Ia=m.sampleElevation(Na,Ia,ab.geometryState.samplerData);wa(ua,ya,oa,.5*(Da+Ia),fb)}else ya=ua??Da,ua=ua?oa:Ia,Da=ya.extent,Ia=K[fb],oa=Da[0===ua||1===ua?2:0]+Ia[0]*Ma,ua=Da[0===ua||3===ua?3:1]+Ia[1]*Ma,ya=ya.renderData,Da=m.sampleElevation(oa,ua,ya.geometryState.samplerData),wa(ya,oa,ua,Da,fb)}}Q||(Ma=Math.sqrt(X*X+Z*Z+Y*Y),ba=X/Ma,ea=Z/Ma,ja=Y/Ma);Ma=Math.sqrt(ka*
ka+da*da+ha*ha);ka/=Ma;da/=Ma;ha/=Ma;Ma=Math.sqrt(ca*ca+fa*fa+ma*ma);ca/=Ma;fa/=Ma;ma/=Ma;if(Q||.999>ja*ja)ba=ha*fa-da*ma,ea=ka*ma-ha*ca,ja=da*ca-ka*fa,Ma=1/Math.sqrt(ba*ba+ea*ea+ja*ja),ba*=Ma,ea*=Ma,ja*=Ma};for(let Ma=0;4>Ma;++Ma){const fb=Ma,ya=(Ma+1)%4,oa=0===Ma||1===Ma?1:0,ua=0===Ma||3===Ma?1:0,Da=b.clamp(oa,Ua,Xa),Ia=b.clamp(ua,Za,la),Na=U[fb],ab=0===Ma||3===Ma?Na.count-1:0,cb=U[ya],hb=0===Ma||1===Ma?cb.count-1:0,ib=G[Ma].cornerTiles;let qb=-1;for(let tb=0;4>tb;++tb){const Cb=ib[tb];Cb&&(-1===
qb||0<u.compareTilesByLij(ib[qb],Cb))&&(qb=tb)}const pb=qb,Lb=ib[pb],Tb=Lb!==S;ea=ba=0;ja=1;if(Tb){const tb=S.level-Lb.level,Cb=2**tb,Ib=[Lb.lij[0]+tb,Lb.lij[1]*Cb,Lb.lij[2]*Cb],bb=[Ib[1]+Cb===S.lij[1],0===Ma&&(1===pb||0===pb&&Lb!==ib[3])||1===Ma&&(0===pb||1===pb&&Lb!==ib[2]),Ib[1]===S.lij[1]+1,2===Ma&&(3===pb||2===pb&&Lb!==ib[1])||3===Ma&&(2===pb||3===pb&&Lb!==ib[0])],ob=bb.reduce((Fb,Sb)=>Fb+(Sb?1:0),0);e.internalAssert(1===ob||2===ob);let Ab=-1,Fa=-1;const Ea=Lb.renderData;if(1===ob){const Fb=
bb.findIndex(Yb=>Yb);e.internalAssert(0<=Fb&&3>=Fb);Ab=(Fb+2)%4;const Sb=O.geometryState.neighborData.edgeResolutions[Fb];Fa=S.getNeighborEdgeStartVertexIndex(Fb,Lb)*Sb+Sb*(0===Fb&&0===Ma||1===Fb&&0===Ma||2===Fb&&1===Ma||3===Fb&&3===Ma?1:0)}else{e.internalAssert(bb[1]||bb[3]);Ab=bb[1]?3:1;const Fb=Ea.geometryState.neighborData.edgeResolutions[Ab];Fa=0===Ma||3===Ma?0:Fb}const Va=Ea.geometryInfo.outerEdges[Ab],db=Na.index0+ab*Na.stride,ta=cb.index0+hb*cb.stride,Ga=Va.index0+Fa*Va.stride,Oa=Va.attributes.position,
Qa=Oa.typedBuffer,Ya=Ga*Oa.typedBufferStride,eb=O.localOrigin,gb=Va.localOrigin,lb=Qa[Ya]+gb[0]-eb[0],kb=Qa[Ya+1]+gb[1]-eb[1],nb=Qa[Ya+2]+gb[2]-eb[2];g.minMaxBoundingBox(lb,kb,nb,N);const ub=Na.attributes.position,Jb=ub.typedBuffer,Bb=db*ub.typedBufferStride;Jb[Bb]=lb;Jb[Bb+1]=kb;Jb[Bb+2]=nb;const xb=cb.attributes.position,mb=xb.typedBuffer,vb=ta*xb.typedBufferStride;mb[vb]=lb;mb[vb+1]=kb;mb[vb+2]=nb;g.encodeUVInBuffer(Na.attributes.uv0,db,Da,Ia);g.encodeUVInBuffer(cb.attributes.uv0,ta,Da,Ia);const Eb=
Va.attributes.normalCompressed.typedBuffer,wb=Ga*Va.attributes.normalCompressed.typedBufferStride,zb=Na.attributes.normalCompressed,Qb=zb.typedBuffer,Kb=db*zb.typedBufferStride;Qb[Kb]=Eb[wb];Qb[Kb+1]=Eb[wb+1];const Ob=cb.attributes.normalCompressed,Wb=Ob.typedBuffer,Rb=ta*Ob.typedBufferStride;Wb[Rb]=Eb[wb];Wb[Rb+1]=Eb[wb+1]}else{const tb=Ka[ya];let Cb=void 0;if(Ka[fb]||tb){const Ab=b.clamp(va*(1-oa)+Ba*oa,Pa,Ra),Fa=b.clamp(Aa*(1-ua)+Ha*ua,Sa,La);Cb=m.sampleElevation(Ab,Fa,J.samplerData)}else Cb=E(ib);
na(oa,ua,Cb);Ta(Ma);const Ib=X-M[0],bb=Z-M[1],ob=Y-M[2];g.minMaxBoundingBox(Ib,bb,ob,N);Na.setVertexFromValuesRawPositionUVNormal(ab,Ib,bb,ob,Da,Ia,ba,ea,ja);cb.setVertexFromValuesRawPositionUVNormal(hb,Ib,bb,ob,Da,Ia,ba,ea,ja)}}for(let Ma=0;4>Ma;++Ma)R[Ma]=null}function E(O){const J=O.reduce((U,N)=>Math.min(U,N?.level??Infinity),Infinity);e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(!O[0]||!O[2]||k.isCornerNeighbor(O[0],O[2],l.NeighborIndex.SOUTH_WEST)),e.internalAssert(!O[1]||!O[3]||k.isCornerNeighbor(O[1],
O[3],l.NeighborIndex.NORTH_WEST)));let M=0,G=0;for(let U=0;4>U;++U){var P=O[U];if(P&&P.level===J){const N=P.extent;P=m.sampleElevation(N[0===U||1===U?0:2],N[0===U||3===U?1:3],P.renderData?.geometryState?.samplerData);G+=P;M++}}O=M?G/M:0;e.internalAssert(null!=O);return O}function F(O){const J=O.geometryInfo.vertexAttributes.position.typedBuffer;O.vao.vertexBuffers.geometry.setSubData(J,0,0,J.length)}function H(O,J,M){if(!J)return!1;O=u.compareTilesByLij(O,J);return 0<O||0===O&&2<=M}const K=[[0,1],
[1,0],[0,-1],[-1,0]],I=new f.PatchGeometryLUT,L=x.fromValues(-Infinity,-Infinity,Infinity,Infinity),R=[null,null,null,null];a.createPlanarGlobePatch=function(O,J){var M=O.tile.extent;J=O.geometryState;var G=M[0],P=M[1],U=M[2]-G,N=M[3]-P,S=J.clippingArea;M=c.isSome(S)?Math.max(0,(S[0]-G)/U):0;const Q=c.isSome(S)?Math.max(0,(S[1]-P)/N):0;G=c.isSome(S)?Math.min(1,(S[2]-G)/U):1;P=c.isSome(S)?Math.min(1,(S[3]-P)/N):1;U=J.numVerticesPerSide;N=(U-2)**2;S=J.neighborData.edgeResolutions.reduce((V,T)=>V+T+
1,0);S=g.acquireTerrainAttributes(N+S);const W=O.geometryInfo;n.empty(W.boundingBox);W.numVerticesPerSide=J.numVerticesPerSide;W.vertexAttributes=S;w.set(W.uvRange,M,Q,G,P);y(O);A(O,N);B(O);v(W,J.numVerticesPerSide,[],[0,U-1],[0,U-1],J.wireframe);O.intersectionData=null};a.createSphericalGlobePatch=function(O,J){const M=O.tile,{extent:G,extentInRadians:P,surface:U}=M,N=O.localOrigin,S=O.geometryState;var Q=U.isWebMercator;const W=S.numVerticesPerSide,V=W-1,T=(W-2)**2,X=Q&&(J===l.PatchType.HAS_SOUTH_POLE||
J===l.PatchType.HAS_BOTH_POLES),Z=Q&&(J===l.PatchType.HAS_NORTH_POLE||J===l.PatchType.HAS_BOTH_POLES);Q=6*((X?1:0)+(Z?1:0))*(V+1);J=S.neighborData;const Y=J.edgeResolutions.reduce((ea,ja)=>ea+ja+1,0),aa=g.acquireTerrainAttributes(T+Q+Y);Q=O.geometryInfo;Q.numVerticesPerSide=S.numVerticesPerSide;Q.vertexAttributes=aa;const ia=Q.boundingBox;n.empty(ia);const na=q(O);I.update(V,P,na);p(O);A(O,T);h(O);const ba=[];(()=>{let ea=T+Y;const ja=N[0],ka=N[1],da=N[2],ha=M.ellipsoid.radius,ca=G[1],fa=G[3],ma=
(qa,wa)=>{wa*=W;g.minMaxBoundingBox(-ja,-ka,-da+qa*ha,ia);ba.push({connectedRowOffset:wa,connectedOuterEdgeOffset:1===qa?0:2,rowOffset:ea,latitudeResolution:6});wa=Math.PI/2-2*Math.atan(Math.exp(-(-1===qa?ca:fa)/ha));const xa=qa*Math.PI/2-wa;qa=.99*(1===qa?1:-1);const pa=ha+0,ra=aa.position,va=aa.uv0,Ba=aa.normalCompressed;for(let Ha=1;6>=Ha;++Ha){var Aa=wa+Ha/6*xa;const Ka=Math.cos(Aa);Aa=Math.sin(Aa);for(let Pa=0;Pa<=V;Pa++){const Ra=Pa/V,Sa=I.cosLonLUT[Pa]*Ka,La=I.sinLonLUT[Pa]*Ka,Ua=Aa,Za=Sa*
pa-ja,Xa=La*pa-ka,la=Ua*pa-da;g.minMaxBoundingBox(Za,Xa,la,ia);ra.setValues(ea,Za,Xa,la);g.encodeUVInBuffer(va,ea,Ra,qa);g.encodeNormalInBuffer(Ba,ea,Sa,La,Ua);++ea}}};X&&ma(-1,0);Z&&ma(1,V)})();v(Q,S.numVerticesPerSide,ba,[0,W-1],[0,W-1],S.wireframe);O.intersectionData=null;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS)for(O=0;4>O;++O)e.internalAssert(Q.outerEdges[O].count===J.edgeResolutions[O]+1)};a.updateCornerSpherical=function(O){O.tile.intersectsClippingArea&&(C(O),r(O,!0),F(O))};a.updateCornersPlanar=
function(O,J){O.tile.intersectsClippingArea&&(C(O),D(O,!0),F(O))};a.updateEdgesAndCornersPlanar=function(O,J){O.tile.intersectsClippingArea&&(B(O),F(O))};a.updateEdgesAndCornersSpherical=function(O){O.tile.intersectsClippingArea&&(h(O),F(O))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./terrainUtils ../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(B,D,z,v,A){var t=1/(Math.abs(z)+Math.abs(v)+Math.abs(A));z*=t;v*=t;t=0>=A?(0<=v?1:-1)*(1-Math.abs(z)):v;B.setValues(D,u(0>=A?(0<=z?1:-1)*(1-Math.abs(v)):z),u(t))}function e(B,D){const z=p(D[0]);D=p(D[1]);const v=1-Math.abs(z)-Math.abs(D);B[2]=v;0>v?(B[0]=(0<=z?1:-1)*(1-Math.abs(D)),B[1]=(0<=D?1:-1)*(1-Math.abs(z))):(B[0]=z,B[1]=D);n.normalize(B,B)}function k(B,D,z,v){B.setValues(D,16384*z,16384*v)}function u(B){return c.clamp(Math.round(32767*B),-32767,32767)}
function p(B){return c.clamp(B/32767,-1,1)}let h=b._createClass(function(){this.vertexAttributes=this.indices=null;this.boundingBox=x.empty();this.numVerticesPerSide=this.indexCount=0;this.uvRange=[0,0,1,1];this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]}),r=function(){function B(z,v,A,t,C){this.attributes=z;this.localOrigin=v;this.index0=A;this.stride=t;this.count=C}var D=B.prototype;D.getVertexIndex=function(z){return this.getAttributeIndex(z)};D.getAttributeIndex=function(z){g.internalAssert(0<=
z&&z<this.count);return this.index0+this.stride*z};D._getVertexRaw=function(z,v){this.attributes.position.getVec(z,v)};D._getNormalRaw=function(z,v){this.attributes.normalCompressed.getVec(z,v)};D.getVertexPos=function(z,v){this._getVertexRaw(this.getAttributeIndex(v),z);n.add(z,z,this.localOrigin)};D.getNormal=function(z,v){const A=w.create();this._getNormalRaw(this.getAttributeIndex(v),A);e(z,A)};D._setNormal=function(z,v,A,t){d(this.attributes.normalCompressed,z,v,A,t)};D._setUV=function(z,v,A){k(this.attributes.uv0,
z,v,A)};D.setNormalFromValues=function(z,v,A,t){this._setNormal(this.getAttributeIndex(z),v,A,t)};D.setVertexFromValuesRawPositionUV=function(z,v,A,t,C,E){z=this.getAttributeIndex(z);this.attributes.position.setValues(z,v,A,t);this._setUV(z,C,E)};D.setVertexFromValuesRawPositionUVNormal=function(z,v,A,t,C,E,F,H,K){z=this.getAttributeIndex(z);this.attributes.position.setValues(z,v,A,t);this._setUV(z,C,E);this._setNormal(z,F,H,K)};return b._createClass(B)}();const q=l.newLayout().vec3f(f.VertexAttribute.POSITION).vec2i16(f.VertexAttribute.UV0).vec2i16(f.VertexAttribute.NORMALCOMPRESSED,
{glNormalized:!0}),y=new m.BufferPool(B=>q.createBuffer(B),B=>B.count);a.EdgeDescriptor=r;a.PatchGeometry=h;a.acquireTerrainAttributes=function(B){return y.acquire(B)};a.clearCaches=function(){y.clear()};a.decodeInt16=p;a.decodeNormal=e;a.encodeInt16=u;a.encodeNormalInBuffer=d;a.encodeUVInBuffer=k;a.minMaxBoundingBox=function(B,D,z,v){B<v[0]?v[0]=B:B>v[3]&&(v[3]=B);D<v[1]?v[1]=D:D>v[4]&&(v[4]=D);z<v[2]?v[2]=z:z>v[5]&&(v[5]=z)};a.releaseGeometry=function(B){y.release(B.vertexAttributes);B.vertexAttributes=
null;B.indices=null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let w=function(){function n(m,l){this._factoryCallback=m;this._lengthCallback=l;this._pool=new Map}var x=n.prototype;x.acquire=function(m){if(!n.test.disabled){var l=this._pool.get(m);if(l&&0!==l.length)return l.pop()}try{return this._factoryCallback(m)}catch(g){l=
window.performance&&window.performance.memory;let f="";l&&(f=`\n  totalJSHeapSize: ${l.totalJSHeapSize}, usedJSHeapSize: ${l.usedJSHeapSize}, jsHeapSizeLimit: ${l.jsHeapSizeLimit}`);console.log("Array allocation of size "+m+" failed: "+g+f);throw g;}};x.release=function(m){if(!n.test.disabled){var l=this._lengthCallback(m),g=this._pool.get(l);g||(g=new c({shrink:!0}),this._pool.set(l,g));g.push(m)}};x.clear=function(){this._pool.clear()};b._createClass(n,[{key:"test",get:function(){return{size:this._pool.size}}}]);
return n}();w.test={disabled:!1};a.BufferPool=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst"],function(a,b,c){let w=function(){function n(){this.sinLonLUT=Array(c.MAX_PATCH_TESSELATION+1);this.cosLonLUT=Array(c.MAX_PATCH_TESSELATION+1);this.sinLatLUT=Array(c.MAX_PATCH_TESSELATION+1);this.cosLatLUT=Array(c.MAX_PATCH_TESSELATION+1)}n.prototype.update=
function(x,m,l){const g=m[0];m=m[2];for(let d=0;d<=x;d++){var f=d/x;const e=g*(1-f)+m*f;this.sinLonLUT[d]=Math.sin(e);this.cosLonLUT[d]=Math.cos(e);f=l(f);this.sinLatLUT[d]=Math.sin(f);this.cosLatLUT[d]=Math.cos(f)}};return b._createClass(n)}();a.PatchGeometryLUT=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./interfaces ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(R,O){return O?.isLoaded||O===R?O:null}let t=function(){function R(){this.geometryInfo=new p.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new r.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new y;this._geometryStateChangedSinceLastUpdate=!0;this._wireframeChanged=this._clippingAreaChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=!1;this._dirtyCorners=
this._dirtyEdges=this._dirtyEdgeResolutions=15}var O=R.prototype;O.init=function(J){this.clear();this._tile=J;J=this.geometryInfo;J.indices=null;J.vertexAttributes=null;l.empty(J.boundingBox);J.indexCount=0;J.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new e.GeometryState;this.localOrigin=null;this.overlay.clear()};O.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null};O.updateGeometryIfNeeded=
function(J){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)this._updateGeometry(J),this._geometryStateChangedSinceLastUpdate=!1;if(h.ENABLE_TERRAIN_INTERNAL_CHECKS&&this.tile.intersectsClippingArea)for(J=0;4>J;++J)h.internalAssert(this.geometryInfo.outerEdges[J].count===this.geometryState.neighborData.edgeResolutions[J]+
1)};O._calculateEdgeResolution=function(J,M){const G=this.tile,P=this.geometryState.numVerticesPerSide-1;if(!G.surface.isGlobal){var U=G.surface.extent;if(n.isSome(U)&&(0===J&&G.extent[3]>U[3]||1===J&&G.extent[2]>U[2]||2===J&&G.extent[1]<U[1]||3===J&&G.extent[0]<U[0]))return P}const N=G.level;U=h.neighborEdgeIndices[J];if(!M)return h.internalAssert(n.isNone(G.surface?.rootTiles)||G.surface.updatingRootTiles||!G.shouldHaveNeighbor(U)),P;if(M.isLoaded)return U=M.renderData.geometryState,M=N-M.level,
h.internalAssert(0<=M),0===M?Math.max(U.numVerticesPerSide-1,P):Math.max(1,U.neighborData.edgeResolutions[(J+2)%4]/2**M);h.internalAssert(!M.isLeaf);let S=P;M.forAllSubtreeOnSide(h.oppositeEdge(U),Q=>{if(Q===G)return!0;if(Q.isLoaded)return S=Math.max(S,2**(Q.level-N)),!0;h.internalAssert(!Q.isLeaf);return!1});return S};O.updateNeighborData=function(){const J=this.tile;if(J.intersectsClippingArea){var M=J.renderData.geometryState.neighborData,G=T=>(T.isLoaded||T.level===J.level)&&T?.intersectsClippingArea,
P=M.edgePeerNeighbors,U=M.edgePeerNeighborSamplerVersions;for(var N=0;4>N;++N){var S=J.findNeighborTile(h.neighborEdgeIndices[N],G),Q=A(J,S),W=Q?.renderData?.geometryState.samplerDataVersion??-1,V=A(J,P[N]);Q=Q!==V;V=U[N]!==W;P[N]=S;if(Q||V)U[N]=W,this._markEdgeDirty(N);W=M.edgeResolutions[N];S=this._calculateEdgeResolution(N,S);h.internalAssert(w.isPowerOfTwo(S));h.internalAssert(1<=S);M.edgeResolutions[N]=S;W!==S&&this._markEdgeResolutionDirty(N)}U=M.cornerPeerNeighbors;for(N=0;4>N;++N){Q=J.findNeighborTile(h.neighborCornerIndices[N],
G);U[N]=Q;S=A(J,P[N]);W=A(J,P[(N+1)%4]);Q=A(J,Q);L[N]=Q;L[(N+1)%4]=W;L[(N+2)%4]=J;L[(N+3)%4]=S;h.internalAssert(L.some(X=>X?.isLoaded||X===J));const T=L.reduce((X,Z)=>Math.min(X,Z?.level??Infinity),Infinity);L.forEach((X,Z)=>{X&&X?.level>T&&(L[Z]=null)});h.internalAssert(L.some(X=>X?.isLoaded||X===J));S=M.cornerNeighborData[N].cornerTiles;W=M.cornerNeighborData[N].cornerTileSamplerVersions;for(Q=0;4>Q;++Q){V=L[Q];const X=V?.renderData.geometryState.samplerDataVersion??-1,Z=S[Q]!==V,Y=!Z&&W[Q]!==X;
if(Z||Y)S[Q]=V,W[Q]=X,this._markCornerDirty(N)}h.internalAssert(S.some(X=>X?.isLoaded||X===J))}h.ENABLE_TERRAIN_INTERNAL_CHECKS&&h.internalAssert(this.geometryState.neighborData.edgeResolutions.every(T=>0<T));for(M=0;4>M;++M)L[M]=null}};O._updateGeometry=function(J){if(this.tile.intersectsClippingArea){h.ENABLE_TERRAIN_INTERNAL_CHECKS&&h.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(N=>0<N));this.intersectionData=null;var M=this.tile,G=this.geometryInfo.vertexAttributes;
G=!this._vao||!G||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions;var P=!G&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),U=!P&&0!==this._dirtyCorners;G?(this.releaseGeometry(),this._createGeometry(J)):P||U?M.updateEdgeElevations():U?M.updateCornerElevations():console.warn("Update for no reason?");this._samplerDataChanged=this._numVerticesPerSideChanged=!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=
0;this._wireframeChanged=this._clippingAreaChanged=!1}};O.releaseGeometry=function(){this._hasGeometry=!1;this.intersectionData=null;if(!this._vao)return!1;this._vao.dispose();this._vao=null;p.releaseGeometry(this.geometryInfo);return!0};O.ensureTexture=function(J,M){n.isSome(this._texture)&&this._texture.descriptor.width!==J&&this.releaseTexture();n.isNone(this._texture)&&(this._texture=M(),this.tile.setMemoryDirty());return this._texture};O.releaseTexture=function(){n.isSome(this._texture)&&(this._texture.release(),
this._texture=null,this.tile.setMemoryDirty())};O._markCornerDirty=function(J){this._dirtyCorners|=1<<J};O._markEdgeDirty=function(J){this._dirtyEdges|=1<<J};O._markEdgeResolutionDirty=function(J){J=1<<J;this._dirtyEdgeResolutions|=J;this._dirtyEdges|=J};O._markAllEdgesAndCornersDirty=function(){this._dirtyEdgeResolutions=this._dirtyEdges=this._dirtyCorners=15};O.updateGeometryState=function(){var J=this._getElevationInfo();const M=this.tile;var G=J.samplerData?M.getElevationVerticesPerSide(J.maxTileLevel):
M.getDefaultVerticesPerSide();const P=Math.max(G,5);let U=M.clippingArea;if(!M.intersectsClippingArea||M.isWithinClippingArea)U=null;G=this.geometryState;let N=!1;G.numVerticesPerSide!==P&&(this._numVerticesPerSideChanged=!0,G.numVerticesPerSide=P,G.samplerDataVersion++,N=!0);J.changed&&(this._samplerDataChanged=!0,G.samplerData=J.samplerData,G.samplerDataVersion++,N=!0);c.equals(G.clippingArea,U)||(this._clippingAreaChanged=!0,G.clippingArea=U,N=!0);J=M.surface.wireframe;G.wireframe!==J&&(this._wireframeChanged=
!0,G.wireframe=J,N=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=N);N&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate};O._createGeometry=function(J){this.tile.createGeometry();const M=this.geometryInfo.vertexAttributes,G=this.geometryInfo.indices,P=J.gl;this._vao=new D.VertexArrayObject(J,z.terrainVertexAttributeLocations,{geometry:d.glLayout(M.layout)},{geometry:v.BufferObject.createVertex(J,P.STATIC_DRAW,
M.buffer)},v.BufferObject.createIndex(J,P.STATIC_DRAW,G));this._hasGeometry=!0};O.setTextureReference=function(J,M=r.ActivationTime.Immediate){n.isSome(J)&&J.texture!==this._texture&&this.releaseTexture();this._textureRef.push(J,M)};O._getElevationInfo=function(){var J=this.geometryState.samplerData;const M=this.tile.layerInfo[u.LayerClass.ELEVATION],G=M.length,P=Array(G);let U=0;var N=0;let S=!1;for(let V=0;V<G;V++){var Q=M[V];if(n.isSome(Q.upsampleInfo)){Q=Q.upsampleInfo.tile;var W=Q.layerInfo[u.LayerClass.ELEVATION][V].data;
W=W&&W.samplerData;J&&J[U]===W||(S=!0);P[U++]=W;N=Math.max(N,Q.lij[0])}else Q.data&&(W=this.tile.surface.layerViewByIndex(V,u.LayerClass.ELEVATION),B.fallsWithinLayer(this.tile,W.layer,!1)&&(N=Q.data,J&&J[U]===N.samplerData||(S=!0),P[U++]=N.samplerData,N=this.tile.level))}n.isSome(J)&&J.length!==U&&(S=!0);if(J=0<U)P.length=U;return{changed:S,samplerData:J?P:null,maxTileLevel:N}};O.checkGeometryWaterproofness=function(){if(h.ENABLE_TERRAIN_INTERNAL_CHECKS){var J=this.tile;h.internalAssert(J?.isLoaded);
if(J.isLoaded&&J.intersectsClippingArea){var M=J.renderData;if(0!==J.level){var G=J.surface.extent;if(!n.isSome(G)||J.intersectsExtent(G)){var P=h.neighborEdgeIndices.map((Q,W)=>n.isSome(G)?0>(2>W?-1:1)*(J.extent[3-W]-G[3-W]):!1),U=J.level;h.internalAssert(0===this._dirtyCorners);h.internalAssert(0===this._dirtyEdges);h.internalAssert(0===this._dirtyEdgeResolutions);h.internalAssert(!this._numVerticesPerSideChanged);h.internalAssert(!this._samplerDataChanged);h.internalAssert(!this._clippingAreaChanged);
h.internalAssert(!this._wireframeChanged);var N=h.neighborCornerIndices.map(Q=>J.findNeighborCornerTileExact(Q,W=>!W.intersectsClippingArea||W.isLoaded||W.level===J.level)??null).map(Q=>Q?.intersectsClippingArea?Q:null),S=this.geometryState.neighborData;for(let Q=0;4>Q;++Q){const W=S.cornerPeerNeighbors[Q],V=N[Q];h.internalAssert(V===W,`Tile[${J.lij}].corner[${Q}] out of date: cur=[${W?.lij}] exp=[${V?.lij}]`)}h.neighborEdgeIndices.forEach((Q,W)=>{if(!P[W]){var V=J.findNeighborTile(Q,ma=>(ma.level===
U||ma?.isLoaded)&&ma?.intersectsClippingArea);if(V){h.internalAssert(V.isLoaded||V.level===J.level);h.internalAssert(V===this.geometryState.neighborData.edgePeerNeighbors[W]);var T=U-V.level;if(V.isLoaded){var X=V.renderData;h.internalAssert(q.isEdgeNeighbor(J,V,Q));h.internalAssert(0<=T);var Z=2**T;if(0>T)h.internalAssert(!1);else{var Y=M.geometryInfo,aa=Y.outerEdges[W],ia=Y.numVerticesPerSide-1,na=X.geometryInfo;if(na){Y=this.geometryState.neighborData.edgePeerNeighbors[W];if(Y?.isLoaded){var ba=
Y.renderData;h.internalAssert(Y===Y);h.internalAssert(M.geometryState.neighborData.edgePeerNeighborSamplerVersions[W]===ba.geometryState.samplerDataVersion);h.internalAssert(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[W]===ba.geometryState.samplerDataVersion)}var ea=(W+2)%4,ja=na.outerEdges[ea];Y=aa.count-1;ba=ja.count-1;h.internalAssert(Y*Z===ba,`Tile[${J.lij}]:e${W},res=${Y} edgeRes mismatch with`+` Neighbor[${V.lij}]:e${ea},res=${ba} (expected:${Y*Z})`);Y=J.extent;ba=Q===k.NeighborIndex.NORTH||
Q===k.NeighborIndex.SOUTH;var ka=ja.count-1,da=ka/2**T,ha=aa.count-1;if(1>da)h.internalAssert(1===ha);else{h.internalAssert(da===ha);h.internalAssert(w.isPowerOfTwo(da));na=na.numVerticesPerSide-1;h.internalAssert(0<T||da===Math.max(na,ia));T=J.getNeighborEdgeStartVertexIndex(W,V);h.internalAssert(0<=T&&T<Z);Z=T*da;h.internalAssert(0<=Z&&Z<=ka-da);var ca=0,fa=Z;aa.getVertexPos(C,0);aa.getVertexPos(E,aa.count-1);Z=x.distance(C,E);Z=Math.max(1,1E-4*Z);for(T=0;T<=da;++T){aa.getVertexPos(C,ca);ja.getVertexPos(E,
fa);na=T/da;ia=ba?Y[0]+na*(Y[2]-Y[0]):Q===k.NeighborIndex.WEST?Y[0]:Y[2];const ma=ba?Q===k.NeighborIndex.SOUTH?Y[1]:Y[3]:Y[1]+na*(Y[3]-Y[1]),qa=J.surface.extent;if(n.isNone(qa)||g.containsXY(qa,ia,ma)){na=x.dist(C,E);ka=x.len(C)-f.earth.radius;ha=x.len(E)-f.earth.radius;const wa=na<Z;wa||(console.warn("Tile edge vertex position mismatch: between"+` [${J.lij}].edge${W}[${ca}/${aa.count}] and`+` [${V.lij}].edge${ea}[${fa}/${ja.count}]`),n.isSome(qa)&&console.warn("  surface extent\x3d ",qa," x,y\x3d",
ia,",",ma),ia=m.create(),x.subtract(ia,M.localOrigin,X.localOrigin),0<x.len(ia)&&console.warn(`   localOrigins: ${M.localOrigin} vs ${X.localOrigin}`+` d=${x.len(ia)} [${ia}]`),(()=>{const pa=m.clone(C),ra=m.clone(E);J.updateEdgeElevations();V.updateEdgeElevations();aa.getVertexPos(C,ca);ja.getVertexPos(E,fa);const va=m.create();x.sub(va,C,pa);0<x.len(va)&&console.warn(`  XXX Tile[${J.lij}] edge out of date: ${pa} vs ${C} d=${x.len(va)} [${va}]`);x.sub(va,E,ra);0<x.len(va)&&console.warn(`  XXX Neighbor[${V.lij}] edge out of date: ${ra} vs ${E} d=${x.len(va)} [${va}]`)})(),
h.internalAssert(wa,"Mismatch in tile"+` [${J.lij}].edge[${W}][${ca}/${aa.count}] vs neighbor`+` [${V.lij}].edge[${ea}][${fa}/${ja.count}]`+` ${h.v32s(C)} vs ${h.v32s(E)}  dist=${na} h(t|n|d)=${ka}|${ha}|${ha-ka}`));aa.getNormal(F,ca);ja.getNormal(H,fa);x.normalize(K,F);x.normalize(I,H);const xa=x.dot(K,I);ia=.01>1-xa||J===V;if(!ia){const pa=m.create();x.sub(pa,F,H);na=()=>`Mismatch in tile edge normal ${h.lij2s(J.lij)} (${ca}/${aa.count-1}) edge ${W} vs neighbor ${h.lij2s(V.lij)}  (${fa}/${ja.count-
1}) nedge ${ea} :`+`${h.v32s(F)} vs ${h.v32s(H)}  dot = ${xa} : ${h.v32s(pa)}`;console.warn("Mismatch in tile edge normal: ",na());J.updateEdgeElevations();V.updateEdgeElevations();ka=m.create();ha=m.create();aa.getNormal(ka,ca);ja.getNormal(ha,fa);x.equals(F,ka)||console.warn("Missing update in tile normal: ",h.v32s(F)," \x3d\x3e ",h.v32s(ka));x.equals(H,ha)||console.warn("Missing update in neighbor normal: ",h.v32s(H)," \x3d\x3e ",h.v32s(ha));h.internalAssert(ia,na())}}ca+=1;fa+=1}}}else h.internalAssert(!1)}}else h.internalAssert(!V.isLeaf),
h.internalAssert(0===T)}else Q=!J.surface.updatingRootTiles&&n.isSome(J.surface.rootTiles)&&0<J.surface.rootTiles.length&&J.shouldHaveNeighbor(Q),h.internalAssert(!Q)}})}}}}};b._createClass(R,[{key:"tile",get:function(){return this._tile}},{key:"hasGeometry",get:function(){return this._hasGeometry}},{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",
get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",get:function(){const J=n.mapOr(this.intersectionData,0,M=>M.estimatedMemoryUsage);return(this.geometryInfo.indices?.byteLength??0)+(this.geometryInfo.vertexAttributes?.byteLength??0)+J}},{key:"textureDescriptor",get:function(){return n.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=
this._texture}}}]);return R}();const C=m.create(),E=m.create(),F=m.create(),H=m.create(),K=m.create(),I=m.create(),L=[null,null,null,null];Object.defineProperty(a,"ActivationTime",{enumerable:!0,get:()=>r.ActivationTime});a.PatchRenderData=t;a.neighborTileIfLoadedOrSelf=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(){this.cornerTiles=
[null,null,null,null];this.cornerTileSamplerVersions=[-1,-1,-1,-1]}),w=b._createClass(function(){this.cornerNeighborData=[new c,new c,new c,new c];this.edgeResolutions=[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1];this.cornerPeerNeighbors=[null,null,null,null]});b=b._createClass(function(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.shading=this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new w});
a.CornerNeighborData=c;a.GeometryState=b;a.NeighborhoodData=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,b,c,w){let n=function(){function x(l){this._getFadeDuration=l;this._delayedTime=this._fadeStart=0}var m=x.prototype;m.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);
this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};m.push=function(l,g=a.ActivationTime.Immediate){this._delayed=c.destroyMaybe(this._delayed);this._push(l,g)};m._push=function(l,g){this._isFadingEnabled||this.clear();if(c.isNone(this._current))this._current=l;else{var f=x.test.fadeMoment||performance.now();g!==a.ActivationTime.Immediate?(this._delayed=l,this._delayedTime=f+g):c.isNone(this._next)?(this._next=l,this._fadeStart=this._alignFadeStart(f)):c.isNone(l)||
(c.destroyMaybe(this._waiting),this._waiting=l)}};m._alignFadeStart=function(l){const g=this._getFadeDuration();return l+g-l%g};b._createClass(x,[{key:"current",get:function(){if(c.isNone(this._current))return null;if(!this._isFadingEnabled){var l=this._delayed||this._waiting||this._next||this._current;l!==this._current&&(this._current=null,this.clear(),this._current=l)}l=x.test.fadeMoment;c.isSome(this._delayed)&&(l=l||performance.now(),l>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),
this._delayed=null));if(c.isSome(this._next)){l=l||performance.now();var g=this._fadeDuration;const f=c.isSome(this._current)&&this._next.texture===this._current.texture,d=this._next.type!==w.TextureUpdate.FADING;g=l-this._fadeStart>=g;if(f||d||g)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(l)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(c.isNone(this._next))return 1;
var l=x.test.fadeMoment||performance.now();l=Math.max(0,l-this._fadeStart);const g=this._fadeDuration;return l>g?0:1-l/g}},{key:"isFading",get:function(){return c.isSome(this._next)||c.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return c.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return x}();n.test={fadeMoment:0};a.ActivationTime=void 0;(function(x){x[x.Immediate=0]="Immediate";
x[x.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K){function I(Q){Q.dispose();Q instanceof q.ElevationTileAgent?M.release(Q):Q instanceof D.MapTileAgent&&J.release(Q)}function L(Q,W,V){return w.isNone(Q)||w.isNone(W)||W===Q?!1:Q.level>=W.level?R(Q,W,V):R(W,Q,A.oppositeCorner(V))}function R(Q,W,V){A.internalAssert(Q.level>=W.level);var T=A.isWestCorner(V),X=A.isNorthCorner(V),Z=Q.extent;V=W.extent;var Y=[T?Z[0]:Z[2],X?Z[3]:Z[1]];const aa=[T?V[2]:V[0],X?V[1]:V[3]];T=1E-5*(Z[2]-Z[0]);
X=A.almostEquals(Y[0],aa[0],T)||Q.surface.isGlobal&&A.almostEquals(Y[0],-aa[0],T);Y=A.almostEquals(Y[1],aa[1],T);if(X&&Y)return!0;if(Q.level===W.level||!X&&!Y)return A.internalAssert(!1),!1;X?(Q=Z[1],Z=Z[3],V=V[1]-T<=Q&&Q<=Z&&Z<=V[3]+T):(Q=Z[0],Z=Z[2],V=V[0]-T<=Q&&Q<=Z&&Z<=V[2]+T);A.internalAssert(V);return V}let O=function(){function Q(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=!0;this._previouslyRendered=!1;this.extent=e.create();
this._elevationBounds=m.create();this.layerInfo=[[],[]];this.extentInRadians=e.create();this.centerAtSeaLevel=g.create();this._center=[g.create(),k.create(),g.create()];this.up=g.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=0;this.distanceToPOI=-1;this._lastPOI=g.create()}
Q.prune=function(){J.prune(0);M.prune(0);C.TilePerLayerInfo.prune()};var W=Q.prototype;W.computeVisibility=function(){this._dirty=!1;var V=this.parent?.frustumVisibility??y.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=V===y.TileFrustumVisibility.INSIDE?y.TileFrustumVisibility.INSIDE:V===y.TileFrustumVisibility.OUTSIDE?y.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);V=this._frustumVisibility!==y.TileFrustumVisibility.OUTSIDE&&this._intersectsClippingArea;
V!==this._visible&&(this._visible=V,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())};W.init=function(V,T,X){this.lij[0]=V[0];this.lij[1]=V[1];this.lij[2]=V[2];this.ellipsoid=d.getReferenceEllipsoid(X.tilingScheme.spatialReference);X.tilingScheme.getExtent(V[0],V[1],V[2],this.extent);X.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+
this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;X.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.elevationLevel=V?V[0]:0;T&&T.elevationBounds?x.copy(this._elevationBounds,T.elevationBounds):x.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=T;this.unsetChildren();
this._surface=X;this.updateVisibility();for(const Z of B.LayerClasses){V=X.numLayers(Z);T=this.layerInfo[Z];for(const Y of T)Y.release();T.length=V;for(let Y=0;Y<V;Y++)T[Y]=C.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),Z===B.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(Y,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(X.tilingScheme.pixelSize,v.MAX_PATCH_TESSELATION)};W.release=function(){A.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);
for(var V of B.LayerClasses){for(const T of this.layerInfo[V])T.release();this.layerInfo[V].length=0}this._parent=null;for(V=0;4>V;++V)this._children[V]=null;this._surface=null;this.setMemoryDirty()};W.refMapData=function(){++this._mapDataRefCount;this._isCached||this._surface.upsampleMapCache.pop(this.key)};W.unrefMapData=function(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const V=this._cachedMemory;0<V&&this._surface.upsampleMapCache.put(this.key,this,V)}};W.setMemoryDirty=
function(){this._usedMemory=null};W._ensureUsedMemory=function(){if(w.isSome(this._usedMemory))return this._usedMemory;let V=this._mapTileMemoryInternal=this._usedMemory=0;for(var {data:T}of this.layerInfo[B.LayerClass.MAP])T instanceof p.VectorTile?V+=this._getTerrainDataMemory(T):this._mapTileMemoryInternal+=this._getTerrainDataMemory(T);T=this._cpuImageMemorySize;for(const X of this.layerInfo[B.LayerClass.ELEVATION])this._usedMemory+=X.data?T:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,
this._mapTileMemoryInternal+=K.getGpuMemoryUsage(this.renderData.textureDescriptor));this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+V);return this._usedMemory};W.getUsedMemoryForLayer=function(V,T){T=this.layerInfo[V][T];return T?.data?V===B.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(T.data):V===B.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0};W._getTerrainDataMemory=function(V){return V instanceof E?K.getGpuMemoryUsage(V.texture):
V instanceof HTMLImageElement||V instanceof h.ImageWithType?this._cpuImageMemorySize:V instanceof p.VectorTile||V instanceof z.RasterTile?V.memoryUsage:0};W.updateScreenDepth=function(V){var T=this._center[a.CenterPosition.MIDDLE];const X=T[0],Z=T[1];T=T[2];const Y=V[2]*X+V[6]*Z+V[10]*T+V[14];this.screenDepth=0>Y?0:Y/(V[3]*X+V[7]*Z+V[11]*T+V[15])};W.shouldSplit=function(V,T,X){if(!this.visible||w.isSome(V.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(V.frustum)===
y.TileFrustumVisibility.OUTSIDE))return F.TileUpdate.NONE;const Z=this.level;l.subtract(P,this._center[a.CenterPosition.MIDDLE],T);var Y=l.squaredLength(P),aa=P;let ia=a.CenterPosition.MIDDLE;l.subtract(U,this._center[a.CenterPosition.TOP],T);var na=l.squaredLength(U);na<Y&&(Y=na,aa=U,ia=a.CenterPosition.TOP);l.subtract(N,this._center[a.CenterPosition.BOTTOM],T);na=l.squaredLength(N);na<Y&&(Y=na,aa=N,ia=a.CenterPosition.BOTTOM);if(this._edgeLen2>Y&&Z<V.maxLod)return F.TileUpdate.SPLIT;const ba=w.isSome(X)?
X-Z:Infinity;Y=Math.sqrt(Y);const ea=this._edgeLen/(V.fovX*Y*2),ja=()=>{if(Z<V.maxLod)return this.elevationLevel=Z,F.TileUpdate.NONE;const ha=Z+Math.ceil(-Math.log2(V.relativeWidthLimit/ea));return ha!==this.elevationLevel?(this.elevationLevel=ha,F.TileUpdate.ELEVATION):F.TileUpdate.NONE};if(.5>=ba)return ja();const ka=l.dot(this.up,P);na=this._elevationBounds[1]-this._elevationBounds[0];const da=na/this.edgeLen;if(V.aboveGround&&0<ka&&.001>da&&0<ka/Y-Math.sin(this._curvatureHeight/(this.edgeLen*
Math.SQRT1_2)*Math.PI)-da)return F.TileUpdate.NONE;X=w.isSome(X)?3-Math.min(ba,2):1;if(ea*X<V.relativeWidthLimit||Z>=V.maxLod)return ja();if(7>Z)return F.TileUpdate.SPLIT;l.scale(S,this.up,ka);l.subtract(S,S,aa);aa=l.squaredLength(S);if(aa<=this.radius*this.radius)return F.TileUpdate.SPLIT;l.scale(S,S,this.radius/Math.sqrt(aa));l.add(S,S,this._center[ia]);l.subtract(S,T,S);return Math.min(1,(Math.abs(l.dot(S,this.up))+.5*na+this._curvatureHeight)/l.length(S))*(this._edgeLen/(V.fovY*Y*2))*X<.1/V.angledSplitBias*
V.relativeHeightLimit?F.TileUpdate.NONE:F.TileUpdate.SPLIT};W.setChildren=function(V,T,X,Z){A.weakAssert(!!(V&&T&&X&&Z),"Null child passed");this._children[0]=V;this._children[1]=T;this._children[2]=X;this._children[3]=Z};W.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};W.load=function(){this.refMapData();for(const V of B.LayerClasses)this._createOrUpdateAgents(0,V);this.surface.renderer.loadTile(this)};W.unload=function(V){V.unloadTile(this);
for(const T of B.LayerClasses){V=this.layerInfo[T];for(const X of V)X.loadingAgent&&X.loadingAgent!==t.TILE_AGENT_DONE&&(I(X.loadingAgent),X.loadingAgent=null),X.pendingUpdates=0}this.resetPendingUpdate(F.TileUpdate.GEOMETRY);this.resetPendingUpdate(F.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(F.TileUpdate.TEXTURE_FADING);this.unrefMapData()};W.unloadMapData=function(){const V=this.layerInfo[B.LayerClass.MAP];for(const T of V)T.loadingAgent&&T.loadingAgent!==t.TILE_AGENT_DONE&&(I(T.loadingAgent),
T.loadingAgent=null),T.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};W.updateClippingStatus=function(V){if(e.equals(V,this._clippingArea))return!1;var T=this._intersectsClippingArea;const X=this._isWithinClippingArea;w.isSome(V)?(this._intersectsClippingArea=this.intersectsExtent(V),this._isWithinClippingArea=this._isWithinExtent(V)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=V;this.updateVisibility();V=X&&this._isWithinClippingArea;
T=!X&&!T&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||V||T||this.setPendingUpdate(F.TileUpdate.GEOMETRY);return!0};W.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};W.getLayerInfo=function(V,T){return this.layerInfo[T][V]};W.hasLayerData=function(V,T){V=this.layerInfo[T][V];return!(!V||!V.data||V.dataInvalidated)};W._isSuspended=function(V){return this.hasPendingUpdate(F.TileUpdate.SPLIT)?!0:V===B.LayerClass.ELEVATION?!1:!this.loadable};
W.hasPendingUpdate=function(V){return(this._pendingUpdates&V)===V};W.setPendingUpdate=function(V){this._pendingUpdates|=V;V===F.TileUpdate.SPLIT||V===F.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};W.resetPendingUpdate=function(V){return this.hasPendingUpdate(V)?(this._pendingUpdates&=~V,!0):!1};W.requestLayerData=function(V,T,X){const Z=this.layerInfo[T][V];if(Z.waitingAgents.has(X))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),X.tile.lij.toString(),T,V),!0;Z.waitingAgents.push(X);if(Z.data&&!Z.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),X.tile.lij.toString(),T,V),X.dataArrived(this),!0;if(Z.requestPromise)return!0;w.abortMaybe(Z.requestAbort);Z.requestAbort=new AbortController;const Y=this._surface.requestTileData(this,V,T,Z.requestAbort);if(!Y)return Z.requestAbort=null,!1;V=()=>{Z.requestPromise===Y&&(Z.requestPromise=
null,Z.requestAbort=null)};Z.requestPromise=Y;Y.then(V,V);return!0};W.hasLij=function(V){return this.lij[0]===V[0]&&this.lij[1]===V[1]&&this.lij[2]===V[2]};W.findByLij=function(V){if(this.hasLij(V))return this;const T=this._children;return T[0]?T[0].findByLij(V)||T[1].findByLij(V)||T[2].findByLij(V)||T[3].findByLij(V):null};W.distanceToSquared=function(V){return l.squaredLength(l.subtract(S,this._center[a.CenterPosition.MIDDLE],V))};W.containsPoint=function(V){const T=this.extent;return V[0]>=T[0]&&
V[1]>=T[1]&&V[0]<=T[2]&&V[1]<=T[3]};W.containsPointXY=function(V,T){const X=this.extent;return V>=X[0]&&T>=X[1]&&V<=X[2]&&T<=X[3]};W.unrequestLayerData=function(V,T,X){V=this.layerInfo[T][V];T=V.waitingAgents;X=null!=T.removeUnordered(X);A.weakAssert(X,"agent has not requested this piece of map data");1>T.length&&(V.abortRequest(),this.setMemoryDirty())};W.dataArrived=function(V,T,X){V=this.layerInfo[T][V];V.data=X;V.dataInvalidated=!1;V.waitingAgents.forAll(Z=>Z.dataArrived(this));V.waitingAgents.clear();
this.setMemoryDirty()};W.dataMissing=function(V,T,X){X.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${T}/${V} error ${X}`);V=this.layerInfo[T][V];V.dataMissing=!0;V.waitingAgents.forAll(Z=>Z.dataMissing());V.waitingAgents.clear();this.setMemoryDirty()};W.updateRenderData=function(V,T){switch(V){case B.LayerClass.MAP:return this._updateTexture(T);case B.LayerClass.ELEVATION:return this._updateGeometry()}};W._updateTexture=function(V){this.renderData&&(this.resetPendingUpdate(V===
y.TextureUpdate.FADING?F.TileUpdate.TEXTURE_NOFADING:F.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(V===y.TextureUpdate.FADING?F.TileUpdate.TEXTURE_FADING:F.TileUpdate.TEXTURE_NOFADING))};W._updateGeometry=function(){this.setPendingUpdate(F.TileUpdate.GEOMETRY);for(const V of this.layerInfo[B.LayerClass.ELEVATION])V.pendingUpdates|=F.TileUpdate.GEOMETRY};W.invalidateLayerData=function(V,T){this.layerInfo[T][V].invalidateSourceData();this.restartAgents(T)};W.computeElevationBounds=function(){const V=
this._elevationBounds,T=V[0],X=V[1];x.set(V,Infinity,-Infinity);const Z=this.layerInfo[B.LayerClass.ELEVATION];let Y=!0;for(const aa of Z)w.isSome(aa.elevationBounds)&&(V[0]=Math.min(V[0],aa.elevationBounds.min),V[1]=Math.max(V[1],aa.elevationBounds.max),aa.elevationBounds.hasNoDataValues||(Y=!1));Y&&(V[0]=Math.min(V[0],0),V[1]=Math.max(V[1],0));if(T!==V[0]||X!==V[1])this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()};W._updateCenter=function(){const V=this._elevationBounds,T=this._center;
l.scale(S,this.up,.5*(V[0]+V[1]));l.add(T[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,S);l.scale(S,this.up,V[0]);l.add(T[a.CenterPosition.TOP],this.centerAtSeaLevel,S);l.scale(S,this.up,V[1]);l.add(T[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,S)};W.findElevationBoundsForLayer=function(V,T){const X=this.layerInfo[B.LayerClass.ELEVATION][V],Z=v.getElevationDesiredResolutionLevel(this.level),Y=Math.max(this.elevationLevel-Z,0);var aa=X.elevationBounds;if(!(w.isSome(aa)&&aa.level>=T&&aa.level<=
Y)&&(T=this._surface.layerViewByIndex(V,B.LayerClass.ELEVATION),T=A.getLayerWithExtentRange(T),H.fallsWithinLayer(this,T,!1))){T=G;aa=!1;var ia=X.data;if(ia&&ia.level<=Y)V=X.data,T.min=V.samplerData.data.minValue,T.max=V.samplerData.data.maxValue,T.hasNoDataValues=V.samplerData.data.hasNoDataValues,T.level=this.level,aa=!0;else{ia=0;let na,ba;for(let ea=this._parent;ea&&(!ba||ia<Z)&&!(ia=this.elevationLevel-ea.level,na=ba||na,ba=ea.layerInfo[B.LayerClass.ELEVATION][V].data,!ba&&na&&ea.level<=Y);ea=
ea.parent);if(ba=ba||na)ba.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],T),Infinity!==T.min&&(T.level=ba.level,aa=!0)}aa&&(w.isNone(X.elevationBounds)&&(X.elevationBounds=new r.ElevationBounds),X.elevationBounds.copyFrom(T))}};W.modifyLayers=function(V,T,X){X=this.layerInfo[X];for(var Z of X)Z.loadingAgent&&Z.loadingAgent!==t.TILE_AGENT_DONE&&(I(Z.loadingAgent),Z.loadingAgent=null),Z.waitingAgents.clear();for(Z=0;Z<X.length;++Z)void 0===V[Z]&&X[Z].release();V=Array(...X);Z=T.length;X.length=
Z;for(let Y=0;Y<Z;Y++){const aa=T[Y];X[Y]=-1<aa?V[aa]:C.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()};W.restartAgents=function(V){this.renderData&&(this._createOrUpdateAgents(0,V),this.updateRenderData(V,y.TextureUpdate.FADING))};W.updateAgents=function(V){if(this.renderData){const T=this.layerInfo[V];for(const X of T)X.loadingAgent===t.TILE_AGENT_DONE&&(X.loadingAgent=null);this._createOrUpdateAgents(0,V)}};W.updateAgentSuspension=function(){for(const V of B.LayerClasses){const T=
this._isSuspended(V);for(const X of this.layerInfo[V])X.loadingAgent&&X.loadingAgent!==t.TILE_AGENT_DONE&&(X.loadingAgent.setSuspension(T),X.loadingAgent===t.TILE_AGENT_DONE&&this.updateRenderData(V,y.TextureUpdate.FADING))}};W.removeLayerAgent=function(V,T){V=this.layerInfo[T][V];V.loadingAgent&&V.loadingAgent!==t.TILE_AGENT_DONE&&V.loadingAgent.dispose();V.loadingAgent=null};W.agentDone=function(V,T){const X=this.layerInfo[T][V];X.loadingAgent=t.TILE_AGENT_DONE;!X.data&&w.isNone(X.upsampleInfo)&&
this._createOrUpdateAgents(V+1,T)};W._hasBlendableAncestor=function(V){return"normal"!==V.blendMode||u.isGroupLayer(V.parent)&&this._hasBlendableAncestor(V.parent)};W._hasBlendModes=function(V,T,X){for(;V<T;++V){const Z=this._surface.layerViewByIndex(V,X);if(A.isBlendableLayerView(Z)&&"normal"!==Z?.layer?.blendMode||u.isGroupLayer(Z?.layer?.parent)&&this._hasBlendableAncestor(Z?.layer?.parent))return!0}return!1};W._createOrUpdateAgents=function(V,T){const X=this.layerInfo[T];if(0!==X.length){var Z=
this._isSuspended(T);for(let na=V;na<X.length;++na){const ba=X[na];var Y=!1;const ea=this._surface.layerViewByIndex(na,T);var aa=A.getLayerWithExtentRange(ea);if(ba.loadingAgent)H.fallsWithinLayer(this,aa,!1)?(ba.loadingAgent!==t.TILE_AGENT_DONE&&ba.loadingAgent.setSuspension(Z),ba.loadingAgent!==t.TILE_AGENT_DONE&&(Y=ba.loadingAgent.update())):ba.dispose();else if(H.fallsWithinLayer(this,aa,!1)){Y=na;aa=T;var ia=Z;const ja=aa===B.LayerClass.ELEVATION?M.acquire():J.acquire();ja.init(this,Y,aa,ia);
ba.loadingAgent=ja;(Y=ba.loadingAgent.startLoading())?ba.loadingAgent===t.TILE_AGENT_DONE&&this.setPendingUpdate(F.TileUpdate.GEOMETRY):(I(ba.loadingAgent),ba.loadingAgent=t.TILE_AGENT_DONE)}ba.loadingAgent===t.TILE_AGENT_DONE&&this.updateRenderData(T,y.TextureUpdate.FADING);if(!this._hasBlendModes(V,X.length,T)&&Y&&ea.isOpaque)break}}};W._isWithinExtent=function(V){const T=this.extent;return T[0]>=V[0]&&V[2]>=T[2]&&T[1]>=V[1]&&V[3]>=T[3]};W.intersectsExtent=function(V){const T=this.extent;return T[2]>=
V[0]&&V[2]>=T[0]&&T[3]>=V[1]&&V[3]>=T[1]};W.getElevationVerticesPerSide=function(V){var T=this.elevationLevel-this.level;V=Math.max(this.level-V,v.getElevationDesiredResolutionLevel(this.level)-T);V=c.clamp((this.maxTesselation>>V)+1,2,this.maxTesselation+1);T=this.getDefaultVerticesPerSide();return Math.max(V,T)};W._findLIJ=function(V,T){if(!V)return null;var X=this.surface.rootTiles;if(w.isSome(X))for(var Z of X){X=Z.level;var Y=V[0];X>Y?X=!1:(X=Y-X,Y=Math.floor(V[2]/2**X),X=Math.floor(V[1]/2**
X)===Z.lij[1]&&Y===Z.lij[2]);if(X){for(X=V[0]-Z.level-1;0<=X&&!Z.isLeaf&&!T(Z);)Z=Z.children[2*(V[1]>>X&1)+(V[2]>>X&1)],X--;return T(Z)?Z:null}}return null};W.findNeighborTile=function(V,T){const X=this.lij;return(V=this.getNeighborLIJ(X,V))?X[0]===V[0]&&X[1]===V[1]&&X[2]===V[2]?T(this)?this:null:this._findLIJ(V,T):null};W.findCorner=function(V,T){V=V===y.NeighborIndex.NORTH_EAST?1:V===y.NeighborIndex.NORTH_WEST?0:V===y.NeighborIndex.SOUTH_WEST?2:3;let X=this;for(;X.children[0]&&(!T||!T(X));)X=X.children[V];
return X};W.findNeighborCornerTileExact=function(V,T){return this.findNeighborTile(V,X=>T(X)||X.level===this.level)?.findCorner(A.oppositeCorner(V),T)||null};W.forAllSubtreeOnSide=function(V,T){const X=V===y.NeighborIndex.NORTH?[0,1]:V===y.NeighborIndex.NORTH_EAST?[1]:V===y.NeighborIndex.EAST?[1,3]:V===y.NeighborIndex.SOUTH_EAST?[3]:V===y.NeighborIndex.SOUTH?[2,3]:V===y.NeighborIndex.SOUTH_WEST?[2]:V===y.NeighborIndex.WEST?[0,2]:[0],Z=Y=>{const aa=Y.children;!T(Y)&&aa[0]&&X.forEach(ia=>Z(aa[ia]))};
Z(this)};W.forallNeighbors=function(V){A.neighborCornerIndices.forEach(T=>this.findNeighborCornerTileExact(T,V));A.neighborEdgeIndices.forEach(T=>this.findNeighborTile(T,X=>X.level===this.level||V(X))?.forAllSubtreeOnSide(A.oppositeEdge(T),V))};W.getNeighborEdgeStartVertexIndex=function(V,T){if(!T)return 0;var X=this.level-T.level;A.internalAssert(!A.ENABLE_TERRAIN_INTERNAL_CHECKS||0<=X);if(0===X)return 0;X=2**X;var Z=(V=1===(V&1))?0:1;T=T.lij[Z+1]*X;Z=this.lij[Z+1];const Y=Z-T;V=V?X-1-Y:Y;A.ENABLE_TERRAIN_INTERNAL_CHECKS&&
(A.internalAssert(T<=Z&&Z<T+X),A.internalAssert(0<=V&&V<X));return V};W.forEachLoadedNeighbor=function(V){const T=this.level,X=Z=>Z.level===T||Z.isLoaded;A.neighborEdgeIndices.forEach(Z=>{const Y=this.findNeighborTile(Z,X);null!=Y&&Y!==this&&Y.forAllSubtreeOnSide(A.oppositeEdge(Z),aa=>aa.isLoaded?(V(aa,Z),!0):!1)});A.neighborCornerIndices.forEach(Z=>{const Y=this.findNeighborTile(Z,X)?.findCorner(A.oppositeCorner(Z),aa=>aa.isLoaded);A.internalAssert(!Y||L(this,Y,Z));Y?.isLoaded&&V(Y,Z)})};W.getNeighborLIJ=
function(V,T){const X=A.isNorth(T)?-1:A.isSouth(T)?1:0;T=A.isWest(T)?-1:A.isEast(T)?1:0;V=[V[0],V[1]+X,V[2]+T];return 0>V[1]?null:this.surface.isGlobal?this.wrapLIJ(V):0>V[2]?null:V};W.wrapLIJ=function(V){return!V||0>V[1]||V[1]>=2**V[0]?null:this.surface.wrapEastWest(V)};W.checkGeometryWaterproofness=function(){A.ENABLE_WATERPROOFNESS_TESTS&&(A.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())};W.shouldHaveNeighbor=function(V){const T=this.extent,X=this.surface.rootTilesExtent,
Z=.25*(T[2]-T[0]);if(A.isNorth(V)&&T[3]+Z>=X[3]||A.isSouth(V)&&T[1]-Z<=X[1])return!1;const Y=this.surface.isGlobal;return!Y&&A.isWest(V)&&T[0]-Z<=X[0]||!Y&&A.isEast(V)&&T[2]+Z>=X[2]?!1:!0};W.updateDistanceToPOI=function(V){var T=this._lastPOI;if(!(0<=this.distanceToPOI&&T[0]===V[0]&&T[1]===V[1]&&T[2]===V[2])){l.copy(this._lastPOI,V);var X=this._center[a.CenterPosition.MIDDLE];T=V[0]-X[0];var Z=V[1]-X[1];V=V[2]-X[2];this.distanceToPOI=T*T+Z*Z+V*V}};b._createClass(Q,[{key:"_isCached",get:function(){return!this.shouldLoad&&
0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",
get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"frustumVisibility",get:function(){this._dirty&&this.computeVisibility();return this._frustumVisibility}},
{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const V=!!this.renderData;V!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=V,this._surface.renderer.setDirty());return V}},{key:"shouldLoad",get:function(){return this.isLeaf}},{key:"usedMemory",get:function(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}},{key:"_cachedMemory",get:function(){return this._isCached?
this._mapTileMemory:0}},{key:"_mapTileMemory",get:function(){this._ensureUsedMemory();return this.layerInfo[B.LayerClass.MAP].reduce((V,T)=>V+(T instanceof p.VectorTile?T.memoryUsage:0),this._mapTileMemoryInternal)}},{key:"_cpuImageMemorySize",get:function(){const V=this._surface.tilingScheme.pixelSize;return V*V*4}},{key:"isLoaded",get:function(){return this.renderData?.hasGeometry??!1}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(const V of B.LayerClasses){const T=this.layerInfo[V];
for(const X of T)if(X.loadingAgent&&X.loadingAgent!==t.TILE_AGENT_DONE&&X.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this._cachedMemory}}},{key:"westNeighborWestExtent",get:function(){return this.extent[0]*(this.isWestEnd?-1:1)}},{key:"eastNeighborEastExtent",get:function(){return this.extent[2]*(this.isEastEnd?-1:1)}},
{key:"isEastEnd",get:function(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}},{key:"isWestEnd",get:function(){return 0===this.lij[2]}},{key:"isNorthEnd",get:function(){return 0===this.lij[1]}},{key:"isSouthEnd",get:function(){return this.extent[1]+f.getEpsilon()>=this.surface.extent[1]}}]);return Q}();const J=new n(D.MapTileAgent),M=new n(q.ElevationTileAgent),G=new r.ElevationBounds;a.CenterPosition=void 0;(function(Q){Q[Q.TOP=0]="TOP";Q[Q.MIDDLE=1]="MIDDLE";Q[Q.BOTTOM=2]="BOTTOM"})(a.CenterPosition||
(a.CenterPosition={}));const P=g.create(),U=g.create(),N=g.create(),S=g.create();a.Tile=O;a.isCornerNeighbor=L;a.isEdgeNeighbor=function(Q,W,V){if(w.isNone(Q)||w.isNone(W))return!1;if(0===Q.level&&0===W.level&&(Q.isEastEnd&&W.isWestEnd&&V===y.NeighborIndex.EAST||Q.isWestEnd&&W.isEastEnd&&V===y.NeighborIndex.WEST))return!0;const T=Math.max(1E-6*(Q.extent[2]-Q.extent[0]),1);switch(V){case y.NeighborIndex.NORTH:return A.almostEquals(Q.extent[3],W.extent[1],T);case y.NeighborIndex.SOUTH:return A.almostEquals(Q.extent[1],
W.extent[3],T);case y.NeighborIndex.EAST:return A.almostEquals(Q.extent[2],W.extent[0],T)||A.almostEquals(Q.extent[2],-W.extent[0],T);case y.NeighborIndex.WEST:return A.almostEquals(Q.extent[0],W.extent[2],T)||A.almostEquals(Q.extent[0],-W.extent[2],T)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,w){w=function(n){function x(){var l=
m.apply(this,arguments);l._scaleRangeEnabled=!1;return l}b._inherits(x,n);var m=b._createSuper(x);b._createClass(x,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return x}(w.TileAgent);a.ElevationTileAgent=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,w,n,x,m){let l=function(){function d(){}var e=d.prototype;e.init=function(k,u,p,h){this.tile=k;this._layerIdx=u;this._layerClass=p;this._suspended=h;this._tileLayerInfo=k.getLayerInfo(u,p);this._tileRequested=null;k=this._findAncestorWithData();this._setUpsampleTile(k)};e.startLoading=function(){return this._requestNext()};e.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=
this.tile=null};e.setSuspension=function(k){k!==this._suspended&&((this._suspended=k)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};e.update=function(){const k=this._findAncestorWithData();this._setUpsampleTile(k);return this._requestNext()};e.dataArrived=function(k){this._setUpsampleTile(k);this._tileRequested=null;k===this.tile?this.tile.updateRenderData(this._layerClass,w.TextureUpdate.FADING):
this._requestNext()};e.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};e._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};e._requestNext=function(){if(this._suspended)return!0;const k=this._findNextDownload();if(this._tileRequested){if(k===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}c.isSome(k)?k.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=k):this._agentDone();return!!this._tileRequested};e._findNextDownload=function(){const k=this._layerIdx,u=this._layerClass;var p=this.tile.surface.layerViewByIndex(k,u),h=x.getLayerWithExtentRange(p);const {minLevel:r,maxLevel:q}=p.dataLevelRange;p=this._desiredMinLevelDelta;const y=this._progressiveLevelModulo+p,B=this._scaleRangeEnabled?m.fallsWithinLayer:()=>!0;let D=this.tile;const z=D.level;let v;const A=this._tileLayerInfo.upsampleInfo,t=c.isSome(A)?
A.tile.level:-1,C=c.isSome(A)?t-z>=p:!1,E=c.get(h,"tilemapCache");for(;D&&B(D,h,!1)&&D.level>=r;){const F=D.level,H=z-F,K=D.layerInfo[u][k];if(K.data&&H>=p){(!C||F>t)&&this._setUpsampleTile(D);K.dataInvalidated&&(v=D);break}if((c.isNone(E)||"unavailable"!==E.getAvailability(D.lij[0],D.lij[1],D.lij[2]))&&F<=q&&!K.data&&!K.dataMissing){if(c.isNone(v)||D.level===r||0===F%n.PROGRESSIVE_LOADING_MODULO||z-v.level<p)v=D;if(H>=y)break}D=D.parent}c.isSome(v)&&z-v.level<p&&(A?v=null:(h=this._findAncestorWithData(),
c.isSome(h)&&(this._setUpsampleTile(h),v=h.layerInfo[u][k].dataInvalidated?h:null)));return v};e._findAncestorWithData=function(){const k=this.tile.elevationLevel,u=this._desiredMinLevelDelta;let p;for(let h=this.tile;h;h=h.parent)if(h.hasLayerData(this._layerIdx,this._layerClass)){if(k-h.level>=u)return h;p=h}return p};e._setUpsampleTile=function(k){this._tileLayerInfo.setUpsampleInfo(this.tile,k);this.tile.updateRenderData(this._layerClass,w.TextureUpdate.FADING)};b._createClass(d,[{key:"updating",
get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return d}();var g=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);e.prototype.dispose=function(){};b._createClass(e,[{key:"_desiredMinLevelDelta",get:function(){throw f;}},{key:"_progressiveLevelModulo",get:function(){throw f;}}]);return e}(l);const f=Error("Abstract method called on TileAgent");
g=new g;a.TILE_AGENT_DONE=g;a.TileAgent=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray","./RenderOrder"],function(a,b,c,w,n){function x(h,r){r(h);if(!h.isLeaf)for(const q of h.children)x(q,r)}function m(h,r){h=h.lij;r=r.lij;return h[0]-r[0]||h[1]-r[1]||h[2]-r[2]}function l(h,r){const q=r.screenDepth-h.screenDepth;if(0!==q)return q;
h=h.lij;r=r.lij;return h[0]-r[0]||h[1]-r[1]||h[2]-r[2]}function g(h,r){const q=h.screenDepth-r.screenDepth;if(0!==q)return q;h=h.lij;r=r.lij;return h[0]-r[0]||h[1]-r[1]||h[2]-r[2]}function f(h,r,q){const y=h.screenDepth,B=r.screenDepth;return y<B?-q:y>B?q:m(h,r)}function d(h,r,q,y){const B=e(h,y);y=e(r,y);return B===y?f(h,r,q):h?q:-q}function e(h,r){for(const q of r)if(h.intersectsExtent(q))return!0;return!1}function k(h,r){const q=h.distanceToPOI-r.distanceToPOI;if(0!==q)return q;h=h.lij;r=r.lij;
return h[0]-r[0]||h[1]-r[1]||h[2]-r[2]}let u=function(){function h(){this._queue=new w;this.remove=()=>{}}var r=h.prototype;r.resetOne=function(q){this._queue.clear();this._queue.push(q);this._last=void 0};r.reset=function(q=null){this._queue.clear();c.isSome(q)&&this._queue.pushArray(q);this._last=void 0};r.skipSubtree=function(){this._last=void 0};r.next=function(){const q=this._last?.children;q&&q[0]&&this._queue.pushArray(q);return this._last=this._queue.pop()};b._createClass(h,[{key:"done",get:function(){return 0===
this._queue.length&&(!this._last||this._last.isLeaf)}}]);return h}(),p=function(){function h(){this._q=new w}var r=h.prototype;r.reset=function(q){this._q.clear();if(!c.isNone(q))for(this._q.pushArray(q),q=0;q<this._q.length;++q){const y=this._q.data[q];y.isLeaf||this._q.pushArray(y.children)}};r.next=function(){return this._q.pop()};b._createClass(h,[{key:"done",get:function(){return 0===this._q.length}}]);return h}();a.IteratorPostorder=p;a.IteratorPreorder=u;a.compareTiles=f;a.compareTilesByLij=
m;a.compareTilesWithStencil=d;a.computeUpsampleInfo=function(h,r,q){let y=1,B=0,D=0;for(;h!==r;)if(y*=.5,B*=.5,D*=.5,h.lij[2]&1&&(B+=.5),0===(h.lij[1]&1)&&(D+=.5),h=h.parent,null==h)throw Error("tile was not a descendant of upsampleTile");q.init(r,B,D,y)};a.fallsWithinLayer=function(h,r,q){if(c.isNone(r)||c.isNone(r.fullExtent))return!1;const y=r.fullExtent,B=h.extent;if(q){if(B[0]<y.xmin||B[1]<y.ymin||B[2]>y.xmax||B[3]>y.ymax)return!1}else if(y.xmin>B[2]||y.ymin>B[3]||y.xmax<B[0]||y.ymax<B[1])return!1;
h=h.surface.tilingScheme.levels[h.level].scale;q=r.minScale;if(0<q&&h>1.00000001*q)return!1;r=r.maxScale;return 0<r&&h<.99999999*r?!1:!0};a.hasLoadableSiblings=function(h){for(let r=0;r<h.length;r++){const q=h[r],y=q.parent;if(y)for(let B=0;4>B;B++){const D=y.children[B];if(D&&D!==q)return!0}}return!1};a.sortTiles=function(h,r,q=null){c.isNone(q)||0===q.length?h===n.RenderOrder.BACK_TO_FRONT?r.sort(l):r.sort(g):r.sort((y,B)=>d(y,B,h,q))};a.sortTilesByPOI=function(h,r){const q=h.length;for(let y=0;y<
q;++y)h.getItemAt(y).updateDistanceToPOI(r);h.sort(k)};a.tilesAreRelated=function(h,r){if(!h||!r||h[0]===r[0])return!1;const q=h[0]<r[0],y=q?h:r;h=q?r:h;r=1<<h[0]-y[0];return Math.floor(h[1]/r)===y[1]&&Math.floor(h[2]/r)===y[2]};a.traverseTilesPreorder=function(h,r){if(Array.isArray(h))for(let q=0;q<h.length;q++)x(h[q],r);else x(h,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=
a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,w){w=function(n){function x(){var l=m.call(this);l._scaleRangeEnabled=!0;return l}b._inherits(x,n);var m=b._createSuper(x);b._createClass(x,[{key:"_desiredMinLevelDelta",
get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return x}(w.TileAgent);a.MapTileAgent=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),function(a,b,c,w,n,x){const m={bandCount:3,outMin:0,outMax:1,minCutOff:[0,
0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let l=function(){function g(d,e,k=null,u=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=d;this.source=
e;this.width=k||e.width;this.height=u||e.height}var f=g.prototype;f.bind=function(d){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(c.isNone(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(d,this.bandIds);c.isSome(this._rasterTexture)&&(this._updateColormapTexture(d),this.transformGrid&&c.isNone(this._transformGridTexture)&&(this._transformGridTexture=x.createTransformTexture(d,this.transformGrid)));return!0};f.getUniforms=function(){const {symbolizerParameters:d,
transformGrid:e,width:k,height:u,opacity:p}=this,h=x.getCommonUniforms(e,[k,u],[this.source.width,this.source.height],p),r=x.getColormapUniforms(d.colormap,d.colormapOffset),q="stretch"===this.symbolizerParameters.type?x.getStretchUniforms(this.symbolizerParameters):null,y="hillshade"===this.symbolizerParameters.type?x.getShadedReliefUniforms(this.symbolizerParameters):null;return new w.ColorizerUniforms(h,r,q||y,this._rasterTexture,this._transformGridTexture,this._colormapTexture)};f.release=function(){this._rasterTexture=
c.disposeMaybe(this._rasterTexture);this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};f._updateRasterTexture=function(d,e){const k=this.source?this.source.extractBands(e):null;k&&k.pixels&&0<k.pixels.length?(e=c.isNone(e)&&c.isNone(this.bandIds)||c.isSome(e)&&c.isSome(this.bandIds)&&e.join("")===this.bandIds.join(""),c.isSome(this._rasterTexture)&&e||(this._rasterTexture=
c.disposeMaybe(this._rasterTexture),e=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=x.createRasterTexture(d,k,e,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=c.disposeMaybe(this._rasterTexture)};f.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};f._getRasterTextureInterpolation=function(d){return"lut"===
this.symbolizerParameters.type||"nearest"===d||"majority"===d||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"};f._updateColormapTexture=function(d){const e=this._colormap,k=this.symbolizerParameters.colormap;if(!k)this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!e)this._colormapTexture=x.createColormapTexture(d,k),this._colormap=k;else if(k.length!==e.length||k.some((u,p)=>u!==e[p]))this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormapTexture=
x.createColormapTexture(d,k),this._colormap=k};b._createClass(g,[{key:"source",get:function(){return this._source},set:function(d){this._source=d;this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...m,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||m},set:function(d){this._symbolizerParameters=d}},{key:"bandIds",get:function(){return this._bandIds},set:function(d){c.isSome(d)&&0<
d.length?this._bandIds&&d.every((e,k)=>this._bandIds?.[k]?e===this._bandIds[k]:!1)||(this._bandIds=d,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(d){this._interpolation=d;c.isSome(this._rasterTexture)&&(d=this._getRasterTextureInterpolation(d),this._rasterTexture.setSamplingMode("bilinear"===d?n.TextureSamplingMode.LINEAR:n.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},
set:function(d){this._transformGrid=d;this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"isBilinearWithStretchColorRamp",get:function(){const {symbolizerParameters:d}=this;return"bilinear"===this.interpolation&&null!=d.colormap&&"stretch"===d.type}},{key:"memoryUsage",get:function(){c.isNone(this._memoryUsed)&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(d=>c.isSome(d)?d.descriptor.width*d.descriptor.height*
4:0).reduce((d,e)=>d+e,0));return this._memoryUsed}}]);return g}();a.RasterTile=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){function q(t){const C=new h.ShaderBuilder;C.include(l.TileComposite);C.include(x.Common,t);C.include(n.Colormap,t);C.include(m.TileBackground,t);C.fragment.code.add(p.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);t.colorizerType===w.RasterColorizerType.Stretch?y(C,t):t.colorizerType===w.RasterColorizerType.Lut?C.fragment.code.add(p.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):t.colorizerType===w.RasterColorizerType.Hillshade&&B(C,t);return C}function y(t,C){t.fragment.uniforms.add([new u.IntegerPassUniform("u_bandCount",F=>F.symbolizer.u_bandCount),new k.FloatsPassUniform("u_minCutOff",F=>F.symbolizer.u_minCutOff,3),new k.FloatsPassUniform("u_maxCutOff",F=>F.symbolizer.u_maxCutOff,3),new k.FloatsPassUniform("u_factor",F=>F.symbolizer.u_factor,3),new e.FloatPassUniform("u_minOutput",F=>F.symbolizer.u_minOutput),new e.FloatPassUniform("u_maxOutput",F=>F.symbolizer.u_maxOutput),
new f.BooleanPassUniform("u_useGamma",F=>F.symbolizer.u_useGamma),new k.FloatsPassUniform("u_gamma",F=>F.symbolizer.u_gamma,3),new k.FloatsPassUniform("u_gammaCorrection",F=>F.symbolizer.u_gammaCorrection,3),new e.FloatPassUniform("u_opacity",F=>F.common.u_opacity)]);t.fragment.code.add(p.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const E=C.applyColormap?p.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:p.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(p.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${C.stretchType===w.RasterColorizerStretchType.Noop?p.glsl`
        fragColor = applyBackgroundBlend(currentPixel);`:p.glsl`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${E}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function B(t,C){t=t.fragment;t.uniforms.add([new r.Texture2DPassUniform("u_image",E=>E.u_image),new u.IntegerPassUniform("u_hillshadeType",E=>E.symbolizer.u_hillshadeType),new k.FloatsPassUniform("u_sinZcosAs",E=>E.symbolizer.u_sinZcosAs,6),new k.FloatsPassUniform("u_sinZsinAs",E=>E.symbolizer.u_sinZsinAs,6),new k.FloatsPassUniform("u_cosZs",E=>E.symbolizer.u_cosZs,6),new k.FloatsPassUniform("u_weights",E=>E.symbolizer.u_weights,6),new d.Float2PassUniform("u_factor",E=>E.symbolizer.u_factor),
new e.FloatPassUniform("u_minValue",E=>E.symbolizer.u_minValue),new e.FloatPassUniform("u_maxValue",E=>E.symbolizer.u_maxValue),new d.Float2PassUniform("u_srcImageSize",E=>E.common.u_srcImageSize)]);t.include(g.ColorConversion);t.code.add(p.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);t.code.add(p.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);C=C.applyColormap?p.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:p.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;t.code.add(p.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${C}
    }
  `)}let D=function(t){function C(F,H,K,I,L,R){F=E.call(this,F,I,L);F.colormap=H;F.symbolizer=K;F.u_colormap=R;F.backgroundColor=c.ZEROS;F.fboTexture=null;F.baseOpacity=1;return F}b._inherits(C,t);var E=b._createSuper(C);return b._createClass(C)}(x.CommonPassParameters),z=function(t){function C(){return E.apply(this,arguments)}b._inherits(C,t);var E=b._createSuper(C);return b._createClass(C)}(D),v=function(t){function C(){return E.apply(this,arguments)}b._inherits(C,t);var E=b._createSuper(C);return b._createClass(C)}(D);
const A=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:v,ColorizerStretchUniforms:z,ColorizerUniforms:D,build:q},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=v;a.ColorizerStretchUniforms=z;a.ColorizerUniforms=D;a.RasterColorizer=A;a.build=q})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]=
"COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],
function(a,b,c,w){a.Colormap=function(n){n.fragment.uniforms.add([new w.Texture2DPassUniform("u_colormap",x=>x.u_colormap),new b.FloatPassUniform("u_colormapOffset",x=>x.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",x=>x.colormap.u_colormapMaxIndex),new b.FloatPassUniform("u_opacity",x=>x.common.u_opacity)]);n.fragment.code.add(c.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,w,n,x,m,l){w=function(g){function f(e,k,u){var p=d.call(this);p.common=
e;p.u_image=k;p.u_transformGrid=u;return p}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(w.TileCompositePassParameters);a.Common=function(g,f){g.include(c.Projection);g.fragment.uniforms.add([new l.Texture2DPassUniform("u_image",d=>d.u_image),new n.BooleanPassUniform("u_flipY",d=>d.common.u_flipY),new n.BooleanPassUniform("u_applyTransform",d=>d.common.u_applyTransform)]);({requireBilinearWithNN:f}=f);f&&g.fragment.uniforms.add([new x.Float2PassUniform("u_srcImageSize",d=>d.common.u_srcImageSize)]);
g.fragment.code.add(m.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);f?g.fragment.code.add(m.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):g.fragment.code.add(m.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};a.CommonPassParameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,w){a.Projection=function(n){n.fragment.uniforms.add(new w.Texture2DPassUniform("u_transformGrid",x=>x.u_transformGrid));n.fragment.uniforms.add(new b.Float2PassUniform("u_transformSpacing",
x=>x.common.u_transformSpacing));n.fragment.uniforms.add(new b.Float2PassUniform("u_targetImageSize",x=>x.common.u_targetImageSize));n.fragment.code.add(c.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,w,n,x,m){let l=function(g){function f(){var e=d.apply(this,arguments);e.scale=1;e.offset=
c.ZEROS;return e}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(x.NoParameters);a.TileComposite=function(g){g.attributes.add(m.VertexAttribute.POSITION,"vec2");g.attributes.add(m.VertexAttribute.UV0,"vec2");g.vertex.uniforms.add(new n.FloatPassUniform("scale",f=>f.scale));g.vertex.uniforms.add(new w.Float2PassUniform("offset",f=>f.offset));g.varyings.add("uv","vec2");g.varyings.add("vuv","vec2");g.vertex.code.add(x.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f){a.BlendLayersOutput=void 0;(function(e){e[e.Composite=0]="Composite";e[e.ColorComposite=1]="ColorComposite";e[e.GridComposite=2]="GridComposite";e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite";e[e.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(e){e[e.NotRequired=0]="NotRequired";e[e.Required=1]="Required";e[e.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;
(function(e){e[e.Off=0]="Off";e[e.On=1]="On";e[e.COUNT=2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));let d=function(e){function k(){var p=u.apply(this,arguments);p.baseOpacity=1;p.backgroundColor=c.ZEROS;p.fboTexture=null;return p}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(g.NoParameters);a.TileBackground=function(e,k){const u=k.output===a.BlendLayersOutput.GridComposite,p=k.output===a.BlendLayersOutput.ColorComposite,h=k.output===a.BlendLayersOutput.GroupBackgroundComposite,
r=k.output===a.BlendLayersOutput.Composite;u&&e.fragment.include(n.BackgroundGrid);p&&e.fragment.uniforms.add(new m.Float3PassUniform("backgroundColor",D=>D.backgroundColor));const q=k.baseOpacityMode===a.BaseOpacityMode.Required;q&&e.fragment.uniforms.add(new l.FloatPassUniform("baseOpacity",D=>D.baseOpacity));r&&e.fragment.uniforms.add(new f.Texture2DPassUniform("fboColor",D=>D.fboTexture));const y=k.blendMode!==w.LayerBlendMode.Normal,B=k.premultipliedSource===a.PremultipliedAlphaSource.On;e.fragment.include(x.BlendModes,
k);e.fragment.code.add(g.glsl`
    vec4 getBackground(vec2 uv) {
      return ${q?g.glsl`baseOpacity *`:""} ${h?g.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:p?g.glsl`vec4(backgroundColor, 1.0)`:u?g.glsl`vec4(gridColor(uv), 1.0)`:g.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${y?g.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:g.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!B&&(r&&!q||h)?g.glsl`colorLayer * opacity;`:g.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";
b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=
26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||
b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(c){c.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,c){a.BlendModes=function(w,n){n=n.blendMode;if(n!==b.LayerBlendMode.Normal){n===b.LayerBlendMode.Reflect&&w.code.add(c.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);n!==b.LayerBlendMode.ColorDodge&&n!==b.LayerBlendMode.VividLight||w.code.add(c.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);n!==b.LayerBlendMode.ColorBurn&&n!==b.LayerBlendMode.VividLight||w.code.add(c.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);n===b.LayerBlendMode.Overlay&&w.code.add(c.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);n===b.LayerBlendMode.HardLight&&w.code.add(c.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);n===b.LayerBlendMode.SoftLight&&w.code.add(c.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);n===b.LayerBlendMode.VividLight&&w.code.add(c.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(n===b.LayerBlendMode.Hue||n===b.LayerBlendMode.Saturation||n===b.LayerBlendMode.Color||n===b.LayerBlendMode.Luminosity)w.code.add(c.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),n!==b.LayerBlendMode.Hue&&n!==b.LayerBlendMode.Saturation||w.code.add(c.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);w.code.add(c.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${n===b.LayerBlendMode.Multiply?c.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Average?c.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Lighten?c.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Darken?c.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
n===b.LayerBlendMode.Lighter?c.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:n===b.LayerBlendMode.Plus?c.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:n===b.LayerBlendMode.Minus?c.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:n===b.LayerBlendMode.Screen?c.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Difference?c.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
n===b.LayerBlendMode.Invert?c.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:n===b.LayerBlendMode.DestinationOver?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:n===b.LayerBlendMode.DestinationAtop?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:n===b.LayerBlendMode.DestinationOut?c.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:n===b.LayerBlendMode.SourceAtop?c.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:n===b.LayerBlendMode.SourceOut?
c.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:n===b.LayerBlendMode.Xor?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:n===b.LayerBlendMode.DestinationIn?c.glsl`return vec4(cb * ob * ol, ol * ob);`:n===b.LayerBlendMode.SourceIn?c.glsl`return vec4(cl * ol * ob, ol * ob);`:n===b.LayerBlendMode.Hue?c.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Saturation?c.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Color?c.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Luminosity?c.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Exclusion?c.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Reflect?c.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.ColorDodge?c.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.ColorBurn?c.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.Overlay?c.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.SoftLight?c.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.HardLight?c.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===b.LayerBlendMode.VividLight?c.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:c.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../core/maybe ../../chunks/vec2f64 ./context-util ./enums ./Texture".split(" "),function(a,b,c,w,n,x){a.createColormapTexture=function(m,l){return new x.Texture(m,{width:l.length/4,height:1,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!1},l)};a.createRasterTexture=function(m,l,g="nearest",f=!1){const d=(f=!(f&&"u8"===l.pixelType))?n.PixelType.FLOAT:n.PixelType.UNSIGNED_BYTE,e=null==l.pixels||0===l.pixels.length?null:f?l.getAsRGBAFloat():l.getAsRGBA();return new x.Texture(m,{width:l.width,height:l.height,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:m.type===w.ContextType.WEBGL2&&f?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,samplingMode:!m.capabilities.textureFloat?.textureFloatLinear||
"bilinear"!==g&&"cubic"!==g?n.TextureSamplingMode.NEAREST:n.TextureSamplingMode.LINEAR,dataType:d,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},e)};a.createTransformTexture=function(m,l){const {spacing:g,offsets:f,coefficients:d,size:[e,k]}=l;var u=1<g[0];l={width:u?4*e:e,height:k,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:m.type===w.ContextType.WEBGL2?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,dataType:n.PixelType.FLOAT,samplingMode:n.TextureSamplingMode.NEAREST,
wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const p=new Float32Array(u?e*k*16:2*f.length);if(u&&null!=d)for(let h=0,r=0;h<d.length;h++)p[r++]=d[h],2===h%3&&(p[r++]=1);else for(u=0;u<k;u++)for(let h=0;h<e;h++){const r=4*(u*e+h),q=2*(h*k+u);p[r]=f[q];p[r+1]=f[q+1];p[r+3]=-1===f[q]?0:1}return new x.Texture(m,l,p)};a.getBasicGridUniforms=function(m,l){return{u_scale:m,u_offset:l}};a.getColormapUniforms=function(m,l){return{u_colormapOffset:l||0,u_colormapMaxIndex:m?m.length/4-1:0}};a.getCommonUniforms=
function(m,l,g,f=1,d=!0){return{u_flipY:d,u_applyTransform:!!m,u_opacity:f,u_transformSpacing:m?m.spacing:c.ZEROS,u_transformGridSize:m?m.size:c.ZEROS,u_targetImageSize:l,u_srcImageSize:g}};a.getShadedReliefUniforms=function(m){return{u_hillshadeType:m.hillshadeType,u_sinZcosAs:m.sinZcosAs,u_sinZsinAs:m.sinZsinAs,u_cosZs:m.cosZs,u_weights:m.weights,u_factor:m.factor,u_minValue:m.minValue,u_maxValue:m.maxValue}};a.getStretchUniforms=function(m){return{u_bandCount:m.bandCount,u_minOutput:m.outMin,u_maxOutput:m.outMax,
u_minCutOff:m.minCutOff,u_maxCutOff:m.maxCutOff,u_factor:m.factor,u_useGamma:m.useGamma,u_gamma:m.gamma,u_gammaCorrection:m.gammaCorrection}};a.getUniformLocationInfos=function(m,l){m=m.gl;l=l.glName;const g=new Map;if(b.isNone(l))return g;const f=m.getProgramParameter(l,m.ACTIVE_UNIFORMS);let d;for(let e=0;e<f;e++)(d=m.getActiveUniform(l,e))&&g.set(d.name,{location:m.getUniformLocation(l,d.name),info:d});return g};a.setTextures=function(m,l,g,f){g.length===f.length&&(f.some(d=>null==d)||g.some(d=>
null==d)||g.forEach((d,e)=>{l.setUniform1i(d,e);m.bindTexture(f[e],e)}))};a.setUniforms=function(m,l,g){Object.keys(g).forEach(f=>{var d=l.get(f)||l.get(f+"[0]");if(d){var e=g[f];if(null!==d&&null!=e)switch({info:d}=d,d.type){case n.UniformType.FLOAT:1<d.size?m.setUniform1fv(f,e):m.setUniform1f(f,e);break;case n.UniformType.FLOAT_VEC2:m.setUniform2fv(f,e);break;case n.UniformType.FLOAT_VEC3:m.setUniform3fv(f,e);break;case n.UniformType.FLOAT_VEC4:m.setUniform4fv(f,e);break;case n.UniformType.FLOAT_MAT3:m.setUniformMatrix3fv(f,
e);break;case n.UniformType.FLOAT_MAT4:m.setUniformMatrix4fv(f,e);break;case n.UniformType.INT:1<d.size?m.setUniform1iv(f,e):m.setUniform1i(f,e);break;case n.UniformType.BOOL:m.setUniform1i(f,e?1:0);break;case n.UniformType.INT_VEC2:case n.UniformType.BOOL_VEC2:m.setUniform2iv(f,e);break;case n.UniformType.INT_VEC3:case n.UniformType.BOOL_VEC3:m.setUniform3iv(f,e);break;case n.UniformType.INT_VEC4:case n.UniformType.BOOL_VEC4:m.setUniform4iv(f,e)}}})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,b,c,w,n,x,m){let l=function(){function d(){this.waitingAgents=new n;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}d.acquire=function(k){const u=g.acquire();u._init(k);return u};var e=d.prototype;e.release=function(){this.dispose();
f.delete(this);g.release(this)};e.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=x.releaseTileData(this._data)};d.prune=function(){g.prune(0)};e._init=function(k){this.waitingAgents.clear();this._data=x.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=k;this.elevationBounds=null};
e.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};e.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};e._unsetUpsampleInfo=function(){c.isSome(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};e.setUpsampleInfo=function(k,u){if(k===u||c.isNone(u))this._unsetUpsampleInfo();else{if(c.isNone(this._upsampleInfo))this._upsampleInfo=
this._pool.acquire();else{if(this._upsampleInfo.tile===u)return;this._upsampleInfo.tile.unrefMapData()}u.refMapData();m.computeUpsampleInfo(k,u,this._upsampleInfo)}};b._createClass(d,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(k){x.releaseTileData(this._data);this._data=k}}]);return d}();const g=new w(l,null,()=>{}),f=new Map;a.TilePerLayerInfo=l;a.printAllocations=function(){0<f.size&&(console.log(`${f.size} live TilePerLayerInfo allocations:`),
f.forEach(d=>console.log(d,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(w){this._texture=w;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};
a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.ELEVATION=2]="ELEVATION";b[b.MERGE=4]="MERGE";b[b.RENDERDATA=8]="RENDERDATA";b[b.GEOMETRY=16]="GEOMETRY";b[b.TEXTURE_NOFADING=32]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=
64]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec4f64"],function(a,b){return function(){function c(){this._scales=b.fromValues(-1,-1,-1,-1);this._offsets=b.fromValues(-1,-1,-1,-1)}var w=c.prototype;w.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=
-1};w.setScale=function(n,x,m){this._scales[2*n]=x;this._scales[2*n+1]=m};w.setOffset=function(n,x,m){this._offsets[2*n]=x;this._offsets[2*n+1]=m};a._createClass(c,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return c}()})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){m=function(p){function h(){var q=r.apply(this,arguments);q.useStencil=!1;return q}c._inherits(h,p);var r=c._createSuper(h);p=h.prototype;p.initializeConfiguration=function(q,y){y.spherical=q.viewingMode===w.ViewingMode.Global};p.initializeProgram=function(q){return new g.Program(q.rctx,h.shader.get().build(this.configuration),u)};p.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};p._createPipeline=
function(q){const y=this.configuration,B=y.backfaceCullingEnabled&&!y.renderOccluded;return k.makePipelineState({blending:y.renderOccluded?k.simpleBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:B?k.backFaceCullingParams:null,depthTest:y.renderOccluded?null:{func:e.CompareFunction.LESS},depthWrite:y.renderOccluded?null:k.defaultDepthWriteParams,colorWrite:k.defaultColorWriteParams,stencilTest:q?f.renderWhenBitIsNotSet(l.StencilBits.IntegratedMeshMaskExcluded):null})};
p.getPipelineState=function(q,y){return this.useStencil?this._stencilPipelineState:c._get(c._getPrototypeOf(h.prototype),"getPipelineState",this).call(this,q,y)};return c._createClass(h)}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(n.Terrain,()=>new Promise((p,h)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],p,h)));const u=new Map([[d.VertexAttribute.POSITION,0],[d.VertexAttribute.UV0,1],[d.VertexAttribute.NORMALCOMPRESSED,2]]);b.TerrainTechnique=m;b.terrainVertexAttributeLocations=
u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I){function L(M){const G=new K.ShaderBuilder,{vertex:P,fragment:U,varyings:N}=G;G.include(k.PositionAttribute);G.include(e.NormalAttribute,M);G.include(u.TextureCoordinateAttribute,M);var S=()=>{G.include(D.NormalUtils,M);P.code.add(F.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};C.addProjViewLocalOrigin(P,M);G.include(d.Transform,M);const Q=M.overlayMode!==A.OverlayMode.Disabled;switch(M.output){case g.ShaderOutput.Color:G.include(t.TerrainTexture,M);G.include(y.EvaluateSceneLighting,M);Q&&G.include(t.OverlayTerrain,{...M,pbrMode:M.pbrMode===z.PBRMode.Terrain?z.PBRMode.TerrainWithWater:z.PBRMode.Water});const W=M.overlayMode===A.OverlayMode.EnabledWithWater;W&&G.include(p.VertexTangent,M);N.add("vnormal","vec3");N.add("vpos","vec3");N.add("vup","vec3");S();(M.atmosphere||
M.screenSizePerspective)&&C.addViewNormal(P);(S=M.receiveShadows&&!M.renderOccluded)&&G.include(l.ForwardLinearDepth,M);M.atmosphere&&N.add("wnormal","vec3");M.screenSizePerspective&&(N.add("screenSizeDistanceToCamera","float"),N.add("screenSizeCosAngle","float"));P.code.add(F.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${W?F.glsl`forwardVertexTangent(vnormal);`:F.glsl``}

          ${M.atmosphere?F.glsl`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Q?F.glsl`setOverlayVTC(uv);`:""}
          ${M.tileBorders?F.glsl`forwardTextureCoordinates();`:""}

          ${M.screenSizePerspective?F.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${S?F.glsl`forwardLinearDepth();`:""}

        }
      `);G.include(f.SliceDraw,M);G.include(y.EvaluateSceneLighting,M);G.include(q.EvaluateAmbientOcclusion,M);G.include(v.ReadShadowMapDraw,M);C.addCameraPosition(U,M);y.addAmbientBoostFactor(U);y.addLightingGlobalFactor(U);U.uniforms.add([P.uniforms.get("localOrigin"),new E.Float3PassUniform("viewDirection",(V,T)=>n.normalize(J,n.set(J,T.camera.viewMatrix[12],T.camera.viewMatrix[13],T.camera.viewMatrix[14])))]);W&&U.uniforms.add([new I.Texture2DPassUniform("ovWaterTex",(V,T)=>0===T.overlays.length?
null:T.overlays[m.OverlayIndex.INNER].getNormalTexture(V.overlaySource)),new H.Matrix4DrawUniform("view",(V,T)=>c.translate(O,T.camera.viewMatrix,V.origin))]);U.code.add(F.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);B.addMainLightDirection(U);B.addMainLightIntensity(U);U.code.add(F.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${M.receiveShadows&&!M.renderOccluded?"readShadowMap(vpos, linearDepth)":M.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Q?F.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${M.invisible?F.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${M.atmosphere?F.glsl`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${M.atmosphere?F.glsl`atm + tileColor.rgb;`:F.glsl`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${M.pbrMode===z.PBRMode.Terrain||M.pbrMode===z.PBRMode.TerrainWithWater?F.glsl`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:F.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${W?F.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${M.screenSizePerspective?F.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${M.visualizeNormals?M.spherical?F.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:F.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${M.tileBorders?F.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `);break;case g.ShaderOutput.Depth:Q&&G.include(t.OverlayTerrain,M);G.include(h.OutputDepth,M);l.addLinearDepth(G);l.addNearFar(G);P.code.add(F.glsl`
              void main(void) {
                ${Q?F.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);U.code.add(F.glsl`
              void main() {
                ${Q&&M.invisible?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case g.ShaderOutput.Shadow:case g.ShaderOutput.ShadowHighlight:case g.ShaderOutput.ShadowExcludeHighlight:G.include(h.OutputDepth,M);l.addLinearDepth(G);l.addNearFar(G);P.code.add(F.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);U.code.add(F.glsl`void main() {
outputDepth(linearDepth);
}`);break;case g.ShaderOutput.Normal:Q&&G.include(t.OverlayTerrain,M);N.add("vnormal","vec3");C.addViewNormal(P);S();P.code.add(F.glsl`
            void main(void) {
              ${Q?F.glsl`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `);U.code.add(F.glsl`
            void main() {
              ${Q&&M.invisible?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case g.ShaderOutput.Highlight:Q&&G.include(t.OverlayTerrain,M),P.code.add(F.glsl`
          void main() {
            ${Q?F.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),G.include(r.OutputHighlight,M),U.code.add(F.glsl`
          void main() {
            ${Q?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}M.output===g.ShaderOutput.ObjectAndLayerIdColor&&(G.include(t.OverlayTerrain,{...M,pbrMode:z.PBRMode.Disabled}),P.code.add(F.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),U.code.add(F.glsl`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`));return G}let R=function(M){function G(){return P.apply(this,arguments)}b._inherits(G,M);var P=b._createSuper(G);return b._createClass(G)}(t.OverlayTerrainPassParameters);const O=w.create(),J=x.create();w=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:R,build:L},Symbol.toStringTag,{value:"Module"}));a.Terrain=w;a.TerrainPassParameters=R;a.build=L})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],
function(a,b){a.VertexTangent=function(c,w){c.varyings.add("tbnTangent","vec3");c.varyings.add("tbnBiTangent","vec3");w.spherical?c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);c.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/Overlay ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(r,q){q.pbrMode!==g.PBRMode.Water&&q.pbrMode!==g.PBRMode.WaterOnIntegratedMesh&&q.pbrMode!==g.PBRMode.TerrainWithWater||r.include(f.Water,q);const {vertex:y,fragment:B}=r;r.varyings.add("vtcOverlay","vec4");y.code.add(e.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);B.code.add(e.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);B.code.add(e.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);B.code.add(e.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);if(q.pbrMode===g.PBRMode.Water||q.pbrMode===g.PBRMode.WaterOnIntegratedMesh||q.pbrMode===g.PBRMode.TerrainWithWater)l.addMainLightDirection(B),l.addMainLightIntensity(B),B.code.add(e.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function p(r,q){return 0===q.overlays.length?null:r.identifier===x.RenderPassIdentifier.Material&&r.output===m.ShaderOutput.Color?q.overlays[w.OverlayIndex.INNER].getColorTextureNoRasterImage():r.identifier===x.RenderPassIdentifier.Material&&r.output===m.ShaderOutput.ObjectAndLayerIdColor?q.overlays[w.OverlayIndex.INNER].getColorTexture(n.OverlaySource.ObjectAndLayerIdColor):r.identifier===x.RenderPassIdentifier.Highlight?q.overlays[w.OverlayIndex.INNER].getValidTexture(w.RenderTargetType.Highlight):
null}a.OverlayMode=void 0;(function(r){r[r.Disabled=0]="Disabled";r[r.Enabled=1]="Enabled";r[r.EnabledWithWater=2]="EnabledWithWater";r[r.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));const h=b.create();a.OverlayIM=function(r,q){const {vertex:y,fragment:B}=r;y.uniforms.add([new d.Float4DrawUniform("overlayTexOffset",(D,z)=>{for(const v of z.overlays){const {index:A,extent:t}=v;0<c.area(t)&&(h[2*A]=D.toMapSpace[0]/c.width(t)-t[0]/c.width(t),h[2*A+1]=D.toMapSpace[1]/c.height(t)-t[1]/c.height(t))}return h}),
new d.Float4DrawUniform("overlayTexScale",(D,z)=>{for(const v of z.overlays){const {index:A,extent:t}=v;0<c.area(t)&&(h[2*A]=D.toMapSpace[2]/c.width(t),h[2*A+1]=D.toMapSpace[3]/c.height(t))}return h})]);B.constants.add("overlayOpacity","float",1);B.uniforms.add(new k.Texture2DPassUniform("ovColorTex",(D,z)=>p(D,z)));u(r,q)};a.getColorTexture=p;a.overlay=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,w,n){let x=function(f){function d(){var k=e.apply(this,arguments);k.slicePlaneLocalOrigin=c.create();k.origin=k.slicePlaneLocalOrigin;return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(n.VertexNormalPassParameters);n=function(f){function d(){return e.apply(this,arguments)}b._inherits(d,f);var e=b._createSuper(d);
return b._createClass(d)}(n.VertexNormalDrawParameters);a.RenderPassIdentifier=void 0;(function(f){f[f.Material=0]="Material";f[f.ShadowMap=1]="ShadowMap";f[f.Highlight=2]="Highlight"})(a.RenderPassIdentifier||(a.RenderPassIdentifier={}));let m=function(f){function d(){var k=e.apply(this,arguments);k.identifier=a.RenderPassIdentifier.Material;k.output=w.ShaderOutput.Color;k.transparent=!1;k.integratedMesh=!1;return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(x),l=function(f){function d(){var k=
e.apply(this,arguments);k.identifier=a.RenderPassIdentifier.ShadowMap;return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(x),g=function(f){function d(){var k=e.apply(this,arguments);k.identifier=a.RenderPassIdentifier.Highlight;return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(x);a.DrawParameters=n;a.HighlightPassParameters=g;a.MaterialPassParameters=m;a.PassParameters=x;a.ShadowMapPassParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"vec4",w.BindType.Draw,(f,d,e)=>f.setUniform4fv(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.Float4DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../terrain/interfaces ./BackgroundGrid.glsl ./Overlay.glsl ./TileBlendInput ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f){let d=function(h){function r(){var y=q.apply(this,arguments);y.overlayOpacity=1;return y}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(l.NoParameters),e=function(h){function r(y){return q.call(this,y,"float")}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(f.Uniform),k=function(h){function r(y){return q.call(this,y,"vec3")}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(f.Uniform),u=function(h){function r(y){return q.call(this,
y,"vec4")}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(f.Uniform),p=function(h){function r(y){return q.call(this,y,"sampler2D")}b._inherits(r,h);var q=b._createSuper(r);return b._createClass(r)}(f.Uniform);a.Float3Uniform=k;a.OverlayTerrain=function(h,r){h.vertex.uniforms.add([new u("overlayTexOffset"),new u("overlayTexScale")]);h.fragment.uniforms.add([new m.FloatPassUniform("overlayOpacity",q=>q.overlayOpacity),new g.Texture2DPassUniform("ovColorTex",(q,y)=>0===y.overlays.length?
null:y.overlays[c.OverlayIndex.INNER].getColorTexture(q.overlaySource))]);n.overlay(h,r)};a.OverlayTerrainPassParameters=d;a.TerrainTexture=function(h,r){const {vertex:q,fragment:y,varyings:B}=h;B.add("vtc","vec2");q.uniforms.add(new u("texOffsetAndScale"));y.uniforms.add(new p("tex"));y.uniforms.add(new k("textureOpacities"));if(h=r.textureFadingEnabled&&!r.renderOccluded)q.uniforms.add(new u("nextTexOffsetAndScale")),B.add("nvtc","vec2"),y.uniforms.add(new p("texNext")),y.uniforms.add(new k("nextTexOpacities")),
y.uniforms.add(new e("fadeFactor"));const D=r.tileBlendInput===x.TileBlendInput.ColorComposite;(r=r.tileBlendInput===x.TileBlendInput.GridComposite)&&y.include(w.BackgroundGrid);D&&y.uniforms.add(new k("backgroundColor"));q.code.add(l.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${h?l.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:l.glsl``}
  }`);y.code.add(l.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${r||D?l.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${D?l.glsl`backgroundColor`:l.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:l.glsl`return color;`}
    }`);h?y.code.add(l.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):y.code.add(l.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4 ../../../chunks/vec4f64".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){let u=b._createClass(function(){this.extent=k.create();this.maxLevel=this.minLevel=0;this.callback=null});a.ScaleRangeQueries=function(p){function h(){var q=r.apply(this,arguments);q._queries=new x({initialSize:10});q._queriesInvPtr=0;q._queryQueue=new x({initialSize:30});q._queryPool=new n(u);return q}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.queryVisibleLevelRange=function(q,y,B,D){const z=this._queryPool.acquire();e.copy(z.extent,q);z.minLevel=
null==y?-Number.MAX_VALUE:y;z.maxLevel=null==B?Number.MAX_VALUE:B;z.callback=D;this._queryQueue.push(z);this.notifyChange("updating")};p.prepare=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const q=this._queryQueue.pop();this._queries.push(q)}this._queriesInvPtr=this._queries.length};p.process=function(){for(let q=0;q<this._queries.length;q++){const y=this._queries.data[q];this._queryPool.release(y);y.callback(q>=this._queriesInvPtr);y.callback=null}this._queries.clear();
this.notifyChange("updating")};p.queriesForTile=function(q){const y=q.level;let B=0;for(;B<this._queriesInvPtr;){const D=this._queries.data[B],z=D.extent;y>=D.minLevel&&y<=D.maxLevel&&z[0]<=q.extent[2]&&z[2]>=q.extent[0]&&z[1]<=q.extent[3]&&z[3]>=q.extent[1]?(this._queries.swapElements(B,this._queriesInvPtr-1),this._queriesInvPtr--):B++}};b._createClass(h,[{key:"updating",get:function(){return 0!==this._queryQueue.length}}]);return h}(w);c.__decorate([m.property()],a.ScaleRangeQueries.prototype,"updating",
null);a.ScaleRangeQueries=c.__decorate([d.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(z,v,A,t,C,E){z=t-z;v=C-v;A=E-A;return z*z+v*v+A*A}let h=function(z){function v(t,C,E){var F=A.call(this);F._convexHull=Array(24);F._boundingSphere=g.create();void 0!==t&&F.init(t,C,E);return F}b._inherits(v,z);var A=b._createSuper(v);z=v.prototype;z.init=function(t,C,E){b._get(b._getPrototypeOf(v.prototype),"init",this).call(this,t,C,E);C=this.ellipsoid.radius;E=this.extentInRadians[0];const F=this.extentInRadians[1],H=this.extentInRadians[2],K=this.extentInRadians[3];
t=t[0];const I=c.lerp(F,K,.5),L=c.lerp(E,H,.5);this._edgeLen=(H-E)*Math.cos(0===t?0:Math.min(Math.abs(F),Math.abs(K)))*C;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=C-Math.sqrt(C*C-this._edgeLen2/4);x.lonLatToSphericalPCPF(this.centerAtSeaLevel,L,I,this.ellipsoid.radius);w.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()};z.updateRadiusAndCenter=function(){this._updateBoundingVolumes();const t=this._center;if(0===this.lij[0])w.set(t[k.CenterPosition.MIDDLE],
0,0,0),w.set(t[k.CenterPosition.TOP],0,0,0),w.set(t[k.CenterPosition.BOTTOM],0,0,0),t[k.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const K=t[k.CenterPosition.MIDDLE],I=this.convexHull;var C=0;for(let L=0;8>L;++L){var E=Math,F=E.max;var H=3*L;H=p(K[0],K[1],K[2],I[H],I[H+1],I[H+2]);C=F.call(E,C,H)}t[k.CenterPosition.MIDDLE][3]=Math.sqrt(C)}};z._calculateFrustumVisibilityStatus=function(t){if(!l.intersectsSphere(t,this._boundingSphere))return f.TileFrustumVisibility.OUTSIDE;
if(10>this.lij[0])return f.TileFrustumVisibility.INTERSECTS;const C=this.convexHull,E=this.surface.view.state.camera.near;let F=!0;for(let K=0;K<l.NumPlanes.NUM;K++){var H=t[K];const I=H[0],L=H[1],R=H[2];H=H[3]-(K===l.PlaneIndex.NEAR?E:0);let O=!1;for(let J=0;8>J;++J){const M=3*J;if(0>I*C[M]+L*C[M+1]+R*C[M+2]+H){if(O=!0,!F)break}else F=!1}if(!O)return f.TileFrustumVisibility.OUTSIDE}return F?f.TileFrustumVisibility.INSIDE:f.TileFrustumVisibility.INTERSECTS};z.computeElevationBounds=function(){b._get(b._getPrototypeOf(v.prototype),
"computeElevationBounds",this).call(this);this._updateBoundingVolumes()};z.createGeometry=function(){d.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()};z._updateBoundingVolumes=function(){this._updateConvexHull();this._updateBoundingSphere();e.ENABLE_TERRAIN_INTERNAL_CHECKS&&this._checkBVs()};z._updateBoundingSphere=function(){const t=this._boundingSphere;var C=this.elevationBounds,E=this.ellipsoid.radius,F=C[1];if(0===this.level)w.set(t,
0,0,0),t[3]=E+F;else{F=this.extentInRadians;var H=.5*(F[0]+F[2]),K=F[3];q(B,H,F[1],E);q(D,H,K,E);w.add(t,B,D);w.scale(t,t,(E+.5*(C[0]+C[1]))/w.len(t));C=this.convexHull;E=0;for(F=0;8>F;++F){H=t[0]-C[3*F];K=t[1]-C[3*F+1];const I=t[2]-C[3*F+2];E=Math.max(E,Math.sqrt(H*H+K*K+I*I))}t[3]=E+2}};z._updateConvexHull=function(){var t=this.extentInRadians,C=this.ellipsoid.radius;if(0!==this.level){var E=this.elevationBounds,F=this._getPatchType(),H=this.surface.isWebMercator,K=H&&F===f.PatchType.HAS_NORTH_POLE,
I=(F=H&&F===f.PatchType.HAS_SOUTH_POLE)||K;H=Math.PI/2;var L=t[0],R=t[2];F=F?-H:t[1];var O=K?H:t[3],J=.5*(L+R);t=E[0];var M=C+(I?Math.min(0,t-1):t);t=n.create();K=n.create();H=n.create();var G=n.create();q(t,L,F,M);q(K,L,O,M);q(H,R,O,M);q(G,R,F,M);L=(Q,W)=>{for(let V=0;3>V;++V)this._convexHull[3*W+V]=Q[V]};L(t,0);L(K,1);L(H,2);L(G,3);E=E[1];var P=C+(I?Math.max(0,E+1):E),U=n.create();C=n.create();E=n.create();q(C,J,O,M);q(E,J,F,M);w.add(U,C,E);w.normalize(U,U);var N=n.create(),S=n.create();F=(Q,W)=>
{w.sub(S,Q,W);w.normalize(S,S);W=-w.dot(Q,N)/w.dot(S,N);e.internalAssert(0<=W);w.scale(S,S,W);w.add(Q,Q,S)};2**this.lij[0]>2*this.lij[1]?(C=n.create(),w.cross(C,y,E),w.normalize(C,C),w.cross(N,E,C),w.normalize(N,N),e.internalAssert(e.almostEquals(w.dot(N,E)/w.len(E),0)),F(t,K),F(G,H),L(t,0),L(G,3)):2**this.lij[0]!==2*this.lij[1]&&(E=n.create(),w.cross(E,y,C),w.normalize(E,E),w.cross(N,E,C),w.normalize(N,N),F(K,t),F(H,G),L(K,1),L(H,2));C=(Q,W)=>{const V=P/w.dot(W,U);for(let T=0;3>T;++T)this._convexHull[3*
Q+T]=W[T]*V};C(4,t);C(5,K);C(6,H);C(7,G)}};z._getPatchType=function(){const t=this.lij[1],C=t===(1<<this.level)-1;return 0===t?C?f.PatchType.HAS_BOTH_POLES:f.PatchType.HAS_NORTH_POLE:C?f.PatchType.HAS_SOUTH_POLE:f.PatchType.REGULAR};z.intersectsRay=function(t,C,E,F){var H=this._boundingSphere;E=H[3]+E;var K=H[0]-t[0];F=H[1]-t[1];t=H[2]-t[2];H=(K*C[0]+F*C[1]+t*C[2])/(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);K=C[0]*H-K;F=C[1]*H-F;C=C[2]*H-t;return K*K+F*F+C*C<E*E};z.getDefaultVerticesPerSide=function(){return this.level<
r.length?r[this.level]+1:2};z.updateCornerElevations=function(){d.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()};z.updateEdgeElevations=function(){d.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()};z._checkBVs=function(){if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&!(2>=this.level)){var t=this._boundingSphere,C=t[3],E=n.create(),F=this.ellipsoid.radius,H=this.elevationBounds;H[1]-H[0];var K=F+H[0],I=this._center[k.CenterPosition.MIDDLE][3],L=this.convexHull,
R=(ma,qa)=>{for(let wa=0;3>wa;++wa)ma[wa]=L[3*qa+wa]},O=n.create(),J=n.create(),M=n.create(),G=n.create(),P=n.create(),U=(ma,qa,wa,xa)=>{R(J,ma);R(M,qa);R(G,wa);w.sub(J,J,M);w.sub(G,G,M);w.cross(O,J,G);w.normalize(O,O);var pa=w.dot(O,M);R(P,xa);const ra=w.dot(O,P);pa=Math.abs(ra-pa);e.internalAssert(e.almostEquals(pa,0),`Non coplanar ${ma},${qa},${wa},${xa} diff = ${pa}`)};U(0,1,2,3);U(4,5,6,7);U(0,1,4,5);U(1,2,5,6);U(2,3,6,7);U(3,0,7,4);var N=m.newDoubleArray(24),S=n.create(),Q=n.create(),W=n.create(),
V=n.create();U=(ma,qa,wa,xa)=>{R(S,qa);R(Q,wa);R(W,xa);w.sub(S,S,Q);w.normalize(S,S);w.sub(W,W,Q);w.normalize(W,W);w.cross(V,S,W);w.normalize(V,V);qa=w.dot(V,Q);ma*=4;for(wa=0;3>wa;++wa)N[ma+wa]=V[wa];N[ma+3]=qa};U(0,0,1,2);U(1,1,0,4);U(2,1,5,2);U(3,3,2,6);U(4,4,0,3);U(5,4,6,5);var T=(ma,qa,wa,xa)=>{ma*=4;return N[ma]*qa+N[ma+1]*wa+N[ma+2]*xa-N[ma+3]},X=(ma,qa,wa,xa)=>-1<=T(ma,qa,wa,xa),Z=2**this.lij[0]>2*this.lij[1];U=(ma,qa,wa)=>Math.sqrt(p(ma,qa,wa,t[0],t[1],t[2]))<C;var Y=this.extentInRadians,
aa=.5*(Y[0]+Y[2]),ia=Y[1],na=Y[3];Y=n.create();var ba=n.create();q(Y,aa,na,K);q(ba,aa,ia,K);K=Z?"Upper":"Lower";Z=!0;for(aa=0;6>aa;++aa){for(ia=0;8>ia;++ia)na=3*ia,na=-1<=T(aa,L[na],L[na+1],L[na+2]),Z&&(Z=na),e.internalAssert(na,`Tile[${this.lij}] Convex hull point ${ia} outside of plane ${aa}`);e.internalAssert(X(aa,ba[0],ba[1],ba[2]),`Tile[${this.lij}] (${K}) bottom mid outside of plane ${aa}`);e.internalAssert(X(aa,Y[0],Y[1],Y[2]),`Tile[${this.lij}] (${K}) top mid outside of plane ${aa}`)}e.internalAssert(Z,
"Not all convex hull points are inside  convex hull polyhedron");e.internalAssert(U(ba[0],ba[1],ba[2]),`Tile[${this.lij}] (${K}) bottom mid outside of bounding sphere`);e.internalAssert(U(Y[0],Y[1],Y[2]),`Tile[${this.lij}] (${K}) top mid outside of bounding sphere`);for(X=0;8>X;++X)Y=3*X,Y=U(L[Y],L[Y+1],L[Y+2]),e.internalAssert(Y,`Tile[${this.lij}] Convex hull point ${X} outside of bounding sphere`);for(U=0;6>U;++U)for(X=0;8>X;++X)Y=3*X,-1<=T(U,L[Y],L[Y+1],L[Y+2])||console.error(`Tile[${this.lij}] Convex hull point ${X} outside of plane ${U}`);
U=this.extentInRadians;U=Math.round(Math.max(U[2]-U[0],U[3]-U[1])*F);if(aa=this.renderData){var {geometryInfo:ea,localOrigin:ja}=aa;if(X=ea.vertexAttributes?.position){Y=X.count;ba=n.create();K=ea.numVerticesPerSide-2;Z=K*K;aa=aa.geometryState.neighborData;ia=aa.edgeResolutions.reduce((ma,qa)=>ma+qa+1,0);for(let ma=0;ma<Y;++ma){const qa=ma<Z,wa=!qa&&ma<Z+ia;let xa=!1;na=-1;if(wa){var ka=Z;for(var da=0;4>da;++da){var ha=aa.edgeResolutions[da];if(ma===ka||ma===ka+ha-1){xa=!0;break}ka+=ha;if(ma<ka){na=
da;break}}}na=wa?aa.edgePeerNeighbors[na]:null;const pa=wa&&na&&0<u.compareTilesByLij(this,na);X.getVec(ma,E);w.add(ba,E,ja);na=w.len(ba)-F;ka=0;da=!1;ha=H[0]-na;const ra=na-H[1],va=1<ha,Ba=1<ra;var ca=va||Ba;const Aa=()=>{const Ha=wa&&!xa;return`Tile[${this.lij}].vertex[${ma}]:${qa?"internal":Ha?"edge":xa?"corner":"pole"}`+(va?"(below)":Ba?"(above)":"")+(pa?"(Neighbor)":"")};var fa=w.dist(ba,t);fa>=C+0&&(fa-=C,ca||(console.error(`${Aa()} is out of the bounding sphere by ${fa.toFixed(0)} / ${C.toFixed(0)}`+
"[tol\x3d0]"+` h=${na.toFixed(0)} / [${H[0].toFixed(0)}..${H[1].toFixed(0)}] (${(fa/C).toFixed(0)})`),da=!0));for(ca=0;6>ca;++ca)if(!(-1<=T(ca,ba[0],ba[1],ba[2]))){fa=T(ca,ba[0],ba[1],ba[2]);const Ha=ma%K,Ka=(ma-Ha)/K;0===ca&&ha||5===ca&&ra||(console.error(`${Aa()} (${Ha},${Ka})|${K}] is out of the bounding trapezoid plane ${ca}`+` h=${Math.round(na)} / [${Math.round(H[0])}..${Math.round(H[1])}] dist=${Math.round(fa)}`+` radii = ${Math.round(C)}/${Math.round(I)}} : maxL = ${U}`),++ka)}if(da||0<ka)break}}}}};
b._createClass(v,[{key:"convexHull",get:function(){return this._convexHull}}]);return v}(k.Tile);const r=[128,64,64,32,16,8,8,4],q=(z,v,A,t)=>{const C=Math.sin(v),E=Math.cos(A);A=Math.sin(A);z[0]=t*E*Math.cos(v);z[1]=t*E*C;z[2]=t*A},y=[0,0,1],B=n.create(),D=n.create();a.SphericalPatch=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){a.SplitLimits=function(f){function d(){var k=e.apply(this,arguments);k.fovX=0;k.fovY=0;k.relativeWidthLimit=0;k.relativeHeightLimit=0;k.maxLod=0;k.angledSplitBias=0;k.aboveGround=!0;return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(w);c.__decorate([n.property()],a.SplitLimits.prototype,"fovX",void 0);c.__decorate([n.property()],a.SplitLimits.prototype,"fovY",void 0);c.__decorate([n.property()],a.SplitLimits.prototype,"relativeWidthLimit",void 0);
c.__decorate([n.property()],a.SplitLimits.prototype,"relativeHeightLimit",void 0);c.__decorate([n.property()],a.SplitLimits.prototype,"maxLod",void 0);c.__decorate([n.property()],a.SplitLimits.prototype,"angledSplitBias",void 0);c.__decorate([n.property()],a.SplitLimits.prototype,"aboveGround",void 0);c.__decorate([n.property()],a.SplitLimits.prototype,"frustum",void 0);a.SplitLimits=c.__decorate([g.subclass("esri.views.3d.terrain.SplitLimits")],a.SplitLimits);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometry ./PatchRenderData ./RenderOrder ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa,ia){const na=r.create();a.TransparencyMode=void 0;(function(da){da[da.Opaque=0]="Opaque";da[da.Semitransparent=1]="Semitransparent";da[da.TransparentWithDraped=2]="TransparentWithDraped";da[da.Empty=3]="Empty"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=function(da){function ha(fa){fa=ca.call(this,fa);fa.type=N.IntersectorType.TERRAIN;fa.isGround=!0;fa._tileSize=256;fa._techniqueConfiguration=
new aa.TerrainTechniqueConfiguration;fa._passParameters=new O.TerrainPassParameters;fa._rctx=null;fa._renderDataPool=new m(t.PatchRenderData);fa._patchGroups=new Map;fa._patchGroupsDirty=!0;fa._patchSortingDirty=!0;fa._tileIterator=new K.IteratorPreorder;fa._highestVisibleLODTile=null;fa._visible=!0;fa._transparencyState=a.TransparencyMode.Opaque;fa._velvetOverground=!0;fa._castShadows=!0;fa._emptyTex=null;fa._tileRenderer=null;fa._stencilEnabledLayerExtents=[];fa._numTilesRendered=0;fa._numTilesCulled=
0;fa._numOriginsRendered=0;fa.needsHighlight=!1;fa.renderOccludedFlags=S.RenderOccludedFlag.Occlude;return fa}b._inherits(ha,da);var ca=b._createSuper(ha);da=ha.prototype;da.initialize=function(){this._stage.addRenderPlugin([Q.RenderSlot.OPAQUE_TERRAIN,Q.RenderSlot.TRANSPARENT_TERRAIN,Q.RenderSlot.OCCLUDED_TERRAIN],this)};da.destroy=function(){this._stage.removeRenderPlugin(this);A.clearCaches()};da.setDebugScreenSizePerspective=function(fa){this._techniqueConfiguration.screenSizePerspective!==fa&&
(this._techniqueConfiguration.screenSizePerspective=fa,this.setNeedsRender())};da.setRootTiles=function(fa){this._rootTiles=fa;this.setDirty()};da.setNeedsHighlight=function(fa){this.needsHighlight=fa;this.setNeedsRender()};da.setRenderOccludedOverlay=function(fa){this.renderOccludedFlags=fa?v.overlayRenderOccludedFlag:S.RenderOccludedFlag.Occlude;this.setNeedsRender()};da.setStencilEnabledLayerExtents=function(fa){this._stencilEnabledLayerExtents=fa;this._setSortingDirty()};da.setTileSize=function(fa){this._tileSize=
fa;x.isSome(this._tileRenderer)&&(this._tileRenderer.tileSize=fa);this.setDirty()};da._prepareTileForLoading=function(fa){fa.renderData||(fa.renderData=this._renderDataPool.acquire(),fa.renderData.init(fa),fa.renderData.localOrigin=this._getLocalOriginOfTile(fa))};da.loadTile=function(fa){this._prepareTileForLoading(fa);this.updateTileGeometryState(fa);this.updateTileTexture(fa,H.TileUpdate.TEXTURE_FADING)};da.updateTileTexture=function(fa,ma){x.isSome(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(fa,
ma===H.TileUpdate.TEXTURE_FADING?B.TextureUpdate.FADING:B.TextureUpdate.UNFADED),this.setNeedsRender(),fa.resetPendingUpdate(ma))};da.updateTileGeometryState=function(fa){for(const ma of fa.layerInfo[D.LayerClass.ELEVATION])ma.pendingUpdates&=~H.TileUpdate.GEOMETRY;fa.resetPendingUpdate(H.TileUpdate.GEOMETRY);(fa=fa.renderData.updateGeometryState())&&this.setDirty();return fa};da.updateGeometryIfNeeded=function(fa){fa.isLoaded&&fa.renderData.updateGeometryIfNeeded(this._rctx)};da.unloadTile=function(fa){const ma=
fa.renderData;ma&&(ma.releaseGeometry(),this._renderDataPool.release(ma),ma.clear(),fa.renderData=null,fa.setMemoryDirty(),this.setDirty())};da._getLocalOriginOfTile=function(fa){const ma=Math.max(0,7*Math.floor((fa.level-3)/7));if(this._isGlobal&&0===ma)return p.ZEROS;for(;fa.parent&&fa.level>ma;)fa=fa.parent;return fa.centerAtSeaLevel};da.setVisibility=function(fa){this._visible=fa;this.setDirty()};da.getStats=function(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,
numOriginsRendered:this._numOriginsRendered}};da.setDirty=function(fa=G.RenderRequestType.UPDATE){this._patchGroupsDirty=!0;this._context.requestRender(fa)};da._setSortingDirty=function(fa=G.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(fa)};da.setNeedsRender=function(fa=G.RenderRequestType.UPDATE){this._context.requestRender(fa)};da.initializeRenderContext=function(fa){this._context=fa;this._rctx=fa.renderContext.rctx;this._techniqueRepository=fa.techniqueRepository;
this._tileRenderer=new F.TileRenderer(this._rctx,this._tileSize,this._techniqueRepository);this.updateTileBackground();this._emptyTex=P.createEmptyTexture(this._rctx)};da.uninitializeRenderContext=function(){this._emptyTex=x.disposeMaybe(this._emptyTex);this._tileRenderer=x.disposeMaybe(this._tileRenderer)};da.intersect=function(fa,ma,qa,wa){if(!(!this._rootTiles||fa.options.selectOpaqueTerrainOnly&&fa.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var xa=ba,pa=ea;u.subtract(xa,
wa,qa);u.set(pa,1/xa[0],1/xa[1],1/xa[2]);var ra=fa.results.min,va=fa.results.max,Ba=fa.results.ground,Aa=fa.options.store===N.StoreResults.MIN,Ha=!!fa.results.ground.target,Ka=T.getVerticalOffsetTerrain(fa.verticalOffset),Pa=fa.tolerance,Ra,Sa=Aa&&x.isSome(ra.dist)?ra.dist:Infinity,La=Za=>{var Xa=Za.renderData;if(Xa?.vao){var la=Xa.geometryInfo;r.set(na,la.boundingBox);var Ta=Xa.localOrigin;x.isSome(Ka)&&(Ka.localOrigin=Ta,Ka.applyToAabb(na));ja[0]=qa[0]-Ta[0];ja[1]=qa[1]-Ta[1];ja[2]=qa[2]-Ta[2];
if(Z.intersectAabbInvDirBefore(na,ja,pa,Pa,Sa)){var Ma=(ua,Da,Ia)=>{ua.set(this.type,Za,Da,Ia,k.IDENTITY);Sa=Aa&&x.isSome(ra.dist)?ra.dist:Infinity};Xa=(ua,Da)=>{x.isSome(Da)&&0<=ua&&(fa.options.backfacesTerrain||0>u.dot(Da,xa))&&(fa.options.invisibleTerrain||!fa.options.selectionMode||null==ma||ma(qa,wa,ua))&&((null==Ba.dist||ua<Ba.dist)&&Ma(Ba,ua,Da),fa.options.isFiltered||(fa.options.store===N.StoreResults.ALL&&(x.isNone(Ra)?(Ra=U.newIntersectorResult(fa.ray),Ma(Ra,ua,Da),fa.results.all.push(Ra)):
ua<Ra.dist&&Ma(Ra,ua,Da)),(null==ra.dist||ua<ra.dist)&&Ma(ra,ua,Da),fa.options.store!==N.StoreResults.MIN&&(null==va.dist||ua>va.dist)&&Ma(va,ua,Da)))};var fb=ka;u.subtract(fb,wa,Ta);Ta=la.indices;var ya=la.vertexAttributes,oa=ya.getField(V.VertexAttribute.POSITION,q.BufferViewVec3f);ya=new M.Attribute(oa.typedBuffer,3,!1,ya.stride/4);la=la.indexCount/3;x.isNone(Ka)&&la>I.componentMinimalSizeForIntersectionData?(oa=Za.renderData,x.isNone(oa.intersectionData)&&(oa.intersectionData=new I.ComponentIntersectionData(Ta,
0,la,ya)),oa.intersectionData.intersectRay({r0:ja,r1:fb},Xa)):Z.intersectTriangles(ja,fb,0,la,Ta,ya,null,Ka,Xa)}}},Ua=this._rootTiles;x.isSome(Ua)&&(()=>{const Za=this._tileIterator;Za.reset(Ua);const Xa=fa.options.invisibleTerrain;for(let la=Za.next();la;la=Za.next())!(la.visible||Xa&&la.intersectsClippingArea)||!x.isSome(Ka)&&!la.intersectsRay(qa,xa,Pa,Sa)||Ha&&this._useStencilForTile(la)?Za.skipSubtree():La(la)})()}};da.processScaleRangeQueries=function(fa,ma){if(!ma.done)for(this._updatePatchGroups();fa.updating&&
!ma.done;){fa.prepare();for(const qa of this._patchGroups.values())for(const wa of qa)x.isSome(wa.renderData?.textureReference)&&fa.queriesForTile(wa);fa.process();ma.madeProgress()}};da.prepareTechnique=function(fa){if(fa.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN){if(0===(fa.renderOccludedMask&v.overlayRenderOccludedFlag))return null}else if(fa.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?Q.RenderSlot.OPAQUE_TERRAIN:Q.RenderSlot.TRANSPARENT_TERRAIN))return null;
switch(fa.output){case L.ShaderOutput.Color:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.hasScreenSpaceReflections=fa.bindParameters.ssr.enabled;this._techniqueConfiguration.hasCloudsReflections=x.isSome(fa.bindParameters.cloudsFade.data);this._techniqueConfiguration.receiveShadows=fa.bindParameters.shadowMap.ready;this._techniqueConfiguration.receiveAmbientOcclusion=fa.bindParameters.ssaoHelper.active;this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?
R.OverlayMode.Disabled:this._overlayRenderer.hasWater?R.OverlayMode.EnabledWithWater:R.OverlayMode.Enabled;return this._updateTechnique(L.ShaderOutput.Color,fa.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN);case L.ShaderOutput.Shadow:case L.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows&&1===fa.bindParameters.lighting.globalFactor)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Shadow,!1);
break;case L.ShaderOutput.Depth:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1;return this._updateTechnique(L.ShaderOutput.Depth,!1);case L.ShaderOutput.Normal:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1;return this._updateTechnique(L.ShaderOutput.Normal,!1);case L.ShaderOutput.ObjectAndLayerIdColor:return this.transparency===
a.TransparencyMode.Empty?null:this._updateTechnique(L.ShaderOutput.ObjectAndLayerIdColor,!1);case L.ShaderOutput.Highlight:if(this.transparency!==a.TransparencyMode.Empty&&this.needsHighlight)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Highlight,!1)}return null};da.render=function(fa,ma){const qa=1===fa.bindParameters.lighting.globalFactor;this._updatePatchGroups();ma.useStencil=!1;switch(fa.output){case L.ShaderOutput.Color:const wa=
fa.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN?z.OverlaySource.Occluded:z.OverlaySource.ColorAndWater;this.transparency===a.TransparencyMode.Opaque?this._renderMaterialPass(fa,ma,wa):fa.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(fa,ma,wa),fa.offscreenRenderingHelper.tmpColor,fa.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break;case L.ShaderOutput.Depth:case L.ShaderOutput.Normal:this._renderAuxiliaryPass(fa,ma,z.OverlaySource.None);break;case L.ShaderOutput.Highlight:this.needsHighlight&&
this._renderAuxiliaryPass(fa,ma,z.OverlaySource.Highlight);break;case L.ShaderOutput.Shadow:case L.ShaderOutput.ShadowExcludeHighlight:this._castShadows&&qa&&this._renderAuxiliaryPass(fa,ma,z.OverlaySource.None);break;case L.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(fa,ma,z.OverlaySource.ObjectAndLayerIdColor)}};da._renderMaterialPass=function(fa,ma,qa){const {rctx:wa}=fa;this._passParameters.overlaySource=qa;wa.bindTechnique(ma,this._passParameters,fa.bindParameters);this._numOriginsRendered=
this._numTilesCulled=this._numTilesRendered=0;this._renderPatchGroups(fa,ma,qa)};da._renderAuxiliaryPass=function(fa,ma,qa){const wa=fa.rctx;this._passParameters.overlaySource=qa;wa.bindTechnique(ma,this._passParameters,fa.bindParameters);this._renderPatchGroupsAuxiliary(fa,ma,qa)};da.updateTileBackground=function(fa=null){if(!x.isNone(this._tileRenderer)){var ma=this._tileRenderer,qa=null;x.isSome(fa)&&(fa=w.toUnitRGBA(fa),qa=p.fromValues(fa[0]||0,fa[1]||0,fa[2]||0));ma.setBackground(qa);this._allTiles.forAll(wa=>
ma.updateTileTexture(wa,B.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=ma.backgroundIsGrid?J.TileBlendInput.GridComposite:x.isSome(ma.backgroundColor)?J.TileBlendInput.ColorComposite:J.TileBlendInput.LayerOnly;this.setNeedsRender()}};da._updatePatchGroups=function(){this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&this.renderOrder!==C.RenderOrder.NONE){const fa=
Array.from(this._patchGroups.values()),ma=this._stencilEnabledLayerExtents;for(const qa of fa)K.sortTiles(this.renderOrder,qa,ma);fa.sort((qa,wa)=>K.compareTiles(qa[0],wa[0],this.renderOrder));this._patchGroups=new Map(fa.map(qa=>[qa[0].renderData.localOrigin,qa]));this._patchSortingDirty=!1}};da._rebuildPatchGroups=function(){const fa=this._rootTiles;if(!x.isNone(fa)){fa[0]?.surface.checkAllTilesWaterproofness();this._patchGroups.clear();for(const ma of fa)this._rebuildPatchGroupsForRootTile(ma)}};
da._rebuildPatchGroupsForRootTile=function(fa){const ma=this._tileIterator;for(ma.resetOne(fa);!ma.done;){fa=ma.next();var qa=fa.renderData;if(!qa){this._numTilesCulled++;continue}if(!fa.visible){this._numTilesCulled++;ma.skipSubtree();continue}qa=qa.localOrigin;let wa=this._patchGroups.get(qa);wa||(wa=[],this._patchGroups.set(qa,wa));wa.push(fa);if(!this._highestVisibleLODTile||fa.elevationLevel>this._highestVisibleLODTile.elevationLevel)this._highestVisibleLODTile=fa;ma.skipSubtree()}};da._useStencilForTile=
function(fa){for(const ma of this._stencilEnabledLayerExtents)if(fa.intersectsExtent(ma))return!0;return!1};da._renderPatchGroupsAuxiliary=function(fa,ma,qa){const wa=0<this._stencilEnabledLayerExtents.length;this._patchGroups.forEach(xa=>{ma.program.bindDraw(new X.DrawParameters(xa[0].renderData.localOrigin),fa.bindParameters,this._passParameters);for(let pa=0;pa<xa.length;pa++)this._renderPatch(fa,ma,xa[pa],ia.PrimitiveType.TRIANGLES,wa,qa)});fa.rctx.bindVAO(null)};da._renderPatchGroups=function(fa,
ma,qa){var wa=fa.bindParameters.camera;const xa=ma.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&W.getSettings(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:wa.fovY});wa=0<this._stencilEnabledLayerExtents.length;const pa=qa===z.OverlaySource.Occluded;pa&&(xa.bindTexture("tex",this._emptyTex),xa.setUniform3fv("textureOpacities",p.ZEROS),xa.setUniform4fv("texOffsetAndScale",h.ZEROS));var ra=
x.isSome(this._tileRenderer)&&x.isSome(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:p.ZEROS;this._techniqueConfiguration.tileBlendInput===J.TileBlendInput.ColorComposite&&xa.setUniform3fv("backgroundColor",ra);ra=this.wireframe?ia.PrimitiveType.LINES:ia.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&xa.bindTexture("texNext",this._emptyTex);var va=this._patchGroups;for(const Ba of va.values()){ma.program.bindDraw(new X.DrawParameters(Ba[0].renderData.localOrigin),
fa.bindParameters,this._passParameters);this._numOriginsRendered++;for(const Aa of Ba){va=Aa.renderData;const Ha=va.textureReference;if(!x.isNone(Ha)){if(!pa){xa.setUniform4fv("texOffsetAndScale",Ha.offsetAndScale);xa.bindTexture("tex",Ha.texture.texture);const Ka=va.textureFadeFactor,Pa=1>Ka?va.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x.isSome(Pa)&&1>Ka?(xa.setUniform1f("fadeFactor",Ka),xa.setUniform4fv("nextTexOffsetAndScale",Pa.offsetAndScale),xa.setUniform3fv("nextTexOpacities",
Pa.opacities),xa.bindTexture("texNext",Pa.texture.texture)):xa.setUniform1f("fadeFactor",1);va.textureIsFading&&this.setNeedsRender();xa.setUniform3fv("textureOpacities",Ha.opacities)}this._renderPatch(fa,ma,Aa,ra,wa,qa);Aa.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}fa.rctx.bindVAO(null)};da._renderPatch=function(fa,ma,qa,wa,xa,pa){const ra=qa.renderData,va=ra.vao,Ba=va.indexBuffer;if(x.isNone(Ba))E.ENABLE_TERRAIN_INTERNAL_CHECKS&&console.error("Rendered tile with no indices: ",
qa.lij," : ",ra);else{var Aa=ma.program;pa===z.OverlaySource.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(Aa,ra.overlay);xa&&(ma.useStencil=this._useStencilForTile(qa),ma.bindPipelineState(fa.rctx,fa.bindParameters.slot));ma=ra.geometryInfo.indexCount;fa.rctx.bindVAO(va);Aa.assertCompatibleVertexAttributeLocations(va);fa.rctx.drawElements(wa,ma,Ba.indexType,0)}};da._bindOverlayPatchData=function(fa,ma){fa.setUniform4fv("overlayTexOffset",ma.offsets);fa.setUniform4fv("overlayTexScale",
ma.scales)};da._updateTechnique=function(fa,ma){this._techniqueConfiguration.output=fa;fa===L.ShaderOutput.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground);this._techniqueConfiguration.renderOccluded=ma;return this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(Y.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)};b._createClass(ha,[{key:"_isGlobal",get:function(){return this._stage.viewingMode===y.ViewingMode.Global}},{key:"canRender",
get:function(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(fa){this._set("renderingDisabled",!!fa);this.setDirty()}},{key:"transparency",get:function(){return this._transparencyState},set:function(fa){this._transparencyState!==fa&&(this._techniqueConfiguration.invisible=fa===a.TransparencyMode.TransparentWithDraped||fa===a.TransparencyMode.Empty,this._transparencyState=fa,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this._overlayRenderer.hasWater}},
{key:"renderPatchBorders",get:function(){return!!this._techniqueConfiguration.tileBorders},set:function(fa){this._techniqueConfiguration.tileBorders!==fa&&(this._techniqueConfiguration.tileBorders=fa,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"visualizeNormals",get:function(){return!!this._techniqueConfiguration.visualizeNormals},set:function(fa){this._techniqueConfiguration.visualizeNormals!==fa&&(this._techniqueConfiguration.visualizeNormals=fa,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}},
{key:"cullBackFaces",get:function(){return this._techniqueConfiguration.backfaceCullingEnabled},set:function(fa){this._techniqueConfiguration.backfaceCullingEnabled!==fa&&(this._techniqueConfiguration.backfaceCullingEnabled=fa,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(fa){this._set("renderOrder",fa);this._setSortingDirty()}},{key:"velvetOverground",set:function(fa){this._velvetOverground!==fa&&(this._velvetOverground=fa,this.setNeedsRender())}},{key:"layerUid",
get:function(){return T.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this._techniqueConfiguration.hasSlicePlane},set:function(fa){this._techniqueConfiguration.hasSlicePlane!==fa&&(this._techniqueConfiguration.hasSlicePlane=fa,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(fa){this._techniqueConfiguration.textureFadingEnabled!==fa&&(this._techniqueConfiguration.textureFadingEnabled=fa,this.setNeedsRender())}},{key:"pbrMode",set:function(fa){this._techniqueConfiguration.pbrMode!==
fa&&(this._techniqueConfiguration.pbrMode=fa,this.setNeedsRender())}},{key:"wireframe",set:function(fa){this._get("wireframe")!==fa&&(this._set("wireframe",fa),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this._tileRenderer}}}]);return ha}(n);c.__decorate([l.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_overlayRenderer",void 0);c.__decorate([l.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_stage",void 0);c.__decorate([l.property({readOnly:!0})],
a.TerrainRenderer.prototype,"_isGlobal",null);c.__decorate([l.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_allTiles",void 0);c.__decorate([l.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_ellipsoidRadius",void 0);c.__decorate([l.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);c.__decorate([l.property()],a.TerrainRenderer.prototype,"renderPatchBorders",null);c.__decorate([l.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);c.__decorate([l.property()],
a.TerrainRenderer.prototype,"cullBackFaces",null);c.__decorate([l.property({value:C.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,"renderOrder",null);c.__decorate([l.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=c.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);const ba=p.create(),ea=p.create(),ja=p.create(),ka=p.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/context-util ../../webgl/enums ../../webgl/Texture".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(M,G){O.layerIndex=G;const P=M.layerInfo[d.LayerClass.MAP][G];if(w.isSome(P.data))return n.set(O.offset,0,0),O.tile=M,O.scale=1,O.sourceLod=M.lij,O.sourceLayerInfo=P,O;M=P.upsampleInfo;return w.isSome(M)?(G=M.tile.layerInfo[d.LayerClass.MAP][G],O.tile=M.tile,n.copy(O.offset,M.offset),O.scale=M.scale,O.sourceLod=M.tile.lij,O.sourceLayerInfo=G,O):null}function t(M){let G="normal"!==M.blendMode;m.isGroupLayer(M.parent)&&(G=t(M.parent)||
G);return G}function C(M,G){m.isGroupLayer(M.parent)&&C(M.parent,G);const P=M.get("uid");if(w.isSome(P)&&""!==P){const U=L.get(P);U?U.start=G:L.set(P,new E(G,G,M.blendMode,M.opacity))}}let E=b._createClass(function(M,G,P,U){this.start=M;this.end=G;this.blendMode=P;this.opacity=U}),F=function(){function M(P,U,N){this._rctx=P;this.tileSize=U;this._techniqueRepository=N;this._passParameters=new g.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._blackTex=
null;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new p.TileCompositor(this._rctx,this._techniqueRepository);this._blackTex=new h(B.createColorTexture(this._rctx,[0,0,0,1]));this._ensureBackgroundTexture(this.tileSize)}var G=M.prototype;G.dispose=function(){this._composition=w.disposeMaybe(this._composition);this._backgroundTexture=w.releaseMaybe(this._backgroundTexture);this._blackTex=w.releaseMaybe(this._blackTex)};G.updateTileTexture=function(P,U){if(P.renderData){var N=
P.surface,S=N.baseOpacity,Q=0,W=0,V=this.tileSize,T=!1,X=N.view.state.contentPixelRatio,Z=!1;L.clear();R.length=0;for(var Y=P.layerInfo[d.LayerClass.MAP],aa=Y.length,ia=0;ia<Y.length;ia++){const ea=N.layerViewByIndex(ia,d.LayerClass.MAP);var na=ea.layer.opacity;H[ia]=na;const ja=ea.fullOpacity;K[ia]=ja;m.isBaseLayer(ea.layer)&&aa>=Y.length&&(aa=ia);if(e.isBlendableLayerView(ea)){I[ia]=ea.layer.blendMode;var ba="normal"!==ea.layer.blendMode;if(m.isGroupLayer(ea.layer.parent)){const ka=ea.layer.parent.get("uid");
w.isSome(ka)&&""!==ka&&(ba=t(ea.layer.parent)||ba)}ba&&(Z=ba,T=!1)}if(0!==na||Z){if(++W,na=A(P,ia))Y[ia].pendingUpdates&=~(r.TileUpdate.TEXTURE_NOFADING&r.TileUpdate.TEXTURE_FADING),m.isGroupLayer(ea.layer.parent)&&(ba=ea.layer.parent.get("uid"),w.isSome(ba)&&""!==ba&&C(ea.layer.parent,ia)),e.isVectorTileLayerView(ea)?V=Math.max(V,this.tileSize*X):1===S&&1===ja&&(ea.isOpaque||this._dataToTexture(na)&&na.sourceLayerInfo.data.descriptor.isOpaque)&&(T=!0),++Q}else Y[ia].pendingUpdates&=~(r.TileUpdate.TEXTURE_NOFADING&
r.TileUpdate.TEXTURE_FADING)}this._rctx.type===D.ContextType.WEBGL1&&(X=V,V=c.nextHighestPowerOfTwo(X),N=V*V,S=X*X,N===S?V=X:(X=V/2,V=N-S<S-X*X?V:X));N=V/this.tileSize;--ia;this._ensureBackgroundTexture(this.tileSize);0===Q?this._useBackgroundTexture(P,W):(1!==Q||Z||!this._useLayerTexture(P,ia,aa,K[ia]))&&this._composeMapLayers(P,U,ia,aa,H,I,V,N,!T||Z,L,Z)}};G._ensureBackgroundTexture=function(P){w.isNone(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(P),this._backgroundDirty=
!0);this._backgroundDirty&&(this._composition.bind(P),this._passParameters.offset=x.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,w.isSome(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,w.isSome(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)};G._useBackgroundTexture=function(P,U){let N=k.ActivationTime.Immediate;
if(P.surface.view.layerViewManager.updating||0<U)N=k.ActivationTime.Delayed;U=P.renderData;this._backgroundTexture&&w.isNone(U.textureReference)&&(N=k.ActivationTime.Immediate);U.setTextureReference(w.isSome(this._backgroundTexture)?new u.TextureReference(this._backgroundTexture,f.TextureUpdate.FADING,J,P.surface.baseOpacity,0,1):null,N)};G._useLayerTexture=function(P,U,N,S){var Q=U<N;N=Q?1:P.surface.baseOpacity;Q=Q?P.surface.baseOpacity:1;U=A(P,U);return this._dataToTexture(U)?(P.renderData.setTextureReference(new u.TextureReference(U.sourceLayerInfo.data,
f.TextureUpdate.FADING,U,N,Q,S)),!0):!1};G._composeMapLayers=function(P,U,N,S,Q,W,V,T,X,Z,Y){this._composition.ensureBuffer(V);const aa=P.surface.baseOpacity;let ia=!1,na=z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,ba=!1,ea=0;for(let da=N;0<=da;da--){var ja=A(P,da);if(!ja)continue;if(0===Q[da]&&!Y)continue;var ka=da<S&&1>aa&&!ia;this._passParameters.baseOpacity=ka?aa:1;N=1>this._passParameters.baseOpacity?y.BaseOpacityMode.Required:y.BaseOpacityMode.NotRequired;ka&&(ia=!0);let ha=!1;Z.forEach(ma=>
{ma.start===da&&(R.push(ma),this._composition.openGroup(V),ha=!0)});ka=0===ea;const ca=ha?y.BlendLayersOutput.GroupBackgroundComposite:X&&ka?this.backgroundIsGrid?y.BlendLayersOutput.GridComposite:y.BlendLayersOutput.ColorComposite:y.BlendLayersOutput.Composite,fa=q.blendModeFromString[W[da]];e.isVectorTileRenderInfo(ja)?(this._passParameters.opacity=Q[da],ba=this._composition.drawVectorData(this._passParameters,ca,V,fa,N,ja,T,this.tileSize,ba)):e.isImageryTileRenderInfo(ja)?(this._passParameters.opacity=
Q[da],this._composition.drawImageryTileData(this._passParameters,ca,V,fa,N,ja),this._hasNearestInterpolation(ja)&&(na=z.TextureSamplingMode.NEAREST)):this._dataToTexture(ja)&&(this._passParameters.texture=ja.sourceLayerInfo.data.texture,this._passParameters.offset=ja.offset,this._passParameters.scale=ja.scale,this._passParameters.opacity=Q[da],this._composition.drawRasterData(this._passParameters,ca,V,fa,N));for(;0<R.length&&R[R.length-1].end===da;)ja=R.pop(),this._passParameters.opacity=ja.opacity,
this._passParameters.offset=x.ZEROS,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,X&&ka?this.backgroundIsGrid?y.BlendLayersOutput.GridComposite:y.BlendLayersOutput.ColorComposite:y.BlendLayersOutput.Composite,V,q.blendModeFromString[ja.blendMode],N);ea++}P=P.renderData;S=P.ensureTexture(V,()=>this._buildTexture(V,na));this._composition.copyFBOToTexture(S);this._composition.unbind();P.setTextureReference(new u.TextureReference(S,U,J,ia?1:aa,0,1))};G._hasNearestInterpolation=
function(P){P=P.sourceLayerInfo.data;return P.source?"nearest"===P.interpolation:!1};G._dataToTexture=function(P){if(e.isRasterTileRenderInfo(P)){const U=P.sourceLayerInfo;U.data=this._buildTexture(U.data);P.tile.setMemoryDirty()}return e.isTextureTileRenderInfo(P)};G.setBackground=function(P){this._backgroundColor!==P&&(this._backgroundColor=P,this._backgroundDirty=!0)};G._buildTexture=function(P,U=z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(w.isNone(P))return null;const N={target:z.TextureType.TEXTURE_2D,
pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:U,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0};U=this._rctx;let S;if("number"===typeof P)N.width=N.height=P,S=new h(new v.Texture(U,N));else if(P instanceof l.ImageWithType)N.isOpaque=P.isOpaque,S=new h(new v.Texture(U,N,P.image)),P.release();else try{N.width=P.width,N.height=P.height,S=new h(new v.Texture(U,N,P))}catch(Q){S=new h(B.createEmptyTexture(U)),
console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}P=U.bindTexture(S.texture,v.Texture.TEXTURE_UNIT_FOR_UPDATES);S.generateMipmap();U.bindTexture(P,v.Texture.TEXTURE_UNIT_FOR_UPDATES);return S};b._createClass(M,[{key:"backgroundIsGrid",get:function(){return w.isNone(this._backgroundColor)}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return M}();
const H=[],K=[],I=[],L=new Map,R=[],O={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},J={offset:[0,0],scale:1};a.GroupInfo=E;a.TileRenderer=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){m=function(h){function r(){var y=q.apply(this,arguments);y.opacity=1;y.baseOpacity=1;y.texture=null;y.fboTexture=null;y.backgroundColor=n.ZEROS;return y}c._inherits(r,h);var q=c._createSuper(r);return c._createClass(r)}(m.TileCompositePassParameters);f=function(h){function r(){return q.apply(this,arguments)}c._inherits(r,h);var q=c._createSuper(r);h=r.prototype;h.initializeProgram=function(y){return new k.Program(y.rctx,r.shader.get().build(this.configuration),
e.Default3D)};h.initializePipeline=function(){return p.makePipelineState({blending:p.simpleBlendingParams(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:p.defaultColorWriteParams})};return c._createClass(r)}(f.ShaderTechnique);f.shader=new g.ReloadableShaderModule(l.BlendLayers,()=>new Promise((h,r)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],h,r)));x=function(h){function r(){var y=q.apply(this,arguments);y.background=l.BackgroundMode.BelowLayer;return y}c._inherits(r,
h);var q=c._createSuper(r);return c._createClass(r)}(x.TileBlendTechniqueConfiguration);w.__decorate([d.parameter()],x.prototype,"background",void 0);b.BlendLayersPassParameters=m;b.BlendLayersTechnique=f;b.BlendLayersTechniqueConfiguration=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x){w=function(m){function l(){var f=g.apply(this,arguments);f.output=n.BlendLayersOutput.Composite;f.baseOpacityMode=n.BaseOpacityMode.NotRequired;f.premultipliedSource=n.PremultipliedAlphaSource.Off;return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(w.BlendModeTechniqueConfiguration);c.__decorate([x.parameter({count:n.BlendLayersOutput.COUNT})],w.prototype,"output",void 0);c.__decorate([x.parameter({count:n.BaseOpacityMode.COUNT})],w.prototype,"baseOpacityMode",
void 0);c.__decorate([x.parameter()],w.prototype,"premultipliedSource",void 0);a.TileBlendTechniqueConfiguration=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w,n){let x=function(m){function l(){var f=
g.apply(this,arguments);f.blendMode=w.LayerBlendMode.Normal;return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:w.LayerBlendMode.COUNT})],x.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(e){const k=new l.ShaderBuilder;k.include(w.TileComposite);if(e.background===a.BackgroundMode.Only)return(e=e.output===c.BlendLayersOutput.ColorComposite)?k.fragment.uniforms.add(new n.Float3PassUniform("backgroundColor",u=>u.backgroundColor)):k.fragment.include(b.BackgroundGrid),k.fragment.code.add(m.glsl`
    void main() {
      fragColor = vec4(${e?m.glsl`backgroundColor`:m.glsl`gridColor(uv)`}, 1.0);
    }
  `),k;k.include(c.TileBackground,e);k.fragment.uniforms.add(new g.Texture2DPassUniform("tex",u=>u.texture));k.fragment.uniforms.add(new x.FloatPassUniform("opacity",u=>u.opacity));k.fragment.code.add(m.glsl`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`);return k}a.BackgroundMode=void 0;(function(e){e[e.BelowLayer=0]="BelowLayer";e[e.Only=1]="Only";e[e.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const d=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:f},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=d;a.build=f})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3f64","../../../chunks/vec4f64"],
function(a,b,c,w){let n=function(){function x(m,l,g,f,d,e){this.texture=m;this.type=l;m.retain();this.offsetAndScale=w.fromValues(g.offset[0],g.offset[1],g.scale,g.scale);this.opacities=c.fromValues(f,d,e)}x.prototype.destroy=function(){this.texture.release()};return b._createClass(x)}();a.TextureReference=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){const D=c.getLogger("esri.views.3d.terrain");c=function(){function z(A,t){this._rctx=A;this._techniqueRepository=t;this._fbos=[];this._vectorTileHelper=new m.VectorTileRendererHelper3D;this._bindParameters=new p.BindParameters(null,null,null);this._blendLayersTechniqueConfig=new l.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=r.createQuadVAO(this._rctx,h.Pos2Tex)}
var v=z.prototype;v.dispose=function(){this._fbos.forEach(w.disposeMaybe);this._fbos=null;this._vtFBO=w.disposeMaybe(this._vtFBO);this._vaoQuad=w.disposeMaybe(this._vaoQuad);this._vectorTileHelper=w.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=w.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=w.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=w.releaseMaybe(this._blendLayersTechnique)};v._getBlendLayersTechnique=function(A,t,C,E=k.PremultipliedAlphaSource.Off,
F=u.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=t;this._blendLayersTechniqueConfig.blendMode=A;this._blendLayersTechniqueConfig.baseOpacityMode=C;this._blendLayersTechniqueConfig.premultipliedSource=E;this._blendLayersTechniqueConfig.background=F;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(l.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)};v.drawBackground=function(A,t){t=this._getBlendLayersTechnique(e.LayerBlendMode.Normal,
t?k.BlendLayersOutput.ColorComposite:k.BlendLayersOutput.GridComposite,k.BaseOpacityMode.NotRequired,k.PremultipliedAlphaSource.Off,u.BackgroundMode.Only);A=this._rctx.bindTechnique(t,A,this._bindParameters);this._render(A)};v._render=function(A){this._rctx.bindVAO(this._vaoQuad);A.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(q.PrimitiveType.TRIANGLE_STRIP,0,B.vertexCount(this._vaoQuad,"geometry"))};v.drawGroup=function(A,t,C,E,F,H=k.PremultipliedAlphaSource.On){t===
k.BlendLayersOutput.Composite&&(A.fboTexture=this._fbos[this.getLastOnHoldId()].get(C).colorTexture);A.texture=this.currentFBO(C).colorTexture;this.closeGroup(C);t=this._getBlendLayersTechnique(E,t,F,H);A=this._rctx.bindTechnique(t,A,this._bindParameters);this._render(A)};v.drawRasterData=function(A,t,C,E,F,H=k.PremultipliedAlphaSource.Off){w.isNone(A.texture)||(A.fboTexture=t===k.BlendLayersOutput.GroupBackgroundComposite||E===e.LayerBlendMode.Normal&&F===k.BaseOpacityMode.NotRequired&&H===k.PremultipliedAlphaSource.Off?
null:this.switch(C).colorTexture,t=this._getBlendLayersTechnique(E,t,F,H),A=this._rctx.bindTechnique(t,A,this._bindParameters),this._render(A))};v.drawImageryTileData=function(A,t,C,E,F,H){var K=H.sourceLayerInfo.data;K.source&&(H.tile.surface.layerViewByIndex(H.layerIndex,g.LayerClass.MAP).ensureSymbolizerParameters(K),K.bind(this._rctx)&&(A.fboTexture=E===e.LayerBlendMode.Normal&&F===k.BaseOpacityMode.NotRequired?null:this.switch(C).colorTexture,t=this._getRasterColorizerTechnique(K,t,E,F),K.opacity=
A.opacity,K=K.getUniforms(),K.scale=H.scale,K.offset=H.offset,K.backgroundColor=A.backgroundColor,K.fboTexture=A.fboTexture,K.baseOpacity=A.baseOpacity,A=this._rctx.bindTechnique(t,K,null),this._render(A)))};v._getRasterColorizerTechnique=function(A,t,C,E){const F=A.symbolizerParameters,H=["stretch","lut","hillshade"].indexOf(F.type);w.isNone(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new f.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=t;this._rasterColorizerConfig.blendMode=C;this._rasterColorizerConfig.baseOpacityMode=E;this._rasterColorizerConfig.colorizerType=H;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.requireBilinearWithNN=A.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=A.hasStretchTypeNone()?x.RasterColorizerStretchType.Noop:x.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=
this._techniqueRepository.releaseAndAcquire(f.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};v.drawVectorData=function(A,t,C,E,F,H,K,I,L){const R=this._rctx,O=H.sourceLayerInfo.data,J=H.tile.surface.layerViewByIndex(H.layerIndex,g.LayerClass.MAP),M=F===k.BaseOpacityMode.Required||1>A.opacity||E!==e.LayerBlendMode.Normal||t!==k.BlendLayersOutput.Composite,G=M?k.PremultipliedAlphaSource.On:k.PremultipliedAlphaSource.Off;this._getBlendLayersTechnique(E,t,F,G).bindPipelineState(R);
let P=null,U=null;M?(U=this.currentFBO(C),w.isNone(this._vtFBO)&&(this._vtFBO=new d.MultiSizeFramebuffer(this._rctx)),P=this._vtFBO.get(C),R.bindFramebuffer(P),this._clearCurrentFBO()):L&&R.clearSafe(q.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(R,H.sourceLod,O,J.painter,J.layer.styleRepository,J.schemaHelper,Math.round(1/H.scale),H.offset,I,K)}catch(N){D.warnOnce("A render call containing vector tiles did not resolve correctly.",N)}return w.isSome(P)?(R.bindFramebuffer(U),
A.texture=P.colorTexture,A.offset=n.ZEROS,A.scale=1,this.drawRasterData(A,t,C,E,F,G),L):!0};v.copyFBOToTexture=function(A){const t=this._rctx,C=t.bindTexture(A.texture,y.Texture.TEXTURE_UNIT_FOR_UPDATES),E=A.descriptor;t.gl.copyTexImage2D(q.TextureType.TEXTURE_2D,0,E.pixelFormat,0,0,E.width,E.height,0);A.generateMipmap();t.bindTexture(C,y.Texture.TEXTURE_UNIT_FOR_UPDATES)};v._clearCurrentFBO=function(){this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.clearSafe(q.ClearBufferBit.COLOR_BUFFER_BIT|
q.ClearBufferBit.DEPTH_BUFFER_BIT)};v._initFBO=function(A,t,C){this._rctx.bindFramebuffer(A);C&&(this._rctx.setViewport(0,0,t,t),this._clearCurrentFBO())};v.ensureBuffer=function(A){this._lastUsedIds.length=0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(A)};v.bind=function(A,t=0,C=!0){this._current=t;if(t>=this._fbos.length)for(let E=this._fbos.length;E<=t;E++)this._fbos.push(new d.MultiSizeFramebuffer(this._rctx));this._initFBO(this._fbos[t].get(A),A,C)};
v._bindNextFreeBuffer=function(A){0<this._lastUsedIds.length?this.bind(A,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(A,this._lastCreatedBufferId))};v.openGroup=function(A){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(A)};v.switch=function(A){const t=this.currentFBO(A),C=this._current;this._bindNextFreeBuffer(A);this._lastUsedIds.push(C);return t};v.getLastOnHoldId=function(){return this._onHoldIds[this._onHoldIds.length-1]};v.closeGroup=function(A){const t=this._current;
this._bindNextFreeBuffer(A);this._lastUsedIds.push(t);this._lastUsedIds.push(this._onHoldIds.pop())};v.unbind=function(){this._rctx.bindFramebuffer(null)};v.currentFBO=function(A){return this._fbos[this._current].get(A)};return b._createClass(z)}();a.TileCompositor=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../Viewpoint ../../ViewState ../../../../geometry/Point".split(" "),
function(a,b,c,w,n,x){c=function(){function m(){this._renderParams={context:null,drawPhase:1,state:new n({viewpoint:new w({targetGeometry:new x(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,
dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}var l=m.prototype;l.dispose=function(){this._renderParams=null};l.render=function(g,f,d,e,k,u,p,h,r,q){const y=u.adjustLevel(f[0]),B=this._renderParams;B.context=g;B.painter=e;B.glyphMosaic=e.glyphMosaic;B.spriteMosaic=e.spriteMosaic;B.pixelRatio=q;B.displayLevel=y;B.requiredLevel=y;q=u.getScale(f[0]);const [D,z]=u.getShift(f,p*q);f=.125*p*q/r;u=d.transforms.dvs;u[0]=f;u[4]=-f;u[6]=-1-D-h[0]*p*2;u[7]=1+z+(1-
h[1])*p*2-2;B.state.size[0]=r;B.state.size[1]=r;d.stage||d.attachWithContext(g);d.triangleCount=0;e.drawTile(B,d,k)};return b._createClass(m)}();a.VectorTileRendererHelper3D=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){var A;const t=[0,0];c=A=function(C){function E(H){H=F.call(this,H);H._viewpoint2D={center:y.create(),rotation:0,scale:0,spatialReference:void 0};H.center=[0,0];H.extent=new z;H.id=0;H.inverseTransform=u.create();H.resolution=0;H.rotation=0;H.scale=0;H.transform=u.create();H.transformNoRotation=u.create();H.displayMat3=h.create();H.displayViewMat3=h.create();H.viewMat3=h.create();H.viewMat2d=k.create();H.worldScreenWidth=0;H.size=[0,0];return H}
a._inherits(E,C);var F=a._createSuper(E);C=E.prototype;C.copy=function(H){const K=this.size,I=this.viewpoint;I&&K?(this.viewpoint=D.copy(I,H.viewpoint),this._set("size",r.copy(K,H.size))):(this.viewpoint=H.viewpoint.clone(),this._set("size",[H.size[0],H.size[1]]));this._set("pixelRatio",H.pixelRatio);return this};C.clone=function(){return new A({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};C.toMap=function(H,K,I){if(B.isVec2(K))return r.transformMat2d(H,K,this.inverseTransform);
t[0]=K;t[1]=I;return r.transformMat2d(H,t,this.inverseTransform)};C.toScreen=function(H,K,I){if(B.isVec2(K))return r.transformMat2d(H,K,this.transform);t[0]=K;t[1]=I;return r.transformMat2d(H,t,this.transform)};C.toScreenNoRotation=function(H,K,I){if(B.isVec2(K))return r.transformMat2d(H,K,this.transformNoRotation);t[0]=K;t[1]=I;return r.transformMat2d(H,t,this.transformNoRotation)};C.getScreenTransform=function(H,K){const {center:I}=this._viewpoint2D,L=this._get("pixelRatio")||1,R=this._get("size");
D.getMatrix(H,I,R,K,0,L);return H};C._update=function(){const {center:H,spatialReference:K,scale:I,rotation:L}=this._viewpoint2D,R=this._get("pixelRatio")||1,O=this._get("size"),J=new w({targetGeometry:new v(H[0],H[1],K),scale:I,rotation:L});this._set("viewpoint",J);if(O&&K&&I){this.resolution=D.getResolution(J);this.rotation=L;this.scale=I;this.spatialReference=K;r.copy(this.center,H);p.set(this.displayMat3,0!==O[0]?2/O[0]:0,0,0,0,0!==O[1]?-2/O[1]:0,0,-1,1,1);var M=p.identity(this.viewMat3),G=q.fromValues(O[0]/
2,O[1]/2),P=q.fromValues(-O[0]/2,-O[1]/2),U=d.toRadian(L);p.translate(M,M,G);p.rotate(M,M,U);p.translate(M,M,P);p.multiply(this.displayViewMat3,this.displayMat3,M);M=e.fromTranslation(this.viewMat2d,G);e.rotate(M,M,U);e.translate(M,M,P);D.getExtent(this.extent,J,O);D.getTransform(this.transform,J,O,R);e.invert(this.inverseTransform,this.transform);D.getTransformNoRotation(this.transformNoRotation,J,O,R);this.worldScreenWidth=D.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(E,[{key:"pixelRatio",set:function(H){this._set("pixelRatio",H);this._update()}},{key:"size",set:function(H){this._set("size",H);this._update()}},{key:"viewpoint",set:function(H){if(H){const K=this._viewpoint2D,I=H.targetGeometry;K.center[0]=I.x;K.center[1]=I.y;K.rotation=H.rotation;K.scale=H.scale;K.spatialReference=I.spatialReference}this._update()}}]);return E}(n.JSONSupport);b.__decorate([x.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([x.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([x.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([x.property()],c.prototype,"spatialReference",void 0);b.__decorate([x.property({type:w,json:{write:!0}})],c.prototype,"viewpoint",null);return c=A=b.__decorate([f.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(m){return[m[0],m[1],m[2],m[3],m[4],m[5]]}function w(m,
l,g,f,d,e){return[m,l,g,f,d,e]}function n(m,l){return new Float64Array(m,l,6)}const x=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:n,fromValues:w},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.mat2df64=x})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(w){return w instanceof Float32Array&&2<=w.length}function c(w){return Array.isArray(w)&&2<=w.length}a.isVec2=function(w){return b(w)||
c(w)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(V,T){return T.type?g.set(V,T.x,T.y):g.copy(V,T)}function q(V,T){return Math.max(V.width/Math.max(1,T[0]),V.height/Math.max(1,T[1]))*t(V.spatialReference)}async function y(V,T,X,Z){if(!V||Array.isArray(V)&&!V.length)return null;c.isCollection(V)&&(V=V.toArray());if(Array.isArray(V)&&V.length&&"object"===typeof V[0]){var Y=V.every(ja=>"attributes"in ja);var aa=V.some(ja=>!ja.geometry),ia=V;if(Y&&aa&&T&&T.allLayerViews){Y=new Map;for(var na of V)V=
na.layer,aa=Y.get(V)||[],ia=na.attributes[V.objectIdField],null!=ia&&aa.push(ia),Y.set(V,aa);const ja=[];Y.forEach((ka,da)=>{const ha=T.allLayerViews.find(ca=>ca.layer.id===da.id);if(ha&&"queryFeatures"in ha){const ca=da.createQuery();ca.objectIds=ka;ca.returnGeometry=!0;ja.push(ha.queryFeatures(ca))}});na=await Promise.all(ja);V=[];for(var ba of na)if(ba&&ba.features&&ba.features.length)for(var ea of ba.features)w.isSome(ea.geometry)&&V.push(ea.geometry);ia=V}for(const ja of ia)Z=await y(ja,T,X,
Z);return Z}if(Array.isArray(V)&&2===V.length&&"number"===typeof V[0]&&"number"===typeof V[1])Y=new k(V);else if(V instanceof e)Y=V;else if("geometry"in V)if(V.geometry)Y=V.geometry;else if(V.layer){const ja=V.layer;(ba=T.allLayerViews.find(ka=>ka.layer.id===ja.id))&&"queryFeatures"in ba&&(ea=ja.createQuery(),ea.objectIds=[V.attributes[ja.objectIdField]],ea.returnGeometry=!0,ba=await ba.queryFeatures(ea),Y=w.get(ba,"features",0,"geometry"))}if(w.isNone(Y))return null;ba="point"===Y.type?new d({xmin:Y.x,
ymin:Y.y,xmax:Y.x,ymax:Y.y,spatialReference:Y.spatialReference}):Y.extent;if(!ba)return null;u.isLoaded()||u.canProjectWithoutEngine(ba.spatialReference,X)||await u.load();X=u.project(ba,X);return X?Z=Z?Z.union(X):X:null}function B(V){if(V&&(!Array.isArray(V)||"number"!==typeof V[0])&&("object"===typeof V||Array.isArray(V)&&"object"===typeof V[0])){if("layer"in V&&V.layer&&V.layer.minScale&&V.layer.maxScale){var T=V.layer;return{min:T.minScale,max:T.maxScale}}if(Array.isArray(V)&&V.length&&V.every(X=>
"layer"in X)){let X=T=0;for(const Z of V)(V=Z.layer)&&V.minScale&&V.maxScale&&(T=V.minScale<T?V.minScale:T,X=V.maxScale>X?V.maxScale:X);return T&&X?{min:T,max:X}:null}}}function D(V,T){return h.equals(V.wkid?V:V.spatialReference||p.WGS84,T)?V:u.project(V,T)}function z(V,T){const X=V.targetGeometry,Z=T.targetGeometry;X.x=Z.x;X.y=Z.y;X.spatialReference=Z.spatialReference;V.scale=T.scale;V.rotation=T.rotation;return V}function v(V,T,X){return X?g.set(V,.5*(T[0]-X.right+X.left),.5*(T[1]-X.bottom+X.top)):
g.scale(V,T,.5)}function A(V){var T=V.scale;V=V.targetGeometry;V=w.isSome(V)&&h.isValid(V.spatialReference)?1/(39.37*n.getMetersPerUnitForSR(V.spatialReference)*96):1;return T*V}function t(V){return h.isValid(V)?39.37*n.getMetersPerUnitForSR(V)*96:1}function C(V){return(V=h.getInfo(V))?V.valid[1]-V.valid[0]:0}const E=180/Math.PI,F=function(){const V=f.create();return function(T,X,Z){const Y=X.targetGeometry;r(V,Y);X=.5*A(X);T.xmin=V[0]-X*Z[0];T.ymin=V[1]-X*Z[1];T.xmax=V[0]+X*Z[0];T.ymax=V[1]+X*Z[1];
T.spatialReference=Y.spatialReference;return T}}(),H=function(){const V=f.create();return function(T,X,Z){return g.sub(T,g.scale(T,X,.5),v(V,X,Z))}}(),K=function(){const V=l.create(),T=f.create();return function(X,Z,Y,aa){const ia=A(Z);Z=x.toRadian(Z.rotation)||0;g.set(T,ia,ia);m.fromScaling(V,T);m.rotate(V,V,Z);m.translate(V,V,H(T,Y,aa));m.translate(V,V,[0,aa.top-aa.bottom]);return g.set(X,V[4],V[5])}}(),I=function(){const V=f.create(),T=f.create(),X=f.create();return function(Z,Y,aa,ia,na,ba){g.negate(V,
Y);g.scale(T,aa,.5*ba);g.set(X,1/ia*ba,-1/ia*ba);m.fromTranslation(Z,T);na&&m.rotate(Z,Z,na);m.scale(Z,Z,X);m.translate(Z,Z,V);return Z}}(),L=function(){const V=f.create();return function(T,X,Z,Y){const aa=A(X),ia=x.toRadian(X.rotation)||0;r(V,X.targetGeometry);return I(T,V,Z,aa,ia,Y)}}(),R=function(){const V=f.create();return function(T,X,Z,Y){const aa=A(X);r(V,X.targetGeometry);return I(T,V,Z,aa,0,Y)}}(),O=function(){const V=f.create(),T=f.create(),X=[0,0,0];return function(Z,Y,aa){g.subtract(V,
Z,Y);g.normalize(V,V);g.subtract(T,Z,aa);g.normalize(T,T);g.cross(X,V,T);Z=Math.acos(g.dot(V,T)/(g.length(V)*g.length(T)))*E;0>X[2]&&(Z=-Z);isNaN(Z)&&(Z=0);return Z}}(),J=function(){const V=f.create();return function(T,X,Z,Y){const aa=T.targetGeometry;z(T,X);K(V,X,Z,Y);aa.x+=V[0];aa.y+=V[1];return T}}(),M=function(){return function(V,T,X){z(V,T);T=V.targetGeometry;T.x=X.x;T.y=X.y;T.spatialReference=X.spatialReference;return V}}(),G=function(){const V=f.create();return function(T,X,Z,Y,aa){aa||(aa=
"center");g.sub(V,Z,Y);g.scale(V,V,.5);Z=V[0];Y=V[1];switch(aa){case "center":g.set(V,0,0);break;case "left":g.set(V,-Z,0);break;case "top":g.set(V,0,Y);break;case "right":g.set(V,Z,0);break;case "bottom":g.set(V,0,-Y);break;case "top-left":g.set(V,-Z,Y);break;case "bottom-left":g.set(V,-Z,-Y);break;case "top-right":g.set(V,Z,Y);break;case "bottom-right":g.set(V,Z,-Y)}W(T,X,V);return T}}(),P=function(){const V=f.create();return function(T,X,Z,Y,aa){z(T,X);isNaN(Z)||0===Z||(S(V,Y,X,aa),T.scale=X.scale*
Z,Q(V,V,T,aa),W(T,T,g.set(V,V[0]-Y[0],Y[1]-V[1])));return T}}(),U=function(){const V=f.create();return function(T,X,Z,Y,aa,ia){z(T,X);isNaN(Z)||0===Z||(S(V,aa,X,ia),T.scale=X.scale*Z,T.rotation+=Y,Q(V,V,T,ia),W(T,T,g.set(V,V[0]-aa[0],aa[1]-V[1])));return T}}(),N=function(){const V=f.create(),T=f.create();return function(X,Z,Y,aa,ia,na,ba){H(T,na,ba);g.add(V,ia,T);return aa?U(X,Z,Y,aa,V,na):P(X,Z,Y,V,na)}}(),S=function(){const V=l.create();return function(T,X,Z,Y){var aa=g.transformMat2d;L(V,Z,Y,1);
Z=m.invert(V,V);return aa.call(g,T,X,Z)}}(),Q=function(){const V=l.create();return function(T,X,Z,Y){return g.transformMat2d(T,X,L(V,Z,Y,1))}}(),W=function(){const V=f.create(),T=l.create();return function(X,Z,Y){z(X,Z);const aa=A(Z),ia=X.targetGeometry;m.fromRotation(T,x.toRadian(Z.rotation)||0);m.scale(T,T,f.fromValues(aa,aa));g.transformMat2d(V,Y,T);ia.x+=V[0];ia.y+=V[1];return X}}();a.addPadding=J;a.angleBetween=O;a.centerAt=M;a.copy=z;a.create=async function(V,T){if(!V||!T)return new b({targetGeometry:new k,
scale:0,rotation:0});let X=T.spatialReference;const {constraints:Z,padding:Y,viewpoint:aa,size:ia}=T,na=[Y?ia[0]-Y.left-Y.right:ia[0],Y?ia[1]-Y.top-Y.bottom:ia[1]];let ba=null;V instanceof b?ba=V:V.viewpoint?ba=V.viewpoint:V.target&&"esri.Viewpoint"===V.target.declaredClass&&(ba=V.target);let ea=null;if(ba&&ba.targetGeometry)ea=ba.targetGeometry;else if(V instanceof d)ea=V;else if(V||V&&("center"in V||"extent"in V||"target"in V))ea=await y(V.center,T,X)||await y(V.extent,T,X)||await y(V.target,T,
X)||await y(V,T,X);!ea&&aa&&aa.targetGeometry?ea=aa.targetGeometry:!ea&&T.extent&&(ea=T.extent);if(!X){var ja=T.spatialReference||T.extent||ea;X=ja.wkid?ja:ja.spatialReference||p.WGS84}u.isLoaded()||h.equals(ea.spatialReference,X)||u.canProjectWithoutEngine(ea,X)||await u.load();ja=D(ea.center??ea,X);var ka=0;ba&&w.isSome(ba.targetGeometry)&&"point"===ba.targetGeometry.type?ka=ba.scale:"scale"in V&&V.scale?ka=V.scale:"zoom"in V&&-1!==V.zoom&&Z&&Z.effectiveLODs?ka=Z.zoomToScale(V.zoom):Array.isArray(ea)||
"point"===ea.type||"extent"===ea.type&&0===ea.width&&0===ea.height?(ka=D(T.extent,X),ka=w.isSome(ka)?q(ka,na):T.extent?q(T.extent,na):aa.scale):ka=q(D(ea.extent,X),na);if(T=B(V))T.min&&T.min>ka?ka=T.min:T.max&&T.max<ka&&(ka=T.max);T=0;ba?T=ba.rotation:V.hasOwnProperty("rotation")?T=V.rotation:aa&&(T=aa.rotation);V=new b({targetGeometry:ja,scale:ka,rotation:T});Z&&(V=Z.fit(V),Z.constrainByGeometry(V),Z.rotationEnabled||(V.rotation=T));return V};a.extentToScale=q;a.getAnchor=v;a.getExtent=F;a.getMatrix=
I;a.getPaddingMapTranslation=K;a.getPaddingScreenTranslation=H;a.getResolution=A;a.getResolutionToScaleFactor=t;a.getTransform=L;a.getTransformNoRotation=R;a.getWorldScreenWidth=function(V,T){return Math.round(C(V)/T)};a.getWorldWidth=C;a.padAndScaleAndRotateBy=N;a.resize=G;a.rotateBy=function(V,T,X){z(V,T);V.rotation+=X;return V};a.rotateTo=function(V,T,X){z(V,T);V.rotation=X;return V};a.scaleAndRotateBy=U;a.scaleTo=function(V,T,X){z(V,T);V.scale=X;return V};a.setExtent=function(V,T,X,Z,Y){M(V,T,
X.center);V.scale=q(X,Z);Y&&Y.constraints&&Y.constraints.constrain(V);return V};a.toMap=S;a.toScreen=Q;a.translateBy=W;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){g=function(p){function h(){return r.apply(this,arguments)}c._inherits(h,p);var r=c._createSuper(h);p=h.prototype;p.initializeProgram=function(q){return new e.Program(q.rctx,h.shader.get().build(this.configuration),d.Default3D)};p.initializePipeline=function(){return u.makePipelineState({blending:u.simpleBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:u.defaultColorWriteParams})};return c._createClass(h)}(g.ShaderTechnique);g.shader=
new l.ReloadableShaderModule(m.RasterColorizer,()=>new Promise((p,h)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],p,h)));x=function(p){function h(){var q=r.apply(this,arguments);q.colorizerType=n.RasterColorizerType.Stretch;q.stretchType=n.RasterColorizerStretchType.Noop;q.applyColormap=!0;q.requireBilinearWithNN=!1;return q}c._inherits(h,p);var r=c._createSuper(h);return c._createClass(h)}(x.TileBlendTechniqueConfiguration);w.__decorate([f.parameter({count:n.RasterColorizerType.COUNT})],
x.prototype,"colorizerType",void 0);w.__decorate([f.parameter({count:n.RasterColorizerStretchType.COUNT})],x.prototype,"stretchType",void 0);w.__decorate([f.parameter()],x.prototype,"applyColormap",void 0);w.__decorate([f.parameter()],x.prototype,"requireBilinearWithNN",void 0);b.RasterColorizerTechnique=g;b.RasterColorizerTechniqueConfiguration=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,b,c,w){let n=function(){function x(l){this._rctx=l;this._fbos=new Map}var m=x.prototype;m.get=function(l){return this._getPool(l)};m.dispose=function(){this._fbos.forEach(l=>l.dispose());this._fbos.clear()};m._getPool=function(l){var g=this._fbos.get(l);if(g)return g;g=new w.FramebufferObject(this._rctx,{colorTarget:c.TargetType.TEXTURE,depthStencilTarget:c.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:l,height:l});this._fbos.set(l,
g);return g};return b._createClass(x)}();a.MultiSizeFramebuffer=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../materials/internal/MaterialUtil".split(" "),function(a,b,c,w,n,x){function m(q,y,B){let D=0,z=Infinity;for(let A=
0;3>A;++A){var v=q[A];if(y[A]<v){if(1E-6>=B[A])return!1;D=Math.max(D,(v-y[A])/B[A])}else-1E-6>=B[A]&&(z=Math.min(z,(v-y[A])/B[A]));if(D>z)return!1;v=q[A+3];if(y[A]>v){if(-1E-6<=B[A])return!1;D=Math.max(D,(v-y[A])/B[A])}else 1E-6<=B[A]&&(z=Math.min(z,(v-y[A])/B[A]));if(D>z)return!1}return!0}function l(q,y,B,D,z,v){let A=D;for(;B<A;){var t=q[B];y[6*t+z+3]<=v?++B:(--A,q[B]=q[A],q[A]=t)}t=B;for(A=D;t<A;)D=q[A-1],y[6*D+z]>=v?--A:(q[A-1]=q[t],q[t]=D,++t);return{next:B,mid:t}}function g(q,y,B,D){if(D<=B)return n.fromValues(NaN,
NaN,NaN,NaN,NaN,NaN);var z=6*q[B];for(var v=0;3>v;++v)h[v]=y[z+0+v],r[v]=y[z+3+v];for(B+=1;B<D;++B)for(z=6*q[B],v=0;3>v;++v)h[v]=Math.min(h[v],y[z+0+v]),r[v]=Math.max(r[v],y[z+3+v]);return n.fromValues(h[0],h[1],h[2],r[0],r[1],r[2])}function f(q){var y=q[3]-q[0];const B=q[4]-q[1],D=q[5]-q[2];y=y>B?y>D?0:B>D?1:2:B>D?1:D>y?2:0;return{axis:y,midValue:(q[y]+q[y+3])/2}}function d(q,y,B,D,z){B-=y;const v=new Float32Array(6*B);for(let t=0;t<B;++t){var A=3*(t+y);const C=q[A]*z,E=q[A+1]*z;A=q[A+2]*z;for(let F=
0;3>F;++F){const H=D[C+F],K=D[E+F],I=D[A+F];v[6*t+F]=Math.min(H,K,I);v[6*t+3+F]=Math.max(H,K,I)}}return v}function e(q,y,B,D){const z=D-B;var v=0;for(var A=B;A<D;++A)for(var t=0;3>t;++t)v=Math.max(y[3*A+t],v);D=65535>=v?new Uint16Array(3*z):new Uint32Array(3*z);for(v=0;v<z;++v)for(A=3*(q[v]+B),t=0;3>t;++t)D[3*v+t]=y[A+t];return D}let k=b._createClass(function(q,y,B,D,z){this.aabb=q;this.axis=y;this.d=B;this.midStartIndex=D;this.rightStartIndex=z}),u=function(){function q(B,D,z,v){this.globalTriangleVertexIndices=
B;this.firstTriangleIndex=D;this.positionAttribute=v;this._rayDirection=w.create();this.bspNodeTree=[];const A=z-D,t=65535>=A?new Uint16Array(A):new Uint32Array(A);this.indices=t;for(let H=0;H<A;++H)t[H]=H;const C=d(B,D,z,v.data,v.stride),E=c.clamp(Math.log2(A/40),2,10),F=(H,K,I)=>{var L=g(t,C,H,K);const R=K-H;if(40>=R)return H=new k(L,void 0,0,H,K),this.bspNodeTree.push(H),H;const {axis:O,midValue:J}=f(L),M=l(t,C,H,K,O,J),G=(P,U)=>{if(!(I>E)){var N=U-P;if(!(40>N||N>=.8*R))return F(P,U,I+1)}};L=new k(L,
O,J,M.next,M.mid);this.bspNodeTree.push(L);L.leftNode=G(H,M.next);L.rightNode=G(M.mid,K);return L};F(0,A,0);this.triangleVertexIndices=e(t,B,D,z)}var y=q.prototype;y.intersectRayTriangleRange=function(B,D){if(!(B>=D)){var z=this.triangleVertexIndices,v=this.positionAttribute.data,A=this.positionAttribute.stride,t=this._rayOrigin,C=t[0],E=t[1];t=t[2];var F=this._rayDirection,H=F[0],K=F[1];F=F[2];for(let W=B,V=3*B;W<D;++W){var I=z[V++]*A,L=v[I++],R=v[I++],O=v[I];I=z[V++]*A;var J=v[I++],M=v[I++],G=v[I];
I=z[V++]*A;var P=v[I++],U=v[I++];J-=L;M-=R;G-=O;P-=L;U-=R;I=v[I]-O;var N=K*I-U*F,S=F*P-I*H;const T=H*U-P*K;var Q=J*N+M*S+G*T;if(!(Math.abs(Q)<=Number.EPSILON)){L=C-L;R=E-R;O=t-O;N=L*N+R*S+O*T;if(0<Q){if(0>N||N>Q)continue}else if(0<N||N<Q)continue;S=R*G-M*O;O=O*J-G*L;R=L*M-J*R;L=H*S+K*O+F*R;if(0<Q){if(0>L||N+L>Q)continue}else if(0<L||N+L<Q)continue;O=(P*S+U*O+I*R)/Q;0<=O&&(Q=this.indices[W]+this.firstTriangleIndex,J=x.computeNormal(J,M,G,P,U,I,p),this._callback(O,J,Q,!1))}}q.numFacesTested+=D-B}};
y.intersectRay=function(B,D){q.numFacesTested=0;var z=w.fromValues(B.r0[0],B.r0[1],B.r0[2]),v=w.fromValues(B.r1[0],B.r1[1],B.r1[2]);B=v[0]-z[0];const A=v[1]-z[1];v=v[2]-z[2];1E-6>B*B+A*A+v*v||(this._rayOrigin=z,z=this._rayDirection,z[0]=B,z[1]=A,z[2]=v,z=this.triangleVertexIndices.length/3,this._callback=D,this.intersectRayBSP(this.bspNodeTree[0],0,z))};y.intersectRayBSP=function(B,D,z){const v=this._rayOrigin,A=this._rayDirection;if(m(B.aabb,v,A)){var t=B.axis,C=B.d;if(v[t]<C||0>A[t]){const E=B.midStartIndex;
if(D<E){const F=B.leftNode;void 0!==F?this.intersectRayBSP(F,D,E):this.intersectRayTriangleRange(D,E)}}this.intersectRayTriangleRange(B.midStartIndex,B.rightStartIndex);if(v[t]>C||0<A[t])D=B.rightStartIndex,D<z&&(B=B.rightNode,void 0!==B?this.intersectRayBSP(B,D,z):this.intersectRayTriangleRange(D,z))}};b._createClass(q,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return q}();u.numFacesTested=0;const p=w.create(),h=[Infinity,
Infinity,Infinity],r=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=u;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){d=function(e){function k(){var p=u.apply(this,arguments);p.output=w.ShaderOutput.Color;p.overlayMode=l.OverlayMode.Disabled;p.tileBlendInput=g.TileBlendInput.LayerOnly;p.spherical=!1;p.doublePrecisionRequiresObfuscation=!1;p.atmosphere=!1;p.receiveShadows=!1;p.hasSlicePlane=!1;p.backfaceCullingEnabled=!1;p.textureFadingEnabled=!1;p.renderOccluded=!1;p.hasScreenSpaceReflections=!1;p.hasCloudsReflections=!1;p.invisible=!1;p.tileBorders=!1;p.visualizeNormals=!1;p.screenSizePerspective=
!1;p.receiveAmbientOcclusion=!1;p.pbrMode=m.PBRMode.Terrain;return p}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(d.DefaultTechniqueConfiguration);c.__decorate([f.parameter({count:w.ShaderOutput.COUNT})],d.prototype,"output",void 0);c.__decorate([f.parameter({count:l.OverlayMode.COUNT})],d.prototype,"overlayMode",void 0);c.__decorate([f.parameter({count:g.TileBlendInput.COUNT})],d.prototype,"tileBlendInput",void 0);c.__decorate([f.parameter()],d.prototype,"spherical",void 0);
c.__decorate([f.parameter()],d.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([f.parameter()],d.prototype,"atmosphere",void 0);c.__decorate([f.parameter()],d.prototype,"receiveShadows",void 0);c.__decorate([f.parameter()],d.prototype,"hasSlicePlane",void 0);c.__decorate([f.parameter()],d.prototype,"backfaceCullingEnabled",void 0);c.__decorate([f.parameter()],d.prototype,"textureFadingEnabled",void 0);c.__decorate([f.parameter()],d.prototype,"renderOccluded",void 0);c.__decorate([f.parameter()],
d.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([f.parameter()],d.prototype,"hasCloudsReflections",void 0);c.__decorate([f.parameter()],d.prototype,"invisible",void 0);c.__decorate([f.parameter()],d.prototype,"tileBorders",void 0);c.__decorate([f.parameter()],d.prototype,"visualizeNormals",void 0);c.__decorate([f.parameter()],d.prototype,"screenSizePerspective",void 0);c.__decorate([f.parameter()],d.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([f.parameter({count:m.PBRMode.COUNT})],
d.prototype,"pbrMode",void 0);c.__decorate([f.parameter({constValue:n.NormalAttributeType.CompressedAttribute})],d.prototype,"normalType",void 0);c.__decorate([f.parameter({constValue:x.TextureCoordinateAttributeType.Compressed})],d.prototype,"textureCoordinateType",void 0);c.__decorate([f.parameter({constValue:!1})],d.prototype,"highStepCount",void 0);c.__decorate([f.parameter({constValue:!1})],d.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([f.parameter({constValue:!1})],d.prototype,
"useFillLights",void 0);a.TerrainTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return a._createClass(function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]})})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){a.TilingSchemeLogic=function(B){function D(v){v=z.call(this,v);v._handles=new n;return v}b._inherits(D,B);var z=b._createSuper(D);B=D.prototype;B.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(m.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};B.destroy=function(){this._handles=x.destroyMaybe(this._handles);
this._waitTask=null;this.layers.destroy()};B._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var v;this.layers.some(t=>!h.isTiledLayer(t)||t.isRejected()?!1:!t.isFulfilled()||x.isSome(q.getTiledLayerInfo(t,this.viewSpatialReference,this.viewingMode))?(v=t,"vector-tile"!==t?.type&&!q.isProjectableRasterLayer(t)):!1);if(v)if(v.isResolved()){var A=q.getTiledLayerInfo(v,this.viewSpatialReference,this.viewingMode);x.isSome(A)&&(A=new y.TilingScheme(A.tileInfo),this._lockTilingScheme(A))}else this._updateWhen(v)}};
B._updateWhen=function(v){const A=v.when().catch(()=>{}).then(()=>{A!==this._waitTask||this.destroyed||this._update()});this._waitTask=A};B._lockTilingScheme=function(v){if(this.viewingMode===r.ViewingMode.Global){const A=v.levels.length-1;v.spatialReference.isWebMercator?v=y.TilingScheme.makeWebMercatorAuxiliarySphere(A):k.canProjectToWGS84ComparableLonLat(v.spatialReference)&&(v=y.TilingScheme.makeGCSWithTileSize(v.spatialReference,v.pixelSize,A))}this.tilingSchemeLocked=!0;this.tilingScheme=v;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(m.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))};B._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};B._setAdHocTilingScheme=function(){if(this.viewingMode===r.ViewingMode.Global){var v=this.extentHelper.viewSpatialReference;const A=k.canProjectToWGS84ComparableLonLat(v)||p.isMars(v)||p.isMoon(v);
v.isWebMercator?this.tilingScheme=y.TilingScheme.WebMercatorAuxiliarySphere:A&&(this.tilingScheme=y.TilingScheme.makeGCSWithTileSize(v,256));this._set("extent",this.extentHelper.layerViewsExtent)}else v=this.extentHelper.layerViewsExtent,x.isSome(v)&&!u.equals(v,this.extent)&&(this.tilingScheme=y.TilingScheme.fromExtent(v,this.extentHelper.viewSpatialReference),this._set("extent",v))};b._createClass(D,[{key:"test",get:function(){return{lockTilingScheme:v=>this._lockTilingScheme(v),done:!this._waitTask}}}]);
return D}(w);c.__decorate([l.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);c.__decorate([l.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([l.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([l.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([l.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([l.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([l.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([e.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec2f64"],function(a,b,c){let w=function(){function n(){this.offset=
c.create();this.scale=0;this.tile=null}var x=n.prototype;x.init=function(m,l,g,f){this.tile=m;this.offset[0]=l;this.offset[1]=g;this.scale=f};x.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return b._createClass(n)}();a.UpsampleInfo=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){a.Stage=function(D){function z(A){A=v.call(this,A);A._handles=new n;A._model=new q.Model;A._layers=new m;A._asyncChangeSet=new p.ChangeSet;A._syncChangeSet=new p.ChangeSet;A._layerSyncSet=new Set;return A}b._inherits(z,D);var v=b._createSuper(z);D=z.prototype;D.initialize=function(){this._set("renderView",new y.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(B.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};
D.destroy=function(){this._handles.destroy()};D.add=function(A){this._model.add(A);r.isWebGLLayer(A)&&(A.attachStage(this),this._addLayer(A));this.renderView.requestRender()};D.remove=function(A){x.isNone(A)||(this.renderView.requestRender(),this._model.remove(A),r.isWebGLLayer(A)&&(this._removeLayer(A),A.detachStage()))};D.addMany=function(A){x.isSome(A)&&(this._model.addMany(A),this.renderView.requestRender())};D.removeMany=function(A){x.isSome(A)&&(this._model.removeMany(A),this.renderView.requestRender())};
D.load=async function(A,t){x.isNone(A)||(Array.isArray(A)||(A=[A]),await Promise.all(A.filter(C=>x.isNone(C.glTexture)).map(C=>this.schedule(()=>this._model.has(C)?C.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),t)))};D.loadImmediate=function(A){return A.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};D.forEachOfType=function(A,t){this._model.forEachOfType(A,t)};D.handleEvent=function(A,t){this.destroyed||
(this._model.dirtySet[A](t),this.renderView.requestRender())};D.runTask=function(A){this._frameTask.processQueue(A);this._commit(A)};D._commit=function(A){const t=this._model.dirtySet;this._asyncChangeSet.empty||A.done||(this.renderer.modify(this._asyncChangeSet,A),this.renderView.requestRender(),A.madeProgress());this._layers.forAll(C=>{if(!A.done){var E=this._layerSyncSet.has(C.id)||C.updatePolicy===h.UpdatePolicy.SYNC,F=E?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(C.id,F);this._layerSyncSet.delete(C.id);
F.empty||(this.renderer.modify(F,E?B.noBudget:A),this.renderView.requestRender(),A.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,B.noBudget),this.renderView.requestRender(),A.madeProgress());this._layers.forAll(C=>{A.done||this._layerSyncSet.has(C.id)||C.updatePolicy!==h.UpdatePolicy.ASYNC||(t.commitLayer(C.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,A),this.renderView.requestRender(),A.madeProgress()))});
this._layerSyncSet.clear();this.notifyChange("running")};D.commitSyncLayers=function(){const A=this._model.dirtySet;this._layers.forAll(t=>{if(this._layerSyncSet.has(t.id)||t.updatePolicy===h.UpdatePolicy.SYNC)A.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id)});for(const t of this._layerSyncSet)A.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,B.noBudget),this.renderView.requestRender())};D._commitLayer=
function(A){this._model.dirtySet.commitLayer(A.id,this._syncChangeSet);this._layerSyncSet.delete(A.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,B.noBudget),this.renderView.requestRender())};D.schedule=function(A,t){return this._frameTask.schedule(A,t)};D.reschedule=function(A,t){return this._frameTask.reschedule(A,t)};D.syncLayer=function(A){this._layerSyncSet.add(A);this.renderView.requestRender()};D.getObject=function(A){return this._model.getObject(A)};D._addLayer=function(A){this._layers.includes(A)||
this._layers.push(A)};D._removeLayer=function(A){this._commitLayer(A);null!=this._layers.removeUnordered(A)&&(this._model.dirtySet.getResidentRenderGeometries(A.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,B.noBudget))};D.addRenderPlugin=function(A,t,C){A=this.renderer.renderPlugins.add(A,t,C);C=()=>{u.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};if(l.isPromiseLike(A))return A.then(C);C()};D.removeRenderPlugin=function(A){u.isIntersectionHandler(A)&&
this.view.sceneIntersectionHelper.removeIntersectionHandler(A);this.renderer.renderPlugins.remove(A)};b._createClass(z,[{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"updating",get:function(){return this.running||this.renderView.updating||this._frameTask.updating}},{key:"renderer",get:function(){return this.renderView?.renderer}},{key:"running",get:function(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}},{key:"layers",get:function(){return this._layers}},
{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const A=this;return{getCount(t){return A._model.test.content.filter(C=>C.type===t).length},model:A._model}}}]);return z}(w);a.Stage.DebugSettings={endFrameContentValidation:!1};c.__decorate([g.property({constructOnly:!0})],a.Stage.prototype,"view",void 0);c.__decorate([g.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([g.property({readOnly:!0})],
a.Stage.prototype,"viewingMode",null);c.__decorate([g.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([g.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);c.__decorate([g.property({readOnly:!0})],a.Stage.prototype,"updating",null);c.__decorate([g.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([g.property({autoDestroy:!0})],a.Stage.prototype,"renderView",void 0);c.__decorate([g.property({readOnly:!0})],a.Stage.prototype,
"renderer",null);c.__decorate([g.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=c.__decorate([k.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){a.Model=function(r){function q(){var B=y.apply(this,arguments);B.dirtySet=new k({model:b._assertThisInitialized(B)});B._content=new Map;B._originFactory=new e.GridLocalOriginFactory(null);return B}b._inherits(q,r);var y=b._createSuper(q);r=q.prototype;r.getObject=function(B){return this._content.get(B)};r.add=function(B){const D=B.id;p.assert(!this._content.has(D),"Model/Stage already contains object to be added");this._content.set(D,B);h.isWebGLLayer(B)&&
this.dirtySet.layerAdded(B)};r.remove=function(B){p.assert(this._content.has(B.id),"Model/Stage doesn't contain object to be removed");this._content.delete(B.id);B.unload();h.isWebGLLayer(B)&&this.dirtySet.layerRemoved(B)};r.addMany=function(B){for(const D of B)n.isSome(D)&&(p.assert(!this._content.has(D.id),"Model/Stage already contains object to be added"),this._content.set(D.id,D))};r.removeMany=function(B){for(const D of B)p.assert(this._content.has(D.id),"Model/Stage doesn't contain object to be removed"),
this._content.delete(D.id),D.unload()};r.has=function(B){return this._content.has(B.id)};r.forEachOfType=function(B,D){this._content.forEach(z=>{z.type===B&&D(z)})};r.getRenderGeometry=function(B,D){const {shaderTransformer:z,localOrigin:v}=D,A=new u.RenderGeometry(D,{shaderTransformer:z,castShadow:B.castShadow});A.updateTransformation(t=>B.getCombinedStaticTransformation(D,t));A.localOrigin=n.isSome(v)?v:this._originFactory.getOrigin(A.boundingSphere);return A};r.updateRenderGeometryTransformation=
function(B,D,z){if(n.isNone(B))return!1;z.updateTransformation(A=>B.getCombinedStaticTransformation(D,A));const v=this._originFactory.getOrigin(z.boundingSphere);return z.localOrigin!==v};r.getStats=function(){const B={},D=Array.from(this._content.values());for(let z=0;z<d.ContentObjectType.COUNT;++z)B[z]=D.filter(v=>v.type===z).length;return{contentTypes:B,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(q,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return q}(w);c.__decorate([x.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([f.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){let u=a._createClass(function(p,h,r){this.operation=p;this.geometry=h;this.states=r});c=function(p){function h(q){q=r.call(this,q);q._residentGeomRecords=new Map;q._dirtyGeomRecords=new Map;q.dirty=!1;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.commitLayer=function(q,y){const B=this._dirtyGeomRecords.get(q);B&&(B.forEach((D,z)=>{const v=this._ensureGeomRecord(q,z);D.forEach(({geometry:A,operation:t,states:C},E)=>{let F=!1;if(t===e.DirtyOperation.UPDATE){const H=
v.get(E);if(H){if(C&e.DirtyState.TRANSFORMATION){const K=this.model.getObject(z);this.model.updateRenderGeometryTransformation(K,A,H)&&(F=!0)}F||y.updates.push({renderGeometry:H,updateType:C})}else k.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(t===e.DirtyOperation.REMOVE||F)(C=v.get(E))?(y.removes.push(C),v.delete(E)):t===e.DirtyOperation.REMOVE&&k.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(t===e.DirtyOperation.ADD||F)t=this.model.getObject(z),
n.isSome(t)&&(A=this.model.getRenderGeometry(t,A),y.adds.push(A),v.set(E,A))});0===v.size&&this._residentGeomRecords.get(q).delete(z)}),0===this._residentGeomRecords.get(q).size&&this._residentGeomRecords.delete(q),this._dirtyGeomRecords.delete(q),this.dirty=this._hasDirtyGeometryRecords)};p.getResidentRenderGeometries=function(q,y){(q=this._residentGeomRecords.get(q))&&q.forEach(B=>B.forEach(D=>y.push(D)))};p._objectStateChanged=function(q,y){for(const B of y.geometries)this._updateOrCreateDirtyRecord(y,
B,null,e.DirtyOperation.UPDATE,q)};p.visibilityChanged=function(q){this._objectStateChanged(e.DirtyState.VISIBILITY,q)};p.highlightChanged=function(q){this._objectStateChanged(e.DirtyState.HIGHLIGHT,q)};p.occlusionChanged=function(q){this._objectStateChanged(e.DirtyState.OCCLUDEE,q)};p.objectGeometryUpdated=function(q){this._updateOrCreateDirtyRecord(q.object,q.geometry,null,e.DirtyOperation.UPDATE,e.DirtyState.GEOMETRY)};p.layerAdded=function(q){q.objects.forAll(y=>this._layerObjectAdded(q,y))};
p.layerRemoved=function(q){q.objects.forAll(y=>this._layerObjectRemoved(q,y))};p.layerObjectAdded=function(q){this._layerObjectAdded(q.layer,q.object)};p._layerObjectAdded=function(q,y){q=q.id;for(const B of y.geometries)this._objectGeometryAdded(y,B,q)};p.layerObjectRemoved=function(q){this._layerObjectRemoved(q.layer,q.object)};p.layerObjectsAdded=function(q){for(const y of q.objects)this._layerObjectAdded(q.layer,y)};p.layerObjectsRemoved=function(q){for(const y of q.objects)this._layerObjectRemoved(q.layer,
y)};p._layerObjectRemoved=function(q,y){q=q.id;for(const B of y.geometries)this._objectGeometryRemoved(y,B,q)};p.shaderTransformationChanged=function(q){(q=this._residentGeomRecords.get(q.id))&&q.forEach((y,B)=>{(B=this.model.getObject(B))&&B.hasVolativeTransformation()&&y.forEach(D=>D.shaderTransformationChanged())})};p.objectTransformation=function(q){const y=this._getParentLayerId(q);this._ensureGeomRecord(y,q.id).forEach(B=>{this._updateOrCreateDirtyRecord(q,B.geometry,y,e.DirtyOperation.UPDATE,
e.DirtyState.TRANSFORMATION)})};p.objectGeometryAdded=function(q){this._objectGeometryAdded(q.object,q.geometry)};p._objectGeometryAdded=function(q,y,B=null){this._updateOrCreateDirtyRecord(q,y,B,e.DirtyOperation.ADD)};p.objectGeometryRemoved=function(q){this._objectGeometryRemoved(q.object,q.geometry)};p._objectGeometryRemoved=function(q,y,B=null){this._updateOrCreateDirtyRecord(q,y,B,e.DirtyOperation.REMOVE)};p._updateOrCreateDirtyRecord=function(q,y,B,D,z=e.DirtyState.NONE){B=n.unwrapOr(B,this._getParentLayerId(q));
const v=y.id;q=this._ensureDirtyRecord(B,q.id);(B=q.get(v))?(y=B.operation,y===e.DirtyOperation.REMOVE&&D===e.DirtyOperation.ADD&&B.states!==e.DirtyState.NONE?B.operation=e.DirtyOperation.UPDATE:y===e.DirtyOperation.REMOVE&&D===e.DirtyOperation.ADD||y===e.DirtyOperation.ADD&&D===e.DirtyOperation.REMOVE?q.delete(v):(y!==e.DirtyOperation.UPDATE||D!==e.DirtyOperation.REMOVE&&D!==e.DirtyOperation.UPDATE?k.assert((y===e.DirtyOperation.REMOVE||y===e.DirtyOperation.ADD)&&D===e.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):
B.operation=D,B.states|=z)):q.set(v,new u(D,y,z));this.dirty=this._hasDirtyGeometryRecords};p._ensureGeomRecord=function(q,y){let B=this._residentGeomRecords.get(q);B||(B=new Map,this._residentGeomRecords.set(q,B));q=B.get(y);q||(q=new Map,B.set(y,q));return q};p._ensureDirtyRecord=function(q,y){let B=this._dirtyGeomRecords.get(q);B||(B=new Map,this._dirtyGeomRecords.set(q,B));q=B.get(y);q||(q=new Map,B.set(y,q));return q};p._getParentLayerId=function(q){return n.isSome(q.parentLayer)?q.parentLayer.id:
x.NullUID};p.formatDebugInfo=function(){const q=["ADD","UPD",void 0,"REM"];let y="";this._dirtyGeomRecords.forEach((B,D)=>{B.forEach((z,v)=>{0<y.length&&(y+="\n");y+=D+"."+v;const A=[];z.forEach(t=>{const C=t.operation;A[C]||(A[C]=[]);A[C].push(t.geometry.id)});for(z=0;z<A.length;z++)if(A[z])for(y+=" "+q[z-1]+": ",v=0;v<A[z].length;v++)y+=A[z][v]+", "})});return y};a._createClass(h,[{key:"_hasDirtyGeometryRecords",get:function(){return w.someMap(this._dirtyGeomRecords,q=>w.someMap(q,y=>y&&0<y.size))}},
{key:"test",get:function(){const q=this;return{get residentLayerCount(){return q._residentGeomRecords.size},get residentObjectCount(){return Array.from(q._residentGeomRecords.values()).reduce((y,B)=>y+B.size,0)},commit:y=>q._dirtyGeomRecords.forEach((B,D)=>q.commitLayer(D,y))}}}]);return h}(c);b.__decorate([m.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([m.property()],c.prototype,"dirty",void 0);return c=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],
c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/context-util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J){a.RenderView=function(G){function P(N){var S=U.call(this,{});S.events=new n;S.waterTextureRepository=new H.WaterTextureRepository;S._magnifierHelper=new z.MagnifierHelper;S.objectAndLayerIdRenderHelper=x("enable-feature:objectAndLayerId-rendering")?new A.ObjectAndLayerIdRenderHelper:null;S._needsUpdate=!0;S._needsRender=!0;S._idleSuspend=!0;S._needsWaterReflectionUpdate=!1;S._lastAnimationUpdate=0;S._container=N.container;
S._viewingMode=N.viewingMode;S._initializeContext(N);S.addHandles([g.watch(()=>S.waterTextureRepository?.updating,()=>S.requestRender(),g.initial),S._magnifierHelper.events.on("request-render",()=>S.requestRender())]);S._stippleTextureRepository=new F.StippleTextureRepository(S._rctx);S._shaderTechniqueRepository=new r.ShaderTechniqueRepository({rctx:S._rctx,viewingMode:N.viewingMode,stippleTextureRepository:S._stippleTextureRepository,waterTextureRepository:S.waterTextureRepository});S._textureRepository=
new E.TextureRepository(N,S._shaderTechniqueRepository,S._rctx);S.addHandles(S._textureRepository.events.on("changed",Q=>S.requestRender(Q)));S._materialRepository=new D.GLMaterialRepository(S._textureRepository,S._shaderTechniqueRepository,()=>S.requestRender(),()=>S.requestRender());S._compositingHelper=new y(S._rctx,S._shaderTechniqueRepository);S.renderer=new t.Renderer(N,S._materialRepository,S._textureRepository,S._shaderTechniqueRepository,S._rctx,S._compositingHelper,S._magnifierHelper,Q=>
S.requestRender(Q));S._screenshotManager=new L.ScreenshotManager(S._rctx,{renderScene:(Q,W,V,T,X)=>S.renderer.render(Q,W,{camera:V,contentCamera:V,mode:O.RenderState.IDLE},T,X),requestRenderScene:Q=>S.requestRender(Q),prepareOverlay:()=>N.options.screenshot.prepareOverlay(),renderOverlay:(Q,W)=>N.options.screenshot.renderOverlay(Q,W)},Q=>S.events.emit("force-camera-for-screenshot",Q),()=>S.renderer.disposeOffscreenBuffers());S._registerFrameTask(N);return S}b._inherits(P,G);var U=b._createSuper(P);
G=P.prototype;G.normalizeCtorArgs=function(){return{}};G.destroy=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=l.removeMaybe(this._frameTask);this._shaderTechniqueRepository=l.destroyMaybe(this._shaderTechniqueRepository)};G.requestRender=function(N=q.RenderRequestType.UPDATE){this._needsRender=!0;N===q.RenderRequestType.UPDATE&&(this._needsUpdate=!0)};G.setIdleSuspend=function(N){this._idleSuspend!==N&&(this._idleSuspend=N,this.requestRender())};
G.takeScreenshot=function(N){return this._screenshotManager.takeScreenshot(N).then(S=>S[0])};G.takeScreenshotWithOID=function(N){N.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(N)};G.getAlpha=function(){return!!this._rctx.contextAttributes.alpha};G.getMinimalDepthForArea=function(N,S,Q,W,V,T=V){T=W.constrainWindowSize(S,Q,V*W.pixelRatio,T*W.pixelRatio);const X=this._ensureDepthBuffer(T);this.renderer.readDepthPixels(W,T,X);V=Number.MAX_VALUE;for(let Z=0;Z<T[2]*T[3];Z++){const Y=
B.textureToDepth(4*Z,X,W.nearFar);V>Y&&Y!==W.nearFar[0]&&Y!==W.nearFar[1]&&(V=Y)}l.isSome(N)&&(N=N.pickDepth(S*W.pixelRatio,Q*W.pixelRatio,W),l.isSome(N)&&V>N&&N!==W.nearFar[0]&&N!==W.nearFar[1]&&(V=N));return V===Number.MAX_VALUE?void 0:V};G._ensureDepthBuffer=function(N){N=4*N[2]*N[3];if(l.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<N)this._tmpDepthBuffer=new Uint8Array(N);return this._tmpDepthBuffer};G.reloadShaders=async function(){I.removeLoadedShaderModules();await this._shaderTechniqueRepository.reloadAll();
this.requestRender()};G._registerFrameTask=function(N){const S=N.view.state;let Q=!1,W=q.RenderRequestType.BACKGROUND,V=!1;this._frameTask=f.addFrameTask({preRender:({time:T})=>{Q=this.updating;W=this._needsUpdate?q.RenderRequestType.UPDATE:q.RenderRequestType.BACKGROUND;N.commitSyncLayers();var X=d.Milliseconds(T-this._lastAnimationUpdate);if(X>this.renderer.animationTimestep||l.isSome(S.forcedAnimationTime)||Q||this._needsRender)X=d.Milliseconds(X/this.renderer.animationTimeDilation),X=new v.UpdateParameters(S.camera,
X,S.forcedAnimationTime),this.renderer.updateAnimation(X)&&this.requestRender(q.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=T},render:({time:T})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<S.camera.fullWidth&&0<S.camera.fullHeight){const X=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(null,null,S,q.Decorations.ON,
T);V=!0;X&&this.renderer.hasWaterReflection&&(this.requestRender(q.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:T})=>{const X=new L.ScreenshotContext(S.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update();this._screenshotManager.update(X,T)},finish:()=>{V&&(this.renderer.finish(S.mode===O.RenderState.IDLE?W:q.RenderRequestType.UPDATE),V=!1)}})};G._initializeContext=function(N){const S=N.options;this._canvas=S.canvas;
this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const Q=J.createContextOrErrorHTML("3d",this._canvas,{alpha:S.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:S.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:S.preserveDrawingBuffer??!1});l.isNone(Q)?(N=x("esri-force-webgl"),m.getLogger(this.declaredClass).error("A WebGL context with the requested version ("+N?N:"automatic) could not be created.")):
(this._rctx=this._newRenderingContext(Q,N),this._loadShaderOnlyExtensions(),!S.alpha&&this._rctx.contextAttributes.alpha&&m.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=x("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};G._newRenderingContext=function(N,S){const Q={disabledExtensions:S.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:S.options.debugWebGLExtensions||
{},maxAnisotropy:8},W=(V,T)=>S.view.resourceController.memoryController.newCache(V,T);if(R.contextCache.enabled){let V=M.get(N);if(V)return V.configure(Q),V.newCache=W,V.ref(),V;V=new C.RenderingContext(N,Q,W);M.set(N,V);V.ref();return V}return new C.RenderingContext(N,Q,W)};G._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("textureFloat")};G.getObjectAndLayerIdColor=function(N){return l.isSome(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(N):
null};b._createClass(P,[{key:"performanceInfo",get:function(){const N=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:void 0!==N.getUsedTextureMemory?N.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==N.getUsedRenderbufferMemory?N.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==N.getUsedVBOMemory?N.getUsedVBOMemory():void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||
this.waterTextureRepository.updating||this._magnifierHelper.updating}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(N){this._magnifierHelper.magnifier=N}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"componentObjectCollection",get:function(){l.isNone(this._componentObjectCollection)&&
(this._componentObjectCollection=new h.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection},set:function(N){this._componentObjectCollection=N}}]);return P}(w);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_rctx",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_container",void 0);c.__decorate([e.property({autoDestroy:!0})],
a.RenderView.prototype,"_canvas",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_stippleTextureRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"waterTextureRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_magnifierHelper",void 0);c.__decorate([e.property({readOnly:!0})],a.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,
"_textureRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([e.property({autoDestroy:!0,readOnly:!0})],a.RenderView.prototype,"renderer",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_screenshotManager",void 0);c.__decorate([e.property()],a.RenderView.prototype,"componentObjectCollection",null);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_componentObjectCollection",void 0);
c.__decorate([e.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([e.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=c.__decorate([p.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const M=K.getContextCache();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U){function N(X,Z){return X===Z?E.ComponentParameterSummary.All:0===X?E.ComponentParameterSummary.None:E.ComponentParameterSummary.Some}const S=w.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");w=function(){function X(Y,aa){this._renderManager=Y;this._viewingMode=aa;this._objects=[new x,new x];this._renderSubmit=new A.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._hasObjectAndLayerId=c("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new M.BufferManager(Y.rctx,2+(this._hasObjectAndLayerId?1:0))}var Z=X.prototype;Z.destroy=function(){I.assert(0===this._objects[B.State.Hidden].length&&0===this._objects[B.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};Z.createObject=function(Y){const aa=new B.ComponentObject;aa.toMapSpace=Y.toMapSpace;aa.transform=Y.transform;aa.obb=
h.clone(Y.obb);aa.components=new y(this._componentBufferManager,Y.geometry.componentOffsets);aa.renderable=this._createRenderable(Y,aa.components);aa.intersectionGeometry=new D(Y.geometry.positionData,aa.components);this._objects[aa.visible].push(aa);return aa};Z.destroyObject=function(Y){this._objects[Y.visible].removeUnordered(Y);Y.destroy();this._notifyDirty()};Z.setObjectVisibility=function(Y,aa){aa!==Y.visible&&(this._objects[Y.visible].removeUnordered(Y),this._objects[aa].push(Y),Y.visible=
aa,this._notifyDirty())};Z.preSubmit=function(Y){const aa=Y.camera.eye;this.visibleObjects.forAll(ia=>ia.renderable.meta.cameraDepthSquared=f.squaredDistance(aa,ia.obb.center))};Z.getMaterial=function(Y){return Y.renderable.material};Z.updateMaterial=function(Y,aa){Y=Y.renderable.material;aa(Y);Y.dirty&&this._notifyDirty()};Z.setAllComponentVisibilities=function(Y,aa){Y.components.visibility.reset(aa);Y.components.visibilityDirty();this._notifyDirty()};Z.forEachVisibleComponent=function(Y,aa){return Y.components.visibility.forEachComponent(aa)};
Z.getComponentCount=function(Y){const aa=Y.components.visibility.componentCount();return{visible:aa,invisible:Y.components.count-aa}};Z.setComponentData=function(Y,aa){const ia=Y.renderable.material,na=Y.components;var ba=na.materialDataBuffer;const ea=na.materialDataIndices,ja=new C.UniformComponentParameters;ba=ba.textureBuffer;const ka=new Uint8Array(4),da=new Uint32Array(ka.buffer);let ha=0,ca=0,fa=0,ma=na.verticalOffsets,qa=Infinity,wa=-Infinity,xa=!1,pa=!1,ra=0;for(let va=0;va<na.count;va++){aa(va,
ja);ha+=+(1>ja.externalColor[3]);ca+=+(ja.externalColorMixMode===p.ColorMixModeEnum.Replace&&1===ja.externalColor[3]);fa+=+ja.castShadows;p.encodeSymbolColor(ja.externalColor,ja.externalColorMixMode,ka);ka[2]=ka[2]&254|+ja.castShadows;ba.setData(ea[va],0,ka[0],ka[1],ka[2],ka[3]);xa||(xa=0<va&&ra!==da[0]);ra=da[0];pa||(pa=0!==ja.elevationOffset);pa&&n.isNone(ma)&&(ma=Array(va).fill(0));n.isSome(ma)&&(ma[va]=ja.elevationOffset);qa=Math.min(qa,ja.elevationOffset);wa=Math.max(wa,ja.elevationOffset);H.encodeElevationOffset(ja.elevationOffset,
ka);ba.setData(ea[va],1,ka[0],ka[1],ka[2],ka[3]);const Ba=ja.objectAndLayerIdColor;n.isSome(Ba)&&ba.setData(ea[va],2,Ba[0],Ba[1],Ba[2],Ba[3]);ja.pickable!==K.getVisibility(na.pickability,va)&&(na.pickability=K.updateVisibilityWithCount(na.pickability,na.count,va,ja.pickable))}na.verticalOffsets=pa?ma:null;Y.offsetObb=pa?h.computeOffsetObb(Y.obb,qa,wa,this._viewingMode,n.isSome(Y.offsetObb)?Y.offsetObb:h.clone(Y.obb)):null;xa||pa||this._hasObjectAndLayerId?(ia.componentParameters=new E.ComponentParametersVarying,
ia.componentParameters.castShadows=N(fa,na.count),ia.componentParameters.transparent=N(ha,na.count),ia.componentParameters.opaqueOverride=N(ca,na.count),ia.componentParameters.texture=ba,ba.updateTexture()):(ia.componentParameters=new E.ComponentParametersUniform,ia.componentParameters.castShadows=ja.castShadows?E.ComponentParameterSummary.All:E.ComponentParameterSummary.None,ia.componentParameters.externalColor=ja.externalColor,ia.componentParameters.externalColorMixMode=ja.externalColorMixMode);
this._notifyDirty()};Z.getComponentAabb=function(Y,aa,ia,na=!1){Y.intersectionGeometry.getComponentAabb(aa,ia);const ba=Y.components.verticalOffsets;if(na||n.isNone(ba))return ia;aa=ba[aa];if(this._viewingMode===u.ViewingMode.Local||0===aa)return ia[2]+=aa,ia[5]+=aa,ia;aa=n.unwrap(R.getVerticalOffsetI3S(aa));aa.localOrigin=Y.transform.position;return aa.applyToAabb(ia)};Z.getComponentObb=function(Y){return Y.obb};Z.getObjectTransform=function(Y){return Y.transform};Z.getComponentPositions=function(Y,
aa,ia){return Y.intersectionGeometry.getComponentPositions(aa,ia)};Z.intersect=function(Y,aa,ia,na,ba,ea){n.isSome(ba)&&(ba.localOrigin=Y.transform.position);const ja=l.invert(W,Y.transform.rotationScale);f.sub(V,aa,Y.transform.position);f.sub(T,ia,Y.transform.position);f.transformMat3(V,V,ja);f.transformMat3(T,T,ja);aa=l.transpose(W,ja);return Y.intersectionGeometry.intersect(V,T,na,aa,ba,Y.components.verticalOffsets,ea)};Z.addEdges=function(Y,aa,ia,na){const {indices:ba,positions:ea}=Y.intersectionGeometry,
ja=Y.components.offsets;return aa.addComponentObject(Y,Y.transform,{center:Y.obb.center,radius:h.radius(Y.obb)},ea,ba,ja,ia,na)};Z.extractEdgeInformation=async function(Y,aa,ia){var na=Y.components.visibility;if(na.allInvisible())return{buffer:J.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:ba,positions:ea}=Y.intersectionGeometry,ja=Y.components.offsets,ka=O.EdgeInputBufferLayout.createBuffer(ea.length/3);k.copy(ka.position.typedBuffer,ea,ka.position.typedBufferStride,
3);e.transformMat3View(ka.position,ka.position,Y.transform.rotationScale);this._setComponentIndices(ka.componentIndex,ba,ja);na=this._computeVisibilityIndices(ba,na,ja,ka.count);Y=d.clone(Y.transform.position);aa=await aa.extractComponentsEdgeLocations({indices:na,indicesLength:na.length,skipDeduplicate:!0,data:ka,writerSettings:{reducedPrecision:!1,variants:0}},ia);return{origin:Y,buffer:aa}};Z._setComponentIndices=function(Y,aa,ia){let na=0;for(let ea=0;ea<ia.length-1;ea++){var ba=ia[ea];const ja=
ia[ea+1];for(;ba<ja;ba++)Y.set(aa?aa[ba]:ba,na);na++}};Z._computeVisibilityIndices=function(Y,aa,ia,na){if(Y&&aa.allVisible())return Y;let ba=0;aa.forEachComponentRange((ka,da)=>{ba+=ia[da]-ia[ka];return!0});const ea=m.isArray(Y)?Array(ba):2===Y?.BYTES_PER_ELEMENT||65536>=na?new Uint16Array(ba):new Uint32Array(ba);let ja=0;aa.forEachComponentRange((ka,da)=>{ka=ia[ka];for(da=ia[da];ka<da;ka++)ea[ja++]=Y?Y[ka]:ka;return!0});return ea};Z.addComponentHighlight=function(Y,aa){Y=Y.components;n.isNone(Y.highlightCounts)&&
(Y.highlightCounts=new Uint32Array(Y.count+1));0===Y.highlightCounts[aa]++&&(Y.highlightsDirty(),this._notifyDirty());Y.highlightCounts[Y.count]++};Z.removeComponentHighlight=function(Y,aa){Y=Y.components;if(n.isNone(Y.highlightCounts))S.warn("Removing non-existing highlight.");else{var ia=Y.highlightCounts[aa],na=Y.highlightCounts[Y.count];0===ia?S.warn("Removing non-existing highlight."):1<ia?(Y.highlightCounts[aa]=ia-1,Y.highlightCounts[Y.count]=na-1):(Y.highlightCounts[aa]=0,Y.highlightsDirty(),
this._notifyDirty(),1===na?Y.highlightCounts=null:Y.highlightCounts[Y.count]=na-1)}};Z.clearHighlights=function(Y){Y=Y.components;n.isSome(Y.highlightCounts)&&(Y.highlightCounts=null,Y.highlightsDirty(),this._notifyDirty())};Z.getObjectGPUMemoryUsage=function(Y){return Y.renderable.meta.gpuMemoryEstimate};Z._createRenderable=function(Y,aa){const ia=this._renderManager.rctx,na=Y.geometry;var ba=na.vertices.layoutParameters,ea=G.BufferObject.createVertex(ia,P.Usage.STATIC_DRAW,na.vertices.data);const ja=
n.applySome(na.indices,ca=>G.BufferObject.createIndex(ia,P.Usage.STATIC_DRAW,ca));var ka=r.glLayout(t.createVertexBufferLayout(ba));const da=new Uint16Array(na.vertices.count);for(let ca=0;ca<aa.count;ca++){var ha=aa.offsets[ca];const fa=aa.offsets[ca+1],ma=aa.materialDataIndices[ca];if(n.isSome(na.indices))for(;ha<fa;ha++)da[na.indices[ha]]=ma;else for(;ha<fa;ha++)da[ha]=ma}aa=G.BufferObject.createVertex(ia,P.Usage.STATIC_DRAW,da.buffer);Y=new E.ComponentMaterial(Y.transform,Y.toMapSpace);ka=new U.VertexArrayObject(ia,
F.attributeLocations,{data:ka,componentIndices:Q},{data:ea,componentIndices:aa},n.unwrap(ja));ba=new v.RenderGeometry(ka,P.PrimitiveType.TRIANGLES,ba,n.isSome(ja));ea={cameraDepthSquared:.5,gpuMemoryEstimate:ea.byteSize+aa.byteSize+(n.isSome(ja)?ja.byteSize:0)};return new z.Renderable(Y,ba,ea)};Z._notifyDirty=function(){this._renderManager.notifyDirty()};b._createClass(X,[{key:"visibleObjects",get:function(){return this._objects[B.State.Visible]}}]);return X}();const Q=r.glLayout(q.newLayout().u16(L.VertexAttribute.COMPONENTINDEX)),
W=g.create(),V=d.create(),T=d.create();a.ComponentObjectCollection=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ../../ViewingMode ./dito".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(I=[0,0,0],L=[-1,-1,-1],R=m.create()){return{center:f.clone(I),halfSize:g.clone(L),quaternion:x.clone(R)}}function q(I,L){const R=u.signedDistance(L,I.center);I=y(I,u.normal(L));return R>I?1:R<-I?-1:0}function y(I,L){n.conjugate(B,I.quaternion);l.transformQuat(D,L,B);I=I.halfSize;return Math.abs(D[0]*I[0])+Math.abs(D[1]*I[1])+Math.abs(D[2]*I[2])}const B=m.create(),D=f.create(),z=f.create(),v=e.create(),A=w.create();b=b._createClass(function(I){this.buffer=
new ArrayBuffer(56*I);this.obbs=Array(I);for(let L=0;L<I;L++)this.obbs[L]={center:f.createView(this.buffer,56*L),halfSize:g.createView(this.buffer,56*L+24),quaternion:x.createView(this.buffer,56*L+36)}});const t=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],C=(()=>{const I=new Int8Array(162);let L=0;const R=O=>{for(let J=0;J<O.length;J++)I[L+J]=O[J];L+=6};R([6,2,3,1,5,4]);R([0,2,3,1,5,4]);R([0,2,3,7,5,4]);R([0,1,3,2,6,4]);R([0,1,3,2,0,0]);R([0,1,5,7,3,2]);R([0,1,3,7,6,4]);R([0,1,3,7,6,2]);R([0,1,5,7,6,2]);
R([0,1,5,4,6,2]);R([0,1,5,4,0,0]);R([0,1,3,7,5,4]);R([0,2,6,4,0,0]);R([0,0,0,0,0,0]);R([1,3,7,5,0,0]);R([2,3,7,6,4,0]);R([2,3,7,6,0,0]);R([2,3,1,5,7,6]);R([0,1,5,7,6,2]);R([0,1,5,7,6,4]);R([0,1,3,7,6,4]);R([4,5,7,6,2,0]);R([4,5,7,6,0,0]);R([4,5,1,3,7,6]);R([0,2,3,7,5,4]);R([6,2,3,7,5,4]);R([6,2,3,1,5,4]);return I})(),E=f.create(),F=f.create(),H=f.create(),K=m.create();a.ObbArray=b;a.clone=function(I){return r(I.center,I.halfSize,I.quaternion)};a.compute=function(I,L){L=L||r();h.computeOBB(I,L);return L};
a.computeOffsetObb=function(I,L,R,O,J){n.copy(J.quaternion,I.quaternion);if(O===p.ViewingMode.Global){n.conjugate(K,I.quaternion);l.transformQuat(E,I.center,K);l.abs(F,E);l.min(H,F,I.halfSize);l.sub(H,F,H);O=l.length(H);l.add(H,F,I.halfSize);const M=l.length(H);O<R?(l.copy(J.center,I.center),l.set(E,R,R,R),l.add(J.halfSize,I.halfSize,E)):(L=0<M?1+L/M:1,O=0<O?1+R/O:1,R=(O+L)/2,L=(O-L)/2,l.scale(J.halfSize,F,L),l.scaleAndAdd(J.halfSize,J.halfSize,I.halfSize,R),l.scale(J.center,F,R),l.scaleAndAdd(J.center,
J.center,I.halfSize,L),l.sign(E,E),l.multiply(J.center,J.center,E),l.transformQuat(J.center,J.center,J.quaternion))}else O=l.set(E,0,0,1),l.scaleAndAdd(J.center,I.center,O,(R+L)/2),n.conjugate(K,I.quaternion),l.transformQuat(O,O,K),l.abs(O,O),l.scaleAndAdd(J.halfSize,I.halfSize,O,(R-L)/2);return J};a.corners=function(I,L){for(let R=0;8>R;++R){const O=L[R];O[0]=R&1?-I.halfSize[0]:I.halfSize[0];O[1]=R&2?-I.halfSize[1]:I.halfSize[1];O[2]=R&4?-I.halfSize[2]:I.halfSize[2];l.transformQuat(O,O,I.quaternion);
l.add(O,O,I.center)}};a.create=r;a.intersectLine=function(I,L,R,O=0){n.conjugate(B,I.quaternion);l.subtract(D,L,I.center);L=l.transformQuat(D,D,B);R=l.transformQuat(z,R,B);let J=-Infinity,M=Infinity;for(let G=0;3>G;G++)if(1E-6<Math.abs(R[G])){const P=(O+I.halfSize[G]-L[G])/R[G],U=(-O-I.halfSize[G]-L[G])/R[G];J=Math.max(J,Math.min(P,U));M=Math.min(M,Math.max(P,U))}else if(L[G]>I.halfSize[G]+O||L[G]<-I.halfSize[G]-O)return!1;return J<=M};a.intersectPlane=q;a.intersectSphere=function(I,L){D[0]=I.center[0]-
L[0];D[1]=I.center[1]-L[1];D[2]=I.center[2]-L[2];n.conjugate(B,I.quaternion);l.transformQuat(D,D,B);l.abs(D,D);l.min(z,D,I.halfSize);return l.sqrDist(z,D)<L[3]*L[3]};a.isVisible=function(I,L){return 0>=q(I,L[0])&&0>=q(I,L[1])&&0>=q(I,L[2])&&0>=q(I,L[3])&&0>=q(I,L[4])&&0>=q(I,L[5])};a.maximumDistancePlane=function(I,L){const R=u.signedDistance(L,I.center);I=y(I,u.normal(L));return R+I};a.minimumDistancePlane=function(I,L){const R=u.signedDistance(L,I.center);I=y(I,u.normal(L));return R-I};a.projectedArea=
function(I,L,R,O,J){n.conjugate(B,I.quaternion);l.sub(D,L,I.center);l.transformQuat(D,D,B);var M=D[0]<-I.halfSize[0]?-1:D[0]>I.halfSize[0]?1:0,G=D[1]<-I.halfSize[1]?-1:D[1]>I.halfSize[1]?1:0,P=D[2]<-I.halfSize[2]?-1:D[2]>I.halfSize[2]?1:0;L=Math.abs(M)+Math.abs(G)+Math.abs(P);if(0===L)return Infinity;L=1===L?4:6;M=6*(M+3*G+9*P+13);c.fromQuat(A,I.quaternion);c.scale(A,A,I.halfSize);for(G=0;G<L;G++)P=C[M+G],l.set(D,((P&1)<<1)-1,(P&2)-1,((P&4)>>1)-1),l.transformMat3(D,D,A),l.add(v,I.center,D),v[3]=1,
d.transformMat4(v,v,R),P=1/Math.max(1E-6,v[3]),t[2*G]=v[0]*P,t[2*G+1]=v[1]*P;I=2*L-2;R=t[0]*(t[3]-t[I+1])+t[I]*(t[1]-t[I-1]);for(L=2;L<I;L+=2)R+=t[L]*(t[L+3]-t[L-1]);return Math.abs(R)*O*J*.125};a.projectedRadius=y;a.radius=function(I){return l.len(I.halfSize)};a.set=function(I,L){l.copy(L.center,I.center);l.copy(L.halfSize,I.halfSize);n.copy(L.quaternion,I.quaternion)};a.toAaBoundingBox=function(I,L){L||(L=k.create());var R=c.fromQuat(A,I.quaternion);const O=I.halfSize[0]*Math.abs(R[0])+I.halfSize[1]*
Math.abs(R[3])+I.halfSize[2]*Math.abs(R[6]),J=I.halfSize[0]*Math.abs(R[1])+I.halfSize[1]*Math.abs(R[4])+I.halfSize[2]*Math.abs(R[7]);R=I.halfSize[0]*Math.abs(R[2])+I.halfSize[1]*Math.abs(R[5])+I.halfSize[2]*Math.abs(R[8]);L[0]=I.center[0]-O;L[1]=I.center[1]-J;L[2]=I.center[2]-R;L[3]=I.center[0]+O;L[4]=I.center[1]+J;L[5]=I.center[2]+R;return L};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const m=new Float32Array(4);
m[3]=1;return m}function c(m){const l=new Float32Array(4);l[0]=m[0];l[1]=m[1];l[2]=m[2];l[3]=m[3];return l}function w(m,l,g,f){const d=new Float32Array(4);d[0]=m;d[1]=l;d[2]=g;d[3]=f;return d}function n(m,l){return new Float32Array(m,l,4)}const x=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:n,fromValues:w},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=n;a.fromValues=w;a.quatf32=x})},"esri/views/3d/support/dito":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Attribute"],function(a,b,c){function w(Z,Y,aa,ia,na,ba){if(!(1E-6>Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2]))for(u(H,aa,Y),u(K,ia,Y),u(I,na,Y),n(Z,Y,F),R[1]=F[0],L[1]=F[1],O[1]=L[1]-R[1],aa=[aa,ia,na],ia=[H,K,I],na=0;3>na;++na){n(Z,aa[na],F);R[0]=F[0];L[0]=F[1];n(Z,ia[na],F);R[2]=F[0];L[2]=F[1];O[0]=L[0]-R[0];O[2]=L[2]-R[2];const ea=g(O);ea<ba.quality&&(k(ba.b0,aa[na]),k(ba.b1,Y),k(ba.b2,ia[na]),ba.quality=ea)}}function n(Z,Y,aa){const {data:ia,
size:na}=Z;aa[0]=Number.POSITIVE_INFINITY;aa[1]=Number.NEGATIVE_INFINITY;for(Z=0;Z<ia.length;Z+=na){const ba=ia[Z]*Y[0]+ia[Z+1]*Y[1]+ia[Z+2]*Y[2];aa[0]=Math.min(aa[0],ba);aa[1]=Math.max(aa[1],ba)}}function x(Z,Y,aa){k(aa.center,Z);e(aa.halfSize,Y,.5);aa.quaternion[0]=0;aa.quaternion[1]=0;aa.quaternion[2]=0;aa.quaternion[3]=1}function m(Z,Y,aa,ia,na,ba){n(Z,Y,F);na[0]=F[0];ba[0]=F[1];n(Z,aa,F);na[1]=F[0];ba[1]=F[1];n(Z,ia,F);na[2]=F[0];ba[2]=F[1]}function l(Z,Y,aa,ia,na,ba,ea){W[0]=Z[0];W[1]=Z[1];
W[2]=Z[2];W[3]=Y[0];W[4]=Y[1];W[5]=Y[2];W[6]=aa[0];W[7]=aa[1];W[8]=aa[2];var ja=ea.quaternion,ka=W,da=ka[0]+ka[4]+ka[8];if(0<da)da=Math.sqrt(da+1),ja[3]=.5*da,da=.5/da,ja[0]=(ka[5]-ka[7])*da,ja[1]=(ka[6]-ka[2])*da,ja[2]=(ka[1]-ka[3])*da;else{da=0;ka[4]>ka[0]&&(da=1);ka[8]>ka[3*da+da]&&(da=2);const ha=(da+1)%3,ca=(da+2)%3;let fa=Math.sqrt(ka[3*da+da]-ka[3*ha+ha]-ka[3*ca+ca]+1);ja[da]=.5*fa;fa=.5/fa;ja[3]=(ka[3*ha+ca]-ka[3*ca+ha])*fa;ja[ha]=(ka[3*ha+da]+ka[3*da+ha])*fa;ja[ca]=(ka[3*ca+da]+ka[3*da+ca])*
fa}f(V,ia,na);e(V,V,.5);e(ea.center,Z,V[0]);e(Q,Y,V[1]);f(ea.center,ea.center,Q);e(Q,aa,V[2]);f(ea.center,ea.center,Q);e(ea.halfSize,ba,.5)}function g(Z){return Z[0]*Z[1]+Z[0]*Z[2]+Z[1]*Z[2]}function f(Z,Y,aa){Z[0]=Y[0]+aa[0];Z[1]=Y[1]+aa[1];Z[2]=Y[2]+aa[2]}function d(Z,Y,aa){Z[0]=Y[0]-aa[0];Z[1]=Y[1]-aa[1];Z[2]=Y[2]-aa[2]}function e(Z,Y,aa){Z[0]=Y[0]*aa;Z[1]=Y[1]*aa;Z[2]=Y[2]*aa}function k(Z,Y,aa=0){Z[0]=Y[aa];Z[1]=Y[aa+1];Z[2]=Y[aa+2]}function u(Z,Y,aa){const ia=Y[0],na=Y[1];Y=Y[2];const ba=aa[0],
ea=aa[1];aa=aa[2];Z[0]=na*aa-Y*ea;Z[1]=Y*ba-ia*aa;Z[2]=ia*ea-na*ba}function p(Z,Y){var aa=Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2];0<aa&&(aa=1/Math.sqrt(aa),Z[0]=Y[0]*aa,Z[1]=Y[1]*aa,Z[2]=Y[2]*aa)}function h(Z,Y){const aa=Y[0]-Z[0],ia=Y[1]-Z[1];Z=Y[2]-Z[2];return aa*aa+ia*ia+Z*Z}const r=[0,0,0],q=[0,0,0],y=[0,0,0],B=[0,0,0],D=[0,0,0],z=[0,0,0],v=[0,0,0],A=[0,0,0],t=[0,0,0],C=[0,0,0],E=[0,0,0],F=[0,0],H=[0,0,0],K=[0,0,0],I=[0,0,0],L=[0,0,0],R=[0,0,0],O=[0,0,0],J=[0,0,0],M=[0,0,0],G=[0,0,0],P=[0,0,0],U=[0,0,0],
N=[0,0,0],S=[0,0,0],Q=[0,0,0],W=[1,0,0,0,1,0,0,0,1],V=[0,0,0];let T=b._createClass(function(Z){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var Y=0;this.minProj=new Float64Array(this.buffer,Y,7);Y+=56;this.maxProj=new Float64Array(this.buffer,Y,7);Y+=56;for(var aa=0;7>aa;++aa)this.minVert[aa]=new Float64Array(this.buffer,Y,3),Y+=24;for(aa=0;7>aa;++aa)this.maxVert[aa]=new Float64Array(this.buffer,Y,3),Y+=24;for(Y=0;7>Y;++Y)this.minProj[Y]=Number.POSITIVE_INFINITY,this.maxProj[Y]=
Number.NEGATIVE_INFINITY;Y=Array(7);aa=Array(7);const {data:ia,size:na}=Z;for(Z=0;Z<ia.length;Z+=na){var ba=ia[Z];ba<this.minProj[0]&&(this.minProj[0]=ba,Y[0]=Z);ba>this.maxProj[0]&&(this.maxProj[0]=ba,aa[0]=Z);ba=ia[Z+1];ba<this.minProj[1]&&(this.minProj[1]=ba,Y[1]=Z);ba>this.maxProj[1]&&(this.maxProj[1]=ba,aa[1]=Z);ba=ia[Z+2];ba<this.minProj[2]&&(this.minProj[2]=ba,Y[2]=Z);ba>this.maxProj[2]&&(this.maxProj[2]=ba,aa[2]=Z);ba=ia[Z]+ia[Z+1]+ia[Z+2];ba<this.minProj[3]&&(this.minProj[3]=ba,Y[3]=Z);ba>
this.maxProj[3]&&(this.maxProj[3]=ba,aa[3]=Z);ba=ia[Z]+ia[Z+1]-ia[Z+2];ba<this.minProj[4]&&(this.minProj[4]=ba,Y[4]=Z);ba>this.maxProj[4]&&(this.maxProj[4]=ba,aa[4]=Z);ba=ia[Z]-ia[Z+1]+ia[Z+2];ba<this.minProj[5]&&(this.minProj[5]=ba,Y[5]=Z);ba>this.maxProj[5]&&(this.maxProj[5]=ba,aa[5]=Z);ba=ia[Z]-ia[Z+1]-ia[Z+2];ba<this.minProj[6]&&(this.minProj[6]=ba,Y[6]=Z);ba>this.maxProj[6]&&(this.maxProj[6]=ba,aa[6]=Z)}for(Z=0;7>Z;++Z)ba=Y[Z],k(this.minVert[Z],ia,ba),ba=aa[Z],k(this.maxVert[Z],ia,ba)}),X=b._createClass(function(){this.b0=
[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0});a.computeOBB=function(Z,Y){const {data:aa,size:ia}=Z;var na=aa.length/ia;if(!(0>=na)){var ba=new T(Z);f(r,ba.minProj,ba.maxProj);e(r,r,.5);d(q,ba.maxProj,ba.minProj);var ea=g(q),ja=new X;ja.quality=ea;14>na&&(Z=new c.Attribute(new Float64Array(ba.buffer,112,42),3));var ka=[0,0,0],da=[0,0,0],ha=[0,0,0];na=[0,0,0];var ca=[0,0,0],fa=[0,0,0],ma=[0,0,0];var qa=Z;var wa=h(ba.maxVert[0],ba.minVert[0]),xa=0;for(var pa=1;7>pa;++pa){const Ba=h(ba.maxVert[pa],
ba.minVert[pa]);Ba>wa&&(wa=Ba,xa=pa)}k(ka,ba.minVert[xa]);k(da,ba.maxVert[xa]);if(1E-6>h(ka,da))qa=1;else{d(na,ka,da);p(na,na);const {data:Ba,size:Aa}=qa;ba=Number.NEGATIVE_INFINITY;wa=0;for(xa=0;xa<Ba.length;xa+=Aa)E[0]=Ba[xa]-ka[0],E[1]=Ba[xa+1]-ka[1],E[2]=Ba[xa+2]-ka[2],pa=na[0]*E[0]+na[1]*E[1]+na[2]*E[2],pa=E[0]*E[0]+E[1]*E[1]+E[2]*E[2]-pa*pa/(na[0]*na[0]+na[1]*na[1]+na[2]*na[2]),pa>ba&&(ba=pa,wa=xa);k(ha,Ba,wa);1E-6>ba?qa=2:(d(ca,da,ha),p(ca,ca),d(fa,ha,ka),p(fa,fa),u(ma,ca,na),p(ma,ma),w(qa,
ma,na,ca,fa,ja),qa=0)}switch(qa){case 1:x(r,q,Y);return;case 2:ea=Z;k(M,na);Math.abs(na[0])>Math.abs(na[1])&&Math.abs(na[0])>Math.abs(na[2])?M[0]=0:Math.abs(na[1])>Math.abs(na[2])?M[1]=0:M[2]=0;1E-6>M[0]*M[0]+M[1]*M[1]+M[2]*M[2]&&(M[0]=M[1]=M[2]=1);u(G,na,M);p(G,G);u(P,na,G);p(P,P);m(ea,na,G,P,U,N);d(S,N,U);l(na,G,P,U,N,S,Y);return}qa=Z;ba=F;const {data:ra,size:va}=qa;k(B,ra);k(y,B);ba[0]=J[0]*ma[0]+J[1]*ma[1]+J[2]*ma[2];ba[1]=ba[0];for(wa=va;wa<ra.length;wa+=va)xa=ra[wa]*ma[0]+ra[wa+1]*ma[1]+ra[wa+
2]*ma[2],xa<ba[0]&&(ba[0]=xa,k(B,ra,wa)),xa>ba[1]&&(ba[1]=xa,k(y,ra,wa));ma=ka[0]*ma[0]+ka[1]*ma[1]+ka[2]*ma[2];F[1]-1E-6<=ma&&(y[0]=void 0);F[0]+1E-6>=ma&&(B[0]=void 0);void 0!==y[0]&&(d(D,y,ka),p(D,D),d(z,y,da),p(z,z),d(v,y,ha),p(v,v),u(A,z,na),p(A,A),u(t,v,ca),p(t,t),u(C,D,fa),p(C,C),w(qa,A,na,z,D,ja),w(qa,t,ca,v,z,ja),w(qa,C,fa,D,v,ja));void 0!==B[0]&&(d(D,B,ka),p(D,D),d(z,B,da),p(z,z),d(v,B,ha),p(v,v),u(A,z,na),p(A,A),u(t,v,ca),p(t,t),u(C,D,fa),p(C,C),w(qa,A,na,z,D,ja),w(qa,t,ca,v,z,ja),w(qa,
C,fa,D,v,ja));m(Z,ja.b0,ja.b1,ja.b2,U,N);Z=[0,0,0];d(Z,N,U);ja.quality=g(Z);ja.quality<ea?l(ja.b0,ja.b1,ja.b2,U,N,Z,Y):x(r,q,Y)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./IndexRange/ComponentRangeRunLengthEncoded"],function(a,b,c){function w(n,x,m){const l=[],g=[];let f=m.length,d=m.length;x.forEachComponent(e=>
{0<n[e]?(f!==e-1&&(l.length&&l.push(m[f+1]-l[l.length-1]),l.push(m[e])),f=e):(d!==e-1&&(g.length&&g.push(m[d+1]-g[g.length-1]),g.push(m[e])),d=e);return!0});l.length&&l.push(m[f+1]-l[l.length-1]);g.length&&g.push(m[d+1]-g[g.length-1]);return{highlightRanges:l,defaultRanges:g}}return function(){function n(m,l){this.offsets=l;this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=this.highlightCounts=this.pickability=null;l=this.count;this.visibility=new c.ComponentRangeRunLengthEncoded(l);
this.materialDataBuffer=m.getBuffer(l);this.materialDataIndices=new Uint16Array(l);for(m=0;m<l;m++)this.materialDataIndices[m]=this.materialDataBuffer.acquireIndex()}var x=n.prototype;x.destroy=function(){for(let m=0;m<this.count;m++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[m])};x.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};x.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};x._updateCachedHighlightRanges=
function(){if((b.isNone(this.cachedHighlightRanges)||b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:m,defaultRanges:l}=w(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=m;this.cachedDefaultRanges=l}};a._createClass(n,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));
return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(b.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return n}()})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports",
"../../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._totalCount=x;this._indexRanges=[0,x]}var n=w.prototype;n.allVisible=function(){return this.componentCount()===this._totalCount};n.allInvisible=function(){return 0===this._indexRanges.length};n.componentCount=function(){const x=this._indexRanges;let m=0;for(let l=0;l<x.length;l+=2)m+=x[l+1];return m};n.reset=function(x){if("all"===x||x.length===this._totalCount)this._indexRanges=[0,this._totalCount];
else{{const g=[];if(0!==x.length){var m=x[0],l=1;for(let f=1;f<x.length;f++){const d=x[f];m+l===d?l+=1:(g.push(m),g.push(l),m=d,l=1)}g.push(m);g.push(l)}x=g}this._indexRanges=x}};n.forEachComponent=function(x){const m=this._indexRanges;for(let g=0;g<m.length;g+=2){var l=m[g];const f=l+m[g+1];for(;l<f;l++)if(!x(l))return!1}return!0};n.forEachComponentRange=function(x){const m=this._indexRanges;for(let l=0;l<m.length;l+=2){const g=m[l];if(!x(g,g+m[l+1]))return!1}return!0};n.computeOffsetRanges=function(x){const m=
Array(this._indexRanges.length),l=this._indexRanges;for(let f=0;f<l.length;f+=2){var g=l[f];const d=x[g];g=x[g+l[f+1]];m[f]=d;m[f+1]=g-d}return m};return b._createClass(w)}();a.ComponentRangeRunLengthEncoded=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){a.ComponentObject=function(f){function d(){var k=e.apply(this,arguments);k.visible=a.State.Hidden;return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(w);c.__decorate([n.property({autoDestroy:!0})],a.ComponentObject.prototype,"renderable",void 0);c.__decorate([n.property({autoDestroy:!0})],a.ComponentObject.prototype,"components",void 0);a.ComponentObject=c.__decorate([g.subclass("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],
a.ComponentObject);a.State=void 0;(function(f){f[f.Hidden=0]="Hidden";f[f.Visible=1]="Visible"})(a.State||(a.State={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Indices ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,w,n,x,m,l,g,f){let d=function(){function u(h,r){this._indices=b.isSome(h.indices)?h.indices:x.getContinuousIndexArray(h.positions.length/3);this._positions=h.positions;this._components=r;this._componentIntersectionData=Array(r.count)}var p=u.prototype;p.getComponentAabb=function(h,r){if(b.isSome(this._perComponentAabbs)){for(let q=0;6>q;q++)r[q]=this._perComponentAabbs[6*h+q];return r}this._computePerComponentAabbs();return this.getComponentAabb(h,r)};p.getComponentPositions=function(h,
r){r.indices=this._indices;r.data=this._positions;r.stride=3;r.startIndex=this._components.offsets[h];r.endIndex=this._components.offsets[h+1]};p.intersect=function(h,r,q,y,B,D,z){const v=new l.Attribute(this._positions,3,!1,3),A=this._indices,t=this._components.offsets,C=f.computeInvDir(h,r,e),E=h[2],F=r[2];this._components.visibility.forEachComponent(H=>{if(!g.getVisibility(this._components.pickability,H))return!0;var K=this.getComponentAabb(H,k);if(b.isSome(D)){var I=D[H];b.isSome(B)?B.componentOffset=
I:(h[2]=E-I,r[2]=F-I)}b.isSome(B)&&B.applyToAabb(K);if(!f.intersectAabbInvDir(K,h,C,q))return!0;K=t[H]/3;I=t[H+1]/3;const L=I-K,R=(O,J,M)=>z(H,O,c.transformMat3(J,J,y),M);b.isNone(B)&&L>m.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[H]&&(this._componentIntersectionData[H]=new m.ComponentIntersectionData(this._indices,K,I,v)),this._componentIntersectionData[H].intersectRay({r0:h,r1:r},R)):f.intersectTriangles(h,r,K,I,A,v,void 0,B,R);return!0})};p._computePerComponentAabbs=
function(){const h=this._components.count;this._perComponentAabbs=new Float32Array(6*h);const r=this._indices,q=this._positions,y=this._components.offsets;let B=0;for(let v=0;v<h;v++){var D=y[v];const A=y[v+1];let t=Infinity,C=Infinity,E=Infinity,F=-Infinity,H=-Infinity,K=-Infinity;for(;D<A;D++){var z=3*r[D];const I=q[z],L=q[z+1];z=q[z+2];t=Math.min(t,I);C=Math.min(C,L);E=Math.min(E,z);F=Math.max(F,I);H=Math.max(H,L);K=Math.max(K,z)}this._perComponentAabbs[B++]=t;this._perComponentAabbs[B++]=C;this._perComponentAabbs[B++]=
E;this._perComponentAabbs[B++]=F;this._perComponentAabbs[B++]=H;this._perComponentAabbs[B++]=K}};a._createClass(u,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return u}();const e=w.create(),k=n.create();return d})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],function(a){function b(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=b;a.getVisibility=function(c,w){if(null==
c)return!0;const {isVisibleBit:n,data:x}=c,m=8*x.BYTES_PER_ELEMENT;return w<x.length*m?(c=w/m|0,0!==(x[c]&1<<w-c*m)===n):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,w,n,x){if(n>=w)return c;null==c&&(c=b());let m=c.data;const l=8*m.BYTES_PER_ELEMENT,g=n/l|0,f=n-l*g,d=m;x=x===c.isVisibleBit;n<d.length*l||!x||(n=Math.max(g+1,Math.ceil(1.5*d.length)),n=Math.min(n,((w-1)/l|0)+1),m=new Uint32Array(n),m.set(d));g<m.length&&(m[g]=m[g]&~(1<<f)|(x?1:0)<<f);c.data=m;return c};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(n,x,m){this.material=n;this.geometry=x;this.meta=m}w.prototype.destroy=function(){this.material.dispose();this.geometry.dispose()};return b._createClass(w)}();a.Renderable=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(n,x,m,l){this.vao=n;this.primitiveType=x;this.parameters=m;this.indexed=l}w.prototype.dispose=function(){this.vao.dispose()};return b._createClass(w)}();a.RenderGeometry=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./DepthRange"],function(a,
b,c){let w=function(){function n(m){this._objects=m}var x=n.prototype;x.submit=function(m,l){this._objects.preSubmit(l);this._objects.visibleObjects.forAll(g=>g.renderable.material.submit(m,l,g))};x.queryShadowCasterDepthRange=function(m){return this._objects.visibleObjects.length?c.computeDepthRange(m,this._objects.visibleObjects):null};return b._createClass(n)}();a.RenderSubmitSystem=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(K,I,L){return l.set(K,I.data[L],I.data[L+1],I.data[L+2])}function u(K,I){K.push(I[0]);K.push(I[1]);K.push(I[2])}function p(K,I,L,R){x.conjugate(A,K.quaternion);l.sub(t,I,K.center);l.transformQuat(t,t,A);const O=8*((t[0]<-K.halfSize[0]?-1:t[0]>K.halfSize[0]?1:0)+3*(t[1]<-K.halfSize[1]?-1:t[1]>K.halfSize[1]?1:0)+9*(t[2]<-K.halfSize[2]?-1:t[2]>K.halfSize[2]?1:0)+13);I=z[O];if(0===I)return I;w.fromQuat(v,K.quaternion);w.scale(v,v,K.halfSize);const J=(M,G)=>
{G=z[O+G+1];l.set(M,((G&1)<<1)-1,(G&2)-1,((G&4)>>1)-1);l.transformMat3(M,M,v);return l.add(M,K.center,M)};L.length=0;u(L,J(C,0));u(L,J(E,1));u(L,J(t,2));u(L,J(F,3));R(L);if(1===I)return I;L.length=0;u(L,C);u(L,F);u(L,J(t,4));u(L,J(H,5));R(L);if(2===I)return I;L.length=0;u(L,C);u(L,H);u(L,J(t,6));u(L,E);R(L);return I}const h=new c({allocator:K=>K||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:K=>{K.object=b.nullifyNonNullableForDispose(K.object);return K}}),r=e.empty(),q=g.create(),
y=g.create(),B=new c({deallocator:null}),D=new c({deallocator:null}),z=(()=>{const K=new Int8Array(216);let I=0;const L=R=>{for(let O=0;O<R.length;O++)K[I+O]=R[O];I+=8};L([3,0,6,2,3,1,5,4]);L([2,0,2,3,1,5,4,0]);L([3,1,0,2,3,7,5,4]);L([2,0,1,3,2,6,4,0]);L([1,0,1,3,2,0,0,0]);L([2,1,5,7,3,2,0,0]);L([3,2,0,1,3,7,6,4]);L([2,2,0,1,3,7,6,0]);L([3,3,0,1,5,7,6,2]);L([2,0,1,5,4,6,2,0]);L([1,0,1,5,4,0,0,0]);L([2,1,3,7,5,4,0,0]);L([1,0,2,6,4,0,0,0]);L([0,0,0,0,0,0,0,0]);L([1,1,3,7,5,0,0,0]);L([2,2,3,7,6,4,0,
0]);L([1,2,3,7,6,0,0,0]);L([2,3,1,5,7,6,2,0]);L([3,4,0,1,5,7,6,2]);L([2,5,7,6,4,0,1,0]);L([3,5,0,1,3,7,6,4]);L([2,4,5,7,6,2,0,0]);L([1,4,5,7,6,0,0,0]);L([2,5,1,3,7,6,4,0]);L([3,6,0,2,3,7,5,4]);L([2,6,2,3,7,5,4,0]);L([3,7,6,2,3,1,5,4]);return K})(),v=n.create(),A=m.create(),t=g.create(),C=g.create(),E=g.create(),F=g.create(),H=g.create();a.computeDepthRange=function(K,I){const L=e.empty(),{eye:R,frustum:O,viewForward:J}=K;I.forAll(M=>{var G=b.isSome(M.offsetObb)?M.offsetObb:M.obb;const P=l.dot(l.sub(t,
G.center,R),J),U=d.projectedRadius(G,J);if(!e.within(L,P-U)||!e.within(L,P+U)){a:{var N=0;for(let S=0;4>S;S++){const Q=d.intersectPlane(G,O[S]);if(0<Q){G=-1;break a}0===Q&&(N|=1<<S)}G=N}-1!==G&&(0===G?(r.far=P+U,r.near=P-U,e.union(L,r)):(N=h.pushNew(),N.near=P-U,N.far=P+U,N.mask=G,N.object=M))}});for(K=0;K<h.length;K++){const M=h.data[K];e.within(L,M.near)&&e.within(L,M.far)||(r.far=M.far,r.near=Infinity,I=b.isSome(M.object.offsetObb)?M.object.offsetObb:M.object.obb,0===p(I,R,B,G=>{var P=D;for(var U=
0;4>U&&0<G.length;U++){if(0===(M.mask&1<<U))continue;var N=O[U],S=G,Q=P;Q.length=0;const W=S.length-3;k(q,S,W);const V=f.signedDistance(N,q);0>=V&&(Q.push(q[0]),Q.push(q[1]),Q.push(q[2]));let T=0,X=V;for(T;T<W;T+=3){k(y,S,T);const Z=f.signedDistance(N,y);0>X*Z&&(l.lerp(q,y,q,Z/(Z-X)),u(Q,q));0>=Z&&u(Q,y);X=Z;l.copy(q,y)}0>X*V&&(k(y,S,W),l.lerp(q,y,q,V/(V-X)),u(Q,q));N=G;G=P;P=N}for(P=0;P<G.length;P+=3)l.set(q,G.data[P],G.data[P+1],G.data[P+2]),U=l.dot(l.sub(q,q,R),J),r.near=Math.min(r.near,U)})&&
(r.near=0),e.union(L,r))}h.length=0;return L};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(n,x){return{near:n,far:x}}function w(n,x,m){n.near=x;n.far=m;return n}b=b._createClass(function(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE});a.DepthRange=b;a.ZERO={near:0,far:0};a.create=c;a.empty=function(n){return n?w(n,Infinity,-Infinity):
c(Infinity,-Infinity)};a.set=w;a.union=function(n,x,m=n){null!=x&&(m.near=Math.min(n.near,x.near),m.far=Math.max(n.far,x.far));return m};a.within=function(n,x){return n.near<=x&&x<=n.far};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,
b,c,w){a.createVertexBufferLayout=function(n){const x=b.newLayout().vec3f(w.VertexAttribute.POSITION);n.normals&&x.vec2i16(w.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});n.textureCoordinates===c.TextureCoordinateAttributeType.Default?x.vec2f(w.VertexAttribute.UV0):n.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(x.vec2f(w.VertexAttribute.UV0),x.vec4u16(w.VertexAttribute.UVREGION,{glNormalized:!0}));n.colors&&x.vec4u8(w.VertexAttribute.COLOR,{glNormalized:!0});return x.alignTo(4)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec4f64","../../../layers/support/symbolColorUtils"],function(a,b,c,w){b=b._createClass(function(){this.externalColor=c.create();this.externalColorMixMode=w.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0});a.UniformComponentParameters=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/interfaces ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H){let K=function(O){function J(G,P){var U=M.call(this);U.toMapSpace=P;U.baseColor=f.fromValues(1,1,1,1);U.usePBR=!1;U.hasParametersFromSource=!1;U.mrrFactors=l.fromValues(1,1,.5);U.emissiveFactor=l.fromValues(0,0,0);U.baseColorTexture=null;U.metallicRoughnessTexture=null;U.emissionTexture=null;U.occlusionTexture=null;U.normalTexture=null;U.objectOpacity=1;U.commonMaterialParameters=new L;U.componentParameters=new R;U.textureAlphaCutoff=
t.defaultMaskAlphaCutoff;U.alphaDiscardMode=F.AlphaDiscardMode.Opaque;U.isIntegratedMesh=!1;U.polygonOffsetEnabled=!1;U.ellipsoidMode=C.EllipsoidMode.Earth;U.hasOccludees=!1;U._techniqueConfiguration=new p.ComponentTechniqueConfiguration;P=new E.TwoVectorPosition(G.position);const N=x.clone(G.rotationScale);n.invert(N,N);U.transformNormalGlobalFromModel=n.transpose(N,N);U.transformWorldFromModelTL=P.low;U.transformWorldFromModelTH=P.high;U.transformWorldFromModelRS=G.rotationScale;return U}b._inherits(J,
O);var M=b._createSuper(J);O=J.prototype;O.dispose=function(){this._technique=w.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};O.prepareTechnique=function(G,P,U,N){const S=this._techniqueConfiguration;S.hasVertexColors=N.colors;S.hasNormals=N.normals;S.textureCoordinateType=N.textureCoordinates;S.hasMetallicRoughnessTexture=w.isSome(this.metallicRoughnessTexture);S.hasEmissionTexture=w.isSome(this.emissionTexture);
S.hasOcclusionTexture=w.isSome(this.occlusionTexture);S.hasNormalTexture=w.isSome(this.normalTexture);S.transparencyPassType=P.identifier===B.RenderPassIdentifier.Material&&null!=U.transparencyPassType?U.transparencyPassType:H.TransparencyPassType.NONE;S.hasMultipassTerrain=P.identifier===B.RenderPassIdentifier.Material&&null!=U.multipassTerrain?U.multipassTerrain.enabled:!1;S.cullAboveGround=P.identifier===B.RenderPassIdentifier.Material&&null!=U.multipassTerrain?U.multipassTerrain.cullAboveGround:
!1;S.ellipsoidMode=this.ellipsoidMode;S.componentData=this.componentParameters.type;S.cullFace=this.commonMaterialParameters.cullFace;S.doubleSidedMode=this.commonMaterialParameters.doubleSided?v.NormalsDoubleSidedMode.View:v.NormalsDoubleSidedMode.None;S.hasBaseColorTexture=w.isSome(this.baseColorTexture);N=this._computeWhichMaterialPass();S.blendingEnabled=N===I.Transparent||N===I.OpaqueAndTransparent;S.alphaDiscardMode=this.alphaDiscardMode;S.integratedMeshMode=this.isIntegratedMesh?(0===U.overlays.length?
0:w.isSome(U.overlays[k.OverlayIndex.INNER].getColorTextureNoRasterImage()))?r.getOverlayNormalTexture(U)?p.IntegratedMeshMode.ColorOverlayWithWater:p.IntegratedMeshMode.ColorOverlay:p.IntegratedMeshMode.NoOverlay:p.IntegratedMeshMode.None;S.hasPolygonOffset=this.polygonOffsetEnabled;N=this.hasParametersFromSource&&w.isNone(this.baseColorTexture);S.pbrMode=S.integratedMeshMode===p.IntegratedMeshMode.ColorOverlayWithWater?A.PBRMode.WaterOnIntegratedMesh:this.usePBR?N?A.PBRMode.Schematic:A.PBRMode.Normal:
A.PBRMode.Disabled;S.normalType=S.integratedMeshMode===p.IntegratedMeshMode.None?S.hasNormals?z.NormalAttributeType.CompressedAttribute:z.NormalAttributeType.ScreenDerivative:z.NormalAttributeType.Ground;S.hasSlicePlane=w.isSome(U.slicePlane)&&this.commonMaterialParameters.hasSlicePlane;if(P.identifier===B.RenderPassIdentifier.ShadowMap)S.output=D.ShaderOutput.Shadow,S.vertexDiscardMode=q.VertexDiscardMode.None;else if(P.identifier===B.RenderPassIdentifier.Highlight)S.output=D.ShaderOutput.Highlight,
S.vertexDiscardMode=q.VertexDiscardMode.None;else{this._computeWhichMaterialPass()===I.OpaqueAndTransparent?S.vertexDiscardMode=P.transparent?q.VertexDiscardMode.Opaque:q.VertexDiscardMode.Transparent:S.vertexDiscardMode=q.VertexDiscardMode.None;S.output=P.output;S.receiveAmbientOcclusion=!1;S.receiveShadows=!1;switch(P.output){case D.ShaderOutput.Color:S.receiveAmbientOcclusion=U.ssaoHelper.active;S.hasOccludees=U.hasOccludees;S.receiveShadows=U.shadowMap.ready;S.hasScreenSpaceReflections=U.ssr.enabled;
S.hasCloudsReflections=w.isSome(U.cloudsFade.data);break;case D.ShaderOutput.Alpha:S.hasOccludees=U.hasOccludees;break;case D.ShaderOutput.ObjectAndLayerIdColor:S.objectAndLayerIdColor=!0}S.snowCover=this.hasSnowCover(U)}this._technique=G.releaseAndAcquire(u.ComponentTechnique,S,this._technique);this._setClean();return this._technique};O.hasSnowCover=function(G){return w.isSome(G.weather)&&G.weatherVisible&&"snowy"===G.weather.type&&"enabled"===G.weather.snowCover};O.submit=function(G,P,U){if(0!==
this.objectOpacity){var N=U.renderable.geometry,S=U.components;U=U.renderable.meta.cameraDepthSquared;var Q=S.geometryRanges,W=S.highlightRanges;S=S.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case I.Opaque:G.materialOpaque.submitDraw(this,N,Q,U);break;case I.Transparent:G.materialTransparent.submitDraw(this,N,Q,U);break;case I.OpaqueAndTransparent:G.materialOpaque.submitDraw(this,N,Q,U);G.materialTransparent.submitDraw(this,N,Q,U);break;case I.IntegratedMesh:G.materialIntegratedMesh.submitDraw(this,
N,Q,U),(0===P.overlays.length?0:w.isSome(P.overlays[k.OverlayIndex.INNER].getValidTexture(k.RenderTargetType.Highlight)))&&G.highlightIntegratedMesh.submitDraw(this,N,Q,U)}(P=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&G.shadowMap.submitDraw(this,N,Q,U);w.isSome(W)&&(G.highlight.submitDraw(this,N,W,U),P&&G.highlightShadowMap.submitDraw(this,N,W,U));P&&w.isSome(S)&&G.defaultShadowMap.submitDraw(this,N,S,U)}};O._computeWhichMaterialPass=function(){return this.isIntegratedMesh?
I.IntegratedMesh:1>this.objectOpacity?I.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?I.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===F.AlphaDiscardMode.Blend||this.alphaDiscardMode===F.AlphaDiscardMode.MaskBlend?I.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?I.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?I.Transparent:I.OpaqueAndTransparent};b._createClass(J,[{key:"texture",get:function(){return w.isSome(this.baseColorTexture)?
this.baseColorTexture.glTexture:null}},{key:"textureMetallicRoughness",get:function(){return w.isSome(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}},{key:"textureEmissive",get:function(){return w.isSome(this.emissionTexture)?this.emissionTexture.glTexture:null}},{key:"textureOcclusion",get:function(){return w.isSome(this.occlusionTexture)?this.occlusionTexture.glTexture:null}},{key:"textureNormal",get:function(){return w.isSome(this.normalTexture)?this.normalTexture.glTexture:
null}}]);return J}(y.MaterialBase);c.__decorate([y.parameter({vectorOps:g.vec4})],K.prototype,"baseColor",void 0);c.__decorate([y.parameter()],K.prototype,"usePBR",void 0);c.__decorate([y.parameter()],K.prototype,"hasParametersFromSource",void 0);c.__decorate([y.parameter({vectorOps:m.vec3})],K.prototype,"mrrFactors",void 0);c.__decorate([y.parameter({vectorOps:m.vec3})],K.prototype,"emissiveFactor",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"baseColorTexture",void 0);c.__decorate([y.parameter({dispose:!0})],
K.prototype,"metallicRoughnessTexture",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"emissionTexture",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"occlusionTexture",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"normalTexture",void 0);c.__decorate([y.parameter()],K.prototype,"objectOpacity",void 0);c.__decorate([y.parameterBlock()],K.prototype,"commonMaterialParameters",void 0);c.__decorate([y.parameterBlock()],K.prototype,"componentParameters",void 0);
c.__decorate([y.parameter()],K.prototype,"textureAlphaCutoff",void 0);c.__decorate([y.parameter()],K.prototype,"alphaDiscardMode",void 0);c.__decorate([y.parameter()],K.prototype,"isIntegratedMesh",void 0);c.__decorate([y.parameter()],K.prototype,"polygonOffsetEnabled",void 0);c.__decorate([y.parameter()],K.prototype,"ellipsoidMode",void 0);c.__decorate([y.parameter()],K.prototype,"hasOccludees",void 0);var I;(function(O){O[O.Opaque=0]="Opaque";O[O.Transparent=1]="Transparent";O[O.OpaqueAndTransparent=
2]="OpaqueAndTransparent";O[O.IntegratedMesh=3]="IntegratedMesh"})(I||(I={}));let L=function(O){function J(){var G=M.apply(this,arguments);G.doubleSided=!1;G.cullFace=F.CullFaceOptions.Back;G.hasSlicePlane=!0;return G}b._inherits(J,O);var M=b._createSuper(J);return b._createClass(J)}(y.MaterialParameterBlock);c.__decorate([y.parameter()],L.prototype,"doubleSided",void 0);c.__decorate([y.parameter()],L.prototype,"cullFace",void 0);c.__decorate([y.parameter()],L.prototype,"hasSlicePlane",void 0);let R=
function(O){function J(){var G=M.apply(this,arguments);G.externalColor=d.fromValues(1,1,1,1);G.externalColorMixMode=e.ColorMixModeEnum.Multiply;G.castShadows=a.ComponentParameterSummary.All;return G}b._inherits(J,O);var M=b._createSuper(J);b._createClass(J,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===e.ColorMixModeEnum.Replace&&1===this.externalColor[3]?
a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"type",get:function(){return h.ComponentDataType.Uniform}}]);return J}(y.MaterialParameterBlock);c.__decorate([y.parameter({vectorOps:g.vec4})],R.prototype,"externalColor",void 0);c.__decorate([y.parameter()],R.prototype,"externalColorMixMode",void 0);c.__decorate([y.parameter()],R.prototype,"castShadows",
void 0);a.ComponentParameterSummary=void 0;(function(O){O[O.All=0]="All";O[O.Some=1]="Some";O[O.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));m=function(O){function J(){var G=M.apply(this,arguments);G.texture=null;G.transparent=a.ComponentParameterSummary.None;G.opaqueOverride=a.ComponentParameterSummary.None;G.castShadows=a.ComponentParameterSummary.None;return G}b._inherits(J,O);var M=b._createSuper(J);b._createClass(J,[{key:"type",get:function(){return h.ComponentDataType.Varying}}]);
return J}(y.MaterialParameterBlock);c.__decorate([y.parameter()],m.prototype,"texture",void 0);c.__decorate([y.parameter()],m.prototype,"transparent",void 0);c.__decorate([y.parameter()],m.prototype,"opaqueOverride",void 0);c.__decorate([y.parameter()],m.prototype,"castShadows",void 0);a.CommonMaterialParameters=L;a.ComponentMaterial=K;a.ComponentParametersUniform=R;a.ComponentParametersVarying=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){g=function(q){function y(){return B.apply(this,arguments)}c._inherits(y,q);var B=c._createSuper(y);q=y.prototype;q.initializeConfiguration=function(D,z){z.spherical=D.viewingMode===w.ViewingMode.Global;z.doublePrecisionRequiresObfuscation=D.rctx.driverTest.doublePrecisionRequiresObfuscation.result};q.initializeProgram=function(D){return new e.Program(D.rctx,y.shader.get().build(this.configuration),r)};q._setPipelineState=function(D){const z=this.configuration,
v=z.integratedMeshMode!==n.IntegratedMeshMode.None,A=D===u.TransparencyPassType.NONE,t=D===u.TransparencyPassType.FrontFace;return h.makePipelineState({blending:z.output!==m.ShaderOutput.Color&&z.output!==m.ShaderOutput.Alpha||!z.blendingEnabled?null:A?d.blendingDefault:d.oitBlending(D),culling:h.cullingParams(z.cullFace),depthTest:{func:d.oitDepthTest(D)},depthWrite:A||t?h.defaultDepthWriteParams:null,colorWrite:h.defaultColorWriteParams,stencilWrite:v||z.hasOccludees?k.stencilWriteMaskOn:null,stencilTest:v?
k.replaceBitWhenDepthTestPasses(f.StencilBits.IntegratedMeshMaskExcluded):z.hasOccludees?k.stencilBaseAllZerosParams:null,polygonOffset:A||t?z.hasPolygonOffset?{factor:2,units:2}:null:d.OITPolygonOffset})};q.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return c._createClass(y)}(g.ShaderTechnique);g.shader=new l.ReloadableShaderModule(x.ComponentShader,()=>new Promise((q,y)=>a(["./shader/ComponentShader.glsl"],q,y)));const r=new Map([[p.VertexAttribute.POSITION,
0],[p.VertexAttribute.NORMAL,1],[p.VertexAttribute.NORMALCOMPRESSED,1],[p.VertexAttribute.COLOR,2],[p.VertexAttribute.UV0,3],[p.VertexAttribute.UVREGION,4],[p.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=g;b.attributeLocations=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){a.IntegratedMeshMode=void 0;(function(r){r[r.None=0]="None";r[r.NoOverlay=1]="NoOverlay";r[r.ColorOverlay=2]="ColorOverlay";r[r.ColorOverlayWithWater=3]="ColorOverlayWithWater";r[r.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));let h=function(r){function q(){var B=y.apply(this,arguments);B.output=x.ShaderOutput.Color;B.textureCoordinateType=l.TextureCoordinateAttributeType.None;B.componentData=w.ComponentDataType.Uniform;B.cullFace=u.CullFaceOptions.Back;
B.vertexDiscardMode=n.VertexDiscardMode.None;B.doubleSidedMode=g.NormalsDoubleSidedMode.WindingOrder;B.alphaDiscardMode=u.AlphaDiscardMode.Opaque;B.integratedMeshMode=a.IntegratedMeshMode.None;B.transparencyPassType=p.TransparencyPassType.NONE;B.ellipsoidMode=d.EllipsoidMode.Earth;B.pbrMode=f.PBRMode.Disabled;B.normalType=m.NormalAttributeType.Attribute;B.spherical=!1;B.doublePrecisionRequiresObfuscation=!1;B.hasVertexColors=!1;B.hasNormals=!1;B.hasSlicePlane=!1;B.hasBaseColorTexture=!1;B.receiveAmbientOcclusion=
!0;B.receiveShadows=!0;B.blendingEnabled=!0;B.hasScreenSpaceReflections=!1;B.hasPolygonOffset=!1;B.hasMetallicRoughnessTexture=!1;B.hasEmissionTexture=!1;B.hasOcclusionTexture=!1;B.hasNormalTexture=!1;B.hasOccludees=!1;B.hasMultipassTerrain=!1;B.cullAboveGround=!1;B.hasCloudsReflections=!0;B.snowCover=!1;B.objectAndLayerIdColor=!1;return B}b._inherits(q,r);var y=b._createSuper(q);return b._createClass(q)}(k.ShaderTechniqueConfiguration);c.__decorate([k.parameter({count:x.ShaderOutput.COUNT})],h.prototype,
"output",void 0);c.__decorate([k.parameter({count:l.TextureCoordinateAttributeType.COUNT})],h.prototype,"textureCoordinateType",void 0);c.__decorate([k.parameter({count:w.ComponentDataType.COUNT})],h.prototype,"componentData",void 0);c.__decorate([k.parameter({count:u.CullFaceOptions.COUNT})],h.prototype,"cullFace",void 0);c.__decorate([k.parameter({count:n.VertexDiscardMode.COUNT})],h.prototype,"vertexDiscardMode",void 0);c.__decorate([k.parameter({count:g.NormalsDoubleSidedMode.COUNT})],h.prototype,
"doubleSidedMode",void 0);c.__decorate([k.parameter({count:u.AlphaDiscardMode.COUNT})],h.prototype,"alphaDiscardMode",void 0);c.__decorate([k.parameter({count:a.IntegratedMeshMode.COUNT})],h.prototype,"integratedMeshMode",void 0);c.__decorate([k.parameter({count:p.TransparencyPassType.COUNT})],h.prototype,"transparencyPassType",void 0);c.__decorate([k.parameter({count:d.EllipsoidMode.COUNT})],h.prototype,"ellipsoidMode",void 0);c.__decorate([k.parameter({count:f.PBRMode.COUNT})],h.prototype,"pbrMode",
void 0);c.__decorate([k.parameter({count:m.NormalAttributeType.COUNT})],h.prototype,"normalType",void 0);c.__decorate([k.parameter()],h.prototype,"spherical",void 0);c.__decorate([k.parameter()],h.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([k.parameter()],h.prototype,"hasVertexColors",void 0);c.__decorate([k.parameter()],h.prototype,"hasNormals",void 0);c.__decorate([k.parameter()],h.prototype,"hasSlicePlane",void 0);c.__decorate([k.parameter()],h.prototype,"hasBaseColorTexture",
void 0);c.__decorate([k.parameter()],h.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([k.parameter()],h.prototype,"receiveShadows",void 0);c.__decorate([k.parameter()],h.prototype,"blendingEnabled",void 0);c.__decorate([k.parameter()],h.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([k.parameter()],h.prototype,"hasPolygonOffset",void 0);c.__decorate([k.parameter()],h.prototype,"hasMetallicRoughnessTexture",void 0);c.__decorate([k.parameter()],h.prototype,"hasEmissionTexture",
void 0);c.__decorate([k.parameter()],h.prototype,"hasOcclusionTexture",void 0);c.__decorate([k.parameter()],h.prototype,"hasNormalTexture",void 0);c.__decorate([k.parameter()],h.prototype,"hasOccludees",void 0);c.__decorate([k.parameter()],h.prototype,"hasMultipassTerrain",void 0);c.__decorate([k.parameter()],h.prototype,"cullAboveGround",void 0);c.__decorate([k.parameter()],h.prototype,"hasCloudsReflections",void 0);c.__decorate([k.parameter()],h.prototype,"snowCover",void 0);c.__decorate([k.parameter()],
h.prototype,"objectAndLayerIdColor",void 0);c.__decorate([k.parameter({constValue:e.BindType.Draw})],h.prototype,"pbrTextureBindType",void 0);c.__decorate([k.parameter({constValue:!0})],h.prototype,"hasSliceHighlight",void 0);c.__decorate([k.parameter({constValue:!1})],h.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([k.parameter({constValue:!1})],h.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([k.parameter({constValue:!1})],h.prototype,"hasVertexTangents",void 0);c.__decorate([k.parameter({constValue:!0})],
h.prototype,"supportsTextureAtlas",void 0);c.__decorate([k.parameter({constValue:!1})],h.prototype,"highStepCount",void 0);c.__decorate([k.parameter({constValue:!1})],h.prototype,"instancedDoublePrecision",void 0);c.__decorate([k.parameter({constValue:!0})],h.prototype,"useFillLights",void 0);c.__decorate([k.parameter({constValue:!1})],h.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(h,r){const {vertex:q,fragment:y}=h;q.include(m.RgbaFloatEncoding);q.uniforms.add(new d.Texture2DDrawUniform("componentColorTex",B=>B.componentParameters.texture.texture));h.attributes.add(e.VertexAttribute.COMPONENTINDEX,"float");h.varyings.add("vExternalColorMixMode","mediump float");h.varyings.add("vExternalColor","vec4");(r=r.output===x.ShaderOutput.ObjectAndLayerIdColor)&&h.varyings.add("vObjectAndLayerIdColor","vec4");h.include(n.DecodeSymbolColor);
q.constants.add("elevationScale","float",2*p);q.constants.add("stride","float",w("enable-feature:objectAndLayerId-rendering")?3:2);q.code.add(f.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);q.code.add(f.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${r?f.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:f.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);y.code.add(f.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${r?f.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function u(h){const {vertex:r,fragment:q}=h;r.uniforms.add(new l.Float4DrawUniform("externalColor",y=>y.componentParameters.externalColor));q.uniforms.add(new g.IntegerDrawUniform("externalColorMixMode",y=>y.componentParameters.externalColorMixMode));h.varyings.add("vExternalColor","vec4");r.code.add(f.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);q.code.add(f.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}a.ComponentDataType=void 0;(function(h){h[h.Uniform=0]="Uniform";h[h.Varying=1]="Varying";h[h.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const p=2**32/1E4;a.ComponentData=function(h,r){switch(r.componentData){case a.ComponentDataType.Varying:return k(h,r);case a.ComponentDataType.Uniform:return u(h);case a.ComponentDataType.COUNT:break;default:b.neverReached(r.componentData)}};a.MAX_ELEVATION_OFFSET=p;a.encodeElevationOffset=function(h,r){c.packFloatRGBA(h/p*.5+.5,r)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,w){c=function(n){function x(l,g){return m.call(this,l,"int",w.BindType.Draw,(f,d,e)=>f.setUniform1i(l,g(d,e)))}b._inherits(x,n);var m=b._createSuper(x);return b._createClass(x)}(c.Uniform);a.IntegerDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,w){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(w.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports",
"../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?a.EllipsoidMode.Mars:c&&b.isMoon(c)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/interfaces ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O){function J(P){const U=new L.ShaderBuilder;U.include(u.VertexPosition,P);U.include(k.VertexNormal,P);U.include(e.VertexColor,P);U.include(d.TextureCoordinateAttribute,P);U.include(m.ForwardLinearDepth,P);U.include(n.ComponentData,P);U.include(H.DiscardOrAdjustAlphaDraw,P);U.include(g.SlicePass,P);U.include(t.ReadBaseColorTexture,P);U.include(x.VertexDiscardByOpacity,P);const {vertex:N,fragment:S}=U;if(P.pbrMode===A.PBRMode.Normal||
P.pbrMode===A.PBRMode.Schematic)U.include(A.PhysicallyBasedRenderingParameters,P),P.hasNormalTexture&&U.include(y.ComputeNormalTexture,P);const Q=P.output===l.ShaderOutput.Shadow||P.output===l.ShaderOutput.ShadowHighlight||P.output===l.ShaderOutput.ShadowExcludeHighlight;Q&&P.componentData===n.ComponentDataType.Varying?N.code.add(I.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):N.code.add(I.glsl`#define discardShadows(castShadows) {}`);
const W=P.integratedMeshMode===w.IntegratedMeshMode.ColorOverlay||P.integratedMeshMode===w.IntegratedMeshMode.ColorOverlayWithWater,V=W&&P.output===l.ShaderOutput.Color&&P.pbrMode===A.PBRMode.WaterOnIntegratedMesh;W&&(U.include(D.EvaluateSceneLighting,P),U.include(E.OverlayIM,P),P.spherical?N.code.add(I.glsl`
      const float invEllipsoidRadius = ${I.glsl.float(1/(P.ellipsoidMode===K.EllipsoidMode.Earth?b.earth.radius:P.ellipsoidMode===K.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):N.code.add(I.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));V&&(U.varyings.add("tbnTangent","vec3"),U.varyings.add("tbnBiTangent","vec3"),U.varyings.add("groundNormal","vec3"));N.code.add(I.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${P.output===l.ShaderOutput.ObjectAndLayerIdColor?I.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${I.glsl.float(F.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${P.output===l.ShaderOutput.ObjectAndLayerIdColor?I.glsl`forwardObjectAndLayerIdColor();`:""}
      ${V?P.spherical?I.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:I.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${W?I.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);P.output===l.ShaderOutput.Alpha&&(S.include(r.ReadLinearDepth),U.include(v.multipassTerrainTest,P),U.include(q.ComputeMaterialColor,P),W&&S.uniforms.add(new R.Texture2DPassUniform("ovColorTex",(T,X)=>E.getColorTexture(T,X))),S.code.add(I.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${P.hasMultipassTerrain?I.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${W?I.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `));P.output===l.ShaderOutput.Color&&(S.include(r.ReadLinearDepth),U.include(v.multipassTerrainTest,P),U.include(q.ComputeMaterialColor,P),U.include(B.ComputeShadingNormal,P),U.include(D.EvaluateSceneLighting,P),P.receiveShadows?(U.include(C.ReadShadowMapPass,P),S.code.add(I.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):S.code.add(I.glsl`float evaluateShadow() { return 0.0; }`),W&&S.uniforms.add(new R.Texture2DPassUniform("ovColorTex",(T,X)=>E.getColorTexture(T,X))),S.code.add(I.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${P.hasMultipassTerrain?I.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${W?I.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),P.pbrMode===A.PBRMode.Normal||P.pbrMode===A.PBRMode.Schematic?(z.addMainLightIntensity(S),S.code.add(I.glsl`
        ${P.pbrMode===A.PBRMode.Normal?I.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),P.hasNormalTexture?S.code.add(I.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):S.code.add(I.glsl`vec3 shadingNormal = normalVertex;`),S.code.add(I.glsl`${P.spherical?I.glsl`vec3 normalGround = normalize(positionWorld());`:I.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),S.code.add(I.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${P.snowCover?I.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${W?I.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(P.receiveShadows?S.code.add(I.glsl`float shadow = evaluateShadow();`):P.spherical?(D.addLightingGlobalFactor(S),S.code.add(I.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):S.code.add(I.glsl`float shadow = 0.0;`),V&&S.uniforms.add(new R.Texture2DPassUniform("ovNormalTex",(T,X)=>M(X))),P.snowCover&&S.code.add(I.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),S.code.add(I.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${W?I.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${V?I.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),S.code.add(I.glsl`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${P.transparencyPassType===O.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `));if(P.output===l.ShaderOutput.Depth||Q)U.include(p.OutputDepth,P),S.code.add(I.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);P.output===l.ShaderOutput.Normal&&(U.include(B.ComputeShadingNormal,P),S.code.add(I.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${P.normalType===f.NormalAttributeType.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));P.output===l.ShaderOutput.ObjectAndLayerIdColor&&U.fragment.code.add(I.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${W?I.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);P.output===l.ShaderOutput.Highlight&&(U.include(h.OutputHighlight,P),S.code.add(I.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${W?I.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return U}function M(P){return 0===P.overlays.length?null:P.overlays[c.OverlayIndex.INNER].getValidTexture(c.RenderTargetType.Water)}const G=Object.freeze(Object.defineProperty({__proto__:null,build:J,getOverlayNormalTexture:M},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=G;a.build=J;a.getOverlayNormalTexture=M})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,w,n,x){a.ComputeMaterialColor=function(m,l){m.include(b.VertexColor,l);m.fragment.include(c.MixExternalColor);m=m.fragment;m.uniforms.add(new w.Float4DrawUniform("baseColor",g=>g.baseColor));m.uniforms.add(new n.FloatDrawUniform("objectOpacity",g=>g.objectOpacity));l.hasVertexColors?m.code.add(x.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):m.code.add(x.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);m.code.add(x.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,w,n,x,m){a.ComputeShadingNormal=function(l,g){const f=l.fragment;switch(g.doubleSidedMode){case x.NormalsDoubleSidedMode.None:f.code.add(m.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case x.NormalsDoubleSidedMode.View:l.include(n.VertexPosition,g);f.code.add(m.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case x.NormalsDoubleSidedMode.WindingOrder:f.code.add(m.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(g.doubleSidedMode);case x.NormalsDoubleSidedMode.COUNT:}switch(g.normalType){case c.NormalAttributeType.Attribute:case c.NormalAttributeType.CompressedAttribute:l.include(w.VertexNormal,g);f.code.add(m.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case c.NormalAttributeType.ScreenDerivative:l.include(n.VertexPosition,g);f.code.add(m.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case c.NormalAttributeType.Ground:g.spherical?(l.include(n.VertexPosition,g),f.code.add(m.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):f.code.add(m.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);f.code.add(m.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(g.normalType);case c.NormalAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,c,w,n,x,m,l){a.ReadBaseColorTexture=function(g,f){const d=g.fragment;!f.hasBaseColorTexture||f.output!==b.ShaderOutput.Color&&f.alphaDiscardMode===l.AlphaDiscardMode.Opaque?d.code.add(x.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`):(g.include(w.VertexTextureCoordinates,f),f=f.textureCoordinateType===c.TextureCoordinateAttributeType.Atlas,d.uniforms.add(new m.Texture2DDrawUniform("baseColorTexture",e=>e.texture)),f?(g.include(n.TextureAtlasLookup),d.code.add(x.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):d.code.add(x.glsl`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(n){function x(){var l=m.apply(this,arguments);l._dirty=!0;return l}b._inherits(x,n);var m=b._createSuper(x);n=x.prototype;n._setDirty=function(){this._dirty=!0};n._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const l of this._parameterBlocks)this[l]._setClean()};
n._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const l of this._parameterBlocks)if(this[l].dirty)return!0;return!1};b._createClass(x,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return x}(c.NoParameters);let w=function(){function n(){this._dirty=!0}var x=n.prototype;x._setDirty=function(){this._dirty=!0};x._setClean=function(){this._dirty=!1};b._createClass(n,[{key:"dirty",get:function(){return this._dirty}}]);return n}();
a.MaterialBase=c;a.MaterialParameterBlock=w;a.parameter=function(n={}){return(x,m)=>{const l=x._parameterCount??0;x._parameterCount=l+1;if(n.vectorOps){const g=n.vectorOps;Object.defineProperty(x,m,{get(){return this[l]},set(f){const d=this[l];if(null==d)this[l]=f;else{if(g.equals(d,f))return;g.copy(d,f)}this._setDirty()}})}else Object.defineProperty(x,m,{get(){return this[l]},set(g){this[l]!==g&&(n.dispose&&this[l]&&this[l].dispose(),this[l]=g,this._setDirty())}})}};a.parameterBlock=function(){return(n,
x)=>{const m=n._parameterCount??0;n._parameterCount=m+1;n._parameterBlocks=n._parameterBlocks||[];n._parameterBlocks.push(m);Object.defineProperty(n,x,{get(){return this[m]},set(l){this[m]!==l&&(this[m]=l,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],
function(a,b,c,w,n){let x=function(){function l(f){this._low=w.create();this._high=w.create();f&&this.set(f)}var g=l.prototype;g.set=function(f){const d=this._low,e=this._high;c.copy(d,f);c.sub(e,f,d)};g.setElements=function(f,d,e){c.set(m,f,d,e);this.set(m)};g.get=function(f){return c.add(f,this._low,this._high)};g.getLowScaled=function(f){return c.scale(f,this._low,1)};b._createClass(l,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return l}();const m=
n.create();a.TwoVectorPosition=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,w){const n=c.newLayout().vec3f(w.VertexAttribute.POSITION).u16(w.VertexAttribute.COMPONENTINDEX).u16(w.VertexAttribute.U16PADDING),x=c.newLayout().vec2u8(w.VertexAttribute.SIDENESS);b=b.glLayout(x);c=
c.newLayout().vec3f(w.VertexAttribute.POSITION0).vec3f(w.VertexAttribute.POSITION1).u16(w.VertexAttribute.COMPONENTINDEX).u8(w.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(w.VertexAttribute.VARIANTSTROKE).u8(w.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(w.VertexAttribute.U8PADDING,{glPadding:!0}).u16(w.VertexAttribute.U16PADDING,{glPadding:!0});const m=c.clone().vec3f(w.VertexAttribute.NORMAL),l=c.clone().vec3f(w.VertexAttribute.NORMALA).vec3f(w.VertexAttribute.NORMALB);w=new Map([[w.VertexAttribute.POSITION0,
0],[w.VertexAttribute.POSITION1,1],[w.VertexAttribute.COMPONENTINDEX,2],[w.VertexAttribute.VARIANTOFFSET,3],[w.VertexAttribute.VARIANTSTROKE,4],[w.VertexAttribute.VARIANTEXTENSION,5],[w.VertexAttribute.NORMAL,6],[w.VertexAttribute.NORMALA,6],[w.VertexAttribute.NORMALB,7],[w.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=n;a.EdgeShaderAttributeLocations=w;a.RegularEdgeInstancesLayout=m;a.SilhouetteEdgeInstancesLayout=l;a.VertexLayout=x;a.glVertexLayout=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(a,b,c,w,n,x,m,l,g){function f(u,p,h,r){if(p)return p=w.computeNeighbors(h,r,u.count),new d(h,r,p,u);
u=c.deduplicate(u.buffer,u.stride/4,{originalIndices:h,originalIndicesLength:r});r=w.computeNeighbors(u.indices,r,u.uniqueCount);return{faces:u.indices,facesLength:u.indices.length,neighbors:r,vertices:m.EdgeInputBufferLayout.createView(u.buffer)}}let d=b._createClass(function(u,p,h,r){this.faces=u;this.facesLength=p;this.neighbors=h;this.vertices=r});const e=new l.RegularEdgeBufferWriter,k=new l.SilhouetteEdgeBufferWriter;b=n.newLayout().vec3f(x.VertexAttribute.POSITION0).vec3f(x.VertexAttribute.POSITION1);
n=n.newLayout().vec3f(x.VertexAttribute.POSITION0).vec3f(x.VertexAttribute.POSITION1).u16(x.VertexAttribute.COMPONENTINDEX).u16(x.VertexAttribute.U16PADDING,{glPadding:!0});a.extract=function(u){const p=f(u.data,u.skipDeduplicate,u.indices,u.indicesLength);e.updateSettings(u.writerSettings);k.updateSettings(u.writerSettings);return g.extractEdges(p,e,k)};a.extractComponentsEdgeLocationsLayout=n;a.extractEdgeInformation=f;a.extractEdgeLocationsLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,c,w){c/=3;const n=new Uint32Array(w+1),x=new Uint32Array(w+1);var m=(h,r)=>{h<r?n[h+1]++:x[r+1]++};for(var l=0;l<c;l++){var g=b[3*l],f=b[3*l+1],d=b[3*l+2];m(g,f);m(f,d);m(d,g)}l=m=0;for(g=0;g<w;g++)f=n[g+1],d=x[g+1],n[g+1]=m,x[g+1]=l,m+=f,l+=d;const e=new Uint32Array(6*c),k=n[w];m=(h,r,q)=>{h<r?(h=n[h+1]++,e[2*h]=r,e[2*h+1]=q):(r=x[r+1]++,e[2*k+2*r]=h,e[2*k+2*r+1]=q)};for(l=0;l<c;l++)g=b[3*
l],f=b[3*l+1],d=b[3*l+2],m(g,f,l),m(f,d,l),m(d,g,l);m=(h,r)=>{const q=2*h;h=r-h;for(r=1;r<h;r++){const y=e[q+2*r],B=e[q+2*r+1];let D=r-1;for(D;0<=D&&e[q+2*D]>y;D--)e[q+2*D+2]=e[q+2*D],e[q+2*D+3]=e[q+2*D+1];e[q+2*D+2]=y;e[q+2*D+3]=B}};for(l=0;l<w;l++)m(n[l],n[l+1]),m(k+x[l],k+x[l+1]);const u=new Int32Array(3*c),p=(h,r)=>h===b[3*r]?0:h===b[3*r+1]?1:h===b[3*r+2]?2:-1;c=(h,r)=>{h=p(h,r);u[3*r+h]=-1};m=(h,r,q,y)=>{h=p(h,r);u[3*r+h]=y;q=p(q,y);u[3*y+q]=r};for(l=0;l<w;l++){g=n[l];f=n[l+1];d=x[l];const h=
x[l+1];for(;g<f&&d<h;){const r=e[2*g],q=e[2*k+2*d];r===q?(m(l,e[2*g+1],q,e[2*k+2*d+1]),g++,d++):r<q?(c(l,e[2*g+1]),g++):(c(q,e[2*k+2*d+1]),d++)}for(;g<f;)c(l,e[2*g+1]),g++;for(;d<h;)c(e[2*k+2*d],e[2*k+2*d+1]),d++}return u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(a,b,c,w,n,x,m){function l(y){const B=e;B[0]=y.position0[0];B[1]=y.position0[1];B[2]=y.position0[2];B[3]=y.position1[0];B[4]=y.position1[1];B[5]=y.position1[2];u[0]=5381;for(y=0;y<k.length;y++)u[0]=31*u[0]+k[y];return u[0]}function g(y){const B=e;B[0]=f(y.position0[0]);B[1]=f(y.position0[1]);B[2]=f(y.position0[2]);B[3]=f(y.position1[0]);B[4]=f(y.position1[1]);B[5]=f(y.position1[2]);u[0]=5381;for(y=0;y<k.length;y++)u[0]=31*u[0]+k[y];return u[0]}function f(y){return Math.round(1E4*y)/1E4}let d=
function(){function y(){}var B=y.prototype;B.updateSettings=function(D){this.settings=D;this._edgeHashFunction=D.reducedPrecision?g:l};B.write=function(D,z,v){var A=this._edgeHashFunction(v);q.seed=A;A=q.getIntRange(0,255);const t=q.getIntRange(0,this.settings.variants-1);var C=q.getFloat();C=-(1-Math.min(C/.7,1))+Math.max(0,C-.7)/(1-.7);C=255*(Math.abs(C)**1.2*(0>C?-1:1)*.5+.5);D.position0.setVec(z,v.position0);D.position1.setVec(z,v.position1);D.componentIndex.set(z,v.componentIndex);D.variantOffset.set(z,
A);D.variantStroke.set(z,t);D.variantExtension.set(z,C)};B.trim=function(D,z){return D.slice(0,z)};return b._createClass(y)}();const e=new Float32Array(6),k=new Uint32Array(e.buffer),u=new Uint32Array(1);let p=function(){function y(){this._commonWriter=new d}var B=y.prototype;B.updateSettings=function(D){this._commonWriter.updateSettings(D)};B.allocate=function(D){return m.RegularEdgeInstancesLayout.createBuffer(D)};B.write=function(D,z,v){this._commonWriter.write(D,z,v);w.add(r,v.faceNormal0,v.faceNormal1);
w.normalize(r,r);D.normal.setVec(z,r)};B.trim=function(D,z){return this._commonWriter.trim(D,z)};return b._createClass(y)}();p.Layout=m.RegularEdgeInstancesLayout;p.glLayout=x.glLayout(m.RegularEdgeInstancesLayout,1);let h=function(){function y(){this._commonWriter=new d}var B=y.prototype;B.updateSettings=function(D){this._commonWriter.updateSettings(D)};B.allocate=function(D){return m.SilhouetteEdgeInstancesLayout.createBuffer(D)};B.write=function(D,z,v){this._commonWriter.write(D,z,v);D.normalA.setVec(z,
v.faceNormal0);D.normalB.setVec(z,v.faceNormal1)};B.trim=function(D,z){return this._commonWriter.trim(D,z)};return b._createClass(y)}();h.Layout=m.SilhouetteEdgeInstancesLayout;h.glLayout=x.glLayout(m.SilhouetteEdgeInstancesLayout,1);const r=n.create(),q=new c;a.CommonBufferWriter=d;a.RegularEdgeBufferWriter=p;a.SilhouetteEdgeBufferWriter=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports",
"../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],function(a,b,c,w,n){function x(e,k){const u=c.acosClamped(e.cosAngle),p=g.fwd,h=g.ortho;w.direction(p,e.position1,e.position0);e=0<w.dot(w.cross(h,e.faceNormal0,e.faceNormal1),p)?-1:1;return u*e>k}function m(e){const k=e.faces.length/3,u=e.faces;e=e.neighbors;var p=0;for(var h=0;h<k;h++){var r=e[3*h+1],q=e[3*h+2],y=u[3*h],B=u[3*h+1],D=u[3*h+2];p+=-1===e[3*h]||y<B?1:0;p+=-1===
r||B<D?1:0;p+=-1===q||D<y?1:0}p=new Int32Array(4*p);h=0;for(r=0;r<k;r++){q=e[3*r];y=e[3*r+1];B=e[3*r+2];D=u[3*r];const z=u[3*r+1],v=u[3*r+2];if(-1===q||D<z)p[h++]=D,p[h++]=z,p[h++]=r,p[h++]=q;if(-1===y||z<v)p[h++]=z,p[h++]=v,p[h++]=r,p[h++]=y;if(-1===B||v<D)p[h++]=v,p[h++]=D,p[h++]=r,p[h++]=B}return p}function l(e){const k=e.faces.length/3,u=e.vertices.position;e=e.faces;const p=f.v0,h=f.v1,r=f.v2,q=new Float32Array(3*k);for(let y=0;y<k;y++){const B=e[3*y+1],D=e[3*y+2];u.getVec(e[3*y],p);u.getVec(B,
h);u.getVec(D,r);w.subtract(h,h,p);w.subtract(r,r,p);w.cross(p,h,r);w.normalize(p,p);q[3*y]=p[0];q[3*y+1]=p[1];q[3*y+2]=p[2]}return q}a.EdgeType=void 0;(function(e){e[e.SOLID=0]="SOLID";e[e.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const g={edge:{position0:n.create(),position1:n.create(),faceNormal0:n.create(),faceNormal1:n.create(),componentIndex:0,cosAngle:0},ortho:n.create(),fwd:n.create()},f={v0:n.create(),v1:n.create(),v2:n.create()},d={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=
function(e,k,u,p=d){const h=e.vertices.position;var r=e.vertices.componentIndex,q=c.deg2rad(p.anglePlanar);p=c.deg2rad(p.angleSignificantEdge);const y=Math.cos(p),B=Math.cos(q),D=g.edge,z=D.position0,v=D.position1,A=D.faceNormal0,t=D.faceNormal1,C=l(e),E=m(e),F=E.length/4;e=k.allocate(F);p=0;const H=u.allocate(F);let K=0,I=0,L=0;const R=b.range(0,F),O=new Float32Array(F);O.forEach((P,U,N)=>{h.getVec(E[4*U],z);h.getVec(E[4*U+1],v);N[U]=w.distance(z,v)});R.sort((P,U)=>O[U]-O[P]);const J=[],M=[];for(let P=
0;P<F;P++){var G=R[P];const U=O[G],N=E[4*G],S=E[4*G+1],Q=E[4*G+2];G=E[4*G+3];const W=-1===G;h.getVec(N,z);h.getVec(S,v);if(W)w.set(A,C[3*Q],C[3*Q+1],C[3*Q+2]),w.copy(t,A),D.componentIndex=r.get(N),D.cosAngle=w.dot(A,t);else{w.set(A,C[3*Q],C[3*Q+1],C[3*Q+2]);w.set(t,C[3*G],C[3*G+1],C[3*G+2]);D.componentIndex=r.get(N);D.cosAngle=w.dot(A,t);if(D.cosAngle>B)continue;-.9999>D.cosAngle&&w.copy(t,A)}I+=U;L++;W||D.cosAngle<y?(k.write(e,p++,D),J.push(U)):x(D,q)&&(u.write(H,K++,D),M.push(U))}r=new Float32Array(J.reverse());
q=new Float32Array(M.reverse());return{regular:{instancesData:k.trim(e,p),lodInfo:{lengths:r}},silhouette:{instancesData:u.trim(H,K),lodInfo:{lengths:q}},averageEdgeLength:I/L}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./ManagedTextureBackedBuffer"],function(a,b,c){let w=function(){function n(m,l=1){this._rctx=m;this._fieldCount=
l;this._buffers=[]}var x=n.prototype;x.garbageCollect=function(){this._buffers=this._buffers.filter(m=>0===m.activeCount?(m.dispose(),!1):!0)};x.destroy=function(){this._buffers.forEach(m=>m.dispose());this._buffers=[]};x.getBuffer=function(m){for(const l of this._buffers)if(l.availableCount>=m)return l;if(m>c.MAX_INDEX_COUNT)return null;m=new c.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(m);return m};x.updateTextures=function(){for(const m of this._buffers)m.textureBuffer.updateTexture()};
return b._createClass(n)}();a.BufferManager=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,w){let n=function(){function x(l,g=1){this.textureBuffer=new w.TextureBackedBuffer(l,g);this._indexManager=new c.SimpleIndexManager(65536)}var m=x.prototype;m.dispose=function(){this.textureBuffer.dispose();
this.textureBuffer=void 0};m.acquireIndex=function(){const l=this._indexManager.acquire();this.textureBuffer.resizeToFit(l);return l};m.releaseIndex=function(l){this._indexManager.release(l)};b._createClass(x,[{key:"availableCount",get:function(){return this._indexManager.availableCount}},{key:"activeCount",get:function(){return this._indexManager.activeCount}}]);return x}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._maxCount=x;this._nextIndex=0;this._recycledIndices=[]}var n=w.prototype;n.acquire=function(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++};n.release=function(x){this._recycledIndices.push(x)};b._createClass(w,[{key:"activeCount",get:function(){return this._nextIndex-this._recycledIndices.length}},{key:"availableCount",get:function(){return this._recycledIndices.length+
this._maxCount-this._nextIndex}}]);return w}();a.SimpleIndexManager=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,b,c,w,n){let x=function(){function m(g,f=1){this._rctx=g;this._fieldCount=f;this.textureWidth=4096;
this._dirty=!0;this._texture=new n.Texture(this._rctx,{target:w.TextureType.TEXTURE_2D,pixelFormat:w.PixelFormat.RGBA,dataType:w.PixelType.UNSIGNED_BYTE,samplingMode:w.TextureSamplingMode.NEAREST,wrapMode:w.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this._data=new c.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var l=m.prototype;l.dispose=function(){this._texture.dispose();this._data=this._texture=void 0};l.setData=function(g,f,d,e,k,u){g=g*this._fieldCount+
f;this._dirty=!0;this._data.set(g,0,d);this._data.set(g,1,e);this._data.set(g,2,k);this._data.set(g,3,u)};l.setDataElement=function(g,f,d,e){g=g*this._fieldCount+f;this._dirty=!0;this._data.set(g,d,e)};l.getDataElement=function(g,f,d){g=g*this._fieldCount+f;this._dirty=!0;return this._data.get(g,d)};l.resizeToFit=function(g){g=(g+1)*this._fieldCount;g>this._data.count&&(g=new c.BufferViewVec4u8(new ArrayBuffer(Math.ceil(g/this.textureWidth)*this.textureWidth*4)),g.typedBuffer.set(this._data.typedBuffer),
this._data=g)};l.updateTexture=function(){if(this._dirty){var g=this._texture.descriptor.width;this._data.count>g*this._texture.descriptor.height&&this._texture.resize(g,this._data.count/g);this._texture.setData(this._data.typedBuffer);this._dirty=!1}};b._createClass(m,[{key:"texture",get:function(){return this._texture}}]);return m}();a.TextureBackedBuffer=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique ../../../../chunks/OverlayCompositing.glsl ../shaders/OverlayCompositingTechnique ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){return function(){function p(r,q){this._rctx=r;this._techniqueRepository=q;this._configuration=new x.CompositingTechniqueConfiguration;this._passParameters=new w.CompositingPassParameters;this._oitParameters=new g.OITCompositingPassParameters;this._hudParameters=new m.HUDCompositingPassParameters;this._overlayParameters=new d.OverlayCompositingPassParameters}var h=p.prototype;h.destroy=function(){this._vao=b.disposeMaybe(this._vao)};h.compositeOIT=function(r,
q,y,B){this._oitParameters.colorTexture=q;this._oitParameters.alphaTexture=y;this._oitParameters.frontFaceTexture=B;q=this._rctx;y=this._techniqueRepository.acquire(f.OITCompositingTechnique);q.bindTechnique(y,this._oitParameters,r);r=this._ensureVAO();q.bindVAO(r);q.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(r,"geometry"));y.release()};h.compositeHUD=function(r,q){this._hudParameters.texture=q;q=this._rctx;const y=this._techniqueRepository.acquire(l.HUDCompositingTechnique);q.bindTechnique(y,
this._hudParameters,r);r=this._ensureVAO();q.bindVAO(r);q.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(r,"geometry"));y.release()};h.compositeOverlay=function(r,q,y,B){this._overlayParameters.texture=q;this._overlayParameters.opacity=y;this._overlayParameters.overlayIndex=B;q=this._rctx;y=this._techniqueRepository.acquire(e.OverlayCompositingTechnique);q.bindTechnique(y,this._overlayParameters,r);r=this._ensureVAO();q.bindVAO(r);q.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(r,
"geometry"));y.release()};h.composite=function(r,q,y=x.AlphaMode.None,B=1){const D=this._rctx;this._configuration.alphaMode=y;this._configuration.hasOpacityFactor=1!==B;this._passParameters.texture=q;this._passParameters.opacity=B;q=this._techniqueRepository.acquire(n.CompositingTechnique,this._configuration);D.bindTechnique(q,this._passParameters,r);r=this._ensureVAO();D.bindVAO(r);D.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(r,"geometry"));q.release()};h._ensureVAO=function(){b.isNone(this._vao)&&
(this._vao=c.createQuadVAO(this._rctx));return this._vao};return a._createClass(p)}()})},"esri/chunks/Compositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,
b,c,w,n,x,m){function l(d){const e=new x.ShaderBuilder;e.include(c.ScreenSpacePass);e.fragment.uniforms.add(new m.Texture2DPassUniform("tex",k=>k.texture));d.hasOpacityFactor&&e.fragment.uniforms.add(new w.FloatPassUniform("opacity",k=>k.opacity));e.fragment.code.add(n.glsl`
    void main() {
      fragColor = texture(tex, uv) ${d.hasOpacityFactor?"* opacity":""};
    }`);return e}let g=function(d){function e(){var u=k.apply(this,arguments);u.opacity=1;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(n.NoParameters);const f=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:g,build:l},Symbol.toStringTag,{value:"Module"}));a.Compositing=f;a.CompositingPassParameters=g;a.build=l})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){n=function(e){function k(){return u.apply(this,arguments)}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new m.Program(p.rctx,k.shader.get().build(this.configuration),x.Default3D)};e.initializePipeline=function(){switch(this.configuration.alphaMode){case g.AlphaMode.None:return d.makePipelineState({colorWrite:d.defaultColorWriteParams});case g.AlphaMode.Alpha:return d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.SRC_ALPHA,
f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams});case g.AlphaMode.PremultipliedAlpha:case g.AlphaMode.COUNT:return d.makePipelineState({blending:d.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})}};return c._createClass(k)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.Compositing,()=>new Promise((e,k)=>a(["./Compositing.glsl"],e,k)));b.CompositingTechnique=
n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){a.AlphaMode=void 0;(function(x){x[x.None=0]="None";x[x.Alpha=1]="Alpha";x[x.PremultipliedAlpha=2]="PremultipliedAlpha";x[x.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));let n=function(x){function m(){var g=
l.apply(this,arguments);g.alphaMode=a.AlphaMode.None;g.hasOpacityFactor=!1;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter({count:a.AlphaMode.COUNT})],n.prototype,"alphaMode",void 0);c.__decorate([w.parameter()],n.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x){function m(){const f=new n.ShaderBuilder;f.include(c.ScreenSpacePass);f.fragment.uniforms.add(new x.Texture2DPassUniform("tex",d=>d.texture));f.fragment.code.add(w.glsl`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`);return f}let l=function(f){function d(){return e.apply(this,arguments)}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(w.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:l,build:m},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=g;a.HUDCompositingPassParameters=l;a.build=m})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.HUDCompositing,()=>new Promise((f,d)=>a(["./HUDCompositing.glsl"],f,d)));b.HUDCompositingTechnique=
n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,w,n,x){function m(){const f=new n.ShaderBuilder;f.include(c.ScreenSpacePass);
f.fragment.uniforms.add([new x.Texture2DPassUniform("colorTexture",d=>d.colorTexture),new x.Texture2DPassUniform("alphaTexture",d=>d.alphaTexture),new x.Texture2DPassUniform("frontFaceTexture",d=>d.frontFaceTexture)]);f.fragment.code.add(w.glsl`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return f}let l=function(f){function d(){return e.apply(this,arguments)}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(w.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:l,build:m},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=g;a.OITCompositingPassParameters=l;a.build=m})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f){n=function(d){function e(){return k.apply(this,arguments)}c._inherits(e,d);var k=c._createSuper(e);d=e.prototype;d.initializeProgram=function(u){return new m.Program(u.rctx,e.shader.get().build(),x.Default3D)};d.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(n.ShaderTechnique);
n.shader=new w.ReloadableShaderModule(l.OITCompositing,()=>new Promise((d,e)=>a(["./OITCompositing.glsl"],d,e)));b.OITCompositingTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OverlayCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(){const k=new l.ShaderBuilder;k.include(w.ScreenSpacePass);k.fragment.uniforms.add(new g.Texture2DPassUniform("tex",u=>u.texture));k.fragment.uniforms.add(new x.IntegerPassUniform("overlayIdx",u=>u.overlayIndex));k.fragment.uniforms.add(new n.FloatPassUniform("opacity",u=>u.opacity));k.fragment.code.add(m.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`);return k}let d=function(k){function u(){var h=p.apply(this,arguments);h.overlayIndex=c.OverlayIndex.INNER;h.opacity=1;return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(m.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:d,build:f},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=e;a.OverlayCompositingPassParameters=d;a.build=f})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f){n=function(d){function e(){return k.apply(this,arguments)}c._inherits(e,d);var k=c._createSuper(e);d=e.prototype;d.initializeProgram=function(u){return new m.Program(u.rctx,e.shader.get().build(),x.Default3D)};d.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.OverlayCompositing,
()=>new Promise((d,e)=>a(["./OverlayCompositing.glsl"],d,e)));b.OverlayCompositingTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(R,O){if(O.visible){var J=u.empty(),M=O.getSpatialQueryAccelerator();w.isSome(M)?q(J,R,M):y(J,R,O.objects);return J}}function q(R,O,J){var M=O.eye;const G=O.viewForward,P=O.frustum,U=S=>S.visible;var N=J.objectCount;500>N?(u.set(H,O.near,Math.min(R.near,O.far)),J.forEachInDepthRange(M,G,p.DepthOrder.FRONT_TO_BACK,H,(S,Q)=>{B(R,O,S);H.far=R.near;Q.setRange(H)},P,U),u.set(H,Math.max(R.far,O.near),O.far),J.forEachInDepthRange(M,G,p.DepthOrder.BACK_TO_FRONT,
H,(S,Q)=>{B(R,O,S);H.near=R.far;Q.setRange(H)},P,U)):(N=Math.max(Math.min(N,500),Math.ceil(.1*N)),M=J.findClosest(G,p.DepthOrder.FRONT_TO_BACK,P,U,N),J=J.findClosest(G,p.DepthOrder.BACK_TO_FRONT,P,U,N),M&&J&&(z(R,O,M.boundingVolumeWorldSpace.bounds),z(R,O,J.boundingVolumeWorldSpace.bounds)))}function y(R,O,J){K.clear();J.forAll(M=>{M.visible&&0!==M.geometries.length&&K.add(M)});K.empty||(K.sort(O),u.set(H,O.near,Math.min(R.near,O.far)),K.forEachInDepthRange(H,p.DepthOrder.FRONT_TO_BACK,(M,G)=>{G<
R.near&&B(R,O,M)}),u.set(H,Math.max(R.far,O.near),O.far),K.forEachInDepthRange(H,p.DepthOrder.BACK_TO_FRONT,(M,G,P)=>{R.far=Math.max(R.far,P)}))}function B(R,O,J){if(J.visible&&d.intersectsSphere(O.frustum,J.boundingVolumeWorldSpace.bounds)){var M=J.transformation,G=F;J.geometries.forEach(P=>{x.multiply(G,M,P.shaderTransformation);const U=k.maxScale(G);D(R,O,P.boundingInfo,G,U)})}}function D(R,O,J,M,G){if(!w.isNone(J)){l.transformMat4(E,J.center,M);var {eye:P,viewForward:U}=O,N=U[0]*(E[0]-P[0])+U[1]*
(E[1]-P[1])+U[2]*(E[2]-P[2]);E[3]=J.radius*G;if(!(N-E[3]>R.near&&N+E[3]<R.far)&&d.intersectsSphere(O.frustum,E))if(100<J.radius&&J.getChildren())for(const S of J.getChildren())D(R,O,S,M,G);else L.unionDepthRangeWithAABB(R,O.viewProjectionMatrix,M,J.bbMin,J.bbMax)}}function z(R,O,J){var M=O.eye;O=O.viewForward;M=(J[0]-M[0])*O[0]+(J[1]-M[1])*O[1]+(J[2]-M[2])*O[2];R.near=Math.min(R.near,M-J[3]);R.far=Math.max(R.far,M+J[3])}let v=function(){function R(){this._items=new n({allocator:J=>J||{obj:null,distance:0,
near:0,far:0},deallocator:J=>{J.obj=null;J.distance=0;J.near=0;J.far=0;return J}})}var O=R.prototype;O.clear=function(){this._items.clear()};O.add=function(J){this._items.pushNew().obj=J};O.sort=function(J){const M=J.eye,G=J.viewForward;this._items.forAll(P=>{const U=P.obj.boundingVolumeWorldSpace.bounds,N=(U[0]-M[0])*G[0]+(U[1]-M[1])*G[1]+(U[2]-M[2])*G[2];P.distance=N;P.near=N-U[3];P.far=N+U[3]});this._items.sort((P,U)=>P.distance-U.distance)};O.forEachInDepthRange=function(J,M,G){if(M===p.DepthOrder.FRONT_TO_BACK)for(M=
0;M<this._items.length;++M){var P=this._items.data[M];P.far<J.near||P.near>J.far||G(P.obj,P.near,P.far)}else for(M=this._items.length-1;0<=M;--M)P=this._items.data[M],P.far<J.near||P.near>J.far||G(P.obj,P.near,P.far)};b._createClass(R,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return R}(),A=function(){function R(){this._view=m.create();this._viewProj=m.create();this._frustum=d.create();this._geometries=[];this._near=[];this._far=
[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}var O=R.prototype;O.compute=function(J,M){this._reset();x.copy(this._view,J.viewMatrix);x.multiply(this._viewProj,J.projectionMatrix,this._view);d.copy(this._frustum,J.frustum);J=this._view;const G=J[2],P=J[6],U=J[10],N=J[14];M.forAll(W=>W.forEachGeometry(V=>{if(V.visible&&V.castShadow){var T=V.boundingSphere,X=G*T[0]+P*T[1]+U*T[2]+N,Z=X-T[3];T=X+T[3];this._geometries.push(V);this._near.push(-T);this._far.push(-Z)}}));
M=new u.DepthRange;if(0===this._geometries.length)return M;for(J=0;J<this._geometries.length;++J)this._near[J]>M.far&&(M.far=this._near[J]),2<this._near[J]&&this._far[J]<M.near&&(M.near=this._far[J]);J=this._looseRange;J.near=Math.max(.5*M.near,2);J.far=2*M.far;var S=0;let Q=0;for(let W=0;W<this._geometries.length;++W)this._near[W]<M.near&&(this._near[W]>=J.near?M.near=this._near[W]:this._nearCandidates[S++]=W),this._far[W]>M.far&&(this._far[W]<=J.far?M.far=this._far[W]:this._farCandidates[Q++]=W);
if(0===this._nearCandidates.length&&0===this._farCandidates.length)return M;this._nearCandidates.sort((W,V)=>this._near[W]<this._near[V]?-1:this._near[W]>this._near[V]?1:0);this._farCandidates.sort((W,V)=>this._far[W]<this._far[V]?1:this._far[W]>this._far[V]?-1:0);for(J=0;J<this._nearCandidates.length;++J)S=this._nearCandidates[J],this._near[S]<M.near&&(S=this._geometries[S],this._includeNearBoundingInfoRec(S.boundingInfo,S.shaderTransformation,M));for(J=0;J<this._farCandidates.length;++J)S=this._farCandidates[J],
this._far[S]>M.far&&(S=this._geometries[S],this._includeFarBoundingInfoRec(S.boundingInfo,S.shaderTransformation,M));this._reset();return M};O._reset=function(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0};O._includeNearBoundingInfoRec=function(J,M,G){if(!w.isNone(J)){l.transformMat4(E,J.center,M);var P=k.maxScale(M),U=E[0],N=E[1],S=E[2];P*=J.radius;var Q=this._frustum;if(!(Q[0][0]*U+Q[0][1]*N+Q[0][2]*S+Q[0][3]>P||Q[1][0]*
U+Q[1][1]*N+Q[1][2]*S+Q[1][3]>P||Q[2][0]*U+Q[2][1]*N+Q[2][2]*S+Q[2][3]>P||Q[3][0]*U+Q[3][1]*N+Q[3][2]*S+Q[3][3]>P||(U=this._view[2]*U+this._view[6]*N+this._view[10]*S+this._view[14],N=U+P,2>-(U-P)||-N>=G.near)))if(-N>this._looseRange.near)G.near=-N;else{if(100<P&&(P=J.getChildren(),void 0!==P)){for(const W of P)this._includeNearBoundingInfoRec(W,M,G);return}L.unionDepthRangeWithAABB(G,this._viewProj,M,J.bbMin,J.bbMax)}}};O._includeFarBoundingInfoRec=function(J,M,G){if(!w.isNone(J)){var P=J.radius;
l.transformMat4(E,J.center,M);var U=k.maxScale(M),N=E[0],S=E[1],Q=E[2];P*=U;U=this._frustum;if(!(U[0][0]*N+U[0][1]*S+U[0][2]*Q+U[0][3]>P||U[1][0]*N+U[1][1]*S+U[1][2]*Q+U[1][3]>P||U[2][0]*N+U[2][1]*S+U[2][2]*Q+U[2][3]>P||U[3][0]*N+U[3][1]*S+U[3][2]*Q+U[3][3]>P||(N=this._view[2]*N+this._view[6]*S+this._view[10]*Q+this._view[14]-P,-N<=G.far)))if(-N<this._looseRange.far)G.far=-N;else{if(100<P&&(P=J.getChildren(),void 0!==P)){for(const W of P)this._includeFarBoundingInfoRec(W,M,G);return}L.unionDepthRangeWithAABB(G,
this._viewProj,M,J.bbMin,J.bbMax)}}};return b._createClass(R)}(),t=function(){function R(){this._modelViewProj=m.create();this._clipPosition=[f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]}var O=R.prototype;O.unionDepthRangeWithAABB=function(J,M,G,P,U){var N=this._modelViewProj;x.multiply(N,M,G);M=!1;for(G=0;8>G;++G){const S=this._clipPosition[G],Q=0===G||3===G||4===G||7===G?P[0]:U[0],W=0===G||1===G||4===G||5===G?P[1]:U[1],V=4>G?P[2]:U[2];S[0]=N[0]*Q+N[4]*
W+N[8]*V+N[12];S[1]=N[1]*Q+N[5]*W+N[9]*V+N[13];S[2]=N[2]*Q+N[6]*W+N[10]*V+N[14];S[3]=N[3]*Q+N[7]*W+N[11]*V+N[15]}for(P=0;12>P;++P){U=this._clipTriangle(this._clipPosition[C[P][0]],this._clipPosition[C[P][1]],this._clipPosition[C[P][2]]);N=!0;for(G=0;G<U.length;++G)if(2<=U[G][3]){N=!1;break}if(!N)for(M=!0,N=0;N<U.length;++N)G=U[N][3],Number.isFinite(G)&&(J.near=Math.min(G,J.near),J.far=Math.max(G,J.far))}return M};O._inside=function(J,M){if(0===M)return J[0]>=-J[3];if(1===M)return J[1]>=-J[3];if(2===
M)return J[0]<=J[3];if(3===M)return J[1]<=J[3];h.assert(!1)};O._intersect=function(J,M,G){let P=0;0===G?P=(-J[3]-J[0])/(M[0]-J[0]+M[3]-J[3]):1===G?P=(-J[3]-J[1])/(M[1]-J[1]+M[3]-J[3]):2===G?P=(J[3]-J[0])/(M[0]-J[0]-M[3]+J[3]):3===G&&(P=(J[3]-J[1])/(M[1]-J[1]-M[3]+J[3]));return g.lerp(f.create(),J,M,P)};O._clipTriangle=function(J,M,G){J=[J,M,G];for(M=0;4>M;++M){G=J;J=[];for(let P=0;P<G.length;++P){const U=G[P],N=G[(P+1)%G.length];this._inside(N,M)?(this._inside(U,M)||J.push(this._intersect(U,N,M)),
J.push(N)):this._inside(U,M)&&J.push(this._intersect(U,N,M))}}return J};return b._createClass(R)}();const C=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],E=e.create(),F=m.create(),H=u.empty(),K=new v,I=new A,L=new t;a.DepthRangeFromRenderGeometries=A;a.depthRangeFromLayer=r;a.depthRangeFromScene=function(R,O,J){let M=0;if(!O.some(P=>{M+=P.numGeometries;return 1E4<=M}))return I.compute(R,O);const G=u.empty();J.forAll(P=>{P.visible&&u.union(G,r(R,
P))});return G};a.textureToDepth=function(R,O,J){return c.unpackFloatRGBA(O,R)*(J[1]-J[0])+J[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E){a.MagnifierHelper=function(F){function H(){var I=K.apply(this,arguments);I._handles=new m;I._magnifier=null;I._imageSources=null;I._imageLoadTask=null;I._resources=null;I._passParameters=new v.MagnifierPassParameters;I.events=new x;I.attributeLocations=new Map([[z.VertexAttribute.POSITION,0]]);I._tmpScreenPoint=d.createScreenPointArray();I._tmpRenderPoint=d.createRenderScreenPointArray();return I}b._inherits(H,F);var K=b._createSuper(H);
F=H.prototype;F.destroy=function(){this._magnifier=null;this._handles.destroy();g.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};F.render=function(I,L){const R=this._validMagnifier;if(!g.isNone(R)){var O=Math.ceil(L.camera.pixelRatio*R.size);this._updateResources(I,O);if(!g.isNone(this._resources)){var J=this._passParameters.textures;O=Math.ceil(1/this._factor*O);J.input.resize(O,O);d.screenPointObjectToArray(R.position,this._tmpScreenPoint);
var M=L.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),G=L.camera.fullHeight,P=.5*O,U=.5*O;M[0]=l.clamp(M[0],P,L.camera.fullWidth-P-1);M[1]=l.clamp(M[1],U,G-U-1);G=Math.floor(M[0]-P);M=Math.floor(M[1]-U);U=this._resources.program;U.bindTexture("textureInput",J.input);I.gl.copyTexImage2D(J.input.descriptor.target,0,J.input.descriptor.pixelFormat,G,M,O,O,0);this._passParameters.magnifier=R;I.useProgram(U);U.bindPass(this._passParameters,L);I.bindVAO(this._resources.vao);I.setPipelineState(this._resources.pipelineState);
I.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4)}}};F._updateResourceLoading=function(){const I=this._validMagnifier;if(!g.isNone(I)){var L=I.maskUrl,R=I.overlayUrl;!g.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===L&&this._imageLoadTask.overlayUrl===R||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);g.isSome(this._imageSources)||g.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:L,overlayUrl:R,task:n.createTask(async O=>{const J=g.isNone(L)||g.isNone(R)?
A.loadMagnifierResources(O):null,M=g.isSome(L)?q.requestImage(L,{signal:O}):J.then(G=>G.mask);O=g.isSome(R)?q.requestImage(R,{signal:O}):J.then(G=>G.overlay);this._imageSources={mask:await M,overlay:await O};this._disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};F._updateResources=function(I,L){this.enabled?g.isSome(this._resources)?this._passParameters.textures.size!==L&&(I=this._createTextureResources(I,
L),g.isNone(I)?this._disposeResources():(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=I)):(L=this._createTextureResources(I,L),g.isNone(L)||(this._resources={program:this._createProgram(I),vao:B.createQuadVAO(I,y.Pos2,this.attributeLocations,0,1),pipelineState:C.makePipelineState({blending:C.simpleBlendingParams(t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:C.defaultColorWriteParams})},this._passParameters.textures=
L)):this._disposeResources()};F._disposeResources=function(){g.isNone(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};F._disposeTextureResources=function(I){I.mask.dispose();I.overlay.dispose();I.input.dispose()};F._createTextureResources=function(I,L){if(g.isNone(this._imageSources))return null;this._imageSources.overlay.width=L;this._imageSources.overlay.height=L;this._imageSources.mask.width=
L;this._imageSources.mask.height=L;const R=new E.Texture(I,{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGBA,internalFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:t.TextureSamplingMode.LINEAR,flipped:!0,preMultiplyAlpha:!e.isSVG(this._imageSources.overlay.src)||!I.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),O=new E.Texture(I,{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.ALPHA,internalFormat:t.PixelFormat.ALPHA,
dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:t.TextureSamplingMode.LINEAR,flipped:!0},this._imageSources.mask);return{input:new E.Texture(I,{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGBA,internalFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:t.TextureSamplingMode.LINEAR,flipped:!1}),mask:O,overlay:R,size:L}};F._createProgram=function(I){return new D.Program(I,v.build(),
this.attributeLocations)};b._createClass(H,[{key:"updating",get:function(){return g.isNone(this._imageSources)&&g.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(I){I!==this._magnifier&&(this._handles.removeAll(),this._magnifier=I,I=()=>{this._updateResourceLoading();this.events.emit("request-render")},g.isSome(this._magnifier)&&this._handles.add(f.watch(()=>g.applySome(this._magnifier,L=>L.version),I)),I())}},
{key:"enabled",get:function(){return g.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return g.isSome(this._magnifier)&&this._magnifier.visible&&g.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"_factor",get:function(){return g.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return H}(w);c.__decorate([k.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);c.__decorate([k.property()],a.MagnifierHelper.prototype,"_imageLoadTask",
void 0);c.__decorate([k.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=c.__decorate([r.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=b._createClass(function(){}),k=function(r){function q(){var B=y.apply(this,arguments);B.textures=new e;return B}b._inherits(q,r);var y=b._createSuper(q);return b._createClass(q)}(l.NoParameters);const u=c.createScreenPointArray(),p=c.createRenderScreenPointArray(),h=n.create();a.MagnifierPassParameters=k;a.TextureResources=e;a.build=function(){const r=new g.ShaderBuilder;r.attributes.add(d.VertexAttribute.POSITION,"vec2");r.vertex.uniforms.add(new m.Float4PassUniform("drawPosition",
(q,y)=>{var B=y.camera.pixelRatio;const D=q.magnifier.offset.x*B,z=q.magnifier.offset.y*B;c.screenPointObjectToArray(q.magnifier.position,u);const v=y.camera.screenToRender(u,p);q=Math.ceil(B*q.magnifier.size);B=y.camera.fullWidth;y=y.camera.fullHeight;return w.set(h,-1+(v[0]+D)/B*2,-1+(v[1]-z)/y*2,q/B*2,q/y*2)}));r.varyings.add("vUV","vec2");r.vertex.code.add(l.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);r.fragment.uniforms.add(new f.Texture2DPassUniform("textureInput",q=>q.textures.input));r.fragment.uniforms.add(new f.Texture2DPassUniform("textureMask",q=>q.textures.mask));r.fragment.uniforms.add(new f.Texture2DPassUniform("textureOverlay",q=>q.textures.overlay));r.fragment.uniforms.add(new x.BooleanPassUniform("maskEnabled",q=>q.magnifier.maskEnabled));r.fragment.uniforms.add(new x.BooleanPassUniform("overlayEnabled",q=>q.magnifier.overlayEnabled));r.fragment.code.add(l.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,w){const n=x=>Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=async function(x){var m=new Promise((g,f)=>a(["./mask-svg"],d=>g(n(d)),f)),l=new Promise((g,f)=>a(["./overlay-svg"],d=>g(n(d)),f));m=w.requestImage((await m).default,
{signal:x});l=w.requestImage((await l).default,{signal:x});l={mask:await m,overlay:await l};c.throwIfAborted(x);return l};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],function(a,b,c,w,n){let x=function(){function m(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";
this.colorZero=new n.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}var l=m.prototype;l.setUidToObjectAndLayerId=function(g,f,d,e,k,u=null,p=null,h=null){g&&f&&d&&e&&(this._layerUidToId.set(e,d),this._layerUidToPopupEnabled.set(e,k),k&&(d=this._layerUidToGraphicsUidToObjectId.get(e),d||(d=new Map,this._layerUidToGraphicsUidToObjectId.set(e,d)),
d.set(f,{objectId:g,attributeNodeId:u,attributeIndex:p,subLayerId:h})))};l.getObjectAndLayerIdColor=function(g){g=this.getObjectAndLayerIdColorArray(g);return w.fromValues(g.get(0,1),g.get(0,2),g.get(0,3),255)};l.getObjectAndLayerIdColorArray=function(g){if(!g.layerUid||!g.graphicUid)return this.colorZero;var f=this._layerUidToPopupEnabled.get(g.layerUid);if(void 0===f)return c.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+g.layerUid),this.colorZero;if(!1===f)return this.colorZero;
let d=this._uidToRenderColor.get(g.layerUid);d||(d=new Map,this._uidToRenderColor.set(g.layerUid,d));f=d.get(g.graphicUid);if(!f){for(;!f;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(f=e)}if(16777215<f)throw Error("Object ID Overflow");d.set(g.graphicUid,f);this._colorToUID.set(f,g)}g=new ArrayBuffer(4);(new DataView(g)).setUint32(0,f,!1);return new n.BufferViewVec4u8(g)};l.getColorToObjectAndLayerIdMapping=function(){const g=new Map;for(const [d,e]of this._colorToUID.entries()){var f=
this._layerUidToGraphicsUidToObjectId.get(e.layerUid);let k=null;f?(k=f.get(e.graphicUid))||c.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+e.graphicUid):c.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+e.layerUid);(f=this._layerUidToId.get(e.layerUid))||c.getLogger(this.declaredClass).warn("no layerId found for uid "+e.layerUid);k&&f&&g.set(d,k.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:k.objectId,lid:f,attrId:k.attributeNodeId,
attrIdx:k.attributeIndex,subLayerId:k.subLayerId}:{type:"object-and-layer-id",oid:k.objectId,lid:f})}return g};return b._createClass(m)}();a.ObjectAndLayerIdRenderHelper=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDUniforms ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./Highlight ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlight ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa){a.Renderer=function(ka){function da(ca,fa,ma,qa,wa,xa,pa,ra){var va=ha.call(this,{});va._stage=ca;va._materialRepository=fa;va._shaderTechniqueRepository=qa;va._rctx=wa;va._compositingHelper=xa;va._magnifierHelper=pa;va._requestRender=ra;va._materialRenderers=new g;va._needsTransparentPass=!1;va._hasHUDElements=!1;va._hasHighlights=!1;va._hasWater=!1;va._hasOverlayWater=!1;va._renderOverlay=
Ba=>{};va._isRendering=!1;va._fallbackDepthStencilTexture=null;va._sliceHelper=new U;va._state=Y.RenderState.IDLE;va._renderStateFeatures=R.setupFeatureDefaults();va._antialiasingEnabled=!0;va._highQualityTransparencyEnabled=!0;va._terrainRenderingEnabled=!0;va._terrainTransparency=q.TransparencyMode.Opaque;va._waterReflectionEnabled=!1;va._ssaoEnabled=!1;va._hasAnimations=!1;va._animationTimestep=new z.AnimationTimeStep;va._handles=new x;va._renderHiddenTransparentEdges=()=>{};va._oitUsed=!1;va._smaaPass=
new N.SmaaRenderPass(va._rctx,qa);ra();va._offscreen=new K.OffscreenRendering(va._rctx,va._compositingHelper);va.performanceInfo=new Z.RendererPerformanceInfo(va._rctx);va._shadowMap=new P.ShadowMap(va._rctx,ca.viewingMode);va._ssaoHelper=new S.SSAOHelper(ca.view,qa,va._rctx,ra);va._highlight=new F.Highlight(qa,va._rctx);va._shadowHighlight=new G.ShadowHighlight(va._rctx,ca.viewingMode);va._shadowAccumulator=new M.ShadowAccumulator(va._rctx,qa,ca,Ba=>{const Aa=va.shadowsEnabled;va._shadowMap.enabled=
!0;va._prepare(Ba.camera,Ba.contentCamera);va._renderPlugins.prepareRender();va._shadowMap.enabled=Aa},(Ba,Aa,Ha)=>{Ba.shadowMap.start(Ba.camera,Aa,Ha);va._renderShadowCascades(B.ShaderOutput.Shadow,Ba.shadowMap);Ba.camera.setGLViewport(va._rctx);va._prepare(Ba.camera,Ba.contentCamera)},ra);va._renderContext=new I.RenderContext(va._rctx,va._offscreen,va._shadowMap,va._ssaoHelper,va._sliceHelper);va._renderPlugins=new O.RenderPluginManager({renderContext:va._renderContext,techniqueRepository:qa,textureRepository:ma,
materialRepository:va._materialRepository,requestRender:ra,controller:ca});va.renderPassManager=new y.RenderPassManager(va._rctx,va._shaderTechniqueRepository);va._renderPlugins.add(va.renderPassManager.slots(),va.renderPassManager);va._handles.add([f.watch(()=>va._stage.view.state.camera,()=>ra(),f.syncAndInitial),f.watch(()=>r.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Ba=>{va._renderHiddenTransparentEdges=Ba?()=>va._renderEdges(V.Transparency.TRANSPARENT):()=>{};ra()},f.initial),f.watch(()=>va._ssaoEnabled||
va.isFeatureEnabled(R.RenderFeature.SSAO),Ba=>va._ssaoHelper.enabled=Ba,f.syncAndInitial)]);return va}b._inherits(da,ka);var ha=b._createSuper(da);ka=da.prototype;ka.isFeatureEnabled=function(ca,fa=this._state){return l.unwrapOr(this._renderStateFeatures.get(fa,ca),!1)};ka.setFeatureEnabled=function(ca,fa,ma){this._renderStateFeatures.set(fa,ca,ma);this.notifyChange("_renderStateFeatures");this._requestRender()};ka.normalizeCtorArgs=function(){return{}};ka.destroy=function(){this._handles.destroy();
this._smaaPass.dispose();this._gpuTimerHandle=l.removeMaybe(this._gpuTimerHandle);this._materialRenderers.forAll(ca=>ca.dispose());this._materialRenderers.clear();this._offscreen.dispose();this._fallbackDepthStencilTexture=l.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.dispose();this._ssaoHelper.dispose();this._highlight.dispose();this._shadowHighlight.dispose();this._shadowAccumulator.dispose();this._edgeView=l.destroyMaybe(this._edgeView);A.BoundingInfo.prune()};ka.disposeOffscreenBuffers=
function(){this._offscreen.dispose();this._shadowMap.disposeOffscreenBuffers();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};ka.ensureEdgeView=function(){l.isNone(this._edgeView)&&(this._edgeView=new W.EdgeView({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:ca=>this._stage.view.resourceController.immediate.schedule(ca)}),
this._handles.add(f.watch(()=>l.applySome(this._edgeView,ca=>ca.updating),()=>this._requestRender(),f.sync)),this._requestRender());return this._edgeView};ka.setParameters=function(ca){const {_shadowMap:fa,_bindParameters:ma}=this;void 0!==ca.screenSpaceReflectionsEnabled&&ma.ssr.enabled!==ca.screenSpaceReflectionsEnabled&&(ma.ssr.enabled=ca.screenSpaceReflectionsEnabled,this._requestRender());void 0!==ca.shadowMap&&this._shadowMap.enabled!==ca.shadowMap&&(this._shadowMap.enabled=ca.shadowMap,this._requestRender());
void 0!==ca.shadowMapMaxCascades&&fa.maxCascades!==ca.shadowMapMaxCascades&&(fa.maxCascades=ca.shadowMapMaxCascades,this._requestRender());if(l.isSome(ca.environment)){l.isSome(ca.environment.weather)&&(this._bindParameters.weather=ca.environment.weather,this._bindParameters.weatherVisible=!!ca.weatherVisible);void 0!==ca.environment.lighting.ambientOcclusionEnabled&&this._ssaoEnabled!==ca.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=ca.environment.lighting.ambientOcclusionEnabled,
this._requestRender());void 0!==ca.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==ca.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=ca.environment.lighting.waterReflectionEnabled,this._requestRender());const qa="virtual"!==ca.environment.lighting.type;ma.enableFillLights!==qa&&(ma.enableFillLights=qa,this._requestRender())}ca.background&&this._offscreen.background!==ca.background&&(this._offscreen.background=ca.background,this._requestRender());
void 0!==ca.antialiasingEnabled&&this._antialiasingEnabled!==ca.antialiasingEnabled&&(this._antialiasingEnabled=ca.antialiasingEnabled,this._requestRender());void 0!==ca.highQualityTransparency&&this._highQualityTransparencyEnabled!==ca.highQualityTransparency&&(this._highQualityTransparencyEnabled=ca.highQualityTransparency,this._requestRender());void 0!==ca.defaultHighlightOptions&&(this._highlight.setDefaultOptions(ca.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(ca.defaultHighlightOptions),
this._requestRender());void 0!==ca.overlays&&this._bindParameters.overlays!==ca.overlays&&(this._bindParameters.overlays=ca.overlays,this._requestRender());void 0!==ca.hasOverlayWater&&this._hasOverlayWater!==ca.hasOverlayWater&&(this._hasOverlayWater=ca.hasOverlayWater,this._requestRender());void 0!==ca.renderOverlay&&this._renderOverlay!==ca.renderOverlay&&(this._renderOverlay=ca.renderOverlay,this._requestRender());void 0!==ca.slicePlane&&this._sliceHelper.plane!==ca.slicePlane&&(this._sliceHelper.plane=
l.unwrap(ca.slicePlane),this._requestRender());void 0!==ca.terrainRenderingEnabled&&this._terrainRenderingEnabled!==ca.terrainRenderingEnabled&&(this._terrainRenderingEnabled=ca.terrainRenderingEnabled,this._requestRender());void 0!==ca.terrainTransparency&&this._terrainTransparency!==ca.terrainTransparency&&(this._terrainTransparency=ca.terrainTransparency,this._requestRender());void 0!==ca.shadowCastOptions&&this._shadowAccumulator.setOptions(ca.shadowCastOptions)};ka.modify=function(ca,fa){this._isRendering&&
console.warn("Renderer.modify called while rendering");const {adds:ma,removes:qa,updates:wa}=ca;if(0!==ma.length||0!==qa.length||0!==wa.length){var xa=!1;L.splitRenderGeometryChangeSetByMaterial(ca).forEach((pa,ra)=>{if(!fa.done){var va=this._materialRenderers.find(Ba=>Ba.material===ra);l.isNone(va)&&0<pa.adds.length&&(va=new T.MergedRenderer(this._rctx,this._materialRepository,ra),this._materialRenderers.push(va));va&&(va.modify(pa),va.isEmpty&&(xa=!0));pa.removes.forEach(Ba=>ca.removes.removeUnordered(Ba));
pa.adds.forEach(Ba=>ca.adds.removeUnordered(Ba));pa.updates.forEach(Ba=>ca.updates.removeUnordered(Ba));fa.madeProgress()}});xa&&this._materialRenderers.filterInPlace(pa=>pa.isEmpty?(pa.dispose(),!1):!0);this._hasHighlights=this._materialRenderers.some(pa=>pa.hasHighlights);this._bindParameters.hasOccludees=this._materialRenderers.some(pa=>pa.hasOccludees);this._hasWater=this._materialRenderers.some(pa=>pa.hasWater);this._hasHUDElements=this._materialRenderers.some(pa=>pa.requiresSlot(J.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,
B.ShaderOutput.Color)||pa.requiresSlot(J.RenderSlot.HUD_MATERIAL,B.ShaderOutput.Color)||pa.requiresSlot(J.RenderSlot.LABEL_MATERIAL,B.ShaderOutput.Color));this._requestRender()}};ka.updateAnimation=function(ca){const fa=this._hasAnimations;this._hasAnimations=!1;this._materialRenderers.forAll(ma=>this._hasAnimations=ma.updateAnimation(ca)||this._hasAnimations);this._hasAnimations=this._renderPlugins.updateAnimation(ca)||this._hasAnimations;this._hasAnimations!==fa&&(this._gpuTimerHandle=fa?l.removeMaybe(this._gpuTimerHandle):
this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations};ka.resetAnimation=function(){this._animationTimestep.clear()};ka.render=function(ca,fa,ma,qa,wa){this._isRendering=!0;this.performanceInfo.startFrame();const {camera:xa,contentCamera:pa,mode:ra}=ma;this._state=ra;this._renderOverlay(wa);this.performanceInfo.advance(Z.PerformanceCategory.OVERLAY);this._renderContext.time=wa;this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;var va=this._offscreen;va.setupRenderTarget(this.hasWaterReflection);
ma=h.create(this._sliceHelper.plane);qa===v.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(ca);xa.setGLViewport(this._rctx);this._prepare(xa,pa);this._renderPlugins.prepareRender();this.performanceInfo.advance(Z.PerformanceCategory.PREPARE);var Ba=this._computeDepthRange(xa);this._renderShadowMap(ca,xa,this._bindParameters.lighting.mainLight.direction,Ba);this.performanceInfo.advance(Z.PerformanceCategory.SHADOW_MAP);va.initializeFrame(xa);this._ensureBindParameters(xa,
pa);this._renderLinearDepth();this.performanceInfo.advance(Z.PerformanceCategory.LINEAR_DEPTH);this._accumulateShadows(Ba,xa,pa);this.performanceInfo.advance(Z.PerformanceCategory.ACCUMULATED_SHADOWS);this._renderNormal();this.performanceInfo.advance(Z.PerformanceCategory.NORMALS);this._ensureBindParametersSSR(wa);this._renderSSAO(wa);this.performanceInfo.advance(Z.PerformanceCategory.SSAO);this._renderContext.output=B.ShaderOutput.Color;va.bindFramebuffer();wa=this._terrainRenderingEnabled&&(this._terrainTransparency===
q.TransparencyMode.Semitransparent||this._terrainTransparency===q.TransparencyMode.TransparentWithDraped);Ba=this._highQualityTransparency&&wa;this._prepareOpaqueGeometrySlots();this._setMultipassTerrain(Ba);this._prepareSlots(J.RenderSlot.TRANSPARENT_TERRAIN);this._setMultipassTerrain(!1);Ba||this._prepareInternalSlots(this._materialRenderers,J.RenderSlot.LINE_CALLOUTS);this._renderOpaqueGeometry();this.performanceInfo.advance(Z.PerformanceCategory.OPAQUE);this._renderTerrainLinearDepth(Ba);this._setMultipassTerrain(Ba);
this._renderEdges(V.Transparency.OPAQUE);this.performanceInfo.advance(Z.PerformanceCategory.OPAQUE_EDGES);this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth);this._renderSlot(J.RenderSlot.VOXEL);this.performanceInfo.advance(Z.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();const Aa=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;Aa&&(this._oitEnabled?this._renderOrderIndependentTransparency(ia.Geometry):this._renderTransparentGeometry());
this.performanceInfo.advance(Z.PerformanceCategory.TRANSPARENT);this._renderGeometryLinearDepth(Ba);const Ha=this._renderHUDVisibility(Ba);Ba||this._renderInternalSlot(J.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(Z.PerformanceCategory.HUD_VISIBILITY);this._renderObjectAndLayerIdColor(fa);this.performanceInfo.advance(Z.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(V.Transparency.TRANSPARENT,Ba);this.performanceInfo.advance(Z.PerformanceCategory.TRANSPARENT_EDGES);this._renderTransparentTerrain();
wa&&Ha&&(Ba?this._renderLineCallouts(D.HUDTransparencyRenderStyle.Occluded):va.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(D.HUDTransparencyRenderStyle.Occluded,va.framebuffer),this.performanceInfo.advance(Z.PerformanceCategory.HUD_OCCLUDED));this.performanceInfo.advance(Z.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);wa&&(va.compositeTransparentTerrainOntoMain(this._bindParameters),Ba&&(this._renderEdges(V.Transparency.OPAQUE),this.performanceInfo.advance(Z.PerformanceCategory.OPAQUE_EDGES),
Aa&&(this._oitEnabled?this._renderOrderIndependentTransparency(ia.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(Z.PerformanceCategory.TRANSPARENT),this._renderEdges(V.Transparency.TRANSPARENT),this.performanceInfo.advance(Z.PerformanceCategory.TRANSPARENT_EDGES)));Ba&&this._renderLineCallouts(D.HUDTransparencyRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);va.renderToTargets(()=>{this._prepareInternalSlots(this._materialRenderers,
J.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._prepareSlots(J.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,J.RenderSlot.LASERLINES);this._renderInternalSlot(J.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(J.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);this._renderSlot(J.RenderSlot.LASERLINES)},va.currentColorTarget,va.mainDepth);this.performanceInfo.advance(Z.PerformanceCategory.ENVIRONMENT);this._renderPlugins.needsLaserlineWithContrastControl&&
va.renderTmpAndCompositeToMain(()=>this._renderSlot(J.RenderSlot.LASERLINES_CONTRAST_CONTROL),this._bindParameters,X.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(Z.PerformanceCategory.LASER_LINE);this._renderOccluded();this.performanceInfo.advance(Z.PerformanceCategory.OCCLUDED);qa=(fa=qa===v.Decorations.ON&&this._magnifierHelper.enabled)&&l.isNone(ca)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):ca;this._rctx.bindFramebuffer(qa);va=this._offscreen.colorTexture;
!this._renderAntiAliasing(va)&&l.isSome(va)&&this._compositingHelper.composite(this._bindParameters,va,X.AlphaMode.None);this.performanceInfo.advance(Z.PerformanceCategory.ANTIALIASING);this._renderHUD(D.HUDTransparencyRenderStyle.NotOccluded,qa);this.performanceInfo.advance(Z.PerformanceCategory.HUD);this._renderHighlights(qa,this._bindParameters);this.performanceInfo.advance(Z.PerformanceCategory.HIGHLIGHTS);fa&&this._magnifierHelper.render(this._rctx,this._bindParameters);qa!==ca&&(this._rctx.bindFramebuffer(ca),
this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,X.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=ma;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.finishFrame()};ka._renderObjectAndLayerIdColor=function(ca){if(l.isSome(ca)&&m("enable-feature:objectAndLayerId-rendering")){const fa=this._renderContext.output;this._rctx.bindFramebuffer(ca);
this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.ObjectAndLayerIdColor),[0,0,0,0],!0,!0);this._rctx.bindFramebuffer(ca);this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=D.HUDTransparencyRenderStyle.NotOccluded;this._renderInternalSlot(J.RenderSlot.HUD_MATERIAL)},void 0,!0,!0);this._renderContext.output=fa}};ka.finish=function(ca){this._hasAnimations||this._animationTimestep.clear();var fa=this.performanceInfo.gpuSamplingEnabled;
if((ca=ca===v.RenderRequestType.BACKGROUND)||fa){const ma=ca?this.performanceInfo.elapsedTime:0;fa=fa?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(ma,fa),ca)}};ka.readDepthPixels=function(ca,fa,ma){const qa=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(ca,ca),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(aa.ClearBufferBit.COLOR_BUFFER_BIT|
aa.ClearBufferBit.DEPTH_BUFFER_BIT|aa.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Depth));qa.readPixels(fa[0],fa[1],fa[2],fa[3],aa.PixelFormat.RGBA,aa.PixelType.UNSIGNED_BYTE,ma)};ka.readHUDVisibility=function(ca,fa,ma,qa,wa){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(ca,fa,ma,qa,aa.PixelFormat.RGBA,aa.PixelType.UNSIGNED_BYTE,wa)};ka.readAccumulatedShadow=function(ca){return this._shadowAccumulator.readAccumulatedShadow(ca[0],
ca[1])};ka._setMultipassTerrain=function(ca){this._setMultipassEnabled(ca);this._setTerrainCulling(ca)};ka._setMultipassEnabled=function(ca){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=ca};ka._setTerrainCulling=function(ca){this._bindParameters.multipassTerrain.cullAboveGround=ca};ka._prepareSlots=function(...ca){this._renderPlugins.prepareSlots(ca)};ka._renderSlot=function(ca){this._bindParameters.slot=ca;this._renderPlugins.render()};ka._renderEdges=
function(ca,fa=!1){const ma=this._edgeView;l.isSome(ma)&&ma.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>ma.render(this._bindParameters,ca),this._bindParameters,X.AlphaMode.Alpha,fa)};ka._renderShadowMap=function(ca,fa,ma,qa){const wa=this._shadowMap;wa.enabled&&this.isFeatureEnabled(R.RenderFeature.ShadowMapUpdate)&&(wa.start(fa,ma,qa),this._shadowHighlight.updateParameters(fa,ma),this._needsShadowHighlight?(this._renderShadowCascades(B.ShaderOutput.ShadowHighlight,this._shadowMap,
xa=>wa.takeCascadeSnapshotTo(xa,P.SnapshotSlot.Highlight)),wa.clear(),this._renderShadowCascades(B.ShaderOutput.ShadowExcludeHighlight,this._shadowMap,xa=>{wa.takeCascadeSnapshotTo(xa,P.SnapshotSlot.Default);this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.ShadowHighlight)})):this._renderShadowCascades(B.ShaderOutput.Shadow),wa.finish(ca),fa.setGLViewport(this._rctx))};ka._renderShadowCascades=function(ca,fa=this._shadowMap,ma=qa=>{}){for(const qa of fa.cascades)qa.camera.setGLViewport(this._rctx),
this._prepare(qa.camera,qa.camera),this._renderGeometryAndTransparentTerrainPass(ca),ma(qa)};ka._renderLinearDepth=function(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth);this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture};ka._renderTerrainLinearDepth=function(ca){ca?
(ca=this._renderContext.output,this._renderContext.output=B.ShaderOutput.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.output=ca):this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture};ka._renderGeometryLinearDepth=function(ca){ca?(ca=this._renderContext.output,
this._offscreen.renderToTargets(()=>this._renderGeometryPass(B.ShaderOutput.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=ca):this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture};ka._renderNormal=function(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Normal)},
this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)};ka._computeDepthRange=function(ca){if(!this._needsDepthRange)return t.ZERO;const fa=C.depthRangeFromScene(ca,this._materialRenderers,this._stage.layers);t.union(fa,this.renderPlugins.queryDepthRange(ca));fa.near=Math.max(ca.near,fa.near);fa.far=Math.min(ca.far,fa.far);return fa};ka._renderGeometryAndTransparentTerrainPass=function(ca){this._renderContext.output=ca;this._prepareSlots(J.RenderSlot.TRANSPARENT_TERRAIN);
this._renderGeometryPass(ca);this._renderTransparentTerrain()};ka._renderGeometryPass=function(ca){this._renderContext.output=ca;this._prepareSlots(J.RenderSlot.TRANSPARENT_MATERIAL);this._renderOpaqueGeometry();this._renderTransparentGeometry()};ka._renderSSAO=function(ca){this._ssaoHelper.render(this._bindParameters,ca,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)};ka._prepareOpaqueGeometrySlots=function(){this._prepareSlots(J.RenderSlot.INTEGRATED_MESH,J.RenderSlot.OPAQUE_TERRAIN,
J.RenderSlot.OPAQUE_MATERIAL,J.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE);this._prepareInternalSlots(this._materialRenderers,J.RenderSlot.OPAQUE_MATERIAL)};ka._renderOpaqueGeometry=function(){this._renderSlot(J.RenderSlot.INTEGRATED_MESH);this._renderSlot(J.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(J.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(J.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(J.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};ka._renderTransparentGeometry=function(){this._renderInternalSlot(J.RenderSlot.TRANSPARENT_MATERIAL);
this._renderSlot(J.RenderSlot.TRANSPARENT_MATERIAL)};ka._renderTransparentTerrain=function(){this._renderSlot(J.RenderSlot.TRANSPARENT_TERRAIN)};ka._renderHUDVisibility=function(ca){let fa=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;fa=this._renderInternalSlot(J.RenderSlot.OCCLUSION_PIXELS)},ca);return fa};ka._renderLineCallouts=
function(ca){this._bindParameters.renderTransparentlyOccludedHUD=ca;ca===D.HUDTransparencyRenderStyle.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(J.RenderSlot.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(J.RenderSlot.LINE_CALLOUTS)};ka._renderHUD=function(ca,fa){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(ia.HUD,ca),this._rctx.bindFramebuffer(fa),this._compositingHelper.composite(this._bindParameters,
this._offscreen.hudColorTexture,X.AlphaMode.PremultipliedAlpha)):ca===D.HUDTransparencyRenderStyle.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(D.HUDTransparencyRenderStyle.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(ca))};ka._renderHUDElements=function(ca){this._bindParameters.renderTransparentlyOccludedHUD=ca;this._prepareInternalSlots(this._materialRenderers,J.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,J.RenderSlot.HUD_MATERIAL,
J.RenderSlot.LABEL_MATERIAL);this._renderInternalSlot(J.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(J.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(J.RenderSlot.LABEL_MATERIAL)};ka._renderHighlights=function(ca,fa){if(this._needsHighlight){var ma=this._highlight,qa=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Highlight);this._rctx.clearSafe(aa.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(D.HUDTransparencyRenderStyle.Both)},
this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=qa.colorTexture;this._needsShadowHighlight&&this._shadowHighlight.render(fa,ca);ma.render(this._bindParameters,qa,ca)}else this._offscreen.disposeTarget(this._offscreen.highlight)};ka._accumulateShadows=function(ca,fa,ma){this._needsShadowCast&&l.isSome(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,ca,fa,ma)};ka._renderOrderIndependentTransparency=
function(ca,fa=D.HUDTransparencyRenderStyle.Both){const ma=ca===ia.HUD,qa=ma?()=>this._renderHUDElements(fa):()=>this._renderTransparentGeometry();ca=xa=>{this._bindParameters.transparencyPassType=xa;this._offscreen.renderOITPass(()=>qa(),xa,ma)};const wa=this._renderContext.output;ma||(this._renderContext.output=B.ShaderOutput.Alpha,this._bindParameters.transparencyPassType=Q.TransparencyPassType.Alpha,this._prepareSlots(J.RenderSlot.TRANSPARENT_MATERIAL),this._renderContext.output=B.ShaderOutput.Color,
this._bindParameters.transparencyPassType=Q.TransparencyPassType.Color,this._prepareSlots(J.RenderSlot.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Q.TransparencyPassType.FrontFace,this._prepareSlots(J.RenderSlot.TRANSPARENT_MATERIAL));this._renderContext.output=B.ShaderOutput.Alpha;ca(Q.TransparencyPassType.Alpha);this._renderContext.output=B.ShaderOutput.Color;ca(Q.TransparencyPassType.Color);ca(Q.TransparencyPassType.FrontFace);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,
ma);this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._renderContext.output=wa;this._oitUsed=!0};ka._disposeOITBuffers=function(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget));this._oitUsed=!1};ka._renderOccluded=function(){let ca=0;na.clear();this._materialRenderers.forAll(xa=>{xa.material&&xa.material.isVisible()&&
xa.material.renderOccluded===H.RenderOccludedFlag.OccludeAndTransparentStencil&&(ca|=xa.material.renderOccluded,na.push(xa))});const fa=this._offscreen,ma=(xa,pa,ra,va,Ba)=>{0!==(ca&pa)&&(fa.renderToTargets(ra,fa.tmpColor,fa.mainDepth,[0,0,0,0],va,Ba),fa.compositeOccludedOntoMain(this._bindParameters,xa))};0!==na.length&&(this._prepareInternalSlots(na,J.RenderSlot.OCCLUDER_MATERIAL,J.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(J.RenderSlot.OCCLUDER_MATERIAL,na),ma(.5,H.RenderOccludedFlag.OccludeAndTransparentStencil,
()=>this._renderInternalSlot(J.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,na),!1,!1));na.clear();this._materialRenderers.forAll(xa=>{xa.material&&xa.material.isVisible()&&(xa.material.renderOccluded===H.RenderOccludedFlag.OccludeAndTransparent||xa.material.renderOccluded===H.RenderOccludedFlag.Transparent||xa.material.renderOccluded===H.RenderOccludedFlag.Opaque)&&(ca|=xa.material.renderOccluded,na.push(xa))});const qa=this._renderPlugins.renderOccludedFlags;if(ca|=qa){var wa=xa=>{this._renderContext.renderOccludedMask=
xa;this._prepareInternalSlots(na,J.RenderSlot.OPAQUE_MATERIAL,J.RenderSlot.TRANSPARENT_MATERIAL,J.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);qa>H.RenderOccludedFlag.Occlude&&this._renderSlot(J.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(J.RenderSlot.OPAQUE_MATERIAL,na);this._renderInternalSlot(J.RenderSlot.TRANSPARENT_MATERIAL,na);this._renderInternalSlot(J.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,na);this._renderContext.resetRenderOccludedMask()};this._renderContext.output=
B.ShaderOutput.Color;ma(.5,H.RenderOccludedFlag.OccludeAndTransparent,()=>wa(H.RenderOccludedFlag.OccludeAndTransparent),!0,v.StencilBits.OutlineVisualElementMask);ma(.5,H.RenderOccludedFlag.Transparent,()=>wa(H.RenderOccludedFlag.Transparent),!0,v.StencilBits.OutlineVisualElementMask);ma(1,H.RenderOccludedFlag.Opaque,()=>wa(H.RenderOccludedFlag.Opaque),!0,v.StencilBits.OutlineVisualElementMask);na.clear()}};ka._renderAntiAliasing=function(ca){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&
l.isSome(ca))return this._smaaPass.render(ca),!0}else this._smaaPass.disable();return!1};ka._prepare=function(ca,fa){this._needsTransparentPass=this._materialRenderers.some(ma=>ma.requiresSlot(J.RenderSlot.TRANSPARENT_MATERIAL,B.ShaderOutput.Color));this._bindParameters.camera=ca;this._bindParameters.contentCamera=fa};ka._ensureBindParameters=function(ca,fa){this._bindParameters.camera=ca;this._bindParameters.contentCamera=fa;ca=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=
ca.hudVisibilityTexture;this._bindParameters.mainColorTexture=ca.mainColorTexture;this._bindParameters.highlightDepthTexture=ca.depthTexture??this._getFallbackDepthTexture()};ka._ensureBindParametersSSR=function(ca){this._bindParameters.ssr.enabled=this.hasWaterReflection;if(this._bindParameters.ssr.enabled){l.isNone(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=ca);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=p.IDENTITY:(u.invert(ea,
this._bindParameters.camera.viewMatrix),u.invert(ba,this._bindParameters.camera.projectionMatrix),u.multiply(ja,ea,ba),u.multiply(ja,this._renderContext.lastFrameCamera.viewMatrix,ja),u.multiply(ja,this._renderContext.lastFrameCamera.projectionMatrix,ja),this._reprojectionMatrix=ja);this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const fa=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=0<fa?Math.min(fa,ca-this._waterReflectionEnableTime)/
fa:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._waterReflectionEnableTime=this._bindParameters.ssr.lastFrameColorTexture=null};ka._prepareInternalSlots=function(ca,...fa){for(const ma of fa)this._bindParameters.slot=ma,ca.forAll(qa=>{qa.material.shouldRender(this._renderContext)&&qa.prepareTechnique(this._renderContext)})};ka._renderInternalSlot=function(ca,fa=this._materialRenderers){let ma=!1;this._bindParameters.slot=ca;fa.forAll(qa=>{if(qa.material.shouldRender(this._renderContext)){const wa=
qa.prepareTechnique(this._renderContext);l.isSome(wa)&&(qa.render(this._renderContext,wa),ma=!0)}});return ma};ka._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=E.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(da,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"_antialiasing",get:function(){return this._antialiasingEnabled||this.isFeatureEnabled(R.RenderFeature.Antialiasing)}},
{key:"_highQualityTransparency",get:function(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(R.RenderFeature.HighQualityTransparency)}},{key:"hasWaterReflection",get:function(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(R.RenderFeature.WaterReflection))}},{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"updating",get:function(){return this._antialiasing&&this._smaaPass.updating||l.isSome(this._edgeView)&&this._edgeView.updating||
this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return u.equals(this._bindParameters.ssr.reprojectionMatrix,p.IDENTITY)}},{key:"_reprojectionMatrix",set:function(ca){n.update(this._bindParameters.ssr.reprojectionMatrix,ca)&&this.notifyChange("isCameraFinal")}},{key:"shadowsEnabled",get:function(){return!!this._shadowMap?.enabled}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},
{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlend.result}},{key:"_oitEnabled",get:function(){return this._highQualityTransparency&&this._hasOITSupport}},{key:"animationTimestep",get:function(){return this._animationTimestep.value}},{key:"animationTimeDilation",get:function(){return this._animationTimestep.timeDilation}},{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||
this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}},{key:"_needsNormal",get:function(){return this._ssaoHelper.active}},{key:"_needsDepthRange",get:function(){return this._shadowMap.enabled||this._needsShadowCast}},{key:"_needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"_needsShadowHighlight",get:function(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}},{key:"_needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},
{key:"gpuMemoryUsage",get:function(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}},{key:"test",get:function(){const ca=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,
weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{ca._renderStateFeatures=R.setupFeatureDefaults()},getFramebufferTexture:fa=>{switch(fa){case a.FramebufferId.Color:return ca._offscreen.colorTexture;case a.FramebufferId.LinearDepth:return ca._offscreen.linearDepthTexture;case a.FramebufferId.Normals:return ca._offscreen.normalTexture;case a.FramebufferId.ShadowMap:return ca._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return ca._offscreen.hudVisibilityTexture;
case a.FramebufferId.Highlight:return ca._offscreen.highlightTexture}}}}}]);return da}(w);c.__decorate([d.property()],a.Renderer.prototype,"_shadowAccumulator",void 0);c.__decorate([d.property()],a.Renderer.prototype,"_state",void 0);c.__decorate([d.property()],a.Renderer.prototype,"_renderStateFeatures",void 0);c.__decorate([d.property()],a.Renderer.prototype,"_antialiasingEnabled",void 0);c.__decorate([d.property({readOnly:!0})],a.Renderer.prototype,"_antialiasing",null);c.__decorate([d.property()],
a.Renderer.prototype,"_ssaoEnabled",void 0);c.__decorate([d.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([d.property({autoDestroy:!0})],a.Renderer.prototype,"_edgeView",void 0);c.__decorate([d.property()],a.Renderer.prototype,"updating",null);c.__decorate([d.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);var ia;(function(ka){ka[ka.Geometry=0]="Geometry";ka[ka.HUD=1]="HUD"})(ia||
(ia={}));a.FramebufferId=void 0;(function(ka){ka[ka.Color=0]="Color";ka[ka.LinearDepth=1]="LinearDepth";ka[ka.Normals=2]="Normals";ka[ka.ShadowMap=3]="ShadowMap";ka[ka.HudVisibility=4]="HudVisibility";ka[ka.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId={}));const na=new g,ba=p.create(),ea=p.create(),ja=p.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){let p=function(){function y(D,z){this.rctx=D;this.shaderTechniqueRepository=z;this.canRender=!0;this._materialPassParameters=new g.MaterialPassParameters;this._shadowPassParameters=new g.ShadowMapPassParameters;this._highlightPassParameters=new g.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new f.RenderPass(D,z),materialTransparent:new f.RenderPass(D,z,f.RenderPassSorting.BackToFront),materialIntegratedMesh:new f.RenderPass(D,z),
shadowMap:new f.RenderPass(D,z),highlight:new f.RenderPass(D,z),highlightIntegratedMesh:new f.RenderPass(D,z),highlightShadowMap:new f.RenderPass(D,z),defaultShadowMap:new f.RenderPass(D,z)}}var B=y.prototype;B.register=function(D){this._systems.add(D)};B.prepareRender=function(D){if(0!==this._systems.size){for(const z of Object.values(this._passes))z.prepareSubmit();this._systems.forEach(z=>z.submit(this._passes,D.bindParameters));for(const z of Object.values(this._passes))z.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};
B.prepareTechniques=function(D){if(0===this._systems.size)return null;this._configure(D);this._materialPassParameters.output=D.output;return this._invoke(D,(z,v)=>z.prepare(v,D.bindParameters))};B.render=function(D,z){this._invoke(D,(v,A)=>v.dispatch(A,D.bindParameters,z))};B._invoke=function(D,z){switch(D.bindParameters.slot){case u.RenderSlot.OPAQUE_MATERIAL:switch(D.output){case d.ShaderOutput.Color:case d.ShaderOutput.Depth:case d.ShaderOutput.Normal:case d.ShaderOutput.ObjectAndLayerIdColor:return z(this._passes.materialOpaque,
this._materialPassParameters);case d.ShaderOutput.Highlight:return z(this._passes.highlight,this._highlightPassParameters);case d.ShaderOutput.Shadow:return z(this._passes.shadowMap,this._shadowPassParameters);case d.ShaderOutput.ShadowHighlight:return z(this._passes.highlightShadowMap,this._shadowPassParameters);case d.ShaderOutput.ShadowExcludeHighlight:return z(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case u.RenderSlot.TRANSPARENT_MATERIAL:switch(D.output){case d.ShaderOutput.Color:case d.ShaderOutput.Alpha:case d.ShaderOutput.Depth:case d.ShaderOutput.Normal:case d.ShaderOutput.ObjectAndLayerIdColor:return z(this._passes.materialTransparent,
this._materialPassParameters)}break;case u.RenderSlot.INTEGRATED_MESH:switch(D.output){case d.ShaderOutput.Color:case d.ShaderOutput.Depth:case d.ShaderOutput.Normal:case d.ShaderOutput.ObjectAndLayerIdColor:return z(this._passes.materialIntegratedMesh,this._materialPassParameters);case d.ShaderOutput.Highlight:return z(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null};B.notifyDirty=function(){this._context.requestRender()};B.slots=function(){return[u.RenderSlot.OPAQUE_MATERIAL,
u.RenderSlot.TRANSPARENT_MATERIAL,u.RenderSlot.INTEGRATED_MESH]};B.initializeRenderContext=function(D){this._context=D};B.uninitializeRenderContext=function(){};B.queryDepthRange=function(D){const z={near:Infinity,far:-Infinity};this._systems.forEach(v=>{v=v.queryShadowCasterDepthRange(D);c.isSome(v)&&k.union(z,v,z)});return z};B._configure=function(D){this._updateParameters(D,D.output===d.ShaderOutput.Shadow||D.output===d.ShaderOutput.ShadowHighlight||D.output===d.ShaderOutput.ShadowExcludeHighlight?
this._shadowPassParameters:D.output===d.ShaderOutput.Highlight?this._highlightPassParameters:this._materialPassParameters)};B._updateParameters=function(D,z){const v=D.bindParameters.camera,A=v.viewInverseTransposeMatrix;m.set(h,A[3],A[7],A[11]);q.set(h);m.copy(z.transformWorldFromViewTH,q.high);m.copy(z.transformWorldFromViewTL,q.low);m.copy(z.slicePlaneLocalOrigin,h);w.fromMat4(z.transformViewFromCameraRelativeRS,v.viewMatrix);x.copy(z.transformProjFromView,v.projectionMatrix);z.identifier===g.RenderPassIdentifier.Material&&
(this._materialPassParameters.transparent=D.bindParameters.slot===u.RenderSlot.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=D.bindParameters.slot===u.RenderSlot.INTEGRATED_MESH,w.transpose(r,z.transformViewFromCameraRelativeRS),w.invert(z.transformNormalViewFromGlobal,r))};b._createClass(y,[{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);
return y}();const h=l.create(),r=n.create(),q=new e.TwoVectorPosition;a.RenderPassManager=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/TransparencyPassType ../../../../webgl/enums".split(" "),function(a,b,c,w,n,x){a.RenderPassSorting=void 0;(function(g){g[g.FrontToBack=0]="FrontToBack";
g[g.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));let m=function(){function g(d,e,k=a.RenderPassSorting.FrontToBack){this._rctx=d;this._techniqueRepository=e;this._sorting=k;this._draws=new w({initialSize:32,allocator:u=>u||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var f=g.prototype;f.submitDraw=function(d,e,k,u){const p=this._draws.pushNew();p.geometry=e;p.geometryRanges=
k;p.material=d;p.depthSquaredHint=u;p.indexType=(e.indexed?c.unwrap(e.vao.indexBuffer).indexType:null)??0};f.prepare=function(d,e){return this._draws.map(k=>k.material.prepareTechnique(this._techniqueRepository,d,e,k.geometry.parameters))};f.dispatch=function(d,e,k){const u=this._rctx;this._previouslyBoundDraw.clear();let p=null;const h=this._draws.length;for(let y=0;y<h;y++){var r=k[y];if(r!==p||r.configuration.transparencyPassType!==n.TransparencyPassType.NONE)u.bindTechnique(r,d,e),p=r;var q=this._draws.data[y];
const B=q.geometry;u.bindVAO(B.vao);this._previouslyBoundDraw.get(r)!==q.material&&(r.program.bindDraw(q.material,e,d),this._previouslyBoundDraw.set(r,q.material));r=q.geometryRanges;const D=r.length;if(0!==q.indexType){const z=l.get(q.indexType);for(let v=0;v<D;v+=2)u.drawElements(B.primitiveType,r[v+1],q.indexType,r[v]*z)}else for(q=0;q<D;q+=2)u.drawArrays(B.primitiveType,r[q],r[q+1])}};f.prepareSubmit=function(){this._draws.clear()};f.finishSubmit=function(){const d=this._sorting===a.RenderPassSorting.FrontToBack?
1:-1;this._draws.sort((e,k)=>{const u=d*(e.depthSquaredHint-k.depthSquaredHint);return 0!==u?u:e.geometry.vao.size-k.geometry.vao.size})};b._createClass(g,[{key:"count",get:function(){return this._draws.length}}]);return g}();const l=new Map;l.set(x.DataType.UNSIGNED_BYTE,1);l.set(x.DataType.UNSIGNED_SHORT,2);l.set(x.DataType.UNSIGNED_INT,4);a.RenderPass=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(a,b,c,w,n){let x=function(){function d(){this._step=g;this._dilation=1;this._firstIdleTime=n.Milliseconds(0)}var e=d.prototype;e.frame=function(k,u){u?0===this._firstIdleTime&&(this._firstIdleTime=n.Milliseconds(performance.now())):this._firstIdleTime=n.Milliseconds(0);if(c("enable-feature:high-quality-idle")){u=u?performance.now()-this._firstIdleTime:0;if(u>=m+l){this._step=
n.Milliseconds(Infinity);this._dilation=1;return}this._dilation=u>=m?10:1}else this._dilation=1;k=w.clamp(k/.5,g,f);this._step=Infinity===this._step?n.Milliseconds(k):n.Milliseconds(.9*this._step+k*(1-.9))};e.clear=function(){this._step=this._firstIdleTime=n.Milliseconds(0)};b._createClass(d,[{key:"value",get:function(){return this._step}},{key:"timeDilation",get:function(){return this._dilation}}]);return d}();const m=n.Milliseconds(6E4),l=n.Milliseconds(5E3),g=n.Milliseconds(1E3),f=n.Milliseconds(1E3/
30);a.AnimationTimeStep=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Highlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./VertexArrayObject ../shaders/HighlightApplyTechnique ../../../../chunks/HighlightBlur.glsl ../shaders/HighlightBlurTechnique ../../../../chunks/HighlightDownsample.glsl ../shaders/HighlightDownsampleTechnique ../shaders/HighlightPassParameters ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){let D=function(){function z(A,t){this._techniqueRep=A;this._rctx=t;this._viewportToRestore=x.create();this._passParameters=new h.HighlightPassParameters;this._downsampleDrawParameters=new u.HighlightDownsampleDrawParameters;this._blurDrawParameters=new e.HighlightBlurDrawParameters;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}var v=z.prototype;v._assertResources=
function(){if(!this._quadVAO){this._quadVAO=g.createQuadVAO(this._rctx);var A={colorTarget:q.TargetType.TEXTURE,depthStencilTarget:q.DepthStencilTargetType.NONE,width:0,height:0},t={target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,samplingMode:q.TextureSamplingMode.LINEAR,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new y.FramebufferObject(this._rctx,A,t);this._blur1Fbo=new y.FramebufferObject(this._rctx,A,t);this._blurTechnique=
this._techniqueRep.acquire(k.HighlightBlurTechnique);this._downsampleTechnique=this._techniqueRep.acquire(p.HighlightDownsampleTechnique);this._applyTechnique=this._techniqueRep.acquire(d.HighlightApplyTechnique)}};v.dispose=function(){this._blurTechnique=c.releaseMaybe(this._blurTechnique);this._downsampleTechnique=c.releaseMaybe(this._downsampleTechnique);this._applyTechnique=c.releaseMaybe(this._applyTechnique);if(this._grid.coverageMipmap)for(let A=1;A<this._grid.coverageMipmap.length;A++)this._grid.coverageMipmap[A].dispose();
this._grid.vao&&this._grid.vao.dispose(!0);this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null);this._blur0Fbo=c.disposeMaybe(this._blur0Fbo);this._blur1Fbo=c.disposeMaybe(this._blur1Fbo)};v.setDefaultOptions=function(A){this._passParameters={...(new h.HighlightPassParameters),...A}};v.render=function(A,t,C){this._passParameters.highlightColorTexture=t.colorTexture;this._assertResources();var E=A.camera;n.copy(this._viewportToRestore,E.fullViewport);var F=E.pixelRatio;const H=Math.ceil(E.fullWidth/
F);E=Math.ceil(E.fullHeight/F);this._blur0Fbo.resize(H,E);this._blur1Fbo.resize(H,E);F=this._rctx;F.bindVAO(this._quadVAO);let K=null;this._gridUpdateResources(t,32);this._gridComputeMipmap(A);this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;K=this._grid.vao;const I=F.bindTechnique(this._blurTechnique,this._passParameters,A);F.bindVAO(K);F.bindFramebuffer(this._blur0Fbo);F.setViewport(0,0,H,E);F.setClearColor(0,0,0,0);F.clear(q.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=t.colorTexture;w.set(this._blurDrawParameters.blurSize,1/H,0);I.bindDraw(this._blurDrawParameters,A,this._passParameters);F.drawArrays(this._blurTechnique.primitiveType,0,B.vertexCount(K,"geometry"));F.bindFramebuffer(this._blur1Fbo);F.clear(q.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture;w.set(this._blurDrawParameters.blurSize,0,1/E);I.bindDraw(this._blurDrawParameters,A,this._passParameters);F.drawArrays(this._blurTechnique.primitiveType,
0,B.vertexCount(K,"geometry"));F.bindFramebuffer(C);F.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]);this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture;F.bindTechnique(this._applyTechnique,this._passParameters,A);F.drawArrays(this._applyTechnique.primitiveType,0,B.vertexCount(K,"geometry"));F.bindVAO(null)};v._gridUpdateResources=function(A,t){const C=this._rctx,E=this._grid;var F=!1;null===E.coverageMipmap&&
(E.coverageMipmap=[A],F=!0);if(E.viewportWidth!==A.width||E.viewportHeight!==A.height)F=!0,E.viewportWidth=A.width,E.viewportHeight=A.height;E.coverageMipmap[0]=A;E.cellPixelSize!==t&&(E.cellPixelSize=t,F=!0);if(F){for(t=1;t<E.coverageMipmap.length;t++)E.coverageMipmap[t].dispose();E.mipmapLevels=Math.ceil(Math.log(E.cellPixelSize)*Math.LOG2E);E.coverageMipmap.length=E.mipmapLevels+1;for(t=0;t<E.mipmapLevels;t++)F=E.coverageMipmap[t],E.coverageMipmap[t+1]=new y.FramebufferObject(C,{colorTarget:q.TargetType.TEXTURE,
depthStencilTarget:q.DepthStencilTargetType.NONE,width:Math.ceil(F.width/2),height:Math.ceil(F.height/2)},{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGB,dataType:q.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:q.TextureSamplingMode.LINEAR,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(F.width/2),height:Math.ceil(F.height/2)})}F=Math.ceil(A.height/E.cellPixelSize);var H=Math.ceil(A.width/E.cellPixelSize);if(!E.vao||E.verticalCellCount!==F||E.horizontalCellCount!==H){E.verticalCellCount=
F;E.horizontalCellCount=H;A=F+1;t=H+1;F=1/F;H=1/H;const K=new Float32Array(24*A*t);let I=0;for(let L=0;L<A;L++)for(let R=0;R<t;R++)K[I]=(R-.5)*H*2-1,K[I+1]=(L-.5)*F*2-1,K[I+2]=R*H,K[I+3]=L*F,K[I+4]=(R+.5)*H*2-1,K[I+5]=(L-.5)*F*2-1,K[I+6]=R*H,K[I+7]=L*F,K[I+8]=(R-.5)*H*2-1,K[I+9]=(L+.5)*F*2-1,K[I+10]=R*H,K[I+11]=L*F,K[I+12]=(R-.5)*H*2-1,K[I+13]=(L+.5)*F*2-1,K[I+14]=R*H,K[I+15]=L*F,K[I+16]=(R+.5)*H*2-1,K[I+17]=(L-.5)*F*2-1,K[I+18]=R*H,K[I+19]=L*F,K[I+20]=(R+.5)*H*2-1,K[I+21]=(L+.5)*F*2-1,K[I+22]=R*
H,K[I+23]=L*F,I+=24;E.vao&&E.vao.dispose(!0);E.vao=new f.VertexArrayObject(C,m.Default3D,{geometry:l.Pos2Tex},{geometry:r.BufferObject.createVertex(C,q.Usage.STATIC_DRAW,K)})}};v._gridComputeMipmap=function(A){const t=this._rctx,C=this._grid,E=t.bindTechnique(this._downsampleTechnique,this._passParameters,A);t.bindVAO(this._quadVAO);for(let F=0;F<C.mipmapLevels;F++){t.bindFramebuffer(C.coverageMipmap[F+1]);const H=C.coverageMipmap[F+1].width,K=C.coverageMipmap[F+1].height;this._downsampleDrawParameters.inputTexture=
C.coverageMipmap[F].colorTexture;w.set(this._downsampleDrawParameters.invFramebufferDim,1/H,1/K);E.bindDraw(this._downsampleDrawParameters,A,this._passParameters);t.setViewport(0,0,H,K);t.drawArrays(q.PrimitiveType.TRIANGLE_STRIP,0,B.vertexCount(this._quadVAO,"geometry"))}};b._createClass(z,[{key:"gpuMemoryUsage",get:function(){let A=(c.isSome(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(c.isSome(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const t of this._grid.coverageMipmap)A+=
t.gpuMemoryUsage;return A}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}]);return z}();a.Highlight=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HighlightApplyTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightApply.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f){n=function(d){function e(){return k.apply(this,arguments)}c._inherits(e,d);var k=c._createSuper(e);d=e.prototype;d.initializeProgram=function(u){return new m.Program(u.rctx,e.shader.get().build(),x.Default3D)};d.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(n.ShaderTechnique);
n.shader=new w.ReloadableShaderModule(l.HighlightApply,()=>new Promise((d,e)=>a(["./HighlightApply.glsl"],d,e)));b.HighlightApplyTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l){function g(){const d=new x.ShaderBuilder,{vertex:e,fragment:k}=d,u=e.code,p=k.code;d.attributes.add(l.VertexAttribute.POSITION,"vec2");d.varyings.add("uv","vec2");d.attributes.add(l.VertexAttribute.UV0,"vec2");e.uniforms.add(new m.Texture2DPassUniform("coverageTex",h=>h.coverageTexture));u.add(n.glsl`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);k.uniforms.add(new m.Texture2DPassUniform("tex",h=>h.blurColorTexture));k.uniforms.add(new m.Texture2DPassUniform("origin",h=>h.highlightColorTexture));k.uniforms.add(new w.Float4PassUniform("uColor",h=>h.color));k.uniforms.add(new w.Float4PassUniform("haloColor",h=>h.haloColor));k.uniforms.add(new w.Float4PassUniform("opacities",h=>b.set(f,h.haloOpacity,h.haloOpacityOccluded,h.fillOpacity,h.fillOpacityOccluded)));k.constants.add("outlineSize","float",8.6);k.constants.add("blurSize","float",.4);
p.add(n.glsl`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return d}const f=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=c;a.build=g})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(){const k=new x.ShaderBuilder,{vertex:u,fragment:p}=k,h=u.code,r=p.code;k.attributes.add(g.VertexAttribute.POSITION,"vec2");k.attributes.add(g.VertexAttribute.UV0,"vec2");k.varyings.add("blurCoordinate","vec3");u.uniforms.add(new l.Texture2DPassUniform("coverageTex",q=>q.coverageTexture));p.uniforms.add(new w.Float2DrawUniform("blurSize",q=>q.blurSize));h.add(n.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`);p.uniforms.add(new m.Texture2DDrawUniform("tex",q=>q.blurInputTexture));r.add(n.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`);return k}let d=function(k){function u(){var h=p.apply(this,arguments);h.blurSize=c.create();return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(n.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:d,build:f},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=e;a.HighlightBlurDrawParameters=d;a.build=f})},"esri/views/3d/webgl-engine/shaders/HighlightBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightBlur.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.HighlightBlur,()=>new Promise((f,d)=>a(["./HighlightBlur.glsl"],f,d)));b.HighlightBlurTechnique=
n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightDownsample.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,w,n,x,m,l){function g(){const e=
new x.ShaderBuilder,{vertex:k,fragment:u}=e,p=k.code,h=u.code;e.attributes.add(l.VertexAttribute.POSITION,"vec2");p.add(n.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`);u.uniforms.add(new m.Texture2DDrawUniform("tex",r=>r.inputTexture));u.uniforms.add(new w.Float2DrawUniform("invFramebufferDim",r=>r.invFramebufferDim));h.add(n.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`);return e}let f=function(e){function k(){var p=u.apply(this,arguments);p.invFramebufferDim=c.create();return p}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(n.NoParameters);const d=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:f,build:g},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=d;a.HighlightDownsampleDrawParameters=f;a.build=g})},"esri/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightDownsample.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.HighlightDownsample,()=>new Promise((f,d)=>a(["./HighlightDownsample.glsl"],f,
d)));b.HighlightDownsampleTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HighlightPassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f32","../../../../chunks/vec4f64","../core/shaderModules/interfaces"],function(a,b,c,w,n){n=function(x){function m(){var g=l.apply(this,arguments);g.color=c.fromValues(1,0,1,1);g.haloColor=c.fromValues(1,0,1,1);g.haloOpacity=1;g.haloOpacityOccluded=
.25;g.fillOpacity=.2;g.fillOpacityOccluded=.05;g.shadowColor=w.fromValues(1,0,1,1);g.shadowOpacity=.15;g.occludedShadowOpacity=.075;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(n.NoParameters);a.HighlightPassParameters=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./RenderTargetHelper ./TransparencyPassType ../shaders/CompositingTechniqueConfiguration ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l){let g=function(){function e(u,p){this._rctx=u;this._compositingHelper=p;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._background={type:"color",color:[0,0,0,1]};const h=u.type===m.ContextType.WEBGL2,r=this._renderTargetHelper=new w.RenderTargetHelper(u);this._mainColorTargets=[r.registerColorTarget({name:"mainColorTarget0"}),r.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=r.registerColorTarget({name:"frontFaceTarget"});u=q=>r.registerColorTarget({name:q,
dataType:l.PixelType.FLOAT,internalFormat:h?l.SizedPixelFormat.RGBA32F:l.PixelFormat.RGBA,samplingMode:l.TextureSamplingMode.NEAREST});this.colorFloatTarget=u("colorFloatTarget");this.alphaFloatTarget=u("alphaFloatTarget");this.mainDepth=r.registerDepthTarget({name:"mainDepth"});this.linearDepth=r.registerColorTarget({name:"linearDepth",samplingMode:l.TextureSamplingMode.NEAREST});this.terrainLinearDepth=r.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=r.registerColorTarget({name:"geometryLinearDepth"});
this.normal=r.registerColorTarget({name:"normal"});this.highlight=r.registerColorTarget({name:"highlight",internalFormat:h?l.SizedPixelFormat.RGBA4:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=r.registerColorTarget({name:"hudVisibility",internalFormat:h?l.SizedPixelFormat.RGBA4:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=r.registerColorTarget({name:"tmpColor"});this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"});this.hudColor=
r.registerColorTarget({name:"hudColor"})}var k=e.prototype;k.dispose=function(){this._renderTargetHelper.dispose()};k.getFramebuffer=function(u,p){return this._renderTargetHelper.getFramebuffer(this._dimensions,u,p)};k.setupRenderTarget=function(u){u||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]));this._mainColorTarget=0===this._mainColorTarget&&u?1:0};k.initializeFrame=function(u){const p=this._rctx;this._dimensions.width=u.fullWidth;this._dimensions.height=u.fullHeight;
this.bindTarget(this.currentColorTarget,this.mainDepth);p.setClearStencil(0);u=this._background.color;p.setClearColor(u[0]*u[3],u[1]*u[3],u[2]*u[3],u[3]);p.clearSafe(l.ClearBufferBit.COLOR_BUFFER_BIT|l.ClearBufferBit.DEPTH_BUFFER_BIT|l.ClearBufferBit.STENCIL_BUFFER_BIT)};k.composite=function(u){c.isSome(this.colorTexture)&&this._compositingHelper.composite(u,this.colorTexture,x.AlphaMode.None)};k.renderTmpAndCompositeToMain=function(u,p,h,r=!1){this.renderToTargets(u,this.tmpColor,r?this.tmpDepth:
this.mainDepth,f);this._compositingHelper.composite(p,this._getColorTexture(this.tmpColor),h)};k.renderHUDVisibility=function(u,p=!1){this.renderToTargets(u,this.hudVisibility,p?this.tmpDepth:this.mainDepth,d)};k.compositeTransparentTerrainOntoHUDVisibility=function(u){this.renderToTargets(()=>this._compositingHelper.compositeHUD(u,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)};k.renderOITPass=function(u,p,h){let r,q;switch(p){case n.TransparencyPassType.Color:r=this.colorFloatTarget;
q=[0,0,0,0];break;case n.TransparencyPassType.Alpha:r=this.alphaFloatTarget;q=[1,1,1,1];break;case n.TransparencyPassType.FrontFace:r=this.frontFaceTarget,q=[0,0,0,0]}h?this.renderToTargets(u,r,this.tmpDepth,q,!0,!0):this.renderToTargets(u,r,this.mainDepth,q,!1)};k.compositeTransparentTerrainOntoMain=function(u){this.bindFramebuffer();this._compositingHelper.composite(u,this._getColorTexture(this.tmpColor),x.AlphaMode.PremultipliedAlpha)};k.compositeOccludedOntoMain=function(u,p){this.bindFramebuffer();
this._compositingHelper.composite(u,this._getColorTexture(this.tmpColor),x.AlphaMode.PremultipliedAlpha,p)};k.compositeTransparentOntoOpaque=function(u,p){p?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(l.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeOIT(u,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))};k.bindFramebuffer=
function(){this._rctx.bindFramebuffer(this.framebuffer)};k.renderDepthDetached=function(u){this.bindTarget(this.currentColorTarget);u();this.bindTarget(this.currentColorTarget,this.mainDepth)};k.disposeTarget=function(u){this._renderTargetHelper.disposeTargetResource(u)};k.renderToFBO=function(u,p,h=!1,r=!1){const q=this._rctx;let y=0;p&&(q.setClearColor(p[0],p[1],p[2],Math.max(1E-13,p[3])),y|=l.ClearBufferBit.COLOR_BUFFER_BIT);h&&(y|=l.ClearBufferBit.DEPTH_BUFFER_BIT);!1===r?r=0:(!0===r&&(r=255),
y|=l.ClearBufferBit.STENCIL_BUFFER_BIT);y&&q.clearSafe(y,r);u();q.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth)};k.renderToTargets=function(u,p,h,r,q=!1,y=!1){p=this.bindTarget(p,h);this.renderToFBO(u,r,q,y);return p};k.bindTarget=function(u,p){u=this._renderTargetHelper.getFramebuffer(this._dimensions,u,p);this._rctx.bindFramebuffer(u);return u};k._getColorTexture=function(u){return this._renderTargetHelper.getColorTexture(u,this._dimensions)};b._createClass(e,[{key:"width",
get:function(){return this._dimensions.width}},{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(u){this._background=u}},{key:"currentColorTarget",get:function(){return this._mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this._mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},
{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},
{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"gpuMemoryUsage",get:function(){let u=0;this._renderTargetHelper&&(u+=this._renderTargetHelper.gpuMemoryUsage);return u}}]);return e}();const f=[0,0,0,0],d=[0,1,0,1];a.OffscreenRendering=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,w,n,x,m,l,g){const f={dataType:n.PixelType.UNSIGNED_BYTE,internalFormat:n.PixelFormat.RGBA},d={};let e=function(){function k(p){this._rctx=p;this._activeTargets=new Set;this._depthTextures=
new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=p.capabilities.depthTexture}var u=k.prototype;u.dispose=function(){this._depthBuffers.forEach(p=>p.dispose());this._depthBuffers.clear();this._depthTextures.forEach(p=>p.dispose());this._depthTextures.clear();this._colorTextures.forEach(p=>p.dispose());this._colorTextures.clear();this._framebuffers.forEach(p=>p.dispose());this._framebuffers.clear();this._activeTargets.clear()};u.disposeTargetResource=
function(p){p=p.id;this._activeTargets.has(p)&&(this._activeTargets.delete(p),this._disposeWithFramebuffers(this._depthTextures,p),this._disposeWithFramebuffers(this._depthBuffers,p),this._disposeWithFramebuffers(this._colorTextures,p))};u._disposeWithFramebuffers=function(p,h){const r=p.get(h);r&&(this._framebuffers.forEach((q,y)=>{if(q.colorAttachment===r||q.depthStencilAttachment===r)q.detachAll(),q.dispose(),this._framebuffers.delete(y)}),r.dispose(),p.delete(h))};u.getDepthTexture=function(p,
h){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(p.id);!r||r.descriptor.width===h.width&&r.descriptor.height===h.height||(r.dispose(),r=c.nullifyNonNullableForDispose());r||(r=new l.Texture(this._rctx,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.DEPTH_STENCIL,dataType:n.PixelType.UNSIGNED_INT_24_8,samplingMode:n.TextureSamplingMode.NEAREST,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,width:h.width,height:h.height}),this._depthTextures.set(p.id,r),this._activeTargets.add(p.id));
return r};u.getAllocatedDepthTexture=function(p){return this._depthTextures.get(p.id)};u.getDepthBuffer=function(p,h){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(p.id);r?r.descriptor.width===h.width&&r.descriptor.height===h.height||r.resize(h.width,h.height):(r=new m.Renderbuffer(this._rctx,{internalFormat:n.RenderbufferFormat.DEPTH_STENCIL,...h}),this._depthBuffers.set(p.id,r),this._activeTargets.add(p.id));return r};u.getColorTexture=function(p,h){let r=this._colorTextures.get(p.id);
!r||r.descriptor.width===h.width&&r.descriptor.height===h.height||(r.dispose(),r=c.nullifyNonNullableForDispose());r||(r=new l.Texture(this._rctx,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:p.internalFormat,dataType:p.dataType,samplingMode:null!=p.samplingMode?p.samplingMode:n.TextureSamplingMode.LINEAR,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,width:h.width,height:h.height}),this._colorTextures.set(p.id,r),this._activeTargets.add(p.id));return r};u.getAllocatedColorTexture=
function(p){return this._colorTextures.get(p.id)};u.registerDepthTarget=function(p={}){return{id:w.generateUID(),...d,...p}};u.registerColorTarget=function(p={}){return{id:w.generateUID(),...f,...p}};u.getFramebuffer=function(p,h,r){const q=this._getKey(h,r);let y=this._framebuffers.get(q);h=this.getColorTexture(h,p);if(this.depthTextureSupported){var B=r?this.getDepthTexture(r,p):void 0;if(!y)return y=c.isSome(r)?new x.FramebufferObject(this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},
h,B):new x.FramebufferObject(this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},h),this._framebuffers.set(q,y),y;if(y.width!==p.width||y.height!==p.height||y.colorTexture!==h||y.depthStencilTexture!==B)y.detachAll(),y.resize(p.width,p.height),y.attachColorTexture(h),y.attachDepthStencilTexture(B);return y}B=r?this.getDepthBuffer(r,p):void 0;if(!y)return y=new x.FramebufferObject(this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:r?n.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:
n.DepthStencilTargetType.NONE},h,B),this._framebuffers.set(q,y),y;if(y.width!==p.width||y.height!==p.height||y.colorTexture!==h)y.detachAll(),y.resize(p.width,p.height),y.attachColorTexture(h),y.attachDepthStencilBuffer(B);return y};u._getKey=function(p,h){return`${p.id}_${h?h.id:"X"}_${p.name}${h?"_"+h.name:""}`};b._createClass(k,[{key:"gpuMemoryUsage",get:function(){let p=0;const h=new Set,r=q=>{h.has(q)||(h.add(q),p+=g.getGpuMemoryUsage(q))};this._depthTextures.forEach(r);this._colorTextures.forEach(r);
this._depthBuffers.forEach(r);return p}}]);return k}();a.RenderTargetHelper=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ./depthRange ./RenderSlot".split(" "),function(a,b,c,w,n,x,m){let l=function(){function f(e){this._context=e;this._renderPlugins=new w;this._slots=[];for(e=
0;e<m.RenderSlot.MAX_SLOTS;++e)this._slots[e]=[]}var d=f.prototype;d.add=function(e,k,u){const p=()=>{if(u?.aborted)throw k.uninitializeRenderContext(),n.createAbortError();this._renderPlugins.push(k);for(const r of e)this._slots[r].push(k);this._context.requestRender()},h=k.initializeRenderContext(this._context,u);if(n.isPromiseLike(h))return h.then(p);p()};d.remove=function(e){if(null!=this._renderPlugins.removeUnordered(e)){for(let k=0;k<this._slots.length;++k)this._slots[k]=this._slots[k].filter(u=>
u!==e);e.uninitializeRenderContext();this._context.requestRender()}};d.prepareRender=function(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})};d.updateAnimation=function(e){let k=!1;this._renderPlugins.forAll(u=>{u.updateAnimation&&(k=u.updateAnimation(e)||k)});return k};d.prepareSlots=function(e){for(const k of e)this._context.renderContext.bindParameters.slot=k,this._slots[k].filter(u=>{u.canRender&&("prepareTechnique"in u&&u.prepareTechnique(this._context.renderContext),
"prepareTechniques"in u&&u.prepareTechniques(this._context.renderContext))})};d.render=function(){const e=[];this._slots[this._context.renderContext.bindParameters.slot].filter(k=>{if(!k.canRender)return!1;if("prepareTechnique"in k)return k=k.prepareTechnique(this._context.renderContext),c.isSome(k)?(e.push(k),!0):!1;if("prepareTechniques"in k)return k=k.prepareTechniques(this._context.renderContext),c.isSome(k)?(e.push(k),!0):!1;e.push(null);return!0}).forEach((k,u)=>k.render(this._context.renderContext,
e[u]))};d.queryDepthRange=function(e){const k=g;k.near=Infinity;k.far=-Infinity;this._renderPlugins.forAll(u=>{u.queryDepthRange&&(u=u.queryDepthRange(e))&&x.union(k,u,k)});return k};b._createClass(f,[{key:"needsTransparentPass",get:function(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}},{key:"needsHighlight",get:function(){return this._renderPlugins.some(e=>!!e.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",
get:function(){const e=this._slots[m.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!e&&0<e.length}},{key:"renderOccludedFlags",get:function(){return this._renderPlugins.reduce((e,k)=>e|k.renderOccludedFlags,0)}}]);return f}();const g={near:0,far:0};a.RenderPluginManager=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){a.ShadowAccumulator=function(F){function H(I,L,R,O,J,M){var G=K.call(this,{});G._rctx=I;G._stage=R;G._prepareForShadowMapPass=O;G._renderToShadowMap=J;G._requestRender=M;G._progress=0;G._sampleCount=0;G._passParameters=new D.ShadowCastAccumulatePassParameters;G._enabledInternal=!1;G._cachedLightDirections=[];G._depthRange=r.ZERO;G._previewing=!1;G._handles=new x;G._cameraForcedForScreenshot=!1;G._bindParameters=new h.BindParameters(new B.ShadowMap(I,
R.viewingMode),null,null);G._bindParameters.shadowMap.enabled=!0;G._vao=q.createQuadVAO(I);G._fbo=new t.FramebufferObject(I,{colorTarget:A.TargetType.TEXTURE,depthStencilTarget:A.DepthStencilTargetType.NONE,width:0,height:0},{target:A.TextureType.TEXTURE_2D,pixelFormat:A.PixelFormat.RGBA,dataType:A.PixelType.UNSIGNED_BYTE,samplingMode:A.TextureSamplingMode.LINEAR,wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});G._accumulationRenderer=new y.ShadowCastRenderer(L,I,b._assertThisInitialized(G),
M);G._handles.add([G._stage.view.resourceController.scheduler.registerTask(v.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(G)),g.watch(()=>R.renderView,P=>{G._handles.remove("renderView");l.isSome(P)&&G._handles.add(P.events.on("force-camera-for-screenshot",()=>G._cameraForcedForScreenshot=!0),"renderView")},g.syncAndInitial),g.watch(()=>G._previewing,()=>G._requestRenderIfEnabled(),g.sync)]);return G}b._inherits(H,F);var K=b._createSuper(H);F=H.prototype;F.normalizeCtorArgs=function(){return{}};
F.runTask=function(I){for(this._prepareForShadowMapPass(this._bindParameters);!I.done&&!this._isDoneAccumulating;)this._accumulateShadow(),I.madeProgress();this._requestRender()};F.renderAccumulation=function(I,L,R,O){this._depthRange=L;this._updateCamera(R);this._bindParameters.contentCamera=O;this._passParameters.linearDepthTexture=I;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===
this._progress||this._cameraForcedForScreenshot)&&this._clear();I=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);for(L=0;L<I;++L)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}};F.render=function(I){this._accumulationRenderer.render(I)};F.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=l.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=l.disposeMaybe(this._fbo);
this._vao=l.disposeMaybe(this._vao);this._accumulationTechniqueCached=l.releaseMaybe(this._accumulationTechniqueCached);this._sampleCount=this._cachedLightDirections.length=0};F.setOptions=function(I){void 0!==I.enabled&&(this._enabled=I.enabled);void 0!==I.previewing&&(this._previewing=I.previewing);void 0!==I.lightDirections&&(this._lightDirections=I.lightDirections);this._accumulationRenderer.setOptions(I)};F.readAccumulatedShadow=function(I,L){if(!this._isActive||1>this._progress||0>I||I>this._fbo.width||
0>L||L>this._fbo.height)return 0;this._fbo.readPixels(I,L,1,1,A.PixelFormat.RGBA,A.PixelType.UNSIGNED_BYTE,E);return E[0]/this._progress};F._start=function(){this._progress=0;this._enabledInternal=!0};F._stop=function(){this._enabledInternal=!1};F._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};F._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(A.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};F._accumulateShadow=
function(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const I=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(I,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(I.primitiveType,0,C.vertexCount(this._vao,"geometry"))};F._sampleLightDirection=function(){this._progress++;return this._lightDirections[104729*this._progress%this._lightDirections.length]};F._updateCamera=
function(I){I.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(I),this._fbo.resize(I.fullWidth,I.fullHeight),this._opacityFromElevation=1-m.smoothstep(y.shadowCastDisableElevationMin,y.shadowCastDisableElevationMax,I.relativeElevation))};F._requestRenderIfEnabled=function(){this._enabledInternal&&this._requestRender()};b._createClass(H,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",
get:function(){return this._isPreviewing||this._isRefining}},{key:"_accumulationTechnique",get:function(){l.isNone(this._accumulationTechniqueCached)&&(this._accumulationTechniqueCached=new z.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},
{key:"_isActive",get:function(){return this._enabledInternal&&0<this._sampleCount}},{key:"canAccumulate",get:function(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==r.ZERO&&this._opacityFromElevation>y.shadowCastDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(I){const L=this._cachedLightDirections;if(!n.equals(L,I,u.equals)){var R=
Math.min(D.ShadowCastMaxSamples,I.length);this._sampleCount=L.length=R;for(let O=0;O<R;++O)L[O]=u.copy(L[O]??p.create(),I[O]);this._invalidate()}}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(I){this._accumulationRenderer.opacityFromElevation=I}},{key:"running",get:function(){return this._isRefining&&this.canAccumulate&&0<this._progress}},{key:"_enabled",set:function(I){I!==this._enabledInternal&&(I?this._start():this._stop())}},
{key:"test",get:function(){const I=this;return{lightDirections:this._lightDirections,get isDone(){return I._isDoneAccumulating},get isActive(){return I._isActive}}}}]);return H}(w);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_enabledInternal",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);
c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);c.__decorate([f.property()],
a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const E=new Uint8Array(4);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){const r=1/512;a.ShadowCastRenderer=function(q){function y(D,z,v,A){var t=B.call(this,{});t._techniqueRepository=D;t._rctx=z;t._data=v;t._requestRender=A;t._passParameters=new k.ShadowCastVisualizePassParameters(t._data.shadowCastTexture);t._techniqueConfig=new p.ShadowCastVisualizeTechniqueConfiguration;t._enabled=!1;t._vao=e.createQuadVAO(z);t._techniqueConfig.visualization=p.ShadowCastVisualization.Gradient;return t}b._inherits(y,q);var B=b._createSuper(y);
q=y.prototype;q.normalizeCtorArgs=function(){return{}};q.dispose=function(){this._stop();this._vao=n.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._technique=null};q.render=function(D){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var z=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(z,this._passParameters,D);this._rctx.drawArrays(z.primitiveType,0,h.vertexCount(this._vao,"geometry"))}};
q.setOptions=function(D){void 0!==D.enabled&&this._setEnabled(D.enabled);void 0!==D.color&&this._setColor(D.color);void 0!==D.threshold&&(this._threshold=D.threshold);void 0!==D.visualization&&(this._visualization=D.visualization);void 0!==D.bandSize&&(this._bandSize=D.bandSize);void 0!==D.bandsEnabled&&(this._bandsEnabled=D.bandsEnabled)};q._setColor=function(D){d.exactEquals(D,this._passParameters.color)||(d.copy(this._passParameters.color,D),this._requestRenderIfRunning())};q._setEnabled=function(D){D!==
this._enabled&&(D?this._start():this._stop())};q._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};q._start=function(){this._enabled=!0;this._requestRender()};q._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(y,[{key:"_visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(u.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._passParameters.opacityFromElevation},
set:function(D){this._passParameters.opacityFromElevation!==D&&(this._passParameters.opacityFromElevation=D,this.notifyChange("opacityFromElevation"))}},{key:"_showVisualization",get:function(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>r}},{key:"_threshold",get:function(){return this._passParameters.threshold},set:function(D){this._threshold!==D&&(this._passParameters.threshold=D,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},
set:function(D){D!==this._visualization&&(this._techniqueConfig.visualization=D,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},{key:"_bandSize",get:function(){return this._passParameters.bandSize},set:function(D){D!==this._bandSize&&(this._passParameters.bandSize=D,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(D){D!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=
D,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return y}(w);c.__decorate([x.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(y){const B=new d.ShaderBuilder,D=B.fragment;D.include(m.RgbaFloatEncoding);D.include(n.ReadLinearDepth);B.include(x.CameraSpace);B.include(w.ScreenSpacePass);const {visualization:z,bandsEnabled:v}=y;D.constants.add("inverseSampleValue","float",k.ShadowCastMaxSamples);D.uniforms.add([new e.Texture2DPassUniform("shadowCastMap",t=>t.shadowCastMap),new g.FloatPassUniform("sampleScale",t=>t.sampleScale),new g.FloatPassUniform("opacityFromElevation",t=>t.opacityFromElevation),
new l.Float4PassUniform("uColor",t=>t.color)]);y=z===u.ShadowCastVisualization.Gradient;const A=z===u.ShadowCastVisualization.Threshold;y&&v?D.uniforms.add(new g.FloatPassUniform("bandSize",t=>t.bandSize)):A&&D.uniforms.add(new g.FloatPassUniform("threshold",t=>t.threshold));D.code.add(f.glsl`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${A?f.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${y&&v?f.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${y?f.glsl`* strength`:""});
      }
    `);return B}let h=function(y){function B(z){var v=D.call(this);v.shadowCastMap=z;v.sampleScale=0;v.opacityFromElevation=1;v.color=c.clone(r);v.bandSize=.1;v.threshold=.5;return v}b._inherits(B,y);var D=b._createSuper(B);return b._createClass(B)}(f.NoParameters);const r=c.fromValues(.01,0,.25,1),q=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:h,build:p},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=q;a.ShadowCastVisualizePassParameters=h;a.build=
p})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){function p(y){const B=new k.ShaderBuilder,D=B.fragment;D.include(g.RgbaFloatEncoding);D.include(x.ReadLinearDepth);B.include(l.CameraSpace);B.include(n.ScreenSpacePass);B.include(m.ReadShadowMapPass,y);D.uniforms.add([new u.Texture2DPassUniform("depthMap",z=>z.linearDepthTexture),new e.Matrix4PassUniform("inverseViewMatrix",(z,v)=>c.invert(q,c.translate(q,v.camera.viewMatrix,v.camera.center))),new f.Float2PassUniform("nearFar",(z,v)=>v.camera.nearFar)]);D.constants.add("sampleValue",
"float",r);D.code.add(d.glsl`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`);return B}let h=function(y){function B(){return D.apply(this,arguments)}b._inherits(B,y);var D=b._createSuper(B);return b._createClass(B)}(m.ReadShadowMapBindParameters);const r=1/255,q=w.create();w=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:h,ShadowCastMaxSamples:255,build:p},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=w;a.ShadowCastAccumulatePassParameters=h;a.ShadowCastMaxSamples=255;a.build=p})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){a.ShadowCastVisualization=void 0;(function(x){x[x.Gradient=0]="Gradient";x[x.Threshold=1]="Threshold";x[x.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));let n=function(x){function m(){var g=l.apply(this,arguments);g.visualization=a.ShadowCastVisualization.Gradient;g.bandsEnabled=!1;return g}b._inherits(m,x);var l=b._createSuper(m);
return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter({count:a.ShadowCastVisualization.COUNT})],n.prototype,"visualization",void 0);c.__decorate([w.parameter()],n.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){n=function(e){function k(p,h){var r;return r=u.call(this,p,h,()=>r.destroy())}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new l.Program(p.rctx,k.shader.get().build(this.configuration),x.Default3D)};e.initializePipeline=function(){return d.makePipelineState({blending:m.blendingDefault,colorWrite:d.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(k,[{key:"primitiveType",get:function(){return f.PrimitiveType.TRIANGLE_STRIP}}]);
return k}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(g.ShadowCastVisualize,()=>new Promise((e,k)=>a(["./ShadowCastVisualize.glsl"],e,k)));b.ShadowCastVisualizeTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){n=function(e){function k(p){var h;return h=u.call(this,p,new g.ShadowConfiguration,()=>h.destroy())}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new m.Program(p.rctx,k.shader.get().build(this.configuration),x.Default3D)};e.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams,
depthTest:null,depthWrite:null})};c._createClass(k,[{key:"primitiveType",get:function(){return f.PrimitiveType.TRIANGLE_STRIP}}]);return k}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.ShadowCastAccumulate,()=>new Promise((e,k)=>a(["./ShadowCastAccumulate.glsl"],e,k)));b.ShadowCastAccumulateTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,w){let n=function(x){function m(){var g=l.apply(this,arguments);g.receiveShadows=!0;return g}b._inherits(m,x);var l=b._createSuper(m);return b._createClass(m)}(w.ShaderTechniqueConfiguration);c.__decorate([w.parameter()],n.prototype,"receiveShadows",void 0);a.ShadowConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowHighlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){let e=function(){function u(h,r){this._rctx=h;this._viewingMode=r;this._maxOpacity=1;this._passParameters=new f.ShadowHighlightPassParameters;this._drawParameters=new l.ReadShadowMapBindParameters;this._vao=g.createQuadVAO(this._rctx)}var p=u.prototype;p.render=function(h,r){if(h.shadowMap.enabled&&h.linearDepthTexture&&this.isVisible){var q=this._technique;this._drawParameters.origin=h.camera.center;this._rctx.bindFramebuffer(r);this._rctx.bindTechnique(q,this._passParameters,
h).bindDraw(this._drawParameters,h,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(q.primitiveType,0,d.vertexCount(this._vao,"geometry"))}};p.setDefaultOptions=function(h){this._passParameters={...this._passParameters,...h};this._updateMaxOpacity()};p.updateParameters=function(h,r){this._passParameters.opacityElevation=1-c.smoothstep(4E4,5E4,h.relativeElevation);h=this._viewingMode===m.ViewingMode.Global?n.normalize(k,h.center):n.set(k,0,0,1);r=n.dot(h,r);this._passParameters.dayNightTerminator=
c.smoothstep(0,1,c.clamp(30*r,0,1))};p.dispose=function(){this._vao=w.disposeMaybe(this._vao);this._techniqueCached=w.releaseMaybe(this._techniqueCached)};p._updateMaxOpacity=function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};b._createClass(u,[{key:"_technique",get:function(){w.isNone(this._techniqueCached)&&(this._techniqueCached=new f.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));
return this._techniqueCached}},{key:"gpuMemoryUsage",get:function(){return this._vao?.size??0}},{key:"isVisible",get:function(){const {opacityElevation:h,dayNightTerminator:r}=this._passParameters;return.001953125<=this._maxOpacity*h*r}}]);return u}();const k=x.create();a.ShadowHighlight=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ./ShadowConfiguration ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){n=function(u){function p(){var r=h.apply(this,arguments);r.shadowColor=w.fromValues(1,0,1,1);r.shadowOpacity=.2;r.occludedShadowOpacity=.1;r.opacityElevation=1;r.dayNightTerminator=1;return r}c._inherits(p,u);var h=c._createSuper(p);return c._createClass(p)}(n.NoParameters);m=function(u){function p(r){var q;return q=h.call(this,r,new f.ShadowConfiguration,()=>q.destroy())}c._inherits(p,u);var h=c._createSuper(p);u=p.prototype;u.initializeProgram=function(r){return new g.Program(r.rctx,
p.shader.get().build(this.configuration),l.Default3D)};u.initializePipeline=function(){return k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(p,[{key:"primitiveType",get:function(){return e.PrimitiveType.TRIANGLE_STRIP}}]);return p}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(d.ShadowHighlight,
()=>new Promise((u,p)=>a(["./ShadowHighlight.glsl"],u,p)));b.ShadowHighlightPassParameters=n;b.ShadowHighlightTechnique=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/maybe ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(H){const K=new D.ShaderBuilder;K.include(e.ReadShadowMapDraw,H);H=K.fragment;H.include(u.RgbaFloatEncoding);H.include(d.ReadLinearDepth);K.include(k.CameraSpace);K.include(g.ScreenSpacePass);H.uniforms.add([new z.Texture2DPassUniform("defaultDepthTex",(I,L)=>L.shadowMap.getSnapshot(v.SnapshotSlot.Default)),new z.Texture2DPassUniform("highlightDepthTex",(I,L)=>L.shadowMap.getSnapshot(v.SnapshotSlot.Highlight)),new z.Texture2DPassUniform("depthMap",
(I,L)=>L.linearDepthTexture),new z.Texture2DPassUniform("highlightMap",(I,L)=>L.highlightColorTexture),new r.Float4PassUniform("uColor",I=>I.shadowColor),new p.Float2PassUniform("nearFar",(I,L)=>L.camera.nearFar),new q.FloatPassUniform("opacity",I=>I.shadowOpacity),new q.FloatPassUniform("occludedOpacity",I=>I.occludedShadowOpacity),new q.FloatPassUniform("terminationFactor",I=>I.opacityElevation*I.dayNightTerminator),new h.Float3PassUniform("lightingMainDirectionView",(I,L)=>m.normalize(E,m.transformMat4(E,
L.lighting.mainLight.direction,L.camera.viewInverseTransposeMatrix))),new p.Float2PassUniform("texelSize",(I,L)=>b.isSome(L.linearDepthTexture)?n.set(F,1/L.linearDepthTexture.descriptor.width,1/L.linearDepthTexture.descriptor.height):x.ZEROS),new B.Matrix4PassUniform("inverseViewMatrix",(I,L)=>c.invert(C,c.translate(C,L.camera.viewMatrix,L.camera.center)))]);H.constants.add("unoccludedHighlightFlag","vec4",f.unoccludedHighlightFlag).add("highlightedThreshold","float",t.highlightedThreshold).add("selfShadowThreshold",
"float",t.selfShadowThreshold);H.code.add(y.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);H.code.add(y.glsl`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return K}const t={highlightedThreshold:.99999,selfShadowThreshold:.025},C=w.create(),E=l.create(),F=x.create();w=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=w;a.build=A})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function w(){this._plane=b.create()}a._createClass(w,[{key:"isEnabled",
get:function(){return!b.equals(this.plane,c)}},{key:"plane",get:function(){return this._plane},set:function(n){b.copy(n||c,this._plane)}}]);return w}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../core/shaderTechnique/ShaderTechniqueConfiguration ./BlendWeightsTechnique ./BlurTechnique ./EdgeDetectTechnique ./glUtil3D ../shaders/SMAAPassParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z){b.SmaaRenderPass=function(v){function A(C,E){var F=t.call(this,{});F._rctx=C;F._techniqueRep=E;F._passParameters=new y.SMAAPassParameters;F._isEnabled=!1;return F}c._inherits(A,v);var t=c._createSuper(A);v=A.prototype;v.normalizeCtorArgs=function(){return{}};v.dispose=function(){this._abortController=x.abortMaybe(this._abortController);this.disable()};v._loadResources=function(C){if(x.isSome(this._abortController))return!1;if(x.isSome(this._passParameters.searchTexture))return!0;
this._abortController=new AbortController;const E=this._abortController.signal;(new Promise((F,H)=>a(["./SmaaRenderPassData"],F,H))).then(F=>this._loadTextures(F,E)).then(()=>C()).finally(()=>this._abortController=null);return!1};v._loadTextures=function(C,E){m.throwIfAborted(E);return Promise.all([this._loadTextureFromBase64(C.areaTexture,B.TextureSamplingMode.LINEAR,B.PixelFormat.RGB),this._loadTextureFromBase64(C.searchTexure,B.TextureSamplingMode.NEAREST,B.PixelFormat.LUMINANCE)]).then(([F,H])=>
{m.isAborted(E)?(F.dispose(),H.dispose(),m.throwIfAborted(E)):(this._passParameters.areaTexture=F,this._passParameters.searchTexture=H)})};v.enable=function(C){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const E=new u.ShaderTechniqueConfiguration;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(r.EdgeDetectTechnique,E,this._edgeDetectTechnique);this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(p.BlendWeightsTechnique,
E,this._blendWeightsTechnique);this._blurTechnique=this._techniqueRep.releaseAndAcquire(h.BlurTechnique,E,this._blurTechnique)}if(!this._loadResources(C))return!1;this._vao=q.createScreenSizeTriangleVAO(this._rctx);this._passParameters.edges=new D.FramebufferObject(this._rctx,{colorTarget:B.TargetType.TEXTURE,depthStencilTarget:B.DepthStencilTargetType.NONE},{target:B.TextureType.TEXTURE_2D,pixelFormat:B.PixelFormat.RGB,dataType:B.PixelType.UNSIGNED_BYTE,samplingMode:B.TextureSamplingMode.LINEAR,
wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._passParameters.blend=new D.FramebufferObject(this._rctx,{colorTarget:B.TargetType.TEXTURE,depthStencilTarget:B.DepthStencilTargetType.NONE},{target:B.TextureType.TEXTURE_2D,pixelFormat:B.PixelFormat.RGBA,dataType:B.PixelType.UNSIGNED_BYTE,samplingMode:B.TextureSamplingMode.LINEAR,wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};v.disable=function(){this._isEnabled&&(this._vao=x.disposeMaybe(this._vao),
this._passParameters.areaTexture=x.disposeMaybe(this._passParameters.areaTexture),this._passParameters.searchTexture=x.disposeMaybe(this._passParameters.searchTexture),this._passParameters.blend=x.disposeMaybe(this._passParameters.blend),this._passParameters.edges=x.disposeMaybe(this._passParameters.edges),this._isEnabled=!1)};v.render=function(C){const E=this._validPassParameters;if(!x.isNone(E)){E.colorTexture=C;var F=this._rctx,H=F.getBoundFramebufferObject(),K=C.descriptor.width;C=C.descriptor.height;
F.bindVAO(this._vao);F.setViewport(0,0,K,C);E.edges.resize(K,C);F.bindFramebuffer(E.edges);F.setClearColor(0,0,0,1);F.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._edgeDetectTechnique,E,null);F.drawArrays(B.PrimitiveType.TRIANGLES,0,3);E.blend.resize(K,C);F.bindFramebuffer(E.blend);F.setClearColor(0,0,1,1);F.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._blendWeightsTechnique,E,null);F.drawArrays(B.PrimitiveType.TRIANGLES,0,3);F.bindFramebuffer(H);F.setClearColor(0,
1,0,1);F.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._blurTechnique,E,null);F.drawArrays(B.PrimitiveType.TRIANGLES,0,3)}};v._loadTextureFromBase64=function(C,E,F){return k.requestImage(C).then(H=>new z.Texture(this._rctx,{pixelFormat:F,dataType:B.PixelType.UNSIGNED_BYTE,wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,width:H.width,height:H.height,samplingMode:E},H))};c._createClass(A,[{key:"updating",get:function(){return x.isSome(this._abortController)}},{key:"_validPassParameters",get:function(){return this._isEnabled?
this._passParameters:null}}]);return A}(n);w.__decorate([l.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);w.__decorate([l.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=w.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BlendWeightsTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/BlendWeights.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.BlendWeights,()=>new Promise((f,d)=>a(["../shaders/BlendWeights.glsl"],f,d)));
b.BlendWeightsTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,b,c,w,n,x){function m(){const f=new c.ShaderBuilder,{attributes:d,
varyings:e,vertex:k,fragment:u}=f;d.add(n.VertexAttribute.POSITION,"vec2");e.add("uv","vec2");e.add("offsets[2]","vec4");e.add("maxOffset","vec4");e.add("pixelCoord","vec2");x.addResolutionUniform(k);k.code.add(b.glsl`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.glsl.int(l.maxSearchSteps)} );
      }
    `);u.uniforms.add(new w.Texture2DPassUniform("edgesTexture",p=>p.edges.colorTexture));u.uniforms.add(new w.Texture2DPassUniform("areaTexture",p=>p.areaTexture));u.uniforms.add(new w.Texture2DPassUniform("searchTexture",p=>p.searchTexture));x.addResolutionUniform(u);u.code.add(b.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(l.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(l.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(l.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(l.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.glsl.int(l.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `);return f}const l={maxSearchSteps:8,maxDistanceAreaTex:16},g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=g;a.build=m})},"esri/views/3d/webgl-engine/shaders/SMAAPassParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces".split(" "),function(a,b,c,w,n,x){x=function(g){function f(){return d.apply(this,
arguments)}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(x.NoParameters);let m=function(g){function f(){return d.apply(this,arguments)}b._inherits(f,g);var d=b._createSuper(f);return b._createClass(f)}(x);const l=w.create();a.SMAAPassParameters=x;a.ValidSMAAPassParameters=m;a.addResolutionUniform=function(g){g.uniforms.add(new n.Float4PassUniform("resolution",f=>{var {descriptor:d}=f.colorTexture;f=d.width;d=d.height;return c.set(l,1/f,1/d,f,d)}))};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/Blur.glsl ../../../webgl/renderState".split(" "),function(a,b,c,w,n,x,m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=
function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.Blur,()=>new Promise((f,d)=>a(["../shaders/Blur.glsl"],f,d)));b.BlurTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),
function(a,b,c,w,n,x){function m(){const g=new c.ShaderBuilder,{attributes:f,varyings:d,vertex:e,fragment:k}=g;f.add(n.VertexAttribute.POSITION,"vec2");d.add("uv","vec2");d.add("offsets[2]","vec4");x.addResolutionUniform(e);e.code.add(b.glsl`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`);k.uniforms.add(new w.Texture2DPassUniform("blendWeightsTexture",u=>u.blend.colorTexture));k.uniforms.add(new w.Texture2DPassUniform("colorTexture",u=>u.colorTexture));x.addResolutionUniform(k);k.code.add(b.glsl`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`);return g}const l=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.Blur=l;a.build=m})},"esri/views/3d/webgl-engine/lib/EdgeDetectTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/EdgeDetect.glsl ../../../webgl/renderState".split(" "),function(a,b,c,w,n,x,
m,l,g){n=function(f){function d(){return e.apply(this,arguments)}c._inherits(d,f);var e=c._createSuper(d);f=d.prototype;f.initializeProgram=function(k){return new m.Program(k.rctx,d.shader.get().build(),x.Default3D)};f.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};return c._createClass(d)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.EdgeDetect,()=>new Promise((f,d)=>a(["../shaders/EdgeDetect.glsl"],f,d)));b.EdgeDetectTechnique=n;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,b,c,w,n,x){function m(){const f=new c.ShaderBuilder,{attributes:d,varyings:e,vertex:k,fragment:u}=f;d.add(n.VertexAttribute.POSITION,
"vec2");x.addResolutionUniform(k);e.add("uv","vec2");e.add("offsets[3]","vec4");k.code.add(b.glsl`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`);u.uniforms.add(new w.Texture2DPassUniform("colorTexture",p=>p.colorTexture));u.code.add(b.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.glsl.float(l.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.glsl.float(l.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `);return f}const l={threshold:.05,localConstrastAdaption:2},g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=g;a.build=m})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/WatchUpdatingTracking ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q){function W(ea){l.isSome(ea)&&(ea.vao.vertexBuffers.instances.dispose(),ea.vao.dispose(!1),ea.vao=null)}function V(ea){let ja=null,ka=null;for(let da=0;da<ea.geometries.length;da++){const ha=ea.geometries[da];if(ha.material.supportsEdges){if(!ja)ja=ha.transformation;else if(!n.equals(ja,ha.transformation))return!1;if(!ka&&l.isSome(ha.localOrigin))ka=ha;else if(ka&&l.isSome(ka.localOrigin)&&l.isSome(ha.localOrigin)&&
ka.localOrigin.id!==ha.localOrigin.id)return!1}}return!0}function T(ea,ja,ka){ja*=ka;ka=n.binaryIndexOf(ea,ja,!0);return-1===ka?ja<ea[0]?ea.length:0:ea.length-ka}a.EdgeView=function(ea){function ja(da){var ha=ka.call(this,da);ha._updatingHandles=new q.WatchUpdatingTracking;ha._perObjectData=new Map;ha._perObjectDataEvictionCache=new Set;ha._renderers=new Map;ha._gpuMemoryUsage=0;ha._workerAbort=new AbortController;ha._tmpModelPosition=r.create();ha._localOrigins=new C.LocalOriginManager(new A.GridLocalOriginFactory(da.renderSR));
return ha}b._inherits(ja,ea);var ka=b._createSuper(ja);ea=ja.prototype;ea.initialize=function(){this._worker=new J.EdgeWorkerHandle(this.schedule);this._componentColorManager=new U.BufferManager(this.rctx,3);const da=K.VertexLayout.createBuffer(4);for(let ha=0;4>ha;ha++)da.sideness.set(ha,0,0===ha||3===ha?0:1),da.sideness.set(ha,1,0===ha||1===ha?0:1);this._verticesBufferObject=S.BufferObject.createVertex(this.rctx,Q.Usage.STATIC_DRAW,da.buffer)};ea.destroy=function(){this.destroyed||(this._perObjectData.forEach(da=>
this._discardObjectEntry(da)),this._perObjectData.clear(),this._strokesTexture=l.disposeMaybe(this._strokesTexture),this._componentColorManager=l.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=l.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())};ea.shouldRender=function(){return 0<this._renderers.size};ea.addComponentObject=async function(da,ha,ca,fa,ma,qa,wa,xa){if(this.hasObject(da))return this.getObjectMemoryUsage(da);
let pa;ca=new X(new Promise(ra=>pa=ra),ca.center,ca.radius);this._perObjectData.set(da,ca);da=await this._updatingHandles.addPromise(this._addComponentGeometry(ha,ca,fa,ma,qa,wa,xa));this.setNeedsRender();pa();return da};ea.addOrUpdateObject3D=async function(da,ha,ca,fa){if(this.destroyed)x.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");else{var ma=this._perObjectData.get(da);0<ma?.renderables.length&&this._perObjectDataEvictionCache.add(ma);var qa,wa=da.boundingVolumeWorldSpace.bounds;
wa=new X(new Promise(pa=>qa=pa),y.getCenter(wa),y.getRadius(wa));this._perObjectData.set(da,wa);var xa=[];if(ca.mergeGeometries&&1<da.geometries.length&&V(da))xa.push(this._addObjectMergedGeometries(da,wa,ha,ca,fa));else for(let pa=0;pa<da.geometries.length;pa++){const ra=da.geometries[pa];ra.material.supportsEdges&&xa.push(this._addGeometry(da,wa,ra,ha[0],ca,fa))}await this._updatingHandles.addPromise(Promise.all(xa));this._perObjectDataEvictionCache.delete(wa);this._discardObjectEntry(ma);this.setNeedsRender();
qa()}};ea._discardObjectEntry=function(da){da&&(da.renderables.length&&(da.renderables.forEach(ha=>this._removeRenderable(ha)),this.setNeedsRender()),da.loaded=null)};ea.hasObject=function(da){return this._perObjectData.has(da)};ea.updateAllComponentOpacities=async function(da,ha){da=await this._updatingHandles.addPromise(this._getObjectEntry(da));if(!l.isNone(da)){var ca=ha instanceof Array?fa=>ha[fa]:()=>ha;da.renderables.forEach(fa=>{const ma=fa.components.meta.length;for(let qa=0;qa<ma;qa++){const wa=
ca(qa),xa=fa.components.meta[qa],pa=xa.index;xa.material.opacity=wa;fa.components.buffer.textureBuffer.setDataElement(pa,1,3,255*wa)}this._updateTransparency(fa)});this.setNeedsRender()}};ea.getObjectMemoryUsage=async function(da){da=await this._getObjectEntry(da);return l.isSome(da)?da.renderables.reduce((ha,ca)=>ha+ca.statistics.gpuMemoryUsage,0):0};ea.updateAllComponentMaterials=async function(da,ha,ca,fa){const ma=da instanceof E.Object3D,qa=!!ca.hasSlicePlane,wa=P.determineRendererType(ha),xa=
R.EdgeRenderer.getKey(wa,qa,ma);da=await this._updatingHandles.addPromise(this._getObjectEntry(da));l.isNone(da)||(da.renderables.forEach(pa=>{if(xa!==pa.rendererKey){var ra=this._renderers.get(pa.rendererKey);const va=this._acquireRenderer(wa,qa,ma);ra.removeRenderable(pa);--ra.refCount;pa.rendererKey=xa;va.addRenderable(pa)}for(ra=0;ra<ha.length;ra++)pa.components.meta[ra].material=ha[ra];fa&&this._updateComponentBuffer(pa.components);this._updateTransparency(pa)}),this.setNeedsRender())};ea.updateAllVerticalOffsets=
async function(da,ha){da=await this._updatingHandles.addPromise(this._getObjectEntry(da));l.isNone(da)||(da.renderables.forEach(ca=>{const fa=ca.components.meta;for(let ma=0;ma<fa.length;ma++)ca.components.meta[ma].verticalOffset=ha?.[ma]??0;this._updateComponentBuffer(ca.components)}),this.setNeedsRender())};ea.updateObjectVisibility=async function(da,ha){da=await this._updatingHandles.addPromise(this._getObjectEntry(da));l.isSome(da)&&(da.renderables.forEach(ca=>ca.visible=ha),this.setNeedsRender())};
ea.removeObject=function(da){const ha=this._perObjectData.get(da);ha&&(this._perObjectData.delete(da),this._discardObjectEntry(ha))};ea._getObjectEntry=async function(da){da=this._perObjectData.get(da);if(!da)throw Error("no object");await da.loaded;return null==da.loaded?null:da};ea.render=function(da,ha){if(!l.isNone(this._componentColorManager)){this._localOrigins.updateViewMatrices(da.camera.viewMatrix);var ca=da.camera.viewInverseTransposeMatrix,fa=r.create(),ma=new v.TwoVectorPosition,qa=0,
wa=0;this._renderers.forEach(pa=>{if(0===pa.refCount)this._renderers.delete(pa.key),pa.dispose();else{let ra=!0,va=!0;pa.forEachRenderable(Ba=>{Ba.visible&&(qa+=Ba.statistics.averageEdgeLength,wa++,ra&&Ba.regular&&(pa.updateTechnique(da,!1),ra=!1),va&&Ba.silhouette&&(pa.updateTechnique(da,!0),va=!1))},ha)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==wa){var xa=new O.EdgePassParameters(40*qa/wa,ha);h.set(fa,ca[3],ca[7],ca[11]);ma.set(fa);h.copy(xa.transformWorldFromViewTH,
ma.high);h.copy(xa.transformWorldFromViewTL,ma.low);k.fromMat4(xa.transformViewFromCameraRelativeRS,da.camera.viewMatrix);k.transpose(ba,xa.transformViewFromCameraRelativeRS);k.invert(xa.transformNormalViewFromGlobal,ba);xa.transformProjFromView=da.camera.projectionMatrix;this._updateObjectCameraDistances(da);this._renderers.forEach(pa=>{this._renderRegularEdges(pa,da,xa);this._renderSilhouetteEdges(pa,da,xa)})}}};ea._updateTransparency=function(da){const ha=P.determineEdgeTransparency(da.components.meta),
ca=P.determineObjectTransparency(da.components.meta);if(ha!==da.edgeTransparency||ca!==da.objectTransparency)da.edgeTransparency=ha,da.objectTransparency=ca,this._renderers.get(da.rendererKey).setRenderablesDirty()};ea._computeModelTransformWithLocalOrigin=function(da,ha,ca){da.getCombinedStaticTransformation(ha,ca);da=l.isSome(ha.localOrigin)?this._localOrigins.register(ha.localOrigin):this._localOrigins.acquire(h.set(this._tmpModelPosition,ca[12],ca[13],ca[14]));ha.localOrigin=da.origin;t.applyToModelMatrix(da.origin.vec3,
ca);return da};ea._updateComponentBuffer=function(da){const {meta:ha,buffer:ca}=da;da=new Uint8Array(4);for(let ma=0;ma<ha.length;ma++){var fa=ha[ma].material;const qa=ha[ma].index,wa=m.clamp(Math.round(fa.size*R.LINE_WIDTH_FRACTION_FACTOR),0,255),xa=m.clamp(fa.extensionLength,-R.EXTENSION_LENGTH_OFFSET,255-R.EXTENSION_LENGTH_OFFSET)+R.EXTENSION_LENGTH_OFFSET,pa="solid"===fa.type?L.EdgeType.SOLID:L.EdgeType.SKETCH,ra=255*fa.opacity;fa=fa.color;ca.textureBuffer.setData(qa,0,255*fa[0],255*fa[1],255*
fa[2],255*fa[3]);ca.textureBuffer.setData(qa,1,wa,xa,pa,ra);z.encodeElevationOffset(ha[ma].verticalOffset,da);ca.textureBuffer.setData(qa,2,da[0],da[1],da[2],da[3])}};ea._createComponentBuffers=function(da){if(l.isNone(this._componentColorManager))return null;const ha=[],ca=this._componentColorManager.getBuffer(da.length);for(let fa=0;fa<da.length;fa++){const ma=da[fa],qa=ca.acquireIndex();ha.push({index:qa,verticalOffset:0,material:ma})}da=new Z(ca,ha);this._updateComponentBuffer(da);return da};
ea._extractEdges=function(da,ha,ca,fa,ma,qa=ma.length){return this._worker.process({data:ha,indices:ma,indicesLength:qa,writerSettings:da,skipDeduplicate:ca},this._workerAbort.signal,fa)};ea._createRenderable=function(da,ha,ca,fa,ma){var qa=pa=>l.isSome(this._verticesBufferObject)?new Y(new F.VertexArrayObject(this.rctx,K.EdgeShaderAttributeLocations,{vertices:K.glVertexLayout,instances:pa===N.EdgeSilhouette.REGULAR?I.RegularEdgeBufferWriter.glLayout:I.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,
instances:S.BufferObject.createVertex(this.rctx,Q.Usage.STATIC_DRAW,pa===N.EdgeSilhouette.REGULAR?da.regular.instancesData.buffer:da.silhouette.instancesData.buffer)}),pa===N.EdgeSilhouette.REGULAR?da.regular.lodInfo:da.silhouette.lodInfo):null;const wa=0<da.regular.lodInfo.lengths.length?qa(N.EdgeSilhouette.REGULAR):null;qa=0<da.silhouette.lodInfo.lengths.length?qa(N.EdgeSilhouette.SILHOUETTE):null;const xa=(l.isSome(wa)?wa.vao.size:0)+(l.isSome(qa)?qa.vao.size:0);return new ia(wa,qa,{gpuMemoryUsage:xa,
externalMemoryUsage:ma,averageEdgeLength:da.averageEdgeLength},ca,P.determineEdgeTransparency(ha.meta),P.determineObjectTransparency(ha.meta),ha,fa)};ea._addGeometry=async function(da,ha,ca,fa,ma,qa){var wa=ca.vertexAttributes.get(H.VertexAttribute.POSITION);const xa=ca.indices.get(H.VertexAttribute.POSITION),pa=p.create();da=this._computeModelTransformWithLocalOrigin(da,ca,pa);wa=new na(wa,xa,pa,da);return this._addPositionData(ha,wa,ca.edgeIndicesLength,fa,ma,qa)};ea._addPositionData=async function(da,
ha,ca,fa,ma,qa=!1){if(null!=da.loaded){var wa=this._createComponentBuffers([fa]);if(!(l.isNone(wa)||0>=ca)){fa=this._acquireRenderer(fa.type,!!ma.hasSlicePlane,!0);var {modelTransform:xa,origin:pa}=ha;ma=ha.indices;ha=ha.position;var ra=ha.data.length/ha.size,va=K.EdgeInputBufferLayout.createBuffer(ra);for(let Ba=0;Ba<ra;Ba++)va.position.set(Ba,0,ha.data[Ba*ha.size]),va.position.set(Ba,1,ha.data[Ba*ha.size+1]),va.position.set(Ba,2,ha.data[Ba*ha.size+2]);P.fillComponenBufferIndices(wa.meta,[0,va.componentIndex.count],
va.componentIndex);ca=await this._updatingHandles.addPromise(this._extractEdges(fa.writerSettings,va,!1,qa,ma,ca));null!=da.loaded&&(wa=this._createRenderable(ca,wa,new aa(xa,pa),fa.key,!1),da.renderables.push(wa),fa.addRenderable(wa),this._gpuMemoryUsage+=wa.statistics.gpuMemoryUsage)}}};ea._addComponentGeometry=async function(da,ha,ca,fa,ma,qa,wa){if(null==ha.loaded)return 0;const xa=this._createComponentBuffers(qa);if(l.isNone(xa))return 0;qa=P.determineRendererType(qa);wa=this._acquireRenderer(qa,
wa.hasSlicePlane||!1,!1);qa=K.EdgeInputBufferLayout.createBuffer(ca.length/3);B.copy(qa.position.typedBuffer,ca,qa.position.typedBufferStride,3);P.fillComponenBufferIndices(xa.meta,ma,qa.componentIndex,fa);ca=await this._updatingHandles.addPromise(this._extractEdges(wa.writerSettings,qa,!0,!1,fa));if(null==ha.loaded)return 0;da=this._createRenderable(ca,xa,da,wa.key,!0);ha.renderables.push(da);wa.addRenderable(da);return da.statistics.gpuMemoryUsage};ea._addObjectMergedGeometries=async function(da,
ha,ca,fa,ma){var qa=new Map,wa=0,xa=null,pa=0;for(var ra=0;ra<da.geometries.length;ra++){var va=da.geometries[ra];if(va.material.supportsEdges){!xa&&va.localOrigin&&(xa=va);var Ba=va.vertexAttributes.get(H.VertexAttribute.POSITION);pa+=Ba.data.length/Ba.size;wa+=va.edgeIndicesLength}}pa=65536<=pa?Uint32Array:Uint16Array;wa=wa?new pa(wa):null;pa=[];ra=0;for(va=0;va<da.geometries.length;va++){Ba=da.geometries[va];if(!Ba.material.supportsEdges)continue;var Aa=Ba.vertexAttributes.get(H.VertexAttribute.POSITION);
const Ha=Ba.indices.get(H.VertexAttribute.POSITION);let Ka=qa.get(Aa.data);if(null==Ka){Ka=pa.length/3;for(let Pa=0;Pa<Aa.data.length;Pa+=Aa.size)pa.push(Aa.data[Pa]),pa.push(Aa.data[Pa+1]),pa.push(Aa.data[Pa+2]);qa.set(Aa.data,Ka)}if(Ha)for(Aa=0;Aa<Ba.edgeIndicesLength;Aa++)wa[ra++]=Ka+Ha[Aa]}xa=xa||da.geometries[0];qa=p.create();xa=this._computeModelTransformWithLocalOrigin(da,xa,qa);for(ra=0;ra<da.geometries.length;ra++)da.geometries[ra].localOrigin=xa.origin;da=new na({data:pa,size:3},wa,qa,xa);
await this._updatingHandles.addPromise(this._addPositionData(ha,da,wa.length,ca[0],fa,ma))};ea._acquireRenderer=function(da,ha,ca){const fa=R.EdgeRenderer.getKey(da,ha,ca);let ma=this._renderers.get(fa);l.isNone(this._strokesTexture)&&(this._strokesTexture=G.generateStrokesTexture(this.rctx));ma||(ma=new R.EdgeRenderer(this.rctx,this.techniqueRepository,{type:da,hasSlicePlane:ha,strokesTexture:this._strokesTexture,legacy:ca,spherical:this.viewingMode===D.ViewingMode.Global}),this._renderers.set(fa,
ma));++ma.refCount;return ma};ea._removeRenderable=function(da){W(da.regular);W(da.silhouette);const ha=this._renderers.get(da.rendererKey);if(ha){ha.removeRenderable(da);--ha.refCount;"origin"in da.transform&&this._localOrigins.release(da.transform.origin);this._gpuMemoryUsage-=da.statistics.externalMemoryUsage?0:da.statistics.gpuMemoryUsage;for(const ca of da.components.meta)da.components.buffer.releaseIndex(ca.index)}};ea._updateObjectCameraDistances=function(da){const ha=da.camera.eye,ca=da.camera.viewForward,
fa=r.create();da=ma=>{h.sub(fa,ma.center,ha);const qa=h.dot(fa,ca),wa=ma.radius,xa=qa<-wa?Infinity:qa<wa?0:qa-wa;ma.renderables.forEach(pa=>pa.distanceToCamera=xa)};this._perObjectData.forEach(da);this._perObjectDataEvictionCache.forEach(da)};ea._renderRegularEdges=function(da,ha,ca){const fa=da.bindRegularEdges(ca,ha),ma=ha.camera.perScreenPixelRatio;da.forEachRenderable(qa=>{if(l.isSome(qa.regular)&&qa.visible){var wa=T(qa.regular.lod.lengths,qa.distanceToCamera,ma);da.renderRegularEdges(fa,qa,
ca,ha,wa)}},ca.transparency)};ea._renderSilhouetteEdges=function(da,ha,ca){const fa=da.bindSilhouetteEdges(ca,ha),ma=ha.camera.perScreenPixelRatio;da.forEachRenderable(qa=>{if(l.isSome(qa.silhouette)&&qa.visible){var wa=T(qa.silhouette.lod.lengths,qa.distanceToCamera,ma);da.renderSilhouetteEdges(fa,qa,ca,ha,wa)}},ca.transparency)};b._createClass(ja,[{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"usedMemory",get:function(){return this._gpuMemoryUsage}},{key:"test",get:function(){return{hasRenderedPrimitives:da=>
{let ha=!1;const ca=da.perScreenPixelRatio,fa=(ma,qa)=>ma.forEachRenderable(wa=>{wa.visible&&!ha&&(l.isSome(wa.regular)&&(ha=0<T(wa.regular.lod.lengths,wa.distanceToCamera,ca)),!ha&&l.isSome(wa.silhouette)&&(ha=0<T(wa.silhouette.lod.lengths,wa.distanceToCamera,ca)))},qa);this._renderers.forEach(ma=>{ha||(fa(ma,M.Transparency.OPAQUE),fa(ma,M.Transparency.TRANSPARENT))});return ha}}}}]);return ja}(w);c.__decorate([g.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([g.property({constructOnly:!0})],
a.EdgeView.prototype,"renderSR",void 0);c.__decorate([g.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);c.__decorate([g.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([g.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);c.__decorate([g.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);c.__decorate([g.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);c.__decorate([g.property({readOnly:!0})],
a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);let X=b._createClass(function(ea,ja,ka){this.center=ja;this.radius=ka;this.renderables=[];this.loaded=ea;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}),Z=b._createClass(function(ea,ja){this.buffer=ea;this.meta=ja}),Y=b._createClass(function(ea,ja){this.vao=ea;this.lod=ja}),aa=b._createClass(function(ea,ja){this.modelMatrix=ea;this.origin=ja}),
ia=b._createClass(function(ea,ja,ka,da,ha,ca,fa,ma){this.regular=ea;this.silhouette=ja;this.statistics=ka;this.transform=da;this.edgeTransparency=ha;this.objectTransparency=ca;this.components=fa;this.rendererKey=ma;this.distanceToCamera=0;this.visible=!0});c=function(ea){function ja(){return ka.apply(this,arguments)}b._inherits(ja,ea);var ka=b._createSuper(ja);return b._createClass(ja)}(ia);w=function(ea){function ja(){return ka.apply(this,arguments)}b._inherits(ja,ea);var ka=b._createSuper(ja);return b._createClass(ja)}(ia);
let na=b._createClass(function(ea,ja,ka,da){this.position=ea;this.indices=ja;this.modelTransform=ka;this.origin=da});const ba=u.create();a.LegacyTransform=aa;a.RegularRenderable=c;a.Renderable=ia;a.SilhouetteRenderable=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,c){const w=-b[0],n=-b[1];b=-b[2];const x=c[3],m=c[7],l=c[11],g=c[15];c[0]+=x*w;c[1]+=x*n;c[2]+=
x*b;c[4]+=m*w;c[5]+=m*n;c[6]+=m*b;c[8]+=l*w;c[9]+=l*n;c[10]+=l*b;c[12]+=g*w;c[13]+=g*n;c[14]+=g*b};a.applyToViewMatrix=function(b,c){const w=b[0],n=b[1];b=b[2];c[12]+=w*c[0]+n*c[4]+b*c[8];c[13]+=w*c[1]+n*c[5]+b*c[9];c[14]+=w*c[2]+n*c[6]+b*c[10];c[14]+=w*c[3]+n*c[7]+b*c[11]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat4","../../../../chunks/mat4f64",
"./localOriginHelper"],function(a,b,c,w,n){let x=function(){function l(f){this._factory=f;this._originData=new Map}var g=l.prototype;g.acquire=function(f){return this.register(this._factory.getOrigin(f))};g.register=function(f){f=this._originData.get(f.id)||new m(f);f.refCount++;this._originData.has(f.origin.id)||this._originData.set(f.origin.id,f);return f};g.release=function(f){f.refCount--;0===f.refCount&&this._originData.delete(f.origin.id)};g.updateViewMatrices=function(f){this._originData.forEach(d=>
{c.copy(d.viewMatrix,f);n.applyToViewMatrix(d.origin.vec3,d.viewMatrix)})};return b._createClass(l)}(),m=b._createClass(function(l){this.origin=l;this.refCount=0;this.viewMatrix=w.create()});a.LocalOriginManager=x;a.OriginData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){const h={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},r={solid:u.EdgeUtilMode.SOLID,sketch:u.EdgeUtilMode.SKETCH,uber:u.EdgeUtilMode.MIXED};u=function(){function y(D,z,v){this._rctx=D;this._shaderTechniqueRepository=z;this._configuration=new e.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[k.Transparency.TRANSPARENT]:{[k.Transparency.TRANSPARENT]:new w,[k.Transparency.OPAQUE]:new w},
[k.Transparency.OPAQUE]:{[k.Transparency.TRANSPARENT]:new w,[k.Transparency.OPAQUE]:new w}};this._renderablesDirty=!1;this._drawParameters=new f.EdgeDrawParameters;this._settings={...h,...v};this.key=y.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:l.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=r[this._settings.type];this._configuration.silhouette=
!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=D.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=v.spherical}var B=y.prototype;B.dispose=function(){this._technique=c.releaseMaybe(this._technique)};B.addRenderable=function(D){this._renderables.add(D);this._renderablesDirty=!0};B.removeRenderable=function(D){this._renderables.delete(D);
this._renderablesDirty=!0};B.setRenderablesDirty=function(){this._renderablesDirty=!0};B.forEachRenderable=function(D,z){this._renderablesDirty&&this._sortRenderables();this._sortedRenderables[z][k.Transparency.TRANSPARENT].forAll(D);this._sortedRenderables[z][k.Transparency.OPAQUE].forAll(D)};B.updateTechnique=function(D,z){this._configuration.hasMultipassTerrain=!!D.multipassTerrain.enabled;this._configuration.cullAboveGround=!!D.multipassTerrain.cullAboveGround;this._configuration.silhouette=z;
return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(d.EdgeShaderTechnique,this._configuration,this._technique)};B.bindRegularEdges=function(D,z){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(z,!1),D,z)};B.bindSilhouetteEdges=function(D,z){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(z,!0),D,z)};B.renderRegularEdges=function(D,z,v,A,t){this._render(D,z,z.regular.vao,v,A,t)};B.renderSilhouetteEdges=function(D,z,v,A,
t){this._render(D,z,z.silhouette.vao,v,A,t)};B._render=function(D,z,v,A,t,C){0<C&&(this._bindDraw(D,z,A,t),this._rctx.bindVAO(v),this._rctx.capabilities.instancing.drawArraysInstanced(p.PrimitiveType.TRIANGLE_FAN,0,4,C))};B._bindDraw=function(D,z,v,A){this._drawParameters.componentDataTexture=z.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in z.transform)this._lastOriginId!==z.transform.origin.origin.id&&(D.setUniformMatrix4fv("localView",
z.transform.origin.viewMatrix),this._lastOriginId=z.transform.origin.origin.id),D.setUniformMatrix4fv("model",z.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=z.transform.origin.origin.vec3;else{const t=new g.TwoVectorPosition(z.transform.position),C=n.transpose(q,n.invert(q,z.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=t.low;this._drawParameters.transformWorldFromModelTH=t.high;this._drawParameters.transformWorldFromModelRS=z.transform.rotationScale;
this._drawParameters.transformNormalGlobalFromModel=C;z=A.camera.viewInverseTransposeMatrix;m.set(this._drawParameters.slicePlaneLocalOrigin,z[3],z[7],z[11])}D.bindDraw(this._drawParameters,A,v)};B._sortRenderables=function(){this._renderablesDirty=!1;this._sortedRenderables[k.Transparency.TRANSPARENT][k.Transparency.TRANSPARENT].clear();this._sortedRenderables[k.Transparency.TRANSPARENT][k.Transparency.OPAQUE].clear();this._sortedRenderables[k.Transparency.OPAQUE][k.Transparency.TRANSPARENT].clear();
this._sortedRenderables[k.Transparency.OPAQUE][k.Transparency.OPAQUE].clear();this._renderables.forEach(z=>{z.objectTransparency!==k.Transparency.INVISIBLE&&z.edgeTransparency!==k.Transparency.INVISIBLE&&this._sortedRenderables[z.objectTransparency][z.edgeTransparency].push(z)});const D=(z,v)=>"origin"in z.transform?"origin"in v.transform?z.transform.origin.origin.id<v.transform.origin.origin.id?-1:z.transform.origin.origin.id>v.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[k.Transparency.TRANSPARENT][k.Transparency.TRANSPARENT].sort(D);
this._sortedRenderables[k.Transparency.TRANSPARENT][k.Transparency.OPAQUE].sort(D);this._sortedRenderables[k.Transparency.OPAQUE][k.Transparency.TRANSPARENT].sort(D);this._sortedRenderables[k.Transparency.OPAQUE][k.Transparency.OPAQUE].sort(D)};y.getKey=function(D,z,v){return`edges-t:${D}:${z}:${v}`};return b._createClass(y)}();const q=x.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=u;a.LINE_WIDTH_FRACTION_FACTOR=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,c,w,n){let x=function(m){function l(f,d){var e=g.call(this);e.distanceFalloffFactor=f;e.transparency=d;e.transformNormalViewFromGlobal=c.create();return e}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(n.VertexPositionPassParameters);n=function(m){function l(){var f=g.apply(this,arguments);f.transformNormalViewFromGlobal=
c.create();f.slicePlaneLocalOrigin=w.create();f.transformNormalGlobalFromModel=c.create();return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(n.VertexPositionDrawParameters);a.EdgeDrawParameters=n;a.EdgePassParameters=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f){n=function(d){function e(){return k.apply(this,arguments)}c._inherits(e,d);var k=c._createSuper(e);d=e.prototype;d.initializeProgram=function(u){return new x.Program(u.rctx,e.shader.get().build(this.configuration),m.EdgeShaderAttributeLocations)};d.initializePipeline=function(u){return u.blendMinMax?f.makePipelineState({blending:f.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ZERO,g.BlendFactor.ONE,g.BlendOperation.ADD,u.blendMinMax.MAX),depthTest:{func:g.CompareFunction.LEQUAL},
colorWrite:f.defaultColorWriteParams}):f.makePipelineState({depthTest:{func:g.CompareFunction.LEQUAL},depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(l.EdgeShader,()=>new Promise((d,e)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],d,e)));b.EdgeShaderTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){function D(A){const t=new d.ShaderBuilder,{vertex:C,fragment:E}=t;A.legacy&&C.uniforms.add([new v("model"),new v("localView")]);t.include(u.AdjustProjectedPosition,A);t.include(r.EdgeUtil,A);t.include(q.LineAmplitude,A);t.include(B.UnpackAttributes,A);t.include(y.LineOffset,A);t.include(n.SliceDraw,A);t.include(h.DiscardNonSilhouetteEdges,A);t.include(p.DiscardByCoverage,A);t.include(x.multipassTerrainTest,A);t.varyings.add("vColor","vec4");t.varyings.add("vRadius",
"float");t.varyings.add("vPosition","vec3");t.varyings.add("vWorldPosition","vec3");t.varyings.add("vViewPos","vec3");t.varyings.add("vLineLengthPixels","float");t.varyings.add("vSizeFalloffFactor","float");C.uniforms.add([new m.Float2PassUniform("pixelToNDC",(F,H)=>c.set(z,2/H.camera.fullViewport[2],2/H.camera.fullViewport[3])),new l.Float4PassUniform("viewport",(F,H)=>H.camera.fullViewport),new g.FloatPassUniform("pixelRatio",(F,H)=>H.camera.pixelRatio)]);t.attributes.add(k.VertexAttribute.POSITION0,
"vec3");t.attributes.add(k.VertexAttribute.POSITION1,"vec3");t.attributes.add(k.VertexAttribute.VARIANTOFFSET,"float");t.attributes.add(k.VertexAttribute.VARIANTSTROKE,"float");t.attributes.add(k.VertexAttribute.VARIANTEXTENSION,"float");C.code.add(f.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${A.antialiasing?f.glsl`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:f.glsl`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${A.mode===r.EdgeUtilMode.SKETCH?f.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:A.mode===r.EdgeUtilMode.MIXED?f.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);E.code.add(f.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${A.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return t}const z=w.create();let v=function(A){function t(E){return C.call(this,E,"mat4")}b._inherits(t,A);var C=b._createSuper(t);return b._createClass(t)}(e.Uniform);w=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=w;a.build=D})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,w,n,x,m){const l=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(g,f){g=g.vertex;g.include(c.IsNaN);g.constants.add("depthBias","vec2",l);g.uniforms.add(new w.Float2PassUniform("inverseViewport",(d,e)=>e.inverseViewport));f.legacy?(g.uniforms.add(new m.Matrix4PassUniform("proj",(d,e)=>e.camera.projectionMatrix)),g.code.add(n.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(g.uniforms.add(new x.Matrix3PassUniform("transformNormalViewFromGlobal",d=>d.transformNormalViewFromGlobal)),g.uniforms.add(new m.Matrix4PassUniform("transformProjFromView",d=>d.transformProjFromView)),g.code.add(n.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));g.code.add(n.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const w=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,w){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);w.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,w){c=c.vertex;w.silhouette?(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),w.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){a.EdgeUtilMode=void 0;(function(u){u[u.SOLID=0]="SOLID";u[u.SKETCH=1]="SKETCH";u[u.MIXED=2]="MIXED";u[u.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeSilhouette=void 0;(function(u){u[u.REGULAR=0]="REGULAR";u[u.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(u,p){const h=u.vertex;h.include(w.RgbaFloatEncoding);h.uniforms.add(new m.FloatPassUniform("distanceFalloffFactor",r=>r.distanceFalloffFactor));h.code.add(l.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);h.uniforms.add(new e.Texture2DDrawUniform("componentDataTex",r=>r.componentDataTexture));u.attributes.add(k.VertexAttribute.COMPONENTINDEX,"float");h.constants.add("componentColorFieldOffset","float",0);h.constants.add("componentOtherFieldOffset","float",1);h.constants.add("componentVerticalOffsetFieldOffset","float",2);h.constants.add("componentFieldCount","float",3);h.constants.add("lineWidthFractionFactor","float",8);h.constants.add("extensionLengthOffset","float",128);h.constants.add("verticalOffsetScale",
"float",2*b.MAX_ELEVATION_OFFSET);h.code.add(l.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`);p.legacy?h.code.add(l.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(h.uniforms.add(new g.Matrix3DrawUniform("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),h.code.add(l.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));p.silhouette?(u.attributes.add(k.VertexAttribute.NORMALA,"vec3"),u.attributes.add(k.VertexAttribute.NORMALB,"vec3"),h.code.add(l.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(u.attributes.add(k.VertexAttribute.NORMAL,"vec3"),h.code.add(l.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));p.legacy?h.code.add(l.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(h.include(c.DoublePrecision,p),h.include(c.DoublePrecision,p),h.uniforms.add([new f.Matrix3PassUniform("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new g.Matrix3DrawUniform("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new n.Float3DrawUniform("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new n.Float3DrawUniform("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new x.Float3PassUniform("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),
new x.Float3PassUniform("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),h.code.add(l.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${p.spherical?l.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:l.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));h.uniforms.add(new d.Matrix4PassUniform("transformProjFromView",(r,q)=>q.camera.projectionMatrix));h.code.add(l.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);h.code.add(l.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(u){return u.mode===a.EdgeUtilMode.SKETCH||u.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(u){return u.mode===a.EdgeUtilMode.SOLID||u.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(a,b,c,w,n){a.LineAmplitude=function(x,m){const l=x.vertex;x.include(n.UnpackAttributes,m);switch(m.mode){case w.EdgeUtilMode.SOLID:l.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case w.EdgeUtilMode.SKETCH:l.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",g=>g.strokesTexture.amplitude));l.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case w.EdgeUtilMode.MIXED:l.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",g=>g.strokesTexture.amplitude)),l.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,w,n){a.UnpackAttributes=function(x,m){const l=x.vertex;x.attributes.add(w.VertexAttribute.SIDENESS,"vec2");m.mode===n.EdgeUtilMode.MIXED?l.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):l.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(m.mode){case n.EdgeUtilMode.MIXED:l.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case n.EdgeUtilMode.SKETCH:l.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case n.EdgeUtilMode.SOLID:l.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case n.EdgeUtilMode.COUNT:break;default:b.neverReached(m.mode)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),
function(a,b,c,w,n,x,m,l){let g=function(f){function d(){return e.apply(this,arguments)}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(n.NoParameters);a.LineOffset=function(f,d){f.include(l.UnpackAttributes,d);const {vertex:e,fragment:k}=f;m.usesSketchLogic(d)&&(e.uniforms.add(new x.Texture2DDrawUniform("strokesTexture",u=>u.strokesTexture.texture)),e.uniforms.add([new w.FloatDrawUniform("strokesLog2Resolution",u=>Math.log2(u.strokesTexture.resolution)),new w.FloatDrawUniform("strokeVariants",
u=>u.strokesTexture.variants)]),f.varyings.add("vStrokeUV","vec2"),k.uniforms.add([new x.Texture2DDrawUniform("strokesTexture",u=>u.strokesTexture.texture),new w.FloatDrawUniform("strokesNormalizationScale",u=>u.strokesTexture.normalizationScale)]),e.code.add(n.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),f.fragment.include(c.RgbaFloatEncoding),k.code.add(n.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(d.mode){case m.EdgeUtilMode.SOLID:e.code.add(n.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);k.code.add(n.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case m.EdgeUtilMode.SKETCH:e.code.add(n.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);k.code.add(n.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case m.EdgeUtilMode.MIXED:f.varyings.add("vType","float"),e.code.add(n.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),k.code.add(n.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,c,w,n,x){n=function(m){function l(){var f=
g.apply(this,arguments);f.mode=x.EdgeUtilMode.SOLID;f.hasSlicePlane=!1;f.silhouette=!1;f.legacy=!1;f.antialiasing=!1;f.doublePrecisionRequiresObfuscation=!1;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;f.spherical=!1;return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(n.DefaultTechniqueConfiguration);c.__decorate([w.parameter({count:x.EdgeUtilMode.COUNT})],n.prototype,"mode",void 0);c.__decorate([w.parameter()],n.prototype,"hasSlicePlane",void 0);c.__decorate([w.parameter()],
n.prototype,"silhouette",void 0);c.__decorate([w.parameter()],n.prototype,"legacy",void 0);c.__decorate([w.parameter()],n.prototype,"antialiasing",void 0);c.__decorate([w.parameter()],n.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([w.parameter()],n.prototype,"hasMultipassTerrain",void 0);c.__decorate([w.parameter()],n.prototype,"cullAboveGround",void 0);c.__decorate([w.parameter()],n.prototype,"spherical",void 0);a.EdgeShaderTechniqueConfiguration=n;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/typedArrayUtil ../../../../../core/workers/WorkerHandle ../../../support/buffer/workerHelper ./edgeProcessing".split(" "),function(a,b,c,w,n,x){w=function(l){function g(d){return f.call(this,"EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>[e.dataBuffer],extractEdgeLocations:e=>
[e.dataBuffer]},d)}b._inherits(g,l);var f=b._createSuper(g);l=g.prototype;l.process=async function(d,e,k){if(k)return x.extract(d);d=await this.invoke(new m(d),e);return this._unpackOutput(d)};l.extractEdgeLocations=async function(d,e){d=await this.invokeMethod("extractEdgeLocations",new m(d),e);return n.unpackInterleavedBuffer(d)};l.extractComponentsEdgeLocations=async function(d,e){d=await this.invokeMethod("extractComponentsEdgeLocations",new m(d),e);return n.unpackInterleavedBuffer(d)};l._unpackOutput=
function(d){return{regular:{instancesData:n.unpackInterleavedBuffer(d.regular.instancesData),lodInfo:{lengths:new Float32Array(d.regular.lodInfo.lengths)}},silhouette:{instancesData:n.unpackInterleavedBuffer(d.silhouette.instancesData),lodInfo:{lengths:new Float32Array(d.silhouette.lodInfo.lengths)}},averageEdgeLength:d.averageEdgeLength}};return b._createClass(g)}(w.WorkerHandle);let m=b._createClass(function(l){this.dataBuffer=l.data.buffer;this.writerSettings=l.writerSettings;this.skipDeduplicate=
l.skipDeduplicate;this.indices=c.isArray(l.indices)?l.indices:l.indices.buffer;this.indicesType=c.isArray(l.indices)?"Array":c.isUint32Array(l.indices)?"Uint32Array":"Uint16Array";this.indicesLength=l.indicesLength});a.EdgeWorkerHandle=w;a.PackedInput=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView","./InterleavedLayout"],function(a,b,c){function w(m){const l=
[];m.fields.forEach((g,f)=>{var d=g.constructor;l.push([f,{...g,constructor:`${d.ElementType}_${d.ElementCount}`}])});return{stride:m.stride,fields:l,fieldNames:m.fieldNames}}function n(m){const l=c.newLayout();l.stride=m.stride;l.fieldNames=m.fieldNames;m.fields.forEach(g=>l.fields.set(g[0],{...g[1],constructor:x.get(g[1].constructor)}));return l}b=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,
b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,
b.BufferViewVec3i32,b.BufferViewVec4i32];const x=new Map;b.forEach(m=>x.set(`${m.ElementType}_${m.ElementCount}`,m));a.packInterleavedBuffer=function(m,l){l.push(m.buffer);return{buffer:m.buffer,layout:w(m.layout)}};a.packLayout=w;a.unpackInterleavedBuffer=function(m){return n(m.layout).createView(m.buffer)};a.unpackLayout=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/floatRGBA ../../../../../core/maybe ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,w,n,x){function m(d,e){if(!d)return null;var k=d.length/2;const u=.1*k;k=Array(k);let p=0;e=e===l.PRESSURE;for(let h=0;h<d.length;h+=2){const r=(d[h]+d[h+1])/2;e?k[p++]=Math.min(u,1-.5*(1-r)):k[p++]=Math.min(u,.5*r)}return k}var l;(function(d){d[d.DISTANCE=0]="DISTANCE";d[d.PRESSURE=1]="PRESSURE"})(l||(l={}));let g=function(){function d(e,k,u,p,h){this.resolution=e;this.normalizationScale=k;this.amplitude=u;this.variants=p;this.texture=h}d.prototype.dispose=function(){this.texture=
w.disposeMaybe(this.texture)};return b._createClass(d)}();const f={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,
-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,
.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,
-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,
-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,
.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,
.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,
.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,
-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,
1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,
.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,
-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,
.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,
.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,
.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,
.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,
3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,
4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,
1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,
.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,
.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,
.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,
.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,
2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,
-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,
.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,
1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,
.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,
.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,
.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,
-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,
.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,
.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,
-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,
.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,
.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,
.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,
.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,
6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,
1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,
-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,
2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,
.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,
.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,
.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=g;a.generateStrokesTexture=
function(d){const e=f.resolution;var k=e/2;const u=new Uint8Array(4*e*e),p=4*e*k;k=f.amplitude;const h=2*k,r=4*e,q=Math.log2(e)+1,y=f.strokes.length;let B=(q-1)*y*r;for(const {distance:D,pressure:z}of f.strokes){let v=D,A=z,t=B;for(let C=0;C<q;C++){0!==C&&(v=m(v,l.DISTANCE),A=m(A,l.PRESSURE));for(let E=0;E<f.resolution;E++){const F=A?A[E%A.length]:1;c.packFloatRGBA((v?v[E%v.length]/h:0)+.5,u,t);c.packFloatRGBA(F,u,t+p);t+=4}t-=r*(y+1)}B+=r}d=new x.Texture(d,{pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,
hasMipmap:!1,samplingMode:n.TextureSamplingMode.LINEAR,width:e,height:e,wrapMode:n.TextureWrapMode.REPEAT},u);return new g(e,h,k,y,d)};a.strokesDefinition=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/maybe","./interfaces"],function(a,b,c){a.determineEdgeTransparency=function(w){let n=c.Transparency.INVISIBLE;for(const {material:x}of w)if(0<x.size*x.color[3]*x.opacity){if(1>x.color[3]*
x.opacity)return c.Transparency.TRANSPARENT;n=c.Transparency.OPAQUE}return n};a.determineObjectTransparency=function(w){let n=c.Transparency.INVISIBLE;for(const {material:x}of w)if(0<x.size*x.color[3]*x.opacity){switch(x.objectTransparency){case c.Transparency.TRANSPARENT:case c.Transparency.INVISIBLE:return c.Transparency.TRANSPARENT;case c.Transparency.OPAQUE:if(1>x.opacity)return c.Transparency.TRANSPARENT}n=c.Transparency.OPAQUE}return n};a.determineRendererType=function(w){let n=null;for(const x of w)if(w=
x.type,0<x.size*x.color[3])if(b.isNone(n))n=w;else if(n!==w)return"uber";return b.isSome(n)?n:"uber"};a.fillComponenBufferIndices=function(w,n,x,m){for(let g=0;g<w.length;g++){const f=w[g].index;var l=n[g];const d=n[g+1];if(m)for(;l<d;l++)x.set(m[l],f);else for(;l<d;l++)x.set(l,f)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/TimerPool".split(" "),
function(a,b,c,w,n,x,m){a.PerformanceCategory=void 0;(function(g){g.OVERLAY="overlay";g.PREPARE="prepare";g.SHADOW_MAP="shadow map";g.LINEAR_DEPTH="linear depth";g.ACCUMULATED_SHADOWS="accumulated shadows";g.NORMALS="normals";g.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";g.SSAO="SSAO";g.OPAQUE="opaque";g.OPAQUE_EDGES="opaque edges";g.VOXEL="voxel";g.TRANSPARENT="transparent";g.TRANSPARENT_EDGES="transparent edges";g.HUD_VISIBILITY="HUD visibility";g.TRANSPARENT_TERRAIN="transparent terrain";
g.ENVIRONMENT="environment";g.LASER_LINE="laser line";g.OCCLUDED="occluded";g.ANTIALIASING="antialiasing";g.HIGHLIGHTS="highlights";g.HUD="HUD";g.HUD_OCCLUDED="HUD occluded";g.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));let l=function(){function g(d){this._rctx=d;this._startTimeStampCPU=n.Milliseconds(0);this._lastTimeStampCPU=n.Milliseconds(0);this._totalCPUTime=new w("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new w(e)]));this._enableGPUTimer=
0;this._totalGPUTime=new w("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new w(e)]));this._totalTime=n.Milliseconds(0);this._totalFrameCount=0}var f=g.prototype;f.enableGPUPerformanceInfo=function(){if(c.isNone(this._gpuTimerPool)){const d=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=m.createElapsedTimerPool(this._rctx,d)}if(c.isNone(this._gpuTimerPool))return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;return{hasGPUTimerSupport:!0,
remove:x.once(()=>{--this._enableGPUTimer;0===this._enableGPUTimer&&(this._gpuTimerPool=c.disposeMaybe(this._gpuTimerPool))})}};f.startFrame=function(){this._startTimeStampCPU=this._lastTimeStampCPU=n.Milliseconds(performance.now());c.isSome(this._gpuTimerPool)&&this._gpuTimerPool.start()};f.advance=function(d){var e=n.Milliseconds(performance.now());this._cpuTimeSamplers.get(d).record(e-this._lastTimeStampCPU);this._lastTimeStampCPU=e;c.isSome(this._gpuTimerPool)&&(e=this._gpuTimerPool.stop(d),this._gpuTimeSamplers.get(d).record(e),
this._gpuTimerPool.start())};f.finishFrame=function(){if(c.isSome(this._gpuTimerPool)){var d=this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(d)}d=n.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=n.Milliseconds(this._totalTime+d);this._totalCPUTime.record(d);c.isSome(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((e,k)=>e+(k.last||0),0));++this._totalFrameCount};b._createClass(g,
[{key:"totalCPUTimeSampler",get:function(){return this._totalCPUTime}},{key:"cpuTimeSamplers",get:function(){return Array.from(this._cpuTimeSamplers.values())}},{key:"totalGPUTimeSampler",get:function(){return this._totalGPUTime}},{key:"gpuTimeSamplers",get:function(){return Array.from(this._gpuTimeSamplers.values())}},{key:"gpuSamplingEnabled",get:function(){return c.isSome(this._gpuTimerPool)}},{key:"totalTime",get:function(){return this._totalTime}},{key:"totalFrameCount",get:function(){return this._totalFrameCount}},
{key:"elapsedTime",get:function(){return n.Milliseconds(performance.now()-this._startTimeStampCPU)}}]);return g}();a.RendererPerformanceInfo=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./capabilities/DisjointTimerQuery"],function(a,b,c,w){let n=function(){function x(l,g){this._timer=l;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;g.forEach(f=>
{const d=this._timer.createQuery(),e=this._timer.createQuery();this._queryPool.push(d,e);this._queryResults.set(f,null)})}var m=x.prototype;m.start=function(){w.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),c.isNone(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))};m.stop=function(l){if(this._timer.disjoint()||c.isNone(this._currentQuery)||!this._queryResults.has(l))return this.abort(),null;this._timer.endTimeElapsed();const g=this._queryResults.get(l);
if(c.isNone(g))return this._queryResults.set(l,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(g))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const f=this._timer.getResult(g)/1E6;this._queryPool.unshift(g);this._queryResults.set(l,this._currentQuery);this._currentQuery=null;return f};m.abort=function(){c.isSome(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=
null)};m.dispose=function(){c.isSome(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(l=>{this._timer.deleteQuery(l)});this._queryResults.forEach(l=>{c.isNone(l)||this._timer.deleteQuery(l)})};return b._createClass(x)}();a.createElapsedTimerPool=function(x,m){x=x.capabilities.disjointTimerQuery;return c.isNone(x)?null:new n(x,m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","./isWebGL2Context"],function(a,b,c){let w=b._createClass(function(n,x,m,l,g,f,d,e,k){this.createQuery=n;this.deleteQuery=x;this.resultAvailable=m;this.getResult=l;this.disjoint=g;this.beginTimeElapsed=f;this.endTimeElapsed=d;this.createTimestamp=e;this.timestampBits=k});a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=w;a.createDisjointTimerQuery=function(n,x){if(x.disjointTimerQuery)return null;let m=n.getExtension("EXT_disjoint_timer_query_webgl2");return m&&
c(n)?new w(()=>n.createQuery(),l=>{n.deleteQuery(l);a.hasRunningElapsedTimer=!1},l=>n.getQueryParameter(l,n.QUERY_RESULT_AVAILABLE),l=>n.getQueryParameter(l,n.QUERY_RESULT),()=>n.getParameter(m.GPU_DISJOINT_EXT),l=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,n.beginQuery(m.TIME_ELAPSED_EXT,l))},()=>{n.endQuery(m.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},l=>m.queryCounterEXT(l,m.TIMESTAMP_EXT),()=>n.getQuery(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):(m=n.getExtension("EXT_disjoint_timer_query"))?
new w(()=>m.createQueryEXT(),l=>{m.deleteQueryEXT(l);a.hasRunningElapsedTimer=!1},l=>m.getQueryObjectEXT(l,m.QUERY_RESULT_AVAILABLE_EXT),l=>m.getQueryObjectEXT(l,m.QUERY_RESULT_EXT),()=>n.getParameter(m.GPU_DISJOINT_EXT),l=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,m.beginQueryEXT(m.TIME_ELAPSED_EXT,l))},()=>{m.endQueryEXT(m.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},l=>m.queryCounterEXT(l,m.TIMESTAMP_EXT),()=>m.getQueryEXT(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/RenderingContext"],function(a,b,c){c=function(w){function n(m,l,g){m=x.call(this,m,l);m.newCache=g;m._refCount=1;return m}b._inherits(n,w);
var x=b._createSuper(n);w=n.prototype;w.destroy=function(){0<--this._refCount||this.dispose()};w.ref=function(){++this._refCount};w.bindTechnique=function(m,l,g,f){this.useProgram(m.program);m.bindPipelineState(this,g?.slot,!!f);m.program.bindPass(l,g);return m.program};b._createClass(n,[{key:"test",get:function(){return this.programCache.test}}]);return n}(c.RenderingContext);a.RenderingContext=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./context-util ./ContextState ./enums ./InstanceCounter ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){function q(D,z,v,A){z?A!==z&&D.bindBuffer(v,z.glName):D.bindBuffer(v,null);return z}function y(D,z){switch(D){case g.PrimitiveType.POINTS:return 2*z;case g.PrimitiveType.TRIANGLES:return z/3;case g.PrimitiveType.TRIANGLE_STRIP:return z-2;case g.PrimitiveType.TRIANGLE_FAN:return z-2;default:return 0}}let B=function(){function D(v,A){this.gl=v;this.instanceCounter=new f.InstanceCounter;this.programCache=new d.ProgramCache(this);this._state=new l.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=r(v)?m.ContextType.WEBGL2:m.ContextType.WEBGL1;this._loadExtensions();this.configure(A)}var z=D.prototype;z.configure=function(v){this._capabilities=new h.Capabilities(this.gl,v);this._parameters=this._loadParameters(v);v=this.gl.getParameter(this.gl.VIEWPORT);this._state=new l.ContextState;this._state.viewport={x:v[0],y:v[1],width:v[2],height:v[3]};this._stateTracker=new e.StateTracker({setBlending:A=>{A?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(A.opRgb,
A.opAlpha),this.setBlendFunctionSeparate(A.srcRgb,A.dstRgb,A.srcAlpha,A.dstAlpha),A=A.color,this.setBlendColor(A.r,A.g,A.b,A.a)):this.setBlendingEnabled(!1)},setCulling:A=>{A?(this.setFaceCullingEnabled(!0),this.setCullFace(A.face),this.setFrontFace(A.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:A=>{A?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(A.factor,A.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:A=>{A?(this.setDepthTestEnabled(!0),this.setDepthFunction(A.func)):
this.setDepthTestEnabled(!1)},setStencilTest:A=>{if(A){this.setStencilTestEnabled(!0);const t=A.function;this.setStencilFunction(t.func,t.ref,t.mask);A=A.operation;this.setStencilOp(A.fail,A.zFail,A.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:A=>{A?(this.setDepthWriteEnabled(!0),this.setDepthRange(A.zNear,A.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:A=>{A?this.setColorMask(A.r,A.g,A.b,A.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:A=>{A?this.setStencilWriteMask(A.mask):
this.setStencilWriteMask(0)}});this.enforceState();c.disposeMaybe(this._driverTest);this._driverTest=new p.WebGLDriverTest(this)};z.dispose=function(){c.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);this.type===m.ContextType.WEBGL2&&(this.unbindBuffer(g.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER),
this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(g.BufferType.COPY_READ_BUFFER),this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;x.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)};z.setPipelineState=function(v){this._stateTracker.setPipeline(v)};z.setBlendingEnabled=function(v){this._state.blend!==v&&(!0===v?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=v,this._stateTracker.invalidateBlending())};
z.externalProgramUpdate=function(){this._state.program?.stop();this._state.program=null};z.externalTextureUnitUpdate=function(v,A){for(let t=0;t<v.length;++t)this._state.textureUnitMap[v[t]]=null;0<=A&&(this._state.activeTexture=A)};z.externalVertexArrayObjectUpdate=function(){const v=this.capabilities.vao;v&&(v.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};z.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};
z.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};z.setBlendColor=function(v,A,t,C){if(v!==this._state.blendColor.r||A!==this._state.blendColor.g||t!==this._state.blendColor.b||C!==this._state.blendColor.a)this.gl.blendColor(v,A,t,C),this._state.blendColor.r=v,this._state.blendColor.g=A,this._state.blendColor.b=t,this._state.blendColor.a=C,this._stateTracker.invalidateBlending()};z.setBlendFunction=function(v,A){if(v!==this._state.blendFunction.srcRGB||A!==this._state.blendFunction.dstRGB)this.gl.blendFunc(v,
A),this._state.blendFunction.srcRGB=v,this._state.blendFunction.srcAlpha=v,this._state.blendFunction.dstRGB=A,this._state.blendFunction.dstAlpha=A,this._stateTracker.invalidateBlending()};z.setBlendFunctionSeparate=function(v,A,t,C){if(this._state.blendFunction.srcRGB!==v||this._state.blendFunction.srcAlpha!==t||this._state.blendFunction.dstRGB!==A||this._state.blendFunction.dstAlpha!==C)this.gl.blendFuncSeparate(v,A,t,C),this._state.blendFunction.srcRGB=v,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=
A,this._state.blendFunction.dstAlpha=C,this._stateTracker.invalidateBlending()};z.setBlendEquation=function(v){this._state.blendEquation.mode!==v&&(this.gl.blendEquation(v),this._state.blendEquation.mode=v,this._state.blendEquation.modeAlpha=v,this._stateTracker.invalidateBlending())};z.setBlendEquationSeparate=function(v,A){if(this._state.blendEquation.mode!==v||this._state.blendEquation.modeAlpha!==A)this.gl.blendEquationSeparate(v,A),this._state.blendEquation.mode=v,this._state.blendEquation.modeAlpha=
A,this._stateTracker.invalidateBlending()};z.setColorMask=function(v,A,t,C){if(this._state.colorMask.r!==v||this._state.colorMask.g!==A||this._state.colorMask.b!==t||this._state.colorMask.a!==C)this.gl.colorMask(v,A,t,C),this._state.colorMask.r=v,this._state.colorMask.g=A,this._state.colorMask.b=t,this._state.colorMask.a=C,this._stateTracker.invalidateColorWrite()};z.setClearColor=function(v,A,t,C){if(this._state.clearColor.r!==v||this._state.clearColor.g!==A||this._state.clearColor.b!==t||this._state.clearColor.a!==
C)this.gl.clearColor(v,A,t,C),this._state.clearColor.r=v,this._state.clearColor.g=A,this._state.clearColor.b=t,this._state.clearColor.a=C};z.setFaceCullingEnabled=function(v){this._state.faceCulling!==v&&(!0===v?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=v,this._stateTracker.invalidateCulling())};z.setPolygonOffsetFillEnabled=function(v){this._state.polygonOffsetFill!==v&&(!0===v?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._state.polygonOffsetFill=v,this._stateTracker.invalidatePolygonOffset())};z.setPolygonOffset=function(v,A){if(this._state.polygonOffset[0]!==v||this._state.polygonOffset[1]!==A)this._state.polygonOffset[0]=v,this._state.polygonOffset[1]=A,this.gl.polygonOffset(v,A),this._stateTracker.invalidatePolygonOffset()};z.setCullFace=function(v){this._state.cullFace!==v&&(this.gl.cullFace(v),this._state.cullFace=v,this._stateTracker.invalidateCulling())};z.setFrontFace=function(v){this._state.frontFace!==
v&&(this.gl.frontFace(v),this._state.frontFace=v,this._stateTracker.invalidateCulling())};z.setScissorTestEnabled=function(v){this._state.scissorTest!==v&&(!0===v?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=v)};z.setScissorRect=function(v,A,t,C){if(this._state.scissorRect.x!==v||this._state.scissorRect.y!==A||this._state.scissorRect.width!==t||this._state.scissorRect.height!==C)this.gl.scissor(v,A,t,C),this._state.scissorRect.x=v,this._state.scissorRect.y=
A,this._state.scissorRect.width=t,this._state.scissorRect.height=C};z.setDepthTestEnabled=function(v){this._state.depthTest!==v&&(!0===v?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=v,this._stateTracker.invalidateDepthTest())};z.setClearDepth=function(v){this._state.clearDepth!==v&&(this.gl.clearDepth(v),this._state.clearDepth=v)};z.setDepthFunction=function(v){this._state.depthFunction!==v&&(this.gl.depthFunc(v),this._state.depthFunction=v,this._stateTracker.invalidateDepthTest())};
z.setDepthWriteEnabled=function(v){this._state.depthWrite!==v&&(this.gl.depthMask(v),this._state.depthWrite=v,this._stateTracker.invalidateDepthWrite())};z.setDepthRange=function(v,A){if(this._state.depthRange.zNear!==v||this._state.depthRange.zFar!==A)this.gl.depthRange(v,A),this._state.depthRange.zNear=v,this._state.depthRange.zFar=A,this._stateTracker.invalidateDepthWrite()};z.setStencilTestEnabled=function(v){this._state.stencilTest!==v&&(!0===v?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),
this._state.stencilTest=v,this._stateTracker.invalidateStencilTest())};z.setClearStencil=function(v){v!==this._state.clearStencil&&(this.gl.clearStencil(v),this._state.clearStencil=v)};z.setStencilFunction=function(v,A,t){if(this._state.stencilFunction.func!==v||this._state.stencilFunction.ref!==A||this._state.stencilFunction.mask!==t)this.gl.stencilFunc(v,A,t),this._state.stencilFunction.face=g.Face.FRONT_AND_BACK,this._state.stencilFunction.func=v,this._state.stencilFunction.ref=A,this._state.stencilFunction.mask=
t,this._stateTracker.invalidateStencilTest()};z.setStencilFunctionSeparate=function(v,A,t,C){if(this._state.stencilFunction.face!==v||this._state.stencilFunction.func!==A||this._state.stencilFunction.ref!==t||this._state.stencilFunction.mask!==C)this.gl.stencilFuncSeparate(v,A,t,C),this._state.stencilFunction.face=v,this._state.stencilFunction.func=A,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=C,this._stateTracker.invalidateStencilTest()};z.setStencilWriteMask=function(v){this._state.stencilWriteMask!==
v&&(this.gl.stencilMask(v),this._state.stencilWriteMask=v,this._stateTracker.invalidateStencilWrite())};z.setStencilOp=function(v,A,t){if(this._state.stencilOperation.face!==g.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==v||this._state.stencilOperation.zFail!==A||this._state.stencilOperation.zPass!==t)this.gl.stencilOp(v,A,t),this._state.stencilOperation.face=g.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=v,this._state.stencilOperation.zFail=A,this._state.stencilOperation.zPass=
t,this._stateTracker.invalidateStencilTest()};z.setStencilOpSeparate=function(v,A,t,C){if(this._state.stencilOperation.face!==v||this._state.stencilOperation.fail!==A||this._state.stencilOperation.zFail!==t||this._state.stencilOperation.zPass!==C)this.gl.stencilOpSeparate(v,A,t,C),this._state.stencilOperation.face=v,this._state.stencilOperation.fail=A,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=C,this._stateTracker.invalidateStencilTest()};z.setActiveTexture=function(v,
A=!1){const t=this._state.activeTexture;0<=v&&(A||v!==this._state.activeTexture)&&(this.gl.activeTexture(g.BASE_TEXTURE_UNIT+v),this._state.activeTexture=v);return t};z.clear=function(v){v&&this.gl.clear(v)};z.clearSafe=function(v,A=255){v&&(v&g.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),v&g.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),v&g.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(A),this.gl.clear(v))};z.drawArrays=function(v,A,t){x.webglDebugEnabled()&&
(this._numOfDrawCalls++,this._numOfTriangles+=y(v,t));this.gl.drawArrays(v,A,t);x.webglDebugEnabled()&&(v=u.getErrorString(this))&&console.error("drawArrays:",v)};z.drawElements=function(v,A,t,C){x.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=y(v,A));this.gl.drawElements(v,A,t,C);if(x.webglDebugEnabled()){const H=u.getErrorString(this);if(H){var E=this.getBoundVAO(),F=E?.indexBuffer;E={indexBuffer:F,vertexBuffers:E?.vertexBuffers};v={mode:v,count:A,type:t,offset:C};F=c.applySome(F,
K=>K.size)??0;A=C+A;console.error(`drawElements: ${H}${F<A?`. Buffer is too small. Attempted to draw index ${A} of ${F}`:""}`,{args:v,vao:E})}}};z.logInfo=function(){x.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};z.resetInfo=function(){x.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};z.setViewport=function(v,A,t,C){t=Math.max(Math.round(t),1);C=Math.max(Math.round(C),1);const E=this._state.viewport;if(E.x!==v||E.y!==
A||E.width!==t||E.height!==C)E.x=v,E.y=A,E.width=t,E.height=C,this.gl.viewport(v,A,t,C)};z.getViewport=function(){const v=this._state.viewport;return{x:v.x,y:v.y,width:v.width,height:v.height}};z.useProgram=function(v){this._state.program!==v&&(this._state.program?.stop(),this._state.program=v,this.gl.useProgram(v?.glName??null))};z.bindTexture=function(v,A,t=!1){(A>=this.parameters.maxTextureImageUnits||0>A)&&console.error("Input texture unit is out of range of available units!");const C=this._state.textureUnitMap[A];
if(c.isNone(v)||null==v.glName)return c.isSome(C)&&(this.setActiveTexture(A,t),this.gl.bindTexture(C.descriptor.target,null)),this._state.textureUnitMap[A]=null,C;if(!t&&C===v)return v.isDirty&&(this.setActiveTexture(A,t),v.applyChanges()),C;this.setActiveTexture(A,t);this.gl.bindTexture(v.descriptor.target,v.glName);v.applyChanges();this._state.textureUnitMap[A]=v;return C};z.unbindTexture=function(v){if(!c.isNone(v))for(let A=0;A<this.parameters.maxTextureImageUnits;A++)this._state.textureUnitMap[A]===
v&&(this.bindTexture(null,A),this._state.textureUnitMap[A]=null)};z.bindFramebuffer=function(v,A=!1){if(A||this._state.readFramebuffer!==v||this._state.drawFramebuffer!==v)c.isNone(v)?(this.gl.bindFramebuffer(g.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(v.initializeAndBind(g.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=v,this._state.drawFramebuffer=v)};z.bindFramebufferSeparate=function(v,A,t=!1){const C=A===g.FramebufferTarget.READ_FRAMEBUFFER,
E=C?this._state.readFramebuffer:this._state.drawFramebuffer;if(t||E!==v)c.isNone(v)?this.gl.bindFramebuffer(A,null):v.initializeAndBind(A),C?this._state.readFramebuffer=c.unwrapOr(v,null):this._state.drawFramebuffer=c.unwrapOr(v,null)};z.blitFramebuffer=function(v,A,t=0,C=0,E=v.width,F=v.height,H=0,K=0,I=A.width,L=A.height,R=g.ClearBufferBit.COLOR_BUFFER_BIT,O=g.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(v,g.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(A,g.FramebufferTarget.DRAW_FRAMEBUFFER);
this.gl.blitFramebuffer(t,C,E,F,H,K,I,L,R,O)};z.bindBuffer=function(v,A){if(v)switch(A??(A=v.bufferType),A){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=q(this.gl,v,A,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=q(this.gl,v,A,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=q(this.gl,v,A,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=q(this.gl,v,A,
this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=q(this.gl,v,A,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=q(this.gl,v,A,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=q(this.gl,v,A,this._state.copyWriteBuffer)}};z.bindRenderbuffer=function(v){const A=this.gl;v||(A.bindRenderbuffer(A.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==
v&&(A.bindRenderbuffer(A.RENDERBUFFER,v.glName),this._state.renderbuffer=v)};z._getBufferBinding=function(v,A){if(A>=this.parameters.maxUniformBufferBindings||0>A)return console.error("Uniform buffer binding point is out of range!"),null;v=this._state.uniformBufferBindingPoints;let t=v[A];c.isNone(t)&&(t={buffer:null,offset:0,size:0},v[A]=t);return t};z.bindBufferBase=function(v,A,t){const C=this._getBufferBinding(v,A);c.isNone(C)||C.buffer===t&&0===C.offset&&0===C.size||(this.gl.bindBufferBase(v,
A,t?t.glName:null),C.buffer=t,C.offset=0,C.size=0)};z.bindBufferRange=function(v,A,t,C,E){const F=this._getBufferBinding(v,A);c.isNone(F)||F.buffer===t&&F.offset===C&&F.size===E||(0!==C%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(v,A,t.glName,C,E),F.buffer=t,F.offset=C,F.size=E))};z.bindUBO=function(v,A,t,C){c.isNone(A)?this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,v,null):
(x.webglDebugEnabled()&&(C??A.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),A.initialize(),void 0!==t&&void 0!==C?this.bindBufferRange(g.BufferType.UNIFORM_BUFFER,v,A.buffer,t,C):this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,v,A.buffer))};z.unbindUBO=function(v){for(let A=0,t=this._state.uniformBufferBindingPoints.length;A<t;A++){const C=this._state.uniformBufferBindingPoints[A];c.isSome(C)&&C.buffer===v.buffer&&
this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,A,null)}};z.unbindBuffer=function(v){switch(v){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=q(this.gl,null,v,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=q(this.gl,null,v,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=q(this.gl,null,v,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=q(this.gl,null,v,
this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=q(this.gl,null,v,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=q(this.gl,null,v,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=q(this.gl,null,v,this._state.copyWriteBuffer)}};z.bindVAO=function(v=null){c.isNone(v)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=
null):this._state.vertexArrayObject!==v&&(v.bind(),this._state.vertexArrayObject=v)};z.clientWaitAsync=async function(v=n.Milliseconds(10)){const A=this.gl,t=A.fenceSync(g.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!t)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(g.ResourceType.Sync,t);A.flush();let C;do await w.after(v),C=A.clientWaitSync(t,0,0);while(C===g.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(g.ResourceType.Sync,
t);A.deleteSync(t);if(C===g.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");};z.getBoundFramebufferObject=function(v=g.FramebufferTarget.FRAMEBUFFER){return v===g.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};z.getBoundVAO=function(){return this._state.vertexArrayObject};z.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);
this.type===m.ContextType.WEBGL2&&(this.unbindBuffer(g.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(g.BufferType.COPY_READ_BUFFER),this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER));for(let v=0;v<this.parameters.maxTextureImageUnits;++v)this.bindTexture(null,v);this.setBlendingEnabled(!1);this.setBlendFunction(g.BlendFactor.ONE,g.BlendFactor.ZERO);this.setBlendEquation(g.BlendOperation.ADD);
this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(g.Face.BACK);this.setFrontFace(g.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(g.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(g.CompareFunction.ALWAYS,0,0);this.setStencilOp(g.StencilOperation.KEEP,
g.StencilOperation.KEEP,g.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};z.enforceState=function(){var v=this.capabilities.vao;v&&v.bindVertexArray(null);const {gl:A,gl2:t}=this;for(var C=0;C<this.parameters.maxVertexAttributes;C++)A.disableVertexAttribArray(C);this._state.vertexBuffer?
A.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):A.bindBuffer(g.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?A.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):A.bindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER,null);if(c.isSome(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(g.BufferType.UNIFORM_BUFFER,null);for(C=0;C<this._parameters.maxUniformBufferBindings;C++){const E=
this._state.uniformBufferBindingPoints[C];if(c.isSome(E)){const {buffer:F,offset:H,size:K}=E;null!==F?0===H&&0===K?t.bindBufferBase(g.BufferType.UNIFORM_BUFFER,C,F.glName):t.bindBufferRange(g.BufferType.UNIFORM_BUFFER,C,F.glName,H,K):t.bindBufferBase(g.BufferType.UNIFORM_BUFFER,C,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(g.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):t.bindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(g.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(g.BufferType.COPY_WRITE_BUFFER,null);t.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,null);t.readBuffer(t.BACK);this._state.readFramebuffer&&
(t.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(g.ColorAttachment.COLOR_ATTACHMENT0));t.bindFramebuffer(g.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,A.bindFramebuffer(g.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(v&&this._state.vertexArrayObject){if(v=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(v)}A.useProgram(this._state.program?.glName??null);A.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);A.bindRenderbuffer(A.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?A.enable(this.gl.BLEND):A.disable(this.gl.BLEND);A.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);A.blendFuncSeparate(this._state.blendFunction.srcRGB,
this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);A.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);A.clearDepth(this._state.clearDepth);A.clearStencil(this._state.clearStencil);A.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);A.cullFace(this._state.cullFace);A.depthFunc(this._state.depthFunction);A.depthRange(this._state.depthRange.zNear,
this._state.depthRange.zFar);!0===this._state.depthTest?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST);A.depthMask(this._state.depthWrite);A.frontFace(this._state.frontFace);A.lineWidth(1);!0===this._state.faceCulling?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE);A.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?A.enable(A.POLYGON_OFFSET_FILL):A.disable(A.POLYGON_OFFSET_FILL);A.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,
this._state.scissorRect.height);!0===this._state.scissorTest?A.enable(A.SCISSOR_TEST):A.disable(A.SCISSOR_TEST);A.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);A.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST);A.stencilMask(this._state.stencilWriteMask);
for(v=0;v<this.parameters.maxTextureImageUnits;v++)A.activeTexture(g.BASE_TEXTURE_UNIT+v),A.bindTexture(g.TextureType.TEXTURE_2D,null),A.bindTexture(g.TextureType.TEXTURE_CUBE_MAP,null),this.type===m.ContextType.WEBGL2&&(A.bindTexture(g.TextureType.TEXTURE_3D,null),A.bindTexture(g.TextureType.TEXTURE_2D_ARRAY,null)),C=this._state.textureUnitMap[v],c.isSome(C)&&A.bindTexture(C.descriptor.target,C.glName);A.activeTexture(g.BASE_TEXTURE_UNIT+this._state.activeTexture);v=this._state.viewport;A.viewport(v.x,
v.y,v.width,v.height);this.resetInfo()};z._loadExtensions=function(){this.type===m.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};z._loadParameters=function(v){var A=this.capabilities.textureFilterAnisotropic;v=v.maxAnisotropy??Infinity;const t=this.type===m.ContextType.WEBGL2,C=this.gl;A={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:A?Math.min(this.gl.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY),v):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:t?C.getParameter(C.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:t?C.getParameter(C.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:t?C.getParameter(C.MAX_FRAGMENT_UNIFORM_BLOCKS):
0,maxUniformBlockSize:t?C.getParameter(C.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:t?C.getParameter(C.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:t?C.getParameter(C.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:t?C.getParameter(C.MAX_SAMPLES):1};k.Texture.TEXTURE_UNIT_FOR_UPDATES=A.maxTextureImageUnits-1;return A};b._createClass(D,[{key:"gl2",get:function(){return this.type===m.ContextType.WEBGL1?null:this.gl}},{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",
get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return D}();a.RenderingContext=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./enums"],function(a,b,c){b=b._createClass(function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:c.BlendFactor.ONE,
dstRGB:c.BlendFactor.ZERO,srcAlpha:c.BlendFactor.ONE,dstAlpha:c.BlendFactor.ZERO};this.blendEquation={mode:c.BlendOperation.ADD,modeAlpha:c.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=c.Face.BACK;this.frontFace=c.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=c.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=
this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:c.Face.FRONT_AND_BACK,func:c.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:c.Face.FRONT_AND_BACK,fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=
null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null});a.ContextState=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,w){const n={RECORD_ALLOCATIONS:!1};let x=function(){function m(){this._current=[];
this._max=[];for(this._allocations=new c.AllocationTracer(n.RECORD_ALLOCATIONS);this._current.length<w.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var l=m.prototype;l.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};l.increment=function(g,f){const d=++this._current[g];this._max[g]=Math.max(d,this._max[g]);this._allocations.add(f)};l.decrement=function(g,f){--this._current[g];this._allocations.remove(f)};b._createClass(m,[{key:"max",
get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((g,f)=>g+f,0)}},{key:"resourceInformation",get:function(){let g="";if(0<this.total){g+="Live objects:\n";for(let f=0;f<w.ResourceType.COUNT;++f){const d=this._current[f];0<d&&(g+=`${w.ResourceType[f]}: ${d}\n`)}}return g+=this._allocations.information}}]);return m}();a.InstanceCounter=x;a.test=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/support/AllocationTracer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(x){this._allocations=new Map;x?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var n=w.prototype;n.add=function(x){this._allocations.set(x,Error().stack)};n.remove=function(x){this._allocations.delete(x)};b._createClass(w,[{key:"information",get:function(){let x="";if(0<this._allocations.size){x+=`${this._allocations.size} live object allocations:\n`;
const m=new Map;this._allocations.forEach(l=>{m.set(l,(m.get(l)??0)+1)});m.forEach((l,g)=>{g=g.split("\n");g.shift();g.shift();x+=`${l}: ${g.shift()}\n`;g.forEach(f=>x+=`   ${f}\n`)})}return x}}]);return w}();a.AllocationTracer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/NestedMap","./Program"],function(a,b,c,w,n){let x=function(){function m(g){this._rctx=
g;this._store=new w.NestedMap}var l=m.prototype;l.dispose=function(){this._store.forEach(g=>g.forEach(f=>f.dispose()));this._store.clear()};l.acquire=function(g,f,d,e){const k=this._store.get(g,f);if(c.isSome(k))return k.ref(),k;d=new n.Program(this._rctx,g,f,d,e);d.ref();this._store.set(g,f,d);return d};b._createClass(m,[{key:"test",get:function(){let g=0;this._store.forEach(f=>f.forEach(d=>g+=d.hasGLName?2:1));return{cachedWebGLObjects:g}}}]);return m}();a.ProgramCache=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),function(a,b,c,w,n,x,m,l,g){function f(u,p,h){u=u.gl;const r=u.createShader(p);u.shaderSource(r,h);u.compileShader(r);x.webglValidateShadersEnabled()&&!u.getShaderParameter(r,u.COMPILE_STATUS)&&(console.error("Compile error in ".concat(p===l.ShaderType.VERTEX_SHADER?
"vertex":"fragment"," shader")),console.error(u.getShaderInfoLog(r)),console.error(d(h)));k.enabled&&(k.compiledLOC+=h.match(/\n/g).length+1);return r}function d(u){let p=2;return u.replace(/\n/g,()=>{var h=p++;h=1E3<=h?h.toString():("  "+h).slice(-3);return"\n"+h+":"})}function e(u,p,h){const r=u.get(p);return r?c.update(r,h):(u.set(p,Array.from(h)),!0)}w=function(){function u(h,r,q,y,B=new Map){this._context=h;this._locations=y;this._uniformBlockBindings=B;this._refCount=1;this._compiled=!1;this._nameToUniformLocation=
{};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;h||console.error("RenderingContext isn't initialized!");0===r.length&&console.error("Shaders source should not be empty!");this._context.type===m.ContextType.WEBGL2&&(r=g.transpileShader(r,l.ShaderType.VERTEX_SHADER),q=g.transpileShader(q,l.ShaderType.FRAGMENT_SHADER));this._vShader=f(this._context,
l.ShaderType.VERTEX_SHADER,r);this._fShader=f(this._context,l.ShaderType.FRAGMENT_SHADER,q);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(l.ResourceType.Shader,this);x.webglValidateShadersEnabled()&&(this.vertexShader=r,this.fragmentShader=q);const D=this._context.gl,z=D.createProgram();D.attachShader(z,this._vShader);D.attachShader(z,this._fShader);this._locations.forEach((v,A)=>D.bindAttribLocation(z,v,A));D.linkProgram(z);x.webglValidateShadersEnabled()&&
!D.getProgramParameter(z,D.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${D.getProgramParameter(z,D.VALIDATE_STATUS)}`+`, gl error ${D.getError()}`+`, vertex: ${D.getShaderParameter(this._vShader,D.COMPILE_STATUS)}`+`, fragment: ${D.getShaderParameter(this._fShader,D.COMPILE_STATUS)}`+`, info log: ${D.getProgramInfoLog(z)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===m.ContextType.WEBGL2)for(const [v,A]of this._uniformBlockBindings)h=
D.getUniformBlockIndex(z,v),4294967295>h&&D.uniformBlockBinding(z,h,A);this._glName=z;this._context.instanceCounter.increment(l.ResourceType.Program,this)}var p=u.prototype;p.dispose=function(){if(!(0<--this._refCount)){var h=this._context.gl;this._vShader&&(h.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(l.ResourceType.Shader,this));this._fShader&&(h.deleteShader(this._fShader),this._fShader=null);this._glName&&(h.deleteProgram(this._glName),this._glName=
null,this._context.instanceCounter.decrement(l.ResourceType.Program,this))}};p.ref=function(){++this._refCount};p._getUniformLocation=function(h){void 0===this._nameToUniformLocation[h]&&n.isSome(this.glName)&&(++k.numUniforms,this._nameToUniformLocation[h]=this._context.gl.getUniformLocation(this.glName,h));return this._nameToUniformLocation[h]};p.hasUniform=function(h){return null!==this._getUniformLocation(h)};p.setUniform1i=function(h,r){const q=this._nameToUniform1[h];if(void 0===q||r!==q)this._context.gl.uniform1i(this._getUniformLocation(h),
r),this._nameToUniform1[h]=r};p.setUniform1iv=function(h,r){e(this._nameToUniform1v,h,r)&&this._context.gl.uniform1iv(this._getUniformLocation(h),r)};p.setUniform2iv=function(h,r){e(this._nameToUniform2,h,r)&&this._context.gl.uniform2iv(this._getUniformLocation(h),r)};p.setUniform3iv=function(h,r){e(this._nameToUniform3,h,r)&&this._context.gl.uniform3iv(this._getUniformLocation(h),r)};p.setUniform4iv=function(h,r){e(this._nameToUniform4,h,r)&&this._context.gl.uniform4iv(this._getUniformLocation(h),
r)};p.setUniform1f=function(h,r){const q=this._nameToUniform1[h];if(void 0===q||r!==q)this._context.gl.uniform1f(this._getUniformLocation(h),r),this._nameToUniform1[h]=r};p.setUniform1fv=function(h,r){e(this._nameToUniform1v,h,r)&&this._context.gl.uniform1fv(this._getUniformLocation(h),r)};p.setUniform2f=function(h,r,q){const y=this._nameToUniform2.get(h);if(void 0===y)this._context.gl.uniform2f(this._getUniformLocation(h),r,q),this._nameToUniform2.set(h,[r,q]);else if(r!==y[0]||q!==y[1])this._context.gl.uniform2f(this._getUniformLocation(h),
r,q),y[0]=r,y[1]=q};p.setUniform2fv=function(h,r){e(this._nameToUniform2,h,r)&&this._context.gl.uniform2fv(this._getUniformLocation(h),r)};p.setUniform3f=function(h,r,q,y){const B=this._nameToUniform3.get(h);if(void 0===B)this._context.gl.uniform3f(this._getUniformLocation(h),r,q,y),this._nameToUniform3[h]=[r,q,y];else if(r!==B[0]||q!==B[1]||y!==B[2])this._context.gl.uniform3f(this._getUniformLocation(h),r,q,y),B[0]=r,B[1]=q,B[2]=y};p.setUniform3fv=function(h,r){e(this._nameToUniform3,h,r)&&this._context.gl.uniform3fv(this._getUniformLocation(h),
r)};p.setUniform4f=function(h,r,q,y,B){const D=this._nameToUniform4.get(h);if(void 0===D)this._context.gl.uniform4f(this._getUniformLocation(h),r,q,y,B),this._nameToUniform4.set(h,[r,q,y,B]);else if(void 0===D||r!==D[0]||q!==D[1]||y!==D[2]||B!==D[3])this._context.gl.uniform4f(this._getUniformLocation(h),r,q,y,B),D[0]=r,D[1]=q,D[2]=y,D[3]=B};p.setUniform4fv=function(h,r){e(this._nameToUniform4,h,r)&&this._context.gl.uniform4fv(this._getUniformLocation(h),r)};p.setUniformMatrix3fv=function(h,r,q=!1){e(this._nameToUniformMatrix3,
h,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(h),q,r)};p.setUniformMatrix4fv=function(h,r,q=!1){e(this._nameToUniformMatrix4,h,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(h),q,r)};p.stop=function(){};b._createClass(u,[{key:"glName",get:function(){return this._glName}},{key:"hasGLName",get:function(){return n.isSome(this._glName)}},{key:"compiled",get:function(){if(this._compiled)return!0;const h=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==
h||n.isNone(this.glName)?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,h.COMPLETION_STATUS_KHR)}}]);return u}();const k={compiledLOC:0,numUniforms:0,enabled:!1};a.Program=w;a.test=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ../../core/maybe ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,b,c,w,n,x,m){function l(){function q(U){U.length&&
I.push({type:p[E],data:U,position:O,line:L,column:R})}function y(){K=K.length?[]:K;if("/"===H&&"*"===F)return O=C+t-1,E=0,H=F,t+1;if("/"===H&&"/"===F)return O=C+t-1,E=1,H=F,t+1;if("#"===F)return E=2,O=C+t,t;if(/\s/.test(F))return E=9,O=C+t,t;J=/\d/.test(F);M=/[^\w_]/.test(F);O=C+t;E=J?4:M?3:9999;return t}function B(){if(("\r"===F||"\n"===F)&&"\\"!==H)return q(K.join("")),E=999,t;K.push(F);H=F;return t+1}function D(){if("."===H&&/\d/.test(F))return E=5,t;if("/"===H&&"*"===F)return E=0,t;if("/"===H&&
"/"===F)return E=1,t;if("."===F&&K.length){for(;z(K););E=5;return t}if(";"===F||")"===F||"("===F){if(K.length)for(;z(K););q(F);E=999;return t+1}var U=2===K.length&&"\x3d"!==F;if(/[\w_\d\s]/.test(F)||U){for(;z(K););E=999;return t}K.push(F);H=F;return t+1}function z(U){var N=0;do{var S=m.operators.indexOf(U.slice(0,U.length+N).join(""));var Q=m.operators[S];if(-1===S){if(0<N--+U.length)continue;Q=U.slice(0,1).join("")}q(Q);O+=Q.length;K=K.slice(Q.length);return K.length}while(1)}function v(){if("."===
F||/[eE]/.test(F))return K.push(F),E=5,H=F,t+1;if("x"===F&&1===K.length&&"0"===K[0])return E=11,K.push(F),H=F,t+1;if(/[^\d]/.test(F))return q(K.join("")),E=999,t;K.push(F);H=F;return t+1}function A(){"f"===F&&(K.push(F),H=F,t+=1);if(/[eE]/.test(F)||"-"===F&&/[eE]/.test(H))return K.push(F),H=F,t+1;if(/[^\d]/.test(F))return q(K.join("")),E=999,t;K.push(F);H=F;return t+1}var t=0,C=0,E=999,F,H,K=[],I=[],L=1,R=0,O=0,J=!1,M=!1,G="",P;return function(U){I=[];if(null!==U){U=U.replace?U.replace(/\r\n/g,"\n"):
U;t=0;G+=U;for(P=G.length;F=G[t],t<P;){U=t;switch(E){case 0:"/"===F&&"*"===H?(K.push(F),q(K.join("")),E=999):(K.push(F),H=F);t+=1;break;case 1:t=B();break;case 2:t=B();break;case 3:t=D();break;case 4:t=v();break;case 11:/[^a-fA-F0-9]/.test(F)?(q(K.join("")),E=999):(K.push(F),H=F,t+=1);break;case 5:t=A();break;case 9999:if(/[^\d\w_]/.test(F)){var N=K.join("");E=-1<m.literals.indexOf(N)?8:-1<m.builtins.indexOf(N)?7:6;q(K.join(""));E=999}else K.push(F),H=F,t+=1;break;case 9:/[^\s]/g.test(F)?(q(K.join("")),
E=999):(K.push(F),H=F,t+=1);break;case 999:t=y()}if(U!==t)switch(G[U]){case "\n":R=0;++L;break;default:++R}}C+=t;G=G.slice(t);return I}K.length&&q(K.join(""));E=10;q("(eof)");return I}}function g(q){return q.map(y=>"eof"!==y.type?y.data:"").join("")}function f(q,y="100",B="300 es"){const D=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const z of q)if("preprocessor"===z.type){const v=D.exec(z.data);if(v){q=v[1].replace(/\s\s+/g," ");if(q===B)return q;if(q===y)return z.data="#version "+B,y;throw Error("unknown glsl version: "+
q);}}q.splice(0,0,{type:"preprocessor",data:"#version "+B},{type:"whitespace",data:"\n"});return null}function d(q,y,B,D){D=D||B;for(const z of q)if("ident"===z.type&&z.data===B)return D in y?y[D]++:y[D]=0,d(q,y,D+"_"+y[D],D);return B}function e(q,y,B="afterVersion"){const D={data:"\n",type:"whitespace"},z=A=>A<q.length?/[^\r\n]$/.test(q[A].data):!1;let v=function(A){let t=-1,C=0,E=-1;for(let H=0;H<A.length;H++){var F=A[H];"preprocessor"===F.type&&(F.data.match(/#(if|ifdef|ifndef)\s+.+/)?++C:F.data.match(/#endif\s*.*/)&&
--C);("afterVersion"===B||"afterPrecision"===B)&&"preprocessor"===F.type&&/^#version/.test(F.data)&&(E=Math.max(E,H));if("afterPrecision"===B&&"keyword"===F.type&&"precision"===F.data){a:{for(F=H;F<A.length;F++){const K=A[F];if("operator"===K.type&&";"===K.data)break a}F=null}if(null===F)throw Error("precision statement not followed by any semicolons!");E=Math.max(E,F)}t<E&&0===C&&(t=H)}return t+1}(q);z(v-1)&&q.splice(v++,0,D);for(const A of y)q.splice(v++,0,A);z(v-1)&&z(v)&&q.splice(v,0,D)}function k(q,
y,B,D="lowp"){e(q,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:D},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"ident",data:y},{type:"operator",data:";"}],"afterPrecision")}function u(q,y,B,D,z="lowp"){e(q,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:D.toString()},{type:"operator",
data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:z},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"ident",data:y},{type:"operator",data:";"}],"afterPrecision")}var p="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const h=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],
r=new Map;a.transpileShader=function(q,y){var B=x.shaderTranspiler.enableCache?r.get(q):null;if(c.isSome(B))return B;B=l();var D=[];D=D.concat(B(q));B=D=D.concat(B(null));if("300 es"===f(B,"100","300 es"))return q;var z=D=null;const v={},A={};for(let F=0;F<B.length;++F){const H=B[F];switch(H.type){case "keyword":y===w.ShaderType.VERTEX_SHADER&&"attribute"===H.data?H.data="in":"varying"===H.data&&(H.data=y===w.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(H.data.trim())&&
(H.data=H.data.replace(/(2D|Cube|EXT)/g,""));y===w.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===H.data&&(D||(D=d(B,v,"fragColor"),k(B,D,"vec4")),H.data=D);if(y===w.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===H.data){var t=void 0;let K=void 0;var C=B,E=F+1;let I=-1;for(;E<C.length;E++){const L=C[E];if("operator"===L.type&&("["===L.data&&(K=E),"]"===L.data)){t=E;break}"integer"===L.type&&(I=parseInt(L.data,10))}K&&t&&C.splice(K,t-K+1);C=I;t=d(B,v,"fragData");u(B,t,"vec4",C,"mediump");H.data=t}else y===
w.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===H.data&&(z||(z=d(B,v,"gl_FragDepth")),H.data=z);break;case "ident":if(n.includes(H.data)){if(C=y===w.ShaderType.VERTEX_SHADER)a:{for(C=F-1;0<=C;C--)if(t=B[C],"whitespace"!==t.type&&"block-comment"!==t.type)if("keyword"===t.type){if("attribute"===t.data||"in"===t.data){C=!0;break a}}else break;C=!1}if(C)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");H.data in A||(A[H.data]=d(B,v,H.data));H.data=A[H.data]}}}for(y=
B.length-1;0<=y;--y)D=B[y],"preprocessor"===D.type&&((z=D.data.match(/#extension\s+(.*):/))&&z[1]&&h.includes(z[1].trim())&&(z=B[y+1],B.splice(y,z&&"whitespace"===z.type?2:1)),(z=D.data.match(/#ifdef\s+(.*)/))&&z[1]&&h.includes(z[1].trim())&&(D.data="#if 1"),(z=D.data.match(/#ifndef\s+(.*)/))&&z[1]&&h.includes(z[1].trim())&&(D.data="#if 0"));B=g(B);x.shaderTranspiler.enableCache&&r.set(q,B);return B};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports"],function(a){var b={};(function(m){(function(l){l=l();void 0!==l&&(m.exports=l)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})({get exports(){return b},
set exports(m){b=m}});const c=b;var w={};(function(m){(function(l){l=l();void 0!==l&&(m.exports=l)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})({get exports(){return w},set exports(m){w=m}});const n=w;var x={};(function(m){(function(l){l=l();void 0!==l&&(m.exports=l)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})({get exports(){return x},
set exports(m){x=m}});a.builtins=x;a.literals=c;a.operators=n})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,c,w,n,x,m){let l=function(){function g(f){this.rctx=f;this.floatBufferBlend=new n.FloatBufferBlend(f);this.svgPremultipliesAlpha=new m.SVGPremultipliedAlpha(f);this.doublePrecisionRequiresObfuscation=
new w.DoublePrecisionRequiresObfuscation(f);this.ignoresSamplerPrecision=new x.IgnoresSamplerPrecision(f);this.drawArraysRequiresIndicesTypeReset=new c.DrawArraysRequiresIndicesTypeReset(f)}g.prototype.dispose=function(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()};return b._createClass(g)}();a.WebGLDriverTest=l;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ../3d/webgl-engine/lib/AppleAmdDriverHelper ./BufferObject ./context-util ./enums ./FramebufferObject ./WebGLDriverTestModule".split(" "),function(a,b,c,w,n,x,m,l,g,f){f=function(d){function e(u){var p=k.call(this);p._rctx=u;p._helperProgram=null;p._rctx.type===m.ContextType.WEBGL2&&c("mac")&&
c("chrome")&&(p._program=p._prepareProgram(),p._helperProgram=p._prepareHelperProgram());return p}b._inherits(e,d);var k=b._createSuper(e);d=e.prototype;d.dispose=function(){b._get(b._getPrototypeOf(e.prototype),"dispose",this).call(this);this._helperProgram?.dispose();this._helperProgram=null};d._test=function(u){const p=this._rctx;p.resetState();const h=new g.FramebufferObject(p,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,
wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1}),r=x.BufferObject.createIndex(this._rctx,l.Usage.STATIC_DRAW,new Uint8Array([0]));p.bindFramebuffer(h);p.setViewport(0,0,1,1);p.useProgram(this._helperProgram);p.bindBuffer(r,l.BufferType.ELEMENT_ARRAY_BUFFER);p.drawElements(l.PrimitiveType.POINTS,1,l.DataType.UNSIGNED_BYTE,0);p.useProgram(u);p.bindVAO(null);p.drawArrays(l.PrimitiveType.TRIANGLES,
0,258);u=new Uint8Array(4);h.readPixels(0,0,1,1,l.PixelFormat.RGBA,l.PixelType.UNSIGNED_BYTE,u);h.dispose();r.dispose();return 255===u[0]};d._prepareProgram=function(){const u=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${w.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
p=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${w.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(u,p,new Map([]))};d._prepareHelperProgram=function(){const u=n.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(u.vertex,u.fragment,new Map([]))};return b._createClass(e)}(f.WebGLDriverTestModule);
a.DrawArraysRequiresIndicesTypeReset=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,b,c){let w=function(){function n(){this._result=!1}n.prototype.dispose=function(){this._program=c.disposeMaybe(this._program)};b._createClass(n,[{key:"result",get:function(){c.isSome(this._program)&&(this._result=this._test(this._program),this.dispose());return this._result}}]);
return n}();a.WebGLDriverTestModule=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e,k){function u(p,h){return p.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${h?
"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}k=function(p){function h(q){var y=r.call(this);y._rctx=q;y._program=u(y._rctx,!1);y._obfuscated=u(y._rctx,!0);return y}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.dispose=function(){b._get(b._getPrototypeOf(h.prototype),"dispose",this).call(this);this._obfuscated=n.disposeMaybe(this._obfuscated)};p._test=function(q){if(w("force-double-precision-obfuscation"))return!0;
if(n.isNone(this._obfuscated))return!1;q=this._runProgram(q);const y=this._runProgram(this._obfuscated);return 0!==q&&(0===y||5<q/y)};p._runProgram=function(q){const y=this._rctx;y.resetState();var B=new f.FramebufferObject(y,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.NONE},{target:g.TextureType.TEXTURE_2D,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:1,
height:1}),D=m.BufferObject.createVertex(y,g.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));const z=new d.VertexArrayObject(y,new Map([["position",0]]),{geometry:[new e.VertexElementDescriptor("position",2,g.DataType.UNSIGNED_SHORT,0,4)]},{geometry:D}),v=x.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),A=x.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),t=new Float32Array(6);l.encodeDoubleArray(v,t,3);const C=new Float32Array(6);l.encodeDoubleArray(A,C,
3);y.useProgram(q);q.setUniform3f("u_highA",t[0],t[2],t[4]);q.setUniform3f("u_lowA",t[1],t[3],t[5]);q.setUniform3f("u_highB",C[0],C[2],C[4]);q.setUniform3f("u_lowB",C[1],C[3],C[5]);y.bindFramebuffer(B);y.setViewport(0,0,1,1);y.bindVAO(z);y.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);q=new Uint8Array(4);B.readPixels(0,0,1,1,g.PixelFormat.RGBA,g.PixelType.UNSIGNED_BYTE,q);z.dispose(!1);D.dispose();B.dispose();B=(v[2]-A[2])/25;D=c.unpackFloatRGBA(q);return Math.abs(B-D)};return b._createClass(h)}(k.WebGLDriverTestModule);
a.DoublePrecisionRequiresObfuscation=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,c,w,n,x,m,l,g,f,d){d=function(e){function k(p){var h=u.call(this);h._rctx=
p;if(!p.gl)return b._possibleConstructorReturn(h);if(p.type===n.ContextType.WEBGL1)return h._result=!(!p.capabilities.textureFloat?.textureFloat||!p.capabilities.colorBufferFloat?.textureFloat),b._possibleConstructorReturn(h);if(!(p.capabilities.textureFloat?.textureFloat&&p.capabilities.colorBufferFloat?.textureFloat&&p.capabilities.colorBufferFloat?.floatBlend))return b._possibleConstructorReturn(h);h._program=p.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]));return h}b._inherits(k,e);var u=b._createSuper(k);k.prototype._test=function(p){const h=this._rctx,r=new m.FramebufferObject(h,{colorTarget:x.TargetType.TEXTURE,depthStencilTarget:x.DepthStencilTargetType.NONE},{target:x.TextureType.TEXTURE_2D,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.FLOAT,internalFormat:x.SizedPixelFormat.RGBA32F,
samplingMode:x.TextureSamplingMode.NEAREST,width:1,height:1}),q=w.BufferObject.createVertex(h,x.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),y=new g.VertexArrayObject(h,new Map([["a_pos",0]]),{geometry:[new f.VertexElementDescriptor("a_pos",2,x.DataType.UNSIGNED_SHORT,0,4)]},{geometry:q});h.useProgram(p);p=h.getBoundFramebufferObject();const {x:B,y:D,width:z,height:v}=h.getViewport();h.bindFramebuffer(r);h.setViewport(0,0,1,1);h.bindVAO(y);h.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,4);
var A=l.makePipelineState({blending:c.blendingAlpha});h.setPipelineState(A);h.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,4);A=h.gl.getError();h.setViewport(B,D,z,v);h.bindFramebuffer(p);y.dispose(!1);q.dispose();r.dispose();return 1282===A?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};return b._createClass(k)}(d.WebGLDriverTestModule);a.FloatBufferBlend=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,c,w,n,x,m,l,g,f){f=function(d){function e(u){var p=k.call(this);p._rctx=u;p._program=u.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]));return p}b._inherits(e,d);var k=b._createSuper(e);e.prototype._test=function(u){const p=this._rctx,h=new x.FramebufferObject(p,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,
samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1}),r=new Uint8Array(4),q=w.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),y=new l.VertexArrayObject(p,new Map([["a_position",0]]),{geometry:[new g.VertexElementDescriptor("a_position",2,n.DataType.SHORT,0,4)]},{geometry:q});p.useProgram(u);var B=new m.Texture(p,{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,
width:1,height:1},new Uint8Array([2,255,0,0]));u.setUniform1i("u_texture",0);p.bindTexture(B,0);B=p.getBoundFramebufferObject();p.bindFramebuffer(h);p.useProgram(u);const {x:D,y:z,width:v,height:A}=p.getViewport();p.setViewport(0,0,1,1);p.bindVAO(y);p.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);p.setViewport(D,z,v,A);h.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,r);y.dispose(!1);q.dispose();h.dispose();(u=255!==r[0]||255!==r[1]||255!==r[2]||255!==r[3])&&c.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${r[0]}.${r[1]}.${r[2]}.${r[3]}]`);
p.bindFramebuffer(B);return u};return b._createClass(e)}(f.WebGLDriverTestModule);a.IgnoresSamplerPrecision=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,b,c,w,n,x,m,l,g){g=function(f){function d(k){var u=
e.call(this);u._rctx=k;u._image=new Image;u._image.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";u._image.width=5;u._image.height=5;u._image.decode();u._program=k.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]));return u}b._inherits(d,f);var e=b._createSuper(d);f=d.prototype;f.dispose=function(){b._get(b._getPrototypeOf(d.prototype),"dispose",this).call(this);this._image.src=""};f._test=function(k){const u=this._rctx;if(!u.gl)return k.dispose(),!0;const p=new x.FramebufferObject(u,{colorTarget:n.TargetType.TEXTURE,
depthStencilTarget:n.DepthStencilTargetType.NONE},{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1}),h=w.BufferObject.createVertex(u,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new l.VertexArrayObject(u,new Map([["a_pos",0]]),c.Pos2us,{geometry:h}),q=new m.Texture(u,{dataType:n.PixelType.UNSIGNED_BYTE,pixelFormat:n.PixelFormat.RGBA,preMultiplyAlpha:!1,
wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:n.TextureSamplingMode.LINEAR},this._image);u.useProgram(k);u.bindTexture(q,0);k.setUniform1i("u_texture",0);k=u.getBoundFramebufferObject();const {x:y,y:B,width:D,height:z}=u.getViewport();u.bindFramebuffer(p);u.setViewport(0,0,1,1);u.setClearColor(0,0,0,0);u.setBlendingEnabled(!1);u.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT);u.bindVAO(r);u.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);p.readPixels(0,0,1,1,n.PixelFormat.RGBA,
n.PixelType.UNSIGNED_BYTE,v);r.dispose(!1);h.dispose();p.dispose();q.dispose();u.setViewport(y,B,D,z);u.bindFramebuffer(k);return 255!==v[0]};return b._createClass(d)}(g.WebGLDriverTestModule);a.SVGPremultipliedAlpha=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const w={geometry:[new c.VertexElementDescriptor("a_pos",
2,b.DataType.BYTE,0,2)]},n={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=w;a.Pos2us=b;a.PosTex2b=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),
function(a,b,c,w,n,x,m,l){let g=function(){function f(d,e){this._gl=d;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=this._instancing=null;this._disabledExtensions=e.disabledExtensions||{};this._debugWebGLExtensions=e.debugWebGLExtensions||{}}f.prototype.enable=function(d){return this[d]};
b._createClass(f,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=w.load(this._gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",get:function(){this._instancing||(this._instancing=n.load(this._gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=l.load(this._gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=
x.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||(this._compressedTextureS3TC=x.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=x.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}},
{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=c.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=x.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=x.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}},
{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=x.loadMinMaxBlending(this._gl,this._disabledExtensions));return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=x.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=
m.load(this._gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=x.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=x.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return f}();a.Capabilities=
g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,w){return w.disjointTimerQuery?null:b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:w.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:
null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c){return b(c)?c:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports",
"./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,w,n,x,m){if(x&&b(c))return!0;if(w[n])return!1;for(const l of m)if(c.getExtension(l))return!0;return!1};a.loadColorBufferFloat=function(c,w){if(b(c)){var n=!w.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float")||!w.colorBufferFloat&&c.getExtension("EXT_color_buffer_float"),x=!w.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");w=!w.floatBlend&&!w.colorBufferFloat&&c.getExtension("EXT_float_blend");return n||
x||w?{textureFloat:!!x,textureHalfFloat:!!n,floatBlend:!!w,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(n=!w.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float"),x=!w.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!w.floatBlend&&!w.colorBufferFloat&&c.getExtension("EXT_float_blend"),n||x||c?{textureFloat:!!x,textureHalfFloat:!!n,
floatBlend:!!c,RGBA16F:n?n.RGBA16F_EXT:void 0,RGB16F:n?n.RGB16F_EXT:void 0,RGBA32F:x?x.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,w){return w.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,
COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,w){return w.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,w){return b(c)?{MIN:c.MIN,MAX:c.MAX}:w.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,w){return w.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?
{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,w){if(b(c))return{textureFloat:!0,textureFloatLinear:!w.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const n=
!w.textureHalfFloat&&c.getExtension("OES_texture_half_float");return{textureFloat:!w.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!w.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!n,textureHalfFloatLinear:!w.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:n?n.HALF_FLOAT_OES:void 0}}return null};a.loadTextureNorm16=function(c,w){return!b(c)||w.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?
{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const w=c.loseContext&&b.getExtension("WEBGL_lose_context");return w?{loseRenderingContext:()=>w.loseContext()}:null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,w){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:w.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),
deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y){a.TextureRepository=function(D){function z(A,t,C){var E=v.call(this,{});E._stage=A;E._techniqueRepository=t;E._rctx=C;E._textures=new Map;E._loadingCount=0;E._frameUpdates=new Map;E.events=new n;E._frameTask=A.view.resourceController.scheduler.registerTask(y.TaskPriority.TEXTURE_UNLOAD);return E}b._inherits(z,D);var v=b._createSuper(z);D=z.prototype;D.normalizeCtorArgs=function(){return{}};D.destroy=function(){this._frameTask.remove();this._stage.forEachOfType(p.ContentObjectType.Texture,
A=>A.unload())};D.acquire=function(A){const t=this._textures.get(A);return t?(t.ref(),m.unwrapOr(t.loadingPromise,t)):this._createNewRef(A)};D.update=function(){let A=!1;this._frameUpdates.forEach(t=>{const C=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);0<=C&&C!==t.previousToken&&(t.previousToken=C,A=!0)});A&&this.events.emit("changed",u.RenderRequestType.BACKGROUND)};D._createNewRef=function(A){const t=this._stage.getObject(A);if(m.isNone(t))return q.assert(void 0!==t),
null;const C=t.events.on("unloaded",()=>{C.remove();this._onTextureUnloaded(A)}),E=new B(A,()=>{this._frameTask.schedule(()=>{E.isUnreferenced&&t.unload()})});this._textures.set(A,E);E.ref();if(m.isSome(t.glTexture))return this._updateGLTexture(E,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(A,{texture:t,previousToken:-1}),E;this._loadingCount++;E.loadingPromise=this._stage.schedule(()=>{const F=t.load(this._rctx,()=>this.textureTechnique),H=I=>{this._loadingCount--;E.loadingPromise=
null;this._updateGLTexture(E,I);t.requiresFrameUpdates&&this._frameUpdates.set(A,{texture:t,previousToken:-1});return E},K=I=>{this._loadingCount--;E.loadingPromise=null;l.isAbortError(I)||x.getLogger(this.declaredClass).error(I);return null};return l.isPromiseLike(F)?F.then(H,K):H(F)});return E.loadingPromise};D._updateGLTexture=function(A,t){A.glTexture=t;this.events.emit("changed",u.RenderRequestType.UPDATE)};D._onTextureUnloaded=function(A){this._textures.delete(A);this._frameUpdates.delete(A)};
b._createClass(z,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){m.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(h.TextureTechnique,new r.TextureTechniqueConfiguration));return this._textureTechnique}}]);return z}(w);c.__decorate([g.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([g.property()],a.TextureRepository.prototype,"_frameTask",void 0);
c.__decorate([g.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let B=function(){function D(v,A){this.id=v;this._release=A;this._refCount=0}var z=D.prototype;z.ref=function(){++this._refCount};z.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(x.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),
this._refCount=0))};b._createClass(D,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return D}();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){a.WaterTextureRepository=function(y){function B(){var z=D.apply(this,arguments);z._passParameters=new q;z._loading=0;return z}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.destroy=function(){this._passParameters.waveNormal=m.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePertubation=m.disposeMaybe(this._passParameters.wavePertubation)};y.ensureResources=function(z){if(0<this._loading)return p.ResourceState.LOADING;if(m.isSome(this._passParameters.waveNormal)&&
m.isSome(this._passParameters.wavePertubation))return p.ResourceState.LOADED;const v={target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.REPEAT,samplingMode:h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};++this._loading;k.requestImage(w.getAssetUrl("esri/images/materials/water/normals.jpg")).then(A=>this._passParameters.waveNormal=new r.Texture(z,{...v,width:A.width,height:A.height},A)).catch(A=>x.getLogger(this.declaredClass).error("Failed to load water material normal texture.",
A)).finally(()=>--this._loading);++this._loading;k.requestImage(w.getAssetUrl("esri/images/materials/water/perturbation.jpg")).then(A=>this._passParameters.wavePertubation=new r.Texture(z,{...v,width:A.width,height:A.height},A)).catch(A=>x.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",A)).finally(()=>--this._loading);return p.ResourceState.LOADING};b._createClass(B,[{key:"passParameters",get:function(){return this._passParameters}},{key:"updating",get:function(){return 0<
this._loading}}]);return B}(n);c.__decorate([l.property()],a.WaterTextureRepository.prototype,"_loading",void 0);c.__decorate([l.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);let q=function(y){function B(){return D.apply(this,arguments)}b._inherits(B,y);var D=b._createSuper(B);return b._createClass(B)}(u.NoParameters);
a.WaterTexturePassParameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f){let d=b._createClass(function(k,u){this.viewCamera=k;this.frameHasDecorations=u}),e=function(){function k(p,h,r,q){this._rctx=p;this._renderFunctions=h;this._forceCameraHook=r;this._disposeOffscreenBuffers=q;this.supersample=!0;this._screenshotQueue=[]}var u=k.prototype;u.destroy=function(){this._rctx=null};u.takeScreenshot=async function(p){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(x.RenderRequestType.BACKGROUND);const h=w.createResolver();
this._screenshotQueue.push({settings:p,resolver:h});return h.promise};u.update=function(p,h){for(const r of this._screenshotQueue){if(null==this._rctx){r.resolver.reject();continue}const q=this._renderScreenshot(p,{...r.settings,pixelRatio:r.settings.pixelRatio*p.viewCamera.pixelRatio},h);r.resolver(q)}this._screenshotQueue.length=0};u._renderScreenshotOverlay=function(p,h,r){p.width=h.width;p.height=h.height;const q=p.getContext("2d"),y=r.pixelRatio;q.save();q.translate(0,h.height);q.scale(1,-1);
r.region&&q.translate(-r.region.x,-r.region.y);q.scale(y,y);h=this._renderFunctions.renderOverlay(p,h);q.restore();return h};u._readbackScreenshot=function(p,h){return p.resample?this._readbackScreenshotResampled({...p,resample:p.resample},h):this._readbackScreenshotImmediate(p,h)};u._readbackScreenshotResampled=function(p,h){const {framebufferWidth:r,framebufferHeight:q,region:y,resample:B}=p,D=this._ensureScreenshotEncodeCanvas();let z=f.createEmptyImageData(r,q,D);this._rctx.gl.readPixels(0,0,
r,q,l.PixelFormat.RGBA,l.DataType.UNSIGNED_BYTE,new Uint8Array(z.data.buffer));h();z=this._renderScreenshotOverlay(D,z,{...p,region:void 0});p=f.createEmptyImageData(y.width,y.height,D);return m.resampleHermite(z,p,!0,B.region.x,q-(B.region.y+B.region.height),B.region.width,B.region.height)};u._readbackScreenshotImmediate=function(p,h){const {framebufferHeight:r,region:q}=p,y=this._ensureScreenshotEncodeCanvas(),B=f.createEmptyImageData(q.width,q.height,y);this._rctx.gl.readPixels(q.x,r-(q.y+q.height),
q.width,q.height,l.PixelFormat.RGBA,l.DataType.UNSIGNED_BYTE,new Uint8Array(B.data.buffer));h();return this._renderScreenshotOverlay(y,B,p)};u._renderScreenshot=function(p,h,r){let q=null,y=null;const B=p.viewCamera,{framebufferWidth:D,framebufferHeight:z}=h;var v=!1;p=h.disableDecorations&&p.frameHasDecorations;var A=h.ignorePadding&&B.pixelRatio!==h.pixelRatio;p=D!==B.fullWidth||z!==B.fullHeight||p||A||h.objectAndLayerIdColor;h.objectAndLayerIdColor&&(y=new g.FramebufferObject(this._rctx,{width:D,
height:z,colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER}));if(p){A=B.clone();if(h.ignorePadding){v=n.clone(A.padding);for(var t=0;4>t;t++)v[t]=Math.round(v[t]/A.pixelRatio*h.pixelRatio);A.padding=v}A.fullWidth=D;A.fullHeight=z;A.pixelRatio=h.pixelRatio;v=B.fovX-A.fovX;t=B.fovY-A.fovY;0>v&&v<t?A.fovX=B.fovX:0>t&&t<v&&(A.fovY=B.fovY);this._forceCameraHook(A);v=!0;q=new g.FramebufferObject(this._rctx,{width:A.fullWidth,height:A.fullHeight,colorTarget:l.TargetType.TEXTURE,
depthStencilTarget:l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderFunctions.renderScene(q,y,A,h.disableDecorations?x.Decorations.OFF:x.Decorations.ON,r);this._disposeOffscreenBuffers()}A=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(q)};r=this._readbackScreenshot(h,A);A();A=null;h.objectAndLayerIdColor&&(t=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(y)},this._rctx.bindFramebuffer(y),A=this._readbackScreenshot(h,t),this._rctx.bindFramebuffer(null),t());if(p&&!this._rctx.contextAttributes.alpha)for(h=
3;h<r.data.length;h+=4)r.data[h]=255;if(A&&!this._rctx.contextAttributes.alpha)for(h=3;h<A.data.length;h+=4)A.data[h]=255;v&&this._forceCameraHook(B);return[r,A]};u._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return b._createClass(k)}();a.ScreenshotContext=d;a.ScreenshotManager=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports",
"../../core/has","../../core/mathUtils","../../core/maybe","../../core/imageUtils"],function(a,b,c,w,n){function x(r,q){const {format:y,quality:B,rotation:D,disableDecorations:z}=r||{};var v=d(r,q.padding);var A=q.width-v.left-v.right;q=q.height-v.top-v.bottom;v={x:0,y:0,width:A,height:q};if(r&&r.area){null!=r.area.x&&(v.x=Math.floor(r.area.x));null!=r.area.y&&(v.y=Math.floor(r.area.y));var t=null!=r.area.width?Math.floor(r.area.width):null,C=null!=r.area.height?Math.floor(r.area.height):null;v.width=
A-v.x;v.height=q-v.y;null!=t&&null!=C?(v.width=Math.min(v.width,t),v.height=Math.min(v.height,C)):null==t&&null!=C?(t=Math.min(v.width,t),v.height*=t/v.width,v.width=t):null!=t&&null==C&&(t=Math.min(v.height,C),v.width*=t/v.height,v.height=t)}v=f(v,r);t=Math.floor(Math.max(v.x,0));C=Math.floor(Math.max(v.y,0));A={x:t,y:C,width:Math.floor(Math.min(v.width,A-t)),height:Math.floor(Math.min(v.height,q-C))};q=A.width/A.height;v=v.width/v.height;v!==q&&(v>q?(q=Math.floor(A.width/v),A={x:A.x,y:Math.floor(A.y+
(A.height-q)/2),width:A.width,height:q}):(q=Math.floor(A.height*v),A={x:Math.floor(A.x+(A.width-q)/2),y:A.y,width:q,height:A.height}));const {width:E,height:F}=g(r,A);q=e(y);v=p[q];v=c.clamp(null!=B?B:v,0,100);return{format:q,quality:v,area:A,width:E,height:F,rotation:D,disableDecorations:!!z,ignoreBackground:!(!r||!r.ignoreBackground),ignorePadding:!(!r||!r.ignorePadding)}}function m(r,q){w.isNone(k)&&(k=document.createElement("canvas"));var y=k;if(q.premultipliedAlpha){var B=r.data;const z=B.length;
for(let v=0;v<z;v+=4){var D=B[v+3];255!==D&&0<D&&(D=255/D,B[v]*=D,B[v+1]*=D,B[v+2]*=D)}}y.width=r.width;y.height=r.height;B=y.getContext("2d",{willReadFrequently:!0});B.putImageData(r,0,0);q.flipY&&(B.save(),B.globalCompositeOperation="copy",B.scale(1,-1),B.translate(0,-B.canvas.height),B.drawImage(B.canvas,0,0),B.restore());return{ctx:B,canvas:y}}function l(r,q){return r.toDataURL(u[q.format],q.quality/100)}function g(r,q){if(!r)return q;const y=r.width;r=r.height;if(null!=y&&null!=r)return{width:Math.floor(y),
height:Math.floor(r)};if(null==y&&null==r)return q;q=q.width/q.height;return null==r?{width:Math.floor(y),height:Math.floor(y/q)}:{width:Math.floor(r*q),height:Math.floor(r)}}function f(r,q){if(!q||null==q.width||null==q.height)return r;q=q.width/q.height;const y=r.width/r.height;if(y===q)return r;if(y<q)return q=Math.floor(r.height*q),r.x-=(q-r.width)/2,r.width=q,r;q=Math.floor(r.width/q);r.y-=(q-r.height)/2;r.height=q;return r}function d(r,q){return!q||r&&r.ignorePadding?h:q}function e(r){switch(r){case "png":case "jpg":case "jpeg":return r;
case null:case void 0:return"png";default:return"png"}}let k=null;const u={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},p={png:100,jpg:98,jpeg:98},h={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=n.createEmptyImageData;a.completeUserSettings=x;a.encode=function(r,q,y){const {ctx:B,canvas:D}=m(r,y);r=B.getImageData(0,0,r.width,r.height);q=l(D,q);D.width=0;D.height=0;return{dataUrl:q,data:r}};a.encodeData=function(r,q){const {ctx:y,canvas:B}=m(r,q);r=y.getImageData(0,0,r.width,r.height);
B.width=0;B.height=0;return r};a.getFormatAndQuality=function(r,q){r=e(r);const y=p[r];q=c.clamp(null!=q?q:y,0,100);return{format:r,quality:q}};a.getMaximumResolutionScale=function(r,q){return q/Math.max(r[0],r[1])};a.resampleHermite=function(r,q,y,B=0,D=0,z=r.width-B,v=r.height-D,A=!1){const {data:t}=r,{width:C,height:E,data:F}=q;z/=C;v/=E;const H=Math.ceil(z/2),K=Math.ceil(v/2);r=r.width;for(let R=0;R<E;R++)for(let O=0;O<C;O++){const J=4*(O+(A?E-R-1:R)*C);let M=0,G=0,P=0,U=0,N=0,S=0;const Q=(R+
.5)*v;for(let W=Math.floor(R*v);W<(R+1)*v;W++){var I=Math.abs(Q-(W+.5))/K;const V=(O+.5)*z;I*=I;for(let T=Math.floor(O*z);T<(O+1)*z;T++){var L=Math.abs(V-(T+.5))/H;L=Math.sqrt(I+L*L);if(1<=L)continue;L=2*L*L*L-3*L*L+1;const X=4*(B+T+(D+W)*r);S+=L*t[X+3];G+=L;!y&&255>t[X+3]&&(L=L*t[X+3]/255);P+=L*t[X];U+=L*t[X+1];N+=L*t[X+2];M+=L}}F[J]=P/M;F[J+1]=U/M;F[J+2]=N/M;F[J+3]=S/G}return q};a.screenshotSuperSampleSettings=function(r,q,y){if(!q)return r;const {framebufferWidth:B,framebufferHeight:D,pixelRatio:z,
region:v}=r;q=d(r,y);y=q.left+q.right;const A=q.top+q.bottom,t=B-y,C=D-A,E=Math.min(8,Math.min((2048-y)/t,(2048-A)/C));return 1.5>E?r:{...r,framebufferWidth:Math.round(t*E)+y,framebufferHeight:Math.round(C*E)+A,pixelRatio:z*E,resample:{region:{x:Math.round((v.x-q.left)*E)+q.left,y:Math.round((v.y-q.top)*E)+q.top,width:Math.round(v.width*E),height:Math.round(v.height*E)},width:B,height:D}}};a.toDataUrl=l;a.toRenderSettings=function(r,q){const y=x(r,q),B=y.area,D=y.width/B.width,z=d(y,q.padding),v=
z.left+z.right,A=z.top+z.bottom;return{framebufferWidth:Math.floor((q.width-v)*D+v),framebufferHeight:Math.floor((q.height-A)*D+A),region:{x:Math.floor(B.x*D)+z.left,y:Math.floor(B.y*D)+z.top,width:y.width,height:y.height},format:y.format,quality:y.quality,rotation:y.rotation,pixelRatio:D,layers:r&&r.layers?r.layers:[],disableDecorations:y.disableDecorations,ignoreBackground:y.ignoreBackground,ignorePadding:y.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const c=b.getContextCache();c.forEach(w=>w.dispose());c.clear()}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(q,y){return b.isNone(q)?null:g.isObjectIntersectorResult(q)||g.isHudIntersectorResult(q)?e(q.target?.object.metadata,y):m.isPclIntersectorResult(q)?(q=q.target.createGraphic(),{type:"graphic",graphic:q,layer:q.layer}):m.isVoxelIntersectorResult(q)?(q=q.target.createVoxelGraphic(),{type:"graphic",graphic:q,layer:q.layer}):l.isOverlayIntersectorResult(q)||f.isLodIntersectorResult(q)?e(q.target,y):m.isI3sIntersectorResult(q)?k(q.target,y):null}function e(q,y){if(b.isNone(q)||
b.isNone(q.graphicUid))return null;const B=h(q,y);if(b.isNone(B))return null;if(B===y.graphics)return b.isNone(y.graphicsView)||"number"!==typeof q.graphicUid?null:y.graphicsView.getHit(q.graphicUid);y=y.allLayerViews.find(D=>D.layer===B);return!y||y.suspended||b.isNone(q.graphicUid)?null:"getHit"in y?y.getHit(q.graphicUid):null}function k(q,y){const B=h(q,y);return b.isNone(B)?null:(y=y.allLayerViews.find(D=>D.layer===B))&&!y.suspended&&"getGraphicFromIntersectorTarget"in y?p(y.getGraphicFromIntersectorTarget(q)):
null}function u(q,y){const B=h(q,y);return b.isNone(B)?null:(y=y.allLayerViews.find(D=>D.layer===B))&&!y.suspended&&"getAABBFromIntersectorTarget"in y?y.getAABBFromIntersectorTarget(q):null}function p(q){return b.isSome(q)?{type:"graphic",graphic:q,layer:q.layer}:null}function h(q,y){return!q||b.isNone(q.layerUid)?null:b.isSome(y.graphicsView)&&q.layerUid===y.graphicsView.processor.layer.id?y.graphics:y.map.findLayerByUid(q.layerUid)}const r=w.create();a.getIntersectedFeatureBSRadius=function(q,y){return g.isObjectIntersectorResult(q)||
g.isHudIntersectorResult(q)?x.getRadius(q.target.object.boundingVolumeWorldSpace.bounds):f.isLodIntersectorResult(q)?(c.getScaling(r,q.transformation),q.target.baseBoundingSphere.radius*Math.max(r[0],r[1],r[2])):m.isI3sIntersectorResult(q)?b.applySome(u(q.target,y),B=>.5*n.diameter(B)):null};a.hasLod=function(q){return g.isObjectIntersectorResult(q)||g.isHudIntersectorResult(q)?!1:f.isLodIntersectorResult(q)?1<q.target.numLodLevels:m.isI3sIntersectorResult(q)?!0:!1};a.toGraphic=function(q,y){q=d(q,
y);return b.isSome(q)&&"graphic"===q.type?q.graphic:null};a.toHit=d;a.toOwner=function(q,y){return g.isObjectIntersectorResult(q)||g.isHudIntersectorResult(q)?h(q.target?.object.metadata,y):l.isTerrainIntersectorResult(q)?y.map?.ground:m.isPclIntersectorResult(q)||m.isI3sIntersectorResult(q)||l.isOverlayIntersectorResult(q)||m.isVoxelIntersectorResult(q)?h(q.target,y):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,b,c,w,n){let x=function(l){function g(d,e,k,u){e=f.call(this,e,k);e.point=d;e.createGraphic=u;return e}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(w.Graphic3DTarget),m=function(l){function g(d,e,k,u,p){var h=f.call(this,d);h.layerUid=d;h.sublayerUid=e;h.nodeIndex=k;h.componentIndex=u;h.triangleNr=
p;return h}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(w.LayerTarget);w=function(l){function g(d,e,k){e=f.call(this,e,null);e.point=d;e.createVoxelGraphic=k;return e}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(w.Graphic3DTarget);a.I3sTarget=m;a.PclTarget=x;a.VoxelTarget=w;a.isI3sIntersectorResult=function(l){return n.isValidIntersectorResult(l)&&l.intersector===c.IntersectorType.I3S&&!!l.target};a.isPclIntersectorResult=function(l){return n.isValidIntersectorResult(l)&&
l.intersector===c.IntersectorType.PCL&&!!l.target};a.isVoxelIntersectorResult=function(l){return n.isValidIntersectorResult(l)&&l.intersector===c.IntersectorType.VOXEL&&!!l.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../core/maybe"],function(a,b){function c(w){return b.isSome(w)&&"graphic"===w.type}a.filterGraphicHits=function(w){return w.filter(c)};a.findFirstGraphicHit=function(w){return w.find(c)??
null};a.hitTestSelectSimilarDistance=async function(w,n){if("2d"===w.type)return w.hitTest(n);w=await w.hitTest(n);if(0===w.results.length)return w;const x=1.05*(b.unwrap(w.results[0].distance)??0);n=w.results.findIndex(m=>(m.distance??0)>x);-1!==n&&(w.results=w.results.slice(0,n));return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,
b,c,w){a.check=function(n){const x=c.getWebGLCapabilities(n);if(!x.available)return new b("webgl:required","WebGL is required but not supported.");if("3d"===n&&x.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!x.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");
if(!x.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(x.type===w.ContextType.WEBGL1){if(!x.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!x.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");
if(!x.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util"],function(a,b,c,w){function n(u){switch(u){case w.ContextType.WEBGL1:return x();case w.ContextType.WEBGL2:return m()}}function x(){if(!g){{const u=
new e,p=l(w.ContextType.WEBGL1,u);c.isNone(p)||(u.supportsElementIndexUint=null!==p.getExtension("OES_element_index_uint"),u.supportsStandardDerivatives=null!==p.getExtension("OES_standard_derivatives"),u.supportsInstancedArrays=null!==p.getExtension("ANGLE_instanced_arrays"),u.supportsTextureFloat=null!==p.getExtension("OES_texture_float"),u.supportsTextureHalfFloat=null!==p.getExtension("OES_texture_half_float"),u.supportsColorBufferFloat=null!==p.getExtension("WEBGL_color_buffer_float"),u.supportsColorBufferFloatBlend=
null!==p.getExtension("EXT_float_blend"),u.supportsColorBufferHalfFloat=null!==p.getExtension("EXT_color_buffer_half_float"));g=u}}return g}function m(){if(!f){{const u=new k,p=l(w.ContextType.WEBGL2,u);c.isNone(p)||(u.supportsColorBufferFloat=null!==p.getExtension("EXT_color_buffer_float"),u.supportsColorBufferFloatBlend=null!==p.getExtension("EXT_float_blend"),u.supportsColorBufferHalfFloat=u.supportsColorBufferFloat||null!==p.getExtension("EXT_color_buffer_half_float"));f=u}}return f}function l(u,
p){if(u===w.ContextType.WEBGL1&&"undefined"===typeof WebGLRenderingContext||u===w.ContextType.WEBGL2&&"undefined"===typeof WebGL2RenderingContext)return null;const h=document.createElement("canvas");if(!h)return null;let r=w.createContext(h,u,{failIfMajorPerformanceCaveat:!0});c.isNone(r)&&(r=w.createContext(h,u),c.isSome(r)&&(p.majorPerformanceCaveat=!0));if(c.isNone(r))return r;if(u===w.ContextType.WEBGL1){if(u=r.getParameter(r.VERSION)?.match(/^WebGL\s+([\d.]*)/))u=parseFloat(u[1]),p.available=
.94<=u}else p.available=!0;p.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE);p.supportsVertexShaderSamplers=0<r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(u=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT))p.supportsHighPrecisionFragment=0<u.precision;return r}let g,f,d=b._createClass(function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=
this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}),e=function(u){function p(){var r=h.apply(this,arguments);r.type=w.ContextType.WEBGL1;return r}b._inherits(p,u);var h=b._createSuper(p);return b._createClass(p)}(d),k=function(u){function p(){var r=h.apply(this,arguments);r.type=w.ContextType.WEBGL2;r.supportsElementIndexUint=!0;r.supportsStandardDerivatives=
!0;r.supportsInstancedArrays=!0;r.supportsTextureFloat=!0;r.supportsTextureHalfFloat=!0;return r}b._inherits(p,u);var h=b._createSuper(p);return b._createClass(p)}(d);a.getWebGL1Capabilities=x;a.getWebGL2Capabilities=m;a.getWebGLCapabilities=function(u){for(u=w.getContextTypes(u);1<u.length;){const p=n(u.shift());if(p.available)return p}return n(u.shift())};a.getWebGLVersionCapabilities=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){c=function(h){function r(y){y=q.call(this,y);y._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};y.components=[];return y}a._inherits(r,h);var q=a._createSuper(r);h=r.prototype;h.initialize=function(){this.addHandles([n.watch(()=>this.components,this._componentsWatcher.bind(this),n.initial),n.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),n.initial)])};h._add=function(y,B,D,z){let v=
y;if("string"===typeof y&&this._defaultPositionLookup[y]){if(this._find(y))return;v=this._createComponent(y)}a._get(a._getPrototypeOf(r.prototype),"_add",this).call(this,v,B,D,z)};h._removeComponents=function(y){y.forEach(B=>{if(B=this._find(B))this.remove(B),B.destroy()})};h._updateViewAwareWidgets=function(y){this.components.forEach(B=>{B=(B=this._find(B))&&B.widget;void 0!==B?.view&&(B.view=y)})};h._componentsWatcher=function(y,B){this._removeComponents(B);this._addComponents(y);this._adjustPadding(y)};
h._adjustPadding=function(y){y.includes("attribution")||this._isOverridden("padding")||({top:y}=this.padding,this.padding=y)};h._addComponents=function(y){this.constructed&&y.forEach(B=>this.add(this._createComponent(B),this._defaultPositionLookup[B]))};h._createComponent=function(y){const B=this._createWidget(y);if(B)return new f({id:y,node:B})};h._createWidget=function(y){const {view:B}=this;switch(y){case "attribution":return new e({view:B});case "compass":return new k({view:B});case "navigation-toggle":return new u({view:B});
case "zoom":return new p({view:B})}};return a._createClass(r)}(d);b.__decorate([x.property()],c.prototype,"components",void 0);return c=b.__decorate([g.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){c=function(f){function d(){var k=e.apply(this,arguments);k.widget=null;return k}a._inherits(d,f);var e=a._createSuper(d);f=d.prototype;f.destroy=function(){this.widget&&this.widget.destroy();this.node=null};f.castNode=function(k){if(!k)return this._set("widget",null),null;if("string"===typeof k||k&&"nodeType"in k)return this._set("widget",null),w.byId(k);k&&"function"===typeof k.render&&!k.domNode&&(k.domNode=document.createElement("div"));this._set("widget",k);return k.domNode};
a._createClass(d,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(k){const u=this._get("node");k!==u&&(k&&k.classList.add("esri-component"),u&&u.classList.remove("esri-component"),this._set("node",k))}}]);return d}(c);b.__decorate([n.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([n.property()],c.prototype,"node",null);b.__decorate([x.cast("node")],c.prototype,"castNode",null);b.__decorate([n.property({readOnly:!0})],c.prototype,
"widget",void 0);return c=b.__decorate([g.subclass("esri.views.ui.Component")],c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/domUtils ../../core/Evented ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){function r(z){return 0===z?"0":`${z}px`}function q(z){const v="object"===typeof z&&null!==z&&Object.getPrototypeOf(z);return null!==v&&v!==Object.prototype||!("component"in z||"index"in z||"position"in z)?null:z}function y(z,{top:v,bottom:A,left:t,right:C}){z.style.top=v;z.style.bottom=A;z.style.left=t;z.style.right=C}const B={left:0,top:0,bottom:0,right:0},D={bottom:30,top:15,right:15,left:15};c=function(z){function v(t){var C=A.call(this,t);C._cornerNameToContainerLookup=
{};C._positionNameToContainerLookup={};C._components=[];C._componentToKey=new Map;C._locale=h.getLocale();C.view=null;C._applyViewPadding=()=>{const E=C.container;E&&y(E,C._toPixelPosition(C._getViewPadding()))};C._applyUIPadding=()=>{const E=C._innerContainer;E&&y(E,C._toPixelPosition(C.padding))};C._initContainers();return C}a._inherits(v,z);var A=a._createSuper(v);z=v.prototype;z.initialize=function(){this.addHandles([m.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,m.initial),
m.watch(()=>this.padding,this._applyUIPadding,m.initial),m.watch(()=>[this.container,this._locale],([t,C])=>{t&&t.setAttribute("lang",C)},m.initial),h.onLocaleChange(t=>{this._locale=t})])};z.destroy=function(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0;this._componentToKey.clear()};z.castPadding=function(t){return"number"===typeof t?{bottom:t,top:t,right:t,left:t}:{...D,...t}};z.add=function(t,C){let E,F;if(Array.isArray(t))t.forEach(K=>this.add(K,C));
else{var H=q(t);H&&({index:E,position:C,component:t,key:F}=H);C&&"object"===typeof C&&({index:E,key:F,position:C}=C);!t||C&&!this._isValidPosition(C)||this._add(t,C,E,F)}};z.remove=function(t,C){if(t){if(Array.isArray(t))return t.map(H=>this.remove(H,C));var E=this._find(t);if(E&&(!this._componentToKey.has(t)||this._componentToKey.get(t)===C)){var F=this._components.indexOf(E);E.node.parentNode?.removeChild(E.node);this._componentToKey.delete(t);return this._components.splice(F,1)[0]}}};z.empty=function(t){if(Array.isArray(t))return t.map(C=>
this.empty(C)).reduce((C,E)=>C.concat(E));t??(t="manual");return"manual"===t?Array.prototype.slice.call(this._manualContainer.children).filter(C=>!C.classList.contains("esri-ui-corner")).map(C=>this.remove(C)):this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,this):null};z.move=function(t,C){Array.isArray(t)&&t.forEach(H=>this.move(H,C));if(t){var E=q(t)||q(C);if(E){var F=E.index;C=E.position;t=E.component||t}(!C||this._isValidPosition(C))&&
(t=this.remove(t))&&this.add(t,{position:C,index:F})}};z.find=function(t){return t?(t=this._findById(t))&&(t.widget||t.node):null};z.getComponents=function(t){return t?Array.isArray(t)?t.map(C=>this._getComponentsAtPosition(C)).flat():this._getComponentsAtPosition(t):this._components.map(({widget:C,node:E})=>C??E)};z.getPosition=function(t){for(const C in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[C].contains(t))return C;return null};z._add=function(t,C,E,F){t instanceof
u||(t=new u({node:t}));this._place({component:t,position:C,index:E});this._components.push(t);F&&this._componentToKey.set(t,F)};z._find=function(t){return t?t instanceof u?this._findByComponent(t):"string"===typeof t?this._findById(t):this._findByNode(t.domNode||t):null};z._getViewPadding=function(){return this.view?.padding??B};z._attachContainers=function(t){t.appendChild(this._innerContainer);t.appendChild(this._manualContainer)};z._initContainers=function(){var t=document.createElement("div");
t.classList.add("esri-ui-inner-container","esri-ui-corner-container");const C=document.createElement("div");C.classList.add("esri-ui-inner-container","esri-ui-manual-container");const E=document.createElement("div");E.classList.add("esri-ui-top-left","esri-ui-corner");t.appendChild(E);const F=document.createElement("div");F.classList.add("esri-ui-top-right","esri-ui-corner");t.appendChild(F);const H=document.createElement("div");H.classList.add("esri-ui-bottom-left","esri-ui-corner");t.appendChild(H);
const K=document.createElement("div");K.classList.add("esri-ui-bottom-right","esri-ui-corner");t.appendChild(K);this._innerContainer=t;this._manualContainer=C;t=p.isRTL();this._cornerNameToContainerLookup={"top-left":E,"top-right":F,"bottom-left":H,"bottom-right":K,"top-leading":t?F:E,"top-trailing":t?E:F,"bottom-leading":t?K:H,"bottom-trailing":t?H:K};this._positionNameToContainerLookup={manual:C,...this._cornerNameToContainerLookup}};z._isValidPosition=function(t){return!!this._positionNameToContainerLookup[t]};
z._place=function(t){var C=t.position??"manual";const {component:E,index:F}=t;t=this._positionNameToContainerLookup[C];C=null!=F&&-1<F;var H=E.widget;H&&!H._started&&"function"===typeof H.postMixInProperties&&"function"===typeof H.buildRendering&&"function"===typeof H.postCreate&&"function"===typeof H.startup&&E.widget.startup();C?(C=Array.prototype.slice.call(t.children),0===F?t.firstChild?w.insertBefore(E.node,t.firstChild):t.appendChild(E.node):F>=C.length?t.appendChild(E.node):w.insertBefore(E.node,
C[F])):t.appendChild(E.node)};z._toPixelPosition=function(t){return{top:r(t.top),left:r(t.left),right:r(t.right),bottom:r(t.bottom)}};z._findByComponent=function(t){return this._components.find(C=>C===t)??null};z._findById=function(t){return this._components.find(({id:C})=>C===t)??null};z._findByNode=function(t){return this._components.find(({node:C})=>C===t)??null};z._getComponentsAtPosition=function(t){return Array.prototype.slice.call(this._positionNameToContainerLookup[t].children).map(C=>this._findByNode(C)).filter(x.isSome).map(({widget:C,
node:E})=>C??E)};a._createClass(v,[{key:"container",set:function(t){const C=this._get("container");t!==C&&(t&&(t.classList.add("esri-ui"),k.setCalciteThemeClass(t),this._attachContainers(t)),C&&(C.classList.remove("esri-ui"),y(C,{top:"",bottom:"",left:"",right:""}),w.empty(C)),this._set("container",t))}},{key:"height",get:function(){const t=this.view?.height??0;if(0===t)return t;const C=this._getViewPadding(),{top:E,bottom:F}=C;return Math.max(t-E-F,0)}},{key:"padding",get:function(){return this._get("padding")},
set:function(t){this._overrideIfSome("padding",t)}},{key:"width",get:function(){const t=this.view?.width??0;if(0===t)return t;const C=this._getViewPadding(),{left:E,right:F}=C;return Math.max(t-E-F,0)}},{key:"test",get:function(){return{components:this._components}}}]);return v}(n.EventedAccessor);b.__decorate([l.property()],c.prototype,"_locale",void 0);b.__decorate([l.property()],c.prototype,"container",null);b.__decorate([l.property()],c.prototype,"height",null);b.__decorate([l.property({value:D})],
c.prototype,"padding",null);b.__decorate([g.cast("padding")],c.prototype,"castPadding",null);b.__decorate([l.property()],c.prototype,"view",void 0);b.__decorate([l.property()],c.prototype,"width",null);return c=b.__decorate([e.subclass("esri.views.ui.UI")],c)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){n=function(p){function h(q,y){var B=r.call(this,q,y);B._isOpen=!1;B._attributionTextOverflowed=!1;B._prevSourceNodeHeight=0;B._resizeObserver=new ResizeObserver(D=>D.forEach(({target:z})=>B._checkSourceTextOverflow(z)));B.iconClass="esri-icon-description";B.itemDelimiter=" | ";B.messages=null;B.viewModel=new f;return B}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.initialize=function(){this.addHandles(c.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))};
p.destroy=function(){this._resizeObserver?.disconnect()};p.render=function(){return k.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};p.renderPoweredBy=function(){return k.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",k.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",
rel:"noreferrer"},"Esri"))};p.renderSourcesNode=function(){const q=this._isOpen,y=this._isInteractive,B=y?"0":"",{attributionText:D}=this;return k.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:q,["esri-interactive"]:y}),innerHTML:D,tabindex:B})};p._afterSourcesNodeCreate=function(q){this._prevSourceNodeHeight=q.clientWidth;this._resizeObserver.observe(q)};p._checkSourceTextOverflow=function(q){let y=
!1;const {clientHeight:B,clientWidth:D,scrollWidth:z}=q;q=z>D;const v=this._attributionTextOverflowed!==q;this._attributionTextOverflowed=q;v&&(y=!0);this._isOpen&&(q=B<this._prevSourceNodeHeight,this._prevSourceNodeHeight=B,q&&(this._isOpen=!1,y=!0));y&&this.scheduleRender()};p._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(h,[{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((q,
y)=>{q.includes(y.text)||q.push(y.text);return q},[]).join(this.itemDelimiter)}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(q){this._overrideIfSome("label",q)}},{key:"view",get:function(){return this.viewModel.view},set:function(q){this.viewModel.view=q}}]);return h}(g);b.__decorate([w.property()],n.prototype,"_isOpen",void 0);b.__decorate([w.property()],n.prototype,"_isInteractive",null);b.__decorate([w.property()],n.prototype,"_attributionTextOverflowed",void 0);
b.__decorate([w.property()],n.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([w.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],n.prototype,"attributionText",null);b.__decorate([w.property()],n.prototype,"iconClass",void 0);b.__decorate([w.property()],n.prototype,"itemDelimiter",void 0);b.__decorate([w.property()],n.prototype,"label",null);b.__decorate([w.property(),e.messageBundle("esri/widgets/Attribution/t9n/Attribution")],n.prototype,"messages",void 0);b.__decorate([w.property()],
n.prototype,"view",null);b.__decorate([w.property({type:f})],n.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],n.prototype,"_toggleState",null);return n=b.__decorate([l.subclass("esri.widgets.Attribution")],n)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){function h(B,D){return B&&"copyright"in B&&(!D||"function"===typeof B.originOf&&"user"===B.originOf("copyright"))}function r(B,D){return B.length!==D.length||B.some((z,v)=>z.text!==D[v].text)}function q(B,D,z){z&&D&&(B.find(v=>v.layerView===D&&v.text===z)||B.push({text:z,layerView:D}))}const y=[];c=function(B){function D(v){var A=z.call(this,v);A._clear=()=>{A._fetchedAttributionData.clear();A._pendingAttributions.clear();A.handles.remove("suspension");A.notifyChange("state")};
A._pendingAttributions=new Set;A._fetchedAttributionData=new Map;A.items=new n;A.view=null;A._allLayerViewsChange=t=>{A.handles.remove("suspension");const C=A.get("view.allLayerViews");C&&A.handles.add(C.map(E=>m.watch(()=>[E.suspended,E.layer?.attributionVisible],()=>A._updateAttributionItems())),"suspension");t&&t.removed&&t.removed.forEach(E=>{A._pendingAttributions.delete(E);A._fetchedAttributionData.delete(E)});A._updateAttributionItems()};A.handles.add([m.on(()=>A.view?.allLayerViews,"change",
t=>A._allLayerViewsChange(t),{onListenerAdd:()=>A._allLayerViewsChange(),onListenerRemove:A._clear}),m.when(()=>!0===A.view?.stationary,()=>A._updateAttributionItems())]);return A}a._inherits(D,B);var z=a._createSuper(D);B=D.prototype;B.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};B._updateAttributionItems=function(){const v=this.view,A=v?.allLayerViews;y.length=0;v&&A?(A.forEach(t=>{if(!t.suspended&&t.layer?.attributionVisible){var C=
t.layer;if(h(C,"user"))q(y,t,C.copyright);else if(C.hasAttributionData)if(this._fetchedAttributionData.has(t)){var E=this._fetchedAttributionData.get(t);E?q(y,t,this._getDynamicAttribution(E,v,C)):h(C)&&q(y,t,C.copyright)}else this._fetchAttributionData(t);else(E=C.get("portalItem.accessInformation"))?q(y,t,E):q(y,t,C.copyright)}}),r(this.items,y)&&(this.items.removeAll(),this.items.addMany(y)),y.length=0,this.notifyChange("state")):this._clear()};B._fetchAttributionData=async function(v){if(!this._pendingAttributions.has(v)){this._pendingAttributions.add(v);
var A=await w.result(v.layer.fetchAttributionData());this._pendingAttributions.has(v)&&(A=A.ok?this._createContributionIndex(A.value,"bing-maps"===v.layer.type):null,this._pendingAttributions.delete(v),this._fetchedAttributionData.set(v,A));this._updateAttributionItems()}};B._createContributionIndex=function(v,A){v=v.contributors;const t={};if(!v)return t;for(let H=0;H<v.length;H++){const K=v[H];var C=K.coverageAreas;if(!C)return;for(const I of C){var E=I.bbox,F=I.zoomMin-(A&&I.zoomMin?1:0);C=I.zoomMax-
(A&&I.zoomMax?1:0);for(E={extent:u.geographicToWebMercator({xmin:E[1],ymin:E[0],xmax:E[3],ymax:E[2],spatialReference:p.WGS84}),attribution:K.attribution||"",score:null!=I.score?I.score:100,id:H};F<=C;F++)t[F]=t[F]||[],t[F].push(E)}}t.maxKey=Math.max.apply(null,Object.keys(t));return t};B._getDynamicAttribution=function(v,A,t){const {extent:C,scale:E}=A;t=t.tileInfo?.scaleToZoom(E)??0;t=Math.min(v.maxKey??0,Math.round(t));if(!C||null==t||-1>=t)return"";v=v[t];const F=u.project(C.center.clone().normalize(),
A.spatialReference),H={};return v?v.filter(K=>{const I=K.id;(K=!H[I]&&F&&K.extent&&k.extentContainsPoint(K.extent,F))&&(H[I]=!0);return K}).sort((K,I)=>I.score-K.score||K.objectId-I.objectId).map(K=>K.attribution).join(", "):""};a._createClass(D,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return D}(x.HandleOwner);b.__decorate([l.property({readOnly:!0,type:n})],c.prototype,"items",void 0);b.__decorate([l.property({readOnly:!0})],
c.prototype,"state",null);b.__decorate([l.property()],c.prototype,"view",void 0);return c=b.__decorate([e.subclass("esri.widgets.Attribution.AttributionViewModel")],c)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){w=function(p){function h(q,y){q=r.call(this,q,y);q.iconClass=f.CSS.widgetIcon;q.messages=null;q.viewModel=new g;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.reset=function(){return this.viewModel.reset()};p.render=function(){const {orientation:q,state:y}=this.viewModel;var B="disabled"===y,D="compass"===("rotation"===y?"rotation":"compass");const z=B?-1:0;B={[f.CSS.disabled]:B,[f.CSS.interactive]:!B};D={[f.CSS.northIcon]:D,[f.CSS.rotationIcon]:!D};
const {messages:v}=this;return k.tsx("div",{bind:this,class:this.classes(f.CSS.base,B),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:z,"aria-label":v.reset,title:v.reset},k.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.icon,D),styles:this._toRotationTransform(q)}),k.tsx("span",{class:f.CSS.text},v.reset))};p._reset=function(){this.viewModel.reset()};p._toRotationTransform=function(q){return{transform:`rotateZ(${q.z}deg)`}};a._createClass(h,[{key:"goToOverride",get:function(){return this.viewModel.goToOverride},
set:function(q){this.viewModel.goToOverride=q}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(q){this._overrideIfSome("label",q)}},{key:"view",get:function(){return this.viewModel.view},set:function(q){this.viewModel.view=q}}]);return h}(l);b.__decorate([c.property()],w.prototype,"goToOverride",null);b.__decorate([c.property()],w.prototype,"iconClass",void 0);b.__decorate([c.property()],w.prototype,"label",null);b.__decorate([c.property(),e.messageBundle("esri/widgets/Compass/t9n/Compass")],
w.prototype,"messages",void 0);b.__decorate([c.property()],w.prototype,"view",null);b.__decorate([c.property({type:g})],w.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],w.prototype,"_reset",null);return w=b.__decorate([m.subclass("esri.widgets.Compass")],w)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){c=function(k){function u(h){h=p.call(this,h);h._handles=new w;h.orientation={x:0,y:0,z:0};h.view=null;h._updateForCamera=h._updateForCamera.bind(a._assertThisInitialized(h));h._updateForRotation=h._updateForRotation.bind(a._assertThisInitialized(h));h._updateRotationWatcher=h._updateRotationWatcher.bind(a._assertThisInitialized(h));return h}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.initialize=function(){this._handles.add(x.watch(()=>this.view,this._updateRotationWatcher,
x.initial))};k.destroy=function(){n.removeMaybe(this._handles);this.view=null};k.reset=function(){if(this.get("view.ready")){var h={};"2d"===this.view?.type?h.rotation=0:h.heading=0;this.callGoTo({target:h})}};k._updateForRotation=function(h){void 0!==h&&null!==h&&(this.orientation={z:h})};k._updateForCamera=function(h){h&&(this.orientation={x:0,y:0,z:-h.heading})};k._updateRotationWatcher=function(h){this._handles.removeAll();h&&this._handles.add("2d"===h.type?x.watch(()=>h?.rotation,this._updateForRotation,
x.initial):x.watch(()=>h?.camera,this._updateForCamera,x.initial))};a._createClass(u,[{key:"canShowNorth",get:function(){const h=this.get("view.spatialReference");return!(!h||!h.isWebMercator&&!h.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return u}(e.GoToMixin(c));b.__decorate([m.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([m.property()],c.prototype,"orientation",void 0);b.__decorate([m.property({readOnly:!0})],
c.prototype,"state",null);b.__decorate([m.property()],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/Compass/css":function(){define(["exports"],function(a){a.CSS={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){w=function(p){function h(q,y){q=r.call(this,q,y);q.iconClass=g.CSS.widgetIcon;q.messages=null;q.viewModel=new f;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.toggle=function(){return this.viewModel.toggle()};p.render=function(){const q="disabled"===this.get("viewModel.state");var y="pan"===this.get("viewModel.navigationMode");const B={[g.CSS.activeButton]:y};y={[g.CSS.activeButton]:!y};const D=q?-1:0,z=this.messages.toggle;return k.tsx("div",
{bind:this,class:this.classes(g.CSS.base,{[g.CSS.disabled]:q,[g.CSS.isLayoutHorizontal]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:D,"aria-label":z,title:z},k.tsx("div",{class:this.classes(g.CSS.button,g.CSS.panButton,B)},k.tsx("span",{class:g.CSS.panIcon})),k.tsx("div",{class:this.classes(g.CSS.button,g.CSS.rotateButton,y)},k.tsx("span",{class:g.CSS.rotationIcon})))};p._toggle=function(){this.toggle()};a._createClass(h,[{key:"label",get:function(){return this.messages?.widgetLabel??
""},set:function(q){this._overrideIfSome("label",q)}},{key:"layout",set:function(q){"horizontal"!==q&&(q="vertical");this._set("layout",q)}},{key:"view",get:function(){return this.viewModel.view},set:function(q){this.viewModel.view=q}}]);return h}(l);b.__decorate([c.property()],w.prototype,"iconClass",void 0);b.__decorate([c.property()],w.prototype,"label",null);b.__decorate([c.property({value:"vertical"})],w.prototype,"layout",null);b.__decorate([c.property(),e.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],
w.prototype,"messages",void 0);b.__decorate([c.property()],w.prototype,"view",null);b.__decorate([c.property({type:f})],w.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],w.prototype,"_toggle",null);return w=b.__decorate([m.subclass("esri.widgets.NavigationToggle")],w)})},"esri/widgets/NavigationToggle/css":function(){define(["exports"],function(a){a.CSS={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",
panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){c=function(f){function d(k){k=e.call(this,k);k.navigationMode="pan";k.view=null;return k}a._inherits(d,f);var e=a._createSuper(d);f=d.prototype;f.initialize=function(){this.own(w.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))};f.destroy=function(){this.view=null};f.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};f._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate"};a._createClass(d,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view?.type?"ready":"disabled"}}]);return d}(c);b.__decorate([n.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([n.property()],c.prototype,"navigationMode",void 0);b.__decorate([n.property()],c.prototype,"view",void 0);return c=b.__decorate([g.subclass("esri.widgets.NavigationToggleViewModel")],c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){n=function(p){function h(q,y){q=r.call(this,q,y);q.iconClass="esri-icon-zoom-in-magnifying-glass";q.messages=null;q.viewModel=new u;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.initialize=function(){this._zoomInButton=new k({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new k({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};p.destroy=function(){this._zoomInButton=c.destroyMaybe(this._zoomInButton);
this._zoomOutButton=c.destroyMaybe(this._zoomOutButton)};p.render=function(){const q={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:y,canZoomOut:B}=this.viewModel;this._zoomInButton.enabled=y;this._zoomOutButton.enabled=B;const {zoomIn:D,zoomOut:z}=this.messages;this._zoomInButton.title=D;this._zoomOutButton.title=z;return e.tsx("div",{class:this.classes("esri-zoom esri-widget",q)},this._zoomInButton.render(),this._zoomOutButton.render())};p.zoomIn=function(){return this.viewModel.zoomIn()};
p.zoomOut=function(){return this.viewModel.zoomOut()};a._createClass(h,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(q){this._overrideIfSome("label",q)}},{key:"layout",set:function(q){"horizontal"!==q&&(q="vertical");this._set("layout",q)}},{key:"view",get:function(){return this.viewModel.view},set:function(q){this.viewModel.view=q}}]);return h}(g);b.__decorate([w.property()],n.prototype,"iconClass",void 0);b.__decorate([w.property()],n.prototype,"label",null);b.__decorate([w.property({value:"vertical"})],
n.prototype,"layout",null);b.__decorate([w.property(),d.messageBundle("esri/widgets/Zoom/t9n/Zoom")],n.prototype,"messages",void 0);b.__decorate([w.property()],n.prototype,"view",null);b.__decorate([w.property({type:u})],n.prototype,"viewModel",void 0);return n=b.__decorate([l.subclass("esri.widgets.Zoom")],n)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){w=function(e){function k(){var p=u.apply(this,arguments);p.enabled=!0;p.iconClass="";p.title="";return p}a._inherits(k,e);var u=a._createSuper(k);e=k.prototype;e.render=function(){const p=this.enabled?0:-1,h={[this.iconClass]:!!this.iconClass};return f.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:p,
title:this.title},f.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",h)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};e._triggerAction=function(){this.action.call(this)};return a._createClass(k)}(l);b.__decorate([c.property()],w.prototype,"action",void 0);b.__decorate([c.property()],w.prototype,"enabled",void 0);b.__decorate([c.property()],w.prototype,"iconClass",void 0);b.__decorate([c.property()],w.prototype,"title",void 0);b.__decorate([g.accessibleHandler()],
w.prototype,"_triggerAction",null);return w=b.__decorate([m.subclass("esri.widgets.IconButton")],w)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,
b,c,w,n,x,m,l,g,f,d,e){c=function(k){function u(h){return p.call(this,h)}a._inherits(u,k);var p=a._createSuper(u);k=u.prototype;k.destroy=function(){this.view=null};k.zoomIn=function(){if(this.canZoomIn){var h=this.view;"2d"===h.type?h.mapViewNavigation.zoomIn():n.ignoreAbortErrors(h.goTo({zoomFactor:2}))}};k.zoomOut=function(){if(this.canZoomOut){var h=this.view;"2d"===h.type?h.mapViewNavigation.zoomOut():n.ignoreAbortErrors(h.goTo({zoomFactor:.5}))}};a._createClass(u,[{key:"canZoomIn",get:function(){return w.isSome(this._zoomConditions)&&
this._zoomConditions.canZoomIn}},{key:"canZoomOut",get:function(){return w.isSome(this._zoomConditions)&&this._zoomConditions?.canZoomOut}},{key:"state",get:function(){return this.view?.ready?"ready":"disabled"}},{key:"view",set:function(h){h?"2d"===h.type?this._zoomConditions=new d({view:h}):"3d"===h.type&&(this._zoomConditions=new e({view:h})):this._zoomConditions=null;this._set("view",h)}}]);return u}(c);b.__decorate([x.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([x.property()],
c.prototype,"canZoomIn",null);b.__decorate([x.property()],c.prototype,"canZoomOut",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([x.property()],c.prototype,"view",null);return c=b.__decorate([f.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){c=function(g){function f(){return d.apply(this,arguments)}a._inherits(f,g);var d=a._createSuper(f);a._createClass(f,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),k=this.get("view.constraints.effectiveMaxScale");return 0===k||e>k}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),k=this.get("view.constraints.effectiveMinScale");
return 0===k||e<k}}]);return f}(c);b.__decorate([w.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([w.property()],c.prototype,"view",void 0);return c=b.__decorate([l.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){c=function(g){function f(){return d.apply(this,arguments)}a._inherits(f,g);var d=a._createSuper(f);a._createClass(f,[{key:"canZoomIn",get:function(){return!!this.view.ready}},{key:"canZoomOut",get:function(){return!!this.view.ready}}]);return f}(c);b.__decorate([w.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([w.property()],c.prototype,"view",void 0);return c=b.__decorate([l.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),function(a,b,c,w,n,x,m,l){w=function(g){function f(e){e=d.call(this,e);e.components=["attribution","zoom","navigation-toggle","compass"];return e}a._inherits(f,g);var d=
a._createSuper(f);return a._createClass(f)}(l);b.__decorate([c.property()],w.prototype,"components",void 0);return w=b.__decorate([m.subclass("esri.views.ui.3d.DefaultUI3D")],w)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/featureFlags ../support/popupUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa,ia,na,ba,ea,ja,ka,da,ha,ca,fa,ma,qa){const wa=["3DObject","Point"];x=X.defineFieldProperties();D=function(ra){function va(...Aa){Aa=Ba.call(this,...Aa);Aa.featureReduction=null;Aa.rangeInfos=null;Aa.operationalLayerType="ArcGISSceneServiceLayer";Aa.type="scene";Aa.fields=null;Aa.floorInfo=null;Aa.outFields=null;Aa.nodePages=null;Aa.materialDefinitions=null;Aa.textureSetDefinitions=null;Aa.geometryDefinitions=
null;Aa.serviceUpdateTimeStamp=null;Aa.excludeObjectIds=new r;Aa.definitionExpression=null;Aa.filter=null;Aa.path=null;Aa.labelsVisible=!0;Aa.labelingInfo=null;Aa.legendEnabled=!0;Aa.priority=null;Aa.semantic=null;Aa.cachedDrawingInfo={color:!1};Aa.popupEnabled=!0;Aa.popupTemplate=null;Aa.objectIdField=null;Aa.globalIdField=null;Aa._fieldUsageInfo={};Aa.screenSizePerspectiveEnabled=!0;return Aa}b._inherits(va,ra);var Ba=b._createSuper(va);ra=va.prototype;ra.normalizeCtorArgs=function(Aa,Ha){return"string"===
typeof Aa?{url:Aa,...Ha}:Aa};ra.getField=function(Aa){return this.fieldsIndex.get(Aa)};ra.getFieldDomain=function(Aa,Ha){return(Ha=this.getFeatureType(Ha?.feature)?.domains?.[Aa])&&"inherited"!==Ha.type?Ha:this.getField(Aa)?.domain??null};ra.getFeatureType=function(Aa){return null!=Aa&&B.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(Aa):null};ra.readNodePages=function(Aa,Ha,Ka){"Point"===Ha.layerType&&(Aa=Ha.pointNodePages);return null==Aa||"object"!==typeof Aa?null:aa.I3SNodePageDefinition.fromJSON(Aa,
Ka)};ra.readCachedDrawingInfo=function(Aa){if(null==Aa||"object"!==typeof Aa)Aa={};null==Aa.color&&(Aa.color=!1);return Aa};ra.readObjectIdField=function(Aa,Ha){!Aa&&Ha.fields&&Ha.fields.some(Ka=>{"esriFieldTypeOID"===Ka.type&&(Aa=Ka.name);return!!Aa});return Aa||void 0};ra.readGlobalIdField=function(Aa,Ha){!Aa&&Ha.fields&&Ha.fields.some(Ka=>{"esriFieldTypeGlobalID"===Ka.type&&(Aa=Ka.name);return!!Aa});return Aa||void 0};ra.readProfile=function(Aa,Ha){Aa=Ha.store.profile;if(null!=Aa&&xa[Aa])return xa[Aa];
y.getLogger(this.declaredClass).error("Unknown or missing profile",{profile:Aa,layer:this});return"mesh-pyramids"};ra.load=function(Aa){const Ha=B.isSome(Aa)?Aa.signal:null,Ka=this.loadFromPortal({supportedTypes:["Scene Service"]},Aa).catch(z.throwIfAbortError).then(()=>this._fetchService(Ha)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Ha),this._setAssociatedFeatureLayer(Ha),B.isSome(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>
this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>ka.loadStyleRenderer(this,{origin:"service"},Ha)).then(()=>Y.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(Aa));this.addResolvingPromise(Ka);return Promise.resolve(this)};ra.beforeSave=async function(){B.isSome(this.filter)&&await this.load()};ra.createQuery=function(){const Aa=new da;"mesh"!==this.geometryType&&(Aa.returnGeometry=!0,Aa.returnZ=!0);Aa.where=this.definitionExpression||
"1\x3d1";Aa.sqlFormat="standard";Aa.outFields=["*"];return Aa};ra.queryExtent=function(Aa,Ha){return this._getAssociatedLayerForQuery().then(Ka=>Ka.queryExtent(Aa||this.createQuery(),Ha))};ra.queryFeatureCount=function(Aa,Ha){return this._getAssociatedLayerForQuery().then(Ka=>Ka.queryFeatureCount(Aa||this.createQuery(),Ha))};ra.queryFeatures=function(Aa,Ha){return this._getAssociatedLayerForQuery().then(Ka=>Ka.queryFeatures(Aa||this.createQuery(),Ha)).then(Ka=>{if(Ka?.features)for(const Pa of Ka.features)Pa.layer=
this,Pa.sourceLayer=this;return Ka})};ra.queryCachedAttributes=async function(Aa,Ha){const Ka=Y.unpackFieldNames(this.fieldsIndex,await ma.getRequiredFields(this,ma.getFetchPopupTemplate(this)));return fa.queryAttributesFromCachedAttributesId(this.parsedUrl.path,this.attributeStorageInfo??[],Aa,Ha,Ka)};ra.queryCachedFeature=async function(Aa,Ha){Aa=await this.queryCachedAttributes(Aa,[Ha]);if(!Aa||0===Aa.length)throw new q("scenelayer:feature-not-in-cached-data","Feature not found in cached data");
Ha=new w;Ha.attributes=Aa[0];Ha.layer=this;Ha.sourceLayer=this;return Ha};ra.queryObjectIds=function(Aa,Ha){return this._getAssociatedLayerForQuery().then(Ka=>Ka.queryObjectIds(Aa||this.createQuery(),Ha))};ra.queryAttachments=function(Aa,Ha){return this._getAssociatedLayerForQuery().then(Ka=>Ka.queryAttachments(Aa,Ha))};ra.getFieldUsageInfo=function(Aa){const Ha={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[Aa]||
Ha:(y.getLogger(this.declaredClass).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Ha)};ra.createPopupTemplate=function(Aa){return ca.createPopupTemplate(this,Aa)};ra._getAssociatedLayerForQuery=function(){const Aa=this.associatedLayer;return B.isSome(Aa)&&Aa.loaded?Promise.resolve(Aa):this._loadAssociatedLayerForQuery()};ra._loadAssociatedLayerForQuery=async function(){await this.load();if(B.isNone(this.associatedLayer))throw new q("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",
{layer:this});try{await this.associatedLayer.load()}catch(Aa){throw new q("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:Aa});}return this.associatedLayer};ra.hasCachedStatistics=function(Aa){return null!=this.statisticsInfo&&this.statisticsInfo.some(Ha=>Ha.name===Aa)};ra.queryCachedStatistics=async function(Aa,Ha){await this.load(Ha);if(!this.statisticsInfo)throw new q("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");
const Ka=this.fieldsIndex.get(Aa);if(!Ka)throw new q("scenelayer:field-unexisting",`Field '${Aa}' does not exist on the layer`);for(const Pa of this.statisticsInfo)if(Pa.name===Ka.name)return Aa=A.join(this.parsedUrl.path,Pa.href),h(Aa,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Ha?Ha.signal:null}).then(Ra=>Ra.data);throw new q("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");};ra.saveAs=async function(Aa,Ha){return this._debouncedSaveOperations(N.SaveOperationType.SAVE_AS,
{...Ha,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Aa)};ra.save=async function(){return this._debouncedSaveOperations(N.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})};ra.applyEdits=async function(Aa,Ha){const Ka=await new Promise((Pa,Ra)=>a(["./graphics/editingSupport"],Pa,Ra));await this.load();if(B.isNone(this.associatedLayer))throw new q(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();
return Ka.applyEdits(this,this.associatedLayer.source,Aa,Ha)};ra.on=function(Aa,Ha){return b._get(b._getPrototypeOf(va.prototype),"on",this).call(this,Aa,Ha)};ra.validateLayer=function(Aa){if(Aa.layerType&&!wa.includes(Aa.layerType))throw new q("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:Aa.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new q("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new q("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});Aa=this.normalReferenceFrame;var Ha=this.spatialReference;let Ka=!1,Pa=!1;if(null==Aa)Pa=Ka=!0;else switch(Ha=Ha&&Ha.isGeographic,Aa){case "east-north-up":case "earth-centered":Ka=!0;Pa=Ha;break;case "vertex-reference-frame":Ka=!0;Pa=!Ha;break;default:Ka=!1}if(!Ka)throw new q("scenelayer:unsupported-normal-reference-frame",
"Normal reference frame is invalid.");if(!Pa)throw new q("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};ra._getTypeKeywords=function(){const Aa=[];if("points"===this.profile)Aa.push("Point");else if("mesh-pyramids"===this.profile)Aa.push("3DObject");else throw new q("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return Aa};ra._populateFieldUsageInfo=function(){this._fieldUsageInfo=
{};if(this.fields)for(const Aa of this.fields){const Ha=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Pa=>Pa.name===Aa.name)),Ka=!!(B.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(Pa=>Pa&&Aa.name===Pa.name));this._fieldUsageInfo[Aa.name]={supportsLabelingInfo:Ha,supportsRenderer:Ha,supportsPopupTemplate:Ha||Ka,supportsLayerQuery:Ka}}};ra._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};
ra._applyAssociatedLayerFieldsOverrides=function(){if(!B.isNone(this.associatedLayer)&&this.associatedLayer.fields){var Aa=null;for(const Ha of this.associatedLayer.fields){const Ka=this.getField(Ha.name);Ka?(!Ka.domain&&Ha.domain&&(Ka.domain=Ha.domain.clone()),Ka.editable=Ha.editable,Ka.nullable=Ha.nullable,Ka.length=Ha.length):(Aa||(Aa=this.fields?this.fields.slice():[]),Aa.push(Ha.clone()))}Aa&&this._set("fields",Aa)}};ra._applyAssociatedLayerPopupOverrides=function(){if(!B.isNone(this.associatedLayer)){var Aa=
["popupTemplate","popupEnabled"],Ha=H.getProperties(this);for(let Ka=0;Ka<Aa.length;Ka++){const Pa=Aa[Ka],Ra=this.originIdOf(Pa),Sa=this.associatedLayer.originIdOf(Pa);Ra<Sa&&(Sa===L.OriginId.SERVICE||Sa===L.OriginId.PORTAL_ITEM)&&Ha.setAtOrigin(Pa,this.associatedLayer[Pa],Sa)}}};ra._setAssociatedFeatureLayer=async function(Aa){if(["mesh-pyramids","points"].includes(this.profile)){Aa=new T.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,Aa);try{this.associatedLayer=await Aa.fetch()}catch(Ha){z.isAbortError(Ha)||
this._logWarningOnPopupEnabled()}}};ra._logWarningOnPopupEnabled=async function(){await v.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const Aa=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?y.getLogger(this.declaredClass).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Aa}`):y.getLogger(this.declaredClass).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Aa}`)};
ra._validateElevationInfo=function(){const Aa=this.elevationInfo;Aa&&("mesh-pyramids"===this.profile&&"relative-to-scene"===Aa.mode&&y.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Mesh scene layers don't support relative-to-scene elevation mode"),Aa.featureExpressionInfo&&"0"!==Aa.featureExpressionInfo.expression&&y.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};b._createClass(va,[{key:"types",get:function(){return B.isSome(this.associatedLayer)?
this.associatedLayer.types??[]:[]}},{key:"typeIdField",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",get:function(){return new Z(this.fields)}},{key:"elevationInfo",set:function(Aa){this._set("elevationInfo",Aa);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return pa[this.profile]||"mesh"}},
{key:"renderer",set:function(Aa){Y.fixRendererFields(Aa,this.fieldsIndex);this._set("renderer",Aa)}},{key:"capabilities",get:function(){var Aa=B.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:S.zeroCapabilities;const {query:Ha,editing:{supportsGlobalId:Ka,supportsRollbackOnFailure:Pa,supportsUploadWithItemId:Ra,supportsGeometryUpdate:Sa,supportsReturnServiceEditsInSourceSpatialReference:La},data:{supportsZ:Ua,supportsM:Za,isVersioned:Xa,supportsAttachment:la},
operations:{supportsEditing:Ta,supportsAdd:Ma,supportsUpdate:fb,supportsDelete:ya,supportsQuery:oa,supportsQueryAttachments:ua}}=Aa;Aa=Aa.operations.supportsChangeTracking;const Da=B.isSome(this.associatedLayer)&&B.isSome(this.associatedLayer.infoFor3D)&&ha.sceneLayerEditingEnabled();return{query:Ha,editing:{supportsGlobalId:Ka,supportsReturnServiceEditsInSourceSpatialReference:La,supportsRollbackOnFailure:Pa,supportsGeometryUpdate:Da&&Sa,supportsUploadWithItemId:Ra},data:{supportsAttachment:la,supportsZ:Ua,
supportsM:Za,isVersioned:Xa},operations:{supportsQuery:oa,supportsQueryAttachments:ua,supportsEditing:Ta&&Aa,supportsAdd:Da&&Ma&&Aa,supportsDelete:Da&&ya&&Aa,supportsUpdate:fb&&Aa}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(Aa){this._overrideIfSome("editingEnabled",Aa)}},{key:"infoFor3D",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.infoFor3D:null}},{key:"defaultPopupTemplate",
get:function(){return B.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return va}(M.EditBusLayer(N.SceneService(J.ArcGISService(G.OperationalLayer(P.PortalLayer(U.ScaleRangeLayer(D.MultiOriginJSONMixin(O.APIKeyMixin(R)))))))));c.__decorate([t.property({types:{key:"type",base:W.FeatureReduction,typeMap:{selection:V}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",
write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],D.prototype,"featureReduction",void 0);c.__decorate([t.property({type:[ea.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],D.prototype,"rangeInfos",void 0);c.__decorate([t.property({json:{read:!1}})],D.prototype,"associatedLayer",void 0);c.__decorate([t.property({type:["show","hide"]})],D.prototype,"listMode",void 0);
c.__decorate([t.property({type:["ArcGISSceneServiceLayer"]})],D.prototype,"operationalLayerType",void 0);c.__decorate([t.property({json:{read:!1},readOnly:!0})],D.prototype,"type",void 0);c.__decorate([t.property({...x.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],D.prototype,"fields",void 0);c.__decorate([t.property()],D.prototype,"types",null);c.__decorate([t.property()],D.prototype,"typeIdField",null);c.__decorate([t.property()],D.prototype,"formTemplate",null);c.__decorate([t.property({readOnly:!0})],
D.prototype,"fieldsIndex",null);c.__decorate([t.property({type:ba,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],D.prototype,"floorInfo",void 0);c.__decorate([t.property(x.outFields)],D.prototype,"outFields",void 0);c.__decorate([t.property({type:aa.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],D.prototype,"nodePages",void 0);c.__decorate([K.reader("service","nodePages",["nodePages","pointNodePages"])],D.prototype,"readNodePages",null);c.__decorate([t.property({type:[aa.I3SMaterialDefinition],
readOnly:!0})],D.prototype,"materialDefinitions",void 0);c.__decorate([t.property({type:[aa.I3STextureSetDefinition],readOnly:!0})],D.prototype,"textureSetDefinitions",void 0);c.__decorate([t.property({type:[aa.I3SGeometryDefinition],readOnly:!0})],D.prototype,"geometryDefinitions",void 0);c.__decorate([t.property({readOnly:!0})],D.prototype,"serviceUpdateTimeStamp",void 0);c.__decorate([t.property({readOnly:!0})],D.prototype,"attributeStorageInfo",void 0);c.__decorate([t.property({readOnly:!0})],
D.prototype,"statisticsInfo",void 0);c.__decorate([t.property({type:r.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],D.prototype,"excludeObjectIds",void 0);c.__decorate([t.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],D.prototype,"definitionExpression",void 0);c.__decorate([t.property({type:ja,json:{name:"layerDefinition.polygonFilter",
write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],D.prototype,"filter",void 0);c.__decorate([t.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],D.prototype,"path",void 0);c.__decorate([t.property(Q.elevationInfo)],D.prototype,"elevationInfo",null);c.__decorate([t.property({type:String})],D.prototype,"geometryType",null);c.__decorate([t.property(Q.labelsVisible)],D.prototype,"labelsVisible",void 0);c.__decorate([t.property({type:[ia],json:{origins:{service:{name:"drawingInfo.labelingInfo",
read:{reader:na.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:na.reader},write:!0}})],D.prototype,"labelingInfo",void 0);c.__decorate([t.property(Q.legendEnabled)],D.prototype,"legendEnabled",void 0);c.__decorate([t.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(ra,va){if("number"===
typeof ra&&0<=ra&&1>=ra)return ra;ra=va.layerDefinition?.drawingInfo?.transparency;return void 0!==ra?qa.transparencyToOpacity(ra):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],D.prototype,"opacity",void 0);c.__decorate([t.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],D.prototype,"priority",void 0);c.__decorate([t.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],D.prototype,"semantic",void 0);c.__decorate([t.property({types:p.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],D.prototype,"renderer",null);c.__decorate([t.property({json:{read:!1}})],D.prototype,"cachedDrawingInfo",void 0);c.__decorate([K.reader("service","cachedDrawingInfo")],D.prototype,"readCachedDrawingInfo",null);c.__decorate([t.property({readOnly:!0,json:{read:!1}})],D.prototype,"capabilities",null);c.__decorate([t.property({type:Boolean,json:{read:!1}})],D.prototype,"editingEnabled",
null);c.__decorate([t.property({readOnly:!0,json:{write:!1,read:!1}})],D.prototype,"infoFor3D",null);c.__decorate([t.property(Q.popupEnabled)],D.prototype,"popupEnabled",void 0);c.__decorate([t.property({type:n,json:{name:"popupInfo",write:!0}})],D.prototype,"popupTemplate",void 0);c.__decorate([t.property({readOnly:!0,json:{read:!1}})],D.prototype,"defaultPopupTemplate",null);c.__decorate([t.property({type:String,json:{read:!1}})],D.prototype,"objectIdField",void 0);c.__decorate([K.reader("service",
"objectIdField",["objectIdField","fields"])],D.prototype,"readObjectIdField",null);c.__decorate([t.property({type:String,json:{read:!1}})],D.prototype,"globalIdField",void 0);c.__decorate([K.reader("service","globalIdField",["globalIdField","fields"])],D.prototype,"readGlobalIdField",null);c.__decorate([t.property({readOnly:!0,type:String,json:{read:!1}})],D.prototype,"displayField",null);c.__decorate([t.property({type:String,json:{read:!1}})],D.prototype,"profile",void 0);c.__decorate([K.reader("service",
"profile",["store.profile"])],D.prototype,"readProfile",null);c.__decorate([t.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],D.prototype,"normalReferenceFrame",void 0);c.__decorate([t.property(Q.screenSizePerspectiveEnabled)],D.prototype,"screenSizePerspectiveEnabled",void 0);D=c.__decorate([I.subclass("esri.layers.SceneLayer")],D);const xa={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",
points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},pa={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return D})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E){const F=x.getLogger("esri.layers.mixins.SceneService");var H;(function(I){I[I.existingItem=0]="existingItem";I[I.newItem=1]="newItem"})(H||(H={}));const K={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(I){I[I.SAVE=0]="SAVE";I[I.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SCENE_SERVICE_ITEM_TYPE=
"Scene Service";a.SceneService=I=>{I=function(L){function R(){var J=O.apply(this,arguments);J.spatialReference=null;J.fullExtent=null;J.heightModelInfo=null;J.minScale=0;J.maxScale=0;J.version={major:Number.NaN,minor:Number.NaN,versionString:""};J.copyright=null;J.sublayerTitleMode="item-title";J.title=null;J.layerId=null;J.indexInfo=null;J._debouncedSaveOperations=l.debounce(async(M,G,P)=>{switch(M){case a.SaveOperationType.SAVE:return J._save(G);case a.SaveOperationType.SAVE_AS:return J._saveAs(P,
G)}});return J}b._inherits(R,L);var O=b._createSuper(R);L=R.prototype;L.readSpatialReference=function(J,M){return this._readSpatialReference(M)};L._readSpatialReference=function(J){if(null!=J.spatialReference)return B.fromJSON(J.spatialReference);J=J.store;J=(J=J.indexCRS||J.geographicCRS)&&parseInt(J.substring(J.lastIndexOf("/")+1,J.length),10);return null!=J?new B(J):null};L.readFullExtent=function(J,M,G){if(null!=J&&"object"===typeof J)return M=null==J.spatialReference?{...J,spatialReference:this._readSpatialReference(M)}:
J,q.fromJSON(M,G);G=M.store;M=this._readSpatialReference(M);return null==M||null==G||null==G.extent||!Array.isArray(G.extent)||G.extent.some(P=>-1E38>P)?null:new q({xmin:G.extent[0],ymin:G.extent[1],xmax:G.extent[2],ymax:G.extent[3],spatialReference:M})};L.parseVersionString=function(J){const M={major:Number.NaN,minor:Number.NaN,versionString:J};J=J.split(".");2<=J.length&&(M.major=parseInt(J[0],10),M.minor=parseInt(J[1],10));return M};L.readVersion=function(J,M){J=M.store;return this.parseVersionString(null!=
J.version?J.version.toString():"")};L.readTitlePortalItem=function(J){return"item-title"!==this.sublayerTitleMode?void 0:J};L.readTitleService=function(J,M){J=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return D.titleFromUrlAndName(this.url,M.name);M=M.name;if(!M&&this.url){const G=D.parse(this.url);m.isSome(G)&&(M=G.title)}"item-title-and-service-name"===this.sublayerTitleMode&&J&&(M=J+" - "+M);return D.cleanTitle(M)};L.writeUrl=function(J,M,G,P){D.writeUrlWithLayerId(this,
J,"layers",M,P)};L._fetchIndexAndUpdateExtent=async function(J,M){this.indexInfo=v.fetchIndexInfo(this.parsedUrl.path,this.rootNode,J,this.apiKey,F,M);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)};L._updateExtent=function(J){if("page"===J?.type){var M=J.rootIndex%J.pageSize;M=J.rootPage?.nodes?.[M];if(null==M||null==M.obb||null==M.obb.center||null==M.obb.halfSize)throw new n("sceneservice:invalid-node-page","Invalid node page.");-1E38>M.obb.center[0]||null==
this.fullExtent||this.fullExtent.hasZ||(J=M.obb.halfSize,M=M.obb.center[2],J=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]),this.fullExtent.zmin=M-J,this.fullExtent.zmax=M+J)}else if("node"===J?.type&&(M=J.rootNode?.mbs,Array.isArray(M)&&4===M.length&&!(-1E38>M[0]))){J=M[2];M=M[3];var {fullExtent:G}=this;G&&(G.zmin=J-M,G.zmax=J+M)}};L._fetchService=async function(J){if(null==this.url)throw new n("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&
/SceneServer\/*$/i.test(this.url)){const M=await this._fetchFirstLayerId(J);null!=M&&(this.layerId=M)}return this._fetchServiceLayer(J)};L._fetchFirstLayerId=async function(J){J=await w(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:J});if(J.data&&Array.isArray(J.data.layers)&&0<J.data.layers.length)return J.data.layers[0].id};L._fetchServiceLayer=async function(J){J=await w(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:J});J.ssl&&
(this.url=this.url.replace(/^http:/i,"https:"));let M=!1;J.data.layerType&&"Voxel"===J.data.layerType&&(M=!0);if(M)return this._fetchVoxelServiceLayer();J=J.data;this.read(J,this._getServiceContext());this.validateLayer(J)};L._fetchVoxelServiceLayer=async function(J){J=(await w(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:J})).data;this.read(J,this._getServiceContext());this.validateLayer(J)};L._getServiceContext=function(){return{origin:"service",portalItem:this.portalItem,
portal:this.portalItem?.portal,url:this.parsedUrl}};L._ensureLoadBeforeSave=async function(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()};L.validateLayer=function(J){};L._updateTypeKeywords=function(J,M,G){J.typeKeywords||(J.typeKeywords=[]);M=M.getTypeKeywords();for(const P of M)J.typeKeywords.push(P);J.typeKeywords&&(J.typeKeywords=J.typeKeywords.filter((P,U,N)=>N.indexOf(P)===U),G===H.newItem&&(J.typeKeywords=J.typeKeywords.filter(P=>"Hosted Service"!==
P)))};L._saveAs=async function(J,M){M={...K,...M};J=C.from(J);J||(F.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new n("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));J.id&&(J=J.clone(),J.id=null);const G=J.portal||t.getDefault();await this._ensureLoadBeforeSave();J.type="Scene Service";J.portal=G;const P={origin:"portal-item",url:null,messages:[],portal:G,portalItem:J,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],
toUpdate:[],toKeep:[],pendingOperations:[]}},U={layers:[this.write({},P)]};await Promise.all(P.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(U,P,M);J.url=this.url;J.title||(J.title=this.title);this._updateTypeKeywords(J,M,H.newItem);await G.signIn();await G.user?.addItem({item:J,folder:M&&M.folder,data:U});await E.saveResources(this.resourceReferences,P,null);this.portalItem=J;r.updateOrigins(P);return P.portalItem=J};L._save=async function(J){J={...K,...J};if(!this.portalItem)throw F.error("_save(): requires the .portalItem property to be set"),
new n("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if("Scene Service"!==this.portalItem.type)throw F.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected Scene Service"),new n("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"');await this._ensureLoadBeforeSave();const M={origin:"portal-item",url:this.portalItem.itemUrl&&g.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||
t.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},G={layers:[this.write({},M)]};await Promise.all(M.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(G,M,J);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,J,H.existingItem);await this.portalItem.update({data:G});await E.saveResources(this.resourceReferences,
M,null);r.updateOrigins(M);return this.portalItem};L._validateAgainstJSONSchema=async function(J,M,G){M=M.messages?.filter(S=>"error"===S.type).map(S=>new n(S.name,S.message,S.details))??[];G?.validationOptions?.ignoreUnsupported&&(M=M.filter(S=>"layer:unsupported"!==S.name&&"symbol:unsupported"!==S.name&&"symbol-layer:unsupported"!==S.name&&"property:unsupported"!==S.name&&"url:unsupported"!==S.name&&"scenemodification:unsupported"!==S.name));const P=G?.validationOptions,U=P?.enabled,N=A.getLoader();
if(U&&N&&(J=(await N()).validate(J,G.portalItemLayerType),0<J.length&&(G=`Layer item did not validate:\n${J.join("\n")}`,F.error(`_validateAgainstJSONSchema(): ${G}`),"throw"===P.failPolicy)))throw M=J.map(S=>new n("sceneservice:schema-validation",S)).concat(M),new n("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:M});if(0<M.length)throw new n("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:M});};b._createClass(R,[{key:"url",set:function(J){J=D.sanitizeUrlWithLayerId({layer:this,url:J,nonStandardUrlAllowed:!1,logger:F});this._set("url",J.url);null!=J.layerId&&this._set("layerId",J.layerId)}},{key:"parsedUrl",get:function(){var J=this._get("url");J=g.urlToObject(J);null!=this.layerId&&(J.path=`${J.path}/layers/${this.layerId}`);return J}}]);return R}(I);c.__decorate([f.property(z.id)],I.prototype,"id",void 0);c.__decorate([f.property({type:B})],I.prototype,"spatialReference",
void 0);c.__decorate([u.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],I.prototype,"readSpatialReference",null);c.__decorate([f.property({type:q})],I.prototype,"fullExtent",void 0);c.__decorate([u.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],I.prototype,"readFullExtent",null);c.__decorate([f.property({readOnly:!0,type:y})],I.prototype,"heightModelInfo",void 0);c.__decorate([f.property({type:Number,
json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],I.prototype,"minScale",void 0);c.__decorate([f.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],I.prototype,"maxScale",void 0);c.__decorate([f.property({readOnly:!0})],I.prototype,"version",void 0);c.__decorate([u.reader("version",["store.version"])],I.prototype,"readVersion",null);c.__decorate([f.property({type:String,
json:{read:{source:"copyrightText"}}})],I.prototype,"copyright",void 0);c.__decorate([f.property({type:String,json:{read:!1}})],I.prototype,"sublayerTitleMode",void 0);c.__decorate([f.property({type:String})],I.prototype,"title",void 0);c.__decorate([u.reader("portal-item","title")],I.prototype,"readTitlePortalItem",null);c.__decorate([u.reader("service","title",["name"])],I.prototype,"readTitleService",null);c.__decorate([f.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",
isRequired:!0,ignoreOrigin:!0},read:!1}}}})],I.prototype,"layerId",void 0);c.__decorate([f.property(z.url)],I.prototype,"url",null);c.__decorate([h.writer("url")],I.prototype,"writeUrl",null);c.__decorate([f.property()],I.prototype,"parsedUrl",null);c.__decorate([f.property({readOnly:!0})],I.prototype,"store",void 0);c.__decorate([f.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],I.prototype,"rootNode",void 0);return I=c.__decorate([p.subclass("esri.layers.mixins.SceneService")],
I)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(({target:w,propName:n,newOrigin:x})=>{b.isMultiOriginJSONMixin(w)&&x&&w.originOf(n)!==x&&w.updateOrigin(n,x)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],
function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../request","../../core/Error","../../core/maybe"],function(a,b,c,w){a.fetchIndexInfo=async function(n,x,m,l,g,f){var d=null;if(w.isSome(m)){d=`${n}/nodepages/`;const e=d+Math.floor(m.rootIndex/m.nodesPerPage);try{return{type:"page",rootPage:(await b(e,{query:{f:"json",token:l},
responseType:"json",signal:f})).data,rootIndex:m.rootIndex,pageSize:m.nodesPerPage,lodMetric:m.lodSelectionMetricType,urlPrefix:d}}catch(k){w.isSome(g)&&g.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",e,k),d=k}}if(!x)return null;x=x&&x.split("/").pop();n=`${n}/nodes/`;x=n+x;try{return{type:"node",rootNode:(await b(x,{query:{f:"json",token:l},responseType:"json",signal:f})).data,urlPrefix:n}}catch(e){throw new c("sceneservice:root-node-missing","Root node missing.",
{pageError:d,nodeError:e,url:x});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],function(a){let b=null;a.getLoader=function(){return b};a.registerLoader=function(c){b=c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/asyncUtils ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,b,c,w,n,x,m){async function l(f,d){d={...(w.isSome(d)?d:{}),compress:f.compress};d=await b.result(f.resource.portalItem.addResource(f.resource,f.content,d));if(!0===d.ok)f.finish?.(f.resource);else throw f.error?.(d.error),d.error;}async function g(f,d){d=await b.result(f.resource.update(f.content,d));if(!0===d.ok)f.finish?.(f.resource);else throw f.error?.(d.error),d.error;}a.saveResources=async function(f,d,e){if(d&&d.resources){var k=d.portalItem===f.portalItem?new Set(f.paths):new Set;
f.paths.length=0;f.portalItem=d.portalItem;var u=new Set(d.resources.toKeep.map(r=>r.resource.path)),p=new Set,h=[];u.forEach(r=>{k.delete(r);f.paths.push(r)});for(const r of d.resources.toUpdate)if(k.delete(r.resource.path),u.has(r.resource.path)||p.has(r.resource.path)){const {resource:q,content:y,finish:B,error:D}=r,z=m.getSiblingOfSameTypeI(q,x.generateUUID());f.paths.push(z.path);h.push(l({resource:z,content:y,compress:r.compress,finish:B,error:D},e))}else f.paths.push(r.resource.path),h.push(g(r,
e)),p.add(r.resource.path);for(const r of d.resources.toAdd)h.push(l(r,e)),f.paths.push(r.resource.path);k.forEach(r=>{d.portalItem&&(r=d.portalItem.resourceFromPath(r),h.push(r.portalItem.removeResource(r).catch(()=>{})))});if(0!==h.length&&(u=await n.eachAlways(h),n.throwIfAborted(e),e=u.filter(r=>"error"in r).map(r=>r.error),0<e.length))throw new c("save:resources","Failed to save one or more resources",{errors:e});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports",
"../../request","../../core/Error","../../core/maybe","../../core/urlUtils"],function(a,b,c,w,n){function x(g){const f=g.lastIndexOf("/");return-1===f?[".",g]:[g.slice(0,f),g.slice(f+1)]}function m(g){{const u=n.getPathExtension(g);g=w.isNone(u)?[g,""]:[g.slice(0,g.length-u.length-1),`.${u}`]}const [f,d]=g,[e,k]=x(f);return[e,k,d]}async function l(g){return g instanceof Blob?g:(await b(g.url,{responseType:"blob"})).data}a.addOrUpdateResource=async function(g,f,d,e){if(!g.hasPath())throw new c(`portal-item-resource-${f}:invalid-path`,
"Resource does not have a valid path");const k=g.portalItem;await k.load(e);f=n.join(k.userItemUrl,"add"===f?"addResources":"updateResources");const [u,p]=x(g.path);d=await l(d);const h=new FormData;u&&"."!==u&&h.append("resourcesPrefix",u);w.isSome(e)&&e.compress&&h.append("compress","true");h.append("fileName",p);h.append("file",d,p);h.append("f","json");w.isSome(e)&&e.access&&h.append("access",e.access);await k.portal.request(f,{method:"post",body:h,signal:w.get(e,"signal")});return g};a.contentToBlob=
l;a.fetchResources=async function(g,f={},d){await g.load(d);var e=n.join(g.itemUrl,"resources");const {start:k=1,num:u=10,sortOrder:p="asc",sortField:h="created"}=f;f={query:{start:k,num:u,sortOrder:p,sortField:h,token:g.apiKey},signal:w.get(d,"signal")};e=await g.portal.request(e,f);return{total:e.total,nextStart:e.nextStart,resources:e.resources.map(({created:r,size:q,resource:y})=>({created:new Date(r),size:q,resource:g.resourceFromPath(y)}))}};a.getSiblingOfSameType=function(g,f){if(!g.hasPath())return null;
const [d,,e]=m(g.path);return g.portalItem.resourceFromPath(n.join(d,f+e))};a.getSiblingOfSameTypeI=function(g,f){if(!g.hasPath())return null;const [d,,e]=m(g.path);return g.portalItem.resourceFromPath(n.join(d,f+e))};a.removeAllResources=async function(g,f){await g.load(f);const d=n.join(g.userItemUrl,"removeResources");return g.portal.request(d,{method:"post",query:{deleteAll:!0},signal:w.get(f,"signal")})};a.removeResource=async function(g,f,d){if(!f.hasPath())throw new c("portal-item-resources-remove:invalid-path",
"Resource does not have a valid path");await g.load(d);const e=n.join(g.userItemUrl,"removeResources");await g.portal.request(e,{method:"post",query:{resource:f.path},signal:w.get(d,"signal")});f.portalItem=null};a.splitPrefixFileNameAndExtension=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,
supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,
supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,
supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,
supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(a,b,c,w,n,x,m,l,g){let f=function(){function d(k,u,p,h){this._parsedUrl=k;this._portalItem=u;this._apiKey=p;this.signal=h;this._rootDocument=null;if(k=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this._urlParts={root:k[1],layerId:parseInt(k[2],10)}}var e=d.prototype;e.fetch=async function(){if(!this._urlParts)return null;var k=this._portalItem??await this._portalItemFromServiceItemId();if(n.isNone(k))return this._loadFromUrl();k=await this._findAndLoadRelatedPortalItem(k);
return n.isNone(k)?null:this._loadFeatureLayerFromPortalItem(k)};e.fetchPortalItem=async function(){if(!this._urlParts)return null;const k=this._portalItem??await this._portalItemFromServiceItemId();return n.isNone(k)?null:this._findAndLoadRelatedPortalItem(k)};e._fetchRootDocument=async function(){if(n.isSome(this._rootDocument))return this._rootDocument;if(n.isNone(this._urlParts))return this._rootDocument={},{};const k={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},
u=`${this._urlParts.root}/SceneServer`;try{this._rootDocument=(await w(u,k)).data}catch{this._rootDocument={}}return this._rootDocument};e._fetchServiceOwningPortalUrl=async function(){var k=this._parsedUrl?.path;const u=k?c.id?.findServerInfo(k):null;if(u?.owningSystemUrl)return u.owningSystemUrl;k=k?k.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const p=(await w(k,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(p)return p}catch(p){x.throwIfAbortError(p)}return null};
e._findAndLoadRelatedPortalItem=async function(k){try{return(await k.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(u=>"Feature Service"===u.type)||null}catch(u){return x.throwIfAbortError(u),null}};e._loadFeatureLayerFromPortalItem=async function(k){await k.load({signal:this.signal});const u=await this._findMatchingAssociatedSublayerUrl(k.url??"");return(new m({url:u,portalItem:k})).load({signal:this.signal})};e._loadFromUrl=async function(){const k=
await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);return(new m({url:k})).load({signal:this.signal})};e._findMatchingAssociatedSublayerUrl=async function(k){k=k.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var u={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const p=this._urlParts?.layerId;var h=this._fetchRootDocument();u=w(k,u);const [r,q]=await Promise.all([u,h]);h=q&&q.layers;u=r.data&&r.data.layers;if(!Array.isArray(u))throw Error("expected layers array");
if(!Array.isArray(h)){if(null!=p&&p<u.length)return`${k}/${u[p].id}`}else for(let y=0;y<Math.min(h.length,u.length);y++)if(h[y].id===p)return`${k}/${u[y].id}`;throw Error("could not find matching associated sublayer");};e._portalItemFromServiceItemId=async function(){var k=(await this._fetchRootDocument()).serviceItemId;if(!k)return null;k=new g({id:k,apiKey:this._apiKey});const u=await this._fetchServiceOwningPortalUrl();n.isSome(u)&&(k.portal=new l({url:u}));try{return k.load({signal:this.signal})}catch(p){return x.throwIfAbortError(p),
null}};return b._createClass(d)}();a.FetchAssociatedFeatureLayer=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g,f){a.I3SNodePageDefinition=function(d){function e(){var u=k.apply(this,arguments);u.nodesPerPage=null;u.rootIndex=0;u.lodSelectionMetricType=null;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([n.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);c.__decorate([n.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);c.__decorate([n.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=c.__decorate([f.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(d){function e(){var u=k.apply(this,arguments);u.factor=1;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([n.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);c.__decorate([n.property({type:Number})],
a.I3SMaterialTexture.prototype,"factor",void 0);a.I3SMaterialTexture=c.__decorate([f.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(d){function e(){var u=k.apply(this,arguments);u.baseColorFactor=[1,1,1,1];u.baseColorTexture=null;u.metallicRoughnessTexture=null;u.metallicFactor=1;u.roughnessFactor=1;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([n.property({type:[Number]})],
a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",void 0);c.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);c.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);c.__decorate([n.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);c.__decorate([n.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,
"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=c.__decorate([f.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(d){function e(){var u=k.apply(this,arguments);u.alphaMode="opaque";u.alphaCutoff=.25;u.doubleSided=!1;u.cullFace="none";u.normalTexture=null;u.occlusionTexture=null;u.emissiveTexture=null;u.emissiveFactor=null;u.pbrMetallicRoughness=null;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);
c.__decorate([g.enumeration({opaque:"opaque",mask:"mask",blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);c.__decorate([n.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);c.__decorate([n.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);c.__decorate([g.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);c.__decorate([n.property({type:a.I3SMaterialTexture})],
a.I3SMaterialDefinition.prototype,"normalTexture",void 0);c.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);c.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);c.__decorate([n.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);c.__decorate([n.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",
void 0);a.I3SMaterialDefinition=c.__decorate([f.subclass("esri.layer.support.I3SMaterialDefinition")],a.I3SMaterialDefinition);a.I3STextureFormat=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([n.property({type:String,json:{read:{source:["name","index"],reader:(d,e)=>null!=d?d:`${e.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);c.__decorate([g.enumeration({jpg:"jpg",png:"png",dds:"dds",
"ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=c.__decorate([f.subclass("esri.layer.support.I3STextureFormat")],a.I3STextureFormat);a.I3STextureSetDefinition=function(d){function e(){var u=k.apply(this,arguments);u.atlas=!1;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([n.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);c.__decorate([n.property({type:Boolean})],
a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=c.__decorate([f.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);a.I3SGeometryAttribute=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([g.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);c.__decorate([n.property({type:Number})],
a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=c.__decorate([f.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);a.I3SGeometryCompressedAttributes=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([g.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);c.__decorate([n.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,
"attributes",void 0);a.I3SGeometryCompressedAttributes=c.__decorate([f.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);a.I3SGeometryBuffer=function(d){function e(){var u=k.apply(this,arguments);u.offset=0;return u}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);c.__decorate([n.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,
"position",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uv0",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,
"featureId",void 0);c.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);c.__decorate([n.property({type:a.I3SGeometryCompressedAttributes})],a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=c.__decorate([f.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(d){function e(){return k.apply(this,arguments)}b._inherits(e,d);var k=b._createSuper(e);return b._createClass(e)}(w.JSONSupport);
c.__decorate([g.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);c.__decorate([n.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=c.__decorate([f.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){a.RangeInfo=function(f){function d(){var k=e.apply(this,arguments);k.name=null;k.field=null;k.currentRangeExtent=null;k.fullRangeExtent=null;k.type="rangeInfo";return k}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(w.JSONSupport);c.__decorate([n.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);c.__decorate([n.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);c.__decorate([n.property({type:[Number],
json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);c.__decorate([n.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);c.__decorate([n.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=c.__decorate([g.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Handles ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){var h;n=h=function(r){function q(B){B=y.call(this,B);B.spatialRelationship="disjoint";B.geometries=new u;B._geometriesSource=null;B._handles=new w;return B}a._inherits(q,r);var y=a._createSuper(q);r=q.prototype;r.initialize=function(){this._handles.add(l.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,l.sync))};r.destroy=function(){this._handles.destroy()};r.readGeometries=function(B,D,z){this._geometriesSource={url:p.fromJSON(B,z),
context:z}};r.loadGeometries=async function(B,D){if(!m.isNone(this._geometriesSource)){var {url:z,context:v}=this._geometriesSource;D=await c(z,{responseType:"json",signal:m.get(D,"signal")});var A=B.toJSON();B=D.data.map(t=>({...t,spatialReference:A}));this.geometries=u.fromJSON(B,v);this._geometriesSource=null}};r.clone=function(){return new h({geometries:x.clone(this.geometries),spatialRelationship:this.spatialRelationship})};return a._createClass(q)}(n.JSONSupport);b.__decorate([g.property({type:["disjoint",
"contains"],nonNullable:!0,json:{write:!0}})],n.prototype,"spatialRelationship",void 0);b.__decorate([g.property({type:u,nonNullable:!0,json:{write:!0}}),k.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],n.prototype,"geometries",void 0);b.__decorate([d.reader(["web-scene","portal-item"],"geometries")],n.prototype,"readGeometries",null);return n=h=b.__decorate([e.subclass("esri.layers.support.SceneFilter")],n)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(r,q,y){const B=x.getPropertyMetadata(q,y);return{type:String,read:(D,z,v)=>{D=f.read(D,z,v);if(B.type===String)return D;if("function"===typeof B.type)return new B.type({url:D})},write:{writer(D,z,v,A){if(A&&A.resources){var t=null==D?null:"string"===typeof D?D:D.url;t=f.toJSON(t,{...A,verifyItemRelativeUrls:A&&A.verifyItemRelativeUrls?{writtenUrls:A.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},f.MarkKeep.NO);var C=B.type!==String&&(!c.isMultiOriginJSONMixin(this)||
A&&A.origin&&this.originIdOf(y)>m.nameToId(A.origin));D={object:this,propertyName:y,value:D,targetUrl:t,dest:z,targetPropertyName:v,context:A,params:r};if(A&&A.portalItem&&t&&!w.isAbsolute(t))if(C){{const {context:E,targetUrl:F,params:H,value:K,dest:I,targetPropertyName:L}=D;E.portalItem&&(z=E.portalItem.resourceFromPath(F),v=p(K,F,E),A=g.getResourceContentExtension(v),t=w.getPathExtension(z.path),C=H?.compress??!1,A!==t?e(D):(E.resources&&u({...D,resource:z,content:v,compress:C,updates:E.resources.toUpdate}),
I[L]=F))}}else k(D);else A&&A.portalItem&&(null==t||null!=f.itemIdFromResourceUrl(t)||w.isBlobProtocol(t)||C)?e(D):z[v]=t}else z[v]="string"===typeof D?f.toJSON(D,A):D.write({},A)}}}}function e(r){const {targetUrl:q,params:y,value:B,context:D,dest:z,targetPropertyName:v}=r;if(D.portalItem){var A=f.prefixAndFilenameFromResourceUrl(q),t=A?.filename??n.generateUUID(),C=y?.prefix??A?.prefix;A=p(B,q,D);var E=w.join(C,t);t=`${E}.${g.getResourceContentExtension(A)}`;var F=D.portalItem.resourceFromPath(t);
w.isBlobProtocol(q)&&D.resources&&D.resources.pendingOperations.push(h(q).then(H=>{F.path=`${E}.${g.getResourceContentExtension(H)}`;z[v]=F.itemRelativeUrl}).catch(()=>{}));D.resources&&u({...r,resource:F,content:A,compress:y?.compress??!1,updates:D.resources.toAdd});z[v]=F.itemRelativeUrl}}function k({context:r,targetUrl:q,dest:y,targetPropertyName:B}){r.portalItem&&r.resources&&(r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(q),compress:!1}),y[B]=q)}function u({object:r,propertyName:q,
updates:y,resource:B,content:D,compress:z}){y.push({resource:B,content:D,compress:z,finish:v=>{"string"===typeof r[q]?r[q]=v.url:r[q].url=v.url}})}function p(r,q,y){return"string"===typeof r?{url:q}:new Blob([JSON.stringify(r.toJSON(y))],{type:"application/json"})}async function h(r){const q=(await new Promise((y,B)=>a(["../../../request"],D=>y(Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}))),B))).default;({data:r}=await q(r,{responseType:"blob"}));
return r}b.persistable=function(r){const q=r?.origins??[void 0];return(y,B)=>{a:if("resource"===r?.type)var D=d(r,y,B);else{switch(r?.type??"other"){case "other":D={read:!0,write:!0};break a;case "url":const {read:z,write:v}=f.persistableUrlUtils;D={read:z,write:v};break a}D=void 0}for(const z of q){const v=l.propertyJSONMeta(y,z,B);for(const A in D)v[A]=D[A]}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],
function(a,b){const c={},w=c["text/plain"],n={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const x in n)c[n[x]]=x;a.getResourceContentExtension=function(x){x instanceof Blob?x=x.type:(x=b.getPathExtension(x.url),x=n[x]||"text/plain");return c[x]||w};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),function(a,b,c,w,n,x,m,l,g,f,d,e,k){var u;c=u=function(p){function h(q){return r.call(this,
q)}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.clone=function(){return new u(this.items.map(q=>q.clone()))};p.write=function(q,y){return this.toJSON(y)};p.toJSON=function(q){const y=q?.layer?.spatialReference;return y?this.toArray().map(B=>{if(!y.equals(B.spatialReference)){if(!k.canProjectWithoutEngine(B.spatialReference,y))return q&&q.messages&&q.messages.push(new n("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:q.layer.spatialReference,
context:q})),null;const D=new e;k.projectPolygon(B,D,y);B=D}B=B.toJSON(q);delete B.spatialReference;return B}).filter(B=>null!=B):(q?.messages&&q.messages.push(new n("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:q.layer.spatialReference,context:q})),this.toArray().map(B=>B.toJSON(q)))};h.fromJSON=function(q,y){const B=new u;q.forEach(D=>B.add(e.fromJSON(D,y)));return B};return a._createClass(h)}(w.JSONSupportMixin(c.ofType(e)));
return c=u=b.__decorate([d.subclass("esri.layers.support.PolygonCollection")],c)})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/SpatialReference ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/Attribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K){function I(pa){return pa?parseInt(pa.substring(pa.lastIndexOf("/")+1,pa.length),10):void 0}function L(pa,ra){var va=ra[0],Ba=ra[1];ra=ra[3];const Aa=pa[0]-va;va-=pa[2];const Ha=pa[1]-Ba;pa=Ba-pa[3];Ba=Math.max(Aa,va,0);const Ka=Math.max(Ha,pa,0);Ba=Ba*Ba+Ka*Ka;return Ba>ra*ra?a.MbsIntersectResult.OUTSIDE:0<Ba?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Aa,va,Ha,pa)>ra?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function R(pa,ra,va){const Ba=[],Aa=va&&va.missingFields;va=va&&va.originalFields;for(const Ha of pa){pa=Ha.toLowerCase();let Ka=!1;for(const Pa of ra)if(pa===Pa.name.toLowerCase()){Ba.push(Pa.name);Ka=!0;va&&va.push(Ha);break}!Ka&&Aa&&Aa.push(Ha)}return Ba}function O(pa,ra,va){const Ba=new Map,Aa=[];va=va();for(const Pa of pa){var Ha=Pa.attributes[ra];for(var Ka=0;Ka<va.length;Ka++){pa=va[Ka];const Ra=pa.featureIds.indexOf(Ha);if(0<=Ra){Ha=Ba.get(pa.node);Ha||(Ha={node:pa.node,indices:[],graphics:[]},
Aa.push(Ha),Ba.set(pa.node,Ha));Ha.indices.push(Ra);for(Ha.graphics.push(Pa);0<Ka;Ka--)va[Ka]=va[Ka-1];va[0]=pa;break}}}return Aa}async function J(pa,ra,va,Ba){ra.sort((Ka,Pa)=>Ka.attributes[va]-Pa.attributes[va]);var Aa=ra.map(Ka=>Ka.attributes[va]);const Ha=[];Ba=R(Ba,pa.fields,{originalFields:Ha});pa=await M(pa,Aa,Ba);for(Aa=0;Aa<ra.length;Aa++){const Ka=ra[Aa],Pa=pa[Aa],Ra={};if(Ka.attributes)for(const Sa in Ka.attributes)Ra[Sa]=Ka.attributes[Sa];for(let Sa=0;Sa<Ha.length;Sa++)Ra[Ha[Sa]]=Pa[Ba[Sa]];
Ka.attributes=Ra}return ra}function M(pa,ra,va){var Ba=pa.capabilities.query.maxRecordCount;if(null!=Ba&&ra.length>Ba)return Ba=w.splitIntoChunks(ra,Ba),Promise.all(Ba.map(Aa=>M(pa,Aa,va))).then(Aa=>Aa.flat());Ba=new A({objectIds:ra,outFields:va,orderByFields:[pa.objectIdField]});return pa.queryFeatures(Ba).then(Aa=>{if(Aa&&Aa.features&&Aa.features.length===ra.length)return Aa.features.map(Ha=>Ha.attributes);throw new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");
})}function G(pa,ra,va,Ba,Aa){const Ha=[];for(const Ka of ra)Ka&&Aa.includes(Ka.name)&&Ha.push({url:`${pa}/nodes/${va}/attributes/${Ka.key}/0`,storageInfo:Ka});return l.eachAlways(Ha.map(Ka=>c(Ka.url,{responseType:"array-buffer"}).then(Pa=>t.readBinaryAttribute(Ka.storageInfo,Pa.data)))).then(Ka=>{const Pa=[];for(const Ra of Ba){const Sa={};for(let La=0;La<Ka.length;La++){const Ua=Ka[La].value;null!=Ua&&(Sa[Ha[La].storageInfo.name]=P(Ua,Ra))}Pa.push(Sa)}return Pa})}function P(pa,ra){if(!pa)return null;
ra=pa[ra];return g.isInt16Array(pa)?-32768===ra?null:ra:g.isInt32Array(pa)?ra===Z?null:ra:ra!==ra?null:ra}function U(pa){var ra=pa.store,va=ra.indexCRS||ra.geographicCRS;if(ra=void 0===va?ra.indexWKT:void 0)if(pa.spatialReference){if(ra!==pa.spatialReference.wkt)throw new n("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new n("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});va=va?new B(I(va)):pa.spatialReference;return va.equals(pa.spatialReference)?pa.spatialReference:va}function N(pa){var ra=pa.store,va=ra.vertexCRS||ra.projectedCRS;if(ra=void 0===va?ra.vertexWKT:void 0)if(pa.spatialReference){if(ra!==pa.spatialReference.wkt)throw new n("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new n("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});va=va?new B(I(va)):pa.spatialReference;return va.equals(pa.spatialReference)?pa.spatialReference:va}function S(pa,ra,va){if(!y.canProjectWithoutEngine(pa,ra))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
va&&!Q(pa,ra))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function Q(pa,ra){return pa.equals(ra)||pa.isWGS84&&ra.isWebMercator||pa.isWebMercator&&ra.isWGS84}function W(pa,ra,va){const Ba=U(pa);pa=N(pa);S(Ba,ra,va);S(pa,ra,va)}function V(pa,ra,va,Ba,Aa=0){if(Ba===D.getSphericalPCPF(Ba))if(ra.isGeographic){var Ha=q.getReferenceEllipsoid(ra);Ba=1+Math.max(0,Aa)/(Ha.radius+pa.center[2]);
h.set(va.center,pa.center[0],pa.center[1],pa.center[2]+Aa);y.projectBuffer(va.center,ra,0,va.center,D.getSphericalPCPF(ra),0,1);u.copy(va.quaternion,pa.quaternion);u.conjugate(da,pa.quaternion);h.set(qa,0,0,1);h.transformQuat(qa,qa,da);h.set(qa,pa.halfSize[0]*Math.abs(qa[0]),pa.halfSize[1]*Math.abs(qa[1]),pa.halfSize[2]*Math.abs(qa[2]));h.scale(qa,qa,Ha.inverseFlattening);h.add(va.halfSize,pa.halfSize,qa);h.scale(va.halfSize,va.halfSize,Ba)}else{H.corners(pa,ha);h.set(va.center,pa.center[0],pa.center[1],
pa.center[2]+Aa);y.computeTranslationToOriginAndRotation(ra,va.center,ka,D.getSphericalPCPF(ra));h.set(va.center,ka[12],ka[13],ka[14]);Ba=2*Math.sqrt(1+ka[0]+ka[5]+ka[10]);da[0]=(ka[6]-ka[9])/Ba;da[1]=(ka[8]-ka[2])/Ba;da[2]=(ka[1]-ka[4])/Ba;da[3]=.25*Ba;u.multiply(va.quaternion,da,pa.quaternion);u.conjugate(da,va.quaternion);let Ka=Ba=pa=0;for(Ha of ha)Ha[2]+=Aa,y.projectBuffer(Ha,ra,0,Ha,D.getSphericalPCPF(ra),0,1),h.sub(qa,Ha,va.center),h.transformQuat(qa,qa,da),pa=Math.max(pa,Math.abs(qa[0])),
Ba=Math.max(Ba,Math.abs(qa[1])),Ka=Math.max(Ka,Math.abs(qa[2]));h.set(va.halfSize,pa,Ba,Ka)}else ra.isWGS84&&(Ba.isWebMercator||v.isPlateCarree(Ba))?(h.copy(ea,pa.center),ea[2]+=Aa,Aa=D.getSphericalPCPF(Ba),y.projectBuffer(ea,ra,0,ea,Aa,0,1),T(Aa,pa,ea,Ba,va)):ra.isWebMercator&&v.isPlateCarree(Ba)?(h.copy(ea,pa.center),ea[2]+=Aa,T(ra,pa,ea,Ba,va)):pa===va?(va.center[2]+=Aa,y.projectBuffer(va.center,ra,0,va.center,Ba,0,1)):(h.set(va.center,pa.center[0],pa.center[1],pa.center[2]+Aa),y.projectBuffer(va.center,
ra,0,va.center,Ba,0,1),u.copy(va.quaternion,pa.quaternion),h.copy(va.halfSize,pa.halfSize))}function T(pa,ra,va,Ba,Aa){const Ha=f.fromQuat(ja,ra.quaternion);for(let Pa=0;8>Pa;++Pa){for(var Ka=0;3>Ka;++Ka)ba[Ka]=ra.halfSize[Ka]*(0!==(Pa&1<<Ka)?-1:1);for(Ka=0;3>Ka;++Ka){let Ra=va[Ka];for(let Sa=0;3>Sa;++Sa)Ra+=ba[Sa]*Ha[3*Sa+Ka];ia[3*Pa+Ka]=Ra}}y.projectBuffer(ia,pa,0,ia,Ba,0,8);H.compute(na,Aa)}const X=z.create();a.MbsIntersectResult=void 0;(function(pa){pa[pa.OUTSIDE=0]="OUTSIDE";pa[pa.INTERSECTS_CENTER_OUTSIDE=
1]="INTERSECTS_CENTER_OUTSIDE";pa[pa.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";pa[pa.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const Z=-(2**31),Y=E.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let aa=b._createClass(function(){this.material=this.edgeMaterial=null;this.castShadows=!0});const ia=Array(24),na=new K.Attribute(ia,3,!0),ba=r.create(),ea=r.create(),ja=d.create(),ka=k.create(),da=p.create(),ha=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],
[0,0,0],[0,0,0]],ca=z.create(),fa=z.create(),ma=H.create(),qa=r.create(),wa={data:Array(72),size:3,exclusive:!0,stride:3},xa=k.create();a.SymbolInfo=aa;a.addWraparound=function(pa,ra){return(pa|0)+(ra|0)|0};a.checkPointCloudLayerCompatibleWithView=function(pa,ra){S(pa.spatialReference,ra.spatialReference,ra.viewingMode)};a.checkPointCloudLayerValid=function(pa){var ra;(ra=null==pa.store||null==pa.store.defaultGeometrySchema)||(pa=pa.store.defaultGeometrySchema,ra=!!(null==pa.geometryType||"points"!==
pa.geometryType||null!=pa.topology&&"PerAttributeArray"!==pa.topology||null!=pa.encoding&&""!==pa.encoding&&"lepcc-xyz"!==pa.encoding||null==pa.vertexAttributes||null==pa.vertexAttributes.position));if(ra)throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(pa,ra,va){if(pa.serviceUpdateTimeStamp?.lastUpdate!==ra.serviceUpdateTimeStamp?.lastUpdate||!va.isEmpty||m.applySome(pa.associatedLayer,Ba=>
Ba.url)!==m.applySome(ra.associatedLayer,Ba=>Ba.url))throw new n("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=function(pa,ra){W(pa,ra.spatialReference,ra.viewingMode)};a.checkSceneLayerValid=function(pa){var ra;(ra=null==pa.store||null==pa.store.defaultGeometrySchema)||(ra=pa.store.defaultGeometrySchema,ra=!!(null!=ra.geometryType&&"triangles"!==ra.geometryType||null!=ra.topology&&"PerAttributeArray"!==ra.topology||null==ra.vertexAttributes||null==ra.vertexAttributes.position));
if(ra)throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:pa.parsedUrl.path});};a.checkSpatialReference=S;a.checkSpatialReferences=W;a.computeVisibilityObb=function(pa,ra,va,Ba,Aa,Ha){if(!Ha||0===Ha.length||m.isNone(ra)||!pa.mbs)return null;const Ka=C.computeGlobalTransformation(pa.mbs,Aa,va,ra);e.invert(xa,Ka);let Pa=null;const Ra=()=>{if(!Pa)if(Pa=ha,z.empty(fa),m.isSome(pa.serviceObb)){V(pa.serviceObb,va,ma,ra,Aa);H.corners(ma,Pa);
for(var Za of Pa)h.transformMat4(Za,Za,xa),z.expandPointInPlace(fa,Za)}else{var Xa=pa.mbs;if(Xa)for(Za=Xa[3],y.projectVectorToVector(Xa,va,qa,ra),h.transformMat4(qa,qa,xa),qa[2]+=Aa,Xa=0;8>Xa;++Xa){const la=Pa[Xa];h.copy(la,[qa[0]+(Xa&1?Za:-Za),qa[1]+(Xa&2?Za:-Za),qa[2]+(Xa&4?Za:-Za)]);z.expandPointInPlace(fa,la)}}};let Sa=Infinity,La=-Infinity;const Ua=Za=>{if("replace"===Za.type&&(Za=Za.geometry,Za?.hasZ)){z.empty(ca);var Xa=Za.spatialReference||Ba;Za=Za.rings.reduce((la,Ta)=>Ta.reduce((Ma,fb)=>
{y.projectVectorToVector(fb,Xa,qa,ra);h.transformMat4(qa,qa,xa);z.expandPointInPlace(ca,qa);return Math.min(qa[2],Ma)},la),Infinity);Ra();z.intersects(fa,ca)&&(Sa=Math.min(Sa,Za),La=Math.max(La,Za))}};Ha.forEach(Za=>Ua(Za));if(Infinity===Sa)return null;Ha=(Za,Xa,la)=>{h.transformMat4(qa,la,Ka);Za[Xa]=qa[0];Za[Xa+1]=qa[1];Za[Xa+2]=qa[2];Xa+=24;la[2]=Sa;h.transformMat4(qa,la,Ka);Za[Xa]=qa[0];Za[Xa+1]=qa[1];Za[Xa+2]=qa[2];Xa+=24;la[2]=La;h.transformMat4(qa,la,Ka);Za[Xa]=qa[0];Za[Xa+1]=qa[1];Za[Xa+2]=
qa[2]};for(let Za=0;8>Za;++Za)Ha(wa.data,3*Za,Pa[Za]);return H.compute(wa)};a.containsDraco=function(pa){if(x("disable-feature:i3s-draco")||!pa)return!1;for(const ra of pa)for(const va of ra.geometryBuffers)if("draco"===va.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=I;a.filterInPlace=function(pa,ra,va){let Ba=0,Aa=0;for(let Ha=0;Ha<ra.length&&Ba<pa.length;Ha++)pa[Ba]===ra[Ha]&&(va(Ha)&&(pa[Aa]=pa[Ba],Aa++),Ba++);pa.length=Aa};a.findFieldsCaseInsensitive=R;a.findIntersectingNodes=
function(pa,ra,va,Ba){va.traverse(ra,Aa=>{const Ha=Aa.mbs;if((null!=Ha&&L(pa,Ha))===a.MbsIntersectResult.OUTSIDE)return!1;Ba(Aa);return!0})};a.getCacheKeySuffix=function(pa,ra){return m.isNone(ra)?"@null":ra===D.getSphericalPCPF(ra)?"@ECEF":pa.equals(ra)?"":null!=ra.wkid?"@"+ra.wkid:null};a.getCachedAttributeValue=P;a.getClipRect=function(pa,ra){if(0===ra.rotationScale[1]&&0===ra.rotationScale[2]&&0===ra.rotationScale[3]&&0===ra.rotationScale[5]&&0===ra.rotationScale[6]&&0===ra.rotationScale[7])return X[0]=
(pa[0]-ra.position[0])/ra.rotationScale[0],X[1]=(pa[1]-ra.position[1])/ra.rotationScale[4],X[2]=(pa[2]-ra.position[0])/ra.rotationScale[0],X[3]=(pa[3]-ra.position[1])/ra.rotationScale[4],X};a.getIndexCrs=U;a.getSymbolInfo=function(pa){const ra=new aa;var va=!1;let Ba=!1;for(const Ha of pa.symbolLayers.items)if("fill"===Ha.type&&Ha.enabled){var Aa=Ha.material;pa=Ha.edges;m.isSome(Aa)&&!va&&(va=Aa.color,Aa=F.parseColorMixMode(Aa.colorMixMode),m.isSome(va)?ra.material={color:[va.r/255,va.g/255,va.b/
255],alpha:va.a,colorMixMode:Aa}:ra.material={color:[1,1,1],alpha:1,colorMixMode:F.ColorMixModeEnum.Multiply},ra.castShadows=Ha.castShadows,va=!0);m.isSome(pa)&&!Ba&&(ra.edgeMaterial=E.createMaterialFromEdges(pa,{}),Ba=!0)}ra.material||(ra.material={color:[1,1,1],alpha:1,colorMixMode:F.ColorMixModeEnum.Multiply});return ra};a.getVertexCrs=N;a.intersectBoundingRectWithMbs=L;a.invalidateMbs=function(pa){m.isSome(pa)&&(pa[3]=-1)};a.invalidateObb=function(pa){m.isSome(pa)&&(pa.halfSize[0]=-1)};a.isSupportedLocalModeProjection=
Q;a.isValidMbs=function(pa){return 0<=pa[3]};a.isValidObb=function(pa){return m.isSome(pa)&&0<=pa.halfSize[0]};a.objectIdFilter=function(pa,ra,va){let Ba=0,Aa=0;for(;Ba<va.length;)0<=w.binaryIndexOf(pa,va[Ba])===ra&&(va[Aa]=va[Ba],Aa++),Ba++;va.length=Aa};a.queryAttributesFromCachedAttributesId=G;a.rendererNeedsTextures=function(pa){if(null==pa||"simple"!==pa.type&&"class-breaks"!==pa.type&&"unique-value"!==pa.type||("unique-value"===pa.type||"class-breaks"===pa.type)&&null==pa.defaultSymbol)return!0;
pa=pa.getSymbols();if(0===pa.length)return!0;for(const ra of pa){if("mesh-3d"!==ra.type||0===ra.symbolLayers.length)return!0;for(const va of ra.symbolLayers.items)if("fill"!==va.type||m.isNone(va.material)||m.isNone(va.material.color)||"replace"!==va.material.colorMixMode)return!0}return!1};a.transformObb=V;a.transparentEdgeMaterial=Y;a.whenGraphicAttributes=async function(pa,ra,va,Ba,Aa){if(0===ra.length)return[];const Ha=pa.attributeStorageInfo;if(m.isSome(pa.associatedLayer))try{return await J(pa.associatedLayer,
ra,va,Ba)}catch(Ka){if(pa.associatedLayer.loaded)throw Ka;}if(Ha){ra=O(ra,va,Aa);if(m.isNone(ra))throw new n("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Ka=pa.parsedUrl.path;return(await Promise.all(ra.map(Pa=>G(Ka,Ha,Pa.node.resources.attributes,Pa.indices,Ba).then(Ra=>{for(let Sa=0;Sa<Pa.graphics.length;Sa++){const La=Pa.graphics[Sa],Ua=Ra[Sa];if(La.attributes)for(const Za in La.attributes)Za in Ua||(Ua[Za]=La.attributes[Za]);La.attributes=Ua}return Pa.graphics})))).flat()}throw new n("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,w,n,x){function m(v,A){const t={byteOffset:0,byteCount:0,fields:Object.create(null)};let C=0;for(let E=0;E<A.length;E++){const F=A[E],H=F.valueType||F.type;
t.fields[F.property]=(0,z[H])(v,C);C+=D[H].BYTES_PER_ELEMENT}t.byteCount=C;return t}function l(v,A,t){return g(v,A,t).map(C=>(C=C?Date.parse(C):null)&&!Number.isNaN(C)?C:null)}function g(v,A,t){const C=[];let E,F=0,H;for(H=0;H<v;H+=1){E=A[H];if(0<E){var K=C,I=K.push,L=t,R=F,O=E-1;let M="",G=0;for(;G<O;){var J=L[R+G];if(128>J)M+=String.fromCharCode(J),G++;else if(192<=J&&224>J){if(G+1>=O)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");M+=String.fromCharCode((J&
31)<<6|L[R+G+1]&63);G+=2}else if(224<=J&&240>J){if(G+2>=O)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");M+=String.fromCharCode((J&15)<<12|(L[R+G+1]&63)<<6|L[R+G+2]&63);G+=3}else if(240<=J&&248>J){if(G+3>=O)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");J=(J&7)<<18|(L[R+G+1]&63)<<12|(L[R+G+2]&63)<<6|L[R+G+3]&63;M=65536<=J?M+String.fromCharCode((J-65536>>10)+55296,(J&1023)+56320):M+String.fromCharCode(J);G+=4}else throw new b("utf8-decode-error",
"UTF-8 Decode failed. Invalid multi byte sequence.");}I.call(K,M);if(0!==t[F+E-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else C.push(null);F+=E}return C}function f(v,A){return new D[A.valueType](v,A.byteOffset,A.count*A.valuesPerElement)}function d(v,A){return new Uint8Array(v,A.byteOffset,A.byteCount)}function e(v,A,t){v=null!=A.header?m(v,A.header):{byteOffset:0,byteCount:0,fields:{count:t}};t={header:v,byteOffset:v.byteCount,byteCount:0,entries:Object.create(null)};
let C=v.byteCount;for(let E=0;E<A.ordering.length;E++){const F=A.ordering[E],H=c.clone(A[F]);H.count=v.fields.count??0;if("String"===H.valueType){H.byteOffset=C;H.byteCount=v.fields[F+"ByteCount"];if("UTF-8"!==H.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:H.encoding});if(H.timeEncoding&&"ECMA_ISO8601"!==H.timeEncoding)throw new b("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:H.timeEncoding});}else if(r(H.valueType)){const K=q(H.valueType);
C+=0!==C%K?K-C%K:0;H.byteOffset=C;H.byteCount=K*H.valuesPerElement*H.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:H.valueType});C+=H.byteCount??0;t.entries[F]=H}t.byteCount=C-t.byteOffset;return t}function k(v,A,t){A!==v&&y.error(`Invalid ${t} buffer size\n expected: ${v}, actual: ${A})`);if(A<v)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:v,actualSize:A});}function u(v){return{isDraco:!1,isLegacy:!1,color:null!=v.color,normal:null!=
v.normal,uv0:null!=v.uv0,uvRegion:null!=v.uvRegion,featureIndex:null!=v.faceRange&&null!=v.featureId}}function p(v){const A={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const t of v.ordering)if(v.vertexAttributes[t])switch(t){case "normal":A.normal=!0;break;case "color":A.color=!0;break;case "uv0":A.uv0=!0;break;case "region":A.uvRegion=!0}v.featureAttributes&&v.featureAttributeOrder&&(A.featureIndex=!0);return A}function h(v){const A={isDraco:!0,isLegacy:!1,
color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const t of v)switch(t){case "normal":A.normal=!0;break;case "uv0":A.uv0=!0;break;case "color":A.color=!0;break;case "uv-region":A.uvRegion=!0;break;case "feature-index":A.featureIndex=!0}return A}function r(v){return D.hasOwnProperty(v)}function q(v){return r(v)?D[v].BYTES_PER_ELEMENT:0}const y=w.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),B={position:x.VertexAttribute.POSITION,normal:x.VertexAttribute.NORMAL,color:x.VertexAttribute.COLOR,
uv0:x.VertexAttribute.UV0,region:x.VertexAttribute.UVREGION},D={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},z={Float32:(v,A)=>(new DataView(v,0)).getFloat32(A,!0),Float64:(v,A)=>(new DataView(v,0)).getFloat64(A,!0),UInt8:(v,A)=>(new DataView(v,0)).getUint8(A),Int8:(v,A)=>(new DataView(v,0)).getInt8(A),UInt16:(v,A)=>(new DataView(v,0)).getUint16(A,!0),Int16:(v,A)=>(new DataView(v,0)).getInt16(A,!0),
UInt32:(v,A)=>(new DataView(v,0)).getUint32(A,!0),Int32:(v,A)=>(new DataView(v,0)).getInt32(A,!0)};a.createAttributeDataIndex=e;a.createGeometryDescriptor=function(v,A){return v&&v.compressedAttributes&&"draco"===v.compressedAttributes.encoding?h(v.compressedAttributes.attributes):v?u(v):p(A)};a.createGeometryDescriptorForDraco=h;a.createGeometryDescriptorFromDefinition=u;a.createGeometryDescriptorFromSchema=p;a.createGeometryIndexFromSchema=function(v,A){var t=m(v,A&&A.header);let C=t.byteCount;
const E={isDraco:!1,header:t,byteOffset:t.byteCount,byteCount:0,vertexAttributes:{}};t=t.fields;var F=null!=t.vertexCount?t.vertexCount:t.count;for(var H of A.ordering){if(!A.vertexAttributes[H])continue;const I={...A.vertexAttributes[H],byteOffset:C,count:F};E.vertexAttributes[B[H]||"_"+H]=I;C+=q(I.valueType)*I.valuesPerElement*F}H=t.faceCount;if(A.faces&&H){E.faces={};for(var K of A.ordering)A.faces[K]&&(F={...A.faces[K],byteOffset:C,count:H},E.faces[K]=F,C+=q(F.valueType)*F.valuesPerElement*H)}K=
t.featureCount;if(A.featureAttributes&&A.featureAttributeOrder&&K){E.featureAttributes={};for(const I of A.featureAttributeOrder)A.featureAttributes[I]&&(t={...A.featureAttributes[I],byteOffset:C,count:K},E.featureAttributes[I]=t,H="UInt64"===t.valueType?8:q(t.valueType),C+=H*t.valuesPerElement*K)}k(C,v.byteLength,"geometry");E.byteCount=C-E.byteOffset;return E};a.createRawView=d;a.createTypedView=f;a.getBytesPerValue=q;a.isValueType=r;a.readBinaryAttribute=function(v,A,t){if("lepcc-rgb"===v.encoding)return n.decodeRGB(A);
if("lepcc-intensity"===v.encoding)return n.decodeIntensity(A);if(null!=v.encoding&&""!==v.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");v["attributeByteCounts "]&&!v.attributeByteCounts&&(y.warn("Warning: Trailing space in 'attributeByteCounts '."),v.attributeByteCounts=v["attributeByteCounts "]);"ObjectIds"===v.ordering[0]&&v.hasOwnProperty("objectIds")&&(y.warn("Warning: Case error in objectIds"),v.ordering[0]="objectIds");t=e(A,v,t);k(t.byteOffset+
t.byteCount,A.byteLength,"attribute");if(v=t.entries.attributeValues||t.entries.objectIds){if("String"===v.valueType){t=t.entries.attributeByteCounts;const C=f(A,t);A=d(A,v);return v.timeEncoding?l(t.count,C,A):g(t.count,C,A)}return f(A,v)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=l;a.readHeader=m;a.readStringArray=g;a.valueType2ArrayBufferReader=z;a.valueType2TypedArrayClassMap=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function c(m,l,g){return{identifier:String.fromCharCode.apply(null,new Uint8Array(m,g+x.identifierOffset,x.identifierLength)),version:l.getUint16(g+x.versionOffset,!0),checksum:l.getUint32(g+x.checksumOffset,!0)}}function w(m,l,g){const f=[];l=n(m,l,f);const d=[];for(let e=0;e<f.length;e++){d.length=0;l=n(m,l,d);for(let k=0;k<d.length;k++)g.push(d[k]+f[e])}return l}function n(m,l,g){var f=new DataView(m,
l),d=f.getUint8(0);const e=d&31;var k=!!(d&32),u=(d&192)>>6;d=0;if(0===u)d=f.getUint32(1,!0),l+=5;else if(1===u)d=f.getUint16(1,!0),l+=3;else if(2===u)d=f.getUint8(1),l+=2;else throw new b("lepcc-decode-error","Bad count type");if(k)throw new b("lepcc-decode-error","LUT not implemented");m=new Uint8Array(m,l,Math.ceil(d*e/8));u=k=f=0;const p=-1>>>32-e;for(let h=0;h<d;h++){for(;k<e;)f|=m[u]<<k,k+=8,u+=1;g[h]=f&p;f>>>=e;k-=e;32<k+e&&(f|=m[u-1]>>8-k)}return l+u}const x={identifierOffset:0,identifierLength:10,
versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(m){const l=new DataView(m,0);var g=0;const {identifier:f,version:d}=c(m,l,g);g+=x.byteCount;if("Intensity "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<d)throw new b("lepcc-decode-error","Unknown version");var e=g;var k=l.getUint32(e+0,!0);var u=l.getUint32(e+4,!0);var p=l.getUint32(e+8,!0);var h=l.getUint16(e+12,!0);var r=l.getUint8(e+14);l.getUint8(e+15);g+=16;if(u*2**32+k!==m.byteLength)throw new b("lepcc-decode-error",
"Bad size");k=new Uint16Array(p);if(8===r){if(p+g!==m.byteLength)throw new b("lepcc-decode-error","Bad size");m=new Uint8Array(m,g,p);for(g=0;g<p;g++)k[g]=m[g]*h}else if(16===r){if(2*p+g!==m.byteLength)throw new b("lepcc-decode-error","Bad size");m=new Uint16Array(m,g,p);for(g=0;g<p;g++)k[g]=m[g]*h}else{r=[];if(n(m,g,r)!==m.byteLength)throw new b("lepcc-decode-error","Bad size");for(m=0;m<p;m++)k[m]=r[m]*h}return k};a.decodeRGB=function(m){var l=new DataView(m,0),g=0;const {identifier:f,version:d}=
c(m,l,g);g+=x.byteCount;if("ClusterRGB"!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<d)throw new b("lepcc-decode-error","Unknown version");var e=g;var k=l.getUint32(e+0,!0);var u=l.getUint32(e+4,!0);var p=l.getUint32(e+8,!0);var h=l.getUint16(e+12,!0);var r=l.getUint8(e+14);e=l.getUint8(e+15);g+=16;if(u*2**32+k!==m.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===r||1===r)&&0===e){if(3*h+p+g!==m.byteLength||256<h)throw new b("lepcc-decode-error","Bad count");l=new Uint8Array(m,
g,3*h);g=new Uint8Array(m,g+3*h,p);m=new Uint8Array(3*p);for(h=0;h<p;h++)k=g[h],m[3*h]=l[3*k],m[3*h+1]=l[3*k+1],m[3*h+2]=l[3*k+2];return m}if(0===r&&0===e){if(3*p+g!==m.byteLength||0!==h)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(m,g)).slice()}if(2>=r&&1===e){if(g+3!==m.byteLength||1!==h)throw new b("lepcc-decode-error","Bad count");m=l.getUint8(g);h=l.getUint8(g+1);g=l.getUint8(g+2);l=new Uint8Array(3*p);for(k=0;k<p;k++)l[3*k]=m,l[3*k+1]=h,l[3*k+2]=g;return l}throw new b("lepcc-decode-error",
"Bad method "+r+","+e);};a.decodeXYZ=function(m){var l=new DataView(m,0),g=0;const {identifier:f,version:d}=c(m,l,g);g+=x.byteCount;if("LEPCC     "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<d)throw new b("lepcc-decode-error","Unknown version");var e=g;var k=l.getUint32(e+0,!0);var u=l.getUint32(e+4,!0);var p=l.getFloat64(e+8,!0);var h=l.getFloat64(e+16,!0);var r=l.getFloat64(e+24,!0);var q=l.getFloat64(e+32,!0);var y=l.getFloat64(e+40,!0);var B=l.getFloat64(e+48,!0);var D=l.getFloat64(e+
56,!0);var z=l.getFloat64(e+64,!0);var v=l.getFloat64(e+72,!0);var A=l.getUint32(e+80,!0);l.getUint32(e+84,!0);g+=88;if(u*2**32+k!==m.byteLength)throw new b("lepcc-decode-error","Bad size");k=new Float64Array(3*A);u=[];A=[];l=[];e=[];g=w(m,g,u);g=w(m,g,A);g=w(m,g,l);g=w(m,g,e);if(g!==m.byteLength)throw new b("lepcc-decode-error","Bad length");g=m=0;for(let t=0;t<u.length;t++){g+=u[t];let C=0;for(let E=0;E<A[t];E++){C+=l[m];const F=e[m];k[3*m]=Math.min(q,p+2*D*C);k[3*m+1]=Math.min(y,h+2*z*g);k[3*m+
2]=Math.min(B,r+2*v*F);m++}}return{errorX:D,errorY:z,errorZ:v,result:k}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection"],function(a,b,c,w,n){function x(m,l,g){const f=c.create(),d=2**(4*Math.ceil(Math.log(m[3])*Math.LOG2E/4)+1);if(g.isGeographic){var e=d/w.getReferenceEllipsoid(g).radius*
180/Math.PI;g=Math.max(-90,Math.min(90,Math.round(m[1]/e)*e));e/=Math.cos((Math.abs(g)-e/2)/180*Math.PI);f[0]=Math.round(m[0]/e)*e;f[1]=g}else g=Math.round(m[1]/d),f[0]=Math.round(m[0]/d)*d,f[1]=g*d;f[2]=Math.round((m[2]+l)/d)*d;return f}a.computeGlobalTransformation=function(m,l,g,f){m=x(m,l,g);l=b.create();n.computeTranslationToOriginAndRotation(g,m,l,f);return l};a.getLocalOrigin=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../core/maybe","../../../layers/support/fieldUtils"],function(a,b,c){a.getFetchPopupTemplate=function(w,n){return w.popupTemplate?w.popupTemplate:b.isSome(n)&&n.defaultPopupTemplateEnabled&&b.isSome(w.defaultPopupTemplate)?w.defaultPopupTemplate:null};a.getRequiredFields=async function(w,n=w.popupTemplate){if(b.isNone(n))return[];const x=await n.getRequiredFields(w.fieldsIndex);({lastEditInfoEnabled:n}=n);const {objectIdField:m,typeIdField:l,globalIdField:g,relationships:f}=w;if(x.includes("*"))return["*"];
n=n?await c.getFeatureEditFields(w):[];const d=c.fixFields(w.fieldsIndex,[...x,...n]);l&&d.push(l);d&&m&&w.fieldsIndex?.has(m)&&!d.includes(m)&&d.push(m);d&&g&&w.fieldsIndex?.has(g)&&!d.includes(g)&&d.push(g);f&&f.forEach(e=>{({keyField:e}=e);d&&e&&w.fieldsIndex?.has(e)&&!d.includes(e)&&d.push(e)});return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){n=function(e){function k(){var p=u.apply(this,arguments);p.type="elevation-3d";return p}a._inherits(k,e);var u=a._createSuper(k);k.prototype.initialize=function(){var p=this.view?.map?.allLayers;p=p&&p.includes(this.layer);var h=this.view?.map?.ground?.layers;h=h&&h.includes(this.layer);p&&!h&&(p=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(p)));this._addTilingSchemeMatchPromise()};
a._createClass(k,[{key:"tileInfo",get:function(){return this.layer.tileInfo}}]);return k}(f.TiledLayerView3D(g.LayerView3D(d)));b.__decorate([w.property()],n.prototype,"layer",void 0);b.__decorate([w.property()],n.prototype,"tileInfo",null);return n=b.__decorate([l.subclass("esri.views.3d.layers.ElevationLayerView3D")],n)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){a.LayerView3D=k=>{k=function(u){function p(){var r=h.apply(this,arguments);r.slicePlaneEnabled=!1;r.supportsHeightUnitConversion=!1;return r}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.postscript=function(r){b._get(b._getPrototypeOf(p.prototype),"postscript",this).call(this,r);e.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};u._validateHeightModelInfo=async function(){const r=new AbortController;var q=
r.signal;this.handles.add(w.makeHandle(()=>r.abort()));await x.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,q);n.throwIfAborted(q);if(q=e.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw q;};u.canResume=function(){const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return b._get(b._getPrototypeOf(p.prototype),"canResume",this).call(this)&&(!r||!r.minScale||!r.maxScale||r.minScale>=r.maxScale)};u.getSuspendInfo=
function(){const r=b._get(b._getPrototypeOf(p.prototype),"getSuspendInfo",this).call(this),q=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;q&&q.minScale&&q.maxScale&&q.minScale<q.maxScale&&(r.outsideScaleRange=!0);return r};return b._createClass(p)}(k);c.__decorate([m.property()],k.prototype,"view",void 0);c.__decorate([m.property()],k.prototype,"slicePlaneEnabled",void 0);return k=c.__decorate([d.subclass("esri.views.3d.layers.LayerView3D")],k)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),function(a,
b,c,w,n,x,m,l,g,f,d,e,k){a.TiledLayerView3D=u=>{u=function(p){function h(){return r.apply(this,arguments)}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.getTileUrl=function(q,y,B){return this.layer.getTileUrl(q,y,B)};p._addTilingSchemeMatchPromise=function(){if(n.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new w("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var q=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(n.isSome(q))return this.addResolvingPromise(Promise.reject(q));
q=x.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const y=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(y)throw y;});this.addResolvingPromise(q)};p._getTileInfoSupportError=function(q,y){if(q=k.checkIfTileInfoSupportedForView(q,y,this.view.spatialReference,this.view.state.viewingMode)){y={layer:this.layer,error:q};switch(q.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":q=
new w("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",y);break;default:q=new w("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",y)}return q}return null};p._getTileInfoCompatibilityError=function(q,y){return n.isNone(q)||!y.compatibleWith(q)?new w("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"):
null};p.levelRangeFromScaleRange=function(q,y){const B={minLevel:0,maxLevel:Infinity};var D=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!D)return B;const z=D.levels[0];D=v=>{v=Math.log(z.scale/v)/Math.LN2;return 1E-9>.5-Math.abs(.5-v%1)?Math.round(v):Math.ceil(v)};null!=q&&0<q&&(B.minLevel=Math.max(0,D(q)));null!=y&&0<y&&(B.maxLevel=Math.max(0,D(y)));return B};p.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};
b._createClass(h,[{key:"imageFormatIsOpaque",get:function(){return!1}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const q=this.tileInfo.lods;return this.levelRangeFromScaleRange(q[0].scale,q[q.length-1].scale)}},{key:"displayLevelRange",get:function(){var q=this.tileInfo.lods;q=this.levelRangeFromScaleRange(this.layer.minScale||q[0].scale,this.layer.maxScale||
q[q.length-1].scale);this.layer.maxScale&&q.maxLevel++;return q}}]);return h}(u);c.__decorate([m.property({readOnly:!0})],u.prototype,"imageFormatIsOpaque",null);c.__decorate([m.property({readOnly:!0})],u.prototype,"updating",void 0);c.__decorate([m.property(e.updatingProgress)],u.prototype,"updatingProgress",void 0);c.__decorate([m.property(e.updatingProgressValue)],u.prototype,"updatingProgressValue",void 0);c.__decorate([m.property()],u.prototype,"fullExtent",null);c.__decorate([m.property({readOnly:!0})],
u.prototype,"isOpaque",null);c.__decorate([m.property({readOnly:!0})],u.prototype,"dataLevelRange",null);c.__decorate([m.property({readOnly:!0})],u.prototype,"displayLevelRange",null);c.__decorate([m.property()],u.prototype,"layer",void 0);c.__decorate([m.property()],u.prototype,"tileInfo",void 0);return u=c.__decorate([d.subclass("esri.views.3d.layers.TiledLayerView3D")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){x=function(u){function p(){var r=h.apply(this,arguments);r.type="feature-3d";r.direct3DObjectFeatureLayerDisplayEnabled=e.direct3DObjectFeatureLayerDisplayEnabled();return r}a._inherits(p,u);var h=a._createSuper(p);p.prototype.initialize=function(){const {layer:r,view:q}=this;d.getEffectiveLayerCapabilities(r)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new c("featurelayerview:query-not-supported","layer view requires a layer with query capability",
{layer:r})));w.isSome(r.infoFor3D)&&(this.direct3DObjectFeatureLayerDisplayEnabled?this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new c("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${r.geometryType}`))));"mesh"!==r.geometryType||f.canProjectWithoutEngine(r.spatialReference,q.spatialReference)||this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))};
a._createClass(p,[{key:"featureSpatialReference",get:function(){return this.view.featureTiles?.tilingScheme?.spatialReference}}]);return p}(k);b.__decorate([n.property({constructOnly:!0})],x.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);b.__decorate([n.property()],x.prototype,"layer",void 0);return x=b.__decorate([g.subclass("esri.views.3d.layers.FeatureLayerView3D")],x)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){m=function(v){function A(C){C=t.call(this,C);C._controllerTotal=0;C._processorTotal=0;C.suspendResumeExtentMode="data";return C}a._inherits(A,v);var t=a._createSuper(A);v=A.prototype;v.initialize=function(){this.handles.add(n.watch(()=>this._updatingRequiredFieldsPromise,C=>this.updatingHandles.addPromise(C),n.syncAndInitial))};v.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._fetcherContext=w.destroyMaybe(this._fetcherContext)};
v.setVisibility=function(C,E){this.processor?.setObjectIdVisibility(C,E)};v.createQuery=function(){return a._get(a._getPrototypeOf(A.prototype),"createQuery",this).call(this)};v.queryFeatures=function(C,E){const F=()=>a._get(a._getPrototypeOf(A.prototype),"queryFeatures",this).call(this,C,E);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(C),F):F()};v.beforeSetController=function(C){C.maximumNumberOfFeatures=this.maximumNumberOfFeatures};v.createController=function(){this._fetcherContext=
new p.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const C=new e.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new h.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>C.serviceDataExtent,E=>{this.processor&&(this.processor.dataExtent=E)},n.initial);this.handles.add(n.watch(()=>this.suspended,E=>{E?C.suspend():C.resume()},n.syncAndInitial));this.updatingHandles.add(()=>this.processor?.displayFeatureLimit,
E=>C.displayFeatureLimit=E,n.initial);this.handles.add(n.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return C};v.doRefresh=async function(C){C&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.refreshFilter()};v._queryFeaturesMesh=async function(C,E){await this._validateQueryFeaturesMesh(C);E=await E();if(C&&C.outStatistics||w.isNone(this.graphics3DProcessor))return E;C=this.layer.objectIdField;const F=this.graphics3DProcessor.graphics3DGraphicsByObjectID,
H=[];for(const K of E.features)if(K.geometry){const I=F.get(K.attributes[C]);I&&(K.geometry=d.hydrateGeometry(I.graphic.geometry),H.push(K))}else H.push(K);E.features=H;return E};v._validateQueryFeaturesMesh=async function(C){if(C){var E=H=>{throw new c("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${H}'`);},F=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const H of F)null!=C[H]&&E(H);"returnM"in C&&C.returnM&&E("returnM");
"returnCentroid"in C&&C.returnCentroid&&E("returnCentroid");w.isSome(C.outSpatialReference)&&!C.outSpatialReference.equals(this.view.spatialReference)&&E("outSpatialReference")}};a._createClass(A,[{key:"maximumNumberOfFeatures",get:function(){return this.controller?.maximumNumberOfFeatures??this._get("maximumNumberOfFeatures")},set:function(C){this._set("maximumNumberOfFeatures",C);this.controller&&(this.controller.maximumNumberOfFeatures=C)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?
!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}},{key:"updatingProgressValue",get:function(){let C=0;if(this.controller?.updating){var E=this.controller.updatingRemaining,F=Math.max(this.controller.updatingTotal,this._controllerTotal);0<F&&(C=(F-E)/F,this._controllerTotal=F)}E=0;if(this.processor?.updating){F=this.processor.updatingRemaining;const H=Math.max(F,this._processorTotal);0<H&&(E=(H-F)/H,this._processorTotal=H)}return.5*(C+E)}},{key:"updatePolicy",get:function(){if(!this.controller)return q.UpdatePolicy.ASYNC;
switch(this.controller.mode){case "snapshot":const C=z[this.layer.geometryType];return null==C||this.controller.serviceDataCount>C?q.UpdatePolicy.ASYNC:q.UpdatePolicy.SYNC;case "tiles":return q.UpdatePolicy.ASYNC}}},{key:"hasZ",get:function(){const C=this.layer,E=C.capabilities&&C.capabilities.data;return E&&E.supportsZ?"returnZ"in C&&null!=C.returnZ?C.returnZ:E.supportsZ:!1}},{key:"hasM",get:function(){const C=this.layer,E=C.capabilities&&C.capabilities.data;return E&&E.supportsM?"returnM"in C&&
null!=C.returnM?C.returnM:!1:!1}},{key:"usedMemory",get:function(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)}},{key:"unloadedMemory",get:function(){const C=this.controller?.expectedFeatureDiff??0,E=this.processor?.loadedFeatures??0;return(this.processor?.unprocessedMemoryEstimate??0)+E/(E+C)*(this.processor?.usedMemoryPerFeature??0)*C}},{key:"ignoresMemoryFactor",get:function(){return this.controller?.hasMaximumNumberOfFeaturesOverride}},{key:"performanceInfo",
get:function(){var C=this.controller?.displayFeatureLimit;C=w.isSome(C)?C.averageSymbolComplexity:void 0;C=w.isSome(C)?`f:${C.primitivesPerFeature},v:${C.primitivesPerCoordinate}`:"n/a";return{...this._getResourceInfo(),partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?.mode??"n/a",symbolComplexity:C,nodes:this.controller?.tileDescriptors.length??0,...(this.controller?.debug??{storedFeatures:0,totalVertices:0})}}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller,
loadedGraphics:this.controller?.graphics}}}]);return A}(D(k.FeatureLikeLayerView3D(y(u.LayerView3D(B)))));b.__decorate([x.property()],m.prototype,"layer",void 0);b.__decorate([x.property()],m.prototype,"controller",void 0);b.__decorate([x.property()],m.prototype,"_controllerTotal",void 0);b.__decorate([x.property()],m.prototype,"_processorTotal",void 0);b.__decorate([x.property()],m.prototype,"maximumNumberOfFeatures",null);b.__decorate([x.property()],m.prototype,"maximumNumberOfFeaturesExceeded",
null);b.__decorate([x.property(r.updatingProgress)],m.prototype,"updatingProgress",void 0);b.__decorate([x.property({readOnly:!0})],m.prototype,"updatingProgressValue",null);b.__decorate([x.property({readOnly:!0})],m.prototype,"updatePolicy",null);b.__decorate([x.property({readOnly:!0})],m.prototype,"hasZ",null);b.__decorate([x.property({readOnly:!0})],m.prototype,"hasM",null);b.__decorate([x.property()],m.prototype,"suspendResumeExtentMode",void 0);m=b.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],
m);const z={point:5E3,polygon:500,polyline:1E3};return m})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){function E(F,H){if(!H)return!1;for(const K of H)if(!F.has(K))return!0;return!1}a.FeatureTileController3D=function(F){function H(I){I=K.call(this,I);I.type="feature-tile-3d";I._watchUpdatingTracking=new y.WatchUpdatingTracking;I.serviceDataExtent=null;I.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;I.vertexLimitExceeded=!1;I.displayFeatureLimit=null;I._suspended=!1;I._tileFetcher=null;I._handles=new g;I._fetchDataInfoPromise=
null;I._fetchDataInfoAbortController=null;I._lifeCycleAbortController=new AbortController;return I}b._inherits(H,F);var K=b._createSuper(H);F=H.prototype;F._approximateExtentSizeAtScale=function(I,L){const R=this.layerView.view,O=L.levels[0];return(O.tileSize[0]/(O.scale/I)+O.tileSize[1]/(O.scale/I))/2*Math.ceil((R.width/L.pixelSize+R.height/L.pixelSize)/2)};F.initialize=function(){this._watchUpdatingTracking.add(()=>this.vertexLimitInfo,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,
this._lifeCycleAbortController.signal)));this._watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),p.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))};F._verifyCapabilities=function(){const I=this.layerView.layer;if("ogc-feature"!==I.type&&!D.getEffectiveLayerCapabilities(I)?.operations.supportsQuery)throw new l("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:I});};F.destroy=function(){this._cancelFetchServiceDataInfo();this._tileFetcher=e.destroyMaybe(this._tileFetcher);this._handles=e.destroyMaybe(this._handles);this._tilesHandle=e.removeMaybe(this._tilesHandle);this._lifeCycleAbortController=e.abortMaybe(this._lifeCycleAbortController);this._watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};F.suspend=function(){this._suspended||(this._suspended=!0,e.isSome(this._tileFetcher)&&
this._tileFetcher.suspend())};F.resume=function(){this._suspended&&(this._suspended=!1,e.isSome(this._tileFetcher)&&this._tileFetcher.resume())};F.restart=function(){const I=()=>{e.isSome(this._tileFetcher)&&this._tileFetcher.restart()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(I,I))};F.refetch=function(){const I=()=>{e.isSome(this._tileFetcher)&&this._tileFetcher.refetch()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(I,I))};F._initializeTileFetcher=
function(){const I=this.layerView.view;if(I){var L=p.whenOnce(()=>I.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._watchUpdatingTracking.addPromise(L);L.then(()=>{const {layerView:R,tileDescriptors:O}=this,J=R.layer,M=new A.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:O,features:this.graphics});this._tileFetcher=M;this._suspended?this._tileFetcher.suspend():this._tileFetcher.resume();const G=this.layerView.view.resourceController;G&&
this._handles.add(p.watch(()=>G.memoryController.memoryFactor,U=>M.memoryFactor=U,p.syncAndInitial));const P="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;P&&this._handles.add(p.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[P],U=>M.lodFactor=U||1,p.initial));"ogc-feature"!==J.type&&this._watchUpdatingTracking.add(()=>J.createQueryVersion,()=>this._dataFilterChanged());this._watchUpdatingTracking.add(()=>R.availableFields,
(U,N)=>this._availableFieldsChanged(N,U));this._watchUpdatingTracking.add(()=>R.requiredFields,(U,N)=>this._requiredFieldsChanged(N,U));this._handles.add([J.on("apply-edits",U=>this._applyEdits(U)),p.watch(()=>this.extent,U=>M.filterExtent=U,p.sync),p.watch(()=>this.tileDescriptors,U=>M.tileDescriptors=U,p.sync),p.watch(()=>this.maximumNumberOfFeatures,U=>{M.maximumNumberOfFeatures=U;M.useTileCount=this.serviceDataCount>U},p.syncAndInitial),p.watch(()=>this.serviceDataCount,U=>M.useTileCount=U>this.maximumNumberOfFeatures,
p.syncAndInitial),p.watch(()=>C.FEATURE_TILE_FETCH_SHOW_TILES,U=>{U&&M&&!M.debugger?(M.debugger=new t.FeatureTileFetcher3DDebugger(M,I.featureTiles.tilingScheme.toTileInfo(),I),M.debugger.update()):!U&&this._tileFetcher&&M.debugger&&(M.debugger.destroy(),M.debugger=null)},p.syncAndInitial)]);this._supportsExceedsLimitQuery||this._watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this._lifeCycleAbortController.signal)))}).catch(()=>
{})}};F._modeChanged=function(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:d.getLogger(this.declaredClass).warn("Unhandled feature layer mode "+this.mode);case "snapshot":e.isSome(this._tilesHandle)&&(this._tilesHandle.remove(),this._tilesHandle=null)}};F._dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};F._applyEdits=function(I){e.isNone(this._tileFetcher)||
this._tileFetcher.applyEdits(I).then(L=>{if(L){if(!this._lifeCycleAbortController)throw u.createAbortError();(L.deletedFeatures.length||L.updatedFeatures.length||L.addedFeatures.length)&&this._watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(L=>{if(!u.isAbortError(L))throw L;})};F._availableFieldsChanged=function(I,L){e.isSome(this._tileFetcher)&&E(this._tileFetcher.availableFields,L)&&this.refetch()};F._requiredFieldsChanged=function(I,
L){e.isSome(this._tileFetcher)&&E(this._tileFetcher.availableFields,L)&&this.restart()};F._createVertexLimitExceededQuery=function(I){const L=this.layerView.layer,R=L.createQuery();R.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:I,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];L.capabilities?.query.supportsCacheHint&&(R.cacheHint=!0);return R};F._createDataInfoQuery=function(){const I=this.layerView.layer,L=I.createQuery();L.outSpatialReference=this.layerView.view.spatialReference;
I.capabilities?.query.supportsCacheHint&&(L.cacheHint=!0);return L};F._fullExtentIsAccurate=function(){const I=this.layerView.layer;if(I.definitionExpression)return!1;switch(I.type){case "feature":case "oriented-imagery":return B.isHostedAgolService(I.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};F._updateServiceDataExtent=async function(I){try{await this._tryUpdateServiceDataExtent(I)}catch(L){u.isAbortError(L)||this._set("serviceDataExtent",f.clone(this.layerView.fullExtentInLocalViewSpatialReference))}};
F._tryUpdateServiceDataExtent=async function(I){var L=this.layerView;const R=L.layer,O=R.capabilities?.query.supportsExtent??!1,J=f.clone(L.fullExtentInLocalViewSpatialReference),M=R.fullExtent,G=this._fullExtentIsAccurate(),P=this.serviceDataCount;O&&P<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!J||!G)&&"queryExtent"in R?(L=this._createDataInfoQuery(),I=await R.queryExtent(L,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,signal:I}),this._set("serviceDataExtent",
I.extent)):J?this._set("serviceDataExtent",J):e.isSome(M)?(I=await z.projectGeometry(M,L.view.spatialReference,"portalItem"in R?R.portalItem:null,I),this._set("serviceDataExtent",I)):this._set("serviceDataExtent",null)};F._updateServiceDataCount=async function(I){const L=this.layerView.layer;if("queryFeatureCount"in L)if(I=await n.result(L.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:I})),!0===I.ok)this._set("serviceDataCount",
I.value);else{if(u.isAbortError(I.error))throw I.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)};F._updateVertexLimitExceeded=async function(I,L){var R=this.vertexLimitInfo;if(e.isNone(R))this._set("vertexLimitExceeded",!1);else{var O=1<this._minimumNumberOfVerticesForGeometry;if(0>=R.primitivesPerFeature||O){var {primitivesPerFeature:J,primitivesPerCoordinate:M,
maximumTotalNumberOfPrimitives:G}=R;0!==J&&e.isSome(I)&&await I;R=this.serviceDataCount;var P=R!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;I=P?Math.ceil((G-R*J)/(M||1)):Math.ceil(G/(M||1));O&&(I=Math.min(I,5E6));if(P&&this._minimumNumberOfVerticesForGeometry*R>I)this._set("vertexLimitExceeded",!0);else if(this._supportsExceedsLimitQuery)if(L=await n.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(I),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,
signal:L})),!1===L.ok){if(u.isAbortError(L.error))throw L.error;this._set("vertexLimitExceeded",!1)}else(L=L.value.features[0])&&L.attributes?this._set("vertexLimitExceeded",!!L.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>I)}else this._set("vertexLimitExceeded",!1)}};F._fetchServiceDataInfo=async function(){this._cancelFetchServiceDataInfo();let I=new AbortController;const L=I.signal;var R=this._updateServiceDataCount(L);
R=u.eachAlways([R,this._updateVertexLimitExceeded(R,L)]);const O=R.then(()=>this._updateServiceDataExtent(L)).catch(J=>{u.isAbortError(J)||d.getLogger(this.declaredClass).error("#fetchServiceDataInfo()",J)}).then(()=>{O===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);I=null});I&&(this._fetchDataInfoPromise=O);this._fetchDataInfoAbortController=I;return R.then(()=>{},()=>{})};F._cancelFetchServiceDataInfo=function(){const I=this._fetchDataInfoAbortController;
I&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,I.abort())};b._createClass(H,[{key:"extent",set:function(I){if(e.isSome(I)&&!I.spatialReference.equals(this.layerView.view.spatialReference))d.getLogger(this.declaredClass).error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var L=this._get("extent");L===I||e.isSome(L)&&I&&L.equals(I)||(I=e.isSome(I)?I.clone():null,this._set("extent",I))}}},{key:"updating",get:function(){return!!(e.isSome(this._tileFetcher)&&
this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._watchUpdatingTracking&&this._watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&e.isSome(this._tileFetcher)?this._tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&e.isSome(this._tileFetcher)?this._tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",
get:function(){return this.updating&&e.isSome(this._tileFetcher)?this._tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return e.isSome(this._tileFetcher)?this._tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!e.isSome(this._tileFetcher)||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return e.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:
0},set:function(I){I!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",I)}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var I=this.layerView.layer;if("feature"===I.type&&e.isSome(I.infoFor3D))return"snapshot";if(!1===this.layerView.view.qualitySettings?.graphics3D?.snapshotAvailable||this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";
var L=this.layerView.view;L=(L=L&&L.featureTiles)&&L.tilingScheme;return I&&I.minScale&&this.serviceDataExtent&&L&&(I=this._approximateExtentSizeAtScale(I.minScale,L),(this.serviceDataExtent.width/I+this.serviceDataExtent.height/I)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const I=this._get("maxTotalSnapshotVertices")||
0,L="snapshot"===this.mode&&e.isSome(this._tileFetcher)&&this._tileFetcher.totalVertices||0;return Math.max(I,L)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new x([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new x}},{key:"test",get:function(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(e.isNone(this.displayFeatureLimit)||
e.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:I,maximumTotalNumberOfPrimitives:L}=this.displayFeatureLimit,{primitivesPerCoordinate:R,primitivesPerFeature:O}=I,J=this._get("vertexLimitInfo");return e.isNone(J)||J.maximumTotalNumberOfPrimitives!==L||J.primitivesPerCoordinate!==R||J.primitivesPerFeature!==O?{primitivesPerCoordinate:R,primitivesPerFeature:O,maximumTotalNumberOfPrimitives:L}:J}},{key:"_supportsExceedsLimitQuery",get:function(){const I=
this.layerView.layer;return null!=I.capabilities&&I.capabilities.operations&&I.capabilities.operations.supportsExceedsLimitStatistics}},{key:"_minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:e.isSome(this._tileFetcher)?this._tileFetcher.storedFeatures:
0,totalFeatures:e.isSome(this._tileFetcher)?this._tileFetcher.totalFeatures:0,totalVertices:e.isSome(this._tileFetcher)?this._tileFetcher.totalVertices:0,missingTiles:e.isSome(this._tileFetcher)?this._tileFetcher.missingTiles:0}}}]);return H}(k.EsriPromiseMixin(w));c.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);c.__decorate([h.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);c.__decorate([h.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"layerView",void 0);c.__decorate([h.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"context",void 0);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"extent",null);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"updating",null);c.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_watchUpdatingTracking",void 0);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"updatingTotal",
null);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);c.__decorate([h.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"serviceDataCount",void 0);c.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitExceeded",void 0);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);c.__decorate([h.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);c.__decorate([h.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);c.__decorate([h.property({readOnly:!0,dependsOn:["mode"]})],a.FeatureTileController3D.prototype,"tileDescriptors",null);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);c.__decorate([h.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);c.__decorate([h.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=c.__decorate([q.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(F){F.NO_SERVICE_DATA_COUNT=Infinity;F.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;F.reset=function(){F.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;F.QUERY_STATISTICS_TIMEOUT=12E3;F.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){function C(O){return"dummy-tile-full-extent"===O.id}function E(O){let J=0;for(const M of O)M.features&&0<M.features.length&&M.alive&&(J=Math.max(J,M.descriptor.lij[0]));return J}function F(O){O.setFeatures([],0,null);O.featuresMissing=!1;return v.FetchStatus.DONE}function H(O){return l.isNone(O)?new Set:new Set(O.map(J=>J.name))}function K(O,J){if(l.isNone(O)||l.isNone(J))return H(J);const M=new Set;for(const {name:G}of J)O.has(G)&&M.add(G);
return M}const I=x.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(O){function J(G){G=M.call(this,G);G._useTileCount=!1;G.updating=!1;G.running=!1;G.updatingTotal=0;G.updatingRemaining=0;G.expectedFeatureDiff=0;G.maximumNumberOfFeaturesExceeded=!1;G.maximumNumberOfFeaturesExceededThrottle=1E3;G._fullRatio=1;G._farRatio=1;G._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};G._handles=new n;G._frameTask=t.ImmediateTask;G._dirty=!1;G._featureTiles=
new Map;G._displayingFeatureReferences=new Map;G._numDisplayingFeatureReferences=0;G._suspended=!0;G._pendingEdits=null;return G}b._inherits(J,O);var M=b._createSuper(J);O=J.prototype;O.initialize=function(){this._handles.add(f.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()}));this._objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?z.MultiFeatureReference:z.SingleFeatureReference;
const G=this.context.scheduler;l.isSome(G)&&(this._frameTask=G.registerTask(t.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()};O.destroy=function(){this._frameTask.remove();this._handles=l.destroyMaybe(this._handles);this._featureTiles.forEach(G=>{this._cancelFetchTile(G);this._removeTile(G)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();this._pendingEdits=null};O.restart=function(){this._featureTiles.forEach(G=>{this._cancelFetchTile(G);
this._clearTile(G);this._resetFetchTile(G)});l.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};O.refetch=function(){this._featureTiles.forEach(G=>{this._cancelFetchTile(G);this._resetFetchTile(G)});l.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};O.suspend=function(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())};O.resume=function(){this._suspended&&(this._suspended=!1,this._unpause())};O._pause=function(){this._paused&&
(this._featureTiles.forEach(G=>this._cancelFetchTile(G)),this._updated())};O._unpause=function(){this._paused||(this._setDirty(),this._updated())};O.applyEdits=function(G){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const P=this._pendingEdits;P.count++;const U=P.edits.then(()=>G.result.catch(N=>{if(g.isAbortError(N))throw N;return null}).then(N=>{if(!N)return N;this._applyEditsDeleteFeatures(N.deletedFeatures);return this._applyEditsAddUpdateFeatures(N.addedFeatures,
N.updatedFeatures,P.controller.signal).then(()=>N)}).then(N=>{0===--P.count&&(this._pendingEdits===P&&(this._pendingEdits=null),l.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated());return N}));P.edits=U;this._updated();return U};O._applyEditsDeleteFeatures=function(G){if(0!==G.length){var P=this.context.globalIdField,U=P&&this.availableFields.has(P),N=new Set,S=this._objectIdField;G.forEach(({objectId:Q,globalId:W})=>{(!Q||0>Q)&&P?(U||I.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${P} to be included the layer's outFields for updates to be reflected in the view`),
(Q=this.features.find(V=>V.attributes&&V.attributes[P]===W))&&N.add(q.getObjectId(Q,S))):N.add(Q)});this._featureTiles.forEach(Q=>{if(Q.features){var W=Q.features.filter(V=>!N.has(q.getObjectId(V,this._objectIdField)));W.length!==Q.features.length&&(Q.setFeatures(W,0,Q.availableFields),this._invalidateCounts())}})}};O._applyEditsAddUpdateFeatures=async function(G,P,U){const N=[],S=new Set;G.forEach(W=>N.push(W.objectId));P.forEach(W=>{N.push(W.objectId);S.add(W.objectId)});if(0!==N.length){var Q=
[];this._featureTiles.forEach(W=>{(W=this._applyEditsAddUpdateTile(W,N,S,U))&&Q.push(W)});await g.eachAlways(Q)}};O._applyEditsAddUpdateTile=async function(G,P,U,N){if(G.features){var S=this._createQuery(G);S.resultType=void 0;S.cacheHint=!1;S.objectIds=P;P=await this._queryFeatures(S,N);N=null;0<U.size&&(S=G.features.filter(Q=>!U.has(q.getObjectId(Q,this._objectIdField))),S.length!==G.features.length&&(N=S));if(0<P.features.length){N||(N=G.features.slice());for(const Q of P.features)N.push(Q)}N&&
(G.hasPreciseFeatureCount&&(G.numFeatures=Math.max(G.numFeatures,N.length)),G.setFeatures(N,0,K(G.availableFields,P.fields)),this._invalidateCounts())}};O._queryFeatures=function(G,P){return this.context.query.queryFeaturesDehydrated(G,{signal:P,timeout:6E5})};O._setDirty=function(){this._dirty=!0;this._updated()};O.runTask=function(G){this._frameTask.processQueue(G);if(this._dirty&&this.initialized){this._dirty=!1;var P=this._getListOfTiles();this._markTilesNotAlive(P);if(G.run(()=>this._addTiles(P,
G))&&G.run(()=>this._filterExtentTiles(P,G))&&G.run(()=>this._removeTiles(P,G))&&!G.done){var U=this._sortTiles(P);G.run(()=>this._showTiles(U,G))&&G.run(()=>this._fetchTiles(U,G))&&G.run(()=>this._updateMemoryEstimates(U,G))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}};O._markTilesNotAlive=function(G){for(const P of G)P.alive=!1};O._addTiles=function(G,P){if(this._suspended)return!1;this.tileDescriptors.forEach(U=>{const N=
this._featureTiles.get(U.id);N?N.alive=!0:P.done||(G.push(this._addTile(U)),P.madeProgress())});return P.hasProgressed};O._filterExtentTiles=function(G,P){for(const U of G){if(P.done)break;U.alive&&(U.filtered=!U.intersects(this.filterExtent),U.filtered&&(this._clearTile(U),P.madeProgress()))}return P.hasProgressed};O._removeTiles=function(G,P){for(let U=G.length-1;0<=U&&!P.done;U--){const N=G[U];N.alive||(this._removeTile(N),U!==G.length-1&&(G[U]=G[G.length-1]),G.pop(),P.madeProgress())}return P.hasProgressed};
O._sortTiles=function(G){G.sort((P,U)=>(P.descriptor.loadPriority??0)-(U.descriptor.loadPriority??0));return G};O._showTiles=function(G,P){const U=this._updateRatio(G),N=S=>{const Q=1>this._fullRatio?U(S)*this._farRatio:1;S.reduceFeatures(Q,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(S)};for(const S of G)if(!P.run(()=>N(S))){this._setDirty();break}return P.hasProgressed};O._fetchTiles=function(G,P){if(this._paused)return!1;var U=!1;for(const S of G)if(S.needsFetching){var N=
l.isSome(this.context.memoryCache)?this.context.memoryCache.pop(S.id):null;if(l.isSome(N))S.cache=N,this._setDirty(),this._scheduleUpdated(),P.madeProgress();else if(this._needsNumFeatures(S)&&(U=new AbortController,N=this._fetchTileCount(S,U.signal),this._handleRequest(S,N,U,()=>S.numFeatures=v.FAILED_FEATURE_COUNT),U=!0,P.madeProgress()),P.done)return!0}if(U)return P.hasProgressed;for(const S of G)if(S.needsFetching&&(G=new AbortController,U=this._fetchTile(S,G.signal),this._handleRequest(S,U,G,
Q=>{S.setFeatures([],0,null);this._invalidateCounts();S.featuresMissing=!1;this.context.logFetchError(I,Q)}),P.madeProgress()))return!0;return P.hasProgressed};O._updateMemoryEstimates=function(G,P){G.some(U=>P.run(()=>U.updateMemoryEstimates())?!1:(this._setDirty(),!0));return P.hasProgressed};O._reclip=function(G,P){if(this.initialized){var U=[];this._featureTiles.forEach(N=>{l.isNone(N.displayingFeatures)||0===N.displayingFeatures.length||(N.intersectionIncludingBorrowed(P,L),N.intersectionIncludingBorrowed(G,
R),r.equals(L,R)||U.push(N))});this._refreshDisplayingFeatures(U);this._updated()}};O._refreshDisplayingFeatures=function(G){const P=new Set,U=this._changes.updates;for(const N of G)if(!l.isNone(N.displayingFeatures))for(const S of N.displayingFeatures)G=q.getObjectId(S,this._objectIdField),P.has(G)||(P.add(G),G=this._displayingFeatureReferences.get(G).feature,U.removes.push(G),U.adds.push(G));this._applyChanges()};O._updated=function(){let G=0;this._paused||this._featureTiles.forEach(U=>U.isFetching?
++G:0);var P=this._dirty||!!this._pendingEdits||0<G;this._set("running",this._dirty);this._set("updating",P);if(P){let U=0,N=0,S=0,Q=0,W=0;const V=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(X=>{++N;if(X.isFetching&&X.hasPreciseFeatureCount){const Z=this._maximumFeaturesForTile(X)*(1-X.emptyFeatureRatio),Y=l.isSome(X.displayingFeatures)?X.displayingFeatures.length*V:0;W+=Z-Y}X.needsFetching?++Q:0<X.numFeatures&&(++S,U+=X.numFeatures)});Q+=
G;let T=P=0;U?(T=U,P=Math.min(Q*U/S,U)):(T=N,P=Q);W=Math.min(this.maximumNumberOfFeatures-this.features.length,W);this._set("updatingTotal",T);this._set("updatingRemaining",P);this._set("expectedFeatureDiff",W)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};O._updateMaximumNumberOfFeaturesExceeded=function(){const G=m.someMap(this._featureTiles,P=>P.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",
G)};O._updateRatio=function(G){const P=E(G),U=Q=>1/(1<<Math.max(0,P-Q.descriptor.lij[0]));let N=0,S=0;for(const Q of G)G=Q.numFeatures,N+=G,S+=G*U(Q);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/N);this._farRatio=this.maximumNumberOfFeatures/S;this._scheduleUpdated();return U};O._maximumFeaturesUpdated=function(G,P){G!==P&&(P>G&&this._featureTiles.forEach(U=>{if(U.featuresMissing){var N=this._maximumFeaturesForTile(U);U.features&&(U.features.length>=N||U.fetchStatus===v.FetchStatus.FULL)||
(this._cancelFetchTile(U),this._resetFetchTile(U))}}),this._setDirty())};O._addTile=function(G){G=new v.FeatureTile(G);this._featureTiles.set(G.id,G);this._resetFetchTile(G);this._referenceDisplayingFeaturesFromRelatedTiles(G);return G};O._referenceDisplayingFeaturesFromRelatedTiles=function(G){const P=G.descriptor.resolution;this._featureTiles.forEach(U=>{if(!(l.isNone(U.displayingFeatures)||G===U||G.descriptor.lij&&U.descriptor.lij&&!A.tilesAreRelated(G.descriptor.lij,U.descriptor.lij))){l.isNone(G.displayingFeatures)&&
(G.displayingFeatures=[]);G.descriptor.extent&&U.descriptor.extent&&(l.isNone(G.extentIncludingBorrowedFeatures)&&(G.extentIncludingBorrowedFeatures=r.clone(G.descriptor.extent)),r.expand(G.extentIncludingBorrowedFeatures,U.descriptor.extent,G.extentIncludingBorrowedFeatures));for(const N of U.displayingFeatures)G.displayingFeatures.push(N),U=this._displayingFeatureReferences.get(q.getObjectId(N,this._objectIdField)),U.ref(U.feature,P),this._numDisplayingFeatureReferences++}});G.featureLimit=l.isSome(G.displayingFeatures)?
G.displayingFeatures.length:0};O._removeTile=function(G){this._clearTile(G);this._featureTiles.delete(G.id)};O._resetFetchTile=function(G){G.filtered=!G.intersects(this.filterExtent);G.filtered?G.needsFetching&&(G.fetchStatus=v.FetchStatus.DONE):G.fetchStatus=v.FetchStatus.FETCH_NEEDED};O._cancelFetchTile=function(G){const P=G.requestController;l.isSome(P)&&(G.requestController=null,G.resetFetching(),P.abort())};O._fetchTileCount=async function(G,P){G.numFeatures=await this._fetchCount(G,P);this._updateRatio(this._getListOfTiles());
return G.fetchStatus===v.FetchStatus.REFETCHING?v.FetchStatus.REFETCH_NEEDED:v.FetchStatus.FETCH_NEEDED};O._fetchTile=async function(G,P){var U=this._maximumFeaturesForTile(G);if(0>=U)return F(G);const N=this._getMaxRecordCount(G);var S=Math.ceil(U/N);if(C(G)||!this.context.capabilities.supportsMaxRecordCountFactor||G.numFeatures<=U&&S>B.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(G,P);S=this._createQuery(G);S.maxRecordCountFactor=Math.ceil(U/N);G.isRefetching&&G.features&&0<G.features.length&&
(S.maxRecordCountFactor=Math.max(Math.ceil(G.features.length/(1-G.emptyFeatureRatio)/N)+1,S.maxRecordCountFactor));const {features:Q,exceededTransferLimit:W,fields:V}=await this._queryFeatures(S,P);U=W?S.maxRecordCountFactor>=B.MAX_MAX_RECORD_COUNT_FACTOR?v.FetchStatus.FULL:v.FetchStatus.DONE:v.FetchStatus.FULL;await this._frameTask.schedule(()=>{G.featuresMissing=Q.length<G.numFeatures||!!W;const T=this._removeEmptyFeatures(Q);G.setFeatures(Q,T,H(V))},P);g.throwIfAborted(P);this._invalidateCounts();
return U};O._fetchCount=async function(G,P){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(G),{signal:P})};O._fetchPagedTile=async function(G,P){let U=0,N=0,S,Q=0,W=this._maximumFeaturesForTile(G)-Q;const V=this._getMaxRecordCount(G);let T=null;for(;;){const X=this._createQuery(G),Z=this._setPagingParameters(X,U,W,V),{features:Y,exceededTransferLimit:aa,fields:ia}=await this._queryFeatures(X,P);await this._frameTask.schedule(()=>{Z&&(U+=l.unwrap(X.num));Q+=Y.length;N+=this._removeEmptyFeatures(Y);
G.featuresMissing=U<G.numFeatures||!!aa;S=S?S.concat(Y):Y;T=K(T,ia);G.setFeatures(S,N,T)},P);g.throwIfAborted(P);this._invalidateCounts();this._setDirty();W=this._maximumFeaturesForTile(G)-Q;if(!Z||!aa||0>=W)return aa?v.FetchStatus.DONE:v.FetchStatus.FULL}};O._createFeatureCountQuery=function(G){G=this._createQuery(G);this.context.capabilities.supportsCacheHint&&(G.resultType=void 0,G.cacheHint=!0);return G};O._createQuery=function(G){const P=this.context.createQuery(),U=G.descriptor.extent;U&&(P.geometry=
r.toExtent(U,this.context.tilingScheme.spatialReference));this._setResolutionParams(P,G);this._useTileQuery(G)?P.resultType="tile":this.context.capabilities.supportsCacheHint&&(P.cacheHint=!0);return P};O._setPagingParameters=function(G,P,U,N){if(!this.context.capabilities.supportsPagination)return!1;G.start=P;0<U&&this.context.capabilities.supportsMaxRecordCountFactor?(G.maxRecordCountFactor=Math.ceil(U/N),G.num=Math.min(G.maxRecordCountFactor*N,U)):G.num=Math.min(N);return!0};O._getEffectiveTileResolution=
function(G){if(null==G.descriptor.resolution)return null;const P=this.context.viewingMode===D.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(G.descriptor.resolution,P)/this.lodFactor};O._setResolutionParams=function(G,P){this._supportsResolution&&(P=this._getEffectiveTileResolution(P),null!=P&&(this.context.capabilities.supportsQuantization?G.quantizationParameters=new y({mode:"view",originPosition:"upper-left",tolerance:P,extent:this.context.fullExtent}):
"polyline"===this.context.geometryType&&(G.maxAllowableOffset=P)))};O._removeEmptyFeatures=function(G){const P=G.length;for(let U=0;U<G.length;)q.hasVertices(G[U].geometry)?++U:(G[U]=G[G.length-1],--G.length);return P-G.length};O._needsNumFeatures=function(G){return this.useTileCount&&G.needsFeatureCount&&!C(G)};O._getMaxRecordCount=function(G){const {tileMaxRecordCount:P,maxRecordCount:U}=this.context;return this._useTileQuery(G)&&l.isSome(P)&&0<P&&this.context.capabilities.supportsResultType?P:
l.isSome(U)&&0<U?U:2E3};O._useTileQuery=function(G){return C(G)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};O._handleRequest=function(G,P,U,N){G.fetchStatus=G.needsRefetching?v.FetchStatus.REFETCHING:v.FetchStatus.FETCHING;G.requestController=U;let S=!1;P.then(Q=>{G.requestController=null;G.fetchStatus=Q}).catch(Q=>{G.requestController===U&&(G.requestController=null,G.fetchStatus=v.FetchStatus.DONE);g.isAbortError(Q)?S=!0:N(Q)}).then(()=>{S||this._setDirty();
this._scheduleUpdated()})};O._scheduleUpdated=function(){this._handles&&!this._handles.has("scheduleUpdated")&&this._handles.add(d.schedule(()=>{this._handles.remove("scheduleUpdated");this._updated()}),"scheduleUpdated")};O._showTile=function(G){if(l.isSome(G.displayingFeatures)&&!G.needsDisplayUpdate)return!1;var P=G.features;if(0===G.featureLimit||!P)return P=l.isSome(G.displayingFeatures)&&0<G.displayingFeatures.length,this._hideTileFeatures(G),G.displayingFeatures=[],P;const U=G.descriptor.resolution,
N=this._changes.updates,S=this._changes.adds,Q=Math.min(G.featureLimit,P.length);G.featureLimit=Q;for(let V=0;V<Q;++V){var W=P[V];const T=q.getObjectId(W,this._objectIdField),X=this._displayingFeatureReferences.get(T);X?(W=X.ref(W,U),W.oldVersion!==W.newVersion&&(W.oldVersion&&N.removes.push(W.oldVersion),W.newVersion&&N.adds.push(W.newVersion))):(this._displayingFeatureReferences.set(T,new this.FeatureReferenceClass(W,U)),S.push(W));this._numDisplayingFeatureReferences++}this._hideTileFeatures(G);
this._applyChanges();G.displayingFeatures=P.slice(0,Q);return!0};O._hideTile=function(G){this._cancelFetchTile(G);this._hideTileFeatures(G)};O._hideTileFeatures=function(G){if(!l.isNone(G.displayingFeatures)){var P=this._changes.updates,U=this._changes.removes;for(const S of G.displayingFeatures){const Q=q.getObjectId(S,this._objectIdField);var N=this._displayingFeatureReferences.get(Q);N&&((N=N.unref(G.descriptor.resolution),this._numDisplayingFeatureReferences--,N)?N.oldVersion!==N.newVersion&&
(null==N.newVersion?(this._displayingFeatureReferences.delete(Q),N.oldVersion&&U.push(N.oldVersion)):(P.adds.push(N.newVersion),N.oldVersion&&P.removes.push(N.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();G.displayingFeatures=null}};O._applyChanges=function(){var G=this._changes.updates;0<G.removes.length&&(this.features.removeMany(G.removes),G.removes.length=0);0<G.adds.length&&(this.features.addMany(G.adds),G.adds.length=0);G=this._changes.adds;const P=this._changes.removes,
U=Math.min(G.length,P.length);let N=0;for(;N<U;){const S=Math.min(N+200,U);this.features.addMany(G.slice(N,S));this.features.removeMany(P.slice(N,S));N=S}G.length>U&&this.features.addMany(0===N?G:G.slice(N));P.length>U&&this.features.removeMany(0===N?P:P.slice(N));G.length=0;P.length=0};O._clearTile=function(G){this._hideTile(G);G.features&&l.isSome(this.context.memoryCache)&&this.context.memoryCache.put(G.id,G.cache,16+G.estimatedSize);G.setFeatures(null,0,null);this._invalidateCounts()};O._invalidateCounts=
function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};O._getListOfTiles=function(){return Array.from(this._featureTiles.values())};O._maximumFeaturesForTile=function(G){const P=G.hasPreciseFeatureCount?G.numFeatures:Infinity;return Math.min(Math.ceil((G.hasPreciseFeatureCount?P:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-G.emptyFeatureRatio)),P)};b._createClass(J,[{key:"maximumNumberOfFeatures",set:function(G){G=
G||Infinity;const P=this._get("maximumNumberOfFeatures");G===P||1>G||(this._set("maximumNumberOfFeatures",G),this._maximumFeaturesUpdated(P,G))}},{key:"memoryFactor",set:function(G){this.memoryFactor!==G&&(this._set("memoryFactor",G),this._setDirty())}},{key:"lodFactor",set:function(G){this.lodFactor!==G&&(this._set("lodFactor",G),this._supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&l.isSome(this.context.query.queryFeatureCount)},set:function(G){this._useTileCount=
G;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let G=0;this._featureTiles.forEach(P=>G+=P.estimatedUnusedSize);return G}},{key:"totalVertices",get:function(){let G=0;this._featureTiles.forEach(P=>G+=P.numVertices);return G}},{key:"totalFeatures",get:function(){let G=0;this._featureTiles.forEach(P=>G+=P.numFeatures);return G}},{key:"filterExtent",set:function(G){if(l.isSome(G)&&this.context.tilingScheme&&!G.spatialReference.equals(this.context.tilingScheme.spatialReference))I.error("#filterExtent\x3d",
"extent needs to be in the same spatial reference as the tiling scheme");else{var P=this._get("filterExtent");P===G||l.isSome(P)&&G&&P.equals(G)||(G=l.isSome(G)?G.clone():null,this._set("filterExtent",G),this._reclip(G,P))}}},{key:"_paused",get:function(){return this._suspended||!!this._pendingEdits}},{key:"availableFields",get:function(){let G=null;this._featureTiles.forEach(P=>{l.isNone(P.displayingFeatures)||0===P.displayingFeatures.length||(l.isNone(G)?G=new Set(P.availableFields):G.forEach(U=>
{P.availableFields.has(U)||l.unwrap(G).delete(U)}))});return l.isSome(G)?G:new Set}},{key:"_supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((G,P)=>G+(P.features?P.features.length:0),0)}},{key:"missingTiles",get:function(){return Array.from(this._featureTiles.values()).reduce((G,P)=>G+(P.needsFetching||P.isFetching?1:0),0)}},{key:"test",get:function(){return{process:G=>
this.runTask(G),getFeatureTileById:G=>this._featureTiles.get(G),forEachFeatureTile:G=>this._featureTiles.forEach(G)}}}]);return J}(w);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);c.__decorate([e.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",
null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"running",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"updatingRemaining",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);c.__decorate([e.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"totalVertices",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=c.__decorate([h.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const L=r.create(),R=r.create();a.contextCapabilitiesFromLayer=
function(O){const J=O.capabilities.query;a:switch(O.geometryType){case "polyline":O=!0;break a;case "polygon":O=O.capabilities&&O.capabilities.query&&O.capabilities.query.supportsQuantization;break a;default:O=!1}return{supportsMultipleResolutions:O,supportsPagination:!(!J||!J.supportsPagination),supportsResultType:!(!J||!J.supportsResultType),supportsCacheHint:!(!J||!J.supportsCacheHint),supportsQuantization:!(!J||!J.supportsQuantization),supportsQuantizationEditMode:!(!J||!J.supportsQuantizationEditMode),
supportsMaxRecordCountFactor:!(!J||!J.supportsMaxRecordCountFactor),supportsFormatPBF:!(!J||!J.supportsFormatPBF)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){c=function(){function q(B,D){this._highestResolutionVersion=null;this.versions=[];this.ref(B,D)}var y=q.prototype;y.ref=function(B,D){const z=this.feature;r.oldVersion=z;this.feature&&Object.defineProperty(B,"uid",{value:this.feature.uid,configurable:!0});for(var v of this.versions)if(v.resolution===D){v.refCount++;if((D=this._highestResolutionVersion===v&&!h.equals(B,v.feature))||this._highestResolutionVersion!==v)v.feature=B;r.newVersion=D?B:z;return r}v=
{feature:B,resolution:D,refCount:1};this.versions.push(v);!this._highestResolutionVersion||D<this._highestResolutionVersion.resolution?(r.newVersion=B,this._highestResolutionVersion=v):r.newVersion=z;return r};y.unref=function(B){for(let D=0;D<this.versions.length;D++){const z=this.versions[D];if(z.resolution===B)return z.refCount--,r.oldVersion=this.feature,0===z.refCount&&(this.versions[D]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===z&&(this._recalculateHighestResolutionVersion(),
r.oldVersion=z.feature)),r.newVersion=this.feature,r}return null};y._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var B=this.versions[0];for(let D=1;D<this.versions.length;D++){const z=this.versions[D];z.resolution<B.resolution&&(B=z)}this._highestResolutionVersion=B}};b._createClass(q,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},
{key:"feature",get:function(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}}]);return q}();w=function(){function q(B){this._feature=B;this._refCount=1}var y=q.prototype;y.ref=function(B){++this._refCount;r.oldVersion=this._feature;this.feature&&Object.defineProperty(B,"uid",{value:this.feature.uid,configurable:!0});h.equals(this._feature,B)||(this._feature=B);r.newVersion=this._feature;return r};y.unref=function(){r.oldVersion=this._feature;if(0<this._refCount&&
(this._refCount--,!this.isReferenced))return r.newVersion=null,r;r.newVersion=this._feature;return r};b._createClass(q,[{key:"isReferenced",get:function(){return 0!==this._refCount}},{key:"isSingle",get:function(){return 1===this._refCount}},{key:"feature",get:function(){return this._feature}}]);return q}();const r={oldVersion:null,newVersion:null};a.MultiFeatureReference=c;a.SingleFeatureReference=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,w,n,x){const m=new Set;let l=function(){function f(e){this.descriptor=e;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=m;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var d=f.prototype;d.setFeatures=function(e,k,u){this._availableFields=
w.unwrapOr(u,m);this._features=e;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;e&&0<e.length?(this._emptyFeatureRatio=k/(e.length+k),this._numVertices=e.reduce((p,h)=>p+x.numVertices(h.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};d.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var e=0;e<this._features.length;++e){const k=x.estimateSize(this._features[e]);this._estimatedSize+=
k;e>=this.featureLimit&&(this._estimatedUnusedSize+=k)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=x.estimateSize(this._features[e]);return!0}return!1};d.resetFetching=function(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED};d.intersects=function(e){if(w.isNone(e)||!this.descriptor.extent)return!0;
n.fromExtent(e,g);return n.intersects(this.descriptor.extent,g)};d.intersectionIncludingBorrowed=function(e,k){const u=w.isSome(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!e&&!u)return n.copy(k,n.POSITIVE_INFINITY),k;w.isSome(e)?(n.fromExtent(e,k),n.intersection(k,u,k)):n.copy(k,u);return k};d._shuffle=function(e){this._features.sort((k,u)=>x.getObjectId(k,e)-x.getObjectId(u,e));c.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=
this._shuffled=!0};d.reduceFeatures=function(e,k,u){if(0>=e)return!1;if(!this._features)return this.featureLimit=0,!1;let p=!1;this.featureLimit=Math.ceil(this.numFeatures*e);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,p=!0));!this._shuffled&&1>e&&this._shuffle(u);e=Math.max(this.featureLimit,Math.ceil(k*this.numFeatures));this._features.length>e&&(this._features.length=
e,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return p};b._createClass(f,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},
{key:"featureLimit",get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return-1<
this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}},
{key:"isRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}},{key:"needsDisplayUpdate",get:function(){var e;if(e=!!this._features){a:{e=
this._features;var k=this.displayingFeatures,u=this.featureLimit;if(w.isNone(k)||w.isNone(e)||u!==k.length||u>e.length)e=!1;else{for(let p=0;p<u;++p)if(e[p]!==k[p]){e=!1;break a}e=!0}}e=!e}return e}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null;this._availableFields=
e.availableFields;this._features=e.features;this._numFeatures=e.numFeatures;this._emptyFeatureRatio=e.emptyFeatureRatio;this.fetchStatus=e.fetchStatus;this.featuresMissing=e.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return f}();a.FetchStatus=void 0;(function(f){f[f.FETCH_NEEDED=0]="FETCH_NEEDED";f[f.REFETCH_NEEDED=1]="REFETCH_NEEDED";f[f.FETCHING=2]="FETCHING";f[f.REFETCHING=3]="REFETCHING";f[f.DONE=4]="DONE";f[f.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));
const g=n.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../core/maybe ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(a,b,c,w,n,x,m,l,g,f){const d=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let e=function(){function k(p,h,r){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=p;this._view=r;this._tilingScheme=new f.TilingScheme(h);
this._loadedSymbols=d.map(q=>new l(new x({material:{color:[q[0],q[1],q[2],.6]},outline:{color:"black",size:1}})));this._loadingSymbols=[new l(new x({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this._pendingSymbols=[new l(new x({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this._dataExtentSymbol=new l(new x({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var u=k.prototype;u.destroy=function(){this.enabled=!1};u.update=function(){this._enabled?
(this._synchronizeMaps(this._loadingGraphics,{filter:p=>p.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:p=>!p.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:p=>!p.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(p=>{this._view.graphics.removeMany(p)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(p=>{this._view.graphics.removeMany(p)}),
this._loadedGraphics.clear(),this._pendingGraphics.forEach(p=>{this._view.graphics.removeMany(p)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))};u.showDataExtent=function(p){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);w.isNone(p)||(p=n.fromExtent(p),this._dataExtentGraphic=new c({geometry:p,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))};
u._synchronizeMaps=function(p,h){const r=[];p.forEach((q,y)=>{const B=this._tileFetcher.test.getFeatureTileById(y);B&&h.filter(B)||(this._view.graphics.removeMany(q),r.push(y))});r.forEach(q=>p.delete(q));this._tileFetcher.test.forEachFeatureTile(q=>{if(h.filter(q)&&!p.has(q.id)){const [D,z,v]=q.descriptor.lij;this._tilingScheme.ensureMaxLod(D);var y=this._tilingScheme.getExtentGeometry(D,z,v),B=new c({geometry:y,symbol:h.symbols[D%h.symbols.length]});y=new c({geometry:y.center,symbol:new m({verticalOffset:{screenLength:40/
.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new g({text:`${D}/${z}/${v}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});B=[B,y];p.set(q.id,B);this._view.graphics.addMany(B)}})};b._createClass(k,[{key:"enabled",get:function(){return this._enabled},set:function(p){this._enabled=p;this.update()}}]);return k}();a.FeatureTileFetcher3DDebugger=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){a.FeatureLikeLayerView3D=A=>{A=function(t){function C(){var F=E.apply(this,arguments);F.controller=null;F.updatePolicy=z.UpdatePolicy.SYNC;F.suspendResumeExtentMode="computed";F.slicePlaneEnabled=!1;F.fullExtentInLocalViewSpatialReference=null;F.suspendResumeExtent=null;F._controllerCreated=!1;F.supportsHeightUnitConversion=!0;F._pendingController=null;F.queryEngine=null;return F}b._inherits(C,t);var E=b._createSuper(C);t=C.prototype;t.initialize=
function(){const F=this.layer;if("isTable"in F&&F.isTable)this.addResolvingPromise(Promise.reject(new w("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:F})));else{this.addResolvingPromise(this._validateGeometryType());this.updatingHandles.add(()=>this.layer.renderer,K=>this._recreateProcessor(K),x.initial);this.addResolvingPromise((async()=>{this.fullExtentInLocalViewSpatialReference=await D.toViewIfLocal(this);await this._initializeController()})());this.updatingHandles.add(()=>
this.updatePolicy,K=>this.processor.preferredUpdatePolicy=K);var H=()=>this.processor.featureStore;this.queryEngine=new q.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return H()},hasZ:this.hasZ,hasM:this.hasM},priority:v.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}};t.destroy=function(){this._destroyPendingController();this.controller=n.destroyMaybe(this.controller);this._set("processor",
n.destroyMaybe(this.processor));this.queryEngine=n.destroyMaybe(this.queryEngine);this.loadedGraphics=null};t._destroyPendingController=function(){this._pendingController=n.destroyMaybe(this._pendingController)};t.getHit=function(F){let H;this.loadedGraphics?.forEach(K=>{K.uid===F&&(H=e.hydrateGraphic(K,this.layer))});return H?{type:"graphic",graphic:H,layer:H.layer}:null};t.whenGraphicBounds=function(F,H){return this.processor?.whenGraphicBounds(F,H)};t.computeAttachmentOrigin=function(F,H){return this.processor?.computeAttachmentOrigin(F,
H)};t.elevationAlignPointsInFeatures=async function(F,H){const K=this.graphics3DProcessor;if(n.isNone(K))throw new w("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return h.elevationAlignPointsInFeatures(this.view,this.layer,I=>K.getGraphics3DGraphicByObjectId(I),F,H)};t.queryForSymbologySnapping=async function(F,H){return this.symbologySnappingSupported?y.queryForSymbologySnapping(this.graphics3DProcessor,F,H):{candidates:[],sourceCandidateIndices:[]}};
t.queryFeatures=function(F,H){return this.queryEngine.executeQuery(this._ensureQuery(F),n.get(H,"signal"))};t.queryObjectIds=function(F,H){return this.queryEngine.executeQueryForIds(this._ensureQuery(F),n.get(H,"signal"))};t.queryFeatureCount=function(F,H){return this.queryEngine.executeQueryForCount(this._ensureQuery(F),n.get(H,"signal"))};t.queryExtent=function(F,H){return this.queryEngine.executeQueryForExtent(this._ensureQuery(F),n.get(H,"signal"))};t._ensureQuery=function(F){return n.isNone(F)?
this.createQuery():u.from(F)};t.highlight=function(F){return this.processor.highlight(F,this.layer.objectIdField)};t.maskOccludee=function(F){return this.processor.maskOccludee(F)};t.canResume=function(){return b._get(b._getPrototypeOf(C.prototype),"canResume",this).call(this)&&!this.processor?.scaleVisibilitySuspended};t.getSuspendInfo=function(){const F=b._get(b._getPrototypeOf(C.prototype),"getSuspendInfo",this).call(this);return this.processor?{...F,...this.processor.suspendInfo}:F};t.isUpdating=
function(){return!this.processor||this.processor.destroyed?!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)};t._initializeController=async function(){const F=this.createController();this._pendingController=F;await F.when();this._setControllerWhenInitialized(F)};t._setControllerWhenInitialized=async function(F){try{await this.when()}catch(H){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?
this._destroyPendingController():(await x.whenOnce(()=>this.view?.basemapTerrain?.ready),this.beforeSetController(F),this._pendingController=null,this.controller=F,this.loadedGraphics=F.graphics,this.notifyChange("updating"))};t._updateClippingExtent=function(F){this.clippingExtent=F;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=F,!0}};t._validateGeometryType=async function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new w("featurelayerview3d:unsupported-geometry-type",
"Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}};t._recreateProcessor=function(F){var H="heatmap"===F?.type;const K="heatmap"===this.processor?.type;F=this.processor;F&&H===K||(H=H?new B.HeatmapFeatureProcessor({owner:this}):new r({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:I=>
this._updateClippingExtent(I)}),this._set("processor",H),F?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(H.initializePromise))};t._getResourceInfo=function(){const F=this.controller instanceof k.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:F?.maximumNumberOfFeatures??-1,totalNumberOfFeatures:F?.serviceDataCount??-1,nodes:0,...this.processor.performanceInfo}};b._createClass(C,[{key:"legendEnabled",get:function(){return this.canResume()&&
this.processor?.legendEnabled}},{key:"graphics3DProcessor",get:function(){return"graphics-3d"===this.processor?.type?this.processor:null}},{key:"heatmapProcessor",get:function(){return"heatmap"===this.processor?.type?this.processor:null}},{key:"symbologySnappingSupported",get:function(){return this.layer?.renderer?.getSymbols()?.some(p.symbolHasExtrudeSymbolLayer)??!1}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return C}(A);c.__decorate([m.property()],A.prototype,"loadedGraphics",
void 0);c.__decorate([m.property()],A.prototype,"suspended",void 0);c.__decorate([m.property({readOnly:!0})],A.prototype,"legendEnabled",null);c.__decorate([m.property()],A.prototype,"updating",void 0);c.__decorate([m.property()],A.prototype,"controller",void 0);c.__decorate([m.property()],A.prototype,"processor",void 0);c.__decorate([m.property({readOnly:!0})],A.prototype,"updatePolicy",void 0);c.__decorate([m.property({readOnly:!0})],A.prototype,"suspendResumeExtentMode",void 0);c.__decorate([m.property({type:Boolean})],
A.prototype,"slicePlaneEnabled",void 0);c.__decorate([m.property({readOnly:!0})],A.prototype,"suspendInfo",void 0);c.__decorate([m.property()],A.prototype,"graphics3DProcessor",null);c.__decorate([m.property()],A.prototype,"heatmapProcessor",null);c.__decorate([m.property()],A.prototype,"symbologySnappingSupported",null);return A=c.__decorate([d.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],A)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),
function(a,b,c,w,n,x,m,l,g,f){const d=new l.ElevationContext,e=n.makeDehydratedPoint(0,0,0,f.WGS84),k=new m.SampleElevationInfo;a.elevationAlignPointsInFeatures=async function(u,p,h,r,q){const {elevationProvider:y,renderCoordsHelper:B,spatialReference:D}=u,{elevationInfo:z}=p;var v=g.extractExpressionInfo(z,!0);v=await g.createContext(v,D,q);w.throwIfAborted(q);q=[];const A=new Set,t=new Set;for(const {objectId:C,points:E}of r)if(r=h(C),c.isNone(r)){for(const F of E)q.push(F[2]);A.add(C)}else{r.isDraped&&
t.add(C);d.setFromElevationInfo(x.getGeometryEffectiveElevationInfo(r.graphic.geometry,z));d.updateFeatureExpressionInfoContext(v,r.graphic,p);e.spatialReference=u.spatialReference;for(const {x:F,y:H,z:K}of E)e.x=F,e.y=H,e.z=K??0,m.evaluateElevationInfoAtPoint(e,y,d,B,k),q.push(k.z)}return{elevations:q,drapedObjectIds:t,failedObjectIds:A}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports","../core/maybe","../symbols/support/unitConversionUtils"],
function(a,b,c){function w(k,u){return b.isNone(u)||!u.mode?(k?d:e).mode:u.mode}function n(k,u){return b.isSome(u)?u:k?d:e}function x(k,u){return w(b.isSome(k)?k.hasZ:!1,u)}function m(k){const u=l(k);return x(k.geometry,u)}function l(k){return k.layer&&"elevationInfo"in k.layer?k.layer.elevationInfo:null}function g(k,u,p,h,r,q,y=null){if(!b.isNone(q)){var B=b.isSome(y)?y.mode:"absolute-height";if("on-the-ground"===B)return 0;({absoluteZ:q}=f(u,p,h,r,k,q));a:{y=b.isSome(y)&&b.isSome(y.offset)?y.offset:
0;switch(B){case "absolute-height":k=q-y;break a;case "relative-to-ground":k=q-(b.unwrapOr(k.elevationProvider.getElevation(u,p,h,r,"ground"),0)+y);break a;case "relative-to-scene":k=q-(b.unwrapOr(k.elevationProvider.getElevation(u,p,h,r,"scene"),0)+y);break a}k=void 0}return k}}function f(k,u,p,h,r,q){const y=b.isSome(q.offset)?q.offset:0;switch(q.mode){case "absolute-height":return{absoluteZ:p+y,elevation:0};case "on-the-ground":return p=b.unwrapOr(r.elevationProvider.getElevation(k,u,0,h,"ground"),
0),{absoluteZ:p,elevation:p};case "relative-to-ground":return k=b.unwrapOr(r.elevationProvider.getElevation(k,u,p,h,"ground"),0),{absoluteZ:p+k+y,elevation:k};case "relative-to-scene":return k=b.unwrapOr(r.elevationProvider.getElevation(k,u,p,h,"scene"),0),{absoluteZ:p+k+y,elevation:k}}}const d={mode:"absolute-height",offset:0},e={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=d;a.elevationContextAffectsAlignment=function(k,u){if(b.isNone(u))return!1;({mode:u}=u);return b.isSome(u)&&
("scene"===k&&"relative-to-scene"===u||"ground"===k&&"absolute-height"!==u)};a.elevationInfoLikeEquals=function(k,u){return k===u||b.isSome(k)&&b.isSome(u)&&k.mode===u.mode&&k.offset===u.offset};a.getConvertedElevation=function(k,u,p,h=null){return g(k,u.x,u.y,u.hasZ?u.z:0,u.spatialReference,p,h)};a.getConvertedElevationFromVector=function(k,u,p,h,r=null){return g(k,u[0],u[1],2<u.length?u[2]:0,p,h,r)};a.getEffectiveElevationInfo=n;a.getEffectiveElevationMode=w;a.getGeometryEffectiveElevationInfo=
function(k,u){return n(b.isSome(k)?!!k.hasZ:!1,u)};a.getGeometryEffectiveElevationMode=x;a.getGraphicEffectiveElevationInfo=function(k){var u=l(k);k=x(k.geometry,u);u=b.isSome(u)&&"on-the-ground"!==k?b.unwrapOr(u.offset,0)*c.getMetersPerUnit(b.unwrapOr(u.unit,"meters")):0;return{mode:k,offset:u}};a.getGraphicEffectiveElevationMode=m;a.getZForElevationMode=function(k,u,p){if(!b.isNone(p)&&p.mode){var h=k.hasZ?k.z:0,r=b.isSome(p.offset)?p.offset:0;switch(p.mode){case "absolute-height":return h-r;case "on-the-ground":return 0;
case "relative-to-ground":return k=b.unwrapOr(u.elevationProvider.getElevation(k.x,k.y,h,k.spatialReference,"ground"),0)+r,h-k;case "relative-to-scene":return k=b.unwrapOr(u.elevationProvider.getElevation(k.x,k.y,h,k.spatialReference,"scene"),0)+r,h-k}}};a.hasGraphicFeatureExpressionInfo=function(k){if("on-the-ground"===m(k))return!1;k=l(k);k=b.isSome(k)&&k.featureExpressionInfo?k.featureExpressionInfo.expression:null;return!(!k||"0"===k)};a.onTheGroundElevationInfo=e;a.zValueInAbsoluteHeightMode=
f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/compilerUtils ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K){x=function(L){function R(J){J=O.call(this,J);J.type="graphics-3d";J._randomRotationRenderers=null;J.elevationFeatureExpressionEnabled=!1;J.scaleVisibilityEnabled=!1;J.filterVisibilityEnabled=!1;J.frustumVisibilityEnabled=!1;J.elevationAlignmentEnabled=!1;J.timeExtentEnabled=!1;J.setUidToIdOnAdd=!0;J.dataExtent=null;J.drapeSourceType=y.DrapeSourceType.Features;J.preferredUpdatePolicy=K.UpdatePolicy.ASYNC;J._suspendResumeExtent=null;
return J}a._inherits(R,L);var O=a._createSuper(R);L=R.prototype;L.initialize=function(){const J=this.owner,M=new D.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:J.hasZ,hasM:J.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:G=>J.view.deconflictor.addGraphicsOwner(G),labeler:(G,P)=>J.view.labeler.addGraphicsOwner(G,P),elevationAlignment:this.elevationAlignmentEnabled?
(G,P)=>new z({graphicsCoreOwner:this,graphicsCore:G,queryGraphicUIDsInExtent:P,elevationProvider:J.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(G,P)=>new t({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:P,graphicsCore:G,basemapTerrain:J.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==J.layer.geometryType?G=>new F.FeatureVisibilityFilter({context:{layerView:J,...G}}):null,objectStates:G=>
new A.Graphics3DObjectStates(G)}});this._set("graphicsCore",M);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new v({graphicsCoreOwner:this}));this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(G,P)=>{u.diff(G,P)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this.updatingHandles.add(()=>this.layer.labelingInfo,(G,P)=>{u.diff(G,
P)&&this.graphicsCore.updateLabelingInfo()});this.updatingHandles.add(()=>this.preferredUpdatePolicy,G=>this.graphicsCore.preferredUpdatePolicy=G);this._set("initializePromise",this._initializeAsync());this.updatingHandles.addPromise(this.initializePromise)};L._initializeAsync=async function(){await l.logOnError(this.graphicsCore.initializePromise);const J=this.owner;this.updatingHandles.add(()=>this.renderer,M=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(M)));this.updatingHandles.add(()=>
J.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this.updatingHandles.add(()=>J.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await l.logOnError(this.graphicsCore.updateLabelingInfo())};L.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("frustumVisibility",m.destroyMaybe(this.frustumVisibility));
this._set("graphicsCore",m.destroyMaybe(this.graphicsCore));this._set("owner",null)};L.maskOccludee=function(J){const {set:M,handle:G}=this.objectStates.acquireSet(H.Object3DState.MaskOccludee,null);this.objectStates.setUid(M,J.uid);return G};L.highlight=function(J,M){if(J instanceof q){const {set:G,handle:P}=this.objectStates.acquireSet(H.Object3DState.Highlight,M);this.owner.queryObjectIds(J).then(U=>this.objectStates.setObjectIds(G,U));return P}if("number"===typeof J||"string"===typeof J||J instanceof
c)return this.highlight([J],M);"toArray"in J&&(J=J.toArray());if(Array.isArray(J)&&0<J.length){if(J[0]instanceof c)if(null!=E.attributeLookup(this.layer.fieldsIndex,J[0].attributes,M))J=J.map(G=>E.attributeLookup(this.layer.fieldsIndex,G.attributes,M));else{J=J.map(U=>U.uid);const {set:G,handle:P}=this.objectStates.acquireSet(H.Object3DState.Highlight,null);this.objectStates.setUids(G,J);return P}if("number"===typeof J[0]||"string"===typeof J[0]){const {set:G,handle:P}=this.objectStates.acquireSet(H.Object3DState.Highlight,
M);this.objectStates.setObjectIds(G,J);return P}}return I};L.resetObjectStates=function(){this.objectStates.reset()};L.whenGraphicBounds=function(J,M){return this.graphicsCore?.whenGraphicBounds(J,M)};L.computeAttachmentOrigin=function(J,M){return this.graphicsCore?.computeAttachmentOrigin(J,M)};L.notifyGraphicGeometryChanged=function(J){this.graphicsCore.notifyGraphicGeometryChanged(J)};L.notifyGraphicVisibilityChanged=function(J){this.graphicsCore.notifyGraphicVisibilityChanged(J)};L.getRenderingInfo=
function(J,M,G){G=r.getRenderingInfo(J,{renderer:M,arcade:G});if(m.isSome(G)&&G.color){const P=G.color;P[0]/=255;P[1]/=255;P[2]/=255}m.isSome(G)&&m.isSome(M)&&this._randomRotationRenderers?.has(M)&&(M=this._randomRotationRenderers.get(M),J=J.attributes[M],M=new w.XXH(0),M.updateFloatArray([J]),M.updateUint8Array([173]),G.heading=8.381E-8*M.digest());return G};L.getRenderingInfoAsync=function(J,M,G,P){return r.getRenderingInfoAsync(J,{renderer:M,arcade:G,...P})};L.getSymbolLayerSize=function(J,M){return this.graphicsCore?.getSymbolLayerSize(J,
M)};L.setObjectIdVisibility=function(J,M){this.graphicsCore?.setObjectIdVisibility(J,M)};L.refreshFilter=function(){m.isSome(this.filterVisibility)&&this.filterVisibility.reapply()};L.getGraphics3DGraphicByObjectId=function(J){return this.graphicsCore?.getGraphics3DGraphicByObjectId(J)};L._updateClippingExtent=function(){const J=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(J,this.owner.view.spatialReference)&&(this.updateClippingExtent(J)||this.graphicsCore.recreateAllGraphics())};
L._setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add(g.watch(()=>this.suspendResumeExtentMode,()=>{this.handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.handles.add([g.watch(()=>this.graphicsCore.computedExtent,J=>this._updateSuspendResumeExtent(J),g.initial),g.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");
break;case "data":this.handles.add([g.when(()=>this.dataExtent,J=>this._updateSuspendResumeExtent(J),g.initial),g.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(m.unwrap(this.dataExtent)))],"suspendResumeExtentMode");break;default:n.neverReached(this.suspendResumeExtentMode)}},g.initial))};L._updateSuspendResumeExtent=function(J){J?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(J,this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)};L._extentToSuspendResumeRect=
function(J,M){const G=this.owner.view.spatialReference;if(!J.spatialReference.equals(G)){if(!p.canProject(J,G))return;J=p.project(J,G)}return C.enlargeExtent(J,M,B.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};L._suspendResumeExtentChanged=function(J){m.isSome(this.frustumVisibility)&&this.frustumVisibility.setExtent(J);m.isSome(this.scaleVisibility)&&this.scaleVisibility.setExtent(J)};a._createClass(R,[{key:"layer",get:function(){return this.owner.layer}},{key:"renderer",get:function(){const {renderer:J,
objectIdField:M}=this.layer;if(!J||!M||"heatmap"===J.type||!J.visualVariables)return J;const G=J.visualVariables.findIndex(U=>"rotation"===U.type&&null!=U.valueExpression&&h.matchRandomRotationExpression(U.valueExpression)===M&&(null==U.axis||"heading"===U.axis)&&"geographic"===U.rotationType);if(0>G)return J;const P=J.clone();P.visualVariables.splice(G,1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(P,M);return P}},{key:"scaleVisibility",
get:function(){return this.graphicsCore?.scaleVisibility}},{key:"filterVisibility",get:function(){return this.graphicsCore?.filterVisibility}},{key:"elevationAlignment",get:function(){return this.graphicsCore?.elevationAlignment}},{key:"objectStates",get:function(){return this.graphicsCore?.objectStates}},{key:"suspendResumeExtentMode",get:function(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}},{key:"scaleVisibilitySuspended",get:function(){return m.isSome(this.scaleVisibility)&&
this.scaleVisibility.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return m.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){const J={};this.scaleVisibilitySuspended&&(J.outsideScaleRange=!0);m.isSome(this.frustumVisibility)&&this.frustumVisibility.suspended&&(J.outsideOfView=!0);return J}},{key:"updating",get:function(){return!!(this.graphicsCore?.updating||m.isSome(this.frustumVisibility)&&
this.frustumVisibility.updating||this.updatingHandles?.updating)}},{key:"updatingRemaining",get:function(){return this.graphicsCore?.updatingRemaining??0}},{key:"featureStore",get:function(){return this.graphicsCore?.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){return this.owner?.fullOpacity}},{key:"filter",get:function(){return"filter"in this.owner?this.owner.filter:null}},
{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}},{key:"graphics3DGraphics",get:function(){return this.graphicsCore?.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphicsCore?.graphics3DGraphicsByObjectID}},
{key:"symbolUpdateType",get:function(){return this.graphicsCore?.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){const J=this.view.resourceController.memoryController.memoryFactor,M=this.graphicsCore?.displayFeatureLimit;return 1===J?M:{...M,maximumNumberOfFeatures:Math.ceil(M.maximumNumberOfFeatures*J),maximumTotalNumberOfFeatures:Math.ceil(M.maximumTotalNumberOfFeatures*J),minimumTotalNumberOfFeatures:Math.ceil(M.minimumTotalNumberOfFeatures*J)}}},{key:"usedMemory",get:function(){return this.graphicsCore?.usedMemory??
0}},{key:"loadedFeatures",get:function(){return this.graphicsCore?.numberOfGraphics??0}},{key:"usedMemoryPerFeature",get:function(){return this.graphicsCore?.usedMemoryPerGraphic??0}},{key:"unprocessedMemoryEstimate",get:function(){return this.graphicsCore?.unprocessedMemoryEstimate??0}},{key:"performanceInfo",get:function(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:m.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended,
visibilityScale:!this.scaleVisibilitySuspended}}}]);return R}(x.HandleOwner);b.__decorate([f.property()],x.prototype,"type",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"owner",void 0);b.__decorate([f.property()],x.prototype,"layer",null);b.__decorate([f.property()],x.prototype,"renderer",null);b.__decorate([f.property({constructOnly:!0})],x.prototype,"updateClippingExtent",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"elevationFeatureExpressionEnabled",void 0);
b.__decorate([f.property({constructOnly:!0})],x.prototype,"graphicsCore",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"filterVisibilityEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"frustumVisibilityEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,
"timeExtentEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],x.prototype,"setUidToIdOnAdd",void 0);b.__decorate([f.property()],x.prototype,"scaleVisibility",null);b.__decorate([f.property()],x.prototype,"filterVisibility",null);b.__decorate([f.property()],x.prototype,"elevationAlignment",null);b.__decorate([f.property({constructOnly:!0})],x.prototype,"frustumVisibility",void 0);b.__decorate([f.property()],x.prototype,"objectStates",null);b.__decorate([f.property()],x.prototype,"initializePromise",
void 0);b.__decorate([f.property()],x.prototype,"suspendResumeExtentMode",null);b.__decorate([f.property()],x.prototype,"dataExtent",void 0);b.__decorate([f.property()],x.prototype,"scaleVisibilitySuspended",null);b.__decorate([f.property()],x.prototype,"suspended",null);b.__decorate([f.property()],x.prototype,"legendEnabled",null);b.__decorate([f.property()],x.prototype,"suspendInfo",null);b.__decorate([f.property()],x.prototype,"updating",null);b.__decorate([f.property()],x.prototype,"updatingRemaining",
null);b.__decorate([f.property()],x.prototype,"featureStore",null);b.__decorate([f.property()],x.prototype,"view",null);b.__decorate([f.property()],x.prototype,"loadedGraphics",null);b.__decorate([f.property()],x.prototype,"fullOpacity",null);b.__decorate([f.property()],x.prototype,"filter",null);b.__decorate([f.property()],x.prototype,"slicePlaneEnabled",null);b.__decorate([f.property()],x.prototype,"drapeSourceType",void 0);b.__decorate([f.property()],x.prototype,"updatePolicy",null);b.__decorate([f.property()],
x.prototype,"preferredUpdatePolicy",void 0);b.__decorate([f.property()],x.prototype,"displayFeatureLimit",null);x=b.__decorate([k.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],x);const I={remove(){},pause(){},resume(){}};return x})},"esri/arcade/functions/hash":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(n){const x=[];for(let m=0,l=n.length;m<l;m++){let g=n.charCodeAt(m);128>g?x.push(g):2048>g?x.push(192|g>>6,128|g&63):55296>
g||57344<=g?x.push(224|g>>12,128|g>>6&63,128|g&63):(m++,g=65536+((g&1023)<<10|n.charCodeAt(m)&1023),x.push(240|g>>18,128|g>>12&63,128|g>>6&63,128|g&63))}return new Uint8Array(x)}let w=function(){function n(m){this._seed=m;this._totallen=0;this._bufs=[];this.init()}var x=n.prototype;x.init=function(){this._bufs=[];this._totallen=0;return this};x.updateFloatArray=function(m){const l=[];for(const g of m)isNaN(g)?l.push("NaN"):Infinity===g?l.push("Infinity"):-Infinity===g?l.push("-Infinity"):0===g?l.push("0"):
l.push(g.toString(16));this.update(c(l.join("")))};x.updateIntArray=function(m){m=Int32Array.from(m);this.update(new Uint8Array(m.buffer))};x.updateUint8Array=function(m){this.update(Uint8Array.from(m))};x.updateWithString=function(m){return this.update(c(m))};x.update=function(m){this._bufs.push(m);this._totallen+=m.length;return this};x.digest=function(){const m=new Uint8Array(this._totallen);let l=0;for(const g of this._bufs)m.set(g,l),l+=g.length;this.init();return this._xxHash32(m,this._seed)};
x._xxHash32=function(m,l=0){var g=l+374761393&4294967295;let f=0;if(16<=m.length){g=[l+2654435761+2246822519&4294967295,l+2246822519&4294967295,l+0&4294967295,l-2654435761&4294967295];l=m.length-16;var d=0;for(f=0;(f&4294967280)<=l;f+=4){var e=f;e=g[d]+(2246822519*(m[e]+(m[e+1]<<8))+(2246822519*(m[e+2]+(m[e+3]<<8))<<16))&4294967295;e=e<<13|e>>>19;g[d]=2654435761*(e&65535)+(2654435761*(e>>>16)<<16)&4294967295;d=d+1&3}g=(g[0]<<1|g[0]>>>31)+(g[1]<<7|g[1]>>>25)+(g[2]<<12|g[2]>>>20)+(g[3]<<18|g[3]>>>14)&
4294967295}g=g+m.length&4294967295;for(l=m.length-4;f<=l;f+=4)d=f,g=g+(3266489917*(m[d]+(m[d+1]<<8))+(3266489917*(m[d+2]+(m[d+3]<<8))<<16))&4294967295,g=g<<17|g>>>15,g=668265263*(g&65535)+(668265263*(g>>>16)<<16)&4294967295;for(;f<m.length;++f)g+=374761393*m[f],g=g<<11|g>>>21,g=2654435761*(g&65535)+(2654435761*(g>>>16)<<16)&4294967295;g^=g>>>15;g=(2246822519*(g&65535)&4294967295)+(2246822519*(g>>>16)<<16);g^=g>>>13;g=(3266489917*(g&65535)&4294967295)+(3266489917*(g>>>16)<<16);g^=g>>>16;return 0>g?
g+4294967296:g};return b._createClass(n)}();a.XXH=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/handleUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa,ia,na,ba,ea,ja,ka,da,ha,ca,fa,ma,qa,wa,xa,pa,ra,va,Ba,Aa,Ha,Ka){var Pa;const Ra=R.create(),Sa=J.create(),La=B.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Pa=function(Ma){function fb(oa){var ua=ya.call(this,oa);ua._propertiesPool=new qa.PropertiesPool({computedExtent:va},b._assertThisInitialized(ua));ua.computedExtent=null;ua.currentRenderer=null;ua.rendererHasGeometryOperations=
!1;ua._graphicStateTracking=null;ua.graphics3DGraphics=new Map;ua.stageLayer=null;ua.stage=null;ua._graphicsDrapedUids=new Set;ua._graphicsBySymbol=new Map;ua._symbolConversionCache=new Map;ua._symbols=new Map;ua._graphicsWithoutSymbol=new Map;ua._graphicsWaitingForSymbol=new Map;ua._graphicsUpdateId=0;ua._handles=new q;ua._frameTask=ra.ImmediateTask;ua._suspendSymbolCleanup=!1;ua._arcadeOnDemand=null;ua._rendererChangeAbortController=null;ua._elevationInfoChangeAbortController=null;ua._initializeAbortController=
null;ua._scaleVisibility=null;ua._filterVisibility=null;ua._spatialIndex=null;ua.extentPadding=0;ua._updatingPendingLoadedGraphicsChange=null;ua._featureStore=null;ua._deconflictor=null;ua._labeler=null;ua._objectStates=null;ua._viewElevationProvider=null;ua._stageLayerElevationProvider=null;ua._sharedSymbolResourcesOwnerHandle=null;ua._whenGraphics3DGraphicRequests={};ua._pendingUpdates=new Map;ua._numberOfGraphics=0;ua._numberOfGraphicsProvidingElevation=0;ua._pendingAdds=0;ua._pendingRemoves=0;
ua._applyPendingRemovesFirst=!1;ua._loadingSymbols=0;ua._pendingUpdatesPool=new v({allocator:Da=>Da||new Za,deallocator:Da=>{Da.clear();return Da}});ua._symbolWarningLogged=!1;ua._geometryWarningLogged=!1;ua._objectIdInvisibleSet=new Set;ua._whenSymbolRemoved=new v;ua.preferredUpdatePolicy=xa.UpdatePolicy.SYNC;ua._forcedUpdatePolicy=null;ua.elevationFeatureExpressionEnabled=!0;ua.owner=null;ua.layer=null;ua.graphicSymbolSupported=!0;ua.getRenderingInfoWithoutRenderer=!1;ua.setUidToIdOnAdd=!0;ua.hasZ=
null;ua.hasM=null;ua._usedMemory=0;ua._visible=!1;ua._startCreateGraphics=!1;ua.symbolCreationContext=new ia.Graphics3DSymbolCreationContext(oa.owner.view.resourceController.scheduler,(Da,Ia)=>ua._frameTask.schedule(Da,Ia));return ua}b._inherits(fb,Ma);var ya=b._createSuper(fb);Ma=fb.prototype;Ma._getConvertedSymbol=function(oa){if("web-style"===oa.type)return oa.clone();var ua=this._symbolConversionCache.get(oa.id);if(z.isSome(ua))return ua;ua=V.to3D(oa,{geometryType:this.layer?.geometryType??void 0,
retainId:!0,hasLabelingContext:this._hasLabelingContext(oa)});const Da=ua.symbol||null;z.isNone(Da)&&ua.error&&La.error(ua.error.message);this._symbolConversionCache.set(oa.id,Da);return Da};Ma._getSymbolComplexitiesUsedOrRenderer=function(oa){if(z.isNone(oa))return[];var ua=oa.getSymbols(),Da="backgroundFillSymbol"in oa?oa.backgroundFillSymbol:null;if(!(Da||ua&&ua.length))return[];oa=[];Da=this._getSymbolComplexityUsedOrRenderer(Da);z.isSome(Da)&&oa.push(Da);for(const Ia of ua)ua=this._getSymbolComplexityUsedOrRenderer(Ia),
z.isSome(ua)&&oa.push(ua);return oa};Ma._getSymbolComplexityUsedOrRenderer=function(oa){if(z.isNone(oa))return null;const ua=this._symbols.get(oa.id);if(z.isSome(ua))return ua.complexity;oa=this._getConvertedSymbol(oa);return z.isSome(oa)?ca.defaultSymbolComplexity(oa):null};Ma._getSymbolComplexitiesUsed=function(){const oa=[];this._symbols.forEach(ua=>{z.isSome(ua)&&oa.push(ua.complexity)});return oa};Ma.initialize=function(){this._featureStore=new Y.Graphics3DFeatureStore({objectIdField:this.owner.layer&&
this.owner.layer.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Da=>this.graphics3DGraphics.forEach(Da)});const oa=(Da,Ia,Na)=>this.spatialIndex.queryGraphicUIDsInExtent(Da,Ia,Na),{componentFactories:ua}=this;z.isSome(ua.elevationAlignment)&&(this._elevationAlignment=ua.elevationAlignment(this,oa));z.isSome(ua.scaleVisibility)&&(this._scaleVisibility=
ua.scaleVisibility(this,oa));z.isSome(ua.filterVisibility)&&(this._filterVisibility=ua.filterVisibility({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Da=>this.modifyGraphics3DGraphicVisibilities(Ia=>Ia.setVisibilityFlag(X.VisibilityFlag.FILTER,Da(U.getObjectId(Ia.graphic,this._objectIdField)),X.VisibilityGroup.GRAPHIC)),setAllFeaturesVisibility:Da=>this.modifyGraphics3DGraphicVisibilities(Ia=>Ia.setVisibilityFlag(X.VisibilityFlag.FILTER,
Da,X.VisibilityGroup.GRAPHIC)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(Da=>Da.clearVisibilityFlag(X.VisibilityFlag.FILTER))}));z.isSome(ua.deconflictor)&&(this._deconflictor=ua.deconflictor(this));z.isSome(ua.labeler)&&z.isSome(this._scaleVisibility)&&(this._labeler=ua.labeler(this,this._scaleVisibility));z.isSome(ua.objectStates)&&(this._objectStates=ua.objectStates(this));this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()};
Ma._initializeAsync=async function(){const oa=this._initializeAbortController?.signal,ua=this.owner.view;this._viewElevationProvider=new T.ViewElevationProvider(this._viewSpatialReference,ua);this._initializeStage(ua,this.layer.uid);var Da=ua.sharedSymbolResources;this.symbolCreationContext.sharedResources=Da;this._sharedSymbolResourcesOwnerHandle=Da.addGraphicsOwner(this.owner);z.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=
this.stage;this.symbolCreationContext.streamDataRequester=Da.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=ua.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new wa.GridLocalOriginFactory(ua.renderSpatialReference);this.symbolCreationContext.elevationProvider=ua.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Ia=>this.notifyGraphicGeometryChanged(Ia);
this.symbolCreationContext.notifyGraphicVisibilityChanged=Ia=>this.notifyGraphicVisibilityChanged(Ia);Da=Z.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await Z.createContext(Da,this._viewSpatialReference,oa,La);A.throwIfAborted(oa);this.symbolCreationContext.screenSizePerspectiveEnabled=ua.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=
!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Ia}=this;this.symbolCreationContext.drapeSourceRenderer=ua.basemapTerrain.overlayManager.registerGeometryDrapeSource(Ia);this._handles.add(y.makeHandle(()=>ua.basemapTerrain.overlayManager.unregisterDrapeSource(Ia)))}this._handles.add([t.watch(()=>
this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),t.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view.screenSizePerspectiveEnabled],()=>{const Ia=ua.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;Ia!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Ia,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),t.watch(()=>this.owner.slicePlaneEnabled,
Ia=>this._slicePlaneEnabledChange(!!Ia)),t.watch(()=>this.owner.view.state?.rasterPixelRatio,()=>this._pixelRatioChange()),t.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,Ia=>this._physicalBasedRenderingChange(Ia)),t.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Ia=>this._skipHighSymbolLoDsChange(Ia)),t.when(()=>ua.basemapTerrain?.tilingScheme,Ia=>{!Ia.spatialReference.equals(this.symbolCreationContext.overlaySR)&&z.isSome(ua.basemapTerrain.spatialReference)&&
(this.symbolCreationContext.overlaySR=ua.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([t.on(()=>this.owner?.loadedGraphics,"change",Na=>{this._graphicsCollectionChanged(Na);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),t.watch(()=>this.effectiveUpdatePolicy,Ia=>{z.isSome(this.stageLayer)&&
(this.stageLayer.updatePolicy=Ia);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===xa.UpdatePolicy.ASYNC;Ia===xa.UpdatePolicy.SYNC&&this.runTask(ra.noBudget)},t.syncAndInitial)]);this._frameTask=ua.resourceController.scheduler.registerTask(ra.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this._handles.add(t.watch(()=>this.layer.featureReduction,()=>this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>
{});this._initializeAbortController=null};Ma._abortInitialize=function(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=null)};Ma.destroy=function(){this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTask.remove();this._frameTask=ra.ImmediateTask;this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._elevationAlignment=z.destroyMaybe(this._elevationAlignment);
this._scaleVisibility=z.destroyMaybe(this._scaleVisibility);this._filterVisibility=z.destroyMaybe(this._filterVisibility);this._labeler=this._deconflictor=null;this._objectStates=z.destroyMaybe(this._objectStates);this.clear();this._featureStore=z.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=z.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=z.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stage.remove(this.stageLayer),this.stage=
this.stageLayer=null);this._handles=z.destroyMaybe(this._handles);this._set("owner",null);for(const oa in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[oa].reject(new r("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=z.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=z.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();
this._objectIdInvisibleSet.clear();this._spatialIndex=z.destroyMaybe(this._spatialIndex)};Ma.clear=function(){this._objectStates?.allGraphicsDeleted();z.isSome(this._graphicStateTracking)&&this._graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(oa=>oa.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(z.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();
this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1;this.notifyChange("updating");this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")};Ma._initializeStage=function(oa,ua){this.stage=oa._stage;this.stageLayer=new pa.WebGLLayer({pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},
ua);this.stage.add(this.stageLayer);oa=this.stageLayer.events;oa.on("objectTransformation",Da=>this.notifyGraphicGeometryChanged(Da.metadata.graphicUid));oa.on("visibilityChanged",Da=>this.notifyGraphicVisibilityChanged(Da.metadata.graphicUid));oa.on("objectGeometryAdded",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid));oa.on("objectGeometryRemoved",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid));oa.on("objectGeometryUpdated",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid))};
Ma.notifyGraphicGeometryChanged=function(oa){z.isNone(this._graphicStateTracking)||z.isNone(oa)||(oa=this.graphics3DGraphics.get(oa))&&this._graphicStateTracking.updateGraphicGeometry(oa)};Ma.notifyGraphicVisibilityChanged=function(oa){z.isNone(this._graphicStateTracking)||z.isNone(oa)||(oa=this.graphics3DGraphics.get(oa))&&this._graphicStateTracking.updateGraphicVisibility(oa)};Ma._updateLayerVisibility=function(){var oa=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;
oa=!this.suspendedOrOutsideOfView&&!oa;oa!==this._visible&&((this._visible=oa)?(this.stageLayer.pickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())};Ma._updateStageLayerVisibility=function(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Ma.getGraphics3DGraphicById=function(oa){return null!=oa?this.graphics3DGraphics.get(oa):void 0};Ma.getGraphics3DGraphicByObjectId=function(oa){return this.owner.layer?.objectIdField?
this._findGraphics3DGraphicByObjectId(oa):null};Ma._getGraphicObjectID=function(oa,ua=this.owner.layer&&this.owner.layer.objectIdField){return U.getObjectId(oa,ua)};Ma.updateLabelingInfo=async function(oa){const ua=this._deconflictor&&this._deconflictor.labelingInfoChange(oa);oa=this._labeler&&this._labeler.labelingInfoChange(oa);await A.eachAlways([ua,oa])};Ma.updateVisibilityInfo=function(){this._deconflictor&&this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()};
Ma.runTask=function(oa){this._frameTask.processQueue(oa);this._applyPendingUpdates(oa);this.notifyChange("running");this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining");if(!oa.hasProgressed)return ra.Task.YIELD};Ma.setObjectIdVisibility=function(oa,ua){ua?this._objectIdInvisibleSet.delete(oa):this._objectIdInvisibleSet.add(oa);oa=this._findGraphics3DGraphicByObjectId(oa);z.isSome(oa)&&this._updateUserVisibility(oa)};Ma._findGraphics3DGraphicByObjectId=function(oa){return D.findInMap(this.graphics3DGraphics,
ua=>this._getGraphicObjectID(ua.graphic)===oa)};Ma._updateUserVisibility=function(oa){if(z.isNone(oa))return!1;var ua=oa.graphic;const Da=this._getGraphicObjectID(ua);ua=ua.visible&&!this.owner.suspended&&(z.isNone(Da)||!this._objectIdInvisibleSet.has(Da));return oa.setVisibilityFlag(X.VisibilityFlag.USER_SETTING,ua,X.VisibilityGroup.GRAPHIC)};Ma._whenGraphics3DGraphic=function(oa){var ua=this.graphics3DGraphics.get(oa.uid);if(ua)return Promise.resolve(ua);if(ua=this._whenGraphics3DGraphicRequests[oa.uid])return ua.promise;
ua=A.createDeferred();this._whenGraphics3DGraphicRequests[oa.uid]=ua;return ua.promise};Ma._boundsForGraphics3DGraphic=async function(oa,ua){const Da=this._viewSpatialReference,Ia=this.owner.view.renderSpatialReference,Na=this.owner.view.basemapTerrain.spatialReference;var ab=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:z.isSome(ua)?!!ua.useViewElevation:!1,minDemResolution:z.isSome(ua)?ua.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:
null;oa=await oa.getProjectedBoundingBox((cb,hb,ib)=>O.projectBuffer(cb,Ia,hb,cb,Da,hb,ib),(cb,hb,ib)=>O.projectBuffer(cb,Na,hb,cb,Da,hb,ib),ab,z.get(ua,"signal"));if(!oa)return null;ua=oa.boundingBox;oa.requiresDrapedElevation&&(ab=this.symbolCreationContext.elevationProvider)&&(J.center(ua,Ra),ab=z.unwrapOr(ab.getElevation(Ra[0],Ra[1],0,Da,"ground"),0),ua[2]=Math.min(ua[2],ab),ua[5]=Math.max(ua[5],ab));return{boundingBox:ua,screenSpaceObjects:oa.screenSpaceObjects}};Ma.whenGraphicBounds=async function(oa,
ua){await t.whenOnce(()=>this.owner?.loadedGraphics);const Da=this.owner.layer&&this.owner.layer.objectIdField;var Ia=this.owner.loadedGraphics.find(Na=>Na===oa?!0:null!=Da&&null!=Na.attributes&&oa.attributes&&Na.attributes[Da]===oa.attributes[Da]);if(!Ia)throw new r("internal:graphic-not-part-of-view","Graphic is not part of this view");Ia=await this._whenGraphics3DGraphic(Ia);return this._boundsForGraphics3DGraphic(Ia,ua)};Ma.computeAttachmentOrigin=function(oa,ua){oa=this.graphics3DGraphics.get(oa.uid);
if(!oa)return null;var Da=oa.computeAttachmentOrigin();if(0===Da.render.num&&0===Da.draped.num)return null;L.set(Xa,0,0,0);oa=0;if(0<Da.render.num){if(!O.projectVectorToVector(Da.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,la,ua))return null;L.add(Xa,Xa,la);oa++}if(0<Da.draped.num){const [Ia,Na]=Da.draped.origin;Da=z.unwrapOr(this._viewElevationProvider.getElevation(Ia,Na,"ground"),0);L.set(la,Ia,Na,Da);if(!O.projectVectorToVector(la,this._viewElevationProvider.spatialReference,
la,ua))return null;L.add(Xa,Xa,la);oa++}1<oa&&L.scale(Xa,Xa,1/oa);return new Ba({x:Xa[0],y:Xa[1],z:Xa[2],spatialReference:ua})};Ma.getSymbolLayerSize=function(oa,ua){var Da=this._symbols.get(oa.id);if(z.isNone(Da))throw new r("internal:symbol-not-part-of-view","Symbol is not part of this view");oa=oa.symbolLayers.indexOf(ua);if(-1===oa)throw new r("internal:missing-symbol-layer","Symbol layer is not in symbol");Da=Da.getSymbolLayerSize(oa);if(z.isNone(Da))throw new r("internal:missing-size","Symbol layer has no valid size");
return Da};Ma._graphicsCollectionChanged=function(oa){this._startCreateGraphics&&(this.add(oa.added),this.remove(oa.removed))};Ma.graphicUpdateHandler=function(oa){const ua=oa.graphic.uid,Da=this.graphics3DGraphics.get(ua);if(!z.isNone(Da)||!z.isNone(this._graphicsWithoutSymbol.get(ua)))switch(oa.property){case "visible":this._graphicUpdateVisibleHandler(Da);break;case "geometry":this._graphicUpdateGeometryHandler(Da,oa);break;case "symbol":this._graphicUpdateSymbolHandler(Da,oa);break;case "transform":this._graphicUpdateTransformHandler(Da,
oa)}};Ma._graphicUpdateGeometryHandler=function(oa,ua){const Da=ua.graphic.geometry;if(z.isNone(Da))this._recreateGraphic(ua.graphic);else if(z.isNone(oa)){if(oa=ua.graphic.symbol&&ua.graphic.symbol.id)if(oa=this._symbols.get(oa),z.isSome(oa)&&oa.loadStatus===da.LoadStatus.LOADING)return;this._recreateGraphic(ua.graphic)}else{var Ia=oa.graphics3DSymbol;!z.isNone(ua.newValue)&&Ia.updateGeometry(oa,ua.newValue)||this._recreateGraphic(oa.graphic);this._expandComputedExtent(Da)}};Ma._graphicUpdateSymbolHandler=
function(oa,ua){var Da=ua.graphic;const Ia=z.isSome(oa)?oa.graphics3DSymbol:z.isSome(ua.oldValue)?this._symbols.get(ua.oldValue.id):null;if(z.isNone(Ia)||z.isNone(ua.newValue))this._recreateGraphic(Da);else{var Na=Ia.symbol;ua=this._getConvertedSymbol(ua.newValue);if(z.isSome(ua)&&(ua.type!==Na.type||"web-style"===ua.type)||"web-style"===Na.type)this._recreateGraphic(Da);else{var ab=this._graphicsBySymbol.get(Na.id);if(ab&&1!==ab.size)this._recreateGraphic(Da);else if(ab=I.diff(Na,ua),z.isNone(ab))this._updateSymbolMapping(Na.id,
ua);else if(ab={diff:ab,graphics3DGraphicPatches:[],symbolStatePatches:[]},Ia.prepareSymbolPatch(ab),I.isEmpty(ab.diff)){var cb=this._getRenderingInfo(Da);if(z.isNone(cb))this._recreateGraphic(Da);else{Da=Ia.extentPadding;for(const hb of ab.symbolStatePatches)hb();Da!==Ia.extentPadding&&this._recomputeExtentPadding();if(z.isSome(oa))for(const hb of ab.graphics3DGraphicPatches)hb(oa,cb);this._updateSymbolMapping(Na.id,ua)}}else this._recreateGraphic(Da)}}};Ma._graphicUpdateVisibleHandler=function(oa){this._updateUserVisibility(oa)&&
(this._labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Ma._graphicUpdateTransformHandler=function(oa,ua){};Ma.recreateGraphics=function(oa){this._suspendSymbolCleanup=!0;this.remove(oa);this.add(oa);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===xa.UpdatePolicy.SYNC&&this._cleanupSymbols()};Ma._recreateGraphic=function(oa){this.recreateGraphics([oa])};Ma._beginGraphicUpdate=function(oa){const ua=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(oa.uid,
ua);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("updating");return ua};Ma._endGraphicUpdate=function(oa){oa&&(this._graphicsWaitingForSymbol.delete(oa.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Ma._recomputeExtentPadding=function(){let oa=0;this._symbols.forEach(ua=>{z.isSome(ua)&&(oa=Math.max(oa,ua.extentPadding))});this._set("extentPadding",oa)};Ma._expandComputedExtent=function(oa){var ua=oa.spatialReference;U.computeAABB(oa,
Sa);oa=this._viewSpatialReference;var Da=Pa.tmpVec;!G.equals(ua,oa)&&O.projectXYZToVector(Sa[0],Sa[1],0,ua,Da,oa)&&(Sa[0]=Da[0],Sa[1]=Da[1],O.projectXYZToVector(Sa[3],Sa[4],0,ua,Da,oa),Sa[3]=Da[0],Sa[4]=Da[1]);if(isFinite(Sa[0])&&isFinite(Sa[3])&&isFinite(Sa[1])&&isFinite(Sa[4])){ua=this.computedExtent;Da=null;var Ia=isFinite(Sa[2])&&isFinite(Sa[5]),Na=Ia&&(!ua||null==ua.zmin||Sa[2]<ua.zmin);Ia=Ia&&(!ua||null==ua.zmax||Sa[5]>ua.zmax);if(ua){if(Sa[0]<ua.xmin||Sa[1]<ua.ymin||Sa[3]>ua.xmax||Sa[4]>ua.ymax||
Na||Ia)Da=this._propertiesPool.get("computedExtent"),Da.xmin=Math.min(Sa[0],ua.xmin),Da.ymin=Math.min(Sa[1],ua.ymin),Da.xmax=Math.max(Sa[3],ua.xmax),Da.ymax=Math.max(Sa[4],ua.ymax),Da.spatialReference=oa}else Da=this._propertiesPool.get("computedExtent"),Da.xmin=Sa[0],Da.ymin=Sa[1],Da.xmax=Sa[3],Da.ymax=Sa[4],Da.spatialReference=oa;Da&&(Na&&(Da.zmin=Sa[2]),Ia&&(Da.zmax=Sa[5]),this._set("computedExtent",Da))}};Ma._abortElevationInfoChange=function(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),
this._elevationInfoChangeAbortController=null)};Ma.elevationInfoChange=async function(){this._abortElevationInfoChange();const oa=new AbortController;this._elevationInfoChangeAbortController=oa;const ua=Z.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await Z.createContext(ua,this._viewSpatialReference,oa.signal,La);A.throwIfAborted(oa.signal);this._elevationInfoChangeAbortController=null;this._labeler?.elevationInfoChange();
this.forEachGraphics3DSymbol((Da,Ia,Na)=>{Da.globalPropertyChanged("elevationInfo",Ia)?Ia.forEach(ab=>{const cb=ab.graphic;ab=ab.labelLayers;for(const hb of ab)hb.graphics3DSymbolLayer.updateGraphicElevationContext(cb,hb)}):this._recreateSymbol(Na)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()};Ma.updateStageLayerElevationProvider=function(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||
0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=z.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new fa.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),
this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))};Ma._clearSymbolsAndGraphics=function(){this.clear();z.isSome(this._filterVisibility)&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=z.disposeMaybe(this._stageLayerElevationProvider))};
Ma.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Ma.recreateAllGraphics=function(){this._recreateAllGraphics(!1)};Ma.recreateAllGraphicsAndSymbols=function(){this._recreateAllGraphics(!0)};Ma._recreateAllGraphics=function(oa=!1){if(this._startCreateGraphics){var {loadedGraphics:ua,view:Da}=this.owner,Ia=Da.basemapTerrain.tilingScheme&&ua&&ua.length?ua.toArray():null;!oa&&Ia||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=
this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Ia&&(oa?this.add(Ia):this.recreateGraphics(Ia))}};Ma._recreateSymbol=function(oa){var ua=this._graphicsBySymbol.get(oa);const Da=[];ua&&(ua.forEach((Ia,Na)=>{const ab=Ia.usedMemory;this._conditionalRemove(Ia,Na);this._spatialIndex?.remove(Ia);Da.push(Ia.graphic);Ia.destroy();this._removeGraphics3DGraphic(Na,
ab);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(oa,new Map));ua=this._symbols.get(oa);z.destroyMaybe(ua);this._symbols.delete(oa);this.add(Da)};Ma._recreateGraphicsForSymbol=function(oa){if(oa=this._graphicsBySymbol.get(oa)){const ua=[];oa.forEach(Da=>ua.push(Da.graphic));this.recreateGraphics(ua)}};Ma._conditionalRemove=function(oa,ua){this._graphicsDrapedUids.delete(ua);this._objectStates?.removeGraphic(oa);this._labeler?.removeGraphic(oa);
this._deconflictor?.removeGraphic(oa);z.isSome(this._graphicStateTracking)&&this._graphicStateTracking.removeGraphic(oa)};Ma.add=function(oa){oa&&0!==oa.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(oa)===xa.UpdatePolicy.ASYNC?this._addDelayed(oa):this._addImmediate(oa),this.notifyChange("updating")):La.error("#add()","Cannot add graphics before terrain surface has been initialized"))};Ma._updatePolicyForGraphics=function(oa){if(this.effectiveUpdatePolicy===
xa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const ua of oa)if(z.isSome(ua.geometry)&&"mesh"===ua.geometry.type&&!ua.geometry.loaded)return xa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy};Ma._addImmediate=function(oa){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const ua of oa)this._addGraphic(ua,this._getRenderingInfo(ua,La),xa.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());
this.owner.view.deconflictor.setDirty()};Ma._addDelayed=function(oa){for(const ua of oa){oa=ua.uid;let Da=this._pendingUpdates.get(oa);Da?Da.add?Da.state!==Ua.NEW&&Da.abortController?.abort():this._pendingAdds++:(Da=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(oa,Da));Da.add=ua}this.notifyChange("running");this.notifyChange("updatingRemaining")};Ma.remove=function(oa){this.effectiveUpdatePolicy===xa.UpdatePolicy.ASYNC?this._removeDelayed(oa):this._removeImmediate(oa);
this.notifyChange("updating")};Ma._removeImmediate=function(oa){for(const ua of oa)this._removeGraphic(ua);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Ma._removeDelayed=function(oa){for(const Da of oa){oa=Da.uid;var ua=this._pendingUpdates.get(oa);ua?ua.add&&(ua.remove?ua.add=null:this._pendingUpdates.delete(oa),ua.state===Ua.LOADING&&ua.abortController?.abort(),this._pendingAdds--):(ua=this._pendingUpdatesPool.pushNew(),ua.remove=
Da,this._pendingUpdates.set(oa,ua),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};Ma._finishPendingUpdates=function(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&La.warn("pendingAdds/Removes in inconsistent state!");this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1};Ma._applyPendingUpdates=
function(oa){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),oa.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [ua,Da]of this._pendingUpdates){if(oa.done){this._applyPendingRemovesFirst=!0;break}if(Da.remove&&!Da.add&&(this._pendingRemoves--,oa.madeProgress(),this._removeGraphic(Da.remove),Da.remove=null,this._pendingUpdates.delete(ua),0===this._pendingRemoves))break}}for(const [ua,
Da]of this._pendingUpdates){if(oa.done)break;Da.add&&Da.state===Ua.NEW&&this._processPendingUpdateNew(Da);let Ia=this.effectiveUpdatePolicy;!Da.remove||Da.add&&Da.state!==Ua.READY||(this._pendingRemoves--,oa.madeProgress(),this._removeGraphic(Da.remove),Da.remove=null,Ia=xa.UpdatePolicy.SYNC);if(Da.add)switch(Da.state){case Ua.READY:this._addGraphic(Da.add,Da.renderingInfo,Ia);Da.add=null;this._pendingAdds--;oa.madeProgress();break;case Ua.REJECTED:Da.add=null,this._pendingAdds--}null==Da.remove&&
null==Da.add&&this._pendingUpdates.delete(ua)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};Ma._processPendingUpdateNew=function(oa){if(oa.add){var ua=oa.add.geometry;z.isSome(ua)&&"mesh"===ua.type&&!ua.loaded?this._processPendingUpdateNewMesh(oa,ua):this._processPendingUpdateNewRenderingInfo(oa)}else oa.state=Ua.READY};Ma._processPendingUpdateNewMesh=async function(oa,ua){oa.state=Ua.LOADING;oa.abortController=new AbortController;const Da=oa.abortController.signal;
try{await ua.load({signal:Da})}catch(Ia){return this._processPendingUpdateNewError(oa,Ia)}oa.abortController=null;this._processPendingUpdateNewRenderingInfo(oa)};Ma._processPendingUpdateNewError=function(oa,ua){oa.abortController=null;A.isAbortError(ua)?oa.state=Ua.NEW:oa.state=Ua.REJECTED};Ma._processPendingUpdateNewRenderingInfo=async function(oa){if(z.isNone(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)oa.renderingInfo=this._getRenderingInfo(oa.add,La);else{oa.state=Ua.LOADING;
oa.abortController=new AbortController;var ua=null;try{ua=await this._getRenderingInfoAsync(oa.add,{signal:oa.abortController.signal})}catch(Da){oa.abortController=null;A.isAbortError(Da)?oa.state=Ua.NEW:oa.state=Ua.REJECTED;return}z.isNone(ua)||z.isNone(ua.symbol)?(La&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,La.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),oa.renderingInfo=null):oa.renderingInfo=ua}oa.state=Ua.READY};Ma._addGraphic=function(oa,ua,
Da){this._graphicsWithoutSymbol.set(oa.uid,oa);if(!z.isNone(ua)&&!z.isNone(ua.symbol)&&U.hasGeometry(oa)){z.isSome(this.stage.renderView.objectAndLayerIdRenderHelper)&&this.setUidToIdOnAdd&&this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(oa.objectId,oa.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled);var Ia=this.getOrCreateGraphics3DSymbol(ua.symbol,ua.renderer);if(!z.isNone(Ia)){this._expandComputedExtent(oa.geometry);var Na=this._beginGraphicUpdate(oa),ab=
new aa(oa,ua,this.layer),cb=!1,hb=pb=>{pb===Ia.symbol.id&&(cb=!0)};this._whenSymbolRemoved.push(hb);var ib=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(hb);if(this._graphicsWaitingForSymbol.get(oa.uid)!==Na||cb||Ia.destroyed||this.graphicSymbolSupported&&oa.symbol&&oa.symbol.id!==Ia.symbol.id)--Ia.referenced,this._cleanupSymbols();else{const pb=this._createGraphics3DGraphic(Ia,ab);this._spatialIndex&&z.isSome(pb)&&this._spatialIndex.add(pb);--Ia.referenced;
this._endGraphicUpdate(oa)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},qb=pb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(hb),cb||(A.isAbortError(pb)?this.add([oa]):Ia.destroyed||this._endGraphicUpdate(oa)))};++this._loadingSymbols;Da===xa.UpdatePolicy.ASYNC?Ia.load(()=>this._frameTask.schedule(ib),pb=>this._frameTask.schedule(()=>qb(pb))):Ia.load(ib,qb)}}};Ma._removeGraphic=function(oa){oa=oa.uid;const ua=this.graphics3DGraphics.get(oa);
if(ua){ua.graphics3DSymbol.onRemoveGraphic(ua);const Da=ua.usedMemory,Ia=ua.isElevationSource;this._conditionalRemove(ua,oa);this._spatialIndex?.remove(ua);this._graphicsBySymbol.get(ua.graphics3DSymbol.symbol.id)?.delete(oa);this._graphicsWithoutSymbol.delete(oa);this._removeGraphics3DGraphic(oa,Da,Ia);ua.destroy();this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(oa),this._graphicsWaitingForSymbol.delete(oa),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),
this.notifyChange("updating"))};Ma._hasLabelingContext=function(oa){if(oa instanceof Aa||oa instanceof Ha){const ua=this.symbolCreationContext.layer;return ua.labelingInfo?ua.labelingInfo.some(Da=>Da.symbol===oa):!1}return!1};Ma._hasValidSymbolCreationContext=function(oa){return oa instanceof Aa&&!this._hasLabelingContext(oa)?(La.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Ma._getRenderingInfo=function(oa,ua){const Da=
oa.geometry;if(z.isNone(Da))return ua&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,ua.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!O.canProjectWithoutEngine(Da.spatialReference,this._viewSpatialReference))return ua&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,ua.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&z.isSome(oa.symbol))return ua&&
!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ua.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;oa=this.rendererHasGeometryOperations?N.hydrateGraphic(oa,this.layer):oa;oa=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||z.isSome(this.currentRenderer))?this.owner.getRenderingInfo(oa,this.currentRenderer,this._arcadeOnDemand):{symbol:oa.symbol||W.getDefaultSymbol3D(oa.geometry)};return z.isNone(oa)||z.isNone(oa.symbol)?
(ua&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ua.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):oa};Ma._getRenderingInfoAsync=function(oa,ua){if(z.isNone(oa.geometry))return La&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,La.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&z.isSome(oa.symbol))return La&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,
La.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;oa=this.rendererHasGeometryOperations?N.hydrateGraphic(oa,this.layer):oa;return this.owner.getRenderingInfoAsync(oa,this.currentRenderer,this._arcadeOnDemand,ua)};Ma._createGraphics3DSymbol=function(oa,ua){if(!this._hasValidSymbolCreationContext(oa))return null;oa=this._getConvertedSymbol(oa);if(!oa)return null;let Da;z.isSome(ua)&&"backgroundFillSymbol"in ua&&ua.backgroundFillSymbol&&(ua=V.to3D(ua.backgroundFillSymbol,
{ignoreDrivers:!0}),z.isSome(ua.symbol)&&"web-style"!==ua.symbol.type&&"cim"!==ua.symbol.type&&(Da=ua.symbol.symbolLayers));const Ia=na.make(oa,this.symbolCreationContext,Da);Ia.load(()=>{const Na=Ia.extentPadding;Na>this.extentPadding&&this._set("extentPadding",Na);this.notifyChange("averageSymbolComplexity")},()=>{});return Ia};Ma.getOrCreateGraphics3DSymbol=function(oa,ua){let Da=this._symbols.get(oa.id);void 0===Da&&(Da=oa instanceof Ka?new ba(oa,Ia=>this._frameTask.schedule(Ia),Ia=>this._createGraphics3DSymbol(Ia,
ua)):this._createGraphics3DSymbol(oa,ua),this._symbols.set(oa.id,Da));z.isSome(Da)&&++Da.referenced;return Da};Ma.trackGraphicState=function(oa){z.isNone(this._graphicStateTracking)&&(this._graphicStateTracking=new ea.GraphicStateTracking(this));return this._graphicStateTracking.add(oa)};Ma._addGraphics3DGraphic=function(oa){this._usedMemory+=oa.usedMemory;this.graphics3DGraphics.set(oa.graphic.uid,oa);this._numberOfGraphics++;oa.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());
this._updateLayerVisibility()};Ma._removeGraphics3DGraphic=function(oa,ua,Da=!1){this._usedMemory-=ua;this.graphics3DGraphics.delete(oa);this._numberOfGraphics--;Da&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Ma._createGraphics3DGraphic=function(oa,ua){const Da=ua.graphic;this._graphicsWithoutSymbol.delete(Da.uid);if(!this._symbols.has(oa.symbol.id))return this.add([Da]),null;if(this.graphics3DGraphics.has(Da.uid))return null;
ua=oa.createGraphics3DGraphic(ua);if(z.isNone(ua))return null;this._addGraphics3DGraphic(ua);oa=oa.symbol.id;this._graphicsBySymbol.has(oa)||this._graphicsBySymbol.set(oa,new Map);this._graphicsBySymbol.get(oa).set(Da.uid,ua);ua.isDraped&&this._graphicsDrapedUids.add(Da.uid);ua.centroid=null;z.isSome(Da.geometry)&&"point"!==Da.geometry.type&&(ua.centroid=ja.computeCentroid(Da.geometry,this._viewSpatialReference));this._updateUserVisibility(ua);z.isSome(this._scaleVisibility)&&this._scaleVisibility.updateVisibility(ua);
z.isSome(this._filterVisibility)&&({defaultVisibility:oa}=this._filterVisibility,ua.setVisibilityFlag(X.VisibilityFlag.FILTER,oa,X.VisibilityGroup.GRAPHIC),oa||this._filterVisibility.reapply());this._deconflictor?.addGraphic(ua);this._labeler?.addGraphic(ua);this._objectStates?.addGraphic(ua);this._deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ua);ua.initialize(this.stage,this.stageLayer,this.owner);z.isSome(this._graphicStateTracking)&&this._graphicStateTracking.addGraphic(ua);
if(oa=this._whenGraphics3DGraphicRequests[Da.uid])delete this._whenGraphics3DGraphicRequests[Da.uid],oa.resolve(ua);return ua};Ma._abortRendererChange=function(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)};Ma.rendererChange=async function(oa){this._abortRendererChange();if(oa!==this.currentRenderer)if(this._validateRenderer(oa),z.isNone(oa)&&this._currentRendererChange(null,!1),S.isSupportedRenderer3D(oa))if(z.isSome(oa)&&
oa.arcadeRequired){var ua=new AbortController;this._rendererChangeAbortController=ua;const {arcadeUtils:Da}=await this._ensureArcade();A.throwIfAborted(ua);const Ia=Da.hasGeometryOperations(oa);Ia&&(await Da.enableGeometryOperations(),A.throwIfAborted(ua));this.effectiveUpdatePolicy===xa.UpdatePolicy.ASYNC?await this._frameTask.schedule(()=>this._currentRendererChange(oa,Ia),ua.signal):this._currentRendererChange(oa,Ia);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===xa.UpdatePolicy.ASYNC?
(this._rendererChangeAbortController=ua=new AbortController,await this._frameTask.schedule(()=>this._currentRendererChange(oa,!1),ua.signal),this._rendererChangeAbortController=null):this._currentRendererChange(oa,!1);else this._currentRendererChange(oa,!1)};Ma._ensureArcade=async function(){z.isNone(this._arcadeOnDemand)&&(this._arcadeOnDemand=await Q.loadArcade());return this._arcadeOnDemand};Ma._currentRendererChange=function(oa,ua){this.currentRenderer=oa;this.rendererHasGeometryOperations=ua;
this.symbolCreationContext.arcade=z.unwrap(this._arcadeOnDemand);ua=this.symbolCreationContext.renderer;if(oa!==ua)if(this._symbolConversionCache.clear(),z.isNone(oa))this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Da=I.diff(ua,oa);this._updateUnchangedSymbolMappings(Da,oa,ua);this.symbolCreationContext.renderer=oa;z.isNone(Da)||("complete"===Da.type?this.recreateAllGraphicsAndSymbols():"partial"===Da.type&&(this._applyRendererDiff(Da,oa,ua)?this._volatileGraphicsUpdated():
this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}};Ma._diffHasSymbolChange=function(oa){for(const ua in oa.diff)switch(ua){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete oa.diff[ua];break;default:return!0}return!1};Ma._applySymbolSetDiff=function(oa,ua,Da){oa=oa||[];ua=ua||[];const Ia=[];for(const Na of ua){const ab=this._graphicsBySymbol.get(Na.id);ab&&ab.forEach((cb,
hb)=>{var ib=cb.graphic,qb=this.layer instanceof P?this.layer:null;const pb=z.unwrap(this._arcadeOnDemand);if(Na!==Da.defaultSymbol||Da.getSymbol(N.hydrateGraphic(ib,qb),{arcade:pb})!==Da.defaultSymbol)qb=cb.usedMemory,oa.length||Da.defaultSymbol?Ia.push(ib):this._graphicsWithoutSymbol.set(hb,ib),ib=this.graphics3DGraphics.get(hb),this._conditionalRemove(ib,hb),cb.destroy(),ab.delete(hb),this._removeGraphics3DGraphic(hb,qb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(cb=>cb(Na.id))}if(oa.length||
Ia.length)this._graphicsWithoutSymbol.forEach(Na=>Ia.push(Na)),this._graphicsWithoutSymbol.clear(),this.add(Ia);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Ma._applyUniqueValueRendererDiff=function(oa,ua,Da){const Ia=oa.diff.defaultSymbol,Na=oa.diff.uniqueValueInfos;if(Ia||Na){const ab=Na?Na.added.map(hb=>hb.symbol).filter(z.isSome):[],cb=Na?Na.removed.map(hb=>hb.symbol).filter(z.isSome):[];if(Na)for(let hb=0;hb<Na.changed.length;hb++)ab.push(Na.changed[hb].newValue.symbol),
cb.push(Na.changed[hb].oldValue.symbol);Ia?(Da.defaultSymbol&&cb.push(Da.defaultSymbol),ua.defaultSymbol&&ab.push(ua.defaultSymbol)):Da.defaultSymbol&&ab.length&&cb.push(ua.defaultSymbol);this._applySymbolSetDiff(ab,cb,ua);delete oa.diff.defaultSymbol;delete oa.diff.uniqueValueInfos;return!0}return!1};Ma._calculateUnchangedSymbolMapping=function(oa,ua,Da){if("unique-value"!==ua?.type||"unique-value"!==Da?.type||z.isSome(oa)&&"partial"!==oa.type)return[];const Ia=ab=>z.isSome(ab)?ab.id:null;var Na=
oa&&oa.diff;oa=Na&&Na.defaultSymbol;if(Na=Na&&Na.uniqueValueInfos)Na=Na.unchanged.map(ab=>({oldId:Ia(ab.oldValue.symbol),newId:Ia(ab.newValue.symbol)}));else{Na=[];for(const ab of Da.uniqueValueInfos??[]){const cb=Ia(ab.symbol),hb=ua.uniqueValueInfos?.find(ib=>ib.value===ab.value);hb&&cb!==Ia(hb.symbol)&&Na.push({oldId:cb,newId:Ia(hb.symbol)})}}!oa&&Da.defaultSymbol&&Na.push({oldId:Ia(Da.defaultSymbol),newId:Ia(ua.defaultSymbol)});return Na};Ma._updateSymbolMapping=function(oa,ua){const Da=z.isSome(ua)&&
ua?"string"===typeof ua?ua:ua.id:null;if(!z.isNone(oa)&&oa!==Da){var Ia=this._graphicsBySymbol.get(oa);this._graphicsBySymbol.delete(oa);void 0!==Ia&&this._graphicsBySymbol.set(Da,Ia);Ia=this._symbols.get(oa);void 0!==Ia&&(this._symbols.delete(oa),this._symbols.set(Da,Ia),z.isSome(Ia)&&(oa="string"===typeof ua?null:ua,z.isSome(oa)?Ia.symbol=oa:Ia.symbol.id=Da))}};Ma._updateUnchangedSymbolMappings=function(oa,ua,Da){oa=this._calculateUnchangedSymbolMapping(oa,ua,Da);for(const {oldId:Ia,newId:Na}of oa)this._updateSymbolMapping(Ia,
Na)};Ma._applyRendererDiff=function(oa,ua,Da){if(this._diffHasSymbolChange(oa))return!1;if(ua instanceof e&&Da instanceof e&&this._applyUniqueValueRendererDiff(oa,ua,Da)&&0===Object.keys(oa.diff).length)return!0;for(const [Ia]of this._graphicsBySymbol)if(Da=this._symbols.get(Ia),z.isSome(Da))switch(Da.applyRendererDiff(oa,ua)){case ka.ApplyRendererDiffResult.Recreate_Symbol:this._recreateSymbol(Ia);break;case ka.ApplyRendererDiffResult.Recreate_Graphics:this._recreateGraphicsForSymbol(Ia)}return!0};
Ma.opacityChange=function(){this.forEachGraphics3DSymbol((oa,ua)=>oa.globalPropertyChanged("opacity",ua));this._updateStageLayerVisibility()};Ma._slicePlaneEnabledChange=function(oa){oa!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=oa,this.stageLayer.sliceable=oa,this.forEachGraphics3DSymbol((ua,Da)=>ua.globalPropertyChanged("slicePlaneEnabled",Da)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),this._labeler&&this._labeler.slicePlaneEnabledChange())};
Ma._physicalBasedRenderingChange=function(oa){this.symbolCreationContext.physicalBasedRenderingEnabled=oa;this.forEachGraphics3DSymbol((ua,Da,Ia)=>{ua.globalPropertyChanged("physicalBasedRenderingEnabled",Da)||this._recreateSymbol(Ia)})};Ma._skipHighSymbolLoDsChange=function(oa){this.symbolCreationContext.skipHighSymbolLods=oa;this.forEachGraphics3DSymbol((ua,Da,Ia)=>{ua.globalPropertyChanged("skipHighSymbolLods",Da)||this._recreateSymbol(Ia)})};Ma._pixelRatioChange=function(){this.forEachGraphics3DSymbol((oa,
ua,Da)=>{oa.globalPropertyChanged("pixelRatio",ua)||this._recreateSymbol(Da)})};Ma._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=C.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};Ma.setClippingExtent=function(oa,ua){const Da=this.symbolCreationContext.clippingExtent,Ia=M.create();ma.toBoundingRect(oa,Ia,ua)?this.symbolCreationContext.clippingExtent=
J.fromRect(J.create(),Ia):this.symbolCreationContext.clippingExtent=null;return!J.equals(this.symbolCreationContext.clippingExtent,Da)};Ma.modifyGraphics3DGraphicVisibilities=function(oa){let ua=!1;this.graphics3DGraphics.forEach(Da=>{oa(Da)&&(ua=!0)});ua&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor.setDirty())};Ma.forEachGraphics3DSymbol=function(oa){for(const [ua,Da]of this._symbols){if(z.isNone(Da))break;const Ia=this._graphicsBySymbol.get(ua);oa(Da,Ia||Ta,ua)}};Ma.updateAllGraphicsVisibility=
function(){z.isSome(this._filterVisibility)&&this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(oa=>{const ua=this._updateUserVisibility(oa);oa=z.isSome(this._scaleVisibility)&&this._scaleVisibility.updateVisibility(oa);return ua||oa})};Ma._hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(oa=>oa.setVisibilityFlag(X.VisibilityFlag.USER_SETTING,!1,X.VisibilityGroup.GRAPHIC))};Ma._validateRenderer=function(oa){(oa=S.validateTo3D(oa,{geometryType:this.layer?.geometryType}))&&
La.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,oa.message)};Ma._volatileGraphicsUpdated=function(){this._labeler?.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};Ma._cleanupSymbols=function(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var oa=!1;this._symbols.forEach((ua,Da)=>{if(!(z.isNone(ua)||0<ua.referenced)){var Ia=this._graphicsBySymbol.get(Da);
Ia&&0!==Ia.size||(this._graphicsBySymbol.delete(Da),this._symbols.delete(Da),z.destroyMaybe(ua),oa=!0)}});oa&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};b._createClass(fb,[{key:"_viewSpatialReference",get:function(){return this.owner.view.spatialReference}},{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new ha.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),
this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}},{key:"numberOfGraphics",get:function(){return this._numberOfGraphics}},{key:"effectiveUpdatePolicy",get:function(){return z.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?xa.UpdatePolicy.ASYNC:z.unwrapOr(this._forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"featureStore",get:function(){return this._featureStore}},{key:"initializePromise",get:function(){return this._initializePromise}},
{key:"scaleVisibility",get:function(){return this._scaleVisibility}},{key:"elevationAlignment",get:function(){return this._elevationAlignment}},{key:"objectStates",get:function(){return this._objectStates}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"updating",get:function(){return!!(0<this._graphicsWaitingForSymbol.size||this.running||this._elevationAlignment?.updating||z.isSome(this._scaleVisibility)&&this._scaleVisibility.updating||z.isSome(this._filterVisibility)&&
this._filterVisibility.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||0<this._loadingSymbols)}},{key:"running",get:function(){return 0<this._pendingUpdates.size||!!this._spatialIndex?.updating}},{key:"suspendedOrOutsideOfView",get:function(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}},{key:"updatingRemaining",get:function(){return this.updating?this._pendingUpdates.size+
.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}},{key:"displayFeatureLimit",get:function(){var oa=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const ua=oa?oa.graphics3D.minTotalNumberOfFeatures:0,Da=oa?oa.graphics3D.maxTotalNumberOfFeatures:0;oa=oa?oa.graphics3D.maxTotalNumberOfPrimitives:0;const Ia=this.averageSymbolComplexity;var Na=Math.max(1,z.isSome(Ia)?Ia.primitivesPerFeature:1),ab=z.isSome(Ia)&&0<Ia.drawCallsPerFeature?Da/
Ia.drawCallsPerFeature*.3:Da;Na=Math.max(ua,Math.min(Da,Math.ceil(oa/Na),ab));return(ab=this._get("displayFeatureLimit"))&&ab.minimumTotalNumberOfFeatures===ua&&ab.maximumTotalNumberOfFeatures===Da&&ab.maximumTotalNumberOfPrimitives===oa&&ab.averageSymbolComplexity===Ia&&ab.maximumNumberOfFeatures===Na?ab:{minimumTotalNumberOfFeatures:ua,maximumTotalNumberOfFeatures:Da,maximumTotalNumberOfPrimitives:oa,averageSymbolComplexity:Ia,maximumNumberOfFeatures:Na}}},{key:"averageSymbolComplexity",get:function(){const oa=
ca.averageSymbolComplexities(this._symbolComplexities),ua=this._get("averageSymbolComplexity");return 0===oa.numComplexities||z.isSome(ua)&&(oa.estimated&&(ua.primitivesPerFeature>=oa.primitivesPerFeature||ua.primitivesPerCoordinate>=oa.primitivesPerCoordinate||ua.drawCallsPerFeature>=oa.drawCallsPerFeature)||ua.primitivesPerFeature===oa.primitivesPerFeature&&ua.primitivesPerCoordinate===oa.primitivesPerCoordinate&&ua.drawCallsPerFeature===oa.drawCallsPerFeature)?ua:oa}},{key:"usedMemory",get:function(){const oa=
z.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,ua=this._getSymbolComplexitiesUsed().reduce((Da,Ia)=>Da+Ia.memory.resourceBytes,0);return this._usedMemory+oa+ua}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):z.isSome(this.averageSymbolComplexity)?
this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}},{key:"_symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},{key:"visible",get:function(){return this._visible}},{key:"_objectIdField",
get:function(){return this.layer.objectIdField}},{key:"graphics3DGraphicsByObjectID",get:function(){const oa=this.owner.layer&&this.owner.layer.objectIdField;if(oa){var ua=new Map;this.graphics3DGraphics.forEach(Da=>{if(Da){var Ia=this._getGraphicObjectID(Da.graphic,oa);z.isSome(Ia)&&ua.set(Ia,Da)}});return ua}}},{key:"labelsEnabled",get:function(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this._pendingUpdates.size)return"unknown";let oa=
0,ua=0;return D.someMap(this._symbols,(Da,Ia)=>{if(z.isSome(Da)){Da=Da.getFastUpdateStatus();if(0<Da.loading)return!0;this._graphicsBySymbol.has(Ia)&&(ua+=Da.fast,oa+=Da.slow)}return!1})?"unknown":0<=ua&&0===oa?"fast":0<=oa&&0===ua?"slow":"mixed"}},{key:"test",get:function(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(oa=>({symbolId:oa,graphics:[...this._graphicsBySymbol.get(oa).keys()].sort()})),
graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:oa=>{this._forcedUpdatePolicy=oa}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this._graphicsWithoutSymbol.size,pending:this._pendingUpdates.size}}}]);return fb}(p);a.Graphics3DCore.tmpVec=
R.create();c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);c.__decorate([E.property()],a.Graphics3DCore.prototype,
"_rendererChangeAbortController",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_elevationInfoChangeAbortController",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);c.__decorate([E.property()],
a.Graphics3DCore.prototype,"_initializePromise",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);c.__decorate([E.property()],
a.Graphics3DCore.prototype,"_labeler",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_objectStates",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);c.__decorate([E.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);c.__decorate([E.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"componentFactories",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"setUidToIdOnAdd",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"featureStore",null);c.__decorate([E.property()],a.Graphics3DCore.prototype,"initializePromise",null);c.__decorate([E.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);c.__decorate([E.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);c.__decorate([E.property()],
a.Graphics3DCore.prototype,"objectStates",null);c.__decorate([E.property()],a.Graphics3DCore.prototype,"filterVisibility",null);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);c.__decorate([E.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);
c.__decorate([E.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);c.__decorate([E.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);c.__decorate([E.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"hasM",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_objectIdField",null);a.Graphics3DCore=Pa=c.__decorate([K.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var Ua;(function(Ma){Ma[Ma.NEW=0]="NEW";Ma[Ma.LOADING=1]="LOADING";Ma[Ma.READY=2]="READY";Ma[Ma.REJECTED=3]="REJECTED"})(Ua||(Ua={}));let Za=function(){function Ma(){this.renderingInfo=this.add=null;this.state=Ua.NEW;this.remove=this.abortController=null}Ma.prototype.clear=
function(){this.renderingInfo=this.add=null;this.state=Ua.NEW;this.remove=this.abortController=null};return b._createClass(Ma)}();const Xa=R.create(),la=R.create(),Ta=new Map;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,b,c,w,n){function x(f){return w.isNone(f)||"simple"===f.type||"unique-value"===f.type||
"class-breaks"===f.type||"dictionary"===f.type||"heatmap"===f.type}function m(f,d){if(!d)return null;d=Array.isArray(d)?d:[d];if(0<d.length){const e=d.map(u=>u.details.symbol.type||u.details.symbol.declaredClass).filter(u=>!!u);e.sort();const k=[];e.forEach((u,p)=>{0!==p&&u===e[p-1]||k.push(u)});return new c("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${k.join(", ")}) which are not supported in 3D`,{renderer:f,symbolErrors:d})}return null}function l(f,d){const e={...n.defaultTo3DOptions,
...d};d=f.uniqueValueInfos?.map(u=>n.to3D(u.symbol,e).error).filter(w.isSome);const k=n.to3D(f.defaultSymbol,e);k.error&&d?.unshift(k.error);return m(f,d)}function g(f){const d=f.classBreakInfos.map(k=>n.to3D(k.symbol).error).filter(w.isSome),e=n.to3D(f.defaultSymbol);e.error&&d.unshift(e.error);return m(f,d)}a.isSupportedRenderer3D=x;a.validateTo3D=function(f,d){if(w.isNone(f))return null;if(!x(f))return new c("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${f.type||
f.declaredClass}'`,{renderer:f});switch(f.type){case "simple":return m(f,n.to3D(f.symbol).error);case "unique-value":return l(f,d);case "class-breaks":return g(f)}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,c,w,n,
x,m,l,g,f,d){const e=m.fromSimpleMarkerSymbol(f.defaultPointSymbol2D),k=n.fromSimpleLineSymbol(f.defaultPolylineSymbol2D),u=l.fromSimpleFillSymbol(f.defaultPolygonSymbol2D),p=new x({symbolLayers:[new w({material:{color:d.defaultColor},edges:new g({size:"1px",color:d.defaultOutlineColor})})]});a.getDefaultSymbol3D=function(h){if(c.isNone(h))return null;switch(h.type){case "mesh":return p;case "point":case "multipoint":return e;case "polyline":return k;case "polygon":case "extent":return u}return null};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){const q=k.create();a.Graphics3DFeatureStore=function(B){function D(v){var A=z.call(this,v);A.events=new n;A.hasZ=null;A.hasM=null;A.objectIdField=null;A.featureAdapter={getAttribute(t,C){return"graphic"in t?t.graphic.attributes[C]:r.optimizedFeatureQueryEngineAdapter.getAttribute(t,C)},getAttributes(t){return"graphic"in t?t.graphic.attributes:r.optimizedFeatureQueryEngineAdapter.getAttributes(t)},getObjectId:t=>"graphic"in t?u.getObjectId(t.graphic,A.objectIdField)??
void 0:r.optimizedFeatureQueryEngineAdapter.getObjectId(t),getGeometry:t=>"graphic"in t?t.getAsOptimizedGeometry(A.hasZ,A.hasM):r.optimizedFeatureQueryEngineAdapter.getGeometry(t),getCentroid:(t,C)=>{if("graphic"in t){let E=null;x.isSome(t.centroid)?E=t.centroid:"point"===t.graphic.geometry.type&&e.projectPoint(t.graphic.geometry,y,A.viewSpatialReference)&&(E=y);t=Array(2+(C.hasZ?1:0)+(C.hasM?1:0));x.isNone(E)?(t[0]=0,t[1]=0,t[2]=0,t[3]=0):(t[0]=E.x,t[1]=E.y,C.hasZ&&(t[2]=E.hasZ?E.z:0),C.hasM&&(t[C.hasZ?
3:2]=E.hasM?E.m:0));return new h([],t)}return r.optimizedFeatureQueryEngineAdapter.getCentroid(t,C)},cloneWithGeometry:(t,C)=>"graphic"in t?new p.OptimizedFeature(C,A.featureAdapter.getAttributes(t),null,A.featureAdapter.getObjectId(t)):r.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(t,C)};return A}b._inherits(D,B);var z=b._createSuper(D);B=D.prototype;B.forEachInBounds=function(v,A){this.getSpatialIndex().forEachInBounds(v,A)};B.forEachBounds=function(v,A){const t=this.getSpatialIndex();for(const C of v)v=
this.featureAdapter.getObjectId(C),x.isSome(t.getBounds(v,q))&&A(q)};return b._createClass(D)}(w);c.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);c.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);c.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);c.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);c.__decorate([m.property({constructOnly:!0})],
a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);c.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);c.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=c.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const y={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../../../core/maybe","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,c,w,n){a.optimizedFeatureQueryEngineAdapter={getObjectId(x){return x.objectId},getAttributes(x){return x.attributes},getAttribute(x,m){return x.attributes[m]},cloneWithGeometry(x,m){return new w.OptimizedFeature(m,x.attributes,null,x.objectId)},getGeometry(x){return x.geometry},
getCentroid(x,m){b.isNone(x.centroid)&&(x.centroid=c.getCentroidOptimizedGeometry(new n,x.geometry,m.hasZ,m.hasM));return x.centroid}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports","../../core/maybe"],function(a,b){function c(n,x,m,l,g,f,d=1){f=g?f?4:3:f?3:2;let e=m,k=m+f,u=0,p=0,h=m=0,r=0;for(let q=0,y=l-1;q<y;q++,e+=f,k+=f){l=x[e];const B=x[e+1],D=x[e+2],z=x[k],v=x[k+1],A=x[k+2];let t=l*v-z*B;h+=t;u+=(l+z)*t;p+=(B+v)*
t;g&&(t=l*A-z*D,m+=(D+A)*t,r+=t);l<n[0]&&(n[0]=l);l>n[1]&&(n[1]=l);B<n[2]&&(n[2]=B);B>n[3]&&(n[3]=B);g&&(D<n[4]&&(n[4]=D),D>n[5]&&(n[5]=D))}0<h*d&&(h*=-1);0<r*d&&(r*=-1);if(!h)return null;n=[u,p,.5*h];g&&(n[3]=m,n[4]=.5*r);return n}function w(n,x,m,l,g){g=l?g?4:3:g?3:2;let f=x,d=x+g,e=0,k=0,u=0,p=0;for(let y=0,B=m-1;y<B;y++,f+=g,d+=g){var h=n[f];const D=n[f+1],z=n[f+2],v=n[d],A=n[d+1],t=n[d+2];if(l){var r=v-h;var q=A-D;const C=t-z;r=Math.sqrt(r*r+q*q+C*C)}else r=v-h,q=A-D,r=Math.sqrt(r*r+q*q);r&&
(e+=r,l?(h=[h+.5*(v-h),D+.5*(A-D),z+.5*(t-z)],k+=r*h[0],u+=r*h[1],p+=r*h[2]):(h=[h+.5*(v-h),D+.5*(A-D)],k+=r*h[0],u+=r*h[1]))}return 0<e?l?[k/e,u/e,p/e]:[k/e,u/e]:0<m?l?[n[x],n[x+1],n[x+2]]:[n[x],n[x+1]]:null}a.getCentroidOptimizedGeometry=function(n,x,m,l,g){if(b.isNone(x)||!x.lengths.length)return null;const f="upperLeft"===g?.originPosition?-1:1;n.lengths.length&&(n.lengths.length=0);n.coords.length&&(n.coords.length=0);g=n.coords;const d=[],e=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:k,coords:u}=x,p=m?l?4:3:l?3:2;let h=0;for(var r of k){const q=c(e,u,h,r,m,l,f);q&&d.push(q);h+=r*p}d.sort((q,y)=>{let B=f*q[2]-f*y[2];0===B&&m&&(B=q[4]-y[4]);return B});d.length&&(r=6*d[0][2],g[0]=d[0][0]/r,g[1]=d[0][1]/r,m&&(r=6*d[0][4],g[2]=0!==r?d[0][3]/r:0),g[0]<e[0]||g[0]>e[1]||g[1]<
e[2]||g[1]>e[3]||m&&(g[2]<e[4]||g[2]>e[5]))&&(g.length=0);if(!g.length)if(x=x.lengths[0]?w(u,0,k[0],m,l):null)g[0]=x[0],g[1]=x[1],m&&2<x.length&&(g[2]=x[2]);else return null;return n};a.lineCentroid=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(w,n){this.scheduler=w;this.schedule=n;this.featureExpressionInfoContext=
this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1});b=b._createClass(function(){});a.Graphics3DSymbolCreationContext=c;a.Graphics3DSymbolLayerCreationContext=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,c){a.make=function(w,n,x){switch(w.type){case "point-3d":return new b(w,n,x);default:return new c(w,n,x)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),
function(a,b,c,w,n,x,m){return function(l){function g(d,e,k){d=f.call(this,d,e,k);d._calloutSymbolLayer=null;d.symbol.hasVisibleCallout()&&(d._calloutSymbolLayer=n.make(d.symbol,e));return d}a._inherits(g,l);var f=a._createSuper(g);l=g.prototype;l.doLoad=async function(d){const e=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{await a._get(a._getPrototypeOf(g.prototype),"doLoad",this).call(this,d),w.throwIfAborted(d)}catch(k){throw this._calloutSymbolLayer?.abortLoad(),
k;}e&&await e};l.destroy=function(){a._get(a._getPrototypeOf(g.prototype),"destroy",this).call(this);this._calloutSymbolLayer=c.destroyMaybe(this._calloutSymbolLayer)};l.createGraphics3DGraphic=function(d,e){e=a._get(a._getPrototypeOf(g.prototype),"createGraphics3DGraphic",this).call(this,d,e);c.isSome(this._calloutSymbolLayer)&&c.isSome(e)&&(d=this._createCalloutGraphic(d),c.isSome(d)&&e.addAuxiliaryGraphic(d));return e};l.globalPropertyChanged=function(d,e){return a._get(a._getPrototypeOf(g.prototype),
"globalPropertyChanged",this).call(this,d,e)?this._calloutSymbolLayer?this._calloutSymbolLayer.globalPropertyChanged(d,e,k=>this._getCalloutGraphicLayer(k)):!0:!1};l.updateGeometry=function(d,e){const k=a._get(a._getPrototypeOf(g.prototype),"updateGeometry",this).call(this,d,e);return k&&this._calloutSymbolLayer&&(d=this._getCalloutGraphicLayer(d))?this._calloutSymbolLayer.updateGeometry(d,e):k};l._createCalloutGraphic=function(d){const e=d.renderingInfo;d.renderingInfo=new x.LineCalloutSymbolLayerRenderingInfo(e.renderer,
e.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(d)};l._getCalloutGraphicLayer=function(d){for(const e of d._auxiliaryLayers)if(e.graphics3DSymbolLayer===this._calloutSymbolLayer)return e};return a._createClass(g)}(m)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,b,c,w,n){let x=function(){function m(g){this._graphicsCore=
g;this._idToState=new Map;this._states=new Set;const f=g.owner.layer&&g.owner.layer.objectIdField;f?(this._getGraphicId=d=>n.getObjectId(d,f),this._getGraphics3DGraphicById=d=>this._graphicsCore.getGraphics3DGraphicByObjectId(d)):(this._getGraphicId=d=>d.uid,this._getGraphics3DGraphicById=d=>this._graphicsCore.getGraphics3DGraphicById(d))}var l=m.prototype;l.destroy=function(){this._idToState.clear();this._states.forEach((g,f)=>this.remove(f))};l.add=function(g){const f={remove:()=>this.remove(g)};
if(this._states.has(g))return f;const d=this._getGraphicId(g.graphic),e=this._getGraphics3DGraphicById(d);this._states.has(g)||this._states.add(g);this._ensureStateList(d).push(g);g.displaying=w.isSome(e)?e.isVisible():!1;g.isDraped=w.isSome(e)?e.isDraped:!1;g.tracking=!0;w.isSome(e)&&g.emit("changed");return f};l.remove=function(g){if(this._states.has(g)){if(this._idToState.size){const f=this._getGraphicId(g.graphic),d=this._idToState.get(f);d&&(c.remove(d,g),0===d.length&&this._idToState.delete(f))}this._states.delete(g);
g.tracking=!1;g.displaying=!1}};l.addGraphic=function(g){this._forEachState(g,f=>{f.displaying=g.isVisible();f.isDraped=g.isDraped;f.emit("changed")})};l.removeGraphic=function(g){this._forEachState(g,f=>{f.displaying=!1;f.isDraped=!1})};l.updateGraphicGeometry=function(g){this._forEachState(g,f=>f.emit("changed"))};l.updateGraphicVisibility=function(g){this._forEachState(g,f=>f.displaying=g.isVisible())};l.allGraphicsDeleted=function(){this._states.forEach(g=>{g.displaying=!1})};l._ensureStateList=
function(g){var f=this._idToState.get(g);if(f)return f;f=[];this._idToState.set(g,f);return f};l._forEachState=function(g,f){0!==this._states.size&&0!==this._idToState.size&&(g=this._getGraphicId(g.graphic),g=this._idToState.get(g),null!=g&&g.forEach(f))};return b._createClass(m)}();a.GraphicStateTracking=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){a.SpatialIndex2D=function(p){function h(q){q=r.call(this,q);q._index=new d.PooledRBush(9,n("esri-csp-restrictions")?y=>({minX:y.extent[0],minY:y.extent[1],maxX:y.extent[2],maxY:y.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);q._missing=new Set;q._boundsByFeature=new Map;q.spatialReference=null;q.hasZ=null;q.hasM=null;q.objectIdField=null;q.updating=!1;return q}b._inherits(h,p);var r=b._createSuper(h);p=h.prototype;p.setup=function(q){this._addMany(q)};
p.destroy=function(){this._missing.clear();this._index=x.destroyMaybe(this._index);this._boundsByFeature.clear();this._boundsByFeature=null};p.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};p.queryGraphicUIDsInExtent=function(q,y,B){!x.isNone(y)&&y.equals(this.spatialReference)&&(u.minX=q[0],u.minY=q[1],u.maxX=q[2],u.maxY=q[3],this.update(),this._index.search(u,D=>B(D.graphic.uid)))};p.add=function(q){this._missing.add(q);
this.updating=!0};p.remove=function(q){this._missing.delete(q)?this.updating=0<this._missing.size:(this._index.remove(q),q=k.getObjectId(q.graphic,this._get("objectIdField")),null!=q&&this._boundsByFeature.delete(q))};p._addMany=function(q){if(0!==q.length){var y=this._get("objectIdField");for(const B of q){B.computeExtent(this.spatialReference);const D=k.getObjectId(B.graphic,y);null!=D&&this._boundsByFeature.set(D,B.extent)}this._index.load(q)}};p.clear=function(){this._index.clear();this._missing.clear();
this._boundsByFeature.clear();this.updating=!1};p.forEachInBounds=function(q,y){u.minX=q[0];u.minY=q[1];u.maxX=q[2];u.maxY=q[3];this.update();this._index.search(u,B=>{y(B)})};p.getBounds=function(q,y){this.update();return(q=this._boundsByFeature.get(q))?e.fromRect(y,q):null};b._createClass(h,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return h}(w);c.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);c.__decorate([m.property({constructOnly:!0})],
a.SpatialIndex2D.prototype,"hasZ",void 0);c.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);c.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);c.__decorate([m.property()],a.SpatialIndex2D.prototype,"updating",void 0);c.__decorate([m.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=c.__decorate([f.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);
const u={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,b,c,w,n,x){function m(t,C){l(t,0,t.children.length,C,t)}function l(t,C,E,F,H){H||(H=new v([]));H.minX=Infinity;H.minY=Infinity;H.maxX=-Infinity;H.maxY=-Infinity;for(let K=C,I;K<E;K++)I=t.children[K],
g(H,t.leaf?F(I):I);return H}function g(t,C){t.minX=Math.min(t.minX,C.minX);t.minY=Math.min(t.minY,C.minY);t.maxX=Math.max(t.maxX,C.maxX);t.maxY=Math.max(t.maxY,C.maxY)}function f(t,C){return t.minX-C.minX}function d(t,C){return t.minY-C.minY}function e(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function k(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,C){return t.minX<=C.minX&&t.minY<=C.minY&&C.maxX<=t.maxX&&C.maxY<=t.maxY}function p(t,C){return C.minX<=t.maxX&&C.minY<=t.maxY&&C.maxX>=t.minX&&
C.maxY>=t.minY}function h(t,C,E,F,H){for(C=[C,E];C.length;){E=w.assumeNonNull(C.pop());const K=w.assumeNonNull(C.pop());if(E-K<=F)continue;const I=K+Math.ceil((E-K)/F/2)*F;x.quickselect(t,I,K,E,H);C.push(K,I,I,E)}}let r=function(){function t(E=9,F){this._compareMinX=f;this._compareMinY=d;this._toBBox=H=>H;this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));F&&("function"===typeof F?this._toBBox=F:this._initFormat(F));this.clear()}var C=t.prototype;C.destroy=
function(){this.clear();q.prune();y.prune();B.prune();D.prune()};C.all=function(E){this._all(this._data,E)};C.search=function(E,F){let H=this._data;const K=this._toBBox;if(p(E,H))for(q.clear();H;){for(let I=0,L=H.children.length;I<L;I++){const R=H.children[I],O=H.leaf?K(R):R;p(E,O)&&(H.leaf?F(R):u(E,O)?this._all(R,F):q.push(R))}H=q.pop()}};C.collides=function(E){let F=this._data;const H=this._toBBox;if(!p(E,F))return!1;for(q.clear();F;){for(let K=0,I=F.children.length;K<I;K++){const L=F.children[K],
R=F.leaf?H(L):L;if(p(E,R)){if(F.leaf||u(E,R))return!0;q.push(L)}}F=q.pop()}return!1};C.load=function(E){if(!E.length)return this;if(E.length<this._minEntries){for(let F=0,H=E.length;F<H;F++)this.insert(E[F]);return this}E=this._build(E.slice(0,E.length),0,E.length-1,0);if(this._data.children.length)if(this._data.height===E.height)this._splitRoot(this._data,E);else{if(this._data.height<E.height){const F=this._data;this._data=E;E=F}this._insert(E,this._data.height-E.height-1,!0)}else this._data=E;return this};
C.insert=function(E){E&&this._insert(E,this._data.height-1);return this};C.clear=function(){this._data=new v([]);return this};C.remove=function(E){if(!E)return this;let F=this._data,H=null,K=0,I=!1,L;const R=this._toBBox(E);B.clear();for(D.clear();F||0<B.length;){F||(F=w.assumeNonNull(B.pop()),H=B.data[B.length-1],K=D.pop()??0,I=!0);if(F.leaf&&(L=c.indexOf(F.children,E,F.children.length,F.indexHint),-1!==L)){F.children.splice(L,1);B.push(F);this._condense(B);break}I||F.leaf||!u(F,R)?H?(K++,F=H.children[K],
I=!1):F=null:(B.push(F),D.push(K),K=0,H=F,F=F.children[0])}return this};C.toJSON=function(){return this._data};C.fromJSON=function(E){this._data=E;return this};C._all=function(E,F){for(y.clear();E;){if(!0===E.leaf)for(const H of E.children)F(H);else y.pushArray(E.children);E=y.pop()??null}};C._build=function(E,F,H,K){var I=H-F+1,L=this._maxEntries;if(I<=L)return E=new v(E.slice(F,H+1)),m(E,this._toBBox),E;K||(K=Math.ceil(Math.log(I)/Math.log(L)),L=Math.ceil(I/L**(K-1)));const R=new A([]);R.height=
K;I=Math.ceil(I/L);L=I*Math.ceil(Math.sqrt(L));for(h(E,F,H,L,this._compareMinX);F<=H;F+=L){const O=Math.min(F+L-1,H);h(E,F,O,I,this._compareMinY);for(let J=F;J<=O;J+=I)R.children.push(this._build(E,J,Math.min(J+I-1,O),K-1))}m(R,this._toBBox);return R};C._chooseSubtree=function(E,F,H,K){for(;;){K.push(F);if(!0===F.leaf||K.length-1===H)break;let I=Infinity,L=Infinity,R=void 0;for(let O=0,J=F.children.length;O<J;O++){const M=F.children[O],G=e(M),P=(Math.max(M.maxX,E.maxX)-Math.min(M.minX,E.minX))*(Math.max(M.maxY,
E.maxY)-Math.min(M.minY,E.minY))-G;P<L?(L=P,I=G<I?G:I,R=M):P===L&&G<I&&(I=G,R=M)}F=R||F.children[0]}return F};C._insert=function(E,F,H){var K=this._toBBox;H=H?E:K(E);B.clear();K=this._chooseSubtree(H,this._data,F,B);K.children.push(E);for(g(K,H);0<=F;)if(B.data[F].children.length>this._maxEntries)this._split(B,F),F--;else break;this._adjustParentBBoxes(H,B,F)};C._split=function(E,F){const H=E.data[F];var K=H.children.length;const I=this._minEntries;this._chooseSplitAxis(H,I,K);(K=this._chooseSplitIndex(H,
I,K))?(K=H.children.splice(K,H.children.length-K),K=H.leaf?new v(K):new A(K),K.height=H.height,m(H,this._toBBox),m(K,this._toBBox),F?E.data[F-1].children.push(K):this._splitRoot(H,K)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};C._splitRoot=function(E,F){this._data=new A([E,F]);this._data.height=E.height+1;m(this._data,this._toBBox)};C._chooseSplitIndex=function(E,F,H){let K,I,L=void 0;K=I=Infinity;for(let O=F;O<=H-F;O++){var R=l(E,0,O,this._toBBox);const J=
l(E,O,H,this._toBBox),M=Math.max(0,Math.min(R.maxX,J.maxX)-Math.max(R.minX,J.minX))*Math.max(0,Math.min(R.maxY,J.maxY)-Math.max(R.minY,J.minY));R=e(R)+e(J);M<K?(K=M,L=O,I=R<I?R:I):M===K&&R<I&&(I=R,L=O)}return L};C._chooseSplitAxis=function(E,F,H){const K=E.leaf?this._compareMinX:f,I=E.leaf?this._compareMinY:d,L=this._allDistMargin(E,F,H,K);F=this._allDistMargin(E,F,H,I);L<F&&E.children.sort(K)};C._allDistMargin=function(E,F,H,K){E.children.sort(K);K=this._toBBox;var I=l(E,0,F,K);const L=l(E,H-F,H,
K);let R=k(I)+k(L);for(let O=F;O<H-F;O++){const J=E.children[O];g(I,E.leaf?K(J):J);R+=k(I)}for(H=H-F-1;H>=F;H--)I=E.children[H],g(L,E.leaf?K(I):I),R+=k(L);return R};C._adjustParentBBoxes=function(E,F,H){for(;0<=H;H--)g(F.data[H],E)};C._condense=function(E){for(let F=E.length-1;0<=F;F--){const H=E.data[F];if(0===H.children.length)if(0<F){const K=E.data[F-1],I=K.children;I.splice(c.indexOf(I,H,I.length,K.indexHint),1)}else this.clear();else m(H,this._toBBox)}};C._initFormat=function(E){const F=["return a",
" - b",";"];this._compareMinX=new Function("a","b",F.join(E[0]));this._compareMinY=new Function("a","b",F.join(E[1]));this._toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return b._createClass(t)}();const q=new n,y=new n,B=new n,D=new n({deallocator:void 0});n=b._createClass(function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity});let z=function(t){function C(){var F=E.apply(this,arguments);F.height=1;F.indexHint=new c.PositionHint;
return F}b._inherits(C,t);var E=b._createSuper(C);return b._createClass(C)}(n),v=function(t){function C(F){var H=E.call(this);H.children=F;H.leaf=!0;return H}b._inherits(C,t);var E=b._createSuper(C);return b._createClass(C)}(z),A=function(t){function C(F){var H=E.call(this);H.children=F;H.leaf=!1;return H}b._inherits(C,t);var E=b._createSuper(C);return b._createClass(C)}(z);a.BBox=n;a.PooledRBush=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],
function(a){var b={};(function(c){(function(w){w=w();void 0!==w&&(c.exports=w)})(function(){function w(m,l,g,f,d){for(;f>g;){if(600<f-g){var e=f-g+1,k=l-g+1,u=Math.log(e),p=.5*Math.exp(2*u/3);u=.5*Math.sqrt(u*p*(e-p)/e)*(0>k-e/2?-1:1);w(m,l,Math.max(g,Math.floor(l-k*p/e+u)),Math.min(f,Math.floor(l+(e-k)*p/e+u)),d)}e=m[l];k=g;p=f;n(m,g,l);for(0<d(m[f],e)&&n(m,g,f);k<p;){n(m,k,p);k++;for(p--;0>d(m[k],e);)k++;for(;0<d(m[p],e);)p--}0===d(m[g],e)?n(m,g,p):(p++,n(m,p,f));p<=l&&(g=p+1);l<=p&&(f=p-1)}}function n(m,
l,g){var f=m[l];m[l]=m[g];m[g]=f}function x(m,l){return m<l?-1:m>l?1:0}return function(m,l,g,f,d){w(m,l,g||0,f||m.length-1,d||x)}})})({get exports(){return b},set exports(c){b=c}});a.quickselect=b})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D){a.StageLayerElevationProvider=function(F){function H(I){I=K.call(this,I);I._elevationOffset=0;I._layerHandes=new x;return I}b._inherits(H,F);var K=b._createSuper(H);F=H.prototype;F.initialize=function(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=B.newIntersector(this.view.state.viewingMode);this._intersector.options.store=D.StoreResults.MIN;var I=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=I[2];this._zmax=I[5];I=this.stageLayer.events;this._layerHandes.add([I.on("layerObjectAdded",L=>this._objectChanged(L.object)),I.on("layerObjectRemoved",L=>this._objectChanged(L.object)),I.on("objectGeometryAdded",L=>this._objectChanged(L.object)),I.on("objectGeometryRemoved",L=>this._objectChanged(L.object)),I.on("objectGeometryUpdated",L=>this._objectChanged(L.object)),I.on("objectTransformation",L=>this._objectChanged(L))])};F.dispose=function(){this._layerHandes.destroy()};
F.elevationInfoChanged=function(){const I=null!=this.layer?this.layer.elevationInfo:null;if(null!=I&&"on-the-ground"!==I.mode){const L=g.getMetersPerVerticalUnitForSR(this.layer.spatialReference),R=y.getMetersPerUnit(I.unit??"meters");this._elevationOffset=l.unwrapOr(I.offset,0)*R/L}else this._elevationOffset=0};F.getElevation=function(I,L,R,O){t[0]=I;t[1]=L;t[2]=R;if(!this._renderCoordsHelper.toRenderCoords(t,O,t))return m.getLogger(this.declaredClass).error("could not project point for elevation alignment"),
null;I=this._elevationOffset;L=this._zmin+I;this._renderCoordsHelper.setAltitude(C,this._zmax+I,t);this._renderCoordsHelper.setAltitude(E,L,t);this._intersector.reset(C,E,null);this._intersector.intersect(this._intersectLayers,null,1,null,J=>!!J.metadata?.isElevationSource);return this._intersector.results.min.getIntersectionPoint(t)?this._renderCoordsHelper.getAltitude(t):null};F._objectChanged=function(I){const L=this.spatialReference;if(I.metadata?.isElevationSource&&!l.isNone(L)){r.empty(z);var R=
I.metadata.lastValidElevationBB;R.isEmpty()||this._expandExtent(L,R.min,R.max,z);var {min:O,max:J}=I.boundingVolumeWorldSpace;this._expandExtent(L,O,J,z);r.toRect(z,v);this._zmin=Math.min(this._zmin,z[2]);this._zmax=Math.max(this._zmax,z[5]);A.extent=v;A.spatialReference=L;this.emit("elevation-change",A);p.copy(R.min,O);p.copy(R.max,J)}};F._computeLayerExtent=function(I,L){r.empty(z);l.isSome(I)&&L.objects.forAll(R=>this._expandExtent(I,R.boundingVolumeWorldSpace.min,R.boundingVolumeWorldSpace.max,
z));return z};F._expandExtent=function(I,L,R,O){for(let J=0;8>J;++J)t[0]=J&1?L[0]:R[0],t[1]=J&2?L[1]:R[1],t[2]=J&4?L[2]:R[2],this._renderCoordsHelper.fromRenderCoords(t,t,I),r.expandWithVec3(O,t);return O};b._createClass(H,[{key:"spatialReference",get:function(){return this.view?.spatialReference}}]);return H}(n.EventedMixin(w));c.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);c.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);c.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);c.__decorate([f.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=c.__decorate([u.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const z=r.empty(),v=q.empty(),A={spatialReference:null,extent:v,context:"scene"},t=h.create(),C=h.create(),E=h.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){c=function(h){function r(y){y=q.call(this,y);y._dirtyExtents=new k.ExtentSet;y._globalDirty=!1;y._averageExtentUpdateSize=0;y._dirtyGraphicsSet=new Set;y._handles=new n;y._updateElevation=!1;y.graphicsCoreOwner=null;y.graphicsCore=null;y.events=new w;return y}a._inherits(r,h);var q=a._createSuper(r);h=r.prototype;h.initialize=function(){const y=this.graphicsCoreOwner.view.resourceController.scheduler;this._handles.add([this.elevationProvider.on("elevation-change",
B=>this._elevationChanged(B)),m.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),y.registerTask(p.TaskPriority.ELEVATION_ALIGNMENT,this)])};h.destroy=function(){this._dirtyGraphicsSet.clear();this._handles=x.destroyMaybe(this._handles);this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=null};h.clear=function(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")};h._suspendedChange=function(){!0===this.graphicsCoreOwner.suspended?
this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))};h.elevationInfoChange=function(){this._globalDirty=!0;this.notifyChange("updating")};h.runTask=function(y){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,y.madeProgress());for(y.run(()=>this._dirtyExtents.merge(y));this.running&&!y.done;)this._updateDirtyGraphics(y),this._updateDirtyExtents(y);this.notifyChange("updating")};h._updateDirtyGraphics=
function(y){const B=this.graphicsCoreOwner.view.renderCoordsHelper,D=this.graphicsCore.effectiveUpdatePolicy===u.UpdatePolicy.ASYNC;for(const z of this._dirtyGraphicsSet.keys()){const v=this.graphicsCore.getGraphics3DGraphicById(z);this._dirtyGraphicsSet.delete(z);x.isSome(v)&&(v.alignWithElevation(this.elevationProvider,B,D),this.graphicsCoreOwner.view.deconflictor.setDirty(),y.madeProgress());if(y.done)break}};h._updateDirtyExtents=function(y){for(;!this._dirtyExtents.empty&&!y.done;){const B=this._dirtyExtents.pop(),
D=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:B,spatialReference:D});const z=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(B,D,v=>{const A=this.graphicsCore.getGraphics3DGraphicById(v);x.isSome(A)&&A.needsElevationUpdates()&&this._dirtyGraphicsSet.add(v)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-z)+.9*this._averageExtentUpdateSize;y.madeProgress()}};h._markAllGraphicsElevationDirty=function(){this._dirtyExtents.clear();
this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((y,B)=>this._dirtyGraphicsSet.add(B))};h._elevationChanged=function(y){if("scene"!==y.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:B,spatialReference:D}=y;this.graphicsCoreOwner.suspended?(this._updateElevation||(y=this.graphicsCore.computedExtent)&&B[2]>y.xmin&&B[0]<y.xmax&&B[3]>y.ymin&&B[1]<y.ymax&&(this._updateElevation=!0),this.events.emit("invalidate-elevation",
{extent:B,spatialReference:D})):(-Infinity===B[0]?this._globalDirty=!0:this._dirtyExtents.add(B),this.notifyChange("updating"))}};a._createClass(r,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}},{key:"updatingRemaining",get:function(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}}]);return r}(c);b.__decorate([l.property()],
c.prototype,"graphicsCoreOwner",void 0);b.__decorate([l.property()],c.prototype,"graphicsCore",void 0);b.__decorate([l.property()],c.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([l.property()],c.prototype,"elevationProvider",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([l.property({readOnly:!0})],c.prototype,"updatingRemaining",null);return c=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,c,w,n){let x=function(){function m(){this._extents=new c({allocator:g=>g||w.create()});this._tmpExtent=w.create();this._dirty=!1}var l=m.prototype;l.clear=function(){this._extents.clear()};l.add=function(g){this._contains(g)||(this._removeContained(g),w.copy(this._extents.pushNew(),g),this._dirty=!0)};l.pop=function(){this._dirty&&this._mergeTight();
return this._extents.pop()};l.merge=function(g){this._mergeTight(g);return g.hasProgressed};l._mergeTight=function(g=n.noBudget){const f=this._extents,d=new Set;let e=0;for(;e!==f.length;){f.sort((k,u)=>k[0]-u[0]);e=f.length;d.clear();for(let k=0;k<f.length;++k){if(g.done)return;const u=f.getItemAt(k);if(u){for(let p=k+1;p<f.length;++p){const h=f.getItemAt(p);if(null==h||h[0]>=u[2])break;d.add(h)}d.forEach(p=>{if(u!==p)if(p[2]<=u[0])d.delete(p);else{var h=w.area(u),r=w.area(p),q=this._tmpExtent;w.expand(u,
p,q);h+=r;.05>(w.area(q)-h)/h&&(w.copy(u,q),d.delete(p),f.remove(p),g.madeProgress())}});d.add(u)}}}this._dirty=!1};l._contains=function(g){return this._extents.some(f=>w.contains(f,g))};l._removeContained=function(g){this._extents.filterInPlace(f=>!w.contains(g,f))};b._createClass(m,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const g=this;return{containsPoint:f=>g._extents.some(d=>w.containsPoint(d,
f))}}}]);return m}();a.ExtentSet=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){c=function(p){function h(q){q=r.call(this,q);q.suspended=!1;q._extent=null;q._extentIntersectionDirty=!0;q._isVisibleBelowSurfaceInternal=!1;q._handles=new w;q.graphicsCoreOwner=null;q.updating=!0;return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.initialize=function(){var {graphicsCoreOwner:q}=this;this._extentIntersection=new k.FrustumExtentIntersection({renderCoordsHelper:q.view.renderCoordsHelper});const y=q.view,B=y.basemapTerrain;q=y.resourceController.scheduler;
this._handles.add([y.on("resize",()=>this._viewChange()),x.watch(()=>y.state.camera,()=>this._viewChange(),x.sync),q.registerTask(u.TaskPriority.FRUSTUM_VISIBILITY,this),x.watch(()=>B.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===y.viewingMode?this._isVisibleBelowSurface=!0:this._handles.add([x.watch(()=>[B.baseOpacity,B.wireframe,y.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),x.initial)])};p.destroy=function(){this._set("graphicsCoreOwner",
null);this._extentIntersection=this._extent=null;this._handles=n.destroyMaybe(this._handles)};p._setDirty=function(){this.updating||this._set("updating",!0)};p.setExtent=function(q){this._extent=q;this._extentIntersectionDirty=!0;this._setDirty()};p._viewChange=function(){this._setDirty()};p._elevationBoundsChange=function(){this._setDirty();this._extentIntersectionDirty=!0};p._updateIsVisibleBelowSurface=function(){const q=this.graphicsCoreOwner.view,y=q.basemapTerrain,B="none"===q.map.ground?.navigationConstraint?.type;
this._isVisibleBelowSurface="local"===q.viewingMode||!y.opaque||B};p._updateExtentIntersection=function(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var q=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var y=-.3*e.getReferenceEllipsoid(q.spatialReference).radius;else{const {min:B,max:D}=q.basemapTerrain.visibleElevationBounds;y=B-Math.max(1,(D-B)*(1.2-1))}this._extentIntersection.update(this._extent,q.spatialReference,y)}};p.runTask=function(q){this._set("updating",
!1);if(!this._extent)return this._set("suspended",!1),u.Task.YIELD;this._updateExtentIntersection();const y=this.graphicsCoreOwner.view.frustum,B=e.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(y,B));q.madeProgress()};a._createClass(h,[{key:"_isVisibleBelowSurface",set:function(q){this._isVisibleBelowSurfaceInternal=q;this._setDirty();this._extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);
return h}(c);b.__decorate([m.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([m.property({constructOnly:!0})],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],c)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils",
"./Graphics3DObjectStateSet"],function(a,b,c,w){let n=function(){function x(l){this._graphicsCore=l;this._stateSets=[]}var m=x.prototype;m.destroy=function(){this.reset();this._stateSets=null};m.reset=function(){this._stateSets&&(this._stateSets.forEach(l=>l.objectStateSet.removeAll()),this._stateSets.length=0)};m.acquireSet=function(l,g){const f=new w.Graphics3DObjectStateSet(l,g);this._stateSets.push(f);l=c.makeHandle(()=>this.releaseSet(f));return{set:f,handle:l}};m.releaseSet=function(l){l.objectStateSet.removeAll();
l=this._stateSets?this._stateSets.indexOf(l):-1;-1!==l&&this._stateSets.splice(l,1)};m._addObjectStateSet=function(l,g){l.addObjectStateSet(g.stateType,g.objectStateSet)};m._removeObjectStateSet=function(l,g){l.removeObjectState(g.objectStateSet)};m.setUid=function(l,g){l.ids.add(g);(g=this._graphicsCore.graphics3DGraphics.get(g))&&this._addObjectStateSet(g,l)};m.setUids=function(l,g){g.forEach(f=>this.setUid(l,f))};m.setObjectIds=function(l,g){g.forEach(f=>l.ids.add(f));this._initializeSet(l)};m.addGraphic=
function(l){this._stateSets.forEach(g=>{!g.paused&&g.hasGraphic(l)&&this._addObjectStateSet(l,g)})};m.removeGraphic=function(l){this._stateSets.forEach(g=>{g.hasGraphic(l)&&this._removeObjectStateSet(l,g)})};m.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(l=>l.objectStateSet.removeAll())};m._initializeSet=function(l){const g=this._graphicsCore.graphics3DGraphics;l.objectIdField?g.forEach(f=>{f&&l.hasGraphic(f)&&this._addObjectStateSet(f,l)}):l.ids.forEach(f=>{(f=g.get(f))&&
this._addObjectStateSet(f,l)})};b._createClass(x,[{key:"test",get:function(){return{states:this._stateSets}}}]);return x}();a.Graphics3DObjectStates=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/Object3DStateSet"],function(a,b,c){let w=function(){function n(x,m){this.stateType=x;this.objectIdField=m;this.objectStateSet=new c.Object3DStateSet;
this.ids=new Set;this.paused=!1}n.prototype.hasGraphic=function(x){return this.objectIdField?this.ids.has(x.graphic.attributes[this.objectIdField]):this.ids.has(x.graphic.uid)};return b._createClass(n)}();a.Graphics3DObjectStateSet=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b,c){var w;(function(x){x[x.Object=0]="Object";
x[x.RenderGeometry=1]="RenderGeometry";x[x.External=2]="External";x[x.COUNT=3]="COUNT"})(w||(w={}));let n=function(){function x(){this._items=[]}var m=x.prototype;m.addObject=function(l,g){this._items.push({type:w.Object,objectStateId:g,object:l})};m.addRenderGeometry=function(l,g,f){this._items.push({type:w.RenderGeometry,objectStateId:g,renderGeometry:l,owner:f})};m.addExternal=function(l,g){this._items.push({type:w.External,objectStateId:g,remove:l})};m.remove=function(l){for(let g=this._items.length-
1;0<=g;--g){const f=this._items[g];f.objectStateId===l&&(this._removeObjectStateItem(f),this._items.splice(g,1))}};m.removeObject=function(l){for(let g=this._items.length-1;0<=g;--g){const f=this._items[g];f.type===w.Object&&f.object===l&&(this._removeObjectStateItem(f),this._items.splice(g,1))}};m.removeRenderGeometry=function(l){for(let g=this._items.length-1;0<=g;--g){const f=this._items[g];f.type===w.RenderGeometry&&f.renderGeometry===l&&(this._removeObjectStateItem(f),this._items.splice(g,1))}};
m.removeAll=function(){this._items.forEach(l=>{this._removeObjectStateItem(l)});this._items=[]};m._removeObjectStateItem=function(l){switch(l.type){case w.Object:l.objectStateId.channel===c.Object3DState.Highlight?l.object.removeHighlight(l.objectStateId):l.objectStateId.channel===c.Object3DState.MaskOccludee&&l.object.removeOcclude(l.objectStateId);break;case w.RenderGeometry:l.owner.removeRenderGeometryObjectState(l.renderGeometry,l.objectStateId);break;case w.External:l.remove(l.objectStateId)}};
return b._createClass(x)}();a.Object3DStateSet=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){const h=w.getLogger("esri.views.3d.layers.graphics.Graphics3DScaleVisibility");c=function(q){function y(D){D=B.call(this,D);D._scaleRangeActive=!1;D._layerScaleRangeVisibilityQuery=!1;D._extent=null;D.graphicsCoreOwner=null;D.layer=null;D.queryGraphicUIDsInExtent=null;D.graphicsCore=null;D.basemapTerrain=null;D.layerScaleEnabled=!0;D.suspended=!1;D._dirty=!0;return D}a._inherits(y,q);var B=a._createSuper(y);q=y.prototype;q.initialize=function(){this.updateScaleRangeActive();
this.handles.add(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(p.TaskPriority.SCALE_VISIBILITY,this));this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())};q.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null};q._setDirty=function(){this._dirty=!0};q.setExtent=function(D){const z=
this.graphicsCoreOwner.view.spatialReference,v=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(z===v)this._extent=D??null;else{const A=e.create();d.projectBoundingRect(D,z,A,v)?this._extent=A:this._extent=null}this._setDirty()};q.scaleRangeActive=function(){return this._scaleRangeActive};q.updateScaleRangeActive=function(){var D=this.layer,z=D.effectiveScaleRange;z=this.layerScaleEnabled&&null!=z&&(0<z.minScale||0<z.maxScale);D.labelingInfo&&!z&&(z=D.labelingInfo.some(v=>v&&(0<(v.minScale??
0)||0<(v.maxScale??0))));D=this._scaleRangeActive!==z;(this._scaleRangeActive=z)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",v=>this._scaleUpdateHandler(v)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!z&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return D};q.runTask=function(D){const z=this.graphicsCoreOwner.view.basemapTerrain;
if(this._extent&&z&&z.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return p.Task.YIELD;this._layerScaleRangeVisibilityQuery=!0;const {minScale:v,maxScale:A}=this.layer.effectiveScaleRange;z.queryVisibleScaleRange(this._extent,v,A,t=>this._finishUpdate(t))}else this._finishUpdate(!0);D.madeProgress()};q._finishUpdate=function(D){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!D);this._dirty=!1};q._visibleAtLayerScale=function(D){const z=
this.layer.effectiveScaleRange;return!this.layerScaleEnabled||u.scaleBoundsPredicate(D,z.minScale||0,z.maxScale||0)};q._visibleAtLabelScale=function(D,z){return u.scaleBoundsPredicate(D,z.minScale||0,z.maxScale||0)};q._graphicScale=function(D){let z;n.isSome(D.centroid)?z=D.centroid:n.isSome(D.graphic.geometry)&&"point"===D.graphic.geometry.type&&(z=D.graphic.geometry);return z?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(z):1:null};q._graphicVisible=
function(D){if(!this.layerScaleEnabled)return!0;D=this._graphicScale(D);return this._visibleAtLayerScale(D)};q.updateVisibility=function(D){if(this._scaleRangeActive){const z=this._graphicVisible(D);return D.setVisibilityFlag(k.VisibilityFlag.SCALE_RANGE,z,k.VisibilityGroup.GRAPHIC)}return!1};q.updateGraphicLabelScaleVisibility=function(D){if(!this._scaleRangeActive||!D.labelLayers||0===D.labelLayers.length)return!1;const z=this._graphicScale(D);if(D=this._updateLabelScaleVisibility(D,z))this.graphicsCoreOwner.view.deconflictor.setDirty(),
this.graphicsCoreOwner.view.labeler.setDirty();return D};q._updateLabelScaleVisibility=function(D,z){if(!D.labelLayers||0===D.labelLayers.length)return!1;const v=D.labelLayers[0]._labelClass;return v&&null!=v.minScale&&null!=v.maxScale&&(z=this._visibleAtLabelScale(z,v),D.setVisibilityFlag(k.VisibilityFlag.SCALE_RANGE,z,k.VisibilityGroup.LABEL))?!0:!1};q._scaleUpdateHandler=function(D){this._setDirty();if(this.graphicsCore.visible){var z=D.extent,v=D.scale,A=this._visibleAtLayerScale(v),t=!1,C=this.graphicsCoreOwner.view.spatialReference;
D=D.spatialReference;if(n.isNone(D))h.error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var E=!D.equals(C);E&&!d.projectBoundingRect(z,D,r,C)?h.error("scaleUpdate: Internal error, cannot project AABR from "+D+" to wkid "+C):(this.queryGraphicUIDsInExtent(E?r:z,C,F=>{F=this.graphicsCore.getGraphics3DGraphicById(F);if(!n.isNone(F)){var H=F.centroid;n.isSome(H)&&(z[0]>H.x||z[1]>H.y||z[2]<H.x||z[3]<H.y)||(F.setVisibilityFlag(k.VisibilityFlag.SCALE_RANGE,A,k.VisibilityGroup.GRAPHIC)&&
(t=!0),this._updateLabelScaleVisibility(F,v)&&(t=!0))}}),t&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty()))}}};q.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(D=>D.clearVisibilityFlag(k.VisibilityFlag.SCALE_RANGE)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a._createClass(y,[{key:"updating",get:function(){return this._dirty||
this.updatingHandles.updating}},{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}}]);return y}(c.HandleOwner);b.__decorate([x.property()],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([x.property()],c.prototype,"layer",void 0);b.__decorate([x.property()],c.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([x.property()],c.prototype,"graphicsCore",void 0);b.__decorate([x.property()],c.prototype,"basemapTerrain",void 0);b.__decorate([x.property({constructOnly:!0})],
c.prototype,"layerScaleEnabled",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([x.property()],c.prototype,"_dirty",void 0);c=b.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c);const r=e.create();return c})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(b,c,w){if(!w||null==c)return null;
if(!b){a:{b=w.toLowerCase();for(var n in c)if(n.toLowerCase()===b){c=c[n];break a}c=null}return c}return(n=b.get(w))?c[n.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/asyncUtils ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){a.FeatureVisibilityFilter=function(y){function B(z){var v=D.call(this,z);v._updateTask=null;v._frameTask=null;v._queryEngine=null;v._updateRequested=!0;v._updateVisibility=async A=>{if(m.isNone(v._compositedFeatureFilter)&&m.isNone(v._sceneFilter)||0===v.context.getFeatureCount())return v._frameTask.schedule(()=>v.clear(),A);try{const t=await v._queryEngine.executeQueryForIdSet(v._compositedFeatureFilter,v._sceneFilter,A);return v._frameTask.schedule(()=>
{v.context.updateFeatureVisibilities(C=>t.has(C))},A)}catch(t){return l.throwIfAbortError(t),x.getLogger(v.declaredClass).warn(`FeatureFilter query failed: ${t}`,{error:t}),v._frameTask.schedule(()=>{v.context.setAllFeaturesVisibility(!0)},A)}};return v}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.initialize=function(){const z=q.TaskPriority.FILTER_VISIBILITY,{layer:v,view:A}=this._layerView,{featureStore:t}=this.context;this._queryEngine=new r.QueryEngine({context:{spatialReference:A.spatialReference,
layer:v,scheduler:A.resourceController.scheduler,featureStore:t,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:z});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(z,this);this.updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),g.initial)};y.destroy=function(){this._updateRequested=!1;this.handles.removeAll();this.updatingHandles.removeAll();this.clear();this._updateTask=
m.abortMaybe(this._updateTask);this._frameTask=m.removeMaybe(this._frameTask);this._queryEngine=m.destroyMaybe(this._queryEngine);this._set("context",null)};y.reapply=function(){this._updateRequested=!0};y.clear=function(){this._queryEngine.clear();this.context.clearFeaturesVisibility()};y.runTask=function(z){this._updateRequested&&(this._updateTask=m.abortMaybe(this._updateTask),this._updateTask=w.createTask(this._updateVisibility),this._updateRequested=!1,z.madeProgress());this._frameTask.processQueue(z)};
b._createClass(B,[{key:"updating",get:function(){return this.running||this.updatingHandles.updating||m.isSome(this._updateTask)&&!this._updateTask.finished}},{key:"running",get:function(){return this._updateRequested||this._frameTask.updating}},{key:"defaultVisibility",get:function(){return m.isNone(this._compositedFeatureFilter)&&m.isNone(this._sceneFilter)}},{key:"_featureFilter",get:function(){return"filter"in this._layerView?this._layerView.filter:null}},{key:"_sceneFilter",get:function(){return"layerFilter"in
this._layerView?this._layerView.layerFilter:null}},{key:"_floorFilter",get:function(){return h.getFloorFilterClause(this._layerView)}},{key:"_timeExtent",get:function(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}},{key:"_compositedFeatureFilter",get:function(){const {_featureFilter:z,_timeExtent:v,_floorFilter:A}=this;if(m.isNone(v)&&m.isNone(A))return z;const t=m.isSome(z)?z.clone():new p;m.isSome(v)&&(t.timeExtent=m.isSome(t.timeExtent)?t.timeExtent.intersection(v):v);
if(m.isSome(A)){const C=m.isNone(t.where)||""===t.where;t.where=C?A:`(${t.where}) AND (${A})`}return t}},{key:"_layerView",get:function(){return this.context.layerView}}]);return B}(n.HandleOwner);c.__decorate([f.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",void 0);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"updating",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"running",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,
"defaultVisibility",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_compositedFeatureFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,
"_layerView",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=c.__decorate([u.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(c,w){if(!c?.length)return null;
c=c.filter(n=>""!==n).map(n=>`'${n}'`);c.push("''");return`${w} IN (${c.join(",")}) OR ${w} IS NULL`}a.getFloorFilterClause=function(c){const w=c.layer;return"floorInfo"in w&&w.floorInfo?.floorField&&"floors"in c.view?b(c.view.floors,w.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(c,w){return"floorInfo"in w&&w.floorInfo?.floorField?b(c,w.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h){const r=k.QueryEngine;a.QueryEngine=function(q){function y(D){D=B.call(this,D);D._dataQueryEngineInstance=null;return D}b._inherits(y,q);var B=b._createSuper(y);q=y.prototype;q.destroy=function(){this.clear()};q.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};q.executeQueryForIdSet=async function(D,z,v){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(D,
z),v)};q.executeQueryForCount=async function(D,z){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(D),z)};q.executeQueryForExtent=async function(D,z){const {count:v,extent:A}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(D),z);D=e.fromJSON(A);return{count:v,extent:D}};q.executeQueryForIds=async function(D,z){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(D),z)};q.executeQueryForLatestObservations=async function(D,z){D=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(D),
z);D=u.fromJSON(D);D.features.forEach(v=>{v.layer=this.layer;v.sourceLayer=this.layer});return D};q.executeQuery=async function(D,z){D=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(D),z);D=u.fromJSON(D);D.features.forEach(v=>{v.layer=this.layer;v.sourceLayer=this.layer});return D};q._ensureQueryJSON=function(D,z){let v=this.defaultQueryJSON;x.isSome(D)&&("outSpatialReference"in D&&!D.outSpatialReference&&(D.outSpatialReference=this.spatialReference),v=D.toJSON());x.isSome(z)&&(D=
z.geometries.map(A=>A.toJSON()).reduce((A,t)=>{A.rings=A.rings.concat(t.rings);return A}),v={...v,sceneFilter:{...z,geometry:D}});return v};q._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const D="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,z=this.layer.objectIdField,v=h.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),A=this.layer.fields?.map(I=>I.toJSON())??[],t=this.priority,C=this.spatialReference.toJSON(),
{hasZ:E,hasM:F,featureStore:H,scheduler:K}=this.context;return this._dataQueryEngineInstance=new r({hasZ:E,hasM:F,geometryType:v,fields:A,timeInfo:D,spatialReference:C,objectIdField:z,featureStore:H,scheduler:K,priority:t})};b._createClass(y,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;
case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new p({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return y}(n);c.__decorate([m.property({constructOnly:!0})],a.QueryEngine.prototype,"context",void 0);c.__decorate([m.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);c.__decorate([m.property()],a.QueryEngine.prototype,"layer",null);c.__decorate([m.property()],
a.QueryEngine.prototype,"spatialReference",null);c.__decorate([m.property()],a.QueryEngine.prototype,"_queryGeometryType",null);c.__decorate([m.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=c.__decorate([d.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../../support/arcadeOnDemand ../../../views/support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C){function E(L){return null!=L&&L.every(R=>"exceedslimit"!==R.statisticType)}let F=b._createClass(function(L,R=null,O,J,M){this.attributes=L;this.geometry=O;this.centroid=J;this.filterFlags=M;this.groupId=-1;this.displayId=R});const H=new m.MemCacheStorage(2E6);let K=0,I=function(){function L(O){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:y.queryCapabilities};this.geometryType=O.geometryType;this.hasM=!!O.hasM;
this.hasZ=!!O.hasZ;this.objectIdField=O.objectIdField;this.spatialReference=O.spatialReference;this.definitionExpression=O.definitionExpression;this.featureStore=O.featureStore;this.aggregateAdapter=O.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=O.timeInfo;O.cacheSpatialQueries&&(this._geometryQueryCache=new m.MemCache(K++ +"$$",H));this.fieldsIndex=new A(O.fields);O.scheduler&&O.priority&&(this._frameTask=O.scheduler.registerTask(O.priority))}
var R=L.prototype;R.destroy=function(){this._frameTask=x.removeMaybe(this._frameTask);this.clearCache();x.destroyMaybe(this._geometryQueryCache);this._changeHandle=x.removeMaybe(this._changeHandle);x.destroyMaybe(this.fieldsIndex)};R.clearCache=function(){this._geometryQueryCache?.clear();this._timeExtentPromise=this._allFeaturesPromise=null};R.executeQuery=async function(O,J){try{return(await this._executeQuery(O,{},J)).createQueryResponse()}catch(M){if(M!==v.QUERY_ENGINE_EMPTY_RESULT)throw M;return(new B.QueryEngineResult([],
O,this)).createQueryResponse()}};R.executeQueryForCount=async function(O={},J){try{return(await this._executeQuery(O,{returnGeometry:!1,returnCentroid:!1,outSR:null},J)).createQueryResponseForCount()}catch(M){if(M!==v.QUERY_ENGINE_EMPTY_RESULT)throw M;return 0}};R.executeQueryForExtent=async function(O,J){const M=O.outSR;try{const G=await this._executeQuery(O,{returnGeometry:!0,returnCentroid:!1,outSR:null},J),P=G.size;if(!P)return{count:0,extent:null};const U=await this._getBounds(G.items,G.spatialReference,
M||this.spatialReference);return{count:P,extent:U}}catch(G){if(G===v.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw G;}};R.executeQueryForIds=async function(O,J){return this.executeQueryForIdSet(O,J).then(M=>Array.from(M))};R.executeQueryForIdSet=async function(O,J){try{const M=await this._executeQuery(O,{returnGeometry:!0,returnCentroid:!1,outSR:null},J),G=M.items,P=new Set;await this._reschedule(()=>{for(const U of G)P.add(M.featureAdapter.getObjectId(U))},J);return P}catch(M){if(M===
v.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw M;}};R.executeQueryForSnapping=async function(O,J){const {point:M,distance:G,types:P}=O;if(P===B.SnappingTypes.NONE)return{candidates:[]};const U=await this._reschedule(()=>this._checkQuerySupport(O.query),J),N=!p.equals(M.spatialReference,this.spatialReference);N&&await q.checkProjectionSupport(M.spatialReference,this.spatialReference);var S="number"===typeof G?G:G.x,Q="number"===typeof G?G:G.y;S={xmin:M.x-S,xmax:M.x+S,ymin:M.y-Q,ymax:M.y+Q,spatialReference:M.spatialReference};
S=N?q.project(S,this.spatialReference):S;if(!S)return{candidates:[]};Q=(await u.normalizeCentralMeridian(k.fromJSON(M),null,{signal:J}))[0];const W=(await u.normalizeCentralMeridian(k.fromJSON(S),null,{signal:J}))[0];if(x.isNone(Q)||x.isNone(W))return{candidates:[]};const V=new B.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(W.toJSON())),J),U,this);await this._reschedule(()=>this._executeObjectIdsQuery(V),J);await this._reschedule(()=>this._executeTimeQuery(V),
J);await this._reschedule(()=>this._executeAttributesQuery(V),J);J=Q.toJSON();J=N?q.project(J,this.spatialReference):J;return V.createSnappingResponse({...O,point:J,distance:N?Math.max(S.xmax-S.xmin,S.ymax-S.ymin)/2:G},M.spatialReference)};R.executeQueryForLatestObservations=async function(O,J){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new w("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:O,timeInfo:this.timeInfo});try{const M=await this._executeQuery(O,
{},J);await this._reschedule(()=>this._filterLatest(M),J);return M.createQueryResponse()}catch(M){if(M!==v.QUERY_ENGINE_EMPTY_RESULT)throw M;return(new B.QueryEngineResult([],O,this)).createQueryResponse()}};R.executeQueryForSummaryStatistics=async function(O={},J,M){const {field:G,normalizationField:P,valueExpression:U}=J;return(await this._getQueryEngineResultForStats(O,{field:G,normalizationField:P,valueExpression:U},M)).createSummaryStatisticsResponse(J)};R.executeQueryForUniqueValues=async function(O=
{},J,M){const {field:G,field2:P,field3:U,valueExpression:N}=J;return(await this._getQueryEngineResultForStats(O,{field:G,field2:P,field3:U,valueExpression:N},M)).createUniqueValuesResponse(J)};R.executeQueryForClassBreaks=async function(O={},J,M){const {field:G,normalizationField:P,valueExpression:U}=J;return(await this._getQueryEngineResultForStats(O,{field:G,normalizationField:P,valueExpression:U},M)).createClassBreaksResponse(J)};R.executeQueryForHistogram=async function(O={},J,M){const {field:G,
normalizationField:P,valueExpression:U}=J;return(await this._getQueryEngineResultForStats(O,{field:G,normalizationField:P,valueExpression:U},M)).createHistogramResponse(J)};R.fetchRecomputedExtents=async function(O){const [J,M]=await Promise.all(["getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getBounds(await this._getAllFeatures(),this.spatialReference,this.spatialReference),x.isSome(this._timeExtentPromise)?
this._timeExtentPromise:this._timeExtentPromise=z.getTimeExtent(this.timeInfo,this.featureStore)]);l.throwIfAborted(O);return{fullExtent:J,timeExtent:M}};R._getBounds=async function(O,J,M){const G=f.set(f.create(),f.NEGATIVE_INFINITY);await this.featureStore.forEachBounds(O,P=>f.expandWithAABB(G,P));O={xmin:G[0],ymin:G[1],xmax:G[3],ymax:G[4],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(G[2])&&isFinite(G[5])&&(O.zmin=G[2],O.zmax=G[5]);J=q.project(O,J,M);J.spatialReference=
v.cleanFromGeometryEngine(M);0===J.xmax-J.xmin&&(M=g.getMetersPerUnitForSR(J.spatialReference),J.xmin-=M,J.xmax+=M);0===J.ymax-J.ymin&&(M=g.getMetersPerUnitForSR(J.spatialReference),J.ymin-=M,J.ymax+=M);this.hasZ&&null!=J.zmin&&null!=J.zmax&&0===J.zmax-J.zmin&&(M=g.getMetersPerUnitForSR(J.spatialReference),J.zmin-=M,J.zmax+=M);return J};R._schedule=async function(O,J){return x.isSome(this._frameTask)?this._frameTask.schedule(O,J):O(C.noBudget)};R._reschedule=async function(O,J){return x.isSome(this._frameTask)?
this._frameTask.reschedule(O,J):O(C.noBudget)};R._getAllFeaturesQueryEngineResult=async function(O){return new B.QueryEngineResult(await this._getAllFeatures(),O,this)};R._getAllFeatures=async function(){if(x.isNone(this._allFeaturesPromise)){const M=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(G=>M.push(G))})().then(()=>M)}const O=this._allFeaturesPromise,J=await O;return O===this._allFeaturesPromise?J.slice():this._getAllFeatures()};R._executeQuery=async function(O,J,M){O=
n.clone(O);O=await this._schedule(()=>v.normalizeQuery(O,this.definitionExpression,this.spatialReference),M);O=await this._reschedule(()=>this._checkQuerySupport(O),M);O={...O,...J};const G=await this._reschedule(()=>this._executeSceneFilterQuery(O,M),M),P=await this._reschedule(()=>this._executeGeometryQuery(O,G,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(P),M);await this._reschedule(()=>this._executeObjectIdsQuery(P),M);await this._reschedule(()=>this._executeTimeQuery(P),M);
await this._reschedule(()=>this._executeAttributesQuery(P),M);return P};R._executeSceneFilterQuery=async function(O,J){if(x.isNone(O.sceneFilter))return null;const {outSR:M,returnGeometry:G,returnCentroid:P}=O;var U=this.featureStore.featureSpatialReference,N=O.sceneFilter.geometry;const S=x.isNone(U)||p.equals(U,N.spatialReference)?N:q.project(N,U);if(!S)return null;U=G||P;U=p.isValid(M)&&!p.equals(this.spatialReference,M)&&U?async T=>this._project(T,M):T=>T;const Q=this.featureAdapter;N=await this._reschedule(()=>
this._searchFeatures(this._getQueryBBoxes(S)),J);if("disjoint"===O.sceneFilter.spatialRelationship){if(!N.length)return null;const T=new Set;for(var W of N)T.add(Q.getObjectId(W));const X=await this._reschedule(()=>this._getAllFeatures(),J);W=await this._reschedule(async()=>{const Z=await D.getSpatialQueryOperator("esriSpatialRelDisjoint",S,this.geometryType,this.hasZ,this.hasM),Y=await this._runSpatialFilter(X,aa=>!T.has(Q.getObjectId(aa))||Z(Q.getGeometry(aa)),J);return new B.QueryEngineResult(Y,
O,this)},J);return U(W)}if(!N.length)return new B.QueryEngineResult([],O,this);if(this._canExecuteSinglePass(S,O))return U(new B.QueryEngineResult(N,O,this));const V=await D.getSpatialQueryOperator("esriSpatialRelContains",S,this.geometryType,this.hasZ,this.hasM);W=await this._runSpatialFilter(N,T=>V(Q.getGeometry(T)),J);return U(new B.QueryEngineResult(W,O,this))};R._executeGeometryQuery=async function(O,J,M){if(x.isSome(J)&&0===J.items.length)return J;O=x.isSome(J)?J.query:O;const {geometry:G,outSR:P,
spatialRel:U,returnGeometry:N,returnCentroid:S}=O;var Q=this.featureStore.featureSpatialReference;const W=!G||x.isNone(Q)||p.equals(Q,G.spatialReference)?G:q.project(G,Q),V=N||S,T=p.isValid(P)&&!p.equals(this.spatialReference,P),X=this._geometryQueryCache&&x.isNone(J)?T&&V?JSON.stringify({originalFilterGeometry:G,spatialRelationship:U,outSpatialReference:P}):JSON.stringify({originalFilterGeometry:G,spatialRelationship:U}):null;Q=X?this._geometryQueryCache.get(X):null;if(x.isSome(Q))return new B.QueryEngineResult(Q,
O,this);Q=async na=>{T&&V&&await this._project(na,P);X&&this._geometryQueryCache.put(X,na.items,na.items.length+1);return na};if(!W)return Q(x.isSome(J)?J:await this._getAllFeaturesQueryEngineResult(O));const Z=this.featureAdapter;let Y=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(G)),M);if("esriSpatialRelDisjoint"===U){if(!Y.length)return Q(x.isSome(J)?J:await this._getAllFeaturesQueryEngineResult(O));const na=new Set;for(var aa of Y)na.add(Z.getObjectId(aa));const ba=x.isSome(J)?
J.items:await this._reschedule(()=>this._getAllFeatures(),M);aa=await this._reschedule(async()=>{const ea=await D.getSpatialQueryOperator(U,W,this.geometryType,this.hasZ,this.hasM),ja=await this._runSpatialFilter(ba,ka=>!na.has(Z.getObjectId(ka))||ea(Z.getGeometry(ka)),M);return new B.QueryEngineResult(ja,O,this)},M);return Q(aa)}if(x.isSome(J)){const na=new c.PositionHint;Y=Y.filter(ba=>0<=c.indexOf(J.items,ba,J.items.length,na))}if(!Y.length)return Q=new B.QueryEngineResult([],O,this),X&&this._geometryQueryCache.put(X,
Q.items,1),Q;if(this._canExecuteSinglePass(W,O))return Q(new B.QueryEngineResult(Y,O,this));const ia=await D.getSpatialQueryOperator(U,W,this.geometryType,this.hasZ,this.hasM);aa=await this._runSpatialFilter(Y,na=>ia(Z.getGeometry(na)),M);return Q(new B.QueryEngineResult(aa,O,this))};R._executeAggregateIdsQuery=function(O){if(0!==O.items.length&&O.query.aggregateIds&&O.query.aggregateIds.length&&!x.isNone(this.aggregateAdapter)){var J=new Set;for(const G of O.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(G).forEach(P=>
J.add(P));var M=this.featureAdapter.getObjectId;O.items=O.items.filter(G=>J.has(M(G)))}};R._executeObjectIdsQuery=function(O){if(0!==O.items.length&&O.query.objectIds&&O.query.objectIds.length){var J=new Set(O.query.objectIds),M=this.featureAdapter.getObjectId;O.items=O.items.filter(G=>J.has(M(G)))}};R._executeTimeQuery=function(O){if(0!==O.items.length){var J=z.getTimeOperator(this.timeInfo,O.query.timeExtent,this.featureAdapter);x.isNone(J)||(O.items=O.items.filter(J))}};R._executeAttributesQuery=
function(O){if(0!==O.items.length){var J=r.getWhereClause(O.query.where,this.fieldsIndex);if(J){if(!J.isStandardized)throw new TypeError("Where clause is not standardized");O.items=O.items.filter(M=>J.testFeature(M,this.featureAdapter))}}};R._runSpatialFilter=async function(O,J,M){if(!J)return O;if(x.isNone(this._frameTask))return O.filter(N=>J(N));let G=0;const P=[],U=async N=>{for(;G<O.length;){const S=O[G++];J(S)&&(P.push(S),N.madeProgress());N.done&&await this._reschedule(Q=>U(Q),M)}};return this._reschedule(N=>
U(N),M).then(()=>P)};R._filterLatest=function(O){const {trackIdField:J,startTimeField:M,endTimeField:G}=this.timeInfo,P=G||M,U=new Map,N=this.featureAdapter.getAttribute;for(const S of O.items){const Q=N(S,J),W=N(S,P),V=U.get(Q);(!V||W>N(V,P))&&U.set(Q,S)}O.items=Array.from(U.values())};R._canExecuteSinglePass=function(O,J){({spatialRel:J}=J);return D.canQueryWithRBush(O)&&("esriSpatialRelEnvelopeIntersects"===J||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===J||"esriSpatialRelContains"===
J||"esriSpatialRelWithin"===J))};R._project=async function(O,J){if(!J||p.equals(this.spatialReference,J))return O;const M=this.featureAdapter;J=await q.projectMany(O.items.map(G=>v.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(G))),this.spatialReference,J);O.items=J.map((G,P)=>M.cloneWithGeometry(O.items[P],h.convertFromGeometry(G,this.hasZ,this.hasM)));return O};R._getQueryBBoxes=function(O){if(D.canQueryWithRBush(O)){if(k.isExtent(O))return[d.fromValues(O.xmin,O.ymin,O.xmax,O.ymax)];
if(k.isPolygon(O))return O.rings.map(J=>d.fromValues(Math.min(J[0][0],J[2][0]),Math.min(J[0][1],J[2][1]),Math.max(J[0][0],J[2][0]),Math.max(J[0][1],J[2][1])))}return[e.getBoundsXY(d.create(),O)]};R._searchFeatures=async function(O){const J=new Set;await Promise.all(O.map(M=>this.featureStore.forEachInBounds(M,G=>J.add(G))));O=Array.from(J.values());J.clear();return O};R._checkStatisticsSupport=async function(O,J){if(0>(O.distance??0)||null!=O.geometryPrecision||O.multipatchOption||O.pixelSize||O.relationParam||
O.text||O.outStatistics||O.groupByFieldsForStatistics||O.having||O.orderByFields)throw new w("feature-store:unsupported-query","Unsupported query options",{query:O});this._checkAttributesQuerySupport(O);return Promise.all([this._checkStatisticsParamsSupport(J),D.checkSpatialQuerySupport(O,this.geometryType,this.spatialReference),q.checkProjectionSupport(this.spatialReference,O.outSR)]).then(()=>O)};R._checkStatisticsParamsSupport=async function(O){var J=[];O.valueExpression&&({arcadeUtils:J}=await t.loadArcade(),
J=J.extractFieldNames(O.valueExpression));O.field&&J.push(O.field);O.field2&&J.push(O.field2);O.field3&&J.push(O.field3);O.normalizationField&&J.push(O.normalizationField);if(!J.length)throw new w("feature-store:unsupported-query","params should have at least a field or valueExpression",{params:O});r.validateFields(this.fieldsIndex,J,"params contains missing fields")};R._checkQuerySupport=async function(O){if(0>(O.distance??0)||null!=O.geometryPrecision||O.multipatchOption||O.pixelSize||O.relationParam||
O.text)throw new w("feature-store:unsupported-query","Unsupported query options",{query:O});this._checkAttributesQuerySupport(O);this._checkStatisticsQuerySupport(O);return Promise.all([D.checkSpatialQuerySupport(O,this.geometryType,this.spatialReference),q.checkProjectionSupport(this.spatialReference,O.outSR)]).then(()=>O)};R._checkAttributesQuerySupport=function(O){const {outFields:J,orderByFields:M,returnDistinctValues:G,outStatistics:P}=O,U=P?P.map(N=>N.outStatisticFieldName&&N.outStatisticFieldName.toLowerCase()).filter(Boolean):
[];if(M&&0<M.length){const N=M.map(S=>{const Q=S.toLowerCase();return Q.includes(" asc")?Q.split(" asc")[0]:Q.includes(" desc")?Q.split(" desc")[0]:S}).filter(S=>!U.includes(S));r.validateFields(this.fieldsIndex,N,"orderByFields contains missing fields")}if(J&&0<J.length)r.validateFields(this.fieldsIndex,J,"outFields contains missing fields");else if(G)throw new w("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:O});r.validateWhere(this.fieldsIndex,
O.where)};R._checkStatisticsQuerySupport=function(O){const {outStatistics:J,groupByFieldsForStatistics:M,having:G}=O;var P=M&&M.length,U=J&&J.length;if(G){if(!P||!U)throw new w("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:O});r.validateHaving(this.fieldsIndex,G,J)}if(U&&E(J)){U=J.map(N=>N.onStatisticField).filter(Boolean);r.validateFields(this.fieldsIndex,U,"onStatisticFields contains missing fields");P&&r.validateFields(this.fieldsIndex,
M,"groupByFieldsForStatistics contains missing fields");for(const N of J){const {onStatisticField:S,statisticType:Q}=N;if(("percentile_disc"===Q||"percentile_cont"===Q)&&"statisticParameters"in N){if({statisticParameters:P}=N,!P)throw new w("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:N,query:O});}else if("count"!==Q&&S&&r.hasInvalidFieldType(S,this.fieldsIndex))throw new w("feature-store:unsupported-query","outStatistics contains non-numeric fields",
{definition:N,query:O});}}};R._getQueryEngineResultForStats=async function(O,J,M){O=n.clone(O);try{O=await this._schedule(()=>v.normalizeQuery(O,this.definitionExpression,this.spatialReference),M);O=await this._reschedule(()=>this._checkStatisticsSupport(O,J),M);const G=await this._reschedule(()=>this._executeSceneFilterQuery(O,M),M),P=await this._reschedule(()=>this._executeGeometryQuery(O,G,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(P),M);await this._reschedule(()=>this._executeObjectIdsQuery(P),
M);await this._reschedule(()=>this._executeTimeQuery(P),M);await this._reschedule(()=>this._executeAttributesQuery(P),M);return P}catch(G){if(G!==v.QUERY_ENGINE_EMPTY_RESULT)throw G;return new B.QueryEngineResult([],O,this)}};b._createClass(L,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}}]);return L}();a.Feature=F;a.QueryEngine=I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports",
"../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,b,c){function w(g,f){return g?m.get(g,f):null}function n(g,f,d,e=!0){const k=[];for(const u of f)if("*"!==u&&!g.has(u))if(e){f=x(u);try{const p=w(f,g);if(!p)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:f});if(!p.isStandardized)throw new b("feature-store:unsupported-query","expression is not standard",{clause:p});n(g,p.fieldNames,"expression contains missing fields")}catch(p){if((f=p&&p.details)&&
(f.clause||f.where))throw p;f&&f.missingFields?k.push(...f.missingFields):k.push(u)}}else k.push(u);if(k.length)throw new b("feature-store:unsupported-query",d,{missingFields:k});}function x(g){return g.split(" as ")[0]}const m=new c.WhereClauseCache(50,500),l=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.getAliasFromFieldName=function(g){return g.split(" as ")[1]};a.getExpressionFromFieldName=
x;a.getWhereClause=w;a.hasInvalidFieldType=function(g,f){return(g=f.get(g))?!l.has(g.type):!1};a.validateFields=n;a.validateHaving=function(g,f,d){if(!f)return!0;const e=m.get(f,g);if(!e)throw new b("feature-store:unsupported-query","invalid SQL expression",{having:f});if(!e.isAggregate)throw new b("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:f});n(g,e.fieldNames,"having contains missing fields");if(!e.getExpressions().every(k=>{const {aggregateType:u,
field:p}=k,h=g.get(p)?.name;return d.some(r=>{const {onStatisticField:q,statisticType:y}=r;return g.get(q)?.name===h&&y.toLowerCase().trim()===u})}))throw new b("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:f});return!0};a.validateWhere=function(g,f){if(!f)return!0;const d=m.get(f,g);if(!d)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:f});if(!d.isStandardized)throw new b("feature-store:unsupported-query","where clause is not standard",
{where:f});n(g,d.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../ItemCache","./WhereClause"],function(a,b,c,w){let n=function(){function x(m,l){this._cache=new c(m);this._invalidCache=new c(l)}x.prototype.get=function(m,l){const g=`${l.uid}:${m}`,f=this._cache.get(g);if(f)return f;if(void 0!==this._invalidCache.get(g))return null;
try{const d=w.WhereClause.create(m,l);this._cache.put(g,d);return d}catch{return this._invalidCache.put(g,null),null}};return b._createClass(x)}();a.WhereClauseCache=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,b,c,w,n,x){function m(I,L){I+="";return I.length>=L?I:Array(L-I.length+1).join("0")+I}
function l(I,L,R="0",O="0",J="0",M="0",G="",P="0",U="0"){return"+"===G||"-"===G?(I=`${m(parseInt(I,10),4)}-${m(parseInt(L,10),2)}-${m(parseInt(R,10),2)}`,L="",10>parseFloat(M)&&(L="0"),O=`${m(parseInt(O,10),2)}:${m(parseInt(J,10),2)}:${L+parseFloat(M).toString()}`,G=`${G}${m(parseInt(P,10),2)}:${m(parseInt(U,10),2)}`,new Date(I+"T"+O+G)):new Date(parseInt(I,10),parseInt(L,10)-1,parseInt(R,10),parseInt(O,10),parseInt(J,10),parseFloat(M))}function g(I){let L=z.exec(I);if(null!==L){const [,R,O,J,M,G,
P]=L;return l(R,O,J,M,G,P)}L=v.exec(I);if(null!==L){const [,R,O,J,M,G,P,U,N,S]=L;return l(R,O,J,M,G,P,U,N,S)}L=A.exec(I);if(null!==L){const [,R,O,J,M,G,P,U,N]=L;return l(R,O,J,M,G,"0",P,U,N)}L=t.exec(I);if(null!==L){const [,R,O,J,M,G]=L;return l(R,O,J,M,G)}L=D.exec(I);if(null!==L){const [,R,O,J]=L;return l(R,O,J)}throw Error("SQL Invalid Timestamp");}function f(I){const L=D.exec(I);if(null===L)try{return g(I)}catch{throw Error("SQL Invalid Date");}const [,R,O,J]=L;return new Date(parseInt(R,10),parseInt(O,
10)-1,parseInt(J,10))}function d(I){return Array.isArray(I)?I:[I]}function e(I){return null!==I?!0!==I:null}function k(I,L){return null!=I&&null!=L?!0===I&&!0===L:!1===I||!1===L?!1:null}function u(I,L){return null!=I&&null!=L?!0===I||!0===L:!0===I||!0===L?!0:null}function p(I,L){if(null==I)return null;let R=!1;for(const O of L)if(null==O)R=null;else if(I===O){R=!0;break}return R}function h(I,L,R){if(null==I)return null;let O="",J=H.Normal;for(let M=0;M<L.length;M++){const G=L.charAt(M);switch(J){case H.Normal:G===
R?J=H.Escaped:O="-[]/{}()*+?.\\^$|".includes(G)?O+("\\"+G):"%"===G?O+".*":"_"===G?O+".":O+G;break;case H.Escaped:O="-[]/{}()*+?.\\^$|".includes(G)?O+("\\"+G):O+G,J=H.Normal}}return(new RegExp("^"+O+"$","m")).test(I)}function r(I){return I instanceof Date?I.valueOf():I}function q(I,L,R){if(null==L||null==R)return null;L=r(L);R=r(R);switch(I){case "\x3c\x3e":return L!==R;case "\x3d":return L===R;case "\x3e":return L>R;case "\x3c":return L<R;case "\x3e\x3d":return L>=R;case "\x3c\x3d":return L<=R}}function y(I,
L,R){if("||"===I)return n.evaluateFunction("concat",[L,R]);if(L instanceof n.SqlInterval)if(R instanceof Date)switch(I){case "+":return new Date(L.valueInMilliseconds()+R.getTime());case "-":return L.valueInMilliseconds()-R.getTime();case "*":return L.valueInMilliseconds()*R.getTime();case "/":return L.valueInMilliseconds()/R.getTime()}else if(R instanceof n.SqlInterval)switch(I){case "+":return n.SqlInterval.createFromMilliseconds(L.valueInMilliseconds()+R.valueInMilliseconds());case "-":return n.SqlInterval.createFromMilliseconds(L.valueInMilliseconds()-
R.valueInMilliseconds());case "*":return L.valueInMilliseconds()*R.valueInMilliseconds();case "/":return L.valueInMilliseconds()/R.valueInMilliseconds()}else L=L.valueInMilliseconds();else if(R instanceof n.SqlInterval)if(L instanceof Date)switch(I){case "+":return new Date(R.valueInMilliseconds()+L.getTime());case "-":return new Date(L.getTime()-R.valueInMilliseconds());case "*":return L.getTime()*R.valueInMilliseconds();case "/":return L.getTime()/R.valueInMilliseconds()}else R=R.valueInMilliseconds();
else if(L instanceof Date&&"number"===typeof R)switch(R*=864E5,L=L.getTime(),I){case "+":return new Date(L+R);case "-":return new Date(L-R);case "*":return new Date(L*R);case "/":return new Date(L/R)}else if(R instanceof Date&&"number"===typeof L)switch(L*=864E5,R=R.getTime(),I){case "+":return new Date(L+R);case "-":return new Date(L-R);case "*":return new Date(L*R);case "/":return new Date(L/R)}switch(I){case "+":return L+R;case "-":return L-R;case "*":return L*R;case "/":return L/R}}function B(I,
L,R,O){I=O.getAttribute(I,L);return null!=I&&1===R[L]?new Date(I):I}const D=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,z=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,C=new Set(["current_timestamp","current_date","current_time"]);let E=function(){function I(){}
I.makeBool=function(L){return!0===L};I.featureValue=function(L,R,O,J){return B(L,R,O,J)};I.equalsNull=function(L){return null===L};I.applyLike=function(L,R,O){return h(L,R,O)};I.ensureArray=function(L){return d(L)};I.applyIn=function(L,R){return p(L,R)};I.currentDate=function(){const L=new Date;L.setHours(0,0,0,0);return L};I.makeSqlInterval=function(L,R,O){return n.SqlInterval.createFromValueAndQualifer(L,R,O)};I.convertInterval=function(L){return L instanceof n.SqlInterval?L.valueInMilliseconds():
L};I.currentTimestamp=function(){return new Date};I.compare=function(L,R,O){return q(L,R,O)};I.calculate=function(L,R,O){return y(L,R,O)};I.makeComparable=function(L){return r(L)};I.evaluateFunction=function(L,R){return n.evaluateFunction(L,R)};I.lookup=function(L,R){L=R[L];return void 0===L?null:L};I.between=function(L,R){return null==L||null==R[0]||null==R[1]?null:L>=R[0]&&L<=R[1]};I.notbetween=function(L,R){return null==L||null==R[0]||null==R[1]?null:L<R[0]||L>R[1]};I.ternaryNot=function(L){return e(L)};
I.ternaryAnd=function(L,R){return k(L,R)};I.ternaryOr=function(L,R){return u(L,R)};return b._createClass(I)}(),F=function(){function I(R,O){this.fieldsIndex=O;this._datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=x.WhereGrammar.parse(R);const {isStandardized:J,isAggregate:M,referencedFieldNames:G}=this._extractExpressionInfo(O);this._referencedFieldNames=G;this.isStandardized=J;this.isAggregate=M}I.create=function(R,O){return new I(R,O)};var L=I.prototype;L.testSet=function(R,
O=K){const J={};for(const M of this.fieldNames)J[M]=R.map(G=>O.getAttribute(G,M));return!!this._evaluateNode(this.parseTree,{attributes:J},K)};L.calculateValue=function(R,O=K){R=this._evaluateNode(this.parseTree,R,O);return R instanceof n.SqlInterval?R.valueInMilliseconds()/864E5:R};L.calculateValueCompiled=function(R,O=K){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(R,this.parameters,O,this._datefields);if(c("esri-csp-restrictions"))return this.calculateValue(R,
O);this._compileMe();return this.parseTree._compiledVersion(R,this.parameters,O,this._datefields)};L.testFeature=function(R,O=K){return!!this._evaluateNode(this.parseTree,R,O)};L.testFeatureCompiled=function(R,O=K){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(R,this.parameters,O,this._datefields);if(c("esri-csp-restrictions"))return this.testFeature(R,O);this._compileMe();return!!this.parseTree._compiledVersion(R,this.parameters,O,this._datefields)};L.getFunctions=
function(){const R=new Set;this._visitAll(this.parseTree,O=>{"function"===O.type&&R.add(O.name.toLowerCase())});return Array.from(R)};L.getExpressions=function(){const R=new Map;this._visitAll(this.parseTree,O=>{if("function"===O.type){const J=O.name.toLowerCase();O=O.args.value[0];if("column-reference"===O.type){O=O.column;const M=`${J}-${O}`;R.has(M)||R.set(M,{aggregateType:J,field:O})}}});return[...R.values()]};L.getVariables=function(){const R=new Set;this._visitAll(this.parseTree,O=>{"parameter"===
O.type&&R.add(O.value.toLowerCase())});return Array.from(R)};L._compileMe=function(){const R="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",R)).bind(E)};L._extractExpressionInfo=function(R){const O=[],J=new Set;let M=!0,G=!0;this._visitAll(this.parseTree,P=>{switch(P.type){case "column-reference":const U=R?.get(P.column);let N,S;U?N=S=U.name??"":(S=P.column,N=S.toLowerCase());
U&&U.name&&("date"===U.type||"esriFieldTypeDate"===U.type)&&(this._datefields[U.name]=1);J.has(N)||(J.add(N),O.push(S));P.column=S;break;case "function":const {name:Q,args:W}=P;P=W.value.length;M&&(M=n.isStandardized(Q,P));G&&(G=w.isAggregate(Q,P))}});return{referencedFieldNames:Array.from(O),isStandardized:M,isAggregate:G}};L._visitAll=function(R,O){if(null!=R)switch(O(R),R.type){case "when-clause":this._visitAll(R.operand,O);this._visitAll(R.value,O);break;case "case-expression":for(const J of R.clauses)this._visitAll(J,
O);"simple"===R.format&&this._visitAll(R.operand,O);null!==R.else&&this._visitAll(R.else,O);break;case "expression-list":for(const J of R.value)this._visitAll(J,O);break;case "unary-expression":this._visitAll(R.expr,O);break;case "binary-expression":this._visitAll(R.left,O);this._visitAll(R.right,O);break;case "function":this._visitAll(R.args,O)}};L.evaluateNodeToJavaScript=function(R){switch(R.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(R.value)+", "+JSON.stringify(R.qualifier)+
","+JSON.stringify(R.op)+")";case "case-expression":var O="";if("simple"===R.format){var J="this.makeComparable("+this.evaluateNodeToJavaScript(R.operand)+")";O="( ";for(let M=0;M<R.clauses.length;M++)O+=" ("+J+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(R.clauses[M].operand)+")) ? ("+this.evaluateNodeToJavaScript(R.clauses[M].value)+") : "}else for(O="( ",J=0;J<R.clauses.length;J++)O+=" this.makeBool("+this.evaluateNodeToJavaScript(R.clauses[J].operand)+")\x3d\x3d\x3dtrue ? ("+
this.evaluateNodeToJavaScript(R.clauses[J].value)+") : ";O=null!==R.else?O+this.evaluateNodeToJavaScript(R.else):O+"null";return O+" )";case "parameter":return"this.lookup("+JSON.stringify(R.value.toLowerCase())+",lookups)";case "expression-list":O="[";for(J of R.value)"["!==O&&(O+=","),O+=this.evaluateNodeToJavaScript(J);return O+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(R.expr)+")";case "binary-expression":switch(R.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+" )";case "IS":if("null"!==R.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(R.left)+")";case "ISNOT":if("null"!==R.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(R.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(R.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(R.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(R.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(R.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+","+JSON.stringify(R.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+","+JSON.stringify(R.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(R.operator)+","+this.evaluateNodeToJavaScript(R.left)+","+
this.evaluateNodeToJavaScript(R.right)+")";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(R.operator)+","+this.evaluateNodeToJavaScript(R.left)+","+this.evaluateNodeToJavaScript(R.right)+")"}throw Error("Not Supported Operator "+R.operator);case "null":case "boolean":case "string":case "number":return JSON.stringify(R.value);case "date":return"(new Date("+f(R.value).getTime().toString()+"))";case "timestamp":return"(new Date("+g(R.value).getTime().toString()+
"))";case "current-time":return"date"===R.mode?"this.currentDate()":"this.currentTimestamp()";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(R.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(R.name)+","+this.evaluateNodeToJavaScript(R.args)+")"}throw Error("Unsupported sql syntax "+R.type);};L._evaluateNode=function(R,O,J){switch(R.type){case "interval":return O=this._evaluateNode(R.value,O,J),n.SqlInterval.createFromValueAndQualifer(O,
R.qualifier,R.op);case "case-expression":if("simple"===R.format){var M=r(this._evaluateNode(R.operand,O,J));for(var G=0;G<R.clauses.length;G++)if(M===r(this._evaluateNode(R.clauses[G].operand,O,J)))return this._evaluateNode(R.clauses[G].value,O,J)}else for(M=0;M<R.clauses.length;M++)if(!0===this._evaluateNode(R.clauses[M].operand,O,J))return this._evaluateNode(R.clauses[M].value,O,J);return null!==R.else?this._evaluateNode(R.else,O,J):null;case "parameter":return this.parameters[R.value.toLowerCase()];
case "expression-list":M=[];for(G of R.value)M.push(this._evaluateNode(G,O,J));return M;case "unary-expression":return e(this._evaluateNode(R.expr,O,J));case "binary-expression":switch(R.operator){case "AND":return k(this._evaluateNode(R.left,O,J),this._evaluateNode(R.right,O,J));case "OR":return u(this._evaluateNode(R.left,O,J),this._evaluateNode(R.right,O,J));case "IS":if("null"!==R.right.type)throw Error("Unsupported RHS for IS");return null===this._evaluateNode(R.left,O,J);case "ISNOT":if("null"!==
R.right.type)throw Error("Unsupported RHS for IS");return null!==this._evaluateNode(R.left,O,J);case "IN":return M=d(this._evaluateNode(R.right,O,J)),p(this._evaluateNode(R.left,O,J),M);case "NOT IN":return M=d(this._evaluateNode(R.right,O,J)),e(p(this._evaluateNode(R.left,O,J),M));case "BETWEEN":return M=this._evaluateNode(R.left,O,J),R=this._evaluateNode(R.right,O,J),null==M||null==R[0]||null==R[1]?null:M>=r(R[0])&&M<=r(R[1]);case "NOTBETWEEN":return M=this._evaluateNode(R.left,O,J),R=this._evaluateNode(R.right,
O,J),null==M||null==R[0]||null==R[1]?null:M<r(R[0])||M>r(R[1]);case "LIKE":return h(this._evaluateNode(R.left,O,J),this._evaluateNode(R.right,O,J),R.escape);case "NOT LIKE":return e(h(this._evaluateNode(R.left,O,J),this._evaluateNode(R.right,O,J),R.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return q(R.operator,this._evaluateNode(R.left,O,J),this._evaluateNode(R.right,O,J));case "-":case "+":case "*":case "/":case "||":return y(R.operator,this._evaluateNode(R.left,
O,J),this._evaluateNode(R.right,O,J))}case "null":case "boolean":case "string":case "number":return R.value;case "date":return f(R.value);case "timestamp":return g(R.value);case "current-time":return O=new Date,"date"===R.mode&&O.setHours(0,0,0,0),O;case "column-reference":return B(O,R.column,this._datefields,J);case "data-type":return R.value;case "function":return O=this._evaluateNode(R.args,O,J),this.isAggregate?w.aggregateFunction(R.name,O):n.evaluateFunction(R.name,O)}throw Error("Unsupported sql syntax "+
R.type);};b._createClass(I,[{key:"fieldNames",get:function(){return this._referencedFieldNames}},{key:"hasDateFunctions",get:function(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,R=>{"current-time"===R.type?this._hasDateFunctions=!0:"function"===R.type&&(this._hasDateFunctions=this._hasDateFunctions||C.has(R.name.toLowerCase()))});return this._hasDateFunctions}}]);return I}();var H;(function(I){I[I.Normal=0]="Normal";I[I.Escaped=
1]="Escaped"})(H||(H={}));const K={getAttribute(I,L){return(I&&"object"===typeof I.attributes?I.attributes:I)[L]}};a.WhereClause=F;a.defaultAttributeAdapter=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function b(n){let x=0;for(let m=0;m<n.length;m++)x+=n[m];return x/n.length}function c(n){const x=b(n),m=n.length;let l=0;for(const g of n)l+=(g-x)**2;return 1<m?l/(m-1):0}const w={min:{minParams:1,maxParams:1,
evaluate:n=>null==n[0]?null:Math.min.apply(Math,n[0])},max:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.max.apply(Math,n[0])},avg:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:b(n[0])},sum:{minParams:1,maxParams:1,evaluate:n=>{if(null==n[0])n=null;else{n=n[0];let x=0;for(let m=0;m<n.length;m++)x+=n[m];n=x}return n}},stddev:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.sqrt(c(n[0]))},count:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].length},var:{minParams:1,
maxParams:1,evaluate:n=>null==n[0]?null:c(n[0])}};a.aggregateFunction=function(n,x){const m=w[n.toLowerCase()];if(null==m)throw Error("Function Not Recognised");if(x.length<m.minParams||x.length>m.maxParams)throw Error(`Invalid Parameter count for call to ${n.toUpperCase()}`);return m.evaluate(x)};a.isAggregate=function(n,x){n=w[n.toLowerCase()];return null!=n&&x>=n.minParams&&x<=n.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../arcade/featureset/support/errorsupport","../string","../../chunks/datetime"],function(a,b,c,w,n){function x(f){f=new Date(f.getTime());f.setHours(0,0,0,0);return f}function m(f,d){if(f instanceof Date)return d?x(f):f;if("string"===typeof f||f instanceof String)if(f=n.DateTime.fromSQL(f),f.isValid)return d?x(f.toJSDate()):f.toJSDate();throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);}let l=function(){function f(){this.op="+";this.millis=this.minute=
this.year=this.month=this.hour=this.second=this.day=0}f._fixDefaults=function(d){if(null!==d.precision||null!==d.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};f._parseSecondsComponent=function(d,e){e.includes(".")?(e=e.split("."),d.second=parseFloat(e[0]),d.millis=parseInt(e[1],10)):d.second=parseFloat(e)};f.createFromMilliseconds=function(d){const e=new f;e.second=d/1E3;return e};f.createFromValueAndQualifer=function(d,e,k){let u=null;const p=new f;p.op="-"===
k?"-":"+";if("interval-period"===e.type){f._fixDefaults(e);k=RegExp("^[0-9]{1,}$");if("year"===e.period||"month"===e.period)throw Error("Year-Month Intervals not supported");if("second"===e.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(d))f._parseSecondsComponent(p,d);else throw Error("Illegal Interval");else if(k.test(d))p[e.period]=parseFloat(d);else throw Error("Illegal Interval");}else{f._fixDefaults(e.start);f._fixDefaults(e.end);if("year"===e.start.period||"month"===e.start.period)throw Error("Year-Month Intervals not supported");
if("year"===e.end.period||"month"===e.end.period)throw Error("Year-Month Intervals not supported");switch(e.start.period){case "day":switch(e.end.period){case "hour":u=RegExp("^[0-9]{1,} [0-9]{1,}$");if(u.test(d))p[e.start.period]=parseFloat(d.split(" ")[0]),p[e.end.period]=parseFloat(d.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":u=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(u.test(d))p[e.start.period]=parseFloat(d.split(" ")[0]),d=d.split(" ")[1].split(":"),p.hour=parseFloat(d[0]),
p.minute=parseFloat(d[1]);else throw Error("Illegal Interval");break;case "second":u=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(u.test(d))p[e.start.period]=parseFloat(d.split(" ")[0]),d=d.split(" ")[1].split(":"),p.hour=parseFloat(d[0]),p.minute=parseFloat(d[1]),f._parseSecondsComponent(p,d[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "hour":switch(e.end.period){case "minute":u=RegExp("^[0-9]{1,}:[0-9]{1,}$");
if(u.test(d))p.hour=parseFloat(d.split(":")[0]),p.minute=parseFloat(d.split(":")[1]);else throw Error("Illegal Interval");break;case "second":u=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(u.test(d))d=d.split(":"),p.hour=parseFloat(d[0]),p.minute=parseFloat(d[1]),f._parseSecondsComponent(p,d[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "minute":switch(e.end.period){case "second":u=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");
if(u.test(d))d=d.split(":"),p.minute=parseFloat(d[0]),f._parseSecondsComponent(p,d[1]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;default:throw Error("Invalid Interval.");}}return p};f.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return b._createClass(f)}();const g={extract:{minParams:2,maxParams:2,evaluate:([f,
d])=>{if(null==d)return null;if(d instanceof Date)switch(f.toUpperCase()){case "SECOND":return d.getSeconds();case "MINUTE":return d.getMinutes();case "HOUR":return d.getHours();case "DAY":return d.getDate();case "MONTH":return d.getMonth()+1;case "YEAR":return d.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:f=>{if(2===f.length){const [d,e]=f;return null==d||null==e?null:d.toString().substring(e-1)}if(3===f.length){const [d,e,k]=
f;return null==d||null==e||null==k?null:0>=k?"":d.toString().substring(e-1,e+k-1)}}},position:{minParams:2,maxParams:2,evaluate:([f,d])=>null==f||null==d?null:d.indexOf(f)+1},trim:{minParams:2,maxParams:3,evaluate:f=>{var d=3===f.length,e=d?f[1]:" ";d=d?f[2]:f[1];if(null==e||null==d)return null;e=`(${w.escapeRegExpString(e)})`;switch(f[0]){case "BOTH":return d.replace(new RegExp(`^${e}*|${e}*$`,"g"),"");case "LEADING":return d.replace(new RegExp(`^${e}*`,"g"),"");case "TRAILING":return d.replace(new RegExp(`${e}*$`,
"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.abs(f[0])},ceiling:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.ceil(f[0])},floor:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.floor(f[0])},log:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])},log10:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?
null:Math.sin(f[0])},cos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cos(f[0])},tan:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.tan(f[0])},asin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.asin(f[0])},acos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.acos(f[0])},atan:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.atan(f[0])},sign:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:0<f[0]?1:0>f[1]?-1:0},power:{minParams:2,maxParams:2,
evaluate:f=>null==f[0]||null==f[1]?null:f[0]**f[1]},mod:{minParams:2,maxParams:2,evaluate:f=>null==f[0]||null==f[1]?null:f[0]%f[1]},round:{minParams:1,maxParams:2,evaluate:f=>{const d=f[0];f=2===f.length?10**f[1]:1;return null==d?null:Math.round(d*f)/f}},truncate:{minParams:1,maxParams:2,evaluate:f=>null==f[0]?null:1===f.length?parseInt(f[0].toFixed(0),10):parseFloat(f[0].toFixed(f[1]))},char_length:{minParams:1,maxParams:1,evaluate:f=>"string"===typeof f[0]||f[0]instanceof String?f[0].length:0},
concat:{minParams:1,maxParams:Infinity,evaluate:f=>{let d="";for(let e=0;e<f.length;e++){if(null==f[e])return null;d+=f[e].toString()}return d}},lower:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:f=>{for(const d of f)if(null!==d)return d;return null}},cosh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cosh(f[0])},
sinh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.sinh(f[0])},tanh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.tanh(f[0])},nullif:{minParams:2,maxParams:2,evaluate:f=>{const d=f[0];f=f[1];return(d instanceof Date?d.valueOf():d)===(f instanceof Date?f.valueOf():f)?null:d}},cast:{minParams:2,maxParams:2,evaluate:f=>{var d=f[0];f=f[1];if(null===d)return null;switch(f.type){case "integer":d=parseInt(d,10);if(isNaN(d))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return d;
case "smallint":d=parseInt(d,10);if(isNaN(d))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);if(32767<d||-32767>d)throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return d;case "float":case "real":d=parseFloat(d);if(isNaN(d))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return d;case "date":return m(d,!0);case "timestamp":return m(d,!1);case "varchar":d=d.toString();if(d.length>f.size)throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return d;default:throw new c.SqlError(c.SqlErrorCodes.InvalidDataType);
}}}};a.SqlInterval=l;a.evaluateFunction=function(f,d){const e=g[f.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(d.length<e.minParams||d.length>e.maxParams)throw Error(`Invalid Parameter count for call to ${f.toUpperCase()}`);return e.evaluate(d)};a.isStandardized=function(f,d){f=g[f.toLowerCase()];return null!=f&&d>=f.minParams&&d<=f.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../executionError"],function(a,b,c){a.SqlErrorCodes=void 0;(function(l){l.InvalidFunctionParameters="InvalidFunctionParameters";l.UnsupportedSqlFunction="UnsupportedSqlFunction";l.UnsupportedOperator="UnsupportedOperator";l.UnsupportedSyntax="UnsupportedSyntax";l.UnsupportedIsRhs="UnsupportedIsRhs";l.UnsupportedIsLhs="UnsupportedIsLhs";l.InvalidDataType="InvalidDataType";l.CannotCastValue="CannotCastValue";l.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||
(a.SqlErrorCodes={}));const w={[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",
[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};let n=function(l){function g(d,e){d=f.call(this,c.doSubstitutions(w[d],e));d.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(d),g);return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(b._wrapNativeSuper(Error));
a.FeatureSetErrorCodes=void 0;(function(l){l.NeverReach="NeverReach";l.NotImplemented="NotImplemented";l.Cancelled="Cancelled";l.InvalidStatResponse="InvalidStatResponse";l.InvalidRequest="InvalidRequest";l.RequestFailed="RequestFailed";l.MissingFeatures="MissingFeatures";l.AggregationFieldNotFound="AggregationFieldNotFound";l.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const x={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",
[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};let m=function(l){function g(d,
e){d=f.call(this,c.doSubstitutions(x[d],e));d.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(d),g);return d}b._inherits(g,l);var f=b._createSuper(g);return b._createClass(g)}(b._wrapNativeSuper(Error));a.FeatureSetError=m;a.FeatureSetErrorMessages=x;a.SqlError=n;a.SqlErrorMessages=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/executionError":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],
function(a,b){function c(k){return k&&k.loc?`Line : ${k.loc.start?.line}, ${k.loc.start?.column}: `:""}function w(k,u){try{if(!u)return k;for(const p in u){let h=u[p];h||(h="");k=k.replace("{"+p+"}",u[p])}}catch(p){}return k}a.ExecutionErrorCodes=void 0;(function(k){k.AsyncNotEnabled="AsyncNotEnabled";k.ModulesNotSupported="ModulesNotSupported";k.CircularModules="CircularModules";k.NeverReach="NeverReach";k.UnsupportedHashType="UnsupportedHashType";k.InvalidParameter="InvalidParameter";k.UnexpectedToken=
"UnexpectedToken";k.Unrecognised="Unrecognised";k.UnrecognisedType="UnrecognisedType";k.MaximumCallDepth="MaximumCallDepth";k.BooleanConditionRequired="BooleanConditionRequired";k.TypeNotAllowedInFeature="TypeNotAllowedInFeature";k.KeyMustBeString="KeyMustBeString";k.WrongNumberOfParameters="WrongNumberOfParameters";k.CallNonFunction="CallNonFunction";k.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral";k.NoFunctionInDictionary="NoFunctionInDictionary";k.NoFunctionInArray="NoFunctionInArray";
k.AssignModuleFunction="AssignModuleFunction";k.LogicExpressionOrAnd="LogicExpressionOrAnd";k.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean";k.FuncionNotFound="FunctionNotFound";k.InvalidMemberAccessKey="InvalidMemberAccessKey";k.UnsupportedUnaryOperator="UnsupportUnaryOperator";k.InvalidIdentifier="InvalidIdentifier";k.MemberOfNull="MemberOfNull";k.UnsupportedOperator="UnsupportedOperator";k.Cancelled="Cancelled";k.ModuleAccessorMustBeString="ModuleAccessorMustBeString";k.ModuleExportNotFound=
"ModuleExportNotFound";k.Immutable="Immutable";k.OutOfBounds="OutOfBounds";k.IllegalResult="IllegalResult";k.FieldNotFound="FieldNotFound";k.PortalRequired="PortalRequired";k.LogicError="LogicError";k.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber";k.KeyAccessorMustBeString="KeyAccessorMustBeString";k.WrongSpatialReference="WrongSpatialReference"})(a.ExecutionErrorCodes||(a.ExecutionErrorCodes={}));const n={[a.ExecutionErrorCodes.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",
[a.ExecutionErrorCodes.LogicError]:"Logic error - {reason}",[a.ExecutionErrorCodes.NeverReach]:"Encountered unreachable logic",[a.ExecutionErrorCodes.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[a.ExecutionErrorCodes.ModuleAccessorMustBeString]:"Module accessor must be a string",[a.ExecutionErrorCodes.ModuleExportNotFound]:"Module has no export with provided identifier",[a.ExecutionErrorCodes.ModulesNotSupported]:"Current profile does not support modules",[a.ExecutionErrorCodes.ArrayAccessorMustBeNumber]:"Array accessor must be a number",
[a.ExecutionErrorCodes.FuncionNotFound]:"Function not found",[a.ExecutionErrorCodes.FieldNotFound]:"Key not found - {key}",[a.ExecutionErrorCodes.CircularModules]:"Circular module dependencies are not allowed",[a.ExecutionErrorCodes.Cancelled]:"Execution cancelled",[a.ExecutionErrorCodes.UnsupportedHashType]:"Type not supported in hash function",[a.ExecutionErrorCodes.IllegalResult]:"Value is not a supported return type",[a.ExecutionErrorCodes.PortalRequired]:"Portal is required",[a.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",
[a.ExecutionErrorCodes.WrongNumberOfParameters]:"Call with wrong number of parameters",[a.ExecutionErrorCodes.Unrecognised]:"Unrecognised code structure",[a.ExecutionErrorCodes.UnrecognisedType]:"Unrecognised type",[a.ExecutionErrorCodes.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[a.ExecutionErrorCodes.BooleanConditionRequired]:"Conditions must use booleans",[a.ExecutionErrorCodes.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",
[a.ExecutionErrorCodes.NoFunctionInArray]:"Arrays cannot contain functions.",[a.ExecutionErrorCodes.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[a.ExecutionErrorCodes.KeyAccessorMustBeString]:"Accessor must be a string",[a.ExecutionErrorCodes.KeyMustBeString]:"Object keys must be a string",[a.ExecutionErrorCodes.Immutable]:"Object is immutable",[a.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",[a.ExecutionErrorCodes.UnexpectedToken]:"Unexpected token",
[a.ExecutionErrorCodes.MemberOfNull]:"Cannot access property of null object",[a.ExecutionErrorCodes.MaximumCallDepth]:"Exceeded maximum function depth",[a.ExecutionErrorCodes.OutOfBounds]:"Out of bounds",[a.ExecutionErrorCodes.InvalidIdentifier]:"Identifier not recognised",[a.ExecutionErrorCodes.FuncionNotFound]:"Function not found",[a.ExecutionErrorCodes.CallNonFunction]:"Expression is not a function",[a.ExecutionErrorCodes.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[a.ExecutionErrorCodes.AssignModuleFunction]:"Cannot assign function to module variable",
[a.ExecutionErrorCodes.UnsupportedUnaryOperator]:"Unsupported unary operator",[a.ExecutionErrorCodes.UnsupportedOperator]:"Unsupported operator",[a.ExecutionErrorCodes.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[a.ExecutionErrorCodes.LogicExpressionOrAnd]:"Logical expression can only be combined with || or \x26\x26"};let x=function(k){function u(...h){return p.call(this,...h)}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(b._wrapNativeSuper(Error)),m=function(k){function u(h,
r){h=p.call(this,c(r)+h.message,{cause:h});h.loc=null;Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(h),u);r&&r.loc&&(h.loc=r.loc);return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(x),l=function(k){function u(h,r,q,y){h=p.call(this,"Execution error - "+c(q)+w(n[r],y));h.loc=null;h.declaredRootClass="esri.arcade.arcadeexecutionerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(h),u);q&&q.loc&&(h.loc=q.loc);return h}
b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(b._wrapNativeSuper(Error)),g=function(k){function u(h,r,q,y){h=p.call(this,"Compilation error - "+c(q)+w(n[r],y));h.loc=null;h.declaredRootClass="esri.arcade.arcadecompilationerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(h),u);q&&q.loc&&(h.loc=q.loc);return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(b._wrapNativeSuper(Error)),f=function(k){function u(){var h=p.call(this,
"Uncompilable code structures");h.declaredRootClass="esri.arcade.arcadeuncompilableerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(h),u);return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(b._wrapNativeSuper(Error));a.ModuleErrorCodes=void 0;(function(k){k.UnrecognisedUri="UnrecognisedUri";k.UnsupportedUriProtocol="UnsupportedUriProtocol"})(a.ModuleErrorCodes||(a.ModuleErrorCodes={}));const d={[a.ModuleErrorCodes.UnrecognisedUri]:"Unrecognised uri - {uri}",
[a.ModuleErrorCodes.UnsupportedUriProtocol]:"Unrecognised uri protocol"};let e=function(k){function u(h,r){h=p.call(this,w(d[h],r));h.declaredRootClass="esri.arcade.arcademoduleerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(h),u);return h}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(b._wrapNativeSuper(Error));a.ArcadeCompilationError=g;a.ArcadeExecutionError=l;a.ArcadeUncompilableError=f;a.ErrorWithCause=x;a.ExecutionErrorMessages=n;a.LocatableArcadeExecutionError=
m;a.ModuleError=e;a.ModuleErrorMessages=d;a.doSubstitutions=w;a.ensureArcadeExecutionError=function(k,u,p){return"esri.arcade.arcadeexecutionerror"===p.declaredRootClass||"esri.arcade.arcadecompilationerror"===p.declaredRootClass?null===p.loc&&u&&u.loc?new m(p,{cause:p}):p:u&&u.loc?new m(p,{cause:p}):p};a.parsingValidationMessage=function(k,u,p){return"Parsing error - "+c(k)+w(n[u],p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../chunks/_commonjsHelpers"],function(a,b,c){var w={};(function(x){(function(m,l){x.exports&&(x.exports=l())})(c.commonjsGlobal,function(){function m(g,f,d,e){g=Error.call(this,g);Object.setPrototypeOf&&Object.setPrototypeOf(g,m.prototype);g.expected=f;g.found=d;g.location=e;g.name="SyntaxError";return g}function l(g,f,d){d=d||" ";if(g.length>f)return g;f-=g.length;d+=d.repeat(f);return g+d.slice(0,f)}(function(g,f){function d(){this.constructor=g}d.prototype=
f.prototype;g.prototype=new d})(m,Error);m.prototype.format=function(g){var f="Error: "+this.message;if(this.location){var d=null,e;for(e=0;e<g.length;e++)if(g[e].source===this.location.source){d=g[e].text.split(/\r\n|\n|\r/g);break}g=this.location.start;e=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(g):g;var k=this.location.source+":"+e.line+":"+e.column;if(d){var u=this.location.end,p=l("",e.line.toString().length," ");d=d[g.line-1];u=(g.line===
u.line?u.column:d.length+1)-g.column||1;f+="\n --\x3e "+k+"\n"+p+" |\n"+e.line+" | "+d+"\n"+p+" | "+l("",g.column-1," ")+l("",u,"^")}else f+="\n at "+k}return f};m.buildMessage=function(g,f){function d(h){return h.charCodeAt(0).toString(16).toUpperCase()}function e(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+d(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+
d(r)})}function k(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+d(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+d(r)})}function u(h){return p[h.type](h)}var p={literal:function(h){return'"'+e(h.text)+'"'},class:function(h){var r=h.parts.map(function(q){return Array.isArray(q)?k(q[0])+"-"+k(q[1]):k(q)});
return"["+(h.inverted?"^":"")+r.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(h){return h.description}};return"Expected "+function(h){h=h.map(u);var r,q;h.sort();if(0<h.length){for(q=r=1;r<h.length;r++)h[r-1]!==h[r]&&(h[q]=h[r],q++);h.length=q}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}(g)+" but "+(f?'"'+e(f)+'"':"end of input")+" found."};return{SyntaxError:m,
parse:function(g,f){function d(za,Ca){return{type:"literal",text:za,ignoreCase:Ca}}function e(za,Ca,Ja){return{type:"class",parts:za,inverted:Ca,ignoreCase:Ja}}function k(za){var Ca=Ud[za],Ja;if(!Ca){for(Ja=za-1;!Ud[Ja];)Ja--;Ca=Ud[Ja];for(Ca={line:Ca.line,column:Ca.column};Ja<za;)10===g.charCodeAt(Ja)?(Ca.line++,Ca.column=1):Ca.column++,Ja++;Ud[za]=Ca}return Ca}function u(za,Ca,Ja){var $a=k(za),jb=k(Ca);za={source:Ta,start:{offset:za,line:$a.line,column:$a.column},end:{offset:Ca,line:jb.line,column:jb.column}};
Ja&&Ta&&"function"===typeof Ta.offset&&(za.start=Ta.offset(za.start),za.end=Ta.offset(za.end));return za}function p(za){sa<jc||(sa>jc&&(jc=sa,ye=[]),ye.push(za))}function h(){var za=sa;La();var Ca=q();Ca!==la?(La(),za=Ca):(sa=za,za=la);return za}function r(){var za=sa;var Ca=q();if(Ca!==la){za=[];var Ja=sa;var $a=La();var jb=Pa();if(jb!==la){var rb=La();var sb=q();sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;for(;Ja!==la;)za.push(Ja),Ja=sa,$a=La(),jb=Pa(),jb!==la?(rb=La(),sb=q(),sb!==
la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)):(sa=Ja,Ja=la);Ja={type:"expression-list"};Ca=[Ca];for($a=0;$a<za.length;$a++)Ca.push(za[$a][3]);Ja.value=Ca;za=Ja}else sa=za,za=la;return za}function q(){var za=sa;var Ca=y();if(Ca!==la){za=[];var Ja=sa;var $a=La();var jb=ja();if(jb!==la){var rb=La();var sb=y();sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;for(;Ja!==la;)za.push(Ja),Ja=sa,$a=La(),jb=ja(),jb!==la?(rb=La(),sb=y(),sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)):(sa=Ja,Ja=la);za=Xa(Ca,za)}else sa=
za,za=la;return za}function y(){var za=sa;var Ca=B();if(Ca!==la){za=[];var Ja=sa;var $a=La();var jb=ea();if(jb!==la){var rb=La();var sb=B();sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;for(;Ja!==la;)za.push(Ja),Ja=sa,$a=La(),jb=ea(),jb!==la?(rb=La(),sb=B(),sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)):(sa=Ja,Ja=la);za=Xa(Ca,za)}else sa=za,za=la;return za}function B(){var za=sa;var Ca=ba();if(Ca===la){Ca=sa;if(33===g.charCodeAt(sa)){var Ja=ya;sa++}else Ja=la,0===Wa&&p(yd);if(Ja!==la){var $a=
sa;Wa++;if(61===g.charCodeAt(sa)){var jb=oa;sa++}else jb=la,0===Wa&&p(Dc);Wa--;jb===la?$a=void 0:(sa=$a,$a=la);$a!==la?Ca=Ja=[Ja,$a]:(sa=Ca,Ca=la)}else sa=Ca,Ca=la}Ca!==la?(Ja=La(),$a=B(),$a!==la?za={type:"unary-expression",operator:"NOT",expr:$a}:(sa=za,za=la)):(sa=za,za=la);if(za===la){Ca=sa;za=A();if(za!==la){La();Ca=[];Ja=sa;$a=La();jb=D();if(jb!==la){var rb=La();var sb=A();sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;if(Ja!==la)for(;Ja!==la;)Ca.push(Ja),Ja=sa,$a=La(),jb=D(),jb!==
la?(rb=La(),sb=A(),sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)):(sa=Ja,Ja=la);else Ca=la;Ca!==la&&(Ca={type:"arithmetic",tail:Ca});Ca===la&&(Ca=sa,Ja=v(),Ja!==la?(La(),$a=Ra(),$a!==la?(La(),$a=r(),$a!==la?(La(),jb=Sa(),jb!==la?Ca={op:Ja,right:$a}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la),Ca===la&&(Ca=sa,Ja=v(),Ja!==la?(La(),$a=Ra(),$a!==la?(La(),$a=Sa(),$a!==la?Ca={op:Ja,right:{type:"expression-list",value:[]}}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la),Ca===la&&(Ca=sa,Ja=v(),Ja!==
la?(La(),$a=R(),$a!==la?Ca={op:Ja,right:$a}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la))),Ca===la&&(Ca=sa,jb=ba(),jb!==la?(La(),Ja=ka(),Ja!==la?(La(),$a=A(),$a!==la?(La(),rb=ea(),rb!==la?(La(),jb=A(),jb!==la?Ca={op:"NOT"+Ja,right:{type:"expression-list",value:[$a,jb]}}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la),Ca===la&&(Ca=sa,jb=ka(),jb!==la?(La(),Ja=A(),Ja!==la?(La(),$a=ea(),$a!==la?(La(),rb=A(),rb!==la?Ca={op:jb,right:{type:"expression-list",value:[Ja,rb]}}:(sa=Ca,Ca=la)):(sa=Ca,
Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la)),Ca===la&&(Ca=sa,Ja=ia(),Ja!==la?(La(),$a=ba(),$a!==la?(La(),$a=A(),$a!==la?Ca={op:Ja+"NOT",right:$a}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la),Ca===la&&(Ca=sa,Ja=ia(),Ja!==la?(La(),$a=A(),$a!==la?Ca={op:Ja,right:$a}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la)),Ca===la&&(Ca=sa,Ja=z(),Ja!==la?(La(),$a=U(),$a!==la?(La(),jb=sa,g.substr(sa,6).toLowerCase()===ta?(rb=g.substr(sa,6),sa+=6):(rb=la,0===Wa&&p(ed)),rb!==la?(rb=sa,Wa++,sb=I(),Wa--,sb===la?rb=void 0:(sa=rb,rb=la),rb!==
la?jb="ESCAPE":(sa=jb,jb=la)):(sa=jb,jb=la),jb!==la?(La(),jb=N(),jb!==la?Ca={op:Ja,right:$a,escape:jb.value}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la)):(sa=Ca,Ca=la),Ca===la&&(Ca=sa,Ja=z(),Ja!==la?(La(),$a=U(),$a!==la?Ca={op:Ja,right:$a,escape:""}:(sa=Ca,Ca=la)):(sa=Ca,Ca=la))))));Ca===la&&(Ca=null);""==Ca||void 0==Ca||null==Ca?Ca=za:(Ja=null,Ca=Ja="arithmetic"==Ca.type?Xa(za,Ca.tail):Za(Ca.op,za,Ca.right,Ca.escape))}else sa=Ca,Ca=la;za=Ca}return za}function D(){if(g.substr(sa,2)===ua){var za=ua;
sa+=2}else za=la,0===Wa&&p(zd);za===la&&(62===g.charCodeAt(sa)?(za=Da,sa++):(za=la,0===Wa&&p(Ad)),za===la&&(g.substr(sa,2)===Ia?(za=Ia,sa+=2):(za=la,0===Wa&&p(Bd)),za===la&&(g.substr(sa,2)===Na?(za=Na,sa+=2):(za=la,0===Wa&&p(Cd)),za===la&&(60===g.charCodeAt(sa)?(za=ab,sa++):(za=la,0===Wa&&p(te)),za===la&&(61===g.charCodeAt(sa)?(za=oa,sa++):(za=la,0===Wa&&p(Dc)),za===la&&(g.substr(sa,2)===cb?(za=cb,sa+=2):(za=la,0===Wa&&p(ue))))))));return za}function z(){var za=za=sa;var Ca=ba();if(Ca!==la){var Ja=
La();var $a=na();$a!==la?za=Ca=[Ca,Ja,$a]:(sa=za,za=la)}else sa=za,za=la;za!==la&&(za=za[0]+" "+za[2]);za===la&&(za=na());return za}function v(){var za=za=sa;var Ca=ba();if(Ca!==la){var Ja=La();var $a=aa();$a!==la?za=Ca=[Ca,Ja,$a]:(sa=za,za=la)}else sa=za,za=la;za!==la&&(za=za[0]+" "+za[2]);za===la&&(za=aa());return za}function A(){var za=sa;var Ca=C();if(Ca!==la){za=[];var Ja=sa;var $a=La();var jb=t();if(jb!==la){var rb=La();var sb=C();sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;for(;Ja!==
la;)za.push(Ja),Ja=sa,$a=La(),jb=t(),jb!==la?(rb=La(),sb=C(),sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)):(sa=Ja,Ja=la);za=Xa(Ca,za)}else sa=za,za=la;return za}function t(){if(43===g.charCodeAt(sa)){var za=hb;sa++}else za=la,0===Wa&&p(cd);za===la&&(45===g.charCodeAt(sa)?(za=ib,sa++):(za=la,0===Wa&&p(oc)),za===la&&(g.substr(sa,2)===qb?(za=qb,sa+=2):(za=la,0===Wa&&p(zc))));return za}function C(){var za=sa;var Ca=F();if(Ca!==la){za=[];var Ja=sa;var $a=La();var jb=E();if(jb!==la){var rb=La();var sb=F();
sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;for(;Ja!==la;)za.push(Ja),Ja=sa,$a=La(),jb=E(),jb!==la?(rb=La(),sb=F(),sb!==la?Ja=$a=[$a,jb,rb,sb]:(sa=Ja,Ja=la)):(sa=Ja,Ja=la);za=Xa(Ca,za)}else sa=za,za=la;return za}function E(){if(42===g.charCodeAt(sa)){var za=pb;sa++}else za=la,0===Wa&&p(uc);za===la&&(47===g.charCodeAt(sa)?(za=Lb,sa++):(za=la,0===Wa&&p(Ec)));return za}function F(){var za=N();if(za===la){var Ca=sa;var Ja=sa;var $a=V();if($a!==la){var jb=T();if(jb!==la){var rb=X();rb!==
la?Ja=parseFloat($a+jb+rb):(sa=Ja,Ja=la)}else sa=Ja,Ja=la}else sa=Ja,Ja=la;Ja===la&&(Ja=sa,$a=V(),$a!==la?(jb=T(),jb!==la?Ja=parseFloat($a+jb):(sa=Ja,Ja=la)):(sa=Ja,Ja=la),Ja===la&&(Ja=sa,$a=V(),$a!==la?(jb=X(),jb!==la?Ja=parseFloat($a+jb):(sa=Ja,Ja=la)):(sa=Ja,Ja=la),Ja===la&&(Ja=sa,$a=V(),$a!==la&&($a=parseFloat($a)),Ja=$a)));var sb=Ja;if(sb!==la){var Vd=sa;Wa++;var of=K();Wa--;of===la?Vd=void 0:(sa=Vd,Vd=la);Vd!==la?Ca={type:"number",value:sb}:(sa=Ca,Ca=la)}else sa=Ca,Ca=la;za=Ca;if(za===la){var ld=
sa;var Ic=sa;if(g.substr(sa,4).toLowerCase()===Ab){var Wd=g.substr(sa,4);sa+=4}else Wd=la,0===Wa&&p(Hd);if(Wd!==la){var md=sa;Wa++;var pf=I();Wa--;pf===la?md=void 0:(sa=md,md=la);md!==la?Ic=Wd=[Wd,md]:(sa=Ic,Ic=la)}else sa=Ic,Ic=la;var Ac=Ic;Ac!==la&&(Ac={type:"boolean",value:!0});ld=Ac;if(ld===la){ld=sa;var Jc=sa;if(g.substr(sa,5).toLowerCase()===Fa){var Xd=g.substr(sa,5);sa+=5}else Xd=la,0===Wa&&p(Id);if(Xd!==la){var nd=sa;Wa++;var qf=I();Wa--;qf===la?nd=void 0:(sa=nd,nd=la);nd!==la?Jc=Xd=[Xd,nd]:
(sa=Jc,Jc=la)}else sa=Jc,Jc=la;Ac=Jc;Ac!==la&&(Ac={type:"boolean",value:!1});ld=Ac}za=ld;if(za===la){var Kc=sa;if(g.substr(sa,4).toLowerCase()===ob){var Yd=g.substr(sa,4);sa+=4}else Yd=la,0===Wa&&p(Gd);if(Yd!==la){var od=sa;Wa++;var rf=I();Wa--;rf===la?od=void 0:(sa=od,od=la);od!==la?Kc=Yd=[Yd,od]:(sa=Kc,Kc=la)}else sa=Kc,Kc=la;var ze=Kc;ze!==la&&(ze={type:"null",value:null});za=ze;if(za===la){var Lc=sa;if(fa()!==la){La();var Me=U();Me!==la?Lc={type:"date",value:Me.value}:(sa=Lc,Lc=la)}else sa=Lc,
Lc=la;za=Lc;if(za===la){var Mc=sa;if(ca()!==la){La();var Ne=U();Ne!==la?Mc={type:"timestamp",value:Ne.value}:(sa=Mc,Mc=la)}else sa=Mc,Mc=la;za=Mc;if(za===la){var Ub=sa;var Ae=ma();if(Ae!==la){La();if(45===g.charCodeAt(sa)){var qc=ib;sa++}else qc=la,0===Wa&&p(oc);qc===la&&(43===g.charCodeAt(sa)?(qc=hb,sa++):(qc=la,0===Wa&&p(cd)));if(qc!==la){La();var pd=U();if(pd!==la){La();var Oe=J();Oe!==la?Ub={type:"interval",value:pd,qualifier:Oe,op:qc}:(sa=Ub,Ub=la)}else sa=Ub,Ub=la}else sa=Ub,Ub=la}else sa=Ub,
Ub=la;Ub===la&&(Ub=sa,Ae=ma(),Ae!==la?(La(),qc=U(),qc!==la?(La(),pd=J(),pd!==la?Ub={type:"interval",value:qc,qualifier:pd,op:""}:(sa=Ub,Ub=la)):(sa=Ub,Ub=la)):(sa=Ub,Ub=la));za=Ub}}}}}}var Gb=za;if(Gb===la){var $b=sa;var Nc=sa;if(g.substr(sa,7).toLowerCase()===kb){var Pe=g.substr(sa,7);sa+=7}else Pe=la,0===Wa&&p(jd);if(Pe!==la){var Zd=sa;Wa++;var sf=I();Wa--;sf===la?Zd=void 0:(sa=Zd,Zd=la);Zd!==la?Nc="EXTRACT":(sa=Nc,Nc=la)}else sa=Nc,Nc=la;if(Nc!==la){La();var tf=Ra();if(tf!==la){La();var gc=qa();
gc===la&&(gc=wa(),gc===la&&(gc=xa(),gc===la&&(gc=pa(),gc===la&&(gc=ra(),gc===la&&(gc=va())))));var Qe=gc;if(Qe!==la){La();var uf=da();if(uf!==la){La();var Re=q();if(Re!==la){La();var vf=Sa();vf!==la?$b={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:Qe},Re]}}:(sa=$b,$b=la)}else sa=$b,$b=la}else sa=$b,$b=la}else sa=$b,$b=la}else sa=$b,$b=la}else sa=$b,$b=la;Gb=$b;if(Gb===la){var ac=sa;var Oc=sa;if(g.substr(sa,9).toLowerCase()===lb){var Se=g.substr(sa,9);sa+=
9}else Se=la,0===Wa&&p(Qd);if(Se!==la){var $d=sa;Wa++;var wf=I();Wa--;wf===la?$d=void 0:(sa=$d,$d=la);$d!==la?Oc="SUBSTRING":(sa=Oc,Oc=la)}else sa=Oc,Oc=la;if(Oc!==la){La();var xf=Ra();if(xf!==la){La();var Be=q();if(Be!==la){La();var yf=da();if(yf!==la){La();var Ce=q();if(Ce!==la){La();var rc=sa;var Pc=sa;if(g.substr(sa,3).toLowerCase()===gb){var Te=g.substr(sa,3);sa+=3}else Te=la,0===Wa&&p(Pd);if(Te!==la){var ae=sa;Wa++;var zf=I();Wa--;zf===la?ae=void 0:(sa=ae,ae=la);ae!==la?Pc="FOR":(sa=Pc,Pc=la)}else sa=
Pc,Pc=la;var qd=Pc;if(qd!==la){var Af=La();var Ue=q();if(Ue!==la){var Bf=La();rc=qd=[qd,Af,Ue,Bf]}else sa=rc,rc=la}else sa=rc,rc=la;rc===la&&(rc=null);qd=Sa();qd!==la?ac={type:"function",name:"substring",args:{type:"expression-list",value:rc?[Be,Ce,rc[2]]:[Be,Ce]}}:(sa=ac,ac=la)}else sa=ac,ac=la}else sa=ac,ac=la}else sa=ac,ac=la}else sa=ac,ac=la}else sa=ac,ac=la;Gb=ac;if(Gb===la){var Mb=sa;var De=ha();if(De!==la){La();var Ee=Ra();if(Ee!==la){La();var sc=O();sc===la&&(sc=null);La();var rd=q();if(rd!==
la){La();var Fe=da();if(Fe!==la){La();var Ve=q();if(Ve!==la){La();var Cf=Sa();Cf!==la?Mb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==sc?"BOTH":sc},rd,Ve]}}:(sa=Mb,Mb=la)}else sa=Mb,Mb=la}else sa=Mb,Mb=la}else sa=Mb,Mb=la}else sa=Mb,Mb=la}else sa=Mb,Mb=la;Mb===la&&(Mb=sa,De=ha(),De!==la?(La(),Ee=Ra(),Ee!==la?(La(),sc=O(),sc===la&&(sc=null),La(),rd=q(),rd!==la?(La(),Fe=Sa(),Fe!==la?Mb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",
value:null==sc?"BOTH":sc},rd]}}:(sa=Mb,Mb=la)):(sa=Mb,Mb=la)):(sa=Mb,Mb=la)):(sa=Mb,Mb=la));Gb=Mb;if(Gb===la){var bc=sa;var Qc=sa;if(g.substr(sa,8).toLowerCase()===ub){var We=g.substr(sa,8);sa+=8}else We=la,0===Wa&&p(Sd);if(We!==la){var be=sa;Wa++;var Df=I();Wa--;Df===la?be=void 0:(sa=be,be=la);be!==la?Qc="POSITION":(sa=Qc,Qc=la)}else sa=Qc,Qc=la;if(Qc!==la){La();var Ef=Ra();if(Ef!==la){La();var Xe=q();if(Xe!==la){La();var Ff=aa();if(Ff!==la){La();var Ye=q();if(Ye!==la){La();var Gf=Sa();Gf!==la?bc=
{type:"function",name:"position",args:{type:"expression-list",value:[Xe,Ye]}}:(sa=bc,bc=la)}else sa=bc,bc=la}else sa=bc,bc=la}else sa=bc,bc=la}else sa=bc,bc=la}else sa=bc,bc=la;Gb=bc;if(Gb===la){var cc=sa;var Rc=sa;if(g.substr(sa,4).toLowerCase()===Eb){var Ze=g.substr(sa,4);sa+=4}else Ze=la,0===Wa&&p(Md);if(Ze!==la){var ce=sa;Wa++;var Hf=I();Wa--;Hf===la?ce=void 0:(sa=ce,ce=la);ce!==la?Rc="CAST":(sa=Rc,Rc=la)}else sa=Rc,Rc=la;if(Rc!==la){La();var If=Ra();if(If!==la){La();var $e=q();if($e!==la){La();
var Sc=sa;if(g.substr(sa,2).toLowerCase()===wb){var af=g.substr(sa,2);sa+=2}else af=la,0===Wa&&p(Jf);if(af!==la){var de=sa;Wa++;var Kf=I();Wa--;Kf===la?de=void 0:(sa=de,de=la);de!==la?Sc="AS":(sa=Sc,Sc=la)}else sa=Sc,Sc=la;var Lf=Sc;if(Lf!==la){La();var Hb=sa;var Tc=sa;if(g.substr(sa,7).toLowerCase()===zb){var bf=g.substr(sa,7);sa+=7}else bf=la,0===Wa&&p(Mf);if(bf!==la){var ee=sa;Wa++;var Nf=I();Wa--;Nf===la?ee=void 0:(sa=ee,ee=la);ee!==la?Tc="INTEGER":(sa=Tc,Tc=la)}else sa=Tc,Tc=la;var Nb=Tc;Nb!==
la&&(Nb={type:"data-type",value:{type:"integer"}});Hb=Nb;if(Hb===la){Hb=sa;var Uc=sa;if(g.substr(sa,8).toLowerCase()===Qb){var cf=g.substr(sa,8);sa+=8}else cf=la,0===Wa&&p(Of);if(cf!==la){var fe=sa;Wa++;var Pf=I();Wa--;Pf===la?fe=void 0:(sa=fe,fe=la);fe!==la?Uc="SMALLINT":(sa=Uc,Uc=la)}else sa=Uc,Uc=la;Nb=Uc;Nb!==la&&(Nb={type:"data-type",value:{type:"smallint"}});Hb=Nb;if(Hb===la){Hb=sa;var Vc=sa;if(g.substr(sa,5).toLowerCase()===Kb){var df=g.substr(sa,5);sa+=5}else df=la,0===Wa&&p(Qf);if(df!==la){var ge=
sa;Wa++;var Rf=I();Wa--;Rf===la?ge=void 0:(sa=ge,ge=la);ge!==la?Vc="FLOAT":(sa=Vc,Vc=la)}else sa=Vc,Vc=la;Nb=Vc;Nb!==la&&(Nb={type:"data-type",value:{type:"float"}});Hb=Nb;if(Hb===la){Hb=sa;var Wc=sa;if(g.substr(sa,4).toLowerCase()===Ob){var ef=g.substr(sa,4);sa+=4}else ef=la,0===Wa&&p(Sf);if(ef!==la){var he=sa;Wa++;var Tf=I();Wa--;Tf===la?he=void 0:(sa=he,he=la);he!==la?Wc="REAL":(sa=Wc,Wc=la)}else sa=Wc,Wc=la;Nb=Wc;Nb!==la&&(Nb={type:"data-type",value:{type:"real"}});Hb=Nb;if(Hb===la&&(Hb=sa,Nb=
fa(),Nb!==la&&(Nb={type:"data-type",value:{type:"date"}}),Hb=Nb,Hb===la&&(Hb=sa,Nb=ca(),Nb!==la&&(Nb={type:"data-type",value:{type:"timestamp"}}),Hb=Nb,Hb===la))){Hb=sa;var Xc=sa;if(g.substr(sa,7).toLowerCase()===Wb){var ff=g.substr(sa,7);sa+=7}else ff=la,0===Wa&&p(Uf);if(ff!==la){var ie=sa;Wa++;var Vf=I();Wa--;Vf===la?ie=void 0:(sa=ie,ie=la);ie!==la?Xc="VARCHAR":(sa=Xc,Xc=la)}else sa=Xc,Xc=la;Nb=Xc;if(Nb!==la){La();var Wf=Ra();if(Wf!==la){La();var gf=Z();if(gf!==la){La();var Xf=Sa();Xf!==la?Hb={type:"data-type",
value:{type:"varchar",size:parseInt(gf)}}:(sa=Hb,Hb=la)}else sa=Hb,Hb=la}else sa=Hb,Hb=la}else sa=Hb,Hb=la}}}}var hf=Hb;if(hf!==la){La();var Yf=Sa();Yf!==la?cc={type:"function",name:"cast",args:{type:"expression-list",value:[$e,hf]}}:(sa=cc,cc=la)}else sa=cc,cc=la}else sa=cc,cc=la}else sa=cc,cc=la}else sa=cc,cc=la}else sa=cc,cc=la;Gb=cc;if(Gb===la){var yc=sa;var je;var hc=sa;hc=je=H();if(hc===la)if(hc=sa,96===g.charCodeAt(sa)?(je=Yc,sa++):(je=la,0===Wa&&p(jf)),je!==la){var ke=[];if(Cc.test(g.charAt(sa))){var tc=
g.charAt(sa);sa++}else tc=la,0===Wa&&p(kf);if(tc!==la)for(;tc!==la;)ke.push(tc),Cc.test(g.charAt(sa))?(tc=g.charAt(sa),sa++):(tc=la,0===Wa&&p(kf));else ke=la;ke!==la?(96===g.charCodeAt(sa)?(tc=Yc,sa++):(tc=la,0===Wa&&p(jf)),tc!==la?hc=ke.join(""):(sa=hc,hc=la)):(sa=hc,hc=la)}else sa=hc,hc=la;var lf=hc;if(lf!==la){La();var Zf=Ra();if(Zf!==la){La();var le=r();le===la&&(le=null);La();var $f=Sa();$f!==la?yc={type:"function",name:lf,args:le?le:{type:"expression-list",value:[]}}:(sa=yc,yc=la)}else sa=yc,
yc=la}else sa=yc,yc=la;Gb=yc;if(Gb===la){var kc;var Vb=sa;var Ge=Ba();if(Ge!==la){La();var sd=q();if(sd!==la){La();var td=[];for(kc=Q();kc!==la;)td.push(kc),kc=Q();kc=La();var me=Aa();me!==la?Vb={type:"case-expression",format:"simple",operand:sd,clauses:td,else:null}:(sa=Vb,Vb=la)}else sa=Vb,Vb=la}else sa=Vb,Vb=la;if(Vb===la)if(Vb=sa,Ge=Ba(),Ge!==la)if(La(),sd=q(),sd!==la){La();td=[];for(kc=Q();kc!==la;)td.push(kc),kc=Q();kc=La();me=W();if(me!==la){La();var ag=Aa();ag!==la?Vb={type:"case-expression",
format:"simple",operand:sd,clauses:td,else:me.value}:(sa=Vb,Vb=la)}else sa=Vb,Vb=la}else sa=Vb,Vb=la;else sa=Vb,Vb=la;var He=Vb;if(He===la){var lc;var Zb=sa;var Ie=Ba();if(Ie!==la){La();var ud=[];for(lc=S();lc!==la;)ud.push(lc),lc=S();lc=La();var ne=Aa();ne!==la?Zb={type:"case-expression",format:"searched",clauses:ud,else:null}:(sa=Zb,Zb=la)}else sa=Zb,Zb=la;if(Zb===la)if(Zb=sa,Ie=Ba(),Ie!==la){La();ud=[];for(lc=S();lc!==la;)ud.push(lc),lc=S();lc=La();ne=W();if(ne!==la){La();var bg=Aa();bg!==la?Zb=
{type:"case-expression",format:"searched",clauses:ud,else:ne.value}:(sa=Zb,Zb=la)}else sa=Zb,Zb=la}else sa=Zb,Zb=la;He=Zb}Gb=He;if(Gb===la){var oe;var pe=sa;var mf=K();if(mf!==la){var nf=[];for(oe=L();oe!==la;)nf.push(oe),oe=L();pe=mf+nf.join("")}else sa=pe,pe=la;var qe=pe;if(qe!==la){var Je=qe;qe=/^CURRENT_DATE$/i.test(Je)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Je)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Je}}Gb=qe;if(Gb===la&&(Gb=R(),
Gb===la)){Gb=sa;var cg=Ra();if(cg!==la){La();var Ke=q();if(Ke!==la){La();var dg=Sa();dg!==la?(Ke.paren=!0,Gb=Ke):(sa=Gb,Gb=la)}else sa=Gb,Gb=la}else sa=Gb,Gb=la}}}}}}}}}return Gb}function H(){var za;var Ca=sa;var Ja=K();if(Ja!==la){Ca=[];for(za=I();za!==la;)Ca.push(za),za=I();Ca=Ja+Ca.join("")}else sa=Ca,Ca=la;return Ca}function K(){if(se.test(g.charAt(sa))){var za=g.charAt(sa);sa++}else za=la,0===Wa&&p(Dd);return za}function I(){if(vd.test(g.charAt(sa))){var za=g.charAt(sa);sa++}else za=la,0===Wa&&
p(vc);return za}function L(){if(Zc.test(g.charAt(sa))){var za=g.charAt(sa);sa++}else za=la,0===Wa&&p(wc);return za}function R(){var za=sa;if(64===g.charCodeAt(sa)){var Ca=Tb;sa++}else Ca=la,0===Wa&&p(xc);if(Ca!==la){var Ja=H();Ja!==la?za=Ca=[Ca,Ja]:(sa=za,za=la)}else sa=za,za=la;za!==la&&(za={type:"parameter",value:za[1]});return za}function O(){var za=sa;if(g.substr(sa,7).toLowerCase()===xb){var Ca=g.substr(sa,7);sa+=7}else Ca=la,0===Wa&&p(hd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:
(sa=Ca,Ca=la);Ca!==la?za="LEADING":(sa=za,za=la)}else sa=za,za=la;za===la&&(za=sa,g.substr(sa,8).toLowerCase()===mb?(Ca=g.substr(sa,8),sa+=8):(Ca=la,0===Wa&&p(we)),Ca!==la?(Ca=sa,Wa++,Ja=I(),Wa--,Ja===la?Ca=void 0:(sa=Ca,Ca=la),Ca!==la?za="TRAILING":(sa=za,za=la)):(sa=za,za=la),za===la&&(za=sa,g.substr(sa,4).toLowerCase()===vb?(Ca=g.substr(sa,4),sa+=4):(Ca=la,0===Wa&&p(xe)),Ca!==la?(Ca=sa,Wa++,Ja=I(),Wa--,Ja===la?Ca=void 0:(sa=Ca,Ca=la),Ca!==la?za="BOTH":(sa=za,za=la)):(sa=za,za=la)));return za}function J(){var za=
sa;var Ca=sa;var Ja=M();if(Ja!==la){La();var $a=Ra();if($a!==la)if(La(),$a=P(),$a!==la){La();var jb=Sa();jb!==la?Ca={type:"interval-period",period:Ja.value,precision:$a,secondary:null}:(sa=Ca,Ca=la)}else sa=Ca,Ca=la;else sa=Ca,Ca=la}else sa=Ca,Ca=la;Ca===la&&(Ca=sa,Ja=M(),Ja!==la&&(Ja={type:"interval-period",period:Ja.value,precision:null,secondary:null}),Ca=Ja);if(Ca!==la)if(La(),Ja=sa,g.substr(sa,2).toLowerCase()===Rb?($a=g.substr(sa,2),sa+=2):($a=la,0===Wa&&p(eg)),$a!==la?($a=sa,Wa++,jb=I(),Wa--,
jb===la?$a=void 0:(sa=$a,$a=la),$a!==la?Ja="TO":(sa=Ja,Ja=la)):(sa=Ja,Ja=la),Ja!==la){La();Ja=sa;$a=M();$a!==la&&($a={type:"interval-period",period:$a.value,precision:null,secondary:null});Ja=$a;if(Ja===la){Ja=sa;$a=va();if($a!==la)if(La(),$a=Ra(),$a!==la)if(La(),$a=P(),$a!==la)if(La(),jb=Pa(),jb!==la)if(La(),jb=G(),jb!==la){La();var rb=Sa();rb!==la?Ja={type:"interval-period",period:"second",precision:$a,secondary:jb}:(sa=Ja,Ja=la)}else sa=Ja,Ja=la;else sa=Ja,Ja=la;else sa=Ja,Ja=la;else sa=Ja,Ja=
la;else sa=Ja,Ja=la;Ja===la&&(Ja=sa,$a=va(),$a!==la?(La(),$a=Ra(),$a!==la?(La(),$a=P(),$a!==la?(La(),jb=Sa(),jb!==la?Ja={type:"interval-period",period:"second",precision:$a,secondary:null}:(sa=Ja,Ja=la)):(sa=Ja,Ja=la)):(sa=Ja,Ja=la)):(sa=Ja,Ja=la),Ja===la&&(Ja=sa,$a=va(),$a!==la&&($a={type:"interval-period",period:"second",precision:null,secondary:null}),Ja=$a))}Ja!==la?za={type:"interval-qualifier",start:Ca,end:Ja}:(sa=za,za=la)}else sa=za,za=la;else sa=za,za=la;za===la&&(za=sa,Ja=M(),Ja!==la?(La(),
Ca=Ra(),Ca!==la?(La(),Ca=G(),Ca!==la?(La(),$a=Sa(),$a!==la?za={type:"interval-period",period:Ja.value,precision:Ca,secondary:null}:(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la),za===la&&(za=sa,Ja=M(),Ja!==la&&(Ja={type:"interval-period",period:Ja.value,precision:null,secondary:null}),za=Ja,za===la&&(za=sa,Ja=va(),Ja!==la?(La(),Ca=Ra(),Ca!==la?(La(),Ca=P(),Ca!==la?(La(),$a=Pa(),$a!==la?(La(),Ja=G(),Ja!==la?(La(),$a=Sa(),$a!==la?za={type:"interval-period",period:"second",precision:Ca,secondary:Ja}:
(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la),za===la&&(za=sa,Ja=va(),Ja!==la?(La(),Ca=Ra(),Ca!==la?(La(),Ca=G(),Ca!==la?(La(),$a=Sa(),$a!==la?za={type:"interval-period",period:"second",precision:Ca,secondary:null}:(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la)):(sa=za,za=la),za===la&&(za=sa,Ja=va(),Ja!==la&&(Ja={type:"interval-period",period:"second",precision:null,secondary:null}),za=Ja)))));return za}function M(){var za=sa;za=xa();za!==la&&(za={type:"string",
value:"day"});za===la&&(za=sa,za=pa(),za!==la&&(za={type:"string",value:"hour"}),za===la&&(za=sa,za=ra(),za!==la&&(za={type:"string",value:"minute"}),za===la&&(za=sa,za=wa(),za!==la&&(za={type:"string",value:"month"}),za===la&&(za=sa,za=qa(),za!==la&&(za={type:"string",value:"year"})))));return za}function G(){var za=Z();za!==la&&(za=parseFloat(za));return za}function P(){var za=Z();za!==la&&(za=parseFloat(za));return za}function U(){var za=N();za===la&&(za=R());return za}function N(){var za=sa;if(39===
g.charCodeAt(sa)){var Ca=tb;sa++}else Ca=la,0===Wa&&p(Fc);Ca===la&&(g.substr(sa,2)===Cb?(Ca=Cb,sa+=2):(Ca=la,0===Wa&&p(dd)));if(Ca!==la){Ca=[];var Ja=sa;g.substr(sa,2)===Ib?(Ja=Ib,sa+=2):(Ja=la,0===Wa&&p(Gc));Ja!==la&&(Ja="'");Ja===la&&($c.test(g.charAt(sa))?(Ja=g.charAt(sa),sa++):(Ja=la,0===Wa&&p(Hc)));for(;Ja!==la;)Ca.push(Ja),Ja=sa,g.substr(sa,2)===Ib?(Ja=Ib,sa+=2):(Ja=la,0===Wa&&p(Gc)),Ja!==la&&(Ja="'"),Ja===la&&($c.test(g.charAt(sa))?(Ja=g.charAt(sa),sa++):(Ja=la,0===Wa&&p(Hc)));39===g.charCodeAt(sa)?
(Ja=tb,sa++):(Ja=la,0===Wa&&p(Fc));Ja!==la?za={type:"string",value:Ca.join("")}:(sa=za,za=la)}else sa=za,za=la;return za}function S(){var za=sa;if(Ha()!==la){La();var Ca=q();if(Ca!==la){La();var Ja=Ka();Ja!==la?(La(),Ja=q(),Ja!==la?za={type:"when-clause",operand:Ca,value:Ja}:(sa=za,za=la)):(sa=za,za=la)}else sa=za,za=la}else sa=za,za=la;return za}function Q(){var za=sa;if(Ha()!==la){La();var Ca=q();if(Ca!==la){La();var Ja=Ka();Ja!==la?(La(),Ja=q(),Ja!==la?za={type:"when-clause",operand:Ca,value:Ja}:
(sa=za,za=la)):(sa=za,za=la)}else sa=za,za=la}else sa=za,za=la;return za}function W(){var za=sa;var Ca=sa;if(g.substr(sa,4).toLowerCase()===mc){var Ja=g.substr(sa,4);sa+=4}else Ja=la,0===Wa&&p(fg);if(Ja!==la){Ja=sa;Wa++;var $a=I();Wa--;$a===la?Ja=void 0:(sa=Ja,Ja=la);Ja!==la?Ca="ELSE":(sa=Ca,Ca=la)}else sa=Ca,Ca=la;Ca!==la?(La(),Ca=q(),Ca!==la?za={type:"else-clause",value:Ca}:(sa=za,za=la)):(sa=za,za=la);return za}function V(){var za=Z();if(za===la){za=sa;if(45===g.charCodeAt(sa)){var Ca=ib;sa++}else Ca=
la,0===Wa&&p(oc);Ca===la&&(43===g.charCodeAt(sa)?(Ca=hb,sa++):(Ca=la,0===Wa&&p(cd)));if(Ca!==la){var Ja=Z();Ja!==la?za=Ca[0]+Ja:(sa=za,za=la)}else sa=za,za=la}return za}function T(){var za=sa;if(46===g.charCodeAt(sa)){var Ca=bb;sa++}else Ca=la,0===Wa&&p(pc);Ca!==la?(za=Z(),za===la&&(za=null),za="."+(null!=za?za:"")):(sa=za,za=la);return za}function X(){var za;var Ca=za=sa;if(xd.test(g.charAt(sa))){var Ja=g.charAt(sa);sa++}else Ja=la,0===Wa&&p(ve);Ja!==la?(ad.test(g.charAt(sa))?(Ca=g.charAt(sa),sa++):
(Ca=la,0===Wa&&p(Fd)),Ca===la&&(Ca=null),Ca="e"+(null===Ca?"":Ca)):(sa=Ca,Ca=la);Ca!==la?(Ja=Z(),Ja!==la?za=Ca+Ja:(sa=za,za=la)):(sa=za,za=la);return za}function Z(){var za=[];var Ca=Y();if(Ca!==la)for(;Ca!==la;)za.push(Ca),Ca=Y();else za=la;za!==la&&(za=za.join(""));return za}function Y(){if(wd.test(g.charAt(sa))){var za=g.charAt(sa);sa++}else za=la,0===Wa&&p(Ed);return za}function aa(){var za=sa;if(g.substr(sa,2).toLowerCase()===Ea){var Ca=g.substr(sa,2);sa+=2}else Ca=la,0===Wa&&p(Jd);if(Ca!==la){Ca=
sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="IN":(sa=za,za=la)}else sa=za,za=la;return za}function ia(){var za=sa;if(g.substr(sa,2).toLowerCase()===Va){var Ca=g.substr(sa,2);sa+=2}else Ca=la,0===Wa&&p(Kd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="IS":(sa=za,za=la)}else sa=za,za=la;return za}function na(){var za=sa;if(g.substr(sa,4).toLowerCase()===db){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(Ld);if(Ca!==la){Ca=sa;Wa++;var Ja=
I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="LIKE":(sa=za,za=la)}else sa=za,za=la;return za}function ba(){var za=sa;if(g.substr(sa,3).toLowerCase()===Ga){var Ca=g.substr(sa,3);sa+=3}else Ca=la,0===Wa&&p(fd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="NOT":(sa=za,za=la)}else sa=za,za=la;return za}function ea(){var za=sa;if(g.substr(sa,3).toLowerCase()===Oa){var Ca=g.substr(sa,3);sa+=3}else Ca=la,0===Wa&&p(gd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===
la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="AND":(sa=za,za=la)}else sa=za,za=la;return za}function ja(){var za=sa;if(g.substr(sa,2).toLowerCase()===Qa){var Ca=g.substr(sa,2);sa+=2}else Ca=la,0===Wa&&p(id);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="OR":(sa=za,za=la)}else sa=za,za=la;return za}function ka(){var za=sa;if(g.substr(sa,7).toLowerCase()===Ya){var Ca=g.substr(sa,7);sa+=7}else Ca=la,0===Wa&&p(Nd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=
Ca,Ca=la);Ca!==la?za="BETWEEN":(sa=za,za=la)}else sa=za,za=la;return za}function da(){var za=sa;if(g.substr(sa,4).toLowerCase()===eb){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(Od);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="FROM":(sa=za,za=la)}else sa=za,za=la;return za}function ha(){var za=sa;if(g.substr(sa,4).toLowerCase()===nb){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(Rd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);
Ca!==la?za="TRIM":(sa=za,za=la)}else sa=za,za=la;return za}function ca(){var za=sa;if(g.substr(sa,9).toLowerCase()===Jb){var Ca=g.substr(sa,9);sa+=9}else Ca=la,0===Wa&&p(Td);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="TIMESTAMP":(sa=za,za=la)}else sa=za,za=la;return za}function fa(){var za=sa;if(g.substr(sa,4).toLowerCase()===Bb){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(kd);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?
za="DATE":(sa=za,za=la)}else sa=za,za=la;return za}function ma(){var za=sa;if(g.substr(sa,8).toLowerCase()===Fb){var Ca=g.substr(sa,8);sa+=8}else Ca=la,0===Wa&&p(gg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="INTERVAL":(sa=za,za=la)}else sa=za,za=la;return za}function qa(){var za=sa;if(g.substr(sa,4).toLowerCase()===Sb){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(hg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="YEAR":
(sa=za,za=la)}else sa=za,za=la;return za}function wa(){var za=sa;if(g.substr(sa,5).toLowerCase()===Yb){var Ca=g.substr(sa,5);sa+=5}else Ca=la,0===Wa&&p(ig);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="MONTH":(sa=za,za=la)}else sa=za,za=la;return za}function xa(){var za=sa;if(g.substr(sa,3).toLowerCase()===dc){var Ca=g.substr(sa,3);sa+=3}else Ca=la,0===Wa&&p(jg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="DAY":(sa=za,za=la)}else sa=
za,za=la;return za}function pa(){var za=sa;if(g.substr(sa,4).toLowerCase()===yb){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(kg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="HOUR":(sa=za,za=la)}else sa=za,za=la;return za}function ra(){var za=sa;if(g.substr(sa,6).toLowerCase()===fc){var Ca=g.substr(sa,6);sa+=6}else Ca=la,0===Wa&&p(lg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="MINUTE":(sa=za,za=la)}else sa=za,za=la;
return za}function va(){var za=sa;if(g.substr(sa,6).toLowerCase()===Db){var Ca=g.substr(sa,6);sa+=6}else Ca=la,0===Wa&&p(mg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="SECOND":(sa=za,za=la)}else sa=za,za=la;return za}function Ba(){var za=sa;if(g.substr(sa,4).toLowerCase()===Pb){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(ng);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="CASE":(sa=za,za=la)}else sa=za,za=la;return za}
function Aa(){var za=sa;if(g.substr(sa,3).toLowerCase()===Xb){var Ca=g.substr(sa,3);sa+=3}else Ca=la,0===Wa&&p(og);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="END":(sa=za,za=la)}else sa=za,za=la;return za}function Ha(){var za=sa;if(g.substr(sa,4).toLowerCase()===ec){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(pg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="WHEN":(sa=za,za=la)}else sa=za,za=la;return za}function Ka(){var za=
sa;if(g.substr(sa,4).toLowerCase()===ic){var Ca=g.substr(sa,4);sa+=4}else Ca=la,0===Wa&&p(qg);if(Ca!==la){Ca=sa;Wa++;var Ja=I();Wa--;Ja===la?Ca=void 0:(sa=Ca,Ca=la);Ca!==la?za="THEN":(sa=za,za=la)}else sa=za,za=la;return za}function Pa(){if(44===g.charCodeAt(sa)){var za=nc;sa++}else za=la,0===Wa&&p(rg);return za}function Ra(){if(40===g.charCodeAt(sa)){var za=Bc;sa++}else za=la,0===Wa&&p(sg);return za}function Sa(){if(41===g.charCodeAt(sa)){var za=re;sa++}else za=la,0===Wa&&p(tg);return za}function La(){var za;
var Ca=[];for(za=Ua();za!==la;)Ca.push(za),za=Ua();return Ca}function Ua(){if(bd.test(g.charAt(sa))){var za=g.charAt(sa);sa++}else za=la,0===Wa&&p(ug);return za}function Za(za,Ca,Ja,$a){za={type:"binary-expression",operator:za,left:Ca,right:Ja};void 0!==$a&&(za.escape=$a);return za}function Xa(za,Ca){for(var Ja=0;Ja<Ca.length;Ja++)za=Za(Ca[Ja][1],za,Ca[Ja][3]);return za}f=void 0!==f?f:{};var la={},Ta=f.grammarSource,Ma={start:h},fb=h,ya="!",oa="\x3d",ua="\x3e\x3d",Da="\x3e",Ia="\x3c\x3d",Na="\x3c\x3e",
ab="\x3c",cb="!\x3d",hb="+",ib="-",qb="||",pb="*",Lb="/",Tb="@",tb="'",Cb="N'",Ib="''",bb=".",ob="null",Ab="true",Fa="false",Ea="in",Va="is",db="like",ta="escape",Ga="not",Oa="and",Qa="or",Ya="between",eb="from",gb="for",lb="substring",kb="extract",nb="trim",ub="position",Jb="timestamp",Bb="date",xb="leading",mb="trailing",vb="both",Eb="cast",wb="as",zb="integer",Qb="smallint",Kb="float",Ob="real",Wb="varchar",Rb="to",Fb="interval",Sb="year",Yb="month",dc="day",yb="hour",fc="minute",Db="second",Pb=
"case",Xb="end",ec="when",ic="then",mc="else",nc=",",Bc="(",re=")",Yc="`",se=/^[A-Za-z_\x80-\uFFFF]/,vd=/^[A-Za-z0-9_]/,Zc=/^[A-Za-z0-9_.\x80-\uFFFF]/,$c=/^[^']/,wd=/^[0-9]/,xd=/^[eE]/,ad=/^[+\-]/,bd=/^[ \t\n\r]/,Cc=/^[^`]/,yd=d("!",!1),Dc=d("\x3d",!1),zd=d("\x3e\x3d",!1),Ad=d("\x3e",!1),Bd=d("\x3c\x3d",!1),Cd=d("\x3c\x3e",!1),te=d("\x3c",!1),ue=d("!\x3d",!1),cd=d("+",!1),oc=d("-",!1),zc=d("||",!1),uc=d("*",!1),Ec=d("/",!1),Dd=e([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),vc=e([["A","Z"],
["a","z"],["0","9"],"_"],!1,!1),wc=e([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),xc=d("@",!1),Fc=d("'",!1),dd=d("N'",!1),Gc=d("''",!1),Hc=e(["'"],!0,!1),pc=d(".",!1),Ed=e([["0","9"]],!1,!1),ve=e(["e","E"],!1,!1),Fd=e(["+","-"],!1,!1),Gd=d("NULL",!0),Hd=d("TRUE",!0),Id=d("FALSE",!0),Jd=d("IN",!0),Kd=d("IS",!0),Ld=d("LIKE",!0),ed=d("ESCAPE",!0),fd=d("NOT",!0),gd=d("AND",!0),id=d("OR",!0),Nd=d("BETWEEN",!0),Od=d("FROM",!0),Pd=d("FOR",!0),Qd=d("SUBSTRING",!0),jd=d("EXTRACT",!0),
Rd=d("TRIM",!0),Sd=d("POSITION",!0),Td=d("TIMESTAMP",!0),kd=d("DATE",!0),hd=d("LEADING",!0),we=d("TRAILING",!0),xe=d("BOTH",!0),Md=d("CAST",!0),Jf=d("AS",!0),Mf=d("INTEGER",!0),Of=d("SMALLINT",!0),Qf=d("FLOAT",!0),Sf=d("REAL",!0),Uf=d("VARCHAR",!0),eg=d("TO",!0),gg=d("INTERVAL",!0),hg=d("YEAR",!0),ig=d("MONTH",!0),jg=d("DAY",!0),kg=d("HOUR",!0),lg=d("MINUTE",!0),mg=d("SECOND",!0),ng=d("CASE",!0),og=d("END",!0),pg=d("WHEN",!0),qg=d("THEN",!0),fg=d("ELSE",!0),rg=d(",",!1),sg=d("(",!1),tg=d(")",!1),
ug=e([" ","\t","\n","\r"],!1,!1),jf=d("`",!1),kf=e(["`"],!0,!1),sa=0,Ud=[{line:1,column:1}],jc=0,ye=[],Wa=0;if("startRule"in f){if(!(f.startRule in Ma))throw Error("Can't start parsing from rule \""+f.startRule+'".');fb=Ma[f.startRule]}var Le=fb();if(Le!==la&&sa===g.length)return Le;Le!==la&&sa<g.length&&p({type:"end"});throw function(za,Ca,Ja){return new m(m.buildMessage(za,Ca),za,Ca,Ja)}(ye,jc<g.length?g.charAt(jc):null,jc<g.length?u(jc,jc+1):u(jc,jc));}}})})({get exports(){return w},set exports(x){w=
x}});let n=function(){function x(){}x.parse=function(m){return w.parse(m)};return b._createClass(x)}();a.WhereGrammar=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,
b,c,w,n,x,m){function l(p,h){if(!h)return null;if("x"in h){var r={x:0,y:0};[r.x,r.y]=p(h.x,h.y,d);null!=h.z&&(r.z=h.z);null!=h.m&&(r.m=h.m);return r}return"xmin"in h?(r={xmin:0,ymin:0,xmax:0,ymax:0},[r.xmin,r.ymin]=p(h.xmin,h.ymin,d),[r.xmax,r.ymax]=p(h.xmax,h.ymax,d),h.hasZ&&(r.zmin=h.zmin,r.zmax=h.zmax,r.hasZ=!0),h.hasM&&(r.mmin=h.mmin,r.mmax=h.mmax,r.hasM=!0),r):"rings"in h?{rings:g(h.rings,p),hasM:h.hasM,hasZ:h.hasZ}:"paths"in h?{paths:g(h.paths,p),hasM:h.hasM,hasZ:h.hasZ}:"points"in h?{points:f(h.points,
p),hasM:h.hasM,hasZ:h.hasZ}:null}function g(p,h){const r=[];for(const q of p)r.push(f(q,h));return r}function f(p,h){const r=[];for(const q of p)p=h(q[0],q[1],[0,0]),r.push(p),2<q.length&&p.push(q[2]),3<q.length&&p.push(q[3]);return r}const d=[0,0],e=l.bind(null,m.lngLatToXY),k=l.bind(null,m.xyToLngLat),u=new (function(){function p(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var h=p.prototype;h.push=async function(r,q,y){if(!(r&&r.length&&q&&y)||x.equals(q,y))return r;
const B={geometries:r,inSpatialReference:q,outSpatialReference:y,resolve:null};this._jobs.push(B);return new Promise(D=>{B.resolve=D;null===this._timer&&(this._timer=setTimeout(this._process,10))})};h._process=function(){this._timer=null;const r=this._jobs.shift();if(r){var {geometries:q,inSpatialReference:y,outSpatialReference:B,resolve:D}=r;m.canProject(y,B)?x.isWebMercator(B)?D(q.map(e)):D(q.map(k)):D(w.projectMany(n.jsonAdapter,q,y,B,null,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}};return b._createClass(p)}());a.checkProjectionSupport=async function(p,h){p&&h&&(p=Array.isArray(p)?p.map(r=>c.isSome(r.geometry)?r.geometry.spatialReference:null).filter(c.isSome):[p],await w.initializeProjection(p.map(r=>({source:r,dest:h}))))};a.project=function(p,h,r,q){if(!p)return p;r||(r=h,h=p.spatialReference);return x.isValid(h)&&x.isValid(r)&&!x.equals(h,r)?m.canProject(h,r)?(p=x.isWebMercator(r)?e(p):k(p),p.spatialReference=r,p):w.projectMany(n.jsonAdapter,[p],h,r,null,q)[0]:p};
a.projectMany=function(p,h,r){return u.push(p,h,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(l,g,f){this.x=l;this.y=g;this.spatialReference=f;this.m=this.z=void 0}),w=b._createClass(function(l,g,f,d){this.rings=l;this.spatialReference=g;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);d&&(this.hasM=d)}),n=b._createClass(function(l,
g,f,d){this.paths=l;this.spatialReference=g;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);d&&(this.hasM=d)}),x=b._createClass(function(l,g,f,d){this.points=l;this.spatialReference=g;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);d&&(this.hasM=d)}),m=b._createClass(function(l,g,f,d,e){this.xmin=l;this.ymin=g;this.xmax=f;this.ymax=d;this.spatialReference=e;this.mmax=this.mmin=this.zmax=this.zmin=void 0});a.jsonAdapter={convertToGEGeometry:function(l,g){return null==g?null:l.convertJSONToGeometry(g)},exportPoint:function(l,
g,f){f=new c(l.getPointX(g),l.getPointY(g),f);const d=l.hasZ(g),e=l.hasM(g);d&&(f.z=l.getPointZ(g));e&&(f.m=l.getPointM(g));return f},exportPolygon:function(l,g,f){return new w(l.exportPaths(g),f,l.hasZ(g),l.hasM(g))},exportPolyline:function(l,g,f){return new n(l.exportPaths(g),f,l.hasZ(g),l.hasM(g))},exportMultipoint:function(l,g,f){return new x(l.exportPoints(g),f,l.hasZ(g),l.hasM(g))},exportExtent:function(l,g,f){var d=l.hasZ(g);const e=l.hasM(g);f=new m(l.getXMin(g),l.getYMin(g),l.getXMax(g),
l.getYMax(g),f);d&&(d=l.getZExtent(g),f.zmin=d.vmin,f.zmax=d.vmax);e&&(l=l.getMExtent(g),f.mmin=l.vmin,f.mmax=l.vmax);return f}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./projectionSupport ./SnappingCandidate ./utils ../../support/fieldUtils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){function h(B,D,z,v){const A=v.x-z.x;v=v.y-z.y;D=Math.min(1,Math.max(0,((D.x-z.x)*A+(D.y-z.y)*v)/(A*A+v*v)));B.x=z.x+A*D;B.y=z.y+v*D}function r(B,D){return B?D?4:3:D?3:2}let q=function(){function B(z,v,A){this.items=z;this.query=v;this.geometryType=A.geometryType;this.hasM=A.hasM;this.hasZ=A.hasZ;this.fieldsIndex=A.fieldsIndex;this.objectIdField=A.objectIdField;this.spatialReference=A.spatialReference;this.featureAdapter=A.featureAdapter}var D=B.prototype;D.createQueryResponseForCount=
function(){const z=new g(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return z.countDistinctValues(this.items);const {groupByFieldsForStatistics:v,having:A,outStatistics:t}=this.query;if(!v?.length)return 1;const C=new Map,E=new Map,F=new Set;for(const I of t){var {statisticType:H}=I;H="exceedslimit"!==H?I.onStatisticField:void 0;if(!E.has(H)){var K=[];for(const L of v){const R=this._getAttributeValues(z,L,C);K.push(R)}E.set(H,this._calculateUniqueValues(K,z.returnDistinctValues))}H=
E.get(H);for(const L in H){const {data:R,items:O}=H[L];K=R.join(",");A&&!z.validateItems(O,A)||F.add(K)}}return F.size};D.createQueryResponse=async function(){let z;z=this.query.outStatistics?this.query.outStatistics.some(v=>"exceedslimit"===v.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const v=this.query.geometry;l.isValid(this.query.outSR)&&!l.equals(v.spatialReference,
this.query.outSR)?z.queryGeometry=e.cleanFromGeometryEngine({spatialReference:this.query.outSR,...f.project(v,v.spatialReference,this.query.outSR)}):z.queryGeometry=e.cleanFromGeometryEngine({spatialReference:this.query.outSR,...v})}return z};D.createSnappingResponse=function(z,v){const A=this.featureAdapter,t=r(this.hasZ,this.hasM),{point:C,mode:E}=z,F="number"===typeof z.distance?z.distance:z.distance.x,H="number"===typeof z.distance?z.distance:z.distance.y,K={candidates:[]},I="esriGeometryPolygon"===
this.geometryType;v=this._getPointCreator(E,this.spatialReference,v);const L=new y(null,0),R=new y(null,0),O={x:0,y:0,z:0};for(const S of this.items){var J=A.getGeometry(S);if(w.isNone(J))continue;const {coords:Q,lengths:W}=J;L.coords=Q;R.coords=Q;if(z.types&b.SnappingTypes.EDGE){J=0;for(var M=0;M<W.length;M++){var G=W[M];for(var P=0;P<G;P++,J+=t){var U=L;U.coordsIndex=J;if(P!==G-1){const V=R;V.coordsIndex=J+t;const T=O;h(O,C,U,V);var N=(C.x-T.x)/F;const X=(C.y-T.y)/H;N=N*N+X*X;1>=N&&K.candidates.push(d.makeEdgeCandidate(A.getObjectId(S),
v(T),Math.sqrt(N),v(U),v(V)))}}}}if(z.types&b.SnappingTypes.VERTEX)for(J=I?Q.length-t:Q.length,M=0;M<J;M+=t)G=L,G.coordsIndex=M,P=(C.x-G.x)/F,U=(C.y-G.y)/H,P=P*P+U*U,1>=P&&K.candidates.push(d.makeVertexCandidate(A.getObjectId(S),v(G),Math.sqrt(P)))}K.candidates.sort((S,Q)=>S.distance-Q.distance);return K};D._getPointCreator=function(z,v,A){const t=w.isSome(A)&&!l.equals(v,A)?E=>f.project(E,v,A):E=>E,{hasZ:C}=this;return"3d"===z?C?({x:E,y:F,z:H})=>t({x:E,y:F,z:H}):({x:E,y:F})=>t({x:E,y:F,z:0}):({x:E,
y:F})=>t({x:E,y:F})};D.createSummaryStatisticsResponse=async function(z){const {field:v,valueExpression:A,normalizationField:t,normalizationType:C,normalizationTotal:E,minValue:F,maxValue:H,scale:K}=z;z=this.fieldsIndex.isDateField(v);var I=await this._getDataValues({field:v,valueExpression:A,normalizationField:t,normalizationType:C,normalizationTotal:E,scale:K});const L=u.isNullCountSupported({normalizationType:C,normalizationField:t,minValue:F,maxValue:H}),R=this.fieldsIndex.get(v),O={value:.5,
fieldType:R?.type};I=k.isStringField(R)?u.calculateStringStatistics({values:I,supportsNullCount:L,percentileParams:O}):u.calculateStatistics({values:I,minValue:F,maxValue:H,useSampleStdDev:!C,supportsNullCount:L,percentileParams:O});return u.processSummaryStatisticsResult(I,z)};D.createUniqueValuesResponse=async function(z){const {field:v,valueExpression:A,domains:t,returnAllCodedValues:C,scale:E}=z;var F=await this._getDataValues({field:v,field2:z.field2,field3:z.field3,fieldDelimiter:z.fieldDelimiter,
valueExpression:A,scale:E});F=u.calculateUniqueValuesCount(F);return u.createUVResult(F,t,C,z.fieldDelimiter)};D.createClassBreaksResponse=async function(z){const {field:v,valueExpression:A,normalizationField:t,normalizationType:C,normalizationTotal:E,classificationMethod:F,standardDeviationInterval:H,minValue:K,maxValue:I,numClasses:L,scale:R}=z;z=await this._getDataValues({field:v,valueExpression:A,normalizationField:t,normalizationType:C,normalizationTotal:E,scale:R});z=u.calculateClassBreaks(z,
{field:v,normalizationField:t,normalizationType:C,normalizationTotal:E,classificationMethod:F,standardDeviationInterval:H,minValue:K,maxValue:I,numClasses:L});return u.resolveCBResult(z,F)};D.createHistogramResponse=async function(z){const {field:v,valueExpression:A,normalizationField:t,normalizationType:C,normalizationTotal:E,classificationMethod:F,standardDeviationInterval:H,minValue:K,maxValue:I,numBins:L,scale:R}=z;z=await this._getDataValues({field:v,valueExpression:A,normalizationField:t,normalizationType:C,
normalizationTotal:E,scale:R});return u.calculateHistogram(z,{field:v,normalizationField:t,normalizationType:C,normalizationTotal:E,classificationMethod:F,standardDeviationInterval:H,minValue:K,maxValue:I,numBins:L})};D._sortFeatures=function(z,v,A){if(1<z.length&&v&&v.length)for(const t of v.reverse()){v=t.split(" ");const C=v[0],E=this.fieldsIndex.get(C);v=v[1]?"desc"===v[1].toLowerCase():!1;const F=u.getAttributeComparator(E?.type,v);z.sort((H,K)=>{H=A(H,C,E);K=A(K,C,E);return F(H,K)})}};D._createFeatureQueryResponse=
function(z){const v=this.items,{geometryType:A,hasM:t,hasZ:C,objectIdField:E,spatialReference:F}=this,{outFields:H,outSR:K,quantizationParameters:I,resultRecordCount:L,resultOffset:R,returnZ:O,returnM:J}=z,M=null!=L?v.length>(R||0)+L:!1,G=H&&(H.includes("*")?[...this.fieldsIndex.fields]:H.map(P=>this.fieldsIndex.get(P)));return{exceededTransferLimit:M,features:this._createFeatures(z,v),fields:G,geometryType:A,hasM:t&&J,hasZ:C&&O,objectIdFieldName:E,spatialReference:e.cleanFromGeometryEngine(K||F),
transform:I&&m.toQuantizationTransform(I)||null}};D._createFeatures=function(z,v){const A=new g(z,this.featureAdapter,this.fieldsIndex),{hasM:t,hasZ:C}=this,{orderByFields:E,quantizationParameters:F,returnGeometry:H,returnCentroid:K,maxAllowableOffset:I,resultOffset:L,resultRecordCount:R,returnZ:O=!1,returnM:J=!1}=z,M=C&&O,G=t&&J;z=[];var P=0;v=[...v];this._sortFeatures(v,E,(S,Q,W)=>A.getFieldValue(S,Q,W));if(H||K){var U=m.toQuantizationTransform(F)??void 0;if(H&&!K)for(var N of v)z[P++]={attributes:A.getAttributes(N),
geometry:e.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(N),I,U,M,G)};else if(!H&&K)for(const S of v)z[P++]={attributes:A.getAttributes(S),centroid:e.transformCentroid(this,this.featureAdapter.getCentroid(S,this),U)};else for(const S of v)z[P++]={attributes:A.getAttributes(S),centroid:e.transformCentroid(this,this.featureAdapter.getCentroid(S,this),U),geometry:e.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),I,U,M,G)}}else for(U of v)(N=
A.getAttributes(U))&&(z[P++]={attributes:N});P=L||0;null!=R&&(z=z.slice(P,Math.min(z.length,P+R)));return z};D._createExceedsLimitQueryResponse=function(z){var v=!1;let A=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY;v=Number.POSITIVE_INFINITY;for(const C of z.outStatistics??[])if("exceedslimit"===C.statisticType){A=null!=C.maxPointCount?C.maxPointCount:Number.POSITIVE_INFINITY;t=null!=C.maxRecordCount?C.maxRecordCount:Number.POSITIVE_INFINITY;v=null!=C.maxVertexCount?C.maxVertexCount:Number.POSITIVE_INFINITY;
break}if("esriGeometryPoint"===this.geometryType)v=this.items.length>A;else if(this.items.length>t)v=!0;else{z=r(this.hasZ,this.hasM);const C=this.featureAdapter;v=this.items.reduce((E,F)=>{F=C.getGeometry(F);return E+(w.isSome(F)&&F.coords.length||0)},0)/z>v}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(v)}}]}};D._createStatisticsQueryResponse=async function(z){var v=
{attributes:{}};const A=[],t=new Map,C=new Map,E=new Map,F=new Map,H=new g(z,this.featureAdapter,this.fieldsIndex);var K=z.outStatistics;const {groupByFieldsForStatistics:I,having:L,orderByFields:R}=z;z=I&&I.length;const O=!!z,J=O?I[0]:null,M=O&&!this.fieldsIndex.get(J);for(const S of K??[]){const {outStatisticFieldName:Q,statisticType:W}=S;K=S;var G="exceedslimit"!==W?S.onStatisticField:void 0;const V="percentile_disc"===W||"percentile_cont"===W,T="EnvelopeAggregate"===W||"CentroidAggregate"===W||
"ConvexHullAggregate"===W,X=O&&1===z&&(G===J||M)&&"count"===W;if(O){if(!E.has(G)){var P=[];for(const Z of I){var U=this._getAttributeValues(H,Z,t);P.push(U)}E.set(G,this._calculateUniqueValues(P,T?!1:H.returnDistinctValues))}P=E.get(G);for(const Z in P){const {count:Y,data:aa,items:ia,itemPositions:na}=P[Z];U=aa.join(",");if(!L||H.validateItems(ia,L)){const ba=F.get(U)||{attributes:{}};if(T){ba.aggregateGeometries||(ba.aggregateGeometries={});const {aggregateGeometries:ja,outStatisticFieldName:ka}=
await this._getAggregateGeometry(K,ia);ba.aggregateGeometries[ka]=ja}else{var N=null;if(X)N=Y;else{const ja=this._getAttributeValues(H,G,t);N=na.map(ka=>ja[ka]);N=V&&"statisticParameters"in K?this._getPercentileValue(K,N):this._getStatisticValue(K,N,null,H.returnDistinctValues)}ba.attributes[Q]=N}let ea=0;I.forEach((ja,ka)=>ba.attributes[this.fieldsIndex.get(ja)?ja:`EXPR_${++ea}`]=aa[ka]);F.set(U,ba)}}}else if(T){v.aggregateGeometries||(v.aggregateGeometries={});const {aggregateGeometries:Z,outStatisticFieldName:Y}=
await this._getAggregateGeometry(K,this.items);v.aggregateGeometries[Y]=Z}else G=this._getAttributeValues(H,G,t),v.attributes[Q]=V&&"statisticParameters"in K?this._getPercentileValue(K,G):this._getStatisticValue(K,G,C,H.returnDistinctValues);A.push({name:Q,alias:Q,type:"esriFieldTypeDouble"})}v=O?Array.from(F.values()):[v];this._sortFeatures(v,R,(S,Q)=>S.attributes[Q]);return{fields:A,features:v}};D._getAggregateGeometry=async function(z,v){var A=await new Promise((R,O)=>a(["../../../geometry/geometryEngineJSON"],
R,O));const {statisticType:t,outStatisticFieldName:C}=z,{featureAdapter:E,spatialReference:F,geometryType:H,hasZ:K,hasM:I}=this;v=v.map(R=>e.getGeometry(H,K,I,E.getGeometry(R)));const L=A.convexHull(F,v,!0)[0];z={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===t?(A=L?x.getPolygonExtent(L):x.getGeometryExtent(A.union(F,v)),z.aggregateGeometries={...A,spatialReference:F},z.outStatisticFieldName=C||"extent"):"CentroidAggregate"===t?(A=L?n.polygonCentroid(L):n.extentCentroid(x.getGeometryExtent(A.union(F,
v))),z.aggregateGeometries={x:A[0],y:A[1],spatialReference:F},z.outStatisticFieldName=C||"centroid"):"ConvexHullAggregate"===t&&(z.aggregateGeometries=L,z.outStatisticFieldName=C||"convexHull");return z};D._getStatisticValue=function(z,v,A,t){const {onStatisticField:C,statisticType:E}=z;z=null;z=A?.has(C)?A.get(C):k.isStringField(this.fieldsIndex.get(C))?u.calculateStringStatistics({values:v,returnDistinct:t}):u.calculateStatistics({values:t?[...(new Set(v))]:v,minValue:null,maxValue:null,useSampleStdDev:!0});
A&&A.set(C,z);return z["var"===E?"variance":E]};D._getPercentileValue=function(z,v){const {onStatisticField:A,statisticParameters:t,statisticType:C}=z,{value:E,orderBy:F}=t;z=this.fieldsIndex.get(A);return u.calculatePercentile(v,{value:E,orderBy:F,fieldType:z?.type,isDiscrete:"percentile_disc"===C})};D._getAttributeValues=function(z,v,A){if(A.has(v))return A.get(v);const t=this.fieldsIndex.get(v),C=this.items.map(E=>z.getFieldValue(E,v,t));A.set(v,C);return C};D._getAttributeDataValues=function(z,
v){return this.items.map(A=>z.getDataValue(A,{field:v.field,field2:v.field2,field3:v.field3,fieldDelimiter:v.fieldDelimiter,normalizationField:v.normalizationField,normalizationType:v.normalizationType,normalizationTotal:v.normalizationTotal}))};D._getAttributeExpressionValues=async function(z,v,A){const {arcadeUtils:t}=await p.loadArcade();v=t.createFunction(v);A=A&&t.getViewInfo(A);return z.getExpressionValues(this.items,v,A,t)};D._calculateUniqueValues=function(z,v){const A={},t=this.items,C=t.length;
for(let E=0;E<C;E++){const F=t[E],H=[];for(const I of z)H.push(I[E]);const K=H.join(",");null==A[K]?A[K]={count:1,data:H,items:[F],itemPositions:[E]}:(v||A[K].count++,A[K].items.push(F),A[K].itemPositions.push(E))}return A};D._getDataValues=async function(z){const v=new g(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:A,field:t,normalizationField:C,normalizationType:E,normalizationTotal:F,scale:H}=z,K=A?{viewingMode:"map",scale:H,spatialReference:this.query.outSR||this.spatialReference}:
null;return A?this._getAttributeExpressionValues(v,A,K):this._getAttributeDataValues(v,{field:t,field2:z.field2,field3:z.field3,fieldDelimiter:z.fieldDelimiter,normalizationField:C,normalizationType:E,normalizationTotal:F})};c._createClass(B,[{key:"size",get:function(){return this.items.length}}]);return B}();b.SnappingTypes=void 0;(function(B){B[B.NONE=0]="NONE";B[B.EDGE=1]="EDGE";B[B.VERTEX=2]="VERTEX"})(b.SnappingTypes||(b.SnappingTypes={}));let y=function(){function B(D,z){this.coords=D;this.coordsIndex=
z}c._createClass(B,[{key:"x",get:function(){return this.coords[this.coordsIndex]}},{key:"y",get:function(){return this.coords[this.coordsIndex+1]}},{key:"z",get:function(){return this.coords[this.coordsIndex+2]}}]);return B}();b.QueryEngineResult=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./attributeSupport","../../../statistics/utils"],function(a,
b,c,w){return function(){function n(m,l,g){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=m.returnDistinctValues??!1;this.fieldsIndex=g;this.featureAdapter=l;if((l=m.outFields)&&!l.includes("*")){this.outFields=l;m=0;for(const d of l){var f=c.getExpressionFromFieldName(d);f=(l=this.fieldsIndex.get(f))?null:c.getWhereClause(f,g);l=l?l.name:c.getAliasFromFieldName(d)||`FIELD_EXP_${m++}`;this._fieldDataCache.set(d,{alias:l,clause:f})}}}var x=n.prototype;x.countDistinctValues=
function(m){if(!this.returnDistinctValues)return m.length;m.forEach(l=>this.getAttributes(l));return this._returnDistinctMap.size};x.getAttributes=function(m){m=this._processAttributesForOutFields(m);return this._processAttributesForDistinctValues(m)};x.getFieldValue=function(m,l,g){const f=g?g.name:l;let d=null;this._fieldDataCache.has(f)?d=this._fieldDataCache.get(f)?.clause:g||(d=c.getWhereClause(l,this.fieldsIndex),this._fieldDataCache.set(f,{alias:f,clause:d}));return g?this.featureAdapter.getAttribute(m,
f):d?.calculateValue(m,this.featureAdapter)};x.getDataValue=function(m,l){const g=l.normalizationType,f=l.normalizationTotal;let d=l.field&&this.getFieldValue(m,l.field,this.fieldsIndex.get(l.field));l.field2&&(d=`${w.processNullValue(d)}${l.fieldDelimiter}${w.processNullValue(this.getFieldValue(m,l.field2,this.fieldsIndex.get(l.field2)))}`,l.field3&&(d=`${d}${l.fieldDelimiter}${w.processNullValue(this.getFieldValue(m,l.field3,this.fieldsIndex.get(l.field3)))}`));g&&Number.isFinite(d)&&(m="field"===
g&&l.normalizationField?this.getFieldValue(m,l.normalizationField,this.fieldsIndex.get(l.normalizationField)):null,d=w.getNormalizedValue(d,g,m,f));return d};x.getExpressionValue=function(m,l,g,f){m={attributes:this.featureAdapter.getAttributes(m),layer:{fields:this.fieldsIndex.fields}};g=f.createExecContext(m,g);return f.executeFunction(l,g)};x.getExpressionValues=function(m,l,g,f){const d={fields:this.fieldsIndex.fields};return m.map(e=>{e={attributes:this.featureAdapter.getAttributes(e),layer:d};
e=f.createExecContext(e,g);return f.executeFunction(l,e)})};x.validateItem=function(m,l){this._fieldDataCache.has(l)||this._fieldDataCache.set(l,{alias:l,clause:c.getWhereClause(l,this.fieldsIndex)});return this._fieldDataCache.get(l)?.clause?.testFeature(m,this.featureAdapter)??!1};x.validateItems=function(m,l){this._fieldDataCache.has(l)||this._fieldDataCache.set(l,{alias:l,clause:c.getWhereClause(l,this.fieldsIndex)});return this._fieldDataCache.get(l)?.clause?.testSet(m,this.featureAdapter)??
!1};x._processAttributesForOutFields=function(m){const l=this.outFields;if(!l||!l.length)return this.featureAdapter.getAttributes(m);const g={};for(const f of l){const {alias:d,clause:e}=this._fieldDataCache.get(f);g[d]=e?e.calculateValue(m,this.featureAdapter):this.featureAdapter.getAttribute(m,d)}return g};x._processAttributesForDistinctValues=function(m){if(b.isNone(m)||!this.returnDistinctValues)return m;var l=this.outFields,g=[];if(l)for(const d of l){var {alias:f}=this._fieldDataCache.get(d);
g.push(m[f])}else for(f in m)g.push(m[f]);l=`${(l||["*"]).join(",")}=${g.join(",")}`;g=this._returnDistinctMap.get(l)||0;this._returnDistinctMap.set(l,++g);return 1<g?null:m};return a._createClass(n)}()})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,c){function w(v){return null==v||"string"===typeof v&&!v?"\x3cNull\x3e":v}function n(v){const A=null!=v.minValue||null!=v.maxValue,t=!!v.sqlExpression&&
v.supportsSQLExpression;return!(null!=v.normalizationField||null!=v.normalizationType)&&!A&&!t}function x(v){const {values:A,useSampleStdDev:t,supportsNullCount:C}=v;var E=Number.POSITIVE_INFINITY;let F=Number.NEGATIVE_INFINITY,H=null,K=null;var I=null;let L=null,R=0;const O=null==v.minValue?-Infinity:v.minValue,J=null==v.maxValue?Infinity:v.maxValue;for(const M of A)Number.isFinite(M)?M>=O&&M<=J&&(H=null===H?M:H+M,E=Math.min(E,M),F=Math.max(F,M),R++):"string"===typeof M&&R++;if(R&&null!=H){K=H/R;
I=0;for(const M of A)Number.isFinite(M)&&M>=O&&M<=J&&(I+=(M-K)**2);L=t?1<R?I/(R-1):0:0<R?I/R:0;I=Math.sqrt(L)}else F=E=null;E={avg:K,count:R,max:F,min:E,stddev:I,sum:H,variance:L};C&&(E.nullcount=A.length-R);v.percentileParams&&(E.median=m(A,v.percentileParams));return E}function m(v,A){const {fieldType:t,value:C,orderBy:E,isDiscrete:F}=A,H=l(t,"desc"===E);v=[...v].filter(R=>null!=R).sort((R,O)=>H(R,O));if(0===v.length)return null;if(0>=C)return v[0];if(1<=C)return v[v.length-1];var K=(v.length-1)*
C,I=Math.floor(K);A=I+1;K%=1;I=v[I];const L=v[A];return A>=v.length||F||"string"===typeof I||"string"===typeof L?I:I*(1-K)+L*K}function l(v,A){const t=A?1:-1,C=d(A),E=f(A);if(!v||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...D].includes(v))return(F,H)=>"number"===typeof F&&"number"===typeof H?C(F,H):"string"===typeof F&&"string"===typeof H?E(F,H):t;if("esriFieldTypeDate"===v)return(F,H)=>{F=(new Date(F)).getTime();H=(new Date(H)).getTime();return isNaN(F)||
isNaN(H)?t:C(F,H)};if(D.has(v))return(F,H)=>C(F,H);if("esriFieldTypeString"===v)return(F,H)=>E(F,H);if("esriFieldTypeGUID"===v||"esriFieldTypeGlobalID"===v){const F=f(A);return(H,K)=>F(e(H),e(K))}return A?(F,H)=>1:(F,H)=>-1}function g(v,A,t){if(t){if(null==v)return null==A?0:1;if(null==A)return-1}else{if(null==v)return null==A?0:-1;if(null==A)return 1}return null}function f(v){return v?(A,t)=>{const C=g(A,t,!0);if(null!=C)return C;A=A.toUpperCase();t=t.toUpperCase();return A>t?-1:A<t?1:0}:(A,t)=>
{const C=g(A,t,!1);if(null!=C)return C;A=A.toUpperCase();t=t.toUpperCase();return A<t?-1:A>t?1:0}}function d(v){return v?(A,t)=>{const C=g(A,t,!0);return null!=C?C:t-A}:(A,t)=>{const C=g(A,t,!1);return null!=C?C:A-t}}function e(v){return v.substr(24,12)+v.substr(19,4)+v.substr(16,2)+v.substr(14,2)+v.substr(11,2)+v.substr(9,2)+v.substr(6,2)+v.substr(4,2)+v.substr(2,2)+v.substr(0,2)}function k(v){return"coded-value"!==v?.type?[]:v.codedValues.map(A=>A.code)}function u(v,A){const t=h({field:A.field,
normalizationType:A.normalizationType,normalizationField:A.normalizationField,classificationMethod:A.classificationMethod,standardDeviationInterval:A.standardDeviationInterval,breakCount:A.numClasses||5});v=p(v,A.minValue,A.maxValue);return c.createGenerateRendererClassBreaks({definition:t,values:v,normalizationTotal:A.normalizationTotal})}function p(v,A,t){const C=null==A?-Infinity:A,E=null==t?Infinity:t;return v.filter(F=>Number.isFinite(F)&&F>=C&&F<=E)}function h(v){const {breakCount:A,field:t,
normalizationField:C,normalizationType:E}=v,F=v.classificationMethod||"equal-interval";return new b({breakCount:A,classificationField:t,classificationMethod:F,normalizationField:"field"===E?C:void 0,normalizationType:E,standardDeviationInterval:"standard-deviation"===F?v.standardDeviationInterval||1:void 0})}function r(v,A){const {field:t,classificationMethod:C,standardDeviationInterval:E,normalizationType:F,normalizationField:H,normalizationTotal:K,minValue:I,maxValue:L}=A,R=A.numBins||10;let O=
A=null,J=null;C&&"equal-interval"!==C||F?({classBreaks:v}=u(v,{field:t,normalizationType:F,normalizationField:H,normalizationTotal:K,classificationMethod:C,standardDeviationInterval:E,minValue:I,maxValue:L,numClasses:R}),A=v[0].minValue,O=v[v.length-1].maxValue,J=v.map(M=>[M.minValue,M.maxValue])):(null!=I&&null!=L?(A=I,O=L):(v=x({values:v,minValue:I,maxValue:L,useSampleStdDev:!F,supportsNullCount:n({normalizationType:F,normalizationField:H,minValue:I,maxValue:L})}),A=v.min??null,O=v.max??null),J=
y(A??0,O??0,R));return{min:A,max:O,intervals:J}}function q(v,A){let t=-1;for(let C=v.length-1;0<=C;C--)if(A>=v[C][0]){t=C;break}return t}function y(v,A,t){const C=(A-v)/t,E=[];let F;for(let H=1;H<=t;H++)F=v+C,F=Number(F.toFixed(16)),E.push([v,H===t?A:F]),v=F;return E}const B=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,D=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),z="min max avg stddev count sum variance nullcount median".split(" ");a.calculateClassBreaks=
u;a.calculateHistogram=function(v,A){var t=r(v,A);const C=t.intervals,E=t.min??0;t=t.max??0;const F=C.map((H,K)=>({minValue:C[K][0],maxValue:C[K][1],count:0}));for(const H of v)null!=H&&H>=E&&H<=t&&(v=q(C,H),-1<v&&F[v].count++);return{bins:F,minValue:E,maxValue:t,normalizationTotal:A.normalizationTotal}};a.calculatePercentile=m;a.calculateStatistics=x;a.calculateStringStatistics=function(v){const A=v.returnDistinct?[...(new Set(v.values))]:v.values,t=A.filter(E=>null!=E).length,C={count:t};v.supportsNullCount&&
(C.nullcount=A.length-t);v.percentileParams&&(C.median=m(A,v.percentileParams));return C};a.calculateUniqueValuesCount=function(v){const A={};for(let t of v){if(null==t||"string"===typeof t&&""===t.trim())t=null;null==A[t]?A[t]={count:1,data:t}:A[t].count++}return{count:A}};a.createClassBreaksDefinition=h;a.createUVResult=function(v,A,t,C){v=v.count;const E=[];if(t&&A){t=[];var F=k(A[0]);for(const H of F)if(A[1]){F=k(A[1]);for(const K of F)if(A[2]){F=k(A[2]);for(const I of F)t.push(`${w(H)}${C}${w(K)}${C}${w(I)}`)}else t.push(`${w(H)}${C}${w(K)}`)}else t.push(H);
for(const H of t)v.hasOwnProperty(H)||(v[H]={data:H,count:0})}for(const H in v)A=v[H],E.push({value:A.data,count:A.count,label:A.label});return{uniqueValueInfos:E}};a.getAttributeComparator=l;a.getEqualIntervalBins=y;a.getNormalizedValue=function(v,A,t,C){let E=null;switch(A){case "log":0!==v&&(E=Math.log(v)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(C)&&0!==C&&(E=v/C*100);break;case "field":Number.isFinite(t)&&0!==t&&(E=v/t);break;case "natural-log":0<v&&(E=Math.log(v));break;case "square-root":0<
v&&(E=v**.5)}return E};a.isNullCountSupported=n;a.processNullValue=w;a.processSummaryStatisticsResult=function(v,A){let t;for(t in v)z.includes(t)&&(Number.isFinite(v[t])||(v[t]=null));if(!A)return v;["avg","stddev","variance"].forEach(C=>{null!=v[C]&&(v[C]=Math.ceil(v[C]))});return v};a.resolveCBResult=function(v,A){let t=v.classBreaks;const C=t[0].minValue,E=t[t.length-1].maxValue,F="standard-deviation"===A;t=t.map(H=>{const K=H.label;H={minValue:H.minValue,maxValue:H.maxValue,label:K};if(F&&K){const I=
K.match(B)?.map(L=>+L.trim())??[];2===I.length?(H.minStdDev=I[0],H.maxStdDev=I[1],0>I[0]&&0<I[1]&&(H.hasAvg=!0)):1===I.length&&(K.includes("\x3c")?(H.minStdDev=null,H.maxStdDev=I[0]):K.includes("\x3e")&&(H.minStdDev=I[0],H.maxStdDev=null))}return H});return{minValue:C,maxValue:E,classBreakInfos:t,normalizationTotal:v.normalizationTotal}};a.statisticTypes=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g,f){x=new c.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});c=new c.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});w=function(d){function e(u){u=k.call(this,u);u.type="class-breaks-definition";u.breakCount=
null;u.classificationField=null;u.classificationMethod=null;u.normalizationField=null;u.normalizationType=null;return u}a._inherits(e,d);var k=a._createSuper(e);a._createClass(e,[{key:"standardDeviationInterval",set:function(u){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",u)}},{key:"definedInterval",set:function(u){"defined-interval"===this.classificationMethod&&this._set("definedInterval",u)}}]);return e}(w.JSONSupport);b.__decorate([g.enumeration({classBreaksDef:"class-breaks-definition"})],
w.prototype,"type",void 0);b.__decorate([n.property({json:{write:!0}})],w.prototype,"breakCount",void 0);b.__decorate([n.property({json:{write:!0}})],w.prototype,"classificationField",void 0);b.__decorate([n.property({type:String,json:{read:x.read,write:x.write}})],w.prototype,"classificationMethod",void 0);b.__decorate([n.property({json:{write:!0}})],w.prototype,"normalizationField",void 0);b.__decorate([n.property({json:{read:c.read,write:c.write}})],w.prototype,"normalizationType",void 0);b.__decorate([n.property({value:null,
json:{write:!0}})],w.prototype,"standardDeviationInterval",null);b.__decorate([n.property({value:null,json:{write:!0}})],w.prototype,"definedInterval",null);return w=b.__decorate([f.subclass("esri.rest.support.ClassBreaksDefinition")],w)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function c(k){var u=k.definition;const {classificationMethod:p,normalizationType:h,definedInterval:r}=u;u=u.breakCount??1;const q=[];var y=k.values;if(0===
y.length)return[];y=y.sort((t,C)=>t-C);var B=y[0],D=y[y.length-1];if("equal-interval"===p)if(y.length>=u){y=(D-B)/u;k=B;for(var z=1;z<u;z++){var v=Number((B+z*y).toFixed(6));q.push({minValue:k,maxValue:v,label:w(k,v,h)});k=v}q.push({minValue:k,maxValue:D,label:w(k,D,h)})}else y.forEach(t=>{q.push({minValue:t,maxValue:t,label:w(t,t,h)})});else if("natural-breaks"===p){y=n(y);k=x(y.uniqueValues,k.valueFrequency||y.valueFrequency,u);for(z=1;z<u;z++)y.uniqueValues.length>z&&(v=Number(y.uniqueValues[k[z]].toFixed(6)),
q.push({minValue:B,maxValue:v,label:w(B,v,h)}),B=v);q.push({minValue:B,maxValue:D,label:w(B,D,h)})}else if("quantile"===p)if(y.length>=u&&B!==D){k=Math.ceil(y.length/u);z=0;for(v=1;v<u;v++){var A=k+z-1;A>y.length&&(A=y.length-1);0>A&&(A=0);q.push({minValue:B,maxValue:y[A],label:w(B,y[A],h)});B=y[A];z+=k;k=Math.ceil((y.length-z)/(u-v))}q.push({minValue:B,maxValue:D,label:w(B,D,h)})}else for(u=-1,D=0;D<y.length;D++)B=y[D],B!==u&&(u=B,q.push({minValue:u,maxValue:B,label:w(u,B,h)}),u=B);else if("standard-deviation"===
p)if(k=g(y),z=f(y,k),0===z)q.push({minValue:y[0],maxValue:y[0],label:w(y[0],y[0],h)});else{y=l(B,D,u,k,z)*z;z=0;for(v=u;1<=v;v--)A=Number((k-(v-.5)*y).toFixed(6)),q.push({minValue:B,maxValue:A,label:w(B,A,h)}),B=A,z++;v=Number((k+.5*y).toFixed(6));q.push({minValue:B,maxValue:v,label:w(B,v,h)});B=v;z++;for(A=1;A<=u;A++)v=z===2*u?D:Number((k+(A+.5)*y).toFixed(6)),q.push({minValue:B,maxValue:v,label:w(B,v,h)}),B=v,z++}else if("defined-interval"===p){if(!r)return q;u=y[0];D=y[y.length-1];y=Math.ceil((D-
u)/r);B=u;for(k=1;k<y;k++)z=Number((u+k*r).toFixed(6)),q.push({minValue:B,maxValue:z,label:w(B,z,h)}),B=z;q.push({minValue:B,maxValue:D,label:w(B,D,h)})}return q}function w(k,u,p){let h=null;return h=k===u?p&&"percent-of-total"===p?k+"%":k.toString():p&&"percent-of-total"===p?k+"% - "+u+"%":k+" - "+u}function n(k){const u=[],p=[];let h=Number.MIN_VALUE,r=1,q=-1;for(let y=0;y<k.length;y++){const B=k[y];B===h?(r++,p[q]=r):null!==B&&(u.push(B),h=B,r=1,p.push(r),q++)}return{uniqueValues:u,valueFrequency:p}}
function x(k,u,p){var h=k.length;const r=[];p>h&&(p=h);for(var q=0;q<p;q++)r.push(Math.round(q*h/p-1));r.push(h-1);q=m(r,k,u,p);h=q.mean;q=q.sdcm;var y=p,B=0,D=0;let z=0,v=0,A=!0;for(let C=0;2>C&&A;C++){0===C&&(A=!1);for(var t=0;t<y-1;t++)for(;r[t+1]+1!==r[t+2];)if(r[t+1]+=1,B=d(t,r,k,u),z=B.sbMean,B=B.sbSdcm,D=d(t+1,r,k,u),v=D.sbMean,D=D.sbSdcm,B+D<q[t]+q[t+1])q[t]=B,q[t+1]=D,h[t]=z,h[t+1]=v,A=!0;else{--r[t+1];break}for(t=y-1;0<t;t--)for(;r[t]!==r[t-1]+1;)if(--r[t],B=d(t-1,r,k,u),z=B.sbMean,B=B.sbSdcm,
D=d(t,r,k,u),v=D.sbMean,D=D.sbSdcm,B+D<q[t-1]+q[t])q[t-1]=B,q[t]=D,h[t-1]=z,h[t]=v,A=!0;else{r[t]+=1;break}}A&&(q=m(r,k,u,p));return r}function m(k,u,p,h){let r=[];var q=[],y=[];let B=0;const D=[],z=[];for(var v=0;v<h;v++){var A=d(v,k,u,p);D.push(A.sbMean);z.push(A.sbSdcm);B+=z[v]}A=B;for(v=!0;v||B<A;){v=!1;r=[];for(q=0;q<h;q++)r.push(k[q]);for(y=0;y<h;y++)for(A=k[y]+1;A<=k[y+1];A++)if(q=u[A],0<y&&A!==k[y+1]&&Math.abs(q-D[y])>Math.abs(q-D[y-1]))k[y]=A;else if(y<h-1&&k[y]!==A-1&&Math.abs(q-D[y])>Math.abs(q-
D[y+1])){k[y+1]=A-1;break}A=B;B=0;q=[];y=[];for(let t=0;t<h;t++){q.push(D[t]);y.push(z[t]);const C=d(t,k,u,p);D[t]=C.sbMean;z[t]=C.sbSdcm;B+=z[t]}}if(B>A){for(u=0;u<h;u++)k[u]=r[u],D[u]=q[u],z[u]=y[u];B=A}return{mean:D,sdcm:z}}function l(k,u,p,h,r){k=Math.max(h-k,u-h)/r/p;return 1<=k?1:.5<=k?.5:.25}function g(k){let u=0;for(let p=0;p<k.length;p++)u+=k[p];return u/=k.length}function f(k,u){let p=0;for(let h=0;h<k.length;h++){const r=k[h];p+=(r-u)*(r-u)}p/=k.length;return Math.sqrt(p)}function d(k,
u,p,h){var r=0,q=0;for(var y=u[k]+1;y<=u[k+1];y++){const B=h[y];r+=p[y]*B;q+=B}0>=q&&e.warn("Exception in Natural Breaks calculation");r/=q;q=0;for(y=u[k]+1;y<=u[k+1];y++)q+=h[y]*(p[y]-r)**2;return{sbMean:r,sbSdcm:q}}const e=b.getLogger("esri.rest.support.generateRendererUtils");a.createGenerateRendererClassBreaks=function(k){const {normalizationTotal:u}=k;return{classBreaks:c(k),normalizationTotal:u}};a.createGenerateRendererUniqueValues=function(k){k=n(k);const u=[],p=k.uniqueValues.length;for(let h=
0;h<p;h++){const r=k.uniqueValues[h];u.push({value:r,count:k.valueFrequency[h],label:r.toString()})}return{uniqueValues:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){async function u(t,C,E){if(!t)return null;var {where:F}=t;t.where=F=F&&F.trim();if(!F||/^1 *= *1$/.test(F)||C&&C===F)t.where=null;if(!t.geometry)return t;C=await h(t);t.distance=0;t.units=null;"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&({spatialReference:F}=t.geometry,C=m.getGeometryExtent(C),C.spatialReference=F);if(C){await k.checkProjectionSupport(C.spatialReference,E);F=C.spatialReference;C=p(C,E)&&l.isExtent(C)?{spatialReference:F,rings:[[[C.xmin,C.ymin],
[C.xmin,C.ymax],[C.xmax,C.ymax],[C.xmax,C.ymin],[C.xmin,C.ymin]]]}:C;F=(await g.normalizeCentralMeridian(l.fromJSON(C)))[0];if(w.isNone(F))throw y;const H="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0;C=H&&p(C,E)?{densificationStep:8*H}:void 0;F=F.toJSON();C=await k.project(F,F.spatialReference,E,C);if(!C)throw y;C.spatialReference=E;t.geometry=C}return t}function p(t,C){if(!t)return!1;const E=t.spatialReference;return(l.isExtent(t)||
l.isPolygon(t)||l.isPolyline(t))&&!f.equals(E,C)&&!x.canProjectWithoutEngine(E,C)}async function h(t){const {distance:C,units:E}=t,F=t.geometry;if(null==C||"vertexAttributes"in F)return F;var H=F.spatialReference;t=E?q.fromJSON(E):n.getUnitString(H);H=H&&(f.isGeographic(H)||f.isWebMercator(H))?F:await k.checkProjectionSupport(H,f.WGS84).then(()=>k.project(F,f.WGS84));return(await r())(H.spatialReference,H,C,t)}async function r(){return(await new Promise((t,C)=>a(["../../../geometry/geometryEngineJSON"],
t,C))).geodesicBuffer}const q=new c.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),y=Object.freeze({}),B=new e,D=new e,z=new e,v={esriGeometryPoint:d.convertToPoint,esriGeometryPolyline:d.convertToPolyline,esriGeometryPolygon:d.convertToPolygon,esriGeometryMultipoint:d.convertToMultipoint},A=(t,C)=>"_geVersion"!==t?C:void 0;b.QUERY_ENGINE_EMPTY_RESULT=
y;b.cleanFromGeometryEngine=function(t){return t&&"_geVersion"in t?JSON.parse(JSON.stringify(t,A)):t};b.getGeometry=function(t,C,E,F,H,K,I=C,L=E){const R=C&&I,O=E&&L;F=w.isSome(F)?"coords"in F?F:F.geometry:null;if(w.isNone(F))return null;if(H)return C=d.generalizeOptimizedGeometry(D,F,C,E,t,H,I,L),K&&(C=d.quantizeOptimizedGeometry(z,C,R,O,t,K)),v[t]?.(C,R,O)??null;if(K)return K=d.quantizeOptimizedGeometry(z,F,C,E,t,K,I,L),v[t]?.(K,R,O)??null;d.removeZMValues(B,F,C,E,I,L);return v[t]?.(B,R,O)??null};
b.normalizeQuery=async function(t,C,E){const {outFields:F,orderByFields:H,groupByFieldsForStatistics:K,outStatistics:I}=t;if(F)for(var L=0;L<F.length;L++)F[L]=F[L].trim();if(H)for(L=0;L<H.length;L++)H[L]=H[L].trim();if(K)for(L=0;L<K.length;L++)K[L]=K[L].trim();if(I)for(L=0;L<I.length;L++)I[L].onStatisticField&&(I[L].onStatisticField=I[L].onStatisticField.trim());t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference);return u(t,C,E)};b.normalizeQueryLike=u;b.transformCentroid=function(t,C,E,F=
t.hasZ,H=t.hasM){if(w.isNone(C))return null;const K=t.hasZ&&F,I=t.hasM&&H;return E?(t=d.quantizeOptimizedGeometry(z,C,t.hasZ,t.hasM,"esriGeometryPoint",E,F,H),d.convertToPoint(t,K,I)):d.convertToPoint(C,K,I)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(){return new Promise((q,y)=>a(["../../../geometry/geometryEngineJSON"],q,y))}const u={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var p={esriSpatialRelIntersects:!0,
esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},h={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},r={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.canQueryWithRBush=
function(q){if(x.isExtent(q))return!0;if(x.isPolygon(q)){for(const y of q.rings)if(5!==y.length||y[0][0]!==y[1][0]||y[0][0]!==y[4][0]||y[2][0]!==y[3][0]||y[0][1]!==y[3][1]||y[0][1]!==y[4][1]||y[1][1]!==y[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=async function(q,y,B){const {spatialRel:D,geometry:z}=q;if(z){if(null==D||!0!==p[D])throw new c("feature-store:unsupported-query","Unsupported query spatial relationship",{query:q});if(m.isValid(z.spatialReference)&&m.isValid(B)){if(null==
z||!0!==h[x.getJsonType(z)])throw new c("feature-store:unsupported-query","Unsupported query geometry type",{query:q});if(null==y||!0!==r[y])throw new c("feature-store:unsupported-query","Unsupported layer geometry type",{query:q});if(q.outSR)return d.checkProjectionSupport(q.geometry&&q.geometry.spatialReference,q.outSR)}}};b.getSpatialQueryOperator=function(q,y,B,D,z){if(x.isPolygon(y)&&"esriGeometryPoint"===B&&("esriSpatialRelIntersects"===q||"esriSpatialRelContains"===q)){const v=g.convertFromPolygon(new f,
y,!1,!1);return Promise.resolve(A=>l.polygonContainsPoint(v,!1,!1,A))}if(x.isPolygon(y)&&"esriGeometryMultipoint"===B){const v=g.convertFromPolygon(new f,y,!1,!1);if("esriSpatialRelContains"===q)return Promise.resolve(A=>l.polygonContainsMultipoint(v,!1,!1,A,D,z))}if(x.isExtent(y)&&"esriGeometryPoint"===B&&("esriSpatialRelIntersects"===q||"esriSpatialRelContains"===q))return Promise.resolve(v=>w.extentContainsPoint(y,e.getGeometry(B,D,z,v)));if(x.isExtent(y)&&"esriGeometryMultipoint"===B&&"esriSpatialRelContains"===
q)return Promise.resolve(v=>w.extentContainsMultipoint(y,e.getGeometry(B,D,z,v)));if(x.isExtent(y)&&"esriSpatialRelIntersects"===q){const v=n.getExtentIntersector(B);return Promise.resolve(A=>v(y,e.getGeometry(B,D,z,A)))}return k().then(v=>{const A=v[u[q]].bind(null,y.spatialReference,y);return t=>A(e.getGeometry(B,D,z,t))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=
b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.extentIntersectsRings=b.extentIntersectsRings;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(c){return"mesh"===c?b.extentIntersectsExtent:
b.getFeatureExtentIntersector(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(c,w,n,x,m){if(!c)return!1;w=w?n?4:3:n?3:2;const {coords:l,lengths:g}=c;n=!1;c=0;for(const d of g){var f=c;for(let e=c,k=c+d*w;e<k;e+=w){f=e+w;f===k&&(f=c);const u=l[e],p=l[e+1],h=l[f];f=l[f+1];(p<m&&f>=m||f<m&&p>=m)&&u+(m-p)/(f-p)*(h-u)<x&&(n=!n)}c+=d*w}return n}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(c,
w,n,x,m,l){m=m?l?4:3:l?3:2;const {coords:g,lengths:f}=x;if(!f)return!1;for(let d=0,e=0;d<f.length;d++,e+=m)if(!b(c,w,n,g[e],g[e+1]))return!1;return!0};a.polygonContainsPoint=function(c,w,n,x){return b(c,w,n,x.coords[0],x.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(n,x,m,l,g){if(null!=l&&null!=g)return f=>{const d=n.getAttribute(f,x);f=n.getAttribute(f,m);return(null==d||d<=
g)&&(null==f||f>=l)};if(null!=l)return f=>{f=n.getAttribute(f,m);return null==f||f>=l};if(null!=g)return f=>{f=n.getAttribute(f,x);return null==f||f<=g}}function c(n,x,m,l){if(null!=m&&null!=l&&m===l)return g=>n.getAttribute(g,x)===m;if(null!=m&&null!=l)return g=>{g=n.getAttribute(g,x);return g>=m&&g<=l};if(null!=m)return g=>n.getAttribute(g,x)>=m;if(null!=l)return g=>n.getAttribute(g,x)<=l}function w(){return()=>!1}a.getTimeExtent=async function(n,x){if(!n)return null;const m=x.featureAdapter,{startTimeField:l,
endTimeField:g}=n;let f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;if(l&&g)await x.forEach(e=>{const k=m.getAttribute(e,l);e=m.getAttribute(e,g);null==k||isNaN(k)||(f=Math.min(f,k));null==e||isNaN(e)||(d=Math.max(d,e))});else{const e=l||g;await x.forEach(k=>{k=m.getAttribute(k,e);null==k||isNaN(k)||(f=Math.min(f,k),d=Math.max(d,k))})}return{start:f,end:d}};a.getTimeOperator=function(n,x,m){if(!x||!n)return null;const {startTimeField:l,endTimeField:g}=n;if(!l&&!g)return null;const {start:f,
end:d}=x;return null===f&&null===d?null:void 0===f&&void 0===d?w():l&&g?b(m,l,g,f,d):c(m,l||g,f,d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils","../../../../support/arcadeOnDemand"],function(a,b,c,w){const n={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=async function(x,m,l){if(b.isNone(x)||0===m.candidates.length)return n;
var g=x.graphics3DGraphicsByObjectID??x.graphics3DGraphics,f=[];const d=[],{renderer:e}=x,k=b.isSome(e)&&"arcadeRequired"in e&&e.arcadeRequired?w.loadArcade():null;var u=async(y,{graphic:B,graphics3DSymbol:D})=>{const z=await k;B=await x.getRenderingInfoAsync(B,e,z,{signal:l});return b.isNone(B)?[]:D.queryForSnapping(y,h,B,l)};const {candidates:p,spatialReference:h}=m;for(m=0;m<p.length;++m){var r=p[m],{objectId:q}=r;q="number"===typeof q?g?.get(q):void 0;if(b.isNone(q))continue;const {graphics3DSymbol:y}=
q;y.symbologySnappingSupported&&(f.push(u(r,q)),d.push(m))}if(0===f.length)return n;g=await Promise.all(f);c.throwIfAborted(l);f=[];u=[];for(m=0;m<g.length;++m){r=g[m];q=d[m];for(const y of r)f.push(y),u.push(q)}return{candidates:f,sourceCandidateIndices:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/byteSizeEstimations ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N){const S=m.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=function(W){function V(X){X=T.call(this,X);X.type="heatmap";X.preferredUpdatePolicy=J.UpdatePolicy.ASYNC;X.dataExtent=null;X.drapeSourceType=C.DrapeSourceType.Features;X._renderGeometries=new Map;X._fieldTotal=0;X._drapeSourceRenderer=null;X._dataType=U.PixelType.HALF_FLOAT;X._pixelFormat=U.PixelFormat.RGBA;
X.initializePromise=Promise.resolve();return X}b._inherits(V,W);var T=b._createSuper(V);W=V.prototype;W.initialize=function(){this._featureStore=new v({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:X,samplingMode:Z,pixelFormat:Y,internalFormat:aa}=N.loadHeatmapTextureConfiguration(this._renderView.renderingContext,S);this._dataType=X;this._pixelFormat=Y;const ia=X!==U.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,
I.DrapedHeatmapRenderer,{...this._rendererParameters,dataType:X,samplingMode:Z,pixelFormat:Y,internalFormat:aa});this._material=new G.HeatmapDensityMaterial({usesHalfFloats:ia});this._materialWithField=new G.HeatmapDensityMaterial({usesHalfFloats:ia,isAttributeDriven:!0});this._filterVisibility=new E.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:na=>this._setAllFeaturesVisibility(na),
clearFeaturesVisibility:()=>this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:na=>this._updateFeatureVisibilities(na)}});this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,na=>this._onLoadedFeaturesChange(na),g.initial);this.updatingHandles.addWhen(()=>this._materialParameters,na=>this._forEachMaterial(ba=>ba.setParameters(na)),g.initial);this.updatingHandles.add(()=>this._rendererParameters,na=>this._drapeSourceRenderer.set(na));this.updatingHandles.add(()=>this._heatmapRendererField,
()=>{this._recreate()},g.sync);this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:na,numeric:ba})=>{if(l.isSome(na)&&ba){let ea=0;this._featureStore.forEach(ja=>ea+=ja.attributes[na]??0);this._fieldTotal=ea}else this._fieldTotal=this._featureStore.numFeatures},g.initial);this.handles.add([g.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:na,field:ba})=>{na&&!ba&&S.warn(`Heatmap renderer field '${na}' for layer '${this.layer.title??
this.layer.id}' not found`)}),g.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:na,numeric:ba})=>{l.isSome(na)&&!ba&&S.warn(`Heatmap renderer field '${na.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),x.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])};W.destroy=function(){this._renderGeometries.clear();this._material=l.disposeMaybe(this._material);
this._materialWithField=l.disposeMaybe(this._materialWithField);this._featureStore.clear();this._featureStore=null};W.whenGraphicBounds=async function(){return null};W.computeAttachmentOrigin=function(){return null};W.highlight=function(){return Q};W.maskOccludee=function(){return Q};W.setObjectIdVisibility=function(){};W.refreshFilter=function(){this.filterVisibility.reapply()};W._onLoadedFeaturesChange=function(X){if(this._featuresArePoints){var {objectIdField:Z}=this.layer;this._featureStore.removeManyById(X.removed.map(aa=>
y.getObjectId(aa,Z)));this._featureStore.addMany(X.added.map(aa=>{const ia=new D.OptimizedFeature(B.convertFromPoint(new z,aa.geometry),aa.attributes,l.applySome(aa.centroid,na=>B.convertFromPoint(new z,na)),y.getObjectId(aa,Z));ia.displayId=aa.uid;return ia}));var Y=X.added;X=X.removed;this._fieldTotal+=this._computeFieldTotalChange(Y,X);X=l.mapSome(X,({uid:aa})=>{const ia=this._renderGeometries.get(aa);this._renderGeometries.delete(aa);return ia});Y=Y.map(aa=>{const ia=this._pointGraphicToRenderGeometry(aa);
this._renderGeometries.set(aa.uid,ia);return ia});0<X.length&&this._drapeSourceRenderer.removeGeometries(X,R.DirtyOperation.REMOVE);0<Y.length&&this._drapeSourceRenderer.addGeometries(Y,R.DirtyOperation.ADD);if(0<Y.length||0<X.length)this.filterVisibility.reapply(),this._renderView.requestRender()}};W._recreate=function(){if(this._loadedPointGraphics){var X=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:X,removed:X})}};W._pointGraphicToRenderGeometry=function(X){const Z=this._heatmapRendererFieldName,
Y=l.isSome(Z)?this._materialWithField:this._material;var aa=h.create();r.projectPointToVector(X.geometry,aa,this._overlaySpatialReference);aa[2]=F.DRAPED_Z;aa=[[M.VertexAttribute.POSITION,new H.Attribute(aa,aa.length)]];const ia=this._heatmapRendererFieldIsNumeric;l.isSome(Z)&&aa.push([M.VertexAttribute.FEATUREATTRIBUTE,new H.Attribute([ia?X.attributes[Z]??0:0],1)]);X=new O.RenderGeometry(new L.Geometry(Y,aa,null,null,K.ContentObjectType.Point),{layerUid:this.layer.uid,graphicUid:X.uid});X.visible=
this.filterVisibility.defaultVisibility;return X};W._forEachMaterial=function(X){X(this._material);X(this._materialWithField)};W._computeFieldTotalChange=function(X,Z){if(l.isNone(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return X.length-Z.length;const Y=this._heatmapRendererFieldName,aa=(ia,na)=>ia+(na.attributes[Y]??0);return X.reduce(aa,0)-Z.reduce(aa,0)};W._clampSearchRadius=function(X){112<X&&S.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");
return Math.min(X,112)};W._updateFeatureVisibilities=function(X){const Z=[];this._featureStore.forEach(({objectId:Y,displayId:aa})=>{Y=X(Y);(aa=this._renderGeometries.get(aa))&&aa.visible!==Y&&(Z.push(aa),aa.visible=Y)});this._drapeSourceRenderer.modifyGeometries(Z,R.DirtyState.VISIBILITY)};W._setAllFeaturesVisibility=function(X){const Z=[];for(const Y of this._renderGeometries.values())Y.visible!==X&&(Z.push(Y),Y.visible=X);this._drapeSourceRenderer.modifyGeometries(Z,R.DirtyState.VISIBILITY)};b._createClass(V,
[{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating||this.filterVisibility.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"displayFeatureLimit",get:function(){var X=this.owner?.view?.resourceController?.memoryController?.memoryFactor??
1;const Z=this.owner?.view?.qualitySettings;X=Z?Math.ceil(Z.heatmap.maxTotalNumberOfFeatures*X):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:X,maximumTotalNumberOfPrimitives:2*X,maximumNumberOfFeatures:X}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",
get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){if(!this._isScaleRangeActive)return!1;const {minScale:X,maxScale:Z}=this.layer.effectiveScaleRange,{scale:Y}=this.view;return!P.scaleBoundsPredicate(Y,X??0,Z??0)}},{key:"usedMemory",get:function(){const X=Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??0)*this._densityMapPixelRatio)??0;return X*X*(this._pixelFormat===U.PixelFormat.RED?1:4)*(this._dataType===U.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*
this._featureStore.numFeatures}},{key:"usedMemoryPerFeature",get:function(){var X=this._loadedPointGraphics.find(()=>!0);if(l.isNone(X))return 0;X=w.estimateAttributesObjectSize(X);const Z=w.estimateNumberByteSize(),Y=6*w.estimateFixedArraySize([0,0,0],Z),aa=6*w.estimateFixedArraySize([0,0],Z);return Y+aa+(this._heatmapRendererFieldIsNumeric?6*Z:0)+X}},{key:"loadedFeatures",get:function(){return this._featureStore.numFeatures}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",
get:function(){return{core:{visible:this._visibleFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"renderer",get:function(){return this._heatmapRenderer}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return l.unwrap(this._overlayRenderer.spatialReference)}},{key:"_rendererParameters",get:function(){return{...this._radiusParameter,...this._densityParameters,
...this._colorRampParameter,...this._pixelRatioParameter}}},{key:"_materialParameters",get:function(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}},{key:"_densityParameters",get:function(){const X=this._heatmapRenderer;if(l.isNone(X))return null;const {minDensity:Z,maxDensity:Y}=X;return{minDensity:Z,maxDensity:Y,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){return l.applySome(this._heatmapRenderer,({radius:X})=>({searchRadius:f.pt2px(this._clampSearchRadius(X))}))}},
{key:"_resolutionForScaleParameter",get:function(){return l.applySome(this._heatmapRenderer,({referenceScale:X})=>({resolutionForScale:0===X?0:q.getResolutionForScale(X,this.view.spatialReference)}))}},{key:"_colorRampParameter",get:function(){return l.applySome(this._heatmapRenderer,X=>({colorRampData:t.generateGradient(X.colorStops)}))}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){return(this.owner?.view?.qualitySettings.heatmap.pixelRatio??
1)*Math.sqrt(this.owner?.view?.resourceController?.memoryController?.memoryFactor??1)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){const X=this.layer.renderer;return"heatmap"===X?.type?X:null}},{key:"_heatmapRendererFieldName",get:function(){return l.applySome(this._heatmapRenderer,
X=>X.field)}},{key:"_heatmapRendererField",get:function(){return l.applySome(this._heatmapRendererFieldName,X=>this.layer.fieldsIndex.get(X))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){const X=this._heatmapRendererField;return l.isNone(X)?!1:A.isNumericField(X)}},{key:"_isScaleRangeActive",get:function(){const {layer:X}=this;if(!("effectiveScaleRange"in X))return!1;const {minScale:Z,maxScale:Y}=X.effectiveScaleRange;return P.isScaleRangeActive(Z,Y)}},{key:"_visibleFeatures",get:function(){let X=
0;this._renderGeometries.forEach(Z=>{Z.visible&&++X});return X}},{key:"test",get:function(){return{visibleFeatureCount:this._visibleFeatures}}}]);return V}(n.HandleOwner);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);c.__decorate([d.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",
null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",
null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"view",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);
c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,
"_filterVisibility",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);c.__decorate([d.property()],
a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,
"_renderGeometries",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);c.__decorate([d.property()],
a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,
"_drapeSourceRenderer",void 0);c.__decorate([d.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=c.__decorate([p.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);const Q=x.makeHandle();a.MAX_RADIUS_PT=112;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter ./utils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){const e=x.create();return function(){function k(p){this.geometryInfo=p;this._boundsStore=new g.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new c;this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}var u=k.prototype;u.getFullExtent=function(p){if(n.isNone(this.fullBounds))return null;const [h,r,q,y]=this.fullBounds;return{xmin:h,ymin:r,xmax:q,ymax:y,spatialReference:d.cleanFromGeometryEngine(p)}};u.add=function(p){this._add(p);this._emitChanged()};
u.addMany=function(p){for(const h of p)this._add(h);this._emitChanged()};u.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};u.removeById=function(p){p=this._featuresById.get(p);if(!p)return null;this._remove(p);this._emitChanged();return p};u.removeManyById=function(p){this._boundsStore.invalidateIndex();for(const h of p)(p=this._featuresById.get(h))&&this._remove(p);this._emitChanged()};u.forEachBounds=function(p,h){for(const r of p)(p=this._boundsStore.get(r.objectId))&&
h(x.fromRect(e,p))};u.getFeature=function(p){return this._featuresById.get(p)};u.has=function(p){return this._featuresById.has(p)};u.forEach=function(p){this._featuresById.forEach(h=>p(h))};u.forEachInBounds=function(p,h){this._boundsStore.forEachInBounds(p,r=>{h(this._featuresById.get(r))})};u.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};u.sweep=function(){let p=!1;this._featuresById.forEach((h,r)=>{this._markedIds.has(r)||(p=!0,this._remove(h))});
this._markedIds.clear();p&&this._emitChanged()};u._emitChanged=function(){this.events.emit("changed",void 0)};u._add=function(p){if(p){var h=p.objectId;if(null==h)w.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:p}));else{var r=this._featuresById.get(h);this._markedIds.add(h);if(r){p.displayId=r.displayId;var q=this._boundsStore.get(h);this._boundsStore.delete(h)}else if(n.isSome(this.onFeatureAdd))this.onFeatureAdd(p);
!n.isNone(p.geometry)&&p.geometry.coords&&p.geometry.coords.length?(q=l.getBoundsOptimizedGeometry(n.isSome(q)?q:m.create(),p.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),n.isSome(q)&&this._boundsStore.set(h,q)):this._boundsStore.set(h,null);this._featuresById.set(h,p)}}};u._remove=function(p){if(n.isSome(this.onFeatureRemove))this.onFeatureRemove(p);const h=p.objectId;this._markedIds.delete(h);this._boundsStore.delete(h);this._featuresById.delete(h);return p};a._createClass(k,[{key:"geometryType",
get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){let p=0;this._featuresById.forEach(h=>{n.isSome(h.geometry)&&h.geometry.coords&&(p+=h.geometry.coords.length)});return{featureCount:this._featuresById.size,
vertexCount:p/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}}]);return k}()})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,c,w,n){function x(g,f,d){m.minX=f[0];m.minY=f[1];m.maxX=f[2];m.maxY=f[3];g.search(m,d)}const m={minX:0,minY:0,maxX:0,maxY:0};let l=function(){function g(){this._indexInvalid=!1;this._boundsToLoad=[];
this._boundsById=new Map;this._idByBounds=new Map;this._index=new w.PooledRBush(9,c("esri-csp-restrictions")?d=>({minX:d[0],minY:d[1],maxX:d[2],maxY:d[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const d=Array(this._idByBounds.size);let e=0;this._idByBounds.forEach((k,u)=>{d[e++]=u});this._indexInvalid=!1;this._index.clear();this._index.load(d)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(d=>this._idByBounds.has(d))))),
this._boundsToLoad.length=0)}}var f=g.prototype;f.clear=function(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};f.delete=function(d){const e=this._boundsById.get(d);this._boundsById.delete(d);e&&(this._idByBounds.delete(e),this._indexInvalid||this._index.remove(e))};f.forEachInBounds=function(d,e){this._loadIndex();x(this._index,d,k=>e(this._idByBounds.get(k)))};f.get=function(d){return this._boundsById.get(d)};f.has=function(d){return this._boundsById.has(d)};
f.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};f.set=function(d,e){if(!this._indexInvalid){const k=this._boundsById.get(d);k&&(this._index.remove(k),this._idByBounds.delete(k))}this._boundsById.set(d,e);e&&(this._idByBounds.set(e,d),this._indexInvalid||(this._boundsToLoad.push(e),5E4<this._boundsToLoad.length&&this._loadIndex()))};b._createClass(g,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;const d=n.empty();for(const e of this._boundsById.values())e&&
(d[0]=Math.min(e[0],d[0]),d[1]=Math.min(e[1],d[1]),d[2]=Math.max(e[2],d[2]),d[3]=Math.max(e[3],d[3]));return d}},{key:"valid",get:function(){return!this._indexInvalid}}]);return g}();a.BoundsStore=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){a.DrapedHeatmapRenderer=function(y){function B(z){z=D.call(this,z);z.pixelRatio=1;z._colorRampData=new Uint8ClampedArray(4);z.type="draped-heatmap";z._heatmapParameters=new u.HeatmapPassParameters;return z}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.initialize=function(){this._densityMap=new h.FramebufferObject(this.rctx,{colorTarget:p.TargetType.TEXTURE,depthStencilTarget:p.DepthStencilTargetType.NONE,width:0,height:0},{target:p.TextureType.TEXTURE_2D,
pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=e.createQuadVAO(this.rctx);var z=this._colorRampData;this._colorRamp=new r.Texture(this.rctx,{target:p.TextureType.TEXTURE_2D,pixelFormat:p.PixelFormat.RGBA,dataType:p.PixelType.UNSIGNED_BYTE,samplingMode:p.TextureSamplingMode.LINEAR,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,width:z.length/4,height:1},z);z=new u.HeatmapTechniqueConfiguration;
z.usesHalfFloat=this.dataType!==p.PixelType.FLOAT;this._technique=new u.HeatmapTechnique({rctx:this.rctx,viewingMode:d.ViewingMode.Local},z);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(n.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};y.destroy=function(){this._technique=w.releaseMaybe(this._technique);this._densityMap=w.disposeMaybe(this._densityMap);
this._quad=w.disposeMaybe(this._quad);this._colorRamp=w.disposeMaybe(this._colorRamp)};y.render=function(z){const v=this._sortedMaterialRenderers;if(0!==v.length){var A=this.rctx.getBoundFramebufferObject(),t=this.rctx.getViewport(),{pixelRatio:C}=this,E=Math.ceil(t.width*C);C=Math.ceil(t.height*C);this._densityMap.resize(E,C);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,E,C);this.rctx.clear(p.ClearBufferBit.COLOR_BUFFER_BIT);var F=!1;v.forAll(H=>{if(H.material.shouldRender(z)){const K=
H.prepareTechnique(z);w.isSome(K)&&(H.render(z,K),F=!0)}});this.rctx.bindFramebuffer(A);this.rctx.setViewport(t.x,t.y,t.width,t.height);F&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,z.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,q.vertexCount(this._quad,"geometry")))}};b._createClass(B,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(z){z!==this._heatmapParameters.searchRadius&&
(this._heatmapParameters.searchRadius=z,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(z){z!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=z,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(z){z!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=z,this.notifyChange("maxDensity"))}},{key:"fieldTotal",
get:function(){return this._heatmapParameters.fieldTotal},set:function(z){this._heatmapParameters.fieldTotal=z;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(z){const {colorRamp:v}=this._heatmapParameters;if(w.isSome(v)&&z!==this._colorRampData){const A=z.length/4;A!==v.descriptor.width&&v.resize(A,1);v.setData(z)}this._colorRampData=z}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(z){this._heatmapParameters.colorRamp=
z}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return B}(k.SortedRenderGeometryRenderer);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",
null);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([x.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);c.__decorate([x.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);c.__decorate([x.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);c.__decorate([x.property({constructOnly:!0})],
a.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);c.__decorate([x.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);a.DrapedHeatmapRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){n=function(h){function r(){var y=q.apply(this,arguments);y.colorRamp=null;y.densityMap=null;y.searchRadius=1;y.fieldTotal=0;y.minDensity=0;y.maxDensity=100;return y}c._inherits(r,h);var q=c._createSuper(r);return c._createClass(r)}(n.NoParameters);m=function(h){function r(y,B){var D;return D=q.call(this,y,B,()=>D.destroy())}c._inherits(r,h);var q=c._createSuper(r);h=r.prototype;h.initializeProgram=function(y){return new d.Program(y.rctx,r.shader.get().build(this.configuration),
g.Default3D)};h.initializePipeline=function(){return p.makePipelineState({blending:f.blendingDefault,colorWrite:p.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(r,[{key:"primitiveType",get:function(){return u.PrimitiveType.TRIANGLE_STRIP}}]);return r}(m.ShaderTechnique);m.shader=new x.ReloadableShaderModule(k.HeatmapShader,()=>new Promise((h,r)=>a(["./Heatmap.glsl"],h,r)));x=function(h){function r(){var y=q.apply(this,arguments);y.usesHalfFloat=!1;return y}c._inherits(r,
h);var q=c._createSuper(r);return c._createClass(r)}(e.DefaultTechniqueConfiguration);w.__decorate([l.parameter()],x.prototype,"usesHalfFloat",void 0);b.HeatmapPassParameters=n;b.HeatmapTechnique=m;b.HeatmapTechniqueConfiguration=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,w,n,x,m){function l(f){const d=new x.ShaderBuilder;d.include(b.ScreenSpacePass);d.include(c.DiscardOrAdjustAlphaBlend);({usesHalfFloat:f}=f);d.fragment.uniforms.add([new m.Texture2DPassUniform("densityMap",e=>e.densityMap),new m.Texture2DPassUniform("tex",e=>e.colorRamp),new w.FloatPassUniform("densityNormalizer",e=>1/(e.maxDensity-e.minDensity)),new w.FloatPassUniform("minDensity",e=>e.minDensity)]);d.fragment.uniforms.add(new w.FloatPassUniform("densityMultiplier",e=>3/(e.searchRadius*
e.searchRadius*Math.PI)));f&&d.constants.add("compressionFactor","float",4);d.fragment.code.add(n.glsl`
    void main() {
      float density = texture(densityMap, uv).r * densityMultiplier${f?n.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      fragColor = color;
    }
  `);return d}const g=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=g;a.build=l})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){let k=function(y){function B(){var z=D.apply(this,arguments);z.isAttributeDriven=!1;z.usesHalfFloats=!1;return z}b._inherits(B,y);var D=b._createSuper(B);return b._createClass(B)}(e.HeatmapDensityPassParameters);l=function(y){function B(z){z=D.call(this,z,new k);z._configuration=new e.HeatmapDensityTechniqueConfiguration;return z}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.requiresSlot=function(z,v){return z===g.RenderSlot.DRAPED_MATERIAL&&v===x.ShaderOutput.Color};
y.getConfiguration=function(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;return this._configuration};y.createGLMaterial=function(z){return new u(z)};y.intersect=function(){};y.intersectDraped=function(z,v,A,t,C,E){v=z.vertexAttributes.get(f.VertexAttribute.POSITION);({parameters:A}=this);({searchRadius:A}=A);({screenToWorldRatio:z}=z);z=A*z+2*z;z*=z;A=v.data.length/v.size;for(let H=0;H<A;H++){var F=H*v.size;
F=c.set(q,v.data[F],v.data[F+1]);c.squaredDistance(F,t)<z&&C(E.dist,E.normal,-1,!1)}};y.createBufferWriter=function(){return new p(this.parameters.isAttributeDriven?r:h)};return b._createClass(B)}(l.Material);let u=function(y){function B(){return D.apply(this,arguments)}b._inherits(B,y);var D=b._createSuper(B);B.prototype.beginSlot=function(z){return this.ensureTechnique(e.HeatmapDensityTechnique,z)};return b._createClass(B)}(m),p=function(){function y(D){this.vertexBufferLayout=D}var B=y.prototype;
B.allocate=function(D){return this.vertexBufferLayout.createBuffer(D)};B.elementCount=function(D){return 6*D.indices.get(f.VertexAttribute.POSITION).length};B.write=function(D,z,v,A,t){d.writePosition(v.indices.get(f.VertexAttribute.POSITION),v.vertexAttributes.get(f.VertexAttribute.POSITION).data,D,A.position,t,6);D=v.indices.get(f.VertexAttribute.POSITION).length;z=A.uv0;let C=t;for(let E=0;E<D;++E)z.setValues(C++,-1,-1),z.setValues(C++,1,-1),z.setValues(C++,1,1),z.setValues(C++,1,1),z.setValues(C++,
-1,1),z.setValues(C++,-1,-1);(A=f.VertexAttribute.FEATUREATTRIBUTE in A?A.featureAttribute:null)&&d.writeBufferFloat(v.indices.get(f.VertexAttribute.FEATUREATTRIBUTE),v.vertexAttributes.get(f.VertexAttribute.FEATUREATTRIBUTE).data,A,t,6)};return b._createClass(y)}();const h=n.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0),r=h.clone().f32(f.VertexAttribute.FEATUREATTRIBUTE),q=w.create();a.HeatmapDensityMaterial=l;a.HeatmapDensityMaterialParameters=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){g=function(p){function h(){var q=r.apply(this,arguments);q.searchRadius=128;q.resolutionForScale=0;return q}c._inherits(h,p);var r=c._createSuper(h);return c._createClass(h)}(g.MaterialParameters);x=function(p){function h(){return r.apply(this,arguments)}c._inherits(h,p);var r=c._createSuper(h);p=h.prototype;p.initializeProgram=function(q){return new f.Program(q.rctx,h.shader.get().build(this.configuration),l.Default3D)};p.initializePipeline=function(){return u.makePipelineState({blending:u.simpleBlendingParams(k.BlendFactor.ONE,
k.BlendFactor.ONE,k.BlendOperation.ADD),colorWrite:u.defaultColorWriteParams,depthTest:null,depthWrite:null})};p.destroy=function(){c._get(c._getPrototypeOf(h.prototype),"destroy",this).call(this)};return c._createClass(h)}(x.ShaderTechnique);x.shader=new n.ReloadableShaderModule(e.HeatmapDensity,()=>new Promise((p,h)=>a(["./HeatmapDensity.glsl"],p,h)));n=function(p){function h(){var q=r.apply(this,arguments);q.isAttributeDriven=!1;q.usesHalfFloat=!1;return q}c._inherits(h,p);var r=c._createSuper(h);
return c._createClass(h)}(d.DefaultTechniqueConfiguration);w.__decorate([m.parameter()],n.prototype,"isAttributeDriven",void 0);w.__decorate([m.parameter()],n.prototype,"usesHalfFloat",void 0);b.HeatmapDensityPassParameters=g;b.HeatmapDensityTechnique=x;b.HeatmapDensityTechniqueConfiguration=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x){function m(g){const f=new n.ShaderBuilder,{vertex:d,fragment:e}=f;b.addProjViewLocalOrigin(d,g);const {isAttributeDriven:k,usesHalfFloat:u}=g;f.attributes.add(x.VertexAttribute.POSITION,"vec3");f.attributes.add(x.VertexAttribute.UV0,"vec2");k&&(f.attributes.add(x.VertexAttribute.FEATUREATTRIBUTE,"float"),f.varyings.add("attributeValue","float"));u&&f.constants.add("compressionFactor","float",.25);f.varyings.add("unitCirclePos","vec2");d.uniforms.add(new c.FloatPassUniform("radius",
({resolutionForScale:p,searchRadius:h},{camera:r,screenToWorldRatio:q})=>2*h*(0===p?1:p/q)*r.pixelRatio/r.fullViewport[2]));d.code.add(w.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${x.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${k?w.glsl`attributeValue = ${x.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);e.code.add(w.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${k?w.glsl` * attributeValue`:""} ${u?w.glsl` * compressionFactor`:""};
      fragColor = vec4(density);
    }
  `);return f}const l=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=l;a.build=m})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","../../core/maybe","./enums"],function(a,b,c,w){a.loadHeatmapTextureConfiguration=function(n,x){const {textureFloat:m,colorBufferFloat:l}=n.capabilities,g=m?.textureFloat,f=m?.textureFloatLinear;var d=m?.textureHalfFloat;const e=m?.textureHalfFloatLinear,k=m?.HALF_FLOAT,
u=l?.textureFloat;var p=l?.textureHalfFloat;const h=l?.floatBlend;n=c.unwrapOrThrow(n.driverTest).floatBufferBlend.result;if(!g&&!d)throw new b("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!u&&!p)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(h&&n||p))throw new b("heatmap:missing-float-blend",
`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${n?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);d=d&&p;p=!!l?.R32F;const r=!!l?.R16F;if(g&&u&&h&&n&&(f||!e))return f||x.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),{dataType:w.PixelType.FLOAT,samplingMode:f?w.TextureSamplingMode.LINEAR:w.TextureSamplingMode.NEAREST,pixelFormat:p?w.PixelFormat.RED:w.PixelFormat.RGBA,
internalFormat:p?w.SizedPixelFormat.R32F:w.PixelFormat.RGBA};if(d)return e||x.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),{dataType:k,samplingMode:e?w.TextureSamplingMode.LINEAR:w.TextureSamplingMode.NEAREST,pixelFormat:r?w.PixelFormat.RED:w.PixelFormat.RGBA,internalFormat:r?w.SizedPixelFormat.R16F:w.PixelFormat.RGBA};throw new b("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/maybe","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,c,w){a.toViewIfLocal=function(n){const x=n.view.spatialReference,m=n.layer.fullExtent;var l=b.isSome(m)&&m.spatialReference;if(b.isNone(m)||!l)return Promise.resolve(null);if(l.equals(x))return Promise.resolve(m.clone());
l=c.project(m,x);return b.isSome(l)?Promise.resolve(l):n.view.state.isLocal?w.projectGeometry(m,x,n.layer.portalItem).then(g=>!n.destroyed&&g?g:null).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,c,w,n){let x=function(){function m(g){this._capabilities=
this._memoryCache=null;const f=g.layerView.layer;this._layerView=g.layerView;this.objectIdField=f.objectIdField;this.globalIdField="globalIdField"in f?f.globalIdField:null;this._returnZ=g.returnZ;this._returnM=g.returnM;g=this._layerView.view.resourceController;this.query=n.createFeatureTileQuery3D(f,g.normal);g&&this._memoryCacheEnabled&&(this._memoryCache=g.memoryController.newCache(f.uid))}var l=m.prototype;l.destroy=function(){this._memoryCache=c.destroyMaybe(this._memoryCache);this.query.destroy()};
l.createQuery=function(){const g=this._layerView.layer.createQuery();g.outFields=this._layerView.availableFields;g.returnZ=this._returnZ;g.returnM=this._returnM;g.outSpatialReference=this.tilingScheme.spatialReference;return g};l.logFetchError=function(g,f){g.error("#fetchTile()",this._layerView.layer,f&&f.message?f.message:f)};b._createClass(m,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;
case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const g=this._layerView.view.resourceController;return g?g.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",
get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return c.isSome(this._capabilities)?this._capabilities:this._capabilities=w.contextCapabilitiesFromLayer(this._layerView.layer)}}]);return m}();a.FeatureTileFetcher3DLayerViewContext=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){let p=function(y){function B(z){return D.call(this,z)}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.queryFeatureCount=function(z,v){return this.layer.queryFeatureCount(z,v)};y.destroy=function(){this._decoder=n.destroyMaybe(this._decoder)};y._createRequestOptions=function(z){return{...z,query:{...this.layer.customParameters,token:this.layer.apiKey,...z?.query}}};b._createClass(B,[{key:"queryFeaturesDehydrated",get:function(){var z=this.layer.capabilities;
z=z&&z.query;const v=this.layer.parsedUrl;if(z&&z.supportsFormatPBF){n.isNone(this._decoder)&&(this._decoder=new u.PBFDecoder(this.controller));const A={sourceSpatialReference:this.layer.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeLength:1024};return(t,C)=>k.runQuery(v,t,"pbf",this._createRequestOptions(C)).then(E=>{x.throwIfAborted(C);return n.isSome(this._decoder)?this._decoder.invoke({buffer:E.data,options:A},C.signal):Promise.reject(x.createAbortError())})}return(A,t)=>
k.executeQuery(v,A,this.layer.spatialReference,this._createRequestOptions(t)).then(C=>e.fromFeatureSetJSON(C.data))}}]);return B}(w);c.__decorate([m.property({constructOnly:!0})],p.prototype,"layer",void 0);c.__decorate([m.property({constructOnly:!0})],p.prototype,"controller",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"queryFeaturesDehydrated",null);p=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],p);let h=function(y){function B(z){return D.call(this,
z)}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.queryFeaturesDehydrated=function(z,v){return this.layer.queryFeatures(z,v)};y.queryFeatureCount=function(z,v){return this.layer.queryFeatureCount(z,v)};return b._createClass(B)}(w);c.__decorate([m.property({constructOnly:!0})],h.prototype,"layer",void 0);c.__decorate([m.property({readOnly:!0})],h.prototype,"queryFeaturesDehydrated",null);h=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],
h);let r=function(y){function B(z){return D.call(this,z)}b._inherits(B,y);var D=b._createSuper(B);B.prototype.queryFeaturesDehydrated=function(z,v){return this.layer.queryFeatures(z,v)};return b._createClass(B)}(w);c.__decorate([m.property({constructOnly:!0})],r.prototype,"layer",void 0);r=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],r);let q=function(y){function B(z){return D.call(this,z)}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;
y.queryFeaturesDehydrated=function(z,v){return this.source.queryFeaturesJSON(z,v).then(e.fromFeatureSetJSON,A=>{if(A&&"query-features-json:unsupported"===A.name)return this.layer.queryFeatures(z,v);throw A;})};y.queryFeatureCount=function(z,v){return this.layer.queryFeatureCount(z,v)};return b._createClass(B)}(w);c.__decorate([m.property({constructOnly:!0})],q.prototype,"layer",void 0);c.__decorate([m.property({constructOnly:!0})],q.prototype,"source",void 0);q=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
q);a.createFeatureTileQuery3D=function(y,B){return"feature"===y.type&&"feature-layer"===y.source.type?n.isSome(y.infoFor3D)?new h({layer:y}):new p({layer:y,controller:B}):"feature"===y.type&&"memory"===y.source.type||"csv"===y.type||"geojson"===y.type||"oriented-imagery"===y.type||"wfs"===y.type?new q({layer:y,source:y.source}):"ogc-feature"===y.type?new r({layer:y}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,c,w,n,x,m,l){function g(e){switch(e.type){case "polyline":e.paths.reduce((k,u)=>k+u.length,0)<n.NATIVE_ARRAY_MAX_SIZE&&(e.paths=e.hasZ||e.hasM?e.paths.map(k=>k.map(u=>[u[0],u[1],u[2]])):e.paths.map(k=>k.map(u=>[u[0],u[1]])));break;case "polygon":e.rings.reduce((k,u)=>k+u.length,0)<n.NATIVE_ARRAY_MAX_SIZE&&(e.rings=e.hasZ||e.hasM?e.rings.map(k=>k.map(u=>[u[0],u[1],u[2]])):e.rings.map(k=>k.map(u=>[u[0],u[1]])))}}let f=function(){function e(u){this._controller=u;this._handle=new d(p=>u.schedule(p))}
var k=e.prototype;k.destroy=function(){this._handle.destroy()};k.invoke=function(u,p){if(!u.buffer||0===u.buffer.byteLength)return Promise.resolve(null);u.options.sourceSpatialReference&&u.options.sourceSpatialReference instanceof m&&(u.options={...u.options,sourceSpatialReference:u.options.sourceSpatialReference.toJSON()});return this._handle.invoke(u,p).then(h=>{let r=0,q=0;const y=async B=>{h.spatialReference=m.fromJSON(h.spatialReference);if(h.fields)for(;r<h.fields.length;)if(h.fields[r]=l.fromJSON(h.fields[r]),
r++,B.madeProgress())return this._controller.reschedule(z=>y(z));const D=h.spatialReference;for(;q<h.features.length;){const z=h.features[q];++q;z.uid=c.generateUID();if(w.isSome(z.geometry)&&(z.geometry.spatialReference=D,g(z.geometry),B.madeProgress()))return this._controller.reschedule(v=>y(v))}return h};return this._controller.schedule(B=>y(B))})};return b._createClass(e)}(),d=function(e){function k(p){return u.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:h=>[h.buffer]},
p)}b._inherits(k,e);var u=b._createSuper(k);return b._createClass(k)}(x.WorkerHandle);a.PBFDecoder=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,b,c,w,n){c=function(x){function m(){var g=l.apply(this,arguments);g._set=new Set;return g}b._inherits(m,x);var l=b._createSuper(m);
x=m.prototype;x.clear=function(){if(0<this._set.size){const g=this.toArray();this._set.clear();this.emit("after-changes",{type:w.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:g})}};x.addMany=function(g){if(0!==g.length){for(const f of g)this._set.add(f);this.emit("after-changes",{type:w.ObservableChangesType.ADD});this.emit("change",{added:g,removed:[]})}};x.remove=function(g){this._set.delete(g)&&(this.emit("after-changes",{type:w.ObservableChangesType.REMOVE}),this.emit("change",
{added:[],removed:[g]}))};x.removeMany=function(g){const f=[];for(const d of g)this._set.delete(d)&&f.push(d);0<f.length&&(this.emit("after-changes",{type:w.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:f}))};x.toArray=function(){return[...this._set]};x.find=function(g){let f;n.someSet(this._set,d=>g(d)?(f=d,!0):!1);return f};x.forEach=function(g){this._set.forEach(f=>g(f))};b._createClass(m,[{key:"length",get:function(){return this._set.size}}]);return m}(c);a.EventedSet=c;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){const D=w.getLogger("esri.views.layers.FeatureLayerView");return z=>{z=function(v){function A(...C){C=t.call(this,...C);C._updatingRequiredFieldsPromise=null;C.filter=null;C.timeExtent=null;C.layer=null;C.requiredFields=[];C.view=null;return C}a._inherits(A,v);var t=a._createSuper(A);v=A.prototype;v.initialize=function(){this.handles.add([m.watch(()=>{const C=this.layer;return[C?.elevationInfo?.featureExpressionInfo,C&&"displayField"in C?C.displayField:
null,C&&"timeInfo"in C&&C.timeInfo,C&&"renderer"in C&&C.renderer,C&&"labelingInfo"in C&&C.labelingInfo,C&&"floorInfo"in C&&C.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),m.syncAndInitial),m.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),m.on(()=>{const C=this.layer;return C&&"sublayers"in C?C.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])};v.highlight=function(C){throw Error("missing implementation");
};v.createQuery=function(){var C={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};C=n.isSome(this.filter)?this.filter.createQuery(C):new q(C);if("feature"===this.layer.type){const E=r.getFloorFilterClause(this);n.isSome(E)&&(C.where=C.where?`(${C.where}) AND (${E})`:E)}n.isSome(this.timeExtent)&&(C.timeExtent=n.isSome(C.timeExtent)?C.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return C};v.createAggregateQuery=function(){return new q({outFields:["*"],
returnGeometry:!0,outSpatialReference:this.view.spatialReference})};v.queryFeatures=function(C,E){throw Error("missing implementation");};v.queryObjectIds=function(C,E){throw Error("missing implementation");};v.queryFeatureCount=function(C,E){throw Error("missing implementation");};v.queryExtent=function(C,E){throw Error("missing implementation");};v.fetchPopupFeatures=async function(C,E){if(C=this.validateFetchPopupFeatures(E))throw C;return this.fetchClientPopupFeatures(E)};v._loadArcadeModules=
function(C){return C.get("expressionInfos.length")||Array.isArray(C.content)&&C.content.some(E=>"expression"===E.type)?y.loadArcade():Promise.resolve()};v._handleRequiredFieldsChange=function(){const C=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",C);C.then(()=>{this._updatingRequiredFieldsPromise===C&&this._set("_updatingRequiredFieldsPromise",null)})};v._updateRequiredFields=async function(){if(this.layer&&this.view){var C="3d"===this.view.type,{layer:E,layer:{fieldsIndex:F,
objectIdField:H}}=this,K="renderer"in E&&E.renderer,I="orderBy"in E&&E.orderBy,L="featureReduction"in E?E.featureReduction:null,R=new Set;K=await x.eachAlways([K?K.collectRequiredFields(R,F):null,h.collectLabelingFields(R,E),C?h.collectElevationFields(R,E):null,n.isSome(this.filter)?h.collectFilterFields(R,E,this.filter):null,n.isSome(this.featureEffect)?h.collectFilterFields(R,E,this.featureEffect.filter):null,L?h.collectFeatureReductionFields(R,E,L):null,I?h.collectOrderByInfos(R,E,I):null]);"timeInfo"in
E&&E.timeInfo&&this.timeExtent&&h.collectFields(R,E.fieldsIndex,[E.timeInfo.startField,E.timeInfo.endField]);"feature"===E.type&&(E.floorInfo&&h.collectFields(R,E.fieldsIndex,[E.floorInfo.floorField]),C&&n.isSome(E.infoFor3D)&&(null==E.globalIdField&&D.error("globalIdField missing on 3DObjectFeatureLayer"),h.collectFields(R,E.fieldsIndex,[E.globalIdField])));"subtype-group"===E.type&&(h.collectField(R,F,E.subtypeField),I=E.sublayers.map(O=>Promise.all([O.renderer?.collectRequiredFields(R,F),h.collectLabelingFields(R,
O)])),await x.eachAlways(I));for(const O of K)O.error&&D.error(O.error);h.collectField(R,F,H);C&&"displayField"in E&&E.displayField&&h.collectField(R,F,E.displayField);C=Array.from(R).sort();this._set("requiredFields",C)}};v.validateFetchPopupFeatures=function(C){if(n.isNone(C))return null;for(const E of C.clientGraphics??[]){const F=E.layer;if("popupEnabled"in F&&!F.popupEnabled)return new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:F});if(E.isAggregate){const H="featureReduction"in
F?F.featureReduction:null;if(!(H&&"popupTemplate"in H&&H.popupEnabled&&H.popupTemplate))return new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:F})}else if("popupTemplate"in F&&!B.getFetchPopupTemplate(F,C))return new c("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:F})}};v.fetchClientPopupFeatures=async function(C){const E=n.isSome(C)?C.clientGraphics:null;if(!E||0===E.length)return[];const F=Array(E.length),H=new Map,K=await this.createPopupQuery(C);
for(let L=0;L<E.length;L++){const R=E[L];if(R.isAggregate){F[L]=R;continue}var I=R.layer;if(!("popupEnabled"in I))continue;const O=h.unpackFieldNames(this.layer.fieldsIndex,K.outFields);I=B.getFetchPopupTemplate(I,C);if(n.isNone(I))continue;const J=await this._loadArcadeModules(I);J&&J.arcadeUtils.hasGeometryOperations(I)||!h.featureHasFields(O,R)?H.set(R.getObjectId(),{graphic:R,index:L}):F[L]=R}if("stream"===this.layer.type||0===H.size)return F.filter(Boolean);K.objectIds=Array.from(H.keys());try{const L=
await this.layer.queryFeatures(K);for(const R of L.features){const {graphic:{geometry:O},index:J}=H.get(R.getObjectId());R.geometry||(R.geometry=O);F[J]=R}}catch{}return F.filter(Boolean)};v.createPopupQuery=async function(C){const E=this.layer.createQuery(),F=new Set;var H=!1,K=n.isSome(C)&&C.clientGraphics?C.clientGraphics.map(I=>I.layer):[this.layer];for(const I of K)if("popupEnabled"in I&&(K=B.getFetchPopupTemplate(I,C),!n.isNone(K))){H=(H=await this._loadArcadeModules(K))&&H.arcadeUtils.hasGeometryOperations(K);
H=!("point"!==this.layer.geometryType&&!H);K=await B.getRequiredFields(this.layer,K);for(const L of K)F.add(L)}E.returnGeometry=H;E.returnZ=H;E.returnM=H;E.outFields=Array.from(F);E.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(C=r.getFloorFilterClause(this),n.isSome(C)&&(E.where=E.where?`(${E.where}) AND (${C})`:C));return E};v.canResume=function(){return!a._get(a._getPrototypeOf(A.prototype),"canResume",this).call(this)||n.isSome(this.timeExtent)&&this.timeExtent.isEmpty?
!1:!0};a._createClass(A,[{key:"availableFields",get:function(){const {layer:C,layer:{fieldsIndex:E},requiredFields:F}=this;return"outFields"in C&&C.outFields?h.fixFields(E,[...h.unpackFieldNames(E,C.outFields),...F]):h.fixFields(E,F)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(C){this._override("featureEffect",C)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(C){D.error("#maximumNumberOfFeatures\x3d",
"Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return A}(z);b.__decorate([l.property()],z.prototype,"_updatingRequiredFieldsPromise",void 0);b.__decorate([l.property({readOnly:!0})],z.prototype,"availableFields",null);b.__decorate([l.property({type:u})],z.prototype,"featureEffect",null);b.__decorate([l.property({type:p})],z.prototype,"filter",void 0);b.__decorate([l.property(k.combinedViewLayerTimeExtentProperty)],z.prototype,
"timeExtent",void 0);b.__decorate([l.property()],z.prototype,"layer",void 0);b.__decorate([l.property({type:Number})],z.prototype,"maximumNumberOfFeatures",null);b.__decorate([l.property({readOnly:!0,type:Boolean})],z.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([l.property({readOnly:!0})],z.prototype,"requiredFields",void 0);b.__decorate([l.property()],z.prototype,"suspended",void 0);b.__decorate([l.property()],z.prototype,"view",void 0);return z=b.__decorate([e.subclass("esri.views.layers.FeatureLayerView")],
z)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g,f){return d=>{d=function(e){function k(){return u.apply(this,arguments)}a._inherits(k,e);var u=a._createSuper(k);
k.prototype.initialize=function(){this.handles.add(n.on(()=>this.layer,"refresh",p=>{this.doRefresh(p.dataChanged).catch(h=>{w.isAbortError(h)||c.getLogger(this.declaredClass).error(h)})}),"RefreshableLayerView")};return a._createClass(k)}(d);b.__decorate([x.property()],d.prototype,"layer",void 0);return d=b.__decorate([f.subclass("esri.layers.mixins.RefreshableLayerView")],d)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../core/has ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa){function ia(ea){return ja=>ea.immediate.schedule(ja)}const na=D.create();k=function(ea){function ja(){var da=ka.apply(this,arguments);da.type="point-cloud-3d";da.maximumPointCount=4E6;da.slicePlaneEnabled=!1;da._renderer=null;da._rendererAdded=!1;da._renderedNodes=new Set;da._nodeScales=new Map;da._updateViewNeeded=!0;da._lodFactor=1;da._maxLoggedBoxWarnings=5;da._pageMultiplier=1;da._nodeLoadEpoch=
0;da._indexQueue=[];da._workQueue=[];da._idleQueue=new K.PromiseQueue;da._indexPagesLoading=new Map;da._loadingNodes=new Map;da._recalcWork=!0;da._layerIsVisible=!1;da._codedDomainPopulationPromise=null;da._codedDomainPopulationAbortController=null;da._totalWork=0;da._index=null;da._loadingInitNodePage=!1;da._nodeIdArray=[];da.ignoresMemoryFactor=!1;return da}a._inherits(ja,ea);var ka=a._createSuper(ja);ea=ja.prototype;ea.initialize=function(){const da=this.view.resourceController;var ha=ia(da);this._worker=
new R.PointCloudWorkerHandle(ha);this.addResolvingPromise(this._worker.promise);this._tmpPoint=z.makeDehydratedPoint(0,0,0,this.layer.spatialReference);O.checkPointCloudLayerValid(this.layer);O.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=da.createStreamDataRequester(W.ClientType.I3S_INDEX);this._dataRequester=da.createStreamDataRequester(W.ClientType.I3S_DATA);this._initRenderer();ha=this._initNodePages();const ca=this.view.resourceController.memoryController;
this._memCache=ca.newCache(this.layer.uid);this.updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),l.initial);this.updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),l.initial);this.updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),l.initial);this.updatingHandles.add(()=>this.layer.filters,()=>this._reload(),l.initial);this.updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),l.initial);this.updatingHandles.add(()=>
this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this.updatingHandles.add(()=>this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",fa=>this._scaleUpdateHandler(fa)),l.watch(()=>ca.memoryFactor,()=>this._setUpdateViewNeeded(),l.sync)]);this.addResolvingPromise(ha);this.when(()=>{this.handles.add([da.scheduler.registerTask(aa.TaskPriority.POINT_CLOUD_LAYER,this),da.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),
()=>this._idleEnd()),this.updatingHandles.add(()=>this.suspended,fa=>{fa?this._clearNodeState():this._setUpdateViewNeeded()},l.initial)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};ea._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};ea.destroy=function(){this.cancelLoading();this._worker=x.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=x.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=x.abortMaybe(this._codedDomainPopulationAbortController);
this._codedDomainPopulationPromise=null};ea._initRenderer=function(){this._renderer=new N.PointRenderer({createGraphic:(da,ha,ca)=>this._createGraphic(da,ha,ca)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(()=>this._clippingBox,da=>this._renderer.clippingBox=da,l.initial);this.updatingHandles.add(()=>this.suspended,da=>this._setPointsVisible(!da),l.initial);this.updatingHandles.add(()=>this.pointScale,da=>this._renderer.scaleFactor=da,l.initial);this._renderer.minSizePx=Math.sqrt(2);
this.updatingHandles.add(()=>this.useRealWorldSymbolSizes,da=>this._renderer.useRealWorldSymbolSizes=da,l.initial);this.updatingHandles.add(()=>this.pointSize,da=>{const ha=g.pt2px(da);this._renderer.size=da;this._renderer.sizePx=ha},l.initial);this.updatingHandles.add(()=>this.slicePlaneEnabled,da=>this._renderer.slicePlaneEnabled=da,l.initial);this.updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),l.initial);this.updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),
l.initial);this.updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,da=>{this._lodFactor=da;this._setUpdateViewNeeded()},l.initial)};ea._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};ea._createGraphic=function(da,ha,ca){const fa=x.isSome(da.pointIdFilterMap)?da.pointIdFilterMap[ha]:ha;ca=this.view.computeMapPointFromVec3d(ca);const ma=this._createGraphicAttributes(da,fa);return new U.PointGraphic({pointCloudMetadata:{nodeId:da.id,
pointIndexInNode:ha,attributePointIndexInNode:fa,epoch:this._nodeLoadEpoch},geometry:ca,attributes:ma,layer:this.layer,sourceLayer:this.layer})};ea._createGraphicAttributes=function(da,ha){const ca={};for(const fa of da.attributes)this._encodeGraphicAttribute(fa.attributeInfo,fa.values,ha,ca);return ca};ea._encodeGraphicAttribute=function(da,ha,ca,fa){var ma=da.storageInfo?.attributeValues;const qa=ma?.valuesPerElement??1;if(1===qa)fa[da.name]=ha[ca];else if("UInt8"===ma?.valueType&&4>=qa){ma=0;ca*=
qa;for(let wa=ca;wa<ca+qa;wa++)ma=(ma<<8)+ha[wa];fa[da.name]=ma}else fa[da.name]=void 0};ea._setPointsVisible=function(da){da&&!this._rendererAdded?(this.view._stage.addRenderPlugin([X.RenderSlot.OPAQUE_MATERIAL],this._renderer),this._rendererAdded=!0):!da&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};ea._rendererChanged=function(){this._renderer.useFixedSizes=G.rendererUsesFixedSizes(this.layer.renderer);this._reload()};ea._reload=function(){this._clearNodeState();
this._memCache.clear();this._setUpdateViewNeeded()};ea._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};ea._scaleUpdateHandler=function(da){const ha=this.layer.effectiveScaleRange;Y.isScaleRangeActive(ha.minScale,ha.maxScale)?q.projectBoundingRect(da.extent,da.spatialReference,ba,this.layer.spatialReference)&&(this._nodeScales.forEach((ca,fa)=>{this._renderedNodes.has(fa)?(ca=this._index.getNode(fa),B.containsPoint(ba,ca.obb.center)&&this._nodeScales.set(fa,
da.scale)):this._nodeScales.delete(fa)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};ea._displayNodes=function(da){this._workQueue=J.nodeDiff([...this._renderedNodes],da,this._index);J.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);J.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<da.length||this._loadingInitNodePage;this.notifyChange("suspended")};
ea.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};ea._cancelNodeLoading=function(){const da=[];this._loadingNodes.forEach(({abortController:ha})=>da.push(ha));this._loadingNodes.clear();for(const ha of da)ha.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};ea._updateQueues=function(){const da=new Set;this._workQueue.forEach(fa=>fa.load.forEach(ma=>da.add(ma)));const ha=[],ca=new Map;this._loadingNodes.forEach((fa,
ma)=>{da.has(ma)?ca.set(ma,fa):ha.push(fa)});this._loadingNodes=ca;for(const {abortController:fa}of ha)fa.abort();this._workQueue=this._workQueue.filter(fa=>{for(const ma of fa.load)if(this._loadingNodes.has(ma))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};ea._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:da})=>da.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();
this._updateLoading()};ea._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(da=>this._removeFromRenderer(da));this._cancelNodeLoading()};ea._idleBegin=function(){this._setUpdateViewNeeded()};ea._idleEnd=function(){this._setUpdateViewNeeded()};ea.runTask=function(da){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,da=this._isRootNodeVisible(),da!==this._layerIsVisible&&(this._layerIsVisible=da,this.notifyChange("suspended")),this._updateLoading());else{for(da.run(()=>
this._updateWorkQueues());0<this._indexQueue.length&&da.run(()=>this._processIndexQueue()););this._processWorkQueue(da);this._idleQueue.runTask(da)}};ea._processIndexQueue=function(){const da=this._indexQueue.shift(),ha=this._loadNodePage(da);this._indexPagesLoading.set(da,ha);ha.promise.then(ca=>{this._index.addPage(da,ca,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(da)},()=>{this._indexPagesLoading.delete(da)});return!0};ea._processWorkQueue=function(da){for(;!da.done;){const ha=
this._scheduleWorkEntry();if(x.isNone(ha))break;this._processWorkEntry(ha);da.madeProgress()}};ea._scheduleWorkEntry=function(){let da=this._workQueue.length;for(;da--;){const ha=this._workQueue.shift();if(ha.remove.find(ca=>!this._renderedNodes.has(ca)))this._workQueue.push(ha);else return ha}return null};ea._processWorkEntry=function(da){if(0===da.load.length)for(const ha of da.remove)this._removeFromRenderer(ha);else Promise.all(da.load.map(ha=>{const ca=new AbortController,fa=this._memCache.pop(ha.toString());
x.isSome(fa)?this._loadingNodes.set(ha,{abortController:ca,promise:Promise.resolve(fa)}):this._loadingNodes.has(ha)||this._loadingNodes.set(ha,{abortController:ca,promise:this._loadNode(ha,ca.signal)});return this._loadingNodes.get(ha).promise})).then(ha=>{for(let ca=0;ca<da.load.length;ca++)if(ha[ca]){const fa=this._setupRendererData(da.load[ca],ha[ca]);this._addToRenderer(fa)}for(const ca of da.remove)this._removeFromRenderer(ca)}).catch(()=>{}).then(()=>{for(const ha of da.load)this._loadingNodes.delete(ha);
this._updateLoading();this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};ea._populateClassCodeCodedDomain=async function(da,ha){const ca=this.layer.fieldsIndex.get("CLASS_CODE");ca&&!ca.domain&&da.includes(ca.name)&&(da=await c.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ha})),!1!==da.ok&&(da=(da=da.value)&&da.labels&&da.labels.labels)&&Array.isArray(da)&&
(ca.domain=new t({name:"CLASS_CODE",codedValues:da.map(fa=>new v.CodedValue({code:fa.value,name:fa.label}))})))};ea.prepareFetchPopupFeatures=async function(da){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(da,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise};ea.whenGraphicAttributes=
async function(da,ha){const ca=this._splitGraphicsPerNode(da),fa=this.layer.attributeStorageInfo,ma=ha.map(xa=>G.getAttributeInfo(fa,xa)).filter(x.isSome),qa=async(xa,pa)=>{const ra=this._index.getNode(pa);await c.forEach(ma,async va=>{const Ba=va.useElevation?await this._loadElevationAttributeFromGeometry(ra.resourceId):await this._loadAndParseAttribute(ra,va);if(Ba)for(const Aa of xa)this._isValidPointGraphic(Aa)&&this._encodeGraphicAttribute(va,Ba,Aa.pointCloudMetadata.attributePointIndexInNode,
Aa.attributes)})},wa=[];ca.forEach((xa,pa)=>{wa.push(qa(xa,pa))});await m.eachAlways(wa);return da};ea._isValidPointGraphic=function(da){return da instanceof U.PointGraphic&&da.pointCloudMetadata&&da.pointCloudMetadata.epoch===this._nodeLoadEpoch};ea._splitGraphicsPerNode=function(da){const ha=new Map;for(const ca of da){if(!this._isValidPointGraphic(ca))continue;da=ca.pointCloudMetadata;const fa=ha.get(da.nodeId);fa?fa.push(ca):ha.set(da.nodeId,[ca])}return ha};ea._loadAndParseAttribute=async function(da,
ha){const ca=await this._loadAttribute(da.resourceId,ha,null);return x.isSome(ca)?P.getAttributeValues({attributeInfo:ha,buffer:ca},null,da.vertexCount):null};ea._loadElevationAttributeFromGeometry=async function(da){da=P.readGeometry(this.layer.store.defaultGeometrySchema,await this._loadGeometry(da,null));return P.elevationFromPositions(da,da.length/3)};ea.highlight=function(da){if(!da)return{remove(){}};da=w.isCollection(da)?da.toArray():Array.isArray(da)?da:[da];return this._renderer.highlight(da.map(ha=>
this._graphicToPointDefinition(ha)))};ea._graphicToPointDefinition=function(da){if(!this._isValidPointGraphic(da))return null;const {nodeId:ha,pointIndexInNode:ca}=da.pointCloudMetadata;return null!=ha&&null!=ca?{nodeId:ha,pointId:ca}:null};ea._computeWork=function(){let da=0;for(const ha of this._workQueue)da+=ha.load.length+ha.remove.length;da+=this._loadingNodes.size;da+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;da+=this._loadingInitNodePage?100:0;return da+=this._updateViewNeeded?
100:0};ea._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};ea.canResume=function(){return a._get(a._getPrototypeOf(ja.prototype),"canResume",this).call(this)&&this._layerIsVisible};ea.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};ea._initNodePages=function(){const da=this.layer.store.index;this._index=new M(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,da.nodesPerPage||da.nodePerIndexBlock);
this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=da.nodesPerPage?1:da.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ha=>{this._index.addPage(0,ha,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};ea._loadNodePage=function(da){const ha=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${da*
this._pageMultiplier}`,ha.signal).then(ca=>ca.nodes.map((fa,ma)=>({resourceId:null!=fa.resourceId?fa.resourceId:da*this._index.pageSize+ma,obb:fa.obb,firstChild:fa.firstChild,childCount:fa.childCount,vertexCount:fa.vertexCount??fa.pointCount,lodThreshold:fa.lodThreshold??fa.effectiveArea}))),abortController:ha}};ea._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let da=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const ha=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();
let ca=this._computeNodesForMinimumDensity(da),fa=this._computePointCount(ca),ma=Math.sqrt(fa/(.75*ha));for(;fa>ha;)da*=ma,ca=this._computeNodesForMinimumDensity(da),fa=this._computePointCount(ca),ma=Math.sqrt(2);this._displayNodes(ca);this._updateViewNeeded=!1;this._updateLoading();return!0};ea._computePointCount=function(da){let ha=0;for(let ca=0;ca<da.length;ca++){const fa=this._index.getNode(da[ca]);fa&&(ha+=fa.vertexCount)}return ha};ea._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};
ea._isRootNodeVisible=function(){let da=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(ha,ca,fa)=>{da=fa;return!1},pageMiss:()=>{}});return da};ea._computeNodesForMinimumDensity=function(da){const ha=this.view.state.contentCamera,ca=ha.frustum,fa=this._clippingBox,ma=ha.viewForward,qa=h.dot(ma,ha.eye),wa=D.fromNormalAndOffset(ma,-qa,na),xa=ha.perScreenPixelRatio/2,pa=da*da,ra=this._nodeIdArray;ra.length=0;const {minScale:va,maxScale:Ba}=
Y.extractSafeScaleBounds(this.layer),Aa=0===va&&0===Ba?Ha=>ra.push(Ha):Ha=>{const Ka=this._getScale(Ha);Y.scaleBoundsPredicate(Ka,va,Ba)&&ra.push(Ha)};this._traverseVisible({frustum:ca,clippingBox:fa},{predicate:(Ha,Ka,Pa)=>{if(!Pa)return!1;if(0===Ka.childCount)return Aa(Ha),!1;Pa=this._index.getRenderObb(Ha);return this._computeAveragePixelArea(Pa,Ka.lodThreshold,Ka.vertexCount,wa,xa)<=pa?(Aa(Ha),!1):!0},pageMiss:(Ha,Ka)=>{Aa(Ha);this._indexQueue.includes(Ka)||this._indexQueue.push(Ka)}});return ra};
ea._getScale=function(da){var ha=this._nodeScales.get(da);null==ha&&(ha=this._index.getNode(da).obb.center,this._tmpPoint.x=ha[0],this._tmpPoint.y=ha[1],this._tmpPoint.z=ha[2],ha=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(da,ha));return ha};ea._computeAveragePixelArea=function(da,ha,ca,fa,ma){da=Math.max(1E-7,V.minimumDistancePlane(da,fa));return ha/(da*da)/(4*ma*ma)/ca};ea._loadNode=function(da,ha){try{return this._loadNodeAsync(da,ha)}catch(ca){throw m.isAbortError(ca)||
n.getLogger(this.declaredClass).error(ca),ca;}};ea._loadAdditionalUserAttributes=async function(da,ha,ca){var fa=this.layer.outFields;if(!fa)return[];fa=H.unpackFieldNames(this.layer.fieldsIndex,fa);da=new Set(da.map(wa=>x.isSome(wa)?wa.name:null));const ma=this.layer.attributeStorageInfo,qa=[];for(const wa of fa)da.has(wa)||(fa=G.getAttributeInfo(ma,wa))&&qa.push(ha(fa));ha=await m.eachAlwaysValues(qa);m.throwIfAborted(ca);return x.mapSome(ha,wa=>wa)};ea._loadNodeAsync=async function(da,ha){const ca=
this._index.getNode(da),fa=G.getRendererInfo(this.layer),ma=G.getFilterInfo(this.layer),qa=ca.resourceId,wa=async xa=>{if(x.isNone(xa))return null;if(xa.useElevation)return{attributeInfo:xa,buffer:null};const pa=await this._loadAttribute(qa,xa,ha);return x.isSome(pa)?{attributeInfo:xa,buffer:pa}:null};return this._idleQueue.push(async()=>{var xa=this._loadGeometry(qa,ha);const {primaryAttribute:pa,modulationAttribute:ra}=fa,va=wa(pa),Ba=wa(ra);var Aa=ma.map(Ua=>Ua.attributeInfo);const Ha=Aa.map(Ua=>
wa(Ua));Aa=this._loadAdditionalUserAttributes([pa,ra,...Aa],wa,ha);const [Ka,Pa,Ra,Sa,La]=await Promise.all([xa,va,Ba,Promise.all(Ha),Aa]);m.throwIfAborted(ha);xa={geometryBuffer:Ka,primaryAttributeData:Pa,modulationAttributeData:Ra,filterAttributesData:Sa,userAttributesData:La,schema:this.layer.store.defaultGeometrySchema,rendererInfo:fa,filterInfo:ma,obb:this._index.getRenderObb(da),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};
return this._worker.invoke(xa,ha)},ha)};ea._loadGeometry=async function(da,ha){return this._requestData(`${this.baseUrl}/nodes/${da}/geometries/0`,ha)};ea._loadAttribute=async function(da,ha,ca){return x.isNone(ha)||!ha.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${da}/attributes/${ha.storageInfo.key}`,ca)};ea._requestNodePage=function(da,ha){return this._indexRequester.request(da,"json",{query:{f:"json",token:this.layer.apiKey},signal:ha})};ea._requestData=function(da,ha){return this._dataRequester.request(da,
"binary",{query:{token:this.layer.apiKey},signal:ha})};ea._removeFromRenderer=function(da){if(this._renderedNodes.has(da)){const ha=this._renderer.removeNode(da);this._renderedNodes.delete(da);this._nodeScales.delete(da);this._memCache.put(ha.id.toString(),ha,5*ha.coordinates.length+128)}};ea._addToRenderer=function(da){this._renderedNodes.has(da.id)||(this._renderedNodes.add(da.id),this._renderer.addNode(da))};ea._setupRendererData=function(da,ha){const ca=this._index.getNode(da),fa=Math.sqrt(ca.lodThreshold/
ca.vertexCount),ma=this._index.getRenderObb(da);if(N.isInstanceOfNode(ha))return ha.splatSize=fa,ha.obb=ma,h.copy(ha.origin,ha.obb.center),ha;var qa=.01*Math.max(ma.halfSize[0],ma.halfSize[1],ma.halfSize[2]);if(ha.obb.halfSize[0]>ma.halfSize[0]+qa||ha.obb.halfSize[1]>ma.halfSize[1]+qa||ha.obb.halfSize[2]>ma.halfSize[2]+qa)0<this._maxLoggedBoxWarnings&&(qa=wa=>`[${wa.halfSize[0]}, ${wa.halfSize[1]}, ${wa.halfSize[2]}]`,n.getLogger(this.declaredClass).warn(`Node ${da} reported bounding box too small. got ${qa(ma)} but points cover ${qa(ha.obb)}`),
0===--this._maxLoggedBoxWarnings&&n.getLogger(this.declaredClass).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(da,ha.obb);return new N.PointRendererNode(da,fa,r.clone(ma.center),ma,0===ca.childCount,ha.points,ha.rgb,ha.attributes,ha.pointIdFilterMap)};a._createClass(ja,[{key:"baseUrl",get:function(){return this.layer.parsedUrl.path}},{key:"pointScale",get:function(){const da=G.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return da&&
null!=da.scaleFactor?da.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const da=G.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return da&&null!=da.useRealWorldSymbolSizes?da.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const da=G.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return da&&null!=da.size?da.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",
get:function(){var da=G.getRendererInfo(this.layer);const ha=new Set;da.primaryAttribute&&ha.add(da.primaryAttribute.name);da.modulationAttribute&&ha.add(da.modulationAttribute.name);if(da=G.getFilterInfo(this.layer))for(const ca of da)ca.attributeInfo&&ha.add(ca.attributeInfo.name);if(this.layer.outFields)for(const ca of H.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))ha.add(ca);return Array.from(ha)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;
const da=y.create();return Q.projectToBoundingBox(this.view.clippingArea,da,this.view.renderSpatialReference)?da:null}},{key:"_elevationOffset",get:function(){const da=this.layer&&this.layer.elevationInfo;if(da&&"absolute-height"===da.mode){const ha=d.getMetersPerVerticalUnitForSR(this.layer.spatialReference),ca=I.getMetersPerUnit(da.unit);return x.unwrapOr(da.offset,0)*ca/ha}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||
0<this._workQueue.length||this._idleQueue.running}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const da=this._computeWork();return 1-Math.min(this._totalWork,da)/this._totalWork}},{key:"usedMemory",get:function(){let da=0;this._renderer.forEachNode(ha=>{da+=160;da+=f.estimateSize(ha.coordinates);for(const ca of ha.attributes)ha=ca.values,f.isArrayBuffer(ha.buffer)&&(da+=f.estimateSize(ha))});return da}},{key:"unloadedMemory",get:function(){const da=
this._renderedNodes.size;if(4>da)return 0;const ha=[...this._renderedNodes].reduce((fa,ma)=>fa+this._index.getNode(ma).vertexCount);let ca=this._loadingNodes.size;for(let fa=0;fa<this._workQueue.length;fa++)ca+=this._workQueue[fa].load.length,ca-=this._workQueue[fa].remove.length;return 0>ca?0:ca*ha/da*((this.usedMemory-160*da)/ha)+160*ca}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((da,ha)=>da+this._index.getNode(ha).vertexCount,
0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return ja}(S.PopupSceneLayerView(L.LayerView3D(Z)));b.__decorate([e.property()],k.prototype,"layer",void 0);b.__decorate([e.property()],k.prototype,"baseUrl",null);b.__decorate([e.property()],
k.prototype,"pointScale",null);b.__decorate([e.property()],k.prototype,"useRealWorldSymbolSizes",null);b.__decorate([e.property()],k.prototype,"pointSize",null);b.__decorate([e.property()],k.prototype,"inverseDensity",null);b.__decorate([e.property()],k.prototype,"maximumPointCount",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"availableFields",null);b.__decorate([e.property({readOnly:!0})],k.prototype,"_clippingBox",null);b.__decorate([e.property({readOnly:!0})],k.prototype,"_elevationOffset",
null);b.__decorate([e.property({type:Boolean})],k.prototype,"slicePlaneEnabled",void 0);b.__decorate([e.property()],k.prototype,"updating",void 0);b.__decorate([e.property(T.updatingProgress)],k.prototype,"updatingProgress",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"updatingProgressValue",null);b=k=b.__decorate([p.subclass("esri.views.3d.layers.PointCloudLayerView3D")],k);const ba=B.create();return b})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,b,c,w){w=function(n){function x(l){var g;return g=m.call(this,"PointCloudWorker","transform",{transform:f=>g._getTransferList(f)},l)}b._inherits(x,n);var m=b._createSuper(x);x.prototype._getTransferList=function(l){const g=[l.geometryBuffer];c.isSome(l.primaryAttributeData)&&l.primaryAttributeData.buffer&&g.push(l.primaryAttributeData.buffer);c.isSome(l.modulationAttributeData)&&l.modulationAttributeData.buffer&&
g.push(l.modulationAttributeData.buffer);if(c.isSome(l.filterAttributesData))for(const f of l.filterAttributesData)c.isSome(f)&&f.buffer&&g.push(f.buffer);for(const f of l.userAttributesData)f.buffer&&g.push(f.buffer);return g};return b._createClass(x)}(w.WorkerHandle);a.PointCloudWorkerHandle=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,b){function c(g,f,d){for(;0<g;){const e=
f.indexOf(g);if(0<=e)return e;g=d.getParentId(g)}return f.indexOf(g)}function w(g,f,d){const e=[f.remove[0]],k=[];for(;1===e.length;){const p=e.pop();k.length=0;for(let h=0;h<f.load.length;h++){let r=f.load[h];for(var u=d.getParentId(r);u!==p;)r=u,u=d.getParentId(r);u=e.indexOf(r);0>u&&(u=e.length,e.push(r),k.push([]));k[u].push(f.load[h])}}f.load=e;for(f=0;f<e.length;f++)1<k[f].length?g.push({remove:[e[f]],load:k[f]}):e[f]=k[f][0]}const n=[!1],x=[null],m=[!1],l=[null];a.nodeDiff=function(g,f,d){for(var e=
0;e<f.length;e++)m[e]=!1,l[e]=null;for(e=0;e<g.length;e++)n[e]=!1,x[e]=null;for(e=0;e<f.length;e++){var k=c(f[e],g,d);0<=k&&(m[e]=!0,null!=x[k]?x[k].push(f[e]):x[k]=[f[e]])}for(e=0;e<g.length;e++)k=c(g[e],f,d),0<=k&&(n[e]=!0,null!=l[k]?l[k].push(g[e]):l[k]=[g[e]]);d=[];for(e=0;e<g.length;e++)null!=x[e]||n[e]||d.push({load:[],remove:[g[e]]});for(e=0;e<f.length;e++)null!=l[e]||m[e]||d.push({load:[f[e]],remove:[]});for(e=0;e<f.length;e++)null!=l[e]&&(1<l[e].length||l[e][0]!==f[e])&&d.push({load:[f[e]],
remove:l[e]});for(f=0;f<g.length;f++)null!=x[f]&&(1<x[f].length||x[f][0]!==g[f])&&d.push({load:x[f],remove:[g[f]]});return d};a.sortFrontToBack=function(g,f,d){return g.sort((e,k)=>{if(0===e.load.length&&0===k.load.length)return 0;if(0===e.load.length)return-1;if(0===k.load.length)return 1;if(0===e.remove.length&&0===k.remove.length)return e=d.getRenderCenter(e.load[0]),k=d.getRenderCenter(k.load[0]),b.dot(e,f)-b.dot(k,f);if(0===e.remove.length)return-1;if(0===k.remove.length)return 1;if(1===e.load.length&&
1===k.load.length)return e=d.getRenderCenter(e.load[0]),k=d.getRenderCenter(k.load[0]),b.dot(e,f)-b.dot(k,f);if(1===e.load.length)return-1;if(1===k.load.length)return 1;e=d.getRenderCenter(e.remove[0]);k=d.getRenderCenter(k.remove[0]);return b.dot(e,f)-b.dot(k,f)})};a.splitWorkEntries=function(g,f,d){for(let e=0;e<g.length;++e){const k=g[e];k.load.length>f&&1===k.remove.length&&w(g,k,d)}};a.splitWorkEntry=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,b,c,w){return function(){function n(m,l,g){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=m;this._renderSR=l;this.pageSize=g}var x=n.prototype;x.addPage=function(m,l,g=0){for(;this._pages.length<m;)this._pages.push(null);var f=this._nodeSR,d=this._renderSR,e=new w.ObbArray(l.length);for(var k=0;k<l.length;k++)c.transformObb(l[k].obb,f,e.obbs[k],d,g);this._pages[m]=
{nodes:l,renderObbs:e.obbs,parents:new Uint32Array(this.pageSize)};m=this._pages;l=this.pageSize;for(g=[0];g.length;)for(f=g.pop(),d=m[f/l|0].nodes[f%l],e=0;e<d.childCount;e++)k=d.firstChild+e,null!=m[k/l|0]&&(m[k/l|0].parents[k%l]=f,g.push(k))};x.hasPage=function(m){return!!this._pages[m]};x.getNode=function(m){const l=this.pageSize;return this._pages[m/l|0].nodes[m%l]};x.getRenderObb=function(m){const l=this.pageSize;return this._pages[m/l|0].renderObbs[m%l]};x.getRenderCenter=function(m){return this.getRenderObb(m).center};
x.setRenderObb=function(m,l){const g=this.pageSize;w.set(l,this._pages[m/g|0].renderObbs[m%g])};x.getParentId=function(m){const l=this.pageSize;return this._pages[m/l|0].parents[m%l]};x.hasNodes=function(m,l){var g=m/this.pageSize|0;for(m=(m+l-1)/this.pageSize|0;g<=m;g++)if(null==this._pages[g])return!1;return!0};x.forEachNodeId=function(m){for(let l=0;l<this._pages.length;l++){const g=this._pages[l];if(g)for(let f=0;f<g.nodes.length;f++)m(l*this.pageSize+f)}};x.createVisibilityTraverse=function(){var m=
this,l=[],g=[],f=b.create();return(d,e)=>{if(m.hasNodes(0,1))for(l.length=0,l.push(0),g.length=0,g.push(0);0<l.length;){var k=l.pop();let y=g.pop();var u=m.getNode(k),p=m.getRenderObb(k),h=!0;if(null!=d.clippingBox){var r=1<<d.frustum.length;if(0===(y&r)){var q=w.toAaBoundingBox(p,f);b.contains(d.clippingBox,q)?y|=r:b.intersects(d.clippingBox,q)||(h=!1)}}for(r=0;r<d.frustum.length&&h;r++)if(q=1<<r,0===(y&q)){const B=w.intersectPlane(p,d.frustum[r]);0<B?h=!1:0>B&&(y|=q)}if(e.predicate(k,u,h)){p=u.firstChild;
u=u.childCount;h=!1;q=p/m.pageSize|0;for(r=(p+u-1)/m.pageSize|0;q<=r;q++)if(!m.hasPage(q)){e.pageMiss(k,q);h=!0;break}if(!h)for(k=0;k<u;k++)l.push(p+k),g.push(y)}}}};return a._createClass(n)}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(w,n){for(const x of w??[])if(x.name===n&&null!=x.attributeValues&&"UInt8"===x.attributeValues.valueType&&3===x.attributeValues.valuesPerElement)return{name:n,storageInfo:x,useElevation:!1};return null}
function c(w,n){for(const x of w??[])if(x.name===n)return w="embedded-elevation"===x.encoding,{name:n,storageInfo:w?null:x,useElevation:w};return"elevation"===n?.toLowerCase()?{name:n,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=c;a.getFilterInfo=function(w){const n=w.filters;return n?n.map(x=>({filterJSON:x.toJSON(),attributeInfo:c(w.attributeStorageInfo,x.field)})):[]};a.getFixedSizeAlgorithm=function(w){return(w=w?.pointSizeAlgorithm)&&"fixed-size"===w.type?w:null};a.getRendererInfo=
function(w){const n=w.renderer;var x=n?.type;const m=n?.toJSON()??null;let l=null,g=!1;w=w.attributeStorageInfo;"point-cloud-unique-value"===x?l=c(w,n.field):"point-cloud-stretch"===x?l=c(w,n.field):"point-cloud-class-breaks"===x?l=c(w,n.field):(l="point-cloud-rgb"===x?b(w,n.field):b(w,"RGB"),g=null!=l);x=null;n?.colorModulation&&(x=c(w,n.colorModulation.field));return{rendererJSON:m,isRGBRenderer:g,primaryAttribute:l,modulationAttribute:x}};a.getSplatSizeAlgorithm=function(w){return(w=w?.pointSizeAlgorithm)&&
"splat"===w.type?w:null};a.rendererUsesFixedSizes=function(w){return(w=w?.pointSizeAlgorithm)&&w.type?"fixed-size"===w.type:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(a,b,c,w,n,x,
m){function l(d,e){const k=new Float64Array(e);for(let u=0;u<e;u++)k[u]=d[3*u+2];return k}function g(d){return null==d||"none"===d?null:"low-four-bit"===d?e=>e&15:"high-four-bit"===d?e=>(e&240)>>4:"absolute-value"===d?e=>Math.abs(e):"modulo-ten"===d?e=>e%10:null}function f(d){let e=0;for(const k of d||[])e|=1<<k;return e}a.elevationFromPositions=l;a.evaluateRenderer=function(d,e,k,u){const {rendererJSON:p,isRGBRenderer:h}=d;var r=d=null;if(e&&h)d=e;else if(e&&"pointCloudUniqueValueRenderer"===p?.type){r=
n.fromJSON(p);var q=r.colorUniqueValueInfos;d=new Uint8Array(3*u);var y=g(r.fieldTransformType);for(var B=0;B<u;B++){var D=(y?y(e[B]):e[B])+"";for(var z=0;z<q.length;z++)if(q[z].values.includes(D)){d[3*B]=q[z].color.r;d[3*B+1]=q[z].color.g;d[3*B+2]=q[z].color.b;break}}}else if(e&&"pointCloudStretchRenderer"===p?.type)for(r=w.fromJSON(p),q=r.stops,d=new Uint8Array(3*u),y=g(r.fieldTransformType),B=0;B<u;B++)if(D=y?y(e[B]):e[B],z=q.length-1,D<q[0].value)d[3*B]=q[0].color.r,d[3*B+1]=q[0].color.g,d[3*
B+2]=q[0].color.b;else if(D>=q[z].value)d[3*B]=q[z].color.r,d[3*B+1]=q[z].color.g,d[3*B+2]=q[z].color.b;else for(z=1;z<q.length;z++){if(D<q[z].value){D=(D-q[z-1].value)/(q[z].value-q[z-1].value);d[3*B]=q[z].color.r*D+q[z-1].color.r*(1-D);d[3*B+1]=q[z].color.g*D+q[z-1].color.g*(1-D);d[3*B+2]=q[z].color.b*D+q[z-1].color.b*(1-D);break}}else if(e&&"pointCloudClassBreaksRenderer"===p?.type)for(r=c.fromJSON(p),q=r.colorClassBreakInfos,d=new Uint8Array(3*u),y=g(r.fieldTransformType),B=0;B<u;B++)for(D=y?
y(e[B]):e[B],z=0;z<q.length;z++){if(D>=q[z].minValue&&D<=q[z].maxValue){d[3*B]=q[z].color.r;d[3*B+1]=q[z].color.g;d[3*B+2]=q[z].color.b;break}}else for(d=new Uint8Array(3*u),e=0;e<d.length;e++)d[e]=255;if(k&&r&&r.colorModulation)for(e=r.colorModulation.minValue,r=r.colorModulation.maxValue,q=0;q<u;q++)y=k[q],y=y>=r?1:y<=e?.3:.3+.7*(y-e)/(r-e),d[3*q]*=y,d[3*q+1]*=y,d[3*q+2]*=y;return d};a.filterInPlace=function(d,e,k,u,p){const h=d.length/3;let r=0;for(let v=0;v<h;v++){let A=!0;for(let t=0;t<u.length&&
A;t++){var {filterJSON:q}=u[t],y=p[t].values[v];switch(q.type){case "pointCloudValueFilter":var B="exclude"===q.mode;q.values.includes(y)===B&&(A=!1);break;case "pointCloudBitfieldFilter":B=f(q.requiredSetBits);q=f(q.requiredClearBits);if((y&B)!==B||0!==(y&q))A=!1;break;case "pointCloudReturnFilter":var D=y&15,z=y>>>4&15;y=1<z;B=1===D;D=D===z;z=!1;for(const C of q.includedReturns)if("last"===C&&D||"firstOfMany"===C&&B&&y||"lastOfMany"===C&&D&&y||"single"===C&&!y){z=!0;break}z||(A=!1)}}A&&(k[r]=v,
d[3*r]=d[3*v],d[3*r+1]=d[3*v+1],d[3*r+2]=d[3*v+2],e[3*r]=e[3*v],e[3*r+1]=e[3*v+1],e[3*r+2]=e[3*v+2],r++)}return r};a.getAttributeValues=function(d,e,k){return b.isSome(d)&&d.attributeInfo.useElevation?e?l(e,k):null:b.isSome(d)&&d.attributeInfo.storageInfo?x.readBinaryAttribute(d.attributeInfo.storageInfo,d.buffer,k):null};a.readGeometry=function(d,e){if(null==d.encoding||""===d.encoding){d=x.createGeometryIndexFromSchema(e,d);if(b.isNone(d.vertexAttributes.position))return;e=x.createTypedView(e,d.vertexAttributes.position);
var k=d.header.fields;d=[k.offsetX,k.offsetY,k.offsetZ];k=[k.scaleX,k.scaleY,k.scaleZ];const u=e.length/3,p=new Float64Array(3*u);for(let h=0;h<u;h++)p[3*h]=e[3*h]*k[0]+d[0],p[3*h+1]=e[3*h+1]*k[1]+d[1],p[3*h+2]=e[3*h+2]*k[2]+d[2];return p}if("lepcc-xyz"===d.encoding)return m.decodeXYZ(e).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,c,w,n,x,m,l,g,f){var d;n=d=function(e){function k(p){p=u.call(this,p);p.type="point-cloud-class-breaks";p.field=null;p.legendOptions=null;p.fieldTransformType=null;p.colorClassBreakInfos=null;return p}a._inherits(k,e);var u=a._createSuper(k);k.prototype.clone=function(){return new d({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:c.clone(this.colorClassBreakInfos),legendOptions:c.clone(this.legendOptions)})};return a._createClass(k)}(l);
b.__decorate([x.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],n.prototype,"type",void 0);b.__decorate([w.property({json:{write:!0},type:String})],n.prototype,"field",void 0);b.__decorate([w.property({type:g.LegendOptions,json:{write:!0}})],n.prototype,"legendOptions",void 0);b.__decorate([w.property({type:l.fieldTransformTypeKebabDict.apiValues,json:{type:l.fieldTransformTypeKebabDict.jsonValues,read:l.fieldTransformTypeKebabDict.read,write:l.fieldTransformTypeKebabDict.write}})],
n.prototype,"fieldTransformType",void 0);b.__decorate([w.property({type:[f],json:{write:!0}})],n.prototype,"colorClassBreakInfos",void 0);return n=d=b.__decorate([m.subclass("esri.renderers.PointCloudClassBreaksRenderer")],n)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f){m=c.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});w=function(d){function e(u){u=k.call(this,u);u.type=void 0;u.pointSizeAlgorithm=null;u.colorModulation=null;u.pointsPerInch=10;return u}a._inherits(e,d);var k=a._createSuper(e);d=e.prototype;d.clone=function(){console.warn(".clone() is not implemented for "+
this.declaredClass);return null};d.cloneProperties=function(){return{pointSizeAlgorithm:n.clone(this.pointSizeAlgorithm),colorModulation:n.clone(this.colorModulation),pointsPerInch:n.clone(this.pointsPerInch)}};return a._createClass(e)}(w.JSONSupport);b.__decorate([x.property({type:m.apiValues,readOnly:!0,nonNullable:!0,json:{type:m.jsonValues,read:!1,write:m.write}})],w.prototype,"type",void 0);b.__decorate([x.property({types:f.pointSizeAlgorithmTypes,json:{write:!0}})],w.prototype,"pointSizeAlgorithm",
void 0);b.__decorate([x.property({type:g,json:{write:!0}})],w.prototype,"colorModulation",void 0);b.__decorate([x.property({json:{write:!0},nonNullable:!0,type:Number})],w.prototype,"pointsPerInch",void 0);w=b.__decorate([l.subclass("esri.renderers.PointCloudRenderer")],w);(w||(w={})).fieldTransformTypeKebabDict=new c.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return w})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){var g;c=g=function(f){function d(){var k=e.apply(this,arguments);k.field=null;k.minValue=0;k.maxValue=255;return k}a._inherits(d,f);var e=a._createSuper(d);d.prototype.clone=function(){return new g({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return a._createClass(d)}(c.JSONSupport);b.__decorate([w.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,
"minValue",void 0);b.__decorate([w.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",void 0);return c=g=b.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,c,w){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":c,splat:w}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l,g){c=new c.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",
pointCloudSplatAlgorithm:"splat"});w=function(f){function d(){return e.apply(this,arguments)}a._inherits(d,f);var e=a._createSuper(d);return a._createClass(d)}(w.JSONSupport);b.__decorate([n.property({type:c.apiValues,readOnly:!0,nonNullable:!0,json:{type:c.jsonValues,read:!1,write:c.write}})],w.prototype,"type",void 0);return w=b.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],w)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;w=f=function(d){function e(){var u=k.apply(this,arguments);u.type="fixed-size";u.size=0;u.useRealWorldSymbolSizes=null;return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return a._createClass(e)}(g);b.__decorate([m.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],w.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],
w.prototype,"size",void 0);b.__decorate([c.property({type:Boolean,json:{write:!0}})],w.prototype,"useRealWorldSymbolSizes",void 0);return w=f=b.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],w)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,w,n,x,m,l,g){var f;w=f=function(d){function e(){var u=k.apply(this,arguments);u.type="splat";u.scaleFactor=1;return u}a._inherits(e,d);var k=a._createSuper(e);e.prototype.clone=function(){return new f({scaleFactor:this.scaleFactor})};return a._createClass(e)}(g);b.__decorate([m.enumeration({pointCloudSplatAlgorithm:"splat"})],w.prototype,"type",void 0);b.__decorate([c.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],w.prototype,"scaleFactor",void 0);return w=f=b.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],
w)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,w,n,x,m,l){var g;w=g=function(f){function d(){var k=e.apply(this,arguments);k.description=null;k.label=null;k.minValue=0;k.maxValue=
0;k.color=null;return k}a._inherits(d,f);var e=a._createSuper(d);d.prototype.clone=function(){return new g({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:n.clone(this.color)})};return a._createClass(d)}(w.JSONSupport);b.__decorate([x.property({type:String,json:{write:!0}})],w.prototype,"description",void 0);b.__decorate([x.property({type:String,json:{write:!0}})],w.prototype,"label",void 0);b.__decorate([x.property({type:Number,json:{read:{source:"classMinValue"},
write:{target:"classMinValue"}}})],w.prototype,"minValue",void 0);b.__decorate([x.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],w.prototype,"maxValue",void 0);b.__decorate([x.property({type:c,json:{type:[m.Integer],write:!0}})],w.prototype,"color",void 0);return w=g=b.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],w)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,c,w,n,x,m,l,g,f){var d;n=d=function(e){function k(p){p=u.call(this,p);p.type="point-cloud-stretch";p.field=null;p.legendOptions=null;p.fieldTransformType=null;p.stops=null;return p}a._inherits(k,e);var u=a._createSuper(k);k.prototype.clone=function(){return new d({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),stops:c.clone(this.stops),legendOptions:c.clone(this.legendOptions)})};return a._createClass(k)}(l);b.__decorate([x.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
n.prototype,"type",void 0);b.__decorate([w.property({json:{write:!0},type:String})],n.prototype,"field",void 0);b.__decorate([w.property({type:g.LegendOptions,json:{write:!0}})],n.prototype,"legendOptions",void 0);b.__decorate([w.property({type:l.fieldTransformTypeKebabDict.apiValues,json:{type:l.fieldTransformTypeKebabDict.jsonValues,read:l.fieldTransformTypeKebabDict.read,write:l.fieldTransformTypeKebabDict.write}})],n.prototype,"fieldTransformType",void 0);b.__decorate([w.property({type:[f],json:{write:!0}})],
n.prototype,"stops",void 0);return n=d=b.__decorate([m.subclass("esri.renderers.PointCloudStretchRenderer")],n)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,b,c,w,n,x,m,l,g,f){var d;n=d=function(e){function k(p){p=u.call(this,p);p.type="point-cloud-unique-value";p.field=null;p.fieldTransformType=null;p.colorUniqueValueInfos=null;p.legendOptions=null;return p}a._inherits(k,e);var u=a._createSuper(k);k.prototype.clone=function(){return new d({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),colorUniqueValueInfos:c.clone(this.colorUniqueValueInfos),legendOptions:c.clone(this.legendOptions)})};
return a._createClass(k)}(l);b.__decorate([x.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],n.prototype,"type",void 0);b.__decorate([w.property({json:{write:!0},type:String})],n.prototype,"field",void 0);b.__decorate([w.property({type:l.fieldTransformTypeKebabDict.apiValues,json:{type:l.fieldTransformTypeKebabDict.jsonValues,read:l.fieldTransformTypeKebabDict.read,write:l.fieldTransformTypeKebabDict.write}})],n.prototype,"fieldTransformType",void 0);b.__decorate([w.property({type:[f],
json:{write:!0}})],n.prototype,"colorUniqueValueInfos",void 0);b.__decorate([w.property({type:g.LegendOptions,json:{write:!0}})],n.prototype,"legendOptions",void 0);return n=d=b.__decorate([m.subclass("esri.renderers.PointCloudUniqueValueRenderer")],n)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l){var g;w=g=function(f){function d(){var k=e.apply(this,arguments);k.description=null;k.label=null;k.values=null;k.color=null;return k}a._inherits(d,f);var e=a._createSuper(d);d.prototype.clone=function(){return new g({description:this.description,label:this.label,values:n.clone(this.values),color:n.clone(this.color)})};return a._createClass(d)}(w.JSONSupport);b.__decorate([x.property({type:String,json:{write:!0}})],w.prototype,"description",void 0);b.__decorate([x.property({type:String,
json:{write:!0}})],w.prototype,"label",void 0);b.__decorate([x.property({type:[String],json:{write:!0}})],w.prototype,"values",void 0);b.__decorate([x.property({type:c,json:{type:[m.Integer],write:!0}})],w.prototype,"color",void 0);return w=g=b.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],w)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,w,n,x,m,l,g){a.PointGraphic=function(f){function d(k){return e.call(this,k)}b._inherits(d,f);var e=b._createSuper(d);return b._createClass(d)}(w);c.__decorate([n.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=c.__decorate([g.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t){function C(R,O,J,M,G){if(J.drawScreenSpace)return J.fixedSize*O*M;G=B.getMaxPointSizeScreenspace(G)*O*M;return J.useFixedSizes?Math.min(J.fixedSize/2,G):0<J.screenMinSize?Math.min(Math.max(J.screenMinSize*O*M,R/2),G):Math.min(R/2,G)}function E(R,O,J,M,G){return J.drawScreenSpace?0:C(R,O,J,M,G)}function F(R){return c.isSome(R.component)?R.component:-1}function H(R,O){if(c.isNone(R))return R;R=R.filter(J=>J.id!==O);return 0===R.length?null:
R}function K(R){return c.isSome(R.dist)&&c.isSome(R.point)&&c.isSome(R.pointId)&&c.isSome(R.node)}const I={positions:[new t.VertexElementDescriptor(y.VertexAttribute.POSITION,3,A.DataType.FLOAT,0,12)],colors:[new t.VertexElementDescriptor(y.VertexAttribute.COLOR,3,A.DataType.UNSIGNED_BYTE,0,3,!0)]};y=function(){function R(J){this._params=J;this.type=r.IntersectorType.PCL;this.isGround=!1;this._passParameters=new B.PointRendererPassParameters;this._highlights=new e.PointHighlights({forEachNode:M=>
this.forEachNode(M),addHighlight:(M,G,P)=>this._addHighlight(M,G,P),removeHighlight:(M,G)=>this._removeHighlight(M,G)});this.canRender=!0;this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new z.PointRendererTechniqueConfiguration;this._nodes=new w}var O=R.prototype;O.initializeRenderContext=function(J){this._context=J;this._techniqueRepository=this._context.techniqueRepository;J.requestRender()};O.uninitializeRenderContext=function(){};O.intersect=function(J,M,G,P){const U=x.create(),
N=x.create(),S=x.create(),Q=x.create(),W=g.create(),V=J.camera.perScreenPixelRatio/2,T=J.camera.near;n.subtract(N,P,G);const X=1/n.length(N);n.scale(N,N,X);n.negate(S,N);m.set(W,N[0],N[1],N[2],-n.dot(N,G));const Z=new L,Y=new L,aa=[],ia=l.create(),na=l.create(this._passParameters.clipBox);l.offset(na,-G[0],-G[1],-G[2],na);this._nodes.forAll(ka=>{const da=ka.splatSize*this._passParameters.scaleFactor;var ha=k.minimumDistancePlane(ka.obb,W),ca=k.maximumDistancePlane(ka.obb,W);ha-=E(da,ha+T,this._passParameters,
V,ka.isLeaf);ca-=E(da,ca+T,this._passParameters,V,ka.isLeaf);ha=null!=Z.dist&&null!=Y.dist&&Z.dist<ha*X&&Y.dist>ca*X;if(!(0>ca||ha)&&(ca=C(da,ca+T,this._passParameters,V,ka.isLeaf),k.intersectLine(ka.obb,G,N,ca))){ca*=ca;k.toAaBoundingBox(ka.obb,ia);l.offset(ia,-G[0],-G[1],-G[2],ia);ha=!l.contains(na,ia);n.subtract(Q,ka.origin,G);var fa=ka.coordinates.length/3;for(let xa=0;xa<fa;xa++){U[0]=Q[0]+ka.coordinates[3*xa];U[1]=Q[1]+ka.coordinates[3*xa+1];U[2]=Q[2]+ka.coordinates[3*xa+2];if(ha&&!l.containsPoint(na,
U))continue;var ma=n.dot(U,N),qa=n.squaredLength(U)-ma*ma;if(qa>ca)continue;var wa=ma+T;const pa=E(da,wa,this._passParameters,V,ka.isLeaf);if(0>ma-pa)continue;wa-=pa;wa=C(da,wa,this._passParameters,V,ka.isLeaf);if(qa>wa*wa)continue;const ra=(ma-pa)*X;ma=va=>{var Ba=xa,Aa=va.point;c.isNone(Aa)&&(Aa=x.create());Aa[0]=ka.origin[0]+ka.coordinates[3*Ba];Aa[1]=ka.origin[1]+ka.coordinates[3*Ba+1];Aa[2]=ka.origin[2]+ka.coordinates[3*Ba+2];va.point=Aa;va.dist=ra;va.normal=S;va.node=ka;va.pointId=xa;va.layerUid=
this.layerUid;return va};(null==Z.dist||ra<Z.dist)&&(null==M||M(G,P,ra))&&ma(Z);J.options.store!==r.StoreResults.MIN&&(null==Y.dist||ra>Y.dist)&&(null==M||M(G,P,ra))&&ma(Y);J.options.store!==r.StoreResults.ALL||null!=M&&!M(G,P,ra)||(qa=new L,aa.push(ma(qa)))}}});const ba=ka=>{const {layerUid:da,node:ha,pointId:ca}=ka;return new d.PclTarget(ka.point,da,ca,()=>this._params.createGraphic(ha,ca,ka.point))},ea=(ka,da)=>{const ha=ba(da);ka.set(this.type,ha,da.dist,da.normal)};if(K(Z)){var ja=J.results.min;
(null==ja.dist||Z.dist<ja.dist)&&ea(ja,Z)}K(Y)&&J.options.store!==r.StoreResults.MIN&&(ja=J.results.max,(null==ja.dist||Y.dist>ja.dist)&&ea(ja,Y));if(J.options.store===r.StoreResults.ALL){ja=f.fromPoints(G,P);for(const ka of aa){const da=h.newIntersectorResult(ja);ea(da,ka);J.results.all.push(da)}}};O.prepareTechnique=function(J){if(0===this._nodes.length||J.output!==u.ShaderOutput.Color&&J.output!==u.ShaderOutput.Depth&&J.output!==u.ShaderOutput.Highlight)return null;this._nodes.forAll(M=>{null==
M.vao&&this._initNode(J,M)});this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=J.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=this._clippingEnabled;this._techniqueConfig.output=J.output===u.ShaderOutput.Depth?u.ShaderOutput.Depth:J.output===u.ShaderOutput.Highlight?u.ShaderOutput.Highlight:
u.ShaderOutput.Color;return this._techniqueRepository.releaseAndAcquire(D.PointRendererTechnique,this._techniqueConfig,this._technique)};O.render=function(J,M){const G=J.rctx,P=G.bindTechnique(M,this._passParameters,J.bindParameters),U=J.output===u.ShaderOutput.Highlight;this._nodes.forAll(N=>{0===N.coordinates.length||U&&!N.highlights||(P.bindDraw(N,J.bindParameters,this._passParameters),G.bindVAO(N.vao),U?this._renderHighlightFragments(G,N):G.drawArrays(A.PrimitiveType.POINTS,0,N.coordinates.length/
3))})};O._renderHighlightFragments=function(J,M){var G=M.highlights;if(!c.isNone(G)){M=c.unwrap(G[0].component);var P=M+1;for(let U=1;U<G.length;U++){const N=c.unwrap(G[U].component);N!==P&&(P-=M,0<P&&J.drawArrays(A.PrimitiveType.POINTS,M,P),M=N);P=N+1}G=P-M;0<G&&J.drawArrays(A.PrimitiveType.POINTS,M,G)}};O.addNode=function(J){this._nodes.push(J);this._highlights.nodeAdded(J);this._requestRender()};O.removeNode=function(J){let M=null;this._nodes.filterInPlace(G=>G.id===J?(M=G,G.vao=c.disposeMaybe(G.vao),
this._highlights.nodeRemoved(G),!1):!0);this._requestRender();return M};O.forEachNode=function(J){this._nodes.forAll(J)};O.removeAll=function(){this._nodes.forAll(J=>J.vao=c.disposeMaybe(J.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()};O.highlight=function(J){return this._highlights.add(J)};O._addHighlight=function(J,M,G){var P=J.highlights;c.isNone(P)&&(P=[]);M={component:M,id:G};P.push(M);M=F(M);for(G=P.length-1;0<G&&M<F(P[G-1]);)[P[G-1],P[G]]=[P[G],P[G-1]],--G;J.highlights=
P;this._requestRender()};O._removeHighlight=function(J,M){J.highlights=H(J.highlights,M);this._requestRender()};O._initNode=function(J,M){J=J.rctx;M.vao=new q.VertexArrayObject(J,p.Default3D,I,{positions:v.BufferObject.createVertex(J,A.Usage.STATIC_DRAW,M.coordinates),colors:v.BufferObject.createVertex(J,A.Usage.STATIC_DRAW,M.rgb)})};O._requestRender=function(){this._context&&this._context.requestRender()};b._createClass(R,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},
{key:"useFixedSizes",get:function(){return this._passParameters.useFixedSizes},set:function(J){this._passParameters.useFixedSizes!==J&&(this._passParameters.useFixedSizes=J,this._requestRender())}},{key:"scaleFactor",get:function(){return this._passParameters.scaleFactor},set:function(J){this._passParameters.scaleFactor!==J&&(this._passParameters.scaleFactor=J,this._requestRender())}},{key:"minSizePx",get:function(){return this._passParameters.minSizePx},set:function(J){this._passParameters.minSizePx!==
J&&(this._passParameters.minSizePx=J,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._passParameters.useRealWorldSymbolSizes},set:function(J){this._passParameters.useRealWorldSymbolSizes!==J&&(this._passParameters.useRealWorldSymbolSizes=J,this._requestRender())}},{key:"size",get:function(){return this._passParameters.size},set:function(J){this._passParameters.size!==J&&(this._passParameters.size=J,this._requestRender())}},{key:"sizePx",get:function(){return this._passParameters.sizePx},
set:function(J){this._passParameters.sizePx!==J&&(this._passParameters.sizePx=J,this._requestRender())}},{key:"clippingBox",set:function(J){l.set(this._passParameters.clipBox,J||l.POSITIVE_INFINITY)}},{key:"_clippingEnabled",get:function(){return!l.equals(this._passParameters.clipBox,l.POSITIVE_INFINITY,(J,M)=>J===M)}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},set:function(J){this._slicePlaneEnabled!==J&&(this._slicePlaneEnabled=J,this._requestRender())}}]);return R}();
t=function(R){function O(M,G,P,U,N,S,Q,W,V=null,T=null){G=J.call(this,P,N,G);G.id=M;G.obb=U;G.coordinates=S;G.rgb=Q;G.attributes=W;G.pointIdFilterMap=V;G.highlights=T;return G}b._inherits(O,R);var J=b._createSuper(O);return b._createClass(O)}(B.PointRendererDrawParameters);let L=b._createClass(function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""});a.PointRenderer=y;a.PointRendererNode=t;a.isInstanceOfNode=function(R){return R.hasOwnProperty("splatSize")};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/handleUtils ../../../../core/maybe ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),function(a,b,c,w,n,x){let m=function(){function g(d){this._context=d;this._highlights=new Set}var f=g.prototype;f.destroy=function(){this._highlights=null};f.add=function(d){const e=new l(d);this._highlights.add(e);
this._enableSet(e);return c.makeHandle(()=>this._removeSet(e))};f._removeSet=function(d){this._disableSet(d);this._highlights.delete(d)};f._enableSet=function(d){d.enabled||(d.enabled=!0,this._context.forEachNode(e=>this._enableSetForNode(d,e)))};f._enableSetForNode=function(d,e){if(d.enabled){var k=d.ids.get(e.id);k&&k.forEach(u=>this._context.addHighlight(e,u,d.id))}};f._disableSet=function(d){d.enabled&&(d.enabled=!1,this._context.forEachNode(e=>this._disableSetForNode(d,e)))};f._disableSetForNode=
function(d,e){d.enabled||this._context.removeHighlight(e,d.id)};f.nodeAdded=function(d){this._highlights.forEach(e=>this._enableSetForNode(e,d))};f.nodeRemoved=function(d){this._highlights.forEach(e=>this._disableSetForNode(e,d))};f.removeAll=function(){this._highlights.forEach(d=>this._disableSet(d))};b._createClass(g,[{key:"hasHighlights",get:function(){return 0<this._highlights.size}}]);return g}(),l=function(){function g(f){this.id=new x.Object3DStateID(n.Object3DState.Highlight);this.ids=new Map;
this.enabled=!1;for(const d of f)w.isSome(d)&&this._add(d.nodeId,d.pointId)}g.prototype._add=function(f,d){const e=this.ids.get(f);e?e.add(d):this.ids.set(f,new Set([d]))};return b._createClass(g)}();a.PointHighlights=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v){function A(I){const L=new z.ShaderBuilder,R=I.output===e.ShaderOutput.Color,O=I.output===e.ShaderOutput.Depth,J=I.output===e.ShaderOutput.Highlight,{vertex:M,fragment:G}=L;L.include(k.SliceDraw,I);L.attributes.add(v.VertexAttribute.POSITION,"vec3");L.attributes.add(v.VertexAttribute.COLOR,"vec3");M.uniforms.add([new B.Matrix4DrawUniform("modelView",(P,U)=>w.multiply(F,U.camera.viewMatrix,w.fromTranslation(F,P.origin))),new D.Matrix4PassUniform("proj",
(P,U)=>U.camera.projectionMatrix),new h.Float2DrawUniform("screenMinMaxSize",(P,U,N)=>x.set(K,N.useFixedSizes?0:N.minSizePx*U.camera.pixelRatio,(P.isLeaf?256:64)*U.camera.pixelRatio))]);M.uniforms.add(I.useFixedSizes?new r.Float2PassUniform("pointScale",(P,U)=>x.set(K,P.fixedSize*U.camera.pixelRatio,U.camera.fullHeight)):new h.Float2DrawUniform("pointScale",(P,U,N)=>x.set(K,P.splatSize*N.scaleFactor*U.camera.pixelRatio,U.camera.fullHeight/U.camera.pixelRatio)));I.clippingEnabled?M.uniforms.add([new q.Float3DrawUniform("clipMin",
(P,U,N)=>l.set(H,N.clipBox[0]-P.origin[0],N.clipBox[1]-P.origin[1],N.clipBox[2]-P.origin[2])),new q.Float3DrawUniform("clipMax",(P,U,N)=>l.set(H,N.clipBox[3]-P.origin[0],N.clipBox[4]-P.origin[1],N.clipBox[5]-P.origin[2]))]):(M.constants.add("clipMin","vec3",[-c.NUMBER_MAX_FLOAT32,-c.NUMBER_MAX_FLOAT32,-c.NUMBER_MAX_FLOAT32]),M.constants.add("clipMax","vec3",[c.NUMBER_MAX_FLOAT32,c.NUMBER_MAX_FLOAT32,c.NUMBER_MAX_FLOAT32]));O?(d.addNearFar(L),d.addCalculateLinearDepth(L),L.varyings.add("depth","float")):
I.output!==e.ShaderOutput.Highlight&&L.varyings.add("vColor","vec3");M.code.add(y.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${I.drawScreenSize?y.glsl`
      float clampedScreenSize = pointSize;`:y.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${O?y.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${R?y.glsl`vColor = color;`:""}
    }
  `);G.include(p.RgbaFloatEncoding,I);J&&L.include(u.OutputHighlight,I);G.code.add(y.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${O?y.glsl`fragColor = float2rgba(depth);`:""}
      ${J?y.glsl`outputHighlight();`:""}
      ${R?y.glsl`fragColor = vec4(vColor, 1.0);`:""}
    }
  `);return L}function t(I){return I?256:64}let C=function(I){function L(){var O=R.apply(this,arguments);O.clipBox=f.create(f.POSITIVE_INFINITY);O.useFixedSizes=!1;O.useRealWorldSymbolSizes=!1;O.scaleFactor=1;O.minSizePx=0;O.size=0;O.sizePx=0;return O}b._inherits(L,I);var R=b._createSuper(L);b._createClass(L,[{key:"fixedSize",get:function(){return this.drawScreenSpace?this.sizePx:this.size}},{key:"screenMinSize",get:function(){return this.useFixedSizes?0:this.minSizePx}},{key:"drawScreenSpace",get:function(){return this.useFixedSizes&&
!this.useRealWorldSymbolSizes}}]);return L}(y.NoParameters),E=function(I){function L(O,J,M){var G=R.call(this,O);G.origin=O;G.isLeaf=J;G.splatSize=M;return G}b._inherits(L,I);var R=b._createSuper(L);return b._createClass(L)}(k.SlicePlaneParameters);const F=n.create(),H=g.create(),K=m.create();n=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:E,PointRendererPassParameters:C,build:A,getMaxPointSizeScreenspace:t},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=
E;a.PointRendererPassParameters=C;a.PointRendererShader=n;a.build=A;a.getMaxPointSizeScreenspace=t})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){n=function(e){function k(p,h,r){return u.call(this,p,h,r)}c._inherits(k,e);var u=c._createSuper(k);e=k.prototype;e.initializeProgram=function(p){return new m.Program(p.rctx,k.shader.get().build(this.configuration),x.Default3D)};e.initializePipeline=function(){return d.makePipelineState({depthTest:{func:f.CompareFunction.LESS},depthWrite:d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?l.stencilWriteMaskOn:null,
stencilTest:this.configuration.hasOccludees?l.stencilBaseAllZerosParams:null})};return c._createClass(k)}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(g.PointRendererShader,()=>new Promise((e,k)=>a(["./PointRenderer.glsl"],e,k)));b.PointRendererTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,w,n,x){x=function(m){function l(){var f=g.apply(this,arguments);f.output=w.ShaderOutput.Color;f.hasSlicePlane=!1;f.drawScreenSize=!1;f.useFixedSizes=!1;f.hasOccludees=!1;f.clippingEnabled=!1;return f}b._inherits(l,m);var g=b._createSuper(l);return b._createClass(l)}(x.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:w.ShaderOutput.COUNT})],x.prototype,"output",void 0);c.__decorate([n.parameter()],x.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],x.prototype,
"drawScreenSize",void 0);c.__decorate([n.parameter()],x.prototype,"useFixedSizes",void 0);c.__decorate([n.parameter()],x.prototype,"hasOccludees",void 0);c.__decorate([n.parameter()],x.prototype,"clippingEnabled",void 0);c.__decorate([n.parameter({constValue:!0})],x.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){a.PopupSceneLayerView=k=>{k=function(u){function p(){return h.apply(this,arguments)}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u._validateFetchPopupFeatures=function(r){const {layer:q}=this,{popupEnabled:y}=q;if(!y)throw new w("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:q});if(!e.getFetchPopupTemplate(q,r))throw new w("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:q});};u.prepareFetchPopupFeatures=
async function(r){};u.fetchPopupFeatures=async function(r,q){this._validateFetchPopupFeatures(q);r=n.isSome(q)?q.clientGraphics:null;if(!r||0===r.length)return[];const y="scene"===this.layer.type&&n.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;let B=[];"fieldsIndex"in this.layer&&(B=d.unpackFieldNames(this.layer.fieldsIndex,await e.getRequiredFields(y,e.getFetchPopupTemplate(this.layer,q))));await this.prepareFetchPopupFeatures(B);q=new Set;const D=[],z=[];for(const v of r)d.populateMissingFields(B,
v,q)?z.push(v):D.push(v);return 0===z.length?D:this.whenGraphicAttributes(z,[...q]).catch(()=>z).then(v=>D.concat(v))};return b._createClass(p)}(k);return k=c.__decorate([f.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J){l=K.defineFieldProperties();r=function(M){function G(){var U=P.apply(this,arguments);U.type="scene-layer-3d";U.progressiveLoadFactor=1;U._elevationContext="scene";U._isIntegratedMesh=!1;U._supportsLabeling=!0;U._interactiveEditingSessions=new Map;U._queryEngine=null;return U}a._inherits(G,M);var P=a._createSuper(G);M=G.prototype;M.tryRecycleWith=function(U,N){return U.url===this.layer.url&&this.i3sOverrides.isEmpty?U.load(N).then(()=>
{F.checkRecyclable(this.layer,U,this.i3sOverrides);this.layer=U;this.i3sOverrides.destroy();this.i3sOverrides=new A.I3SOverrides({view:this.view,layer:U,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null};M.initialize=function(){this._fieldsHelper=new L.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,N=>this._rangeInfosChanged(N),x.initial);this.updatingHandles.add(()=>this.layer.renderer,N=>this.updatingHandles.addPromise(this._rendererChange(N)),
x.initial);const U=()=>this._filterChange();this.updatingHandles.add(()=>this.parsedDefinitionExpression,U);this.updatingHandles.add(()=>this.filter,U);this.updatingHandles.add(()=>this._floorFilterClause,U);this.updatingHandles.add(()=>this._excludeObjectIdsSorted,U);this.updatingHandles.add(()=>n.isSome(this.viewFilter)?this.viewFilter.sortedObjectIds:null,U);this.updatingHandles.add(()=>n.isSome(this.viewFilter)?this.viewFilter.parsedWhereClause:null,U);this.updatingHandles.add(()=>[n.isSome(this.viewFilter)?
this.viewFilter.parsedGeometry:null,n.isSome(this.filter)?this.filter.spatialRelationship:null,n.isSome(this.layer.filter)?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",N=>this.updatingHandles.addPromise(N.result)));this.handles.add(this.layer.on("edits",N=>this._handleEdits(N)))};M.destroy=function(){this._fieldsHelper=n.destroyMaybe(this._fieldsHelper)};M._rangeInfosChanged=function(U){null!=U&&0<U.length&&w.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
M.createQuery=function(){const U={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return n.isSome(this.filter)?this.filter.createQuery(U):new p(U)};M.queryExtent=function(U,N){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(U),N?.signal)};M.queryFeatureCount=function(U,N){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(U),N?.signal)};M.queryFeatures=function(U,N){return this._ensureQueryEngine().executeQuery(this._ensureQuery(U),
N?.signal).then(S=>{if(!S?.features)return S;const Q=this.layer;for(const W of S.features)W.layer=Q,W.sourceLayer=Q;return S})};M.queryObjectIds=function(U,N){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(U),N?.signal)};M._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};M._createQueryEngine=function(){const U=D.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);
return new t.I3SQueryEngine({layerView:this,priority:J.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new E.I3SQueryFeatureStore({featureAdapter:new C.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:U}),forAllFeatures:(N,S)=>this._forAllFeatures((Q,W,V)=>N({id:Q,index:W,meta:V}),S,q.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA),getFeatureExtent:U,sourceSpatialReference:F.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};
M.highlight=function(U){const N=this._highlights;if(U instanceof p){const {set:S,handle:Q}=N.acquireSet();this.queryObjectIds(U).then(W=>N.setFeatureIds(S,W));return Q}return a._get(a._getPrototypeOf(G.prototype),"highlight",this).call(this,U)};M.createInteractiveEditSession=function(U){return B.createInteractiveEditSession(this._attributeEditingContext,U)};M._createLayerGraphic=function(U){U=new c(null,null,U);U.layer=this.layer;U.sourceLayer=this.layer;return U};M.canResume=function(){return a._get(a._getPrototypeOf(G.prototype),
"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)};M.getFilters=function(){const U=a._get(a._getPrototypeOf(G.prototype),"getFilters",this).call(this),N=this._excludeObjectIdsSorted;n.isSome(N)&&U.push(S=>F.objectIdFilter(N,!1,S));this._floorFilterClause&&this.addSqlFilter(U,this._floorFilterClause,this.logError);this.addSqlFilter(U,this.parsedDefinitionExpression,this.logError);n.isSome(this.viewFilter)&&this.viewFilter.addFilters(U,this.view,this._controller.crsIndex,
this._collection);return U};M.isUpdating=function(){return a._get(a._getPrototypeOf(G.prototype),"isUpdating",this).call(this)||this.layerFilterUpdating||n.isSome(this.viewFilter)&&this.viewFilter.updating||n.isSome(this.i3sOverrides)&&this.i3sOverrides.updating};M._ensureQuery=function(U){return this._addDefinitionExpressionToQuery(n.isNone(U)?this.createQuery():p.from(U))};M._handleEdits=function(U){h.sceneLayerEditingEnabled()&&B.processGeometryEdits(this._attributeEditingContext,U);B.processAttributeEdits(this._attributeEditingContext,
U)};M.computeNodeFiltering=function(U){const N=this.viewFilter;return n.isNone(N)||!this.view.spatialReference||N.isMBSGeometryVisible(U,this.view.spatialReference,this._controller.crsIndex)?v.NodeFilterImpact.Unmodified:v.NodeFilterImpact.Culled};a._createClass(G,[{key:"i3slayer",get:function(){return this.layer}},{key:"layerPopupEnabled",get:function(){return this.layer.popupEnabled}},{key:"filter",get:function(){return this._get("filter")},set:function(U){this._set("filter",z.I3SMeshViewFilter.checkSupport(U)?
U:null)}},{key:"viewFilter",get:function(){const U=this.filter,N=this.layerFilter;if(n.isNone(U)&&n.isNone(N))return null;const S=this._get("viewFilter");if(n.isNone(S))return new z.I3SMeshViewFilter({layerFilter:N,viewFilter:U,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:Q=>this._loadAsyncModule(Q),addSqlFilter:(Q,W)=>this.addSqlFilter(Q,W,this.logError)});S.viewFilter=U;S.layerFilter=N;return S}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??[]}},{key:"_floorFilterClause",
get:function(){const U=u.getFloorFilterClause(this);return n.isSome(U)?e.WhereClause.create(U,this.layer.fieldsIndex):null}},{key:"_excludeObjectIdsSorted",get:function(){let U=this.layer.excludeObjectIds.toArray();h.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.geometryChangedObjectIds.length&&(U=U.concat(this.i3sOverrides.geometryChangedObjectIds));return U.length?U.sort((N,S)=>N-S):null}},{key:"_objectQualitySettings",get:function(){return this.view?.qualitySettings?.sceneService?.object}},
{key:"lodFactor",get:function(){return this._objectQualitySettings?.lodFactor??1}},{key:"lodCrossfadeinDuration",get:function(){return this._objectQualitySettings.lodCrossfadeinDuration??0}},{key:"lodCrossfadeoutDuration",get:function(){return this._objectQualitySettings.lodCrossfadeoutDuration??0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return this._objectQualitySettings.lodCrossfadeUncoveredDuration??0}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??
0}},{key:"_attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:U=>this._forAllNodes(N=>n.isSome(N)?U(N.node,N.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,getAttributeData:U=>this.getAttributeData(U),setAttributeData:(U,N)=>this.setAttributeData(U,N),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",
get:function(){const U=this.viewFilter;return n.isSome(U)&&n.isSome(U.parsedGeometry)}}]);return G}(r.I3SMeshView3D(H.DefinitionExpressionSceneLayerView(I.PopupSceneLayerView(y.LayerView3D(O)))));b.__decorate([m.property()],r.prototype,"i3slayer",null);b.__decorate([m.property(R.updatingProgress)],r.prototype,"updatingProgress",void 0);b.__decorate([m.property({type:k})],r.prototype,"filter",null);b.__decorate([m.property({readOnly:!0})],r.prototype,"viewFilter",null);b.__decorate([m.property(l.requiredFields)],
r.prototype,"requiredFields",null);b.__decorate([m.property(l.availableFields)],r.prototype,"availableFields",void 0);b.__decorate([m.property()],r.prototype,"_fieldsHelper",void 0);b.__decorate([m.property()],r.prototype,"_floorFilterClause",null);b.__decorate([m.property()],r.prototype,"_excludeObjectIdsSorted",null);b.__decorate([m.property()],r.prototype,"_objectQualitySettings",null);b.__decorate([m.property()],r.prototype,"lodFactor",null);b.__decorate([m.property()],r.prototype,"updatingProgressValue",
null);return r=b.__decorate([d.subclass("esri.views.3d.layers.SceneLayerView3D")],r)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/byteSizeEstimations ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../chunks/sphere ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa,ia,na,ba,ea,ja,ka,da,ha,ca,fa,ma,qa,wa,xa,pa,ra,va,Ba,Aa,Ha,Ka,Pa,Ra,Sa,La,Ua,Za,Xa){function la(Fa,Ea){p.isAbortError(Fa)||Ia.warn("Error while processing edges. Edges on this layer might not display correctly",Ea,Fa)}function Ta(Fa){if(k.isNone(Fa))return!1;const Ea=Fa.metallicRoughness;return Ea&&0<=Ea.baseColorTextureId||Ea&&0<=Ea.metallicRoughnessTextureId||0<=Fa.normalTextureId||0<=Fa.emissiveTextureId||
0<=Fa.occlusionTextureId}function Ma(Fa){return k.isSome(Fa)&&q.isArrayBuffer(Fa.data)}function fb(Fa,Ea){Fa=1024+Fa.interleavedVertexData.byteLength+(Fa.indices?Fa.indices.byteLength:0)+Fa.positionData.data.byteLength+Fa.positionData.indices.byteLength;if(k.isSome(Ea))for(const Va of Ea)k.isSome(Va)&&q.isArrayBuffer(Va.data)&&(Fa+=Va.data.byteLength);return Fa}function ya(Fa,Ea){return Ea.byteSize>hb?(Ia.warn(`Node is too big to store in IndexedDB cache: ${Fa.id} (${Ea.byteSize} bytes)`),!1):0<Ea.byteSize}
function oa(Fa){if(0===Fa.length)return null;const Ea=new Float64Array(10*Fa.length);Fa.forAll((Va,db)=>{let ta=Va.serviceObb;k.isNone(ta)&&(ta=Tb,F.copy(ta.center,Va.mbs),ta.halfSize[0]=ta.halfSize[1]=ta.halfSize[2]=Va.mbs[3]);Va=10*db;Ea[Va]=ta.center[0];Ea[Va+1]=ta.center[1];Ea[Va+2]=ta.center[2];Ea[Va+3]=ta.halfSize[0];Ea[Va+4]=ta.halfSize[1];Ea[Va+5]=ta.halfSize[2];Ea[Va+6]=ta.quaternion[0];Ea[Va+7]=ta.quaternion[1];Ea[Va+8]=ta.quaternion[2];Ea[Va+9]=ta.quaternion[3]});return Ea}function ua(Fa,
Ea){Fa.forEach(Va=>Va.opacity=Ea)}function Da(Fa){return Ea=>{if(Fa.immediate)return Fa.immediate.schedule(Ea);console.error("Error no immediate schudler");throw Error("cant find immediate scheduler");}}const Ia=d.getLogger("esri.views.3d.layers.I3SMeshView3D"),Na=[1,1,1,1];let ab=function(Fa){function Ea(db,ta,Ga,Oa,Qa,Ya,eb){var gb=Va.call(this);gb.node=db;gb.featureIds=ta;gb.objectHandle=Ga;gb.cachedRendererVersion=Oa;gb.attributeInfo=Qa;gb.material=Ya;gb.textures=eb;gb.cachedMidsTerrainSR=null;
gb.cachedEdgeMaterials=[];gb.edgeMemoryUsage=0;gb.cachedSymbology=null;return gb}c._inherits(Ea,Fa);var Va=c._createSuper(Ea);return c._createClass(Ea)}(ka.NodeCrossfadeMetaData);var cb;(function(Fa){Fa[Fa.CastShadows=4]="CastShadows";Fa[Fa.Pickable=5]="Pickable"})(cb||(cb={}));const hb=100*l.ByteSizeUnit.MEGABYTES;var ib;(function(Fa){Fa[Fa.ADD=0]="ADD";Fa[Fa.REMOVE=1]="REMOVE";Fa[Fa.UPDATE=2]="UPDATE"})(ib||(ib={}));const qb=O.create(),pb=J.create(),Lb=J.create(),Tb=Ka.create(),tb=[0,0,0,0],Cb=
new n([0,0,0,0]),Ib=G.fromValues(0,0,0,0),bb={remove(){},pause(){},resume(){}};b.ElevationMode=void 0;(function(Fa){Fa[Fa.Absolute=0]="Absolute";Fa[Fa.RelativeToGround=1]="RelativeToGround";Fa[Fa.OnTheGround=2]="OnTheGround"})(b.ElevationMode||(b.ElevationMode={}));const ob=H.create(),Ab=O.create();b.I3SMeshView3D=Fa=>{Fa=function(Ea){function Va(...ta){ta=db.call(this,ta);ta._nodeId2Meta=new Map;ta._nodeId2MetaReloading=new Map;ta._i3sWasmLoaded=!1;ta._snappingSourcesTrackers=[];ta._hasLoadedPBRTextures=
!1;ta._asyncModuleLoading=0;ta._addTasks=new Map;ta._currentRenderer=null;ta._rendererVersion=0;ta._colorVariable=null;ta._opacityVariable=null;ta._rendererFields=null;ta._symbologyFields=null;ta._symbologyOverride=null;ta._symbologyOverrideFields=null;ta._symbolInfos=new Map;ta._visibleGeometryChangedSchedulerHandle=null;ta._idbCache=f("enable-feature:idb-mock-cache")?new ra.IDBMockCache:new pa.IDBCache("esri-scenelayer-cache","geometries");ta._hasComponentData=!1;ta._hasVertexColors=!1;ta.holeFilling=
"auto";ta._hasColors=!1;ta._hasTextures=!1;ta._hasData=!1;ta.slicePlaneEnabled=!1;ta._modifications=[];ta.ignoresMemoryFactor=!1;ta._layerUrl="";ta._cacheKeySuffix=null;ta._elevationTask=null;ta._filters=[];ta._arcade=null;ta._tmpAttributeOnlyGraphic=new x(null,null,{});ta._crossfadeHelper=new ka.I3SCrossfadeHelper(c._assertThisInitialized(ta));return ta}c._inherits(Va,Ea);var db=c._createSuper(Va);Ea=Va.prototype;Ea.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);
var ta=this.view.resourceController;this.i3sOverrides=new qa.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:ta.memoryController});this._worker=new Z.I3SMeshWorkerHandle(Da(ta));this.addResolvingPromise(this._worker.promise);ta=this.i3slayer.store;this._worker.setLegacySchema(this.uid,ta.defaultGeometrySchema);xa.checkSceneLayerValid(this.i3slayer);xa.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new U({layerView:this});
this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();ta=ta.defaultGeometrySchema;if(this._isIntegratedMesh||!ta)this._hasComponentData=!1;else{const Ga=ta.featureAttributes;this._hasComponentData=!!(Ga&&Ga.faceRange&&Ga.id)}this._hasVertexColors=null!=(ta?.vertexAttributes.color??null)&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);
this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(this.uid,Ga=>this._deleteComponentObject(Ga));this._intersectionHandler=new ca.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Ga=>k.isSome(this._controller.index)&&k.isSome(this._controller.index.rootNode)?
this._controller.index.traverse(this._controller.index.rootNode,Oa=>{var Qa=Oa.index;Qa=this._nodeId2Meta.get(Qa)||this._nodeId2MetaReloading.get(Qa);return Ga(Oa,k.isSome(Qa)?Qa.objectHandle:null)}):()=>{}});this.updatingHandles.add(()=>this.layerUid,Ga=>this._intersectionHandler.layerUid=Ga);this.updatingHandles.add(()=>this.sublayerUid,Ga=>this._intersectionHandler.sublayerUid=Ga);this._elevationProvider=new da({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=
this._usePBR;this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),h.initial);this.updatingHandles.add(()=>this.fullOpacity,Ga=>this._opacityChange(Ga));this.updatingHandles.add(()=>this.slicePlaneEnabled,Ga=>this._slicePlaneEnabledChange(Ga));this.updatingHandles.add(()=>this.elevationOffset,(Ga,Oa)=>{this._reloadAll(Oa);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(Ga,Oa)=>this._elevationInfoChanged(Ga,Oa),h.initial);
this.updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==b.ElevationMode.Absolute,(Ga,Oa)=>{Ga?this.handles.add(this.view.basemapTerrain.on("elevation-change",({extent:Qa})=>this._ensureElevationTask().addExtent(Qa)),"elevation-change"):Oa&&this.handles.remove("elevation-change")},h.initial);this.updatingHandles.add(()=>this._usePBR,Ga=>this._updatePBR(Ga));ta=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,ta);this.updatingHandles.add(()=>
this.uncompressedTextureDownsamplingEnabled,ta);this.updatingHandles.add(()=>this.suspended,Ga=>this._suspendedChange(Ga),h.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),h.initial);this.updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),h.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),h.initial);this.handles.add([h.watch(()=>Aa.I3S_TREE_SHOW_TILES,Ga=>{if(Ga&&!this._treeDebugger){const Oa=
this._controller.crsIndex;(new Promise((Qa,Ya)=>a(["./support/I3STreeDebugger"],Qa,Ya))).then(({I3STreeDebugger:Qa})=>{!this._treeDebugger&&Aa.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Qa({lv:this,view:this.view,nodeSR:Oa}))})}else Ga||Aa.I3S_TREE_SHOW_TILES||(this._treeDebugger=k.destroyMaybe(this._treeDebugger))},h.initial),h.watch(()=>Aa.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),h.initial)]);this._cacheKeySuffix=xa.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);
this._idbCache.init().catch(Ga=>Ia.warn(`Failed to initialize IndexedDB cache: ${Ga}`))};Ea.destroy=function(){this._clearAddTasks();this._elevationTask=k.destroyMaybe(this._elevationTask);this.i3sOverrides=k.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),
this._intersectionHandler=null);const ta=this._worker;ta&&(ta.destroyContext(this.uid).then(()=>ta.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=k.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=k.destroyMaybe(this._labeler);this._treeDebugger=k.destroyMaybe(this._treeDebugger);this._controller=k.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=
k.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};Ea._memEstimateTextureAdded=function(ta){ta=ta.estimatedTexMemRequired;this._gpuMemoryEstimate+=ta;this._texMemoryEstimate+=ta;return ta};Ea._memEstimateTextureRemoved=function(ta){k.isSome(ta)&&(ta=ta.estimatedTexMemRequired,this._gpuMemoryEstimate-=ta,this._texMemoryEstimate-=
ta)};Ea._memEstimateGeometryAdded=function(ta){ta=this._collection.getObjectGPUMemoryUsage(ta);this._gpuMemoryEstimate+=ta;this._geoMemoryEstimate+=ta;return ta};Ea._memEstimateGeometryRemoved=function(ta){ta=this._collection.getObjectGPUMemoryUsage(ta);this._gpuMemoryEstimate-=ta;this._geoMemoryEstimate-=ta};Ea.isNodeLoaded=function(ta){return this._nodeId2Meta.has(ta)};Ea.isNodeReloading=function(ta){return this._nodeId2MetaReloading.has(ta)};Ea._labelingChanged=function(){if(!na.areLabelsVisible(this.i3slayer)||
!this._supportsLabeling)k.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!k.isSome(this._labeler)){var ta=new X({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(Ga=>k.isSome(Ga)&&this._addMetaToLabeler(ta,Ga));this._labeler=ta}};Ea._loadAsyncModule=function(ta){++this._asyncModuleLoading;return ta.then(Ga=>{--this._asyncModuleLoading;return Ga},Ga=>{--this._asyncModuleLoading;throw Ga;})};Ea._modificationsChanged=function(){if(!this._i3sWasmLoaded&&
this.hasModifications)this._i3sWasmLoaded=aa.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var ta=this.uid,Ga=this.i3slayer.spatialReference;this._worker.setModifications(ta,this._layerClippingArea,this._modifications,Ga);var Oa=Z.toWasmModification(this._layerClippingArea,this._modifications,Ga);aa.setModificationsSync({context:ta,modifications:Oa,isGeodetic:Ga.isGeographic});this._controller.modificationsChanged();
var Qa=this.hasModifications?new u:null;this._nodeId2Meta.forEach((Ya,eb)=>{k.isNone(Ya)?(this._nodeId2Meta.delete(eb),this._controller.updateLoadStatus(eb,!1)):Ya.node.hasModifications?(this._nodeId2Meta.delete(eb),this._nodeId2MetaReloading.set(eb,Ya)):k.isSome(Qa)&&Qa.push(Ya.node)});k.isSome(Qa)&&this._nodeId2MetaReloading.forEach(Ya=>Qa.push(Ya.node));k.isSome(Qa)&&0<Qa.length&&(this.updateNodeModificationStatus(Qa),Qa.forAll(Ya=>{if(Ya.imModificationImpact!==ma.NodeIMModificationImpact.Culled){const eb=
this._nodeId2Meta.get(Ya.index);this._controller.invalidateGeometryVisibility(Ya.index);k.isSome(eb)?(this._nodeId2Meta.delete(Ya.index),this._nodeId2MetaReloading.set(Ya.index,eb)):this._nodeId2Meta.has(Ya.index)&&(this._nodeId2Meta.delete(Ya.index),this._controller.updateLoadStatus(Ya.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};Ea._showModifications=function(){k.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),
this._modificationGraphics=null);if(Aa.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var ta={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Ga={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Oa of this._modifications){const Qa=Oa.geometry;Qa.spatialReference=this.i3slayer.spatialReference;this._modificationGraphics.push(new x({geometry:Qa,symbol:{...Ga,color:ta[Oa.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}};
Ea._addMetaToLabeler=function(ta,Ga){ta.addNodeMeta(Ga,(Oa,Qa)=>this._createAttributes(Oa,Qa))};Ea._suspendedChange=function(ta){ta?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};
Ea.getLoadedAttributes=function(ta){ta=this._nodeId2Meta.get(ta);if(k.isSome(ta)&&k.isSome(ta.attributeInfo))return ta.attributeInfo.loadedAttributes};Ea.getAttributeData=function(ta){ta=this._nodeId2Meta.get(ta);if(k.isSome(ta)&&k.isSome(ta.attributeInfo))return ta.attributeInfo.attributeData};Ea.setAttributeData=function(ta,Ga){ta=this._nodeId2Meta.get(ta);k.isSome(ta)&&k.isSome(ta.attributeInfo)&&(ta.attributeInfo.attributeData=Ga,this._attributeValuesChanged(ta))};Ea.updateAttributes=async function(ta,
Ga,Oa){const Qa=this._nodeId2Meta.get(ta);k.isSome(Qa)&&(await this.i3sOverrides.apply(Qa.featureIds,Ga,Oa),Qa.attributeInfo=Ga,this._controller.reschedule(()=>this._attributeValuesChanged(Qa),Oa).catch(Ya=>{p.isAbortError(Ya)||Ia.warn("Error while updating attribute values. Layer might not display correctly.",Ya)}))};Ea._attributeValuesChanged=function(ta){ta.cachedRendererVersion=this._getInvalidRendererVersion();ta.filteredIds=null;k.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(ta,
(Ga,Oa)=>this._createAttributes(Ga,Oa));this._updateEngineObject(ta)};Ea.clearMemCache=function(){k.isSome(this._memCache)&&this._memCache.clear()};Ea.getVisibleNodes=function(){const ta=[];this._nodeId2Meta.forEach(Ga=>k.isSome(Ga)&&ta.push(Ga.node));return ta};Ea.getNodeComponentObb=function(ta){ta=this._nodeId2Meta.get(ta.index)??this._nodeId2MetaReloading.get(ta.index);return k.isSome(ta)?this._collection.getComponentObb(ta.objectHandle):null};Ea.getLoadedNodeIndices=function(ta){this._nodeId2Meta.forEach((Ga,
Oa)=>ta.push(Oa));this._nodeId2MetaReloading.forEach((Ga,Oa)=>ta.push(Oa))};Ea._preLoadBasis=function(){!f("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&ba.TextureEncoding.Basis)&&k.applySome(this.i3slayer.textureSetDefinitions,ta=>ta.some(Ga=>Ga.formats.some(Oa=>"basis"===Oa.format||"ktx2"===Oa.format)))&&Za.loadBasis()};Ea._getVertexBufferLayout=function(ta,Ga){ta={hasTexture:Ta(ta.params.material),hasNormals:Ga.normal,hasRegions:Ga.uvRegion};return Ra.glLayout(La.createVertexBufferLayout(this._getGeometryParameters(ta)))};
Ea._getObjectIdField=function(){return this.i3slayer.objectIdField||P.fallbackObjectIDAttribute};Ea._findGraphicNodeAndIndex=function(ta){const Ga=va.attributeLookup(this.i3slayer.fieldsIndex,ta.attributes,this._getObjectIdField());let Oa=null;e.someMap(this._nodeId2Meta,Qa=>{if(k.isNone(Qa))return!1;const Ya=Qa.featureIds.indexOf(Ga);if(-1===Ya)return!1;Oa={node:Qa.node,index:Ya};return!0});return Oa};Ea._getGraphicIndices=function(ta,Ga){ta=this._nodeId2Meta.get(ta.index);if(k.isNone(ta))return[];
const Oa=[],Qa=this._getObjectIdField(),Ya=this.i3slayer.fieldsIndex;for(const eb of Ga)Ga=va.attributeLookup(Ya,eb.attributes,Qa),Ga=ta.featureIds.indexOf(Ga),-1!==Ga&&Oa.push(Ga);return Oa};Ea.whenGraphicBounds=function(ta){ta=this._findGraphicNodeAndIndex(ta);if(!ta)return Promise.reject();ta=this._getAABB(ta.node.index,ta.index);return k.isNone(ta)?Promise.reject():Promise.resolve({boundingBox:ta,screenSpaceObjects:[]})};Ea.getAABBFromIntersectorTarget=function(ta){return null==ta.nodeIndex||
null==ta.componentIndex?null:this._getAABB(ta.nodeIndex,ta.componentIndex)};Ea._getAABB=function(ta,Ga){ta=this._nodeId2Meta.get(ta);if(k.isNone(ta)||null==ta.featureIds||Ga>=ta.featureIds.length)return null;Ga=ha.boundingBoxCornerPoints(Ga,this._collection,ta.objectHandle,M.newDoubleArray(24));if(!R.projectBuffer(Ga,this.view.renderSpatialReference,0,Ga,this.view.spatialReference,0,8))return null;ta=O.empty();O.expandWithBuffer(ta,Ga,0,8);return ta};Ea.whenGraphicAttributes=function(ta,Ga){return xa.whenGraphicAttributes(this.i3slayer,
ta,this._getObjectIdField(),Ga,()=>[...this._nodeId2Meta.values()].filter(k.isSome))};Ea.getGraphicFromIntersectorTarget=function(ta){if(null==ta.nodeIndex||null==ta.componentIndex)return null;const Ga=this._nodeId2Meta.get(ta.nodeIndex);return k.isNone(Ga)||null==Ga.featureIds||ta.componentIndex>=Ga.featureIds.length?null:this._createGraphic(ta.componentIndex,Ga)};Ea._getCacheKey=function(ta){return`${this._layerUrl}/v${19}/${ta.id}${this._cacheKeySuffix}`};Ea._getMemCacheKey=function(ta,Ga=this.elevationOffset){return ta+
"#"+Ga};Ea.loadCachedGPUData=function(ta){return k.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(ta.index)):null};Ea.deleteCachedGPUData=function(ta){k.isSome(ta)&&this._deleteComponentObject(ta)};Ea._cacheGPUData=function(ta,Ga=this.elevationOffset){if(k.isNone(this._memCache))this._deleteComponentObject(ta);else{var Oa=this._controller.indexDepth-ta.node.level;this._memCache.put(this._getMemCacheKey(ta.node.index,Ga),ta,ta.node.memory,Oa)}};Ea.loadMissingTextures=function(ta,Ga,
Oa,Qa){const Ya=ta?.filter((eb,gb)=>{if(0===(eb.usage&this.rendererTextureUsage))return!1;if(k.isNone(Ga))return!0;eb=fa.selectEncoding(eb.encodings,this.supportedTextureEncodings);gb=Ga[gb];return k.isNone(gb)||null==gb.data||eb&&gb.encoding!==eb.encoding?!0:!1})??[];return 0===Ya.length?Promise.resolve(!1):Oa(Ya,Qa).then(eb=>{let gb=0;for(let lb=0;lb<ta.length;lb++)gb<eb.length&&eb[gb].id===ta[lb].id&&(Ga[lb]=eb[gb],gb++);return!0})};Ea.loadCachedNodeData=function(ta,Ga,Oa){return this._idbCacheEnabled?
this._idbCache.get(this._getCacheKey(ta),Ga).then(Qa=>{if(null==Qa)return null;if(Qa.nodeVersion!==ta.version)return this._idbCache.remove(this._getCacheKey(ta)),null;this.elevationInfo.mode===b.ElevationMode.Absolute&&(ta.geometryObb=Qa.geometryObb);return this.loadMissingTextures(Qa.requiredTextures,Qa.textureData,Oa,Ga).then(Ya=>{Ya&&this._idbCache.initialized&&k.isSome(Qa.textureData)&&(Qa.byteSize=fb(Qa.transformedGeometry,Qa.textureData),Qa.textureData.every(Ma)&&ya(ta,Qa)&&this._idbCache.put(this._getCacheKey(ta),
Qa).catch(eb=>Ia.warn(`Failed to update node with textures in IndexedDB cache: ${ta.id}: ${eb}`)));p.throwIfAborted(Ga);return Qa})}):Promise.resolve(null)};Ea.addNode=function(ta,Ga,Oa){return"geometryData"in Ga?null==Ga.geometryBuffer?(this._addNodeMeta(ta.index,null),Promise.resolve()):this._addData(ta,Ga.attributeDataInfo,()=>this._transformNode(ta,Ga,Oa).then(Qa=>this._safeReschedule(()=>{if(k.isNone(Qa))return ta.hasModifications=!1,this._addCachedNodeData(ta,null,Oa);ta.hasModifications=Qa.transformedGeometry.hasModifications;
const {obb:Ya,componentOffsets:eb,featureIds:gb,transformedGeometry:lb}=Qa;var kb=wa.computeGlobalTransformation(ta.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),nb=Ka.create([Ya.center.x,Ya.center.y,Ya.center.z],[Ya.extents.x,Ya.extents.y,Ya.extents.z],E.fromValues(Ya.orientation.x,Ya.orientation.y,Ya.orientation.z,Ya.orientation.w));F.transformMat4(nb.center,nb.center,kb);this.elevationInfo.mode===b.ElevationMode.Absolute&&(ta.geometryObb=nb);Ga.geometryData.componentOffsets=
eb;gb&&(Ga.geometryData.featureIds=Array.from(gb));kb={nodeVersion:ta.version,geometryData:Ga.geometryData,requiredTextures:Ga.requiredTextures,textureData:Ga.textureData,transformedGeometry:lb,globalTrafo:kb,geometryObb:nb,byteSize:fb(lb,Ga.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&ya(ta,kb)&&(nb=k.isSome(kb.textureData)?kb.textureData.map(ub=>Ma(ub)?ub:null):null,this._idbCache.put(this._getCacheKey(ta),{...kb,textureData:nb}).catch(ub=>Ia.warn(`Failed to store node in IndexedDB cache: ${ta.id}: ${ub}`)));
return this._addCachedNodeData(ta,kb,Oa)},Oa))):Promise.reject()};Ea.getElevationRange=function(ta){let Ga=Infinity,Oa=-Infinity;const Qa=L.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference);this._nodeId2Meta.forEach(Ya=>{if(k.isSome(Ya)&&k.isSome(Ya.node.geometryObb)&&Ka.intersectSphere(Ya.node.geometryObb,ta)){var eb=this._collection.getObjectTransform(Ya.objectHandle);eb=this.view.renderCoordsHelper.getAltitude(eb.position);for(let lb=0;lb<Ya.featureIds.length;lb++){var gb=this._collection.getComponentAabb(Ya.objectHandle,
lb,Ab);if("local"===this.view.viewingMode)Ga=Math.min(Ga,eb+gb[2]),Oa=Math.max(Oa,eb+gb[5]);else{Ga=Math.min(Ga,eb+gb[2]);const kb=Math.max(Math.abs(gb[3]),Math.abs(gb[0])),nb=Math.max(Math.abs(gb[4]),Math.abs(gb[1]));gb=eb+gb[5]+Qa.radius;Oa=Math.max(Oa,Math.sqrt(kb*kb+nb*nb+gb*gb)-Qa.radius)}}}});return{min:Ga,max:Oa}};Ea.computeVisibilityObb=function(ta){return xa.computeVisibilityObb(ta,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,
this._modifications)};Ea._transformNode=function(ta,Ga,Oa){var Qa=Ga.geometryData.geometries??[];const Ya=Array(Qa.length);for(var eb=0;eb<Qa.length;++eb)Ya[eb]=this._getVertexBufferLayout(Qa[eb],Ga.geometryDescriptor);Qa=ta.mbs;eb=this.elevationOffset;var gb=this._controller.crsIndex,lb=this._controller.crsVertex;const kb=this.view.renderSpatialReference,nb=wa.getLocalOrigin(Qa,eb,gb),ub=wa.computeGlobalTransformation(Qa,eb,gb,kb);gb=R.getProjectorName(gb,lb);lb=R.getProjectorName(lb,kb);return k.isNone(gb)||
k.isNone(lb)?Promise.resolve(null):this._worker.invoke({context:this.uid,geometryBuffer:Ga.geometryBuffer,geometryData:Ga.geometryData,geometryDescriptor:Ga.geometryDescriptor,layouts:Ya,localOrigin:nb,globalTrafo:ub,mbs:Qa,obb:ta.serviceObb,elevationOffset:eb,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:gb,vertexToRenderProjector:lb},Oa)};Ea._setNewNodeOpacity=function(ta){this._setNodeOpacity(ta,
this.nodeCrossfadingEnabled?0:this.fullOpacity)};Ea.addCachedGPUData=function(ta,Ga,Oa){this.elevationInfo.mode===b.ElevationMode.Absolute&&(ta.geometryObb=Ka.clone(this._collection.getComponentObb(Ga.objectHandle)));this._controller.isGeometryVisible(ta)?(k.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Ga),ta=ta.index,this._addNodeMeta(ta,Ga),this.updateNodeState(ta,Oa),this._collection.setObjectVisibility(Ga.objectHandle,Sa.State.Visible),this._updateMaterial(Ga),this._setNewNodeOpacity(Ga),
this.elevationInfo.mode!==b.ElevationMode.Absolute&&this._ensureElevationTask().schedule(ta),this._updateEngineObject(Ga),this._highlights.objectCreated(Ga),k.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Ga)};Ea.addCachedNodeData=function(ta,Ga,Oa,Qa){return this._addData(ta,Oa,()=>this._addCachedNodeData(ta,Ga,Qa))};Ea._addCachedNodeData=async function(ta,Ga,Oa){if(this.suspended||!this._controller.isGeometryVisible(ta))this._removeNodeStageData(ta.index,this.elevationOffset,
this._nodeId2MetaReloading);else if(k.isNone(Ga))this._addNodeMeta(ta.index,null);else{var Qa=this._addTasks.get(ta.index),{geometryData:Ya,transformedGeometry:eb,globalTrafo:gb}=Ga;await this.i3sOverrides.apply(Ya.featureIds,Qa.attributeInfo,Oa);var lb=k.isSome(Ga.textureData)?Ga.textureData.filter(Db=>k.isSome(Db)&&0!==(Db.usage&this.rendererTextureUsage)):[];!f("disable-feature:i3s-basis")&&lb.some(Db=>k.isSome(Db)&&(Db.encoding===ba.TextureEncoding.Basis||Db.encoding===ba.TextureEncoding.KTX2))&&
await Za.loadBasis();ta.memory=0;var {componentOffsets:kb,geometries:nb,featureIds:ub}=Ya,Jb=this._collection,Bb=nb[0],{layout:xb,indices:mb,interleavedVertexData:vb,positionData:Eb,hasColors:wb}=eb,zb=this._materialParameters(Bb,xb),Qb=kb||new Uint32Array([0,mb?mb.length:vb.byteLength/xb[0].stride]);Qb={vertices:{data:vb,count:vb.byteLength/xb[0].stride,layoutParameters:zb.geometryParams},positionData:{positions:Eb.data,indices:Eb.indices},indices:mb,componentOffsets:Qb};var Kb=Bb.transformation?
C.clone(Bb.transformation):C.create();t.multiply(Kb,gb,Kb);Bb=t.getTranslation(H.create(),Kb);Kb=v.fromMat4(A.create(),Kb);var Ob=this.view.renderSpatialReference,Wb=this.view.basemapTerrain.spatialReference,Rb=H.create(),Fb=[1,1,1];R.localLinearScaleFactors(Bb,Ob,Fb,Wb)||Ia.errorOnce("Unsupported coordinate system for IM overlay");R.projectVectorToVector(Bb,Ob,Rb,Wb);var Sb=Jb.createObject({toMapSpace:I.fromValues(Rb[0],Rb[1],Fb[0],Fb[1]),geometry:Qb,obb:Ga.geometryObb,transform:{position:Bb,rotationScale:Kb}}),
{textures:Yb,texturePromise:dc}=this._initMaterialAndTextures(Sb,zb.material,lb,zb.geometryParams.textureCoordinates===Ua.TextureCoordinateAttributeType.Atlas);ta.memory+=this._memEstimateGeometryAdded(Sb);ta.memory+=Yb.reduce((Db,Pb)=>Db+(k.isSome(Pb)?this._memEstimateTextureAdded(Pb):0),0);lb=!!zb.material.hasParametersFromSource;zb="blend"!==zb.material.alphaMode&&1<=zb.material.metallicRoughness.baseColorFactor[3];var yb=new ab(ta,ub,Sb,this._getInvalidRendererVersion(),Qa.attributeInfo,{hasParametersFromSource:lb,
isOpaque:zb},Yb);Qa.meta=yb;!this._hasTextures&&Ga.requiredTextures?.some(({usage:Db})=>0!==(Db&ba.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||wb;this._hasTextures=this._hasTextures||!!ta.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var fc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(yb),dc]).then(([Db])=>{k.isSome(Db)&&Db.updateObjectVisibility(yb.objectHandle,!1).catch(Pb=>la(Pb,this.i3slayer.title));
return this._safeReschedule(()=>{var Pb=this._addTasks.get(ta.index);if(Pb)if(this._addNodeMeta(ta.index,yb),Pb.meta=null,this.suspended)this._removeNodeStageData(ta.index,this.elevationOffset);else{Jb.setObjectVisibility(Sb,Sa.State.Visible);k.isSome(Db)&&Db.updateObjectVisibility(yb.objectHandle,!0).catch(mc=>la(mc,this.i3slayer.title));yb.attributeInfo=Pb.attributeInfo;Pb=yb.cachedRendererVersion!==this._rendererVersion;var Xb=fc!==this.slicePlaneEnabled;this._updateElevationOffsets(yb);var ec=
yb.elevationOffsets;this._updateComponentData(yb);var ic=this._applyFiltersToNode(yb);(Pb||k.isSome(Db)&&(Xb||ic||ec))&&this._addOrUpdateEdgeRendering(yb);k.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,yb);this._visibleGeometryChanged(yb,ib.ADD);this._highlights.objectCreated(yb);this._updateMaterial(yb);this._setNewNodeOpacity(yb);k.isSome(this._treeDebugger)&&this._treeDebugger.update()}},Oa)}).catch(Db=>{k.isSome(Qa.meta)&&(this._cacheGPUData(Qa.meta),Qa.meta=null);throw Db;})}};
Ea._addNodeMeta=function(ta,Ga){this._removeNodeStageData(ta,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(ta)){Ia.error("Removing duplicated node");const Oa=this._nodeId2Meta.get(ta);k.isSome(Oa)&&this._deleteComponentObject(Oa)}else this._controller.updateLoadStatus(ta,!0);k.isSome(Ga)&&(Ga.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&ua(Ga.cachedEdgeMaterials,0));this._nodeId2Meta.set(ta,Ga)};Ea._updateElevationOffsets=function(ta){const Ga=this.view.renderSpatialReference,
Oa=this.elevationInfo,Qa=this.view.basemapTerrain,Ya=Qa.spatialReference;var eb=Oa.mode;if(k.isNone(Ga)||k.isNone(Ya)||eb===b.ElevationMode.Absolute)ta.elevationOffsets=null;else{var gb=this._collection.getObjectTransform(ta.objectHandle);ta.elevationOffsets=ta.elevationOffsets??[];var lb=eb===b.ElevationMode.OnTheGround;eb=this.view.renderCoordsHelper;var kb=ta.featureIds.length;if(!ta.cachedMidsTerrainSR){ta.cachedMidsTerrainSR=M.newDoubleArray(3*kb);const Bb=ta.cachedMidsTerrainSR;for(let xb=0;xb<
kb;xb++){this._collection.getComponentAabb(ta.objectHandle,xb,Ab,!0);F.set(ob,(Ab[0]+Ab[3])/2,(Ab[1]+Ab[4])/2,Ab[2]);F.transformMat3(ob,ob,gb.rotationScale);F.add(ob,ob,gb.position);const mb=3*xb;Bb[mb+2]=eb.getAltitude(ob);R.projectVectorToVector(ob,Ga,ob,Ya);Bb[mb]=ob[0];Bb[mb+1]=ob[1]}}var nb=ta.cachedMidsTerrainSR,ub=Oa.offset,Jb=ta.elevationOffsets;Qa.getElevations(nb,kb,(Bb,xb)=>{const mb=lb?nb[3*Bb+2]:0;Jb[Bb]=ub+(k.isSome(xb)?xb-mb:0)})}};Ea._ensureElevationTask=function(){return k.isSome(this._elevationTask)?
this._elevationTask:this._elevationTask=new ja.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,ta=>{ta=this._controller.updateElevationChanged(ta,this.view.basemapTerrain.spatialReference);return k.isSome(ta)?ta.filterInPlace(Ga=>k.isSome(this._nodeId2Meta.get(Ga))):null},ta=>{ta=this._nodeId2Meta.get(ta);this._nodeElevationAlignmentChanged(ta)})};Ea._elevationInfoChanged=function(ta,Ga){const Oa=ta.mode!==b.ElevationMode.Absolute;ta=!!Ga&&Ga!==ta&&Ga.mode!==b.ElevationMode.Absolute;
this._intersectionHandler.updateElevationAlignState(Oa,this.view.state.viewingMode);Oa&&!ta&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Qa=>this._nodeElevationAlignmentChanged(Qa))};Ea._nodeElevationAlignmentChanged=function(ta){k.isNone(ta)||(this._updateElevationOffsets(ta),this._updateComponentData(ta),this._updateEdgeRendering(ta),k.isSome(this._labeler)&&this._labeler.updateLabelPositions(ta),this._updateSnappingSources(ta,ib.UPDATE))};Ea._safeReschedule=function(ta,Ga){p.throwIfAborted(Ga);
return this._controller.reschedule(ta,Ga)};Ea._materialParameters=function(ta,Ga){ta=k.isSome(ta.params.material)?ta.params.material:fa.defaultMaterial();const Oa=Ga.some(Ya=>"uvRegion"===Ya.name);Ga=Ga.some(Ya=>"normalCompressed"===Ya.name);const Qa=Ta(ta);return{geometryParams:this._getGeometryParameters({hasTexture:Qa,hasNormals:Ga,hasRegions:Oa}),material:ta}};Ea._initMaterialAndTextures=function(ta,Ga,Oa,Qa){const Ya=this._stage.renderView,eb=Oa.map(lb=>fa.createTexture(lb,Ga,Qa,Ya));this._stage.addMany(eb);
let gb=null;this._collection.updateMaterial(ta,lb=>{gb=fa.configureMaterial(lb,Ga,eb,Oa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(lb)});return{textures:eb,texturePromise:gb}};Ea._getGeometryParameters=function(ta){return{textureCoordinates:ta.hasTexture?ta.hasRegions?Ua.TextureCoordinateAttributeType.Atlas:
Ua.TextureCoordinateAttributeType.Default:Ua.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:ta.hasNormals&&!this._isIntegratedMesh}};Ea._addData=function(ta,Ga,Oa){let Qa=this._addTasks.get(ta.index);Qa?Qa.attributeInfo=Ga:(Qa={...p.createResolver(),attributeInfo:Ga,meta:null},this._addTasks.set(ta.index,Qa),Oa().then(Qa.resolve,Qa.reject).then(()=>this._addTasks.delete(ta.index)).catch(Ya=>{this._addTasks.delete(ta.index);throw Ya;}));return Qa.promise};Ea._clearAddTasks=
function(){this._addTasks.forEach(ta=>{k.isSome(ta.meta)&&(this._cacheGPUData(ta.meta),ta.meta=null)});this._addTasks.clear()};Ea._clippingAreaChanged=function(){var ta=this.view.renderSpatialReference;const Ga=this.i3slayer.spatialReference,Oa=J.create();this._renderClippingArea=Ha.toBoundingRect(this.view.clippingArea,Oa,ta)?Oa:null;ta=J.create();this._layerClippingArea=Ha.toBoundingRect(this.view.clippingArea,ta,Ga)?ta:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);
this._isIntegratedMesh&&this._modificationsChanged()};Ea._geometryFilterChange=function(){const ta=this.hasGeometryFilter;this._controller.geometryFilterChanged(ta);this._applyFilters(ta)};Ea._filterChange=function(){this._applyFilters(this.hasGeometryFilter)};Ea._applyFilters=function(ta){this._filters=this.getFilters();ta?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Ga=>{k.isSome(Ga)&&this._applyFiltersToNode(Ga)&&(this._addOrUpdateEdgeRendering(Ga),this._visibleGeometryChanged(Ga,
ib.UPDATE))})};Ea.getFilters=function(){const ta=[],Ga=this._renderClippingArea;k.isSome(Ga)&&ta.push((Oa,Qa)=>this._boundingRectFilter(Oa,Qa,Ga));return ta};Ea.addSqlFilter=function(ta,Ga,Oa){if(k.isSome(Ga)){const Qa=Ga.fieldNames;ta.push((Ya,eb)=>this._sqlFilter(Ya,eb,Ga,Qa,Oa))}};Ea._sqlFilter=function(ta,Ga,Oa,Qa,Ya){const eb={},gb=this._createLayerGraphic(eb),lb=this.i3slayer.objectIdField,kb=Ga.featureIds,nb=k.isSome(Ga.attributeInfo)&&Ga.attributeInfo.attributeData;Qa.every(ub=>ub===lb||nb&&
null!=nb[ub])&&xa.filterInPlace(ta,kb,ub=>{eb[lb]=kb[ub];for(const Jb of Qa)Jb!==lb&&(eb[Jb]=nb?xa.getCachedAttributeValue(nb[Jb],ub):null);try{return Oa.testFeature(gb)}catch(Jb){return Ya(Jb),!1}})};Ea._boundingRectNodeTest=function(ta,Ga){R.projectBoundingSphere(ta.node.mbs,this._controller.crsIndex,Ib,this.view.renderSpatialReference);return xa.intersectBoundingRectWithMbs(Ga,Ib)};Ea._boundingRectFeatureTest=function(ta,Ga,Oa){this._collection.getComponentAabb(ta.objectHandle,Ga,qb);O.toRect(qb,
pb);return J.intersects(Oa,pb)};Ea._boundingRectFilter=function(ta,Ga,Oa){var Qa=this._collection;const Ya=this._boundingRectNodeTest(Ga,Oa);if(Ya!==xa.MbsIntersectResult.INSIDE)if(Ya===xa.MbsIntersectResult.OUTSIDE)ta.length=0;else if(Qa=Qa.getComponentCount(Ga.objectHandle),Qa.invisible+Qa.visible===Ga.featureIds.length){var eb=this._transformClippingArea(Lb,Oa,Ga.objectHandle);xa.filterInPlace(ta,Ga.featureIds,gb=>this._boundingRectFeatureTest(Ga,gb,eb))}};Ea._transformClippingArea=function(ta,
Ga,Oa){var Qa=this._collection.getObjectTransform(Oa);Oa=Qa.position;Qa=Qa.rotationScale;ta[0]=(Ga[0]-Oa[0])/Qa[0];ta[1]=(Ga[1]-Oa[1])/Qa[4];ta[2]=(Ga[2]-Oa[0])/Qa[0];ta[3]=(Ga[3]-Oa[1])/Qa[4];return ta};Ea._addOrUpdateEdgeRendering=function(ta,Ga=!0){const Oa=this._edgeView;if(k.isNone(Oa))return Promise.resolve(null);const Qa=ta.objectHandle;var Ya=Oa.hasObject(Qa);const {hasEdges:eb,perFeatureEdgeMaterials:gb}=this._getFilteredEdgeMaterials(ta),lb={hasSlicePlane:this.slicePlaneEnabled};if(eb&&
Ya)return this.nodeCrossfadingEnabled&&(Ya=this.getNodeOpacity(ta),ua(gb,Ya)),Oa.updateAllComponentMaterials(Qa,gb,lb,Ga).catch(kb=>la(kb,this.i3slayer.title)),Oa.updateObjectVisibility(Qa,!0).catch(kb=>la(kb,this.i3slayer.title)),Oa.updateAllVerticalOffsets(Qa,ta.elevationOffsets).catch(kb=>la(kb,this.i3slayer.title)),Promise.resolve(Oa);if(eb&&!Ya)return this._collection.addEdges(Qa,Oa,gb,lb).then(kb=>{ta.edgeMemoryUsage=kb;ta.node.memory+=kb;Oa.updateAllVerticalOffsets(Qa,ta.elevationOffsets).catch(nb=>
la(nb,this.i3slayer.title));return Oa});!eb&&Ya&&(ta.node.memory-=ta.edgeMemoryUsage,ta.edgeMemoryUsage=0,Oa.removeObject(Qa));return Promise.resolve(null)};Ea._applyFiltersToNode=function(ta){return this._applyFiltersToNodeComponents(ta)?(k.isSome(this._labeler)&&this._labeler.applyFilterChange(ta),!0):!1};Ea._applyFiltersToNodeComponents=function(ta){const Ga=this._collection;var Oa=0===Ga.getComponentCount(ta.objectHandle).invisible;Ga.setAllComponentVisibilities(ta.objectHandle,"all");if(0===
this._filters.length)return ta.filteredIds=null,!Oa;this._updateCachedFilteredIds(ta);if(ta.filteredIds===ta.featureIds)return!Oa;Oa=this._computeFilteredComponentIndices(ta);Ga.setAllComponentVisibilities(ta.objectHandle,Oa);return!0};Ea._updateCachedFilteredIds=function(ta){if(null==ta.filteredIds||ta.appliedFilters!==this._filters)ta.filteredIds=this._computeFilteredIds(ta),ta.appliedFilters=this._filters};Ea._computeFilteredIds=function(ta){const Ga=ta.featureIds.slice();for(const Oa of this._filters)if(Oa(Ga,
ta),0===Ga.length)break;return Ga.length===ta.featureIds.length?ta.featureIds:Ga};Ea._computeFilteredComponentIndices=function(ta){const Ga=[],Oa=ta.filteredIds;k.isSome(Oa)&&ta.featureIds.forEach((Qa,Ya)=>{Oa[Ga.length]===Qa&&Ga.push(Ya)});return Ga};Ea._removeAllNodeDataFromStage=function(ta=this.elevationOffset){this._nodeId2Meta.forEach((Ga,Oa)=>this._removeNodeStageData(Oa,ta));this._nodeId2MetaReloading.forEach((Ga,Oa)=>this._removeNodeStageData(Oa,ta,this._nodeId2MetaReloading));this._elevationTask=
k.destroyMaybe(this._elevationTask)};Ea.removeNode=function(ta){const Ga=this.elevationOffset;this._removeNodeStageData(ta,Ga);this._removeNodeStageData(ta,Ga,this._nodeId2MetaReloading);k.isSome(this._elevationTask)&&this._elevationTask.remove(ta)};Ea._removeNodeStageData=function(ta,Ga,Oa=this._nodeId2Meta){Oa.has(ta)&&this._controller.updateLoadStatus(ta,!1);const Qa=Oa.get(ta);k.isNone(Qa)?Oa.delete(ta):(this._collection.setObjectVisibility(Qa.objectHandle,Sa.State.Hidden),k.isSome(this._edgeView)&&
this._edgeView.hasObject(Qa.objectHandle)&&this._edgeView.updateObjectVisibility(Qa.objectHandle,!1).catch(Ya=>la(Ya,this.i3slayer.title)),this._visibleGeometryChanged(Qa,ib.REMOVE),k.isSome(this._labeler)&&this._labeler.removeNodeMeta(Qa),Oa.delete(ta),this._highlights.objectDeleted(Qa),Oa===this._nodeId2Meta?(this._cacheGPUData(Qa,Ga),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Qa)):this._deleteComponentObject(Qa),k.isSome(this._treeDebugger)&&this._treeDebugger.update())};
Ea._deleteComponentObject=function(ta){k.isSome(this._edgeView)&&this._edgeView.removeObject(ta.objectHandle);this._memEstimateGeometryRemoved(ta.objectHandle);this._collection.destroyObject(ta.objectHandle);if(ta.textures)for(const Ga of ta.textures)this._memEstimateTextureRemoved(Ga),this._stage.remove(Ga)};Ea.updateNodeState=function(ta,Ga){ta=this._nodeId2Meta.get(ta);k.isSome(ta)&&this._collection.updateMaterial(ta.objectHandle,Oa=>Oa.polygonOffsetEnabled=Ga===ma.NodeState.Hole)};Ea._invalidateAllSymbols=
function(){this._rendererVersion=xa.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Ea._getInvalidRendererVersion=function(){return xa.addWraparound(this._rendererVersion,-1)};Ea._rendererChange=async function(ta){this._currentRenderer=ta;this.notifyChange("rendererTextureUsage");this._rendererVersion=xa.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();ta&&(this._rendererFields=
await ta.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&ta&&"arcadeRequired"in ta&&ta.arcadeRequired&&(this._arcade=await W.loadArcade());if(ta&&"visualVariables"in ta&&ta.visualVariables)for(const Ga of ta.visualVariables)"color"===Ga.type?this._colorVariable=Ga:"opacity"===Ga.type?this._opacityVariable=Ga:Ia.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Ga.type}`);if(ta)for(const Ga of ta.getSymbols())"mesh-3d"!==Ga.type&&Ia.error(`Symbols of type '${Ga.type}' are not supported for 3D Object Scene Services.`);
this._controller&&this._controller.requestUpdate()};Ea._getCachedEdgeMaterials=function(ta){this._hasComponentData&&ta.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ta);return ta.cachedEdgeMaterials};Ea._getComponentParameters=function(ta){this._hasComponentData&&ta.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ta);const Ga=ta.cachedSymbology;return(Oa,Qa)=>{const Ya=5*Oa;K.set(Qa.externalColor,Ga[Ya]/255,Ga[Ya+1]/255,Ga[Ya+2]/255,Ga[Ya+
3]/255);if(k.isSome(this._stage.renderView.objectAndLayerIdRenderHelper)){const eb=ta.featureIds[Oa];this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(eb,eb,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabled,ta.node.resources.attributes,Oa,this.sublayerId);Qa.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:eb,layerUid:this.layerUid+"_"+this.sublayerId})}Qa.externalColorMixMode=Ga[Ya+4]&(1<<cb.CastShadows)-1;Qa.castShadows=
0!==(Ga[Ya+4]&1<<cb.CastShadows);Qa.pickable=0!==(Ga[Ya+4]&1<<cb.Pickable);Qa.elevationOffset=ta.elevationOffsets?.[Oa]??0}};Ea._getSymbolInfo=function(ta,Ga){Ga=ta&&ta.getSymbol(Ga,{arcade:this._arcade});if(!(Ga instanceof V))return null;ta=Ga.id;if(this._symbolInfos.has(ta))return this._symbolInfos.get(ta);Ga=xa.getSymbolInfo(Ga);this._symbolInfos.set(ta,Ga);return Ga};Ea._setSymbologyOverride=function(ta,Ga){this._symbologyOverride!==ta&&(this._symbologyOverride=ta,this._symbologyOverrideFields=
Ga,this._invalidateAllSymbols(),this._updateSymbologyFields())};Ea._updateSymbologyFields=function(){this._symbologyFields=k.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?k.isSome(this._rendererFields)&&0<this._rendererFields.length?N.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};Ea._updateCachedRendererData=function(ta){ta.cachedRendererVersion=this._rendererVersion;
if(this._hasComponentData){var Ga=this._tmpAttributeOnlyGraphic,Oa={};Ga.attributes=Oa;var Qa=this._currentRenderer,Ya=k.isSome(ta.attributeInfo)&&ta.attributeInfo.attributeData,eb=null!=ta.featureIds?this.i3slayer.objectIdField:null,gb=null!=Ya&&k.isSome(this._symbologyFields)&&0<this._symbologyFields.length,lb=null,kb=null;if(gb&&k.isSome(this._symbologyFields)){lb=[];kb=[];for(var nb of this._symbologyFields){var ub=Ya[nb];ub&&(lb.push(nb),kb.push(ub))}}ta.cachedSymbology||(ta.cachedSymbology=
new Uint8Array(5*ta.featureIds.length));Ya={color:tb,castShadows:!0,pickable:!0,colorMixMode:Ba.ColorMixModeEnum.Multiply,edgeMaterial:null};nb=this.fullOpacity;nb=this.nodeCrossfadingEnabled?this.getNodeOpacity(ta):nb;ub=null;var Jb=Xa.Transparency.OPAQUE,Bb=xa.transparentEdgeMaterial,xb=0;for(let wb=0;wb<ta.featureIds.length;wb++){null!=eb&&(Oa[eb]=ta.featureIds[wb]);if(gb&&lb)for(var mb=0;mb<lb.length;mb++)Oa[lb[mb]]=xa.getCachedAttributeValue(kb[mb],wb);var vb=Qa?this._getSymbolInfo(Qa,Ga):null;
let zb=mb=null;if(Qa&&"visualVariables"in Qa){if(this._colorVariable){var Eb=Q.getColor(this._colorVariable,Ga,{color:Cb,arcade:this._arcade});Eb&&(mb=tb,mb[0]=Eb.r/255,mb[1]=Eb.g/255,mb[2]=Eb.b/255,this._opacityVariable||null===Eb.a||(zb=Eb.a))}this._opacityVariable&&(zb=Q.getOpacity(this._opacityVariable,Ga,{arcade:this._arcade}))}vb&&vb.material&&(Eb=vb.material,mb=k.isNone(mb)||k.isNone(zb)?ia.overrideColor(mb,zb,Eb.color,Eb.alpha,Na,tb):ia.overrideColor(mb,zb,null,null,Na,tb));k.isNone(mb)&&
(mb=tb,mb[0]=1,mb[1]=1,mb[2]=1,mb[3]=1);Ya.pickable=!0;Ya.castShadows=vb?vb.castShadows:!0;Ya.colorMixMode=vb&&vb.material?vb.material.colorMixMode:Ba.ColorMixModeEnum.Multiply;Ya.edgeMaterial=vb?vb.edgeMaterial:null;k.isSome(this._symbologyOverride)&&(Ya.color=mb,this._symbologyOverride(Ga,Ya),mb=Ya.color);if(k.isSome(Ya.edgeMaterial)){vb=0>=mb[3]?Xa.Transparency.INVISIBLE:1<=mb[3]&&(ta.material.isOpaque||Ya.colorMixMode===Ba.ColorMixModeEnum.Replace)?Xa.Transparency.OPAQUE:Xa.Transparency.TRANSPARENT;
if(Ya.edgeMaterial!==ub||vb!==Jb)Bb={...Ya.edgeMaterial,opacity:nb,objectTransparency:vb},ub=Ya.edgeMaterial,Jb=vb;ta.cachedEdgeMaterials[wb]=Bb}else ta.cachedEdgeMaterials[wb]=xa.transparentEdgeMaterial;ta.cachedSymbology[xb]=Math.round(255*mb[0]);ta.cachedSymbology[xb+1]=Math.round(255*mb[1]);ta.cachedSymbology[xb+2]=Math.round(255*mb[2]);ta.cachedSymbology[xb+3]=Math.round(255*mb[3]);ta.cachedSymbology[xb+4]=Ya.colorMixMode|+Ya.castShadows<<cb.CastShadows|+Ya.pickable<<cb.Pickable;xb+=5}}};Ea._getFilteredEdgeMaterials=
function(ta){var Ga=this._getCachedEdgeMaterials(ta);this.nodeCrossfadingEnabled||ua(Ga,this.fullOpacity);const Oa=ta.filteredIds;if(k.isNone(Oa))return{hasEdges:Ga.some(eb=>eb!==xa.transparentEdgeMaterial),perFeatureEdgeMaterials:Ga};let Qa=0,Ya=!1;Ga=Ga.map((eb,gb)=>{if(ta.featureIds[gb]!==Oa[Qa])return xa.transparentEdgeMaterial;Ya=Ya||eb!==xa.transparentEdgeMaterial;Qa++;return eb});return{hasEdges:Ya,perFeatureEdgeMaterials:Ga}};Ea._updateComponentData=function(ta){if(this._hasComponentData){var Ga=
ta.objectHandle;ta=this._getComponentParameters(ta);this._collection.setComponentData(Ga,ta);this._stage.renderView.requestRender()}};Ea._reloadAll=function(ta=this.elevationOffset){this._removeAllNodeDataFromStage(ta);null!=this._controller&&this._controller.restartNodeLoading()};Ea._opacityChange=function(ta){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Ga=>{k.isNone(Ga)||(this._collection.updateMaterial(Ga.objectHandle,Oa=>Oa.objectOpacity=ta),
ua(Ga.cachedEdgeMaterials,ta),this._updateEdgeRendering(Ga))})};Ea._updateMaterial=function(ta){this._collection.updateMaterial(ta.objectHandle,Ga=>{Ga.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Ga.usePBR=this._usePBR;this._updateMaterialOverlay(Ga)})};Ea._updateMaterialOverlay=function(ta){};Ea._updateEngineObject=function(ta){this._updateComponentData(ta);this._applyFiltersToNode(ta);this._addOrUpdateEdgeRendering(ta);this._visibleGeometryChanged(ta,ib.UPDATE)};Ea._slicePlaneEnabledChange=
function(ta){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=ta);k.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=ta);this._nodeId2Meta.forEach(Ga=>{k.isNone(Ga)||(this._collection.updateMaterial(Ga.objectHandle,Oa=>Oa.commonMaterialParameters.hasSlicePlane=ta),this._updateEdgeRendering(Ga,!1))})};Ea._updatePBR=function(ta){this._nodeId2Meta.forEach(Ga=>{k.isNone(Ga)||this._collection.updateMaterial(Ga.objectHandle,Oa=>Oa.usePBR=ta)});this._hasLoadedPBRTextures=!0};
Ea._updateEdgeRendering=function(ta,Ga=!0){k.isSome(this._edgeView)&&this._edgeView.hasObject(ta.objectHandle)&&this._addOrUpdateEdgeRendering(ta,Ga)};Ea._forAllNodes=function(ta){this._nodeId2Meta.forEach(ta)};Ea._forAllFeatures=function(ta,Ga,Oa=Y.ForAllFeaturesVisibilityMode.VISIBLE_ONLY){e.someMap(this._nodeId2Meta,Qa=>{if(k.isNone(Qa))return!1;if(k.isSome(Ga))switch(Ga(Qa)){case Y.ForAllFeaturesReturnType.EXIT:return!0;case Y.ForAllFeaturesReturnType.SKIP:return!1}let Ya=Y.ForAllFeaturesReturnType.CONTINUE;
switch(Oa){case Y.ForAllFeaturesVisibilityMode.ALL:Ya=this._forAllFeaturesOfNode(Qa,ta);break;case Y.ForAllFeaturesVisibilityMode.VISIBLE_ONLY:Ya=this._forVisibleFeaturesOfNode(Qa,ta);break;case Y.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA:Ya=this._forAllFeaturesOfNodeInClippingArea(Qa,ta)}return Ya===Y.ForAllFeaturesReturnType.EXIT})};Ea._forAllFeaturesOfNode=function(ta,Ga){let Oa=Y.ForAllFeaturesReturnType.CONTINUE;const Qa=ta.featureIds;for(let Ya=0;Ya<Qa.length&&(Oa=Ga(Qa[Ya],Ya,ta),Oa!==
Y.ForAllFeaturesReturnType.EXIT);Ya++);return Oa};Ea._forVisibleFeaturesOfNode=function(ta,Ga){let Oa=Y.ForAllFeaturesReturnType.CONTINUE;const Qa=ta.featureIds;this._collection.forEachVisibleComponent(ta.objectHandle,Ya=>{Oa=Ga(Qa[Ya],Ya,ta);return Oa===Y.ForAllFeaturesReturnType.CONTINUE});return Oa};Ea._forAllFeaturesOfNodeInClippingArea=function(ta,Ga){if(k.isNone(this._renderClippingArea))return this._forAllFeaturesOfNode(ta,Ga);var Oa=this._boundingRectNodeTest(ta,this._renderClippingArea);
if(Oa===xa.MbsIntersectResult.OUTSIDE)return Y.ForAllFeaturesReturnType.CONTINUE;if(Oa===xa.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(ta,Ga);Oa=Y.ForAllFeaturesReturnType.CONTINUE;const Qa=ta.featureIds,Ya=xa.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(ta.objectHandle));for(let eb=0;eb<Qa.length;eb++){if(!this._boundingRectFeatureTest(ta,eb,Ya))continue;const gb=Ga(Qa[eb],eb,ta);if(gb===Y.ForAllFeaturesReturnType.EXIT)return gb}return Oa};Ea._createAttributes=
function(ta,Ga){const Oa={};null!=Ga.featureIds&&(Oa[this._getObjectIdField()]=Ga.featureIds[ta]);Ga=k.isSome(Ga.attributeInfo)&&Ga.attributeInfo.attributeData;if(k.isSome(Ga))for(const Qa of Object.keys(Ga))Oa[Qa]=xa.getCachedAttributeValue(Ga[Qa],ta);return Oa};Ea._createGraphic=function(ta,Ga){return this._createLayerGraphic(this._createAttributes(ta,Ga))};Ea.highlight=function(ta){const Ga=this._highlights;"number"===typeof ta?ta=[ta]:ta instanceof x?ta=[ta]:ta instanceof g&&(ta=ta.toArray());
if(Array.isArray(ta)&&0<ta.length){if(ta[0]instanceof x){const Oa=this.i3slayer.fieldsIndex,Qa=this._getObjectIdField();ta=ta.map(gb=>va.attributeLookup(Oa,gb.attributes,Qa));const {set:Ya,handle:eb}=Ga.acquireSet();Ga.setFeatureIds(Ya,ta);return eb}if("number"===typeof ta[0]){const {set:Oa,handle:Qa}=Ga.acquireSet();Ga.setFeatureIds(Oa,ta);return Qa}}return bb};Ea.resetHighlights=function(){k.destroyMaybe(this._highlights);this._highlights=new ea({collection:this._collection,forAllFeatures:ta=>this._forAllFeatures(ta,
null,Y.ForAllFeaturesVisibilityMode.ALL),forAllFeaturesOfNode:(ta,Ga)=>this._forAllFeaturesOfNode(ta,Ga)})};Ea._visibleGeometryChanged=function(ta,Ga){this._elevationProvider&&(this._elevationProvider.objectChanged(ta.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=r.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(ta,Ga))};Ea.getNodeOpacityByIndex=function(ta){ta=
this._nodeId2Meta.get(ta);return this.getNodeOpacity(ta)};Ea.getNodeOpacity=function(ta){return k.isSome(ta)?this._collection.getMaterial(ta.objectHandle).objectOpacity:0};Ea.isNodeFullyFadedIn=function(ta){return this._crossfadeHelper.isNodeFullyFadedIn(ta)};Ea.getNodeCrossfadeMetaData=function(ta){return this._nodeId2Meta.get(ta)};Ea.markNodeToRemove=function(ta){this._controller&&this._controller.markNodeToRemove(ta)};Ea.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};
Ea.foreachCrossfadeNode=function(ta){this._nodeId2Meta.forEach((Ga,Oa)=>ta(Oa,Ga))};Ea.fadeNode=function(ta,Ga,Oa){if(this.nodeCrossfadingEnabled){var Qa=this._nodeId2Meta.get(ta);k.isSome(Qa)&&this._crossfadeHelper.fadeNode(ta,Qa,Ga,Oa)}};Ea.setNodeOpacityByIndex=function(ta,Ga){ta=this._nodeId2Meta.get(ta);k.isSome(ta)&&this._setNodeOpacity(ta,Ga)};Ea._setNodeOpacity=function(ta,Ga){this._collection.updateMaterial(ta.objectHandle,Oa=>Oa.objectOpacity=Ga);this._setNodeEdgeOpacity(ta,Ga)};Ea._setNodeEdgeOpacity=
function(ta,Ga){!k.isNone(this._edgeView)&&ta.cachedEdgeMaterials&&(ua(ta.cachedEdgeMaterials,Ga),ta=ta.objectHandle,this._edgeView.hasObject(ta)&&this._edgeView.updateAllComponentOpacities(ta,Ga).catch(Oa=>la(Oa,this.i3slayer.title)))};Ea.updateNodeModificationStatus=function(ta){var Ga=ta.length;if(this.hasModifications&&!(0>=Ga)&&!0===this._i3sWasmLoaded){Ga=this.uid;var Oa=oa(ta);if(k.isSome(Oa)){aa.filterObbsForModificationsSync({context:Ga,buffer:Oa.buffer});const Qa=new Float64Array(Oa.buffer);
ta.forAll((Ya,eb)=>{eb=aa.interpretObbModificationResults(Qa[eb]);Ya.imModificationImpact=eb;eb!==ma.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(Ya.index)})}}};Ea.notifyUpdate=function(){this.notifyChange("updating")};Ea.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};Ea.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||k.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper?.updating||
this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||k.isSome(this._elevationTask)&&this._elevationTask.running};Ea.trackSnappingSources=function(ta){const Ga={events:ta,fetchEdgeLocations:async(Oa,Qa,Ya)=>{Oa=this._nodeId2Meta.get(Oa);if(k.isNone(Oa))throw Error("invalid-node");const {origin:eb,buffer:gb}=await this._collection.extractEdgeInformation(Oa.objectHandle,Qa,Ya);this._snappingLocationsApplyElevation(Oa,gb,eb);return{type:"components",objectIds:Oa.featureIds,locations:gb,
origin:eb}},remove:()=>{m.removeUnordered(this._snappingSourcesTrackers,Ga)}};this._snappingSourcesTrackers.push(Ga);this._nodeId2Meta.forEach((Oa,Qa)=>{k.isNone(Oa)||(Oa=this._controller.getRenderMbs(Oa.node),k.isSome(Oa)&&ta.add(Qa,Oa))});return Ga};Ea._snappingLocationsApplyElevation=function(ta,Ga,Oa){if(ta.elevationOffsets&&this.elevationInfo.mode!==b.ElevationMode.Absolute){var Qa=Ga.position0,Ya=Ga.position1;Ga=Ga.componentIndex;var eb=H.create(),gb=H.create(),lb=(kb,nb)=>{F.add(kb,kb,Oa);
this.view.renderCoordsHelper.worldUpAtPosition(kb,gb);F.add(kb,kb,F.scale(gb,gb,nb));F.subtract(kb,kb,Oa)};for(let kb=0;kb<Qa.count;kb++){const nb=ta.elevationOffsets[Ga.get(kb)];Qa.getVec(kb,eb);lb(eb,nb);Qa.setVec(kb,eb);Ya.getVec(kb,eb);lb(eb,nb);Ya.setVec(kb,eb)}}};Ea._updateSnappingSources=function(ta,Ga){const {index:Oa}=ta.node;ta=this._controller.getRenderMbs(ta.node);if(!k.isNone(ta))for(const Qa of this._snappingSourcesTrackers)Ga!==ib.REMOVE&&Ga!==ib.UPDATE||Qa.events.remove(Oa),Ga!==ib.ADD&&
Ga!==ib.UPDATE||Qa.events.add(Oa,ta)};c._createClass(Va,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",get:function(){return null}},{key:"updatingProgressValue",
get:function(){return this._controller?.updatingProgress??0}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return xa.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?ba.TextureUsage.AllTexturesPBR:ba.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?ba.TextureUsage.GeometryTexturesPBR:ba.TextureUsage.GeometryTextures}},
{key:"elevationOffset",get:function(){const ta=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=ta&&"absolute-height"===ta.mode){const Ga=y.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Oa=T.getMetersPerUnit(ta.unit);return k.unwrapOr(ta.offset,0)*Oa/Ga}return 0}},{key:"elevationInfo",get:function(){const ta=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==ta)return{mode:b.ElevationMode.Absolute,offset:0};var Ga=y.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);
const Oa=T.getMetersPerUnit(ta.unit);Ga=k.unwrapOr(ta.offset,0)*Oa/Ga;switch(ta.mode){case "absolute-height":return{mode:b.ElevationMode.Absolute,offset:Ga};case "relative-to-ground":return{mode:b.ElevationMode.RelativeToGround,offset:Ga};case "on-the-ground":return{mode:b.ElevationMode.OnTheGround,offset:0};default:return{mode:b.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return fa.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",
get:function(){const ta=0===(this.supportedTextureEncodings&ba.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&ta}},{key:"usedMemory",get:function(){let ta=k.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Ga=>ta+=k.isSome(Ga)?Ga.node.memory:0);this._nodeId2MetaReloading.forEach(Ga=>ta+=k.isSome(Ga)?Ga.node.memory:0);return ta}},{key:"unloadedMemory",get:function(){return(k.isSome(this._controller)?this._controller.unloadedMemoryEstimate:
0)+(k.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"_supportsNodeCrossFading",get:function(){return!this.view?._stage?.renderer.shadowsEnabled}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},
{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"_usePBR",get:function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}},{key:"performanceInfo",get:function(){const ta={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/
1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.unloadedMemory/1048576).toFixed(1)+"MB"};k.isSome(this._memCache)&&(ta.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(ta.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(ta));return ta}},{key:"test",
get:function(){const ta=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Ga=[];ta._forAllFeatures(Oa=>{Ga.push(Oa);return Y.ForAllFeaturesReturnType.CONTINUE},null,Y.ForAllFeaturesVisibilityMode.VISIBLE_ONLY);Ga.sort((Oa,Qa)=>Oa-Qa);return Ga},get numNodes(){return ta._nodeId2Meta.size},get loadedNodes(){return Array.from(ta._nodeId2Meta.keys()).sort((Ga,Oa)=>Ga-Oa)}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&k.isSome(this._layerClippingArea)||
this._modifications&&0<this._modifications.length}}]);return Va}(Fa);w.__decorate([B.property()],Fa.prototype,"_hasLoadedPBRTextures",void 0);w.__decorate([B.property()],Fa.prototype,"_asyncModuleLoading",void 0);w.__decorate([B.property()],Fa.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);w.__decorate([B.property()],Fa.prototype,"view",void 0);w.__decorate([B.property()],Fa.prototype,"i3slayer",void 0);w.__decorate([B.property()],Fa.prototype,"_controller",void 0);w.__decorate([B.property()],
Fa.prototype,"_labeler",void 0);w.__decorate([B.property()],Fa.prototype,"updating",void 0);w.__decorate([B.property()],Fa.prototype,"suspended",void 0);w.__decorate([B.property()],Fa.prototype,"holeFilling",void 0);w.__decorate([B.property(Pa.updatingProgress)],Fa.prototype,"updatingProgress",void 0);w.__decorate([B.property()],Fa.prototype,"updatingProgressValue",null);w.__decorate([B.property()],Fa.prototype,"hasTexturesOrVertexColors",null);w.__decorate([B.property()],Fa.prototype,"rendererTextureUsage",
null);w.__decorate([B.property()],Fa.prototype,"elevationOffset",null);w.__decorate([B.property()],Fa.prototype,"elevationInfo",null);w.__decorate([B.property({type:Boolean})],Fa.prototype,"slicePlaneEnabled",void 0);w.__decorate([B.property()],Fa.prototype,"supportedTextureEncodings",null);w.__decorate([B.property()],Fa.prototype,"uncompressedTextureDownsamplingEnabled",null);w.__decorate([B.property({type:[S]})],Fa.prototype,"_modifications",void 0);w.__decorate([B.property()],Fa.prototype,"_elevationTask",
void 0);w.__decorate([B.property({readOnly:!0})],Fa.prototype,"_usePBR",null);return Fa=w.__decorate([z.subclass("esri.views.3d.layers.I3SMeshView3D")],Fa)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R){function O(Q,W){return m.isSome(Q)&&Q.length===W.length&&Q.every(V=>0<=J(W,V.name))}function J(Q,W){W=W.toLowerCase();for(let V=0;V<Q.length;V++)if(Q[V].name.toLowerCase()===W)return V;return-1}const M=x.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");c=function(Q){function W(T){T=V.call(this,T);T.screenSizeFactor=0;T.featureTarget=5E4;T.fixedFeatureTarget=!1;T.updating=!0;T.updatingProgress=1;T.leavesReached=
!1;T.scaleVisibilityEnabled=!0;T._featureLOD=1;T._stableFeatureLOD=!1;T._isIdle=!1;T._cameraDirty=!0;T._invisibleDirty=!1;T._idleStateCallbacks=null;T._newLoadingNodes=new l({deallocator:null});T._loadedNodeScales=new Map;T._modificationsNodeFilteringArray=new l;T._downloadingCount=0;T._loadingNodes=new Map;T._updatingNodes=new Map;T._progressMaxNumNodes=1;T._requiredAttributes=[];T._requiredAttributesDirty=!0;T._updatesDisabled=!1;T.disableIDBCache=!1;T._disableMemCache=!1;T._restartNodeLoading=
!1;T._fields=null;T._attributeStorageInfo=null;T._handles=new w;T._idleQueue=new y.PromiseQueue;T._elevationUpdateNodes=new l({deallocator:null});T._errorCount=0;return T}a._inherits(W,Q);var V=a._createSuper(W);Q=W.prototype;Q.initialize=function(){const {layerView:T,layer:X}=this;this._disableMemCache=!T.loadCachedGPUData||!T.addCachedGPUData;this._lodHandling=new v(T);this._defaultGeometrySchema=X.store.defaultGeometrySchema;this.disableIDBCache=n("disable-feature:idb-cache");"fields"in X&&(this._fields=
X.fields,this._attributeStorageInfo=X.attributeStorageInfo);this.addResolvingPromise(Promise.all([X.indexInfo,X.when(),T.when()]).then(([Z])=>{if(!this.destroyed&&T&&!T.destroyed&&Z){var {view:Y}=T,{resourceController:aa}=Y;this._setClippingArea(Y.clippingArea);this.addHandles([d.watch(()=>Y?.pointsOfInterest?.focus?.renderLocation,ia=>this._pointOfInterestChanged(ia),d.initial),d.watch(()=>aa.memoryController.memoryFactor,()=>this._setCameraDirty(),d.sync),d.watch(()=>T.suspended,ia=>{const na=ia?
()=>this._updateViewData():()=>this._updateIdleState(!0),ba=ia?()=>{}:()=>this._updateIdleState(!1);!ia&&m.isSome(this._index)&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(ia&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=na,this._idleStateCallbacks.idleEnd=ba):this._idleStateCallbacks=aa.scheduler.registerIdleStateCallbacks(na,ba)},d.initial),D.addCallback(T.view.resourceController.scheduler,this),d.watch(()=>T.uncompressedTextureDownsamplingEnabled,
()=>this.restartNodeLoading()),d.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),d.watch(()=>Y.state?.contentCamera,()=>this._setCameraDirty()),d.watch(()=>X.elevationInfo,ia=>this._elevationInfoChanged(ia)),d.watch(()=>X.effectiveScaleRange,()=>this._scaleBoundsChanged()),d.watch(()=>T.lodFactor,()=>this._setCameraDirty()),d.watch(()=>T.availableFields,()=>this._requiredFieldsChange()),d.watch(()=>T.holeFilling,ia=>m.isSome(this._index)&&
(this._index.holeFilling=ia))]);this._updateScaleHandles();this._viewportQueries=new F(this.crsIndex,Y.renderCoordsHelper,Y.state.contentCamera,!Y.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?Y.basemapTerrain:Y.elevationProvider,B.viewingModeFromString(Y.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._index=new z.I3SIndex(X,Z,this.indexStreamController,
this._viewportQueries,M,T.holeFilling,ia=>T.isNodeLoaded(ia),ia=>T.isNodeReloading(ia),ia=>this._shouldLoadNode(ia),ia=>this._enableFromGPUCache(ia,A.NodeState.Leaf),ia=>this._needsUpdate(ia),()=>!this.indexStreamController.busy,ia=>T.computeVisibilityObb?T.computeVisibilityObb(ia):null,T?.computeNodeFiltering?ia=>T.computeNodeFiltering(ia):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid||this.isGraphics3D);this._index.imModificationsChanged(!!T.hasModifications);
this._startNodeLoading()}}));this._tmpPoint=q.makeDehydratedPoint(0,0,0,this.crsIndex)};Q.updateNodeModificationStatus=function(T){const X=this._index,Z=this.layerView;m.isSome(X)&&Z?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),T.forAll(Y=>{Y=X.getNode(Y);m.isSome(Y)&&this._modificationsNodeFilteringArray.push(Y)}),Z.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};Q.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&
(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;G.prune();m.isSome(P)&&(P.hide(),P=null)};Q._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const T=this._attributeStorageInfo,X=this._fields,Z=this.layer.objectIdField;return this.layerView.availableFields.map(Y=>{const aa=J(T,Y);Y=J(X,Y);return 0<=aa&&0<=Y?{index:aa,name:X[Y].name,field:X[Y],
attributeStorageInfo:T[aa]}:null}).filter(Y=>null!=Y&&Y.name!==Z)};Q._requiredFieldsChange=function(){const T=this._getRequiredAttributes();O(this._requiredAttributes,T)||(this._requiredAttributes=T,this._requiredAttributesDirty=!1,this.restartNodeLoading())};Q.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};Q._setClippingArea=function(T){const X=r.create();K.toBoundingRect(T,X,this.layerView.view.renderSpatialReference)?this._clippingArea=X:this._clippingArea=
null};Q._pointOfInterestChanged=function(T){m.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(T),m.isSome(this._index)&&(this._index.progressiveLoadPenalty=U.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};Q.updateClippingArea=function(T){this._setClippingArea(T);m.isSome(this._viewportQueries)&&m.isSome(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};
Q._setCameraDirty=function(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};Q.updateElevationChanged=function(T,X){const Z=this._index;if(m.isNone(Z)||m.isNone(Z.rootNode)||m.isNone(X))return null;this.crsIndex.equals(X)||(h.projectBoundingRect(T,X,N,this.crsIndex),T=N);const Y=this._elevationUpdateNodes;Y.clear();E.findIntersectingNodes(T,Z.rootNode,Z,aa=>Y.push(aa.index));Y.length&&(Y.forAll(aa=>Z.updateElevationChanged(aa)),this._setCameraDirty());return Y};
Q.removeAllGeometryObbs=function(){m.isSome(this._index)&&this._index.removeAllGeometryObbs()};Q.getRenderMbs=function(T){return m.isSome(this._viewportQueries)?this._viewportQueries.getRenderMbs(T):null};Q._elevationInfoChanged=function(T){m.isNone(this._index)||(this._index.updateElevationInfo(T,this.isMeshPyramid||this.isGraphics3D),this._setCameraDirty())};Q._updateScaleHandles=function(){this._handles.remove("scale-bounds");this._areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",
T=>this._scaleUpdateHandler(T)),"scale-bounds")};Q._scaleBoundsChanged=function(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};Q._scaleUpdateHandler=function(T){this._updateScaleInBoundingRect(T.extent,T.spatialReference);this._setCameraDirty()};Q._updateScaleInBoundingRect=function(T,X){const Z=this._index;m.isNone(Z)||!m.isNone(Z.rootNode)&&h.projectBoundingRect(T,X,N,this.crsIndex)&&this._loadedNodeScales.forEach((Y,aa)=>{Y=Z.getNode(aa);
m.isSome(Y)&&r.intersectsSphere(N,Y.mbs)&&this._loadedNodeScales.set(aa,this._computeScale(Y))})};Q.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};Q.schedule=function(T,X){return this._idleQueue.push(T,X)};Q.reschedule=function(T,X){return this._idleQueue.unshift(T,X)};Q.runTask=function(T,X){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||m.isNone(this._index))return-Infinity;
this._processWithErrorLogging(T,X);return this._index.maxPriority};Q._processWithErrorLogging=function(T,X){try{this._process(T,X)}catch(Z){50>this._errorCount?M.error("Error during processing: "+Z):50===this._errorCount&&M.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};Q._process=function(T,X){this._restartNodeLoading&&this._startNodeLoading();null==this._nodeLoader||m.isNone(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(T)&&
(this._invisibleDirty=!1),this._isIntegratedMesh&&(T.enabled=!1),T.run(()=>this._processIndex(T)),this._updateFeatureLOD(),T.run(()=>this._processCache(T)),this._isIntegratedMesh&&(T.enabled=!0),T.run(()=>this._processNodes(T,X)),this._idleQueue.runTask(T),T.run(()=>this._prefetchIndex()),X.numIndexLoading+=this._index.indexLoading,X.numNodesLoading+=this._downloadingCount,T.run(()=>this._lodHandling.lodGlobalHandling(T)),this._evaluateUpdating())};Q._processIndex=function(T){if(m.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),T,X=>this.updateNodeModificationStatus(X)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),T=this._index.featureEstimate.leavesReached,this._index.isLoading||T===this._get("leavesReached")||this._set("leavesReached",T));return this._index.load()};
Q._prefetchIndex=function(){return m.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};Q._updateFeatureLOD=function(){if(this.useMaximumNumberOfFeatures&&!m.isNone(this._index)&&!m.isNone(this._viewportQueries)){var T=!this._index.isLoading,X=this.featureTarget*this._baseLOD,Z=this._index.featureEstimate;Z.estimate=Z.estimate||X/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=
!1}else if(T&&Z.estimate<X){if(Z.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(X/Z.estimate,1.001));T=this._lod;X=this._index.checkFeatureTarget(X,T);X!==T&&(this._featureLOD=X/this._baseLOD,this._stableFeatureLOD=!0)}else if(Z.estimate>1.2*X||T&&Z.estimate>X){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(Z.estimate/X-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.requestUpdate()}};Q._processCache=function(T){const X=this._index;if(m.isNone(X))return!1;for(;0<this._newLoadingNodes.length&&!T.done;){var Z=this._newLoadingNodes.pop();for(Z=X.getParent(Z);m.isSome(Z)&&!this.layerView.isNodeLoaded(Z.index)&&this._isNodeInScaleBounds(Z);Z=X.getParent(Z.index))if(this._enableFromGPUCache(Z,A.NodeState.Hole)){T.madeProgress();break}}return T.hasProgressed};Q._processNodes=function(T,X){if(m.isNone(this._index))return!1;let Z=(this._isIdle?100:2)-this._loadingNodes.size;
const Y=this._index.updates;Y.cancel.forEach(this._cancelNode,this);for(Y.cancel=[];0<Y.remove.length&&!T.done;)this.layerView.removeNode(Y.remove.pop()),T.madeProgress();for(;0<Y.update.length&&!T.done;){var aa=this._index.getNode(Y.update.pop());m.isSome(aa)&&(this._updateLoadedNode(aa),T.madeProgress())}for(;0<Y.add.length&&!T.done&&0<Z;){--Z;aa=this._index.getNode(Y.add.back());if(m.isNone(aa)||aa.cacheState!==A.CacheState.Cached&&!this._hasNodeLoadToken(X))break;Y.add.pop();this._loadNode(aa);
T.madeProgress()}return T.hasProgressed};Q._cancelAllNodes=function(){this._loadingNodes.forEach(T=>T.abort());this._loadingNodes.clear();this._updatingNodes.forEach(T=>T.abort());this._updatingNodes.clear()};Q._cancelNode=function(T){const X=this._loadingNodes.get(T);X&&(X.abort(),this._loadingNodes.delete(T))};Q._hasNodeLoadToken=function(T){return!this._isIdle&&2<=T.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<I.maxDownloadSlots&&!this.dataStreamController.busy};Q._evaluateUpdating=
function(){var T=!1,X=0;this.layerView&&(this.layerView.suspended?X=(T=this._cameraDirty)?0:1:(T=m.isSome(this._index)?this._index.indexMissing:0,X=m.isSome(this._index)?this._index.updates.add.length:0,X=T+3*X+2*this._loadingNodes.size,T=!!(0<X||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||m.isSome(this._index)&&this._index.isPrefetching),0===X&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=
Math.max(X,this._progressMaxNumNodes),X=1-X/this._progressMaxNumNodes),this.updating=T,this.updatingProgress=X)};Q._updateViewData=function(){if(this._cameraDirty&&!m.isNone(this._index)&&!m.isNone(this._viewportQueries)){var T=this.layerView.view,{contentCamera:X,fixedContentCamera:Z}=T.state;this.screenSizeFactor=1/(X.perScreenPixelRatio/2);this._viewportQueries.updateCamera(X,!Z||this.isGraphics3D);this._viewportQueries.setPointOfInterest(T.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=U.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};Q._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};Q.isGeometryVisible=function(T){return m.isSome(this._index)&&this._index.isGeometryVisible(T.index)};
Q.updateVisibility=function(T){m.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(T)};Q.invalidateGeometryVisibility=function(T){m.isSome(this._index)&&this._index.invalidateGeometryVisibility(T)};Q.invalidateVisibilityObbs=function(){m.isSome(this._index)&&this._index.invalidateVisibilityObbs()};Q.modificationsChanged=function(){m.isSome(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications);this._invisibleDirty=!0};Q._shouldLoadNode=function(T){return!this._lodHandling.shouldLoadNode(T)||
this._shouldDropNode(T)||m.isNone(this._index)||!this._index.isGeometryVisible(T.index)?!1:this._isNodeInScaleBounds(T)};Q._shouldDropNode=function(T){if(m.isNone(this._viewportQueries))return!1;const X=this._lodDropFactor;return 1<=X||!this._lodHandling.hasNoVisibleChildren(T)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(T))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*X};Q._startNodeLoading=function(){this._restartNodeLoading=
!1;const T=this._index;this._updatesDisabled||m.isNone(T)||m.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new t(this.layer,this.dataStreamController,M,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,
textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures}),T.requestUpdate(),this._lodHandling.startNodeLoading(X=>this._isNodeInScaleBounds(X),(X,Z)=>this._removeNodes(X,Z,S.fadeout),T,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};Q.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};Q.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),
this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};Q._removeInvisibleNodes=function(T){const X=this._index;if(m.isNone(X)||m.isNone(this._viewportQueries))return!1;G.clear();this.layerView.getLoadedNodeIndices(G);const Z=0===this._viewportQueries.maxDistance,Y=Z?()=>!1:aa=>this._shouldDropNode(aa);G.filterInPlace(aa=>{const ia=X.getNode(aa);return m.isNone(ia)||!X.isGeometryVisible(aa)||Y(ia)||!this._isNodeInScaleBounds(ia)});0<G.length&&this._lodHandling.setLodGlobalDirty();
this._removeNodes(G,T,S.pop);if(Z&&1>this._lodDropFactor)return!1;if(0===G.length)return!0;G.clear();return!1};Q.markNodeToRemove=function(T){G.push(T)};Q.removeMarkedNodes=function(){this._removeNodes(G,R.noBudget,S.pop)};Q._removeNodes=function(T,X,Z){const Y=T.length;if(0!==Y&&!X.done){for(m.isSome(this._index)&&this._index.requestUpdate();0<T.length&&!X.done;){const aa=T.pop(),ia=this._index;Z===S.fadeout&&this.layerView.nodeFadeoutEnabled&&m.isSome(ia)&&ia.isGeometryVisible(aa)?this.layerView.fadeNode(aa,
H.FadeDirection.FadeOut,!0):this.layerView.removeNode(aa);X.madeProgress()}if(0<this._loadedNodeScales.size)for(X=T.length;X<Y;X++)this._loadedNodeScales.delete(T.data[X])}};Q._needsUpdate=function(T){if(!T.resources.hasFeatureData||this._updatingNodes.has(T.index))return!1;T=this.layerView.getLoadedAttributes(T.index);return null!=T&&T!==this._requiredAttributes};Q._updateLoadedNode=function(T){const X=new AbortController;this._updatingNodes.set(T.index,X);const Z=this.layerView.getLoadedAttributes(T.index);
(O(Z,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(T.index)):this._nodeLoader.loadAttributes(T,this._requiredAttributes,X.signal)).then(Y=>this.schedule(()=>this.layerView.updateAttributes(T.index,{loadedAttributes:this._requiredAttributes,attributeData:Y},X.signal),X.signal)).catch(Y=>{if(!f.isAbortError(Y))return this.layerView.updateAttributes(T.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},X.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(T.index);
this._evaluateUpdating()});this._evaluateUpdating()};Q._loadNode=function(T){if(this._loadingNodes.has(T.index))M.error("already loading node "+T.index);else{var X=new AbortController;this._loadingNodes.set(T.index,X);this._evaluateUpdating();this._loadAndAddNode(T,X.signal).then(Z=>{Z&&m.isSome(this._index)&&this._loadingNodes.get(T.index)===X&&(this._loadingNodes.delete(T.index),this._index.requestUpdate())}).catch(Z=>{if(!f.isAbortError(Z))throw Z;}).finally(()=>{this._loadingNodes.get(T.index)===
X&&this._loadingNodes.delete(T.index);this._evaluateUpdating()})}};Q._loadAndAddNode=function(T,X){return T.cacheState===A.CacheState.Uncached?this._loadUncached(T,X).then(()=>!1):this._loadCached(T,X).then(Z=>{if(Z)return!1;T.cacheState=A.CacheState.Uncached;return!0}).catch(Z=>f.isAbortError(Z)?!1:(T.cacheState=A.CacheState.Uncached,!0))};Q._enableFromGPUCache=function(T,X){if(this._disableMemCache||m.isNone(this._index))return!1;if(X===A.NodeState.Hole&&!this._index.useNodeAsHole(T.index))return!0;
const Z=this._loadCachedGPUData(T);if(!Z)return!1;this.layerView.addCachedGPUData(T,Z,X);this._nodeAdded();return!0};Q._loadCachedGPUData=function(T){T=this.layerView.loadCachedGPUData(T);if(m.isSome(T)&&m.isSome(T.attributeInfo)&&O(T.attributeInfo.loadedAttributes,this._requiredAttributes))return T;this.layerView.deleteCachedGPUData(T);return null};Q._nodeAdded=function(){m.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};Q.updateLoadStatus=
function(T,X){const Z=this._index;m.isSome(Z)&&Z.updateChildrenLoaded(T,X?1:-1)};Q._loadCached=function(T,X){if(this._enableFromGPUCache(T,A.NodeState.Leaf))return Promise.resolve(!0);const Z=this.layerView;return!this.disableIDBCache&&Z.loadCachedNodeData&&Z.addCachedNodeData?this.schedule(()=>Z.loadCachedNodeData(T,X,(Y,aa)=>this._nodeLoader.loadTextures(T,Y,aa)),X).then(Y=>{if(m.isNone(Y))return!1;const aa=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(T,aa,
X),X).then(ia=>this.reschedule(()=>Z.addCachedNodeData(T,Y,{loadedAttributes:aa,attributeData:ia},X),X)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};Q._loadUncached=function(T,X){this._downloadingCount++;return this._nodeLoader.loadNodeData(T,X).catch(Z=>{this._downloadingCount--;throw Z;}).then(Z=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(T,Z,X),X)}).then(()=>{this._nodeAdded();T.cacheState=A.CacheState.Cached}).catch(Z=>{if(!f.isAbortError(Z))throw M.error("#loadNodeData()",
this.layer,`Failed to load node '${T.id}'`,Z),T.failed=!0,m.isSome(this._index)&&this._index.requestUpdate(),Z;})};Q._updateIdleState=function(T){T!==this._isIdle&&(this._isIdle=T,this._evaluateUpdating(),T&&this._index&&m.isSome(this._index)&&this._index.resetFailedNodes())};Q._getScale=function(T){if(this._loadedNodeScales.has(T.index))return this._loadedNodeScales.get(T.index);const X=this._computeScale(T);this.layerView.isNodeLoaded(T.index)&&this._loadedNodeScales.set(T.index,X);return X};Q._computeScale=
function(T){this._tmpPoint.x=T.mbs[0];this._tmpPoint.y=T.mbs[1];this._tmpPoint.z=T.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,T.mbs[3])};Q._isNodeInScaleBounds=function(T){if(!this._areScaleBoundsActive)return!0;T=this._getScale(T);const {minScale:X,maxScale:Z}=L.extractSafeScaleBounds(this.layer);return L.scaleBoundsPredicate(T,X,Z)};Q.updateStats=function(T){T.index=m.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(T.detail=this._featureLOD,T.target=
this.featureTarget*this._baseLOD);m.isSome(this._index)&&this._index.updateStats(T)};Q.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();m.isSome(this._index)&&this._index.requestUpdate()};Q.geometryFilterChanged=function(T){const X=this._index;m.isSome(X)&&X.layerFilterChanged(T);this._setCameraDirty()};a._createClass(W,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}},{key:"isGraphics3D",
get:function(){return"points"===this.layer.profile}},{key:"useMaximumNumberOfFeatures",get:function(){return!this.isMeshPyramid&&(m.isNone(this.layer.priority)||"High"===this.layer.priority)}},{key:"indexStreamController",get:function(){const T=this.layerView.view.resourceController.createStreamDataRequester(I.ClientType.I3S_INDEX);return new C.I3SStreamDataController(T,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const T=this.layerView.view.resourceController.createStreamDataRequester(I.ClientType.I3S_DATA);
return new C.I3SStreamDataController(T,this.layer.apiKey)}},{key:"crsVertex",get:function(){return E.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return E.getIndexCrs(this.layer)}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"running",get:function(){return this.updating}},{key:"rootNodeVisible",get:function(){if(m.isSome(this._index)){const T=this._index.rootNode;if(m.isSome(T))return this._updateViewData(),this._index.isNodeVisible(T.index)}return!0}},{key:"index",
get:function(){return this._index}},{key:"_isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},{key:"_areScaleBoundsActive",get:function(){const {minScale:T,maxScale:X}=L.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<T||0<X)}},{key:"unloadedMemoryEstimate",get:function(){return m.isNone(this._index)||this.layerView.suspended?0:this._index.unloadedMemoryEstimate*this._lodDropFactor}},{key:"indexDepth",get:function(){return m.isSome(this._index)?
this._index.maxLevel:0}},{key:"disableMemCache",set:function(T){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=T}},{key:"_lod",get:function(){return this._featureLOD*this._baseLOD}},{key:"_baseLOD",get:function(){const T=this.layerView.lodFactor,X=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<T?T:1)*X}},{key:"_lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;
const T=this.layerView.view.resourceController.memoryController;return(Math.min(T.memoryFactor,.5)-T.minQuality)/(.5-T.minQuality)}},{key:"test",get:function(){const T=this;return{index:this._index,set disableUpdates(X){(T._updatesDisabled=X)?T.cancelNodeLoading():T.requestUpdate()},set disableIDBCache(X){T.disableIDBCache=X},set ignoreServiceObb(X){m.isSome(T._index)&&(T._index.ignoreServiceObb=X)},shouldLoadNode:X=>T._shouldLoadNode(X)}}}]);return W}(g.EsriPromiseMixin(c));b.__decorate([e.property({readOnly:!0})],
c.prototype,"isMeshPyramid",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"isGraphics3D",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"useMaximumNumberOfFeatures",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"indexStreamController",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"dataStreamController",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"crsVertex",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"crsIndex",null);
b.__decorate([e.property()],c.prototype,"screenSizeFactor",void 0);b.__decorate([e.property()],c.prototype,"featureTarget",void 0);b.__decorate([e.property()],c.prototype,"fixedFeatureTarget",void 0);b.__decorate([e.property()],c.prototype,"layerView",void 0);b.__decorate([e.property()],c.prototype,"layer",null);b.__decorate([e.property()],c.prototype,"updating",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"running",null);b.__decorate([e.property()],c.prototype,"updatingProgress",
void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"leavesReached",void 0);b.__decorate([e.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([e.property({readOnly:!0,dependsOn:[]})],c.prototype,"rootNodeVisible",null);c=b.__decorate([p.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c);const G=new l({deallocator:null});let P;const U={factorIM:.2,factor3dObject:.05,distancePenalty:10},N=r.create();var S;(function(Q){Q[Q.pop=0]="pop";
Q[Q.fadeout=1]="fadeout"})(S||(S={}));return c})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),function(a,b,c,w,n,x,m,l,g,f){let d=function(u){function p(){var r=
h.call(this);r.referenceCount=0;r.callbacks=[];r.runIndex=0;return r}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.runTask=function(r){this._sort();const q=this.callbacks,y={numIndexLoading:0,numNodesLoading:0};for(let B=0;B<q.length&&!r.done;++B)q[B].priority=q[B].runTask(r,y),this.runIndex=B};u._sort=function(){const r=this.callbacks;let q=r.length;for(let y=this.runIndex;0<y;y--){const B=r[y-1];let D=y;for(;D<r.length&&B.priority<=r[D].priority&&(D!==q||B.priority<r[D].priority);)r[D-
1]=r[D],D++;r[D-1]=B;q=D-1}this.runIndex=0};u.add=function(r){this._sort();r.priority=Infinity;this.callbacks.unshift(r);this.notifyChange("running")};u.remove=function(r){n.removeUnordered(this.callbacks,r);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")};b._createClass(p,[{key:"running",get:function(){return this.callbacks.some(r=>r.running)}}]);return p}(w);c.__decorate([x.property({readOnly:!0})],d.prototype,"running",null);d=c.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],
d);let e=b._createClass(function(u,p){this.task=u;this.handle=p});const k=new Map;a.addCallback=function(u,p){let h=k.get(u);if(null==h){const r=new d,q=u.registerTask(f.TaskPriority.I3S_CONTROLLER,r);h=new e(r,q);k.set(u,h)}h.task.add(p);return{remove:()=>{null!=h&&(h.task.remove(p),0<h.task.callbacks.length||(k.delete(u),h.handle.remove(),h.task.destroy()),h=null)}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/sphere ../../../../support/featureFlags ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){function e(A){c.isSome(A.node)&&(f.invalidateMbs(A.node.renderMbs),f.invalidateObb(A.node.serviceObbInRenderSR));c.isSome(A.ref)&&(f.invalidateMbs(A.ref.renderMbs),f.invalidateObb(A.ref.serviceObbInRenderSR))}function k(A,t){return 0>A?-1:0===t?0:A/t|0}function u(A=[],t=[],C=[]){return{nodes:A,children:t,parents:C}}function p(A,t){return 0>A?-A-1:0===t?A:A%t}function h(A){if(A)for(let t=0;t<A.length;t++)for(const C of z)if(C[0]===A[t].metricType)return{lodMetric:C[1],
maxError:A[t].maxError};return{lodMetric:g.LodMetric.None,maxError:0}}function r(A){return Math.sqrt(4/Math.PI*A)}let q=b._createClass(function(A,t,C,E,F){this.childOffset=A;this.childCount=t;this.visibilityCache=C;this.ref=E;this.node=F;this.useAsHole=0;this.filterImpact=g.NodeFilterImpact.NotChecked}),y=function(){function A(C,E,F,H,K,I,L,R,O,J,M,G,P,U){this._layer=C;this._streamDataController=F;this._viewportQueries=H;this._logger=K;this.holeFilling=I;this._isLoaded=L;this._isReloading=R;this._isSelected=
O;this._enable=J;this._needsUpdate=M;this._canRequest=G;this._computeVisibilityObb=P;this._computeNodeFiltering=U;this._dirty=!0;this._nodePages=[];this._clientNodePage=null;this._rootIndex=this._nodesPerPage=this._nodeCount=0;this._lodMetric=g.LodMetric.None;this._lodConversion=N=>N;this._isEditable=!1;this._urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;
this._nodeTraversalState=new Map;this._version=f.addWraparound(0,2);this._visibilityCacheVersion=f.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new w({deallocator:null});this._prefetch=new w({deallocator:null});this._updates=new D(this._missing);this._imModificationUncategorized=new w({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._layerHasFilter=this.layerHasModifications=
this.needNodeElevationRange=!1;this._isEditable=l.i3sPatchingEnabled()&&c.isSome(C.associatedLayer)&&c.isSome(C.associatedLayer.infoFor3D);C.serviceUpdateTimeStamp&&C.serviceUpdateTimeStamp.lastUpdate&&(this._lastUpdate=`${C.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:1;this._init(E)}var t=A.prototype;t._init=function(C){if("page"===C.type){var E=C.rootPage;this._urlPrefix=C.urlPrefix;this._nodesPerPage=C.pageSize;switch(C.lodMetric){case "maxScreenThreshold":this._lodMetric=
g.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=g.LodMetric.MaxScreenThreshold,this._lodConversion=r}if(this._isEditable){this._rootIndex=-1;var F=p(C.rootIndex,C.pageSize);F=E.nodes[F];F={nodes:[{index:this._rootIndex,children:[C.rootIndex],mesh:void 0,obb:F.obb,lodThreshold:F.lodThreshold}]};this._addPage(k(this._rootIndex,this._nodesPerPage),F)}else this._rootIndex=C.rootIndex;this._addPage(k(C.rootIndex,this._nodesPerPage),E);this._updateParentsAndLevel()}else"node"===
C.type&&(this._urlPrefix=C.urlPrefix,this._nodePages.push(u()),this._isEditable?(this._clientNodePage=u(),E={id:"-1",version:null,mbs:C.rootNode.mbs,obb:C.rootNode.obb,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:[{id:"root",href:"../root",mbs:C.rootNode.mbs,obb:C.rootNode.obb}]},this._rootIndex=this._makeClientRefNode(new g.NodeBase(E.id,null),null),(E=this._validateNode(E.id,E))&&this._addNode(E,-1)):this._rootIndex=this._makeRefNode(new g.NodeBase(C.rootNode.id,
null),-1),(C=this._validateNode(C.rootNode.id,C.rootNode))&&this._addNode(C,0))};t._loadPage=function(C){this._loading.add(C);this._streamDataController.request(this._urlPrefix+C,"json").then(E=>{this._pageQueue.push({pageIndex:C,page:E})}).catch(E=>{this._loading.delete(C);n.isAbortError(E)||(this._failedPages.add(C),this._logger.error("#loadPage()",this._layer,`Error when loading page ${C}`,E))})};t._addQueuedPages=function(C){for(;0<this._pageQueue.length&&!C.done;){const {pageIndex:E,page:F}=
this._pageQueue.shift();this._addPage(E,F);this._loading.delete(E);C.madeProgress()}this._updateParentsAndLevel()};t._addPage=function(C,E){const F=[],H=[];E=E.nodes.map((K,I)=>{const L=F.length,R=K.children?K.children.length:0;H.push(this._rootIndex);for(var O=0;O<R;O++)F.push(K.children[O]);const J=`${K.index}`;O=d.clone(K.obb);const M=m.fromValues(O.center[0],O.center[1],O.center[2],x.length(O.halfSize));var G=K.mesh&&K.mesh.attribute;const P=K.mesh&&K.mesh.geometry;var U=K.mesh&&K.mesh.material;
G={hasSharedResource:!1,hasFeatureData:!!P,attributes:G&&null!=G.resource?`${G.resource}`:void 0,geometry:P&&null!=P.resource?`${P.resource}`:void 0,texture:U&&null!=U.resource?`${U.resource}`:void 0,geometryDefinition:P?P.definition:-1,materialDefinition:U?U.definition:-1};U=g.Node;var N=this._nodesPerPage;I=-1===C?-(I+1):0===N?I:C*N+I;K=new U(J,I,M,R,0,G,this._lastUpdate,this._lodMetric,this._lodConversion(K.lodThreshold),P?P.featureCount:null);K.serviceObb=O;K.visibilityObb=this._computeVisibilityObb(K);
K.vertexCount=P?P.vertexCount:0;return new q(L,R,f.addWraparound(this._visibilityCacheVersion,-2),null,K)});if(-1===C)this._clientNodePage=u(E,F,H);else{for(let K=this._nodePages.length;K<C;K++)this._nodePages[K]=null;this._nodePages[C]=u(E,F,H)}this._nodeCount+=E.length};t._updateParentsAndLevel=function(){const C=[],E=(F,H,K)=>{const I=this._getPage(F);if(c.isSome(I)){const L=p(F,this._nodesPerPage);I.parents[L]=c.isSome(H)?H:-1;H=I.nodes[L].node;c.isSome(H)&&(H.level=K,C.push(F))}};for(E(this._rootIndex,
null,0);C.length;){const F=C.pop(),H=this.getNode(F);if(c.isSome(H))for(let K=0;K<H.childCount;K++){const I=this.getChildIndex(H.index,K);E(I,F,H.level+1);this._maxLevel=Math.max(this._maxLevel,H.level+1)}}};t._getPage=function(C){C=k(C,this._nodesPerPage);return 0>C?this._clientNodePage:this._nodePages[C]};t._getNodeInternal=function(C){const E=this._getPage(C);return c.isNone(E)?null:E.nodes[p(C,this._nodesPerPage)]};t._addNode=function(C,E){null!=C.children&&this.populateChildren(E,C.children);
var F=this.getParent(E);F=c.isSome(F)?F.level+1:0;this._maxLevel=Math.max(this._maxLevel,C.children?F+1:F);const {lodMetric:H,maxError:K}=h(C.lodSelection),I=c.unwrap(this._getNodeInternal(E));I.node=new g.Node(C.id,E,C.mbs,I.childCount,F,C.resources,C.version,H,K,C.numFeatures);C.obb&&(I.node.serviceObb=d.clone(C.obb));I.node.visibilityObb=this._computeVisibilityObb(I.node);c.isSome(I.ref)&&(null==I.ref.mbs&&(I.ref.mbs=C.mbs),I.node.renderMbs=I.ref.renderMbs,I.node.serviceObbInRenderSR=I.ref.serviceObbInRenderSR,
I.ref.visibilityObb=I.node.visibilityObb);return I.node};t._makeRefNode=function(C,E){const F=this._nodePages[0];if(null==F)return-1;const H=F.nodes.length;F.nodes.push(new q(0,0,f.addWraparound(this._visibilityCacheVersion,-2),C,null));this._nodeCount++;F.parents.push(E);f.invalidateMbs(C.renderMbs);f.invalidateObb(C.serviceObbInRenderSR);return H};t._makeClientRefNode=function(C,E){const F=this._clientNodePage;if(null==F)return-1;const H=-(F.nodes.length+1);F.nodes.push(new q(0,0,f.addWraparound(this._visibilityCacheVersion,
-2),C,null));this._nodeCount++;F.parents.push(c.isSome(E)?E:-1);f.invalidateMbs(C.renderMbs);f.invalidateObb(C.serviceObbInRenderSR);return H};t.populateChildren=function(C,E){var F=c.unwrap(this._getNodeInternal(C));const H=c.unwrap(this._getPage(C));F.childOffset=H.children.length;F.childCount=E.length;for(F=0;F<E.length;F++){const K=this._makeRefNode(E[F],C);H.children.push(K)}};t.getNode=function(C){C=this._getNodeInternal(C);return c.isSome(C)?C.node:null};t.getIndexById=function(C){let E;this._forAllNodes((F,
H)=>{c.isSome(F.node)&&F.node.id===C?E=H:c.isSome(F.ref)&&F.ref.id===C&&(E=H)});return E};t.getNodeById=function(C){C=this.getIndexById(C);return null!=C&&0<=C?this.getNode(C):null};t.getChildIndex=function(C,E){const F=this._getPage(C);if(c.isNone(F))return-1;C=F.nodes[p(C,this._nodesPerPage)];return F.children[C.childOffset+E]};t.getParentIndex=function(C){const E=this._getPage(C);return c.isSome(E)&&C!==this._rootIndex?E.parents[p(C,this._nodesPerPage)]:null};t.getParent=function(C){C=this.getParentIndex(C);
return c.isSome(C)?this.getNode(C):null};t.isLeaf=function(C){C=this._getNodeInternal(C);return c.isSome(C)&&0===C.childCount};t.removeAllGeometryObbs=function(){this._forAllNodes(C=>{c.isSome(C.node)&&(C.node.geometryObb=null)})};t.invalidateVisibilityCache=function(){this._visibilityCacheVersion=f.addWraparound(this._visibilityCacheVersion,2)};t.invalidateNodeVisibilityCache=function(C){C=this._getNodeInternal(C);c.isSome(C)&&this.invalidateNodeVisibilityCacheInternal(C)};t.invalidateNodeVisibilityCacheInternal=
function(C){C.visibilityCache=f.addWraparound(this._visibilityCacheVersion,-2)};t.invalidateBoundingVolumeCache=function(C){C=this._getNodeInternal(C);c.isSome(C)&&(e(C),this.invalidateNodeVisibilityCacheInternal(C))};t.updateElevationChanged=function(C){const E=this._getNodeInternal(C);c.isNone(E)||(this.needNodeElevationRange?(C=c.isSome(E.node)?E.node:E.ref,c.isNone(C)||(C=C.elevationRange,c.isNone(C)||(C.valid=!1))):this.invalidateBoundingVolumeCache(C))};t.invalidateGeometryVisibility=function(C){C=
this._getNodeInternal(C);c.isSome(C)&&c.isSome(C.node)&&(C.node.geometryObb=null,f.invalidateMbs(C.node.renderMbs),f.invalidateObb(C.node.serviceObbInRenderSR))};t.invalidateVisibilityObbs=function(){c.isNone(this.rootNode)||this.traverse(this.rootNode,C=>{C.visibilityObb=this._computeVisibilityObb(C);C.geometryObb=null;return!0})};t._updateElevationRange=function(C){var E=this._getNodeInternal(C);if(c.isNone(E))return null;const F=c.isSome(E.node)?E.node:E.ref;if(c.isNone(F))return null;const H=
F.elevationRange;if(c.isSome(H)&&H.valid)return H;const K=new g.ElevationRange;let I=!1;for(let L=0;L<E.childCount;L++){const R=this._updateElevationRange(this.getChildIndex(C,L));c.isNone(R)?I=!0:(K.min=Math.min(K.min,R.min),K.max=Math.max(K.max,R.max))}if(0===E.childCount||I&&c.isSome(E.node)&&E.node.resources.geometry)E=this._viewportQueries.getElevationRange(F),c.isSome(E)&&(K.min=Math.min(K.min,E.min),K.max=Math.max(K.max,E.max));if(c.isSome(H)&&H.min===K.min&&H.max===K.max)return H.valid=!0,
H;K.valid=!0;F.elevationRange=K;this.invalidateBoundingVolumeCache(C);return K};t.isNodeVisible=function(C){const E=this._getNodeInternal(C);if(c.isNone(E)||c.isSome(E.ref)&&!E.ref.mbs)return!0;this.needNodeElevationRange&&this._updateElevationRange(C);if((E.visibilityCache&-2)!==this._visibilityCacheVersion){C=E.node;const H=c.isSome(C)&&(c.isNone(E.ref)||c.isSome(C.visibilityObb))?C:c.isSome(E.ref)?E.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(c.isSome(C)||c.isSome(E.ref))&&E.filterImpact===
g.NodeFilterImpact.NotChecked){var F=c.isSome(C)?C.mbs:c.isSome(E.ref)?E.ref.mbs:null;E.filterImpact=null!=F?this._computeNodeFiltering(F):g.NodeFilterImpact.Unmodified}F=c.isSome(C)&&E.filterImpact===g.NodeFilterImpact.Culled;C=!(c.isSome(C)&&C.imModificationImpact===g.NodeIMModificationImpact.Culled)&&(!H||this._viewportQueries.isNodeVisible(H))&&!F;E.visibilityCache=this._visibilityCacheVersion+(C?1:0);return C}return 1===(E.visibilityCache&1)};t.isGeometryVisible=function(C){if(!this.isNodeVisible(C))return!1;
C=this._getNodeInternal(C);return c.isSome(C)&&c.isSome(C.node)&&c.isSome(C.node.geometryObb)&&(!this.layerHasModifications||C.node.imModificationImpact!==g.NodeIMModificationImpact.NotChecked)?this._viewportQueries.isGeometryVisible(C.node):!0};t._traverseCoverage=function(C,E,F,H,K){C=this._getPage(C);if(!c.isNone(C)&&0!==E.childCount){var I=E.childOffset+E.childCount,L=[];for(E=E.childOffset;E<I;++E){const R=C.children[E],O=this._getNodeInternal(R);c.isSome(O)&&c.isSome(O.node)&&this.isGeometryVisible(R)&&
L.push(O)}H/=L.length;for(const R of L)C=c.unwrap(R.node).index,this._isLoaded(C)||this._isReloading(C)?(K.delta=Math.max(K.delta,F),K.coverage+=H):this._traverseCoverage(C,R,F+1,H,K)}};t.useNodeAsHole=function(C){if("off"===this.holeFilling)return!1;const E=this._getNodeInternal(C);if(c.isNone(E))return!1;if("always"===this.holeFilling)return!0;if((E.useAsHole&-2)===this._version)return 1===(E.useAsHole&1);const F={delta:0,coverage:0};this._traverseCoverage(C,E,0,1,F);C=.5>=F.delta*F.coverage;E.useAsHole=
this._version+(C?1:0);return C};t.destroy=function(){this._updates.add.prune();this._updates.update.prune()};t.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=f.addWraparound(this._version,2)};t.imModificationsChanged=function(C){this.layerHasModifications=C;this._forAllNodes(({node:E})=>{c.isSome(E)&&(E.imModificationImpact=g.NodeIMModificationImpact.NotChecked,E.visibilityObb=this._computeVisibilityObb(E),E.hasModifications&&this.invalidateGeometryVisibility(E.index))});
this.invalidateVisibilityCache()};t.layerFilterChanged=function(C){this._layerHasFilter=C;this._forAllNodes(E=>{c.isSome(E)&&(E.filterImpact=g.NodeFilterImpact.NotChecked,E=E.node,c.isSome(E)&&this.invalidateNodeVisibilityCache(E.index))});this.invalidateVisibilityCache()};t.update=function(C,E,F){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(E);this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(C);
B.clear();var H=!0,K=new v,I=new v,L=this._imModificationUncategorized;L.clear();var R=new Set;this.traverseVisible((J,M,G)=>{if(c.isNone(M))M=this._entryPriority(J),Infinity===M&&(M=this._entryPriority(G)),J=k(J,this._nodesPerPage),B.set(J,Math.max(M,B.get(J)||0)),this._loading.has(J)||this._failedPages.has(J)||this._missing.push(J),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,M);else{var P=M.node;this._updateNodeFeatureEstimate(P,I);if(c.isNone(P))M=this._entryPriority(J),this._loading.has(J)||
this._failedNodes.has(J)||(this._missing.push(J),B.set(J,M)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,M);else{G=c.unwrap(this._getPage(J));if(0===this._missing.length&&0===this._nodesPerPage)for(let U=0;U<M.childCount;U++){const N=G.children[M.childOffset+U],S=this._getNodeInternal(N);!c.isSome(S)||S.node||this._loading.has(N)||this._failedNodes.has(N)||(B.set(N,this._entryPriority(N)),this._prefetch.push(N))}P.failed||!P.resources.hasFeatureData?H&&0<M.childCount&&this._isSelected(P)&&
(H=!1):(R.add(P.id),this._isLoaded(J)?(K.known+=P.memory,++K.knownNodes,this._isSelected(P)?0<M.childCount&&(H=!1):(K.unremoved+=P.memory,H=!1),this._needsUpdate(P)&&(M=this._entryPriority(J),B.set(J,M),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,M),this._updates.update.push(J))):(P.memory&&(K.known+=P.memory,++K.knownNodes),this._isSelected(P)?(0<M.childCount&&(H=!1),P.memory?(K.missing+=P.memory,K.known+=P.memory,++K.knownNodes):++K.missingNodes,C.includes(P.index)?(this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,this._entryPriority(J)),this._updates.cancel=this._updates.cancel.filter(U=>U!==P.index)):!E.done&&this._enable(P)?E.madeProgress():(M=this._entryPriority(J),B.set(J,M),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,M),this._updates.add.push(J),this.layerHasModifications&&F&&c.isSome(P)&&P.imModificationImpact===g.NodeIMModificationImpact.NotChecked&&L.push(J))):this._isReloading(J)&&this._updates.remove.push(J)))}}});var O=this._updates.add;0<O.length&&
this.layerHasModifications&&(0<L.length&&F?.(L),O.filterInPlace(J=>{var M=this._getNodeInternal(J);(M=c.isNone(M)||c.isNone(M.node)||M.node.imModificationImpact!==g.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(J);return M}));this._unloadedMemoryEstimate=K.missing-K.unremoved;3<K.knownNodes&&0<K.missingNodes&&(this._unloadedMemoryEstimate+=K.known/K.knownNodes*K.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=
this._computeFeatureEstimate(I);this._featureEstimate.leavesReached=H;this._missing.sort((J,M)=>J-M);this._missing.filterInPlace((J,M)=>1>M||this._missing.data[M-1]!==J);this._missing.sort((J,M)=>B.get(J)-B.get(M));0<this._missing.length&&(this._maxUnloadedPrio=B.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(J=>B.get(J)>=this._maxUnloadedPrio).sort((J,M)=>B.get(J)-B.get(M));this._updates.update.sort((J,M)=>B.get(J)-B.get(M));this._indexMissing=this._loading.size+
this._missing.length;this._dirty=0<this._indexMissing;B.clear()}};t.checkFeatureTarget=function(C,E){const F=this._viewportQueries.updateScreenSpaceErrorBias(E);let H=E,K=E,I=F,L=10;for(;L--;){const R=new v;this._updateFeatureEstimate(H,R);if(this._computeFeatureEstimate(R)<=C){if(H>=E||0<R.missingNodes||0===L)break;I=H;H=.5*(H+K)}else K=H,H=.5*(H+I)}this._version=f.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(F);return Math.min(E,H)};t._updateFeatureEstimate=function(C,
E){this._version=f.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(C);this.traverseVisible((F,H)=>this._updateNodeFeatureEstimate(c.isSome(H)?H.node:void 0,E))};t._updateNodeFeatureEstimate=function(C,E){c.isNone(C)||C.failed||c.isNone(C.numFeatures)||(this._isLoaded(C.index)?(E.known+=C.numFeatures,++E.knownNodes,this._isSelected(C)||(E.unremoved+=C.numFeatures)):this._isSelected(C)&&(c.isSome(C.numFeatures)?(E.missing+=C.numFeatures,E.known+=C.numFeatures,++E.knownNodes):
++E.missingNodes))};t._computeFeatureEstimate=function(C){let E=C.known-C.unremoved;3<C.knownNodes&&0<C.missingNodes&&(E+=C.known/C.knownNodes*C.missingNodes);return Math.max(0,E)};t.load=function(){return this._load(this._missing)};t.prefetch=function(){this._prefetch.sort((C,E)=>B.get(C)-B.get(E));return this._load(this._prefetch)};t._load=function(C){if(0===C.length||!this._canRequest())return!1;for(;0<C.length&&this._canRequest();)0===this._nodesPerPage?this._loadNode(C.pop()):this._loadPage(C.pop());
return!0};t.nodeTraversalState=function(C){if(c.isNone(C))return null;let E=this._nodeTraversalState.get(C.index);if(E&&(E.version&-2)===this._version)return E;const F=this._viewportQueries.getLodLevel(C),H=this._viewportQueries.hasLOD(C);var K=!0;H?(K=this.getParentIndex(C.index),c.isSome(K)?(K=this._nodeTraversalState.get(K),K=!!K&&F>K.lodLevel):K=0<F):K=0===C.childCount;if(E)return E.lodLevel=F,E.isChosen=K,E.version=this._version+1,E;E=new g.NodeTraversalState(H,K,F,this._version+1);this._nodeTraversalState.set(C.index,
E);return E};t._loadNode=function(C){this._loading.add(C);const E=c.unwrap(this._getNodeInternal(C)).ref;if(c.isNone(E))this._failedNodes.add(C);else{var F=E.id,H=this._urlPrefix+F,K=()=>{this._loading.delete(C);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this._streamDataController.request(H,"json").then(I=>{K();I=this._validateNode(F,I);null!=I&&(I.obb&&this.invalidateNodeVisibilityCache(C),I=this._addNode(I,C),this.nodeTraversalState(I))},I=>{K();n.isAbortError(I)||(this._logger.error("#loadNode()",
this._layer,"Error loading node: "+H),this._failedNodes.add(C))})}};t._validateNode=function(C,E){if(null==E||"object"!==typeof E||E.id!==C)return this._logger.error("#validateNode()",this._layer,`Invalid node. Wrong type or wrong id "${C}"`),null;if(!Array.isArray(E.mbs))return this._logger.error("#validateNode()",this._layer,`Invalid bounding volume on node ${C}.`),null;E.sharedResource&&"./shared"!==E.sharedResource.href&&"./shared/"!==E.sharedResource.href&&this._logger.warn("#validateNode()",
this._layer,`Invalid shared resource href on node "${C}"`);var F=E.geometryData;null==F||Array.isArray(F)&&0===F.length||Array.isArray(F)&&1===F.length&&"./geometries/0"===F[0].href||this._logger.warn("#validateNode()",this._layer,`Invalid geometry data on node "${C}"`);F=E.attributeData;const H=this._layer.attributeStorageInfo;null==F||Array.isArray(F)&&!F.some((L,R)=>L.href!==`./attributes/${H?.[R]?.key??`f_${R}`}/0`)||this._logger.warn("#validateNode()",this._layer,`Invalid attribute data on node "${C}"`);
E.featureData&&1<E.featureData.length&&this._logger.warn("#validateNode()",this._layer,`Node ${C} has ${E.featureData.length} bundles. Only the first bundle will be loaded.`);F=E.hasOwnProperty("obb")&&!this.ignoreServiceObb?E.obb:null;const K=E.featureData&&1===E.featureData.length&&E.featureData[0].featureRange?E.featureData[0].featureRange[1]-E.featureData[0].featureRange[0]+1:void 0;var I=L=>{if(null==L)return null;var R=O=>this._logger.error("#validateNode()",this._layer,`Invalid node reference on node ${C}: ${O}`);
if("number"===typeof L.id)R(`id ${L.id} is a number instead of a string.`);else if("string"!==typeof L.id||!Array.isArray(L.mbs))return R("Missing or invalid id."),null;if(!Array.isArray(L.mbs))return R(`Invalid bounding volume on reference ${L.id}.`),null;L.href&&L.href!=="../"+L.id&&this._logger.error("#validateNode()",this._layer,`Invalid node href on node "${C}"`);R=L.hasOwnProperty("obb")&&!this.ignoreServiceObb?L.obb:null;L=new g.NodeBase(`${L.id}`,L.mbs);L.serviceObb=R;L.visibilityObb=this._computeVisibilityObb(L);
return L};I=Array.isArray(E.children)?E.children.map(I).filter(L=>null!=L):null;return{id:C,mbs:E.mbs,obb:F,children:I,resources:{hasFeatureData:E.featureData&&0<E.featureData.length,hasSharedResource:null!=E.sharedResource,attributes:E.attributeData?C:void 0,texture:E.textureData&&0<E.textureData.length?C:void 0,geometry:null!=E.geometryData?C:void 0},version:"string"===typeof E.version?E.version:null,lodSelection:Array.isArray(E.lodSelection)?E.lodSelection:null,numFeatures:K}};t.resetFailedNodes=
function(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(C=>{c.isSome(C.node)&&(C.node.failed=!1)})};t._entryPriority=function(C){var E=this._getNodeInternal(C),F=this.getParentIndex(C);if(c.isNone(E)||c.isNone(F)&&null==E.node)return c.isNone(F)?Infinity:this._entryPriority(F);let H=0;E.node&&c.isSome(F)&&(F=this._nodeTraversalState.get(F),null!=F&&(H=F.lodLevel));for(F=this.progressiveLoadPenalty;c.isSome(C);C=this.getParentIndex(C))if(this._isLoaded(C)){F=0;break}E=c.isSome(E.ref)?
this._viewportQueries.distToPOI(E.ref):c.isSome(E.node)?this._viewportQueries.distToPOI(E.node):0;return-E-H*(E+this.progressiveLoadPenalty)+F};t.traverseVisible=function(C){const E=this._getNodeInternal(this._rootIndex);c.isNone(E)?C(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,null,E,C)};t._traverseVisible=function(C,E,F,H){if(F.node&&0===F.childCount)this.isGeometryVisible(C)&&H(C,F,E);else if(this.isNodeVisible(C)&&(H(C,F,E),null!=F.node&&(E=this.nodeTraversalState(F.node),
!E?.nodeHasLOD||E.lodLevel!==this._maxLodLevel))){E=c.unwrap(this._getPage(C));for(let K=0;K<F.childCount;K++){const I=E.children[F.childOffset+K],L=this._getNodeInternal(I);c.isSome(L)?this._traverseVisible(I,C,L,H):H(I,null,C)}}};t.traverse=function(C,E){E(C)&&this.traverseChildren(C,E)};t.traverseChildren=function(C,E){C=C.index;const F=this._getNodeInternal(C);c.isSome(F)&&this._traverseChildren(C,F,E)};t._traverseChildren=function(C,E,F){C=this._getPage(C);if(!c.isNone(C)){var H=E.childOffset+
E.childCount;for(E=E.childOffset;E<H;++E){const K=C.children[E],I=this._getNodeInternal(K);c.isSome(I)&&c.isSome(I.node)&&F(I.node)&&this._traverseChildren(K,I,F)}}};t.updateChildrenLoaded=function(C,E){for(C=this.getNode(C);c.isSome(C);)C.childrenLoaded+=E,C=this.getParent(C.index)};t.checkChildrenLoadedInvariant=function(){if(c.isNone(this.rootNode))return!0;const C=[],E=F=>{let H=this._isLoaded(F.index)||this._isReloading(F.index)?1:0;this.traverseChildren(F,K=>{H+=E(K);return!1});F.childrenLoaded!==
H&&C.push(F.index);return H};E(this.rootNode);C.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+C.join(","));return 0<C.length};t.updateStats=function(C){0<this._updates.add.length&&(C.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)C.index+=" + "+this._indexMissing||this._prefetch.length;C.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const E=this._featureEstimate.estimate-C.features;0<E?C.features+=" + "+E:
0>E&&(C.features+=" - "+-E)}};t.updateElevationInfo=function(C,E){this.needNodeElevationRange=E&&!!C&&("relative-to-ground"===C.mode||"on-the-ground"===C.mode);this._viewportQueries.updateElevationInfo(C);this.invalidateAllElevationRanges()};t.invalidateAllElevationRanges=function(){this._forAllNodes(C=>{e(C);c.isSome(C.node)&&(C.node.elevationRange=null);c.isSome(C.ref)&&(C.ref.elevationRange=null)})};t._forAllNodes=function(C){if(null!=this._clientNodePage){var E=this._clientNodePage;for(var F=
0;F<E.nodes.length;F++)C(E.nodes[F],-(F+1))}for(E=0;E<this._nodePages.length;E++)if(F=this._nodePages[E]){const H=E*this._nodesPerPage;for(let K=0;K<F.nodes.length;K++)C(F.nodes[K],H+K)}};b._createClass(A,[{key:"rootNode",get:function(){return this.getNode(this._rootIndex)}},{key:"size",get:function(){return this._nodeCount}},{key:"isEditable",get:function(){return this._isEditable}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"isLoading",
get:function(){return 0<this._indexMissing}},{key:"isPrefetching",get:function(){return 0<this._prefetch.length}},{key:"indexLoading",get:function(){return this._loading.size}},{key:"indexMissing",get:function(){return this._indexMissing}},{key:"unloadedMemoryEstimate",get:function(){return this._unloadedMemoryEstimate}},{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"maxPriority",get:function(){return Math.max(this._maxProcessingPrio,
this._maxUnloadedPrio)}},{key:"test",get:function(){return{addNode:(C,E)=>this._addNode(C,E)}}}]);return A}();const B=new Map;let D=function(){function A(t){this.missing=t;this.update=new w({deallocator:null});this.add=new w({deallocator:null});this.remove=new w({deallocator:null});this.cancel=[]}A.prototype.reset=function(t){this.add.clear();this.update.clear();this.cancel=t};return b._createClass(A)}();const z=[["maxScreenThreshold",g.LodMetric.MaxScreenThreshold],["screenSpaceRelative",g.LodMetric.ScreenSpaceRelative],
["removedFeatureDiameter",g.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",g.LodMetric.DistanceRangeFromDefaultCamera]];let v=b._createClass(function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0});a.I3SIndex=y;a.selectErrorMetric=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/sphere"],function(a,b,
c){let w=b._createClass(function(l,g){this.id=l;this.mbs=g;this.renderMbs=c.fromValues(0,0,0,-1);this.elevationRange=null}),n=b._createClass(function(){this.min=Infinity;this.max=-Infinity;this.valid=!1});a.NodeFilterImpact=void 0;(function(l){l[l.Unmodified=0]="Unmodified";l[l.Culled=1]="Culled";l[l.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(l){l[l.Unmodified=0]="Unmodified";l[l.PotentiallyModified=1]="PotentiallyModified";
l[l.Culled=2]="Culled";l[l.Unknown=3]="Unknown";l[l.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));let x=function(l){function g(d,e,k,u,p,h,r,q,y,B){d=f.call(this,d,k);d.index=e;d.childCount=u;d.level=p;d.resources=h;d.version=r;d.lodMetric=q;d.maxError=y;d.numFeatures=B;d.failed=!1;d.cacheState=a.CacheState.Unknown;d.vertexCount=0;d.memory=0;d.childrenLoaded=0;d.hasModifications=!1;d.imModificationImpact=a.NodeIMModificationImpact.NotChecked;return d}b._inherits(g,
l);var f=b._createSuper(g);return b._createClass(g)}(w);a.CacheState=void 0;(function(l){l[l.Unknown=0]="Unknown";l[l.Uncached=1]="Uncached";l[l.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(l){l[l.None=0]="None";l[l.MaxScreenThreshold=1]="MaxScreenThreshold";l[l.ScreenSpaceRelative=2]="ScreenSpaceRelative";l[l.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";l[l.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));
a.NodeState=void 0;(function(l){l[l.Hole=0]="Hole";l[l.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));let m=b._createClass(function(l,g,f,d){this.nodeHasLOD=l;this.isChosen=g;this.lodLevel=f;this.version=d});a.ElevationRange=n;a.Node=x;a.NodeBase=w;a.NodeTraversalState=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray",
"./I3SNode","../support/I3SLayerView"],function(a,b,c,w,n){let x=function(){function l(f){this._layerView=f;this._lodGlobalDirty=!1}var g=l.prototype;g.startNodeLoading=function(f,d,e,k){this._maxLodLevel=k.maxLodLevel;this._index=e;this._isNodeInScaleBounds=f;this._removeNodes=d};g.shouldLoadNode=function(f){if(b.isNone(f))return!1;const d=this._index.nodeTraversalState(f);return this._isChosenMaxLOD(d)?!0:d.isChosen?this._childrenRequireLoading(f):!1};g.setLodGlobalDirty=function(){this._lodGlobalDirty=
!0};g.lodGlobalHandling=function(f){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var d=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));m.clear();this._lodGlobalHandling(this._index.rootNode,d,!1,!!this._layerView.nodeCrossfadingEnabled);d=m.length;this._removeNodes(m,f);f=m.length<d;0!==m.length&&(this._lodGlobalDirty=!0);m.clear();return f};g._lodGlobalHandling=function(f,d,e,k){if(b.isNone(f))return!1;const u=f.index,p=this._index,
h=this._layerView;var r=p.nodeTraversalState(f);r=this._isChosenMaxLOD(r);var q=!f.resources.hasFeatureData;if(r&&q)return 0<f.childrenLoaded&&this._removeChildrenRecursive(f),!0;q=h.isNodeLoaded(u);if(k&&q&&r){var y=!e&&this.hasNoVisibleChildren(f);h.fadeNode(u,n.FadeDirection.FadeIn,!y)}y=q&&(!h.isNodeFullyFadedIn||h.isNodeFullyFadedIn(u));if(q&&(h.updateNodeState(u,r?w.NodeState.Leaf:w.NodeState.Hole),r))return y&&this._removeChildrenRecursive(f),y;var B=0<f.childCount;let D=B;if(B)for(B=0;B<f.childCount;B++){const z=
p.getChildIndex(u,B),v=p.getNode(z);b.isSome(v)?p.isGeometryVisible(z)&&!this._lodGlobalHandling(v,d,e||y,k)&&this._isNodeInScaleBounds(v)&&(D=!1):p.isNodeVisible(z)&&(D=!1)}(d=q&&!r&&(D||m.length<d))&&m.push(u);!k||d||!q||e||D||h.fadeNode(u,n.FadeDirection.FadeIn,!1);f=!f.resources.hasFeatureData;return D||y&&!d||f};g._removeChildrenRecursive=function(f){this._index.traverseChildren(f,d=>{(this._layerView.isNodeLoaded(d.index)||this._layerView.isNodeReloading(d.index))&&m.push(d.index);return 0<
d.childrenLoaded})};g.hasNoVisibleChildren=function(f){let d=!0;this._index.traverseChildren(f,e=>d&&this._index.isNodeVisible(e.index)?this._layerView.isNodeLoaded(e.index)?d=!1:0<e.childrenLoaded:!1);return d};g._childrenRequireLoading=function(f){let d=!1,e=!0;this._index.traverseChildren(f,k=>{if(!e||!this._index.isNodeVisible(k.index))return!1;const u=this._index.nodeTraversalState(k);this._isChosenMaxLOD(u)&&this._index.isGeometryVisible(k.index)&&(d=!0);return this._layerView.isNodeLoaded(k.index)?
e=!1:0<k.childrenLoaded});return e&&d};g._isChosenMaxLOD=function(f){return f.isChosen&&(!f.nodeHasLOD||f.lodLevel===this._maxLodLevel)};a._createClass(l,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return l}();const m=new c({deallocator:null});return x})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=
1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),function(a,b,c,w,n,x,m,l,g,f){return function(){function d(k,u,p,h,r,q){this._streamDataController=u;this._logger=
p;this._defaultGeometrySchema=h;this._requiredAttributes=r;this._options=q;this._logLayer=k;this._layerUrl=k.parsedUrl.path;this._geometryDefinitions=k.geometryDefinitions;if(k.materialDefinitions){const y=k.textureSetDefinitions;this._materialAndTextures=k.materialDefinitions.map(B=>f.getMaterialAndTextures(y,B))}}var e=d.prototype;e._load=function(k,u,p){return this._streamDataController.request(k,u,p)};e._loadAttribute=function(k,u,p){return this._load(`${this._layerUrl}/nodes/${k.resources.attributes}/attributes/${u.key}/0`,
"binary",p).then(h=>g.readBinaryAttribute(u,h))};e.loadAttributes=function(k,u,p){return x.eachAlways(u.map(h=>this._loadAttribute(k,h.attributeStorageInfo,p))).then(h=>{const r={};for(let q=0;q<u.length;++q){const y=h[q].value;if(y)r[u[q].name]=y;else{if(x.isAbortError(h[q].error))throw h[q].error;this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${u[q].name}' on node '${k.id}'`,h[q].error)}}return r})};e.loadNodeData=async function(k,u){var p=null!=this._requiredAttributes&&
k.resources.attributes?b.result(this.loadAttributes(k,this._requiredAttributes,u)):null;var h=this._geometryDefinitions;var r={bufferDefinition:null,bufferIndex:0};var q=k.resources.geometryDefinition;if(!(null==h||null==q||0>q)&&(h=0<=q?h[q].geometryBuffers:null,null!=h))for(q=0;q<h.length;q++){var y=h[q];if(null!=y.compressedAttributes){if("draco"===y.compressedAttributes.encoding&&!c("disable-feature:i3s-draco")){r.bufferIndex=q;r.bufferDefinition=y;break}}else r.bufferIndex=q,r.bufferDefinition=
h[q]}const {bufferDefinition:B,bufferIndex:D}=r;q=(y=!!k.resources.geometry)?b.result(this._loadGeometry(k.resources.geometry,D,u)):null;h=k.resources.hasSharedResource?await this._loadShared(k,u):null;r=k.resources.materialDefinition;r=this._materialAndTextures&&null!=r&&0<=r?this._materialAndTextures[r]:null!=h?f.getMaterialAndTexturesFromShared(h):null;var z=r?.material;r=r?.textures??[];const v=`${k.id}`,A=!y&&this._options.loadFeatureData;y=A?await this._loadFeatureData(v,u):null;if(A)a:{if(y)for(C of y.featureData)if(z=
C.geometries,null!=z)for(var t of z){var C={featureIds:[C.id],featureDataPosition:C.position,geometries:[t]};break a}C=null}else C={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:z}}],featureDataPosition:[0,0,0]};if(n.isNone(C))if(y){t=[];for(E of y.featureData)null!=E.position&&t.push({featureIds:[E.id],featureDataPosition:E.position,geometries:[]});var E=t}else E=null;else E=null;t=0<r.length?b.result(this.loadTextures(k,r,u)):null;u=k=null;q&&(k=b.assertResult(await q),(u=this._defaultGeometrySchema)&&
h&&h.materialDefinitions&&(q=Object.keys(h.materialDefinitions)[0],!h.materialDefinitions[q].params.vertexRegions&&u.vertexAttributes.region&&(u=w.clone(u),delete u.vertexAttributes.region)),u=g.createGeometryDescriptor(B,u));h=t?b.assertResult(await t):null;p=(p=p?b.assertResult(await p):{})?{attributeData:p,loadedAttributes:this._requiredAttributes}:null;if(n.isSome(C))return{geometryData:C,attributeDataInfo:p,geometryBuffer:k,geometryDescriptor:u,requiredTextures:r,textureData:h};if(n.isSome(E))return{pointData:E,
attributeDataInfo:p,geometryBuffer:k,geometryDescriptor:u,requiredTextures:r,textureData:h};throw Error();};d._addAbsoluteHrefTexture=function(k,u){k=k.textureDefinitions;if(null!=k)for(const p of Object.keys(k))for(const h of k[p].images)Array.isArray(h.href)?h.hrefConcat=h.href.map(r=>m.makeAbsolute(r,u)):h.hrefConcat=m.makeAbsolute(h.href,u)};d._fixTextureEncodings=function(k){k=k.textureDefinitions;if(null!=k)for(const p in k){const h=k[p];if(Array.isArray(h.encoding))for(var u=0;u<h.encoding.length;u++){const r=
h.encoding[u];"data:"===r.substring(0,5)&&(h.encoding[u]=r.substring(5))}else u=h.encoding,"data:"===u.substring(0,5)&&(h.encoding=u.substring(5))}};e._loadShared=function(k,u){const p=`${this._layerUrl}/nodes/${k.resources.geometry}/shared`;return this._load(p,"json",u).then(h=>{d._fixTextureEncodings(h);d._addAbsoluteHrefTexture(h,p);return h})};e._loadTexture=function(k,u,p,h,r,q){let y=!1;return r===l.TextureEncoding.DDS_S3TC||r===l.TextureEncoding.KTX2||r===l.TextureEncoding.Basis?this._load(k,
"binary",q).then(B=>({id:u,usage:p,data:B,encoding:r,downsampled:y})):this._load(k,"image",q).then(B=>{var D=B;if(h&&4096<=B.width*B.height){D=Math.ceil(B.width/2);const z=Math.ceil(B.height/2),v=document.createElement("canvas");v.width=D;v.height=z;v.getContext("2d").drawImage(B,0,0,D,z);D=v;y=!0}return{id:u,usage:p,data:D,encoding:r,downsampled:y}})};e.loadTextures=function(k,u,p){const h=!!this._options.uncompressedTextureDownsamplingEnabled,r=this._options.textureUsageMask;return Promise.all(u.map(q=>
{if(0===(q.usage&r))return null;const y=f.selectEncoding(q.encodings,this._options.textureEncodings);return null==y?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${k.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${k.resources.texture||k.id}/textures/${y.name}`,q.id,q.usage,h,y.encoding,p)}))};e._loadFeatureData=function(k,u){return this._load(`${this._layerUrl}/nodes/${k}/features/0`,"json",u)};e._loadGeometry=function(k,u,p){return this._load(`${this._layerUrl}/nodes/${k}/geometries/${u}`,
"binary",p)};return a._createClass(d)}()})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";
b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../../webgl/enums".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){function k(D){return D.sort((z,v)=>z.encoding-v.encoding)}function u(D,z,v){if(w.isNone(D)||v===n.TextureUsage.None)return null;for(let A=0;A<D.length;A++){const t=D[A];if(w.isSome(t)&&0!==(t.usage&v))return D=z[A],w.isSome(D)?D.id:null}return null}function p(D){switch(D){case n.TextureEncoding.KTX2:return f.TextureEncodingMimeType.KTX2_ENCODING;case n.TextureEncoding.Basis:return f.TextureEncodingMimeType.BASIS_ENCODING;case n.TextureEncoding.DDS_S3TC:return f.TextureEncodingMimeType.DDS_ENCODING;
case n.TextureEncoding.PNG:return"image/png";case n.TextureEncoding.JPG:return"image/jpeg";case n.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const h={ktx2:n.TextureEncoding.KTX2,basis:n.TextureEncoding.Basis,dds:n.TextureEncoding.DDS_S3TC,png:n.TextureEncoding.PNG,jpg:n.TextureEncoding.JPG,"ktx-etc2":n.TextureEncoding.KTX_ETC2},r={[f.TextureEncodingMimeType.KTX2_ENCODING]:n.TextureEncoding.Basis,[f.TextureEncodingMimeType.BASIS_ENCODING]:n.TextureEncoding.Basis,[f.TextureEncodingMimeType.DDS_ENCODING]:n.TextureEncoding.DDS_S3TC,
"image/png":n.TextureEncoding.PNG,"image/jpg":n.TextureEncoding.JPG,"image/jpeg":n.TextureEncoding.JPG,"image/ktx":n.TextureEncoding.KTX_ETC2},q=()=>({alphaMode:"opaque",alphaCutoff:l.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:f.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
y={s:e.TextureWrapMode.CLAMP_TO_EDGE,t:e.TextureWrapMode.CLAMP_TO_EDGE},B={s:e.TextureWrapMode.REPEAT,t:e.TextureWrapMode.REPEAT};a.configureMaterial=function(D,z,v,A,t,C){const E=C.rendererTextureUsage;var F=z.metallicRoughness.baseColorFactor,H=c.clamp(z.metallicRoughness.baseColorFactor[3],0,1);D.baseColor=[F[0],F[1],F[2],H];D.hasParametersFromSource=!!z.hasParametersFromSource;D.usePBR=C.usePBR;D.mrrFactors=[z.metallicRoughness.metallicFactor,z.metallicRoughness.roughnessFactor,z.hasParametersFromSource?
.2:.5];D.emissiveFactor=z.emissiveFactor;D.isIntegratedMesh=C.isIntegratedMesh;D.textureAlphaCutoff="mask"===z.alphaMode?z.alphaCutoff:l.defaultMaskAlphaCutoff;D.alphaDiscardMode="opaque"===z.alphaMode?f.AlphaDiscardMode.Opaque:"mask"===z.alphaMode?f.AlphaDiscardMode.Mask:f.AlphaDiscardMode.MaskBlend;F=[];H=u(A,v,(n.TextureUsage.Color|n.TextureUsage.AlphaMask)&E);w.isSome(H)&&(D.baseColorTexture=new x.RenderTexture(t,H),F.push(D.baseColorTexture.loadPromise));H=u(A,v,n.TextureUsage.MetallicRoughness&
E);w.isSome(H)&&(D.metallicRoughnessTexture=new x.RenderTexture(t,H),F.push(D.metallicRoughnessTexture.loadPromise));H=u(A,v,n.TextureUsage.Emissive&E);w.isSome(H)&&(D.emissionTexture=new x.RenderTexture(t,H),F.push(D.emissionTexture.loadPromise));H=u(A,v,n.TextureUsage.Occlusion&E);w.isSome(H)&&(D.occlusionTexture=new x.RenderTexture(t,H),F.push(D.occlusionTexture.loadPromise));v=u(A,v,n.TextureUsage.Normal&E);w.isSome(v)&&(D.normalTexture=new x.RenderTexture(t,v),F.push(D.normalTexture.loadPromise));
D.commonMaterialParameters.hasSlicePlane=C.slicePlaneEnabled;D.commonMaterialParameters.doubleSided=z.doubleSided;D.commonMaterialParameters.cullFace=z.cullFace;D.ellipsoidMode=g.getEllipsoidMode(C.viewSpatialReference);return Promise.all(F)};a.createTexture=function(D,z,v,A){if(w.isNone(D)||null==D.data)return null;const t=D.data;var C=!(t instanceof HTMLImageElement)||c.isPowerOfTwo(t.width)&&c.isPowerOfTwo(t.height);A=A.renderingContext.parameters.maxMaxAnisotropy;C=C&&!D.downsampled&&1<A;v=v||
!z.wrapTextures?y:B;const E=p(D.encoding);return new d.Texture(t,{mipmap:C,maxAnisotropy:A,encoding:E,wrap:v,components:D.usage&n.TextureUsage.Color?"opaque"===z.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=q;a.getMaterialAndTextures=function(D,z){const v=new Map,A=(L,R)=>{if(w.isNone(L))return-1;var O=v.get(L.id);if(O)return O.usage|=R,O.id;O=v.size;v.set(L.id,{id:O,usage:R});return O};var t=z.pbrMetallicRoughness;const C=t&&t.baseColorFactor,E=z.emissiveFactor,F=null==z.normalTexture&&null==
z.emissiveTexture&&null==z.occlusionTexture&&(t?null==t.metallicRoughnessTexture&&1===t.roughnessFactor&&(1===t.metallicFactor||0===t.metallicFactor):!0),H=F?m.PBRSchematicMRRValues[0]:t?t.metallicFactor:1,K=F?m.PBRSchematicMRRValues[1]:t?t.roughnessFactor:1;t={baseColorFactor:C?[C[0],C[1],C[2],C[3]]:[1,1,1,1],baseColorTextureId:A(t&&t.baseColorTexture,"mask"===z.alphaMode?n.TextureUsage.Color|n.TextureUsage.AlphaMask:n.TextureUsage.Color),metallicRoughnessTextureId:A(t&&t.metallicRoughnessTexture,
n.TextureUsage.MetallicRoughness),metallicFactor:H,roughnessFactor:K};z={alphaMode:z.alphaMode,alphaCutoff:z.alphaCutoff,doubleSided:z.doubleSided,cullFace:"none"===z.cullFace?f.CullFaceOptions.None:"back"===z.cullFace?f.CullFaceOptions.Back:"front"===z.cullFace?f.CullFaceOptions.Front:f.CullFaceOptions.None,normalTextureId:A(z.normalTexture,n.TextureUsage.Normal),emissiveTextureId:A(z.emissiveTexture,n.TextureUsage.Emissive),occlusionTextureId:A(z.occlusionTexture,n.TextureUsage.Occlusion),emissiveFactor:E?
[E[0],E[1],E[2]]:[0,0,0],metallicRoughness:t,wrapTextures:!1,hasParametersFromSource:F};const I=[];v.forEach(({usage:L},R)=>{var O=w.isSome(D)&&D[R]&&D[R].formats;O=O?k(O.map(({name:J,format:M})=>({name:J,encoding:h[M]}))):[];I.push({id:R,usage:L,encodings:O})});return{material:z,textures:I}};a.getMaterialAndTexturesFromShared=function(D){var z=D&&D.materialDefinitions?Object.keys(D.materialDefinitions)[0]:null,v=D&&D.textureDefinitions?Object.keys(D.textureDefinitions)[0]:null;z=z?D.materialDefinitions?.[z]:
null;v=v?D.textureDefinitions?.[v]:null;D=q();if(null!=z){z=z.params;z.diffuse&&(D.metallicRoughness.baseColorFactor=[z.diffuse[0],z.diffuse[1],z.diffuse[2],1]);null!=z.doubleSided&&(D.doubleSided=z.doubleSided,D.cullFace=z.doubleSided?f.CullFaceOptions.None:f.CullFaceOptions.Back);if("none"===z.cullFace||"front"===z.cullFace||"back"===z.cullFace)D.cullFace="none"===z.cullFace?f.CullFaceOptions.None:"back"===z.cullFace?f.CullFaceOptions.Back:f.CullFaceOptions.Front;z.transparency&&(D.metallicRoughness.baseColorFactor[3]=
c.clamp(1-z.transparency,0,1));if(z.useVertexColorAlpha||1>D.metallicRoughness.baseColorFactor[3])D.alphaMode="blend"}z=[];if(null!=v){!v.wrap||"repeat"!==v.wrap[0]&&"repeat"!==v.wrap[1]||(D.wrapTextures=!0);let A=n.TextureUsage.Color;"rgba"===v.channels&&(D.alphaMode="blend",A|=n.TextureUsage.AlphaMask);const t=v.images[v.images.length-1],C=E=>E&&E.split("/").pop();v=Array.isArray(v.encoding)?k(v.encoding.map((E,F)=>({name:C(t.href[F]),encoding:r[E]||0}))):[{name:C(t.href),encoding:r[v.encoding]||
0}];z.push({id:0,usage:A,encodings:v});D.metallicRoughness.baseColorTextureId=0}return{material:D,textures:z}};a.getSupportedEncodings=function(D){const z=!!D.compressedTextureS3TC;D=!!D.compressedTextureETC;const v=b("disable-feature:i3s-basis")?0:n.TextureEncoding.Basis|n.TextureEncoding.KTX2,A=v|n.TextureEncoding.DDS_S3TC;return n.TextureEncoding.JPG|n.TextureEncoding.PNG|(z?A:0)|(D?v:0)};a.selectEncoding=function(D,z){if(null!=z)return D.find(v=>0!==(v.encoding&z))};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,c,w){let n=function(){function x(m,l){this._textureRep=m;this.loadPromise=null;this._disposed=!1;m=this._textureRep.acquire(l);w.isPromiseLike(m)?(m.then(g=>{this._disposed?c.releaseMaybe(g):this._textureRef=g}),this.loadPromise=m):this._textureRef=m}x.prototype.dispose=
function(){this._textureRef=c.releaseMaybe(this._textureRef);this._disposed=!0};b._createClass(x,[{key:"glTexture",get:function(){return c.isSome(this._textureRef)?this._textureRef.glTexture:null}}]);return x}();a.RenderTexture=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,b,c){let w=function(){function n(m,l){this._requester=
m;this._apiKey=l;this._activeRequests=new Set}var x=n.prototype;x.request=function(m,l,g){const f=new AbortController;g=c.onAbortOrThrow(g,()=>f.abort());m=this._requester.request(m,l,{signal:f.signal,query:{token:this._apiKey}});const d={response:m,abortController:f,abortHandle:g};this._activeRequests.add(d);c.always(m,()=>{d.abortController=null;d.abortHandle?.remove();d.abortHandle=null;this._activeRequests.delete(d)});return m};x.cancelAll=function(){this._activeRequests.forEach(m=>{m.abortController?.abort();
m.abortController=null;m.abortHandle?.remove()});this._activeRequests.clear()};b._createClass(n,[{key:"busy",get:function(){return this._requester.busy}}]);return n}();a.I3SStreamDataController=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q){return function(){function y(D,z,v,A,t,C,E,F,H={}){this._indexSR=D;this._renderCoordsHelper=z;this._clippingArea=t;this._elevationProvider=C;this._viewingMode=E;this._options=H;this._frustum=g.create();this._useFrustumCulling=!1;this._poi=w.create();this._elevationContext=null;this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=q.create();this._tmp1=w.create();this._tmp2=w.create();this._tmp3=w.create();this._tmp0=w.create();this._screenspaceErrorBias=
H.screenspaceErrorBias||1;this._progressiveLoadFactor=H.progressiveLoadFactor||1;this.updateCamera(v,A);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(F);this._tmpPoint=e.makeDehydratedPoint(0,0,0,D);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(this.engineSR.isWebMercator||f.isPlateCarree(this.engineSR));this._indexSREllipsoidRadius=x.getReferenceEllipsoid(this._indexSR).radius}var B=y.prototype;B.updateElevationInfo=function(D){null==D?this._elevationContext=
null:(this._elevationContext=u.ElevationContext.fromElevationInfo(D),this._elevationContext.updateFeatureExpressionInfoContext(p.createContextWithoutExpressionSupport(p.extractExpressionInfo(D,!1))))};B.updateCamera=function(D,z){(this._useFrustumCulling=z)&&g.fromMatrix(D.viewMatrix,D.projectionMatrix,this._frustum);this._screenSizeFactor=1/(D.perScreenPixelRatio/2);this._camPos=D.eye;this.minDistance=Infinity;this.maxDistance=0};B.setPointOfInterest=function(D){this._poi=D};B.updateScreenSpaceErrorBias=
function(D){const z=this._screenspaceErrorBias;this._screenspaceErrorBias=D;return z};B.updateClippingArea=function(D){this._clippingArea=D};B.getElevationRange=function(D){if(b.isNone(this._elevationContext))return null;D=D.mbs;if(!D)return null;const z="relative-to-scene"===this._elevationContext.mode?"scene":"ground";if(this._elevationProvider.getSphereElevationBounds)return this._elevationProvider.getSphereElevationBounds(D,this._indexSR);D=this._elevationProvider.getElevation(D[0],D[1],D[2],
this._indexSR,z);return b.isSome(D)?{min:D,max:D}:null};B.getRenderMbs=function(D){const z=D.renderMbs;if(r.isValidMbs(z))return z;D.mbs&&n.copy(z,D.mbs);this._elevationContext&&1E5>z[3]&&(this._tmpPoint.x=z[0],this._tmpPoint.y=z[1],this._tmpPoint.z=z[2],z[2]=k.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));m.projectBoundingSphere(z,this._indexSR,z,this.engineSR);return z};B.getVisibilityObb=function(D){if(b.isSome(D.visibilityObb))return D.visibilityObb;
const z=D.serviceObb,v=.01*this._indexSREllipsoidRadius;if(b.isNone(z)||!D.mbs||!r.isValidObb(z)||this._isECEFOBBInLocalMode&&z.halfSize.some(A=>A>v))return null;D.serviceObbInRenderSR=this._computeRenderObb(z,D.serviceObbInRenderSR,D.mbs[3],D.elevationRange);return D.serviceObbInRenderSR};B._computeRenderObb=function(D,z,v,A){if(b.isNone(z))z=q.create();else if(r.isValidObb(z))return z;let t=0,C=0;if(this._elevationContext&&b.isSome(A)&&Number.isFinite(A.min))switch(this._elevationContext.mode){case "relative-to-ground":t=
this._elevationContext.geometryZWithOffset(D.center[2],this._renderCoordsHelper)+A.min-D.center[2];C=A.max-A.min;break;case "on-the-ground":t=A.min-D.center[2],C=A.max-A.min}else this._elevationContext&&1E5>v&&(this._tmpPoint.x=D.center[0],this._tmpPoint.y=D.center[1],this._tmpPoint.z=D.center[2],t=k.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-D.center[2]);0<C?(r.transformObb(D,this._indexSR,this._tmpObb,this.engineSR,t),
q.computeOffsetObb(this._tmpObb,0,C,this._viewingMode,z)):r.transformObb(D,this._indexSR,z,this.engineSR,t);return z};B.isNodeVisible=function(D){const z=this.getRenderMbs(D);if(!this._isMBSinClippingArea(z))return!1;if(!this._useFrustumCulling)return!0;D=this.getVisibilityObb(D);return b.isSome(D)?q.isVisible(D,this._frustum):g.intersectsSphere(this._frustum,d.wrap(z))};B.isGeometryVisible=function(D){if(!this._useFrustumCulling)return!0;const z=D.geometryObb;return b.isSome(z)?q.isVisible(z,this._frustum):
this.isNodeVisible(D)};B._isMBSinClippingArea=function(D){return b.isNone(this._clippingArea)?!0:r.intersectBoundingRectWithMbs(this._clippingArea,D)!==r.MbsIntersectResult.OUTSIDE};B._screenSpaceDiameterMbs=function(D,z){var v=this.getRenderMbs(D);D=Math.sqrt(c.squaredDistance(v,this._camPos));v=D-v[3];this._updateMinMaxDistance(D);return 0>v?.5*Number.MAX_VALUE:z/v*this._screenSizeFactor};B.calcCameraDistance=function(D){return this.calcCameraDistanceToCenter(D)-this.getRenderMbs(D)[3]};B.calcCameraDistanceToCenter=
function(D){D=this.getRenderMbs(D);D=c.distance(D,this._camPos);this._updateMinMaxDistance(D);return D};B.calcAngleDependentLoD=function(D){D=this.getRenderMbs(D);const z=D[3];D=(Math.abs(D[0]*(D[0]-this._camPos[0])+D[1]*(D[1]-this._camPos[1])+D[2]*(D[2]-this._camPos[2]))/c.length(D)+z)/c.distance(D,this._camPos);return Math.min(1,D)};B.hasLOD=function(D){return D.lodMetric!==h.LodMetric.None};B._getDistancePlanarMode=function(D,z){var v=D[0]-z[0];const A=D[1]-z[1];D=D[2]-z[2];v=v*v+A*A;z=z[3];if(v<=
z*z)return Math.abs(D);z=Math.sqrt(v)-z;return Math.sqrt(D*D+z*z)};B._getDistanceGlobeMode=function(D,z){var v=c.length(z);const A=c.length(D)-v;c.scale(this._tmp0,D,c.dot(D,z)/c.squaredLength(D));var t=c.squaredDistance(z,this._tmp0),C=z[3];if(t<=C*C)return Math.abs(A);z=c.scale(this._tmp0,z,1/v);v=c.scale(this._tmp1,z,v-C*C/2/v);t=c.subtract(this._tmp2,D,v);t=c.subtract(this._tmp2,t,c.scale(this._tmp3,z,c.dot(z,t)));v=c.add(this._tmp2,v,c.scale(this._tmp2,t,C/c.length(t)));C=c.distance(D,v);2E5<=
A&&(D=c.subtract(this._tmp1,D,v),D=c.dot(D,z)/c.length(D),.08>D&&(D=1E-4),C/=D);return C};B._getDistance=function(D,z){return this.engineSR===l.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(D,z):this._getDistancePlanarMode(D,z)};B._updateMinMaxDistance=function(D){0<D?(this.minDistance=Math.min(this.minDistance,D),this.maxDistance=Math.max(this.maxDistance,D)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-D))};B.getLodLevel=function(D){if(D.lodMetric===h.LodMetric.None)return 0;
if(0===D.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const z=this._screenspaceErrorBias;return this.evaluateLODmetric(D,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(D,z)?2:1:0}return this.evaluateLODmetric(D,this._screenspaceErrorBias)?this.maxLodLevel:0};B.evaluateLODmetric=function(D,z){switch(D.lodMetric){case h.LodMetric.ScreenSpaceRelative:const v=this.getRenderMbs(D),A=this._getDistance(this._camPos,v),t=2*A/
this._screenSizeFactor;this._updateMinMaxDistance(A+v[3]);return D.maxError*z<=t;case h.LodMetric.MaxScreenThreshold:return z=this._screenSpaceDiameterMbs(D,D.mbs[3]*z),this._options.angleDependentLoD&&(z*=this.calcAngleDependentLoD(D)),z<D.maxError;case h.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(D,D.maxError)*z;case h.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(D)>D.maxError*z}return!1};B.distToPOI=function(D){D=this.getRenderMbs(D);return c.distance(D,
this._poi)-D[3]};B.distCameraToPOI=function(){return c.distance(this._camPos,this._poi)};return a._createClass(y)}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){var u;c=u=function(p){function h(q){q=r.call(this,q);q.geometry=null;q.type="clip";return q}a._inherits(h,p);var r=a._createSuper(h);p=h.prototype;p.writeGeometry=function(q,y,B,D){if(D.layer&&D.layer.spatialReference&&!D.layer.spatialReference.equals(this.geometry.spatialReference)){if(!e.canProjectWithoutEngine(q.spatialReference,D.layer.spatialReference)){D&&D.messages&&D.messages.push(new x("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:D.layer.spatialReference,context:D}));return}const z=new k;e.projectPolygon(q,z,D.layer.spatialReference);y[B]=z.toJSON(D)}else y[B]=q.toJSON(D);delete y[B].spatialReference};p.clone=function(){return new u({geometry:n.clone(this.geometry),type:this.type})};return a._createClass(h)}(w.JSONSupport);b.__decorate([m.property({type:k}),d.persistable()],c.prototype,"geometry",void 0);b.__decorate([f.writer(["web-scene","portal-item"],"geometry")],c.prototype,"writeGeometry",
null);b.__decorate([m.property({type:["clip","mask","replace"],nonNullable:!0}),d.persistable()],c.prototype,"type",void 0);return c=u=b.__decorate([g.subclass("esri.layers.support.SceneModification")],c)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z){w=function(t){function C(F){F=E.call(this,F);F.loadedGraphics=new B.LimitGraphicsMap(5E4);F.slicePlaneEnabled=!1;F._renderingInfo={symbol:new z};F._handles=new x;F._graphicsByNode=new Map;return F}a._inherits(C,t);var E=a._createSuper(C);t=C.prototype;t.initialize=function(){const F=this.view.basemapTerrain;this._graphicsCore=new r.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:D.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,
graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:H=>this.view.deconflictor.addGraphicsOwner(H),labeler:(H,K)=>this.view.labeler.addGraphicsOwner(H,K,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),scaleVisibility:(H,K)=>new q({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:K,graphicsCore:H,basemapTerrain:F,layerScaleEnabled:!1})}});
this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this._handles.add(l.watch(()=>this.layer.labelingInfo,(H,K)=>{u.diff(H,K)&&this._graphicsCore.updateLabelingInfo()}))};t.destroy=function(){this._handles=m.destroyMaybe(this._handles);this._graphicsCore=m.destroyMaybe(this._graphicsCore);this.loadedGraphics=m.destroyMaybe(this.loadedGraphics);this.view=null};t.addNodeMeta=function(F,H){let K=0;const I=F.filteredIds,L=this.view.spatialReference,R=
F.featureIds.map((O,J)=>{y.boundingBoxTop(J,this.collection,F.objectHandle,A);const M=h.makeDehydratedPoint(0,0,0,L);this.view.renderCoordsHelper.fromRenderCoords(A,M);J=H(J,F);let G=!1;m.isNone(I)?G=!0:K<I.length&&O===I[K]&&(G=!0,K++);return{objectId:O,uid:c.generateUID(),attributes:J,visible:G,geometry:M}});this.loadedGraphics.addMany(R);this._graphicsByNode.set(F.node.index,R)};t.updateLabelPositions=function(F){const H=this._graphicsByNode.get(F.node.index);if(H){var K=0,I=this.view.spatialReference,
L=this.view.renderCoordsHelper;for(let R=0;R<F.featureIds.length;R++){const O=H[K];if(F.featureIds[R]===O.objectId){K++;const J=this._graphicsCore.getGraphics3DGraphicById(O.uid);m.isNone(J)||(y.boundingBoxTop(R,this.collection,F.objectHandle,A),this.view.renderCoordsHelper.fromRenderCoords(A,A,I),J.alignWithAbsoluteElevation(A[2],L,!1),m.isSome(O.geometry)&&"point"===O.geometry.type&&(O.geometry.z=A[2]))}}}};t.setNodeMetaAttributes=function(F,H){const K=this._graphicsByNode.get(F.node.index);if(K){var I=
Array(K.length);for(let L=0;L<K.length;L++){const R=K[L];R.attributes=H(L,F);I[L]=R.uid}this._graphicsCore.updateLabelingInfo(I)}};t.applyFilterChange=function(F){var H=this._graphicsByNode.get(F.node.index);if(H)if(m.isNone(F.filteredIds))for(var K of H)K.visible||(K.visible=!0,v.graphic=K,v.property="visible",v.oldValue=!1,v.newValue=!0,this._graphicsCore.graphicUpdateHandler(v));else{K=0;for(const I of H)H=I.visible,K<F.filteredIds.length&&I.objectId===F.filteredIds[K]?(I.visible=!0,K++):I.visible=
!1,H!==I.visible&&(v.graphic=I,v.property="visible",v.oldValue=H,v.newValue=I.visible,this._graphicsCore.graphicUpdateHandler(v))}};t.removeNodeMeta=function(F){this.loadedGraphics.removeManyByObjectId(F.featureIds)};t.getRenderingInfo=function(){return this._renderingInfo};t.notifyGraphicGeometryChanged=function(){};t.notifyGraphicVisibilityChanged=function(){};a._createClass(C,[{key:"updating",get:function(){return this._graphicsCore?.updating??!1}},{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},
{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return C}(n);b.__decorate([g.property()],w.prototype,"view",void 0);b.__decorate([g.property()],w.prototype,"layer",void 0);b.__decorate([g.property()],w.prototype,"collection",void 0);b.__decorate([g.property()],w.prototype,"loadedGraphics",void 0);b.__decorate([g.property()],
w.prototype,"updating",null);b.__decorate([g.property()],w.prototype,"slicePlaneEnabled",void 0);b.__decorate([g.property()],w.prototype,"_graphicsCore",void 0);w=b.__decorate([k.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],w);const v={graphic:null,property:null,oldValue:null,newValue:null},A=p.create();return w})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray".split(" "),
function(a,b,c,w,n,x,m){function l(d,e,k,u){d=e.getComponentAabb(k,d,g);e=e.getObjectTransform(k);for(k=0;8>k;++k)f[0]=k&1?d[0]:d[3],f[1]=k&2?d[1]:d[4],f[2]=k&4?d[2]:d[5],c.transformMat3(f,f,e.rotationScale),c.add(f,f,e.position),u[3*k]=f[0],u[3*k+1]=f[1],u[3*k+2]=f[2];return u}const g=x.create(),f=w.create();a.boundingBoxCornerPoints=l;a.boundingBoxTop=function(d,e,k,u){d=e.getComponentAabb(k,d,g);e=e.getObjectTransform(k);u[0]=0;u[1]=0;u[2]=0;for(k=0;8>k;++k)f[0]=k&1?d[0]:d[3],f[1]=k&2?d[1]:d[4],
f[2]=d[5],c.transformMat3(f,f,e.rotationScale),c.add(f,f,e.position),u[0]+=f[0],u[1]+=f[1],u[2]+=f[2];u[0]/=8;u[1]/=8;u[2]/=8;return u};a.createGetFeatureExtent=function(d,e,k){const u=m.newDoubleArray(24);return p=>{var h=p.meta.featureExtents;if(b.isNone(h)){h=new Float64Array(6*p.meta.featureIds.length);p.meta.featureExtents=h;for(let r=0;r<h.length;r+=6)h[r]=Number.POSITIVE_INFINITY}h=new Float64Array(h.buffer,6*p.index*Float64Array.BYTES_PER_ELEMENT,6);h[0]===Number.POSITIVE_INFINITY&&(l(p.index,
k,p.meta.objectHandle,u),n.projectBuffer(u,e,0,u,d,0,8)?(x.set(h,x.NEGATIVE_INFINITY),x.expandWithBuffer(h,u,0,8)):x.set(h,x.ZERO));return h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,c,w,n){c=function(l){function g(d){var e=f.call(this);e._limit=d;e._all=new n.GraphicsMap;e._active=new m(b._assertThisInitialized(e));
e._pending=new Map;e._handle=e._all.on("change",k=>e._handleChanges(k));return e}b._inherits(g,l);var f=b._createSuper(g);l=g.prototype;l.destroy=function(){this._handle.remove()};l.toArray=function(){return this._active.toArray()};l.find=function(d){return this._active.find(d)};l.forEach=function(d){this._active.forEach(d)};l.addMany=function(d){this._all.addMany(d)};l.removeManyByObjectId=function(d){this._all.removeManyByObjectId(d)};l._handleChanges=function(d){let e=d.removed;if(0<this._pending.size){e=
[];for(var k of d.removed)this._pending.delete(k.objectId)||e.push(k)}k=this._limit-this._active.length+e.length;k<d.added.length&&(this._active.removeMany(e),e=[],x.reset(1-this._limit/(this._active.length+d.added.length)),this._active.forEach(p=>{x.sample()&&(e.push(p),this._pending.set(p.objectId,p))}),k=this._limit-this._active.length+e.length);let u=d.added;if(k<d.added.length){u=[];x.reset(k/d.added.length);for(const p of d.added)x.sample()?u.push(p):this._pending.set(p.objectId,p)}d=k-u.length;
0<d&&0<this._pending.size&&(x.reset(d/this._pending.size),this._pending.forEach(p=>{x.sample()&&(u.push(p),this._pending.delete(p.objectId))}));this._active.addAndRemove(u,e)};b._createClass(g,[{key:"length",get:function(){return this._active.length}}]);return g}(c);const x=new (function(){function l(){this._percentage=1;this._last=-1;this._index=0}var g=l.prototype;g.reset=function(f){this._percentage=f;this._last=-1};g.sample=function(){const f=Math.floor(this._index*this._percentage);++this._index;
if(f===this._last)return!1;this._last=f;return!0};return b._createClass(l)}());let m=function(){function l(f){this._parent=f;this._map=new Map}var g=l.prototype;g.forEach=function(f){this._map.forEach(d=>f(d))};g.find=function(f){let d=void 0;w.someMap(this._map,e=>f(e)?(d=e,!0):!1);return d};g.toArray=function(){return[...this._map.values()]};g.addAndRemove=function(f,d){for(const e of f)this._map.set(e.objectId,e);for(const e of d)this._map.delete(e.objectId);(0<f.length||0<d.length)&&this._parent.emit("change",
{added:f,removed:d})};g.removeMany=function(f){for(const d of f)this._map.delete(d.objectId);0<f.length&&this._parent.emit("change",{added:[],removed:f})};b._createClass(l,[{key:"length",get:function(){return this._map.size}}]);return l}();a.LimitGraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,b,c,w){c=
function(n){function x(){var l=m.apply(this,arguments);l._map=new Map;return l}b._inherits(x,n);var m=b._createSuper(x);n=x.prototype;n.clear=function(){if(0<this._map.size){const l=this.toArray();this._map.clear();this.emit("change",{added:[],removed:l})}};n.get=function(l){return this._map.get(l)};n.addMany=function(l){if(0!==l.length){var g=new Set;for(let f=0;f<l.length;f++){const d=l[f],e=d.objectId,k=this._map.get(e);k?(g.add(e),d!==k&&(l[f]=k),k.refCount||(k.refCount=0),++k.refCount):(d.refCount=
1,this._map.set(e,d))}l=0<g.size?l.filter(f=>!g.has(f.objectId)):l;0<l.length&&this.emit("change",{added:l,removed:[]})}};n.removeMany=function(l){const g=[];for(const f of l){l=f.objectId;const d=this._map.get(l);null!=d&&(!d.refCount||0>=--d.refCount)&&(this._map.delete(l),g.push(f))}0<g.length&&this.emit("change",{added:[],removed:g})};n.removeManyByObjectId=function(l){const g=[];for(const f of l)l=this._map.get(f),null!=l&&(!l.refCount||0>=--l.refCount)&&(this._map.delete(f),g.push(l));0<g.length&&
this.emit("change",{added:[],removed:g})};n.toArray=function(){return[...this._map.values()]};n.find=function(l){let g;w.someMap(this._map,f=>l(f)?(g=f,!0):!1);return g};n.forEach=function(l){this._map.forEach(g=>l(g))};b._createClass(x,[{key:"length",get:function(){return this._map.size}}]);return x}(c);a.GraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),
function(a,b,c,w,n,x,m,l){function g(e,k,u){f.clear();var p=Infinity;let h=Infinity,r=-Infinity,q=-Infinity,y=!1;for(const D of k){var B="clip"===D.type?l.ModificationType.Inside:"mask"===D.type?l.ModificationType.Outside:l.ModificationType.Replace;const z=w.unwrapOrThrow(D.geometry,"modification.geometry");k=v=>v;if(z.spatialReference){if(!m.canProjectWithoutEngine(z.spatialReference,u)){c.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");
continue}k=v=>{m.projectVectorToVector(v,z.spatialReference,d,u);return d}}else z.hasZ||(d[2]=0,k=v=>{d[0]=v[0];d[1]=v[1];return d});y=y||B===l.ModificationType.Outside;f.push(B);f.push(z.rings.length);for(const v of z.rings){f.push(v.length);for(const A of v)B=k(A),f.push(B[0]),f.push(B[1]),f.push(B[2]),p=Math.min(p,B[0]),h=Math.min(h,B[1]),r=Math.max(r,B[0]),q=Math.max(q,B[1])}}w.isSome(e)&&(y?(f.push(l.ModificationType.Inside),f.push(2),f.push(4),f.push(p-1E-4),f.push(h-1E-4),f.push(0),f.push(r+
1E-4),f.push(h-1E-4),f.push(0),f.push(r+1E-4),f.push(q+1E-4),f.push(0),f.push(p-1E-4),f.push(q+1E-4),f.push(0)):(f.push(l.ModificationType.Outside),f.push(1)),f.push(4),f.push(e[0]),f.push(e[1]),f.push(0),f.push(e[2]),f.push(e[1]),f.push(0),f.push(e[2]),f.push(e[3]),f.push(0),f.push(e[0]),f.push(e[3]),f.push(0));f.push(l.ModificationType.Finished);e=new Float64Array(f.length);for(p=0;p<f.length;++p)e[p]=f.getItemAt(p);return e}x=function(e){function k(p){return u.call(this,"SceneLayerWorker","process",
{process:h=>[h.geometryBuffer]},p,{hasInitialize:!0})}b._inherits(k,e);var u=b._createSuper(k);e=k.prototype;e.setModifications=function(p,h,r,q){p={context:p,modifications:g(h,r,q),isGeodetic:q.isGeographic};this.broadcast(p,"setModifications")};e.setLegacySchema=function(p,h){h=JSON.stringify(h);this.broadcast({context:p,jsonSchema:h},"setLegacySchema")};e.destroyContext=function(p){return this.broadcast(p,"destroyContext")};return b._createClass(k)}(x.WorkerHandle);const f=new n({deallocator:null}),
d=[0,0,0];a.I3SMeshWorkerHandle=x;a.toWasmModification=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||(a.ModificationType={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesVisibilityMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.ALL_IN_CLIPPING_AREA=2]="ALL_IN_CLIPPING_AREA"})(a.ForAllFeaturesVisibilityMode||(a.ForAllFeaturesVisibilityMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType=
{}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define(["exports","../../../core/maybe","../../../libs/i3s/enums","../../../libs/i3s/I3SModule","./i3s/I3SNode"],function(a,b,c,w,n){function x(p){const h=p.modifications,r=k._malloc(8*h.length),q=new Float64Array(k.HEAPU8.buffer,r,h.length);for(let y=0;y<h.length;++y)q[y]=h[y];k.setModifications(p.context,r,h.length,p.isGeodetic);k._free(r)}function m(p,h){if(!k)return null;const {context:r,
localOrigin:q,globalTrafo:y,mbs:B,obb:D,elevationOffset:z,geometryBuffer:v,geometryDescriptor:A,indexToVertexProjector:t,vertexToRenderProjector:C}=p;var E=k._malloc(v.byteLength),F=k._malloc(33*Float64Array.BYTES_PER_ELEMENT),H=new Uint8Array(k.HEAPU8.buffer,E,v.byteLength);H.set(new Uint8Array(v));var K=new Float64Array(k.HEAPU8.buffer,F,33);f(K,q);var I=K.byteOffset+3*K.BYTES_PER_ELEMENT,L=new Float64Array(K.buffer,I);f(L,y);I+=16*K.BYTES_PER_ELEMENT;L=new Float64Array(K.buffer,I);f(L,B);I+=4*
K.BYTES_PER_ELEMENT;b.isSome(D)&&(L=new Float64Array(K.buffer,I),f(L,D.center),I+=3*K.BYTES_PER_ELEMENT,L=new Float64Array(K.buffer,I),f(L,D.halfSize),I+=3*K.BYTES_PER_ELEMENT,L=new Float64Array(K.buffer,I),f(L,D.quaternion));K={isDraco:!1,isLegacy:!1,color:p.layouts.some(O=>O.some(J=>"color"===J.name)),normal:p.needNormals&&p.layouts.some(O=>O.some(J=>"normalCompressed"===J.name)),uv0:p.layouts.some(O=>O.some(J=>"uv0"===J.name)),uvRegion:p.layouts.some(O=>O.some(J=>"uvRegion"===J.name)),featureIndex:A.featureIndex};
H=k.process(r,!!p.obb,E,H.byteLength,A,K,F,z,t,C,p.normalReferenceFrame);k._free(F);k._free(E);if(0<H.error.length)throw Error(`i3s.wasm: ${H.error}`);if(H.discarded)return null;E=0<H.componentOffsets.length?H.componentOffsets.slice():null;F=0<H.featureIds.length?H.featureIds.slice():null;K=H.interleavedVertedData.slice().buffer;I=H.indicesType===c.IndexType.Int16?(new Uint16Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/2)).slice():(new Uint32Array(H.indices.buffer,H.indices.byteOffset,
H.indices.byteLength/4)).slice();L=H.positions.slice();const R=H.positionIndicesType===c.IndexType.Int16?(new Uint16Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/2)).slice():(new Uint32Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/4)).slice();p={layout:p.layouts[0],interleavedVertexData:K,indices:I,hasColors:H.hasColors,hasModifications:H.hasModifications,positionData:{data:L,indices:R}};F&&h.push(F.buffer);E&&h.push(E.buffer);
h.push(K);h.push(I.buffer);h.push(L.buffer);h.push(R.buffer);return{componentOffsets:E,featureIds:F,transformedGeometry:p,obb:H.obb}}function l(p){const {context:h,buffer:r}=p;p=k._malloc(r.byteLength);const q=r.byteLength/Float64Array.BYTES_PER_ELEMENT,y=new Float64Array(k.HEAPU8.buffer,p,q),B=new Float64Array(r);y.set(B);k.filterOBBs(h,p,q);B.set(y);k._free(p)}function g(p){k&&(k.destroy(p),k=null)}function f(p,h){for(let r=0;r<h.length;++r)p[r]=h[r]}function d(){if(k)return Promise.resolve();e||
(e=w.get().then(p=>{k=p;e=null}));return e}let e,k;const u={transform:m,destroy:g};a.destroyContext=function(p){g(p)};a.dracoDecompressPointCloudData=async function(p){await d();const h=[p.geometryBuffer];var {geometryBuffer:r}=p,q=r.byteLength;p=k._malloc(q);q=new Uint8Array(k.HEAPU8.buffer,p,q);q.set(new Uint8Array(r));r=k.dracoDecompressPointCloudData(p,q.byteLength);k._free(p);if(0<r.error.length)throw Error(`i3s.wasm: ${r.error}`);p=0<r.featureIds?.length?r.featureIds.slice():null;r=r.positions.slice();
p&&h.push(p.buffer);h.push(r.buffer);return{result:{positions:r,featureIds:p},transferList:h}};a.filterObbsForModifications=async function(p){await d();l(p);p={buffer:p.buffer};return{result:p,transferList:[p.buffer]}};a.filterObbsForModificationsSync=l;a.initialize=d;a.interpretObbModificationResults=function(p){return 0===p?n.NodeIMModificationImpact.Unmodified:1===p?n.NodeIMModificationImpact.PotentiallyModified:2===p?n.NodeIMModificationImpact.Culled:n.NodeIMModificationImpact.Unknown};a.process=
async function(p){await d();const h=[p.geometryBuffer];return{result:m(p,h),transferList:h}};a.setLegacySchema=async function(p){await d();k.setLegacySchema(p.context,p.jsonSchema)};a.setModifications=async function(p){await d();x(p)};a.setModificationsSync=x;a.test=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,c){function w(x){return c.getAssetUrl(`esri/libs/i3s/${x}`)}let n;b.get=function(){n||
(n=(new Promise(x=>(new Promise((m,l)=>a(["../../chunks/i3s"],m,l))).then(m=>m.i3s).then(({default:m})=>{const l=m({locateFile:w,onRuntimeInitialized:()=>x(l)});delete l.then}))).catch(x=>{throw x;}));return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../II3SMeshView3D"],function(a,b,c){let w=a._createClass(function(){this.ids=new Set;this.paused=
!1});return function(){function n({collection:m,forAllFeatures:l,forAllFeaturesOfNode:g}){this._highlights=[];this._collection=m;this._forAllFeatures=l;this._forAllFeaturesOfNode=g}var x=n.prototype;x.destroy=function(){this._highlights.forEach(m=>this._releaseSet(m));this._highlights=null};x.acquireSet=function(){const m=new w;this._highlights.push(m);return{set:m,handle:{remove:()=>{this._highlights&&(this._releaseSet(m),b.removeUnordered(this._highlights,m))},pause:()=>{this._releaseSet(m);m.paused=
!0},resume:()=>{m.paused=!1;this._initializeSet(m)}}}};x.setFeatureIds=function(m,l){l.forEach(g=>m.ids.add(g));this._initializeSet(m)};x._initializeSet=function(m){this._forAllFeatures((l,g,f)=>{m.ids.has(l)&&this._collection.addComponentHighlight(f.objectHandle,g);return c.ForAllFeaturesReturnType.CONTINUE})};x._releaseSet=function(m){this._forAllFeatures((l,g,f)=>{m.ids.has(l)&&this._collection.removeComponentHighlight(f.objectHandle,g);return c.ForAllFeaturesReturnType.CONTINUE})};x.objectCreated=
function(m){this._highlights.forEach(l=>{l.paused||this._forAllFeaturesOfNode(m,(g,f)=>{l.ids.has(g)&&this._collection.addComponentHighlight(m.objectHandle,f);return c.ForAllFeaturesReturnType.CONTINUE})})};x.objectDeleted=function(m){this._collection.clearHighlights(m.objectHandle)};return a._createClass(n)}()})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e){a.I3SAsyncElevationUpdater=function(k){function u(h,r,q){var y=p.call(this,{});y._updateExtent=r;y._updateNode=q;y.running=!1;y._extentSet=new d.ExtentSet;y._nodeSet=new Set;y.addHandles(h.registerTask(e.TaskPriority.ELEVATION_ALIGNMENT,b._assertThisInitialized(y)));return y}b._inherits(u,k);var p=b._createSuper(u);k=u.prototype;k.normalizeCtorArgs=function(){return{}};k.addExtent=function(h){this._extentSet.add(h);this.running=!0};k.schedule=function(h){this._nodeSet.add(h);
this.running=!0};k.remove=function(h){this._nodeSet.delete(h);this._updateRunning()};k.runTask=function(h){const r=this._extentSet;for(h.run(()=>r.merge(h));!r.empty&&!h.done;){var q=this._updateExtent(r.pop());n.isSome(q)&&q.forAll(y=>this.schedule(y));h.madeProgress()}if(!h.done){q=this._nodeSet;for(const y of q)if(q.delete(y),this._updateNode(y),h.madeProgress(),h.done)break;this._updateRunning()}};k._updateRunning=function(){this.running=0<this._nodeSet.size||0<this._extentSet.size};return b._createClass(u)}(w);
c.__decorate([x.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=c.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],a.I3SAsyncElevationUpdater);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,
c,w,n){let x=b._createClass(function(){this.lodCrossfadeSignedDuration=0}),m=function(){function l(f){this._view=f;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var g=l.prototype;g.destroy=function(){this._preRenderFrameTaskHandle?.remove();this._view=this._preRenderFrameTaskHandle=null};g.stopNodeFading=function(f){null!=f.lodCrossfadeProgress&&(this._numFadingNodes--,f.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&
(this._preRenderFrameTaskHandle=c.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))};g._startNodeFading=function(f,d,e){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=w.addFrameTask({preRender:k=>this._updateAllNodeFading(k)}),this._view.notifyLODUpdate());null==f.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());f.lodCrossfadeSignedDuration=e;f.lodCrossfadeProgress=d};g._updateAllNodeFading=function(f){const d=
this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((e,k)=>{if(c.isSome(k)&&c.isSome(k.lodCrossfadeProgress)){const u=k.lodCrossfadeSignedDuration,p=k.lodCrossfadeProgress+Math.abs(f.deltaTime/u),h=!d||1<=p||0===u,r=(0<u?this._view.fullOpacity:0)-(h?0:0<u?1:-1)*(1-p);h?(this.stopNodeFading(k),0>u&&this._view.markNodeToRemove(e)):k.lodCrossfadeProgress=p;this._view.setNodeOpacityByIndex(e,r)}});this._view.removeMarkedNodes()};g.stopAllNodeFading=function(){this._view.foreachCrossfadeNode((f,
d)=>{c.isSome(d)&&c.isSome(d.lodCrossfadeProgress)&&(this.stopNodeFading(d),d=d.lodCrossfadeSignedDuration,0>d&&this._view.markNodeToRemove(f),this._view.setNodeOpacityByIndex(f,0<d?this._view.fullOpacity:0))});this._view.removeMarkedNodes()};g.fadeNode=function(f,d,e,k){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var u=this._view;const p=u.nodeCrossfadingEnabled,h=e===n.FadeDirection.FadeIn?u.fullOpacity:0;k=p?k?e===n.FadeDirection.FadeIn?u.lodCrossfadeinDuration:
u.lodCrossfadeoutDuration:u.lodCrossfadeUncoveredDuration:0;u=this._view.getNodeOpacityByIndex(f);p&&u!==h&&0<k?this._startNodeFading(d,1-Math.abs(h-u),(e===n.FadeDirection.FadeIn?1:-1)*k):(this.stopNodeFading(d),this._view.setNodeOpacityByIndex(f,h),e===n.FadeDirection.FadeOut&&this._view.removeNode(f))};g.isNodeFullyFadedIn=function(f){const d=this._view.getNodeCrossfadeMetaData(f);return c.isNone(d)||null==d.lodCrossfadeProgress&&this._view.getNodeOpacityByIndex(f)===this._view.fullOpacity};b._createClass(l,
[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return l}();a.I3SCrossfadeHelper=m;a.NodeCrossfadeMetaData=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){const D=r.empty(),z=k.create(),v=q.fromValues(0,0,0,0),A=p.create(),t=p.create(),C=p.create();c=function(E){function F(K){K=H.call(this,K);K._tmpEvent={spatialReference:null,extent:D,context:"scene"};return K}a._inherits(F,E);var H=a._createSuper(F);E=F.prototype;E.initialize=function(){this.view=this.layerView.view;this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersector=y.newIntersector(this.view.state.viewingMode);this._intersector.options.store=
B.StoreResults.MIN;const K=this.layerView.i3slayer.fullExtent;x.isNone(K)?n.getLogger(this.declaredClass).error("I3SElevationProvider expected fullExtent on I3SLayer."):(this._zmin=K.zmin,this._zmax=K.zmax);this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};E.getElevation=function(K,I,L,R){A[0]=K;A[1]=I;A[2]=L;if(!this._renderCoordsHelper.toRenderCoords(A,R,A))return n.getLogger(this.declaredClass).error("could not project point to compute elevation"),null;K=this.layerView.elevationOffset;
I=this._zmin+K;this._renderCoordsHelper.setAltitude(t,this._zmax+K,A);this._renderCoordsHelper.setAltitude(C,I,A);this._intersector.reset(t,C,null);this.intersectionHandler.intersect(this._intersector,null,t,C);return this._intersector.results.min.getIntersectionPoint(A)?this._renderCoordsHelper.getAltitude(A):null};E.getSphereElevationBounds=function(K,I){h.projectBoundingSphere(K,I,v,this._renderCoordsHelper.spatialReference);return this.layerView.getElevationRange(v)};E.layerChanged=function(){this.spatialReference&&
(this._tmpEvent.extent=this._computeLayerExtent(),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};E.objectChanged=function(K){this.spatialReference&&(this._tmpEvent.extent=this._computeObjectExtent(K),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};E._computeObjectExtent=function(K){r.empty(D);this._expandExtent(K,D);return D};E._computeLayerExtent=function(){r.empty(D);for(const K of this.layerView.getVisibleNodes())this._expandExtent(K,
D);return D};E._expandExtent=function(K,I){const L=this.spatialReference;if(!x.isNone(L)&&(K=this.layerView.getNodeComponentObb(K),!x.isNone(K))){e.fromQuat(z,K.quaternion);z[12]=K.center[0];z[13]=K.center[1];z[14]=K.center[2];for(let R=0;8>R;++R)A[0]=R&1?K.halfSize[0]:-K.halfSize[0],A[1]=R&2?K.halfSize[1]:-K.halfSize[1],A[2]=R&4?K.halfSize[2]:-K.halfSize[2],u.transformMat4(A,A,z),this._renderCoordsHelper.fromRenderCoords(A,A,L),r.expand(I,A,I)}};a._createClass(F,[{key:"spatialReference",get:function(){return this.view?.elevationProvider?.spatialReference}}]);
return F}(w.EventedMixin(c));b.__decorate([m.property({constructOnly:!0})],c.prototype,"layerView",void 0);b.__decorate([m.property({constructOnly:!0})],c.prototype,"intersectionHandler",void 0);b.__decorate([m.property()],c.prototype,"view",void 0);b.__decorate([m.property()],c.prototype,"spatialReference",null);return c=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],c)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../ViewingMode ./I3SUtil ./Intersector ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f){function d(k,u,p,h=0){h=k[3]+h;const r=u[0]-k[0],q=u[1]-k[1];k=u[2]-k[2];u=p[0];const y=p[1];p=p[2];const B=u*r+y*q+p*k;return 0<=B*B-(u*u+y*y+p*p)*(r*r+q*q+k*k-h*h)}let e=function(){function k(p){this.type=g.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=p.layerUid;this.sublayerUid=p.sublayerUid;this._collection=p.collection;this._traverseNodeHierarchy=p.traverseNodeHierarchy;this.slicePlaneEnabled=p.slicePlaneEnabled;this.isGround=p.isGround}var u=k.prototype;
u.updateElevationAlignState=function(p,h){this._needVerticalOffset=p&&h===w.ViewingMode.Global};u.intersect=function(p,h,r,q){const y=p.results,B=p.options.store===g.StoreResults.ALL,D=p.ray.direction,z=p.tolerance;let v=C=>C,A=C=>C;const t=f.getVerticalOffsetI3S(c.isSome(p.verticalOffset)?p.verticalOffset:this._needVerticalOffset?0:null);c.isSome(p.verticalOffset)&&c.isSome(t)&&(v=C=>t.applyToMbs(C),A=C=>t.applyToObb(C));this._traverseNodeHierarchy((C,E)=>{if(0===C.childrenLoaded)return!1;const F=
c.isSome(C.serviceObbInRenderSR)&&n.isValidObb(C.serviceObbInRenderSR)?C.serviceObbInRenderSR:null;if(c.isSome(F)&&!m.intersectLine(A(F),r,D,z))return!1;E&&(c.isSome(F)||!n.isValidMbs(C.renderMbs)||d(v(C.renderMbs),r,D,z))&&(c.isNone(C.geometryObb)||m.intersectLine(A(C.geometryObb),r,D,z))&&this._collection.intersect(E,r,q,z,t,(H,K,I,L)=>{if(0<=K&&(null==h||h(r,q,K))){var R=O=>{const J=new x.I3sTarget(this.layerUid,this.sublayerUid,C.index,H,L);O.set(this.type,J,K,I)};this.isGround&&(null==y.ground.dist||
K<y.ground.dist)&&R(y.ground);if(!p.options.isFiltered&&((null==y.min.dist||K<y.min.dist)&&R(y.min),(null==y.max.dist||K>y.max.dist)&&R(y.max),B)){const O=l.newIntersectorResult(p.ray);R(O);p.results.all.push(O)}}});return!0})};return b._createClass(k)}();a.I3SIntersectionHandler=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../support/featureFlags ../FeatureLayerView3D".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B){a.I3SOverrides=function(v){function A(C){C=t.call(this,C);C._warnMaximumChangedObjectsExceeded=!1;C._interactiveEditingSessions=null;C._maximumNumberOfEditOVerrides=5E4;C._original3DOFLDefinitionExpression=null;C._associatedLayerView=null;C._changedObjectIds=new Set;C._pendingFetchChangedObjectIds=null;C._pendingFetchAbortController=new AbortController;return C}b._inherits(A,v);var t=b._createSuper(A);v=A.prototype;v.initialize=function(){this._memCache=
this.memoryController.newCache(`${this.layer.uid}-attribute-overrides`);this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.then(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null});this.is3DOFL&&y.direct3DObjectFeatureLayerDisplayEnabled()&&f.isSome(this._associatedLayer)&&this._associatedLayer.load().then(C=>{this.destroyed||(this._original3DOFLDefinitionExpression=C.definitionExpression,
this.addHandles(e.watch(()=>this._definitionExpression,E=>C.definitionExpression=E,e.initial)),this._associatedLayerView=new B({layer:this._associatedLayer,view:this.view}))})};v.destroy=function(){this.is3DOFL&&y.direct3DObjectFeatureLayerDisplayEnabled()&&f.isSome(this._associatedLayerView)&&f.isSome(this._associatedLayer)&&(this._associatedLayer.definitionExpression=f.unwrap(this._original3DOFLDefinitionExpression));this._set("layer",null);this._memCache=f.destroyMaybe(this._memCache);this._pendingFetchAbortController=
f.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=null};v.createInteractiveEditSession=function(C){this._changedObjectIds.add(C);this.notifyChange("_changedObjectIds");f.isNone(this._interactiveEditingSessions)&&(this._interactiveEditingSessions=[]);const E=this._interactiveEditingSessions,F=new D(C,{rollback:()=>{x.remove(E,F);0===E.length&&(this._interactiveEditingSessions=null)},commit:H=>{for(const [K,I]of H)this.updateAttributeValue(C,K,I)}});E.unshift(F);return F};
v.apply=async function(C,E,F){if(!f.isNone(E)){var {loadedAttributes:H,attributeData:K}=E;if(!f.isNone(H)&&0!==H.length&&!f.isNone(K)&&(this._pendingFetchChangedObjectIds&&await d.whenOrAbort(this._pendingFetchChangedObjectIds,F),0!==this._changedObjectIds.size)){E={loadedAttributes:H,attributeData:K};var I=this._getOverridesFromCache(C,E,this._changedObjectIds),{objectIds:L,fieldNames:R}=I;0!==L.length&&0!==R.length&&(F=await this._queryOverridesFromAssociatedLayer(L,R,F),f.isNone(F)||this._processOverridesFromAssociatedLayer(C,
F,R,E))}}};v.updateGeometry=function(C){this._changedObjectIds.add(C);this.notifyChange("_changedObjectIds")};v.updateAttributeValue=function(C,E,F){this._changedObjectIds.add(C);this._cacheAttributeValue(C,E,F);this.notifyChange("_changedObjectIds")};v._cacheAttributeValue=function(C,E,F){this._memCache.put(this._getAttributeCacheKey(C,E),F,this._memCacheAttributeValueSize(F))};v._getOverridesFromCache=function(C,{loadedAttributes:E,attributeData:F},H){const K=new Set,I=[];for(var L of E)I[L.index]=
F[L.name];F=new Set;for(L=0;L<C.length;L++){const R=C[L];if(H.has(R))for(const O of E){const J=this._fromCache(R,O.index);void 0!==J?I[O.index][L]=J:(K.add(R),F.add(O.name))}}return{objectIds:Array.from(K),fieldNames:Array.from(F)}};v._fromCache=function(C,E){const F=this._fromInteractiveEditingSession(C,E);if(void 0!==F)return F;C=this._getAttributeCacheKey(C,E);return this._memCache.get(C)};v._fromInteractiveEditingSession=function(C,E){if(!f.isNone(this._interactiveEditingSessions))for(const F of this._interactiveEditingSessions){if(F.objectId!==
C)continue;const H=F.get(E);if(void 0!==H)return H}};v._getAttributeCacheKey=function(C,E){return`${C}-${E}`};v._queryOverridesFromAssociatedLayer=async function(C,E,F){if(0===C.length||0===E.length)return null;C=C.sort((I,L)=>I-L);this._warnMaximumChangedObjectsExceeded&&(this._warnMaximumChangedObjectsExceeded=!1,this._logMaximumObjectsExceededWarning());const H=this.layer.associatedLayer;if(f.isNone(H))return null;const K=H.createQuery();K.where="1\x3d1";K.returnGeometry=!1;K.outFields=[H.objectIdField,
...E];K.cacheHint=!0;K.objectIds=C;E=q.getMaximumQuerySize(H);C=C.length>E?x.splitIntoChunks(C,E).map(I=>{const L=K.clone();L.objectIds=I;return m.resultOrAbort(q.queryAllJSON(H,L,{signal:F}))}):[m.resultOrAbort(q.queryAllJSON(H,K,{signal:F}))];return(await Promise.all(C)).reduce((I,L)=>I.concat(L.ok?L.value.features:[]),[])};v._logMaximumObjectsExceededWarning=function(){let C=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${r.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const E=this.layer.portalItem;C=E&&E.loaded?C+` (${E.portal.url}/home/item.html?id=${E.id}#settings)`:C+` (${this.layer.parsedUrl.path})`;g.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,`${C}.`)};v._processOverridesFromAssociatedLayer=function(C,E,F,{loadedAttributes:H,attributeData:K}){var I=this.layer.associatedLayer;if(!f.isNone(I)){I=I.objectIdField;var L=F.map(O=>K[O]),R=new Map(H.map(O=>[O.name,O.index]));H=F.map(O=>R.get(O));C=new Map(Array.from(C,
(O,J)=>[O,J]));for(const O of E){E=O.attributes[I];for(let J=0;J<F.length;J++){const M=H[J],G=C.get(E),P=O.attributes[F[J]];L[J][G]=P;this._cacheAttributeValue(E,M,P)}}}};v._memCacheAttributeValueSize=function(C){return"string"===typeof C?l.estimateStringByteSize(C):l.estimateNumberByteSize()};v._fetchChangedObjectIds=async function(C){var E=this.layer;await E.load({signal:C});this._changedObjectIds.clear();if(!f.isNone(E.associatedLayer)&&E.associatedLayer.capabilities?.operations?.supportsChangeTracking){var F=
this._getFetchChangedObjectIdsServerGen();if(!f.isNone(F)){var H=E.associatedLayer.layerId,K=f.isSome(E.associatedLayer.infoFor3D);C=await m.result(w(`${E.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`[${H}]`,returnUpdates:!0,returnDeletes:K,returnInserts:K,layerServerGens:JSON.stringify([{id:H,serverGen:F}])},timeout:1E4,signal:C}));if(C.ok&&C.value.data?.edits&&1===C.value.data.edits.length)for(F=C.value.data.edits[0],C=f.get(F,"objectIds","adds"),
E=f.get(F,"objectIds","updates"),H=f.get(F,"objectIds","deletes"),F=[],f.isSome(C)&&(F=F.concat(C)),f.isSome(E)&&(F=F.concat(E)),f.isSome(H)&&(F=F.concat(H)),C=Math.min(this._maximumNumberOfEditOVerrides,F.length),C<F.length&&(this._warnMaximumChangedObjectsExceeded=!0),E=F.sort((I,L)=>I-L),F=0;F<C;F++)this._changedObjectIds.add(E[F]);this.notifyChange("_changedObjectIds")}}};v._getFetchChangedObjectIdsServerGen=function(){var C=this.layer;if(f.isSome(C.serviceUpdateTimeStamp)&&f.isSome(C.serviceUpdateTimeStamp.lastUpdate))return C.serviceUpdateTimeStamp.lastUpdate;
C=C.associatedLayer;return f.isSome(C)&&f.isSome(C.serverGens)&&f.isSome(C.serverGens.minServerGen)?C.serverGens.minServerGen:null};b._createClass(A,[{key:"is3DOFL",get:function(){return y.sceneLayerEditingEnabled()&&f.isSome(this._associatedLayer)&&f.isSome(this._associatedLayer.infoFor3D)}},{key:"geometryChangedObjectIds",get:function(){return this.is3DOFL?[...this._changedObjectIds]:[]}},{key:"_associatedLayer",get:function(){return null==this.layer?null:this.layer.associatedLayer}},{key:"_definitionExpression",
get:function(){const C=this.geometryChangedObjectIds;return 0===C.length?"1 \x3d 0":`OBJECTID IN (${C.join(",")})`}},{key:"updating",get:function(){return this.is3DOFL&&y.direct3DObjectFeatureLayerDisplayEnabled()?!f.isSome(this._associatedLayerView)||f.isSome(this._associatedLayerView)&&this._associatedLayerView.updating:!1}},{key:"isEmpty",get:function(){return null==this._pendingFetchChangedObjectIds&&0===this._changedObjectIds.size}},{key:"test",get:function(){const C=this;return{changedObjectIds:Array.from(this._changedObjectIds),
pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return C._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(E){C._maximumNumberOfEditOVerrides=E}}}}]);return A}(n);c.__decorate([k.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);c.__decorate([k.property({constructOnly:!0})],a.I3SOverrides.prototype,"layer",void 0);c.__decorate([k.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);c.__decorate([k.property({readOnly:!0})],
a.I3SOverrides.prototype,"geometryChangedObjectIds",null);c.__decorate([k.property()],a.I3SOverrides.prototype,"_associatedLayer",null);c.__decorate([k.property()],a.I3SOverrides.prototype,"_associatedLayerView",void 0);c.__decorate([k.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);c.__decorate([k.property()],a.I3SOverrides.prototype,"_changedObjectIds",void 0);c.__decorate([k.property()],a.I3SOverrides.prototype,"_pendingFetchChangedObjectIds",void 0);c.__decorate([k.property()],
a.I3SOverrides.prototype,"_definitionExpression",null);c.__decorate([k.property()],a.I3SOverrides.prototype,"updating",null);c.__decorate([k.property()],a.I3SOverrides.prototype,"isEmpty",null);a.I3SOverrides=c.__decorate([h.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);let D=function(){function v(t,C){this.objectId=t;this._options=C;this._updates=new Map;this._state=z.ACTIVE}var A=v.prototype;A.get=function(t){return this._updates.get(t)};A.set=function(t,C){this._isActive&&
this._updates.set(t,C)};A.rollback=function(){this._isActive&&(this._state=z.ROLLED_BACK,this._options.rollback())};A.commit=function(){this._isActive&&(this._state=z.COMMITTED,this._options.commit(this._updates),this._updates.clear())};b._createClass(v,[{key:"_isActive",get:function(){return this._state===z.ACTIVE}}]);return v}();var z;(function(v){v[v.ACTIVE=0]="ACTIVE";v[v.COMMITTED=1]="COMMITTED";v[v.ROLLED_BACK=2]="ROLLED_BACK"})(z||(z={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/featureQueryAll":function(){define(["exports","../../core/maybe","../../rest/support/Query"],function(a,b,c){function w(m){return x(m)*n(m)}function n(m){return m.capabilities.query.maxRecordCount||2E3}function x(m){return m.capabilities.query.supportsMaxRecordCountFactor?c.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=x;a.getMaximumQuerySize=w;a.getMaximumRecordCount=n;a.queryAllJSON=async function(m,l,g){l=l.clone();m.capabilities.query.supportsMaxRecordCountFactor&&
(l.maxRecordCountFactor=x(m));const f=w(m),d=m.capabilities.query.supportsPagination;l.start=0;l.num=f;let e=null;for(;;){const k=await m.source.queryFeaturesJSON(l,g);b.isNone(e)?e=k:e.features=e.features.concat(k.features);e.exceededTransferLimit=k.exceededTransferLimit;if(!d||!k.exceededTransferLimit)break;l.start+=f}return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils".split(" "),
function(a,b,c,w,n,x){function m(f){return new Promise((d,e)=>{f.oncomplete=()=>d();f.onerror=()=>e(f.error);f.onabort=()=>e(f.error)})}function l(f){return new Promise((d,e)=>{"done"===f.readyState?null!=f.error?e(f.error):d(f.result):(f.onsuccess=()=>d(f.result),f.onerror=()=>e(f.error))})}let g=function(){function f(e,k,u=14){this._version=u;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=c.ByteSizeUnit.GIGABYTES;
this.quotaReductionFactor=.2;this._dbName=e;this._storeName=k}var d=f.prototype;d.init=function(){return Promise.resolve().then(()=>{const e=indexedDB.open(this._dbName,this._version);e.onupgradeneeded=k=>{var u=e.result;const p=e.transaction,h=u.objectStoreNames.contains(this._storeName)?p.objectStore(this._storeName):u.createObjectStore(this._storeName);u=u.objectStoreNames.contains("last_access")?p.objectStore("last_access"):u.createObjectStore("last_access");u.indexNames.contains("date")||u.createIndex("date",
"date",{unique:!1});u.indexNames.contains("byteSize")||u.createIndex("byteSize","byteSize",{unique:!1});k.oldVersion<this._version&&(h.clear(),u.clear())};return l(e)}).then(e=>{this._destroyed?e.close():this._db=e})};d.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};d.getHitRate=function(){return this._hit/(this._hit+this._miss)};d.put=function(e,k){return null==this._db?Promise.reject(new w("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=
this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(e,k)).catch(u=>{if(u&&"QuotaExceededError"===u.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(p=>this._removeLeastRecentlyAccessed(k.byteSize+Math.ceil(p*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(e,k));throw u;
}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(u=>this._removeLeastRecentlyAccessed(u-this.maxByteSize)))})};d.get=function(e,k){const u=this._db;if(null==u)return Promise.resolve(void 0);let p=null;return Promise.resolve().then(()=>{const h=u.transaction(this._storeName,"readonly");p=x.onAbort(k,()=>{h.abort()});const r=h.objectStore(this._storeName).get(e);return l(r)}).then(h=>{null==h?++this._miss:this._db&&(++this._hit,
this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:h.byteSize},e));n.isSome(p)&&p.remove();return h}).catch(()=>{++this._miss;x.throwIfAborted(k);n.isSome(p)&&p.remove()})};d.remove=function(e){const k=this._db;return null==k?Promise.resolve():Promise.resolve().then(async()=>{const u=k.transaction([this._storeName,"last_access"],"readwrite");var p=u.objectStore(this._storeName),h=u.objectStore("last_access");p=p.delete(e);h=h.delete(e);await Promise.all([l(p),
l(h),m(u)])})};d._put=function(e,k){var u=this._db;if(null==u)return Promise.resolve();u=u.transaction([this._storeName,"last_access"],"readwrite");var p=u.objectStore(this._storeName);const h=u.objectStore("last_access");p=p.put(k,e);e=h.put({date:Date.now(),byteSize:k.byteSize},e);return Promise.all([l(p),l(e),m(u)])};d._removeLeastRecentlyAccessed=function(e){if(0>=e||!this._db)return Promise.resolve();const k=this._db.transaction([this._storeName,"last_access"],"readwrite"),u=k.objectStore(this._storeName),
p=k.objectStore("last_access");let h=0;const r=p.index("date").openCursor(null,"next");r.onsuccess=()=>{const q=r.result;null!=q&&(null!=q.value.byteSize&&(h+=q.value.byteSize),u.delete(q.primaryKey),p.delete(q.primaryKey),h<e&&q.continue())};return m(k)};d._getCacheSize=function(){var e=this._db;if(null==e)return Promise.resolve(0);e=e.transaction("last_access");let k=0;const u=e.objectStore("last_access").index("byteSize").openKeyCursor();u.onsuccess=()=>{const p=u.result;if(p){var h=p.key;null!=
h&&(k+=h);p.continue()}};return m(e).then(()=>k)};b._createClass(f,[{key:"initialized",get:function(){return null!=this._db}}]);return f}();a.IDBCache=g;a.whenRequest=l;a.whenTransaction=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function w(){this._data=new Map;this._hit=this._miss=0;this.initialized=!0}var n=w.prototype;n.init=
function(){return Promise.resolve()};n.get=async function(x,m){if(this._data.has(x))return this._hit++,this._data.get(x)??void 0;this._miss++};n.destroy=function(){};n.put=function(x,m){this._data.set(x,m);return Promise.resolve()};n.remove=function(x){this._data.delete(x);return Promise.resolve()};n.getHitRate=function(){return this._hit/(this._hit+this._miss)};return b._createClass(w)}();a.IDBMockCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports",
"../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(a,b,c,w){function n(d,e){const k=e.edits.updateFeatures;if(!k||0===k.length)return new f;const u=x(e),p=new f;e=new Map;for(let y=0;y<d.attributeStorageInfo.length;y++)e.set(d.attributeStorageInfo[y].name,y);const h=d.fieldsIndex,r=d.objectIdField,q=k.filter(y=>{y=w.attributeLookup(h,y.attributes,r);return u.has(y)});d.forEachNode((y,B)=>{const D=new Set(B);for(const C of q){const E=w.attributeLookup(h,C.attributes,
r);if(!D.has(E))continue;const F=B.indexOf(E);for(const H in C.attributes){var z=d.fieldsIndex.normalizeFieldName(H);var v=p;var A=y.index,t=v.get(A);t?v=t:(t=new g,v.set(A,t),v=t);(A=null!=z&&v.get(z))?z=A:(A=[],v.set(z,A),z=A);z.push({featureIndex:F,featureId:E,value:C.attributes[H]})}}});return p}function x(d){const e=new Set;if(!d.updatedFeatures)return e;for(const k of d.updatedFeatures)null!=k.objectId&&null==k.error&&e.add(k.objectId);return e}const m={setAttribute(){},rollback(){},commit(){}};
var l;(function(d){d[d.EDITING=0]="EDITING";d[d.ROLLED_BACK=1]="ROLLED_BACK";d[d.COMMITTED=2]="COMMITTED"})(l||(l={}));const g=Map,f=Map;a.createInteractiveEditSession=function(d,e){const k=e.attributes[d.objectIdField];var u=d.sessions.get(k);if(u)return u;const p=b.clone(e.attributes),h=new Set;if(null==k)return m;const r=d.i3sOverrides.createInteractiveEditSession(k),q=new Map;let y=l.EDITING;u={setAttribute(B,D){if(y===l.EDITING){var z=d.fieldsIndex.get(B);if(!c.isNone(z)){var v=d.attributeStorageInfo.findIndex(C=>
C.name===z.name);if(!(0>v)){r.set(v,D);var A=d.attributeStorageInfo[v],t=!1;h.add(B);d.forEachNode((C,E)=>{var F=q.get(C);null==F?(E=E.indexOf(k),q.set(C,E)):E=F;if(-1!==E&&(F=d.getAttributeData(C.index))){const H=F[A.name];H&&(H[E]=D,d.setAttributeData(C.index,F,e),t=!0)}});t&&d.clearMemCache()}}}},rollback(){if(y===l.EDITING){for(const B of h)this.setAttribute(B,p[B]);r.rollback();y=l.ROLLED_BACK;d.sessions.delete(k)}},commit(){y===l.EDITING&&(r.commit(),y=l.COMMITTED,d.sessions.delete(k))}};d.sessions.set(k,
u);return u};a.processAttributeEdits=function(d,e){e=n(d,e);if(0!==e.size){var k=new Map;for(let p=0;p<d.attributeStorageInfo.length;p++)k.set(d.attributeStorageInfo[p].name,p);var u=!1;e.forEach((p,h)=>{const r=d.getAttributeData(h);let q=!1;p.forEach((y,B)=>{const D=c.isSome(r)?r[B]:null;B=k.get(B);for(const {featureIndex:z,value:v,featureId:A}of y)D&&(D[z]=v,u=q=!0),d.i3sOverrides.updateAttributeValue(A,B,v)});q&&d.setAttributeData(h,r,null)});u&&d.clearMemCache()}};a.processGeometryEdits=function(d,
e){e=[...e.addedFeatures,...e.updatedFeatures,...e.deletedFeatures];for(const k of e)k.objectId&&d.i3sOverrides.updateGeometry(k.objectId)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K){function I(T,X,Z){if(f.isNone(X))return null;if("disjoint"===Z&&"polygon"===X.type){Z=X.rings.length;const Y=X.spatialReference,aa=Array(Z);for(let ba=0;ba<Z;++ba){const ea=z.fromValues(Infinity,Infinity,-Infinity,-Infinity);z.expandWithNestedArray(ea,X.rings[ba]);aa[ba]={type:"polygon",rings:[X.rings[ba]],spatialReference:Y,cache:{},aabr:ea}}aa.sort((ba,ea)=>ba.aabr[0]-ea.aabr[0]);const ia=new Set,na=new m.PositionHint;for(X=0;X<
aa.length;++X){const ba=aa[X],ea=ba.aabr[0];ia.forEach(ja=>{ea>=ja.aabr[2]?ia.delete(ja):ba.aabr[1]>ja.aabr[3]||ba.aabr[3]<ja.aabr[1]||!T.intersects(ba,ja)||(ba.rings=ba.rings.concat(ja.rings),z.expand(ba.aabr,ja.aabr,ba.aabr),ba.cache={},ia.delete(ja),ja=m.indexOf(aa,ja,aa.length,na),aa.splice(ja,1))});ia.add(ba)}for(const ba of aa)ba.aabr=void 0;return aa}return[X]}function L(T,X,Z,Y,aa){const ia=J(T,X,Y);return Z.every(na=>M(T,na,ia,aa)!==Q.DISCARD)}function R(T,X,Z,Y,aa,ia,na,ba){const ea=na[0].spatialReference||
aa.spatialReference;if(B.projectBoundingSphere(Z.node.mbs,ia,W,ea)){ia=J(T,W,ea);var ja=O(ba,aa,ea,Y,Z.objectHandle);for(const ka of na){if(0===X.length)break;switch(M(T,ka,ia,ba)){case Q.DISCARD:X.length=0;return;case Q.KEEP:continue}H.filterInPlace(X,Z.featureIds,da=>U(T,ka,da,ja))}}else N.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function O(T,X,Z,Y,aa){X=X.renderSpatialReference;const ia=new Map,na={type:"polygon",rings:[[[0,0,0],
[0,0,0],[0,0,0],[0,0,0]]],spatialReference:Z};na.rings[0][3]=na.rings[0][0];let ba,ea;switch(T){case "intersects":ba=(ja,ka,da)=>ja.intersects(ka,da)?Q.KEEP:Q.TEST;ea=G;break;case "contains":ba=(ja,ka,da)=>ja.contains(ka,da)?Q.TEST:Q.DISCARD;ea=G;break;default:ba=(ja,ka,da)=>ja.disjoint(ka,da)?Q.TEST:Q.DISCARD,ea=P}return{collection:Y,object:aa,type:T,maskSR:Z,renderSR:X,aabbCache:ia,triangle:na,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:ba,geometryTest:ea}}function J(T,
X,Z){const Y={type:"point",x:X[0],y:X[1],hasZ:!1,hasM:!1,spatialReference:Z};Z=!t.isWGS84(Z)&&!t.isWebMercator(Z);X=Number.isNaN(X[3])?0:g.clamp(X[3],0,2*A.earth.radius);T=Z?T.buffer(Y,X,1):T.geodesicBuffer(Y,X,1);T.type="polygon";return T}function M(T,X,Z,Y){switch(Y){case "intersects":case "contains":return G(T,X,Z);case "disjoint":return P(T,X,Z)}}function G(T,X,Z){return T.intersects(X,Z)?T.contains(X,Z)?Q.KEEP:Q.TEST:Q.DISCARD}function P(T,X,Z){return T.intersects(X,Z)?T.contains(X,Z)?Q.DISCARD:
Q.TEST:Q.KEEP}function U(T,X,Z,Y){const {collection:aa,object:ia,renderSR:na,maskSR:ba,geometryTest:ea,aabbCache:ja}=Y;var ka=ja.get(Z);if(!ka){ka=aa.getObjectTransform(ia);aa.getComponentAabb(ia,Z,V);var da=[[V[0],V[1],0],[V[0],V[4],0],[V[3],V[4],0],[V[3],V[1],0]];for(var ha=0;4>ha;++ha)q.transformMat3(da[ha],da[ha],ka.rotationScale),q.add(da[ha],da[ha],ka.position),B.projectVectorToVector(da[ha],na,da[ha],ba);ka={type:"polygon",rings:[da],spatialReference:ba,cache:{}};ka.rings[0][4]=ka.rings[0][0];
ja.set(Z,ka)}switch(ea(T,X,ka)){case Q.DISCARD:return!1;case Q.KEEP:return!0}const {triangle:ca,triangleTest:fa,positions:ma}=Y;ka=ca.rings[0][0];da=ca.rings[0][1];ha=ca.rings[0][2];const qa=aa.getObjectTransform(ia);aa.getComponentPositions(ia,Z,ma);const {indices:wa,data:xa,stride:pa,startIndex:ra,endIndex:va}=ma;for(Z=ra;Z<va;Z+=3){const Ba=pa*wa[Z],Aa=pa*wa[Z+1],Ha=pa*wa[Z+2];q.set(ka,xa[Ba],xa[Ba+1],xa[Ba+2]);q.set(da,xa[Aa],xa[Aa+1],xa[Aa+2]);q.set(ha,xa[Ha],xa[Ha+1],xa[Ha+2]);q.transformMat3(ka,
ka,qa.rotationScale);q.transformMat3(da,da,qa.rotationScale);q.transformMat3(ha,ha,qa.rotationScale);q.add(ka,ka,qa.position);q.add(da,da,qa.position);q.add(ha,ha,qa.position);B.projectVectorToVector(ka,na,ka,ba);B.projectVectorToVector(da,na,da,ba);B.projectVectorToVector(ha,na,ha,ba);switch(fa(T,X,ca)){case Q.DISCARD:return!1;case Q.KEEP:return!0}}switch(Y.type){case "intersects":return!1;default:return!0}}const N=l.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");b.I3SMeshViewFilter=function(T){function X(Y){Y=
Z.call(this,Y);Y._projectionEngineLoaded=!1;return Y}c._inherits(X,T);var Z=c._createSuper(X);T=X.prototype;T.initialize=function(){e.whenOnce(()=>f.unwrap(this.viewFilter)?.geometry||f.isSome(this.layerFilter)).then(()=>this.loadAsyncModule((new Promise((Y,aa)=>a(["../../../../geometry/geometryEngine"],Y,aa))).then(Y=>{this.destroyed||(this._geometryEngine=Y)})))};T.addFilters=function(Y,aa,ia,na){const ba=this.sortedObjectIds;f.isSome(ba)&&Y.push(da=>H.objectIdFilter(ba,!0,da));this.addSqlFilter(Y,
this.parsedWhereClause);const ea=d.unwrapUpdating(this._layerMaskGeometries),ja=this._geometryEngine;if(f.isSome(ea)&&f.isSome(this.layerFilter)&&f.isSome(ja)){const da=this.layerFilter.spatialRelationship;Y.push((ha,ca)=>R(ja,ha,ca,na,aa,ia,ea,da))}const ka=d.unwrapUpdating(this._viewMaskGeometries);if(f.isSome(ka)&&f.isSome(this.viewFilter)&&f.isSome(ja)){const da=this.viewFilter.spatialRelationship;Y.push((ha,ca)=>R(ja,ha,ca,na,aa,ia,ka,da))}};T.isMBSGeometryVisible=function(Y,aa,ia){var na=d.unwrapUpdating(this._layerMaskGeometries);
const ba=this._geometryEngine;if(f.isSome(na)&&f.isSome(this.layerFilter)&&f.isSome(ba)){var ea=this.layerFilter.spatialRelationship;aa=na[0].spatialReference||aa;return B.projectBoundingSphere(Y,ia,W,aa)?L(ba,W,na,aa,ea):(N.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}na=d.unwrapUpdating(this._viewMaskGeometries);return f.isSome(na)&&f.isSome(this.viewFilter)&&f.isSome(ba)?(ea=this.viewFilter.spatialRelationship,aa=na[0].spatialReference||
aa,B.projectBoundingSphere(Y,ia,W,aa)?L(ba,W,na,aa,ea):(N.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0};X.checkSupport=function(Y){if(f.isNone(Y))return!1;if(Y.timeExtent)return N.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;Y=Y.spatialRelationship;return null!=Y&&S.includes(Y)?!0:(N.warn(`Filters with spatialRelationship other than ${S.join(", ")} are not supported for mesh scene layers`),
!1)};c._createClass(X,[{key:"sortedObjectIds",get:function(){if(f.isNone(this.viewFilter)||f.isNone(this.viewFilter.objectIds))return null;const Y=v.doubleArrayFrom(this.viewFilter.objectIds);Y.sort();return Y}},{key:"parsedWhereClause",get:function(){const Y=f.isSome(this.viewFilter)?this.viewFilter.where:null;if(f.isNone(Y)||!Y)return null;try{return y.WhereClause.create(Y,this.layerFieldsIndex)}catch(aa){N.error(`Failed to parse filter where clause: ${aa}`)}return null}},{key:"parsedGeometry",
get:function(){const Y=d.unwrapUpdating(this._viewMaskGeometries),aa=d.unwrapUpdating(this._layerMaskGeometries);return f.isNone(Y)||f.isNone(aa)?Y||aa:aa.concat(Y)}},{key:"_layerMaskGeometries",get:function(){const Y=this.layerFilter;return f.isNone(Y)?null:f.isNone(this._geometryEngine)?d.updating:"disjoint"===Y.spatialRelationship?Y.geometries.map(aa=>({type:"polygon",rings:aa.rings,spatialReference:aa.spatialReference,cache:{}})):[Y.geometries.reduce((aa,ia)=>{aa.rings=[...aa.rings,...ia.rings];
return aa},{type:"polygon",rings:[],spatialReference:Y.geometries[0].spatialReference,cache:{}})]}},{key:"_viewMaskGeometries",get:function(){if(f.isNone(this.viewFilter))return null;var {geometry:Y}=this.viewFilter;if(f.isNone(Y))return null;if(f.isNone(this.viewFilter)||f.isNone(this._geometryEngine))return d.updating;const {distance:aa,units:ia}=this.viewFilter,na=this.viewFilter.spatialRelationship;Y="mesh"===Y.type?Y.extent:Y;if(f.isNone(aa)||0===aa)return I(this._geometryEngine,Y,na);const ba=
ia||k.getUnitString(Y.spatialReference);if(Y.spatialReference.isWGS84)return Y=this._geometryEngine.geodesicBuffer(Y,aa,ba),I(this._geometryEngine,Y,na);var ea=E.project(Y,K.WGS84);if(f.isSome(ea))return Y=E.project(this._geometryEngine.geodesicBuffer(ea,aa,ba),Y.spatialReference),I(this._geometryEngine,Y,na);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(B.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;ea=null;try{ea=B.project(Y,K.WGS84)}catch(ja){}if(ea)try{ea=
B.project(this._geometryEngine.geodesicBuffer(ea,aa,ba),Y.spatialReference)}catch(ja){ea=null}ea||N.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${Y.spatialReference.wkid}) to WGS84.`);return I(this._geometryEngine,ea,na)}},{key:"updating",get:function(){return d.isUpdating(this._layerMaskGeometries)||d.isUpdating(this._viewMaskGeometries)}}]);return X}(x);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);w.__decorate([u.property({type:F})],
b.I3SMeshViewFilter.prototype,"viewFilter",void 0);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);w.__decorate([u.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);w.__decorate([u.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);w.__decorate([u.property({readOnly:!0})],
b.I3SMeshViewFilter.prototype,"parsedGeometry",null);w.__decorate([u.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);w.__decorate([u.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"updating",null);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);w.__decorate([u.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);
b.I3SMeshViewFilter=w.__decorate([r.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const S=["contains","intersects","disjoint"];var Q;(function(T){T[T.KEEP=0]="KEEP";T[T.DISCARD=1]="DISCARD";T[T.TEST=2]="TEST"})(Q||(Q={}));const W=C.fromValues(0,0,0,0),V=D.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===b};a.unwrapUpdating=function(b){return"updating"===
b?null:b};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r){const q=p.QueryEngine;a.I3SQueryEngine=function(y){function B(z){z=D.call(this,z);z._handles=new x;return z}b._inherits(B,y);var D=b._createSuper(B);y=B.prototype;y.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};y.destroy=function(){this._dataQueryEngineInstance=m.destroyMaybe(this._dataQueryEngineInstance);this._handles=m.destroyMaybe(this._handles);this._set("layerView",
null)};y.executeQueryForCount=async function(z,v){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(z),v)};y.executeQueryForExtent=async function(z,v){const {count:A,extent:t}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(z),v);z=k.fromJSON(t);return{count:A,extent:z}};y.executeQueryForIds=async function(z,v){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(z),v)};y.executeQuery=async function(z,v){z=this._ensureQueryJSON(z);if(z.returnGeometry)throw new n("feature-store:unsupported-query",
"returnGeometry is not yet supported for mesh scene layer queries");if(z.returnCentroid)throw new n("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");v=await this._dataQueryEngine.executeQuery(z,v);v=h.fromJSON(v);v.features.forEach(A=>{A.geometry=null});return v};y._ensureQueryJSON=function(z){return m.isNone(z)?this.defaultQueryJSON:z.toJSON()};y._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const z=this.layer.objectIdField||u.fallbackObjectIDAttribute,v=this.layer.fields?.map(C=>C.toJSON())??[],A=this.layerView.view.resourceController.scheduler,t=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new q({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:v,timeInfo:null,spatialReference:t,objectIdField:z,featureStore:this.spatialIndex,scheduler:A,priority:this.priority})};b._createClass(B,[{key:"spatialReference",get:function(){return this.layerView.view.spatialReference}},
{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"defaultQueryJSON",get:function(){return(new r({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return B}(w);c.__decorate([l.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);c.__decorate([l.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);c.__decorate([l.property({constructOnly:!0})],a.I3SQueryEngine.prototype,
"spatialIndex",void 0);c.__decorate([l.property()],a.I3SQueryEngine.prototype,"spatialReference",null);c.__decorate([l.property()],a.I3SQueryEngine.prototype,"layer",null);c.__decorate([l.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=c.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,b,c,w,n,x,m){let l=function(){function f(e){this._objectIdField=e.objectIdField;this._getFeatureExtent=e.getFeatureExtent}var d=f.prototype;d.getObjectId=function(e){return e.id};d.getAttributes=function(e){const {meta:k,index:u}=e,p={};this._objectIdField&&(p[this._objectIdField]=e.id);e=c.isSome(k.attributeInfo)&&k.attributeInfo.attributeData;if(c.isSome(e))for(const h of Object.keys(e))p[h]=m.getCachedAttributeValue(e[h],u);return p};d.getAttribute=function(e,k){if(k===this._objectIdField)return e.id;
const {meta:u,index:p}=e;e=c.isSome(u.attributeInfo)&&u.attributeInfo.attributeData;return c.isSome(e)?m.getCachedAttributeValue(e[k],p):null};d.getGeometry=function(e){if(e.geometry)return e.geometry;const [k,u,p,h,r]=this._getFeatureExtent(e,g);return new x([5],[k,u,p,h,u,p,h,r,p,k,r,p,k,u,p])};d.getCentroid=function(e,k){if(e.geometry)return n.getCentroidOptimizedGeometry(new x,e.geometry,k.hasZ,k.hasM);const [u,p,h,r,q,y]=this._getFeatureExtent(e,g);return new x([0],[(u+r)/2,(p+q)/2,(h+y)/2])};
d.cloneWithGeometry=function(e,k){const {id:u,index:p,meta:h}=e;return{id:u,index:p,meta:h,geometry:k}};return b._createClass(f)}();const g=w.create();a.I3SQueryFeatureAdapter=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../II3SMeshView3D".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p){const h=e.create();a.I3SQueryFeatureStore=function(B){function D(v){v=z.call(this,v);v.events=new n;return v}b._inherits(D,B);var z=b._createSuper(D);B=D.prototype;B.forEach=function(v){this.forAllFeatures(A=>{v(A);return p.ForAllFeaturesReturnType.CONTINUE})};B.forEachBounds=function(v,A){const t=this.getFeatureExtent;for(const C of v)A(t(C,h))};B.forEachInBounds=function(v,A){this.forAllFeatures(t=>{const C=this.getFeatureExtent(t,q);k.intersects(v,e.toRect(C,
y))&&A(t);return p.ForAllFeaturesReturnType.CONTINUE},t=>{d.projectBoundingSphere(t.node.mbs,this.sourceSpatialReference,r,this.viewSpatialReference);if(r[0]>=v[0]&&r[2]<=v[2]&&r[1]>=v[1]&&r[3]<=v[3])return p.ForAllFeaturesReturnType.CONTINUE;t=r[0]-Math.max(v[0],Math.min(r[0],v[2]));const C=r[1]-Math.max(v[1],Math.min(r[1],v[3]));return t*t+C*C<=r[3]*r[3]?p.ForAllFeaturesReturnType.CONTINUE:p.ForAllFeaturesReturnType.SKIP})};return b._createClass(D)}(w);c.__decorate([x.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);c.__decorate([x.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);c.__decorate([x.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);c.__decorate([x.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);c.__decorate([x.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=
c.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const r=u.fromValues(0,0,0,0),q=e.create(),y=k.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d){a.DefinitionExpressionSceneLayerView=e=>{e=function(k){function u(){var h=p.apply(this,arguments);h._definitionExpressionErrors=0;h._maxDefinitionExpressionErrors=20;h.logError=r=>{h._definitionExpressionErrors<h._maxDefinitionExpressionErrors&&w.getLogger(h.declaredClass).error("Error while evaluating definitionExpression: "+r);h._definitionExpressionErrors++;h._definitionExpressionErrors===h._maxDefinitionExpressionErrors&&w.getLogger(h.declaredClass).error("Further errors are ignored")};
return h}b._inherits(u,k);var p=b._createSuper(u);k=u.prototype;k._evaluateClause=function(h,r){try{return h.testFeature(r)}catch(q){return this.logError(q),!1}};k._addDefinitionExpressionToQuery=function(h){if(!this.parsedDefinitionExpression)return h;const r=this.i3slayer.definitionExpression;h=h.clone();h.where=h.where?`(${r}) AND (${h.where})`:r;return h};b._createClass(u,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const h=
f.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!h.isStandardized)return w.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;const r=[];d.findFieldsCaseInsensitive(h.fieldNames,this.i3slayer.fields,{missingFields:r});if(0<r.length)return w.getLogger(this.declaredClass).error(`definitionExpression references unknown fields: ${r.join(", ")}`),null;this._definitionExpressionErrors=0;return h}catch(h){return w.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+
h),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}}]);return u}(e);c.__decorate([n.property()],e.prototype,"i3slayer",void 0);c.__decorate([n.property({readOnly:!0})],e.prototype,"parsedDefinitionExpression",null);c.__decorate([n.property({readOnly:!0})],e.prototype,"definitionExpressionFields",null);return e=c.__decorate([g.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],e)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:c,layer:{fieldsIndex:w},requiredFields:n}=this;return c.outFields?b.fixFields(w,[...b.unpackFieldNames(w,c.outFields),...n]):b.fixFields(w,n)}}}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k){async function u(p){const h=new Set;try{return await p(h),Array.from(h).sort()}catch(r){return x.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(r),null}}a.SceneLayerViewRequiredFields=function(p){function h(q){return r.call(this,q)}b._inherits(h,p);var r=b._createSuper(h);h.prototype.initialize=function(){this.handles.add([this.autoUpdateAsync("rendererFields",async()=>{const {fieldsIndex:q,renderer:y}=this.layer;return y?u(B=>y.collectRequiredFields(B,
q)):null}),this.autoUpdateAsync("labelingFields",async()=>{const {layer:q}=this;return q.labelsVisible?u(y=>k.collectLabelingFields(y,q)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:q,filter:y}=this.layerView;return u(B=>k.collectFilterFields(B,q,y))})])};b._createClass(h,[{key:"layer",get:function(){return this.layerView.layer}},{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:q},definitionExpressionFields:y},rendererFields:B,labelingFields:D,viewFilterFields:z}=
this;return k.fixFields(q,[...m.unwrapOr(y,[]),...m.unwrapOr(B,[]),...m.unwrapOr(D,[]),...m.unwrapOr(z,[])])}}]);return h}(w.AsyncUpdateMixin(n.HandleOwner));c.__decorate([l.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);c.__decorate([l.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);c.__decorate([l.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);c.__decorate([l.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",
void 0);c.__decorate([l.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);c.__decorate([l.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=c.__decorate([e.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),
function(a,b,c,w,n,x,m,l,g){function f(k,u){const p=()=>{if(!h||r)return u();h.clear();r=!0;const q=x.runTracked(h,u);r=!1;return q};let h=new g.SimpleTrackingTarget(()=>{h&&!r&&k(p)}),r=!1;k(p);return{remove:()=>{h&&(h.destroy(),h=null)}}}const d=k=>{k=function(u){function p(){var r=h.apply(this,arguments);r._numUpdating=0;r._asyncUpdateState=new Map;return r}b._inherits(p,u);var h=b._createSuper(p);u=p.prototype;u.autoUpdateAsync=function(r,q){return f(y=>this._updateAsync(r,y),q)};u._updateAsync=
async function(r,q){if(!this._startAsyncUpdate(r)){try{const y=await q();this._set(r,y)}catch(y){n.getLogger(this.declaredClass).warn(`Async update of "${String(r)}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(r)&&this._updateAsync(r,q)}};u._startAsyncUpdate=function(r){const q=this._asyncUpdateState.get(r)??e.None;if(q&e.Updating)return this._asyncUpdateState.set(r,q|e.Invalidated),!0;++this._numUpdating;this._asyncUpdateState.set(r,q|e.Updating);return!1};
u._endAsyncUpdate=function(r){--this._numUpdating;const q=(this._asyncUpdateState.get(r)??e.None)&~e.Updating;if(q&e.Invalidated)return this._asyncUpdateState.set(r,q&~e.Invalidated),!0;this._asyncUpdateState.set(r,q);return!1};b._createClass(p,[{key:"updating",get:function(){return 0<this._numUpdating}}]);return p}(k);c.__decorate([m.property({readOnly:!0})],k.prototype,"updating",null);c.__decorate([m.property()],k.prototype,"_numUpdating",void 0);return k=c.__decorate([l.subclass("esri.core.AsyncUpdate")],
k)};var e;(function(k){k[k.None=0]="None";k[k.Updating=1]="Updating";k[k.Invalidated=2]="Invalidated"})(e||(e={}));a.AsyncUpdate=function(k){function u(){return p.apply(this,arguments)}b._inherits(u,k);var p=b._createSuper(u);return b._createClass(u)}(d(w));a.AsyncUpdate=c.__decorate([l.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u){const p=w.getLogger("esri.views.layers.SceneLayerView");w=function(h){function r(){var y=q.apply(this,arguments);y.layer=null;y.filter=null;y._geometryEngine=null;y._projectionEngineLoaded=!1;return y}b._inherits(r,h);var q=b._createSuper(r);h=r.prototype;h.initialize=function(){m.whenOnce(()=>!this._geometryEngine&&n.isSome(this.layer.filter)&&this.layer.filter.geometries.length).then(async()=>this._geometryEngine=await new Promise((y,B)=>a(["../../geometry/geometryEngine"],
y,B)));this._projectionEngineLoaded=k.isLoaded();m.whenOnce(()=>!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine).then(async()=>{await k.load();this._projectionEngineLoaded=!0})};h.destroy=function(){};h.highlight=function(y){throw Error("Not implemented");};h.queryFeatures=function(y,B){throw Error("Not implemented");};h.queryObjectIds=function(y,B){throw Error("Not implemented");};h.queryFeatureCount=function(y,B){throw Error("Not implemented");};h.createQuery=function(){throw Error("Not implemented");
};h.queryExtent=function(y,B){throw Error("Not implemented");};b._createClass(r,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(y){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){return x.unwrapUpdating(this._layerFilter)}},{key:"_layerFilter",get:function(){const y=this.layer.filter;if(n.isNone(y)||1>y.geometries.length)return null;const B=this._geometryEngine;
if(n.isNone(B)||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return x.updating;const D=y.geometries.getItemAt(0).spatialReference,z=y.geometries.toArray().map(C=>{try{C=B.simplify(C)}catch(E){return p.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==C)return null;if(C.spatialReference.equals(D))return C;try{return k.project(C,D)}catch(E){return p.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(n.isSome).sort((C,E)=>C.extent.xmin-E.extent.xmin),v=new Set,A=[],t=[];for(let C of z){const E=C.extent.xmin;A.length=0;v.forEach(F=>{E>=F.extent.xmax?(t.push(F),v.delete(F)):C.extent.ymin<=F.extent.ymax&&C.extent.ymax>=F.extent.ymin&&B.intersects(C,F)&&A.push(F)});if(0<A.length){A.push(C);try{C=B.union(A)}catch(F){p.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}A.pop();A.forEach(F=>v.delete(F))}v.add(C)}v.forEach(C=>t.push(C));return 0<
t.length?{spatialRelationship:y.spatialRelationship,geometries:t}:null}},{key:"_filterNeedsProjectionEngine",get:function(){const y=this.layer.filter;if(n.isNone(y)||1>=y.geometries.length)return!1;const B=y.geometries.getItemAt(0).spatialReference;return y.geometries.some(({spatialReference:D})=>!D.equals(B)&&!k.canProjectWithoutEngine(D,B))}},{key:"layerFilterUpdating",get:function(){return x.isUpdating(this._layerFilter)}}]);return r}(u);c.__decorate([l.property()],w.prototype,"layer",void 0);
c.__decorate([l.property()],w.prototype,"availableFields",null);c.__decorate([l.property()],w.prototype,"maximumNumberOfFeatures",null);c.__decorate([l.property({readOnly:!0})],w.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([l.property()],w.prototype,"filter",void 0);c.__decorate([l.property({readOnly:!0})],w.prototype,"layerFilter",null);c.__decorate([l.property({readOnly:!0})],w.prototype,"_layerFilter",null);c.__decorate([l.property()],w.prototype,"_geometryEngine",void 0);c.__decorate([l.property()],
w.prototype,"_projectionEngineLoaded",void 0);c.__decorate([l.property()],w.prototype,"_filterNeedsProjectionEngine",null);c.__decorate([l.property()],w.prototype,"layerFilterUpdating",null);return w=c.__decorate([e.subclass("esri.views.layers.SceneLayerView")],w)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/contains ../../../geometry/support/DoubleArray ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W){function V(aa){return"geometryBuffer"in aa&&null!==aa.geometryBuffer}function T(aa){const ia=aa.attributeInfo,na=aa.node.index;if(!(m.isNone(ia)||m.isNone(ia.loadedAttributes)||m.isNone(ia.attributeData)))for(let ba=0;ba<aa.graphics.length;ba++){const ea=aa.graphics[ba];if(ea.nodeIndex===na){ea.attributes||(ea.attributes={});for(const {name:ja}of ia.loadedAttributes)ia.attributeData[ja]&&(ea.attributes[ja]=
L.getCachedAttributeValue(ia.attributeData[ja],ba))}}}f=O.defineFieldProperties();C=function(aa){function ia(){var ba=na.apply(this,arguments);ba.type="scene-layer-graphics-3d";ba._queryEngine=null;ba._memCache=null;ba._interactiveEditingSessions=new Map;ba.loadedGraphics=new K.I3SGraphicsMap((ea,ja,ka)=>{{const da=ja.attributeInfo;if(m.isNone(da)||m.isNone(da.loadedAttributes)||m.isNone(da.attributeData))ea=!1;else{ja=!1;for(const {name:ha}of da.loadedAttributes)if(da.attributeData[ha]){const ca=
L.getCachedAttributeValue(da.attributeData[ha],ka);ca!==ea.attributes[ha]&&(ea.attributes[ha]=ca,ja=!0)}ea=ja}}return ea},ea=>ba.processor.graphicsCore.recreateGraphics(ea));ba.holeFilling="always";ba.progressiveLoadFactor=1;ba.supportsHeightUnitConversion=!0;ba._coordinatesOutsideExtentErrors=0;ba._maxCoordinatesOutsideExtentErrors=20;return ba}b._inherits(ia,aa);var na=b._createSuper(ia);aa=ia.prototype;aa.tryRecycleWith=function(ba,ea){return ba.url===this.layer.url&&this._i3sOverrides.isEmpty?
ba.load(ea).then(()=>{L.checkRecyclable(this.layer,ba,this._i3sOverrides);this.layer=ba;this._i3sOverrides.destroy();this._i3sOverrides=new I.I3SOverrides({view:this.view,layer:ba,memoryController:this.view.resourceController?.memoryController});m.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null};aa.initialize=function(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=new I.I3SOverrides({view:this.view,layer:this.layer,memoryController:this.view.resourceController?.memoryController});
L.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new M.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,ba=>this._rangeInfosChanged(ba),l.initial);this.updatingHandles.add(()=>this.layer.renderer,(ba,ea)=>this._rendererChange(ba,ea));this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange());this.handles.add(l.watch(()=>G.I3S_TREE_SHOW_TILES,
ba=>{if(ba&&!this._treeDebugger){const ea=this._controller.crsIndex;(new Promise((ja,ka)=>a(["./support/I3STreeDebugger"],ja,ka))).then(({I3STreeDebugger:ja})=>{!this._treeDebugger&&G.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ja({lv:this,view:this.view,nodeSR:ea}))})}else ba||!this._treeDebugger||G.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},l.initial));this._set("processor",new E({owner:this,preferredUpdatePolicy:S.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,
filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:ba=>this._updateClippingExtent(ba)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",ba=>this._controller.updateElevationChanged(ba.extent,ba.spatialReference));this.supportsHeightUnitConversion&&(this._verticalScale=q.getGeometryZScaler("point",this.layer.spatialReference,
this.view.spatialReference));this.addResolvingPromise(this.processor.initializePromise);this._memCache=this.view.resourceController.memoryController.newCache(this.uid);this._controller=new z({layerView:this,scaleVisibilityEnabled:!1});L.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new t.I3SPointsWorkerHandle(ba=>this.view.resourceController.immediate.schedule(ba)));this.handles.add(this.layer.on("apply-edits",ba=>this.updatingHandles.addPromise(ba.result)));this.handles.add(this.layer.on("edits",
ba=>this._handleEdits(ba)));this.when(()=>{this._setupQueryEngine();this.updatingHandles.add(()=>this.maximumNumberOfFeatures,ba=>this._controller.featureTarget=ba,l.initial);this.updatingHandles.add(()=>this.suspended,ba=>{ba&&this._removeAllNodeData()})})};aa.destroy=function(){this._treeDebugger=m.destroyMaybe(this._treeDebugger);this._i3sOverrides=m.destroyMaybe(this._i3sOverrides);this._set("processor",m.destroyMaybe(this.processor));this._controller=m.destroyMaybe(this._controller);this._queryEngine=
m.destroyMaybe(this._queryEngine);this._worker=m.destroyMaybe(this._worker);this._memCache=m.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=m.destroyMaybe(this._fieldsHelper)};aa.whenGraphicAttributes=async function(ba,ea){return L.whenGraphicAttributes(this.layer,ba,this._getObjectIdField(),ea,()=>[...this.loadedGraphics.nodes()])};aa.getHit=function(ba){if(!this.loadedGraphics)return null;const ea=D.hydrateGraphic(this.loadedGraphics.find(ka=>ka.uid===ba),this.layer),
ja=this._getObjectIdField();if(!ea||!ea.attributes||!ea.attributes[ja])return null;ea.layer=this.layer;ea.sourceLayer=this.layer;return{type:"graphic",graphic:ea,layer:ea.layer}};aa.whenGraphicBounds=function(ba,ea){return this.processor.whenGraphicBounds(ba,ea)};aa.computeAttachmentOrigin=function(ba,ea){return this.processor.computeAttachmentOrigin(ba,ea)};aa.canResume=function(){return b._get(b._getPrototypeOf(ia.prototype),"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)};
aa.isUpdating=function(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)};aa.highlight=function(ba){return this.processor.highlight(ba,this.layer.objectIdField)};aa.createInteractiveEditSession=function(ba){return H.createInteractiveEditSession(this._attributeEditingContext,ba)};aa._decompressBinaryPointData=async function(ba,ea){ba={geometryBuffer:ba.geometryBuffer};m.isNone(this._worker)&&(this._worker=new t.I3SPointsWorkerHandle(ja=>
this.view.resourceController.immediate.schedule(ja)));ea=await this._worker.invoke(ba,ea);if(m.isNone(ea))throw Error("Failed to decompress Draco point data");return{positionData:ea.positions,featureIds:ea.featureIds}};aa.addNode=async function(ba,ea,ja){if(!(V(ea)||"pointData"in ea))throw Error();if(this.loadedGraphics.hasNode(ba.index))x.getLogger(this.declaredClass).error("I3S node "+ba.id+" already added");else{if(m.isSome(this.layer.fullExtent)){var ka=this.layer.fullExtent.clone();ka.xmin-=
.5;ka.ymin-=.5;ka.xmax+=.5;ka.ymax+=.5;null!=ka.zmin&&null!=ka.zmax&&(ka.zmin-=.5,ka.zmax+=.5);null!=ka.mmin&&null!=ka.mmax&&(ka.mmin-=.5,ka.mmax+=.5)}else ka=null;var da=ka;ka=[];var {featureIds:ha,pointPositions:ca}=V(ea)?await this._extractBinaryPointPositions(ba,ea,ja):this._extractLegacyPointPositions(ea);this._validatePositions(ba,ha,ca,da,ka);var fa=this._controller.crsVertex;p.projectBuffer(ca,fa,0,ca,this.view.spatialReference,0,ha.length);da=V(ea)?ba.level:0;da={graphics:this._createGraphics(ha,
ca,ba.index,da),featureIds:ha,attributeInfo:ea.attributeDataInfo,node:ba};await this._i3sOverrides.apply(da.featureIds,ea.attributeDataInfo,ja);ba.numFeatures=da.graphics.length;this._updateNodeMemory(ba);T(da);0<ka.length&&(this._computeObb(ba,ka,fa),this._controller.updateVisibility(ba.index));if(this._controller.isGeometryVisible(ba)){if(m.isSome(this._verticalScale))for(const ma of da.graphics)this._verticalScale(ma.geometry);ea=this.view._stage.renderView.objectAndLayerIdRenderHelper;if(m.isSome(ea))for(ja=
0;ja<da.featureIds.length;ja++)ea.setUidToObjectAndLayerId(da.featureIds[ja],da.graphics[ja].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled,da.node.resources.attributes,ja);this.loadedGraphics.addNode(ba.index,da);this._controller.updateLoadStatus(ba.index,!0);this._filterNode(da);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(da)}};aa._computeObb=function(ba,ea,ja){const ka=this._controller.crsIndex,da=ka.isGeographic?this.view.renderSpatialReference:ka;p.projectBuffer(ea,
ja,0,ea,da,0,ea.length/3);ba.serviceObb=P.compute(new N.Attribute(ea,3));ka.isGeographic&&p.projectVectorToVector(ba.serviceObb.center,da,ba.serviceObb.center,ka)};aa.isNodeLoaded=function(ba){return this.loadedGraphics.hasNode(ba)};aa.isNodeReloading=function(){return!1};aa.updateNodeState=function(){};aa._extractBinaryPointPositions=async function(ba,ea,ja){ea=await this._decompressBinaryPointData(ea,ja);ja=ea.positionData;const ka=ja.length/3,da=r.newDoubleArray(3*ka);ba=m.isSome(ba.serviceObb)?
ba.serviceObb.center:[0,0,0];const ha=Math.abs(ba[2])*2**-20;for(let ca=0;ca<ka;ca++){const fa=3*ca;da[fa]=ja[fa]+ba[0];da[fa+1]=ja[fa+1]+ba[1];da[fa+2]=ja[fa+2]+ba[2];Math.abs(da[fa+2])<ha&&(da[fa+2]=0)}return{featureIds:ea.featureIds?Array.from(ea.featureIds):[],pointPositions:da}};aa._extractLegacyPointPositions=function(ba){const ea=ba.pointData.length,ja=r.newDoubleArray(3*ea),ka=[];for(let ca=0;ca<ea;ca++){var da=ba.pointData[ca];const fa=da.featureDataPosition,ma=fa.length;var ha=da.geometries?.[0]??
X[ma];da=da.featureIds[0];if("Embedded"!==ha.type||"points"!==ha.params.type||2>ma||3<ma)continue;ha=ha.params.vertexAttributes?.position??[0,0,0];const qa=3*ka.length;ja[qa]=fa[0]+ha[0];ja[qa+1]=fa[1]+ha[1];ja[qa+2]=3===ma?fa[2]+ha[2]:NaN;ka.push(da)}return{featureIds:ka,pointPositions:ja}};aa._validatePositions=function(ba,ea,ja,ka,da){if(!m.isNone(ka)||!ba.serviceObb){ea=ea.length;for(let ha=0;ha<ea;ha++){const ca=3*ha;k.set(Z,ja[ca],ja[ca+1],ja[ca+2]);m.isSome(ka)&&!h.extentContainsCoords3D(ka,
Z)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&x.getLogger(this.declaredClass).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&x.getLogger(this.declaredClass).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);ba.serviceObb||da.push(Z[0],Z[1],Z[2])}}};aa._createGraphics=function(ba,ea,ja,ka){const da=ba.length,
ha=this._getObjectIdField(),ca=this.processor.graphicsCore,fa=[],ma=this.view.spatialReference;for(let pa=0;pa<da;pa++){var qa=ba[pa];const ra={};null!=qa&&(ra[ha]=qa);qa=null==qa?w.generateUID():qa;var wa=3*pa,xa=isNaN(ea[wa+2])?void 0:ea[wa+2];wa=B.makeDehydratedPoint(ea[wa],ea[wa+1],xa,ma);xa=this.loadedGraphics.get(qa);if(m.isSome(xa)){if(null==xa.level||xa.level<ka)Y.property="geometry",Y.graphic=xa,Y.oldValue=m.unwrap(xa.geometry),Y.newValue=wa,xa.geometry=wa,xa.level=ka,ca.graphicUpdateHandler(Y);
fa.push(xa)}else xa=w.generateUID(),fa.push({objectId:qa,uid:xa,geometry:wa,attributes:ra,visible:!0,nodeIndex:ja,level:ka})}return fa};aa._updateNodeMemory=function(ba){ba.memory=4096+(m.isSome(ba.numFeatures)?ba.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)};aa._cacheNodeData=function(ba){const ea=ba.graphics.reduce((ja,ka)=>B.estimateSize(ka)+ja,8*ba.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(ba.node),ba,ea)};aa._getMemCacheKey=function(ba){return`${ba.index}`};
aa._removeAllNodeData=function(){this.loadedGraphics.forEachNode((ba,ea)=>{ba&&(this._updateNodeMemory(ba.node),this._cacheNodeData(ba));this._controller.updateLoadStatus(ea,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};aa.removeNode=function(ba){if(ba=this._removeNodeStageData(ba))this._updateNodeMemory(ba.node),this._cacheNodeData(ba)};aa._removeNodeStageData=function(ba){const ea=this.loadedGraphics.getNode(ba);if(m.isNone(ea))return null;this._controller.updateLoadStatus(ba,
!1);this.loadedGraphics.removeNode(ba);this._treeDebugger&&this._treeDebugger.update();return ea};aa.loadCachedNodeData=async function(ba){return this._memCache?.pop(this._getMemCacheKey(ba))};aa.addCachedNodeData=async function(ba,ea,ja,ka){this.loadedGraphics.hasNode(ba.index)?x.getLogger(this.declaredClass).error("I3S node "+ba.id+" already added"):(await this._i3sOverrides.apply(ea.featureIds,ja,ka),this.loadedGraphics.addNode(ba.index,ea),this._controller.updateLoadStatus(ba.index,!0),this._updateNodeMemory(ba),
ea.attributeInfo=ja,this._attributeValuesChanged(ea),this._filterNode(ea),this._treeDebugger&&this._treeDebugger.update())};aa.getLoadedNodeIds=function(){const ba=[];this.loadedGraphics.forEachNode(ea=>ba.push(ea.node.id));return ba.sort()};aa.getVisibleNodes=function(){const ba=[];this.loadedGraphics.forEachNode(ea=>ba.push(ea.node));return ba};aa.getLoadedNodeIndices=function(ba){this.loadedGraphics.forEachNode((ea,ja)=>ba.push(ja))};aa.getLoadedAttributes=function(ba){ba=this.loadedGraphics.getNode(ba);
if(m.isSome(ba)&&m.isSome(ba.attributeInfo))return ba.attributeInfo.loadedAttributes};aa.getAttributeData=function(ba){ba=this.loadedGraphics.getNode(ba);if(m.isSome(ba)&&m.isSome(ba.attributeInfo))return ba.attributeInfo.attributeData};aa._setAttributeData=function(ba,ea){ba=this.loadedGraphics.getNode(ba);m.isNone(ba)||m.isNone(ba.attributeInfo)||(ba.attributeInfo.attributeData=ea,this._attributeValuesChanged(ba))};aa.updateAttributes=async function(ba,ea,ja){ba=this.loadedGraphics.getNode(ba);
m.isNone(ba)||(await this._i3sOverrides.apply(ba.featureIds,ea,ja),ba.attributeInfo=ea,this._attributeValuesChanged(ba))};aa._attributeValuesChanged=function(ba){T(ba);this._filterNode(ba);this.processor.graphicsCore.labelsEnabled&&(ba=ba.graphics.map(ea=>ea.uid),this.processor.graphicsCore.updateLabelingInfo(ba))};aa._updateClippingExtent=function(ba){this._controller&&this._controller.updateClippingArea(ba);return!1};aa._getObjectIdField=function(){return this.layer.objectIdField||y.fallbackObjectIDAttribute};
aa._rendererChange=async function(ba,ea){const {layer:{fieldsIndex:ja}}=this,ka=new Set;let da;ba?(await ba.collectRequiredFields(ka,ja),da=Array.from(ka).sort()):da=[];ka.clear();let ha;ea?(await ea.collectRequiredFields(ka,ja),ha=Array.from(ka).sort()):ha=[];da.length===ha.length&&da.every((ca,fa)=>da[fa]===ha[fa])||this._reloadAllNodes()};aa._rangeInfosChanged=function(ba){null!=ba&&0<ba.length&&x.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
aa._filterChange=function(){this.loadedGraphics.forEachNode(ba=>this._filterNode(ba))};aa._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};aa._filterNode=function(ba){const ea=this.parsedDefinitionExpression,ja=this._excludeObjectIdsSorted,ka=this._getObjectIdField();for(const da of ba.graphics){ba=da.visible;const ha=!ea||this._evaluateClause(ea,da),ca=m.isNone(ja)||0>n.binaryIndexOf(ja,da.attributes[ka]);da.visible=ha&&ca;ba!==da.visible&&
(Y.graphic=da,Y.property="visible",Y.oldValue=ba,Y.newValue=da.visible,this.processor.graphicsCore.graphicUpdateHandler(Y))}};aa.createQuery=function(){const ba={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return m.isSome(this.filter)?this.filter.createQuery(ba):new A(ba)};aa.queryFeatures=function(ba,ea){return this._queryEngine.executeQuery(this._ensureQuery(ba),ea?.signal)};aa.queryObjectIds=function(ba,ea){return this._queryEngine.executeQueryForIds(this._ensureQuery(ba),
ea?.signal)};aa.queryFeatureCount=function(ba,ea){return this._queryEngine.executeQueryForCount(this._ensureQuery(ba),ea?.signal)};aa.queryExtent=function(ba,ea){return this._queryEngine.executeQueryForExtent(this._ensureQuery(ba),ea?.signal)};aa._ensureQuery=function(ba){return this._addDefinitionExpressionToQuery(m.isNone(ba)?this.createQuery():A.from(ba))};aa._setupQueryEngine=function(){const ba=()=>this.processor.featureStore;this._queryEngine=new F.QueryEngine({context:{spatialReference:this.view.spatialReference,
layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return ba()},hasZ:this.hasZ,hasM:this.hasM},priority:W.TaskPriority.FEATURE_QUERY_ENGINE})};aa._handleEdits=function(ba){H.processAttributeEdits(this._attributeEditingContext,ba)};b._createClass(ia,[{key:"i3slayer",get:function(){return this.layer}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??1}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??
[]}},{key:"maximumNumberOfFeatures",get:function(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0},set:function(ba){null!=ba?(this._override("maximumNumberOfFeatures",ba),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}},{key:"_excludeObjectIdsSorted",
get:function(){const ba=this.layer.excludeObjectIds;return ba.length?ba.toArray().sort((ea,ja)=>ea-ja):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this.processor?.graphicsCore?.usedMemory??0}},{key:"unloadedMemory",
get:function(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}},{key:"ignoresMemoryFactor",get:function(){return this._controller&&this._controller.fixedFeatureTarget}},{key:"_attributeEditingContext",get:function(){const ba=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:ba,forEachNode:ea=>this.loadedGraphics.forEachNode(ja=>ea(ja.node,ja.featureIds)),
attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:ea=>this.getAttributeData(ea),setAttributeData:(ea,ja,ka)=>{this._setAttributeData(ea,ja);ea=this.loadedGraphics.getNode(ea);m.isSome(ka)?(ka=this.loadedGraphics.get(ka.attributes[ba]),m.isSome(ka)&&this.processor.graphicsCore.recreateGraphics([ka])):m.isSome(ea)&&this.processor.graphicsCore.recreateGraphics(ea.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const ba=
{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this.loadedGraphics.nodeCount,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(ba);return ba}},{key:"test",get:function(){return{controller:this._controller,numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}}]);return ia}(R.DefinitionExpressionSceneLayerView(J.PopupSceneLayerView(C.LayerView3D(Q))));
c.__decorate([g.property()],C.prototype,"processor",void 0);c.__decorate([g.property({type:v})],C.prototype,"filter",void 0);c.__decorate([g.property()],C.prototype,"loadedGraphics",void 0);c.__decorate([g.property()],C.prototype,"i3slayer",null);c.__decorate([g.property()],C.prototype,"_controller",void 0);c.__decorate([g.property()],C.prototype,"updating",void 0);c.__decorate([g.property()],C.prototype,"suspended",void 0);c.__decorate([g.property()],C.prototype,"holeFilling",void 0);c.__decorate([g.property(U.updatingProgress)],
C.prototype,"updatingProgress",void 0);c.__decorate([g.property()],C.prototype,"updatingProgressValue",null);c.__decorate([g.property(f.requiredFields)],C.prototype,"requiredFields",null);c.__decorate([g.property(f.availableFields)],C.prototype,"availableFields",void 0);c.__decorate([g.property()],C.prototype,"_fieldsHelper",void 0);c.__decorate([g.property({type:Number})],C.prototype,"maximumNumberOfFeatures",null);c.__decorate([g.property({readOnly:!0})],C.prototype,"maximumNumberOfFeaturesExceeded",
null);c.__decorate([g.property()],C.prototype,"_excludeObjectIdsSorted",null);c.__decorate([g.property({readOnly:!0})],C.prototype,"lodFactor",null);c.__decorate([g.property({readOnly:!0})],C.prototype,"hasM",null);c.__decorate([g.property({readOnly:!0})],C.prototype,"hasZ",null);c=C=c.__decorate([e.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],C);const X={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,
0,0]}}}},Z=u.create(),Y={graphic:null,property:null,oldValue:null,newValue:null};return c})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,b,c){c=function(w){function n(m){return x.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:l=>[l.geometryBuffer]},m,{hasInitialize:!0})}b._inherits(n,w);var x=b._createSuper(n);return b._createClass(n)}(c.WorkerHandle);
a.I3SPointsWorkerHandle=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/MapUtils","../../../../core/maybe"],function(a,b,c,w,n){c=function(x){function m(g,f){var d=l.call(this);d._updateAndCompare=g;d._notifyUpdated=f;d._nodes=new Map;d._graphics=new Map;d._duplicates=new Map;return d}b._inherits(m,x);var l=b._createSuper(m);
x=m.prototype;x.clear=function(){if(0<this._graphics.size){const g=this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:g})}this._nodes.clear()};x.get=function(g){return this._graphics.get(g)};x.getNode=function(g){return this._nodes.get(g)};x.hasNode=function(g){return this._nodes.has(g)};x.nodes=function(){return this._nodes.values()};x.addNode=function(g,f){this._nodes.set(g,f);const d=f.graphics;if(0!==d.length){var e=new Set;for(let u=0;u<d.length;u++){var k=d[u];const p=
k.objectId,h=this._graphics.get(p);h?(e.add(p),k!==h&&(d[u]=h),(k=this._duplicates.get(p))?k.push(g):this._duplicates.set(p,[h.nodeIndex,g])):(k.nodeIndex=g,this._graphics.set(p,k))}e.size&&this._updateForeignGraphics(f);g=0<e.size?d.filter(u=>!e.has(u.objectId)):d;0<g.length&&this.emit("change",{added:g,removed:[]})}};x.removeNode=function(g){var f=this._nodes.get(g);if(f){this._nodes.delete(g);var d=new Set,e=[];for(const p of f.graphics){f=p.objectId;var k=this._graphics.get(f);if(!k)continue;
const h=this._duplicates.get(f);if(h){var u=h.indexOf(g);if(-1===u)console.error("error: removing graphic from node that should not reference it.");else{h.splice(u,1);if(k.nodeIndex===g){k=this.getNode(h[0]);for(u=1;u<h.length;u++){const r=this.getNode(h[u]);if(n.isNone(k)||n.isSome(r)&&r.node.level>k.node.level)k=r}n.isSome(k)&&d.add(k)}1===h.length&&this._duplicates.delete(f)}}else this._graphics.delete(f),e.push(p)}0<e.length&&this.emit("change",{added:[],removed:e});d.forEach(p=>this._updateForeignGraphics(p))}else console.error("Removing unknown node")};
x._updateForeignGraphics=function(g){const f=[],d=g.node.index,e=g.node.level;let k=0;for(;k<g.graphics.length;){var u=g.graphics[k].nodeIndex;if(u===d){k++;continue}let p=1;for(;k+p<g.graphics.length&&g.graphics[k+p].nodeIndex===u;)p++;u=this.getNode(u);if(!(n.isSome(u)&&u.node.level>e))for(u=k;u<k+p;u++){const h=g.graphics[u];h.nodeIndex=d;this._updateAndCompare(h,g,u)&&f.push(h)}k+=p}this._notifyUpdated(f)};x.toArray=function(){return Array.from(this._graphics.values())};x.find=function(g){let f=
void 0;w.someMap(this._graphics,d=>g(d)?(f=d,!0):!1);return f};x.forEach=function(g){this._graphics.forEach(f=>g(f))};x.forEachNode=function(g){this._nodes.forEach((f,d)=>g(f,d))};x._checkInvariants=function(){const g=new Map;this._nodes.forEach((d,e)=>{e!==d.node.index&&console.error("Mismatched node index");d.graphics.forEach(k=>{g.set(k.objectId,1+(g.get(k.objectId)??0));const u=this._duplicates.get(k.objectId);u&&!u.includes(e)&&console.error("Node not listed in duplicate list");u||k.nodeIndex===
e||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==g.size&&console.error("Mismatch between actual and expected number of graphics");let f=0;g.forEach((d,e)=>{f+=1<d?1:0;const k=this._graphics.get(e);if(k){var u=this._nodes.get(k.nodeIndex);u?(e=this._duplicates.get(e))?(e.length!==d&&console.error("Wrong number of entries in duplicate list"),e.forEach(p=>{(p=this._nodes.get(p))?p.node.level>u.node.level&&console.error("Duplicated graphic does not reference highest level node"):
console.error("Unknown node in duplicate list")})):1<d&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});this._duplicates.size!==f&&console.error("Mismatch between expected and actual number of duplicate entries")};b._createClass(m,[{key:"length",get:function(){return this._graphics.size}},{key:"nodeCount",get:function(){return this._nodes.size}}]);return m}(c);a.I3SGraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/LayerConstants ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/RenderState ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),function(a,
b,c,w,n,x,m,l,g,f,d,e,k,u,p,h,r,q,y,B,D,z,v,A,t,C,E,F,H,K,I,L,R,O,J,M,G,P,U,N,S,Q,W,V,T,X,Z,Y,aa,ia,na,ba,ea,ja,ka,da,ha,ca,fa,ma,qa,wa,xa,pa,ra,va,Ba,Aa,Ha,Ka,Pa,Ra,Sa,La,Ua,Za,Xa,la,Ta,Ma,fb,ya,oa,ua,Da,Ia,Na,ab,cb,hb,ib){function qb(bb,ob){bb.layerUids||(bb.layerUids=new Set);bb.layerUids.add(ob)}function pb(bb,ob){return h.isSome(bb)&&I.canProjectWithoutEngine(bb.spatialReference,ob)?I.project(bb,ob):null}const Lb=bb=>Object.freeze(Object.defineProperty({__proto__:null,default:bb},Symbol.toStringTag,
{value:"Module"}));n=function(bb){function ob(Fa){var Ea=Ab.call(this,Fa);Ea._userClippingArea=null;Ea._clippingArea=null;Ea._initialDefaultSpatialReference=null;Ea._defaults={};Ea._externallySet={environment:!1};Ea._createGraphicsViewController=null;Ea._resolveWhenReady=[];Ea._propertiesPool=new pa.PropertiesPool({slicePlane:R.BoundedPlaneClass},b._assertThisInitialized(Ea));Ea._resourceController=Ba.newResourceController(b._assertThisInitialized(Ea));Ea._defaultToMapOptions={include:new Set};Ea._defaultHitTestOptions=
{exclude:new Set};Ea.deconflictor=new ba.GraphicsDeconflictor({view:b._assertThisInitialized(Ea)});Ea.labeler=new ea.Labeler({view:b._assertThisInitialized(Ea),deconflictor:Ea.deconflictor.labels});Ea.sharedSymbolResources=null;Ea.analyses=new P.AnalysesCollection;Ea.basemapTerrain=null;Ea.elevationProvider=null;Ea.canvas=null;Ea.constraints=new Y.Constraints;Ea.environmentManager=new ia.SceneViewEnvironmentManager;Ea.floors=new l;Ea.fullOpacity=1;Ea.graphicsView=null;Ea.analysisViewManager=new Z({view:b._assertThisInitialized(Ea)});
Ea.groundView=null;Ea.map=null;Ea.screenSizePerspectiveEnabled=!0;Ea.state=new ka;Ea.spatialReference=null;Ea.alphaCompositingEnabled=!1;Ea.preserveDrawingBufferEnabled=!1;Ea.supersampleScreenshotsEnabled=!0;Ea.type="3d";Ea.ui=new Na;Ea._numUpdating=0;Ea._lastUpdateTime=0;Ea.updatingProgress=.5;Ea.highlightOptions=new wa;Ea.voxelWasm=null;Ea.voxelWasmPromise=null;z.initialize();Fa&&Fa.environment||(Ea._defaults.environment=new aa,Ea.environment=Ea._defaults.environment);const Va=(db=null)=>{h.isSome(db)&&
db.type===r.ObservableChangesType.MOVE||(Ea._updatingChanged(),Ea.map&&Ea.map.allLayers.forEach(async ta=>{try{await ta.when()}catch{}Ea._updatingChanged()}))};Ea.handles.add([y.on(()=>Ea.map?.allLayers,"after-changes",db=>Va(db),{onListenerAdd:()=>Va(),onListenerRemove:()=>Va(),sync:!0}),Ea.allLayerViews.on("after-changes",db=>Ea._updateUpdatingMonitors(db)),y.watch(()=>Ea.map,db=>{db&&"load"in db&&db.load&&db.load().catch(()=>{})})]);Ea.inputManager=new na({view:b._assertThisInitialized(Ea)});Ea.stateManager=
new da.ViewStateManager({view:b._assertThisInitialized(Ea)});return Ea}b._inherits(ob,bb);var Ab=b._createSuper(ob);bb=ob.prototype;bb.initialize=function(){this.groundView=new S({view:this});this._updateUpdatingMonitors();const Fa=()=>this._updateDefaultToMapOptions();this.handles.add(y.on(()=>this.map?.allLayers,"after-changes",Fa,{onListenerAdd:Fa,onListenerRemove:Fa}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Ea=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=
Ea)},y.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Ea=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Ea)},y.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,Ea=>B.setFrameDuration(0<Ea?1E3/Math.ceil(Ea):0),y.initial);this.updatingHandles.add(()=>this.map?.ground,Fa,y.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),y.syncAndInitial);
this.handles.add(y.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),y.sync))};bb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=h.destroyMaybe(this.sharedSymbolResources),this._set("labeler",h.destroyMaybe(this.labeler)),this._set("deconflictor",h.destroyMaybe(this.deconflictor)),this._resourceController=h.destroyMaybe(this._resourceController),
this._set("stateManager",h.destroyMaybe(this.stateManager)),this._set("inputManager",h.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",h.destroyMaybe(this.environmentManager)),this.groundView=h.destroyMaybe(this.groundView),this._exitBasemapTerrain())};bb.installContentCameraReset=function(Fa={sticky:!1}){return this.stateManager.installContentCameraReset(Fa)};bb.castEnvironment=function(Fa){return Fa?
Fa instanceof aa?Fa:Fa instanceof ab?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Fa):aa.fromWebsceneEnvironment(Fa):E.ensureType(aa,Fa):new aa};bb.on=function(Fa,Ea,Va,db){return(Va=this.viewEvents.on(Fa,Ea,Va,db))?Va:b._get(b._getPrototypeOf(ob.prototype),"on",this).call(this,Fa,Ea)};bb.hasEventListener=function(Fa){return b._get(b._getPrototypeOf(ob.prototype),"hasEventListener",this).call(this,Fa)||this.viewEvents.hasHandler(Fa)};bb.toMap=function(Fa,Ea){if(!this.ready)return p.getLogger(this.declaredClass).error("#toMap()",
"Scene view cannot be used before it is ready"),null;Ea=Ea?this.externalToInternalIntersectOptions(Ea):this._defaultToMapOptions;var Va=h.isSome(Ea.graphics)&&(h.isSome(Ea.graphics.include)||h.isSome(Ea.graphics.exclude));Fa=oa.isSupportedScreenPointEvent(Fa)?oa.createScreenPointFromSupportedEvent(this,Fa):Fa;Fa=D.screenPointObjectToArray(Fa);Ea.enableDraped=Ea.include&&!Ea.include.has(la.TERRAIN_ID)||Ea.exclude&&Ea.exclude.has(la.TERRAIN_ID);const db=this.sceneIntersectionHelper,ta=La.newIntersector(this.state.viewingMode);
ta.options.selectionMode=!0;ta.options.store=Va?Ua.StoreResults.ALL:Ua.StoreResults.MIN;db.intersectIntersectorScreen(Fa,ta,Ea);if(Va){for(const Ga of ta.results.all)if(Va=Xa.toHit(Ga,this),h.isNone(Va)||"graphic"!==Va.type||this._testGraphicUidFilter(Ea.graphics,Va.graphic))return this._intersectResultToMapPoint(Ga);return null}return this._intersectResultToMapPoint(ta.results.min)};bb.toScreen=function(Fa){if(!this.ready)return p.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),
null;const Ea=h.unwrapOr(null==Fa.z?qa.getElevationAtPoint(this.elevationProvider,Fa):null,0);I.projectPointToVector(Fa,tb,this.renderSpatialReference,Ea);this.state.camera.projectToScreen(tb,Cb);return D.createScreenPoint(Cb[0],Cb[1])};bb.pixelSizeAt=function(Fa){if(!this.ready)return p.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Fa)return 0;I.projectPointToVector(Fa,tb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(tb)};
bb.overlayPixelSizeInMapUnits=function(Fa){const Ea=this.basemapTerrain.overlayManager;return Ea?Ea.overlayPixelSizeInMapUnits(Fa):1};bb.hitTest=function(Fa,Ea){if(!this.ready)return p.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;Fa=oa.isSupportedScreenPointEvent(Fa)?oa.createScreenPointFromSupportedEvent(this,Fa):Fa;var Va=D.createScreenPointArray(Fa.x,Fa.y),db=Ea?this.externalToInternalIntersectOptions(Ea):this._defaultHitTestOptions;db.requiresGroundFeedback=
!0;db.enableDraped=!0;Ea=La.newIntersector(this.state.viewingMode);Ea.options.selectionMode=!0;Ea.options.store=Ua.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Va,Ea,db);Va=this._intersectResultsToHits(Ea.results.all,db.graphics);db=Ea.results.ground;var ta=Xa.toOwner(db,this);ta=h.isSome(ta)&&"type"in ta&&"integrated-mesh"===ta.type?ta:null;Fa={screenPoint:Fa,results:Va,ground:{mapPoint:this._intersectResultToMapPoint(db),distance:Za.isValidIntersectorResult(db)?db.distanceInRenderSpace:
0,layer:ta}};fa.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Fa.intersector=Ea);return Promise.resolve(Fa)};bb.popupHitTest=async function(Fa){const {results:Ea,ground:Va}=await Ta.hitTestSelectSimilarDistance(this,Fa);let db=null;!(0===Ea.length||1E-5>Math.abs(h.unwrapOr(Ea[0].distance,0)-Va.distance))||Va.layer&&"integrated-mesh"===Va.layer.type||(db=Va.mapPoint);return{results:Ea,screenPoint:Fa,mapPoint:db}};bb.goTo=function(Fa,Ea){return this.updatingHandles.addPromise(this.stateManager.goTo(Fa,Ea))};
bb.whenAnalysisView=async function(Fa){if(h.isNone(Fa.parent))throw new f("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Fa});switch(Fa.parent.type){case "line-of-sight":case "dimension":return(await this.whenLayerView(Fa.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Fa)}};bb.whenLayerView=function(Fa){return b._get(b._getPrototypeOf(ob.prototype),"whenLayerView",this).call(this,Fa)};bb.takeScreenshot=async function(Fa){Fa=
this._completeSettings(Fa);await this.whenReady();const Ea=await this._stage.renderView.takeScreenshot(Fa);return ya.encode(Ea,Fa,this._pixelFormat())};bb._takeScreenshot=async function(Fa){Fa=this._completeSettings(Fa);await this.whenReady();Fa=await this._stage.renderView.takeScreenshot(Fa);return ya.encodeData(Fa,this._pixelFormat())};bb._takeScreenshotWithObjectAndLayerId=async function(Fa){Fa=this._completeSettings(Fa);await this.whenReady();Fa=await this._stage.renderView.takeScreenshotWithOID(Fa);
return[ya.encodeData(Fa[0],this._pixelFormat()),ya.encodeData(Fa[1],this._pixelFormat())]};bb._completeSettings=function(Fa){Fa=ya.toRenderSettings(Fa,this);Fa.pixelRatio/=this.state.pixelRatio;return ya.screenshotSuperSampleSettings(Fa,this.supersampleScreenshotsEnabled,this.padding)};bb._pixelFormat=function(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}};bb.takeScreenshotWithObjectAndLayerId=async function(Fa){if(!k("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");
var Ea=this._completeSettings(Fa);await this.whenReady();var Va=await this._stage.renderView.takeScreenshotWithOID(Ea);Ea=ya.encode(Va[0],Ea,this._pixelFormat());Fa=this._completeSettings(Fa);Fa.format="png";Va=ya.encode(Va[1],Fa,this._pixelFormat());return[Ea,Va]};bb.getColorToObjectAndLayerIdMapping=function(){if(h.isNone(this._stage.renderView.objectAndLayerIdRenderHelper))throw Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()};
bb.addUpdatingPromise=function(Fa){return this.updatingHandles.addPromise(Fa)};bb.importLayerView=function(Fa){return X.layerView3DImporter.importLayerView(Fa)};bb.hasLayerViewModule=function(Fa){return X.layerView3DImporter.hasLayerViewModule(Fa)};bb.forceDOMReadyCycle=function(){this.forceReadyCycle()};bb.getDefaultSpatialReference=function(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&
this._initialDefaultSpatialReference||null};bb.validate=async function(){let Fa=Da.check(this.type);const Ea=k("safari");Ea&&9>Ea&&(Fa=new f("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Ea}));if(h.isSome(Fa))throw p.getLogger(this.declaredClass).warn("#validate()",Fa.message),Fa;};bb.getSpatialReferenceSupport=function({spatialReference:Fa,layer:Ea}){var Va=this._predeterminedViewingMode;if(h.isSome(Va))return this._validateSpatialReferenceForViewingMode(Fa,
Ea,Va)?{constraints:this._makeSpatialReferenceConstraints(Fa,Ea,Va)}:null;Va=this._validateSpatialReferenceForViewingMode(Fa,Ea,T.ViewingMode.Local);const db=this._validateSpatialReferenceForViewingMode(Fa,Ea,T.ViewingMode.Global);return Va||db?Va&&db?{constraints:this._makeSpatialReferenceConstraints(Fa,Ea,null)}:Va?{constraints:this._makeSpatialReferenceConstraints(Fa,Ea,T.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Fa,Ea,T.ViewingMode.Global)}:null};bb._validateSpatialReferenceForViewingMode=
function(Fa,Ea,Va){return ua.isSpatialReferenceSupported(Fa,Va)?h.isNone(Ea)||G.isImageryTileLayer(Ea)?!0:G.isTiledLayer(Ea)&&h.isNone(Ra.getTiledLayerInfo(Ea,Fa,Va))||G.isVoxelLayer(Ea)&&Va===T.ViewingMode.Global?!1:!0:!1};bb._makeSpatialReferenceConstraints=function(Fa,Ea,Va){if(h.isNone(Ea))return[{spatialReference:Fa,viewingMode:Va}];const db=Fa.isWebMercator,ta=Fa.isWGS84;return G.isImageryTileLayer(Ea)&&(db||ta)?(ta&&Va!==T.ViewingMode.Local?null===Ra.checkIfTileInfoSupportedForView(Ea.tileInfo,
Ea.fullExtent,Fa,T.ViewingMode.Global):1)?[{spatialReference:Fa,viewingMode:Va},{spatialReference:cb.WebMercator,viewingMode:Va}]:[{spatialReference:db?cb.WGS84:cb.WebMercator,viewingMode:Va}]:G.isTiledLayer(Ea)||G.isVoxelLayer(Ea)||!db&&!ta?G.isTiledLayer(Ea)&&db&&Va!==T.ViewingMode.Global?[{spatialReference:Fa,viewingMode:Va},{spatialReference:cb.WGS84,viewingMode:T.ViewingMode.Local}]:[{spatialReference:Fa,viewingMode:Va}]:[{spatialReference:Fa,viewingMode:Va},{spatialReference:db?cb.WGS84:cb.WebMercator,
viewingMode:Va}]};bb._validateSpatialReference=function(Fa){const Ea=h.isSome(this.getSpatialReferenceSupport({spatialReference:Fa})),Va=this._predeterminedViewingMode;Ea||(h.isSome(Va)?p.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${T.stringFromViewingMode(Va)} viewing mode.`):Fa.isGeographic&&p.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported."));return Ea};bb.whenReady=function(){return new Promise(Fa=>{this.ready?
Fa(this):this._resolveWhenReady.push(Fa)})};bb.computeMapPointFromVec3d=function(Fa,Ea){let Va=this.spatialReference||cb.WGS84;I.projectVectorToVector(Fa,this.renderSpatialReference,Fa,Va)||(Va=cb.WGS84,I.projectVectorToVector(Fa,this.renderSpatialReference,Fa,Va));Ea?(Ea.x=Fa[0],Ea.y=Fa[1],Ea.z=Fa[2],Ea.spatialReference=Va):Ea=new hb(Fa,Va);return Ea};bb.trackGraphicState=function(Fa){if(!Fa.graphic)return p.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),
null;const Ea=this.getViewForGraphic(Fa.graphic);let Va=null,db=!1;const ta=Ga=>{!db&&h.isSome(Ga)&&"processor"in Ga&&"graphics-3d"===Ga.processor?.type&&Ga.processor.graphicsCore&&(Va=Ga.processor.graphicsCore.trackGraphicState(Fa))};h.isSome(Ea)?ta(Ea):this.whenViewForGraphic(Fa.graphic,{waitForLayer:!0}).then(Ga=>ta(Ga),()=>{}).catch(()=>{});return{remove:()=>{db=!0;h.isSome(Va)&&(Va.remove(),Va=null)}}};bb.highlight=function(Fa){if(Array.isArray(Fa))return e.handlesGroup(Fa.map(Va=>this.highlight(Va)));
if(l.isCollection(Fa))return e.handlesGroup(Fa.toArray().map(Va=>this.highlight(Va)));const Ea=this.getViewForGraphic(Fa);return Ea&&"highlight"in Ea?Ea.highlight(Fa):e.makeHandle()};bb.maskOccludee=function(Fa){if(!Fa)return p.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ea=this.getViewForGraphic(Fa);let Va=null,db=!1;const ta=Ga=>{!db&&h.isSome(Ga)&&Ma.occludeesSupported(Ga)&&(Va=Ga.maskOccludee(Fa))};h.isSome(Ea)?
ta(Ea):this.whenViewForGraphic(Fa,{waitForLayer:!0}).then(Ga=>ta(Ga),()=>{}).catch(()=>{});return{remove:()=>{db=!0;h.isSome(Va)&&(Va.remove(),Va=null)}}};bb.getViewForGraphic=function(Fa){return Fa.layer===this.graphics?this.graphicsView:Fa.layer?this.allLayerViews.find(Ea=>Ea.layer===Fa.layer):null};bb.graphicChanged=function(Fa){h.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Fa)};bb.whenViewForGraphic=async function(Fa,Ea){if(Fa.layer===this)return await y.whenOnce(()=>this.graphicsView),
this.graphicsView;if(!Fa.layer||!this.map)throw new f("no-view-for-graphic");return Ea&&Ea.waitForLayer&&!this.map.allLayers.includes(Fa.layer)?new Promise((Va,db)=>{const ta=this.map.allLayers.on("change",Ga=>{Ga.added.includes(Fa.layer)&&(ta.remove(),this.whenLayerView(Fa.layer).then(Va,db))})}):this.whenLayerView(Fa.layer)};bb.externalToInternalIntersectOptions=function(Fa){const Ea=this._externalToInternalRenderItems(Fa.include,Tb.INCLUDE);Fa=this._externalToInternalRenderItems(Fa.exclude,Tb.EXCLUDE);
return{include:Ea.layerUids,exclude:Fa.layerUids,graphics:{include:Ea.graphicUids,exclude:Fa.graphicUids}}};bb._intersectResultToMapPoint=function(Fa,Ea){return Fa.getIntersectionPoint(tb)?(Ea=this.computeMapPointFromVec3d(tb,Ea),Fa.intersector===Ua.IntersectorType.TERRAIN&&this.basemapTerrain&&(Ea.z=h.unwrapOr(qa.getElevationAtPoint(this.basemapTerrain,Ea),0)),Ea):null};bb._intersectResultsToHits=function(Fa,Ea){const Va=[];let db=null;for(let Oa=0;Oa<Fa.length;Oa++){const Qa=Fa[Oa];var ta=Xa.toOwner(Qa,
this);if(h.isSome(ta)&&(ta===this.map.ground||"type"in ta&&"integrated-mesh"===ta.type))break;ta=Xa.toHit(Qa,this);if(!h.isNone(ta)){if("graphic"===ta.type){h.isNone(db)&&Oa!==Fa.length-1&&(db=new Set);if(h.isSome(db)){var Ga=this._getGraphicFilterUid(ta.graphic);if(db.has(Ga))continue;db.add(Ga)}if(!this._testGraphicUidFilter(Ea,ta.graphic))continue}Ga=this._intersectResultToMapPoint(Qa);Va.push({...ta,mapPoint:Ga,distance:Qa.distanceInRenderSpace})}}return Va};bb._getGraphicFilterUid=function(Fa){var Ea=
Fa.sourceLayer,Va=Fa.layer;if(Ea=Ea&&"objectIdField"in Ea?Ea:Va&&"objectIdField"in Va?Va:Ea)if(Va=Ea.objectIdField??M.fallbackObjectIDAttribute,Va=Fa.attributes?.[Va])return`o-${Ea.id}-${Va}`;return`u-${Fa.uid}`};bb._testGraphicUidFilter=function(Fa,Ea){Ea=this._getGraphicFilterUid(Ea);return h.isNone(Fa)||(h.isNone(Fa.include)||Fa.include.has(Ea))&&(h.isNone(Fa.exclude)||!Fa.exclude.has(Ea))};bb._externalToInternalRenderItems=function(Fa,Ea,Va={layerUids:void 0,graphicUids:void 0}){if(!Fa)return Va;
if(Fa instanceof x){var db=this._getGraphicFilterUid(Fa);Va.graphicUids||(Va.graphicUids=new Set);Va.graphicUids.add(db);Ea===Tb.INCLUDE&&(h.isSome(this.graphicsView)&&Fa.layer===this?qb(Va,this.graphicsView.processor.layer.id):Fa.layer&&qb(Va,Fa.layer.uid))}else if(u.isIterable(Fa))for(db of Fa)db===this.graphics&&h.isSome(this.graphicsView)?qb(Va,this.graphicsView.processor.layer.id):db===this.map.ground?qb(Va,la.TERRAIN_ID):this._externalToInternalRenderItems(db,Ea,Va);else"uid"in Fa&&qb(Va,Fa.uid);
return Va};bb._initBasemapTerrain=function(){this._set("basemapTerrain",new Pa({view:this}));this._set("elevationProvider",new ca.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};bb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};bb._initGlobe=function(){this._initCoordinateSystem();
this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ka.PointsOfInterest({view:this}));this._set("featureTiles",new ja.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Fa=()=>{var Ea=this.basemapTerrain?.extent;this.clippingArea||
Ea?Ea&&this.basemapTerrain.spatialReference?(Ea=h.isSome(this.basemapTerrain.extent)&&h.isSome(this.basemapTerrain.spatialReference)?I.project(L.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,h.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Ea):this.featureTiles.filterExtent=Ea):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>
fa.FEATURE_TILE_TREE_SHOW_TILES,Ea=>{Ea&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Va,db)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Va,db))).then(({FeatureTileTree3DDebugger:Va})=>{!this._featureTreeDebugger&&fa.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Va({view:this}))}):Ea||!this._featureTreeDebugger||fa.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},y.syncAndInitial),
this.updatingHandles.add(()=>this.clippingArea,Fa,y.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Fa,y.syncAndInitial)],"feature-tiles");this.stateManager.init()};bb._exitGlobe=function(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),
this._exitCoordinateSystem())};bb._initCoordinateSystem=function(){if(this.spatialReference){var Fa=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Fa)||this._set("mapCoordsHelper",new xa.MapCoordsHelper(this.map,Fa));const Ea=this.state.isGlobal;Fa=O.renderSRFromViewSR(Ea,Fa);Fa!==this.renderSpatialReference&&(this._set("renderCoordsHelper",va.RenderCoordsHelper.create(this.state.viewingMode,Fa)),Ea||this.handles.add(y.watch(()=>this.basemapTerrain?.extent,
Va=>{const db=this.renderCoordsHelper.spatialReference;h.isSome(Va)&&(0!==Va[0]||0!==Va[1]||0!==Va[2]||0!==Va[3])&&I.projectBoundingRect(Va,this.basemapTerrain.spatialReference,Ib,db)&&(this.renderCoordsHelper.extent=Ib)},y.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(La.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};bb._exitCoordinateSystem=function(){this.mapCoordsHelper&&
(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};bb._updatingChanged=function(){this.notifyChange("updating")};bb._updateUpdatingMonitors=function(Fa=null){h.isSome(Fa)&&Fa.type===r.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Ea=>{Ea.destroyed||(this.handles.add(y.watch(()=>[Ea.updating,Ea.updatingProgress],()=>this._updatingChanged(),y.sync),"updatingMonitors"),Ea.when(()=>this._updatingChanged(),
()=>this._updatingChanged()))}),this._updatingChanged())};bb._prepareScreenshotOverlay=async function(){this.overlay&&await this.overlay.prepare()};bb._renderScreenshotOverlay=function(Fa,Ea){if(!this.overlay||!this.overlay.hasVisibleItems)return Ea;const Va=Fa.getContext("2d");Va.putImageData(Ea,0,0);this.overlay.renderCanvas(Fa);return Va.getImageData(0,0,Ea.width,Ea.height)};bb._initStage=function(){var Fa={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,
alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Va,db)=>this._renderScreenshotOverlay(Va,db)}},Ea=new ha.SceneIntersectionHelper(this.state.viewingMode,Va=>this._stage.layers.forAll(Va),this);this._set("sceneIntersectionHelper",Ea);Ea=g.byId(this.surface);this._stage=new Sa.Stage({view:this,options:Fa,container:Ea});this._stage.renderer.setParameters({slicePlane:this.slicePlane});
this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),y.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,Va=>this._stage.renderer.setParameters({highQualityTransparency:Va}),y.initial),y.watch(()=>this.magnifier,Va=>this._stage.renderView.magnifier=Va,y.syncAndInitial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),
d.on(this._stage.renderView.canvas,"webglcontextlost",Va=>this.fatalError=new f("webgl-context-lost",Va.statusMessage))],"stage");Fa=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:wa.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],
Fa),"stage");Fa();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(La.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};bb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage=h.destroyMaybe(this._stage);this.handles.remove("stage");this._set("canvas",null)};bb._initSurface=function(Fa){this._exitSurface();this.state.init(Fa,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=
new Ha.SharedSymbolResources({view:this,viewingMode:Fa,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};bb._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};bb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");
this._createGraphicsViewController=new AbortController;var Fa=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Fa,Fa);this._updatingChanged()}};bb._createGraphicsViewAsync=async function(Fa){const Ea=(await new Promise((Va,db)=>a(["./3d/layers/GraphicsView3D"],ta=>Va(Lb(ta)),db))).default;q.throwIfAborted(Fa);await y.whenOnce(()=>this.basemapTerrain?.ready,Fa);this._set("graphicsView",new Ea({view:this}))};
bb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");h.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};bb._startup=function(){var Fa=T.viewingModeFromString(this.viewingMode);Fa===T.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Fa);this._set("ready",
!0);this.handles.add(y.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Fa=this.get("map.initialViewProperties.environment"))&&(this.environment=Fa);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Fa=this._resolveWhenReady;this._resolveWhenReady=[];Fa.forEach(Ea=>Ea(this))};bb._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();
this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};bb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(la.TERRAIN_ID);for(const Fa of this.map.allLayers.items)"integrated-mesh"===Fa.type&&this._defaultToMapOptions.include.add(Fa.uid)}};bb._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();
if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(la.TERRAIN_ID);for(const Fa of this.map.allLayers.items)"integrated-mesh"===Fa.type&&1>Fa.opacity&&this._defaultHitTestOptions.exclude.add(Fa.uid)}};bb.addVoxelLayerViewToWasm=function(Fa){return h.isNone(this.voxelWasm)?(h.isNone(this.voxelWasmPromise)&&(this.voxelWasmPromise=(new Promise((Ea,Va)=>a(["../layers/VoxelWasmPerSceneView"],db=>Ea(Lb(db)),Va))).then(Ea=>this.voxelWasm=new Ea.default(this))),
this.voxelWasmPromise.then(Ea=>Ea.addVoxelLayer(Fa))):this.voxelWasm.addVoxelLayer(Fa)};bb.removeVoxelLayerViewFromWasm=function(Fa){h.isSome(this.voxelWasm)&&1>this.voxelWasm.removeVoxelLayer(Fa)&&(this.voxelWasmPromise=this.voxelWasm=null)};b._createClass(ob,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){return this.basemapTerrain?.spatialReference}},{key:"animation",get:function(){return this.state?.animation}},
{key:"camera",get:function(){return this.stateManager?.camera},set:function(Fa){this.stateManager&&(this.stateManager.camera=Fa)}},{key:"contentCamera",get:function(){return this.stateManager?.contentCamera},set:function(Fa){this.stateManager&&(this.stateManager.contentCamera=Fa)}},{key:"center",get:function(){return this.stateManager?.center},set:function(Fa){this.stateManager&&(this.stateManager.center=Fa)}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Fa=this._userClippingArea||
("clippingArea"in this.map?this.map?.clippingArea:void 0);if(!this._userClippingArea&&!this.get("map.clippingEnabled")||h.isNone(Fa))return this._clippingArea=null;if(!(Fa instanceof ib))return p.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Fa=pb(Fa,this.spatialReference),h.isNone(Fa)))return p.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),
this._clippingArea;Fa=Fa.clone();h.isNone(Fa.intersection(this._groundAndLayersExtent))&&(Fa.xmin=Fa.xmax,Fa.ymin=Fa.ymax);Fa.zmin=void 0;Fa.zmax=void 0;Fa.equals(this._clippingArea)||(this._clippingArea=Fa);return this._clippingArea},set:function(Fa){this.ready&&"global"===this.viewingMode&&h.isSome(Fa)?p.getLogger(this.declaredClass).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Fa}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===
T.ViewingMode.Global)return null;const Fa=this.renderSpatialReference,Ea=this.dataExtent;return h.isNone(Ea)||h.isNone(Fa)||Ea.spatialReference.equals(Fa)?Ea:pb(Ea,Fa)}},{key:"dataExtent",get:function(){let Fa=this._groundAndLayersExtent;var Ea=pb(this.clippingArea,this.spatialReference||cb.WGS84);h.isSome(Ea)&&(Fa=h.isSome(Fa)?Fa.intersection(Ea):Ea);Ea=this._get("dataExtent");return h.isSome(Fa)&&Fa.equals(Ea)?Ea:Fa}},{key:"_groundAndLayersExtent",get:function(){const Fa=this.spatialReference||
cb.WGS84;let Ea;const Va=ta=>{ta=pb(ta,Fa);h.isNone(ta)||(h.isSome(Ea)?Ea.union(ta):Ea=ta.clone())};var db=this.basemapTerrain;if(db?.spatialReference){const ta=db.groundExtent;Va(new ib({xmin:ta[0],ymin:ta[1],zmin:0,xmax:ta[2],ymax:ta[3],zmax:0,spatialReference:db.spatialReference}))}this.map&&this.map.allLayers.forEach(ta=>{!h.isSome(ta.fullExtent)||"graphics"===ta.type&&ta.internal||Va(ta.fullExtent)});if(h.isNone(Ea))return null;Ea.hasZ?(Ea.zmin=Math.min(0,Ea.zmin??0),Ea.zmax=Math.max(0,Ea.zmax??
0)):(Ea.zmin=0,Ea.zmax=0);db=this._get("_groundAndLayersExtent");return Ea.equals(db)?db:Ea}},{key:"environment",set:function(Fa){Fa!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Fa)}},{key:"extent",get:function(){return this.stateManager?.extent},set:function(Fa){this.stateManager&&(this.stateManager.extent=Fa)}},{key:"screenCenter",get:function(){return this.stateManager?.screenCenter}},{key:"frustum",get:function(){return this.stateManager?.frustum}},
{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||this.toolViewManager?.interacting}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(h.isNone(this.state)||this.state.stationary)}},{key:"navigating",get:function(){return this.state?.navigating??!1}},{key:"padding",
get:function(){return this.stateManager?.padding},set:function(Fa){this.stateManager&&(this.stateManager.padding=Fa)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||ma.getDefaultProfile()},set:function(Fa){ma.isValidProfile(Fa)&&(ma.apply(Fa,this.qualitySettings),this._set("qualityProfile",Fa))}},{key:"slicePlane",set:function(Fa){h.isSome(this._stage)&&this._stage.renderer.setParameters({slicePlane:Fa});if(h.isNone(Fa))this._set("slicePlane",null);else{var Ea=this._propertiesPool.get("slicePlane");
R.copy(Fa,Ea);this._set("slicePlane",Ea)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?J.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"scale",get:function(){return this.stateManager?.scale},set:function(Fa){this.stateManager&&(this.stateManager.scale=Fa)}},{key:"heightModelInfo",get:function(){const Fa=this.getDefaultHeightModelInfo();return null!=Fa?K.deriveUnitFromSR(Fa,this.spatialReference):
null}},{key:"updating",get:function(){if(this.destroyed)return!1;let Fa=0,Ea=this.layerViewManager.updating,Va=Ea?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(Ga=>{Ga.isFulfilled()?Ga.updating&&(Ea=!0,Ga.suspended||Ra.isSurfaceLayerView(Ga)||(++Va,Fa+=Ga.updatingProgress)):++Va});for(var db of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,
this.analysisViewManager])h.isSome(db)&&db.updating&&(Va+=.1,Fa+=.05);for(var ta of[this.deconflictor,this.labeler,this.basemapTerrain])h.isSome(ta)&&ta.updating&&(++Va,Fa+=ta.updatingProgress);db=this.stateManager.test.updatingIgnoreRenderState?fb.RenderState.IDLE:this.state.mode;(Ea=!!(Ea||0<Va||this.updatingHandles.updating||!this.ready||!this.stationary||db!==fb.RenderState.IDLE||this._createGraphicsViewController||this.inputManager?.hasPendingInputs||this.map?.allLayers?.some(Ga=>!Ga.isFulfilled())))?
(this._numUpdating=Math.max(Va,this._numUpdating),Fa+=this._numUpdating-Va):this._numUpdating=0;Fa=0<this._numUpdating?Fa/this._numUpdating:Ea?0:1;this._get("updatingProgress")!==Fa&&(db=performance.now(),1>Fa&&(ta=Math.min((db-this._lastUpdateTime)/2E3,1),Fa=this.updatingProgress*(1-ta)+Fa*ta),this._set("updatingProgress",Fa),this._lastUpdateTime=Ea&&1>Fa?db:0);return Ea}},{key:"viewingMode",get:function(){var Fa=this._predeterminedViewingMode;return h.isSome(Fa)?T.stringFromViewingMode(Fa):(Fa=
this.spatialReference)?h.isSome(this.defaultsFromMap?.viewingMode)&&Fa.equals(this.defaultsFromMap.spatialReference)?T.stringFromViewingMode(this.defaultsFromMap.viewingMode):ua.isSpatialReferenceSupported(Fa,T.ViewingMode.Global)?"global":"local":"global"},set:function(Fa){this.ready?p.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Fa)}},{key:"viewpoint",get:function(){return this.stateManager?.viewpoint},set:function(Fa){this.stateManager&&
(this.stateManager.viewpoint=Fa)}},{key:"zoom",get:function(){return this.stateManager.zoom},set:function(Fa){this.stateManager&&(this.stateManager.zoom=Fa)}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new Aa(this)}},{key:"test",get:function(){return{takeScreenshot:Fa=>this._takeScreenshot(Fa),takeScreenshotWithObjectAndLayerId:Fa=>this._takeScreenshotWithObjectAndLayerId(Fa)}}},{key:"_predeterminedViewingMode",get:function(){const Fa=
this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return h.isSome(Fa)?T.viewingModeFromString(Fa):null}}]);return ob}(U.BreakpointsOwner(N.DOMContainer(Q.PopupView(W))));n.type="3d";c.__decorate([v.property()],n.prototype,"_userClippingArea",void 0);c.__decorate([v.property()],n.prototype,"_resourceController",void 0);c.__decorate([v.property()],n.prototype,"_stage",void 0);c.__decorate([v.property({readOnly:!0})],
n.prototype,"deconflictor",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"labeler",void 0);c.__decorate([v.property(H.owningCollectionProperty(P.AnalysesCollection,"analyses"))],n.prototype,"analyses",void 0);c.__decorate([v.property({type:V,readOnly:!0})],n.prototype,"animation",null);c.__decorate([v.property({readOnly:!0})],n.prototype,"basemapTerrain",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"elevationProvider",void 0);c.__decorate([v.property()],n.prototype,
"camera",null);c.__decorate([v.property({type:w})],n.prototype,"contentCamera",null);c.__decorate([v.property({readOnly:!0})],n.prototype,"canvas",void 0);c.__decorate([v.property({type:hb})],n.prototype,"center",null);c.__decorate([v.property({type:ib})],n.prototype,"clippingArea",null);c.__decorate([v.property({type:Y.Constraints})],n.prototype,"constraints",void 0);c.__decorate([v.property({type:ib,readOnly:!0})],n.prototype,"renderDataExtent",null);c.__decorate([v.property({type:ib,readOnly:!0})],
n.prototype,"dataExtent",null);c.__decorate([v.property({type:ib,readOnly:!0})],n.prototype,"_groundAndLayersExtent",null);c.__decorate([v.property({value:null,type:aa})],n.prototype,"environment",null);c.__decorate([A.cast("environment")],n.prototype,"castEnvironment",null);c.__decorate([v.property({readOnly:!0})],n.prototype,"environmentManager",void 0);c.__decorate([v.property({type:ib})],n.prototype,"extent",null);c.__decorate([v.property()],n.prototype,"floors",void 0);c.__decorate([v.property()],
n.prototype,"screenCenter",null);c.__decorate([v.property()],n.prototype,"frustum",null);c.__decorate([v.property({type:Number,readOnly:!0})],n.prototype,"fullOpacity",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"graphicsView",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"analysisViewManager",void 0);c.__decorate([v.property()],n.prototype,"groundView",void 0);c.__decorate([v.property({type:Boolean})],n.prototype,"initialExtentRequired",null);c.__decorate([v.property()],
n.prototype,"_defaultsFromMapSettings",null);c.__decorate([v.property()],n.prototype,"interacting",null);c.__decorate([v.property()],n.prototype,"stationary",null);c.__decorate([v.property()],n.prototype,"navigating",null);c.__decorate([v.property()],n.prototype,"map",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"mapCoordsHelper",void 0);c.__decorate([v.property()],n.prototype,"padding",null);c.__decorate([v.property({type:Ka.PointsOfInterest,readOnly:!0})],n.prototype,"pointsOfInterest",
void 0);c.__decorate([v.property({type:ja.FeatureTileTree3D,readOnly:!0})],n.prototype,"featureTiles",void 0);c.__decorate([v.property()],n.prototype,"_featureTreeDebugger",void 0);c.__decorate([v.property({type:Boolean})],n.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([v.property({constructOnly:!0})],n.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([v.property({constructOnly:!0})],n.prototype,"debugWebGLExtensions",void 0);c.__decorate([v.property({constructOnly:!0})],
n.prototype,"renderCanvas",void 0);c.__decorate([v.property({constructOnly:!0})],n.prototype,"state",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"inputManager",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"stateManager",void 0);c.__decorate([v.property({type:["low","medium","high"]})],n.prototype,"qualityProfile",null);c.__decorate([v.property({type:ra,get(){let bb=this._get("qualitySettings");bb||(bb=new ra,ma.apply(this.qualityProfile,bb));return bb}})],n.prototype,
"qualitySettings",void 0);c.__decorate([v.property()],n.prototype,"slicePlane",null);c.__decorate([v.property({readOnly:!0})],n.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([v.property({readOnly:!0})],n.prototype,"renderCoordsHelper",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,"sceneIntersectionHelper",void 0);c.__decorate([v.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],n.prototype,"resolution",null);c.__decorate([v.property({type:Number})],
n.prototype,"scale",null);c.__decorate([v.property()],n.prototype,"heightModelInfo",null);c.__decorate([v.property()],n.prototype,"spatialReference",void 0);c.__decorate([v.property({type:Boolean,constructOnly:!0})],n.prototype,"alphaCompositingEnabled",void 0);c.__decorate([v.property({constructOnly:!0})],n.prototype,"preserveDrawingBufferEnabled",void 0);c.__decorate([v.property({type:Boolean})],n.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([v.property({readOnly:!0})],n.prototype,
"type",void 0);c.__decorate([v.property(),A.cast(bb=>bb instanceof Ia?bb:E.ensureClass(Na,bb))],n.prototype,"ui",void 0);c.__decorate([v.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating state.mode".split(" ")})],
n.prototype,"updating",null);c.__decorate([v.property({type:Number,readOnly:!0,dependsOn:["updating"]})],n.prototype,"updatingProgress",void 0);c.__decorate([v.property({type:["global","local"]})],n.prototype,"viewingMode",null);c.__decorate([v.property({type:m})],n.prototype,"viewpoint",null);c.__decorate([v.property({type:Number})],n.prototype,"zoom",null);c.__decorate([v.property({type:wa})],n.prototype,"highlightOptions",void 0);n=c.__decorate([C.subclass("esri.views.SceneView")],n);var Tb;(function(bb){bb[bb.INCLUDE=
0]="INCLUDE";bb[bb.EXCLUDE=1]="EXCLUDE"})(Tb||(Tb={}));const tb=F.create(),Cb=D.createScreenPointArray(),Ib=L.create();return n});