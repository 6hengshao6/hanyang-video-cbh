// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),function(k,p,q,v,m,B,C,w,x,y,z){m=function(g){function n(){var a=A.apply(this,arguments);a.type="raster";
return a}k._inherits(n,g);var A=k._createSuper(n);g=n.prototype;g.attach=function(){k._get(k._getPrototypeOf(n.prototype),"attach",this).call(this);this.container=new x.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()};g.detach=function(){k._get(k._getPrototypeOf(n.prototype),"detach",this).call(this);this.container.removeAllChildren();this.container=null};g.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&
this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&z.canUseMajorityInterpolationOnDataSource(this.layer))};g.fetchTile=function(a,c){return this.layer.fetchTile(a.level,a.row,a.col,c)};g.updateRasterFunctionParameters=function(){const {raster:a,type:c}=this.layer,{container:h}=this;if("Function"!==a.datasetFormat||"wcs"===c)h.rasterFunctionChain=null,h.children.forEach(b=>{({bitmap:b}=b);b&&(b.suspended=!0,b.processed=!1,b.projected&&(b.invalidateTexture(),b.rasterTexture=
null))}),this._rasterFunctionState="na";else{var l=this._rasterFunctionState,{rasterFunction:f,primaryRasters:d}=a,e=f.supportsGPU&&(!d||1>=d.rasters.length),r=e?f.flatWebGLFunctionChain:null,{renderer:t}=this.layer;e=!e||!r?.functions.length||"raster-stretch"===t.type&&t.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();h.rasterFunctionChain=e?null:r;var u=null==f?"na":h.rasterFunctionChain?"gpu":"cpu";h.children.forEach(b=>{({bitmap:b}=b);b&&(b.suspended=l!==u,b.processed=!1,b.processedTexture=
null)});this._rasterFunctionState=u}};g.updateTileSource=async function(a,c){const h=this._getBandIds(),l=this._getLayerInterpolation(),f=this.canUseWebGLForProcessing(),{source:d,globalSymbolizerParams:e,suspended:r,coords:t,resolution:u}=c;c=this.layerView.hasTilingEffects?e:c.symbolizerParams;({bitmap:a}=a);[a.x,a.y]=t;a.resolution=u;if(d&&q.isSome(d)&&q.isSome(d.pixelBlock)){var b={extent:d.extent,pixelBlock:d.pixelBlock};a.rawPixelData=b;f?(a.source=d.pixelBlock,a.isRendereredSource=!1):(b=await this.layer.applyRenderer(b,
"stretch"===e?.type?e:void 0),a.source=b,a.isRendereredSource=!0);a.symbolizerParameters=f?c:null;f?a.transformGrid||(a.transformGrid=d.transformGrid):a.transformGrid=null}else b=this.createEmptyTilePixelBlock(),a.source=b,a.symbolizerParameters=f?c:null,a.transformGrid=null;a.bandIds=f?h:null;a.width=this._tileInfoView.tileInfo.size[0];a.height=this._tileInfoView.tileInfo.size[1];a.interpolation=l;a.suspended=r;a.invalidateTexture()};g.updateTileSymbolizerParameters=async function(a,c){const {local:h,
global:l}=c;c=this._getBandIds();const f=this._getLayerInterpolation(),d=this.canUseWebGLForProcessing();({bitmap:a}=a);const {rawPixelData:e}=a;!d&&q.isSome(e)?(a.source=await this.layer.applyRenderer(e,"stretch"===l?.type?l:void 0),a.isRendereredSource=!0):(a.isRendereredSource&&q.isSome(e)&&(a.source=e.pixelBlock),a.isRendereredSource=!1);a.symbolizerParameters=d?this.layerView.hasTilingEffects?l:h:null;a.bandIds=d?c:null;a.interpolation=f;a.suspended=!1};g._getLayerInterpolation=function(){var a=
this.layer.renderer.type;if("raster-colormap"===a||"unique-value"===a||"class-breaks"===a)return"nearest";({interpolation:a}=this.layer);const {renderer:c}=this.layer;return"raster-stretch"===c.type&&null!=c.colorRamp?"bilinear"===a||"cubic"===a?"bilinear":"nearest":a};return k._createClass(n)}(y.BaseImageryTileSubView2D);p.__decorate([v.property()],m.prototype,"container",void 0);p.__decorate([v.property()],m.prototype,"layer",void 0);p.__decorate([v.property()],m.prototype,"type",void 0);return m=
p.__decorate([w.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],m)});