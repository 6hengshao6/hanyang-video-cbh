// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(n,h,f,q,r,t,e,g,B,C,D,u,v,w,x,y,z){const m=q.ofType({key:"type",base:null,typeMap:{rect:x,path:z,geometry:y}});n.LayerView2DMixin=d=>{d=function(c){function k(){var a=A.apply(this,arguments);a.attached=!1;a.clips=new m;a.lastUpdateId=-1;a.moving=!1;a.updateRequested=!1;a.visibleAtCurrentScale=!1;a.highlightOptions=null;return a}h._inherits(k,c);var A=h._createSuper(k);c=k.prototype;c.initialize=function(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new t("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new v.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([e.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},e.syncAndInitial),
e.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=b)},e.syncAndInitial),e.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},e.syncAndInitial),e.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},e.syncAndInitial),e.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,e.syncAndInitial),e.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},e.syncAndInitial),e.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},e.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};c.destroy=function(){this.processDetach();this.updateRequested=!1};c.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};c.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};c.isVisibleAtScale=function(a){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;
const {minScale:l,maxScale:p}=b;return(0===l||a<=l)&&(0===p||a>=p)};c.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};c.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};c.hitTest=function(a,b){return Promise.resolve(null)};c.supportsSpatialReference=function(a){return!0};
c.canResume=function(){return this.spatialReferenceSupported?h._get(h._getPrototypeOf(k.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};c.getSuspendInfo=function(){const a=h._get(h._getPrototypeOf(k.prototype),"getSuspendInfo",this).call(this),b=!this.spatialReferenceSupported,l=this.visibleAtCurrentScale;b&&(a.spatialReferenceNotSupported=b);l&&(a.outsideScaleRange=l);return a};c.addAttachHandles=function(a){this.addHandles(a,"attach")};h._createClass(k,[{key:"spatialReferenceSupported",
get:function(){const a=this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return k}(d);f.__decorate([g.property()],d.prototype,"attached",void 0);f.__decorate([g.property({type:m,set(c){c=r.referenceSetter(c,this._get("clips"),m);this._set("clips",c)}})],d.prototype,"clips",void 0);f.__decorate([g.property()],
d.prototype,"container",void 0);f.__decorate([g.property()],d.prototype,"moving",void 0);f.__decorate([g.property({readOnly:!0})],d.prototype,"spatialReferenceSupported",null);f.__decorate([g.property({readOnly:!0})],d.prototype,"updateParameters",void 0);f.__decorate([g.property()],d.prototype,"updateRequested",void 0);f.__decorate([g.property()],d.prototype,"updating",null);f.__decorate([g.property()],d.prototype,"view",void 0);f.__decorate([g.property({readOnly:!0})],d.prototype,"visibleAtCurrentScale",
void 0);f.__decorate([g.property({type:w})],d.prototype,"highlightOptions",void 0);return d=f.__decorate([u.subclass("esri.views.2d.layers.LayerView2D")],d)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});