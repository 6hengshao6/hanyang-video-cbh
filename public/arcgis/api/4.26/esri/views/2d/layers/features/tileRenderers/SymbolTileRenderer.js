// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/CircularArray ../../../../core/has ../../../../core/maybe ../../../../chunks/mat2df32 ./enums ./Utils ./WGLTile ./collisions/MetricReader ./cpuMapped/Geometry".split(" "),function(w,t,n,x,p,u,l,f,c,g,b){let a=0;c=function(d){function h(e,k,r,y,m,v){e=q.call(this,e,k,r,y);e.instanceId=a++;e.patchCount=0;e._renderState={current:{geometry:new Map,metrics:null},
next:null,swap:!1,swapFrames:0,locked:!1};e._patches=new n(100);e._bufferPatches=new n(100);e._lastCommitTime=0;e.transforms.labelMat2d=u.create();e._store=m;e._requestLabelUpdate=v;return e}t._inherits(h,d);var q=t._createSuper(h);d=h.prototype;d.destroy=function(){t._get(t._getPrototypeOf(h.prototype),"destroy",this).call(this);this._renderState.current.geometry.forEach(e=>e.destroy());p.isSome(this._renderState.next)&&this._renderState.next.geometry.forEach(e=>e.destroy());this._renderState.current=
null;this._renderState.next=null};d.getGeometry=function(e){return this._renderState.current.geometry.get(e)};d.patch=function(e,k){this.patchCount++;e.clear&&50<=this._patches.size&&this._dropPatches();const r=e.addOrUpdate&&this.key.id!==e.addOrUpdate.tileKeyOrigin;k&&r?this._bufferPatches.enqueue(e):(e.sort=e.sort&&!k,this._patches.enqueue(e));this.requestRender()};d.commit=function(e){if(this._lastCommitTime!==e.time){this._lastCommitTime=e.time;for(e=0;4>e;e++)this._updateMesh(),this.isReady&&
this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}};d.lock=function(){this._renderState.locked=!0};d.unlock=function(){this._renderState.locked=!1;this._flushUpdates();this._swap()};d._swapRenderStates=function(){this._renderState.next&&(this._renderState.locked?(this._renderState.swap=!0,this.requestRender()):(this._renderState.swap=!0,this._swap()))};d._swap=function(){this._renderState.swap&&(this._renderState.swap=!1,p.isSome(this._renderState.next)&&
(this._renderState.current.geometry.forEach(e=>e.destroy()),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))};d._flushUpdates=function(){let e=this._patches.maxSize;for(;this._patches.size&&e--;)this._updateMesh(),this._swap()};d._updateBufferMesh=function(){var e=this._bufferPatches.peek();if(!p.isSome(e)||!e.clear||null===this._renderState.next)for(;this._bufferPatches.size;)e=this._bufferPatches.dequeue(),p.isSome(e)&&this._patchBuffer(e)};
d._updateMesh=function(){const e=this._patches.dequeue();if(p.isSome(e)){if(x("esri-2d-update-debug")){var k=e.addOrUpdate?.tileKeyOrigin;k=this.key.id===k?"SELF":k;let r="";for(let y=0;5>y;y++)r+=e.addOrUpdate?.data[y]?.records?.byteLength?1:0;console.debug(this.key.id,"FeatureTile:patch",`[clear: ${e.clear} origin: ${k}, end:${e.end} data:${r}]`)}!0===e.clear&&(p.isSome(this._renderState.next)&&(this._renderState.next.geometry.forEach(r=>r.destroy()),this._renderState.next=null),this._renderState.next=
{geometry:new Map,metrics:null},x("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState"));this.requestRender();this._patch(e);e.end&&(x("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),this.ready(),this._swapRenderStates())}};d._patch=function(e){f.forEachGeometryType(k=>{this._remove(k,e.remove);this._insert(k,e,!1)})};d._patchBuffer=function(e){f.forEachGeometryType(k=>{this._insert(k,e,!0)})};
d._insert=function(e,k,r){try{const y=p.unwrapOr(this._renderState.next,this._renderState.current),m=k.addOrUpdate?.data[e],v=y.geometry;p.isNone(m)||(v.has(e)||(x("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Creating geometry buffer ${e}`),v.set(e,new b.Geometry(e,this.stage))),x("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Inserting into ${e}, version=${k.addOrUpdate?.version} stride=${m.stride}`),v.get(e).insert(m,k.sort,r),e===l.WGLGeometryType.LABEL&&
this._insertLabelMetrics(k.type,m.metrics,k.clear))}catch(y){}};d._insertLabelMetrics=function(e,k,r){r=p.unwrapOr(this._renderState.next,this._renderState.current);if(!p.isNone(k))if(k=g.MetricReader.from(k),p.isNone(r.metrics))r.metrics=k;else{if("update"===e)for(e=k.getCursor();e.next();)r.metrics.delete(e.id);r.metrics.link(k)}};d._remove=function(e,k){e=p.unwrapOr(this._renderState.next,this._renderState.current).geometry.get(e);k&&k.length&&e&&(e.remove(k),this._removeLabelMetrics(k))};d._removeLabelMetrics=
function(e){const {metrics:k}=p.unwrapOr(this._renderState.next,this._renderState.current);if(!p.isNone(k)&&e.length)for(const r of e)for(;k.delete(r););};d._dropPatches=function(){const e=[];let k=!1;for(;this._patches.size;){const r=this._patches.dequeue();if(p.isNone(r))break;if(r.clear){if(k)break;k=!0}e.push(r)}this._patches.clear();e.forEach(r=>this._patches.enqueue(r))};t._createClass(h,[{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}},
{key:"updateStatus",get:function(){return`renderState:${!!this._renderState.current}, ${!!this._renderState.next}, hasData:${this.hasData}, queue:${this._patches.size}`}}]);return h}(c.WGLTile);w.FeatureTile=c;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/MetricReader":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(w,t,n){let x=function(){function u(f){this._savedOffset=this._savedCursor=
null;this._cursor=this._head=f}u.from=function(f){f=p.from(new Float32Array(f));return new u(f)};var l=u.prototype;l.computedMinZoom=function(){return this._cursor.computedMinZoom()};l.setComputedMinZoom=function(f){return this._cursor.setComputedMinZoom(f)};l.boundsComputedAnchorX=function(f){return this._cursor.boundsComputedAnchorX(f)};l.boundsComputedAnchorY=function(f){return this._cursor.boundsComputedAnchorY(f)};l.setBoundsComputedAnchorX=function(f,c){return this._cursor.setBoundsComputedAnchorX(f,
c)};l.setBoundsComputedAnchorY=function(f,c){return this._cursor.setBoundsComputedAnchorY(f,c)};l.boundsX=function(f){return this._cursor.boundsX(f)};l.boundsY=function(f){return this._cursor.boundsY(f)};l.boundsWidth=function(f){return this._cursor.boundsWidth(f)};l.boundsHeight=function(f){return this._cursor.boundsHeight(f)};l.link=function(f){if(n.isSome(f._head))return this._cursor.link(f._head)};l.getCursor=function(){return this.copy()};l.copy=function(){const f=new u(this._head?.copy());if(!f._head)return f;
let c=f._head,g=f._head._link;for(;g;)c._link=g.copy(),c=g,g=c._link;return f};l.peekId=function(){return this._cursor.peekId()??this._cursor._link.peekId()};l.nextId=function(){const f=this.id;for(;f===this.id;)if(!this.next())return!1;return!0};l.save=function(){this._savedCursor=this._cursor;this._savedOffset=this._cursor._offset};l.restore=function(){this._savedCursor&&(this._cursor=this._savedCursor);null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)};l.next=function(){if(!this._cursor)return!1;
if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;this._cursor._offset=0}return!0};l.lookup=function(f){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(f);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor};l.delete=function(f){let c=this._head,g=null;for(;c;){if(c.delete(f))return c.isEmpty()&&n.isSome(g)&&(g._link=c._link),!0;g=c;c=c._link}return!1};t._createClass(u,[{key:"id",get:function(){return this._cursor.id}},
{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}}]);
return u}(),p=function(){function u(f){this._offset=-1;this._link=null;this._deletedCount=this._count=0;this._offsets={instance:null};this._buffer=f}u.from=function(f){return new u(new Float32Array(f))};var l=u.prototype;l.isEmpty=function(){return this._deletedCount===this.count};l.computedMinZoom=function(){return this._buffer[this._offset+8]};l.setComputedMinZoom=function(f){this._buffer[this._offset+8]=f};l.boundsComputedAnchorX=function(f){return this._buffer[this._offset+10+6*f]};l.boundsComputedAnchorY=
function(f){return this._buffer[this._offset+10+6*f+1]};l.setBoundsComputedAnchorX=function(f,c){this._buffer[this._offset+10+6*f]=c};l.setBoundsComputedAnchorY=function(f,c){this._buffer[this._offset+10+6*f+1]=c};l.boundsX=function(f){return this._buffer[this._offset+10+6*f+2]};l.boundsY=function(f){return this._buffer[this._offset+10+6*f+3]};l.boundsWidth=function(f){return this._buffer[this._offset+10+6*f+4]};l.boundsHeight=function(f){return this._buffer[this._offset+10+6*f+5]};l.link=function(f){let c=
this;for(;c._link;)c=c._link;c._link=f};l.getCursor=function(){return this.copy()};l.copy=function(){const f=new u(this._buffer);f._link=this._link;f._offset=this._offset;f._deletedCount=this._deletedCount;f._offsets=this._offsets;f._count=this._count;return f};l.peekId=function(){const f=this._offset+10+6*this.boundsCount+0;return f>=this._buffer.length?0:this._buffer[f]};l.next=function(){let f=0;for(;this._offset<this._buffer.length&&100>f++&&(this._offset=-1===this._offset?0:this._offset+(10+
6*this.boundsCount),4294967296===this.id););return 4294967296!==this.id&&this._offset<this._buffer.length};l.delete=function(f){const c=this._offset,g=this.lookup(f);if(g)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===f;)this.id=4294967295,++this._deletedCount;this._offset=c;return g};l.lookup=function(f){const c=this._offset;if(n.isNone(this._offsets.instance)){this._offsets.instance=new Map;const g=this.copy();g._offset=-1;let b=0;for(;g.next();)g.id!==b&&(this._offsets.instance.set(g.id,
g._offset),b=g.id)}if(!this._offsets.instance.has(f))return!1;this._offset=this._offsets.instance.get(f);return 4294967296===this.id?(this._offset=c,!1):!0};l._computeCount=function(){const f=this._offset;let c=0;for(this._offset=-1;this.next();)c++;this._offset=f;return c};t._createClass(u,[{key:"count",get:function(){this._count||(this._count=this._computeCount());return this._count}},{key:"id",get:function(){return this._buffer[this._offset]},set:function(f){this._buffer[this._offset]=f}},{key:"baseZoom",
get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"boundsCount",get:function(){return this._buffer[this._offset+
9]}}]);return u}();w.MetricReader=x;w.MetricReaderNode=p;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Geometry":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../FeatureDisplayList ./Buffer ./DisplayRecordReader ../../../../webgl/VertexArrayObject".split(" "),function(w,t,n,x,p,u,l){let f=function(){function c(b,a){this._vaos=new Map;this._indicesInvalid=!1;this.geometryType=b;this._stage=
a}var g=c.prototype;g.destroy=function(){for(const [,b]of this._vaos)n.isSome(b)&&b.dispose(!1);this._indexBuffer=n.destroyMaybe(this._indexBuffer);this._vertexBuffer=n.destroyMaybe(this._vertexBuffer)};g.insert=function(b,a,d){if(b.records.byteLength)if(d=b.stride,this._vertexBuffer&&this._indexBuffer){var h=b.vertices.byteLength/d;this._indexBuffer.ensure(b.indices.byteLength/4);this._vertexBuffer.ensure(h);const {vertices:q,indices:e}=b;b=u.DisplayRecordReader.from(b.records);const k=this._vertexBuffer.insert(q,
0,q.byteLength/d,0),r=this._indexBuffer.insert(e,0,e.byteLength/4,k);b.forEach(y=>{y.indexFrom+=r;y.vertexFrom+=k});n.unwrapOrThrow(this._records,"Expected records to be defined").link(b);if(a)this._indicesInvalid=!0;else if(this._displayList)for(a=b.getCursor();a.next();)this._displayList.addRecord(a)}else{h=b.indices.byteLength/4;const q=b.vertices.byteLength/d,e=d/Uint32Array.BYTES_PER_ELEMENT,k=this._stage.bufferPool;this._records=u.DisplayRecordReader.from(b.records);this._indexBuffer=new p.Buffer("index",
h,1,k);this._vertexBuffer=new p.Buffer("vertex",q,e,k);this._indexBuffer.insert(b.indices,0,b.indices.byteLength/4,0);this._vertexBuffer.insert(b.vertices,0,b.vertices.byteLength/d,0);a&&(this._indicesInvalid=!0)}};g.remove=function(b){if(!n.isNone(this._records))for(const a of b){b=this._records.getCursor();if(!b.lookup(a))continue;const d=b.indexFrom,h=b.vertexFrom;let q=b.indexCount,e=b.vertexCount;for(;b.next()&&b.id===a;)q+=b.indexCount,e+=b.vertexCount;this._indexBuffer.free(d,q);this._vertexBuffer.free(h,
e,!0);this._records.delete(a)}};g.getVAO=function(b,a,d,h){if(!this._vertexBuffer||!this._indexBuffer||n.isNone(this._records)||!this._vertexBuffer.bufferSize)return null;const q=h?1:0;let e=this._vaos.get(q);if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||h&&this._indexBuffer.invalidatedComputeBuffer)n.applySome(e,r=>r.dispose(!1)),e=null;this._vertexBuffer.upload();this._indexBuffer.upload();h=this._indexBuffer.getGPUBuffer(b,1===q);const k=this._vertexBuffer.getGPUBuffer(b);e||
(e=new l.VertexArrayObject(b,d,a,{geometry:k},h),this._vaos.set(q,e));return e};g.forEachCommand=function(b){if(!n.isNone(this._records)){this._sortIndices(this._records);if(!this._displayList){const a=this._cursorIndexOrder;this._displayList=x.FeatureDisplayList.from(this,this.geometryType,this._records.getCursor(),a)}this._displayList.forEach(b)}};g._sortIndices=function(b){const a=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var d=0,h=b.getCursor(),q=[],e=
[],k=[];h.next();)e.push(h.index),k.push(h.sortKey),q.push(h.id);e.sort((m,v)=>{const z=k[v],A=k[m];return A===z?q[v]-q[m]:z-A});b=b.getCursor();h=a?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer();for(const m of e){if(!b.seekIndex(m))throw Error("Expected to find index");if(a){const {indexFrom:v,indexCount:z}=b;b.indexFrom=d;for(var r=0;r<z;r++)this._indexBuffer.set(d++,h.array[v+r])}else{const {vertexFrom:v,vertexCount:z}=b;var y=this._vertexBuffer.strideInt;const A=v*y;r=A+z*
y;b.vertexFrom=d/y;for(y=A;y<r;y++)this._vertexBuffer.set(d++,h.array[y])}}this._cursorIndexOrder=e;this._displayList=null}};return t._createClass(c)}();w.Geometry=f;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./cpuMapped/FreeList"],function(w,t,n,x){let p=function(){function l(f,c,g,b,a){this.target=f;this.geometryType=c;this.materialKey=
g;this.indexFrom=b;this.indexCount=a}l.prototype.extend=function(f){this.indexCount+=f};t._createClass(l,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}}]);return l}(),u=function(){function l(c,g){this.geometryType=0;this._target=c;this.geometryType=g}l.from=function(c,g,b,a){c=new l(c,g);if(n.isSome(a))for(const d of a)b.seekIndex(d),c.addRecord(b);else for(;b.next();)c.addRecord(b);return c};var f=l.prototype;f.addRecord=function(c){var g=this._target,b=this.geometryType,
a=c.materialKey;let d=c.indexFrom,h=c.indexCount;const q=c.vertexFrom;c=c.vertexCount;h||(d=q,h=c);if(n.isNone(this._head))a=new p(g,b,a,d,h),this._head=new x.List(a);else{g=null;for(b=this._head;b;){if(d<b.data.indexFrom)return this._insert(a,d,h,g,b);g=b;b=b.next}this._insert(a,d,h,g,null)}};f.forEach=function(c){n.isSome(this._head)&&this._head.forEach(c)};f.infos=function*(){if(n.isSome(this._head))for(const c of this._head.values())yield c};f._insert=function(c,g,b,a,d){if(n.isNone(a)&&n.isNone(d)){const h=
new p(this._target,this.geometryType,c,g,b);this._head=new x.List(h)}if(n.isNone(a)&&n.isSome(d))return this._insertAtHead(c,g,b,d);if(n.isSome(a)&&n.isNone(d))return this._insertAtEnd(c,g,b,a);if(n.isSome(a)&&n.isSome(d))return this._insertAtMiddle(c,g,b,a,d)};f._insertAtHead=function(c,g,b,a){c===a.data.materialKey&&g+b===a.data.indexFrom?(a.data.indexFrom=g,a.data.indexCount+=b):(c=new p(this._target,this.geometryType,c,g,b),this._head=new x.List(c),this._head.next=a)};f._insertAtEnd=function(c,
g,b,a){a.data.materialKey===c&&a.data.indexEnd===g?a.data.indexCount+=b:(c=new p(this._target,this.geometryType,c,g,b),c=new x.List(c),a.next=c)};f._insertAtMiddle=function(c,g,b,a,d){a.data.materialKey===c&&a.data.indexEnd===g?(a.data.indexCount+=b,a.data.materialKey===d.data.materialKey&&a.data.indexEnd===d.data.indexFrom&&(a.data.indexCount+=d.data.indexCount,a.next=d.next)):c===d.data.materialKey&&g+b===d.data.indexFrom?(d.data.indexFrom=g,d.data.indexCount+=b):(c=new p(this._target,this.geometryType,
c,g,b),c=new x.List(c),a.next=c,c.next=d)};return t._createClass(l)}();w.FeatureDisplayList=u;w.FeatureDisplayListInfo=p;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../BufferPool ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(w,t,n,x,p,u,l){let f=function(){function c(b,a,d,h){h=x.TypedBuffer.create(a*
d*Uint32Array.BYTES_PER_ELEMENT,h);this.size=a;this.strideInt=d;this.bufferType=b;this.dirty={start:Infinity,end:0};this._gpu=null;this._cpu=h;this.clear()}var g=c.prototype;g.invalidate=function(){this._invalidateTriangleBuffer();n.applySome(this._gpu,b=>b.dispose());this._gpu=null};g._invalidateTriangleBuffer=function(){n.applySome(this._gpuComputeTriangles,b=>b.dispose());this._gpuComputeTriangles=null};g.destroy=function(){n.applySome(this._gpu,b=>b.dispose());n.applySome(this._gpuComputeTriangles,
b=>b.dispose());n.applySome(this._cpu,b=>b.destroy());n.applySome(this._cpu2,b=>b.destroy())};g.clear=function(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new p.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0};g.ensure=function(b){if(!(this.maxAvailableSpace()>=b)&&b*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const a=this._cpu.length/this.strideInt;b=Math.round(1.25*(a+b));this._cpu.expand(b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);
this.freeList.free(a,b-a)}};g.set=function(b,a){this._cpu.array[b]!==a&&(this._cpu.array[b]=a,this.dirty.start=Math.min(b,this.dirty.start),this.dirty.end=Math.max(b,this.dirty.end))};g.getGPUBuffer=function(b,a=!1){if(!this.bufferSize)return null;if(a){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");n.isNone(this._gpuComputeTriangles)&&(this._gpuComputeTriangles=this._createComputeBuffer(b));return this._gpuComputeTriangles}n.isNone(this._gpu)&&
(this._gpu=this._createBuffer(b));return this._gpu};g.getCPUBuffer=function(){this._cpu2||(this._cpu2=this._cpu.slice());this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT);this._cpu2.set(this._cpu);return this._cpu2};g.maxAvailableSpace=function(){return this.freeList.maxAvailableSpace()};g.insert=function(b,a,d,h){const q=d*this.strideInt;if(!q)return 0;b=new Uint32Array(b,a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,q);d=n.unwrapOrThrow(this.freeList.firstFit(d),
"First fit region must be defined")*this.strideInt;a=d/this.strideInt-a;if(0!==h)for(let e=0;e<b.length;e++)b[e]+=h;this._cpu.array.set(b,d);this.dirty.start=Math.min(this.dirty.start,d);this.dirty.end=Math.max(this.dirty.end,d+q);this.fillPointer=Math.max(this.fillPointer,d+q);return a};g.free=function(b,a,d){const h=b*this.strideInt,q=(b+a)*this.strideInt;if(!0===d)for(d=b;d!==b+a;d++)this._cpu.array[d*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,h);this.dirty.end=Math.max(this.dirty.end,
q);this.freeList.free(b,a)};g.upload=function(){this.dirty.end&&(this._invalidateTriangleBuffer(),n.isNone(this._gpu)||this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)};g._createBuffer=function(b){const a=l.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?u.BufferObject.createIndex(b,a,this._cpu.array):u.BufferObject.createVertex(b,a,this._cpu.array)};g._createComputeBuffer=function(b){const a=l.Usage.DYNAMIC_DRAW,
d=new Uint32Array(this.fillPointer/3);for(let h=0;h<this.fillPointer;h+=3)d[h/3]=this._cpu.array[h];return u.BufferObject.createIndex(b,a,d)};t._createClass(c,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"invalidated",get:function(){return 0<this.bufferSize&&!this._gpu}},{key:"invalidatedComputeBuffer",get:function(){return 0<this.bufferSize&&!this._gpuComputeTriangles}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}}]);return c}();w.Buffer=
f;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/has ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass".split(" "),function(w,t,n,
x,p,u,l,f){n=function(c){function g(a){a=b.call(this,a);a.tiles=new Map;return a}w._inherits(g,c);var b=w._createSuper(g);c=g.prototype;c.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};c.acquireTile=function(a){const d=this.createTile(a);d.once("isReady",()=>this.notifyChange("updating"));this.tiles.set(a.id,d);this.notifyChange("updating");return d};c.forceAttributeTextureUpload=function(){};c.forEachTile=function(a){this.tiles.forEach(a)};c.releaseTile=
function(a){this.tiles.delete(a.key.id);this.notifyChange("updating");this.disposeTile(a)};c.isUpdating=function(){let a=!0;this.tiles.forEach(h=>{a=a&&h.isReady});const d=!a;if(x("esri-2d-log-updating")){let h="";this.tiles.forEach(q=>{h+=`-> ${q.key.id}: isReady: ${q.isReady} status: ${q.updateStatus}\n`;a=a&&q.isReady});console.log(`Updating BaseTileRenderer ${d}\n${h}`)}return d};c.setHighlight=function(){};c.invalidateLabels=function(){};c.requestUpdate=function(){this.layerView.requestUpdate()};
w._createClass(g,[{key:"updating",get:function(){return this.isUpdating()}}]);return g}(n.HandleOwner);t.__decorate([p.property()],n.prototype,"layer",void 0);t.__decorate([p.property()],n.prototype,"layerView",void 0);t.__decorate([p.property()],n.prototype,"tileInfoView",void 0);t.__decorate([p.property()],n.prototype,"updating",null);return n=t.__decorate([f.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],n)})},"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../engine/brushes ../../../../engine/FeatureContainer ../../../../engine/webgl/enums".split(" "),
function(w,t,n,x,p,u,l){const f=n("featurelayer-order-by-server-enabled");n=function(c){function g(a,d,h,q){a=b.call(this,a);a._hitTestsRequests=[];a._layer=h;a._layerView=d;a._onUpdate=q;return a}t._inherits(g,c);var b=t._createSuper(g);c=g.prototype;c.renderChildren=function(a){this.attributeView.update();this.hasAnimation&&a.painter.effects.integrate.draw(a,a.attributeView);t._get(t._getPrototypeOf(g.prototype),"renderChildren",this).call(this,a)};c.hasEmptyAttributeView=function(){return this.attributeView.isEmpty()};
c.isUpdating=function(){return this.attributeView.isUpdating()};c.hitTest=function(a){let d=this._hitTestsRequests.find(({x:q,y:e})=>q===a.x&&e===a.y);const h=x.createResolver();d?d.resolvers.push(h):(d={x:a.x,y:a.y,resolvers:[h]},this._hitTestsRequests.push(d));this.requestRender();return h.promise};c.onTileData=function(a,d){const h=f&&"orderBy"in this._layer&&this._layer.orderBy,q=h&&h?.length&&!h[0].valueExpression&&h[0].field;a.patch(d,!!h&&this._layerView.orderByFields===q);this.contains(a)||
this.addChild(a);this.requestRender()};c.onTileError=function(a){this.contains(a)||this.addChild(a)};c.updateTransitionProperties=function(a,d){t._get(t._getPrototypeOf(g.prototype),"updateTransitionProperties",this).call(this,a,d);this._layerView.featureEffectView.transitionStep(a,d);this._layerView.featureEffectView.transitioning&&this.requestRender()};c.doRender=function(a){const {minScale:d,maxScale:h}=this._layer.effectiveScaleRange,q=a.state.scale;q<=(d||Infinity)&&q>=h&&t._get(t._getPrototypeOf(g.prototype),
"doRender",this).call(this,a)};c.afterRender=function(a){t._get(t._getPrototypeOf(g.prototype),"afterRender",this).call(this,a);this._hitTestsRequests.length&&this.requestRender()};c.onAttributeStoreUpdate=function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate();this._onUpdate()};c.setStencilReference=function(a){const {rendererSchema:d}=a.rendererInfo;if("dot-density"===d?.type&&1<d?.dotSize||"heatmap"===d?.type)for(const h of this.children)h.stencilRef=h.key.level+1;else t._get(t._getPrototypeOf(g.prototype),
"setStencilReference",this).call(this,a)};c.prepareRenderPasses=function(a){const d=a.registerRenderPass({name:"label",brushes:[p.brushes.label],target:()=>this.hasLabels?this.children:null,drawPhase:l.WGLDrawPhase.LABEL|l.WGLDrawPhase.LABEL_ALPHA}),h=a.registerRenderPass({name:"geometry",brushes:[p.brushes.fill,p.brushes.dotDensity,p.brushes.line,p.brushes.marker,p.brushes.heatmap,p.brushes.pieChart,p.brushes.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,
effects:[{apply:a.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:a.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:a.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]}),q=a.registerRenderPass({name:"highlight",brushes:[p.brushes.fill,p.brushes.dotDensity,p.brushes.line,
p.brushes.marker,p.brushes.pieChart,p.brushes.text],target:()=>this.children,drawPhase:l.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:a.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...t._get(t._getPrototypeOf(g.prototype),"prepareRenderPasses",this).call(this,a),h,q,d]};t._createClass(g,[{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some(d=>!!d.labelingInfo?.length&&
d.labelsVisible);var a=this._layer.featureReduction;a=a&&"labelingInfo"in a&&a.labelsVisible&&a.labelingInfo&&a.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!a}}]);return g}(u.FeatureContainer);w.WGLFeatureView=n;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../engine/webgl/FeatureTile ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),function(w,
t,n,x,p,u,l,f,c,g,b,a,d,h,q,e){u=function(k){function r(){var m=y.apply(this,arguments);m.type="symbol";return m}w._inherits(r,k);var y=w._createSuper(r);k=r.prototype;k.install=function(m){const v=new e.WGLFeatureView(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=v;m.addChild(v)};k.uninstall=function(m){m.removeChild(this.featuresView);this.featuresView=x.destroyMaybe(this.featuresView)};k.fetchResource=function(m,v){({url:m}=m);const z=this.featuresView.stage;
try{return z.resourceManager.fetchResource(m,{signal:v.signal})}catch(A){return p.isAbortError(A)?Promise.resolve({width:0,height:0}):Promise.reject(A)}};k.isUpdating=function(){const m=w._get(w._getPrototypeOf(r.prototype),"isUpdating",this).call(this),v=!this.featuresView||this.featuresView.isUpdating();var z=this.featuresView?.hasEmptyAttributeView();z=m||v||m&&z;n("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${z}\n  -> updatingTiles ${m}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${v}`);
return z};k.hitTest=function(m){return this.featuresView.hitTest(m)};k.supportsRenderer=function(m){return null!=m&&"simple class-breaks unique-value dot-density dictionary heatmap pie-chart".split(" ").includes(m.type)};k.onConfigUpdate=function(m){var v=null;m&&"visualVariables"in m&&(v=(d.simplifyVVRenderer(m).visualVariables||[]).map(z=>{const A=z.clone();"normalizationField"in z&&(A.normalizationField=null);z.valueExpression&&"$view.scale"!==z.valueExpression&&(A.valueExpression=null,A.field=
"nop");return A}),v=q.convertVisualVariables(v));this.featuresView.setRendererInfo(m,v,this.layerView.featureEffect)};k.onTileData=function(m){const v=this.tiles.get(m.tileKey);if(v&&m.data)this.featuresView.onTileData(v,m.data);this.layerView.view.labelManager.requestUpdate()};k.onTileError=function(m){if(m=this.tiles.get(m.tileKey))this.featuresView.onTileError(m)};k.forceAttributeTextureUpload=function(){this.featuresView.attributeView.forceTextureUpload()};k.lockGPUUploads=function(){this.featuresView.attributeView.lockTextureUpload();
this.tiles.forEach(m=>m.lock())};k.unlockGPUUploads=function(){this.featuresView.attributeView.unlockTextureUpload();this.tiles.forEach(m=>m.unlock())};k.getMaterialItems=async function(m){return this.featuresView.getMaterialItems(m)};k.invalidateLabels=function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()};k.createTile=function(m){const v=this.tileInfoView.getTileBounds(b.create(),m),z=this.tileInfoView.getTileResolution(m.level);return new a.FeatureTile(m,z,v[0],
v[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())};k.disposeTile=function(m){this.featuresView.removeChild(m);m.destroy();this.layerView.view.labelManager.requestUpdate()};return w._createClass(r)}(h);return u=t.__decorate([g.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],u)});