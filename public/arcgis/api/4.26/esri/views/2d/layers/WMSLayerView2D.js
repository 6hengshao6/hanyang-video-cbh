// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../engine/BitmapContainer ./LayerView2D ./support/ExportStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/WMSLayerView".split(" "),
function(l,m,A,B,C,D,t,e,N,O,E,F,u,G,H,I,J,K){e=function(b){function h(){var a=L.apply(this,arguments);a.bitmapContainer=new u.BitmapContainer;return a}l._inherits(h,b);var L=l._createSuper(h);b=h.prototype;b.supportsSpatialReference=function(a){return this.layer.serviceSupportsSpatialReference(a)};b.update=function(a){this.strategy.update(a).catch(c=>{C.isAbortError(c)||A.getLogger(this.declaredClass).error(c)})};b.attach=function(){const {layer:a}=this,{imageMaxHeight:c,imageMaxWidth:f}=a;this.bitmapContainer=
new u.BitmapContainer;this.container.addChild(this.bitmapContainer);this.strategy=new H({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:c,imageMaxWidth:f,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1});this.addAttachHandles(D.watch(()=>this.exportImageVersion,()=>this.requestUpdate()))};b.detach=function(){this.strategy=B.destroyMaybe(this.strategy);this.container.removeAllChildren()};b.moveStart=
function(){};b.viewChange=function(){};b.moveEnd=function(){this.requestUpdate()};b.createFetchPopupFeaturesQuery=function(a){const {view:c,bitmapContainer:f}=this,{x:g,y:n}=a,{spatialReference:M}=c;let d,p=0,v=0;f.children.some(k=>{const {width:w,height:x,resolution:y,x:q,y:r}=k;k=q+y*w;const z=r-y*x;return g>=q&&g<=k&&n<=r&&n>=z?(d=new F({xmin:q,ymin:z,xmax:k,ymax:r,spatialReference:M}),p=w,v=x,!0):!1});if(!d)return null;a=d.width/p;return{extent:d,width:p,height:v,x:Math.round((g-d.xmin)/a),y:Math.round((d.ymax-
n)/a)}};b.doRefresh=async function(){this.requestUpdate()};b.isUpdating=function(){return this.strategy.updating||this.updateRequested};b.fetchImage=function(a,c,f,g){return this.layer.fetchImageBitmap(a,c,f,{timeExtent:this.timeExtent,...g})};return l._createClass(h)}(K(J(G.LayerView2DMixin(I))));m.__decorate([t.property()],e.prototype,"strategy",void 0);m.__decorate([t.property()],e.prototype,"updating",void 0);return e=m.__decorate([E.subclass("esri.views.2d.layers.WMSLayerView2D")],e)});