// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(r,x,p,u,y,z,A,B,C,v,n,D){const E=Math.PI/180,w=()=>C.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",
count:2,type:n.DataType.FLOAT}]});return function(k){function q(c){var a=F.call(this);a._program=null;a._vao=null;a._vertexBuffer=null;a._indexBuffer=null;a._dvsMat3=u.create();a._localOrigin={x:0,y:0};a._getBounds=c;return a}r._inherits(q,k);var F=r._createSuper(q);k=q.prototype;k.destroy=function(){this._vao&&(this._vao.dispose(!0),this._indexBuffer=this._vertexBuffer=this._vao=null);this._program=x.disposeMaybe(this._program)};k.doRender=function(c){const {context:a}=c,h=this._getBounds();1>h.length||
(this._createShaderProgram(a),this._updateMatricesAndLocalOrigin(c),this._updateBufferData(a,h),a.setBlendingEnabled(!0),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),a.setStencilTestEnabled(!1),a.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA),a.setColorMask(!0,!0,!0,!0),c=this._program,a.bindVAO(this._vao),a.useProgram(c),c.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),a.gl.lineWidth(1),a.drawElements(n.PrimitiveType.LINES,8*h.length,n.DataType.UNSIGNED_INT,0),a.bindVAO())};
k._createTransforms=function(){return{dvs:u.create()}};k._createShaderProgram=function(c){this._program||(this._program=c.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",
w().attributes))};k._updateMatricesAndLocalOrigin=function(c){var {state:a}=c;const {displayMat3:h,size:l,resolution:d,pixelRatio:e,rotation:b,viewpoint:f}=a;c=E*b;const {x:g,y:G}=f.targetGeometry;a=A.normalizeMapX(g,a.spatialReference);this._localOrigin.x=a;this._localOrigin.y=G;a=e*l[0];const t=e*l[1],H=d*a,I=d*t,m=p.identity(this._dvsMat3);p.multiply(m,m,h);p.translate(m,m,y.fromValues(a/2,t/2));p.scale(m,m,z.fromValues(l[0]/H,-t/I,1));p.rotate(m,m,-c)};k._updateBufferData=function(c,a){const {x:h,
y:l}=this._localOrigin,d=new Float32Array(8*a.length),e=new Uint32Array(8*a.length);let b=0,f=0;for(const g of a)g&&(d[2*b]=g[0]-h,d[2*b+1]=g[1]-l,d[2*b+2]=g[0]-h,d[2*b+3]=g[3]-l,d[2*b+4]=g[2]-h,d[2*b+5]=g[3]-l,d[2*b+6]=g[2]-h,d[2*b+7]=g[1]-l,e[f]=b+0,e[f+1]=b+3,e[f+2]=b+3,e[f+3]=b+2,e[f+4]=b+2,e[f+5]=b+1,e[f+6]=b+1,e[f+7]=b+0,b+=4,f+=8);this._vertexBuffer?this._vertexBuffer.setData(d.buffer):this._vertexBuffer=v.BufferObject.createVertex(c,n.Usage.DYNAMIC_DRAW,d.buffer);this._indexBuffer?this._indexBuffer.setData(e):
this._indexBuffer=v.BufferObject.createIndex(c,n.Usage.DYNAMIC_DRAW,e);this._vao||(a=w(),this._vao=new D.VertexArrayObject(c,a.attributes,a.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer))};return r._createClass(q)}(B.DisplayObject)});