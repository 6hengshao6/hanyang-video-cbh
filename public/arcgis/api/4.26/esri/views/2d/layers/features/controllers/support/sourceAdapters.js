// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/workers/Connection ../../../../../../geometry/support/quantizationUtils ../../../../../../layers/graphics/featureConversionUtils ../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../rest/query/operations/query ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderPBF".split(" "),function(p,e,v,m,w,t,q,u,r,k,x){async function y(c){const b=
new w;await b.open(c,{});return b}let l=function(){function c(b){this.service=b}c.prototype.destroy=function(){};return e._createClass(c)}(),z=function(c){function b(a){var d=h.call(this,a);d._portsOpen=y(a.source).then(g=>d.client=g);return d}e._inherits(b,c);var h=e._createSuper(b);c=b.prototype;c.destroy=function(){this.client.close();this.client=null};c.executeQuery=async function(a,d){await this._portsOpen;a=await this.client.invoke("queryFeatures",a.toJSON(),d);return k.FeatureSetReaderJSON.fromFeatureSet(a,
this.service)};return e._createClass(b)}(l),A=function(c){function b(){return h.apply(this,arguments)}e._inherits(b,c);var h=e._createSuper(b);b.prototype.executeQuery=async function(a,d){({data:d}=await r.executeQueryPBFBuffer(this.service.source,a,d));return x.FeatureSetReaderPBF.fromBuffer(d,this.service,!a.quantizationParameters)};return e._createClass(b)}(l),E=function(c){function b(){return h.apply(this,arguments)}e._inherits(b,c);var h=e._createSuper(b);b.prototype.executeQuery=async function(a,
d){const {source:g,capabilities:n,spatialReference:B,objectIdField:C,geometryType:D}=this.service;if(m.isSome(a.quantizationParameters)&&!n.query.supportsQuantization){const f=a.clone();a=t.toQuantizationTransform(m.unwrap(f.quantizationParameters));f.quantizationParameters=null;({data:d}=await r.executeQuery(g,f,B,d));d=q.convertFromFeatureSet(d,C);q.quantizeOptimizedFeatureSet(a,d);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(d,this.service)}({data:a}=await r.executeQuery(g,a,this.service.spatialReference,
d));"esriGeometryPoint"===D&&(a.features=a.features?.filter(f=>m.isSome(f.geometry)?(f=f.geometry,Number.isFinite(f.x)&&Number.isFinite(f.y)):!0));return k.FeatureSetReaderJSON.fromFeatureSet(a,this.service)};return e._createClass(b)}(l),F=function(c){function b(){return h.apply(this,arguments)}e._inherits(b,c);var h=e._createSuper(b);b.prototype.executeQuery=async function(a,d){var {capabilities:g}=this.service;if(a.quantizationParameters&&!g.query.supportsQuantization){const n=a.clone();g=t.toQuantizationTransform(m.unwrap(n.quantizationParameters));
n.quantizationParameters=null;a=await u.queryOptimizedFeatureSet(this.service.source,a,d);q.quantizeOptimizedFeatureSet(g,a);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(a,this.service)}a=await u.queryOptimizedFeatureSet(this.service.source,a,d);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(a,this.service)};return e._createClass(b)}(l);p.SourceAdapter=l;p.createSourceAdapter=function(c){const {capabilities:b}=c;return"ogc-source"===c.source?.type?new F(c):Array.isArray(c.source)?
new z(c):b.query.supportsFormatPBF&&v("featurelayer-pbf")?new A(c):new E(c)};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});