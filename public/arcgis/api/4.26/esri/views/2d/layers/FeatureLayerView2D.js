// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/arrayUtils ./core/has ./core/accessorSupport/decorators/subclass".split(" "),function(r,h,f,e,w,E,z,n){f=function(u){function m(){var v=d.apply(this,arguments);v.isAggregate=!0;return v}r._inherits(m,u);var d=r._createSuper(m);u=m.prototype;u.getEffectivePopupTemplate=function(v){return this.popupTemplate?
this.popupTemplate:(v=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in v&&v.popupEnabled?v.popupTemplate:null};u.getObjectId=function(){return this.attributes.aggregateId};return r._createClass(m)}(f);h.__decorate([e.property({type:Boolean})],f.prototype,"isAggregate",void 0);return f=h.__decorate([n.subclass("esri.AggregateGraphic")],f)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),
function(r,h,f,e,w,E,z,n,u,m){f=function(d){function v(c){var l=B.call(this,c);l._filter=null;l.duration=e("mapview-transitions-duration");l._excludedEffectView=new m.EffectView(c);l._includedEffectView=new m.EffectView(c);return l}r._inherits(v,d);var B=r._createSuper(v);d=v.prototype;d.transitionStep=function(c,l){this._set("scale",l);this.transitioning?(this._includedEffectView.transitionStep(c,l),this._excludedEffectView.transitionStep(c,l),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=
l,this._includedEffectView.scale=l)};d.endTransitions=function(){this._includedEffectView.endTransitions();this._excludedEffectView.endTransitions();this._filter=null};d._transitionTo=function(c){const l=this._get("featureEffect");c=w.unwrap(c);const t=w.unwrap(c?.includedEffect),A=w.unwrap(c?.excludedEffect),C=this._includedEffectView.canTransitionTo(t)&&this._excludedEffectView.canTransitionTo(A);this._includedEffectView.effect=t;this._excludedEffectView.effect=A;this._set("featureEffect",c);this._filter=
c?.filter||l?.filter||null;C||this.endTransitions()};r._createClass(v,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(c){this._get("featureEffect")!==c&&this._transitionTo(c)}},{key:"filter",get:function(){return this._filter||w.unwrap(this.featureEffect)?.filter||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},
{key:"scale",set:function(c){this._set("scale",c);this._excludedEffectView.scale=c;this._includedEffectView.scale=c}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}}]);return v}(f);h.__decorate([E.property()],f.prototype,"_filter",void 0);h.__decorate([E.property()],f.prototype,"_excludedEffectView",void 0);h.__decorate([E.property()],f.prototype,"_includedEffectView",void 0);h.__decorate([E.property()],f.prototype,"duration",
void 0);h.__decorate([E.property()],f.prototype,"excludedEffects",null);h.__decorate([E.property()],f.prototype,"featureEffect",null);h.__decorate([E.property()],f.prototype,"filter",null);h.__decorate([E.property()],f.prototype,"hasEffects",null);h.__decorate([E.property()],f.prototype,"includedEffects",null);h.__decorate([E.property({value:0})],f.prototype,"scale",null);h.__decorate([E.property()],f.prototype,"transitioning",null);return f=h.__decorate([u.subclass("esri.layers.effects.FeatureEffectView")],
f)})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),function(r,h,f,e,w,E,z,n,u,m,d,v,B){e=function(c){function l(){var A=
t.apply(this,arguments);A.features=[];return A}r._inherits(l,c);var t=r._createSuper(l);l.prototype.readFeatures=function(A,C){C=B.fromJSON(C.spatialReference);const G=[];for(let I=0;I<A.length;I++){var D=A[I];const x=f.fromJSON(D);var L=D.geometry&&D.geometry.spatialReference;w.isSome(x.geometry)&&!L&&(x.geometry.spatialReference=C);D=D.aggregateGeometries;L=x.aggregateGeometries;if(D&&w.isSome(L))for(const F in L){const T=L[F],g=D[F]?.spatialReference;w.isSome(T)&&!g&&(T.spatialReference=C)}G.push(x)}return G};
return r._createClass(l)}(v);h.__decorate([E.property({type:[f],json:{write:!0}})],e.prototype,"features",void 0);h.__decorate([m.reader("features")],e.prototype,"readFeatures",null);return e=h.__decorate([d.subclass("esri.rest.support.AggregateFeatureSet")],e)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(r,h,f,e,w,E,z,n,u,m,d,v,B,c,l,t,A){const C=e.ofType({key:"type",base:null,typeMap:{rect:l,path:A,geometry:t}});r.LayerView2DMixin=G=>{G=function(D){function L(){var x=I.apply(this,arguments);x.attached=!1;x.clips=new C;x.lastUpdateId=-1;x.moving=!1;x.updateRequested=!1;x.visibleAtCurrentScale=!1;x.highlightOptions=null;return x}h._inherits(L,D);var I=h._createSuper(L);D=L.prototype;D.initialize=function(){const x=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&x&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new E("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new B.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([z.watch(()=>this.suspended,F=>{this.container&&(this.container.visible=!F);this.view&&!F&&this.updateRequested&&this.view.requestUpdate()},z.syncAndInitial),
z.watch(()=>this.layer?.opacity??1,F=>{this.container&&(this.container.opacity=F)},z.syncAndInitial),z.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",F=>{this.container&&(this.container.blendMode=F)},z.syncAndInitial),z.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,F=>{this.container&&(this.container.effect=F)},z.syncAndInitial),z.watch(()=>this.highlightOptions,F=>this.container.highlightOptions=F,z.syncAndInitial),z.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},z.syncAndInitial),z.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:F})=>{F=null!=F?this.isVisibleAtScale(F):!1;F!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",F)},z.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(F=>{F===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};D.destroy=function(){this.processDetach();this.updateRequested=!1};D.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};D.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};D.isVisibleAtScale=function(x){const F=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!F)return!0;
const {minScale:T,maxScale:g}=F;return(0===T||x<=T)&&(0===g||x>=g)};D.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};D.processUpdate=function(x){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",x),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(x)))};D.hitTest=function(x,F){return Promise.resolve(null)};D.supportsSpatialReference=function(x){return!0};
D.canResume=function(){return this.spatialReferenceSupported?h._get(h._getPrototypeOf(L.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};D.getSuspendInfo=function(){const x=h._get(h._getPrototypeOf(L.prototype),"getSuspendInfo",this).call(this),F=!this.spatialReferenceSupported,T=this.visibleAtCurrentScale;F&&(x.spatialReferenceNotSupported=F);T&&(x.outsideScaleRange=T);return x};D.addAttachHandles=function(x){this.addHandles(x,"attach")};h._createClass(L,[{key:"spatialReferenceSupported",
get:function(){const x=this.view?.spatialReference;return null==x||this.supportsSpatialReference(x)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return L}(G);f.__decorate([n.property()],G.prototype,"attached",void 0);f.__decorate([n.property({type:C,set(D){D=w.referenceSetter(D,this._get("clips"),C);this._set("clips",D)}})],G.prototype,"clips",void 0);f.__decorate([n.property()],
G.prototype,"container",void 0);f.__decorate([n.property()],G.prototype,"moving",void 0);f.__decorate([n.property({readOnly:!0})],G.prototype,"spatialReferenceSupported",null);f.__decorate([n.property({readOnly:!0})],G.prototype,"updateParameters",void 0);f.__decorate([n.property()],G.prototype,"updateRequested",void 0);f.__decorate([n.property()],G.prototype,"updating",null);f.__decorate([n.property()],G.prototype,"view",void 0);f.__decorate([n.property({readOnly:!0})],G.prototype,"visibleAtCurrentScale",
void 0);f.__decorate([n.property({type:c})],G.prototype,"highlightOptions",void 0);return G=f.__decorate([v.subclass("esri.views.2d.layers.LayerView2D")],G)};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(r,h,f,e,w,E,z,n){var u;e=u=function(m){function d(B){B=v.call(this,B);B.type="rect";B.left=null;B.right=null;B.top=null;B.bottom=null;return B}r._inherits(d,m);var v=r._createSuper(d);m=d.prototype;m.clone=function(){return new u({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};m.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return r._createClass(d)}(n);h.__decorate([f.property({type:[Number,
String],json:{write:!0}})],e.prototype,"left",void 0);h.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"right",void 0);h.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"top",void 0);h.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"bottom",void 0);return e=u=h.__decorate([z.subclass("esri.views.layers.support.ClipRect")],e)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(r,h,f,e,w,E,z,n){f=function(u){function m(){return d.apply(this,arguments)}r._inherits(m,u);var d=r._createSuper(m);r._createClass(m,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return m}(f.JSONSupport);h.__decorate([e.property({readOnly:!0})],f.prototype,"version",null);return f=h.__decorate([n.subclass("esri.views.layers.support.ClipArea")],f)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(r,h,f,e,w,E,z,n,u,m,d,v,B){var c;f={base:u,key:"type",typeMap:{extent:v,polygon:B}};d=c=function(l){function t(C){C=A.call(this,C);C.type="geometry";C.geometry=null;return C}r._inherits(t,l);var A=r._createSuper(t);l=t.prototype;l.clone=function(){return new c({geometry:this.geometry?.clone()??null})};l.commitVersionProperties=function(){this.commitProperty("geometry")};return r._createClass(t)}(d);h.__decorate([e.property({types:f,json:{read:m.fromJSON,write:!0}})],d.prototype,"geometry",
void 0);return d=c=h.__decorate([n.subclass("esri.views.layers.support.Geometry")],d)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(r,h,f,e,w,E,z,n){e=function(u){function m(v){v=d.call(this,v);v.type="path";
v.path=[];return v}r._inherits(m,u);var d=r._createSuper(m);m.prototype.commitVersionProperties=function(){this.commitProperty("path")};return r._createClass(m)}(n);h.__decorate([f.property({type:[[[Number]]],json:{write:!0}})],e.prototype,"path",void 0);return e=h.__decorate([z.subclass("esri.views.layers.support.Path")],e)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports"],function(r,h){const f=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},
Symbol.toStringTag,{value:"Module"}));h.createOrReuseTileRenderer=async function(e,w){if(!e)return null;switch(e.type){case "symbol":return new (await new Promise((E,z)=>r(["./tileRenderers/SymbolTileRenderer"],n=>E(f(n)),z))).default(w);case "heatmap":return new (await new Promise((E,z)=>r(["./tileRenderers/HeatmapTileRenderer"],n=>E(f(n)),z))).default(w)}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(r,h,f,e,w,E,z,n,u){function m(c){return c.some(l=>l.globalId)}function d(c){return c.filter(l=>!l.error).map(l=>l.objectId??l.globalId).filter(l=>null!=l)}function v(c,l){c=new Set(c);for(const t of l.values())c.add(t);return c}function B(c,l){c=new Set(c);for(const t of l.values())c.delete(t);return c}f=function(c){function l(A){var C=t.call(this,A);C._hasGlobalIds=!1;C._notifyUpdating=()=>{C.notifyChange("updating")};return C}r._inherits(l,c);var t=r._createSuper(l);c=l.prototype;c.normalizeCtorArgs=
function(A){this._queueProcessor=new u.QueueProcessor({concurrency:1,process:A.process});return{}};c.destroy=function(){this.clear()};c.clear=function(){this._queueProcessor.clear()};c.push=function(A){const C=this._queueProcessor;var G=C.last();switch(A.type){case "update":case "refresh":if(G?.type===A.type)return;C.push(A).then(this._notifyUpdating,this._notifyUpdating);break;case "edit":(G="processed-edit"===G?.type?G:null)&&C.popLast();A=this._mergeEdits(G,A);for(const D of A)D&&C.push(D).then(this._notifyUpdating,
this._notifyUpdating)}this.notifyChange("updating")};c._mergeEdits=function(A,C){const {addedFeatures:G,deletedFeatures:D,updatedFeatures:L}=C.edits;if(this._hasGlobalIds=this._hasGlobalIds||m(G)||m(L)||m(D))return C=[...G,...L],[A,{type:"processed-edit",edits:{addOrModified:C,removed:D}}];C=new Set(d(A?.edits.addOrModified??[]));A=new Set(d(A?.edits.removed??[]));const I=new Set([...d(G),...d(L)]),x=new Set(d(D));C=Array.from(v(B(C,x),I)).map(F=>({objectId:F}));A=Array.from(v(B(A,I),x)).map(F=>({objectId:F}));
return[{type:"processed-edit",edits:{addOrModified:C,removed:A}}]};r._createClass(l,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return l}(f);h.__decorate([e.property({readOnly:!0})],f.prototype,"updating",null);h.__decorate([e.property()],f.prototype,"process",void 0);return f=h.__decorate([n.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],f)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(r,h,f,e,w,E,z,n,u,m){f=function(d){function v(c){c=B.call(this,c);c._startupResolver=e.createResolver();c.isReady=!1;return c}r._inherits(v,d);var B=r._createSuper(v);d=v.prototype;d.initialize=function(){this._controller=new AbortController;this.addResolvingPromise(this._startWorker(this._controller.signal))};d.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};d.startup=async function(c,l,t,A){await this.when();var C=this._controller.signal;C=Array.isArray(t.source)?
{transferList:t.source,signal:C}:void 0;c=c.tileInfo.toJSON();await this._connection.invoke("startup",{service:t,config:l,tileInfo:c,tiles:A},C);this._startupResolver.resolve();this._set("isReady",!0)};d.updateTiles=async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("updateTiles",c))};d.update=async function(c){c={config:c};await this._startupResolver.promise;return this._connection.invoke("update",c)};d.applyUpdate=async function(c){await this._startupResolver.promise;
return this._connection.invoke("applyUpdate",c)};d.setHighlight=async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",c))};d.stop=async function(){await this._startupResolver.promise;if(!this.closed)return e.ignoreAbortErrors(this._connection.invoke("stop"))};d.refresh=async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.refresh",c))};d.querySummaryStatistics=
async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",{query:c.toJSON(),params:l},t)};d.queryAggregateSummaryStatistics=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateSummaryStatistics",{query:c.toJSON(),params:l},t)};d.queryUniqueValues=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryUniqueValues",{query:c.toJSON(),
params:l},t)};d.queryAggregateUniqueValues=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateUniqueValues",{query:c.toJSON(),params:l},t)};d.queryClassBreaks=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryClassBreaks",{query:c.toJSON(),params:l},t)};d.queryAggregateClassBreaks=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateClassBreaks",
{query:c.toJSON(),params:l},t)};d.queryHistogram=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryHistogram",{query:c.toJSON(),params:l},t)};d.queryAggregateHistogram=async function(c,l,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateHistogram",{query:c.toJSON(),params:l},t)};d.queryFeatures=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",
c?.toJSON(),l)};d.queryVisibleFeatures=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryVisibleFeatures",c?.toJSON(),l)};d.queryObjectIds=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",c?.toJSON(),l)};d.queryFeatureCount=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",c?.toJSON(),l)};d.queryExtent=async function(c,
l){return this._connection.invoke("controller.queryExtent",c.toJSON(),l)};d.queryLatestObservations=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",c.toJSON(),l)};d.queryStatistics=async function(c){await this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",c)};d.queryAggregates=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregates",
c?.toJSON(),l)};d.queryAggregateCount=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateCount",c?.toJSON(),l)};d.queryAggregateIds=async function(c,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateIds",c?.toJSON(),l)};d.getObjectId=async function(c){await this._startupResolver.promise;return this._connection.invoke("controller.getObjectId",c)};d.getDisplayId=async function(c){await this._startupResolver.promise;
return this._connection.invoke("controller.getDisplayId",c)};d.getFeatures=async function(c){await this._startupResolver.promise;return this._connection.invoke("controller.getFeatures",c)};d.getAggregates=async function(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")};d.getAggregateValueRanges=async function(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")};d.mapValidDisplayIds=async function(c){await this._startupResolver.promise;
return this._connection.invoke("controller.mapValidDisplayIds",c)};d.onEdits=async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.onEdits",c))};d.enableEvent=async function(c,l){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:c,value:l}))};d.pauseStream=async function(){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))};
d.resumeStream=async function(){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))};d.sendMessageToSocket=async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToSocket",c))};d.sendMessageToClient=async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToClient",c))};d.updateCustomParameters=
async function(c){await this._startupResolver.promise;return e.ignoreAbortErrors(this._connection.invoke("controller.updateCustomParameters",c))};d._startWorker=async function(c){try{this._connection=await w.open("Pipeline",{client:this.client,strategy:"dedicated",signal:c})}catch(l){e.throwIfNotAbortError(l)}};r._createClass(v,[{key:"tileRenderer",set:function(c){this.client.tileRenderer=c}},{key:"closed",get:function(){return this._connection.closed}}]);return v}(f.EsriPromise);h.__decorate([E.property()],
f.prototype,"isReady",void 0);h.__decorate([E.property({constructOnly:!0})],f.prototype,"client",void 0);h.__decorate([E.property()],f.prototype,"tileRenderer",null);return f=h.__decorate([m.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],f)})},"esri/views/2d/tiling/TileManager":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./TileCoverage","./TileKey"],function(r,h,f,e,w){let E=function(){function z(u){this._tiles=new Map;this.buffer=0;
this.acquireTile=u.acquireTile;this.releaseTile=u.releaseTile;this.tileInfoView=u.tileInfoView;this.buffer=u.buffer}var n=z.prototype;n.destroy=function(){};n.clear=function(){this._tiles.forEach(u=>this._releaseTile(u))};n.tileKeys=function(){const u=[];this._tiles.forEach((m,d)=>u.push(d));return u};n.update=function(u){u=this.tileInfoView.getTileCoverage(u.state,this.buffer,"closest");const {spans:m,lodInfo:d}=u,{level:v}=d,B=[],c=[],l=new Set,t=new Set;for(const {row:A,colFrom:C,colTo:G}of m)for(let D=
C;D<=G;D++){const L=w.getId(v,A,d.normalizeCol(D),d.getWorldForColumn(D)),I=this._getOrAcquireTile(B,L);l.add(L);I.isReady?I.visible=!0:t.add(I.key)}t.forEach(A=>this._addPlaceholders(l,A));this._tiles.forEach(A=>{l.has(A.key.id)||(c.push(A.key.id),this._releaseTile(A))});e.pool.release(u);return{hasMissingTiles:0<t.size,added:B,removed:c}};n._getOrAcquireTile=function(u,m){if(!this._tiles.has(m)){const d=this.acquireTile(new w(m));u.push(m);this._tiles.set(m,d);d.visible=!1}return this._tiles.get(m)};
n._getTile=function(u){return this._tiles.get(u)};n._releaseTile=function(u){this._tiles.delete(u.key.id);this.releaseTile(u)};n._addPlaceholders=function(u,m){const d=this._addPlaceholderChildren(u,m);1E-6>Math.abs(1-d)||this._addPlaceholderParent(u,m)||(this._getTile(m.id).visible=!0)};n._addPlaceholderChildren=function(u,m){let d=0;this._tiles.forEach(v=>{d+=this._addPlaceholderChild(u,v,m)});return d};n._addPlaceholderChild=function(u,m,d){if(m.key.level<=d.level||!m.hasData||!d.contains(m.key))return 0;
m.visible=!0;u.add(m.key.id);return 1/(1<<2*(m.key.level-d.level))};n._addPlaceholderParent=function(u,m){m=m.getParentKey();var d=0;let v=null;for(;f.isSome(m);){if(u.has(m.id))return!0;const B=this._getTile(m.id);if(B?.isReady){for(const c of u)(d=this._getTile(c))&&m.contains(d.key)&&(d.visible=!1);B.visible=!0;u.add(B.key.id);return!0}B?.hasData&&B.patchCount>d&&(d=B.patchCount,v=B);m=m.getParentKey()}return v?(v.visible=!0,u.add(v.key.id),!0):!1};return h._createClass(z)}();r.TileManager=E;Object.defineProperty(r,
Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(r,h,f,e,w,E,z,n,u,m,d,v,B,c,l,t,A,C,G,D){const L=e.getLogger("esri.views.layers.FeatureLayerView");return I=>{I=function(x){function F(...g){g=T.call(this,...g);g._updatingRequiredFieldsPromise=null;g.filter=null;g.timeExtent=null;g.layer=null;g.requiredFields=[];g.view=null;return g}r._inherits(F,x);var T=r._createSuper(F);x=F.prototype;x.initialize=function(){this.handles.add([z.watch(()=>{const g=this.layer;return[g?.elevationInfo?.featureExpressionInfo,g&&"displayField"in g?g.displayField:
null,g&&"timeInfo"in g&&g.timeInfo,g&&"renderer"in g&&g.renderer,g&&"labelingInfo"in g&&g.labelingInfo,g&&"floorInfo"in g&&g.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),z.syncAndInitial),z.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),z.on(()=>{const g=this.layer;return g&&"sublayers"in g?g.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])};x.highlight=function(g){throw Error("missing implementation");
};x.createQuery=function(){var g={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};g=w.isSome(this.filter)?this.filter.createQuery(g):new C(g);if("feature"===this.layer.type){const q=A.getFloorFilterClause(this);w.isSome(q)&&(g.where=g.where?`(${g.where}) AND (${q})`:q)}w.isSome(this.timeExtent)&&(g.timeExtent=w.isSome(g.timeExtent)?g.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return g};x.createAggregateQuery=function(){return new C({outFields:["*"],
returnGeometry:!0,outSpatialReference:this.view.spatialReference})};x.queryFeatures=function(g,q){throw Error("missing implementation");};x.queryObjectIds=function(g,q){throw Error("missing implementation");};x.queryFeatureCount=function(g,q){throw Error("missing implementation");};x.queryExtent=function(g,q){throw Error("missing implementation");};x.fetchPopupFeatures=async function(g,q){if(g=this.validateFetchPopupFeatures(q))throw g;return this.fetchClientPopupFeatures(q)};x._loadArcadeModules=
function(g){return g.get("expressionInfos.length")||Array.isArray(g.content)&&g.content.some(q=>"expression"===q.type)?G.loadArcade():Promise.resolve()};x._handleRequiredFieldsChange=function(){const g=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",g);g.then(()=>{this._updatingRequiredFieldsPromise===g&&this._set("_updatingRequiredFieldsPromise",null)})};x._updateRequiredFields=async function(){if(this.layer&&this.view){var g="3d"===this.view.type,{layer:q,layer:{fieldsIndex:H,
objectIdField:M}}=this,N="renderer"in q&&q.renderer,P="orderBy"in q&&q.orderBy,S="featureReduction"in q?q.featureReduction:null,J=new Set;N=await E.eachAlways([N?N.collectRequiredFields(J,H):null,t.collectLabelingFields(J,q),g?t.collectElevationFields(J,q):null,w.isSome(this.filter)?t.collectFilterFields(J,q,this.filter):null,w.isSome(this.featureEffect)?t.collectFilterFields(J,q,this.featureEffect.filter):null,S?t.collectFeatureReductionFields(J,q,S):null,P?t.collectOrderByInfos(J,q,P):null]);"timeInfo"in
q&&q.timeInfo&&this.timeExtent&&t.collectFields(J,q.fieldsIndex,[q.timeInfo.startField,q.timeInfo.endField]);"feature"===q.type&&(q.floorInfo&&t.collectFields(J,q.fieldsIndex,[q.floorInfo.floorField]),g&&w.isSome(q.infoFor3D)&&(null==q.globalIdField&&L.error("globalIdField missing on 3DObjectFeatureLayer"),t.collectFields(J,q.fieldsIndex,[q.globalIdField])));"subtype-group"===q.type&&(t.collectField(J,H,q.subtypeField),P=q.sublayers.map(V=>Promise.all([V.renderer?.collectRequiredFields(J,H),t.collectLabelingFields(J,
V)])),await E.eachAlways(P));for(const V of N)V.error&&L.error(V.error);t.collectField(J,H,M);g&&"displayField"in q&&q.displayField&&t.collectField(J,H,q.displayField);g=Array.from(J).sort();this._set("requiredFields",g)}};x.validateFetchPopupFeatures=function(g){if(w.isNone(g))return null;for(const q of g.clientGraphics??[]){const H=q.layer;if("popupEnabled"in H&&!H.popupEnabled)return new f("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:H});if(q.isAggregate){const M="featureReduction"in
H?H.featureReduction:null;if(!(M&&"popupTemplate"in M&&M.popupEnabled&&M.popupTemplate))return new f("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:H})}else if("popupTemplate"in H&&!D.getFetchPopupTemplate(H,g))return new f("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:H})}};x.fetchClientPopupFeatures=async function(g){const q=w.isSome(g)?g.clientGraphics:null;if(!q||0===q.length)return[];const H=Array(q.length),M=new Map,N=await this.createPopupQuery(g);
for(let S=0;S<q.length;S++){const J=q[S];if(J.isAggregate){H[S]=J;continue}var P=J.layer;if(!("popupEnabled"in P))continue;const V=t.unpackFieldNames(this.layer.fieldsIndex,N.outFields);P=D.getFetchPopupTemplate(P,g);if(w.isNone(P))continue;const Y=await this._loadArcadeModules(P);Y&&Y.arcadeUtils.hasGeometryOperations(P)||!t.featureHasFields(V,J)?M.set(J.getObjectId(),{graphic:J,index:S}):H[S]=J}if("stream"===this.layer.type||0===M.size)return H.filter(Boolean);N.objectIds=Array.from(M.keys());try{const S=
await this.layer.queryFeatures(N);for(const J of S.features){const {graphic:{geometry:V},index:Y}=M.get(J.getObjectId());J.geometry||(J.geometry=V);H[Y]=J}}catch{}return H.filter(Boolean)};x.createPopupQuery=async function(g){const q=this.layer.createQuery(),H=new Set;var M=!1,N=w.isSome(g)&&g.clientGraphics?g.clientGraphics.map(P=>P.layer):[this.layer];for(const P of N)if("popupEnabled"in P&&(N=D.getFetchPopupTemplate(P,g),!w.isNone(N))){M=(M=await this._loadArcadeModules(N))&&M.arcadeUtils.hasGeometryOperations(N);
M=!("point"!==this.layer.geometryType&&!M);N=await D.getRequiredFields(this.layer,N);for(const S of N)H.add(S)}q.returnGeometry=M;q.returnZ=M;q.returnM=M;q.outFields=Array.from(H);q.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(g=A.getFloorFilterClause(this),w.isSome(g)&&(q.where=q.where?`(${q.where}) AND (${g})`:g));return q};x.canResume=function(){return!r._get(r._getPrototypeOf(F.prototype),"canResume",this).call(this)||w.isSome(this.timeExtent)&&this.timeExtent.isEmpty?
!1:!0};r._createClass(F,[{key:"availableFields",get:function(){const {layer:g,layer:{fieldsIndex:q},requiredFields:H}=this;return"outFields"in g&&g.outFields?t.fixFields(q,[...t.unpackFieldNames(q,g.outFields),...H]):t.fixFields(q,H)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(g){this._override("featureEffect",g)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(g){L.error("#maximumNumberOfFeatures\x3d",
"Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return F}(I);h.__decorate([n.property()],I.prototype,"_updatingRequiredFieldsPromise",void 0);h.__decorate([n.property({readOnly:!0})],I.prototype,"availableFields",null);h.__decorate([n.property({type:c})],I.prototype,"featureEffect",null);h.__decorate([n.property({type:l})],I.prototype,"filter",void 0);h.__decorate([n.property(B.combinedViewLayerTimeExtentProperty)],I.prototype,
"timeExtent",void 0);h.__decorate([n.property()],I.prototype,"layer",void 0);h.__decorate([n.property({type:Number})],I.prototype,"maximumNumberOfFeatures",null);h.__decorate([n.property({readOnly:!0,type:Boolean})],I.prototype,"maximumNumberOfFeaturesExceeded",null);h.__decorate([n.property({readOnly:!0})],I.prototype,"requiredFields",void 0);h.__decorate([n.property()],I.prototype,"suspended",void 0);h.__decorate([n.property()],I.prototype,"view",void 0);return I=h.__decorate([v.subclass("esri.views.layers.FeatureLayerView")],
I)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(r){function h(f,e){if(!f?.length)return null;f=f.filter(w=>""!==w).map(w=>`'${w}'`);f.push("''");return`${e} IN (${f.join(",")}) OR ${e} IS NULL`}r.getFloorFilterClause=function(f){const e=f.layer;return"floorInfo"in e&&e.floorInfo?.floorField&&"floors"in f.view?h(f.view.floors,e.floorInfo.floorField):null};r.getLayerFloorFilterClause=function(f,e){return"floorInfo"in e&&e.floorInfo?.floorField?h(f,e.floorInfo.floorField):
null};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(r,h,f){r.getFetchPopupTemplate=function(e,w){return e.popupTemplate?e.popupTemplate:h.isSome(w)&&w.defaultPopupTemplateEnabled&&h.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null};r.getRequiredFields=async function(e,w=e.popupTemplate){if(h.isNone(w))return[];const E=await w.getRequiredFields(e.fieldsIndex);
({lastEditInfoEnabled:w}=w);const {objectIdField:z,typeIdField:n,globalIdField:u,relationships:m}=e;if(E.includes("*"))return["*"];w=w?await f.getFeatureEditFields(e):[];const d=f.fixFields(e.fieldsIndex,[...E,...w]);n&&d.push(n);d&&z&&e.fieldsIndex?.has(z)&&!d.includes(z)&&d.push(z);d&&u&&e.fieldsIndex?.has(u)&&!d.includes(u)&&d.push(u);m&&m.forEach(v=>{({keyField:v}=v);d&&v&&e.fieldsIndex?.has(v)&&!d.includes(v)&&d.push(v)});return d};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(r,h,f,e,w,E,z,n,u,m){return d=>{d=function(v){function B(){return c.apply(this,arguments)}r._inherits(B,v);var c=r._createSuper(B);
B.prototype.initialize=function(){this.handles.add(w.on(()=>this.layer,"refresh",l=>{this.doRefresh(l.dataChanged).catch(t=>{e.isAbortError(t)||f.getLogger(this.declaredClass).error(t)})}),"RefreshableLayerView")};return r._createClass(B)}(d);h.__decorate([E.property()],d.prototype,"layer",void 0);return d=h.__decorate([m.subclass("esri.layers.mixins.RefreshableLayerView")],d)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../layers/support/layerUtils ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./features/support/rendererUtils ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/util ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../webgl/capabilities ../../../geometry/Extent".split(" "),function(r,
h,f,e,w,E,z,n,u,m,d,v,B,c,l,t,A,C,G,D,L,I,x,F,T,g,q,H,M,N,P,S,J,V,Y,ia,ja){function ha(p){return p&&"openPorts"in p}e=function(p){function aa(){var a=ka.apply(this,arguments);a._pipelineIsUpdating=!0;a._commandsQueue=new M({process:b=>{switch(b.type){case "processed-edit":return a._doEdit(b);case "refresh":return a._doRefresh(b.dataChanged);case "update":return a._doUpdate()}}});a._visibilityOverrides=new Set;a._highlightIds=new Map;a._updateHighlight=v.debounce(async()=>a._proxy.setHighlight(Array.from(a._highlightIds.keys())));
a._uploadsLocked=!1;a._needsClusterSizeUpdate=!1;a.featureEffectView=new A;a._lastDefinitionExpression=null;return a}r._inherits(aa,p);var ka=r._createSuper(aa);p=aa.prototype;p.destroy=function(){d.applySome(this._updateClusterSizeTask,a=>a.remove());this._proxy?.destroy();this._commandsQueue.destroy()};p.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()]));this.addHandles([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),
B.watch(()=>this.featureEffect,a=>{this.featureEffectView.featureEffect=a},B.syncAndInitial)],"constructor");this.featureEffectView.endTransitions()};p._initProxy=async function(){var a=this.layer;if("isTable"in a&&a.isTable)throw new z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});if(("feature"===a.type||"subtype-group"===a.type)&&!G.getEffectiveLayerCapabilities(a)?.operations.supportsQuery)throw new z("featurelayerview:query-not-supported",
"layer view requires a layer with query capability",{layer:a});this._proxy&&this._proxy.destroy();a=this._createClientOptions();this._set("_proxy",new N({client:a}));return this._proxy.when()};p._initServiceOptions=async function(){this._set("_serviceOptions",await this._createServiceOptions());return this._serviceOptions};p.highlight=function(a){let b;a instanceof w?b=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?b=[a]:E.isCollection(a)&&0<a.length?b=a.map(y=>y?.getObjectId()).toArray():
Array.isArray(a)&&0<a.length&&(b="number"===typeof a[0]||"string"===typeof a[0]?a:a.map(y=>y?.getObjectId()));const k=b?.filter(d.isSome);if(!k||!k.length)return{remove:()=>{}};this._addHighlight(k);return{remove:()=>this._removeHighlight(k)}};p.hasHighlight=function(){return!!this._highlightIds.size};p.hitTest=async function(a,b){if(!this.tileRenderer)return null;b=await this.tileRenderer.hitTest(b);if(0===b.length)return null;const {features:k,aggregates:y}=await this._proxy.getFeatures(b);return[...y.map(K=>
this._createGraphicHit(a,f.fromJSON(K))),...k.map(K=>this._createGraphicHit(a,w.fromJSON(K)))]};p.queryStatistics=function(){return this._proxy.queryStatistics()};p.querySummaryStatistics=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(a),b,k)};p.queryAggregateSummaryStatistics=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryAggregateSummaryStatistics(this._cleanUpAggregateQuery(a),b,k)};p.queryUniqueValues=
async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(a),b,k)};p.queryAggregateUniqueValues=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryAggregateUniqueValues(this._cleanUpAggregateQuery(a),b,k)};p.queryClassBreaks=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(a),b,k)};p.queryAggregateClassBreaks=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryAggregateClassBreaks(this._cleanUpAggregateQuery(a),
b,k)};p.queryHistogram=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(a),b,k)};p.queryAggregateHistogram=async function(a,b,k){b={...b,scale:this.view.scale};return this._proxy.queryAggregateHistogram(this._cleanUpAggregateQuery(a),b,k)};p.queryFeatures=function(a,b){return this.queryFeaturesJSON(a,b).then(k=>{k=L.fromJSON(k);k.features.forEach(y=>this._setLayersForFeature(y));return k})};p.queryVisibleFeatures=function(a,b){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(a),
b).then(k=>{k=L.fromJSON(k);k.features.forEach(y=>this._setLayersForFeature(y));return k})};p.queryAggregates=async function(a,b){a=await this._proxy.queryAggregates(this._cleanUpAggregateQuery(a),b);a=D.fromJSON(a);a.features.forEach(k=>this._setLayersForFeature(k));return a};p.queryAggregateIds=function(a,b){return this._proxy.queryAggregateIds(this._cleanUpAggregateQuery(a),b)};p.queryAggregateCount=function(a,b){return this._proxy.queryAggregateCount(this._cleanUpAggregateQuery(a),b)};p.queryAggregateJSON=
function(a,b){return this._proxy.queryAggregates(this._cleanUpAggregateQuery(a),b)};p.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),b)};p.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),b)};p.queryFeatureCount=function(a,b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};p.queryExtent=function(a,b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(k=>({count:k.count,extent:ja.fromJSON(k.extent)}))};
p.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};p.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:b,added:k,removed:y}=this._tileStrategy.update(a);(k.length||y.length)&&this._proxy.updateTiles({added:k,removed:y});b&&this.requestUpdate();this.notifyChange("updating")}};p.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new S.TileManager({acquireTile:a=>
this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.addAttachHandles(B.watch(()=>this.renderingConfigHash,()=>this._update(),B.initial));"stream"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",a=>this._edit(a)))};p.detach=function(){this._commandsQueue.clear();this._proxy?.stop();this.container.removeAllChildren();this.tileRenderer?.uninstall(this.container);this.tileRenderer=null;this._tileStrategy=d.destroyMaybe(this._tileStrategy);
this._tileRendererHash=null};p.moveStart=function(){this.requestUpdate()};p.viewChange=function(){this.requestUpdate()};p.moveEnd=function(){this.requestUpdate()};p.isUpdating=function(){const a="renderer"in this.layer&&null!=this.layer.renderer,b=this._commandsQueue.updating,k=null!=this._updatingRequiredFieldsPromise,y=!this._proxy||!this._proxy.isReady,K=this._pipelineIsUpdating,O=null==this.tileRenderer||this.tileRenderer?.updating,R=a&&(b||k||y||K||O);n("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${R}\n  -> hasRenderer ${a}\n  -> hasPendingCommand ${b}\n  -> updatingRequiredFields ${k}\n  -> updatingProxy ${y}\n  -> updatingPipeline ${K}\n  -> updatingTileRenderer ${O}\n`);
return R};p._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};p._detectQueryMode=async function(a){a="path"in a;const {layer:b}=this;var k="refreshInterval"in b&&!!b.refreshInterval;k=!("editingInfo"in b&&b.editingInfo?.lastEditDate)&&k;const y=G.getEffectiveLayerCapabilities(b);if(a&&("feature"===b.type||"subtype-group"===b.type)&&"point"===b.geometryType&&y?.query.supportsPagination&&!y?.operations.supportsEditing&&
!k&&n("featurelayer-snapshot-enabled"))try{const R=await b.queryFeatureCount();var K=n("featurelayer-snapshot-point-min-threshold");if(R<=K)return{mode:"snapshot",featureCount:R};const X=n("featurelayer-snapshot-point-max-threshold"),Q=n("featurelayer-snapshot-point-coverage"),W=this.view.extent;var O=d.unwrap(b.fullExtent);K=O?.clone().intersection(W);const U=d.isSome(K)?K.width*K.height:0;O=O?.width*O?.height;if(R<=X&&(0===O?0:U/O)>=Q)return{mode:"snapshot",featureCount:R}}catch(R){m.getLogger(this.declaredClass).warn("mapview-feature-layer",
"Encountered an error when querying for featureCount",{error:R})}return{mode:"on-demand"}};p._createServiceOptions=async function(){var a=this.layer;if("stream"===a.type)return null;const b=G.getEffectiveLayerCapabilities(a),{capabilities:k,objectIdField:y}=a,K=a.fields.map(Z=>Z.toJSON()),O=d.isSome(a.fullExtent)?a.fullExtent.toJSON():null,R=P.toJSONGeometryType(a.geometryType),X="timeInfo"in a&&a.timeInfo&&a.timeInfo.toJSON()||null,Q=a.spatialReference?a.spatialReference.toJSON():null,W="feature"===
a.type?a.globalIdField:null;let U;"ogc-feature"===a.type?U=a.source.getSource():ha(a.source)?U=await a.source.openPorts():a.parsedUrl&&(U=u.clone(a.parsedUrl),"dynamicDataSource"in a&&a.dynamicDataSource&&(U.query={layer:JSON.stringify({source:a.dynamicDataSource})}));a="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone;const da=("subtypeField"in this.layer?this.layer.subtypeField:null)??null,{mode:ea,featureCount:fa}=await this._detectQueryMode(U);let ba=this.layer.objectIdField;
if("feature"===this.layer.type&&d.isSome(this.layer.orderBy)&&this.layer.orderBy.length){const Z=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;Z&&(ba=Z)}return{type:ea,timeReferenceUnknownClient:a,subtypeField:da,featureCount:fa,globalIdField:W,maxRecordCount:k.query.maxRecordCount,tileMaxRecordCount:k.query.tileMaxRecordCount,capabilities:k,effectiveCapabilities:b,fields:K,fullExtent:O,geometryType:R,objectIdField:y,source:U,timeInfo:X,spatialReference:Q,orderByFields:ba,datesInUnknownTimezone:a,
dateFieldsTimeReference:("dateFieldsTimeReference"in this.layer?this.layer.dateFieldsTimeReference?.toJSON():null)||null,preferredTimeReference:("preferredTimeReference"in this.layer?this.layer.preferredTimeReference?.toJSON():null)||null,editFieldsInfo:"editFieldsInfo"in this.layer?this.layer.editFieldsInfo?.toJSON():null}};p._createMemoryServiceOptions=async function(a){a=await a.openPorts();return{...this._createServiceOptions(),type:"memory",source:a}};p._cleanUpQuery=function(a){a=I.from(a)||
this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};p._cleanUpAggregateQuery=function(a){a=I.from(a)||this.createAggregateQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};p._update=async function(){return this._commandsQueue.push({type:"update"})};p._edit=async function(a){if(this.suspended)this._clearTiles();else if(this._validateEdit(a))return this._commandsQueue.push({type:"edit",edits:a})};p.doRefresh=
async function(a){if(this.attached&&this._tileStrategy.tileKeys().length){if(!this.suspended||!a)return this._commandsQueue.push({type:"refresh",dataChanged:a});this._clearTiles()}};p._clearTiles=function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())};p._validateEdit=function(a){const b="globalIdField"in this.layer&&this.layer.globalIdField,
k=a.deletedFeatures.some(K=>-1===K.objectId||!K.objectId),y=b&&this.availableFields.includes(b);return k&&!y?(m.getLogger(this.declaredClass).error(new z("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${b} to be included the layer's outFields for updates to be reflected on the map`)),null):a};p._doUpdate=async function(){try{if(!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {featureEffectView:a,filter:b}=this;await this._updateRequiredFields();
if(!this.destroyed){var {renderer:k}=this._getEffectiveRenderer();this._set("_effectiveRenderer",k);var y=this._createSchemaConfig(),K=this._createConfiguration(y,b,a.filter),O=this._lastDefinitionExpression!==K.schema.source.definitionExpression;this._lastDefinitionExpression=K.schema.source.definitionExpression;var R=K.schema.tileRenderer,X=this._createTileRendererHash(R);"snapshot"===this._serviceOptions.type&&(K.schema.source.initialFeatureCount=this._serviceOptions.featureCount);if(X!==this._tileRendererHash){await this._initTileRenderer(R,
k);const Q=this.layer,W="stream"===Q.type?await this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(k);"stream"!==Q.type&&ha(Q.source)&&(W.source=await Q.source.openPorts());const U={added:this._tileStrategy.tileKeys(),removed:[]};n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Proxy startup");await this._proxy.startup(this.view.featuresTilingScheme,K,W,U);n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy startup");this.hasHighlight()&&
(n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating highlight"),await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished highlight update"));n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate start");this.tileRenderer.onConfigUpdate(k);n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate end")}else{"snapshot"===this._serviceOptions.type&&O&&(K.schema.source.changedFeatureCount=
await this.layer.queryFeatureCount());n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating proxy");const Q=await this._proxy.update(K);n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy update");if(Q.mesh||Q.targets?.aggregate)n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Locking GPU Uploads"),this._lockGPUUploads();try{n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Applying update to proxy"),await this._proxy.applyUpdate(Q),
n("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished applying update to proxy")}catch(W){v.isAbortError(W)||m.getLogger(this.declaredClass).error(W)}(Q.mesh||Q.targets?.aggregate)&&this._unlockGPUUploads();this.tileRenderer.onConfigUpdate(k);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=X;this.tileRenderer.invalidateLabels();this.requestUpdate()}}}catch(Q){}};p._doEdit=async function(a){try{await this._proxy.onEdits(a)}catch(b){v.isAbortError(b)}};
p._doRefresh=async function(a){this._lockGPUUploads();try{let b;a&&"snapshot"===this.queryMode&&"queryFeatureCount"in this.layer&&(b=await this.layer.queryFeatureCount());await this._proxy.refresh({dataChanged:a,featureCount:b})}catch(b){v.isAbortError(b)}this._unlockGPUUploads();this._effectiveFeatureReduction&&this._updateClusterSizeVariable()};p._updateClusterSizeVariable=function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=
!1)};p._createUpdateClusterSizeTask=function(a,b){return B.watch(()=>this._aggregateValueRanges,k=>{this._updateClusterEffectiveRendererSizeVariable(a,b,k);this._needsClusterSizeUpdate=!0;this._uploadsLocked||this._updateClusterSizeVariable()})};p._updateClusterEffectiveRendererSizeVariable=async function(a,b,k){if(a.dynamicClusterSize&&"visualVariables"in a&&a.visualVariables){var y=H.findSizeVV(a.visualVariables);d.isSome(y)&&"cluster_count"===y.field&&(y=a.visualVariables.indexOf(y),a.visualVariables[y]=
H.createClusterCountSizeVariable(b,k),a=a.clone(),a.dynamicClusterSize=!0,this._set("_effectiveRenderer",a))}};p._getEffectiveRenderer=function(){var a=this.layer,b="renderer"in a?a.renderer:null;a=this._effectiveFeatureReduction;this._updateClusterSizeTask=d.removeMaybe(this._updateClusterSizeTask);if(a&&"renderer"in a&&a.renderer&&!a.renderer.authoringInfo?.isAutoGenerated){var k=a.fields;if("cluster"===a.type){const {renderer:y,didInject:K}=H.injectDynamicLevelDependentSizeVisualVariable(a.renderer,
a,this._aggregateValueRanges);K&&(this._updateClusterSizeTask=this._createUpdateClusterSizeTask(y,a));return{renderer:y,aggregateFields:k,featureReduction:a}}return{renderer:a.renderer,aggregateFields:k,featureReduction:a}}return a&&"cluster"===a.type&&b&&H.isClusterCompatibleRenderer(b)?(k=[],b=H.createClusterRenderer(k,b,a,this._aggregateValueRanges,!0),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(b,a),{renderer:b,aggregateFields:k,featureReduction:a}):{renderer:b,aggregateFields:[],
featureReduction:null}};p._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};p._releaseTile=function(a){this.tileRenderer.releaseTile(a)};p._initTileRenderer=async function(a,b){a=await g.createOrReuseTileRenderer(a,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer=d.destroyMaybe(this.tileRenderer));
if(this.destroyed)return null;this._proxy.tileRenderer=a;this._set("tileRenderer",a);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(b);this.requestUpdate();return this.tileRenderer};p._createTileRendererHash=function(a){return`${a.type}`};p._injectOverrides=function(a){var b=d.isSome(a)?a.timeExtent:null;b=d.isSome(this.timeExtent)&&d.isSome(b)?this.timeExtent.intersection(b):this.timeExtent||b;var k=null;const y="floorInfo"in this.layer&&this.layer.floorInfo;y&&(k=d.isSome(a)?
a.where:null,k=this._addFloorFilterClause(k));if(!this._visibilityOverrides.size&&!b&&!y)return d.isSome(a)?a.toJSON():null;a=d.isSome(a)&&a.clone()||new C;a.timeExtent=b;k&&(a.where=k);a=a.toJSON();a.hiddenIds=Array.from(this._visibilityOverrides);return a};p._addFloorFilterClause=function(a){var b=this.layer;a=a||"";if("floorInfo"in b&&b.floorInfo){var k=this.view.floors;if(!k||!k.length)return a;b.floorInfo.viewAllLevelIds?.length&&(k=b.floorInfo.viewAllLevelIds);k=k.filter(y=>""!==y).map(y=>"'"+
y+"'");k.push("''");b=b.floorInfo.floorField;k=("("+b+" IN ({ids}) OR "+b+" IS NULL)").replace("{ids}",k.join(", "));if(d.isSome(a)&&a.includes(b)){let y=new RegExp("AND \\("+b+".*NULL\\)","g");a=a.replace(y,"");y=new RegExp("\\("+b+".*NULL\\)","g");a=a.replace(y,"");a=a.replace(/\s+/g," ").trim()}a=""!==a?"("+a+") AND "+k:k}return""!==a?a:null};p._createConfiguration=function(a,b,k){const y="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,K="feature"===
this.layer.type?this.layer.gdbVersion??void 0:void 0,O=Array(x.MAX_FILTERS);b=this._injectOverrides(b);O[0]=b;O[1]=d.isSome(k)?k.toJSON():null;a=T.createSchema(a);if(d.isNone(a))return null;k=ia.getWebGLCapabilities("2d");return{availableFields:this.availableFields,gdbVersion:K,historicMoment:y,devicePixelRatio:window.devicePixelRatio||1,filters:O,schema:a,supportsTextureFloat:k.supportsTextureFloat,maxTextureSize:k.maxTextureSize}};p._hasRequiredSupport=function(a){return"renderer"in a?q.isRendererSupported(a.renderer):
!0};p._lockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())};p._unlockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())};p._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};p._createSchemaConfig=function(){const a=this.layer;return{renderer:"renderer"in a?a.renderer:null,spatialReference:a.spatialReference,timeExtent:"timeExtent"in a?a.timeExtent:
null,definitionExpression:a.definitionExpression,featureReduction:this._effectiveFeatureReduction,fields:a.fields,geometryType:a.geometryType,historicMoment:"historicMoment"in a?a.historicMoment:null,labelsVisible:"labelsVisible"in a&&a.labelsVisible,labelingInfo:"labelingInfo"in a?a.labelingInfo:null,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"gdbVersion"in a?a.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in a&&a.orderBy?a.orderBy:null,customParameters:{...("customParameters"in
a?a.customParameters:void 0),token:"apiKey"in a?a.apiKey??void 0:void 0},subtypeCode:"subtypeCode"in a?a.subtypeCode:void 0,subtypeField:"subtypeField"in a?a.subtypeField:void 0}};p._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight().catch(b=>{v.isAbortError(b)||m.getLogger(this.declaredClass).error(b)})};p._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&
(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight().catch(b=>{v.isAbortError(b)||m.getLogger(this.declaredClass).error(b)})};p._setLayersForFeature=function(a){const b=this.layer;a.layer=b;a.sourceLayer=b};p._createGraphicHit=function(a,b){this._setLayersForFeature(b);d.isSome(b.geometry)&&(b.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:b,layer:this.layer,mapPoint:a}};r._createClass(aa,[{key:"_effectiveFeatureReduction",
get:function(){if(!("featureReduction"in this.layer))return null;const a=this.layer.featureReduction;return a?!("maxScale"in a&&a.maxScale)||a.maxScale<this.view.scale?a:null:null}},{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions?.type?this._serviceOptions?.orderByFields:void 0}},{key:"labelsVisible",get:function(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(b=>b.labelingInfo&&b.labelsVisible)}},{key:"queryMode",
get:function(){return this._serviceOptions?.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const a=this.availableFields;var b=this.layer;const k=this.view.floors,{definitionExpression:y}=b,K="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,O="renderer"in b&&b.renderer,R="gdbVersion"in b?b.gdbVersion:void 0,X="historicMoment"in b?b.historicMoment?.getTime():void 0,{timeExtent:Q}=this,W="customParameters"in b?JSON.stringify(b.customParameters):
void 0,U="apiKey"in b?b.apiKey:void 0;b="stream"===b.type?`${JSON.stringify(b.geometryDefinition)}${b.definitionExpression}`:null;const da=JSON.stringify(this.clips),ea=this._effectiveFeatureReduction?.toJSON(),fa="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),ba="sublayers"in this.layer&&this.layer.sublayers.items.reduce((Z,ca)=>Z+`${ca.visible?1:0}.${JSON.stringify(ca.renderer)}.${ca.labelsVisible}\n.${JSON.stringify(ca.labelingInfo)}`,"");return JSON.stringify({orderBy:fa,sublayerHash:ba,
subtypeCode:"subtypeCode"in this.layer&&this.layer.subtypeCode,filterHash:d.isSome(this.filter)&&this.filter.toJSON(),effectHash:d.isSome(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:b,gdbVersion:R,definitionExpression:y,historicMoment:X,availableFields:a,renderer:O,labelingInfo:K,timeExtent:Q,floors:k,clipsHash:da,featureReduction:ea,customParameters:W,apiKey:U})}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);
return!!this.filter||a||!!this._visibilityOverrides.size||!!this.timeExtent}}]);return aa}(J(Y(F.LayerView2DMixin(V))));h.__decorate([c.property()],e.prototype,"_serviceOptions",void 0);h.__decorate([c.property()],e.prototype,"_proxy",void 0);h.__decorate([c.property()],e.prototype,"_pipelineIsUpdating",void 0);h.__decorate([c.property()],e.prototype,"_effectiveRenderer",void 0);h.__decorate([c.property()],e.prototype,"_effectiveFeatureReduction",null);h.__decorate([c.property()],e.prototype,"_aggregateValueRanges",
void 0);h.__decorate([c.property()],e.prototype,"_commandsQueue",void 0);h.__decorate([c.property()],e.prototype,"featureEffectView",void 0);h.__decorate([c.property()],e.prototype,"labelsVisible",null);h.__decorate([c.property({readOnly:!0})],e.prototype,"queryMode",null);h.__decorate([c.property()],e.prototype,"renderingConfigHash",null);h.__decorate([c.property()],e.prototype,"tileRenderer",void 0);h.__decorate([c.property()],e.prototype,"updating",void 0);return e=h.__decorate([t.subclass("esri.views.2d.layers.FeatureLayerView2D")],
e)});