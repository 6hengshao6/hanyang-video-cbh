// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),function(e,
h,g,w,E,G,y,k,H,z,D,d,n,x){e.MediaElementView=function(A){function K(f){return p.call(this,f)}h._inherits(K,A);var p=h._createSuper(K);h._createClass(K,[{key:"bounds",get:function(){const f=this.coords;return E.isNone(f)||E.isNone(f.extent)?null:n.fromExtent(f.extent)}},{key:"coords",get:function(){const f=E.unwrap(this.element.georeference)?.coords;return d.projectOrLoad(f,this.spatialReference).geometry}},{key:"normalizedCoords",get:function(){return D.fromJSON(x.normalizeCentralMeridianSync(this.coords))}},
{key:"normalizedBounds",get:function(){const f=E.isSome(this.normalizedCoords)?this.normalizedCoords.extent:null;return E.isSome(f)?n.fromExtent(f):null}}]);return K}(w);g.__decorate([G.property()],e.MediaElementView.prototype,"spatialReference",void 0);g.__decorate([G.property()],e.MediaElementView.prototype,"element",void 0);g.__decorate([G.property()],e.MediaElementView.prototype,"bounds",null);g.__decorate([G.property()],e.MediaElementView.prototype,"coords",null);g.__decorate([G.property()],
e.MediaElementView.prototype,"normalizedCoords",null);g.__decorate([G.property()],e.MediaElementView.prototype,"normalizedBounds",null);e.MediaElementView=g.__decorate([z.subclass("esri.layers.support.MediaElementView")],e.MediaElementView);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../DisplayObject ../../../webgl/BufferObject ../../../webgl/context-util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(e,h,g,w,E,G,y,k,H,z,D,d,n,x,A,K,p){const f=H.create();return function(m){function q(r){var a=I.call(this);a.elementView=r;a.isWrapAround=!1;a.perspectiveTransform=D.create();a._vertices=new Float32Array(20);a._handles=[];a._handles.push(k.watch(()=>a.elementView.element.opacity,b=>a.opacity=b,k.initial),k.watch(()=>[a.elementView.coords],()=>{a.requestRender()},k.initial),k.when(()=>a.elementView.element.loaded,()=>{const b=a.elementView.element;a.ready();"video"===b.type&&G.isSome(b.content)&&
a._handles.push(g.on(b.content,"play",()=>a.requestRender()))},k.initial));r.element.load().catch(b=>{w.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new h("element-load-error","Element cannot be displayed",{element:r,error:b}))});return a}e._inherits(q,m);var I=e._createSuper(q);m=q.prototype;m.destroy=function(){this._handles.forEach(r=>r.remove());this.texture=G.disposeMaybe(this.texture)};m.beforeRender=function(r){const {context:a}=r,b=this.elementView.element.content;if(G.isSome(b)){var t=
b instanceof HTMLImageElement;const u=b instanceof HTMLVideoElement,B=t?b.naturalWidth:u?b.videoWidth:b.width;t=t?b.naturalHeight:u?b.videoHeight:b.height;this._updatePerspectiveTransform(B,t);this.texture?u&&!b.paused&&(this.texture.setData(b),this.requestRender(),(a.type===x.ContextType.WEBGL2||E.isPowerOfTwo(B)&&E.isPowerOfTwo(t))&&this.texture.generateMipmap()):(this.texture=new K.Texture(a,{pixelFormat:A.PixelFormat.RGBA,dataType:A.PixelType.UNSIGNED_BYTE,samplingMode:A.TextureSamplingMode.LINEAR,
wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,width:B,height:t,preMultiplyAlpha:!0},b),(a.type===x.ContextType.WEBGL2||E.isPowerOfTwo(B)&&E.isPowerOfTwo(t))&&this.texture.generateMipmap(),u&&!b.paused&&this.requestRender())}e._get(e._getPrototypeOf(q.prototype),"beforeRender",this).call(this,r)};m._createTransforms=function(){return null};m.updateDrawCoords=function(r,a){var b=this.elementView.coords;if(!G.isNone(b)){var [t,u,B,L]=b.rings[0];b=this._vertices;var {x:F,y:J}=r;(r=0!==a)?b.set([u[0]-F,u[1]-
J,t[0]-F,t[1]-J,B[0]-F,B[1]-J,L[0]-F,L[1]-J,L[0]-F,L[1]-J,u[0]+a-F,u[1]-J,u[0]+a-F,u[1]-J,t[0]+a-F,t[1]-J,B[0]+a-F,B[1]-J,L[0]+a-F,L[1]-J]):b.set([u[0]-F,u[1]-J,t[0]-F,t[1]-J,B[0]-F,B[1]-J,L[0]-F,L[1]-J]);this.isWrapAround=r}};m.getVAO=function(r,a,b){if(G.isNone(this.elementView.coords))return null;var t=this._vertices;this._vao?this._geometryVbo.setData(t):(this._geometryVbo=n.BufferObject.createVertex(r,A.Usage.DYNAMIC_DRAW,t),t=n.BufferObject.createVertex(r,A.Usage.STATIC_DRAW,new Uint16Array([0,
0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new p.VertexArrayObject(r,b,a,{geometry:this._geometryVbo,tex:t}));return this._vao};m._updatePerspectiveTransform=function(r,a){const b=this._vertices;y.getProjectiveTransform(f,[0,0,r,0,0,a,r,a],[b[0],b[1],b[4],b[5],b[2],b[3],b[6],b[7]]);z.set(this.perspectiveTransform,f[6]/f[8]*r,f[7]/f[8]*a)};e._createClass(q,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return q}(d.DisplayObject)})},"esri/core/perspectiveUtils":function(){define("exports ../chunks/mat3 ../chunks/mat3f64 ../chunks/vec2 ../chunks/vec3 ../chunks/vec3f64".split(" "),
function(e,h,g,w,E,G){function y(d,n,x,A,K,p,f,m,q){h.set(d,n,A,p,x,K,f,1,1,1);E.set(k,m,q,1);h.adjoint(H,d);const [I,r,a]=E.transformMat3(k,k,h.transpose(H,H));h.set(H,I,0,0,0,r,0,0,0,a);return h.multiply(d,H,d)}const k=G.create(),H=g.create(),z=g.create(),D=g.create();e.getProjectiveTransform=function(d,n,x){y(z,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);y(D,x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7]);h.multiply(d,h.adjoint(z,z),D);0!==d[8]&&(d[0]/=d[8],d[1]/=d[8],d[2]/=d[8],d[3]/=d[8],d[4]/=d[8],d[5]/=
d[8],d[6]/=d[8],d[7]/=d[8],d[8]/=d[8]);return d};e.transformProjective=function(d,n,x){E.set(k,n[0],n[1],1);E.transformMat3(k,k,h.transpose(H,x));return 0===k[2]?w.set(d,k[0],k[1]):w.set(d,k[0]/k[2],k[1]/k[2])};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ../brushes ./enums ./WGLContainer".split(" "),
function(e,h,g,w,E,G,y,k,H,z,D,d,n){return function(x){function A(){var p=K.apply(this,arguments);p._localOrigin=g.createScreenPoint(0,0);p._viewStateId=-1;p._dvsMat3=E.create();p.requiresDedicatedFBO=!1;return p}e._inherits(A,x);var K=e._createSuper(A);x=A.prototype;x.beforeRender=function(p){this._updateMatrices(p);this._updateOverlays(p,this.children);for(const f of this.children)f.beforeRender(p)};x.prepareRenderPasses=function(p){const f=p.registerRenderPass({name:"overlay",brushes:[D.brushes.overlay],
target:()=>this.children,drawPhase:d.WGLDrawPhase.MAP});return[...e._get(e._getPrototypeOf(A.prototype),"prepareRenderPasses",this).call(this,p),f]};x._updateMatrices=function(p){var {state:f}=p;const {id:m,size:q,pixelRatio:I,resolution:r,rotation:a,viewpoint:b,displayMat3:t}=f;if(this._viewStateId!==m){p=Math.PI/180*a;var u=I*q[0],B=I*q[1],{x:L,y:F}=b.targetGeometry;f=k.normalizeMapX(L,f.spatialReference);this._localOrigin.x=f;this._localOrigin.y=F;f=r*u;var J=r*B,M=w.identity(this._dvsMat3);w.multiply(M,
M,t);w.translate(M,M,G.fromValues(u/2,B/2));w.scale(M,M,y.fromValues(u/f,-B/J,1));w.rotate(M,M,-p);this._viewStateId=m}};x._updateOverlays=function(p,f){const {state:m}=p,{rotation:q,spatialReference:I,worldScreenWidth:r,size:a,viewpoint:b}=m;p=this._localOrigin;let t=0;var u=H.getInfo(I);if(u&&I.isWrappable){var B=180/Math.PI*q,L=Math.round(a[0]*Math.abs(Math.cos(B))+a[1]*Math.abs(Math.sin(B)));const [J,M]=u.valid;u=z.getWorldWidth(I);const {x:Y,y:ba}=b.targetGeometry;B=[0,0];m.toScreen(B,[Y,ba]);
const T=[0,0];L=L>r?.5*r:.5*L;var F=Math.floor((Y+.5*u)/u);const ca=J+F*u;F=M+F*u;const W=[B[0]+L,0];m.toMap(T,W);T[0]>F&&(t=u);W[0]=B[0]-L;m.toMap(T,W);T[0]<ca&&(t=-u);for(const U of f){f=U.elementView.bounds;if(h.isNone(f))continue;const [Z,,aa]=f;Z<J&&aa>J?U.updateDrawCoords(p,u):aa>M&&Z<M?U.updateDrawCoords(p,-u):U.updateDrawCoords(p,t)}}else for(B of f)B.updateDrawCoords(p,t)};e._createClass(A,[{key:"dvsMat3",get:function(){return this._dvsMat3}}]);return A}(n)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(e,h,g,w,E,G,y,k,H,z,D,d,n,x,A,K,p){const f=w.ofType({key:"type",base:null,typeMap:{rect:A,path:p,geometry:K}});e.LayerView2DMixin=m=>{m=function(q){function I(){var a=r.apply(this,arguments);a.attached=!1;a.clips=new f;a.lastUpdateId=-1;a.moving=!1;a.updateRequested=!1;a.visibleAtCurrentScale=!1;a.highlightOptions=null;return a}h._inherits(I,q);var r=h._createSuper(I);q=I.prototype;q.initialize=function(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new G("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new n.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([y.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},y.syncAndInitial),
y.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=b)},y.syncAndInitial),y.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},y.syncAndInitial),y.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},y.syncAndInitial),y.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,y.syncAndInitial),y.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},y.syncAndInitial),y.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},y.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};q.destroy=function(){this.processDetach();this.updateRequested=!1};q.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};q.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};q.isVisibleAtScale=function(a){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;
const {minScale:t,maxScale:u}=b;return(0===t||a<=t)&&(0===u||a>=u)};q.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};q.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};q.hitTest=function(a,b){return Promise.resolve(null)};q.supportsSpatialReference=function(a){return!0};
q.canResume=function(){return this.spatialReferenceSupported?h._get(h._getPrototypeOf(I.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};q.getSuspendInfo=function(){const a=h._get(h._getPrototypeOf(I.prototype),"getSuspendInfo",this).call(this),b=!this.spatialReferenceSupported,t=this.visibleAtCurrentScale;b&&(a.spatialReferenceNotSupported=b);t&&(a.outsideScaleRange=t);return a};q.addAttachHandles=function(a){this.addHandles(a,"attach")};h._createClass(I,[{key:"spatialReferenceSupported",
get:function(){const a=this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return I}(m);g.__decorate([k.property()],m.prototype,"attached",void 0);g.__decorate([k.property({type:f,set(q){q=E.referenceSetter(q,this._get("clips"),f);this._set("clips",q)}})],m.prototype,"clips",void 0);g.__decorate([k.property()],
m.prototype,"container",void 0);g.__decorate([k.property()],m.prototype,"moving",void 0);g.__decorate([k.property({readOnly:!0})],m.prototype,"spatialReferenceSupported",null);g.__decorate([k.property({readOnly:!0})],m.prototype,"updateParameters",void 0);g.__decorate([k.property()],m.prototype,"updateRequested",void 0);g.__decorate([k.property()],m.prototype,"updating",null);g.__decorate([k.property()],m.prototype,"view",void 0);g.__decorate([k.property({readOnly:!0})],m.prototype,"visibleAtCurrentScale",
void 0);g.__decorate([k.property({type:x})],m.prototype,"highlightOptions",void 0);return m=g.__decorate([d.subclass("esri.views.2d.layers.LayerView2D")],m)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(e,h,g,w,E,G,y,k){var H;w=H=function(z){function D(n){n=d.call(this,n);n.type="rect";n.left=null;n.right=null;n.top=null;n.bottom=null;return n}e._inherits(D,z);var d=e._createSuper(D);z=D.prototype;z.clone=function(){return new H({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};z.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return e._createClass(D)}(k);h.__decorate([g.property({type:[Number,
String],json:{write:!0}})],w.prototype,"left",void 0);h.__decorate([g.property({type:[Number,String],json:{write:!0}})],w.prototype,"right",void 0);h.__decorate([g.property({type:[Number,String],json:{write:!0}})],w.prototype,"top",void 0);h.__decorate([g.property({type:[Number,String],json:{write:!0}})],w.prototype,"bottom",void 0);return w=H=h.__decorate([y.subclass("esri.views.layers.support.ClipRect")],w)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(e,h,g,w,E,G,y,k){g=function(H){function z(){return D.apply(this,arguments)}e._inherits(z,H);var D=e._createSuper(z);e._createClass(z,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return z}(g.JSONSupport);h.__decorate([w.property({readOnly:!0})],g.prototype,"version",null);return g=h.__decorate([k.subclass("esri.views.layers.support.ClipArea")],g)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(e,h,g,w,E,G,y,k,H,z,D,d,n){var x;g={base:H,key:"type",typeMap:{extent:d,polygon:n}};D=x=function(A){function K(f){f=p.call(this,f);f.type="geometry";f.geometry=null;return f}e._inherits(K,A);var p=e._createSuper(K);A=K.prototype;A.clone=function(){return new x({geometry:this.geometry?.clone()??null})};A.commitVersionProperties=function(){this.commitProperty("geometry")};return e._createClass(K)}(D);h.__decorate([w.property({types:g,json:{read:z.fromJSON,write:!0}})],D.prototype,"geometry",
void 0);return D=x=h.__decorate([k.subclass("esri.views.layers.support.Geometry")],D)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(e,h,g,w,E,G,y,k){w=function(H){function z(d){d=D.call(this,d);d.type="path";
d.path=[];return d}e._inherits(z,H);var D=e._createSuper(z);z.prototype.commitVersionProperties=function(){this.commitProperty("path")};return e._createClass(z)}(k);h.__decorate([g.property({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0);return w=h.__decorate([y.subclass("esri.views.layers.support.Path")],w)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../renderers/ClassBreaksRenderer ../../../renderers/DictionaryRenderer ../../../renderers/DotDensityRenderer ../../../renderers/HeatmapRenderer ../../../renderers/PieChartRenderer ../../../renderers/Renderer ../../../renderers/SimpleRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/support/jsonUtils ../../../symbols ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/intersectsBase ../../../layers/support/MediaElementView ../../../core/Error ../../../core/scheduling ../../../request ../../../chunks/index3 ../../../core/urlUtils ../../../chunks/index4 ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../webgl/context-util ../../../chunks/builtins ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../../../core/mathUtils ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../LabelManager ./graphics/GraphicsView2D ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ../tiling/PagedTileQueue ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/Overlay ../engine/webgl/OverlayContainer ./LayerView2D ../../layers/LayerView ../../../geometry/Extent".split(" "),function(e,
h,g,w,E,G,y,k,H,z,D,d,n,x,A,K,p,f,m,q,I,r,a,b,t,u,B,L,F,J,M,Y,ba,T,ca,W,U,Z,aa,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,fa,ha,ia,ja,ka,la,ma){function da(C,N,Q){C.getTileBounds(O,N.key,!0);V.xmin=O[0];V.ymin=O[1];V.xmax=O[2];V.ymax=O[3];return L.extentIntersectsPolygon(V,Q)}let S=function(C){function N(){var c=Q.apply(this,arguments);c._overlayContainer=null;c._fetchQueue=null;
c._tileStrategy=null;c._elementReferences=new Map;c._debugGraphicsView=null;c.layer=null;c.elements=new A;return c}e._inherits(N,C);var Q=e._createSuper(N);C=N.prototype;C.attach=function(){this.addAttachHandles([I.on(()=>this.layer.effectiveSource,"refresh",()=>{for(const c of this._tileStrategy.tiles)this._updateTile(c);this.requestUpdate()}),I.on(()=>this.layer.effectiveSource,"change",({element:c})=>this._elementUpdateHandler(c))]);this._overlayContainer=new ja;this.container.addChild(this._overlayContainer);
this._fetchQueue=new fa({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(c,l)=>this._queryElements(c,l)});this._tileStrategy=new ha({cachePolicy:"purge",resampling:!0,acquireTile:c=>this._acquireTile(c),releaseTile:c=>this._releaseTile(c),tileInfoView:this.view.featuresTilingScheme});this.requestUpdate()};C.detach=function(){this.elements.removeAll();this._tileStrategy.destroy();this._fetchQueue.destroy();this._overlayContainer.removeAllChildren();this.container.removeAllChildren();
this._elementReferences.clear();this._debugGraphicsView?.destroy()};C.supportsSpatialReference=function(c){return!0};C.moveStart=function(){this.requestUpdate()};C.viewChange=function(){this.requestUpdate()};C.moveEnd=function(){this.requestUpdate()};C.update=function(c){this._tileStrategy.update(c);this._debugGraphicsView?.update(c)};C.hitTest=async function(c,l){l=[];var v=c.normalize();v=[v.x,v.y];for(const {projectedElement:{normalizedCoords:P,element:X}}of this._elementReferences.values())m.isSome(P)&&
B.ringsContainsCoords(P.rings,v)&&l.push({type:"media",element:X,layer:this.layer,mapPoint:c});return l.reverse()};C.canResume=function(){return null!=this.layer.source&&e._get(e._getPrototypeOf(N.prototype),"canResume",this).call(this)};C.doRefresh=async function(){this._fetchQueue.reset();this._tileStrategy.tiles.forEach(c=>this._updateTile(c))};C._acquireTile=function(c){c=new na(c.clone());this._updateTile(c);return c};C._updateTile=function(c){this.updatingHandles.addPromise(this._fetchQueue.push(c.key).then(l=>
{const [v,P]=c.setElements(l);this._referenceElements(c,v);this._dereferenceElements(c,P);this.requestUpdate()},l=>{q.isAbortError(l)||p.getLogger(this.declaredClass).error(l)}))};C._releaseTile=function(c){this._fetchQueue.abort(c.key.id);c.elements&&this._dereferenceElements(c,c.elements);this.requestUpdate()};C._queryElements=async function(c,l){const v=this.layer.effectiveSource;if(m.isNone(v))return[];this.view.featuresTilingScheme.getTileBounds(O,c,!0);c=new ma({xmin:O[0],ymin:O[1],xmax:O[2],
ymax:O[3],spatialReference:this.view.spatialReference});return v.queryElements(c,l)};C._referenceElements=function(c,l){if(!m.isNone(this.layer.source))for(const v of l)this._referenceElement(c,v)};C._referenceElement=function(c,l){f.getOrCreateMapValue(this._elementReferences,l.uid,()=>{const v=new F.MediaElementView({element:l,spatialReference:this.view.spatialReference}),P=new ia(v);this._overlayContainer.addChild(P);this.elements.add(l);return{tiles:new Set,projectedElement:v,overlay:P,debugGraphic:null}}).tiles.add(c)};
C._dereferenceElements=function(c,l){for(const v of l)this._dereferenceElement(c,v)};C._dereferenceElement=function(c,l){const v=this._elementReferences.get(l.uid);v.tiles.delete(c);v.tiles.size||(this._overlayContainer.removeChild(v.overlay),v.overlay.destroy(),v.projectedElement.destroy(),this._elementReferences.delete(l.uid),this.elements.remove(l),this._debugGraphicsView?.graphics.remove(v.debugGraphic))};C._elementUpdateHandler=function(c){var l=this._elementReferences.get(c.uid);if(l){const X=
l.projectedElement.normalizedCoords;if(m.isNone(X))this._overlayContainer.removeChild(l.overlay),l.overlay.destroy(),l.projectedElement.destroy(),this._elementReferences.delete(c.uid),this.elements.remove(c),this._debugGraphicsView?.graphics.remove(l.debugGraphic);else{var v=[],P=[];for(const R of this._tileStrategy.tiles){const ea=da(this.view.featuresTilingScheme,R,X);l.tiles.has(R)?ea||P.push(R):ea&&v.push(R)}for(const R of v)this._referenceElement(R,c);for(const R of P)this._dereferenceElement(R,
c);l=this._elementReferences.get(c.uid);l?.debugGraphic&&(l.debugGraphic.geometry=l.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:l.debugGraphic,property:"geometry"}))}}else if(l=(new F.MediaElementView({element:c,spatialReference:this.view.spatialReference})).normalizedCoords,m.isSome(l))for(v of this._tileStrategy.tiles)da(this.view.featuresTilingScheme,v,l)&&this._referenceElement(v,c)};return e._createClass(N)}(ka.LayerView2DMixin(la));h.__decorate([r.property()],
S.prototype,"_fetchQueue",void 0);h.__decorate([r.property()],S.prototype,"layer",void 0);h.__decorate([r.property({readOnly:!0})],S.prototype,"elements",void 0);S=h.__decorate([t.subclass("esri.views.2d.layers.MediaLayerView2D")],S);const O=u.create(),V={xmin:0,ymin:0,xmax:0,ymax:0};let na=function(){function C(Q){this.key=Q;this.elements=null;this.isReady=!1;this.visible=!0}var N=C.prototype;N.setElements=function(Q){const c=[],l=new Set(this.elements);this.elements=Q;for(const v of Q)l.has(v)?
l.delete(v):c.push(v);this.isReady=!0;return[c,Array.from(l)]};N.destroy=function(){};return e._createClass(C)}();return S});