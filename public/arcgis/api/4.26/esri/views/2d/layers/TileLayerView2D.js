// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../engine/BitmapTileContainer".split(" "),function(k,d,e,f,a,c,g,l,m,h){k.BitmapTileLayerView2D=b=>{b=function(n){function r(){return z.apply(this,arguments)}d._inherits(r,
n);var z=d._createSuper(r);n=r.prototype;n.attach=function(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=new h.BitmapTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView)};n.detach=function(){this.container.removeChild(this._bitmapView);this._bitmapView?.removeAllChildren()};return d._createClass(r)}(b);return b=e.__decorate([m.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],b)};Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(k,d,e,f,a,c,g,l,m,h,b,n,r,z,q,A,N){const p=f.ofType({key:"type",base:null,typeMap:{rect:q,path:N,geometry:A}});k.LayerView2DMixin=F=>{F=function(D){function L(){var B=U.apply(this,arguments);B.attached=!1;B.clips=new p;B.lastUpdateId=-1;B.moving=!1;B.updateRequested=!1;B.visibleAtCurrentScale=!1;B.highlightOptions=null;return B}d._inherits(L,D);var U=d._createSuper(L);D=L.prototype;D.initialize=function(){const B=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&B&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new r.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([g.watch(()=>this.suspended,t=>{this.container&&(this.container.visible=!t);this.view&&!t&&this.updateRequested&&this.view.requestUpdate()},g.syncAndInitial),
g.watch(()=>this.layer?.opacity??1,t=>{this.container&&(this.container.opacity=t)},g.syncAndInitial),g.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",t=>{this.container&&(this.container.blendMode=t)},g.syncAndInitial),g.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,t=>{this.container&&(this.container.effect=t)},g.syncAndInitial),g.watch(()=>this.highlightOptions,t=>this.container.highlightOptions=t,g.syncAndInitial),g.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},g.syncAndInitial),g.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:t})=>{t=null!=t?this.isVisibleAtScale(t):!1;t!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",t)},g.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(t=>{t===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};D.destroy=function(){this.processDetach();this.updateRequested=!1};D.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};D.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};D.isVisibleAtScale=function(B){const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!t)return!0;
const {minScale:Q,maxScale:V}=t;return(0===Q||B<=Q)&&(0===V||B>=V)};D.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};D.processUpdate=function(B){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",B),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(B)))};D.hitTest=function(B,t){return Promise.resolve(null)};D.supportsSpatialReference=function(B){return!0};
D.canResume=function(){return this.spatialReferenceSupported?d._get(d._getPrototypeOf(L.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};D.getSuspendInfo=function(){const B=d._get(d._getPrototypeOf(L.prototype),"getSuspendInfo",this).call(this),t=!this.spatialReferenceSupported,Q=this.visibleAtCurrentScale;t&&(B.spatialReferenceNotSupported=t);Q&&(B.outsideScaleRange=Q);return B};D.addAttachHandles=function(B){this.addHandles(B,"attach")};d._createClass(L,[{key:"spatialReferenceSupported",
get:function(){const B=this.view?.spatialReference;return null==B||this.supportsSpatialReference(B)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return L}(F);e.__decorate([l.property()],F.prototype,"attached",void 0);e.__decorate([l.property({type:p,set(D){D=a.referenceSetter(D,this._get("clips"),p);this._set("clips",D)}})],F.prototype,"clips",void 0);e.__decorate([l.property()],
F.prototype,"container",void 0);e.__decorate([l.property()],F.prototype,"moving",void 0);e.__decorate([l.property({readOnly:!0})],F.prototype,"spatialReferenceSupported",null);e.__decorate([l.property({readOnly:!0})],F.prototype,"updateParameters",void 0);e.__decorate([l.property()],F.prototype,"updateRequested",void 0);e.__decorate([l.property()],F.prototype,"updating",null);e.__decorate([l.property()],F.prototype,"view",void 0);e.__decorate([l.property({readOnly:!0})],F.prototype,"visibleAtCurrentScale",
void 0);e.__decorate([l.property({type:z})],F.prototype,"highlightOptions",void 0);return F=e.__decorate([n.subclass("esri.views.2d.layers.LayerView2D")],F)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(k,d,e,f,a,c,g,l){var m;f=m=function(h){function b(r){r=n.call(this,r);r.type="rect";r.left=null;r.right=null;r.top=null;r.bottom=null;return r}k._inherits(b,h);var n=k._createSuper(b);h=b.prototype;h.clone=function(){return new m({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};h.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return k._createClass(b)}(l);d.__decorate([e.property({type:[Number,
String],json:{write:!0}})],f.prototype,"left",void 0);d.__decorate([e.property({type:[Number,String],json:{write:!0}})],f.prototype,"right",void 0);d.__decorate([e.property({type:[Number,String],json:{write:!0}})],f.prototype,"top",void 0);d.__decorate([e.property({type:[Number,String],json:{write:!0}})],f.prototype,"bottom",void 0);return f=m=d.__decorate([g.subclass("esri.views.layers.support.ClipRect")],f)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(k,d,e,f,a,c,g,l){e=function(m){function h(){return b.apply(this,arguments)}k._inherits(h,m);var b=k._createSuper(h);k._createClass(h,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return h}(e.JSONSupport);d.__decorate([f.property({readOnly:!0})],e.prototype,"version",null);return e=d.__decorate([l.subclass("esri.views.layers.support.ClipArea")],e)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(k,d,e,f,a,c,g,l,m,h,b,n,r){var z;e={base:m,key:"type",typeMap:{extent:n,polygon:r}};b=z=function(q){function A(p){p=N.call(this,p);p.type="geometry";p.geometry=null;return p}k._inherits(A,q);var N=k._createSuper(A);q=A.prototype;q.clone=function(){return new z({geometry:this.geometry?.clone()??null})};q.commitVersionProperties=function(){this.commitProperty("geometry")};return k._createClass(A)}(b);d.__decorate([f.property({types:e,json:{read:h.fromJSON,write:!0}})],b.prototype,"geometry",
void 0);return b=z=d.__decorate([l.subclass("esri.views.layers.support.Geometry")],b)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(k,d,e,f,a,c,g,l){f=function(m){function h(n){n=b.call(this,n);n.type="path";
n.path=[];return n}k._inherits(h,m);var b=k._createSuper(h);h.prototype.commitVersionProperties=function(){this.commitProperty("path")};return k._createClass(h)}(l);d.__decorate([e.property({type:[[[Number]]],json:{write:!0}})],f.prototype,"path",void 0);return f=d.__decorate([g.subclass("esri.views.layers.support.Path")],f)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(k,d,e,f,a,c,g,l,m,h,b){e=function(n){function r(){return z.apply(this,arguments)}k._inherits(r,n);var z=k._createSuper(r);n=r.prototype;n.doRender=function(q){q.drawPhase===m.WGLDrawPhase.HIGHLIGHT&&k._get(k._getPrototypeOf(r.prototype),"doRender",this).call(this,q)};n.renderChildren=function(q){this.attributeView.update();if(this.children.some(N=>N.hasData)){this.attributeView.bindTextures(q.context);k._get(k._getPrototypeOf(r.prototype),"renderChildren",this).call(this,q);var {painter:A}=
q;A=A.effects.highlight;A.bind(q);q.context.setColorMask(!0,!0,!0,!0);q.context.clear(b.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(q,A.defines.concat(["highlightAll"]));A.draw(q);A.unbind()}};return k._createClass(r)}(h);return e=d.__decorate([l.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],e)})},"esri/views/2d/layers/support/imageUtils":function(){define(["exports"],function(k){function d(e){const f=document.createElement("canvas");[f.width,f.height]=e;return f}k.createBlankImage=
d;k.resampleImage=function(e,f,a,c){if(a.level===c.level)return f;const g=e.tileInfo.size;var l=e.getTileResolution(a.level),m=e.getTileResolution(c.level),h=e.getLODInfoAt(c.level),b=h.getXForColumn(c.col);c=h.getYForRow(c.row);h=e.getLODInfoAt(a.level);e=h.getXForColumn(a.col);const n=h.getYForRow(a.row);h=(f instanceof HTMLImageElement?f.naturalWidth:f.width)/g[0];a=(f instanceof HTMLImageElement?f.naturalHeight:f.height)/g[1];b=Math.round((b-e)/l*h);c=Math.round(-(c-n)/l*a);e=Math.round(m/l*g[0]*
h);l=Math.round(m/l*g[1]*a);m=d(g);m.getContext("2d").drawImage(f,b,c,e,l,0,0,g[0],g[1]);return m};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(k,d,e,f,a,c,g,l,m,h){return b=>{b=function(n){function r(){return z.apply(this,arguments)}k._inherits(r,n);var z=k._createSuper(r);r.prototype.initialize=function(){this.handles.add(a.on(()=>this.layer,"refresh",q=>{this.doRefresh(q.dataChanged).catch(A=>{f.isAbortError(A)||e.getLogger(this.declaredClass).error(A)})}),"RefreshableLayerView")};return k._createClass(r)}(b);d.__decorate([c.property()],b.prototype,"layer",void 0);return b=d.__decorate([h.subclass("esri.layers.mixins.RefreshableLayerView")],
b)}})},"esri/views/layers/support/MapServiceLayerViewHelper":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../../../geometry/support/scaleUtils ../../../layers/support/floorFilterUtils ../../../renderers/support/clickToleranceUtils ../../../rest/identify ../../../rest/support/IdentifyParameters ../../../support/arcadeOnDemand ../../../symbols/SimpleMarkerSymbol ./popupUtils".split(" "),
function(k,d,e,f,a,c,g,l,m,h,b,n,r,z,q,A,N,p,F,D,L,U,B,t,Q,V,Y){function Z(G,M,R){const v=[],y=w=>{var K=0===w.minScale||M<=w.minScale;const E=0===w.maxScale||M>=w.maxScale;w.visible&&K&&E&&(w.sublayers?w.sublayers.forEach(y):w.popupEnabled&&(K=Y.getFetchPopupTemplate(w,{...R,defaultPopupTemplateEnabled:!1}),b.isSome(K)&&v.unshift({sublayer:w,popupTemplate:K})))};(G?.toArray()??[]).reverse().map(y);return v}function ba(G){return G.expressionInfos?.length||Array.isArray(G.content)&&G.content.some(M=>
"expression"===M.type)?Q.loadArcade():Promise.resolve()}async function da(G,M){if(G.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(M.map(({sublayer:R})=>R.load().then(()=>R.capabilities.operations.supportsQuery)))}catch{return!1}}async function ha(G,M){const R=G.renderer;R&&"defaultSymbol"in R&&!R.defaultSymbol&&(M=R.valueExpression?await Promise.all(M.map(v=>R.getSymbolAsync(v).then(y=>y?v:null))).then(v=>v.filter(y=>null!=y)):M.filter(v=>null!=R.getSymbol(v)));return M}
let ca=null;d.MapServiceLayerViewHelper=function(G){function M(v){var y=R.call(this,v);y._featuresResolutions=new WeakMap;y.highlightGraphics=null;y.highlightGraphicUpdated=null;y.updateHighlightedFeatures=n.debounce(async w=>{y.destroyed||y.updatingHandles.addPromise(y._updateHighlightedFeaturesGeometries(w).catch(()=>{}))});return y}e._inherits(M,G);var R=e._createSuper(M);G=M.prototype;G.initialize=function(){const v=y=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(y).catch(()=>
{}));this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([r.on(()=>this.highlightGraphics,"change",y=>v(y.added),{onListenerAdd:y=>v(y)})])};G.fetchPopupFeatures=async function(v,y){const {layerView:{layer:w,view:{scale:K}}}=this;if(!v)throw new l("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:w});const E=Z(w.sublayers,K,y);if(!E.length)return[];const P=await da(w,E);if(!((w.capabilities?.operations?.supportsIdentify??!0)&&10.5<=w.version||
P))throw new l("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:w});return P?this._fetchPopupFeaturesUsingQueries(v,E,y):this._fetchPopupFeaturesUsingIdentify(v,E,y)};G.clearHighlights=function(){this.highlightGraphics?.removeAll()};G.highlight=function(v){const y=this.highlightGraphics;if(!y)return{remove(){}};let w=null;v instanceof a?w=[v]:g.isCollection(v)&&0<v.length?w=v.toArray():Array.isArray(v)&&0<v.length&&(w=v);w=w?.filter(b.isSome);if(!w||!w.length)return{remove:()=>
{}};for(const K of w)v=K.sourceLayer,null!=v&&"geometryType"in v&&"point"===v.geometryType&&(K.visible=!1);y.addMany(w);return{remove:()=>{y.removeMany(w??[])}}};G._updateHighlightedFeaturesSymbols=async function(v){const {layerView:{view:y},highlightGraphics:w,highlightGraphicUpdated:K}=this;if(w&&K)for(const E of v){const P=E.sourceLayer&&"renderer"in E.sourceLayer&&E.sourceLayer.renderer;E.sourceLayer&&"geometryType"in E.sourceLayer&&"point"===E.sourceLayer.geometryType&&P&&"getSymbolAsync"in P&&
P.getSymbolAsync(E).then(async x=>{x||(x=new V);let I=null;const J="visualVariables"in P?P.visualVariables?.find(H=>"size"===H.type):void 0;J&&(ca||(ca=(await new Promise((H,S)=>k(["../../../renderers/visualVariables/support/visualVariableUtils"],H,S))).getSize),I=ca(J,E,{view:y.type,scale:y.scale,shape:"simple-marker"===x.type?x.style:null}));I||(I="width"in x&&"height"in x&&null!=x.width&&null!=x.height?Math.max(x.width,x.height):"size"in x?x.size:16);w.includes(E)&&(E.symbol=new V({style:"square",
size:I,xoffset:"xoffset"in x?x.xoffset:0,yoffset:"yoffset"in x?x.yoffset:0}),K(E,"symbol"),E.visible=!0)})}};G._updateHighlightedFeaturesGeometries=async function(v){const {layerView:{layer:y,view:w},highlightGraphics:K,highlightGraphicUpdated:E}=this;this._highlightGeometriesResolution=v;if(E&&K?.length&&y.capabilities.operations.supportsQuery){var P=this._getTargetResolution(v);v=new Map;for(var x of K)(!this._featuresResolutions.has(x)||this._featuresResolutions.get(x)>P)&&h.getOrCreateMapValue(v,
x.sourceLayer,()=>new Map).set(x.getObjectId(),x);x=Array.from(v,([I,J])=>{const H=I.createQuery();H.objectIds=[...J.keys()];H.outFields=[I.objectIdField];H.returnGeometry=!0;H.maxAllowableOffset=P;H.outSpatialReference=w.spatialReference;return I.queryFeatures(H)});x=await Promise.all(x);if(!this.destroyed)for(const {features:I}of x)for(const J of I)(x=v.get(J.sourceLayer).get(J.getObjectId()))&&K.includes(x)&&(x.geometry=J.geometry,E(x,"geometry"),this._featuresResolutions.set(x,P))}};G._getTargetResolution=
function(v){const y=v*z.getMetersPerUnitForSR(this.layerView.view.spatialReference),w=y/16;return 10>=w?0:v/y*w};G._fetchPopupFeaturesUsingIdentify=async function(v,y,w){v=await this._createIdentifyParameters(v,y,w);if(b.isNone(v))return[];({results:v}=await B.identify(this.layerView.layer.parsedUrl,v));return v.map(K=>K.feature)};G._createIdentifyParameters=async function(v,y,w){const {floors:K,layer:E,timeExtent:P,view:{spatialReference:x,scale:I}}=this.layerView,J=b.isSome(w)?w.event:null;if(!y.length)return null;
await Promise.all(y.map(({sublayer:W})=>W.load().catch(()=>{})));y=Math.min(m("mapservice-popup-identify-max-tolerance"),E.allSublayers.reduce((W,ea)=>ea.renderer?U.calculateTolerance({renderer:ea.renderer,event:J}):W,2));var H=this.createFetchPopupFeaturesQueryGeometry(v,y);const S=D.getResolutionForScale(I,x);w=Math.round(H.width/S);H=new F({xmin:H.center.x-S*w,ymin:H.center.y-S*w,xmax:H.center.x+S*w,ymax:H.center.y+S*w,spatialReference:H.spatialReference});return new t({floors:K,gdbVersion:"gdbVersion"in
E?E.gdbVersion:void 0,geometry:v,height:w,layerOption:"popup",mapExtent:H,returnGeometry:!0,spatialReference:x,sublayers:E.sublayers,timeExtent:P,tolerance:y,width:w})};G._fetchPopupFeaturesUsingQueries=async function(v,y,w){const {layerView:{floors:K,timeExtent:E}}=this,P=b.isSome(w)?w.event:null;y=y.map(async({sublayer:x,popupTemplate:I})=>{await x.load().catch(()=>{});if(x.capabilities&&!x.capabilities.operations.supportsQuery)return[];var J=x.createQuery(),H=U.calculateTolerance({renderer:x.renderer,
event:P}),S=this.createFetchPopupFeaturesQueryGeometry(v,H);J.geometry=S;J.outFields=await Y.getRequiredFields(x,I);J.timeExtent=E;if(K){var W=K.clone();W=L.getLayerFloorFilterClause(W,x);b.isSome(W)&&(J.where=J.where?`(${J.where}) AND (${W})`:W)}H=this._getTargetResolution(S.width/H);S=await ba(I);I="point"===x.geometryType||S&&S.arcadeUtils.hasGeometryOperations(I);I||(J.maxAllowableOffset=H);({features:J}=await x.queryFeatures(J));I=I?0:H;J=await ha(x,J);for(const ea of J)this._featuresResolutions.set(ea,
I);return J});return(await n.eachAlways(y)).reverse().reduce((x,I)=>I.value?[...x,...I.value]:x,[]).filter(x=>null!=x)};return e._createClass(M)}(c);f.__decorate([q.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"createFetchPopupFeaturesQueryGeometry",void 0);f.__decorate([q.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"layerView",void 0);f.__decorate([q.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"highlightGraphics",void 0);f.__decorate([q.property({constructOnly:!0})],
d.MapServiceLayerViewHelper.prototype,"highlightGraphicUpdated",void 0);f.__decorate([q.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"updatingHandles",void 0);d.MapServiceLayerViewHelper=f.__decorate([p.subclass("esri.views.layers.support.MapService")],d.MapServiceLayerViewHelper);d.collectPopupProviders=Z;d.isMapServiceLayerView=function(G,M){return"tile"===M.type||"map-image"===M.type};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],
function(k){function d(e,f){if(!e?.length)return null;e=e.filter(a=>""!==a).map(a=>`'${a}'`);e.push("''");return`${f} IN (${e.join(",")}) OR ${f} IS NULL`}k.getFloorFilterClause=function(e){const f=e.layer;return"floorInfo"in f&&f.floorInfo?.floorField&&"floors"in e.view?d(e.view.floors,f.floorInfo.floorField):null};k.getLayerFloorFilterClause=function(e,f){return"floorInfo"in f&&f.floorInfo?.floorField?d(e,f.floorInfo.floorField):null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(k){function d(a,c){return c?"xoffset"in c&&c.xoffset?Math.max(a,Math.abs(c.xoffset)):"yoffset"in c&&c.yoffset?Math.max(a,Math.abs(c.yoffset||0)):a:a}function e(a,c){if("number"===typeof a)return a;if(a&&a.stops&&a.stops.length){a=a.stops;let g=c=0;for(let l=0;l<a.length;l++){const m=a[l].size;"number"===typeof m&&(c+=m,g++)}return c/g}return c}function f(a,c){if(!c)return a;c=c.filter(m=>"size"===m.type).map(m=>{const {maxSize:h,
minSize:b}=m;return(e(h,a)+e(b,a))/2});let g=0;const l=c.length;if(0===l)return a;for(let m=0;m<l;m++)g+=c[m];return Math.max(Math.floor(g/l),a)}k.calculateTolerance=function(a){const c=a&&a.renderer;a="touch"===(a&&a.event&&a.event.pointerType)?9:6;if(!c)return a;a="visualVariables"in c?f(a,c.visualVariables):a;if("simple"===c.type)return d(a,c.symbol);if("unique-value"===c.type){let g=a;c.uniqueValueInfos?.forEach(l=>{g=d(g,l.symbol)});return g}if("class-breaks"===c.type){let g=a;c.classBreakInfos.forEach(l=>
{g=d(g,l.symbol)});return g}return a};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/rest/identify":function(){define("exports ../request ../geometry/support/normalizeUtils ./utils ./operations/identify ./support/IdentifyParameters ./support/IdentifyResult".split(" "),function(k,d,e,f,a,c,g){function l(b){b=b.data;b.results=b.results||[];b.exceededTransferLimit=!!b.exceededTransferLimit;b.results=b.results.map(n=>g.fromJSON(n));return b}function m(b){return b=c.from(b)}function h(b,
n){function r(q){z.set(q.id,q);q.sublayers&&q.sublayers.forEach(r)}if(!n?.length)return b;const z=new Map;n.forEach(r);for(const q of b.results)q.feature.sourceLayer=z.get(q.layerId);return b}k.identify=async function(b,n,r){n=m(n);const z=n.geometry?[n.geometry]:[],q=f.parseUrl(b);q.path+="/identify";return e.normalizeCentralMeridian(z).then(A=>{A=a.identifyToIdentifyRESTParameters(n,{geometry:A&&A[0]});A=f.encode({...q.query,f:"json",...A});A=f.asValidOptions(A,r);return d(q.path,A).then(l).then(N=>
h(N,n.sublayers))})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/identify":function(){define("exports ../../core/maybe ../../core/sql ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../layers/support/floorFilterUtils ../../layers/support/sublayerUtils".split(" "),function(k,d,e,f,a,c,g){function l(h){const {mapExtent:b,floors:n,width:r,sublayers:z,layerIds:q,layerOption:A,gdbVersion:N}=h;var p=z?.find(t=>null!=t.layer)?.layer?.serviceSublayers;
const F="popup"===A;h={};const D=a.getScale({extent:b,width:r,spatialReference:b?.spatialReference}),L=[],U=t=>{const Q=0===D,V=0===t.minScale||D<=t.minScale,Y=0===t.maxScale||D>=t.maxScale;t.visible&&(Q||V&&Y)&&(t.sublayers?t.sublayers.forEach(U):!1!==q?.includes(t.id)&&(!F||t.popupTemplate&&t.popupEnabled)&&L.unshift(t))};z?.forEach(U);if(z&&!L.length)h.layerIds=[];else{p=g.isExportDynamic(L,p,N);var B=L.map(t=>{const Q=c.getLayerFloorFilterClause(n,t);return t.toExportImageJSON(Q)});if(p)h.dynamicLayers=
JSON.stringify(B);else if(z?(p=L.map(({id:t})=>t),q&&(p=p.filter(t=>q.includes(t))),h.layerIds=p):q?.length&&(h.layerIds=q),p=m(n,L),d.isSome(p)&&p.length){B={};for(const t of p)t.definitionExpression&&(B[t.id]=t.definitionExpression);Object.keys(B).length&&(h.layerDefs=JSON.stringify(B))}}return h}function m(h,b){const n=!!h?.length;b=b.filter(r=>null!=r.definitionExpression||n&&null!=r.floorInfo);return b.length?b.map(r=>{var z=c.getLayerFloorFilterClause(h,r);z=e.sqlAnd(z,r.definitionExpression);
return{id:r.id,definitionExpression:d.unwrapOr(z,void 0)}}):null}k.identifyToIdentifyRESTParameters=function(h,b){const {dpi:n,gdbVersion:r,geometry:z,geometryPrecision:q,height:A,layerOption:N,mapExtent:p,maxAllowableOffset:F,returnFieldName:D,returnGeometry:L,returnUnformattedValues:U,returnZ:B,spatialReference:t,timeExtent:Q,tolerance:V,width:Y}=h.toJSON(),{dynamicLayers:Z,layerDefs:ba,layerIds:da}=l(h);b=b&&d.isSome(b.geometry)?b.geometry:null;h={geometryPrecision:q,maxAllowableOffset:F,returnFieldName:D,
returnGeometry:L,returnUnformattedValues:U,returnZ:B,tolerance:V};b=b&&b.toJSON()||z;h.imageDisplay=`${Y},${A},${n}`;r&&(h.gdbVersion=r);b&&(delete b.spatialReference,h.geometry=JSON.stringify(b),h.geometryType=f.getJsonType(b));t?h.sr=t.wkid||JSON.stringify(t):b&&b.spatialReference?h.sr=b.spatialReference.wkid||JSON.stringify(b.spatialReference):p&&p.spatialReference&&(h.sr=p.spatialReference.wkid||JSON.stringify(p.spatialReference));h.time=Q?[Q.start,Q.end].join():null;if(p){const {xmin:ha,ymin:ca,
xmax:G,ymax:M}=p;h.mapExtent=`${ha},${ca},${G},${M}`}ba&&(h.layerDefs=ba);Z&&!ba&&(h.dynamicLayers=Z);h.layers="popup"===N?"visible":N;da&&!Z&&(h.layers+=`:${da.join(",")}`);return h};k.toDynamicLayersJSON=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/maybe","../../core/accessorSupport/PropertyOrigin"],function(k,d,e){function f(a,c){if(!a||!a.length||d.isNone(c))return!0;c=c.slice().reverse().flatten(({sublayers:m})=>
m&&m.toArray().reverse()).map(m=>m.id).toArray();if(a.length>c.length)return!1;let g=0;const l=c.length;for(const {id:m}of a){for(;g<l&&c[g]!==m;)g++;if(g>=l)return!1}return!0}k.isExportDynamic=function(a,c,g){return a.some(l=>{const m=l.source;return!(!m||"map-layer"===m.type&&m.mapLayerId===l.id&&(d.isNone(m.gdbVersion)||m.gdbVersion===g))||l.originIdOf("renderer")>e.OriginId.SERVICE||l.originIdOf("labelingInfo")>e.OriginId.SERVICE||l.originIdOf("opacity")>e.OriginId.SERVICE||l.originIdOf("labelsVisible")>
e.OriginId.SERVICE})?!0:!f(a,c)};k.isSublayerOverhaul=function(a){return!!a&&a.some(c=>null!=c.minScale||c.layerDefinition&&null!=c.layerDefinition.minScale)};k.shouldWriteSublayerStructure=function(a,c,g){return c.flatten(({sublayers:l})=>l).length!==a.length||a.some(l=>l.originIdOf("minScale")>g||l.originIdOf("maxScale")>g||l.originIdOf("renderer")>g||l.originIdOf("labelingInfo")>g||l.originIdOf("opacity")>g||l.originIdOf("labelsVisible")>g||l.originIdOf("source")>g)?!0:!f(a,c)};Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/IdentifyParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(k,d,e,f,a,
c,g,l,m,h,b,n,r){var z;a=z=function(q){function A(p){p=N.call(this,p);p.dpi=96;p.floors=null;p.gdbVersion=null;p.geometry=null;p.geometryPrecision=null;p.height=400;p.layerIds=null;p.layerOption="top";p.mapExtent=null;p.maxAllowableOffset=null;p.returnFieldName=!0;p.returnGeometry=!1;p.returnM=!1;p.returnUnformattedValues=!0;p.returnZ=!1;p.spatialReference=null;p.sublayers=null;p.timeExtent=null;p.tolerance=null;p.width=400;return p}k._inherits(A,q);var N=k._createSuper(A);A.from=function(p){return g.ensureClass(z,
p)};return k._createClass(A)}(a.JSONSupport);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"dpi",void 0);d.__decorate([c.property()],a.prototype,"floors",void 0);d.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"gdbVersion",void 0);d.__decorate([c.property({types:e.geometryTypes,json:{read:b.fromJSON,write:!0}})],a.prototype,"geometry",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"geometryPrecision",void 0);d.__decorate([c.property({type:Number,
json:{write:!0}})],a.prototype,"height",void 0);d.__decorate([c.property({type:[Number],json:{write:!0}})],a.prototype,"layerIds",void 0);d.__decorate([c.property({type:["top","visible","all","popup"],json:{write:!0}})],a.prototype,"layerOption",void 0);d.__decorate([c.property({type:n,json:{write:!0}})],a.prototype,"mapExtent",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"maxAllowableOffset",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,
"returnFieldName",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnGeometry",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnM",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnUnformattedValues",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnZ",void 0);d.__decorate([c.property({type:r,json:{write:!0}})],a.prototype,"spatialReference",void 0);d.__decorate([c.property()],
a.prototype,"sublayers",void 0);d.__decorate([c.property({type:f,json:{write:!0}})],a.prototype,"timeExtent",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"tolerance",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"width",void 0);return a=z=d.__decorate([h.subclass("esri.rest.support.IdentifyParameters")],a)})},"esri/rest/support/IdentifyResult":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/typeUtils".split(" "),
function(k,d,e,f,a,c,g,l,m,h,b,n,r,z){e=function(q){function A(p){p=N.call(this,p);p.displayFieldName=null;p.feature=null;p.layerId=null;p.layerName=null;return p}k._inherits(A,q);var N=k._createSuper(A);q=A.prototype;q.readFeature=function(p,F){return f.fromJSON({attributes:{...F.attributes},geometry:{...F.geometry}})};q.writeFeature=function(p,F){if(p){var {attributes:D,geometry:L}=p;D&&(F.attributes={...D});c.isSome(L)&&(F.geometry=L.toJSON(),F.geometryType=z.typeKebabDictionary.toJSON(L.type))}};
return k._createClass(A)}(a.JSONSupport);d.__decorate([g.property({type:String,json:{write:!0}})],e.prototype,"displayFieldName",void 0);d.__decorate([g.property({type:f})],e.prototype,"feature",void 0);d.__decorate([b.reader("feature",["attributes","geometry"])],e.prototype,"readFeature",null);d.__decorate([r.writer("feature")],e.prototype,"writeFeature",null);d.__decorate([g.property({type:Number,json:{write:!0}})],e.prototype,"layerId",void 0);d.__decorate([g.property({type:String,json:{write:!0}})],
e.prototype,"layerName",void 0);return e=d.__decorate([n.subclass("esri.rest.support.IdentifyResult")],e)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(k,d,e){k.getFetchPopupTemplate=function(f,a){return f.popupTemplate?f.popupTemplate:d.isSome(a)&&a.defaultPopupTemplateEnabled&&d.isSome(f.defaultPopupTemplate)?f.defaultPopupTemplate:null};k.getRequiredFields=async function(f,a=f.popupTemplate){if(d.isNone(a))return[];
const c=await a.getRequiredFields(f.fieldsIndex);({lastEditInfoEnabled:a}=a);const {objectIdField:g,typeIdField:l,globalIdField:m,relationships:h}=f;if(c.includes("*"))return["*"];a=a?await e.getFeatureEditFields(f):[];const b=e.fixFields(f.fieldsIndex,[...c,...a]);l&&b.push(l);b&&g&&f.fieldsIndex?.has(g)&&!b.includes(g)&&b.push(g);b&&m&&f.fieldsIndex?.has(m)&&!b.includes(m)&&b.push(m);h&&h.forEach(n=>{({keyField:n}=n);b&&n&&f.fieldsIndex?.has(n)&&!b.includes(n)&&b.push(n)});return b};Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define("exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils ../../geometry/Extent".split(" "),function(k,d,e,f,a,c){function g(m,h,b,n=new c){let r=0;if("2d"===b.type)r=h*(b.resolution??0);else if("3d"===b.type){var z=b.overlayPixelSizeInMapUnits(m),q=b.basemapSpatialReference;r=e.isSome(q)&&!q.equals(b.spatialReference)?f.getMetersPerUnitForSR(q)/f.getMetersPerUnitForSR(b.spatialReference):
h*z}h=m.x-r;z=m.y-r;q=m.x+r;m=m.y+r;({spatialReference:b}=b);n.xmin=Math.min(h,q);n.ymin=Math.min(z,m);n.xmax=Math.max(h,q);n.ymax=Math.max(z,m);n.spatialReference=b;return n}const l=new c;k.createQueryGeometry=g;k.intersectsDrapedGeometry=function(m,h,b){m=b.toMap(m);if(e.isNone(m))return!1;const n=a.calculateTolerance();return g(m,n,b,l).intersects(h)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../support/GraphicsCollection ../../../core/Error ../../../core/scheduling ../../../request ../../../chunks/index3 ../../../core/urlUtils ../../../chunks/index4 ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../webgl/context-util ../../../chunks/builtins ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../../../core/mathUtils ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../LabelManager ./graphics/GraphicsView2D ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ./BitmapTileLayerView2D ./LayerView2D ./graphics/HighlightGraphicContainer ./support/imageUtils ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/MapServiceLayerViewHelper ../../support/drapedUtils".split(" "),function(k,
d,e,f,a,c,g,l,m,h,b,n,r,z,q,A,N,p,F,D,L,U,B,t,Q,V,Y,Z,ba,da,ha,ca,G,M,R,v,y,w,K,E,P,x,I,J,H,S,W,ea,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,oa,pa,qa,ia,ra,ka,sa,ta,ua,va,la,wa){const xa=[0,0];g=function(O){function aa(){var u=ya.apply(this,arguments);u._fetchQueue=null;u._highlightGraphics=new n.GraphicsCollection;u._highlightView=null;u._popupHighlightHelper=null;u._tileStrategy=null;u.layer=null;return u}k._inherits(aa,O);var ya=k._createSuper(aa);O=aa.prototype;
O.update=function(u){this._fetchQueue.pause();this._fetchQueue.state=u.state;this._tileStrategy.update(u);this._fetchQueue.resume();this._highlightView?.processUpdate(u)};O.attach=function(){const u="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new ra(this.layer.tileInfo,this.layer.fullExtent);this._fetchQueue=new sa({tileInfoView:this._tileInfoView,concurrency:u&&10*u.length||10,process:(C,T)=>this.fetchTile(C,T)});this._tileStrategy=new ta({cachePolicy:"keep",resampling:this.resampling,
acquireTile:C=>this.acquireTile(C),releaseTile:C=>this.releaseTile(C),tileInfoView:this._tileInfoView});if(la.isMapServiceLayerView(this,this.layer)){const C=this._highlightView=new na({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new qa(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container);this._popupHighlightHelper=new la.MapServiceLayerViewHelper({createFetchPopupFeaturesQueryGeometry:(T,
X)=>wa.createQueryGeometry(T,X,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(T,X)=>{C.graphicUpdateHandler({graphic:T,property:X})},layerView:this,updatingHandles:this.updatingHandles})}this.requestUpdate();this.addAttachHandles(a.watch(()=>this.resampling,()=>{this.doRefresh()}));k._get(k._getPrototypeOf(aa.prototype),"attach",this).call(this)};O.detach=function(){k._get(k._getPrototypeOf(aa.prototype),"detach",this).call(this);this._tileStrategy.destroy();this._fetchQueue.clear();
this.container.removeAllChildren();this._popupHighlightHelper?.destroy();this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null};O.fetchPopupFeatures=async function(u,C){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeatures(u,C):[]};O.highlight=function(u){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(u):{remove(){}}};O.moveStart=function(){this.requestUpdate()};O.viewChange=function(){this.requestUpdate()};O.moveEnd=
function(){this.requestUpdate()};O.supportsSpatialReference=function(u){return b.equals(this.layer.tileInfo?.spatialReference,u)};O.doRefresh=async function(){!this.attached||this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(u=>this._enqueueTileFetch(u)))};O.isUpdating=function(){return this._fetchQueue?.updating??!1};O.acquireTile=function(u){u=this._bitmapView.createTile(u);const C=u.bitmap;[C.x,C.y]=this._tileInfoView.getTileCoords(xa,u.key);C.resolution=
this._tileInfoView.getTileResolution(u.key);[C.width,C.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(u);this._bitmapView.addChild(u);this.requestUpdate();return u};O.releaseTile=function(u){this._fetchQueue.abort(u.key.id);this._bitmapView.removeChild(u);u.once("detach",()=>u.destroy());this.requestUpdate()};O.fetchTile=async function(u,C={}){var T="tilemapCache"in this.layer?this.layer.tilemapCache:null;const {signal:X,resamplingLevel:ma=0}=C;if(!T)try{return await this._fetchImage(u,
X)}catch(fa){if(!f.isAbortError(fa)&&!this.resampling)return ia.createBlankImage(this._tileInfoView.tileInfo.size);if(3>ma&&(T=this._tileInfoView.getTileParentId(u.id)))return T=new ka(T),C=await this.fetchTile(T,{...C,resamplingLevel:ma+1}),ia.resampleImage(this._tileInfoView,C,T,u);throw fa;}C=new ka(0,0,0,0);let ja;try{await T.fetchAvailabilityUpsample(u.level,u.row,u.col,C,{signal:X});if(C.level!==u.level&&!this.resampling)return ia.createBlankImage(this._tileInfoView.tileInfo.size);ja=await this._fetchImage(C,
X)}catch(fa){if(f.isAbortError(fa))throw fa;ja=await this._fetchImage(u,X)}return this.resampling?ia.resampleImage(this._tileInfoView,ja,C,u):ja};O._enqueueTileFetch=async function(u){if(!this._fetchQueue.has(u.key.id)){try{const C=await this._fetchQueue.push(u.key);u.bitmap.source=C;u.bitmap.width=this._tileInfoView.tileInfo.size[0];u.bitmap.height=this._tileInfoView.tileInfo.size[1];u.once("attach",()=>this.requestUpdate())}catch(C){f.isAbortError(C)||e.getLogger(this.declaredClass).error(C)}this.requestUpdate()}};
O._fetchImage=async function(u,C){return this.layer.fetchImageBitmapTile(u.level,u.row,u.col,{signal:C})};k._createClass(aa,[{key:"resampling",get:function(){return!("resampling"in this.layer)||!1!==this.layer.resampling}}]);return aa}(va(oa.BitmapTileLayerView2D(pa.LayerView2DMixin(ua))));d.__decorate([c.property()],g.prototype,"_fetchQueue",void 0);d.__decorate([c.property()],g.prototype,"resampling",null);return g=d.__decorate([h.subclass("esri.views.2d.layers.TileLayerView2D")],g)});