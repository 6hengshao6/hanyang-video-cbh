// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(u,
A,K,t,C,H,I,P,D,V,G,L,U,X){t=function(N){function W(){var m=p.apply(this,arguments);m._loadImagery=(x,F,a,d,e)=>L.loadImagery(m.layer,x,F,a,d,e);m._createFlowMesh=(x,F,a,d)=>m.layer.createFlowMesh({meshType:x,flowData:a,simulationSettings:F},{signal:d});m.attached=!1;m.type="flow";m.timeExtent=null;m.redrawOrRefetch=async()=>{m._updateVisualization()};return m}u._inherits(W,N);var p=u._createSuper(W);N=W.prototype;N.attach=function(){const {layer:m}=this,x=()=>{this._loadImagery=(F,a,d,e,b)=>L.loadImagery(m,
F,a,d,e,b);this._updateVisualization()};"multidimensionalDefinition"in m?this.addHandles(C.watch(()=>m.multidimensionalDefinition,x)):this.addHandles([C.watch(()=>m.mosaicRule,x),C.watch(()=>m.renderingRule,x),C.watch(()=>m.definitionExpression,x)]);this.container=new U;this._strategy=new X({flowContainer:this.container});this._updateVisualization()};N.detach=function(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()};N.update=function(m){m.stationary?
this._strategy.update(m):this.layerView.requestUpdate()};N.hitTest=function(m){return new K({attributes:{},geometry:m.clone(),layer:this.layer})};N.moveEnd=function(){};N.doRefresh=async function(){};N._updateVisualization=function(){var m=this.layer.renderer;null!=m&&"flow"===m.type&&(m=G(m,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=m,this.layerView.requestUpdate())};u._createClass(W,[{key:"updating",get:function(){return!this.attached||
this._strategy.updating}}]);return W}(t);A.__decorate([H.property()],t.prototype,"_strategy",void 0);A.__decorate([H.property()],t.prototype,"attached",void 0);A.__decorate([H.property()],t.prototype,"container",void 0);A.__decorate([H.property()],t.prototype,"layer",void 0);A.__decorate([H.property()],t.prototype,"layerView",void 0);A.__decorate([H.property()],t.prototype,"type",void 0);A.__decorate([H.property()],t.prototype,"updating",null);A.__decorate([H.property()],t.prototype,"timeExtent",
void 0);return t=A.__decorate([V.subclass("esri.views.2d.engine.flow.FlowView2D")],t)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define("../../../../core/maybe ./utils ./styles/Imagery ./styles/Particles ./styles/Stack ./styles/Streamlines".split(" "),function(u,A,K,t,C,H){return function(I,P){const {flowSpeed:D,trailLength:V}=I,G=A.getFlowSimulationSettings(I);let L=null;const U={opacity:A.getOpacity(I),size:A.getSize(I)};let X=A.getColor(I);"none"===I.background?U.color=X:("constant"===
X.kind&&(X={kind:"ramp",stops:[0,1],values:[0,0,0,1,X.value[0],X.value[1],X.value[2],X.value[3]],count:2}),L=new K.Imagery({loadImagery:P.loadImagery,timeExtent:P.timeExtent,color:X,opacity:{kind:"constant",value:[1]}}),U.color=A.getForegroundColor());P={loadImagery:P.loadImagery,createFlowMesh:P.createFlowMesh,simulationSettings:G,timeExtent:P.timeExtent,trailLength:V,flowSpeed:D,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:U.color,opacity:U.opacity,size:U.size};
I="butt"===I.trailCap||4>=A.getMax(A.getSize(I))?new H(P):new t.Particles(P);return u.isSome(L)?new C.Stack([L,I]):I}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/maybe","../../../../core/screenUtils"],function(u,A,K){function t(D){return"constant"===D.kind?D.value[0]:D.values[D.values.length-1]}function C(D){D=D.toRgba();return[D[0]/255,D[1]/255,D[2]/255,D[3]]}function H(D){if(!D.hasVisualVariables("size"))return{kind:"constant",value:[K.pt2px(D.trailWidth)]};
const V=D.getVisualVariablesForType("size")[0];D=[];const G=[];if(V.stops){for(L of V.stops)D.push(L.value),G.push(K.pt2px(L.size));var L=V.stops.length}else D.push(V.minDataValue,V.maxDataValue),G.push(K.pt2px(V.minSize),K.pt2px(V.maxSize)),L=2;return{kind:"ramp",stops:D,values:G,count:L}}function I(D,V,G,L){switch(V){case "int":D.setUniform1iv(G,L);break;case "float":D.setUniform1fv(G,L);break;case "vec2":D.setUniform2fv(G,L);break;case "vec3":D.setUniform3fv(G,L);break;case "vec4":D.setUniform4fv(G,
L)}}function P(D,V){return D===V?!0:A.isSome(D)&&A.isSome(V)?D.equals(V):!1}u.areStreamlinesCompatible=function(D,V){var G=D.simulationSettings,L=V.simulationSettings;let U;U=(U=(U=(U=(U=(U=(U=(U=(U=(U=(U=G.collisions===L.collisions)&&G.density===L.density)&&G.interpolate===L.interpolate)&&G.lineCollisionWidth===L.lineCollisionWidth)&&G.lineSpacing===L.lineSpacing)&&G.maxTurnAngle===L.maxTurnAngle)&&G.minSpeedThreshold===L.minSpeedThreshold)&&G.segmentLength===L.segmentLength)&&G.smoothing===L.smoothing)&&
G.velocityScale===L.velocityScale)&&G.verticesPerLine===L.verticesPerLine;return U&&P(D.timeExtent,V.timeExtent)?G=(G=(G=(G=(G=D.loadImagery===V.loadImagery)&&D.createFlowMesh===V.createFlowMesh)&&D.color.kind===V.color.kind)&&D.opacity.kind===V.opacity.kind)&&D.size.kind===V.size.kind:!1};u.getColor=function(D){if(!D.hasVisualVariables("color"))return{kind:"constant",value:C(D.color)};D=D.getVisualVariablesForType("color")[0];const V=[],G=[];for(const L of D.stops)V.push(L.value),Array.prototype.push.apply(G,
C(L.color));return{kind:"ramp",stops:V,values:G,count:D.stops.length}};u.getFlowSimulationSettings=function(D){var V=H(D);V=t(V);const G=Math.max(V/2,5),L=Math.round(K.pt2px(D.maxPathLength)/G)+1,{density:U}=D;return{smoothing:K.pt2px(D.smoothing),interpolate:!0,velocityScale:"flow-from"===D.flowRepresentation?1:-1,verticesPerLine:L,minSpeedThreshold:.001,segmentLength:G,maxTurnAngle:1,collisions:!0,lineCollisionWidth:V,lineSpacing:10,density:U}};u.getForegroundColor=function(D){return{kind:"constant",
value:[.1,.1,.1,1]}};u.getMax=t;u.getOpacity=function(D){if(!D.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};D=D.getVisualVariablesForType("opacity")[0];const V=[],G=[];for(const L of D.stops)V.push(L.value),G.push(L.opacity);return{kind:"ramp",stops:V,values:G,count:D.stops.length}};u.getSize=H;u.setUniform=I;u.setUniforms=function(D,V,G,L){"constant"===L.kind?I(D,G,`u_${V}`,L.value):(I(D,"float",`u_${V}_stops`,L.stops),I(D,G,`u_${V}_values`,L.values),D.setUniform1i(`u_${V}_count`,
L.count))};u.timeExtentsEqual=P;u.toRgba=C;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(u,A,K,t,C,H,I,P,D){let V=function(){function N(p){this._params=
p;this.animated=!1}var W=N.prototype;W.isCompatible=function(p){if(!(p instanceof N&&t.timeExtentsEqual(this._params.timeExtent,p._params.timeExtent)))return!1;let m;return m=(m=(m=this._params.loadImagery===p._params.loadImagery)&&this._params.color.kind===p._params.color.kind)&&this._params.opacity.kind===p._params.opacity.kind};W.load=async function(p,m){const {extent:x,size:F}=p;K.throwIfAborted(m);p=await this._params.loadImagery(x,F[0],F[1],this._params.timeExtent,m);return new X(p,{color:this._params.color,
opacity:this._params.opacity})};W.render=function(p,m,x){({context:p}=p);const {program:F}=x;p.setFaceCullingEnabled(!1);p.setBlendingEnabled(!0);p.setBlendFunction(H.BlendFactor.ONE,H.BlendFactor.ONE_MINUS_SRC_ALPHA);p.useProgram(F);F.setUniformMatrix3fv("u_dvsMat3",m.dvsMat3);p.bindTexture(x.texture,0);F.setUniform1i("u_texture",0);F.setUniform1f("u_Min",x.min);F.setUniform1f("u_Max",x.max);t.setUniforms(F,"color","vec4",this._params.color);t.setUniforms(F,"opacity","float",this._params.opacity);
p.bindVAO(x.vertexArray);p.drawArrays(H.PrimitiveType.TRIANGLE_STRIP,0,4)};return A._createClass(N)}();const G=new Map;G.set("a_position",0);G.set("a_texcoord",1);const L={geometry:[new D.VertexElementDescriptor("a_position",2,H.DataType.UNSIGNED_SHORT,0,8),new D.VertexElementDescriptor("a_texcoord",2,H.DataType.UNSIGNED_SHORT,4,8)]},U={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:G};let X=function(){function N(p,m){this._flowData=p;this._values=m}var W=N.prototype;W.attach=
function(p){var {context:m}=p;const {width:x,height:F}=this._flowData;var a={geometry:C.BufferObject.createVertex(m,H.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,x,0,1,1,0,F,0,0,x,F,1,0]))};a=new P.VertexArrayObject(m,G,L,a);var d=[];"ramp"===this._values.color.kind&&d.push("vvColor");"ramp"===this._values.opacity.kind&&d.push("vvOpacity");p=p.painter.materialManager.getProgram(U,d);d=1E6;let e=-1E6;for(var b=0;b<F;b++)for(var c=0;c<x;c++)if(0!==this._flowData.mask[b*x+c]){var g=this._flowData.data[2*
(b*x+c)],h=this._flowData.data[2*(b*x+c)+1];g=Math.sqrt(g*g+h*h);d=Math.min(d,g);e=Math.max(e,g)}b=new Uint8Array(4*x*F);for(c=0;c<F;c++)for(g=0;g<x;g++)if(0!==this._flowData.mask[c*x+g]){h=this._flowData.data[2*(c*x+g)];const k=this._flowData.data[2*(c*x+g)+1];b[4*(c*x+g)]=(Math.sqrt(h*h+k*k)-d)/(e-d)*255;b[4*(c*x+g)+1]=0;b[4*(c*x+g)+2]=0;b[4*(c*x+g)+3]=255}else b[4*(c*x+g)]=0,b[4*(c*x+g)+1]=0,b[4*(c*x+g)+2]=0,b[4*(c*x+g)+3]=0;m=new I.Texture(m,{pixelFormat:H.PixelFormat.RGBA,internalFormat:H.PixelFormat.RGBA,
samplingMode:H.TextureSamplingMode.LINEAR,dataType:H.PixelType.UNSIGNED_BYTE,wrapMode:H.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,width:x,height:F},b);this.vertexArray=a;this.program=p;this.texture=m;this.min=d;this.max=e;this._flowData=null};W.detach=function(){this.vertexArray.dispose();this.texture.dispose()};A._createClass(N,[{key:"ready",get:function(){return this.program.compiled}}]);return N}();u.Imagery=V;u.ImageryResources=X;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(u,A,K,t,C,H,I,P){let D=function(){function X(W){this._params=W}var N=X.prototype;N.isCompatible=function(W){return W instanceof X?t.areStreamlinesCompatible(this._params,W._params):!1};
N.load=async function(W,p){const {extent:m,size:x}=W;K.throwIfAborted(p);W=await this._params.loadImagery(m,x[0],x[1],this._params.timeExtent,p);const {vertexData:F,indexData:a}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,W,p);return new U(F,a,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})};N.render=function(W,p,m){({context:W}=W);const {program:x}=m;W.setFaceCullingEnabled(!1);W.setBlendingEnabled(!0);W.setBlendFunction(H.BlendFactor.ONE,
H.BlendFactor.ONE_MINUS_SRC_ALPHA);W.useProgram(x);x.setUniform1f("u_time",p.time);x.setUniform1f("u_trailLength",this._params.trailLength);x.setUniform1f("u_flowSpeed",this._params.flowSpeed);x.setUniform1f("u_featheringSize",this._params.featheringSize);x.setUniform1f("u_featheringOffset",this._params.featheringOffset);x.setUniform1f("u_introFade",this._params.introFade?1:0);x.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);x.setUniform1f("u_decayRate",this._params.decayRate);x.setUniformMatrix3fv("u_dvsMat3",
p.dvsMat3);x.setUniformMatrix3fv("u_displayViewMat3",p.displayViewMat3);t.setUniforms(x,"color","vec4",this._params.color);t.setUniforms(x,"opacity","float",this._params.opacity);t.setUniforms(x,"size","float",this._params.size);W.bindVAO(m.vertexArray);W.drawElements(H.PrimitiveType.TRIANGLES,m.indexCount,H.DataType.UNSIGNED_INT,0)};A._createClass(X,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return X}();const V=new Map;V.set("a_xyts0",0);V.set("a_xyts1",1);V.set("a_typeIdDurationSeed",
2);V.set("a_extrudeInfo",3);const G={geometry:[new P.VertexElementDescriptor("a_xyts0",4,H.DataType.FLOAT,0,64),new P.VertexElementDescriptor("a_xyts1",4,H.DataType.FLOAT,16,64),new P.VertexElementDescriptor("a_typeIdDurationSeed",4,H.DataType.FLOAT,32,64),new P.VertexElementDescriptor("a_extrudeInfo",4,H.DataType.FLOAT,48,64)]},L={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:V};let U=function(){function X(W,p,m){this._vertexData=W;this._indexData=p;this._values=m}var N=
X.prototype;N.attach=function(W){var {context:p}=W,m=C.BufferObject.createVertex(p,H.Usage.STATIC_DRAW,this._vertexData);const x=C.BufferObject.createIndex(p,H.Usage.STATIC_DRAW,this._indexData);p=new I.VertexArrayObject(p,V,G,{geometry:m},x);m=[];"ramp"===this._values.color.kind&&m.push("vvColor");"ramp"===this._values.opacity.kind&&m.push("vvOpacity");"ramp"===this._values.size.kind&&m.push("vvSize");W=W.painter.materialManager.getProgram(L,m);this.vertexArray=p;this.program=W;this.indexCount=this._indexData.length;
this._indexData=this._vertexData=null};N.detach=function(){this.vertexArray.dispose()};A._createClass(X,[{key:"ready",get:function(){return this.program.compiled}}]);return X}();u.Particles=D;u.ParticlesResources=U;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(u,A){let K=function(){function C(I){this._styles=I}var H=C.prototype;H.isCompatible=function(I){if(!(I instanceof
C)||this._styles.length!==I._styles.length)return!1;const P=this._styles.length;for(let D=0;D<P;D++)if(!this._styles[D].isCompatible(I._styles[D]))return!1;return!0};H.load=async function(I,P){const D=await Promise.all(this._styles.map(V=>V.load(I,P)));return new t(D)};H.render=function(I,P,D){for(let V=0;V<this._styles.length;V++)this._styles[V].render(I,P,D.resources[V])};A._createClass(C,[{key:"animated",get:function(){return this._styles.reduce((I,P)=>I||P.animated,!1)}}]);return C}(),t=function(){function C(I){this.resources=
I}var H=C.prototype;H.attach=function(I){for(const P of this.resources)P.attach(I)};H.detach=function(){for(const I of this.resources)I.detach()};A._createClass(C,[{key:"ready",get:function(){return this.resources.reduce((I,P)=>I&&P.ready,!0)}}]);return C}();u.Stack=K;u.StackResources=t;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(u,A,K,t,C,H,I){let P=function(){function U(N){this._params=N}var X=U.prototype;X.isCompatible=function(N){return N instanceof U?K.areStreamlinesCompatible(this._params,N._params):!1};X.load=async function(N,W){const {extent:p,size:m}=N;A.throwIfAborted(W);N=await this._params.loadImagery(p,m[0],m[1],this._params.timeExtent,W);const {vertexData:x,indexData:F}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,N,W);return new L(x,F,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})};X.render=function(N,W,p){({context:N}=N);const {program:m}=p;N.setFaceCullingEnabled(!1);N.setBlendingEnabled(!0);N.setBlendFunction(C.BlendFactor.ONE,C.BlendFactor.ONE_MINUS_SRC_ALPHA);N.useProgram(m);m.setUniform1f("u_time",W.time);m.setUniform1f("u_trailLength",this._params.trailLength);m.setUniform1f("u_flowSpeed",this._params.flowSpeed);m.setUniform1f("u_featheringSize",this._params.featheringSize);m.setUniform1f("u_featheringOffset",this._params.featheringOffset);m.setUniform1f("u_introFade",
this._params.introFade?1:0);m.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);m.setUniform1f("u_decayRate",this._params.decayRate);m.setUniformMatrix3fv("u_dvsMat3",W.dvsMat3);m.setUniformMatrix3fv("u_displayViewMat3",W.displayViewMat3);K.setUniforms(m,"color","vec4",this._params.color);K.setUniforms(m,"opacity","float",this._params.opacity);K.setUniforms(m,"size","float",this._params.size);N.bindVAO(p.vertexArray);N.drawElements(C.PrimitiveType.TRIANGLES,p.indexCount,C.DataType.UNSIGNED_INT,
0)};u._createClass(U,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return U}();const D=new Map;D.set("a_positionAndSide",0);D.set("a_timeInfo",1);D.set("a_extrude",2);D.set("a_speed",3);const V={geometry:[new I.VertexElementDescriptor("a_positionAndSide",3,C.DataType.FLOAT,0,36),new I.VertexElementDescriptor("a_timeInfo",3,C.DataType.FLOAT,12,36),new I.VertexElementDescriptor("a_extrude",2,C.DataType.FLOAT,24,36),new I.VertexElementDescriptor("a_speed",1,C.DataType.FLOAT,32,
36)]},G={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:D};let L=function(){function U(N,W,p){this._vertexData=N;this._indexData=W;this._values=p}var X=U.prototype;X.attach=function(N){var {context:W}=N,p=t.BufferObject.createVertex(W,C.Usage.STATIC_DRAW,this._vertexData);const m=t.BufferObject.createIndex(W,C.Usage.STATIC_DRAW,this._indexData);W=new H.VertexArrayObject(W,D,V,{geometry:p},m);p=[];"ramp"===this._values.color.kind&&p.push("vvColor");"ramp"===this._values.opacity.kind&&
p.push("vvOpacity");"ramp"===this._values.size.kind&&p.push("vvSize");N=N.painter.materialManager.getProgram(G,p);this.vertexArray=W;this.program=N;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};X.detach=function(){this.vertexArray.dispose()};u._createClass(U,[{key:"ready",get:function(){return this.program.compiled}}]);return U}();return P})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(u,A,K,t,C,H,I,P,D,V){function G(a,d){const e=X(d.data,d.width,d.height,a.smoothing);return a.interpolate?(b,c)=>{const g=Math.floor(b),h=Math.floor(c);if(0>g||g>=d.width||0>h||h>=d.height)return[0,0];b-=g;c-=h;const k=g<d.width-1?g+1:g,l=h<d.height-1?h+1:h;return[(e[2*(h*d.width+g)]*(1-c)+e[2*(l*d.width+g)]*c)*(1-b)+(e[2*(h*d.width+k)]*(1-c)+e[2*(l*d.width+k)]*c)*b,(e[2*(h*d.width+g)+1]*(1-c)+e[2*(l*d.width+g)+1]*c)*(1-b)+(e[2*(h*d.width+k)+1]*(1-c)+e[2*(l*d.width+k)+1]*c)*b]}:(b,c)=>{b=
Math.round(b);c=Math.round(c);return 0>b||b>=d.width||0>c||c>=d.height?[0,0]:[e[2*(c*d.width+b)],e[2*(c*d.width+b)+1]]}}function L(a,d,e,b,c,g,h,k,l){const w=[];let z=0,[E,y]=d(e,b);E*=a.velocityScale;y*=a.velocityScale;w.push({x:e,y:b,t:z,speed:Math.sqrt(E*E+y*y)});for(let S=0;S<a.verticesPerLine;S++){let [T,ba]=d(e,b);T*=a.velocityScale;ba*=a.velocityScale;const Y=Math.sqrt(T*T+ba*ba);if(Y<a.minSpeedThreshold)break;const f=T/Y,n=ba/Y;e+=f*a.segmentLength;b+=n*a.segmentLength;z+=a.segmentLength/
Y;if(Math.acos(f*B+n*Q)>a.maxTurnAngle)break;if(a.collisions){var B=Math.round(e*l);var Q=Math.round(b*l);if(0>B||B>h-1||0>Q||Q>k-1)break;const q=g[Q*h+B];if(-1!==q&&q!==c)break;g[Q*h+B]=c}w.push({x:e,y:b,t:z,speed:Y});B=f;Q=n}return w}function U(a,d,e,b){const c=[],g=new P,h=1/Math.max(a.lineCollisionWidth,1),k=Math.round(e*h),l=Math.round(b*h),w=new Int32Array(k*l);for(var z=0;z<w.length;z++)w[z]=-1;z=[];for(let E=0;E<b;E+=a.lineSpacing)for(let y=0;y<e;y+=a.lineSpacing)z.push({x:y,y:E,sort:g.getFloat()});
z.sort((E,y)=>E.sort-y.sort);for(const {x:E,y}of z)g.getFloat()<a.density&&(e=L(a,d,E,y,c.length,w,k,l,h),2>e.length||c.push(e));return c}function X(a,d,e,b){if(0===b)return a;const c=Math.round(3*b),g=Array(2*c+1);var h=0;for(var k=-c;k<=c;k++){var l=Math.exp(-k*k/(b*b));g[k+c]=l;h+=l}for(b=-c;b<=c;b++)g[b+c]/=h;h=new Float32Array(a.length);for(b=0;b<e;b++)for(k=0;k<d;k++){var w=l=0;for(var z=-c;z<=c;z++)if(!(0>k+z||k+z>=d)){var E=g[z+c];l+=E*a[2*(b*d+(k+z))];w+=E*a[2*(b*d+(k+z))+1]}h[2*(b*d+k)]=
l;h[2*(b*d+k)+1]=w}a=new Float32Array(a.length);for(b=0;b<d;b++)for(k=0;k<e;k++){w=l=0;for(z=-c;z<=c;z++)0>k+z||k+z>=e||(E=g[z+c],l+=E*h[2*((k+z)*d+b)],w+=E*h[2*((k+z)*d+b)+1]);a[2*(k*d+b)]=l;a[2*(k*d+b)+1]=w}return a}function N(a,d){const e=new P;var b=a.reduce((k,l)=>k+l.length,0);b=new Float32Array(4*b);const c=Array(a.length);let g=0,h=0;for(const k of a){a=g;for(const l of k)b[4*g]=l.x,b[4*g+1]=l.y,b[4*g+2]=l.t,b[4*g+3]=l.speed,g++;c[h++]={startVertex:a,numberOfVertices:k.length,totalTime:k[k.length-
1].t,timeSeed:d?e.getFloat():0}}return{lineVertices:b,lineDescriptors:c}}function W(a,d){function e(B,Q,S,T,ba,Y,f,n){const q=9*l;let r=0;k[q+r++]=B;k[q+r++]=Q;k[q+r++]=1;k[q+r++]=S;k[q+r++]=Y;k[q+r++]=f;k[q+r++]=T/2;k[q+r++]=ba/2;k[q+r++]=n;l++;k[q+r++]=B;k[q+r++]=Q;k[q+r++]=-1;k[q+r++]=S;k[q+r++]=Y;k[q+r++]=f;k[q+r++]=-T/2;k[q+r++]=-ba/2;k[q+r++]=n;l++}const {lineVertices:b,lineDescriptors:c}=a;var g=a=0;for(var h of c)a+=2*h.numberOfVertices,g+=6*(h.numberOfVertices-1);const k=new Float32Array(9*
a);h=new Uint32Array(g);let l=0;a=0;for(const B of c){const {totalTime:Q,timeSeed:S}=B;let T=g=null,ba=null;var w=null,z=null,E=null;for(let Y=0;Y<B.numberOfVertices;Y++){w=b[4*(B.startVertex+Y)];const f=b[4*(B.startVertex+Y)+1],n=b[4*(B.startVertex+Y)+2],q=b[4*(B.startVertex+Y)+3];let r=null,M=null;var y=null;let v=null;0<Y&&(r=w-g,M=f-T,y=Math.sqrt(r*r+M*M),r/=y,M/=y,1<Y?(z=r+z,E=M+E,y=Math.sqrt(z*z+E*E),z/=y,E/=y,y=Math.min(1/(z*r+E*M),d),z*=y,E*=y,y=-E,v=z):(y=-M,v=r),null!==y&&null!==v&&(e(g,
T,ba,y,v,Q,S,q),h[a++]=l-2,h[a++]=l,h[a++]=l-1,h[a++]=l,h[a++]=l+1,h[a++]=l-1));g=w;T=f;ba=n;z=r;E=M;w=q}e(g,T,ba,-E,z,Q,S,w)}return{vertexData:k,indexData:h}}function p(a){function d(R,J){var Z=n+r,aa=q+M,ca=Math.sqrt(Z*Z+aa*aa);Z/=ca;aa/=ca;var ea=n*Z+q*aa,da=r+v,ia=M+O;ca=Math.sqrt(da*da+ia*ia);da/=ca;ia/=ca;var fa=r*da+M*ia;ca=y;var ja=B,ha=Q,la=S;aa=-(aa/ea);Z/=ea;ea=T;var na=ba,oa=Y,pa=f;ia=-(ia/fa);da/=fa;fa=16*z;let ma=0;for(const ta of[1,2])for(const qa of[1,2,3,4])l[fa+ma++]=ca,l[fa+ma++]=
ja,l[fa+ma++]=ha,l[fa+ma++]=la,l[fa+ma++]=ea,l[fa+ma++]=na,l[fa+ma++]=oa,l[fa+ma++]=pa,l[fa+ma++]=ta,l[fa+ma++]=qa,l[fa+ma++]=R,l[fa+ma++]=J,l[fa+ma++]=aa/2,l[fa+ma++]=Z/2,l[fa+ma++]=ia/2,l[fa+ma++]=da/2,z++;w[E++]=z-8;w[E++]=z-7;w[E++]=z-6;w[E++]=z-7;w[E++]=z-5;w[E++]=z-6;w[E++]=z-4;w[E++]=z-3;w[E++]=z-2;w[E++]=z-3;w[E++]=z-1;w[E++]=z-2}function e(R,J,Z,aa,ca,ea){n=r;q=M;r=v;M=O;null==n&&null==q&&(n=r,q=M);if(null!=T&&null!=ba){v=R-T;O=J-ba;const da=Math.sqrt(v*v+O*O);v/=da;O/=da}null!=n&&null!=
q&&d(ca,ea);y=T;B=ba;Q=Y;S=f;T=R;ba=J;Y=Z;f=aa}function b(R,J){n=r;q=M;r=v;M=O;null==n&&null==q&&(n=r,q=M);null!=n&&null!=q&&d(R,J)}const {lineVertices:c,lineDescriptors:g}=a;let h=a=0;for(var k of g){const R=k.numberOfVertices-1;a+=8*R;h+=12*R}const l=new Float32Array(16*a),w=new Uint32Array(h);let z=0,E=0,y,B,Q,S,T,ba,Y,f,n,q,r,M,v,O;for(const R of g){O=v=M=r=q=n=f=Y=ba=T=S=Q=B=y=null;const {totalTime:J,timeSeed:Z}=R;for(k=0;k<R.numberOfVertices;k++)e(c[4*(R.startVertex+k)],c[4*(R.startVertex+k)+
1],c[4*(R.startVertex+k)+2],c[4*(R.startVertex+k)+3],J,Z);b(J,Z)}return{vertexData:l,indexData:w}}function m(a,d){const e=d.pixels,{width:b,height:c}=d,g=new Float32Array(b*c*2),h=d.mask||new Uint8Array(b*c*2);d.mask||h.fill(255);if("vector-uv"===a)for(a=0;a<b*c;a++)g[2*a]=e[0][a],g[2*a+1]=-e[1][a];else if("vector-magdir"===a)for(a=0;a<b*c;a++){d=e[0][a];const k=C.deg2rad(e[1][a]),l=Math.sin(k-Math.PI/2);g[2*a]=Math.cos(k-Math.PI/2)*d;g[2*a+1]=l*d}return{data:g,mask:h,width:b,height:c}}async function x(a,
d,e,b,c,g){const h={requestProjectedLocalDirections:!0,signal:g};H.isSome(c)&&(h.timeExtent=c);if("imagery"===a.type)return await a.load({signal:g}),c=a.rasterInfo.dataType,a=await a.fetchImage(d,e,b,h),!a||H.isNone(a.pixelData)||H.isNone(a.pixelData.pixelBlock)?{data:new Float32Array(e*b*2),mask:new Uint8Array(e*b),width:e,height:b}:m(c,a.pixelData.pixelBlock);await a.load({signal:g});c=a.rasterInfo.dataType;a=await a.fetchPixels(d,e,b,h);return!a||H.isNone(a.pixelBlock)?{data:new Float32Array(e*
b*2),mask:new Uint8Array(e*b),width:e,height:b}:m(c,a.pixelBlock)}const F=t.getLogger("esri.views.2d.engine.flow.dataUtils");u.createAnimatedLinesData=N;u.createFlowMesh=async function(a,d,e,b){const c=performance.now();var g=G(d,e);const h=performance.now();e=U(d,g,e.width,e.height);d=performance.now();g=N(e,!0);e=performance.now();a="Streamlines"===a?W(g,10):p(g);g=performance.now();K("esri-2d-profiler")&&(F.info("I.1","_createFlowFieldFromData (ms)",Math.round(h-c)),F.info("I.2","_getStreamlines (ms)",
Math.round(d-h)),F.info("I.3","createAnimatedLinesData (ms)",Math.round(e-d)),F.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(g-e)),F.info("I.5","createFlowMesh (ms)",Math.round(g-c)),F.info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();I.throwIfAborted(b);return a};u.createParticlesMesh=p;u.createStreamlinesMesh=W;u.loadImagery=async function(a,d,e,b,c,g){const h=performance.now();var k=D.getInfo(d.spatialReference);
if(!k)return e=await x(a,d,e,b,c,g),K("esri-2d-profiler")&&F.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-h)),K("esri-2d-profiler")&&F.info("I.9","Number of parts",1),e;const [l,w]=k.valid,z=Math.ceil(d.width/(w-l)),E=d.width/z,y=Math.round(e/z);let B=d.xmin;const Q=[];k=performance.now();for(let S=0;S<z;S++){const T=new V({xmin:B,xmax:B+E,ymin:d.ymin,ymax:d.ymax,spatialReference:d.spatialReference});Q.push(x(a,T,y,b,c,g));B+=E}a=await Promise.all(Q);K("esri-2d-profiler")&&
F.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-k));K("esri-2d-profiler")&&F.info("I.9","Number of parts",a.length);b={data:new Float32Array(e*b*2),mask:new Uint8Array(e*b),width:e,height:b};d=0;for(const S of a){for(a=0;a<S.height;a++)for(c=0;c<S.width;c++)d+c>=e||(b.data[2*(a*e+d+c)]=S.data[2*(a*S.width+c)],b.data[2*(a*e+d+c)+1]=S.data[2*(a*S.width+c)+1],b.mask[a*e+d+c]=S.mask[a*S.width+c]);d+=S.width}K("esri-2d-profiler")&&F.info("I.10","loadImagery, general exit (ms)",
Math.round(performance.now()-h));return b};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(u,A,K,t){return function(C){function H(){var P=I.apply(this,arguments);P.flowStyle=null;return P}u._inherits(H,C);var I=u._createSuper(H);C=H.prototype;C.doRender=function(P){u._get(u._getPrototypeOf(H.prototype),"doRender",
this).call(this,P)};C.prepareRenderPasses=function(P){const D=P.registerRenderPass({name:"flow",brushes:[A],target:()=>this.children,drawPhase:K.WGLDrawPhase.MAP});return[...u._get(u._getPrototypeOf(H.prototype),"prepareRenderPasses",this).call(this,P),D]};u._createClass(H,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return H}(t)})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat3f32",
"../webgl/brushes/WGLBrush","../../../webgl/enums"],function(u,A,K,t,C){return function(H){function I(){var D=P.apply(this,arguments);D._visualState={time:0,dvsMat3:K.create(),displayViewMat3:K.create()};return D}u._inherits(I,H);var P=u._createSuper(I);H=I.prototype;H.dispose=function(){};H.prepareState=function(D){({context:D}=D);D.setColorMask(!0,!0,!0,!0);D.setStencilFunction(C.CompareFunction.EQUAL,0,255)};H.draw=function(D,V){const {requestRender:G,allowDelayedRender:L}=D,{displayData:U}=V;
if(!A.isNone(U)&&("loaded"===U.state.name&&U.attach(D),"attached"===U.state.name)){var X=U.state.resources;L&&!X.ready&&A.isSome(G)?G():(this._visualState.time=D.time/1E3,this._visualState.dvsMat3=V.transforms.dvs,this._visualState.displayViewMat3=D.state.displayViewMat3,U.flowStyle.render(D,this._visualState,X),U.flowStyle.animated&&A.isSome(G)&&G())}};return u._createClass(I)}(t)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U,X,N,W,p){function m(x,F){const a=new X({x:(x.xmax+x.xmin)/2,y:(x.ymax+x.ymin)/2,spatialReference:x.spatialReference});var d=x.xmax-x.xmin;const e=x.ymax-x.ymin,b=Math.abs(Math.cos(H.deg2rad(F))),c=Math.abs(Math.sin(H.deg2rad(F)));F=b*d+c*e;d=c*d+b*e;x=new p({xmin:a.x-F/2,ymin:a.y-d/2,xmax:a.x+F/2,ymax:a.y+d/2,spatialReference:x.spatialReference});x.centerAt(a);return x}K=function(x){function F(d){d=a.call(this,d);d._flowDisplayObject=new W.FlowDisplayObject;d._loading=
null;return d}u._inherits(F,x);var a=u._createSuper(F);x=F.prototype;x.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};x.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};x.update=function(d){var {flowStyle:e}=this.flowContainer;if(I.isNone(e))this._clear();else{var {extent:b,rotation:c,resolution:g,pixelRatio:h}=d.state;d=m(b,c);d.expand(1.15);e=new N(e,d,[Math.round((d.xmax-d.xmin)/g),Math.round((d.ymax-d.ymin)/g)],h);if(I.isSome(this._loading)){if(this._loading.update(e))return;
this._loading.detach();this._loading=null}if(I.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(e))e.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},k=>{P.isAbortError(k)||(C.getLogger(this.declaredClass).error("A resource failed to load.",k),this._loading=null)}),this._loading=e}};x._clear=function(){this._flowDisplayObject.clear();I.isSome(this._loading)&&(this._loading.detach(),this._loading=
null)};u._createClass(F,[{key:"updating",get:function(){return null!=this._loading}}]);return F}(t);A.__decorate([D.property()],K.prototype,"_loading",void 0);A.__decorate([D.property()],K.prototype,"flowContainer",void 0);A.__decorate([D.property()],K.prototype,"updating",null);return K=A.__decorate([U.subclass("esri.views.2d.engine.flow.FlowStrategy")],K)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(u,
A){return function(){function K(C,H,I,P){this.state={name:"created"};this.flowStyle=C;this.extent=H;this.size=I;this.pixelRatio=P}var t=K.prototype;t.load=async function(){const C=new AbortController;this.state={name:"loading",abortController:C};this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},C.signal)}};t.attach=function(C){if("loaded"!==this.state.name)A.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");
else{var H=this.state.resources;H.attach(C);this.state={name:"attached",resources:H}}};t.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};t.update=function(C){if(!this.flowStyle.isCompatible(C.flowStyle)||!this.extent.equals(C.extent)||this.size[0]!==C.size[0]||this.size[1]!==C.size[1]||this.pixelRatio!==C.pixelRatio)return!1;this.flowStyle=C.flowStyle;
return!0};return u._createClass(K)}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(u,A,K,t,C,H,I){I=function(P){function D(){var G=V.apply(this,arguments);G._displayData=null;return G}A._inherits(D,P);var V=A._createSuper(D);P=D.prototype;P.clear=function(){t.isSome(this._displayData)&&
(this._displayData.detach(),this._displayData=null,this.requestRender())};P.setTransform=function(G){var {displayData:L}=this;if(!t.isNone(L)){var U=[0,0];G.toScreen(U,[L.extent.xmin,L.extent.ymax]);L=(L.extent.xmax-L.extent.xmin)/L.size[0]/G.resolution;var X=K.deg2rad(G.rotation),{dvs:N}=this.transforms;C.fromTranslation(N,[-1,1,0]);C.scale(N,N,[2/(G.size[0]*G.pixelRatio),-2/(G.size[1]*G.pixelRatio),1]);C.translate(N,N,[U[0],U[1],0]);C.rotate(N,N,X);C.scale(N,N,[L*G.pixelRatio,L*G.pixelRatio,1])}};
P._createTransforms=function(){return{dvs:H.create()}};A._createClass(D,[{key:"displayData",get:function(){return this._displayData},set:function(G){this._displayData=G;this.requestRender()}}]);return D}(I.DisplayObject);u.FlowDisplayObject=I;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U,X,N,W,p){const m=t.ofType({key:"type",base:null,typeMap:{rect:N,path:p,geometry:W}});u.LayerView2DMixin=x=>{x=function(F){function a(){var e=d.apply(this,arguments);e.attached=!1;e.clips=new m;e.lastUpdateId=-1;e.moving=!1;e.updateRequested=!1;e.visibleAtCurrentScale=!1;e.highlightOptions=null;return e}A._inherits(a,F);var d=A._createSuper(a);F=a.prototype;F.initialize=function(){const e=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&e&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new H("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new U.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([I.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},I.syncAndInitial),
I.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=b)},I.syncAndInitial),I.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},I.syncAndInitial),I.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},I.syncAndInitial),I.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,I.syncAndInitial),I.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},I.syncAndInitial),I.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},I.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};F.destroy=function(){this.processDetach();this.updateRequested=!1};F.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};F.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};F.isVisibleAtScale=function(e){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;
const {minScale:c,maxScale:g}=b;return(0===c||e<=c)&&(0===g||e>=g)};F.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};F.processUpdate=function(e){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e)))};F.hitTest=function(e,b){return Promise.resolve(null)};F.supportsSpatialReference=function(e){return!0};
F.canResume=function(){return this.spatialReferenceSupported?A._get(A._getPrototypeOf(a.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};F.getSuspendInfo=function(){const e=A._get(A._getPrototypeOf(a.prototype),"getSuspendInfo",this).call(this),b=!this.spatialReferenceSupported,c=this.visibleAtCurrentScale;b&&(e.spatialReferenceNotSupported=b);c&&(e.outsideScaleRange=c);return e};F.addAttachHandles=function(e){this.addHandles(e,"attach")};A._createClass(a,[{key:"spatialReferenceSupported",
get:function(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return a}(x);K.__decorate([P.property()],x.prototype,"attached",void 0);K.__decorate([P.property({type:m,set(F){F=C.referenceSetter(F,this._get("clips"),m);this._set("clips",F)}})],x.prototype,"clips",void 0);K.__decorate([P.property()],
x.prototype,"container",void 0);K.__decorate([P.property()],x.prototype,"moving",void 0);K.__decorate([P.property({readOnly:!0})],x.prototype,"spatialReferenceSupported",null);K.__decorate([P.property({readOnly:!0})],x.prototype,"updateParameters",void 0);K.__decorate([P.property()],x.prototype,"updateRequested",void 0);K.__decorate([P.property()],x.prototype,"updating",null);K.__decorate([P.property()],x.prototype,"view",void 0);K.__decorate([P.property({readOnly:!0})],x.prototype,"visibleAtCurrentScale",
void 0);K.__decorate([P.property({type:X})],x.prototype,"highlightOptions",void 0);return x=K.__decorate([L.subclass("esri.views.2d.layers.LayerView2D")],x)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(u,A,K,t,C,H,I,P){var D;t=D=function(V){function G(U){U=L.call(this,U);U.type="rect";U.left=null;U.right=null;U.top=null;U.bottom=null;return U}u._inherits(G,V);var L=u._createSuper(G);V=G.prototype;V.clone=function(){return new D({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};V.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return u._createClass(G)}(P);A.__decorate([K.property({type:[Number,
String],json:{write:!0}})],t.prototype,"left",void 0);A.__decorate([K.property({type:[Number,String],json:{write:!0}})],t.prototype,"right",void 0);A.__decorate([K.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0);A.__decorate([K.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0);return t=D=A.__decorate([I.subclass("esri.views.layers.support.ClipRect")],t)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(u,A,K,t,C,H,I,P){K=function(D){function V(){return G.apply(this,arguments)}u._inherits(V,D);var G=u._createSuper(V);u._createClass(V,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return V}(K.JSONSupport);A.__decorate([t.property({readOnly:!0})],K.prototype,"version",null);return K=A.__decorate([P.subclass("esri.views.layers.support.ClipArea")],K)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U){var X;K={base:D,key:"type",typeMap:{extent:L,polygon:U}};G=X=function(N){function W(m){m=p.call(this,m);m.type="geometry";m.geometry=null;return m}u._inherits(W,N);var p=u._createSuper(W);N=W.prototype;N.clone=function(){return new X({geometry:this.geometry?.clone()??null})};N.commitVersionProperties=function(){this.commitProperty("geometry")};return u._createClass(W)}(G);A.__decorate([t.property({types:K,json:{read:V.fromJSON,write:!0}})],G.prototype,"geometry",
void 0);return G=X=A.__decorate([P.subclass("esri.views.layers.support.Geometry")],G)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(u,A,K,t,C,H,I,P){t=function(D){function V(L){L=G.call(this,L);L.type="path";
L.path=[];return L}u._inherits(V,D);var G=u._createSuper(V);V.prototype.commitVersionProperties=function(){this.commitProperty("path")};return u._createClass(V)}(P);A.__decorate([K.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0);return t=A.__decorate([I.subclass("esri.views.layers.support.Path")],t)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G){K=function(L){function U(){return X.apply(this,arguments)}u._inherits(U,L);var X=u._createSuper(U);L=U.prototype;L.doRender=function(N){N.drawPhase===D.WGLDrawPhase.HIGHLIGHT&&u._get(u._getPrototypeOf(U.prototype),"doRender",this).call(this,N)};L.renderChildren=function(N){this.attributeView.update();if(this.children.some(p=>p.hasData)){this.attributeView.bindTextures(N.context);u._get(u._getPrototypeOf(U.prototype),"renderChildren",this).call(this,N);var {painter:W}=
N;W=W.effects.highlight;W.bind(N);N.context.setColorMask(!0,!0,!0,!0);N.context.clear(G.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(N,W.defines.concat(["highlightAll"]));W.draw(N);W.unbind()}};return u._createClass(U)}(V);return K=A.__decorate([P.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],K)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U,X,N,W,p){t=function(m){function x(){var a=F.apply(this,arguments);a.attached=!1;a.container=new N.Container;a.updateRequested=!1;a.type="imagery";a._bitmapView=new X.BitmapContainer;return a}u._inherits(x,m);var F=u._createSuper(x);m=x.prototype;m.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};m.update=function(a){this.strategy.update(a).catch(d=>{I.isAbortError(d)||C.getLogger(this.declaredClass).error(d)})};m.hitTest=
function(a){return new K({attributes:{},geometry:a.clone(),layer:this.layer})};m.attach=function(){this.container.addChild(this._bitmapView);this.strategy=new p({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})};m.detach=function(){this.strategy.destroy();
this._bitmapView.removeAllChildren();this.container.removeAllChildren();this.updateRequested=!1};m.redraw=function(){this.strategy.updateExports(async a=>{const {source:d}=a;if(d&&!(d instanceof ImageBitmap)){var e=await this.layer.applyRenderer({extent:d.extent,pixelBlock:d.originalPixelBlock??d.pixelBlock});d.filter=b=>this.layer.pixelFilter?this.layer.applyFilter(b):{...e,extent:d.extent}}}).catch(a=>{I.isAbortError(a)||C.getLogger(this.declaredClass).error(a)})};m.requestUpdate=function(){this.updateRequested||
(this.updateRequested=!0,this.view.requestUpdate())};m.isUpdating=function(){return this.strategy.updating||this.updateRequested};m.getPixelData=function(){if(this.updating)return null;var a=this.strategy.bitmaps;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){const d=this.view.extent;a=a.map(e=>e.source).filter(e=>e.extent&&e.extent.intersects(d)).map(e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}));a=U.mosaicPixelData(a,
d);return H.isSome(a)?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null};m._fetchImage=async function(a,d,e,b){b=b||{};b.timeExtent=this.timeExtent;b.requestAsImageElement=!0;b.returnImageBitmap=!0;a=await this.layer.fetchImage(a,d,e,b);if(a.imageBitmap)return a.imageBitmap;b=await this.layer.applyRenderer(a.pixelData,{signal:b.signal});b=new W(b.pixelBlock,b.extent?.clone(),a.pixelData.pixelBlock);b.filter=c=>this.layer.applyFilter(c);return b};u._createClass(x,[{key:"updating",get:function(){return!this.attached||
this.isUpdating()}}]);return x}(t);A.__decorate([P.property()],t.prototype,"attached",void 0);A.__decorate([P.property()],t.prototype,"container",void 0);A.__decorate([P.property()],t.prototype,"layer",void 0);A.__decorate([P.property()],t.prototype,"strategy",void 0);A.__decorate([P.property()],t.prototype,"timeExtent",void 0);A.__decorate([P.property()],t.prototype,"view",void 0);A.__decorate([P.property()],t.prototype,"updateRequested",void 0);A.__decorate([P.property()],t.prototype,"updating",
null);A.__decorate([P.property()],t.prototype,"type",void 0);return t=A.__decorate([L.subclass("esri.views.2d.layers.imagery.ImageryView2D")],t)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../../../core/maybe","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(u,A,K,t){function C(a){return A.isSome(a)&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function H(a,d,e,b,c){const g=a.length;c=K.createEmptyBand(c,g);if(d)for(let h=
0;h<g;h++)d[h]&&(c[h]=e[a[h]-b]);else for(d=0;d<g;d++)c[d]=e[a[d]-b];return c}function I(a,d,e,b){const c=null!=e&&2<=e.length?new Set(e):null;e=1===e?.length?e[0]:null;const g=!!d?.length;for(let h=0;h<a.length;h++)if(b[h]){const k=a[h];if(g){let l=!1;for(let w=0;w<d.length;w+=2)if(k>=d[w]&&k<=d[w+1]){l=!0;break}l||(b[h]=0)}b[h]&&(k===e||c?.has(k))&&(b[h]=0)}}function P(a,d){const e=a[0].length;for(let b=0;b<e;b++)if(d[b]){let c=!1;for(let g=0;g<a.length;g++)if(a[g][b]){c=!0;break}c||(d[b]=0)}}function D(a,
d){const e=a[0].length;for(let b=0;b<e;b++)if(d[b]){let c=!1;for(let g=0;g<a.length;g++)if(0===a[g][b]){c=!0;break}c&&(d[b]=0)}}function V(a,d,e,b,c,g,h,k){return{xmin:c<=e*a?0:c<e*a+a?c-e*a:a,ymin:g<=b*d?0:g<b*d+d?g-b*d:d,xmax:c+h<=e*a?0:c+h<e*a+a?c+h-e*a:a,ymax:g+k<=b*d?0:g+k<b*d+d?g+k-b*d:d}}function G(a,d,e,b,c,g){const {width:h,height:k}=e.block,{x:l,y:w}=e.offset,{width:z,height:E}=e.mosaic;e=V(h,k,b,c,l,w,z,E);let y=0;var B=0;if(g){var Q=g.hasGCSSShiftTransform?360:g.halfWorldWidth??0,S=h*
g.resolutionX;const T=g.startX+b*S;T<Q&&T+S>Q?B=g.rightPadding:T>=Q&&(y=g.leftMargin-g.rightPadding,B=0)}e.xmax-=B;if("number"===typeof d)for(g=e.ymin;g<e.ymax;g++)for(B=(c*k+g-w)*z+(b*h-l)+y,Q=e.xmin;Q<e.xmax;Q++)a[B+Q]=d;else for(g=e.ymin;g<e.ymax;g++)for(B=(c*k+g-w)*z+(b*h-l)+y,Q=g*h,S=e.xmin;S<e.xmax;S++)a[B+S]=d[Q+S]}function L(a,d,e={}){const {clipOffset:b,clipSize:c,alignmentInfo:g,blockWidths:h}=e;if(h)return U(a,d,{blockWidths:h});var k=a.find(Y=>C(Y));if(A.isNone(k))return null;e=c?c.width:
d.width;const l=c?c.height:d.height;var w=k.width,z=k.height;const E=d.width/w,y=d.height/z;d={offset:b||{x:0,y:0},mosaic:c||d,block:{width:w,height:z}};w=k.pixelType;z=K.getPixelArrayConstructor(w);var B=k.pixels.length;k=[];for(var Q=0;Q<B;Q++){var S=new z(e*l);for(let Y=0;Y<y;Y++)for(let f=0;f<E;f++){var T=a[Y*E+f];C(T)&&(T=T.pixels[Q],G(S,T,d,f,Y,g))}k.push(S)}let ba;if(a.some(Y=>A.isNone(Y)||A.isSome(Y.mask)&&0<Y.mask.length))for(ba=new Uint8Array(e*l),z=0;z<y;z++)for(B=0;B<E;B++)S=a[z*E+B],
Q=A.isSome(S)?S.mask:null,A.isSome(Q)?G(ba,Q,d,B,z,g):S?G(ba,1,d,B,z,g):G(ba,0,d,B,z,g);a=new K({width:e,height:l,pixels:k,pixelType:w,mask:ba});a.updateStatistics();return a}function U(a,d,e){const b=a.find(B=>A.isSome(B));if(A.isNone(b))return null;var c=a.some(B=>A.isSome(B)?!!B.mask:!0);const {width:g,height:h}=d;d=c?new Uint8Array(g*h):null;({blockWidths:e}=e);const k=[],l=b.getPlaneCount(),w=K.getPixelArrayConstructor(b.pixelType);if(c)for(let B=0,Q=0;B<a.length;Q+=e[B],B++)if(c=a[B],C(c)){var z=
A.unwrap(c.mask);for(var E=0;E<h;E++)for(var y=0;y<e[B];y++)d[E*g+y+Q]=null==z?255:z[E*c.width+y]}for(c=0;c<l;c++){z=new w(g*h);for(let B=0,Q=0;B<a.length;Q+=e[B],B++)if(E=a[B],C(E)&&(y=E.pixels[c],null!=y))for(let S=0;S<h;S++)for(let T=0;T<e[B];T++)z[S*g+T+Q]=y[S*E.width+T];k.push(z)}a=new K({width:g,height:h,mask:d,pixels:k,pixelType:b.pixelType});a.updateStatistics();return a}function X(a){if(!C(a))return null;const d=a.clone(),{width:e,height:b,pixels:c}=a;var g=c[0];const h=d.pixels[0];a=A.unwrap(a.mask);
for(let w=2;w<b-1;w++){const z=new Map;for(var k=w-2;k<w+2;k++)for(var l=0;4>l;l++){const E=k*e+l;p(z,g[E],a?a[E]:1)}h[w*e]=N(z);h[w*e+1]=h[w*e+2]=h[w*e];for(k=3;k<e-1;k++)l=(w-2)*e+k+1,p(z,g[l],a?a[l]:1),l=(w-1)*e+k+1,p(z,g[l],a?a[l]:1),l=w*e+k+1,p(z,g[l],a?a[l]:1),l=(w+1)*e+k+1,p(z,g[l],a?a[l]:1),l=(w-2)*e+k-3,W(z,g[l],a?a[l]:1),l=(w-1)*e+k-3,W(z,g[l],a?a[l]:1),l=w*e+k-3,W(z,g[l],a?a[l]:1),l=(w+1)*e+k-3,W(z,g[l],a?a[l]:1),h[w*e+k]=N(z);h[w*e+k+1]=h[w*e+k]}for(g=0;g<e;g++)h[g]=h[e+g]=h[2*e+g],h[(b-
1)*e+g]=h[(b-2)*e+g];d.updateStatistics();return d}function N(a){if(0===a.size)return 0;let d=0,e=-1,b=0;const c=a.keys();let g=c.next();for(;!g.done;)b=a.get(g.value),b>d&&(e=g.value,d=b),g=c.next();return e}function W(a,d,e){0!==e&&(e=a.get(d),1===e?a.delete(d):a.set(d,e-1))}function p(a,d,e){0!==e&&a.set(d,a.has(d)?a.get(d)+1:1)}function m(a,d,e){let {x:b,y:c}=d;const {width:g,height:h}=e;if(0===b&&0===c&&h===a.height&&g===a.width)return a;const {width:k,height:l}=a;d=Math.max(0,c);const w=Math.max(0,
b),z=Math.min(b+g,k),E=Math.min(c+h,l);if(0>z||0>E||!C(a))return null;b=Math.max(0,-b);c=Math.max(0,-c);var {pixels:y}=a,B=g*h,Q=y.length;const S=[];for(var T=0;T<Q;T++){var ba=y[T],Y=K.createEmptyBand(a.pixelType,B);for(let f=d;f<E;f++){const n=f*k;let q=(f+c-d)*g+b;for(let r=w;r<z;r++)Y[q++]=ba[n+r]}S.push(Y)}y=new Uint8Array(B);B=A.unwrap(a.mask);for(Q=d;Q<E;Q++)for(T=Q*k,ba=(Q+c-d)*g+b,Y=w;Y<z;Y++)y[ba++]=B?B[T+Y]:1;a=new K({width:e.width,height:e.height,pixelType:a.pixelType,pixels:S,mask:y});
a.updateStatistics();return a}function x(a,d=!0){if(!C(a))return null;const {pixels:e,width:b,height:c,mask:g,pixelType:h}=a;a=[];const k=Math.round(b/2),l=Math.round(c/2),w=c-1,z=b-1;for(var E=0;E<e.length;E++){var y=e[E],B=K.createEmptyBand(h,k*l),Q=0;for(var S=0;S<c;S+=2)for(var T=0;T<b;T+=2){var ba=y[S*b+T];if(d){var Y=T===z?ba:y[S*b+T+1];const f=S===w?ba:y[S*b+T+b],n=T===z?f:S===w?Y:y[S*b+T+b+1];B[Q++]=(ba+Y+f+n)/4}else B[Q++]=ba}a.push(B)}E=null;if(A.isSome(g))for(E=new Uint8Array(k*l),y=0,
B=0;B<c;B+=2)for(Q=0;Q<b;Q+=2)S=g[B*b+Q],d?(T=Q===z?S:g[B*b+Q+1],ba=B===w?S:g[B*b+Q+b],Y=Q===z?ba:B===w?T:g[B*b+Q+b+1],E[y++]=S*T*ba*Y?1:0):E[y++]=S;return new K({width:k,height:l,pixelType:h,pixels:a,mask:E})}function F(a,d,e,b,c=0){const {width:g,height:h}=a,{width:k,height:l}=d;a=b.cols;b=b.rows;d=Math.ceil(k/a-.1/a);const w=Math.ceil(l/b-.1/b);let z,E,y,B,Q;const S=d*a;var T=S*w*b;const ba=new Float32Array(T),Y=new Float32Array(T),f=new Uint32Array(T),n=new Uint32Array(T);let q=0,r,M;for(let R=
0;R<w;R++)for(let J=0;J<d;J++){var v=12*(R*d+J);T=e[v];z=e[v+1];E=e[v+2];y=e[v+3];B=e[v+4];Q=e[v+5];for(var O=0;O<b;O++){q=(R*b+O)*S+J*a;M=(O+.5)/b;for(let Z=0;Z<O;Z++)r=(Z+.5)/a,ba[q+Z]=(T*r+z*M+E)*g+c,Y[q+Z]=(y*r+B*M+Q)*h+c,f[q+Z]=Math.floor(ba[q+Z]),n[q+Z]=Math.floor(Y[q+Z])}v+=6;T=e[v];z=e[v+1];E=e[v+2];y=e[v+3];B=e[v+4];Q=e[v+5];for(v=0;v<b;v++)for(q=(R*b+v)*S+J*a,M=(v+.5)/b,O=v;O<a;O++)r=(O+.5)/a,ba[q+O]=(T*r+z*M+E)*g+c,Y[q+O]=(y*r+B*M+Q)*h+c,f[q+O]=Math.floor(ba[q+O]),n[q+O]=Math.floor(Y[q+
O])}return{offsets_x:ba,offsets_y:Y,offsets_xi:f,offsets_yi:n,gridWidth:S}}u.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(u.NoDataInterpretation||(u.NoDataInterpretation={}));u.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(u.MissingBandAction||(u.MissingBandAction={}));u.MAX_MAP_SIZE_GPU=6;u.approximateTransform=function(a,d,e,b,c="nearest"){if(!C(a))return null;"majority"===c&&(a=X(a));const {pixels:g,mask:h,
pixelType:k}=a,l=a.width;var w=a.height;const z=K.getPixelArrayConstructor(k),E=g.length,{width:y,height:B}=d;a=!1;for(let n=0;n<e.length;n+=3)-1===e[n]&&-1===e[n+1]&&-1===e[n+2]&&(a=!0);const {offsets_x:Q,offsets_y:S,offsets_xi:T,offsets_yi:ba,gridWidth:Y}=F({width:l,height:w},d,e,b,"majority"===c?.5:0);let f;d=(n,q,r)=>{const M=n instanceof Float32Array||n instanceof Float64Array?0:.5;for(let v=0;v<B;v++){f=v*Y;for(let O=0;O<y;O++){if(0>Q[f]||0>S[f])n[v*y+O]=0;else if(r)n[v*y+O]=q[T[f]+ba[f]*l];
else{const R=Math.floor(Q[f]),J=Math.floor(S[f]),Z=Math.ceil(Q[f]),aa=Math.ceil(S[f]),ca=Q[f]-R,ea=S[f]-J;n[v*y+O]=!h||h[R+J*l]&&h[Z+J*l]&&h[R+aa*l]&&h[Z+aa*l]?(1-ea)*((1-ca)*q[R+J*l]+ca*q[Z+J*l])+ea*((1-ca)*q[R+aa*l]+ca*q[Z+aa*l])+M:q[T[f]+ba[f]*l]}f++}}};e=[];for(w=0;w<E;w++)b=new z(y*B),d(b,g[w],"nearest"===c||"majority"===c),e.push(b);c=new K({width:y,height:B,pixelType:k,pixels:e});if(A.isSome(h))c.mask=new Uint8Array(y*B),d(c.mask,h,!0);else if(a)for(c.mask=new Uint8Array(y*B),a=0;a<y*B;a++)c.mask[a]=
0>Q[a]||0>S[a]?0:1;c.updateStatistics();return c};u.clip=m;u.colorize=function(a,d){if(!C(a)||!d||!d.indexedColormap&&!d.indexed2DColormap)return a;const e=a.clone();var b=e.pixels;let c=e.mask;const g=e.width*e.height;if(1!==b.length)return a;const {indexedColormap:h,indexed2DColormap:k,offset:l,alphaSpecified:w}=d;a=0;b=b[0];d=new Uint8Array(b.length);const z=new Uint8Array(b.length),E=new Uint8Array(b.length);var y=0;if(h){const B=h.length-1;if(A.isSome(c))for(a=0;a<g;a++)c[a]&&(y=4*(b[a]-l),y<
l||y>B?c[a]=0:(d[a]=h[y],z[a]=h[y+1],E[a]=h[y+2],c[a]=h[y+3]));else{c=new Uint8Array(g);for(a=0;a<g;a++)y=4*(b[a]-l),y<l||y>B?c[a]=0:(d[a]=h[y],z[a]=h[y+1],E[a]=h[y+2],c[a]=h[y+3]);e.mask=c}}else if(k)if(A.isSome(c))for(a=0;a<g;a++)c[a]&&(y=k[b[a]],d[a]=y[0],z[a]=y[1],E[a]=y[2],c[a]=y[3]);else{c=new Uint8Array(g);for(a=0;a<g;a++)y=k[b[a]],d[a]=y[0],z[a]=y[1],E[a]=y[2],c[a]=y[3];e.mask=c}e.pixels=[d,z,E];e.statistics=null;e.pixelType="u8";e.maskIsAlpha=w;return e};u.compositeBands=function(a){if(!a?.length||
a.some(l=>!C(l)))return null;if(1===a.length)return A.isSome(a[0])?a[0].clone():null;const {width:d,height:e,pixelType:b}=a[0];if(a.some(l=>l.width!==d||l.height!==e))return null;const c=a.map(({mask:l})=>l).filter(l=>null!=l);let g=null;c.length&&(g=new Uint8Array(d*e),g.set(c[0]),1<c.length&&D(c.slice(1),g));const h=[];a.forEach(({pixels:l})=>h.push(...l));const k=[];a.map(({statistics:l})=>l).filter(l=>l?.length).forEach(l=>k.push(...l));return new K({pixelType:b,width:d,height:e,mask:g,pixels:h,
statistics:k.length?k:null})};u.createColormapLUT=function(a){if(a){var d=a.colormap;if(d&&0!==d.length){d=d.sort((w,z)=>w[0]-z[0]);var e=0;0>d[0][0]&&(e=d[0][0]);var b=Math.max(256,d[d.length-1][0]-e+1),c=new Uint8Array(4*b),g=[],h=0,k=0,l=5===d[0].length;if(65536<b)return d.forEach(w=>{g[w[0]-e]=l?w.slice(1):w.slice(1).concat([255])}),{indexed2DColormap:g,offset:e,alphaSpecified:l};if(a.fillUnspecified)for(a=d[k],h=a[0]-e;h<b;h++)c[4*h]=a[1],c[4*h+1]=a[2],c[4*h+2]=a[3],c[4*h+3]=l?a[4]:255,h===a[0]-
e&&(a=k===d.length-1?a:d[++k]);else for(h=0;h<d.length;h++)a=d[h],k=4*(a[0]-e),c[k]=a[1],c[k+1]=a[2],c[k+2]=a[3],c[k+3]=l?a[4]:255;return{indexedColormap:c,offset:e,alphaSpecified:l}}}};u.createMaskLUT=function(a,d,e){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var b=a.includes("16")?65536:256;a=a.includes("s")?-b/2:0;b=new Uint8Array(b);if(d)for(let g=0;g<d.length;g++){var c=Math.ceil(d[2*g]-a);const h=Math.floor(d[2*g+1]-a);for(;c<=h;c++)b[c]=255}else b.fill(255);if(e)for(d=0;d<e.length;d++)b[e[d]-
a]=0;return{lut:b,offset:a}};u.createRemapLUT=function(a){const {srcPixelType:d,inputRanges:e,outputValues:b,allowUnmatched:c,noDataRanges:g,isLastInputRangeInclusive:h,outputPixelType:k}=a;if("u8"!==d&&"s8"!==d&&"u16"!==d&&"s16"!==d)return null;var l=d.includes("16")?65536:256;a=d.includes("s")?-l/2:0;const w=K.createEmptyBand(k,l);l=new Uint8Array(l);c&&l.fill(255);const [z,E]=t.getPixelValueRange(k);if(e?.length&&b?.length){var y=e.map(T=>T-1E-6);y[0]=e[0];h&&(y[y.length-1]=e[e.length-1]);for(var B=
0;B<y.length;B++){var Q=b[B]>E?E:b[B]<z?z:b[B],S=Math.ceil(y[2*B]-a);const T=Math.floor(y[2*B+1]-a);for(;S<=T;S++)w[S]=Q,l[S]=255}}if(g?.length)for(y=0;y<g.length;y++)for(Q=Math.ceil(g[2*y]-a),B=Math.floor(g[2*y+1]-a);Q<=B;Q++)l[Q]=0;return{lut:w,offset:a,mask:l}};u.extractBands=function(a,d){if(!d?.length||!C(a))return a;const e=a.pixels.length;return d&&d.some(b=>b>=e)||1===e&&1===d.length&&0===d[0]||e===d.length&&!d.some((b,c)=>b!==c)?a:new K({pixelType:a.pixelType,width:a.width,height:a.height,
mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:d.map(b=>a.pixels[b]),statistics:a.statistics&&d.map(b=>a.statistics[b])})};u.getClipBounds=V;u.getLocalArithmeticNorthRotations=function(a,d){const {coefficients:e,spacing:b}=d,{offsets_x:c,offsets_y:g,gridWidth:h}=F(a,a,e,{rows:b[0],cols:b[1]}),{width:k,height:l}=a;a=new Float32Array(k*l);d=180/Math.PI;for(let E=0;E<l;E++)for(let y=0;y<k;y++){var w=E*h+y,z=0===E?w:w-h;const B=E===l-1?w:w+h;w=c[z]-c[B];z=g[B]-g[z];isNaN(w)||
isNaN(z)?a[E*k+y]=90:(z=Math.atan2(z,w)*d,z=(360+z)%360,a[E*k+y]=z)}return a};u.interpolateOffsets=F;u.isValidPixelBlock=C;u.lookupBandValues=H;u.lookupPixels=function(a,d){if(!C(a))return null;const {pixels:e,mask:b}=a,c=e.length;let g=d.lut;const {offset:h}=d;g&&1===g[0].length&&(g=e.map(()=>g));const k=[];d=d.outputPixelType||"u8";for(let l=0;l<c;l++){const w=H(e[l],b,g[l],h||0,d);k.push(w)}a=new K({width:a.width,height:a.height,pixels:k,mask:b,pixelType:d});a.updateStatistics();return a};u.mask=
function(a,d){if(!C(a))return null;const {width:e,height:b,pixels:c}=a;var g=e*b;const h=new Uint8Array(g);a.mask?h.set(a.mask):h.fill(255);a=c.length;const {includedRanges:k,noDataValues:l,outputPixelType:w,matchAll:z,lookups:E}=d;if(E){g=[];for(d=0;d<a;d++){var y=E[d];y=H(c[d],h,y.lut,y.offset||0,"u8");g.push(y)}1===g.length?h.set(g[0]):z?P(g,h):D(g,h)}else if(z){d=[];for(y=0;y<a;y++){const B=new Uint8Array(g);B.set(h);I(c[y],k?.slice(2*y,2*y+2),l?.[y],B);d.push(B)}1===d.length?h.set(d[0]):P(d,
h)}else for(g=0;g<a;g++)I(c[g],k?.slice(2*g,2*g+2),l?.[g],h);return new K({width:e,height:b,pixelType:w,pixels:c,mask:h})};u.mosaic=L;u.mosaicPixelData=function(a,d){if(!a||0===a.length)return null;var e=a.find(E=>E.pixelBlock);if(!e||A.isNone(e.pixelBlock))return null;var b=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width;const c=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,g=.01*Math.min(b,c),h=a.sort((E,y)=>Math.abs(E.extent.ymax-y.extent.ymax)>g?y.extent.ymax-E.extent.ymax:Math.abs(E.extent.xmin-
y.extent.xmin)>g?E.extent.xmin-y.extent.xmin:0);var k=Math.min.apply(null,h.map(E=>E.extent.xmin));const l=Math.min.apply(null,h.map(E=>E.extent.ymin)),w=Math.max.apply(null,h.map(E=>E.extent.xmax)),z=Math.max.apply(null,h.map(E=>E.extent.ymax));a={x:Math.round((d.xmin-k)/b),y:Math.round((z-d.ymax)/c)};k={width:Math.round((w-k)/b),height:Math.round((z-l)/c)};b={width:Math.round((d.xmax-d.xmin)/b),height:Math.round((d.ymax-d.ymin)/c)};if(Math.round(k.width/e.pixelBlock.width)*Math.round(k.height/e.pixelBlock.height)!==
h.length||0>a.x||0>a.y||k.width<b.width||k.height<b.height)return null;e=h.map(E=>E.pixelBlock);e=L(e,k,{clipOffset:a,clipSize:b});return{extent:d,pixelBlock:e}};u.remap=function(a,d){if(!C(a))return null;const {width:e,height:b}=a,{inputRanges:c,outputValues:g,outputPixelType:h,noDataRanges:k,allowUnmatched:l,isLastInputRangeInclusive:w}=d;d=a.pixels[0];const z=K.createEmptyBand(h,d.length),E=a.mask,y=new Uint8Array(e*b);E?y.set(E):y.fill(255);const B=a.pixelType.startsWith("f")?1E-6:0;a=c.map(q=>
q-B);a[0]=c[0];a[a.length-1]=c[c.length-1]+(w?1E-6:0);var Q=c.length/2;const [S,T]=t.getPixelValueRange(h);for(var ba=0;ba<b;ba++)for(var Y=0;Y<e;Y++){var f=ba*e+Y;if(y[f]){var n=d[f];let q=!1;for(let r=Q-1;0<=r;r--)if(n===a[2*r]||n>a[2*r]&&n<a[2*r+1]){z[f]=g[r];q=!0;break}q||(l?z[f]=n>T?T:n<S?S:n:y[f]=0)}}if(a=k?.length)for(Q=0;Q<b;Q++)for(ba=0;ba<e;ba++)if(Y=Q*e+ba,!E||E[Y])for(f=d[Y],n=0;n<a;n+=2)if(f>=k[n]&&f<=k[n+1]){z[Y]=0;y[Y]=0;break}return new K({width:e,height:b,pixelType:h,pixels:[z],mask:y})};
u.remapColor=function(a,d){if(!C(a))return null;a=a.clone();var {pixels:e}=a;const b=a.width*a.height,c=d.length,g=Math.floor(c/2),h=d[Math.floor(g)];e=e[0];let k,l,w,z,E,y,B=!1;const Q=new Uint8Array(b),S=new Uint8Array(b),T=new Uint8Array(b);let ba=a.mask;const Y=4===d[0].mappedColor.length;ba||(ba=new Uint8Array(b),ba.fill(Y?255:1),a.mask=ba);for(E=0;E<b;E++)if(ba[E]){k=e[E];B=!1;y=g;l=h;w=0;for(z=c-1;1<z-w;){if(k===l.value){B=!0;break}k>l.value?w=y:z=y;y=Math.floor((w+z)/2);l=d[Math.floor(y)]}B||
(k===d[w].value?(l=d[w],B=!0):k===d[z].value?(l=d[z],B=!0):k<d[w].value?(B=!1,l=null):k>d[w].value&&(k<d[z].value?(l=d[w],B=!0):z===c-1?(B=!1,l=null):(l=d[z],B=!0)));B?(Q[E]=l.mappedColor[0],S[E]=l.mappedColor[1],T[E]=l.mappedColor[2],ba[E]=l.mappedColor[3]):Q[E]=S[E]=T[E]=ba[E]=0}a.pixels=[Q,S,T];a.mask=ba;a.pixelType="u8";a.maskIsAlpha=Y;return a};u.resampleByMajority=X;u.setValidBoundary=function(a,d,e){if(!C(a))return null;const {width:b,height:c}=a,g=d.x;d=d.y;const h=e.width+g;e=e.height+d;
if(0>g||0>d||h>b||e>c||0===g&&0===d&&h===b&&e===c)return a;a.mask||(a.mask=new Uint8Array(b*c));const k=a.mask;for(let l=0;l<c;l++){const w=l*b;for(let z=0;z<b;z++)k[w+z]=l<d||l>=e||z<g||z>=h?0:1}a.updateStatistics();return a};u.split=function(a,d,e){if(!C(a))return null;const {width:b,height:c}=d;let {width:g,height:h}=a;const k=new Map,l={x:0,y:0};e=null==e?1:1+e;for(let w=0;w<e;w++){const z=Math.ceil(g/b),E=Math.ceil(h/c);for(let y=0;y<E;y++){l.y=y*c;for(let B=0;B<z;B++){l.x=B*b;const Q=m(a,l,
d);k.set(`${w}/${y}/${B}`,Q)}}w<e-1&&(a=x(a));g=Math.round(g/2);h=Math.round(h/2)}return k};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L){var U;t=U=function(X){function N(p){p=W.call(this,p);p.width=null;p.height=null;p.pixelType="f32";p.validPixelCount=null;p.mask=null;p.maskIsAlpha=!1;p.premultiplyAlpha=!1;p.statistics=null;p.depthCount=1;return p}u._inherits(N,X);var W=u._createSuper(N);N.createEmptyBand=function(p,m){return new (U.getPixelArrayConstructor(p))(m)};N.getPixelArrayConstructor=function(p){let m;switch(p){case "u1":case "u2":case "u4":case "u8":m=Uint8Array;break;case "u16":m=Uint16Array;
break;case "u32":m=Uint32Array;break;case "s8":m=Int8Array;break;case "s16":m=Int16Array;break;case "s32":m=Int32Array;break;case "f32":m=Float32Array;break;case "f64":m=Float64Array;break;case "c64":case "c128":case "unknown":m=Float32Array}return m};X=N.prototype;X.castPixelType=function(p){if(!p)return"f32";p=p.toLowerCase();["u1","u2","u4"].includes(p)?p="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(p)||(p="f32");return p};X.getPlaneCount=function(){return this.pixels?.length};
X.addData=function(p){if(!p.pixels||p.pixels.length!==this.width*this.height)throw new K("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(p.pixels);this.statistics.push(p.statistics??new G.SimpleBandStatistics)};X.getAsRGBA=function(){const p=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(p);
break;default:this._fillFrom8Bit(p)}return new Uint8ClampedArray(p)};X.getAsRGBAFloat=function(){const p=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(p);return p};X.updateStatistics=function(){if(this.pixels){this.statistics=this.pixels.map(x=>this._calculateBandStatistics(x,this.mask));var p=this.mask,m=0;if(I.isSome(p))for(let x=0;x<p.length;x++)p[x]&&m++;else m=this.width*this.height;this.validPixelCount=m}};X.clamp=function(p){if(p&&"f64"!==p&&"f32"!==p&&this.pixels){var [m,
x]=L.getPixelValueRange(p),F=this.pixels,a=this.width*this.height,d=F.length,e=[];for(let h=0;h<d;h++){var b=U.createEmptyBand(p,a);var c=F[h];for(let k=0;k<a;k++){var g=c[k];b[k]=g>x?x:g<m?m:g}e.push(b)}this.pixels=e;this.pixelType=p}};X.extractBands=function(p){const {pixels:m,statistics:x}=this;if(I.isNone(p)||0===p.length||!m||0===m.length)return this;var F=m.length;const a=p.some(d=>d>=m.length);F=F===p.length&&!p.some((d,e)=>d!==e);return a||F?this:new U({pixelType:this.pixelType,width:this.width,
height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:p.map(d=>m[d]),statistics:x&&p.map(d=>x[d])})};X.clone=function(){const p=new U({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});I.isSome(this.mask)&&(p.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let m;const x=U.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){p.pixels=
[];const F=!!this.pixels[0].slice;for(m=0;m<this.pixels.length;m++)p.pixels[m]=F?this.pixels[m].slice(0,this.pixels[m].length):new x(this.pixels[m])}if(this.statistics)for(p.statistics=[],m=0;m<this.statistics.length;m++)p.statistics[m]=C.clone(this.statistics[m]);p.premultiplyAlpha=this.premultiplyAlpha;return p};X._fillFrom8Bit=function(p){const {mask:m,maskIsAlpha:x,premultiplyAlpha:F,pixels:a}=this;if(p&&a&&a.length){var d,e;var b=d=e=a[0];3<=a.length?(d=a[1],e=a[2]):2===a.length&&(d=a[1]);var c=
new Uint32Array(p),g=this.width*this.height;if(b.length!==g)H.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(I.isSome(m)&&m.length===g)if(x)for(p=0;p<g;p++){const h=m[p];if(h){const k=h/255;c[p]=F?h<<24|e[p]*k<<16|d[p]*k<<8|b[p]*k:h<<24|e[p]<<16|d[p]<<8|b[p]}}else for(p=0;p<g;p++)m[p]&&(c[p]=-16777216|e[p]<<16|d[p]<<8|b[p]);else for(p=0;p<g;p++)c[p]=-16777216|e[p]<<16|d[p]<<8|b[p]}else H.getLogger(this.declaredClass).error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};X._fillFromNon8Bit=function(p){const {pixels:m,mask:x,statistics:F}=this;if(p&&m&&m.length){var a=this.pixelType,d=1,e=0;d=1;if(F&&0<F.length){for(var b of F)null!=b.minValue&&(e=Math.min(e,b.minValue)),null!=b.maxValue&&null!=b.minValue&&(d=Math.max(d,b.maxValue-b.minValue));d=255/d}else d=255,"s8"===a?(e=-128,d=127):"u16"===a?d=65535:"s16"===a?(e=-32768,d=32767):"u32"===a?d=4294967295:"s32"===a?(e=-2147483648,d=2147483647):"f32"===a?
(e=-3.4*1E39,d=3.4*1E39):"f64"===a&&(e=-Number.MAX_VALUE,d=Number.MAX_VALUE),d=255/(d-e);p=new Uint32Array(p);a=this.width*this.height;var c,g,h;b=c=g=m[0];if(b.length!==a)return H.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=m.length)if(c=m[1],3<=m.length&&(g=m[2]),I.isSome(x)&&x.length===a)for(h=0;h<a;h++)x[h]&&(p[h]=-16777216|(g[h]-e)*d<<16|(c[h]-e)*d<<8|(b[h]-e)*d);else for(h=0;h<a;h++)p[h]=-16777216|(g[h]-e)*d<<16|(c[h]-e)*d<<
8|(b[h]-e)*d;else if(I.isSome(x)&&x.length===a)for(h=0;h<a;h++)c=(b[h]-e)*d,x[h]&&(p[h]=-16777216|c<<16|c<<8|c);else for(h=0;h<a;h++)c=(b[h]-e)*d,p[h]=-16777216|c<<16|c<<8|c}else H.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};X._fillFrom32Bit=function(p){const {pixels:m,mask:x}=this;if(!p||!m||!m.length)return H.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let F,
a,d,e;F=a=d=m[0];3<=m.length?(a=m[1],d=m[2]):2===m.length&&(a=m[1]);const b=this.width*this.height;if(F.length!==b)return H.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let c=0;if(I.isSome(x)&&x.length===b)for(e=0;e<b;e++)p[c++]=F[e],p[c++]=a[e],p[c++]=d[e],p[c++]=x[e]&1;else for(e=0;e<b;e++)p[c++]=F[e],p[c++]=a[e],p[c++]=d[e],p[c++]=1};X._calculateBandStatistics=function(p,m){let x=Infinity,F=-Infinity;const a=p.length;let d,e=0;
if(I.isSome(m))for(d=0;d<a;d++)m[d]&&(e=p[d],x=e<x?e:x,F=e>F?e:F);else for(d=0;d<a;d++)e=p[d],x=e<x?e:x,F=e>F?e:F;return new G.SimpleBandStatistics(x,F)};return u._createClass(N)}(t.JSONSupport);A.__decorate([P.property({json:{write:!0}})],t.prototype,"width",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"height",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"pixelType",void 0);A.__decorate([D.cast("pixelType")],t.prototype,"castPixelType",null);A.__decorate([P.property({json:{write:!0}})],
t.prototype,"validPixelCount",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"mask",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"maskIsAlpha",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"pixels",void 0);A.__decorate([P.property()],t.prototype,"premultiplyAlpha",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"statistics",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"depthCount",void 0);A.__decorate([P.property({json:{write:!0}})],
t.prototype,"noDataValues",void 0);A.__decorate([P.property({json:{write:!0}})],t.prototype,"bandMasks",void 0);return t=U=A.__decorate([V.subclass("esri.layers.support.PixelBlock")],t)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(u,A){A=A._createClass(function(K=null,t=null,C=null){this.minValue=K;this.maxValue=t;this.noDataValue=C});u.SimpleBandStatistics=A;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(u){function A(t){return K[t]??[-3.4028234663852886E38,3.4028234663852886E38]}const K={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};u.convertNoDataToMask=function(t,C,H){if(!(t.depthCount&&1<t.depthCount)){var {pixels:I,statistics:P,
pixelType:D}=t,V=I[0].length,G=t.bandMasks??[],L=t.mask??(new Uint8Array(V)).fill(255),U="f32"===D||"f64"===D,X=A(D),N=!1;for(let m=0;m<I.length;m++){const x="number"===typeof C?C:C[m];if(null==x)continue;var W=P?.[m].maxValue??X[1];if((P?.[m].minValue??X[0])>x+Number.EPSILON||W<x-Number.EPSILON)continue;W=G[m]||(new Uint8Array(V)).fill(255);const F=I[m];var p=H?.customFloatTolerance;if(U&&0!==p){p||(p=9.999999E37<=Math.abs(x)?2E-7*Math.abs(x):"f32"===D?2**-23:Number.EPSILON);for(let a=0;a<F.length;a++)W[a]&&
Math.abs(F[a]-x)<p&&(F[a]=0,W[a]=0,L[a]=0,N=!0)}else for(p=0;p<F.length;p++)W[p]&&F[p]===x&&(F[p]=0,W[p]=0,L[p]=0,N=!0);G[m]=W}N&&(t.bandMasks=G,t.mask=L);N&&"updateStatistics"in t&&t.updateStatistics()}};u.getPixelValueRange=A;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U,X,N,W){const p=V.create(),m=[0,0],x=new W(0,0,0,0);K=function(F){function a(e){var b=d.call(this,e);b._imagePromise=null;b.bitmaps=[];b.hidpi=!1;b.imageMaxWidth=2048;b.imageMaxHeight=2048;b.imageRotationSupported=!1;b.imageNormalizationSupported=!1;b.update=C.debounce(async(c,g)=>{C.throwIfAborted(g);if(c.stationary&&!b.destroyed){var h=c.state,k=G.getInfo(h.spatialReference);c=b.hidpi?c.pixelRatio:1;var l=b.imageNormalizationSupported&&h.worldScreenWidth&&h.worldScreenWidth<
h.size[0],w=b.imageMaxWidth??0,z=b.imageMaxHeight??0;l?(m[0]=h.worldScreenWidth,m[1]=h.size[1]):b.imageRotationSupported?(m[0]=h.size[0],m[1]=h.size[1]):U.getOuterSize(m,h);k=k&&(h.extent.xmin<k.valid[0]||h.extent.xmax>k.valid[1]);var E=!b.imageNormalizationSupported&&k,y=!(Math.floor(m[0]*c)>w||Math.floor(m[1]*c)>z)&&!E,B=b.imageRotationSupported?h.rotation:0;k=b.container.children.slice();y?(l=l?h.paddedViewState.center:h.center,b._imagePromise&&console.error("Image promise was not defined!"),b._imagePromise=
b._singleExport(h,m,l,h.resolution,B,c,g)):(l=Math.min(w,z),E&&(l=Math.min(h.worldScreenWidth,l)),b._imagePromise=b._tiledExport(h,l,c,g));try{const Q=await b._imagePromise??[];C.throwIfAborted(g);g=[];b._imagePromise=null;if(!b.destroyed){b.bitmaps=Q;for(const S of k)Q.includes(S)||g.push(S.fadeOut().then(()=>{S.remove();S.destroy()}));for(const S of Q)g.push(S.fadeIn());await Promise.all(g)}}catch(Q){b._imagePromise=null,C.throwIfAbortError(Q)}}},5E3);b.updateExports=C.debounce(async c=>{const g=
[];for(const h of b.container.children){if(!h.visible||!h.stage)return;g.push(c(h).then(()=>{h.invalidateTexture();h.requestRender()}))}b._imagePromise=C.eachAlways(g).then(()=>b._imagePromise=null);await b._imagePromise});return b}u._inherits(a,F);var d=u._createSuper(a);F=a.prototype;F.destroy=function(){this.bitmaps.forEach(e=>e.destroy());this.bitmaps=[]};F._export=async function(e,b,c,g,h,k){c=await this.fetchSource(e,Math.floor(b*h),Math.floor(c*h),{rotation:g,pixelRatio:h,signal:k});C.throwIfAborted(k);
const l=new X.Bitmap(null,{immutable:!0,requestRenderOnSourceChangedEnabled:!0});l.x=e.xmin;l.y=e.ymax;l.resolution=e.width/b;l.rotation=g;l.pixelRatio=h;l.opacity=0;this.container.addChild(l);await l.setSourceAsync(c,k);C.throwIfAborted(k);return l};F._singleExport=async function(e,b,c,g,h,k,l){U.getBBox(p,c,g,b);e=V.toExtent(p,e.spatialReference);return[await this._export(e,b[0],b[1],h,k,l)]};F._tiledExport=function(e,b,c,g){var h=L.create({size:b,spatialReference:e.spatialReference,scales:[e.scale]});
const k=new N(h);h=k.getTileCoverage(e);if(!h)return null;const l=[];h.forEach((w,z,E,y)=>{x.set(w,z,E,0);k.getTileBounds(p,x);const B=V.toExtent(p,e.spatialReference);l.push(this._export(B,b,b,0,c,g).then(Q=>{0!==y&&(x.set(w,z,E,y),k.getTileBounds(p,x),Q.x=p[0],Q.y=p[3]);return Q}))});return Promise.all(l)};u._createClass(a,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return a}(K);A.__decorate([H.property()],K.prototype,"_imagePromise",void 0);A.__decorate([H.property()],
K.prototype,"bitmaps",void 0);A.__decorate([H.property()],K.prototype,"container",void 0);A.__decorate([H.property()],K.prototype,"fetchSource",void 0);A.__decorate([H.property()],K.prototype,"hidpi",void 0);A.__decorate([H.property()],K.prototype,"imageMaxWidth",void 0);A.__decorate([H.property()],K.prototype,"imageMaxHeight",void 0);A.__decorate([H.property()],K.prototype,"imageRotationSupported",void 0);A.__decorate([H.property()],K.prototype,"imageNormalizationSupported",void 0);A.__decorate([H.property()],
K.prototype,"requestUpdate",void 0);A.__decorate([H.property()],K.prototype,"updating",null);return K=A.__decorate([D.subclass("esri.views.2d.layers.support.ExportStrategy")],K)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(u){const A=Math.PI/180;u.getBBox=function(K,t,C,H){const [I,P]=t,[D,V]=H;t=.5*C;K[0]=I-t*D;K[1]=P-t*V;K[2]=I+t*D;K[3]=P+t*V;return K};u.getOuterSize=function(K,t){var C=t.rotation*A;const H=Math.abs(Math.cos(C));C=Math.abs(Math.sin(C));const [I,P]=t.size;
K[0]=Math.round(P*C+I*H);K[1]=Math.round(P*H+I*C);return K};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U,X,N,W,p){C=function(m){function x(){var a=F.apply(this,arguments);a.attached=!1;a.container=new W.RasterVFContainer;a.type="imageryVF";a._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};a._fetchpixels=async(d,e,b,c)=>{const g=await a._projectFullExtentPromise,{symbolTileSize:h}=a.layer.renderer,{extent:k,width:l,height:w}=N.snapImageToSymbolTile(d,e,b,h,g);if(H.isSome(g)&&!g.intersects(d))return{extent:k,pixelBlock:null};d={bbox:`${k.xmin}, ${k.ymin}, ${k.xmax}, ${k.ymax}`,
exportParametersVersion:a.layer.exportImageServiceParameters.version,symbolTileSize:h,time:JSON.stringify(a.timeExtent||"")};if(a._canReuseVectorFieldData(d)&&(e=a.getPixelData(),H.isSome(e)&&`${e.extent.xmin}, ${e.extent.ymin}, ${e.extent.xmax}, ${e.extent.ymax}`===d.bbox))return e;({pixelData:c}=await a.layer.fetchImage(k,l,w,{timeExtent:a.timeExtent,requestAsImageElement:!1,signal:c}));a._dataParameters=d;c=c?.pixelBlock;if(H.isNone(c))return{extent:k,pixelBlock:null};c="vector-uv"===a.layer.rasterInfo.dataType?
H.unwrap(N.convertVectorFieldData(c,"vector-uv")):c;return{extent:k,pixelBlock:c}};return a}u._inherits(x,m);var F=u._createSuper(x);m=x.prototype;m.attach=function(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new p({container:this.container,fetchPixels:this._fetchpixels});this.handles.add(I.watch(()=>this.layer.renderer,a=>this._updateSymbolizerParams(a),I.syncAndInitial),"attach")};m.detach=function(){this._strategy.destroy();this.container.children.forEach(a=>
a.destroy());this.container.removeAllChildren();this.handles.remove("attach");this._strategy=this.container=this._projectFullExtentPromise=null};m.getPixelData=function(){const a=this.container.children[0]?.rawPixelData;if(this.updating||!a)return null;const {extent:d,pixelBlock:e}=a;return{extent:d,pixelBlock:e}};m.hitTest=function(a){return new K({attributes:{},geometry:a.clone(),layer:this.layer})};m.update=function(a){this._strategy.update(a,this._symbolizerParams)};m.redraw=function(){const {renderer:a}=
this.layer;a&&(this._updateSymbolizerParams(a),this._strategy.redraw(this._symbolizerParams))};m._canReuseVectorFieldData=function(a){const d=this._dataParameters.time===a.time,e=this._dataParameters.symbolTileSize===a.symbolTileSize,b=this._dataParameters.bbox===a.bbox;return this._dataParameters.exportParametersVersion===a.exportParametersVersion&&d&&e&&b};m._getProjectedFullExtent=async function(a){try{return await X.projectExtent(this.layer.fullExtent,a)}catch(d){try{const e=(await t(this.layer.url,
{query:{option:"footprints",outSR:a.wkid||JSON.stringify(a.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return e?U.fromJSON(e):null}catch{return null}}};m._updateSymbolizerParams=function(a){"vector-field"===a.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))};u._createClass(x,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return x}(C.HandleOwner);A.__decorate([P.property()],C.prototype,
"attached",void 0);A.__decorate([P.property()],C.prototype,"container",void 0);A.__decorate([P.property()],C.prototype,"layer",void 0);A.__decorate([P.property()],C.prototype,"timeExtent",void 0);A.__decorate([P.property()],C.prototype,"type",void 0);A.__decorate([P.property()],C.prototype,"view",void 0);A.__decorate([P.property()],C.prototype,"updating",null);return C=A.__decorate([L.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],C)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G){function L(f,n,q){return!I.canProjectWithoutEngine(f,n,q)}function U(f,n,q){if((f=L(f,n,q))&&!I.isLoaded())throw new K("rasterprojectionhelper-project","projection engine is not loaded");return f}function X(f,n,q,r=null){const M=f.spatialReference;if(M.equals(n))return f;U(M,n,r);q=q.center;q=new P({xmin:q.x-f.x/2,xmax:q.x+f.x/2,ymin:q.y-f.y/2,ymax:q.y+f.y/2,spatialReference:M});r=I.project(q,n,r);q=l(n);t.isNone(r)||t.isSome(q)&&r.width>=q?(n=C.getMetersPerUnitForSR(M)/
C.getMetersPerUnitForSR(n),f={x:f.x*n,y:f.y*n}):f={x:r.width,y:r.height};return f}function N(f,n=.01){return C.getMetersPerUnitForSR(f)?n/C.getMetersPerUnitForSR(f):0}function W(f,n,q=null,r=!0){const M=f.spatialReference;if(M.equals(n))return f;U(M,n,q);q=I.project(f,n,q);if(!r||!q)return q;p([f],[q],M,n);return q}function p(f,n,q,r){const M=w(q,!0),v=w(r,!0);q=N(q,500);r=N(r,500);if(q&&t.isSome(M)&&t.isSome(v))for(let O=0;O<f.length;O++){const R=n[O];if(!R)continue;const {x:J}=f[O],{x:Z}=R;Z>=v[1]-
r&&Math.abs(J-M[0])<q?R.x-=v[1]-v[0]:Z<=v[0]+r&&Math.abs(J-M[1])<q&&(R.x+=v[1]-v[0])}}function m(f){const {inSR:n,outSR:q,datumTransformation:r,preferPE:M}=f;if(n.equals(q))return{points:f}=e(f,null),f;if(n.isWebMercator&&q.isWGS84||n.isWGS84&&q.isWebMercator){const {cols:Z,rows:aa,xres:ca,yres:ea,usePixelCenter:da,inSR:ia,outSR:fa}=f;let {xmin:ja,ymax:ha}=f;da&&(ja+=ca/2,ha-=ea/2);f=[];var v=[],O=Math.max(Z,aa);for(var R=0;R<O;R++){var J=I.project(new D({x:ja+ca*Math.min(Z,R),y:ha-ea*Math.min(aa,
R),spatialReference:ia}),fa);R<=Z&&f.push(J.x);R<=aa&&v.push(J.y)}O=[];for(R=0;R<Z;R++)for(J=0;J<aa;J++)O.push([f[R],v[J]]);return O}if(U(n,q,r)&&M){if(n.isGeographic)return F(f);v=a(n);if(t.isSome(v))return F(f)}return x(f)}function x(f){var {points:n}=e(f,null);const {inSR:q,outSR:r,datumTransformation:M}=f;f=n.map(v=>new D(v[0],v[1],q));n=I.project(f,r,M);M&&p(f,n,q,r);return n.map(v=>v?[v.x,v.y]:[NaN,NaN])}function F(f){const {inSR:n,outSR:q,datumTransformation:r}=f;var M=a(n);const {points:v,
mask:O}=e(f,M);n.isGeographic||(f=n.wkid?H.PeFactory.coordsys(n.wkid):H.PeFactory.fromString(n.isGeographic?H.PeDefs.PE_TYPE_GEOGCS:H.PeDefs.PE_TYPE_PROJCS,n.wkt),H.PeCSTransformations.projToGeog(f,v.length,v));if(t.isSome(r)&&r.steps.length){var R;q.isGeographic&&(R=v.map(([J])=>179.9955<J?1:-179.9955>J?-1:0));r.steps.forEach(J=>{const Z=J.wkid?H.PeFactory.geogtran(J.wkid):H.PeFactory.fromString(H.PeDefs.PE_TYPE_GEOGTRAN,J.wkt);H.PeGTTransformations.geogToGeog(Z,v.length,v,null,J.isInverse?H.PeDefs.PE_TRANSFORM_2_TO_1:
H.PeDefs.PE_TRANSFORM_1_TO_2)});if(R)for(f=0;f<v.length;f++){M=R[f];const J=v[f][0],Z=179.9955<J?1:-179.9955>J?-1:0;M&&Z&&M!==Z&&(v[f][0]=0<M?J+360:J-360)}}q.isGeographic||(R=a(q,!0),R=t.isSome(R)&&R.isEnvelope?[R.bbox[1],R.bbox[3]]:[-90,90],b(v,R),R=q.wkid?H.PeFactory.coordsys(q.wkid):H.PeFactory.fromString(q.isGeographic?H.PeDefs.PE_TYPE_GEOGCS:H.PeDefs.PE_TYPE_PROJCS,q.wkt),H.PeCSTransformations.geogToProj(R,v.length,v));R=v;if(O&&v.length!==O.length){R=[];for(let J=0,Z=0;J<O.length;J++)O[J]?R.push(v[Z++]):
R.push([NaN,NaN])}return R}function a(f,n=!1){var q=f.wkid||f.wkt;if(!q||f.isGeographic)return null;q=String(q);if(ba.has(q))return q=ba.get(q),n?q?.gcs:q?.pcs;var r=f.wkid?H.PeFactory.coordsys(f.wkid):H.PeFactory.fromString(f.isGeographic?H.PeDefs.PE_TYPE_GEOGCS:H.PeDefs.PE_TYPE_PROJCS,f.wkt);f=N(f,1E-4);f=d(r,f);r=d(r,0,!0);ba.set(q,{pcs:f,gcs:r});return n?r:f}function d(f,n=0,q=!1){var r=H.PePCSInfo.generate(f),M=q?f.horizonGcsGenerate():f.horizonPcsGenerate();if(!r||!M?.length)return null;f=!1;
var v=M.find(aa=>1===aa.getInclusive()&&1===aa.getKind());if(!v){v=M.find(aa=>1===aa.getInclusive()&&0===aa.getKind());if(!v)return null;f=!0}q=q?0:(2===r.getNorthPoleLocation()?1:0)|(2===r.getSouthPoleLocation()?2:0);r=r.isPannableRectangle();v=v.getCoord();if(f)return{isEnvelope:f,isPannable:r,vertices:v,coef:null,bbox:[v[0][0]-n,v[0][1]-n,v[1][0]+n,v[1][1]+n],poleLocation:q};n=0;f=[];let [O,R]=v[0],[J,Z]=v[0];for(let aa=0,ca=v.length;aa<ca;aa++){n++;n===ca&&(n=0);const [ea,da]=v[aa],[ia,fa]=v[n];
if(fa===da)f.push([ea,ia,da,fa,2]);else{M=(ia-ea)/(fa-da||1E-4);const ja=ea-M*da;da<fa?f.push([M,ja,da,fa,0]):f.push([M,ja,fa,da,1])}O=O<ea?O:ea;R=R<da?R:da;J=J>ea?J:ea;Z=Z>da?Z:da}return{isEnvelope:!1,isPannable:r,vertices:v,coef:f,bbox:[O,R,J,Z],poleLocation:q}}function e(f,n){const q=[],{cols:r,rows:M,xres:v,yres:O,usePixelCenter:R}=f;let {xmin:J,ymax:Z}=f;R&&(J+=v/2,Z-=O/2);if(t.isNone(n)){for(f=0;f<r;f++)for(n=0;n<M;n++)q.push([J+v*f,Z-O*n]);return{points:q}}f=new Uint8Array(r*M);if(n.isEnvelope){const {bbox:[ja,
ha,la,na]}=n;for(let oa=0,pa=0;oa<r;oa++){var aa=J+v*oa,ca=n.isPannable||aa>=ja&&aa<=la;for(var ea=0;ea<M;ea++,pa++){var da=Z-O*ea;ca&&da>=ha&&da<=na&&(q.push([aa,da]),f[pa]=1)}}return{points:q,mask:f}}aa=n.coef;n=[];for(ca=0;ca<M;ca++){var ia=Z-O*ca;ea=[];da=[];for(var fa=0;fa<aa.length;fa++){const [ja,ha,la,na,oa]=aa[fa];ia===la&&la===na?(ea.push(ja),ea.push(ha),da.push(2),da.push(2)):ia>=la&&ia<=na&&(ea.push(ja*ia+ha),da.push(oa))}ia=ea;if(2<ea.length){fa=2===da[0]?0:da[0];let ja=ea[0];ia=[];for(let ha=
1;ha<da.length;ha++)if(2!==da[ha]||ha===da.length-1)da[ha]!==fa&&(ia.push(0===fa?Math.min(ja,ea[ha-1]):Math.max(ja,ea[ha-1])),fa=da[ha],ja=ea[ha]),ha===da.length-1&&ia.push(0===da[ha]?Math.min(ja,ea[ha]):Math.max(ja,ea[ha]));ia.sort((ha,la)=>ha-la)}else ea[0]>ea[1]&&(ia=[ea[1],ea[0]]);n.push(ia)}for(let ja=0,ha=0;ja<r;ja++)for(aa=J+v*ja,ca=0;ca<M;ca++,ha++)if(ea=Z-O*ca,da=n[ca],2===da.length)aa>=da[0]&&aa<=da[1]&&(q.push([aa,ea]),f[ha]=1);else if(2<da.length){ia=!1;for(fa=0;fa<da.length;fa+=2)if(aa>=
da[fa]&&aa<=da[fa+1]){ia=!0;break}ia&&(q.push([aa,ea]),f[ha]=1)}return{points:q,mask:f}}function b(f,n){const [q,r]=n;for(n=0;n<f.length;n++){const M=f[n][1];if(M<q||M>r)f[n]=[NaN,NaN]}}function c(f){const n=l(f[0].spatialReference);if(2>f.length||t.isNone(n))return f[0];const q=N(f[0].spatialReference);f=f.filter(R=>R.width>q);if(1===f.length)return f[0];let {xmin:r,xmax:M,ymin:v,ymax:O}=f[0];for(let R=1;R<f.length;R++){const J=f[R];M=J.xmax+n*R;v=Math.min(v,J.ymin);O=Math.max(O,J.ymax)}return new P({xmin:r,
xmax:M,ymin:v,ymax:O,spatialReference:f[0].spatialReference})}function g(f,n,q=null,r=!0){var M=f.spatialReference;if(M.equals(n))return f;var v=E(f);const O=l(M,!0);var R=l(n);if(0===v||t.isNone(O)||t.isNone(R))return v=k(f,n,q,r),t.isNone(O)&&t.isSome(R)&&Math.abs(v.width-R)<N(n)&&I.isLoaded()&&(M=a(M),t.isSome(M)&&M.poleLocation===Q.None&&f.width<(M.bbox[2]-M.bbox[0])/2)?h(f,n)||v:v;R=f.clone().normalize();if(1===R.length&&f.xmax<O&&f.xmax-O/2>N(M)){const {xmin:J,xmax:Z}=f;for(let aa=0;aa<=v;aa++)R[aa]=
new P({xmin:0===aa?J:-O/2,xmax:aa===v?Z-O*aa:O/2,ymin:f.ymin,ymax:f.ymax,spatialReference:M})}f=R.map(J=>k(J,n,q,r));return c(f.filter(t.isSome))}function h(f,n){const q=l(n);if(t.isNone(q))return null;let {xmin:r,ymin:M,xmax:v,ymax:O}=f;var R=f.spatialReference;f=new V({spatialReference:R,rings:[[[r,M],[v,M],[v,O],[r,O],[r,M]]]});f=I.project(f,n);if(2!==f.rings.length||!f.rings[0].length||!f.rings[1].length)return null;({rings:f}=f);R=N(R);n=new P({spatialReference:n});for(let J=0;2>J;J++){r=v=f[J][0][0];
M=O=f[J][0][1];for(let Z=0;Z<f[J].length;Z++)r=r>f[J][Z][0]?f[J][Z][0]:r,v=v<f[J][Z][0]?f[J][Z][0]:v,M=M>f[J][Z][1]?f[J][Z][1]:M,O=O<f[J][Z][1]?f[J][Z][1]:O;if(0===J)n.ymin=M,n.ymax=O,n.xmin=r,n.xmax=v;else if(n.ymin=Math.min(n.ymin,M),n.ymax=Math.max(n.ymax,O),Math.abs(v-q/2)<R)n.xmin=r,n.xmax+=q;else if(Math.abs(r+q/2)<R)n.xmax=v+q;else return null}return n}function k(f,n,q=null,r=!0,M=!0){const v=f.spatialReference;if(v.equals(n)||!n)return f;U(v,n,q);const O=I.project(f,n,q);if(M&&n.isWebMercator&&
O&&(O.ymax=Math.min(2.0037508342787E7,O.ymax),O.ymin=Math.max(-2.0037508342787E7,O.ymin),O.ymin>=O.ymax))return null;if(!r||!O)return O;var R=w(v,!0);r=w(n,!0);if(t.isNone(R)||t.isNone(r))return O;M=N(v,.001);const J=N(v,500);var Z=N(n,.001);if(Math.abs(O.xmin-r[0])<Z&&Math.abs(O.xmax-r[1])<Z){Z=Math.abs(f.xmin-R[0]);R=Math.abs(R[1]-f.xmax);if(Z<M&&R>J){O.xmin=r[0];var aa=[];aa.push(new D(f.xmax,f.ymin,v));aa.push(new D(f.xmax,(f.ymin+f.ymax)/2,v));aa.push(new D(f.xmax,f.ymax,v));aa=aa.map(ca=>W(ca,
n,q)).filter(ca=>!isNaN(ca?.x)).map(ca=>ca.x);O.xmax=Math.max.apply(null,aa)}R<M&&Z>J&&(O.xmax=r[1],r=[],r.push(new D(f.xmin,f.ymin,v)),r.push(new D(f.xmin,(f.ymin+f.ymax)/2,v)),r.push(new D(f.xmin,f.ymax,v)),f=r.map(ca=>W(ca,n,q)).filter(ca=>!isNaN(ca?.x)).map(ca=>ca.x),O.xmin=Math.min.apply(null,f))}else f=N(n,.001),Math.abs(O.xmin-r[0])<f&&(O.xmin=r[0]),Math.abs(O.xmax-r[1])<f&&(O.xmax=r[1]);return O}function l(f,n=!1){return f?f.isWebMercator?2*(n?2.0037508342787E7:2.0037508342788905E7):f.wkid&&
f.isGeographic?360:2*T[f.wkid]||null:null}function w(f,n=!1){if(f.isGeographic)return[-180,180];f=l(f,n);return t.isSome(f)?[-f/2,f/2]:null}function z(f,n,q,r){f=(f-n)/q;0!==f-Math.floor(f)?f=Math.floor(f):r&&--f;return f}function E(f,n=!1){var q=l(f.spatialReference);if(t.isNone(q))return 0;const r=n?0:-(q/2),M=N(f.spatialReference),v=!n&&Math.abs(f.xmin+q/2)<M?-q/2:f.xmin;f=z(!n&&Math.abs(f.xmax-q/2)<M?q/2:f.xmax,r,q,!0);q=z(v,r,q,!1);return f-q}function y(f){const {projectedExtent:n,srcBufferExtent:q,
pixelSize:r,datumTransformation:M,rasterTransform:v}=f;var O=n.spatialReference;const R=q.spatialReference;var J=U(O,R);const {xmin:Z,ymin:aa,xmax:ca,ymax:ea}=n,da=l(R),ia=t.isSome(da)&&(f.hasWrapAround||"gcs-shift"===v?.type);f=f.spacing||[32,32];var fa=f[0]*r.x,ja=f[1]*r.y;const ha=1===f[0],la=Math.ceil((ca-Z)/fa-.1/f[0])+(ha?0:1),na=Math.ceil((ea-aa)/ja-.1/f[1])+(ha?0:1);fa=m({cols:la,rows:na,xmin:Z,ymax:ea,xres:fa,yres:ja,inSR:O,outSR:R,datumTransformation:M,preferPE:4>=f[0],usePixelCenter:ha});
ja=[];let oa,pa=0;const ma=ha?-1:NaN,{xmin:ta,xmax:qa,ymax:ua,width:va,height:wa}=q,xa=N(R,500),ya=t.isSome(da)&&0<ta&&qa>da/2;var ra=!1;J&&(ra=a(O),ra=t.isSome(ra)&&0<ra.poleLocation);for(O=0;O<la;O++){J=[];for(let sa=0;sa<na;sa++){var ka=fa[O*na+sa];ia&&ka[0]>qa&&ka[0]>da/2-xa?ka[0]-=da:ia&&0===O&&0>ka[0]&&ya&&!v&&(ka[0]+=da);!ka||isNaN(ka[0])||isNaN(ka[1])?(ja.push(ma),ja.push(ma),J.push(null),pa++):(v&&(ka=v.inverseTransform(new D({x:ka[0],y:ka[1],spatialReference:R})),ka=[ka.x,ka.y]),J.push(ka),
0<O&&ia&&oa[sa]&&ka[0]<oa[sa][0]&&(ka[0]+=da,ra&&ka[0]>qa&&ka[0]>da&&(ka[0]-=da)),ja.push((ka[0]-ta)/va),ja.push((ua-ka[1])/wa))}oa=J}return{offsets:ja,error:null,coefficients:null,outofBoundPointCount:pa,spacing:f,size:ha?[la,na]:[la-1,na-1]}}function B(f,n,q){const {cols:r,rows:M}=n;n=new Float32Array((r-1)*(M-1)*12);const v=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),O=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ea=0;ea<r-1;ea++){for(var R=0;R<M-1;R++){var J=ea*M*2+2*R,Z=f[J];const da=f[J+
1];var aa=f[J+2],ca=f[J+3];J+=2*M;const ia=f[J],fa=f[J+1],ja=f[J+2];J=f[J+3];let ha=0,la=12*(R*(r-1)+ea);for(let na=0;3>na;na++)n[la++]=v[ha++]*Z+v[ha++]*aa+v[ha++]*ja;ha=0;for(aa=0;3>aa;aa++)n[la++]=v[ha++]*da+v[ha++]*ca+v[ha++]*J;ha=0;for(ca=0;3>ca;ca++)n[la++]=O[ha++]*Z+O[ha++]*ia+O[ha++]*ja;ha=0;for(Z=0;3>Z;Z++)n[la++]=O[ha++]*da+O[ha++]*fa+O[ha++]*J}if(q)for(R=0;R<n.length;R++)isNaN(n[R])&&(n[R]=-1)}return n}var Q;(function(f){f[f.None=0]="None";f[f.North=1]="North";f[f.South=2]="South";f[f.Both=
3]="Both"})(Q||(Q={}));const S=(f,n,q,r=0)=>{if(1===q[0])return[0,0];var M=1,v=-1,O=1,R=-1;for(var J=0;J<f.length;J+=2)isNaN(f[J])||(M=M>f[J]?f[J]:M,v=v>f[J]?v:f[J],O=O>f[J+1]?f[J+1]:O,R=R>f[J+1]?R:f[J+1]);const {cols:Z,rows:aa}=n;n=(v-M)/Z/q[0];q=(R-O)/aa/q[1];r*=2;O=0;R=!1;M=[0,0];for(v=0;v<Z-3;v++){for(J=0;J<aa-3;J++){var ca=v*aa*2+2*J;const ea=Math.abs(((f[ca]+f[ca+4]+f[ca+4*aa]+f[ca+4*aa+4])/4-f[ca+2*aa+2])/n);ca=Math.abs(((f[ca+1]+f[ca+5]+f[ca+4*aa+1]+f[ca+4*aa+5])/4-f[ca+2*aa+3])/q);ea+ca>
O&&(O=ea+ca,M=[ea,ca]);if(r&&O>r){R=!0;break}}if(R)break}return M},T={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,
54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},ba=new Map,Y=new Map;u.computeProjectedScales=function(f,n,q=512,r=!0){const {extent:M,spatialReference:v,pixelSize:O}=f,R=X(new D({x:O.x,y:O.y,spatialReference:v}),n,M);if(null==R)return{projectedPixelSize:null,
scales:null,srcResolutions:null,isCustomTilingScheme:!1};const J=(R.x+R.y)/2,Z=C.getMetersPerUnitForSR(n);var aa=J*Z*96*39.37,ca=n.isGeographic?256/q*2.958287637958547E8:256/q*5.91657527591555E8,ea="vector-magdir"===f.dataType||"vector-uv"===f.dataType,da=g(M,n),ia=Math.min(Math.ceil(Math.log(Math.min(f.width,f.height)/32)/Math.LN2),Math.ceil(Math.log(ca/2/aa)/Math.LN2));!ea&&r&&(n.isGeographic||n.isWebMercator)&&(ea=0>da.xmin*da.xmax,!ea&&3>ia&&(r=l(n),t.isSome(r)&&(ea=2**ia*J*q,q=Math.ceil(r/ea),
ea=1===q||2===q&&r/2-da.xmax<ea)));r=aa;f=Math.min(2,Math.max(1.414,f.storageInfo?.pyramidScalingFactor||2));if(ea)r=ca,ca=n.isGeographic?1.341104507446289E-6:.29858214164761665,ia=96*ca*Z*39.37,n=X(new D({x:ca,y:ca,spatialReference:{wkid:n.isGeographic?4326:3857}}),v,da),n.x*=r/ia,n.y*=r/ia;else{n={x:O.x,y:O.y};for(da=0;r<.5005*ca&&da<ia;)da++,r*=f,n.x*=f,n.y*=f;1.001>=Math.max(r,ca)/Math.min(r,ca)&&(r=ca)}ca=[r];da=[{x:n.x,y:n.y}];for(aa=Math.min(70.5310735,aa)/1.001;r>=aa;)r/=f,n.x/=f,n.y/=f,ca.push(r),
da.push({x:n.x,y:n.y});return{projectedPixelSize:R,scales:ca,srcResolutions:da,isCustomTilingScheme:!ea}};u.defaultGridSpacing=32;u.defaultProjectionToleranceInPixels=4;u.getDefaultDatumTransformationForDataset=function(f,n,q){return U(f.spatialReference,n)?q?I.getTransformation(n,f.spatialReference,f):I.getTransformation(f.spatialReference,n,f):null};u.getProjectedGridPoints=m;u.getProjectionOffsetGrid=function(f){var n=f.isAdaptive&&null==f.spacing;let q=f.spacing||[32,32],r=y(f);var M={cols:r.size[0]+
1,rows:r.size[1]+1};const v=0<r.outofBoundPointCount&&r.outofBoundPointCount<r.offsets.length/2;let O=r.outofBoundPointCount===r.offsets.length/2||n&&v?[0,0]:S(r.offsets,M,q,4);const R=(O[0]+O[1])/2;var J=f.projectedExtent.spatialReference;const Z=f.srcBufferExtent.spatialReference;n&&(v||4<R)&&(L(J,Z,f.datumTransformation)&&(J.isGeographic||t.isSome(a(J))),q=[4,4],r=y({...f,spacing:q}),M={cols:r.size[0]+1,rows:r.size[1]+1},O=S(r.offsets,M,q,4));r.error=O;1<q[0]&&(r.coefficients=B(r.offsets,M,v));
!f.includeGCSGrid||J.isGeographic||J.isWebMercator||(Z.isGeographic?r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:q}:(n=a(J),t.isSome(n)&&!n.isEnvelope&&(J&&!J.isGeographic&&(n=String(J.wkid||J.wkt),Y.has(n)?J=Y.get(n):(J=(J.wkid?H.PeFactory.coordsys(J.wkid):H.PeFactory.fromString(H.PeDefs.PE_TYPE_PROJCS,J.wkt)).getGeogcs().getCode(),Y.set(n,J)),J=new G({wkid:J})),J=g(f.projectedExtent,J),{offsets:f}=y({...f,srcBufferExtent:J,spacing:q}),M=B(f,M,v),r.gcsGrid={offsets:f,coefficients:M,
spacing:q})));return r};u.getRasterDatasetAlignmentInfo=function(f){const n=f.storageInfo.origin.x;var q=l(f.spatialReference,!0);if(t.isNone(q))return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const r=q/2,{nativePixelSize:M,storageInfo:v,extent:O}=f,{maximumPyramidLevel:R,blockWidth:J,pyramidScalingFactor:Z}=v;let aa=M.x;const ca=[];f=t.isSome(f.transform)&&"gcs-shift"===f.transform.type;const ea=n+(f?0:r);q=f?q-n:r-n;for(let da=0;da<=R;da++){const ia=(O.xmax-n)/aa/J,fa=q/aa/J;ca.push({resolutionX:aa,
blockWidth:J,datsetColumnCount:0===ia-Math.floor(ia)?ia:Math.ceil(ia),worldColumnCountFromOrigin:0===fa-Math.floor(fa)?fa:Math.ceil(fa),leftMargin:Math.round(ea/aa)%J,rightPadding:(J-Math.round(q/aa)%J)%J,originColumnOffset:Math.floor(ea/aa/J)});aa*=Z}return{originX:n,halfWorldWidth:r,pyramidsInfo:ca,hasGCSSShiftTransform:f}};u.getWorldWidth=l;u.getWorldWrapCount=E;u.load=async function(){I.isLoaded()||await I.load()};u.minimumGridSpacing=4;u.projectExtent=g;u.projectPoint=W;u.projectResolution=X;
u.requirePE=L;u.snapExtent=function(f){f=f.clone().normalize();return 1===f.length?f[0]:c(f)};u.snapPyramid=function(f,n,q){const {storageInfo:r,pixelSize:M}=n;var v=0;let O=!1;var {pyramidResolutions:R}=r;if(t.isSome(R)&&R.length){f=(f.x+f.y)/2;var J=R[R.length-1];J=(J.x+J.y)/2;var Z=(M.x+M.y)/2;if(f<=Z)v=0;else if(f>=J)v=R.length,O=8<f/J;else{J=Z;for(let aa=1;aa<=R.length;aa++){Z=(R[aa-1].x+R[aa-1].y)/2;if(f<=Z){f===Z?v=aa:"down"===q?(v=aa-1,O=8<f/J):v="up"===q?aa:f-J>Z-f||2<f/J?aa:aa-1;break}J=
Z}}q=0===v?M:R[v-1];O&&(R=Math.min(q.x,q.y),f=C.getMetersPerUnitForSR(n.spatialReference),19567<R*f&&(O=!1));return{pyramidLevel:v,pyramidResolution:new D({x:q.x,y:q.y,spatialReference:n.spatialReference}),excessiveReading:O}}v=Math.log(f.x/M.x)/Math.LN2;f=Math.log(f.y/M.y)/Math.LN2;R=n.storageInfo.maximumPyramidLevel||0;v="down"===q?Math.floor(Math.min(v,f)):"up"===q?Math.ceil(Math.max(v,f)):Math.round((v+f)/2);0>v?v=0:v>R&&(O=v>R+3,v=R);q=2**v;n=new D({x:q*n.nativePixelSize.x,y:q*n.nativePixelSize.y,
spatialReference:n.spatialReference});return{pyramidLevel:v,pyramidResolution:n,excessiveReading:O}};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(u,A,K,t,C){function H(c,g){return p.get(c)/p.get(g)||1}function I(c,g="geographic"){const [h,k]=c;c=Math.sqrt(h*h+k*k);let l=Math.atan2(k,h)*m;l=(360+l)%360;"geographic"===
g&&(l=(450-l)%360);return[c,l]}function P(c,g="geographic"){let h=c[1];"geographic"===g&&(h=(450-h)%360);h%=360;c=c[0];return[c*Math.cos(h/m),c*Math.sin(h/m)]}function D(c,g,h="geographic",k=1){if(!C.isValidPixelBlock(c))return c;const {pixels:l,width:w,height:z}=c;var E=w*z;const y=l[0],B=l[1],Q=c.pixelType.startsWith("f")?c.pixelType:"f32",S=t.createEmptyBand(Q,E);E=t.createEmptyBand(Q,E);let T=0;for(let ba=0;ba<z;ba++)for(let Y=0;Y<w;Y++)"vector-uv"===g?([S[T],E[T]]=I([y[T],B[T]],h),S[T]*=k):([S[T],
E[T]]=P([y[T],B[T]],h),S[T]*=k,E[T]*=k),T++;c=new t({pixelType:Q,width:c.width,height:c.height,mask:c.mask,validPixelCount:c.validPixelCount,maskIsAlpha:c.maskIsAlpha,pixels:[S,E]});c.updateStatistics();return c}function V(c=0,g=0,h=Math.PI,k=!0){k&&(h=(2*Math.PI-h)%(2*Math.PI));k=k?-1:1;const l=-7*k,w=-2*k,z=-16*k,[E,y]=L(0,g+13*k,h,21.75),[B,Q]=L(c-5.5,g+l,h,21.75),[S,T]=L(c+5.5,g+l,h,21.75),[ba,Y]=L(c-1.5,g+w,h,21.75),[f,n]=L(c+1.5,g+w,h,21.75),[q,r]=L(c-1.5,g+z,h,21.75),[M,v]=L(c+1.5,g+z,h,21.75);
return[E,y,B,Q,ba,Y,f,n,S,T,q,r,M,v]}function G(c=0,g=Math.PI,h=!0){h&&(g=(2*Math.PI-g)%(2*Math.PI));var k=h?-1:1,l=5*k;const w=20*k,z=25*k;k*=2;const E=h?1:-1;h=5*E;let [y,B]=[0+h,0-w],[Q,S]=[y+2*E,B],[T,ba]=[Q-0*E,S+k],[Y,f]=[0-h,0-z],[n,q]=[Y+0*E,f-k],r=Math.ceil(c/5),M=Math.floor(r/10);r-=8*M;c=[];const v=[];for(let ia=0;ia<r/2;ia++,M--){0>=M&&1===r%2&&ia===(r-1)/2&&(Y=0,n=Y+0*E,f=(f+B)/2,q=f-k);const [fa,ja]=L(Y,f,g,45);if(0<M){const [ha,la]=L(Q,f,g,45),[na,oa]=L(y,B,g,45);c.push(ha);c.push(la);
c.push(fa);c.push(ja);c.push(na);c.push(oa)}else{const [ha,la]=L(Q,S,g,45),[na,oa]=L(T,ba,g,45),[pa,ma]=L(n,q,g,45);v.push(fa);v.push(ja);v.push(pa);v.push(ma);v.push(na);v.push(oa);v.push(ha);v.push(la)}f+=l;B+=l;S+=l;ba+=l;q+=l}const [O,R]=L(0+h,0+w,g,45);l=7*E;const [J,Z]=L(0+l,0+w,g,45),[aa,ca]=L(0+h,0-z,g,45),[ea,da]=L(0+l,0-z,g,45);return{pennants:c,barbs:v,shaft:[O,R,J,Z,aa,ca,ea,da]}}function L(c,g,h,k=1){return[Math.sqrt(c*c+g*g)/k,(2*Math.PI+(2*Math.PI+Math.atan2(g,c))%(2*Math.PI)-h)%(2*
Math.PI)]}function U(c,g,h,k){h=H(k||"knots",h);for(k=1;k<g.length;k++)if(k===g.length-1){if(c<g[k]*h)break}else if(c<=g[k]*h)break;return Math.min(k-1,g.length-2)}function X(c,g,h,k,l){let w=0;switch(g){case "beaufort_kn":w=U(c,a,"knots",h);break;case "beaufort_km":w=U(c,a,"kilometer-per-hour",h);break;case "beaufort_ft":w=U(c,a,"feet-per-second",h);break;case "beaufort_m":w=U(c,a,"meter-per-second",h);break;case "classified_arrow":w=U(c,l??[],k,h);break;case "ocean_current_m":w=U(c,d,"meter-per-second",
h);break;case "ocean_current_kn":w=U(c,e,"knots",h)}return w}function N(c,g){const {style:h,inputUnit:k,outputUnit:l,breakValues:w}=g,z=x.fromJSON(k),E=x.fromJSON(l);let y=0,B=0;const {width:Q,height:S,mask:T}=c,ba=c.pixels[0];c=c.pixels[1];var Y=K.isSome(T)?T.filter(q=>0<q).length:Q*S;const f=new Float32Array(42*Y);Y=new Uint32Array(15*Y);g=g.invertDirection?V(0,0,0,!1):F;for(let q=0;q<S;q++)for(let r=0;r<Q;r++){var n=q*Q+r;if(!T||T[q*Q+r]){const M=(c[n]+360)%360/180*Math.PI,v=X(ba[n],h,z,E,w);for(let O=
0;O<g.length;O+=2)f[y++]=(r+.5)/Q,f[y++]=(q+.5)/S,f[y++]=g[O],f[y++]=g[O+1]+M,f[y++]=v,f[y++]=ba[n];n=7*(y/42-1);Y[B++]=n;Y[B++]=n+1;Y[B++]=n+2;Y[B++]=n+0;Y[B++]=n+4;Y[B++]=n+3;Y[B++]=n+0;Y[B++]=n+2;Y[B++]=n+3;Y[B++]=n+2;Y[B++]=n+5;Y[B++]=n+3;Y[B++]=n+5;Y[B++]=n+6;Y[B++]=n+3}}return{vertexData:f,indexData:Y}}function W(c,g){let h=0,k=0;const {width:l,height:w,mask:z}=c;c=c.pixels[0];const E=[],y=[];var B=x.fromJSON(g.inputUnit);B=H(B,"knots");g="wind_speed"===g.style?5:Number.MAX_VALUE;for(let S=
0;S<w;S++)for(let T=0;T<l;T++){var Q=c[S*l+T]*B;if((!z||z[S*l+T])&&Q<g){for(let ba=0;4>ba;ba++)E[h++]=(T+.5)/l,E[h++]=(S+.5)/w,E[h++]=2>ba?-.5:.5,E[h++]=0===ba%2?-.5:.5,E[h++]=0,E[h++]=Q;Q=4*(h/24-1);y[k++]=Q;y[k++]=Q+1;y[k++]=Q+2;y[k++]=Q+1;y[k++]=Q+2;y[k++]=Q+3}}return{vertexData:new Float32Array(E),indexData:new Uint32Array(y)}}const p=new Map;p.set("meter-per-second",1);p.set("kilometer-per-hour",.277778);p.set("knots",.514444);p.set("feet-per-second",.3048);p.set("mile-per-hour",.44704);const m=
180/Math.PI,x=new A.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),F=V(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],d=[0,.5,1,1.5,2],e=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],b=[];u.convertToLocalDirections=function(c,g,h,k="geographic"){if(!C.isValidPixelBlock(c)||K.isNone(h))return c;c="vector-magdir"===g?c.clone():K.unwrap(D(c,g));const l=c.pixels[1];for(let w=0;w<l.length;w++)l[w]=
"geographic"===k?(l[w]+h[w]+270)%360:(l[w]+360-h[w])%360;return"vector-magdir"===g?c:D(c,"vector-magdir")};u.convertVectorFieldData=D;u.convertVectorFieldUnit=function(c,g,h=1){if(1===h||!C.isValidPixelBlock(c))return c;c=c.clone();const {pixels:k,width:l,height:w}=c,z=k[0],E=k[1];let y=0;for(let B=0;B<w;B++)for(let Q=0;Q<l;Q++)"vector-uv"===g?(z[y]*=h,E[y]*=h):z[y]*=h,y++;c.updateStatistics();return c};u.createVFMesh=function(c,g){if("simple_scalar"===g.style)g=W(c,g);else if("wind_speed"===g.style){if(0===
b.length)for(var h=0;30>h;h++)b.push(G(5*h,0,!g.invertDirection));g=x.fromJSON(g.inputUnit);g=H(g,"knots");const {width:z,height:E,mask:y}=c;h=c.pixels[0];c=c.pixels[1];const B=[],Q=[];let S=0,T=0;for(let ba=0;ba<E;ba++)for(let Y=0;Y<z;Y++){var k=ba*z+Y,l=h[k]*g;if((!y||y[ba*z+Y])&&5<=l){const f=(c[k]+360)%360/180*Math.PI,{pennants:n,barbs:q,shaft:r}=b[Math.min(Math.floor(l/5),29)];if(0===n.length+q.length)continue;k=B.length/6;const M=(Y+.5)/z,v=(ba+.5)/E;for(var w=0;w<n.length;w+=2)B[S++]=M,B[S++]=
v,B[S++]=n[w],B[S++]=n[w+1]+f,B[S++]=0,B[S++]=l;for(w=0;w<q.length;w+=2)B[S++]=M,B[S++]=v,B[S++]=q[w],B[S++]=q[w+1]+f,B[S++]=0,B[S++]=l;for(w=0;w<r.length;w+=2)B[S++]=M,B[S++]=v,B[S++]=r[w],B[S++]=r[w+1]+f,B[S++]=0,B[S++]=l;for(l=0;l<n.length/6;l++)Q[T++]=k,Q[T++]=k+1,Q[T++]=k+2,k+=3;for(l=0;l<q.length/8;l++)Q[T++]=k,Q[T++]=k+1,Q[T++]=k+2,Q[T++]=k+1,Q[T++]=k+2,Q[T++]=k+3,k+=4;Q[T++]=k+0;Q[T++]=k+1;Q[T++]=k+2;Q[T++]=k+1;Q[T++]=k+3;Q[T++]=k+2;k+=4}}g={vertexData:new Float32Array(B),indexData:new Uint32Array(Q)}}else g=
N(c,g);return g};u.createVFMeshScalar=W;u.getUnitConversionFactor=H;u.sampleVectorField=function(c,g,h,k=[0,0],l=.5){const {width:w,height:z,mask:E}=c,[y,B]=c.pixels,[Q,S]=k;c=Math.round((w-Q)/h);k=Math.round((z-S)/h);var T=c*k;const ba=new Float32Array(T),Y=new Float32Array(T);T=new Uint8Array(T);g="vector-uv"===g;for(let n=0;n<k;n++)for(let q=0;q<c;q++){let r=0;const M=n*c+q,v=Math.max(0,n*h+S),O=Math.max(0,q*h+Q),R=Math.min(z,v+h),J=Math.min(w,O+h);for(let Z=v;Z<R;Z++)for(let aa=O;aa<J;aa++){var f=
Z*w+aa;if(!E||E[f]){r++;f=g?[y[f],B[f]]:[y[f],(360+B[f])%360];const [ca,ea]=g?f:P(f);ba[M]+=ca;Y[M]+=ea}}if(r>=(R-v)*(J-O)*(1-l)){T[M]=1;const [Z,aa]=I([ba[M]/r,Y[M]/r]);ba[M]=Z;Y[M]=aa}else T[M]=0,ba[M]=0,Y[M]=0}h=new t({width:c,height:k,pixels:[ba,Y],mask:T});h.updateStatistics();return h};u.snapImageToSymbolTile=function(c,g,h,k,l){if(K.isNone(l)||!l.spatialReference.equals(c.spatialReference))return{extent:c,width:Math.round(g/k),height:Math.round(h/k),resolution:c.width/g};const w=l.xmin;l=l.ymax;
g=(c.xmax-c.xmin)/g*k;h=(c.ymax-c.ymin)/h*k;c.xmin=w+Math.floor((c.xmin-w)/g)*g;c.xmax=w+Math.ceil((c.xmax-w)/g)*g;c.ymin=l+Math.floor((c.ymin-l)/h)*h;c.ymax=l+Math.ceil((c.ymax-l)/h)*h;return{extent:c,width:Math.round(c.width/g),height:Math.round(c.height/h),resolution:(g+h)/2}};u.unitKebabDict=x;u.uvComponentToVector=I;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(u,A,K,t,C){C=function(H){function I(){var D=P.apply(this,arguments);D.symbolTypes=["triangle"];return D}A._inherits(I,H);var P=A._createSuper(I);H=I.prototype;H.prepareRenderPasses=function(D){const V=D.registerRenderPass({name:"imagery (vf)",brushes:[K],target:()=>this.children,drawPhase:t.WGLDrawPhase.MAP});return[...A._get(A._getPrototypeOf(I.prototype),"prepareRenderPasses",this).call(this,D),V]};H.doRender=function(D){this.visible&&
D.drawPhase===t.WGLDrawPhase.MAP&&this.symbolTypes.forEach(V=>{D.renderPass=V;A._get(A._getPrototypeOf(I.prototype),"doRender",this).call(this,D)})};A._createClass(I,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return I}(C);u.RasterVFContainer=C;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../webgl/brushes/WGLBrush","../../../webgl/enums"],
function(u,A,K,t){const C=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,
.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),H={beaufort_ft:C,beaufort_m:C,beaufort_km:C,beaufort_mi:C,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,
.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,
0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,
1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),single_arrow:new Float32Array([0,92/255,230/255,1]),wind_speed:new Float32Array([0,0,0,1])},I=[0,20];return function(P){function D(){var G=V.apply(this,arguments);G._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],
["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}};return G}u._inherits(D,P);var V=u._createSuper(D);P=D.prototype;P.dispose=function(){};P.prepareState=function({context:G}){G.setBlendingEnabled(!0);G.setBlendFunctionSeparate(t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA,t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA);G.setColorMask(!0,!0,!0,!0);G.setStencilWriteMask(0);G.setStencilTestEnabled(!0);G.setStencilOp(t.StencilOperation.KEEP,
t.StencilOperation.KEEP,t.StencilOperation.REPLACE)};P.draw=function(G,L){if(!A.isNone(L.source)&&0!==L.source.validPixelCount){var {context:U,timeline:X}=G;X.begin(this.name);U.setStencilFunction(t.CompareFunction.EQUAL,L.stencilRef,255);L.updateVectorFieldVAO(G);if("scalar"===G.renderPass){var N=L.vaoData.scalar;N&&this._drawScalars(G,L,N.vao,N.elementCount)}else(N=L.vaoData.magdir)&&this._drawTriangles(G,L,N.vao,N.elementCount);X.end(this.name)}};P._drawTriangles=function(G,L,U,X){const {context:N,
painter:W,requestRender:p,allowDelayedRender:m}=G,{symbolizerParameters:x}=L;var F=x.dataRange?["dataRange"]:[];"geographic"===x.rotationType&&F.push("rotationGeographic");F=W.materialManager.getProgram(this._desc.magdir,F);if(m&&A.isSome(p)&&!F.compiled)p();else{N.useProgram(F);var {coordScale:a,opacity:d,transforms:e}=L;F.setUniform2fv("u_coordScale",a);F.setUniform1f("u_opacity",d);F.setUniformMatrix3fv("u_dvsMat3",e.dvs);var {style:b,dataRange:c,rotation:g,symbolPercentRange:h}=x;F.setUniform4fv("u_colors",
H[b]||H.single_arrow);F.setUniform2fv("u_dataRange",c||I);F.setUniform1f("u_rotation",g);F.setUniform2fv("u_symbolPercentRange",h);G=this._getSymbolSize(G,L);F.setUniform2fv("u_symbolSize",G);N.bindVAO(U);N.drawElements(t.PrimitiveType.TRIANGLES,X,t.DataType.UNSIGNED_INT,0)}};P._drawScalars=function(G,L,U,X){const {context:N,painter:W,requestRender:p,allowDelayedRender:m}=G,{symbolizerParameters:x}=L;var F=[];"wind_speed"===x.style?F.push("innerCircle"):x.dataRange&&F.push("dataRange");"geographic"===
x.rotationType&&F.push("rotationGeographic");F=W.materialManager.getProgram(this._desc.scalar,F);if(m&&A.isSome(p)&&!F.compiled)p();else{N.useProgram(F);var {coordScale:a,opacity:d,transforms:e}=L;F.setUniform2fv("u_coordScale",a);F.setUniform1f("u_opacity",d);F.setUniformMatrix3fv("u_dvsMat3",e.dvs);var {dataRange:b,symbolPercentRange:c}=x;F.setUniform2fv("u_dataRange",b||I);F.setUniform2fv("u_symbolPercentRange",c);G=this._getSymbolSize(G,L);F.setUniform2fv("u_symbolSize",G);N.bindVAO(U);N.drawElements(t.PrimitiveType.TRIANGLES,
X,t.DataType.UNSIGNED_INT,0)}};P._getSymbolSize=function(G,L){G=L.key?2**(G.displayLevel-L.key.level):L.resolution/G.state.resolution;const {symbolTileSize:U}=L.symbolizerParameters;return[U/(Math.round((L.width-L.offset[0])/U)*U)/G,U/(Math.round((L.height-L.offset[1])/U)*U)/G]};return u._createClass(D)}(K)})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U){K=function(X){function N(p){var m=W.call(this,p);m._loading=null;m.update=H.debounce((x,F)=>m._update(x,F).catch(a=>{H.isAbortError(a)||t.getLogger(m.declaredClass).error(a)}));return m}u._inherits(N,X);var W=u._createSuper(N);X=N.prototype;X.redraw=function(p){if(this.container.children.length){var m=this.container.children[0];m.symbolizerParameters=p;m.invalidateVAO();this.container.symbolTypes="wind_speed"===p.style?["scalar","triangle"]:"simple_scalar"===p.style?
["scalar"]:["triangle"];this.container.requestRender()}};X._update=async function(p,m,x){if(p.stationary){var {extent:F,spatialReference:a}=p.state,d=new L({xmin:F.xmin,ymin:F.ymin,xmax:F.xmax,ymax:F.ymax,spatialReference:a}),[e,b]=p.state.size;this._loading=this.fetchPixels(d,e,b,x);x=await this._loading;this._addToDisplay(x,m,p.state);this._loading=null}};X._addToDisplay=function(p,m,x){if(C.isNone(p.pixelBlock))this.container.children.forEach(e=>e.destroy()),this.container.removeAllChildren();
else{var {extent:F,pixelBlock:a}=p,d=new U.RasterVFDisplayObject(a);d.offset=[0,0];d.symbolizerParameters=m;d.rawPixelData=p;d.invalidateVAO();d.x=F.xmin;d.y=F.ymax;d.pixelRatio=x.pixelRatio;d.rotation=x.rotation;d.resolution=x.resolution;d.width=a.width*m.symbolTileSize;d.height=a.height*m.symbolTileSize;this.container.children.forEach(e=>e.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===m.style?["scalar","triangle"]:"simple_scalar"===m.style?["scalar"]:["triangle"];
this.container.addChild(d)}};u._createClass(N,[{key:"updating",get:function(){return!!this._loading}}]);return N}(K);A.__decorate([I.property()],K.prototype,"fetchPixels",void 0);A.__decorate([I.property()],K.prototype,"container",void 0);A.__decorate([I.property()],K.prototype,"_loading",void 0);A.__decorate([I.property()],K.prototype,"updating",null);return K=A.__decorate([G.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],K)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U){K=function(X){function N(p=null){var m=W.call(this);m._source=null;m._symbolizerParameters=null;m._vaoInvalidated=!0;m.coordScale=[1,1];m.height=null;m.key=null;m.offset=null;m.stencilRef=0;m.resolution=null;m.pixelRatio=1;m.x=0;m.y=0;m.rotation=0;m.rawPixelData=null;m.vaoData=null;m.width=null;m.source=p;return m}A._inherits(N,X);var W=A._createSuper(N);X=N.prototype;X.destroy=function(){t.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),
this.vaoData=null)};X.invalidateVAO=function(){!this._vaoInvalidated&&t.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};X.updateVectorFieldVAO=function(p){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(t.isSome(this.source)&&t.isNone(this.vaoData)){var {style:m}=this.symbolizerParameters;switch(m){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":m=
P.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(p.context,m)};break;case "simple_scalar":m=P.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(p.context,m)};break;case "wind_speed":m=P.createVFMesh(this.source,this.symbolizerParameters);m=this._createVectorFieldVAO(p.context,m);const x=P.createVFMeshScalar(this.source,this.symbolizerParameters);p=this._createVectorFieldVAO(p.context,x);this.vaoData=
{magdir:m,scalar:p}}}this.ready();this.requestRender()}};X._createTransforms=function(){return{dvs:H.create()}};X.setTransform=function(p){const m=C.identity(this.transforms.dvs),[x,F]=p.toScreenNoRotation([0,0],[this.x,this.y]);var a=this.resolution/this.pixelRatio/p.resolution;const d=a*this.width;a*=this.height;const e=Math.PI*this.rotation/180;C.translate(m,m,I.fromValues(x,F));C.translate(m,m,I.fromValues(d/2,a/2));C.rotate(m,m,-e);C.translate(m,m,I.fromValues(-d/2,-a/2));C.scaleByVec2(m,m,I.fromValues(d,
a));C.multiply(this.transforms.dvs,p.displayViewMat3,m)};X.onAttach=function(){this.invalidateVAO()};X.onDetach=function(){this.invalidateVAO()};X._createVectorFieldVAO=function(p,m){const {vertexData:x,indexData:F}=m;m=G.BufferObject.createVertex(p,L.Usage.STATIC_DRAW,new Float32Array(x));const a=G.BufferObject.createIndex(p,L.Usage.STATIC_DRAW,new Uint32Array(F)),d=V.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:L.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:L.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:L.DataType.FLOAT,normalized:!1}]});return{vao:new U.VertexArrayObject(p,d.attributes,d.bufferLayouts,{geometry:m},a),elementCount:F.length}};A._createClass(N,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(p){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(p)&&(this._symbolizerParameters=p,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(p){this._source=p;this.invalidateVAO()}}]);return N}(D.DisplayObject);u.RasterVFDisplayObject=K;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(u,A,K,t,C,H,I,P,D,V,G,L,U){return X=>{X=function(N){function W(){var m=p.apply(this,arguments);m.view=null;return m}u._inherits(W,N);var p=u._createSuper(W);N=W.prototype;N.fetchPopupFeatures=async function(m,x){const {layer:F}=this;if(!m)throw new K("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:F});var {popupEnabled:a}=F;const d=U.getFetchPopupTemplate(F,x);if(!a||t.isNone(d))throw new K("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:a,popupTemplate:d});const e=await d.getRequiredFields();a=new L;a.timeExtent=this.timeExtent;a.geometry=m;a.outFields=e;a.outSpatialReference=m.spatialReference;const {resolution:b,spatialReference:c}=this.view;m="2d"===this.view.type?new V(b,b,c):new V(.5*b,.5*b,c);const {returnTopmostRaster:g,showNoDataRecords:h}=d.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};x={returnDomainValues:!0,returnTopmostRaster:g,pixelSize:m,showNoDataRecords:h,signal:t.isSome(x)?x.signal:null};
return F.queryVisibleRasters(a,x).then(k=>k)};N.canResume=function(){return!u._get(u._getPrototypeOf(W.prototype),"canResume",this).call(this)||this.timeExtent?.isEmpty?!1:!0};return u._createClass(W)}(X);A.__decorate([C.property()],X.prototype,"layer",void 0);A.__decorate([C.property()],X.prototype,"suspended",void 0);A.__decorate([C.property(G.combinedViewLayerTimeExtentProperty)],X.prototype,"timeExtent",void 0);A.__decorate([C.property()],X.prototype,"view",void 0);return X=A.__decorate([D.subclass("esri.views.layers.ImageryLayerView")],
X)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(u,A,K){u.getFetchPopupTemplate=function(t,C){return t.popupTemplate?t.popupTemplate:A.isSome(C)&&C.defaultPopupTemplateEnabled&&A.isSome(t.defaultPopupTemplate)?t.defaultPopupTemplate:null};u.getRequiredFields=async function(t,C=t.popupTemplate){if(A.isNone(C))return[];const H=await C.getRequiredFields(t.fieldsIndex);({lastEditInfoEnabled:C}=C);const {objectIdField:I,
typeIdField:P,globalIdField:D,relationships:V}=t;if(H.includes("*"))return["*"];C=C?await K.getFeatureEditFields(t):[];const G=K.fixFields(t.fieldsIndex,[...H,...C]);P&&G.push(P);G&&I&&t.fieldsIndex?.has(I)&&!G.includes(I)&&G.push(I);G&&D&&t.fieldsIndex?.has(D)&&!G.includes(D)&&G.push(D);V&&V.forEach(L=>{({keyField:L}=L);G&&L&&t.fieldsIndex?.has(L)&&!G.includes(L)&&G.push(L)});return G};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(u,A,K,t,C,H,I,P,D,V){return G=>{G=function(L){function U(){return X.apply(this,arguments)}u._inherits(U,L);var X=u._createSuper(U);U.prototype.initialize=function(){this.handles.add(C.on(()=>this.layer,"refresh",N=>{this.doRefresh(N.dataChanged).catch(W=>{t.isAbortError(W)||K.getLogger(this.declaredClass).error(W)})}),"RefreshableLayerView")};return u._createClass(U)}(G);A.__decorate([H.property()],G.prototype,"layer",void 0);return G=A.__decorate([V.subclass("esri.layers.mixins.RefreshableLayerView")],
G)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(u,
A,K,t,C,H,I,P,D,V,G,L,U,X,N,W,p,m,x,F){I=function(a){function d(){var b=e.apply(this,arguments);b._exportImageVersion=-1;b._highlightGraphics=new G.GraphicsCollection;b._highlightView=void 0;b.layer=null;b.subview=null;return b}u._inherits(d,a);var e=u._createSuper(d);a=d.prototype;a.hitTest=async function(b,c){return this.subview?[{type:"graphic",graphic:this.subview.hitTest(b),layer:this.layer,mapPoint:b}]:null};a.update=function(b){this.subview?.update(b)};a.attach=function(){this.layer.increaseRasterJobHandlerUsage();
this._setSubView();this.view&&(this._highlightView=new X({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new N(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.addAttachHandles([C.watch(()=>this.layer.blendMode??"normal",b=>this.subview&&(this.subview.container.blendMode=b),C.syncAndInitial),C.watch(()=>this.layer.effect??null,b=>this.subview&&(this.subview.container.effect=b),C.syncAndInitial),
C.watch(()=>this.layer.exportImageServiceParameters.version,b=>{b&&this._exportImageVersion!==b&&(this._exportImageVersion=b,this.requestUpdate())},C.sync),C.watch(()=>this.timeExtent,b=>{const {subview:c}=this;c&&(c.timeExtent=b,"redraw"in c?this.requestUpdate():c.redrawOrRefetch())},C.sync),this.layer.on("redraw",()=>{const {subview:b}=this;b&&("redraw"in b?b.redraw():b.redrawOrRefetch())}),C.watch(()=>this.layer.renderer,()=>this._setSubView())])};a.detach=function(){this.layer.decreaseRasterJobHandlerUsage();
this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1};a.moveStart=function(){};a.viewChange=function(){};a.moveEnd=function(){this.requestUpdate()};a.highlight=function(b,c){if(!((Array.isArray(b)?b[0]:t.isCollection(b)?b.getItemAt(0):b)instanceof K))return{remove:()=>{}};let g=[];Array.isArray(b)||t.isCollection(b)?g=b.map(h=>h.clone()):b instanceof K&&(g=[b.clone()]);this._highlightGraphics.addMany(g);
return{remove:()=>{this._highlightGraphics.removeMany(g)}}};a.doRefresh=async function(){this.requestUpdate()};a.isUpdating=function(){return!this.subview||this.subview.updating};a._setSubView=function(){if(this.view){var b=this.layer.renderer?.type,c="imagery";"vector-field"===b?c="imageryVF":"flow"===b&&(c="flow");if(this.subview){({type:b}=this.subview);if(b===c){this._attachSubview(this.subview);"flow"===b?this.subview.redrawOrRefetch():"imagery"===b&&"lerc"===this.layer.format?this.subview.redraw():
this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===c?new W({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===c?new p({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new L({layer:this.layer,layerView:this});this._attachSubview(this.subview);this.requestUpdate()}};a._attachSubview=function(b){b&&!b.attached&&(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0),b.container.blendMode=this.layer.blendMode,
b.container.effect=this.layer.effect)};a._detachSubview=function(b){b?.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)};u._createClass(d,[{key:"pixelData",get:function(){const {subview:b}=this;return this.updating||!b?null:"getPixelData"in b?b.getPixelData():null}}]);return d}(m(F(U.LayerView2DMixin(x))));A.__decorate([H.property()],I.prototype,"pixelData",null);A.__decorate([H.property()],I.prototype,"subview",void 0);return I=A.__decorate([V.subclass("esri.views.2d.layers.ImageryLayerView2D")],
I)});