// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../DisplayObject ../../../webgl/BufferObject ../../../webgl/context-util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(q,x,y,z,u,r,A,
m,B,C,D,E,v,w,n,F,G){const t=B.create();return function(k){function p(c){var b=H.call(this);b.elementView=c;b.isWrapAround=!1;b.perspectiveTransform=D.create();b._vertices=new Float32Array(20);b._handles=[];b._handles.push(m.watch(()=>b.elementView.element.opacity,a=>b.opacity=a,m.initial),m.watch(()=>[b.elementView.coords],()=>{b.requestRender()},m.initial),m.when(()=>b.elementView.element.loaded,()=>{const a=b.elementView.element;b.ready();"video"===a.type&&r.isSome(a.content)&&b._handles.push(y.on(a.content,
"play",()=>b.requestRender()))},m.initial));c.element.load().catch(a=>{z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new x("element-load-error","Element cannot be displayed",{element:c,error:a}))});return b}q._inherits(p,k);var H=q._createSuper(p);k=p.prototype;k.destroy=function(){this._handles.forEach(c=>c.remove());this.texture=r.disposeMaybe(this.texture)};k.beforeRender=function(c){const {context:b}=c,a=this.elementView.element.content;if(r.isSome(a)){var d=a instanceof HTMLImageElement;
const g=a instanceof HTMLVideoElement,h=d?a.naturalWidth:g?a.videoWidth:a.width;d=d?a.naturalHeight:g?a.videoHeight:a.height;this._updatePerspectiveTransform(h,d);this.texture?g&&!a.paused&&(this.texture.setData(a),this.requestRender(),(b.type===w.ContextType.WEBGL2||u.isPowerOfTwo(h)&&u.isPowerOfTwo(d))&&this.texture.generateMipmap()):(this.texture=new F.Texture(b,{pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.LINEAR,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,
width:h,height:d,preMultiplyAlpha:!0},a),(b.type===w.ContextType.WEBGL2||u.isPowerOfTwo(h)&&u.isPowerOfTwo(d))&&this.texture.generateMipmap(),g&&!a.paused&&this.requestRender())}q._get(q._getPrototypeOf(p.prototype),"beforeRender",this).call(this,c)};k._createTransforms=function(){return null};k.updateDrawCoords=function(c,b){var a=this.elementView.coords;if(!r.isNone(a)){var [d,g,h,l]=a.rings[0];a=this._vertices;var {x:e,y:f}=c;(c=0!==b)?a.set([g[0]-e,g[1]-f,d[0]-e,d[1]-f,h[0]-e,h[1]-f,l[0]-e,l[1]-
f,l[0]-e,l[1]-f,g[0]+b-e,g[1]-f,g[0]+b-e,g[1]-f,d[0]+b-e,d[1]-f,h[0]+b-e,h[1]-f,l[0]+b-e,l[1]-f]):a.set([g[0]-e,g[1]-f,d[0]-e,d[1]-f,h[0]-e,h[1]-f,l[0]-e,l[1]-f]);this.isWrapAround=c}};k.getVAO=function(c,b,a){if(r.isNone(this.elementView.coords))return null;var d=this._vertices;this._vao?this._geometryVbo.setData(d):(this._geometryVbo=v.BufferObject.createVertex(c,n.Usage.DYNAMIC_DRAW,d),d=v.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),
this._vao=new G.VertexArrayObject(c,a,b,{geometry:this._geometryVbo,tex:d}));return this._vao};k._updatePerspectiveTransform=function(c,b){const a=this._vertices;A.getProjectiveTransform(t,[0,0,c,0,0,b,c,b],[a[0],a[1],a[4],a[5],a[2],a[3],a[6],a[7]]);C.set(this.perspectiveTransform,t[6]/t[8]*c,t[7]/t[8]*b)};q._createClass(p,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return p}(E.DisplayObject)});