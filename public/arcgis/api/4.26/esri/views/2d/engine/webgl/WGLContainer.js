// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3f32 ../brushes ../Container ./ClippingInfo ./enums".split(" "),function(d,u,h,n,p,q,r,f){return function(b){function e(){var a=t.apply(this,arguments);a.name=a.constructor.name;return a}d._inherits(e,b);var t=d._createSuper(e);b=e.prototype;b.beforeRender=function(a){d._get(d._getPrototypeOf(e.prototype),"beforeRender",this).call(this,a);this.updateTransforms(a.state)};b._createTransforms=
function(){return{dvs:n.create()}};b.doRender=function(a){a=this.createRenderParams(a);const {painter:c,globalOpacity:g,profiler:k,drawPhase:l}=a,m=l===f.WGLDrawPhase.LABEL||l===f.WGLDrawPhase.HIGHLIGHT?1:g*this.computedOpacity;k.recordContainerStart(this.name);c.beforeRenderLayer(a,this._clippingInfos?255:0,m);this.renderChildren(a);c.compositeLayer(a,m);k.recordContainerEnd()};b.renderChildren=function(a){h.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(a.painter));for(const c of this._renderPasses)try{c.render(a)}catch(g){}};
b.createRenderParams=function(a){a.requireFBO=this.requiresDedicatedFBO;return a};b.prepareRenderPasses=function(a){return[a.registerRenderPass({name:"clip",brushes:[p.brushes.clip],target:()=>this._clippingInfos,drawPhase:f.WGLDrawPhase.MAP|f.WGLDrawPhase.LABEL|f.WGLDrawPhase.LABEL_ALPHA|f.WGLDrawPhase.DEBUG|f.WGLDrawPhase.HIGHLIGHT})]};b.updateTransforms=function(a){for(const c of this.children)c.setTransform(a)};b.onAttach=function(){d._get(d._getPrototypeOf(e.prototype),"onAttach",this).call(this);
this._updateClippingInfo()};b.onDetach=function(){d._get(d._getPrototypeOf(e.prototype),"onDetach",this).call(this);this._updateClippingInfo()};b._updateClippingInfo=function(){h.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(g=>g.destroy()),this._clippingInfos=null);const a=this.stage;if(a){var c=this._clips;h.isSome(c)&&c.length&&(this._clippingInfos=c.items.map(g=>r.fromClipArea(a,g)));this.requestRender()}};d._createClass(e,[{key:"clips",set:function(a){this._clips=a;this.children.forEach(c=>
c.clips=a);this._updateClippingInfo()}}]);return e}(q.Container)});