// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ../brushes ./enums ./WGLContainer".split(" "),function(p,D,E,q,F,G,H,I,J,K,L,M,N){return function(h){function k(){var a=O.apply(this,arguments);a._localOrigin=E.createScreenPoint(0,
0);a._viewStateId=-1;a._dvsMat3=F.create();a.requiresDedicatedFBO=!1;return a}p._inherits(k,h);var O=p._createSuper(k);h=k.prototype;h.beforeRender=function(a){this._updateMatrices(a);this._updateOverlays(a,this.children);for(const b of this.children)b.beforeRender(a)};h.prepareRenderPasses=function(a){const b=a.registerRenderPass({name:"overlay",brushes:[L.brushes.overlay],target:()=>this.children,drawPhase:M.WGLDrawPhase.MAP});return[...p._get(p._getPrototypeOf(k.prototype),"prepareRenderPasses",
this).call(this,a),b]};h._updateMatrices=function(a){var {state:b}=a;const {id:f,size:u,pixelRatio:l,resolution:r,rotation:v,viewpoint:y,displayMat3:m}=b;if(this._viewStateId!==f){a=Math.PI/180*v;var c=l*u[0],d=l*u[1],{x:g,y:n}=y.targetGeometry;b=I.normalizeMapX(g,b.spatialReference);this._localOrigin.x=b;this._localOrigin.y=n;b=r*c;var t=r*d,e=q.identity(this._dvsMat3);q.multiply(e,e,m);q.translate(e,e,G.fromValues(c/2,d/2));q.scale(e,e,H.fromValues(c/b,-d/t,1));q.rotate(e,e,-a);this._viewStateId=
f}};h._updateOverlays=function(a,b){const {state:f}=a,{rotation:u,spatialReference:l,worldScreenWidth:r,size:v,viewpoint:y}=f;a=this._localOrigin;let m=0;var c=J.getInfo(l);if(c&&l.isWrappable){var d=180/Math.PI*u,g=Math.round(v[0]*Math.abs(Math.cos(d))+v[1]*Math.abs(Math.sin(d)));const [t,e]=c.valid;c=K.getWorldWidth(l);const {x:A,y:P}=y.targetGeometry;d=[0,0];f.toScreen(d,[A,P]);const w=[0,0];g=g>r?.5*r:.5*g;var n=Math.floor((A+.5*c)/c);const Q=t+n*c;n=e+n*c;const z=[d[0]+g,0];f.toMap(w,z);w[0]>
n&&(m=c);z[0]=d[0]-g;f.toMap(w,z);w[0]<Q&&(m=-c);for(const x of b){b=x.elementView.bounds;if(D.isNone(b))continue;const [B,,C]=b;B<t&&C>t?x.updateDrawCoords(a,c):C>e&&B<e?x.updateDrawCoords(a,-c):x.updateDrawCoords(a,m)}}else for(d of b)d.updateDrawCoords(a,m)};p._createClass(k,[{key:"dvsMat3",get:function(){return this._dvsMat3}}]);return k}(N)});