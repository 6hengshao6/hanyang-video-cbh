// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../definitions ../../enums ../../number ../../TurboLine ../../materialKey/MaterialKey ./templateUtils".split(" "),function(r,t,w,x,n,y,p,z){const A=(c,h,m)=>(l,a,b,e,d,f,k,g,q,u,v)=>{b=n.i1616to32(v,Math.ceil(16*c._halfWidth));k=n.i8888to32(Math.round(16*k),Math.round(16*g),Math.round(16*q),Math.round(16*u));d=n.i8888to32(16*d,16*f,0,c._bitset);f=c.out;f.vertexBounds(l,a,h,m);f.vertexWrite(n.i1616to32(8*l,8*
a));f.vertexWrite(c.id);f.vertexWrite(c._fillColor);f.vertexWrite(k);f.vertexWrite(b);f.vertexWrite(c._tl);f.vertexWrite(c._br);f.vertexWrite(d);f.vertexWrite(n.i1616to32(Math.ceil(16*c._halfReferenceWidth),0));f.vertexWrite(c.minMaxZoom);f.vertexEnd();return c.offset+c.vertexCount++},B=(c,h,m)=>(l,a,b,e,d,f,k,g,q,u,v)=>{b=n.i1616to32(16*c._halfWidth,16*c._halfReferenceWidth);k=n.i8888to32(16*k+128,16*g+128,16*q+128,16*u+128);g=c.out;q=c._bitset<<24|c.id;g.vertexBounds(l,a,h,m);g.vertexWrite(n.i1616to32(8*
l,8*a));g.vertexWrite(q);g.vertexWrite(c._fillColor);l=p.hasSimpleSymbology(c.key);l||(g.vertexWrite(0),g.vertexWrite(0));g.vertexWrite(0);g.vertexWrite(b);g.vertexWrite(k);l||g.vertexWrite(c.minMaxZoom);g.vertexEnd();return c.offset+c.vertexCount++},C=c=>(h,m,l)=>{const a=c.out;a.indexWrite(h);a.indexWrite(m);a.indexWrite(l);c.indexCount+=3};return c=>function(h){function m(...a){a=l.call(this,...a);a.tessellationProperties={};a._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0};a.geometryType=
x.WGLGeometryType.LINE;return a}r._inherits(m,h);var l=r._createSuper(m);h=m.prototype;h.writeGeometry=function(a,b,e,d){this._writeGeometry(a,b,e,d)};h._initializeTessellator=function(a){var b=p.LineMaterialKey.load(this._materialKey),e=p.FillMaterialKey.load(this._materialKey),d=this._tessellationOptions;b=b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue;a=this.tessellationProperties._halfWidth<w.THIN_LINE_HALF_WIDTH_THRESHOLD&&!a&&!b;this.tessellationProperties.minMaxZoom=
this._minMaxZoom;d.wrapDistance=65535;d.textured=this._isDashed||this._hasPattern;d.offset=this.tessellationProperties.offset;d.halfWidth=this.tessellationProperties._halfWidth;d=a?0:1;e=p.hasOutlineFillSymbology(e)?B:A;this._lineTessellator=new y.LineTessellation(e(this.tessellationProperties,d,d),C(this.tessellationProperties),a)};h._write=function(a,b,e,d){e="esriGeometryPoint"===b.geometryType;a.recordStart(b.getDisplayId(),this._materialKey,this.geometryType,e);this._writeGeometry(a,b,d,e);a.recordEnd()};
h._writeGeometry=function(a,b,e,d){e=e??b.readLegacyGeometryForDisplay();d=this._getLines(e,d);t.isNone(d)||this._writeVertices(a,b,d)};h._getLines=function(a,b){if(t.isNone(a))return null;a=a.paths||a.rings;return t.isNone(a)?null:z.clipLinesMarshall(a,b?256:16)};h._writeVertices=function(a,b,e){const d=b.getDisplayId(),f=a.vertexCount(),k=this.tessellationProperties;b=this._tessellationOptions;k.out=a;k.id=d;k.indexCount=0;k.vertexCount=0;k.offset=f;b.capType=this._capType;b.joinType=this._joinType;
a=p.FillMaterialKey.load(this._materialKey);this.tessellationProperties.key=p.hasOutlineFillSymbology(a)?a:p.LineMaterialKey.load(this._materialKey);for(const {line:g,start:q}of e)b.initialDistance=q%65535,this._lineTessellator.tessellate(g,b)};return r._createClass(m)}(c)});