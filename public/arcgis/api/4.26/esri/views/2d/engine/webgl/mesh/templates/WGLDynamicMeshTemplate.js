// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/Logger","../../../../../../symbols/cim/cimAnalyzer","../../../../../../symbols/cim/utils","./WGLMeshTemplate"],function(n,v,w,k,x){const p=v.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");return function(y){function l(d){var a=z.call(this);a._ongoingMaterialRequestMap=new Map;a._materialCache=new Map;a._dynamicPropertyMap=new Map;a._cimLayer=d;return a}n._inherits(l,y);var z=n._createSuper(l);l.prototype.analyze=
async function(d,a,e,f,g){if(g&&0===g.length)return null;const q=g&&0<g.length,h=a.readLegacyFeature();a=a.getObjectId();const r=this._materialCache;var b=this._cimLayer.materialHash;if(!b)return p.error("A Dynamic mesh template must have a material hash value or function!"),null;const c="function"===typeof b?b(h,e,f,a):b;b=r.get(c);if(null!=b||(b=this._ongoingMaterialRequestMap.get(c)))return b;b=this._cimLayer;const t=w.analyzeCIMResource(b.cim,this._cimLayer.materialOverrides);t.mosaicHash=c;const {type:u,
url:A}=b;a={cim:t,type:u,mosaicHash:c,url:A,size:null,dashTemplate:null,text:null,fontName:null,objectId:a,animatedSymbolProperties:null};switch(u){case "marker":a.size=k.evaluateValueOrFunction(b.size,h,e,f);a.animatedSymbolProperties=k.evaluateValueOrFunction(b.animatedSymbolProperties,h,e,f);break;case "line":a.dashTemplate=b.dashTemplate;break;case "text":a.text=k.evaluateValueOrFunction(b.text,h,e,f),a.fontName=k.evaluateValueOrFunction(b.fontName,h,e,f)}d=d.getMosaicItem(a,g).then(m=>{q||(this._ongoingMaterialRequestMap.delete(c),
r.set(c,m));return m}).catch(m=>{this._ongoingMaterialRequestMap.delete(c);p.error(".analyze()",m.message);return null});q||this._ongoingMaterialRequestMap.set(c,d);return d};return n._createClass(l)}(x)});