// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(x,C,D,y,g,E,F,G,w,n,z,H,h,I,J,K){const L=F.create(),
M=E.create();return function(N){function p(a,c,q){var b=O.call(this,a);b._cimMarkerLayer=a;b._minMaxZoom=z.i1616to32(Math.round(c*n.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(q*n.MIN_MAX_ZOOM_PRECISION_FACTOR));const k=a.color;h.isFunction(k)?b._dynamicPropertyMap.set("_fillColor",(e,f,d)=>w.premultiplyAlphaRGBA(k(e,f,d))):b._fillColor=w.premultiplyAlphaRGBA(k);const r=a.outlineColor;h.isFunction(r)?b._dynamicPropertyMap.set("_outlineColor",(e,f,d)=>w.premultiplyAlphaRGBA(r(e,f,d))):b._outlineColor=
w.premultiplyAlphaRGBA(r);const l=a.size;h.isFunction(l)?b._dynamicPropertyMap.set("_size",(e,f,d)=>g.pt2px(l(e,f,d))):b._size=g.pt2px(l)||0;c=a.scaleX;h.isFunction(c)?b._dynamicPropertyMap.set("_scaleX",c):b._scaleX=c;const u=a.offsetX;h.isFunction(u)?b._dynamicPropertyMap.set("xOffset",(e,f,d)=>g.pt2px(u(e,f,d))):b.xOffset=g.pt2px(u)||0;const m=a.offsetY;h.isFunction(m)?b._dynamicPropertyMap.set("yOffset",(e,f,d)=>g.pt2px(m(e,f,d))):b.yOffset=g.pt2px(m)||0;const t=a.outlineWidth;h.isFunction(t)?
b._dynamicPropertyMap.set("_outlineWidth",(e,f,d)=>g.pt2px(t(e,f,d))):b._outlineWidth=g.pt2px(t)||0;c=a.rotation;h.isFunction(c)?b._dynamicPropertyMap.set("_angle",c):b._angle=c||0;y.isSome(a.effects)&&(c=a.effects,h.isFunction(c)?b._dynamicPropertyMap.set("_effects",c):b._effects=c);y.isSome(a.markerPlacement)&&(c=a.markerPlacement,h.isFunction(c)?b._dynamicPropertyMap.set("_markerPlacement",c):b._markerPlacement=c);b._scaleFactor=y.unwrapOr(a.scaleFactor,1);b._bitSet=(a.alignment===G.Alignment.MAP?
n.BITSET_MARKER_ALIGNMENT_MAP:n.BITSET_MARKER_ALIGNMENT_SCREEN)|(a.colorLocked?n.BITSET_GENERIC_LOCK_COLOR:0)|(a.scaleSymbolsProportionally?n.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0);b._materialKey=a.materialKey;return b}x._inherits(p,N);var O=x._createSuper(p);p.fromCIMMarker=function(a,c){const [q,b]=h.getMinMaxZoom(a.scaleInfo,c);return new p(a,q,b)};p.prototype.bindFeature=function(a,c,q){const b=a.readLegacyFeature();a=a.getObjectId();this._dynamicPropertyMap.forEach((P,Q)=>{this[Q]=P(b,
c,q)});var k=this._cimMarkerLayer.materialHash;a="function"===typeof k?k(b,c,q,a):k;if((a=this._materialCache.get(a))&&K.ok(a.spriteMosaicItem)&&a.spriteMosaicItem){a=a.spriteMosaicItem;k=this._cimMarkerLayer.sizeRatio;var r=a.width/a.height*this._scaleX,l=H.MarkerMaterialKey.load(this._materialKey);l.sdf=a.sdf;l.pattern=!0;l.textureBinding=a.textureBinding;this._materialKey=l.data;var u=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,m=this._size,t=m*r,e=this.xOffset,f=this.yOffset;
this.xOffset*=this._scaleFactor;this.yOffset*=this._scaleFactor;var d=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/g.pt2px(this._cimMarkerLayer.frameHeight):1;d*=this._outlineWidth;var R=g.pt2px(this._cimMarkerLayer.referenceSize),A=0,B=0,v=this._cimMarkerLayer.anchorPoint;v&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(A=g.pt2px(v.x)/(this._size*r),B=g.pt2px(v.y)/this._size):(A=v.x,B=v.y));this._anchorX=A;this._anchorY=B;this._sizeOutlineWidth=
z.i8888to32(Math.round(Math.min(Math.sqrt(128*t),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*R),255)));this.angle=u;this._bitestAndDistRatio=z.i1616to32(this._bitSet,Math.round(64*k));this._computeSize(t,m,k,d,this._scaleFactor,a,l.hasSizeVV(),!0);this._applyTransformation(M,L);this.xOffset=e;this.yOffset=f}else D.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new C("mapview-cim","Encountered an error when binding feature"))};
return x._createClass(p)}(I(J))});