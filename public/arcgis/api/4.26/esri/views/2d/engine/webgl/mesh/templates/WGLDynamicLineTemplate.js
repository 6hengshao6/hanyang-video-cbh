// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(q,v,t,u,h,r,w,d,x,y,z){return function(A){function n(a,e,p){var b=B.call(this,a);b._minMaxZoom=r.i1616to32(Math.round(e*h.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(p*h.MIN_MAX_ZOOM_PRECISION_FACTOR));b._cimLineLayer=
a;let c=0;d.isFunction(a.width)||(c=.5*t.pt2px(a.width));b._dynamicPropertyMap.set("_halfWidth",(k,g,l)=>d.isFunction(a.width)?.5*t.pt2px(a.width(k,g,l)):c);d.isFunction(a.cap)?b._dynamicPropertyMap.set("_capType",a.cap):b._capType=a.cap;d.isFunction(a.join)?b._dynamicPropertyMap.set("_joinType",a.join):b._joinType=a.join;const f=a.color;d.isFunction(f)?b._dynamicPropertyMap.set("_fillColor",(k,g,l)=>u.premultiplyAlphaRGBA(f(k,g,l))):b._fillColor=f&&u.premultiplyAlphaRGBA(f)||0;const m=a.miterLimit;
d.isFunction(m)?b._dynamicPropertyMap.set("_miterLimitCosine",(k,g,l)=>d.getLimitCosine(m(k,g,l))):b._miterLimitCosine=d.getLimitCosine(m);v.isSome(a.effects)&&(e=a.effects,d.isFunction(e)?b._dynamicPropertyMap.set("_effects",e):b._effects=e);b._scaleFactor=a.scaleFactor||1;b._isDashed=null!=a.dashTemplate;b.tessellationProperties._bitset=(a.colorLocked?h.BITSET_GENERIC_LOCK_COLOR:0)|(a.scaleDash?h.BITSET_LINE_SCALE_DASH:0)|(a.sampleAlphaOnly?h.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0);b._materialKey=
a.materialKey;b._initializeTessellator(!0);return b}q._inherits(n,A);var B=q._createSuper(n);n.fromCIMLine=function(a,e){const [p,b]=d.getMinMaxZoom(a.scaleInfo,e);return new n(a,p,b)};n.prototype.bindFeature=function(a,e,p){const b=a.readLegacyFeature();this._dynamicPropertyMap.forEach((f,m)=>{this[m]=f(b,e,p)});this._halfWidth*=this._scaleFactor;a=this._materialCache;var c=this._cimLineLayer.materialHash;c=c(b,e,p);c=a.get(c);a=null;c&&z.ok(c.spriteMosaicItem)&&(a=c.spriteMosaicItem);if(a){this._hasPattern=
!0;const {rect:f,width:m,height:k}=a;c=f.x+h.SPRITE_PADDING;const g=f.y+h.SPRITE_PADDING,l=c+m,C=g+k;this.tessellationProperties._tl=r.i1616to32(c,g);this.tessellationProperties._br=r.i1616to32(l,C)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties.offset=0;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;
c=w.LineMaterialKey.load(this._materialKey);a&&(c.sdf=a.sdf,c.pattern=!0,c.textureBinding=a.textureBinding);this._materialKey=c.data};return q._createClass(n)}(x(y))});