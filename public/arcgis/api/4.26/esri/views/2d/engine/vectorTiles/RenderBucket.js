// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(u,p,g,x,A,m,n,v){let w=function(){function e(l,c){this.layerUIDs=[];this.isDestroyed=!1;this._data=l;this.memoryUsed=l.byteLength;let a=1;l=new Uint32Array(l);this.layerUIDs=[];const b=l[a++];for(let d=0;d<b;d++)this.layerUIDs[d]=l[a++];this.bufferDataOffset=a;c&&(this.layer=c.getStyleLayerByUID(this.layerUIDs[0]))}
var h=e.prototype;h.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};h.prepareForRendering=function(l){g.isNone(this._data)||(this.doPrepareForRendering(l,this._data,this.bufferDataOffset),this._data=null)};p._createClass(e,[{key:"isPreparedForRendering",get:function(){return g.isNone(this._data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return e}(),B=function(e){function h(c,a){a=l.call(this,c,a);a.type=x.BucketType.LINE;a.lineIndexStart=0;a.lineIndexCount=
0;c=new Uint32Array(c);let b=a.bufferDataOffset;a.lineIndexStart=c[b++];a.lineIndexCount=c[b++];const d=c[b++];if(0<d){const f=new Map;for(let k=0;k<d;k++){const r=c[b++],q=c[b++],t=c[b++];f.set(r,[q,t])}a.patternMap=f}a.bufferDataOffset=b;return a}p._inherits(h,e);var l=p._createSuper(h);e=h.prototype;e.hasData=function(){return 0<this.lineIndexCount};e.triangleCount=function(){return this.lineIndexCount/3};e.doDestroy=function(){g.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();
g.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();g.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};e.doPrepareForRendering=function(c,a,b){a=new Uint32Array(a);var d=new Int32Array(a.buffer);const f=a[b++];this.lineVertexBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Int32Array(d.buffer,4*b,f));b+=f;d=a[b++];this.lineIndexBuffer=m.BufferObject.createIndex(c,n.Usage.STATIC_DRAW,
new Uint32Array(a.buffer,4*b,d));b+=d;b=this.layer.lineMaterial;this.lineVertexArrayObject=new v.VertexArrayObject(c,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return p._createClass(h)}(w),C=function(e){function h(c,a){a=l.call(this,c,a);a.type=x.BucketType.FILL;a.fillIndexStart=0;a.fillIndexCount=0;a.outlineIndexStart=0;a.outlineIndexCount=0;c=new Uint32Array(c);let b=a.bufferDataOffset;a.fillIndexStart=c[b++];a.fillIndexCount=c[b++];a.outlineIndexStart=
c[b++];a.outlineIndexCount=c[b++];const d=c[b++];if(0<d){const f=new Map;for(let k=0;k<d;k++){const r=c[b++],q=c[b++],t=c[b++];f.set(r,[q,t])}a.patternMap=f}a.bufferDataOffset=b;return a}p._inherits(h,e);var l=p._createSuper(h);e=h.prototype;e.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};e.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};e.doDestroy=function(){g.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();g.isSome(this.fillVertexBuffer)&&
this.fillVertexBuffer.dispose();g.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;g.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();g.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();g.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};e.doPrepareForRendering=
function(c,a,b){a=new Uint32Array(a);var d=new Int32Array(a.buffer),f=a[b++];this.fillVertexBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Int32Array(d.buffer,4*b,f));b+=f;f=a[b++];this.fillIndexBuffer=m.BufferObject.createIndex(c,n.Usage.STATIC_DRAW,new Uint32Array(a.buffer,4*b,f));b+=f;f=a[b++];this.outlineVertexBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Int32Array(d.buffer,4*b,f));b+=f;d=a[b++];this.outlineIndexBuffer=m.BufferObject.createIndex(c,n.Usage.STATIC_DRAW,
new Uint32Array(a.buffer,4*b,d));b+=d;a=this.layer;b=a.fillMaterial;a=a.outlineMaterial;this.fillVertexArrayObject=new v.VertexArrayObject(c,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new v.VertexArrayObject(c,a.getAttributeLocations(),a.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return p._createClass(h)}(w),D=function(e){function h(c,a,b){a=l.call(this,c,a);a.type=x.BucketType.SYMBOL;
a.iconPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.symbolInstances=[];a.isIconSDF=!1;a.opacityChanged=!1;a.lastOpacityUpdate=0;a.symbols=[];const d=new Uint32Array(c),f=new Int32Array(c);c=new Float32Array(c);let k=a.bufferDataOffset;a.isIconSDF=!!d[k++];var r=d[k++];for(var q=0;q<r;q++){var t=d[k++],y=d[k++],z=d[k++];a.iconPerPageElementsMap.set(t,[y,z])}r=d[k++];for(q=0;q<r;q++)t=d[k++],y=d[k++],z=d[k++],a.glyphPerPageElementsMap.set(t,[y,z]);r=d[k++];q=d[k++];a.iconOpacity=new Int32Array(r);
a.textOpacity=new Int32Array(q);k=A.deserializeSymbols(d,f,c,k,a.symbols,b);a.bufferDataOffset=k;return a}p._inherits(h,e);var l=p._createSuper(h);e=h.prototype;e.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};e.triangleCount=function(){let c=0;for(const [,a]of this.iconPerPageElementsMap)c+=a[1];for(const [,a]of this.glyphPerPageElementsMap)c+=a[1];return c/3};e.doDestroy=function(){g.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();
g.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();g.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();g.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;g.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();g.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();g.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();g.isSome(this.textIndexBuffer)&&
this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};e.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var c=g.unwrap(this.iconOpacity),a=g.unwrap(this.iconOpacityBuffer);0<c.length&&c.byteLength===a.size&&a.setSubData(c,0,0,c.length);c=g.unwrap(this.textOpacity);a=g.unwrap(this.textOpacityBuffer);0<c.length&&c.byteLength===a.size&&a.setSubData(c,0,0,c.length)}};e.doPrepareForRendering=
function(c,a,b){a=new Uint32Array(a);var d=new Int32Array(a.buffer),f=a[b++];this.iconVertexBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Int32Array(d.buffer,4*b,f));b+=f;f=a[b++];this.iconIndexBuffer=m.BufferObject.createIndex(c,n.Usage.STATIC_DRAW,new Uint32Array(a.buffer,4*b,f));b+=f;f=a[b++];this.textVertexBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Int32Array(d.buffer,4*b,f));b+=f;d=a[b++];this.textIndexBuffer=m.BufferObject.createIndex(c,n.Usage.STATIC_DRAW,new Uint32Array(a.buffer,
4*b,d));b+=d;this.iconOpacityBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,g.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,g.unwrap(this.textOpacity).buffer);a=this.layer;b=a.iconMaterial;a=a.textMaterial;this.iconVertexArrayObject=new v.VertexArrayObject(c,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new v.VertexArrayObject(c,
a.getAttributeLocations(),a.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return p._createClass(h)}(w),E=function(e){function h(c,a){a=l.call(this,c,a);a.type=x.BucketType.CIRCLE;a.circleIndexStart=0;a.circleIndexCount=0;c=new Uint32Array(c);let b=a.bufferDataOffset;a.circleIndexStart=c[b++];a.circleIndexCount=c[b++];a.bufferDataOffset=b;return a}p._inherits(h,e);var l=p._createSuper(h);e=h.prototype;e.hasData=function(){return 0<this.circleIndexCount};
e.triangleCount=function(){return this.circleIndexCount/3};e.doDestroy=function(){g.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();g.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();g.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};e.doPrepareForRendering=function(c,a,b){a=new Uint32Array(a);var d=new Int32Array(a.buffer);const f=a[b++];
this.circleVertexBuffer=m.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,new Int32Array(d.buffer,4*b,f));b+=f;d=a[b++];this.circleIndexBuffer=m.BufferObject.createIndex(c,n.Usage.STATIC_DRAW,new Uint32Array(a.buffer,4*b,d));b+=d;b=this.layer.circleMaterial;this.circleVertexArrayObject=new v.VertexArrayObject(c,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return p._createClass(h)}(w);u.CircleRenderBucket=E;u.FillRenderBucket=C;u.LineRenderBucket=
B;u.RenderBucketBase=w;u.SymbolRenderBucket=D;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});