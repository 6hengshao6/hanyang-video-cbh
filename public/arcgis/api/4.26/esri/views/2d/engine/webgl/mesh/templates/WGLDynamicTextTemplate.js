// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(q,r,m,z,v,p,u,A,B,c,C,D,E){return function(t){function n(a,e,d){var b=F.call(this,a);b._horizontalAlignment="center";b._verticalAlignment=
"middle";b._textToGlyphs=new Map;b._minMaxZoom=A.i1616to32(Math.round(e*u.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(d*u.MIN_MAX_ZOOM_PRECISION_FACTOR));e=a.scaleFactor||1;b._cimTextLayer=a;const k=a.color;c.isFunction(k)?b._dynamicPropertyMap.set("_color",(f,g,h)=>p.premultiplyAlphaRGBA(k(f,g,h))):b._color=p.premultiplyAlphaRGBA(k);const l=a.outlineColor;c.isFunction(l)?b._dynamicPropertyMap.set("_haloColor",(f,g,h)=>p.premultiplyAlphaRGBA(l(f,g,h))):b._haloColor=p.premultiplyAlphaRGBA(l);let w;c.isFunction(a.size)||
(w=Math.min(Math.round(m.pt2px(a.size*a.sizeRatio)),127));b._dynamicPropertyMap.set("_size",(f,g,h)=>c.isFunction(a.size)?Math.min(Math.round(m.pt2px(a.size(f,g,h)*a.sizeRatio)),127):w);c.isFunction(a.outlineSize)?b._dynamicPropertyMap.set("_haloSize",(f,g,h)=>Math.min(Math.floor(5*m.pt2px(a.outlineSize(f,g,h)*a.sizeRatio)),127)):b._haloSize=Math.min(Math.floor(5*m.pt2px(a.outlineSize*a.sizeRatio)),127);let x;c.isFunction(a.offsetX)||(x=Math.round(m.pt2px(a.offsetX*a.sizeRatio)));b._dynamicPropertyMap.set("_xOffset",
(f,g,h)=>c.isFunction(a.offsetX)?Math.round(m.pt2px(a.offsetX(f,g,h)*a.sizeRatio)):x);let y;c.isFunction(a.offsetY)||(y=Math.round(m.pt2px(a.offsetY*a.sizeRatio)));b._dynamicPropertyMap.set("_yOffset",(f,g,h)=>c.isFunction(a.offsetY)?Math.round(m.pt2px(a.offsetY(f,g,h)*a.sizeRatio)):y);c.isFunction(a.angle)?b._dynamicPropertyMap.set("_angle",a.angle):b._angle=a.angle;c.isFunction(a.horizontalAlignment)?b._dynamicPropertyMap.set("_horizontalAlignment",a.horizontalAlignment):b._horizontalAlignment=
a.horizontalAlignment;c.isFunction(a.verticalAlignment)?b._dynamicPropertyMap.set("_verticalAlignment",a.verticalAlignment):b._verticalAlignment=a.verticalAlignment;r.isSome(a.effects)&&(d=a.effects,c.isFunction(d)?b._dynamicPropertyMap.set("_effects",d):b._effects=d);r.isSome(a.markerPlacement)&&(d=a.markerPlacement,c.isFunction(d)?b._dynamicPropertyMap.set("_markerPlacement",d):b._textPlacement=d);c.isFunction(a.text)?b._dynamicPropertyMap.set("_text",a.text):b._text=a.text;b._backgroundColor=a.backgroundColor&&
p.premultiplyAlphaRGBA(a.backgroundColor);b._borderLineColor=a.borderLineColor&&p.premultiplyAlphaRGBA(a.borderLineColor);b._borderLineSize=a.borderLineWidth;b._scaleFactor=e;e=Math.min(Math.round(m.pt2px(a.referenceSize*a.sizeRatio)),127);b._referenceSize=Math.round(Math.sqrt(256*e));b._materialKey=a.materialKey;e=B.TextMaterialKey.load(b._materialKey);e.sdf=!0;b._bitset=(a.alignment===z.Alignment.MAP?1:0)|(a.colorLocked?1:0)<<1;b._materialKey=e.data;b._decoration="none";b._lineHeight=1;b._lineWidth=
512;b._isCIM=!0;return b}q._inherits(n,t);var F=q._createSuper(n);n.fromCIMText=function(a,e){const [d,b]=c.getMinMaxZoom(a.scaleInfo,e);return new n(a,d,b)};t=n.prototype;t.analyze=async function(a,e,d,b){var k=e.readLegacyFeature();var l=this._cimTextLayer;k="string"===typeof l.text?l.text:"function"===typeof l.text?l.text(k,d,b)??"":"";(a=await q._get(q._getPrototypeOf(n.prototype),"analyze",this).call(this,a,e,d,b,E.codepoints(k)))&&a.glyphMosaicItems&&this._textToGlyphs.set(k,a.glyphMosaicItems);
return a};t.bindFeature=function(a,e,d){const b=a.readLegacyFeature();this._dynamicPropertyMap.forEach((k,l)=>{this[l]=k(b,e,d)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/u.GLYPH_SIZE,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=v.getXAnchorDirection(r.unwrapOr(this._horizontalAlignment,"center")),this._yAlignD=v.getYAnchorDirection(r.unwrapOr(this._verticalAlignment,"baseline")),a=this._textToGlyphs.get(this._text)??
[],this.bindTextInfo(a,!1)):this._shapingInfo=null};return q._createClass(n)}(C(D))});