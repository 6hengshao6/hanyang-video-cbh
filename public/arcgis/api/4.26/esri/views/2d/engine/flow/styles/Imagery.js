// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(r,v,z,t,A,h,B,C,w){let D=function(){function l(a){this._params=a;this.animated=!1}var m=l.prototype;m.isCompatible=function(a){if(!(a instanceof l&&t.timeExtentsEqual(this._params.timeExtent,a._params.timeExtent)))return!1;
let f;return f=(f=(f=this._params.loadImagery===a._params.loadImagery)&&this._params.color.kind===a._params.color.kind)&&this._params.opacity.kind===a._params.opacity.kind};m.load=async function(a,f){const {extent:b,size:e}=a;z.throwIfAborted(f);a=await this._params.loadImagery(b,e[0],e[1],this._params.timeExtent,f);return new x(a,{color:this._params.color,opacity:this._params.opacity})};m.render=function(a,f,b){({context:a}=a);const {program:e}=b;a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);
a.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);a.useProgram(e);e.setUniformMatrix3fv("u_dvsMat3",f.dvsMat3);a.bindTexture(b.texture,0);e.setUniform1i("u_texture",0);e.setUniform1f("u_Min",b.min);e.setUniform1f("u_Max",b.max);t.setUniforms(e,"color","vec4",this._params.color);t.setUniforms(e,"opacity","float",this._params.opacity);a.bindVAO(b.vertexArray);a.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4)};return v._createClass(l)}();const p=new Map;p.set("a_position",0);p.set("a_texcoord",
1);const E={geometry:[new w.VertexElementDescriptor("a_position",2,h.DataType.UNSIGNED_SHORT,0,8),new w.VertexElementDescriptor("a_texcoord",2,h.DataType.UNSIGNED_SHORT,4,8)]},F={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:p};let x=function(){function l(a,f){this._flowData=a;this._values=f}var m=l.prototype;m.attach=function(a){var {context:f}=a;const {width:b,height:e}=this._flowData;var u={geometry:A.BufferObject.createVertex(f,h.Usage.STATIC_DRAW,new Uint16Array([0,0,0,
1,b,0,1,1,0,e,0,0,b,e,1,0]))};u=new C.VertexArrayObject(f,p,E,u);var k=[];"ramp"===this._values.color.kind&&k.push("vvColor");"ramp"===this._values.opacity.kind&&k.push("vvOpacity");a=a.painter.materialManager.getProgram(F,k);k=1E6;let q=-1E6;for(var g=0;g<e;g++)for(var c=0;c<b;c++)if(0!==this._flowData.mask[g*b+c]){var d=this._flowData.data[2*(g*b+c)],n=this._flowData.data[2*(g*b+c)+1];d=Math.sqrt(d*d+n*n);k=Math.min(k,d);q=Math.max(q,d)}g=new Uint8Array(4*b*e);for(c=0;c<e;c++)for(d=0;d<b;d++)if(0!==
this._flowData.mask[c*b+d]){n=this._flowData.data[2*(c*b+d)];const y=this._flowData.data[2*(c*b+d)+1];g[4*(c*b+d)]=(Math.sqrt(n*n+y*y)-k)/(q-k)*255;g[4*(c*b+d)+1]=0;g[4*(c*b+d)+2]=0;g[4*(c*b+d)+3]=255}else g[4*(c*b+d)]=0,g[4*(c*b+d)+1]=0,g[4*(c*b+d)+2]=0,g[4*(c*b+d)+3]=0;f=new B.Texture(f,{pixelFormat:h.PixelFormat.RGBA,internalFormat:h.PixelFormat.RGBA,samplingMode:h.TextureSamplingMode.LINEAR,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,width:b,height:e},
g);this.vertexArray=u;this.program=a;this.texture=f;this.min=k;this.max=q;this._flowData=null};m.detach=function(){this.vertexArray.dispose();this.texture.dispose()};v._createClass(l,[{key:"ready",get:function(){return this.program.compiled}}]);return l}();r.Imagery=D;r.ImageryResources=x;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});