// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../definitions ../enums ../number ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),function(z,r,A,t,H,I,u,J,K,v,L,l,M){v=function(h){function m(){var a=N.apply(this,arguments);a._color=I.fromValues(1,0,0,1);a._patternMatrix=H.create();a._programOptions={id:!1,
pattern:!1};return a}r._inherits(m,h);var N=r._createSuper(m);h=m.prototype;h.dispose=function(){this._vao&&(this._vao.dispose(),this._vao=null)};h.drawMany=function(a,g){const {context:f,painter:k,styleLayerUID:O,requestRender:B,allowDelayedRender:P}=a;this._loadWGLResources(a);const n=a.displayLevel;var c=a.styleLayer,b=c.backgroundMaterial;const Q=k.vectorTilesMaterialManager;var d=c.getPaintValue("background-color",n);const C=c.getPaintValue("background-opacity",n),D=c.getPaintValue("background-pattern",
n),w=void 0!==D,p=d[3]*C,x=a.spriteMosaic;let E,F;const R=(window.devicePixelRatio|1)>u.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===J.WGLDrawPhase.HITTEST;const y=this._programOptions;y.id=a;y.pattern=w;b=Q.getMaterialProgram(f,b,y);if(P&&t.isSome(B)&&!b.compiled)B();else{f.bindVAO(this._vao);f.useProgram(b);if(w){d=x.getMosaicItemPosition(D,!0);if(t.isSome(d)){const {tl:e,br:q,page:G}=d;E=q[0]-e[0];F=q[1]-e[1];d=x.getPageSize(G);t.isSome(d)&&(x.bind(f,l.TextureSamplingMode.LINEAR,G,u.VTL_TEXTURE_BINDING_UNIT_SPRITES),
b.setUniform4f("u_tlbr",e[0],e[1],q[0],q[1]),b.setUniform2fv("u_mosaicSize",d),b.setUniform1i("u_texture",u.VTL_TEXTURE_BINDING_UNIT_SPRITES))}b.setUniform1f("u_opacity",C)}else this._color[0]=p*d[0],this._color[1]=p*d[1],this._color[2]=p*d[2],this._color[3]=p,b.setUniform4fv("u_color",this._color);b.setUniform1f("u_depth",c.z||0);a&&(c=K.u32to4Xu8(O+1),b.setUniform4fv("u_id",c));for(const e of g)b.setUniform1f("u_coord_range",e.rangeX),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),w&&(c=R*
e.width*Math.max(2**(Math.round(n)-e.key.level),1),g=c/A.nextPowerOfTwo(E),c/=A.nextPowerOfTwo(F),this._patternMatrix[0]=g,this._patternMatrix[4]=c,b.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),f.setStencilFunction(l.CompareFunction.EQUAL,0,255),f.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4)}};h._loadWGLResources=function(a){if(!this._vao){var {context:g,styleLayer:f}=a;a=f.backgroundMaterial;var k=new Int8Array([0,0,1,0,0,1,1,1]);k=L.BufferObject.createVertex(g,l.Usage.STATIC_DRAW,
k);this._vao=new M.VertexArrayObject(g,a.getAttributeLocations(),a.getLayoutInfo(),{geometry:k})}};return r._createClass(m)}(v);z.WGLBrushVTLBackground=v;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});