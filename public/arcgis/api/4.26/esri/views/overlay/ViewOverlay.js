// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),function(n,g,e,r,h,w,x,y,t,u,z,p){e=function(d){function k(){var a=v.apply(this,arguments);a.items=new r;a._watchUpdatingTracking=
new u.WatchUpdatingTracking;a._callbacks=new Map;a._projector=p.createProjector();a._hiddenProjector=p.createProjector();return a}n._inherits(k,d);var v=n._createSuper(k);d=k.prototype;d.initialize=function(){const a=document.createElement("div");a.className="esri-overlay-surface";this._set("surface",a);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");a.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>
this.items,b=>{for(const c of b.added){const f=()=>c.render();this._callbacks.set(c,f);this._projector.append(this.surface,f)}for(const c of b.removed)b=this._projector.detach(this._callbacks.get(c)),this.surface.removeChild(b.domNode),this._callbacks.delete(c)})};d.addItem=function(a){this.items.add(a)};d.removeItem=function(a){this.items.remove(a)};d.destroy=function(){this.items.removeAll();this._callbacks.forEach(a=>this._projector.detach(a));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};
d.render=function(){this._projector.renderNow()};d.computeBoundingRect=function(a){const b=this._hiddenSurface,c=this._hiddenProjector;let f;const q=()=>f=a.render();c.append(b,q);c.renderNow();const l={left:0,top:0,right:0,bottom:0};if(f&&f.domNode){const m=f.domNode.getBoundingClientRect();l.left=m.left;l.top=m.top;l.right=m.right;l.bottom=m.bottom}for(c.detach(q);b.firstChild;)b.removeChild(b.firstChild);return l};d.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);
return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};d.prepare=async function(){await document.fonts.load(this._fontString()).catch(()=>{})};d.renderCanvas=function(a){if(this.items.some(c=>c.visible)){var b=a.getContext("2d");b.save();b.font=this._fontString();this.items.forEach(c=>{b.save();c.renderCanvas(b);b.restore()});b.restore()}};d._fontString=function(){return`10px ${getComputedStyle(this.surface).fontFamily}`};n._createClass(k,[{key:"needsRender",
get:function(){return 0<this.items.length}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some(a=>a.visible)}}]);return k}(e);g.__decorate([h.property({readOnly:!0})],e.prototype,"surface",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"items",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"needsRender",null);g.__decorate([h.property({readOnly:!0})],e.prototype,"_watchUpdatingTracking",
void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"updating",null);return e=g.__decorate([t.subclass("esri.views.overlay.ViewOverlay")],e)});