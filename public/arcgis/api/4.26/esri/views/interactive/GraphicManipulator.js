// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Evented ../../core/maybe ../../core/reactiveUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/vec2 ../../chunks/vec3 ../../chunks/vec3f64 ../../geometry/projection ../../support/elevationInfoUtils ../../symbols/support/defaults ../../symbols/support/ElevationInfo ./support/utils ../support/drapedUtils".split(" "),
function(c,q,g,x,y,l,t,m,k,K,L,M,z,u,A,B,r,C,D,E,F,G){c.GraphicManipulator=function(f){function n(a){a=H.call(this,a);a.layer=null;a.interactive=!0;a.selectable=!1;a.grabbable=!0;a.dragging=!1;a.cursor=null;a.events=new y.EventEmitter;a._circleCollisionCache=null;a._graphicSymbolChangedHandle=null;a._originalSymbol=null;return a}q._inherits(n,f);var H=q._createSuper(n);f=n.prototype;f.grabbableForEvent=function(){return!0};f.destroy=function(){this.detachSymbolChanged();this._resetGraphicSymbol();
this._set("view",null)};f.intersectionDistance=function(a){const d=this.graphic;if(!1===d.visible)return null;const e=d.geometry;if(l.isNone(e))return null;var b=this._get("focusedSymbol");b=l.isSome(b)?b:d.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,a,e,b):this._intersectDistance3D(this.view,a,d)};f.attach=function(){this.attachSymbolChanged();l.isSome(this.layer)&&this.layer.add(this.graphic)};f.detach=function(){this.detachSymbolChanged();this._resetGraphicSymbol();l.isSome(this.layer)&&
this.layer.remove(this.graphic)};f.attachSymbolChanged=function(){this.detachSymbolChanged();this._graphicSymbolChangedHandle=t.watch(()=>this.graphic?.symbol,a=>{l.isSome(a)&&a!==this.focusedSymbol&&a!==this._originalSymbol&&(this._originalSymbol=a,this._focused&&l.isSome(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))},t.sync)};f.detachSymbolChanged=function(){l.isSome(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)};
f.onElevationChange=function(){};f.onViewChange=function(){};f._updateGraphicSymbol=function(){this.graphic.symbol=this._focused&&l.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol};f._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol};f._intersectDistance2D=function(a,d,e,b){b=b||D.getDefaultSymbol2D(e);if(l.isNone(b))return null;var h=this._circleCollisionCache;if("point"===e.type&&"cim"===b.type&&"CIMPointSymbol"===b.data.symbol?.type&&b.data.symbol.symbolLayers){const {offsetX:p,
offsetY:I,size:J}=F.getSymbolInfo(b);b=m.screenPointObjectToArray(d,v);h=J/2;a=a.toScreen(e);return u.squaredDistance(b,[a.x+p,a.y+I])<h*h?1:null}if("point"!==e.type||"simple-marker"!==b.type)return G.intersectsDrapedGeometry(d,e,a)?1:null;if(l.isNone(h)||!h.originalPoint.equals(e)){const p=a.spatialReference;r.canProjectWithoutEngine(e.spatialReference,p)&&(h=r.project(e,p),this._circleCollisionCache=h={originalPoint:e.clone(),mapPoint:h,radiusPx:m.pt2px(b.size)})}if(l.isSome(h)){e=m.screenPointObjectToArray(d,
v);a=a.toScreen?.(h.mapPoint);if(!a)return null;h=h.radiusPx;d=a.x+m.pt2px(b.xoffset);b=a.y-m.pt2px(b.yoffset);return u.squaredDistance(e,[d,b])<h*h?1:null}return null};f._intersectDistance3D=function(a,d,e){return(d=a.toMap(d,{include:[e]}))&&r.projectPointToVector(d,w,a.renderSpatialReference)?A.distance(w,a.state.camera.eye):null};q._createClass(n,[{key:"graphic",set:function(a){this._circleCollisionCache=null;this._originalSymbol=a.symbol;this._set("graphic",a);this.attachSymbolChanged()}},{key:"elevationInfo",
get:function(){var {layer:a}=this.graphic;a=a&&"elevationInfo"in a?a.elevationInfo:null;const d=C.getGraphicEffectiveElevationMode(this.graphic);return new E({mode:d,offset:a?a.offset:0})}},{key:"focusedSymbol",set:function(a){a!==this._get("focusedSymbol")&&(this._set("focusedSymbol",a),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbing",set:function(a){a!==this._get("grabbing")&&(this._set("grabbing",a),this._updateGraphicSymbol())}},{key:"hovering",set:function(a){a!==
this._get("hovering")&&(this._set("hovering",a),this._updateGraphicSymbol())}},{key:"selected",set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:a?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}}]);return n}(x);g.__decorate([k.property({constructOnly:!0,nonNullable:!0})],c.GraphicManipulator.prototype,"graphic",null);g.__decorate([k.property()],c.GraphicManipulator.prototype,
"elevationInfo",null);g.__decorate([k.property({constructOnly:!0,nonNullable:!0})],c.GraphicManipulator.prototype,"view",void 0);g.__decorate([k.property({value:null})],c.GraphicManipulator.prototype,"focusedSymbol",null);g.__decorate([k.property({constructOnly:!0})],c.GraphicManipulator.prototype,"layer",void 0);g.__decorate([k.property()],c.GraphicManipulator.prototype,"interactive",void 0);g.__decorate([k.property()],c.GraphicManipulator.prototype,"selectable",void 0);g.__decorate([k.property()],
c.GraphicManipulator.prototype,"grabbable",void 0);g.__decorate([k.property({value:!1})],c.GraphicManipulator.prototype,"grabbing",null);g.__decorate([k.property()],c.GraphicManipulator.prototype,"dragging",void 0);g.__decorate([k.property()],c.GraphicManipulator.prototype,"hovering",null);g.__decorate([k.property({value:!1})],c.GraphicManipulator.prototype,"selected",null);g.__decorate([k.property()],c.GraphicManipulator.prototype,"cursor",void 0);c.GraphicManipulator=g.__decorate([z.subclass("esri.views.interactive.GraphicManipulator")],
c.GraphicManipulator);const w=B.create(),v=m.createScreenPointArray();Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});