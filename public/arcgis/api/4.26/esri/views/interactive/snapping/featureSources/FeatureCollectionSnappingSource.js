// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/elevationInfoUtils ../snappingUtils ./queryEngineUtils ./snappingCandidateElevationAlignment ./snappingCandidateElevationFilter ./symbologySnappingCandidates".split(" "),
function(e,q,f,w,g,l,m,h,C,D,E,x,y,r,t,u,z,v){e.FeatureCollectionSnappingSource=function(n){function p(a){a=A.call(this,a);a.view=null;a._layerView3D=null;return a}q._inherits(p,n);var A=q._createSuper(p);n=p.prototype;n.initialize=function(){const {view:a}=this,{layer:b}=this.layerSource;g.isSome(a)&&"3d"===a.type&&"subtype-group"!==b.type&&(a.whenLayerView(b).then(c=>this._layerView3D=c),this.addHandles([a.elevationProvider.on("elevation-change",({context:c})=>{const {elevationInfo:d}=b;y.elevationContextAffectsAlignment(c,
d)&&this._snappingElevationAligner.notifyElevationSourceChange()}),m.watch(()=>b.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),m.initial),m.watch(()=>g.isSome(this._layerView3D)?this._layerView3D.processor?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),m.initial),m.on(()=>g.toNullable(this._layerView3D)?.layer,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())]))};n.refresh=function(){};n.fetchCandidates=
async function(a,b){var {layer:c}=this.layerSource,d=c.source;if(!d?.querySnapping)return[];c=r.makeFilter(c);a=r.makeSnappingQuery(a,g.unwrap(this.view)?.type??"2d",c);d=await d.querySnapping(a,{signal:b});l.throwIfAborted(b);d=await this._snappingElevationAligner.alignCandidates(d.candidates,b);l.throwIfAborted(b);c=await this._symbologySnappingFetcher.fetch(d,b);l.throwIfAborted(b);b=0===c.length?d:[...d,...c];b=this._snappingElevationFilter.filter(a,b);const k=this._getGroundElevation;return b.map(B=>
t.convertSnappingCandidate(B,k))};q._createClass(p,[{key:"availability",get:function(){return 1}},{key:"updating",get:function(){return this.layerSource.updating}},{key:"_snappingElevationAligner",get:function(){const {view:a}=this,{layer:b}=this.layerSource,c=g.isSome(a)&&"3d"===a.type;return c&&"subtype-group"!==b.type?u.getSnappingCandidateElevationAligner(c,{elevationInfo:b.elevationInfo,alignPointsInFeatures:async(d,k)=>(await l.whenOrAbort(a.whenLayerView(b),k)).elevationAlignPointsInFeatures(d,
k),spatialReference:a.spatialReference}):u.getSnappingCandidateElevationAligner()}},{key:"_snappingElevationFilter",get:function(){var {view:a}=this;a=g.isSome(a)&&"3d"===a.type&&"subtype-group"!==this.layerSource.layer.type;return z.getSnappingCandidateElevationFilter(a)}},{key:"_symbologySnappingFetcher",get:function(){const {view:a}=this,{layer:b}=this.layerSource;return g.isSome(a)&&"3d"===a.type&&"subtype-group"!==b.type?v.getSymbologySnappingCandidatesFetcher(this._symbologySnappingSupported,
async(c,d)=>{const k=await a.whenLayerView(b);l.throwIfAborted(d);return k.queryForSymbologySnapping({candidates:c,spatialReference:a.spatialReference},d)}):v.getSymbologySnappingCandidatesFetcher()}},{key:"_symbologySnappingSupported",get:function(){return g.isSome(this._layerView3D)&&this._layerView3D.symbologySnappingSupported}},{key:"_getGroundElevation",get:function(){return t.makeGetGroundElevation(this.view)}}]);return p}(w);f.__decorate([h.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,
"layerSource",void 0);f.__decorate([h.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,"view",void 0);f.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationAligner",null);f.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationFilter",null);f.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingFetcher",null);f.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,
"_layerView3D",void 0);f.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingSupported",null);f.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_getGroundElevation",null);e.FeatureCollectionSnappingSource=f.__decorate([x.subclass("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],e.FeatureCollectionSnappingSource);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});