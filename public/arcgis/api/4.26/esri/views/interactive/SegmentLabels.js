// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/quantityFormatUtils ../../core/reactiveUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/vec2 ../../chunks/vec2f64 ../../chunks/vec3 ../../geometry/support/coordsUtils ../../intl/messages ../../support/elevationInfoUtils ../../support/getDefaultUnitForView ../overlay/TextOverlayItem ../support/automaticLengthMeasurementUtils".split(" "),
function(e,y,n,E,F,G,h,H,I,A,B,p,V,W,X,J,q,C,K,L,M,N,O,P,Q){const R={default:15,far:25};e.SegmentLabels=function(k){function u(a){a=S.call(this,a);a.context=null;a.stagedVertex=null;a.visible=!0;a.edgeDistance="default";a._messagesUnits=null;a._labelInfos=[];a._nextLabelIndex=0;return a}y._inherits(u,k);var S=y._createSuper(u);k=u.prototype;k.initialize=function(){const a=F.createTask(async d=>{const l=await M.fetchMessageBundle("esri/core/t9n/Units");H.throwIfAborted(d);this._messagesUnits=l}),b=
()=>h.applySome(this.context,d=>d.editGeometryOperations);this.addHandles([A.watch(()=>[h.isSome(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(d=>A.on(b,d,()=>this._update())),G.makeHandle(()=>a.abort())])};k.destroy=function(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())};k._update=function(){this._nextLabelIndex=
0;const a=this.context;if(!h.isNone(a)){var {components:b,geometry:d,coordinateHelper:l}=a.editGeometryOperations.data;if(d){var r=b.length;for(let t=0;t<r;++t){const c=[];b[t].iterateVertices(z=>{c.push(l.toXYZ(z.pos))});0===t&&h.isSome(this.stagedVertex)&&c.push(l.toXYZ(this.stagedVertex));if(2>c.length)continue;var g=c[0],m=c[c.length-1];"polygon"===d.type&&2<c.length&&!K.equals(g,m)&&c.push(g);m=1===r?!L.isClockwise(c,!1,!1):!1;let w=T,x=U;this.toScreenPointArray(a,g,w);for(g=1;g<c.length;++g){const z=
c[g-1],D=c[g];this.toScreenPointArray(a,D,x);this._addLabel(a,z,w,D,x,m);[w,x]=[x,w]}}}}this._destroyUnusedLabels()};k._addLabel=function(a,b,d,l,r,g){const {label:m}=this._getOrCreateLabel(a);if(!this.visible||3025>q.squaredDistance(d,r))m.visible=!1;else{var t=h.isSome(a.graphicState)?a.graphicState.isDraped?"on-the-ground":"absolute-height":N.getGeometryEffectiveElevationMode(a.editGeometryOperations.data.geometry,a.elevationInfo),{spatialReference:c}=a.editGeometryOperations.data;b=Q.autoDirectDistanceByElevationMode(b,
l,c,t);l=this._messagesUnits;a=O.getDefaultUnitForView(a.view);m.text=h.isSome(l)&&h.isSome(b)?I.formatLength(l,b,a):"";m.visible=!0;a=r[0]-d[0];b=r[1]-d[1];g?q.set(f,-b,a):q.set(f,b,-a);q.normalize(f,f);q.scale(f,f,this._edgeDistancePixels);q.lerp(v,d,r,.5);q.add(v,v,f);m.position=[v[0],v[1]];m.anchor=Math.abs(f[0])>Math.abs(f[1])?0<f[0]?"left":"right":0>-f[1]?"top":"bottom"}};k._getOrCreateLabel=function(a){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];
const b=new P({fontSize:10,anchor:"center"});a.view.overlay?.items.add(b);a={label:b};this._labelInfos.push(a);this._nextLabelIndex=this._labelInfos.length;return a};k._destroyUnusedLabels=function(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())};k._destroyLabel=function({label:a}){h.applySome(this.context,b=>b.view.overlay?.items.remove(a));a.destroy()};y._createClass(u,[{key:"updating",get:function(){return h.isNone(this._messagesUnits)}},{key:"test",
get:function(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(a=>a.label.text)}}},{key:"_edgeDistancePixels",get:function(){return R[this.edgeDistance]}}]);return u}(E);n.__decorate([p.property()],e.SegmentLabels.prototype,"context",void 0);n.__decorate([p.property()],e.SegmentLabels.prototype,"stagedVertex",void 0);n.__decorate([p.property()],e.SegmentLabels.prototype,"visible",void 0);n.__decorate([p.property()],e.SegmentLabels.prototype,"edgeDistance",void 0);n.__decorate([p.property()],
e.SegmentLabels.prototype,"updating",null);n.__decorate([p.property()],e.SegmentLabels.prototype,"_messagesUnits",void 0);n.__decorate([p.property()],e.SegmentLabels.prototype,"_edgeDistancePixels",null);e.SegmentLabels=n.__decorate([J.subclass("esri.views.interactive")],e.SegmentLabels);const f=C.create(),v=C.create(),T=B.createScreenPointArray(),U=B.createScreenPointArray();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});