// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Evented ../../core/HandleOwner ../../core/handleUtils ../../core/maybe ../../core/quantityUtils ../../core/reactiveUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/GraphicsLayer ../../support/elevationInfoUtils ./support/createUtils ./support/helpMessageUtils ./support/surfaceCoordinateSystems ../interactive/InteractiveToolBase ../interactive/sketch/SketchLabelOptions ../interactive/sketch/SketchTooltipOptions ../interactive/tooltip/DrawTooltipInfos ../interactive/tooltip/Tooltip ../support/automaticAreaMeasurementUtils ../support/automaticLengthMeasurementUtils".split(" "),
function(d,x,e,H,I,J,K,b,n,y,L,f,S,T,U,M,N,O,p,B,C,P,D,E,v,Q,F,z){let G=x._createClass(function(){this.rectangle=this.circle=this.outline=this.full=this.activeVertex=this.regularVertices=null});d.DrawGraphicTool=function(h){function w(a){a=R.call(this,a);a._graphic=null;a._createOperationGeometry=null;a.defaultZ=0;a.geometryType=null;a.hasZ=!0;a.labelOptions=new D;a.geometryToPlace=null;a.mode=null;a.snappingManager=null;a.snapToScene=!1;a.tooltip=null;a.tooltipOptions=new E;return a}x._inherits(w,
h);var R=x._createSuper(w);h=w.prototype;h.initialize=function(){this.internalGraphicsLayer=new N({listMode:"hide",internal:!0});this.view.map.layers.add(this.internalGraphicsLayer);this.drawOperation=this.makeDrawOperation();this.handles.add([this.drawOperation.on("vertex-add",a=>this.onVertexAdd(a)),this.drawOperation.on("vertex-remove",a=>this.onVertexRemove(a)),this.drawOperation.on("vertex-update",a=>this.onVertexUpdate(a)),this.drawOperation.on("cursor-update",a=>this.onCursorUpdate(a)),this.drawOperation.on("complete",
a=>this.onComplete(a)),y.watch(()=>this.tooltipOptions.enabled,a=>{this.tooltip=a?new Q.Tooltip({view:this.view,info:this._tooltipInfo}):b.destroyMaybe(this.tooltip)},y.syncAndInitial),y.watch(()=>this._tooltipInfo,a=>{b.isSome(this.tooltip)&&(this.tooltip.info=a)},y.syncAndInitial)]);this.finishToolCreation()};h.destroy=function(){this.drawOperation=b.destroyMaybe(this.drawOperation);this.tooltip=b.destroyMaybe(this.tooltip);this._destroyAllVisualisations();this.view.map.remove(this.internalGraphicsLayer);
this.internalGraphicsLayer=b.destroyMaybe(this.internalGraphicsLayer);this._set("view",null)};h.completeCreateOperation=function(){this.drawOperation.complete()};h.onInputEvent=function(a){this.drawOperation.onInputEvent(a)};h.redo=function(){this.drawOperation.redo()};h.reset=function(){};h.undo=function(){this.drawOperation.undo()};h._destroyAllVisualisations=function(){this.handles.remove(r.outline);this.handles.remove(r.regularVertices);this.handles.remove(r.activeVertex);this.handles.remove("create-operation-graphic")};
h._createOrUpdateGraphic=function(a){if(b.isSome(this._graphic))return this._updateGraphicGeometry(this._graphic,a),this._graphic;const c=this._graphic=new H({...this.graphicProperties,symbol:this.graphicSymbol});this._updateGraphicGeometry(c,a);this.internalGraphicsLayer.add(c);this.handles.add(this.initializeGraphic(c));this.notifyChange("graphic");this.handles.add(K.makeHandle(()=>{this.internalGraphicsLayer.remove(c);b.destroyMaybe(c);this._graphic===c&&(this._graphic=null)}),"create-operation-graphic");
return c};h._updateGraphicGeometry=function(a,c){a.geometry=c};h._getCreateOperationGeometry=function(a={operationComplete:!1}){var {drawOperation:c}=this;if(null==c||0===c.numVertices)return null;const {coordinateHelper:q,view:m}=c;var l=c.stagedVertex,k=c.committedVertices;c=k.slice();var t=b.isSome(l);t&&c.push(q.pointToArray(l));var u=t?q.pointToArray(l):k.splice(-1)[0];l=c.length;t=m.spatialReference;const A="3d"===m.type&&"global"===m.viewingMode,g=new G;switch(this.geometryType){case "point":case "mesh":g.regularVertices=
k;g.activeVertex=u;g.full=q.arrayToPoint(c[0]);break;case "multipoint":g.regularVertices=k;g.activeVertex=u;0<l&&(g.full=p.createMultipoint(c,t));break;case "polyline":g.regularVertices=k;g.activeVertex=u;0<l&&(g.full=p.createPolyline([c],t,A));break;case "polygon":g.regularVertices=k;g.activeVertex=u;0<l&&(g.full=p.createPolygon([c],t,A,!0));break;case "circle":0<l&&(k=C.createViewAlignedCoordinateSystem(m,c[0]),1===l&&a.operationComplete?(a=c[0],u=k.makeMapPoint(a[0]+48*m.resolution,a[1]),g.circle=
p.createCircle([a,u],k,!0),g.full=b.isSome(g.circle)?g.circle.geometry:null):2===l&&(this.forceUniformSize?(g.circle=p.createCircle(c,k,this.centered),g.full=b.isSome(g.circle)?g.circle.geometry:null):(g.rectangle=p.createEllipse(c,k,this.centered),g.full=g.rectangle.geometry)));break;case "rectangle":0<l&&(k=C.createViewAlignedCoordinateSystem(m,c[0]),1===l&&a.operationComplete?(a=c[0],u=k.makeMapPoint(a[0]+48*m.resolution,a[1]),g.rectangle=p.createSquare([a,u],k,!0),g.full=g.rectangle.geometry):
2===l&&(g.rectangle=this.forceUniformSize?p.createSquare(c,k,this.centered):p.createRectangle(c,k,this.centered),g.full=g.rectangle.geometry));break;default:return null}switch(this.geometryType){case "polyline":case "polygon":1<l&&(g.outline=p.createPolyline([c],t,A));break;case "circle":case "rectangle":b.isSome(g.full)&&"polygon"===g.full.type&&(g.outline=p.createPolygon(g.full.rings,t,A))}return g};h.initializeGraphic=function(a){return null};h.onComplete=function(a){this._updateGraphic();let c=
null;if(this.drawOperation.isCompleted){const q=this._getCreateOperationGeometry({operationComplete:!0});b.isSome(q)&&(c=this._createOrUpdateGraphic(q.full).clone())}this._createOperationGeometry=null;this.emit("complete",{graphic:c,...a})};h.onCursorUpdate=function(a){this._updateGraphic();this.emit("cursor-update",a)};h.onDeactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()};h.onVertexAdd=function(a){this._updateGraphic();this.emit("vertex-add",a)};h.onVertexRemove=
function(a){this._updateGraphic();this.emit("vertex-remove",a)};h.onVertexUpdate=function(a){this._updateGraphic();this.emit("vertex-update",a)};h._updateGraphic=function(){const a=this._getCreateOperationGeometry();this._createOperationGeometry=a;b.isNone(a)?this._destroyAllVisualisations():(b.isSome(a.outline)?this.handles.add(this.onOutlineChanged(a.outline),r.outline):this.handles.remove(r.outline),b.isSome(a.regularVertices)?this.handles.add(this.onRegularVerticesChanged(a.regularVertices),r.regularVertices):
this.handles.remove(r.regularVertices),b.isSome(a.activeVertex)?this.handles.add(this.onActiveVertexChanged(a.activeVertex),r.activeVertex):this.handles.remove(r.activeVertex),b.isSome(a.full)?this._createOrUpdateGraphic(a.full):this.handles.remove("create-operation-graphic"))};x._createClass(w,[{key:"_defaultElevation",get:function(){return n.createLength(this.defaultZ,"meters")}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},
{key:"centered",set:function(a){this._set("centered",a);this._updateGraphic()}},{key:"enabled",set:function(a){this.drawOperation.interactive=a;this._set("enabled",a)}},{key:"forceUniformSize",set:function(a){this._set("forceUniformSize",a);this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(a){this._set("graphicSymbol",a);b.isSome(this._graphic)&&(this._graphic.symbol=a)}},{key:"updating",get:function(){return this.drawOperation?.updating??
!1}},{key:"_tooltipInfo",get:function(){const {drawOperation:a}=this;if(!a)return null;switch(this.geometryType){case "point":return this._drawPointTooltipInfo;case "polyline":return this._drawPolylineTooltipInfo;case "polygon":return this._drawPolygonTooltipInfo;case "rectangle":return this._drawRectangleTooltipInfo;case "circle":return this._drawCircleTooltipInfo;default:return null}}},{key:"_drawPointTooltipInfo",get:function(){const a=b.applySome(this.graphic,c=>c.geometry);return b.isNone(a)||
"point"!==a.type||"2d"===this.view.type&&0===this.defaultZ?null:new v.DrawPointTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:this.view.type,helpMessage:B.getDrawHelpMessage("point",a)})}},{key:"_drawPolylineTooltipInfo",get:function(){var a=this._createOperationGeometry;a=b.isSome(a)?a.full:null;if(b.isNone(a)||"polyline"!==a.type)return null;const c=z.autoLengthByElevationMode(a,this._elevationMode);return new v.DrawPolylineTooltipInfo({tooltipOptions:this.tooltipOptions,
elevation:this._elevationTooltipDetail,totalLength:b.unwrapOr(c,n.zeroMeters),viewType:this.view.type,helpMessage:B.getDrawHelpMessage("polyline",a)})}},{key:"_drawPolygonTooltipInfo",get:function(){var a=this._createOperationGeometry;a=b.isSome(a)?a.full:null;if(b.isNone(a)||"polygon"!==a.type)return null;const c=F.autoAreaByElevationMode(a,this._elevationMode);return new v.DrawPolygonTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:b.unwrapOr(c,n.zeroSquareMeters),
viewType:this.view.type,helpMessage:B.getDrawHelpMessage("polygon",a)})}},{key:"_drawRectangleTooltipInfo",get:function(){return b.isNone(this.drawOperation)?null:new v.DrawRectangleTooltipInfo({tooltipOptions:this.tooltipOptions,xSize:b.unwrapOr(this._xSize,n.zeroMeters),ySize:b.unwrapOr(this._ySize,n.zeroMeters),area:b.unwrapOr(this._fullGeometryArea,n.zeroSquareMeters)})}},{key:"_drawCircleTooltipInfo",get:function(){if(b.isNone(this.drawOperation))return null;const a=this.forceUniformSize;return new v.DrawCircleTooltipInfo({tooltipOptions:this.tooltipOptions,
radius:a?b.unwrapOr(this._circleRadius,n.zeroMeters):null,xSize:a?null:b.unwrapOr(this._xSize,n.zeroMeters),ySize:a?null:b.unwrapOr(this._ySize,n.zeroMeters),area:b.unwrapOr(this._fullGeometryArea,n.zeroSquareMeters)})}},{key:"_circleRadius",get:function(){const a=this._createOperationGeometry;return b.isSome(a)&&b.isSome(a.circle)&&b.isSome(a.circle.center)&&b.isSome(a.circle.edge)?z.autoHorizontalDistanceByElevationModeBetweenPoints(a.circle.center,a.circle.edge,this._elevationMode):null}},{key:"_xSize",
get:function(){var a=this._createOperationGeometry;if(b.isNone(a)||b.isNone(a.rectangle))return null;({midpoints:a}=a.rectangle);return b.isSome(a)?z.autoHorizontalDistanceByElevationModeBetweenPoints(a.left,a.right,this._elevationMode):null}},{key:"_ySize",get:function(){var a=this._createOperationGeometry;if(b.isNone(a)||b.isNone(a.rectangle))return null;({midpoints:a}=a.rectangle);return b.isSome(a)?z.autoHorizontalDistanceByElevationModeBetweenPoints(a.top,a.bottom,this._elevationMode):null}},
{key:"_fullGeometryArea",get:function(){var a=this._createOperationGeometry;a=b.isSome(a)?a.full:null;return b.isNone(a)||"polygon"!==a.type?null:F.autoAreaByElevationMode(a,this._elevationMode)}},{key:"_elevationTooltipDetail",get:function(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}},{key:"_vertexTooltipElevation",get:function(){const {tooltipOptions:a,view:c,drawOperation:q}=this;if(b.isNone(q))return this._defaultElevation;var m=q.stagedVertex??q.lastVertex;
if(b.isNone(m)||"2d"===c.type)return this._defaultElevation;m=(O.getConvertedElevation(c,m,q.elevationInfo,{mode:a.elevation.mode,offset:0})??0)*L.getMetersPerVerticalUnitForSR(m.spatialReference);return n.createLength(m,"meters")}},{key:"_elevationMode",get:function(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}}]);return w}(J.HandleOwnerMixin(I.EventedMixin(P.InteractiveToolBase)));e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_createOperationGeometry",void 0);
e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_defaultElevation",null);e.__decorate([f.property({value:!0})],d.DrawGraphicTool.prototype,"centered",null);e.__decorate([f.property({nonNullable:!0})],d.DrawGraphicTool.prototype,"defaultZ",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"drawOperation",void 0);e.__decorate([f.property({value:!0})],d.DrawGraphicTool.prototype,"enabled",null);e.__decorate([f.property({value:!0})],d.DrawGraphicTool.prototype,"forceUniformSize",
null);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"geometryType",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"graphic",null);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"graphicProperties",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"graphicSymbol",null);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"hasZ",void 0);e.__decorate([f.property({constructOnly:!0,type:D})],d.DrawGraphicTool.prototype,
"labelOptions",void 0);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"geometryToPlace",void 0);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"mode",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"snappingManager",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"snapToScene",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"tooltip",void 0);e.__decorate([f.property({constructOnly:!0,type:E})],d.DrawGraphicTool.prototype,
"tooltipOptions",void 0);e.__decorate([f.property({readOnly:!0})],d.DrawGraphicTool.prototype,"type",void 0);e.__decorate([f.property({readOnly:!0})],d.DrawGraphicTool.prototype,"updating",null);e.__decorate([f.property({constructOnly:!0,nonNullable:!0})],d.DrawGraphicTool.prototype,"view",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_tooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawPointTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,
"_drawPolylineTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawPolygonTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawRectangleTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawCircleTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_circleRadius",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_xSize",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,
"_ySize",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_fullGeometryArea",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_elevationTooltipDetail",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_vertexTooltipElevation",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_elevationMode",null);d.DrawGraphicTool=e.__decorate([M.subclass("esri.views.draw.DrawGraphicTool")],d.DrawGraphicTool);const r={outline:"outline-visual",regularVertices:"regular-vertices-visual",
activeVertex:"active-vertex-visual"};d.CreateOperationGeometry=G;d.geometryTypeToDrawOperationGeometryType=function(h){switch(h){case "point":case "polyline":case "polygon":case "multipoint":return h;case "circle":case "rectangle":return"segment";case "mesh":return"point"}};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});