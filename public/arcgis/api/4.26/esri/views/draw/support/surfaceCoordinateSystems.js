// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/maybe ../../../chunks/mat2d ../../../chunks/mat2df64 ../../../chunks/quat ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/Axis ../../../geometry/Point".split(" "),function(h,k,p,m,z,r,v,w,l,g,t,q){function n(e,c,f=null){return m.isSome(f)?[e,c,f]:[e,c]}function u(e,c,f=null){return m.isSome(f)?{x:e,y:c,z:f}:{x:e,y:c}}p=function(){function e(c){this.spatialReference=
c}e.prototype.mapToLocalMultiple=function(c){return m.filterNones(c.map(f=>this.mapToLocal(f)))};k._createClass(e,[{key:"doUnnormalization",get:function(){return!1}}]);return e}();let x=function(e){function c(b,d,a=null){d=f.call(this,d);d._defaultZ=a;d.transform=r.create();d.transformInv=r.create();d.transform=r.clone(b);z.invert(d.transformInv,d.transform);return d}k._inherits(c,e);var f=k._createSuper(c);e=c.prototype;e.makeMapPoint=function(b,d){return n(b,d,this._defaultZ)};e.mapToLocal=function(b){return u(this.transform[0]*
b[0]+this.transform[2]*b[1]+this.transform[4],this.transform[1]*b[0]+this.transform[3]*b[1]+this.transform[5])};e.localToMap=function(b){return n(this.transformInv[0]*b.x+this.transformInv[2]*b.y+this.transformInv[4],this.transformInv[1]*b.x+this.transformInv[3]*b.y+this.transformInv[5],this._defaultZ)};return k._createClass(c)}(p),y=function(e){function c(b,d){var a=f.call(this,b.spatialReference);a.view=b;a.defaultZ=null;a.pWS=g.create();a.tangentFrameUpWS=g.create();a.tangentFrameRightWS=g.create();
a.tangentFrameForwardWS=g.create();a.localFrameRightWS=g.create();a.localFrameUpWS=g.create();a.worldToLocalTransform=w.create();a.localToWorldTransform=w.create();a.scale=1;a.scale=b.resolution;a.referenceMapPoint=d;a.defaultZ=d.hasZ?d.z:null;b=b.state.camera.viewRight;a.view.renderCoordsHelper.toRenderCoords(a.referenceMapPoint,a.pWS);a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,t.Axis.X,a.tangentFrameRightWS);a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,t.Axis.Y,a.tangentFrameUpWS);
a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,t.Axis.Z,a.tangentFrameForwardWS);d=g.create();l.scale(d,a.tangentFrameForwardWS,l.dot(b,a.tangentFrameForwardWS));l.subtract(a.localFrameRightWS,b,d);l.normalize(a.localFrameRightWS,a.localFrameRightWS);l.cross(a.localFrameUpWS,a.tangentFrameForwardWS,a.localFrameRightWS);v.rotationTo(a.worldToLocalTransform,a.localFrameRightWS,a.tangentFrameRightWS);v.invert(a.localToWorldTransform,a.worldToLocalTransform);return a}k._inherits(c,e);var f=k._createSuper(c);
e=c.prototype;e.makeMapPoint=function(b,d){return n(b,d,this.defaultZ)};e.mapToLocal=function(b){const d=g.create();this.view.renderCoordsHelper.toRenderCoords(new q({x:b[0],y:b[1],spatialReference:this.spatialReference}),d);l.transformQuat(d,d,this.worldToLocalTransform);b=this.view.renderCoordsHelper.fromRenderCoords(d,this.view.spatialReference);return m.isSome(b)?u(b.x/this.scale,b.y/this.scale):null};e.localToMap=function(b){const d=g.create();this.view.renderCoordsHelper.toRenderCoords(new q({x:b.x*
this.scale,y:b.y*this.scale,spatialReference:this.spatialReference}),d);l.transformQuat(d,d,this.localToWorldTransform);b=this.view.renderCoordsHelper.fromRenderCoords(d,this.view.spatialReference);return m.isSome(b)?n(b.x,b.y,this.defaultZ):null};k._createClass(c,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}}]);return c}(p);h.AffineCoordinateSystem=x;h.SceneViewCoordinateSystem=y;h.SurfaceCoordinateSystem=p;h.createViewAlignedCoordinateSystem=function(e,c){return"2d"===
e.type?new x(e.state.transform,e.spatialReference,2<c.length?c[2]:null):"3d"===e.type?(c=2<c.length?new q({x:c[0],y:c[1],z:c[2],spatialReference:e.spatialReference}):new q({x:c[0],y:c[1],spatialReference:e.spatialReference}),new y(e,c)):null};h.makeMapPoint=n;h.makeSurfacePoint=u;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});