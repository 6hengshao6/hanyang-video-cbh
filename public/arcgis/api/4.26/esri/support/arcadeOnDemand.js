// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../chunks/_rollupPluginBabelHelpers ../geometry ../core/Error ../core/Logger ../core/maybe ../geometry/SpatialReference".split(" "),function(z,k,A,r,B,C,D,E){function w(){t||(t=(async()=>{const b=await new Promise((d,a)=>z(["./arcadeUtils"],d,a));return{arcade:b.arcade,arcadeUtils:b,Dictionary:b.Dictionary,Feature:b.arcadeFeature}})());return t}const F=C.getLogger("esri.support.arcadeOnDemand");let t;r=(b,d,a)=>n.create(b,d,a,null,["$feature","$view"]);let n=function(){function b(a,
g,u,m,h,f,c){this.script=a;this.evaluate=m;this.fields=Array.isArray(f)?f:f.fields;this._syntaxTree=u;this._arcade=g;this._arcadeFeature=h;this._spatialReference=c;this._referencesGeometry=g.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}b.create=async function(a,g,u,m,h,f){const {arcade:c,Feature:G,Dictionary:x}=await w(),v=E.fromJSON(g);let l;try{l=c.parseScript(a,f)}catch(e){return F.error(new B("arcade-bad-expression","Failed to parse arcade script",
{script:a,error:e})),null}h=h.reduce((e,H)=>({...e,[H]:null}),{});let p=null;D.isSome(m)&&(p=new x(m),p.immutable=!0,h.$config=null);f=(m=c.scriptUsesGeometryEngine(l))&&c.enableGeometrySupport();const I=c.scriptUsesFeatureSet(l)&&c.enableFeatureSetSupport(),y=(g=c.scriptIsAsync(l))&&c.enableAsyncSupport();h={vars:h,spatialReference:v,useAsync:!!y};await Promise.all([f,I,y]);f=new Set;await c.loadDependentModules(f,l,null,g,m);const q=new x;q.immutable=!1;q.setField("scale",0);const J=c.compileScript(l,
h);return new b(a,c,l,e=>{"$view"in e&&e.$view&&(q.setField("scale","object"===typeof e.$view?e.$view.scale:void 0),e.$view=q);p&&(e.$config=p);return J({vars:e,spatialReference:v})},new G,u,v)};var d=b.prototype;d.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&(a.geometry.spatialReference=this._spatialReference);this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this.fields});return this._arcadeFeature};d.referencesGeometry=function(){return this._referencesGeometry};
d.referencesScale=function(){return this._referencesScale};return A._createClass(b)}();k.ArcadeExpression=n;k.createDictionaryExpression=(b,d,a,g)=>n.create(b,d,a,g,["$feature","$view"]);k.createLabelExpression=(b,d,a)=>n.create(b,d,a,null,["$feature"]);k.createRendererExpression=r;k.createVVExpression=r;k.loadArcade=w;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});