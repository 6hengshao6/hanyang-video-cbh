// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../request ./featureSetCollection ./featureset/actions/AttributeFilter ./featureset/actions/GroupBy ./featureset/actions/OrderBy ./featureset/actions/SpatialFilter ./featureset/actions/Top ./featureset/sources/FeatureLayerDynamic ./featureset/sources/FeatureLayerMemory ./featureset/sources/FeatureLayerRelated ./featureset/support/cache ./featureset/support/errorsupport ./featureset/support/FeatureSet ./featureset/support/shared ../core/sql/WhereClause ../layers/FeatureLayer ../portal/PortalItem".split(" "),
function(p,t,u,x,C,D,E,F,G,H,I,J,l,y,K,z,L,m,M){async function v(a,g){if(l.applicationCache){var k=l.applicationCache.getLayerInfo(a);if(k)return k=await k,new m({url:a,outFields:g,sourceJSON:k});const c=new m({url:a,outFields:g});g=(async()=>{await c.load();return c.sourceJSON})();if(l.applicationCache){l.applicationCache.setLayerInfo(a,g);try{return await g,c}catch(f){throw l.applicationCache.clearLayerInfo(a),f;}}await g;return c}return new m({url:a,outFields:g})}async function w(a,g,k,c,f,b=null){a=
await v(a,["*"]);return r(a,g,k,c,f,b)}function r(a,g=null,k=null,c=!0,f=null,b=null){g={layer:a,spatialReference:g,outFields:k,includeGeometry:c,lrucache:f,interceptor:b};return!0===a._hasMemorySource()?new I(g):new H(g)}async function N(a){if(null!==l.applicationCache){var g=l.applicationCache.getLayerInfo(a);if(null!==g)return g}g=(async()=>{const k=await u(a,{responseType:"json",query:{f:"json"}});return k.data?k.data:null})();if(null!==l.applicationCache){l.applicationCache.setLayerInfo(a,g);
try{return await g}catch(k){throw l.applicationCache.clearLayerInfo(a),k;}}return g}async function O(a,g){const k="QUERYDATAELEMTS:"+g.toString()+":"+a;if(null!==l.applicationCache){var c=l.applicationCache.getLayerInfo(k);if(null!==c)return c}c=(async()=>{var f=await u(a+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([g.toString()]),f:"json"}});if(f.data&&(f=f.data,f.layerDataElements&&f.layerDataElements[0]))return f.layerDataElements[0];throw new y.FeatureSetError(y.FeatureSetErrorCodes.DataElementsNotFound);
})();if(null!==l.applicationCache){l.applicationCache.setLayerInfo(k,c);try{return await c}catch(f){throw l.applicationCache.clearLayerInfo(k),f;}}return c}async function A(a){if(null!==l.applicationCache){var g=l.applicationCache.getLayerInfo(a);if(null!==g)return g}g=(async()=>{var k=await u(a,{responseType:"json",query:{f:"json"}});return k.data?(k=k.data,k.layers||(k.layers=[]),k.tables||(k.tables=[]),k):{layers:[],tables:[]}})();if(null!==l.applicationCache){l.applicationCache.setLayerInfo(a,
g);try{return await g}catch(k){throw l.applicationCache.clearLayerInfo(a),k;}}return g}C.registerAction();D.registerAction();E.registerAction();F.registerAction();G.registerAction();let P=function(a){function g(c,f=null,b=null,e=null){var d=k.call(this);d._map=c;d._overridespref=f;d._lrucache=b;d._interceptor=e;d._instantLayers=[];return d}t._inherits(g,a);var k=t._createSuper(g);a=g.prototype;a._makeAndAddFeatureSet=function(c,f=!0,b=null){const e=r(c,this._overridespref,null===b?["*"]:b,f,this._lrucache,
this._interceptor);this._instantLayers.push({featureset:e,opitem:c,includeGeometry:f,outFields:JSON.stringify(b)});return e};a.featureSetByName=async function(c,f=!0,b=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return await this._map.load(),this.featureSetByName(c,f,b);null===b&&(b=["*"]);b=b.slice(0);b=b.sort();var e=JSON.stringify(b);for(let d=0;d<this._instantLayers.length;d++){const h=this._instantLayers[d];if(h.opitem.title===c&&h.includeGeometry===f&&
h.outFields===e)return this._instantLayers[d].featureset}if(e=this._map.allLayers.find(d=>d instanceof m&&d.title===c?!0:!1))return this._makeAndAddFeatureSet(e,f,b);if(this._map.tables&&(e=this._map.tables.find(d=>d.title&&d.title===c||d.title&&d.title===c?!0:!1))){if(e instanceof m)return this._makeAndAddFeatureSet(e,f,b);e._materializedTable||(e._materializedTable=new m(e.outFields?e:{...e,outFields:["*"]}));await e._materializedTable.load();return this._makeAndAddFeatureSet(e._materializedTable,
f,b)}return null};a.featureSetById=async function(c,f=!0,b=["*"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return await this._map.load(),this.featureSetById(c,f,b);null===b&&(b=["*"]);b=b.slice(0);b=b.sort();var e=JSON.stringify(b);for(let d=0;d<this._instantLayers.length;d++){const h=this._instantLayers[d];if(h.opitem.id===c&&h.includeGeometry===f&&h.outFields===e)return this._instantLayers[d].featureset}if(e=this._map.allLayers.find(d=>d instanceof m&&d.id===
c?!0:!1))return this._makeAndAddFeatureSet(e,f,b);if(this._map.tables&&(e=this._map.tables.find(d=>d.id===c?!0:!1))){if(e instanceof m)return this._makeAndAddFeatureSet(e,f,b);e._materializedTable||(e._materializedTable=new m({...e,outFields:["*"]}));await e._materializedTable.load();return this._makeAndAddFeatureSet(e._materializedTable,f,b)}return null};return t._createClass(g)}(x),Q=function(a){function g(c,f=null,b=null,e=null){var d=k.call(this);d._url=c;d._overridespref=f;d._lrucache=b;d._interceptor=
e;d.metadata=null;d._instantLayers=[];return d}t._inherits(g,a);var k=t._createSuper(g);a=g.prototype;a._makeAndAddFeatureSet=function(c,f=!0,b=null){const e=r(c,this._overridespref,null===b?["*"]:b,f,this._lrucache);this._instantLayers.push({featureset:e,opitem:c,includeGeometry:f,outFields:JSON.stringify(b)});return e};a._loadMetaData=async function(){const c=await A(this._url);return this.metadata=c};a.load=function(){return this._loadMetaData()};a.clone=function(){return new g(this._url,this._overridespref,
this._lrucache,this._interceptor)};a.featureSetByName=async function(c,f=!0,b=null){null===b&&(b=["*"]);b=b.slice(0);b=b.sort();var e=JSON.stringify(b);for(var d=0;d<this._instantLayers.length;d++){const h=this._instantLayers[d];if(h.opitem.title===c&&h.includeGeometry===f&&h.outFields===e)return this._instantLayers[d].featureset}e=await this._loadMetaData();d=null;for(const h of e.layers??[])h.name===c&&(d=h);if(!d)for(const h of e.tables??[])h.name===c&&(d=h);return d?(c=await v(this._url+"/"+d.id,
["*"]),this._makeAndAddFeatureSet(c,f,b)):null};a.featureSetById=async function(c,f=!0,b=["*"]){null===b&&(b=["*"]);b=b.slice(0);b=b.sort();var e=JSON.stringify(b);c=null!==c&&void 0!==c?c.toString():"";for(var d=0;d<this._instantLayers.length;d++){const h=this._instantLayers[d];if(h.opitem.id===c&&h.includeGeometry===f&&h.outFields===e)return this._instantLayers[d].featureset}e=await this._loadMetaData();d=null;for(const h of e.layers??[])null!==h.id&&void 0!==h.id&&h.id.toString()===c&&(d=h);if(!d)for(const h of e.tables??
[])null!==h.id&&void 0!==h.id&&h.id.toString()===c&&(d=h);return d?(c=await v(this._url+"/"+d.id,["*"]),this._makeAndAddFeatureSet(c,f,b)):null};t._createClass(g,[{key:"url",get:function(){return this._url}}]);return g}(x);p.constructAssociationMetaDataFeatureSetFromUrl=async function(a,g){var k=3,c=[],f=null,b={},e=null;e=await A(a);if(e.controllerDatasetLayers&&void 0!==e.controllerDatasetLayers.utilityNetworkLayerId&&null!==e.controllerDatasetLayers.utilityNetworkLayerId){if(e.layers)for(var d of e.layers)b[d.id]=
d.name;if(e.tables)for(var h of e.tables)b[h.id]=h.name;d=e.controllerDatasetLayers.utilityNetworkLayerId;if(e=await O(a,d)){(f=e)&&f.dataElement&&void 0!==f.dataElement.schemaGeneration&&(k=f.dataElement.schemaGeneration);e={};f.dataElement.domainNetworks||(f.dataElement.domainNetworks=[]);for(var q of f.dataElement.domainNetworks){for(const n of q.edgeSources??[])h={layerId:n.layerId,sourceId:n.sourceId,className:b[n.layerId]??null},h.className&&(e[h.className]=h);for(const n of q.junctionSources??
[])h={layerId:n.layerId,sourceId:n.sourceId,className:b[n.layerId]??null},h.className&&(e[h.className]=h)}if(f.dataElement.terminalConfigurations)for(const n of f.dataElement.terminalConfigurations)for(const B of n.terminals)c.push({terminalId:B.terminalId,terminalName:B.terminalName});b=await N(a+"/"+d);if(b.systemLayers&&void 0!==b.systemLayers.associationsTableId&&null!==b.systemLayers.associationsTableId)return q=[],4<=k&&(q.push("STATUS"),q.push("PERCENTALONG")),a=await w(a+"/"+b.systemLayers.associationsTableId.toString(),
g,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...q],!1,null,null),await a.load(),4<=k&&(a=a.filter(L.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",a.getFieldsIndex())),await a.load()),
{lkp:e,associations:a,unVersion:k,terminals:c}}}return{associations:null,unVersion:k,lkp:null,terminals:[]}};p.constructFeatureSet=r;p.constructFeatureSetFromPortalItem=async function(a,g,k,c,f,b,e,d=null){if(l.applicationCache){var h=l.applicationCache.getLayerInfo(a+":"+b.url);if(h)return a=await h,g=new m({url:z.extractServiceUrl(a.url)+"/"+g,outFields:["*"]}),r(g,k,c,f,e,d)}h=(new M({id:a,portal:b})).load();l.applicationCache&&l.applicationCache.setLayerInfo(a+":"+b.url,h);try{const q=await h,
n=new m({url:z.extractServiceUrl(q.url??"")+"/"+g,outFields:["*"]});return r(n,k,c,f,e,d)}catch(q){throw l.applicationCache&&l.applicationCache.clearLayerInfo(a+":"+b.url),q;}};p.constructFeatureSetFromRelationship=async function(a,g,k,c=null,f=null,b=!0,e=null,d=null){var h=a.serviceUrl();if(!h)return null;h="/"===h.charAt(h.length-1)?h+g.relatedTableId.toString():h+"/"+g.relatedTableId.toString();h=await w(h,c,f,b,e,d);return new J({layer:a,relatedLayer:h,relationship:g,objectId:k,spatialReference:c,
outFields:f,includeGeometry:b,lrucache:e,interceptor:d})};p.constructFeatureSetFromUrl=w;p.convertToFeatureSet=function(a,g,k,c,f){if(null===a)return null;if(a instanceof m){switch(g){case "datasource":return r(a,f,a.outFields,!0,k,c).getDataSourceFeatureSet();case "parent":return r(a,f,a.outFields,!0,k,c);case "root":return r(a,f,a.outFields,!0,k,c)}return null}if(a instanceof K)switch(g){case "datasource":return a.getDataSourceFeatureSet();case "parent":return a;case "root":return a.getRootFeatureSet()}return null};
p.createFeatureSetCollectionFromMap=function(a,g,k=null,c=null){return new P(a,g,k,c)};p.createFeatureSetCollectionFromService=function(a,g,k=null,c=null){return new Q(a,g,k,c)};p.initialiseMetaDataCache=function(){null===l.applicationCache&&(l.applicationCache=new l)};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});