// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Handles ../../core/handleUtils ../../core/maybe ../../core/reactiveUtils ../../core/screenUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(d,p,e,u,v,w,x,n,q,r,t,g,C,D,E,y){var h;(function(f){f.PointerMove=
"pointer-move";f.Main="main"})(h||(h={}));d.ShadowTooltipViewModel=function(f){function l(b){var a=z.call(this,b);a._handles=new w;a._screenPoint=null;a._accumulatedShadowTime=null;a._shadowTimeTask=null;a._updateAccumulatedShadowTime=(m,k)=>{a._shadowTimeTask=n.abortMaybe(a._shadowTimeTask);a._shadowTimeTask=v.createTask(async c=>{const {results:A,ground:B}=await m.hitTest(k);0!==A.length||B.mapPoint?(c=await a.getDuration(k,c),a._accumulatedShadowTime=c):a._accumulatedShadowTime=null})};a._throttledUpdateAccumulatedShadowTime=
t.throttle(a._updateAccumulatedShadowTime,300);return a}p._inherits(l,f);var z=p._createSuper(l);f=l.prototype;f.initialize=function(){this._handles.add(q.watch(()=>({enabled:this.enabled,view:this.view}),({enabled:b,view:a})=>{b&&n.isSome(a)?this._startTracking(a):this._stopTracking()},q.syncAndInitial))};f.destroy=function(){this._handles=n.destroyMaybe(this._handles)};f._startTracking=function(b){const a=this._handles;if(!a.has(h.Main)){var m=()=>{a.has(h.PointerMove)||a.add(b.on("pointer-move",
c=>{this._screenPoint=c=r.createScreenPoint(c.x,c.y);this._throttledUpdateAccumulatedShadowTime(b,c)}),h.PointerMove)},k=()=>{a.remove(h.PointerMove);this._accumulatedShadowTime=this._screenPoint=null};a.add([this._throttledUpdateAccumulatedShadowTime,b.on("pointer-enter",m),b.on("pointer-leave",k),b.on("pointer-down",k),b.on("pointer-drag",k),b.on("pointer-up",m),b.on("click",c=>{this._screenPoint=c=r.createScreenPoint(c.x,c.y);this._updateAccumulatedShadowTime(b,c)}),x.makeHandle(()=>{this._shadowTimeTask=
n.abortMaybe(this._shadowTimeTask)})],h.Main);m()}};f._stopTracking=function(){this._handles.remove(h.Main)};p._createClass(l,[{key:"screenPoint",get:function(){return this.enabled?this._screenPoint:null}},{key:"accumulatedShadowTime",get:function(){return this.enabled?this._accumulatedShadowTime:null}},{key:"testData",get:function(){return{setThrottleDelay:b=>{this._throttledUpdateAccumulatedShadowTime.remove();this._throttledUpdateAccumulatedShadowTime=t.throttle(this._updateAccumulatedShadowTime,
b)}}}}]);return l}(u);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"getDuration",void 0);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"view",void 0);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"enabled",void 0);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"screenPoint",null);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"accumulatedShadowTime",null);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,
"_screenPoint",void 0);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"_accumulatedShadowTime",void 0);e.__decorate([g.property()],d.ShadowTooltipViewModel.prototype,"_shadowTimeTask",void 0);d.ShadowTooltipViewModel=e.__decorate([y.subclass("esri.widgets.ShadowCast.ShadowTooltipViewModel")],d.ShadowTooltipViewModel);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});