// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ScaleRanges ../Slider/SliderViewModel".split(" "),function(m,f,e,p,g,w,x,y,r,q,t){e=function(c){function k(a){a=u.call(this,a);a.layer=null;a.scaleRanges=q.fromScaleRange({minScale:0,maxScale:0});({max:b}=a._getSliderIndexRange(a.scaleRanges.length-
1));var b=new t({precision:10,min:0,max:b,values:[0,b]});a.sliderViewModel=b;return a}m._inherits(k,c);var u=m._createSuper(k);c=k.prototype;c.initialize=function(){this.own([p.watch(()=>({loaded:this.layer?.loaded,ready:this.view?.ready}),({loaded:a,ready:b})=>{a&&b&&(this._hasTiledLayer()&&(a=this._getLayerResampling()?void 0:this.mapScaleToSlider(this._getTiledLayerMaxScale()),b=this.mapScaleToSlider(this._getTiledLayerMinScale()),this.sliderViewModel.effectiveMax=a,this.sliderViewModel.effectiveMin=
b),(a=this.layer)&&"minScale"in a&&"maxScale"in a?(this.minScale=a.minScale,this.maxScale=a.maxScale):this.maxScale=this.minScale=void 0)},p.initial)])};c.mapScaleToSlider=function(a){const b=this.scaleRanges.scaleToRangeIndex(a),d=this.scaleRanges.findScaleRangeByIndex(b),{maxScale:h,minScale:l}=d,{max:n,min:v}=this._getSliderIndexRange(b);return this._mapToRange(a,l,h,v,n)};c.mapSliderToScale=function(a){const b=this.scaleRanges.findScaleRangeByIndex(a),{maxScale:d,minScale:h}=b,{max:l,min:n}=this._getSliderIndexRange(a);
return this._mapToRange(a,n,l,h,d)};c._setSliderRange=function(a){this.scaleRanges=q.fromScaleRange(a);({max:a}=this._getSliderIndexRange(this.scaleRanges.length-1));this.sliderViewModel.max=a;this.sliderViewModel.min=0;this.notifyChange("maxScaleLimit");this.notifyChange("minScaleLimit")};c._getSliderIndexRange=function(a){a=Math.floor(a);return{min:a,max:a+.99999}};c._mapToRange=function(a,b,d,h,l){return h+(a-b)*(l-h)/(d-b)};c._setMaxScaleOnSlider=function(a){const {scaleRanges:b,sliderViewModel:d}=
this;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMaxScaleToLayer(b.clampMaxScale(a))),d.values=[d.values[0],a])};c._setMinScaleOnSlider=function(a){const {scaleRanges:b,sliderViewModel:d}=this;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMinScaleToLayer(b.clampMinScale(a))),d.values=[a,d.values[1]])};c._constrainMinScaleToLayer=function(a){var {scaleRanges:b}=this;if(this._hasTiledLayer()){({firstRange:b}=b);const d=this._getTiledLayerMinScale();a=.85<this._mapToRange(a,b.maxScale,
b.minScale,0,1)?d:a>d?d:a}return a};c._constrainMaxScaleToLayer=function(a){if(this._hasTiledLayer()&&!this._getLayerResampling()){const b=this._getTiledLayerMaxScale();a=a<b?b:a}return a};c._normalizeScale=function(a,b){var d="max"===a?"maxScale":"minScale";d=this._hasTiledLayer()?"min"===a?this._getTiledLayerMinScale():this._getTiledLayerMaxScale():this.scaleRanges[d];a=this._hasTiledLayer()?"min"===a?this._getTiledLayerRealMinScale():this._getTiledLayerRealMaxScale():d;return Number((0===b||a===
b||1E-6>=Math.abs(a-b)?0:b).toFixed(6))};c._getLayerLODS=function(){return this.layer?.loaded&&"tileInfo"in this.layer?"imagery-tile"===this.layer?.type&&"Raster"===this.layer.raster?.tileType?null:this.layer.tileInfo?.lods:null};c._getLayerResampling=function(){return this.layer?.loaded?"resampling"in this.layer?this.layer.resampling:!0:!1};c._getTiledLayerMinScale=function(){const a=this._getLayerLODS();return this.scaleRanges.clampMinScale(a[0].scale)};c._getTiledLayerMaxScale=function(){const a=
this._getLayerLODS();return a[a.length-1].scale};c._getTiledLayerRealMinScale=function(){const a=this._getLayerLODS(),b=this.layer;return this.scaleRanges.clampMinScale((b&&"sourceJSON"in b?b.sourceJSON?.tileInfo?.lods??a:a)[0].scale)};c._getTiledLayerRealMaxScale=function(){var a=this._getLayerLODS();const b=this.layer;a=b&&"sourceJSON"in b?b.sourceJSON?.tileInfo?.lods??a:a;return a[a.length-1].scale};c._hasTiledLayer=function(){return!!this._getLayerLODS()};m._createClass(k,[{key:"effectiveMaxScale",
get:function(){return 0===this.maxScale?this.maxScaleLimit:this.maxScale}},{key:"effectiveMinScale",get:function(){return 0===this.minScale?this.minScaleLimit:this.minScale}},{key:"effectiveMaxScaleLimit",get:function(){return this.mapSliderToScale(this._hasTiledLayer()&&!this._getLayerResampling()?this.sliderViewModel.effectiveMax:this.sliderViewModel.max)}},{key:"effectiveMinScaleLimit",get:function(){return this.mapSliderToScale(this._hasTiledLayer()?this.sliderViewModel.effectiveMin:this.sliderViewModel.min)}},
{key:"maxScale",get:function(){const a=this.mapSliderToScale(this.sliderViewModel.values[1]);return this._normalizeScale("max",a)},set:function(a){this._setMaxScaleOnSlider(a)}},{key:"maxScaleLimit",get:function(){return this.mapSliderToScale(this.sliderViewModel.max)},set:function(a){this._setSliderRange({maxScale:a,minScale:this.minScaleLimit})}},{key:"minScale",get:function(){const a=this.mapSliderToScale(this.sliderViewModel.values[0]);return this._normalizeScale("min",a)},set:function(a){this._setMinScaleOnSlider(a)}},
{key:"minScaleLimit",get:function(){return this.mapSliderToScale(this.sliderViewModel.min)},set:function(a){this._setSliderRange({maxScale:this.maxScaleLimit,minScale:a})}},{key:"state",get:function(){const {view:a,layer:b}=this;return!a&&!b||!a&&b&&b.loaded||!b&&a&&a.ready||a&&a.ready&&b&&b.loaded?"ready":"disabled"}},{key:"view",set:function(a){this._set("view",a)}}]);return k}(e);f.__decorate([g.property({readOnly:!0})],e.prototype,"effectiveMaxScale",null);f.__decorate([g.property({readOnly:!0})],
e.prototype,"effectiveMinScale",null);f.__decorate([g.property()],e.prototype,"effectiveMaxScaleLimit",null);f.__decorate([g.property()],e.prototype,"effectiveMinScaleLimit",null);f.__decorate([g.property()],e.prototype,"layer",void 0);f.__decorate([g.property()],e.prototype,"maxScale",null);f.__decorate([g.property()],e.prototype,"maxScaleLimit",null);f.__decorate([g.property()],e.prototype,"minScale",null);f.__decorate([g.property()],e.prototype,"minScaleLimit",null);f.__decorate([g.property()],
e.prototype,"scaleRanges",void 0);f.__decorate([g.property()],e.prototype,"sliderViewModel",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"state",null);f.__decorate([g.property()],e.prototype,"view",null);return e=f.__decorate([r.subclass("esri.widgets.ScaleRangeSlider.ScaleRangeSliderViewModel")],e)});