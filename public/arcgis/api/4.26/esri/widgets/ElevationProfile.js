// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/asyncUtils ../core/maybe ../core/memoize ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./ElevationProfile/css ./ElevationProfile/ElevationProfileViewModel ./ElevationProfile/ElevationProfileVisibleElements ./ElevationProfile/components/Legend ./ElevationProfile/components/SettingsButton ./ElevationProfile/support/chartUtils ./ElevationProfile/support/constants ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(v,e,B,k,x,C,q,f,d,M,N,D,E,h,y,z,F,G,H,l,I,w,m){var n;(function(c){c.Sketch="sketch";c.SketchCancel="sketch-cancel";c.SketchDone="sketch-done";c.Select="select";c.SelectCancel="select-cancel"})(n||(n={}));const r=[{type:n.Select},{type:n.Sketch}],J={[l.ElevationProfileErrorState.None]:null,[l.ElevationProfileErrorState.NoValidInput]:"noProfile",[l.ElevationProfileErrorState.NoVisibleProfiles]:"noProfile",[l.ElevationProfileErrorState.RefinedButNoChartData]:"noProfile",[l.ElevationProfileErrorState.TooComplex]:"tooComplex",
[l.ElevationProfileErrorState.UnknownError]:"unknown",[l.ElevationProfileErrorState.InvalidGeometry]:"invalidGeometry",[l.ElevationProfileErrorState.InvalidElevationInfo]:"invalidElevationInfo"},A=Symbol("resize-observer-handle");d=function(c){function t(a,b){b=K.call(this,a,b);b.viewModel=null;b.visibleElements=new z;b.iconClass=h.CSS.widgetIcon;b.messages=null;b.messagesCommon=null;b.messagesUnits=null;b._chartContainer=null;b._chart=null;b._chartInitTask=null;b._chartIsRefined=!1;b._width=0;b._zoomOutButtonVisible=
!1;b._getChartUpdateParamsMemoized=x.memoize((g,p,u,L)=>({chart:g,data:p,stationary:u,messages:L}));b._getDetailsPropsMemoized=x.memoize((g,p)=>({effectiveUnits:g,profiles:p}));a?.viewModel||(b._defaultViewModel=new y({view:a?.view}),b.viewModel=b._defaultViewModel);return b}v._inherits(t,c);var K=v._createSuper(t);c=t.prototype;c.initialize=function(){this._legend=new F.Legend(this._legendProps);this._settingsButton=new G.SettingsButton(this._settingsButtonProps);this.addHandles([q.watch(()=>this._legendProps,
a=>this._legend.set(a)),q.watch(()=>this._settingsButtonProps,a=>this._settingsButton.set(a))])};c.postInitialize=function(){this.addHandles([q.watch(()=>({container:this._chartContainer,width:this._width}),({container:a,width:b})=>{this._destroyChart();k.isSome(a)&&0<b&&this._initializeChart(a)},q.initial),q.watch(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),q.initial)])};c.destroy=function(){this._destroyChart();k.isSome(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&
this._defaultViewModel.destroy();this._legend=k.destroyMaybe(this._legend);this._settingsButton=k.destroyMaybe(this._settingsButton)};c.render=function(){const {viewModel:a,visible:b}=this;return m.tsx("div",{key:this,class:this.classes({[h.CSS.base]:b,[h.CSS.esriWidget]:b,[h.CSS.esriWidgetDisabled]:b&&"disabled"===a.state,[h.CSS.portrait]:this._portrait,[h.CSS.refined]:1===a.progress}),"aria-label":this.messages.widgetLabel},m.tsx("div",{key:"content-wrapper",bind:this,afterCreate:this._onContentWrapperAfterCreate,
afterRemoved:this._onContentWrapperRemoved},b&&this._renderContentForState()))};c._renderContentForState=function(){switch(this.viewModel.state){case l.ElevationProfileState.Ready:return this._renderContentForReadyState();case l.ElevationProfileState.Selecting:return this._renderContentForSelectingState();case l.ElevationProfileState.Creating:return this._renderContentForCreatingState();case l.ElevationProfileState.Selected:return this._renderContentForSelectedState();case l.ElevationProfileState.Created:return this._renderContentForCreatedState();
case l.ElevationProfileState.Disabled:return this._renderContentForReadyState()}};c._renderContentForReadyState=function(){const {sketchButton:a,selectButton:b}=this.visibleElements,g=this.messages;return this._renderContent({prompt:a&&b?g.readyPrompt:a?g.readyPromptCreateOnly:b?g.readyPromptSelectOnly:g.errors?.noProfile,chart:!1,actions:r})};c._renderContentForSelectingState=function(){const a=this.view;return k.isNone(a)?null:this._renderContent({prompt:this.messages[`selectingPrompt-${a.type}`],
chart:!1,actions:[{type:n.SelectCancel}]})};c._renderContentForCreatingState=function(){const {view:a,viewModel:b}=this;if(k.isNone(a))return null;const g=b.hasVertices?[{type:n.SketchCancel},{type:n.SketchDone,disabled:!b.tool.interaction.canStopCreating}]:[{type:n.Select},{type:n.Sketch,disabled:!0}];if(b.errorState===l.ElevationProfileErrorState.NoValidInput)return this._renderContent({chart:!1,actions:g,prompt:this.messages[`creatingPrompt-${a.type}`]});const p=this._getErrorMessage();return p?
this._renderContent({chart:!1,actions:g,prompt:p}):this._renderContent({chart:!0,actions:g})};c._renderContentForSelectedState=function(){const a=this._getErrorMessage();return a?this._renderContent({chart:!1,actions:r,prompt:a}):this._renderContent({chart:!0,actions:r})};c._renderContentForCreatedState=function(){const a=this._getErrorMessage();return a?this._renderContent({chart:!1,actions:r,prompt:a}):this._renderContent({chart:!0,actions:r})};c._getErrorMessage=function(){const a=J[this.viewModel.errorState];
return a?this.messages?.errors?.[a]:null};c._renderContent=function(a){const b=k.isSome(a.prompt)?this._renderPrompt(a.prompt):a.chart&&this._renderChart(),g=k.isSome(this.viewModel.input);return[m.tsx("header",{key:"header",class:h.CSS.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&g&&this._renderClearButton(),this.visibleElements.settingsButton&&this._settingsButton.render()),m.tsx("div",{class:h.CSS.mainContainer},b),this.visibleElements.legend&&
this._legend.render(),this._renderActions(a)]};c._renderZoomOutButton=function(){return m.tsx("button",{key:"zoom-out",class:h.CSS.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut,type:"button"})};c._onZoomOutButtonClick=function(){k.applySome(this._chart,a=>a.zoomOut())};c._renderClearButton=function(){return m.tsx("button",{key:"clear-profile",class:h.CSS.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile,type:"button"})};
c._onClearButtonClick=function(){this.viewModel.clear()};c._renderPrompt=function(a){return[m.tsx("div",{key:"prompt-container",bind:this,class:h.CSS.promptContainer},m.tsx("p",null,a))]};c._renderChart=function(){if(!this.visibleElements.chart)return[m.tsx("div",{key:"empty-chart-container",class:h.CSS.chartContainer})];const a=this._chartIsRefined||this._canRenderChart();if(!a)return[this._renderSpinner({size:"large"}),m.tsx("div",{key:"chart-container-empty",class:h.CSS.chartContainer})];const {chartData:b,
progress:g}=this.viewModel;return[k.isSome(b)&&0<g&&1>g&&this._renderSpinner({size:a?"small":"large"}),m.tsx("div",{key:"chart-container",bind:this,class:h.CSS.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]};c._renderSpinner=function(a){return m.tsx("div",{key:"spinner",class:this.classes(h.CSS.chartSpinner,{[h.CSS.chartSpinnerSmall]:"small"===a.size}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})};c._onSpinnerAfterCreate=
function(a){requestAnimationFrame(()=>a.classList.add(h.CSS.chartSpinnerVisible))};c._onSpinnerExit=function(a,b){a.classList.remove(h.CSS.chartSpinnerVisible);setTimeout(b,200)};c._canRenderChart=function(){const a=this.viewModel.chartData;if(k.isNone(a))return!1;if(!this.viewModel.inputIsSketched)return a.refined;let b=0;for(const {samples:g}of a.lines)b+=k.isSome(g)?g.length:0;return a.refined||b<=l.getConfig().largeChartSamples};c._renderActions=function({actions:a}){a=a.map(b=>{switch(b.type){case n.Sketch:return this.visibleElements.sketchButton&&
this._renderAction({action:b,onClick:this._onSketchButtonClick,className:h.CSS.sketchButton,label:this.messages.sketchButtonLabel});case n.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:b,onClick:this._onCancelButtonClick,className:h.CSS.sketchCancelButton,label:this.messagesCommon.cancel});case n.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:b,onClick:this._onDoneButtonClick,className:h.CSS.sketchDoneButton,label:this.messagesCommon.done});
case n.Select:return this.visibleElements.selectButton&&this._renderAction({action:b,onClick:this._onSelectButtonClick,className:h.CSS.selectButton,label:this.messages.selectButtonLabel});case n.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:b,onClick:this._onCancelButtonClick,className:h.CSS.selectCancelButton,label:this.messagesCommon.cancel})}}).filter(Boolean);return a.length?m.tsx("footer",{key:"footer",class:h.CSS.footer},a):null};c._renderAction=function({action:a,
onClick:b,className:g,label:p}){return m.tsx("button",{key:`action-${a.type}`,class:this.classes(h.CSS.actionButton,g,{[h.CSS.buttonDisabled]:!!a.disabled}),bind:this,disabled:a.disabled,onclick:b,type:"button"},p)};c._onSketchButtonClick=function(){this.viewModel.start({mode:"sketch"})};c._onSelectButtonClick=function(){this.viewModel.start({mode:"select"})};c._onCancelButtonClick=function(){this.viewModel.cancel()};c._onDoneButtonClick=function(){this.viewModel.stop()};c._onContentWrapperAfterCreate=
function(a){a=I.onResize(a,b=>{this._width=b.contentRect.width});this.addHandles(a,A)};c._onContentWrapperRemoved=function(){this.removeHandles(A)};c._updateChart=function(a){const {data:b,chart:g,messages:p,stationary:u}=a;!k.isNone(g)&&!k.isNone(p)&&u&&this._canRenderChart()&&(g.update(a),this._chartIsRefined=k.isSome(b)&&b.refined)};c._onChartContainerAfterCreate=function(a){this._chartContainer=a};c._onChartContainerRemoved=function(){this._chartContainer=null};c._initializeChart=function(a){k.abortMaybe(this._chartInitTask);
this._chartInitTask=B.createTask(async b=>{const g=await H.createChart({container:a,abortOptions:{signal:b},onRangeChange:(p,u)=>{this._zoomOutButtonVisible=1!==p||1!==u},onCursorPositionChange:p=>{this.viewModel.hoveredChartPosition=p}});if(b.aborted)throw k.destroyMaybe(g),C.createAbortError();this._chart=g;this._updateChart(this._chartUpdateParams)})};c._destroyChart=function(){this._chartInitTask=k.abortMaybe(this._chartInitTask);this._chart=k.destroyMaybe(this._chart);this._chartIsRefined=!1};
v._createClass(t,[{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}},{key:"input",get:function(){return this.viewModel.input},set:function(a){this.viewModel.input=a}},{key:"profiles",get:function(){return this.viewModel.profiles},set:function(a){this.viewModel.profiles=a}},{key:"unitOptions",get:function(){return this.viewModel.unitOptions},set:function(a){this.viewModel.unitOptions=a}},{key:"unit",get:function(){return this.viewModel.unit},set:function(a){this.viewModel.unit=
a}},{key:"geodesicDistanceThreshold",get:function(){return this.viewModel.geodesicDistanceThreshold},set:function(a){this.viewModel.geodesicDistanceThreshold=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"visible",get:function(){return this.viewModel.visible},set:function(a){this.viewModel.visible=a}},{key:"_portrait",get:function(){return this._width<l.getConfig().portraitModePixelBreakpoint}},{key:"_chartUpdateParams",
get:function(){const a=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,k.isSome(a)?a.stationary:!0,this._chartMessages)}},{key:"_chartMessages",get:function(){return{...this.messagesUnits,...this.messages}}},{key:"_legendProps",get:function(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,this._profilesArray)}},{key:"_profilesArray",get:function(){return this.profiles.toArray()}},{key:"_settingsButtonProps",get:function(){return{viewModel:this.viewModel,
visibleElements:this.visibleElements}}},{key:"test",get:function(){return{chart:this._chart}}}]);return t}(E);e.__decorate([f.property({type:y})],d.prototype,"viewModel",void 0);e.__decorate([f.property()],d.prototype,"view",null);e.__decorate([f.property()],d.prototype,"input",null);e.__decorate([f.property()],d.prototype,"profiles",null);e.__decorate([f.property()],d.prototype,"unitOptions",null);e.__decorate([f.property()],d.prototype,"unit",null);e.__decorate([f.property()],d.prototype,"geodesicDistanceThreshold",
null);e.__decorate([f.property({type:z,nonNullable:!0})],d.prototype,"visibleElements",void 0);e.__decorate([f.property()],d.prototype,"iconClass",void 0);e.__decorate([f.property()],d.prototype,"label",null);e.__decorate([f.property()],d.prototype,"visible",null);e.__decorate([f.property(),w.messageBundle("esri/widgets/ElevationProfile/t9n/ElevationProfile")],d.prototype,"messages",void 0);e.__decorate([f.property(),w.messageBundle("esri/t9n/common")],d.prototype,"messagesCommon",void 0);e.__decorate([f.property(),
w.messageBundle("esri/core/t9n/Units")],d.prototype,"messagesUnits",void 0);e.__decorate([f.property()],d.prototype,"_chartContainer",void 0);e.__decorate([f.property()],d.prototype,"_chart",void 0);e.__decorate([f.property()],d.prototype,"_chartInitTask",void 0);e.__decorate([f.property()],d.prototype,"_chartIsRefined",void 0);e.__decorate([f.property()],d.prototype,"_settingsButton",void 0);e.__decorate([f.property()],d.prototype,"_legend",void 0);e.__decorate([f.property()],d.prototype,"_width",
void 0);e.__decorate([f.property()],d.prototype,"_portrait",null);e.__decorate([f.property()],d.prototype,"_zoomOutButtonVisible",void 0);e.__decorate([f.property()],d.prototype,"_chartUpdateParams",null);e.__decorate([f.property()],d.prototype,"_chartMessages",null);e.__decorate([f.property()],d.prototype,"_legendProps",null);e.__decorate([f.property()],d.prototype,"_profilesArray",null);e.__decorate([f.property()],d.prototype,"_settingsButtonProps",null);return d=e.__decorate([D.subclass("esri.widgets.ElevationProfile")],
d)});