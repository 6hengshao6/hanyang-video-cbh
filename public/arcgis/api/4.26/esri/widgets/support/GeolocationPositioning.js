// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../assets ../../Graphic ../../core/Accessor ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../symbols/PictureMarkerSymbol ./geolocationUtils ./GoTo".split(" "),function(m,g,r,p,c,t,u,h,J,K,L,v,w,q,x){c=function(d){function l(){var a=y.apply(this,arguments);a._geolocationUsable=
!0;a._iconPath=r.getAssetUrl("esri/images/support/sdk_gps_location.png");a.geolocationOptions=null;a.goToLocationEnabled=!0;a.graphic=new p({symbol:new w({url:a._iconPath,width:21,height:21})});a.scale=null;a.useHeadingEnabled=!0;a.view=null;return a}m._inherits(l,d);var y=m._createSuper(l);d=l.prototype;d.initialize=function(){q.supported()||(this._geolocationUsable=!1)};d.destroy=function(){this._clear();this.view=null};d._clear=function(){const {view:a,graphic:b}=this;a&&b&&a.graphics.remove(b)};
d._getScaleWithinConstraints=function(a,b){if(!b)return a;if("2d"===b.type){const {effectiveMaxScale:e,effectiveMinScale:f}=b.constraints;return Math.min(f,Math.max(e,a))}return a};d._getScale=function(a){const {scale:b}=this;return this._getScaleWithinConstraints("number"===typeof b?b:2500,a)};d._getHeading=function(a,b){b=b?.spatialReference;a=a.coords?.heading;if(!(!b?.isWebMercator&&!b?.isGeographic||"number"!==typeof a||isNaN(a)||0>a||360<a))return a};d._addHeading=function(a){const {heading:b,
target:e,view:f}=a;f&&"number"===typeof b&&!isNaN(b)&&("3d"===f.type?e.heading=b:"2d"===f.type&&(e.rotation=360-b))};d._animatePoint=function(a,b,e,f){const {view:k}=this;if(!this.goToLocationEnabled||!k)return Promise.resolve(b);const n=this.useHeadingEnabled?this._getHeading(b,k):void 0;a={target:a,scale:e};this._addHeading({heading:n,target:a,view:k});return this.callGoTo({target:a,options:f}).then(()=>b)};d._setPosition=async function(a,b){try{const e=this.view,f=await q.positionToPoint({position:a,
view:e},b),{graphic:k}=this,{timestamp:n,coords:z}=a,{accuracy:A,altitude:B,altitudeAccuracy:C,heading:D,latitude:E,longitude:F,speed:G}=z,H={timestamp:n,accuracy:A,altitude:B,altitudeAccuracy:C,heading:D,latitude:E,longitude:F,speed:G};k&&(k.geometry=f,k.attributes=H);const I=this._getScale(e);return this._animatePoint(f,a,I,b)}catch(e){throw new t("positioning:invalid-point","Cannot position invalid point",{error:e});}};return m._createClass(l)}(x.GoToMixin(u.EventedMixin(c)));g.__decorate([h.property()],
c.prototype,"_geolocationUsable",void 0);g.__decorate([h.property()],c.prototype,"geolocationOptions",void 0);g.__decorate([h.property()],c.prototype,"goToLocationEnabled",void 0);g.__decorate([h.property({type:p,nonNullable:!0})],c.prototype,"graphic",void 0);g.__decorate([h.property()],c.prototype,"scale",void 0);g.__decorate([h.property()],c.prototype,"useHeadingEnabled",void 0);g.__decorate([h.property()],c.prototype,"view",void 0);return c=g.__decorate([v.subclass("esri.widgets.support.GeolocationPositioning")],
c)});