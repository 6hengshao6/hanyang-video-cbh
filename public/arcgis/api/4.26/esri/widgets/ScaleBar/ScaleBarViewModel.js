// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/Accessor ../../core/maybe ../../core/screenUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/geodesicUtils ../../geometry/support/normalizeUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/WKIDUnitConversion ../../geometry/SpatialReference ../../geometry/Polyline ../../geometry/Point".split(" "),
function(r,n,l,B,C,t,D,u,K,L,M,E,w,F,x,G,p,H,I,y){function z(g,h){const {x:m,y:a}="decimal-degrees"===g?G.webMercatorToGeographic(h,!0):h;return[m,a]}function A({state:{paddedViewState:g},spatialReference:h,width:m}){return h.isWrappable&&g.worldScreenWidth<m}l=function(g){function h(a){a=m.call(this,a);a.scaleComputedFrom=t.createScreenPoint();a.view=null;return a}r._inherits(h,g);var m=r._createSuper(h);g=h.prototype;g.getScaleBarProperties=function(a,b){if("disabled"===this.state||isNaN(a)||!b||
null==this.view)return null;const e=this._getDistanceInKm(this.view,this.scaleComputedFrom);return C.isNone(e)?null:"metric"===b?this._getScaleBarProps(a,e,"metric"):this._getScaleBarProps(a,e/1.609,"imperial")};g._getLocationUnit=function(){const {spatialReference:a}=this.view,{isWebMercator:b,wkid:e,wkt:d}=a;return b||d?.includes("WGS_1984_Web_Mercator")?"decimal-degrees":x.isValid(a)&&(null!=e&&p[e]||null!=d&&D.isProjectedWKT(d))?"linear-unit":"unknown"};g._getDistanceInKm=function(a,b){const {state:e,
spatialReference:d}=a;var c=this._getLocationUnit();if("linear-unit"===c){var k=e.extent.width;{const {wkid:v,wkt:q}=d;null!=v&&null!=p[v]?c=p.values[p[v]]:null!=q?(c=q.lastIndexOf(",")+1,a=q.lastIndexOf("]]"),c=parseFloat(q.substring(c,a))):c=1}return k*c/1E3}const [f,J]=this._getScaleMeasuringPoints(a,b);a="decimal-degrees"===c||d.isGeographic&&!w.isSupported(d)?H.WGS84:d;c=new I({paths:[[z(c,f),z(c,J)]],spatialReference:a});c=F.straightLineDensify(c,10);try{[k]=w.geodesicLengths([c],"kilometers")}catch{return null}return k};
g._getScaleMeasuringPoints=function(a,b){const {width:e,height:d,position:c,spatialReference:k}=a;if(A(a))return a=x.getInfo(k),{valid:b}=a,a=new y(b[0],0,k),b=new y(b[1],0,k),[a,b];var f=b.y-c[1];f>d?f=d:0>f&&(f=0);b=t.createScreenPoint(0,f);f=t.createScreenPoint(e,f);b=a.toMap(b);a=a.toMap(f);return[b,a]};g._getScaleBarProps=function(a,b,e){var d=this.view;d=A(d)?d.state.paddedViewState.worldScreenWidth:d.width;b=a*b/d;e="metric"===e?"kilometer":"mile";.1>b&&("mile"===e?(b*=5280,e="foot"):"kilometer"===
e&&(b*=1E3,e="meter"));for(d=0;1<=b;)b/=10,d++;var c=this._getConstraints(b);if(!c)return null;const {min:k,max:f}=c;c=f/b>=b/k?k:f;return{length:c/b*a,value:10**d*c,unit:e}};g._getConstraints=function(a){return.5<a?{min:.5,max:1}:.3<a?{min:.3,max:.5}:.2<a?{min:.2,max:.3}:.15<a?{min:.15,max:.2}:.1<=a?{min:.15,max:.1}:null};r._createClass(h,[{key:"state",get:function(){return this.view?.ready&&"2d"===this.view?.type?"ready":"disabled"}}]);return h}(B);n.__decorate([u.property()],l.prototype,"scaleComputedFrom",
void 0);n.__decorate([u.property({readOnly:!0})],l.prototype,"state",null);n.__decorate([u.property()],l.prototype,"view",void 0);return l=n.__decorate([E.subclass("esri.widgets.Scalebar.ScaleBarViewModel")],l)});