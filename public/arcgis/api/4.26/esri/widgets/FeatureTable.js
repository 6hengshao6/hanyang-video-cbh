// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/deprecate ../core/HandleOwner ../core/Logger ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./FeatureTable/FeatureTableViewModel ./FeatureTable/Grid/support/ButtonMenu ./FeatureTable/Grid/support/ButtonMenuItem ./support/componentsUtils ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(w,t,e,d,y,C,D,E,r,f,F,N,O,G,H,I,J,n,K,L,P,x,h,z){const A={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0,selectedRecordsShowAllToggle:!0,selectedRecordsShowSelectedToggle:!0,zoomToSelection:!0,deleteSelection:!0},selectionColumn:!0,columnMenus:!0},B=D.getLogger("esri.widgets.FeatureTable");d=function(b){function u(a,c){a=M.call(this,a,c);a._prompt=null;a.menu=null;a.menuConfig=null;a.viewModel=new I;a.visibleElements={...A};a._showDeletePrompt=a._showDeletePrompt.bind(t._assertThisInitialized(a));
a._onDeleteSelectionClick=a._onDeleteSelectionClick.bind(t._assertThisInitialized(a));return a}t._inherits(u,b);var M=t._createSuper(u);b=u.prototype;b.initialize=function(){this.handles.add([r.on(()=>this.viewModel.columns,"change",()=>this._syncMenuConfig()),r.on(()=>this.viewModel.activeFilters,"change",()=>this._syncMenuConfig()),r.on(()=>this.highlightIds,"change",g=>{this._syncMenuConfig();this._onSelectionChange(g)}),r.watch(()=>[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled],
()=>this.scheduleRender()),r.watch(()=>[this.menuConfig,this.editingEnabled],()=>this._syncMenuConfig()),r.watch(()=>this.messages,()=>{this.menu&&(this.menu.label=this.messages?.options);this._syncMenuConfig()})]);this._set("menu",new J({label:this.messages?.options,iconClass:"esri-icon-handle-horizontal",...this.menuConfig}));const {attachmentsEnabled:a,relatedRecordsEnabled:c}=this;this.viewModel?.store?.set({attachmentsEnabled:a,relatedRecordsEnabled:c})};b.loadDependencies=function(){return K.loadCalciteComponents({button:()=>
new Promise((a,c)=>w(["../chunks/calcite-button"],a,c)),icon:()=>new Promise((a,c)=>w(["../chunks/calcite-icon"],a,c)),scrim:()=>new Promise((a,c)=>w(["../chunks/calcite-scrim"],a,c))})};b.destroy=function(){this._prompt=null;this.handles.removeAll();this.menu?.destroy()};b.castVisibleElements=function(a){a={...A,...a};this.grid?.set("visibleElements",{...this.grid.visibleElements,selectionColumn:a.selectionColumn,columnMenus:a.columnMenus});return a};b.clearHighlights=function(){y.deprecatedFunction(B,
"`FeatureTable.clearHighlights` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"});return this.viewModel.clearHighlights()};b.clearSelection=function(){y.deprecatedFunction(B,"`FeatureTable.clearSelection` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"});
return this.viewModel.clearSelection()};b.clearSelectionFilter=function(){return this.viewModel.clearSelectionFilter()};b.deleteSelection=function(a){return this.highlightIds.length?a?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()};b.deselectRows=function(a){return this.viewModel.deselectRows(a)};b.filterBySelection=function(){return this.viewModel.filterBySelection()};b.findColumn=function(a){return this.viewModel.findColumn(a)};
b.hideColumn=function(a){this.grid?.hideColumn(a);this._syncMenuConfig()};b.refresh=function(){return this.viewModel.refresh()};b.showAllColumns=function(){return this.viewModel.showAllColumns()};b.showColumn=function(a){this.grid?.showColumn(a);this._syncMenuConfig()};b.sortColumn=function(a,c){return this.viewModel.sortColumn(a,c)};b.selectRows=function(a){return this.viewModel.selectRows(a)};b.scrollToIndex=function(a){return this.viewModel.scrollToIndex(a)};b.zoomToSelection=function(){return this.viewModel.zoomToSelection()};
b.render=function(){var {_prompt:a}=this;a=E.isSome(a)?h.tsx("calcite-scrim",null,this.renderPrompt(a)):null;return h.tsx("div",{bind:this,class:this.classes("esri-feature-table","esri-widget")},this.visibleElements.header?this._renderHeader():null,h.tsx("div",{class:"esri-feature-table__content"},"disabled"!==this.state&&this.grid?.render()),a)};b.renderPrompt=function({title:a,message:c,context:g,actions:l}){const k=h.tsx("calcite-button",{appearance:"solid",kind:"danger"===g?"danger":"brand",width:l.secondary?
"half":"full",onclick:l.primary.action,key:"prompt-primary-button"},l.primary.label);l=l.secondary?h.tsx("calcite-button",{appearance:"outline",kind:"danger"===g?"danger":"brand",width:"half",onclick:l.secondary.action,key:"prompt-secondary-button"},l.secondary.label):null;return h.tsx("div",{class:`${"esri-feature-table__prompt"}--${g}`},h.tsx("div",{class:"esri-feature-table__prompt__header"},h.tsx("calcite-icon",{icon:"exclamation-mark-triangle"}),h.tsx(L.Heading,{class:"esri-feature-table__prompt__header__heading",
level:2},a)),h.tsx("div",{class:"esri-feature-table__prompt__message"},c),h.tsx("div",{class:"esri-feature-table__prompt__divider"}),h.tsx("div",{class:"esri-feature-table__prompt__actions"},l,k))};b._renderHeader=function(){return h.tsx("div",{key:"header",class:"esri-feature-table__header"},this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)};b._renderTitle=function(){return h.tsx("div",{class:"esri-feature-table__title",key:"title"},this._getTitle())};b._getTitle=
function(){const {grid:a,highlightIds:c,layer:g,messages:l,viewModel:{size:k}}=this;return a&&g?z.substitute(l.header,{title:g.title,count:k,selected:c.length||0}):""};b._renderLoader=function(){const {state:a,store:c}=this.viewModel;return h.tsx("div",{class:"esri-feature-table__loader-container"},"loading"===a||c.syncing||c.querying?h.tsx("div",{class:"esri-feature-table__loader",key:"loader"}):null)};b._renderMenu=function(){return h.tsx("div",{class:"esri-feature-table__menu"},this.menu?.render())};
b._onSelectionChange=function(a){const {added:c,removed:g}=a;a=c.map(k=>this.viewModel.store.getLocalItemByKey(k)||{objectId:k,feature:null,attachments:null,relatedRecords:null});const l=g.map(k=>this.viewModel.store.getLocalItemByKey(k)||{objectId:k,feature:null,attachments:null,relatedRecords:null});this.emit("selection-change",{added:a,removed:l})};b._syncMenuConfig=function(){this.menu?.set({...this.menuConfig,items:this._getMenuItems()})};b._getMenuItems=function(){const a=this.menuConfig?.items,
c=this._getDefaultMenuItems(),g=[];c?.length&&g.push(...c);a?.length&&g.push(...a);return g};b._getDefaultMenuItems=function(){const {highlightIds:a,messages:c,viewModel:g,visibleElements:l}=this,{menuItems:k}=l,m=[];k?.refreshData&&m.push(new n({selectionEnabled:!1,label:c?.refreshData,clickFunction:()=>this.refresh()}));if(a.length){const p=this._getSelectionFilter();k?.clearSelection&&m.push(new n({selectionEnabled:!1,label:c?.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()}));
k?.zoomToSelection&&this.view&&m.push(new n({selectionEnabled:!1,label:c?.zoomToSelection,clickFunction:()=>this.viewModel.zoomToSelection()}));if(k?.selectedRecordsShowSelectedToggle&&(!p||a.length!==p.objectIds.length)){const q=c.showSelected,v=new n({selectionEnabled:!1,label:q,clickFunction:()=>{this.filterBySelection();v.set("label",q)}});m.push(v)}k?.deleteSelection&&this.editingEnabled&&this.layer?.capabilities?.operations?.supportsDelete&&m.push(new n({selectionEnabled:!1,label:c.deleteSelection,
clickFunction:this._showDeletePrompt}))}if(k?.selectedRecordsShowAllToggle&&this._hasSelectionFilter()){const p=c.showAllRecords,q=new n({selectionEnabled:!1,label:p,clickFunction:()=>{this.clearSelectionFilter();q.set("label",p)}});m.push(q)}k?.toggleColumns&&m.push(new n({iconClass:"esri-icon-right",label:c?.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:g?.columns?.items.map(({header:p,hidden:q,path:v})=>new n({label:p||v,selected:!q,selectionEnabled:!0,iconClass:"esri-icon-check-mark",
clickFunction:()=>this._toggleColumnFromMenuItem(v)}))}));return m.length?m:null};b._toggleMenuItemSelectedIcon=function({item:a}){a?.set("iconClass",a?.selected?"esri-icon-down":"esri-icon-right")};b._toggleColumnFromMenuItem=function(a){const {grid:c,viewModel:g}=this;g.findColumn(a)?.hidden?c?.showColumn(a):c?.hideColumn(a)};b._showDeletePrompt=function(){const {messages:a,messagesCommon:c}=this,g=z.substitute(a.deleteSelectionCount,{count:this.highlightIds.length||0});this.menu&&(this.menu.open=
!1);this._prompt={title:g,message:a.deleteRecordsRemoved,context:"danger",actions:{primary:{label:c.delete,action:this._onDeleteSelectionClick},secondary:{label:a.keepRecords,action:()=>this._prompt=null}}}};b._onDeleteSelectionClick=async function(){await this.viewModel.deleteSelection();this._prompt=null};b._getSelectionFilter=function(){return this.viewModel.activeFilters?.find(a=>"selection"===a.type)};b._hasSelectionFilter=function(){return!!this._getSelectionFilter()};t._createClass(u,[{key:"activeFilters",
get:function(){return this.viewModel.activeFilters}},{key:"activeSortOrders",get:function(){return this.viewModel.activeSortOrders}},{key:"attachmentsEnabled",get:function(){return this.viewModel.attachmentsEnabled},set:function(a){this.viewModel.attachmentsEnabled=a}},{key:"autoRefreshEnabled",get:function(){return this.viewModel.autoRefreshEnabled},set:function(a){this.viewModel.autoRefreshEnabled=a}},{key:"columnReorderingEnabled",get:function(){return this.viewModel.columnReorderingEnabled},set:function(a){this.viewModel.columnReorderingEnabled=
a}},{key:"columns",get:function(){return this.viewModel.columns}},{key:"editingEnabled",get:function(){return this.viewModel.editingEnabled},set:function(a){this.viewModel.editingEnabled=a}},{key:"fieldConfigs",get:function(){return this.viewModel.fieldConfigs??[]},set:function(a){this.viewModel.fieldConfigs=a}},{key:"filterGeometry",get:function(){return this.viewModel.filterGeometry},set:function(a){this.viewModel.filterGeometry=a}},{key:"grid",get:function(){return this.viewModel.grid}},{key:"hiddenFields",
get:function(){return this.viewModel.hiddenFields},set:function(a){this.viewModel.hiddenFields=a}},{key:"highlightEnabled",get:function(){return this.viewModel.highlightEnabled},set:function(a){this.viewModel.highlightEnabled=a}},{key:"highlightIds",get:function(){return this.viewModel.highlightIds},set:function(a){this.viewModel.highlightIds=a}},{key:"highlightOnRowSelectEnabled",get:function(){return this.viewModel.highlightEnabled},set:function(a){this.viewModel.highlightEnabled=a}},{key:"label",
get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"layer",get:function(){return this.viewModel.layer},set:function(a){this.viewModel.layer=a}},{key:"messages",get:function(){return this.viewModel.messages},set:function(a){this.viewModel.messages=a}},{key:"messagesCommon",get:function(){return this.viewModel.messagesCommon},set:function(a){this.viewModel.messagesCommon=a}},{key:"messagesURIUtils",get:function(){return this.viewModel.messagesURIUtils},
set:function(a){this.viewModel.messagesURIUtils=a}},{key:"multiSortEnabled",get:function(){return this.viewModel.multiSortEnabled},set:function(a){this.viewModel.multiSortEnabled=a}},{key:"pageSize",get:function(){return this.viewModel.pageSize},set:function(a){this.viewModel.pageSize=a}},{key:"relatedRecordsEnabled",get:function(){return this.viewModel.relatedRecordsEnabled},set:function(a){this.viewModel.relatedRecordsEnabled=a}},{key:"state",get:function(){return this.viewModel.state}},{key:"tableTemplate",
get:function(){return this.viewModel.tableTemplate},set:function(a){this.viewModel.tableTemplate=a}},{key:"timeExtent",get:function(){return this.viewModel.timeExtent},set:function(a){this.viewModel.timeExtent=a}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}}]);return u}(C.HandleOwnerMixin(H));e.__decorate([f.property({readOnly:!0})],d.prototype,"activeFilters",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"activeSortOrders",null);e.__decorate([f.property()],
d.prototype,"attachmentsEnabled",null);e.__decorate([f.property()],d.prototype,"autoRefreshEnabled",null);e.__decorate([f.property()],d.prototype,"columnReorderingEnabled",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"columns",null);e.__decorate([f.property()],d.prototype,"editingEnabled",null);e.__decorate([f.property()],d.prototype,"fieldConfigs",null);e.__decorate([f.property()],d.prototype,"filterGeometry",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"grid",null);e.__decorate([f.property()],
d.prototype,"hiddenFields",null);e.__decorate([f.property()],d.prototype,"highlightEnabled",null);e.__decorate([f.property()],d.prototype,"highlightIds",null);e.__decorate([f.property()],d.prototype,"highlightOnRowSelectEnabled",null);e.__decorate([f.property()],d.prototype,"label",null);e.__decorate([f.property()],d.prototype,"layer",null);e.__decorate([f.property(),x.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],d.prototype,"messages",null);e.__decorate([f.property(),x.messageBundle("esri/t9n/common")],
d.prototype,"messagesCommon",null);e.__decorate([f.property(),x.messageBundle("esri/widgets/support/t9n/uriUtils")],d.prototype,"messagesURIUtils",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"menu",void 0);e.__decorate([f.property()],d.prototype,"menuConfig",void 0);e.__decorate([f.property()],d.prototype,"multiSortEnabled",null);e.__decorate([f.property()],d.prototype,"pageSize",null);e.__decorate([f.property()],d.prototype,"relatedRecordsEnabled",null);e.__decorate([f.property({readOnly:!0})],
d.prototype,"state",null);e.__decorate([f.property()],d.prototype,"tableTemplate",null);e.__decorate([f.property()],d.prototype,"timeExtent",null);e.__decorate([f.property()],d.prototype,"view",null);e.__decorate([f.property()],d.prototype,"viewModel",void 0);e.__decorate([f.property()],d.prototype,"visibleElements",void 0);e.__decorate([F.cast("visibleElements")],d.prototype,"castVisibleElements",null);return d=e.__decorate([G.subclass("esri.widgets.FeatureTable")],d)});