// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/HandleOwner ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(h,c,l,b,m,d,q,r,t,n){b=function(e){function g(a){a=p.call(this,a);a._indexHistory=[];a._lastStepIndex=-1;a._stepIndex=-1;a._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"};
a.data=void 0;a.started=!1;a.steps=[];a.type=null;return a}h._inherits(g,e);var p=h._createSuper(g);e=g.prototype;e.cancel=async function(a={force:!0}){return!1!==a.force?this._cancel():new Promise((f,k)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel().then(f)},deny:()=>k(new l("workflow:cancel-denied","Request to cancel workflow was denied."))}})})};e.commit=async function(){this.handles.remove(this._handleKeys.beforeCommit);await this.onCommit(this.data);this.handles.remove(this._handleKeys.afterCommit);
this.emit("commit");this.started&&await this.reset()};e.go=async function(a){var {steps:f}=this;f=f.findIndex(k=>k.id===a);this._indexHistory.push(this._stepIndex);await this._go(f)};e.next=async function(){this._indexHistory.push(this._stepIndex);await this._go(this._stepIndex+1)};e.previous=async function(a={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),a.cancelCurrentStep)};e.reset=async function(){await this._cancel(!1);await this.start()};e.start=async function(){this._set("started",
!0);await this._go(-1===this._stepIndex?0:this._stepIndex)};e._cancel=async function(a=!0){this.started&&(this._set("started",!1),await this.steps[this._stepIndex].tearDown({cancelled:!0}),this.data&&this.data.viewModel.sketchViewModel.layer.removeAll());this.handles.remove([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]);this._resetIndexing(a);a&&this.emit("cancel")};e._go=async function(a=-1,f=!1){-1>=a||a>=this.steps.length||(this.started&&(-1<this._lastStepIndex&&await this.steps[this._lastStepIndex].tearDown({cancelled:f}),
await this.steps[a].setUp(),this._lastStepIndex=a),this._stepIndex=a,this._notifyStepProps())};e._resetIndexing=function(a=!0){this._lastStepIndex=this._stepIndex=-1;this._indexHistory.length=0;a&&this._notifyStepProps()};e._notifyStepProps=function(){this.notifyChange("stepId");this.notifyChange("hasPreviousStep");this.notifyChange("hasNextStep")};h._createClass(g,[{key:"hasNextStep",get:function(){const {steps:a}=this;return!!(a&&this._stepIndex<a.filter(f=>!f.parent).length-1)}},{key:"hasPreviousStep",
get:function(){return 0<this._stepIndex}},{key:"reliesOnOwnerAdminPrivileges",get:function(){return!1}},{key:"shouldShowAttachments",get:function(){return!1}},{key:"shouldAllowAttachmentEditing",get:function(){return!1}},{key:"stepId",get:function(){var {steps:a}=this;return(a=a&&a[this._stepIndex])&&a.id}},{key:"helpMessage",get:function(){}}]);return g}(m.HandleOwnerMixin(b.EventedAccessor));c.__decorate([d.property()],b.prototype,"data",void 0);c.__decorate([d.property()],b.prototype,"hasNextStep",
null);c.__decorate([d.property()],b.prototype,"hasPreviousStep",null);c.__decorate([d.property()],b.prototype,"onCommit",void 0);c.__decorate([d.property()],b.prototype,"reliesOnOwnerAdminPrivileges",null);c.__decorate([d.property()],b.prototype,"shouldShowAttachments",null);c.__decorate([d.property()],b.prototype,"shouldAllowAttachmentEditing",null);c.__decorate([d.property()],b.prototype,"started",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"stepId",null);c.__decorate([d.property()],
b.prototype,"steps",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property()],b.prototype,"helpMessage",null);c.__decorate([d.property()],b.prototype,"commit",null);return b=c.__decorate([n.subclass("esri.widgets.Editor.Workflow")],b)});