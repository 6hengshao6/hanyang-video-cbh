// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ListItem ./support/layerListUtils".split(" "),function(q,k,f,w,g,l,z,A,B,x,u,r){const v=f.ofType(u);f=function(c){function m(a){a=y.call(this,a);a.checkPublishStatusEnabled=!1;a.listItemCreatedFunction=
null;a.operationalItems=new v;a.view=null;return a}q._inherits(m,c);var y=q._createSuper(m);c=m.prototype;c.initialize=function(){this.addHandles([g.watch(()=>[this.view,this.view?.ready],()=>this._viewHandles(),g.initial),g.watch(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],"view")};c.destroy=function(){this.removeAllHandles();this.view=null;this.operationalItems.removeAll()};c.triggerAction=function(a,b){a&&!a.disabled&&this.emit("trigger-action",
{action:a,item:b})};c.moveListItem=function(a,b,d,e){const n=a?.layer;if(n){var h=this.view?.map?.layers,t=b?r.getItemLayers(b):h;h=d?r.getItemLayers(d):h;if(t&&h){var {operationalItems:p}=this;b=b?.children||p;p=d?.children||p;e=h.length-e;a.parent=d||null;b.includes(a)&&b.remove(a);t.includes(n)&&t.remove(n);p.includes(a)||p.add(a,e);h.includes(n)||h.add(n,e)}}};c._createLayerViewHandles=function(a){this.removeHandles("layer-views");this._compileList();a&&this.addHandles(a.on("change",()=>this._compileList()),
"layer-views")};c._createMapLayerHandles=function(a){this.removeHandles("map-layers");this._compileList();a&&this.addHandles(a.on("change",()=>this._compileList()),"map-layers")};c._createListItem=function(a){const {view:b,listItemCreatedFunction:d,checkPublishStatusEnabled:e}=this;return new u({checkPublishStatusEnabled:e,layer:a,listItemCreatedFunction:d,view:b})};c._removeAllItems=function(){this.operationalItems.removeAll()};c._getViewableLayers=function(a){if(a)return a.filter(b=>"hide"!==r.findLayerListMode(b))};
c._watchLayersListMode=function(a){this.removeHandles("layer-list-mode");a&&a.forEach(b=>{"listMode"in b&&this.addHandles(g.watch(()=>b.listMode,()=>this._compileList()),"layer-list-mode")})};c._compileList=function(){var a=this.get("view.map.layers");this._watchLayersListMode(a);(a=this._getViewableLayers(a))&&a.length?(this._createNewItems(a),this._removeItems(a),this._sortItems(a)):this._removeAllItems()};c._createNewItems=function(a){const {operationalItems:b}=this;a.forEach(d=>{b.find(e=>e.layer===
d)||b.add(this._createListItem(d))})};c._removeItems=function(a){const {operationalItems:b}=this,d=[];b.forEach(e=>{e&&a&&a.includes(e.layer)||d.push(e)});b.removeMany(d)};c._sortItems=function(a){const {operationalItems:b}=this;b.sort((d,e)=>{d=a.indexOf(d.layer);e=a.indexOf(e.layer);return d>e?-1:d<e?1:0})};c._recompileList=function(){this._removeAllItems();this._compileList()};c._viewHandles=function(){const {view:a}=this;this.removeHandles(["map-layers","layer-views","view-layers"]);this._compileList();
a&&a.ready&&this.addHandles([g.watch(()=>this.view?.map?.allLayers,b=>this._createMapLayerHandles(b),g.initial),g.watch(()=>this.view?.allLayerViews,b=>this._createLayerViewHandles(b),g.initial)],"view-layers")};q._createClass(m,[{key:"state",get:function(){const a=this.get("view");return this.get("view.ready")?"ready":a?"loading":"disabled"}}]);return m}(w.EventedAccessor);k.__decorate([l.property()],f.prototype,"checkPublishStatusEnabled",void 0);k.__decorate([l.property()],f.prototype,"listItemCreatedFunction",
void 0);k.__decorate([l.property({type:v})],f.prototype,"operationalItems",void 0);k.__decorate([l.property({readOnly:!0})],f.prototype,"state",null);k.__decorate([l.property()],f.prototype,"view",void 0);return f=k.__decorate([x.subclass("esri.widgets.LayerList.LayerListViewModel")],f)});