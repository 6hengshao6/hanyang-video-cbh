// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/deprecate ../core/events ../core/Logger ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../properties/defaultUnit ../rest/support/Stop ../symbols/SimpleMarkerSymbol ./Search ./Widget ./Directions/DirectionsViewModel ./Directions/components/SaveLayer ./Directions/support/directionsUtils ./Directions/support/resources ./Search/support/locatorUtils ./support/componentsUtils ./support/DatePicker ./support/Heading ./support/TimePicker ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils ../chunks/sortable.esm ../intl/number ../intl/date".split(" "),
function(I,J,n,m,C,D,T,h,u,q,U,ja,ka,V,W,X,Y,Z,aa,N,ba,G,c,O,ca,da,z,ea,A,K,e,la,fa,L,P){function Q(f){return!!f.composedPath?.().find(B=>B.classList?.contains("esri-search__suggestions-list"))}const R={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0},E=T.getLogger("esri.widgets.Directions");m=function(f){function B(a,d){var b=ha.call(this,a,d);b._activeStop=null;b._activeManeuver=null;b._autoStopRemovalDelay=100;b._autoStopRemovalTimeoutId=void 0;
b._departureTimeOption=c.DepartureTimeOption.NOW;b._datePicker=new da;b._focusedManeuver=null;b._newPlaceholderStop=null;b._pointerDownUpHandle=null;b._pointerPressedSearchSuggestionStop=null;b._renderSavePopoverFunction=null;b._saveAsButtonNode=null;b._saveLayer=new ba.SaveLayer;b._sections=null;b._sortable=null;b._stopsToSearches=new Map;b._timePicker=new ea;b._viewClickHandle=null;b.headingLevel=2;b.iconClass=c.CSS.widgetIcon;b.messages=null;b.messagesCommon=null;b.messagesUnits=null;b.searchProperties=
null;b.viewModel=new N;b.visibleElements={...R};b._setUpDragAndDropStops=g=>{b._sortable=fa.Sortable.create(g,{draggable:`.${c.CSS.validStopRow}`,ghostClass:c.CSS.stopRowGhost,handle:`.${c.CSS.stopHandle}`,onEnd:b._handleStopInputDragEnd})};b._handleDragHandlePointerDown=()=>b.viewModel.layer.stops.forEach(g=>b._acquireSearch(g).activeMenu="none");b._handleStopInputDragEnd=({oldIndex:g,newIndex:k,target:l})=>{if(g!==k&&null!=k&&null!=g){var {children:p}=l,t=p[g];l.insertBefore(p[k],0>k-g?t.nextElementSibling:
t);l=b.viewModel.layer.stops;l.reorder(l.getItemAt(g),k);for(const r of l)r.sequence=null;b._getDirections()}};return b}J._inherits(B,f);var ha=J._createSuper(B);f=B.prototype;f.initialize=function(){this.addHandles([u.watch(()=>this.viewModel.layer.routeInfo,()=>{this._focusedManeuver=this._activeManeuver=null;this._sections=this._getSections();this.scheduleRender()},u.initial),u.when(()=>this.view,(a,d)=>{d&&(this._viewClickHandle=null,h.isSome(d)&&this.removeHandles(d));if(a){d=this._prepPointerDownUpClick();
const b=this._prepViewClick();d.pause();b.pause();const g=a.surface;this.addHandles([D.on(g,"mousedown",()=>this._autoStopRemovalDelay=500),D.on(g,"mouseup",()=>this._autoStopRemovalDelay=100),d,b],a);this._pointerDownUpHandle=d;this._viewClickHandle=b}},u.initial),u.when(()=>h.isNone(this.viewModel.serviceDescription),()=>{try{this.viewModel.load()}catch{}},u.initial),u.watch(()=>this._saveLayer.state,()=>{this.scheduleRender()})]);this.when(()=>{this.destroyed||(this._renderSavePopoverFunction=
this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))})};f.loadDependencies=function(){return ca.loadCalciteComponents({button:()=>new Promise((a,d)=>I(["../chunks/calcite-button"],a,d)),link:()=>new Promise((a,d)=>I(["../chunks/calcite-link"],a,d)),popover:()=>new Promise((a,d)=>I(["../chunks/calcite-popover"],a,d))})};f.destroy=function(){this._datePicker.destroy();this._timePicker.destroy();for(const a of this._stopsToSearches.values())a.destroy();
this._sortable?.destroy();h.isSome(this._renderSavePopoverFunction)&&this._projector.detach(this._renderSavePopoverFunction)};f.castVisibleElements=function(a){return{...R,...a}};f.getDirections=function(){return this.viewModel.getDirections()};f.render=function(){return e.tsx("div",{class:this.classes(c.CSS.base,c.CSS.scroller)},this._renderPanelContent())};f.save=function(){return this.viewModel.layer.save()};f.saveAs=function(a,d={}){return this.viewModel.layer.saveAs(a,d)};f.zoomToRoute=function(){return this.viewModel.zoomToRoute()};
f._renderPanelContent=function(){const {viewModel:{serviceDescription:a,state:d}}=this;var b="initializing"===d;const g="error"===d&&!a,k="unauthenticated"===d,l={[c.CSS.panelContentLoading]:b,[c.CSS.panelContentError]:g,[c.CSS.panelContentSignIn]:k},p=b?"presentation":"group";b=k?this._renderSignIn():g?this._renderMessage(this._getErrorMessage()):b?this._renderLoader():this._renderReadyContent();return e.tsx("div",{class:this.classes(c.CSS.panelContent,l),role:p},b)};f._renderReadyContent=function(){return[this._renderStopsContainer(),
this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]};f._renderSignIn=function(){return e.tsx("div",{key:"sign-in",class:c.CSS.signInContent},e.tsx(z.Heading,{class:c.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),e.tsx(z.Heading,{level:z.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),e.tsx("button",{class:this.classes(c.CSS.button,
c.CSS.buttonSecondary,c.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))};f._handleSignInClick=function(){this.viewModel.load().catch(()=>{})};f._renderTravelModeOptions=function(){if(!this.visibleElements.traveMode)return null;const {selectedTravelMode:a,travelModes:d}=this.viewModel;if(0===d.length)return null;const b=h.isSome(a)?a.name:this.messages.travelMode;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),
class:this.classes(c.CSS.travelMode,this._saveLayer.opened&&c.CSS.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},e.tsx("select",{"aria-label":b,bind:this,class:this.classes(c.CSS.travelModeSelect,c.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:b},d.map((g,k)=>e.tsx("option",{key:`esri-directions__travel-mode-${k}`,"data-mode":g,selected:a===g,value:`${k}`},g.name))))};f._handleTravelModeChange=function(a){a=a.currentTarget;
a=a.item(a.selectedIndex);this.viewModel.selectedTravelMode=a?.["data-mode"];this._getDirections()};f._renderStopsContainer=function(){return this.visibleElements.stops?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.section,this._saveLayer.opened&&c.CSS.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null};f._renderDepartureTimeControls=function(){if(!this.visibleElements.departureTime)return null;const {messages:{departAt:a,
departureTime:d,leaveNow:b,timeUnspecified:g}}=this;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.departureTime,this._saveLayer.opened&&c.CSS.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},e.tsx("select",{"aria-label":d,bind:this,class:this.classes(c.CSS.departureTimeSelect,c.CSS.select),onchange:this._handleDepartureOptionChange,title:d},e.tsx("option",{value:c.DepartureTimeOption.NOW,selected:this._departureTimeOption===
c.DepartureTimeOption.NOW},b),e.tsx("option",{value:c.DepartureTimeOption.DEPART_AT,selected:this._departureTimeOption===c.DepartureTimeOption.DEPART_AT},a),e.tsx("option",{value:c.DepartureTimeOption.UNSPECIFIED,selected:this._departureTimeOption===c.DepartureTimeOption.UNSPECIFIED},g)),this._departureTimeOption===c.DepartureTimeOption.DEPART_AT?this._renderTimeControls():null)};f._renderStops=function(){const a=this.viewModel.layer.stops;let d=0;for(var b of this._stopsToSearches.keys())a.includes(b)||
this._disposeSearch(b);for(var g of a)b=this._acquireSearch(g),"none"!==b.activeMenu&&(d+=1),h.isSome(g.name)&&(b.searchTerm=g.name);g=a.toArray().map((k,l)=>{var p=a.length,t=1<l&&h.isNone(k.geometry);const r={[c.CSS.stopsIcon]:0<=l&&l<p-1,[c.CSS.lastStopIcon]:l===p-1},v={[c.CSS.lastStopIconContainer]:l===p-1};t={[c.CSS.validStopRow]:!t};var x=a.getItemAt(l+1);x=x&&h.isSome(x.geometry);var w=l===p-1,y=l===p-2;x=2===p&&0===l||2<p&&!w&&!y||2<p&&y&&x||2<p&&w&&h.isNone(k.geometry);p=3>p;w=this._acquireSearch(k);
({messages:y}=this);const {removeStop:F,reverseStops:S,unlocated:ia}=y;var H=h.isSome(k.geometry)&&h.isSome(k.name)?k.name:ia,M=L.formatNumber(l+1);y=`${y.stopLabel} ${M} (${H})`;H=`${this.id}__stop--${l}`;k=!!w.searchTerm&&!!w.selectedResult&&h.isSome(k.geometry)&&w.selectedResult.name===k.name;M={zIndex:"none"!==w.activeMenu?`${d--}`:""};return e.tsx("li",{"aria-label":y,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(c.CSS.stopRow,t),id:H,key:l,"data-stop-index":l,styles:M},
e.tsx("div",{class:c.CSS.stopHandle},e.tsx("span",{"aria-hidden":"true",class:this.classes(c.CSS.stopIcon,c.CSS.handleIcon,c.CSS.stopHandleIcon,c.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),e.tsx("div",{bind:this,"aria-labelledby":H,class:this.classes(c.CSS.stopIconContainer,v),"data-stop-index":l,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},e.tsx("span",{class:this.classes(c.CSS.stopIcon,r),tabindex:k?"0":null}))),e.tsx("div",
{class:c.CSS.stopInput},w.render()),e.tsx("div",{class:c.CSS.stopOptions,role:"group"},e.tsx("div",{"aria-label":F,class:c.CSS.removeStopButton,bind:this,"data-stop-index":l,hidden:p,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:F},e.tsx("span",{"aria-hidden":"true",class:this.classes(c.CSS.stopIcon,c.CSS.removeStop,c.CSS.removeStopIcon,c.CSS.interactiveStopIcon)}),e.tsx("span",{class:c.CSS.screenReaderText},"removeStopTitle")),e.tsx("div",{"aria-label":S,
class:c.CSS.reverseStops,bind:this,hidden:x,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:S},e.tsx("span",{"aria-hidden":"true",class:this.classes(c.CSS.stopIcon,c.CSS.reverseStopIcon,c.CSS.interactiveStopIcon)}),e.tsx("span",{class:c.CSS.screenReaderText},"removeStopTitle"))))});b=this._renderAddStop();return e.tsx("div",null,e.tsx("ol",{class:c.CSS.stops,role:"group",afterCreate:this._setUpDragAndDropStops},g),b)};f._renderAddStop=function(){var {stops:a}=
this.viewModel.layer;const d=a.filter(({geometry:b})=>h.isSome(b));a=a.at(-1);return 1<d.length&&d.length<this.maxStops&&h.isSome(a)&&h.isSome(a.geometry)?e.tsx("div",{class:c.CSS.toolbarSection},e.tsx("div",{class:c.CSS.toolbarButtons},e.tsx("calcite-button",{appearance:"outline",class:c.CSS.addStopButton,kind:"neutral",scale:"s",round:!0,iconStart:"plus",key:c.CSS.addStopButton,onclick:()=>{this._addNewPlaceholder()},label:this.messages.addStop,width:"full"},this.messages.addStop))):null};f._handleStopIconClick=
function(a){(a=this.viewModel.layer.stops.getItemAt(a.currentTarget?.["data-stop-index"]))&&h.isSome(a.geometry)&&this._centerAtStop(a)};f._handleClearRouteClick=function(){this.viewModel.reset()};f._centerAtStop=function(a){this.viewModel.centerAt(a)};f._handleStopFieldCreation=function(a){const d=this._newPlaceholderStop;if(d){a=this.viewModel.layer.stops.getItemAt(a["data-stop-index"]);if(d===a){const b=this._acquireSearch(a);b.when(()=>{this.renderNow();b.focus()})}this._newPlaceholderStop=null}};
f._handleStopInputBlur=function(a,d){if(!this._saveLayer.opened)if(this.removeHandles("search-term"),a.selectedResult&&h.isSome(d.geometry)&&h.isSome(a.selectedResult?.feature.geometry)&&d.geometry===a.selectedResult?.feature.geometry)this._pointerDownUpHandle?.pause();else{var b=h.isNone(d.geometry)&&h.isNone(a.selectedResult?.feature.geometry),g=h.isSome(d.geometry)&&h.isSome(a.selectedResult?.feature.geometry)&&d.geometry!==a.selectedResult?.feature.geometry;(b||g)&&"none"===a.activeMenu&&a.searchTerm?
(a.search(),this._pointerDownUpHandle?.pause()):a.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"===a.viewModel.state?this._pointerDownUpHandle?.pause():this._pointerPressedSearchSuggestionStop||(h.isSome(d.geometry)&&(d.geometry=null,this._getDirections()),this.scheduleRender()))},this._autoStopRemovalDelay))}};f._handleStopInputFocus=function(a,d){this._pointerDownUpHandle?.resume();
const {view:b}=this;if(!this.hasHandles("search-term")&&b){var g=b.cursor;this.addHandles([{remove(){b.cursor=g}},u.watch(()=>a.searchTerm,k=>{a.destroyed||(b.cursor=k.length?g:"copy")},u.initial)],"search-term");this._activeStop=d}};f._prepViewClick=function(){const {view:a}=this.viewModel;h.assertIsSome(a);h.assertIsSome(a.surface);const d=D.pausable(a,"click",this._handleViewClick.bind(this)),b=D.pausable(a.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId);b.pause()});return{remove(){b.remove();
d.remove()},pause(){b.pause();d.pause()},resume(){b.resume();d.resume()}}};f._prepPointerDownUpClick=function(){const a=D.pausable(document,"pointerdown",b=>{this._pointerPressedSearchSuggestionStop=Q(b)?this._activeStop:null}),d=D.pausable(document,"pointerup",b=>{this._pointerDownUpHandle?.pause();b=Q(b);const g=this._activeStop;b||g!==this._pointerPressedSearchSuggestionStop||this._removeStop(g);this.scheduleRender();this._pointerPressedSearchSuggestionStop=b?g:null});return{remove(){d.remove();
a.remove()},pause(){d.pause();a.pause()},resume(){a.resume()}}};f._handleViewClick=function(a){a.stopPropagation();const d=this._activeStop,b=d?this._stopsToSearches.get(d):null;d&&b&&!b.searchTerm&&(b.search(a.mapPoint).then(g=>{if(g=g?.results[0].results){var {feature:k,name:l}=g[0];d.geometry=k.geometry;d.name=l;b.searchTerm=l}}),this.scheduleRender());this._viewClickHandle?.pause();clearTimeout(this._autoStopRemovalTimeoutId)};f._addNewPlaceholder=function(){this._pointerDownUpHandle?.pause();
if(!this._newPlaceholderStop){var a=new X({symbol:new Y});this.viewModel.layer.stops.add(a);this._newPlaceholderStop=a}};f._handleReverseStops=function(){this._reverseStops()};f._reverseStops=function(){this.viewModel.layer.stops.reverse();for(const a of this.viewModel.layer.stops)a.sequence=null;this._getDirections()};f._handleRemoveStop=function(a){a=this.viewModel.layer.stops.getItemAt(a.currentTarget?.["data-stop-index"]);this._removeStop(a);(h.isSome(a.geometry)||h.isNone(this.viewModel.layer.routeInfo))&&
this._getDirections()};f._removeStop=function(a){!a||2>=this.viewModel.layer.stops.length||(this._disposeSearch(a),this.viewModel.layer.stops.remove(a))};f._handleDepartureOptionChange=function(a){a=a.currentTarget;a=a.item(a.selectedIndex);a.value===c.DepartureTimeOption.NOW?(this._departureTimeOption=c.DepartureTimeOption.NOW,this.viewModel.departureTime=c.DepartureTimeOption.NOW,this.removeHandles("date-time-picker"),this._getDirections()):a.value===c.DepartureTimeOption.DEPART_AT?(this._departureTimeOption=
c.DepartureTimeOption.DEPART_AT,this.addHandles(u.watch(()=>[this._datePicker.value,this._timePicker.value],()=>{this._updateDepartureTime();this._getDirections()},u.initial),"date-time-picker")):(this._departureTimeOption=c.DepartureTimeOption.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())};f._updateDepartureTime=function(){const a=this._datePicker.value,d=this._timePicker.value;a&&d&&(this.viewModel.departureTime=new Date(a.getFullYear(),a.getMonth(),a.getDate(),d.getHours(),
d.getMinutes()))};f._renderTimeControls=function(){return e.tsx("div",{class:c.CSS.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())};f._renderSectionSplitter=function(){return e.tsx("div",{class:c.CSS.sectionSplitter})};f._renderSaveContainer=function(){const {saveButton:a,saveAsButton:d,printButton:b,layerDetails:g}=this.visibleElements;return a||d||b||g?e.tsx("div",{class:c.CSS.saveSection,key:c.CSS.saveSection},this._renderSaveButtons(),
this._renderRouteLayerDetailsLink()):null};f._renderSaveButtons=function(){const {saveButton:a,saveAsButton:d,printButton:b}=this.visibleElements;return a||d||b?e.tsx("div",{class:c.CSS.saveButtons,key:c.CSS.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null};f._renderSaveButton=function(){if(!this.visibleElements.saveButton)return null;var a=this.viewModel.layer.portalItem?.itemControl;a=h.isSome(this.viewModel.layer.routeInfo)&&("admin"===a||"update"===
a);return e.tsx("calcite-button",{appearance:"outline",class:c.CSS.saveButton,disabled:!a,iconStart:"save",key:c.CSS.saveButton,onclick:()=>{this._handleSaveButtonClick()},label:this.messagesCommon.save,width:"full"},this.messagesCommon.save)};f._renderSaveAsButton=function(){if(!this.visibleElements.saveAsButton)return null;const a=h.isNone(this.viewModel.layer.routeInfo);return e.tsx("div",{class:c.CSS.saveAsButtonPopover,key:c.CSS.saveAsButtonPopover},e.tsx("calcite-button",{afterCreate:d=>{this._saveAsButtonNode=
d},appearance:"outline",class:c.CSS.saveAsButton,disabled:a,iconStart:"duplicate",key:c.CSS.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),label:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))};f._renderSavePopover=function(){return e.tsx("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:h.unwrap(this._saveAsButtonNode)},this._saveLayer.render())};f._handleSaveAsButtonClick=function(){this._saveLayer.opened?
this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)};f._renderPrintButton=function(){return this.visibleElements.printButton?e.tsx("calcite-button",{appearance:"outline",class:c.CSS.printButton,iconStart:"print",key:c.CSS.printButton,label:this.messagesCommon.print}):null};f._renderRouteLayerDetailsLink=function(){if(!this.visibleElements.layerDetails)return null;const {portalItem:a}=this.viewModel.layer;if(!a)return null;const {id:d,portal:{url:b}}=a;return e.tsx("calcite-link",{class:c.CSS.layerDetailsLink,
href:`${b}/home/item.html?id=${d}`,key:c.CSS.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)};f._handleSaveButtonClick=function(){this.viewModel.layer.save()};f._renderDirectionsContainer=function(){return e.tsx("div",{class:this.classes(c.CSS.directionsSection,c.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())};f._renderLoader=function(){return e.tsx("div",{class:c.CSS.loader,key:"loader"})};f._renderWarningCard=function(){return e.tsx("div",
{class:c.CSS.warningCard,role:"alert"},e.tsx("div",{class:c.CSS.warningHeader},e.tsx("span",{class:c.CSS.warningIcon,"aria-hidden":"true"}),e.tsx(z.Heading,{class:c.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),e.tsx("div",{class:c.CSS.warningMessage},this._getErrorMessage()))};f._renderDirectionsContainerContent=function(){const {viewModel:{layer:a,state:d}}=this,b="routing"===d;return"error"===d?this._renderWarningCard():b?this._renderLoader():h.isSome(a.directionLines)?
e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.summary,this._saveLayer.opened&&c.CSS.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):e.tsx("div",{key:"esri-directions__placeholder",class:c.CSS.emptyContent},this._renderPlaceholder(),e.tsx(z.Heading,{class:c.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))};f._renderPlaceholder=function(){return e.tsx("svg",
{class:c.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},e.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))};
f._renderMessage=function(a){return e.tsx(z.Heading,{level:this.headingLevel},a)};f._renderRouteActions=function(){return e.tsx("div",{class:c.CSS.routeActions},e.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(c.CSS.clearRouteButton,c.CSS.button,c.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))};f._getSections=function(){const {directionPoints:a,directionLines:d,stops:b}=this.viewModel.layer;if(h.isNone(a)||
h.isNone(d))return null;const g=[];let k=null;for(const p of a){const {objectId:t,stopId:r}=p;if(h.isSome(r)){var l=b.find(x=>x.objectId===r);const v=0===g.length;if(h.isNone(k)||k.stop!==l)k={stop:l,directions:[],open:v},g.push(k)}else h.isNone(k)||(l=d.find(v=>v.directionPointId===t),h.isNone(l)||k.directions.push({directionPoint:p,directionLine:l}))}return g};f._renderManeuverSections=function(){return h.isNone(this._sections)?null:e.tsx("div",{class:c.CSS.maneuvers,role:"group"},this._sections.map((a,
d)=>{const {open:b}=a;let g;0<a.directions.length&&b&&(g=e.tsx("ol",{class:c.CSS.maneuverList},a.directions.map(r=>this._renderManeuver(r))));var k=2<h.unwrap(this._sections).length;const l=d===h.unwrap(this._sections).length-1,p={[c.CSS.collapsibleSection]:k},t={[c.CSS.openIcon]:!b,[c.CSS.closeIcon]:b};k&&!l?(k=b?this.messagesCommon.close:this.messagesCommon.open,a=e.tsx("header",{class:this.classes(c.CSS.maneuverSectionHeader,c.CSS.maneuverSectionToggle),key:c.CSS.maneuverSectionHeader},e.tsx("div",
{"aria-expanded":b.toString(),"aria-label":k,bind:this,class:c.CSS.maneuverSectionHeaderButton,"data-maneuver-section":a,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:k},e.tsx(z.Heading,{class:c.CSS.maneuverSectionTitle,level:this.headingLevel},a.stop.name),e.tsx("span",{"aria-hidden":"true",class:this.classes(t)})))):a=e.tsx("header",{class:c.CSS.maneuverSectionHeader,key:c.CSS.maneuverSectionHeader},e.tsx(z.Heading,{class:c.CSS.maneuverSectionTitle,
level:this.headingLevel},a.stop.name));return e.tsx("section",{class:this.classes(c.CSS.maneuverSection,p),key:d},a,g)}))};f._handleSectionToggle=function(a){a=a.currentTarget["data-maneuver-section"];a.open=!a.open};f._renderCosts=function(){var a=this._getCostSummary(),{directionPoints:d}=this.viewModel.layer;if(h.isNone(d)||h.isNone(a))return null;d=d.getItemAt(d.length-1).arrivalTime;const {distance:b,duration:g}=a,{eta:k,primaryCosts:l,secondaryCosts:p,zoomToRoute:t}=this.messages;a=P.convertDateFormatToIntlOptions("short-time");
if(h.isSome(d)){a=P.formatDate(d,a);d=d.getTimezoneOffset();const r=Math.abs(Math.floor(d)%60),v={minimumIntegerDigits:2};d=`GMT${0<d?"-":"+"}${L.formatNumber(Math.abs(Math.floor(d/60)),v)}${L.formatNumber(r,v)}`;a=`<strong>${a}</strong> ${d}`}else a="";return e.tsx("div",{"aria-label":t,bind:this,class:c.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:t},e.tsx("div",{class:c.CSS.costsDetails,role:"group"},e.tsx("div",
{class:c.CSS.primaryCosts,title:l},g),e.tsx("div",{class:c.CSS.verticalSplitter}),e.tsx("div",{class:c.CSS.secondaryCosts,title:p},b)),e.tsx("div",{innerHTML:a,title:k}))};f._handleSummaryInteraction=function(){this._focusedManeuver=this._activeManeuver=null;this.viewModel.clearHighlights();this.zoomToRoute()};f._getErrorMessage=function(){const {messages:a,viewModel:{lastError:d}}=this;if(h.isSome(d))switch(d.name){case "directions-view-model:unable-to-route":return a.errors.unableToRoute;case "directions-view-model:service-metadata-unavailable":return a.errors.unableToLoadServiceMetadata}return a.errors.unknownError};
f._normalizeSearchSources=function(a){this._overrideDefaultSources(a);this._applyLocatorSourceOverrides(a)};f._overrideDefaultSources=function(a){a.viewModel.defaultSources.forEach(d=>{d.autoNavigate=!1})};f._applyLocatorSourceOverrides=function({allSources:a}){for(const d of a)"url"in d&&d.url&&(d.locationType??(d.locationType="street"),O.isArcGISWorldGeocoder(d.url)&&this.apiKey&&null==d.apiKey&&(d.apiKey=this.apiKey,d.url=O.meteredArcGISLocatorUrl))};f._acquireSearch=function(a){const {view:d}=
this.viewModel;if(this._stopsToSearches.has(a)){const g=this._stopsToSearches.get(a);g.view=d;this._overrideDefaultSources(g);return g}const b=new Z({view:d,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});this._normalizeSearchSources(b);this.addHandles([u.on(()=>b.allSources,"change",()=>this._normalizeSearchSources(b)),b.on("select-result",()=>{a.geometry=b.selectedResult?.feature.geometry;a.name=b.selectedResult?.name;this._getDirections()}),b.on("search-focus",()=>this._handleStopInputFocus(b,
a)),b.on("search-blur",()=>this._handleStopInputBlur(b,a)),b.on("search-clear",()=>{a.geometry=null;a.name=null;this._activeStop=a;this.viewModel.layer.removeResult()}),u.watch(()=>b.searchTerm,g=>{a.name=g})],b);this._stopsToSearches.set(a,b);return b};f._disposeSearch=function(a){if(a&&this._stopsToSearches.has(a)){var d=this._stopsToSearches.get(a);this.removeHandles(d);d.destroy();this._stopsToSearches.delete(a)}};f._renderManeuver=function(a){const {directionPoint:d,directionLine:b}=a,{distance:g,
duration:k}=b,{messages:l,messagesUnits:p,unit:t}=this;a=G.formatDistance(p,h.unwrapOrValue(g,0),t);var r=G.formatDuration(h.unwrapOrValue(k,0));a=a&&r?`${a}&nbsp;&middot;&nbsp;${r}`:`${a}${r}`;r=this._getFormattedManeuverText(d);const {objectId:v,directionPointType:x}=d,w=c.getIconPath(x),y=`esri-directions__maneuver-${v}`,F=`esri-directions__intermediate-costs-${v}`;return e.tsx("li",{"aria-labelledby":`${y} ${F}`,bind:this,class:this.classes(c.CSS.maneuver,{[c.CSS.maneuverActive]:this._activeManeuver===
b}),"data-maneuver":b,key:b,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},h.isSome(w)&&e.tsx("img",{alt:"",class:c.CSS.maneuverIcon,src:w}),e.tsx("div",{class:c.CSS.maneuverCostsContainer},e.tsx("span",{id:y,innerHTML:h.unwrapOrValue(r,"")}),e.tsx("div",{class:c.CSS.maneuverCosts},e.tsx("div",{class:c.CSS.horizontalSplitter}),
e.tsx("div",{"aria-hidden":"true",id:F,class:c.CSS.intermediateCost,innerHTML:a,title:l.intermediateCosts}))))};f._handleManeuverClick=function(a){a=a.currentTarget["data-maneuver"];if(this._activeManeuver===a)this._activeManeuver=null,this.zoomToRoute();else{this._activeManeuver=a;var {geometry:d}=a;this.viewModel.centerAt(d);this.viewModel.highlight(a)}};f._handleManeuverMouseOver=function(a){this._activeManeuver||this._focusedManeuver||this.viewModel.highlight(a.currentTarget["data-maneuver"])};
f._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()};f._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())};f._handleManeuverFocus=function(a){this._activeManeuver||(this._focusedManeuver=a=a.currentTarget["data-maneuver"],this.viewModel.highlight(a))};f._getFormattedManeuverText=function(a){const {displayText:d,name:b,intersectingName:g}=a;if(h.isNone(d))return"";a=d;h.isSome(b)&&
a.includes(b)&&(a=a.replace(b,`<strong>${b}</strong>`));h.isSome(g)&&a.includes(g)&&(a=a.replace(g,`<strong>${g}</strong>`));return a};f._getCostSummary=function(){const {messagesUnits:a,unit:d,viewModel:b}=this;var {routeInfo:g}=b.layer;if(h.isNone(g))return null;var k=h.unwrapOrValue(g.totalDistance,0);g=h.unwrapOrValue(g.totalDuration,0);k=G.formatDistance(a,k,d);g=G.formatDuration(g);return{distance:k,duration:g}};f._getDirections=async function(){if(!(2>this.viewModel.layer.stops.filter(a=>h.isSome(a.geometry)).length))try{await this.viewModel.getDirections()}catch{}};
J._createClass(B,[{key:"apiKey",get:function(){return this.viewModel.apiKey}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(a){this.viewModel.goToOverride=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"lastRoute",get:function(){return this.viewModel.lastRoute}},{key:"layer",get:function(){return this.viewModel.layer},set:function(a){this.viewModel.layer=a}},{key:"maxStops",get:function(){return this.viewModel.maxStops},
set:function(a){this.viewModel.maxStops=a}},{key:"routeServiceUrl",get:function(){C.deprecatedProperty(E,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.url},set:function(a){C.deprecatedProperty(E,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.url=a}},{key:"routeSymbol",get:function(){C.deprecatedProperty(E,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",
version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.defaultSymbols.directionLines},set:function(a){C.deprecatedProperty(E,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.defaultSymbols.directionLines=a}},{key:"stopSymbols",get:function(){C.deprecatedProperty(E,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.defaultSymbols.stops},
set:function(a){C.deprecatedProperty(E,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.defaultSymbols.stops=a}},{key:"unit",get:function(){return this.defaultUnit},set:function(a){this._overrideIfSome("unit",a)}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}},{key:"test",get:function(){return{acquireSearch:a=>this._acquireSearch(a)}}}]);return B}(aa);n.__decorate([q.property()],
m.prototype,"apiKey",null);n.__decorate([q.property(W.defaultUnitPropertyMetadata)],m.prototype,"defaultUnit",void 0);n.__decorate([q.property()],m.prototype,"goToOverride",null);n.__decorate([q.property()],m.prototype,"headingLevel",void 0);n.__decorate([q.property()],m.prototype,"iconClass",void 0);n.__decorate([q.property()],m.prototype,"label",null);n.__decorate([q.property({readOnly:!0})],m.prototype,"lastRoute",null);n.__decorate([q.property()],m.prototype,"layer",null);n.__decorate([q.property()],
m.prototype,"maxStops",null);n.__decorate([q.property(),K.messageBundle("esri/widgets/Directions/t9n/Directions")],m.prototype,"messages",void 0);n.__decorate([q.property(),K.messageBundle("esri/t9n/common")],m.prototype,"messagesCommon",void 0);n.__decorate([q.property(),K.messageBundle("esri/core/t9n/Units")],m.prototype,"messagesUnits",void 0);n.__decorate([q.property()],m.prototype,"routeServiceUrl",null);n.__decorate([q.property()],m.prototype,"routeSymbol",null);n.__decorate([q.property()],
m.prototype,"searchProperties",void 0);n.__decorate([q.property()],m.prototype,"stopSymbols",null);n.__decorate([q.property()],m.prototype,"unit",null);n.__decorate([q.property()],m.prototype,"view",null);n.__decorate([q.property({type:N})],m.prototype,"viewModel",void 0);n.__decorate([q.property()],m.prototype,"visibleElements",void 0);n.__decorate([U.cast("visibleElements")],m.prototype,"castVisibleElements",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleStopIconClick",null);n.__decorate([A.accessibleHandler()],
m.prototype,"_handleClearRouteClick",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleReverseStops",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleRemoveStop",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleSectionToggle",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleSummaryInteraction",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleManeuverClick",null);return m=n.__decorate([V.subclass("esri.widgets.Directions")],m)});