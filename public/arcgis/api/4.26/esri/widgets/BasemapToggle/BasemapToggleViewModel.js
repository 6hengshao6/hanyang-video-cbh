// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/compilerUtils ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapDefinitions ../../support/basemapUtils".split(" "),function(m,d,b,t,n,p,e,w,A,x,q,u,y,f){b=function(g){function h(a){a=
z.call(this,a);a._basemapCache={};a._loadingProjectionEngine=!1;a.nextBasemap=f.ensureType("hybrid",a._basemapCache);a.view=null;return a}m._inherits(h,g);var z=m._createSuper(h);g=h.prototype;g.initialize=function(){p.watch(()=>this.nextBasemap,a=>{a&&!a.loaded&&a.load().catch(()=>{})},p.initial)};g.destroy=function(){this.view=null;f.destroyCache(this._basemapCache);this._basemapCache=null};g.castNextBasemap=function(a){return f.ensureType(a,this._basemapCache)};g.toggle=async function(){const {activeBasemap:a,
nextBasemap:c,state:l,view:k}=this;if(k&&"disabled"!==l&&"incompatible-next-basemap"!==l){var v=this._viewSpatialReferenceLocked;if(!v){await p.whenOnce(()=>!this._nextBasemapSpatialReferenceTask.updating);if(c!==this.nextBasemap||a!==this.activeBasemap)return;const {spatialReference:r}=this._nextBasemapSpatialReferenceTask;!n.isSome(r)||u.equals(k.spatialReference,r)||q.isLoaded()||q.canProjectWithoutEngine(k.spatialReference,r)||(this._loadingProjectionEngine=!0,await q.load(),this._loadingProjectionEngine=
!1);if(c!==this.nextBasemap||a!==this.activeBasemap)return}k.map.basemap=c;v||!n.isSome(this._nextBasemapSpatialReferenceTask.spatialReference)||u.equals(k.spatialReference,this._nextBasemapSpatialReferenceTask.spatialReference)||(k.spatialReference=this._nextBasemapSpatialReferenceTask.spatialReference);this.nextBasemap=a}};h.getThumbnailUrl=function(a){if(!a)return null;var {thumbnailUrl:c}=a;return c?c:(c=f.getWellKnownBasemapId(a))?y.esriBasemapDefinitions[c].thumbnailUrl:(a=a.baseLayers.find(l=>
!!t.typeCast(l)().get("portalItem.thumbnailUrl")))?t.typeCast(a)().get("portalItem.thumbnailUrl"):null};m._createClass(h,[{key:"_nextBasemapSpatialReferenceTask",get:function(){return f.findSpatialReference(this.view,this.nextBasemap)}},{key:"_viewSpatialReferenceLocked",get:function(){const {view:a}=this;return a&&"spatialReferenceLocked"in a?a.spatialReferenceLocked:!0}},{key:"activeBasemap",get:function(){return f.ensureType(this.view?.map?.basemap??"topo-vector",this._basemapCache)}},{key:"state",
get:function(){const {view:a}=this;if(!a?.ready||this._nextBasemapSpatialReferenceTask.updating)return"disabled";const {spatialReference:c}=this._nextBasemapSpatialReferenceTask;return this._viewSpatialReferenceLocked&&n.isSome(c)&&!a.spatialReference.equals(c)?"incompatible-next-basemap":this._loadingProjectionEngine?"loading":"ready"}}]);return h}(b);d.__decorate([e.property()],b.prototype,"_loadingProjectionEngine",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"_nextBasemapSpatialReferenceTask",
null);d.__decorate([e.property({readOnly:!0})],b.prototype,"_viewSpatialReferenceLocked",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"activeBasemap",null);d.__decorate([e.property()],b.prototype,"nextBasemap",void 0);d.__decorate([w.cast("nextBasemap")],b.prototype,"castNextBasemap",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"state",null);d.__decorate([e.property()],b.prototype,"view",void 0);d.__decorate([e.property()],b.prototype,"toggle",null);return b=d.__decorate([x.subclass("esri.widgets.BasemapToggle.BasemapToggleViewModel")],
b)});