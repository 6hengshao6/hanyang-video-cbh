// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/uid ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/CodedValue ../../layers/support/CodedValueDomain ../../layers/support/Domain ../../layers/support/InheritedDomain ../../layers/support/RangeDomain ../../layers/support/domainUtils ../../layers/support/fieldUtils ../../layers/support/layerUtils ./featureFormUtils ../../intl/substitute".split(" "),
function(w,c,b,F,G,k,H,d,P,Q,R,I,J,K,S,T,U,t,m,L,x,y){function z(h){return 1E7<=h||-1E7>=h}var n;(function(h){h.Text="text";h.Number="number";h.Date="date";h.Unsupported="unsupported"})(n||(n={}));var u;(u||(u={})).TOO_SHORT="length-validation-error::too-short";const A={type:"number"},B={type:"number",intlOptions:{notation:"scientific"}},C={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};b=function(h){function q(a){a=M.call(this,
a);a._storedValue=null;a.arcadeEditType="NA";a.editableExpressionExecutor=null;a.id=H.generateUID().toString();a.requiredExpressionExecutor=null;a.valueExpressionExecutor=null;a.visibilityExpressionExecutor=null;a.feature=null;a.field=null;a.fieldElement=null;a.layer=null;a.error=null;a.group=null;a.messages=null;return a}w._inherits(q,h);var M=w._createSuper(q);h=q.prototype;h._isDomainCompatible=function(a){const {field:e}=this;if("coded-value"===a?.type){const f=typeof a.codedValues[0].code;if("string"===
f&&m.isStringField(e)||"number"===f&&m.isNumericField(e))return!0}return"range"===a?.type&&m.isNumericField(e)||m.isDateField(e)?!0:!1};h._validate=function(){const {domain:a,field:e,initialFeature:f,minLength:g,required:p,type:r,valid:v,value:l}=this,D=p&&null===l,N=void 0!==v;return!D&&f.getAttribute(e.name)===l&&N?null:D?m.TypeValidationError.INVALID_TYPE:"text"===r&&-1<g&&"string"===typeof l&&l.length<g?u.TOO_SHORT:a?null!==l||p?t.validateDomainValue(a,l):null:m.validateFieldValue(e,l)};h._isVisibleByDefault=
function(){const a=this.field?.type;return this.field?.visible&&"oid"!==a&&"global-id"!==a&&!this._isGeometryField()};h._isEditorField=function(){return m.getFeatureEditFields(this.layer).includes(this.name)};h._isGeometryField=function(){return m.getFeatureGeometryFields(this.layer).includes(this.name)};h._shouldUseValueExpression=function(){return this._layerFieldAllowsEdits&&!this._configAllowsEdits&&k.isSome(this.valueExpressionExecutor)};h._toErrorMessage=function(){const {domain:a,field:e,messages:f,
minLength:g,value:p,required:r,type:v}=this;var l=this.error;return f?r&&null===p?f.validationErrors.cannotBeNull:l===t.DomainValidationError.VALUE_OUT_OF_RANGE||l===m.NumericRangeValidationError.OUT_OF_RANGE?(l=t.getDomainRange(a)||m.getFieldRange(e),y.substitute(f.validationErrors.outsideRange,l,{format:{max:"date"===v?C:z(l.max)?B:A,min:"date"===v?C:z(l.min)?B:A}})):l===t.DomainValidationError.INVALID_CODED_VALUE?f.validationErrors.invalidCodedValue:l===m.TypeValidationError.INVALID_TYPE?f.validationErrors.invalidType:
l===u.TOO_SHORT?y.substitute(f.validationErrors.tooShort,{min:g}):null:null};w._createClass(q,[{key:"_configAllowsEdits",get:function(){const {fieldElement:a,layer:e,name:f}=this;return k.isSome(a)?a.editableExpression?!!this.evaluatedEditableExpression:!1!==a.editable:e?.userHasUpdateItemPrivileges?!0:(e&&"popupTemplate"in e?e?.popupTemplate?.fieldInfos?.find(({fieldName:g})=>g===f):null)?.isEditable??!0}},{key:"_layerFieldAllowsEdits",get:function(){const {field:a,layer:e}=this;if(!e||!a)return!1;
var f=L.getEffectiveLayerCapabilities(e);const g=f?.operations.supportsEditing,p=a.editable;f=O(f,this.arcadeEditType);return!!(g&&p&&f)}},{key:"isUsingValueExpression",get:function(){return this._shouldUseValueExpression()}},{key:"evaluatedEditableExpression",get:function(){const {editableExpressionExecutor:a}=this;return k.isSome(a)?!!a.lastEvaluatedValue:null}},{key:"evaluatedRequiredExpression",get:function(){const {requiredExpressionExecutor:a}=this;return k.isSome(a)?!!a.lastEvaluatedValue:
null}},{key:"evaluatedVisibilityExpression",get:function(){const {visibilityExpressionExecutor:a}=this;return k.isSome(a)?!!a.lastEvaluatedValue:null}},{key:"evaluatedValueExpression",get:function(){const {valueExpressionExecutor:a}=this;return k.isSome(a)?a.lastEvaluatedValue:null}},{key:"initialFeature",set:function(a){this._set("initialFeature",a);this.notifyChange("valid")}},{key:"description",get:function(){return k.unwrap(this.fieldElement)?.description}},{key:"domain",get:function(){var {layer:a}=
this;const {typeFieldName:e,types:f}=x.getNormalizedFeatureTypeInfo(a);if(e===this.name&&k.isNone(this.field.domain))return new K({name:"__internal-type-based-coded-value-domain__",codedValues:f.map(({code:p,name:r})=>new J.CodedValue({code:p,name:r}))});var {feature:g}=this;a=a?.getFieldDomain(this.name,{feature:g});g=k.get(this.fieldElement,"domain");return k.isSome(g)&&this._isDomainCompatible(g)?g:a}},{key:"editable",get:function(){return this._layerFieldAllowsEdits?this.evaluatedEditableExpression??
this._configAllowsEdits:!1}},{key:"inputType",get:function(){return k.unwrap(this.fieldElement)?.input?.type}},{key:"errorMessage",get:function(){return this._toErrorMessage()}},{key:"hint",get:function(){return k.unwrap(this.fieldElement)?.hint}},{key:"includeTime",get:function(){var {fieldElement:a}=this;a=k.isSome(a)&&"datetime-picker"===a.input?.type?a.input.includeTime:void 0;return void 0===a||a}},{key:"label",get:function(){return k.isSome(this.fieldElement)&&this.fieldElement.label||this.field.alias||
this.field.name}},{key:"maxLength",get:function(){if(this.type===n.Date)return-1;const {field:a,fieldElement:e}=this,f=a?.length,g=E(e)?e.input.maxLength:NaN;return null!=g&&!isNaN(g)&&-1<=g&&(-1===f||g<=f)?g:f}},{key:"minLength",get:function(){if(this.type===n.Date)return-1;const {field:a,fieldElement:e}=this,f=a?.length,g=E(e)?e.input.minLength:NaN;return null!=g&&!isNaN(g)&&-1<=g&&(-1===f||g<=f)?g:-1}},{key:"name",get:function(){return this.field?.name}},{key:"required",get:function(){const {editable:a,
evaluatedRequiredExpression:e,field:f,visible:g}=this;return a?!1===f?.nullable?!0:g&&k.isSome(e)?e:!1:!1},set:function(a){this._overrideIfSome("required",a)}},{key:"submittable",get:function(){const {field:a,required:e,valid:f,value:g}=this;return e&&k.isNone(g)?!1:f?!0:this.initialFeature.getAttribute(a.name)===g}},{key:"type",get:function(){const {field:a}=this;return m.isNumericField(a)?n.Number:m.isStringField(a)?n.Text:m.isDateField(a)?n.Date:n.Unsupported}},{key:"updating",get:function(){const {editableExpressionExecutor:a,
valueExpressionExecutor:e}=this;return k.isSome(e)&&e.updating||k.isSome(a)&&a.updating}},{key:"valid",get:function(){const a=this.editable?this._validate():null;this._set("error",a);return null===a}},{key:"value",get:function(){if(this._shouldUseValueExpression()){const a=this.evaluatedValueExpression;if(this.type===n.Date){if(a instanceof Date)return a.getTime();if("number"!==typeof a)return parseInt(a,10)}return k.isSome(a)&&"object"===typeof a?a.toString():a}return this.get("_storedValue")},set:function(a){this.notifyChange("evaluatedVisibilityExpression");
this.set("_storedValue",a)}},{key:"visible",get:function(){return this._isEditorField()?!1:k.isSome(this.evaluatedVisibilityExpression)?this.evaluatedVisibilityExpression:k.isSome(this.fieldElement)?!0:this._isVisibleByDefault()}}]);return q}(G.HandleOwnerMixin(F));c.__decorate([d.property()],b.prototype,"_storedValue",void 0);c.__decorate([d.property()],b.prototype,"_configAllowsEdits",null);c.__decorate([d.property()],b.prototype,"_layerFieldAllowsEdits",null);c.__decorate([d.property()],b.prototype,
"arcadeEditType",void 0);c.__decorate([d.property()],b.prototype,"editableExpressionExecutor",void 0);c.__decorate([d.property()],b.prototype,"requiredExpressionExecutor",void 0);c.__decorate([d.property()],b.prototype,"valueExpressionExecutor",void 0);c.__decorate([d.property()],b.prototype,"isUsingValueExpression",null);c.__decorate([d.property()],b.prototype,"visibilityExpressionExecutor",void 0);c.__decorate([d.property()],b.prototype,"evaluatedEditableExpression",null);c.__decorate([d.property()],
b.prototype,"evaluatedRequiredExpression",null);c.__decorate([d.property()],b.prototype,"evaluatedVisibilityExpression",null);c.__decorate([d.property()],b.prototype,"evaluatedValueExpression",null);c.__decorate([d.property()],b.prototype,"feature",void 0);c.__decorate([d.property()],b.prototype,"field",void 0);c.__decorate([d.property({constructOnly:!0})],b.prototype,"fieldElement",void 0);c.__decorate([d.property()],b.prototype,"initialFeature",null);c.__decorate([d.property()],b.prototype,"layer",
void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"description",null);c.__decorate([d.property()],b.prototype,"domain",null);c.__decorate([d.property()],b.prototype,"editable",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"inputType",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"error",void 0);c.__decorate([d.property({dependsOn:["error","messages","value"]})],b.prototype,"errorMessage",null);c.__decorate([d.property()],b.prototype,"group",void 0);c.__decorate([d.property({readOnly:!0})],
b.prototype,"hint",null);c.__decorate([d.property()],b.prototype,"includeTime",null);c.__decorate([d.property()],b.prototype,"label",null);c.__decorate([d.property()],b.prototype,"maxLength",null);c.__decorate([d.property()],b.prototype,"minLength",null);c.__decorate([d.property()],b.prototype,"messages",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"name",null);c.__decorate([d.property()],b.prototype,"required",null);c.__decorate([d.property()],b.prototype,"submittable",null);c.__decorate([d.property()],
b.prototype,"type",null);c.__decorate([d.property()],b.prototype,"updating",null);c.__decorate([d.property()],b.prototype,"valid",null);c.__decorate([d.property({value:null})],b.prototype,"value",null);c.__decorate([d.property()],b.prototype,"visible",null);b=c.__decorate([I.subclass("esri.widgets.FeatureForm.InputField")],b);const O=(h,q)=>{if(!h)return!0;({operations:h}=h);switch(q){case "INSERT":return h.supportsAdd;case "UPDATE":case "DELETE":return h.supportsUpdate;default:return!0}},E=h=>k.isSome(h)&&
(x.isFieldElementWithInputType(h,"text-box")||x.isFieldElementWithInputType(h,"text-area"));return b});