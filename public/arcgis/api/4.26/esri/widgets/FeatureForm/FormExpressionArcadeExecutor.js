// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../arcade ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../layers/support/fieldUtils".split(" "),function(a,k,c,m,q,r,e,n,y,z,t,u,v){n=Symbol("FormExpressionArcadeExecutor");a.FormExpressionArcadeExecutor=function(d){function f(g){var b=
l.call(this,g);b[w]=!0;b._lastEvaluatedValue=null;b._abortController=new AbortController;b._stale=!1;b._updatingTracking=new u.WatchUpdatingTracking;b._executeAsyncDebounced=r.debounce(async(h,x,p)=>{h=await b.executor.executeAsync(h,{...x,abortSignal:p});if(p.aborted)return b._lastEvaluatedValue;b._lastEvaluatedValue=h;b._stale=!1;return h});return b}k._inherits(f,d);var l=k._createSuper(f);d=f.prototype;d.abort=function(){this._abortController.abort()};d.execute=function(g,b){this._abortController=
new AbortController;return this._lastEvaluatedValue=g=this.executor.execute(g,{...b,abortSignal:this._abortController.signal})};d.executeAsync=async function(g,b){this._abortController=new AbortController;return this._updatingTracking.addPromise(this._executeAsyncDebounced(g,b??{},this._abortController.signal))};d.markStale=function(){this._stale=!0};d.reset=function(){this.abort();this._lastEvaluatedValue=null;this._stale=!1};k._createClass(f,[{key:"isAsync",get:function(){return this.executor.isAsync}},
{key:"fieldsUsed",get:function(){return this.executor.fieldsUsed}},{key:"syntaxTree",get:function(){return this.executor.syntaxTree}},{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"stale",get:function(){return this._stale}},{key:"geometryUsed",get:function(){return this.executor.geometryUsed}},{key:"variablesUsed",get:function(){return this.executor.variablesUsed}},{key:"lastEvaluatedValue",get:function(){return this._lastEvaluatedValue}}]);return f}(q);var w=n;c.__decorate([e.property()],
a.FormExpressionArcadeExecutor.prototype,"_lastEvaluatedValue",void 0);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"_stale",void 0);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"_updatingTracking",void 0);c.__decorate([e.property({constructOnly:!0})],a.FormExpressionArcadeExecutor.prototype,"executor",void 0);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"isAsync",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,
"fieldsUsed",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"syntaxTree",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"updating",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"stale",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"geometryUsed",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,"variablesUsed",null);c.__decorate([e.property()],a.FormExpressionArcadeExecutor.prototype,
"lastEvaluatedValue",null);a.FormExpressionArcadeExecutor=c.__decorate([t.subclass("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],a.FormExpressionArcadeExecutor);a.createFormExpressionArcadeExecutor=async(d,f)=>{const l=m.createArcadeProfile("form-calculation");d=await m.createArcadeExecutor(d,l,{});f?.fieldsIndex&&(d.fieldsUsed=v.fixFields(f.fieldsIndex,d.fieldsUsed));return new a.FormExpressionArcadeExecutor({executor:d})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});