// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Basemap ../../core/Collection ../../core/HandleOwner ../../core/Loadable ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(n,f,z,q,d,r,t,u,h,A,F,G,B,p,v,C,w,x,D,m){const y=q.ofType(x);d=function(g){function l(a){a=E.call(this,a);a._loadingProjectionEngine=!1;a.items=new y;a.source=new m;a.view=null;return a}n._inherits(l,g);var E=n._createSuper(l);g=l.prototype;g.initialize=function(){const a=()=>this._recreateItems();this.handles.add([u.watch(()=>"ready"===this.state?this.compatibilityFunction:null,()=>this._updateItems()),u.on(()=>this.source?.basemaps,"change",a,{onListenerAdd:a})])};g.castSource=function(a){return Array.isArray(a)||
q.isCollection(a)?new D({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new m({portal:a}):!a||a instanceof m||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new m(a)};g.basemapEquals=function(a,b){return C.contentEquals(a,b)};g.refresh=function(){this._recreateItems()};g.load=function(a){this.addResolvingPromise(r.isLoadable(this.source)?this.source.load(a):null);return Promise.resolve(this)};g._recreateItems=function(){const a=this.source?.basemaps,{view:b,compatibilityFunction:e}=
this;this.items.removeAll().forEach(c=>c.destroy());a&&this.items.addMany(a.map(c=>new x({basemap:c,compatibilityFunction:e,view:b})))};g._updateItems=function(){for(const a of this.items)a.compatibilityFunction=this.compatibilityFunction,a.view=this.view};n._createClass(l,[{key:"activeBasemap",get:function(){return this.view?.map?.basemap??null},set:function(a){const b=this.view;if(b?.map){var e="string"===typeof a?z.fromId(a):a;if(e&&b.ready){var c=e.spatialReference||this.items?.find(k=>this.basemapEquals(e,
k.basemap))?.spatialReference;if(c&&"spatialReferenceLocked"in b&&!b.spatialReferenceLocked){const k=b.spatialReference;!t.isSome(c)||v.equals(k,c)||p.canProjectWithoutEngine(b.spatialReference,c)||p.isLoaded()?(b.map.basemap=e,this._clearOverride("activeBasemap"),t.isSome(c)&&!v.equals(b.spatialReference,c)&&(b.spatialReference=c)):(this._override("activeBasemap",e),this._loadingProjectionEngine=!0,p.load().then(()=>{this._get("activeBasemap")===a&&(b.map.basemap=a,b.spatialReference=c,this._clearOverride("activeBasemap"))},
()=>{}).then(()=>{this._loadingProjectionEngine=!1}))}else b.map.basemap=e,this._clearOverride("activeBasemap")}else b.map.basemap=e,this._clearOverride("activeBasemap")}}},{key:"activeBasemapIndex",get:function(){const {state:a,items:b,activeBasemap:e}=this;if("ready"!==a)return-1;const c=b.findIndex(k=>k.basemap===e);return-1===c?b.findIndex(k=>this.basemapEquals(k.basemap,e)):c}},{key:"compatibilityFunction",get:function(){return"3d"===this.view?.type?w.default3DCompatibility:w.default2DCompatibility},
set:function(a){this._overrideIfSome("compatibilityFunction",a)}},{key:"state",get:function(){return this.view?.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}}]);return l}(d.HandleOwnerMixin(r));f.__decorate([h.property()],d.prototype,"_loadingProjectionEngine",void 0);f.__decorate([h.property()],d.prototype,"activeBasemap",null);f.__decorate([h.property({readOnly:!0})],d.prototype,"activeBasemapIndex",null);f.__decorate([h.property()],d.prototype,"compatibilityFunction",
null);f.__decorate([h.property({readOnly:!0,type:y})],d.prototype,"items",void 0);f.__decorate([h.property()],d.prototype,"source",void 0);f.__decorate([A.cast("source")],d.prototype,"castSource",null);f.__decorate([h.property({readOnly:!0})],d.prototype,"state",null);f.__decorate([h.property()],d.prototype,"view",void 0);return d=f.__decorate([B.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],d)});