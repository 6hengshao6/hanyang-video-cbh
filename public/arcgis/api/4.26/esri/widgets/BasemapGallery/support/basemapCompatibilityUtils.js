// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/ViewingMode ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),function(m,f,k,l,n,p,q,t,u){function r(){throw new f("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}async function v(a,b){const {basemap:c,view:e}=a;
await c.load(b);if(0!==c.baseLayers.length){a=c.baseLayers.concat(c.referenceLayers).toArray().filter(d=>!n.isBasemapSupportedLayer(d)).map(d=>new f("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:d,operationalLayerType:d.operationalLayerType||"unknown"}));if(a.length)throw a[0];a=c.baseLayers.getItemAt(0);if(n.isBasemapSupportedLayer(a)){try{await a.load(b)}catch(d){const {name:g="basemap-compatibility:unknown-error",message:h=
"Unknown basemap compatibility error",details:w}=d;throw new f(g,h,w);}x(a,e)}}}function x(a,b){const c=b.state.viewingMode;if(c){if("wmts"===a?.type){var e=q.getTileInfoAndExtentFromWMTSLayer(a,b.spatialReference,c);if(k.isNone(e.tileInfo))throw new f("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");var d=e.tileInfo;e=e.fullExtent}else d=a.tileInfo,e=a.fullExtent;if(!k.isNone(d)){if(!u.isSpatialReferenceSupported(d.spatialReference,c))throw new f(`basemapgalleryitem:spatial-reference-unsupported-${p.stringFromViewingMode(c)}`,
`Basemap spatial reference is unsupported in ${p.stringFromViewingMode(c)} mode`);var g=d.spatialReference.isGeographic;g="vector-tile"===a?.type?d.getOrCreateCompatible(256,g?1:2):null;if(c===p.ViewingMode.Global){let h=q.checkIfTileInfoSupportedForView(d,e,null,c);h&&"vector-tile"===a?.type&&k.isSome(e)&&g&&!q.checkIfTileInfoSupportedForView(g,e,null,c)&&(h=null);if(h)throw new f(`basemapgalleryitem:tiling-scheme-unsupported-${d.spatialReference.isWebMercator?"web-mercator":"wgs84"}-global`,"Basemap tiling scheme is unsupported in global mode",
{error:h});}else if(t.TilingScheme.checkUnsupported(d))throw new f("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");b=b.get("basemapTerrain.tilingScheme");if(!(!b||b.compatibleWith(d)||"vector-tile"===a?.type&&g&&b.compatibleWith(g)))throw new f("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}}m.default2DCompatibility=async function(a,b={}){const {basemap:c,view:e}=a;l.throwIfAborted(b);
if(!(!e||"spatialReferenceLocked"in e&&!e.spatialReferenceLocked)&&(await c.load(b),l.throwIfAborted(b),0!==c.baseLayers.length&&(a=c.baseLayers.getItemAt(0),n.isTiledLayer(a)))){if(c.spatialReference){if(e.spatialReference.equals(c.spatialReference))return;r()}await a.load(b);l.throwIfAborted(b);b=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?a.tileInfo?.spatialReference:null]).filter(k.isSome);0!==b.length&&b.every(d=>!e.spatialReference.equals(d))&&r()}};
m.default3DCompatibility=async function(a,b={}){await v(a,b);l.throwIfAborted(b)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});