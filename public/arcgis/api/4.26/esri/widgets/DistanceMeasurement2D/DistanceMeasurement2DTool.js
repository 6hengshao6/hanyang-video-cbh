// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../intl ../../symbols ../../core/analysisThemeUtils ../../core/maybe ../../core/reactiveUtils ../../core/unitFormatUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/geometryEngine ../../geometry/projection ../../geometry/support/geodesicUtils ../../layers/GraphicsLayer ../../views/ViewingMode ../../views/draw/Draw ../../views/interactive/dragEventPipeline ../../views/interactive/GraphicManipulator ../../views/interactive/InteractiveToolBase ../../intl/messages ../../intl/locale ../../geometry/Point ../../symbols/CIMSymbol ../../symbols/TextSymbol ../../symbols/Font ../../symbols/SimpleMarkerSymbol ../../geometry/Polyline ../../geometry/SpatialReference".split(" "),
function(e,x,k,aa,y,ba,ca,t,u,C,z,N,l,da,ea,fa,O,A,v,n,D,P,Q,B,R,S,E,T,F,U,V,W,G,X,H){function Y(b,c,d){var a=t.getAccentColor(.5);const g={type:"simple-line",width:0},f=new G({style:"circle",color:a,size:8,outline:g});a=new G({style:"circle",color:a,size:12,outline:g});b=new y({geometry:b,symbol:f});return new R.GraphicManipulator({view:c,layer:d,graphic:b,focusedSymbol:a})}function I(b,c,d){b=new X({paths:[b],spatialReference:c});if(c.isGeographic)if(n.isSupported(c))d=n.geodesicLengths([b],"meters")[0],
c=n.geodesicDensify(b,1E5);else{d=v.project(b,H.WGS84);var a=n.geodesicDensify(d,1E5);d=n.geodesicLengths([d],"meters")[0];c=v.project(a,c)}else c.isWebMercator?(d=A.geodesicLength(b,"meters"),c=A.geodesicDensify(b,1E5,"meters")):(a=A.planarLength(b,"meters"),a>=d?(d=v.project(b,H.WGS84),a=n.geodesicDensify(d,1E5),d=n.geodesicLengths([d],"meters")[0],c=v.project(a,c)):(d=a,c=b));return{measurement:{geometry:c,length:d},original:b,drawing:c}}function J(b,c,d){if(!c||!b)return"";switch(d){case "metric":return z.formatMetricLength(b,
c.length,"meters");case "imperial":return z.formatImperialLength(b,c.length,"meters");default:return z.formatDecimal(b,N.convertUnit(c.length,"meters",d),d)}}e.DistanceMeasurement2DTool=function(b){function c(a){a=d.call(this,a);a._drawActive=!1;a._measurementLayer=new D({internal:!0,listMode:"hide",visible:!1});a._manipulatorLayer=new D({internal:!0,listMode:"hide",visible:!1});a._vertices=[];a.geodesicDistanceThreshold=1E5;a.measurement=null;a.measurementLabel=null;return a}x._inherits(c,b);var d=
x._createSuper(c);b=c.prototype;b.initialize=function(){E.fetchMessageBundle("esri/core/t9n/Units").then(g=>{this.messages=g});this.addHandles(T.onLocaleChange(async()=>{this.messages=await E.fetchMessageBundle("esri/core/t9n/Units")}));const a=this.view;this._draw=new Q({view:a});a.map.addMany([this._measurementLayer,this._manipulatorLayer]);a.focus();this.addHandles(C.watch(()=>[this.unit,this.geodesicDistanceThreshold,this.messages],()=>{this._updatePolylines()},C.initial))};b.destroy=function(){const {map:a}=
this.view;this._draw.view=null;this._draw=u.destroyMaybe(this._draw);a.removeMany([this._measurementLayer,this._manipulatorLayer]);this._measurementLayer.removeAll();this._manipulatorLayer.removeAll();this._set("measurement",null);this._set("measurementLabel",null);this._measurementLayer=u.destroyMaybe(this._measurementLayer);this._manipulatorLayer=u.destroyMaybe(this._manipulatorLayer);this._resetVertices()};b.onActivate=function(){this._drawActive||0!==this._vertices.length||this._startSketch()};
b.onShow=function(){this._measurementLayer.visible=!0;this._manipulatorLayer.visible=!0};b.onHide=function(){this._measurementLayer.visible=!1;this._manipulatorLayer.visible=!1};b.reset=function(){this._resetVertices();this._measurementLayer.removeAll();this._set("measurement",null);this._set("measurementLabel",null);this._draw.reset();this._drawActive=!1;this._updateSketch([])};b._resetVertices=function(){for(const {handle:a}of this._vertices)a.remove();this._vertices=[]};b._startSketch=function(){this._drawActive=
!0;const a=this._draw.create("polyline",{mode:"click"});a.on("vertex-add vertex-update vertex-remove cursor-update undo redo".split(" "),g=>this._updateSketch(g.vertices));a.on("draw-complete",()=>{this._stopSketch()})};b._stopSketch=function(){this.manipulators.forEach(({manipulator:a})=>{a.interactive=!0});this._drawActive=!1;this.finishToolCreation()};b._updateSketch=function(a){const {spatialReference:g}=this.view;for(;this._vertices.length>a.length;){const {handle:h,manipulator:w}=this._vertices.pop();
h.remove();this.manipulators.remove(w)}for(let h=this._vertices.length;h<a.length;h++){const [w,K]=a[h];var f=new F({x:w,y:K,spatialReference:g});f=Y(f,this.view,this._manipulatorLayer);this.manipulators.add(f);var p=B.createManipulatorDragEventPipeline(f,(L,Z)=>{Z.next(B.screenToMap(this.view)).next(B.dragGraphic(L.graphic,P.ViewingMode.Local)).next(()=>{const M=L.graphic.geometry;this._vertices[h].coord=[M.x,M.y];this._updatePolylines()})});this._vertices.push({manipulator:f,coord:[w,K],handle:p})}f=
this._vertices.length-1;p=this._vertices[f];const [m,q]=a[f];if(p.coord[0]!==m||p.coord[1]!==q)p.coord=[m,q],p.manipulator.graphic.geometry=new F({x:m,y:q,spatialReference:g});const r=this._drawActive?this._vertices[f].manipulator:null;this.manipulators.forEach(({manipulator:h})=>{h.interactive=u.isNone(r)||h!==r});this._updatePolylines()};b._updatePolylines=function(){if(2>this._vertices.length)this._measurementLayer.removeAll();else{var a=this._vertices.map(({coord:h})=>h),{measurement:g,drawing:f,
original:p}=I(a,this.view.spatialReference,this.geodesicDistanceThreshold);this._set("measurement",g);a=J(this.messages,g,this.unit);this._set("measurementLabel",a);var {graphics:m}=this._measurementLayer;if(2===m.length){var q=m.at(0);var r=m.at(1)}else q=new y({symbol:new U({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,
capStyle:"Butt",joinStyle:"Round",width:3.5,color:t.getContrastColor().toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:5,color:t.getAccentColor().toArray()}]}}})}),r=new y({symbol:new V({color:t.getTextColor(),haloColor:t.getTextHaloColor(.5),haloSize:2,font:new W({size:14,family:"sans-serif"})})}),m.removeAll(),m.addMany([q,r]);q.geometry=f;r.geometry=p.extent?.center;r.symbol.text=a}};x._createClass(c,[{key:"cursor",get:function(){return this._drawActive?"crosshair":
null}},{key:"editable",set:function(a){this._set("editable",a);a||this._draw.reset()}}]);return c}(S.InteractiveToolBase);k.__decorate([l.property()],e.DistanceMeasurement2DTool.prototype,"_drawActive",void 0);k.__decorate([l.property({readOnly:!0})],e.DistanceMeasurement2DTool.prototype,"cursor",null);k.__decorate([l.property({value:!0})],e.DistanceMeasurement2DTool.prototype,"editable",null);k.__decorate([l.property({type:Number})],e.DistanceMeasurement2DTool.prototype,"geodesicDistanceThreshold",
void 0);k.__decorate([l.property({readOnly:!0})],e.DistanceMeasurement2DTool.prototype,"measurement",void 0);k.__decorate([l.property({readOnly:!0})],e.DistanceMeasurement2DTool.prototype,"measurementLabel",void 0);k.__decorate([l.property()],e.DistanceMeasurement2DTool.prototype,"messages",void 0);k.__decorate([l.property()],e.DistanceMeasurement2DTool.prototype,"unit",void 0);k.__decorate([l.property({constructOnly:!0})],e.DistanceMeasurement2DTool.prototype,"view",void 0);e.DistanceMeasurement2DTool=
k.__decorate([O.subclass("esri.widgets.DistanceMeasurement2D.DistanceMeasurement2DTool")],e.DistanceMeasurement2DTool);e.createDistanceMeasurementInfo2D=I;e.createDistanceMeasurementLabel=J;e.isProjectionEngineRequired=function(b){if(!b)return!1;const {isGeographic:c,isWebMercator:d,isWGS84:a}=b;return c&&!a&&!n.isSupported(b)||!c&&!d};e.isSupported=function(b){return null!=b};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});