// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Handles ../../core/handleUtils ../../core/maybe ../../core/memoize ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/elevationInfoUtils ./support/constants ./support/geometryUtils ./support/profileUtils".split(" "),
function(k,t,m,z,A,B,C,l,q,u,r,D,n,I,J,K,E,x,v,y,F){k.ElevationProfileController=function(h){function p(a){var b=G.call(this,a);b._handles=new B;b._updateTask=null;b._paramsPerProfile=new Map;b._getUpdateParametersMemoized=q.memoize((c,d,e)=>({stationary:c,visibleProfiles:d,generationParameters:e}));b._getGenerationParametersMemoized=q.memoize((c,d,e,g,f,w,H)=>y.isPolyline(d)&&y.isValidInputPath(d)&&!l.isNone(g)?{view:c,geometry:d,elevationInfo:e,options:w,queue:g,cache:f,slicePlane:H}:null);b._getElevationInfoMemoized=
q.memoize((c,d)=>({mode:c,offset:d}));b._getOptionsMemoized=q.memoize((c,d,e)=>{const {densificationMaxSamples:g,maxTotalSamples:f}=v.getConfig();return{geodesicDistanceThreshold:c,samplingDistance:d,densificationMaxSamples:Math.round(g/e),maxTotalSamples:f}});b._updateThrottled=D.throttle(c=>u.ignoreAbortErrors(b._update(c)),v.getConfig().updateThrottleMillis);return b}t._inherits(p,h);var G=t._createSuper(p);h=p.prototype;h.initialize=function(){const a=this.viewModel;this._handles.add([r.watch(()=>
a.profiles.toArray(),b=>{this._abortUpdate();this._paramsPerProfile.clear();this._handles.remove("line-change");this._handles.add(b.map(c=>C.handlesGroup([c.attach(this.viewModel),c.on("change",()=>{this._invalidateProfile(c)})])),"line-change")},r.syncAndInitial),this._updateThrottled,r.watch(()=>this._updateParameters,this._updateThrottled,r.syncAndInitial)])};h.destroy=function(){this._handles.destroy();this._paramsPerProfile.clear()};h._update=async function({stationary:a,visibleProfiles:b,generationParameters:c}){this._abortUpdate();
a&&(l.isNone(c)?this._clearResults():this._updateTask=A.createTask(async d=>{this.viewModel.error=null;const e=b.filter(f=>!this._isProfileValid(f,c));var g=F.generateProfiles({...c,providers:e},{signal:d});try{for await(const f of g)for(u.throwIfAborted(d),this._clearInvalidResults(c),g=0;g<e.length;g++)e[g].result=f[g];for(const f of e)this._paramsPerProfile.set(f,c)}catch(f){u.throwIfAbortError(f),this._abortUpdate(),this.viewModel.error=f,e.forEach(w=>{w.result=null})}}))};h._abortUpdate=function(){this._updateTask=
l.abortMaybe(this._updateTask)};h._isProfileValid=function(a,b){return this._paramsPerProfile.has(a)&&this._paramsPerProfile.get(a)===b};h._invalidateProfile=function(a){this._paramsPerProfile.delete(a);this._updateThrottled(this._updateParameters)};h._clearInvalidResults=function(a){for(const b of this.viewModel.profiles.items)this._isProfileValid(b,a)||(b.result=null,this._paramsPerProfile.delete(b))};h._clearResults=function(){for(const a of this.viewModel.profiles.items)a.result=null,this._paramsPerProfile.delete(a)};
t._createClass(p,[{key:"_updateParameters",get:function(){var {viewModel:a}=this;a=a.view;return this._getUpdateParametersMemoized(l.isSome(a)?a.stationary:!0,this.viewModel.visibleProfiles,this._generationParameters)}},{key:"_generationParameters",get:function(){const {view:a,input:b,queue:c,tileCache:d}=this.viewModel;return l.isNone(a)||!a.ready?null:this._getGenerationParametersMemoized(a,l.applySome(b,e=>e.geometry),this._elevationInfo,c,d,this._options,"3d"===a.type?a.slicePlane:null)}},{key:"_elevationInfo",
get:function(){const a=l.applySome(this.viewModel.input,b=>x.hasGraphicFeatureExpressionInfo(b)?null:x.getGraphicEffectiveElevationInfo(b));return l.isSome(a)?this._getElevationInfoMemoized(a.mode,a.offset):null}},{key:"_options",get:function(){const a=this.viewModel,b=a.visibleProfiles.length;let c=l.unwrapOr(a.minDemResolution,v.getConfig().defaultDemResolution);c=parseFloat(c.toFixed(2));return this._getOptionsMemoized(a.geodesicDistanceThreshold,c,b)}}]);return p}(z);m.__decorate([n.property({nonNullable:!0})],
k.ElevationProfileController.prototype,"viewModel",void 0);m.__decorate([n.property()],k.ElevationProfileController.prototype,"_updateParameters",null);m.__decorate([n.property()],k.ElevationProfileController.prototype,"_generationParameters",null);m.__decorate([n.property()],k.ElevationProfileController.prototype,"_elevationInfo",null);m.__decorate([n.property()],k.ElevationProfileController.prototype,"_options",null);k.ElevationProfileController=m.__decorate([E.subclass("esri.widgets.ElevationProfile.ElevationProfileController")],
k.ElevationProfileController);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});