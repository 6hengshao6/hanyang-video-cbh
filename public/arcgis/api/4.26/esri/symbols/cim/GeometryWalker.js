// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/_rollupPluginBabelHelpers","./CIMCursor","./CurveHelper"],function(h,l,n,p){let q=function(){function c(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}var f=c.prototype;f.isEmpty=function(){return 0===this._values.length};f.size=function(){return this._values.length};f.init=function(e,a,b=!0){this._setEmpty();if(!e||0===e.length)return!1;for(let d=0;d<e.length;d++){let k=Math.abs(e[d]);b&&1E-7>k&&(k=1E-7);this._values.push(k);this._length+=
k}a&&e.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0};f.scale=function(e){const a=this._values?this._values.length:0;for(let b=0;b<a;++b)this._values[b]*=e;this._length*=e;this.extPtGap*=e;this.ctrlPtGap*=e};f.addValue=function(e){this._length+=e;this._values.push(e)};f.firstValue=function(){return this._values[0]};f.lastValue=function(){return this._values[this._values.length-1]};f.nextValue=function(){this._currentValue++;
this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]};f.reset=function(){this._currentValue=-1};f.length=function(){return this._length};f._setEmpty=function(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0};return l._createClass(c)}(),r=l._createClass(function(){this.pt=null;this.sa=this.ca=0});h.EndType=void 0;(function(c){c[c.FAIL=0]="FAIL";c[c.END=1]="END";c[c.CONTINUE=2]="CONTINUE"})(h.EndType||(h.EndType=
{}));let m=function(){function c(){this.reset()}var f=c.prototype;f.reset=function(){this.segment=-1;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1};f.isValid=function(){return-1!==this.segment};f.copyTo=function(e){e.segment=this.segment;e.segmentLength=this.segmentLength;e.abscissa=this.abscissa;e.isPathEnd=this.isPathEnd;e.isPartEnd=this.isPartEnd};return l._createClass(c)}(),u=function(c){function f(a=0,b=!1){a=e.call(this,a,b);a._tolerance=p.PIXEL_TOLERANCE;a._currentPosition=
new m;return a}l._inherits(f,c);var e=l._createSuper(f);c=f.prototype;c.updateTolerance=function(a){this._tolerance=p.PIXEL_TOLERANCE*a};c.init=function(a,b,d=!0){d?(this._patternLength=b.length(),this._partExtPtGap=b.extPtGap,this._partCtrlPtGap=b.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._path=a;this._seg=-1;return this._setPosAtNextPart()};c.curPositionIsValid=function(){return this._currentPosition.isValid()};
c.nextPosition=function(a,b=h.EndType.FAIL){const d=new m;if(!this._nextPosition(a,d,null,b))return!1;d.copyTo(this._currentPosition);return!0};c.curPointAndAngle=function(a){a.pt=this._getPoint(this._currentPosition);const [b,d]=this._getAngle(this._currentPosition);a.ca=b;a.sa=d};c.nextPointAndAngle=function(a,b,d=h.EndType.FAIL){const k=new m;if(!this._nextPosition(a,k,null,d))return!1;k.copyTo(this._currentPosition);b.pt=this._getPoint(k);const [g,t]=this._getAngle(k);b.ca=g;b.sa=t;return!0};
c.nextCurve=function(a){if(0===a)return null;const b=[],d=new m;if(!this._nextPosition(a,d,b,h.EndType.END))return null;d.copyTo(this._currentPosition);return b};c.isPathEnd=function(){return this._currentPosition.isPathEnd};c.getPathEnd=function(){if(-1===this._currentPosition.segment)throw Error("missing segment");return this._path[this._currentPosition.segment+1]};c._nextPosition=function(a,b,d,k){if(this._currentPosition.isPathEnd)return!1;var g=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&
(g/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(b);b.abscissa+a*this._partLengthRatio>b.segmentLength+this._tolerance;)if(d&&(0===d.length&&(0===g?(g=this._path[b.segment],d.push([g[0],g[1]])):d.push(this.getSegCoord2D(this._path,b.segment,g))),g=this._path[b.segment+1],d.push([g[0],g[1]])),g=0,a-=(b.segmentLength-b.abscissa)/this._partLengthRatio,this._partSegCount)b.segment=this._nextSegment(),b.segmentLength=this.calculateSegLength(this._path,b.segment),b.abscissa=0,this._partSegCount--;
else{if(!this._setPosAtNextPart()){if(k===h.EndType.FAIL)return!1;b.segmentLength=this.calculateSegLength(this._path,b.segment);b.isPartEnd=!0;k===h.EndType.END?(b.abscissa=b.segmentLength,b.isPathEnd=!0):b.abscissa=b.segmentLength+a;return!0}this._currentPosition.copyTo(b)}b.abscissa+=a*this._partLengthRatio;d&&(0===d.length&&(0===g?(a=this._path[b.segment],d.push([a[0],a[1]])):d.push(this.getSegCoord2D(this._path,b.segment,g))),a=b.abscissa/b.segmentLength,1===a?(a=this._path[b.segment+1],d.push([a[0],
a[1]])):d.push(this.getSegCoord2D(this._path,b.segment,a)));!this._partSegCount&&Math.abs(b.abscissa-b.segmentLength)<this._tolerance&&(b.isPathEnd=this._partIsLast,b.isPartEnd=!0);return!0};c._getPoint=function(a){if(-1===a.segment)throw Error("missing segment");return this.getSegCoord2D(this._path,a.segment,0>=a.segmentLength?0:a.abscissa/a.segmentLength)};c._getAngle=function(a){if(-1===a.segment)throw Error("missing segment");return this.getSegAngleCS(this._path,a.segment,0>=a.segmentLength?0:
a.abscissa/a.segmentLength)};c._setPosAtNextPart=function(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this._nextSegment()),this._partSegCount++,1===n.getId(this._path[this._getEndPointIndex()])){this._partIsLast=!this._hasNextSegment();break}for(var a=this._partSegCount;a;)this._previousSegment(),
--a;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1;--this._partSegCount;a=this._getStartPointIndex();this._ctrlPtBegin=1===n.getId(this._path[a]);a=a+this._partSegCount+1;a>=this._path.length&&(a=0);this._ctrlPtEnd=1===n.getId(this._path[a]);if(0<this._patternLength){a=this._ctrlPtBegin?this._partCtrlPtGap:
this._partExtPtGap;const b=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let d=Math.round((this._partLength-(a+b))/this._patternLength);0>=d&&(d=0<a+b?0:1);this._partLengthRatio=this._partLength/(a+b+d*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0};c._hasNextSegment=function(){return this._seg<this._path.length-2};c._previousSegment=function(){return--this._seg};c._nextSegment=function(){return++this._seg};c._getStartPointIndex=
function(){return this._seg};c._getEndPointIndex=function(){return this._seg+1};return l._createClass(f)}(p.CurveHelper);h.DashPattern=q;h.GeometryWalker=u;h.Pos=r;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});