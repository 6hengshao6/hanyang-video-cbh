// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/BidiText ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/maybe ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/alignmentUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(x,u,W,X,Y,G,H,Z,K,aa,N,ba,ca,q,da,ea,O,fa,I,L,ha,P,w,z,Q,ia){function R(g,l=1){const c=w.fromCIMFontDecoration(g);var a=w.fromCIMFontStyle(g.fontStyleName);const b=X.getFontFamily(g.fontFamilyName),{weight:e,style:d}=a;a=l*(g.height||5);const f=w.fromCIMHorizontalAlignment(g.horizontalAlignment),h=w.fromCIMVerticalAlignment(g.verticalAlignment),k=w.getFillColor(g),m=w.getStrokeColor(g.haloSymbol);g=m?l*(g.haloSize|0):0;return{color:k,size:a,horizontalAlignment:f,verticalAlignment:h,font:{family:b,
style:w.getFontStyle(d),weight:w.getFontWeight(e),decoration:c},halo:{size:g||0,color:m,style:d},pixelRatio:1,premultiplyColors:!0}}const A=Math.PI/180,S=G.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let C=function(){function g(c){this._t=c}g.createIdentity=function(){return new g([1,0,0,0,1,0])};var l=g.prototype;l.clone=function(){return new g(this._t.slice())};l.transform=function(c){const a=this._t;return[a[0]*c[0]+a[1]*c[1]+a[2],a[3]*c[0]+a[4]*c[1]+a[5]]};g.createScale=function(c,a){return new g([c,
0,0,0,a,0])};l.scale=function(c,a){const b=this._t;b[0]*=c;b[1]*=c;b[2]*=c;b[3]*=a;b[4]*=a;b[5]*=a;return this};l.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};g.createTranslate=function(c,a){return new g([0,0,c,0,0,a])};l.translate=function(c,a){const b=this._t;b[2]+=c;b[5]+=a;return this};g.createRotate=function(c){const a=Math.cos(c);c=Math.sin(c);return new g([a,-c,0,c,a,0])};l.rotate=function(c){return g.multiply(this,g.createRotate(c),this)};l.angle=function(){const c=
this._t[0],a=this._t[3],b=Math.sqrt(c*c+a*a);return[c/b,a/b]};g.multiply=function(c,a,b){c=c._t;a=a._t;const e=c[1]*a[0]+c[4]*a[1],d=c[2]*a[0]+c[5]*a[1]+a[2],f=c[0]*a[3]+c[3]*a[4],h=c[1]*a[3]+c[4]*a[4],k=c[2]*a[3]+c[5]*a[4]+a[5],m=b._t;m[0]=c[0]*a[0]+c[3]*a[1];m[1]=e;m[2]=d;m[3]=f;m[4]=h;m[5]=k;return b};l.invert=function(){const c=this._t;let a=c[0]*c[4]-c[1]*c[3];if(0===a)return new g([0,0,0,0,0,0]);a=1/a;return new g([c[4]*a,-c[1]*a,(c[1]*c[5]-c[2]*c[4])*a,-c[3]*a,c[0]*a,(c[2]*c[3]-c[0]*c[5])*
a])};return u._createClass(g)}();G=function(){function g(c,a){this._resourceManager=c;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new Z(fa.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(a||C.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}var l=g.prototype;l.setTransform=function(c,a){this._transfos=[c||C.createIdentity()];this._sizeTransfos=[a||(c?c.scaleRatio():1)]};l.setGeomUnitsPerPoint=function(c){this._geomUnitsPerPoint=
c};l.transformPt=function(c){return this._transfos[this._transfos.length-1].transform(c)};l.transformSize=function(c){return c*this._sizeTransfos[this._sizeTransfos.length-1]};l.reverseTransformPt=function(c){return this._transfos[this._transfos.length-1].invert().transform(c)};l.reverseTransformSize=function(c){return c/this._sizeTransfos[this._sizeTransfos.length-1]};l.getTransformAngle=function(){return this._transfos[this._transfos.length-1].angle()};l.geomUnitsPerPoint=function(){return this.isEmbedded()?
1:this._geomUnitsPerPoint};l.isEmbedded=function(){return 1<this._transfos.length};l.back=function(){return this._transfos[this._transfos.length-1]};l.push=function(c,a){a=a?c.scaleRatio():1;C.multiply(c,this.back(),c);this._transfos.push(c);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*a)};l.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};l.drawSymbol=function(c,a,b){if(c)switch(c.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(c,
a);break;case "CIMTextSymbol":this.drawTextSymbol(c,a,b)}};l.drawMultiLayerSymbol=function(c,a){if(c&&a){var b=c.symbolLayers;if(b)if((c=c.effects)&&0<c.length){if(a=this.executeEffects(c,a))for(c=a.next();c;)this.drawSymbolLayers(b,c),c=a.next()}else this.drawSymbolLayers(b,a)}};l.executeEffects=function(c,a){const b=this._resourceManager.geometryEngine;a=new da.SimpleGeometryCursor(a);for(const e of c)(c=O.getEffectOperator(e))&&(a=c.execute(a,e,this.geomUnitsPerPoint(),null,b));return a};l.drawSymbolLayers=
function(c,a){let b=c.length;for(;b--;){const d=c[b];if(d&&!1!==d.enable){var e=d.effects;if(e&&0<e.length){if(e=this.executeEffects(e,a)){let f=null;for(;(f=e.next())&&(this.drawSymbolLayer(d,f),!this._earlyReturn););}}else this.drawSymbolLayer(d,a);if(this._earlyReturn)break}}};l.drawSymbolLayer=function(c,a){switch(c.type){case "CIMSolidFill":this.drawSolidFill(a,c.color);break;case "CIMHatchFill":this.drawHatchFill(a,c);break;case "CIMPictureFill":this.drawPictureFill(a,c);break;case "CIMGradientFill":this.drawGradientFill(a,
c);break;case "CIMSolidStroke":this.drawSolidStroke(a,c.color,c.width,c.capStyle,c.joinStyle,c.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(a,c);break;case "CIMGradientStroke":this.drawGradientStroke(a,c);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(c,a)}};l.drawHatchFill=function(c,a){const b=this._buildHatchPolyline(a,c,this.geomUnitsPerPoint());b&&(this.pushClipPath(c),this.drawMultiLayerSymbol(a.lineSymbol,b),this.popClipPath())};
l.drawPictureFill=function(c,a){};l.drawGradientFill=function(c,a){};l.drawPictureStroke=function(c,a){};l.drawGradientStroke=function(c,a){};l.drawMarkerLayer=function(c,a){var b=c.markerPlacement;if(b){var e=O.getPlacementOperator(b);if(e){var d="CIMMarkerPlacementInsidePolygon"===b.type||"CIMMarkerPlacementPolygonCenter"===b.type&&b.clipAtBoundary;d&&this.pushClipPath(a);if(a=e.execute(aa.getJSONCursor(a),b,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(b=null;(b=a.next())&&
(this.drawMarker(c,b),!this._earlyReturn););d&&this.popClipPath()}}else{d=this._placementPool.acquire();if(q.isPoint(a))d.tx=a.x,d.ty=a.y,this.drawMarker(c,d);else if(q.isPolygon(a)){if(a=ca.polygonCentroid(a))[d.tx,d.ty]=a,this.drawMarker(c,d)}else for(e of a.points)if(d.tx=e[0],d.ty=e[1],this.drawMarker(c,d),this._earlyReturn)break;this._placementPool.release(d)}};l.drawMarker=function(c,a){switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(c,a);break;case "CIMVectorMarker":this.drawVectorMarker(c,
a)}};l.drawPictureMarker=function(c,a){if(c){var b=this._resourceManager.getResource(c.url),e=c.size??10;if(!(H.isNone(b)||0>=e)){var d=b.width;b=b.height;if(d&&b){b=d/b;var f=c.scaleX??1;d=C.createIdentity();var h=c.anchorPoint;if(h){var k=h.x;h=h.y;"Absolute"!==c.anchorPointUnits&&(k*=e*b*f,h*=e);d.translate(-k,-h)}b=c.rotation??0;c.rotateClockwise&&(b=-b);this._mapRotation&&(b+=this._mapRotation);b&&d.rotate(b*A);b=c.offsetX??0;f=c.offsetY??0;if(b||f){if(this._mapRotation){h=A*this._mapRotation;
k=Math.cos(h);h=Math.sin(h);const m=b*h+f*k;b=b*k-f*h;f=m}d.translate(b,f)}b=this.geomUnitsPerPoint();1!==b&&d.scale(b,b);(b=a.getAngle())&&d.rotate(b);d.translate(a.tx,a.ty);this.push(d,!1);this.drawImage(c,e);this.pop()}}}};l.drawVectorMarker=function(c,a){if(c){var b=c.markerGraphics;if(b){var e=c.size??10,d=c.frame,f=d?d.ymax-d.ymin:0;f=e&&f?e/f:1;e=C.createIdentity();d&&e.translate(.5*-(d.xmax+d.xmin),.5*-(d.ymax+d.ymin));var h=c.anchorPoint;if(h){var k=h.x;h=h.y;"Absolute"!==c.anchorPointUnits?
d&&(k*=d.xmax-d.xmin,h*=d.ymax-d.ymin):(k/=f,h/=f);e.translate(-k,-h)}1!==f&&e.scale(f,f);d=c.rotation??0;c.rotateClockwise&&(d=-d);this._mapRotation&&(d+=this._mapRotation);d&&e.rotate(d*A);d=c.offsetX??0;f=c.offsetY??0;if(d||f){if(this._mapRotation){h=A*this._mapRotation;k=Math.cos(h);h=Math.sin(h);const m=d*h+f*k;d=d*k-f*h;f=m}e.translate(d,f)}d=this.geomUnitsPerPoint();1!==d&&e.scale(d,d);(d=a.getAngle())&&e.rotate(d);e.translate(a.tx,a.ty);this.push(e,c.scaleSymbolsProportionally);for(const m of b)if(m&&
m.symbol&&m.geometry||S.error("Invalid marker graphic",m),this.drawSymbol(m.symbol,m.geometry,m.textString),this._earlyReturn)break;this.pop()}}};l.drawTextSymbol=function(c,a,b){if(c&&q.isPoint(a)&&!(0>=(c.height??10))){var e=C.createIdentity(),d=c.angle??0;(d=-d)&&e.rotate(d*A);d=c.offsetX??0;var f=c.offsetY??0;(d||f)&&e.translate(d,f);d=this.geomUnitsPerPoint();1!==d&&e.scale(d,d);e.translate(a.x,a.y);this.push(e,!1);this.drawText(c,b);this.pop()}};l._buildHatchPolyline=function(c,a,b){var e=(void 0!==
c.separation?c.separation:4)*b,d=void 0!==c.rotation?c.rotation:0;if(0===e)return null;0>e&&(e=-e);for(var f=0,h=.5*e;f>h;)f-=e;for(;f<-h;)f+=e;f=N.create();ba.getBoundsXY(f,a);f[0]-=h;f[1]-=h;f[2]+=h;f[3]+=h;for(var k=[[f[0],f[1]],[f[0],f[3]],[f[2],f[3]],[f[2],f[1]]];180<d;)d-=180;for(;0>d;)d+=180;h=Math.cos(d*A);var m=Math.sin(d*A);d=-e*m;a=e*h;f=(void 0!==c.offsetX?c.offsetX*b:0)*m-(void 0!==c.offsetY?c.offsetY*b:0)*h;let r;var n=c=Number.MAX_VALUE;r=b=-Number.MAX_VALUE;for(var t of k){var p=t[0];
const v=t[1];k=h*p+m*v;p=-m*p+h*v;n=Math.min(n,k);c=Math.min(c,p);r=Math.max(r,k);b=Math.max(b,p)}c=Math.floor(c/e)*e;t=h*n-m*c-d*f/e;n=m*n+h*c-a*f/e;k=h*r-m*c-d*f/e;f=m*r+h*c-a*f/e;e=1+Math.round((b-c)/e);h=[];for(m=0;m<e;m++)t+=d,n+=a,k+=d,f+=a,h.push([[t,n],[k,f]]);return{paths:h}};return u._createClass(g)}();let ja=function(g){function l(a,b){a=c.call(this,a,b);a.reset();return a}u._inherits(l,g);var c=u._createSuper(l);g=l.prototype;g.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=
this._ymax=-Infinity;this._clipCount=0};g.envelope=function(){return new ha(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};g.bounds=function(){return N.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)};g.drawSolidFill=function(a){!a||0<this._clipCount||(q.isPolygon(a)?this._processPath(a.rings,0):q.isPolyline(a)?this._processPath(a.paths,0):q.isExtent(a)?(a=D(a))&&this._processPath(a.rings,0):console.error("drawSolidFill Unexpected geometry type!"))};g.drawSolidStroke=
function(a,b,e){!a||0<this._clipCount||(b=.5*this.transformSize(e??0),q.isPolygon(a)?this._processPath(a.rings,b):q.isPolyline(a)?this._processPath(a.paths,b):q.isExtent(a)?(a=D(a))&&this._processPath(a.rings,b):console.error("drawSolidStroke unexpected geometry type!"))};g.drawMarkerLayer=function(a,b){q.isPolygon(b)&&a.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===a.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===a.markerPlacement.type&&a.markerPlacement.clipAtBoundary)?this._processPath(b.rings,
0):u._get(u._getPrototypeOf(l.prototype),"drawMarkerLayer",this).call(this,a,b)};g.drawHatchFill=function(a,b){this.drawSolidFill(a)};g.drawPictureFill=function(a,b){this.drawSolidFill(a)};g.drawGradientFill=function(a,b){this.drawSolidFill(a)};g.drawPictureStroke=function(a,b){this.drawSolidStroke(a,null,b.width)};g.drawGradientStroke=function(a,b){this.drawSolidStroke(a,null,b.width)};g.pushClipPath=function(a){this.drawSolidFill(a);this._clipCount++};g.popClipPath=function(){this._clipCount--};
g.drawImage=function(a,b){var {url:e}=a;a=a.scaleX??1;let d=a*b,f=b;e=this._resourceManager.getResource(e);!b&&H.isSome(e)&&(d=a*e.width,f=e.height);this._merge(this.transformPt([-d/2,-f/2]),0);this._merge(this.transformPt([-d/2,f/2]),0);this._merge(this.transformPt([d/2,-f/2]),0);this._merge(this.transformPt([d/2,f/2]),0)};g.drawText=function(a,b){if(b&&0!==b.length){this._textRasterizer||(this._textRasterizer=new P);var e=R(a),[d,f]=this._textRasterizer.computeTextSize(b,e);b=0;switch(a.horizontalAlignment){case "Left":b=
d/2;break;case "Right":b=-d/2}e=0;switch(a.verticalAlignment){case "Bottom":e=f/2;break;case "Top":e=-f/2;break;case "Baseline":e=f/6}this._merge(this.transformPt([-d/2+b,-f/2+e]),0);this._merge(this.transformPt([-d/2+b,f/2+e]),0);this._merge(this.transformPt([d/2+b,-f/2+e]),0);this._merge(this.transformPt([d/2+b,f/2+e]),0)}};g._processPath=function(a,b){if(a)for(const e of a)if(a=e?e.length:0,1<a){this._merge(this.transformPt(e[0]),b);for(let d=1;d<a;d++)this._merge(this.transformPt(e[d]),b)}};g._merge=
function(a,b){a[0]-b<this._xmin&&(this._xmin=a[0]-b);a[0]+b>this._xmax&&(this._xmax=a[0]+b);a[1]-b<this._ymin&&(this._ymin=a[1]-b);a[1]+b>this._ymax&&(this._ymax=a[1]+b)};return u._createClass(l)}(G),ka=function(g){function l(){var a=c.apply(this,arguments);a._searchPoint=[0,0];a._searchDistPoint=0;a._textInfo=null;return a}u._inherits(l,g);var c=u._createSuper(l);g=l.prototype;g.hitTest=function(a,b,e,d,f,h){h*=K.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(h);this._searchPoint=[(a[0]+
a[2])/2,(a[1]+a[3])/2];this._searchDistPoint=(a[2]-a[0])/2/h;this._textInfo=d;this._mapRotation=b&&("CIMPointSymbol"===b.type&&"Map"!==b.angleAlignment||"CIMTextSymbol"===b.type)?f:0;this._earlyReturn=!1;this.drawSymbol(b,e);return this._earlyReturn};g.drawSolidFill=function(a,b){this._hitTestFill(a)};g.drawHatchFill=function(a,b){this._hitTestFill(a)};g.drawPictureFill=function(a,b){this._hitTestFill(a)};g.drawGradientFill=function(a,b){this._hitTestFill(a)};g.drawSolidStroke=function(a,b,e,d,f,
h){this._hitTestStroke(a,e)};g.drawPictureStroke=function(a,b){this._hitTestStroke(a,b.width)};g.drawGradientStroke=function(a,b){this._hitTestStroke(a,b.width)};g.drawMarkerLayer=function(a,b){a.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===a.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===a.markerPlacement.type&&a.markerPlacement.clipAtBoundary)?this._hitTestFill(b):u._get(u._getPrototypeOf(l.prototype),"drawMarkerLayer",this).call(this,a,b)};g.pushClipPath=function(a){};g.popClipPath=
function(){};g.drawImage=function(a,b){var {url:e}=a;a=a.scaleX??1;e=this._resourceManager.getResource(e);if(!H.isNone(e)&&0!==e.height&&0!==b){b*=this.geomUnitsPerPoint();a=e.width/e.height*a*b;e=this.reverseTransformPt(this._searchPoint);var d=this._searchDistPoint;Math.abs(e[0])<a/2+d&&Math.abs(e[1])<b/2+d&&(this._earlyReturn=!0)}};g.drawText=function(a,b){if(b=this._textInfo)if(b=b.get(a)){var {text:e,mosaicItem:d}=b;if(d?.glyphMosaicItems?.length){b=a.height??10;var {lineGapType:f,lineGap:h}=
a,k=f?T(f,h??0,b):0,m=W.bidiText(e)[1],r="CIMBackgroundCallout"===a.callout?.type;a=ia.shapeGlyphs(d.glyphMosaicItems,m,{scale:b/Q.GLYPH_SIZE,angle:0,xOffset:0,yOffset:0,hAlign:U(a.horizontalAlignment),vAlign:V(a.verticalAlignment),maxLineWidth:512,lineHeight:Q.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(k||1,4)),decoration:a.font.decoration||"none",isCIM:!0,hasBackground:r});k=this.reverseTransformPt(this._searchPoint);b=k[0];k=k[1];for(const n of a.glyphs)if(b>n.xTopLeft&&b<n.xBottomRight&&k>
-n.yBottomRight&&k<-n.yTopLeft){this._earlyReturn=!0;break}}}};g._hitTestFill=function(a){let b=null;if(q.isExtent(a))b=[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]];else if(q.isPolygon(a))b=a.rings;else if(q.isPolyline(a))b=a.paths;else return;a=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(a,b)&&(this._earlyReturn=!0);if(!this._earlyReturn){const e=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(a,b,
e)&&(this._earlyReturn=!0)}};g._hitTestStroke=function(a,b){let e=null;if(q.isExtent(a))e=[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]];else if(q.isPolygon(a))e=a.rings;else if(q.isPolyline(a))e=a.paths;else return;a=this.reverseTransformPt(this._searchPoint);b=(b??0)*this.geomUnitsPerPoint();const d=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(a,e,b/2+d)&&(this._earlyReturn=!0)};g._pointInPolygon=function(a,b){let e=
0;for(const d of b){b=d.length;for(let f=1;f<b;f++){const h=d[f-1],k=d[f];h[1]>a[1]!==k[1]>a[1]&&(0<(k[0]-h[0])*(a[1]-h[1])-(k[1]-h[1])*(a[0]-h[0])?e++:e--)}}return 0!==e};g._nearLine=function(a,b,e){for(const f of b){b=f.length;for(let h=1;h<b;h++){var d=f[h-1];const k=f[h];let m=(k[0]-d[0])*(k[0]-d[0])+(k[1]-d[1])*(k[1]-d[1]);if(0!==m&&(m=Math.sqrt(m),Math.abs(((k[0]-d[0])*(a[1]-d[1])-(k[1]-d[1])*(a[0]-d[0]))/m)<e&&(d=((k[0]-d[0])*(a[0]-d[0])+(k[1]-d[1])*(a[1]-d[1]))/m,d>-e&&d<m+e)))return!0}}return!1};
return u._createClass(l)}(G),la=function(g){function l(a,b,e,d){b=c.call(this,b,e);b._applyAdditionalRenderProps=d;b._colorSubstitutionHelper=new ea;b._ctx=a;return b}u._inherits(l,g);var c=u._createSuper(l);g=l.prototype;g.drawSolidFill=function(a,b){if(a){if(q.isPolygon(a))this._buildPath(a.rings,!0);else if(q.isPolyline(a))this._buildPath(a.paths,!0);else if(q.isExtent(a))this._buildPath(D(a).rings,!0);else if(q.isMultipoint(a))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");
else return;a=this._ctx;a.fillStyle="string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+(b[3]??255)/255+")";a.fill("evenodd")}};g.drawSolidStroke=function(a,b,e,d,f,h){if(a&&b&&0!==e){if(q.isPolygon(a))this._buildPath(a.rings,!0);else if(q.isPolyline(a))this._buildPath(a.paths,!1);else if(q.isExtent(a))this._buildPath(D(a).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}a=this._ctx;a.strokeStyle="string"===typeof b?
b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+(b[3]??255)/255+")";a.lineWidth=Math.max(this.transformSize(e),.5);this._setCapStyle(d);this._setJoinStyle(f);a.miterLimit=h;a.stroke()}};g.pushClipPath=function(a){this._ctx.save();if(q.isPolygon(a))this._buildPath(a.rings,!0);else if(q.isPolyline(a))this._buildPath(a.paths,!0);else if(q.isExtent(a))this._buildPath(D(a).rings,!0);else return;this._ctx.clip("evenodd")};g.popClipPath=function(){this._ctx.restore()};g.drawImage=
function(a,b){const {colorSubstitutions:e,url:d,tintColor:f}=a;a=a.scaleX??1;var h=this._resourceManager.getResource(d);if(!H.isNone(h)){var k=h.width/h.height*b,m=b;b||(k=h.width,m=h.height);var r=w.isSVGImage(d)||"src"in h&&w.isSVGImage(h.src);b="getFrame"in h?L.getFirstFrame(h):h;e&&(b=this._colorSubstitutionHelper.applyColorSubstituition(b,e));this._applyAdditionalRenderProps&&!r&&f&&(b=this._colorSubstitutionHelper.tintImageData(b,f));h=this.transformPt([0,0]);var [n,t]=this.getTransformAngle();
r=this.transformSize(1);var p=this._ctx;p.save();p.setTransform({m11:a*r*n,m12:a*r*t,m21:-r*t,m22:r*n,m41:h[0],m42:h[1]});p.drawImage(b,-k/2,-m/2,k,m);p.restore()}};g.drawText=function(a,b){if(b&&0!==b.length&&(this._textRasterizer||(this._textRasterizer=new P),a=R(a),a.size*=this.transformSize(K.px2pt(1)),b=this._textRasterizer.rasterizeText(b,a))){var {size:e,anchorX:d,anchorY:f,canvas:h}=b;b=e[0]*(d+.5);a=e[1]*(f-.5);var k=this._ctx,m=this.transformPt([0,0]),[r,n]=this.getTransformAngle();k.save();
k.setTransform({m11:1*r,m12:1*n,m21:-1*n,m22:1*r,m41:m[0]-1*b,m42:m[1]+1*a});k.drawImage(h,0,0);k.restore()}};g.drawPictureFill=function(a,b){if(a){var {colorSubstitutions:e,height:d,offsetX:f,offsetY:h,rotation:k,scaleX:m,tintColor:r,url:n}=b;b=this._resourceManager.getResource(n);if(!H.isNone(b)){if(q.isPolygon(a))this._buildPath(a.rings,!0);else if(q.isPolyline(a))this._buildPath(a.paths,!0);else if(q.isExtent(a))this._buildPath(D(a).rings,!0);else if(q.isMultipoint(a))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");
else return;a=this._ctx;var t=w.isSVGImage(n)||"src"in b&&w.isSVGImage(b.src),p="getFrame"in b?L.getFirstFrame(b):b;e&&(p=this._colorSubstitutionHelper.applyColorSubstituition(p,e));if(this._applyAdditionalRenderProps){if(t||r&&(p=this._colorSubstitutionHelper.tintImageData(p,r)),t=a.createPattern(p,"repeat"),p=this.transformSize(1),k||(k=0),f=f?p*f:0,h=h?p*h:0,d&&(d*=p),p=d?d/b.height:1,b=m&&d?m*d/b.width:1,0!==k||1!==p||1!==b||0!==f||0!==h){const v=new DOMMatrix;v.rotateSelf(0,0,-k).translateSelf(f,
h).scaleSelf(b,p,1);t.setTransform(v)}}else t=a.createPattern(p,"repeat");a.save();a.fillStyle=t;a.fill("evenodd");a.restore()}}};g.drawPictureStroke=function(a,b){if(a){var {colorSubstitutions:e,capStyle:d,joinStyle:f,miterLimit:h,tintColor:k,url:m,width:r}=b;b=this._resourceManager.getResource(m);if(!H.isNone(b)){if(q.isPolygon(a))var n=a.rings;else if(q.isPolyline(a))n=a.paths;else if(q.isExtent(a))n=D(a).rings;else{q.isMultipoint(a)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");
return}r||(r=b.width);a=w.isSVGImage(m)||"src"in b&&w.isSVGImage(b.src);var t="getFrame"in b?L.getFirstFrame(b):b;e&&(t=this._colorSubstitutionHelper.applyColorSubstituition(t,e));this._applyAdditionalRenderProps&&(a||k&&(t=this._colorSubstitutionHelper.tintImageData(t,k)));b=Math.max(this.transformSize(K.pt2px(r)),.5);a=b/t.width;var p=this._ctx;t=p.createPattern(t,"repeat-y");p.save();this._setCapStyle(d);this._setJoinStyle(f);void 0!==h&&(p.miterLimit=h);p.lineWidth=b;var v;for(let B of n){B=Y.clone(B);
var J=v=void 0,E=void 0;let M=J=void 0;n=B;for(var F=n[0],y=1;y<n.length;)M=n[y][0]-F[0],J=n[y][1]-F[1],J=0!==M?J/M:Math.PI/2,void 0!==E&&1E-4>=J-E?(n.splice(y-1,1),F=v):(v=F,F=n[y],y++),E=J;if(B&&!(1>=B.length))for(n=this.transformPt(B[0]),E=1;E<B.length;E++)v=this.transformPt(B[E]),F=180/Math.PI*Math.atan2(v[1]-n[1],v[0]-n[0]),y=new DOMMatrix,y.translateSelf(0,n[1]-b/2).scaleSelf(a,a,1).rotateSelf(0,0,90-F),t.setTransform(y),p.strokeStyle=t,p.beginPath(),p.moveTo(n[0],n[1]),p.lineTo(v[0],v[1]),
p.stroke(),n=v}p.restore()}}};g._buildPath=function(a,b){const e=this._ctx;e.beginPath();if(a)for(const d of a)if(a=d?d.length:0,1<a){let f=this.transformPt(d[0]);e.moveTo(f[0],f[1]);for(let h=1;h<a;h++)f=this.transformPt(d[h]),e.lineTo(f[0],f[1]);b&&e.closePath()}};g._setCapStyle=function(a){switch(a){case I.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case I.LineCapStyle.Round:this._ctx.lineCap="round";break;case I.LineCapStyle.Square:this._ctx.lineCap="square"}};g._setJoinStyle=function(a){switch(a){case I.LineJoinStyle.Bevel:this._ctx.lineJoin=
"bevel";break;case I.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case I.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}};return u._createClass(l)}(G);const D=g=>g?{spatialReference:g.spatialReference,rings:[[[g.xmin,g.ymin],[g.xmin,g.ymax],[g.xmax,g.ymax],[g.xmax,g.ymin],[g.xmin,g.ymin]]]}:null,U=g=>{switch(g){case "Left":return z.HAlign.Left;case "Right":return z.HAlign.Right;case "Center":return z.HAlign.Center;case "Justify":return S.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),
z.HAlign.Center}},V=g=>{switch(g){case "Top":return z.VAlign.Top;case "Center":return z.VAlign.Center;case "Bottom":return z.VAlign.Bottom;case "Baseline":return z.VAlign.Baseline}},T=(g,l,c)=>{switch(g){case "ExtraLeading":return 1+l/c;case "Multiple":return l;case "Exact":return l/c}};x.CIMSymbolDrawHelper=G;x.C_DEG_TO_RAD=A;x.CanvasDrawHelper=la;x.EnvDrawHelper=ja;x.HittestDrawHelper=ka;x.Transformation=C;x.horizontalAlignment2HAlign=U;x.lineGapType2LineHeight=T;x.verticalAlignment2VAlign=V;Object.defineProperty(x,
Symbol.toStringTag,{value:"Module"})});