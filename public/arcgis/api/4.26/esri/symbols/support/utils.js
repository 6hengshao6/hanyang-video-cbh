// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(u,g,n,k,v,J,f,w,x,y,z,A){function B(a){a=a.symbolLayers;if(!a)return null;let b=null;a.forEach(c=>{if("object"!==c.type||null==c.resource?.href)b="water"===c.type?f.unwrap(c.color):f.isSome(c.material)?f.unwrap(c.material.color):null});return b?new n(b):null}function m(a,
b){if(null==b||null==a)return a;a=a.toRgba();a[3]*=b;return new n(a)}function C(a,b,c){if(a=a.symbolLayers){var e=d=>{d=f.isSome(d)?d:null;b=b??d??(null!=c?D:null);return m(b,c)};a.forEach(d=>{if("object"!==d.type||null==d.resource?.href||b)if("water"===d.type)d.color=e(d.color);else{var l=f.isSome(d.material)?d.material.color:null;l=e(l);f.isNone(d.material)?d.material=new A.Symbol3DMaterial({color:l}):d.material.color=l;null!=c&&"outline"in d&&f.isSome(d.outline)&&f.isSome(d.outline.color)&&(d.outline.color=
m(d.outline.color,c))}})}}async function E(a,b){(a=a.symbolLayers)&&await v.forEach(a,async c=>F(c,b))}async function F(a,b){switch(a.type){case "extrude":a.size="number"===typeof b[2]?b[2]:0;break;case "icon":case "line":case "text":b=r(b);f.isSome(b)&&(a.size=b);break;case "path":const c=t(b,x.ONES,[a.width,void 0,a.height]);a.width=p(b[0],a.width,1,c);a.height=p(b[2],a.height,1,c);break;case "object":await G(a,b)}}function r(a){for(const b of a)if("number"===typeof b)return b;return null}async function G(a,
b){const {resourceSize:c,symbolSize:e}=await H(a),d=t(b,c,e);a.width=p(b[0],e[0],c[0],d);a.depth=p(b[1],e[1],c[1],d);a.height=p(b[2],e[2],c[2],d)}function t(a,b,c){for(let e=0;3>e;e++){const d=a[e];switch(d){case "symbol-value":return a=c[e],null!=a?a/b[e]:1;case "proportional":break;default:if(d&&b[e])return d/b[e]}}return 1}async function H(a){const b=await (await new Promise((q,I)=>u(["./symbolLayerUtils"],q,I))).computeObjectLayerResourceSize(a,10),{width:c,height:e,depth:d}=a;a=[c,d,e];let l=
1;for(var h=0;3>h;h++){const q=a[h];if(null!=q){l=q/b[h];break}}for(h=0;3>h;h++)null==a[h]&&(a[h]=b[h]*l);return{resourceSize:b,symbolSize:a}}function p(a,b,c,e){switch(a){case "proportional":return c*e;case "symbol-value":return null!=b?b:c;default:return a}}const D=new n("white");g.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new n(b)),k.isSymbol3D(a))C(a,b,c);else if(k.isSymbol2D(a)){if(b=b??a.color)a.color=m(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=
m(a.outline.color,c))}};g.applyOpacityToColor=m;g.applyRotationToSymbol=function(a,b,c){a&&null!=b&&(k.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(e=>{if(e&&"object"===e.type)switch(c){case "tilt":e.tilt=b;break;case "roll":e.roll=b;break;default:e.heading=b}}):!k.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))};g.applySizesToSymbol=async function(a,b){if(a&&b){if(k.isSymbol3D(a))return E(a,b);if(k.isSymbol2D(a)&&(b=r(b),!f.isNone(b)))switch(a.type){case "simple-marker":a.size=
b;break;case "picture-marker":const c=a.width/a.height;1<c?(a.width=b,a.height=b*c):(a.width=b*c,a.height=b);break;case "simple-line":a.width=b;break;case "text":a.font.size=b}}};g.fetchWebStyleSymbol=async function(a,b){const c=await a.fetchSymbol(b);return c?c:a.fetchCIMSymbol(b)};g.getCSSFilterFromEffectList=function(a){if(!a)return null;a=a.effects.filter(b=>"bloom"!==b.type).map(b=>b.toJSON());return y.effectFunctionsFromJSON(a)};g.getColorFromSymbol=function(a,b){if(!a)return null;let c=null;
k.isSymbol3D(a)?c=B(a):k.isSymbol2D(a)&&(c=a.color?new n(a.color):null);return c?m(c,b):null};g.getIconHref=function(a){return f.unwrapOrThrow(a.resource).href};g.getSymbolOutlineSize=function(a){if(!a)return 0;if(k.isSymbol3D(a)){{const b=a.symbolLayers&&a.symbolLayers.length;b?(a=a.symbolLayers.getItemAt(b-1),a="outline"in a?f.get(a,"outline","size"):void 0):a=void 0}return f.isSome(a)?a:0}return w.px2pt(z.getStroke(a)?.width)};g.isVolumetricSymbol=function(a){if(f.isNone(a)||!("symbolLayers"in
a)||f.isNone(a.symbolLayers))return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(b=>"object"===b.type);case "line-3d":return a.symbolLayers.some(b=>"path"===b.type);case "polygon-3d":return a.symbolLayers.some(b=>"object"===b.type||"extrude"===b.type);default:return!1}};g.symbolHasExtrudeSymbolLayer=function(a){return f.isSome(a)&&"polygon-3d"===a.type&&a.symbolLayers.some(b=>"extrude"===b.type)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});