// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../core/screenUtils ../cim/CIMSymbolHelper ../cim/CIMSymbolRasterizer ../cim/utils ./previewUtils ./renderUtils".split(" "),function(r,h,m,n,y,p,z){const q=new n.CIMSymbolRasterizer(null,!0),k=h.px2pt(p.SymbolSizeDefaults.size),t=h.px2pt(p.SymbolSizeDefaults.maxSize),A=h.px2pt(p.SymbolSizeDefaults.lineWidth);r.previewCIMSymbol=async function(b,g={}){const {node:u,opacity:v,symbolConfig:l}=g;var f=null!=l&&"object"===typeof l&&"isSquareFill"in l?l.isSquareFill:!1,c=g.cimOptions||
g,d=c.geometryType||y.mapCIMSymbolToGeometryType(b?.data?.symbol);var a=g?.size;a="number"===typeof a?{width:a,height:a}:{width:null!=a&&"object"===typeof a&&"width"in a?a.width:null,height:null!=a&&"object"===typeof a&&"height"in a?a.height:null};const {feature:w,fieldMap:x}=c;if(null==a.width||null==a.height){c=await m.OverrideHelper.resolveSymbolOverrides(b.data,w,null,x,d);if(!c)return null;b=b.clone();b.data={type:"CIMSymbolReference",symbol:c};b.data.primitiveOverrides=void 0;var e=[];m.CIMSymbolHelper.fetchResources(c,
q.resourceManager,e);0<e.length&&await Promise.all(e);e=m.CIMSymbolHelper.getEnvelope(c,null,q.resourceManager);c=e?.width;e=e?.height;a.width="esriGeometryPolygon"===d?k:"esriGeometryPolyline"===d?A:null!=c&&isFinite(c)?Math.min(c,t):k;a.height="esriGeometryPolygon"===d?k:null!=e&&isFinite(e)?Math.max(Math.min(e,t),1):k}f=await q.rasterizeCIMSymbolAsync(b,w,a,f||"esriGeometryPolygon"!==d?n.GeometryStyle.Preview:n.GeometryStyle.Legend,x,d);if(!f)return null;const {width:B,height:C}=f;b=document.createElement("canvas");
b.width=B;b.height=C;b.getContext("2d").putImageData(f,0,0);f=h.pt2px(a.width);a=h.pt2px(a.height);d=new Image(f,a);d.src=b.toDataURL();null!=v&&(d.style.opacity=`${v}`);b=d;null!=g.effectView&&(b=z.renderSymbol([[{shape:{type:"image",x:0,y:0,width:f,height:a,src:d.src},fill:null,stroke:null,offset:[0,0]}]],[f,a],{effectView:g.effectView}));u&&b&&u.appendChild(b);return b};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});