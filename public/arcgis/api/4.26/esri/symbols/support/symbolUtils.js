// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils ../../widgets/Legend/styles/support/relationshipUtils ../../widgets/Legend/support/relationshipRampUtils".split(" "),function(u,t,J,p,x,B,C,y,q,D,E){function F(a,b){if(b&&(a.style.filter=q.getCSSFilterFromEffectList(b),b=b.effects))for(const c of b)if("drop-shadow"===c?.type){0>c.offsetX?a.style.marginLeft=`${Math.abs(c.offsetX)}px`:a.style.marginRight=`${c.offsetX}px`;
break}}async function z(a,b){switch(a.type){case "web-style":var {previewWebStyleSymbol:c}=await new Promise((d,e)=>u(["./previewWebStyleSymbol"],d,e));return c(a,z,b);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:c}=await new Promise((d,e)=>u(["./previewSymbol3D"],d,e)),c(a,b);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:c}=await new Promise((d,e)=>u(["./previewSymbol2D"],
d,e)),c(a,b);case "cim":return{previewCIMSymbol:c}=await new Promise((d,e)=>u(["./previewCIMSymbol"],d,e)),c(a,b)}}function w(a){return a&&"opacity"in a?a.opacity*w(a.parent):1}let v=null;const A=[255,255,255];t.getDisplayedColor=async function(a,b){if(a){var c=w(a.layer||a.sourceLayer);if(p.isSome(a.symbol)&&(!p.isSome(b)||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await q.fetchWebStyleSymbol(a.symbol,b):a.symbol.clone(),q.getColorFromSymbol(a,c);var d=p.isSome(b)&&b.renderer||
a.get("layer.renderer")||a.get("sourceLayer.renderer"),e=await d.getSymbolAsync(a,b);if(e){e="web-style"===e.type?await q.fetchWebStyleSymbol(e,b):e.clone();var k=q.getColorFromSymbol(e,c);if(!("visualVariables"in d)||"visualVariables"in d&&!d.visualVariables||"visualVariables"in d&&!d.visualVariables?.length)return k;d.arcadeRequiredForVisualVariables&&(p.isNone(b)||p.isNone(b.arcade))&&(b={...p.unwrap(b)},b.arcade=await x.loadArcade());e=await new Promise((g,l)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],
g,l));var h=[],f=[];for(const g of d.visualVariables)switch(g.type){case "color":h.push(g);break;case "opacity":f.push(g)}d=(d=0<h.length?h[h.length-1]:null)?e.getColor(d,a,b):k;a=(k=0<f.length?f[f.length-1]:null)?e.getOpacity(k,a,b):null;null!=c&&(a=null!=a?a*c:c);return d?q.applyOpacityToColor(d,a):null}}};t.getDisplayedSymbol=async function(a,b){if(a){var c=a.sourceLayer,d=(p.isSome(b)&&(b.useSourceLayer??!1)?c:a.layer)??c;c=w(d);if(p.isSome(a.symbol)&&(!p.isSome(b)||!0!==b.ignoreGraphicSymbol))return a=
"web-style"===a.symbol.type?await q.fetchWebStyleSymbol(a.symbol,{...b,cache:p.isSome(b)?b.webStyleCache:null}):a.symbol.clone(),q.applyColorToSymbol(a,null,c),a;var e=(p.isSome(b)?b.renderer:null)??(d&&"renderer"in d?d.renderer:null);if(d=e&&"getSymbolAsync"in e?await e.getSymbolAsync(a,b):null){d="web-style"===d.type?await d.fetchSymbol({...b,cache:p.isSome(b)?b.webStyleCache:null}):d.clone();if(!(e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.length))return q.applyColorToSymbol(d,
null,c),d;"arcadeRequiredForVisualVariables"in e&&e.arcadeRequiredForVisualVariables&&(p.isNone(b)||p.isNone(b.arcade))&&(b={...p.unwrap(b)},b.arcade=await x.loadArcade());var k=await new Promise((n,r)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],n,r)),h=[],f=[],g=[],l=[];for(var m of e.visualVariables)switch(m.type){case "color":h.push(m);break;case "opacity":f.push(m);break;case "rotation":l.push(m);break;case "size":m.target||g.push(m)}m=(m=!!h.length&&h[h.length-1])?k.getColor(m,
a,b):null;f=(f=!!f.length&&f[f.length-1])?k.getOpacity(f,a,b):null;null!=c&&(f=null!=f?f*c:c);q.applyColorToSymbol(d,m,f);g.length&&(c=k.getAllSizes(g,a,b),await q.applySizesToSymbol(d,c));for(const n of l)q.applyRotationToSymbol(d,k.getRotationAngle(n,a,b),n.axis);return d}}};t.renderColorRampPreviewHTML=function(a,b={}){var c="horizontal"===b.align;const d=b.width??(c?75:24),e=b.height??(c?24:75);var k=b.gradient??!0,h=window.devicePixelRatio,f=d*h,g=e*h;h=document.createElement("canvas");h.width=
f;h.height=g;h.style.width=`${d}px`;h.style.height=`${e}px`;const l=h.getContext("2d");var m=c?f:0;const n=c?0:g;if(k){const r=l.createLinearGradient(0,0,m,n);c=a.length;const G=1===c?0:1/(c-1);a.forEach((H,I)=>r.addColorStop(I*G,H.toString()));l.fillStyle=r;l.fillRect(0,0,f,g)}else{f=c?f/a.length:f;g=c?g:g/a.length;m=k=0;for(const r of a)l.fillStyle=r.toString(),l.fillRect(k,m,f,g),k=c?k+f:0,m=c?0:m+g}a=document.createElement("div");a.style.width=`${d}px`;a.style.height=`${e}px`;F(a,b?.effectList);
a.appendChild(h);return a};t.renderDotDensityPreviewHTML=function(a,b,c){const {backgroundColor:d,outline:e,dotSize:k}=a;c=c&&c.swatchSize||C.SymbolSizeDefaults.size;const h=Math.round(c*c/k**2*.8),f=window.devicePixelRatio;a=document.createElement("canvas");const g=c*f;a.width=g;a.height=g;a.style.width=`${a.width/f}px`;a.style.height=`${a.height/f}px`;const l=a.getContext("2d");d&&(l.fillStyle=d.toCss(!0),l.fillRect(0,0,g,g),l.fill());l.fillStyle=b.toCss(!0);if(v&&v.length/2===h)for(b=0;b<2*h;b+=
2)l.fillRect(v[b],v[b+1],k*f,k*f),l.fill();else for(v=[],b=0;b<2*h;b+=2){const m=Math.floor(Math.random()*(g-0+1)),n=Math.floor(Math.random()*(g-0+1));v.push(m,n);l.fillRect(m,n,k*f,k*f);l.fill()}e&&(e.color&&(l.strokeStyle=e.color.toCss(!0)),l.lineWidth=e.width,l.strokeRect(0,0,g,g));c=new Image(c,c);c.src=a.toDataURL();return c};t.renderPieChartPreviewHTML=function(a,b={}){const c=b.radius||40;var d=2*Math.PI*c,e=a.length;const k=d/e,h=[],f=B.getStroke(b.outline);null!=f?.width&&(f.width*=2);(f||
b.backgroundColor)&&h.push({shape:{type:"circle",cx:c,cy:c,r:c},fill:b.backgroundColor,stroke:f,offset:[0,0]});const g=b.values,l=g&&g.length===e&&100===g.reduce((n,r)=>n+r,0),m=[0];for(let n=0;n<e;n++){let r=null;l&&(r=g[n]*d/100,m.push(r+m[n]));h.push({shape:{type:"circle",cx:c,cy:c,r:c/2},fill:[0,0,0,0],stroke:{width:c,dashArray:`${(r??k)/2} ${d}`,dashoffset:`-${l?m[n]/2:k/2*n}`,color:a[n]},offset:[0,0]})}e=null;a=2*c+(f?.width||0);if(d=b.holePercentage)f&&h.push({shape:{type:"circle",cx:c,cy:c,
r:c*d},fill:null,stroke:f,offset:[0,0]}),e=a/2,e=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:A,stroke:f?{...f,color:A}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:c*d},fill:[0,0,0],stroke:null,offset:[0,0]}]];return y.renderSymbol([h],[a,a],{effectView:b.effectList,ignoreStrokeWidth:!0,masking:e,rotation:-90})};t.renderPreviewHTML=z;t.renderRelationshipRampPreviewHTML=function(a,b={}){const c=a?.authoringInfo;if("relationship"!==c?.type||!c?.numClasses||!a.uniqueValueInfos)return null;const {focus:d,
numClasses:e}=c,k=E.getRelationshipRampElement({focus:d,numClasses:e,infos:a.uniqueValueInfos});a=b&&b.node||document.createElement("div");y.renderOnce(a,()=>D.renderRelationshipRamp(k,b.id||"relationship",b.opacity||1,b.effectList));return a};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});