// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/has ../../core/maybe ../../core/promiseUtils ../../layers/support/source/DataLayerSource ./executeQueryJSON ./executeQueryPBF ../support/FeatureSet ../support/Query".split(" "),function(r,k,t,u,f,v,w,x,y,z,A){async function n(d,b,c,e){e={...e};var a=A.from(b);a.sourceSpatialReference=a.sourceSpatialReference??c?.sourceSpatialReference??null;if(c?.gdbVersion||c?.dynamicDataSource)a=a===b?a.clone():a,a.gdbVersion=b.gdbVersion||c.gdbVersion,a.dynamicDataSource=
b.dynamicDataSource?w.DataLayerSource.from(b.dynamicDataSource):c.dynamicDataSource;const h=c?.infoFor3D;if(f.isSome(h)&&p(b,h)){a=a===b?a.clone():a;a.formatOf3DObjects=null;for(g of h.queryFormats){if("3D_glb"===g){a.formatOf3DObjects=g;break}"3D_gltf"!==g||a.formatOf3DObjects||(a.formatOf3DObjects=g)}if(!a.formatOf3DObjects)throw new t("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(f.isNone(a.outFields)||
!a.outFields.includes("*")){a=a===b?a.clone():a;f.isNone(a.outFields)&&(a.outFields=[]);const {originX:l,originY:B,originZ:C,translationX:D,translationY:E,translationZ:F,scaleX:G,scaleY:H,scaleZ:I,rotationX:J,rotationY:K,rotationZ:L,rotationDeg:M}=h.transformFieldRoles;a.outFields.push(l,B,C,D,E,F,G,H,I,J,K,L,M)}}var g=a;b=null!=b.outStatistics?.[0];a=u("featurelayer-pbf-statistics");b=!b||a;let m;if("pbf"===c?.format&&b)try{m=await y.executeRawQueryPBF(d,g,e)}catch(l){if("query:parsing-pbf"===l.name)c.format=
"json";else throw l;}"json"!==c?.format&&b||(m=await x.executeRawQueryJSON(d,g,e));q(c?.fieldsIndex,m.fields);return m}function q(d,b){if(f.isSome(d)&&f.isSome(b))for(const c of b)(b=d.get(c.name))&&Object.assign(c,b.toJSON())}async function N(d,b,c,e){c=c?.infoFor3D;if(!p(d,c)||f.isNone(c)||!b.assetMaps||!b.features||!b.features.length)return z.fromJSON(b);({meshFeatureSetFromJSON:e}=await v.whenOrAbort(new Promise((a,h)=>r(["../support/meshFeatureSet"],a,h)),e));return e(d,c,b)}function p(d,b){return f.isSome(b)&&
!0===d.returnGeometry&&"xyFootprint"!==d.multipatchOption&&!d.outStatistics}k.executeQuery=async function(d,b,c,e){return n(d,b,c,e).then(a=>N(b,a,c,e))};k.executeRawQuery=n;k.normalizeFields=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});