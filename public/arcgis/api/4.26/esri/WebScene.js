// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(d,b){d.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(({target:k,propName:l,newOrigin:t})=>{b.isMultiOriginJSONMixin(k)&&t&&k.originOf(l)!==t&&k.updateOrigin(l,t)})};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(d){d.isMultiOriginJSONMixin=function(b){return b&&
"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/support/MapFloorInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../layers/support/FacilityLayerInfo ../layers/support/LevelLayerInfo ../layers/support/SiteLayerInfo".split(" "),function(d,b,
a,k,l,t,x,q,m,h,g){a=function(f){function p(u){u=r.call(this,u);u.levelLayer=null;u.facilityLayer=null;u.siteLayer=null;return u}d._inherits(p,f);var r=d._createSuper(p);return d._createClass(p)}(a.JSONSupport);b.__decorate([k.property({type:h,json:{write:!0}})],a.prototype,"levelLayer",void 0);b.__decorate([k.property({type:m,json:{write:!0}})],a.prototype,"facilityLayer",void 0);b.__decorate([k.property({type:g,json:{write:!0}})],a.prototype,"siteLayer",void 0);return a=b.__decorate([q.subclass("esri.support.MapFloorInfo")],
a)})},"esri/layers/support/FacilityLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(d,b,a,k,l,t,x,q){a=function(m){function h(f){f=g.call(this,f);f.facilityIdField=null;f.layerId=null;f.nameField=null;f.siteIdField=null;f.sublayerId=null;return f}
d._inherits(h,m);var g=d._createSuper(h);return d._createClass(h)}(a.JSONSupport);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"facilityIdField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"layerId",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"nameField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"siteIdField",void 0);b.__decorate([k.property({type:Number,json:{read:{source:"subLayerId"},
write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0);return a=b.__decorate([q.subclass("esri.layers.support.FacilityLayerInfo")],a)})},"esri/layers/support/LevelLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q){a=function(m){function h(f){f=g.call(this,f);f.facilityIdField=null;f.layerId=null;f.levelIdField=null;f.levelNumberField=null;f.longNameField=null;f.shortNameField=null;f.sublayerId=null;f.verticalOrderField=null;return f}d._inherits(h,m);var g=d._createSuper(h);return d._createClass(h)}(a.JSONSupport);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"facilityIdField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"layerId",
void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"levelIdField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"levelNumberField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"longNameField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"shortNameField",void 0);b.__decorate([k.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,
write:!1}}}})],a.prototype,"sublayerId",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"verticalOrderField",void 0);return a=b.__decorate([q.subclass("esri.layers.support.LevelLayerInfo")],a)})},"esri/layers/support/SiteLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q){a=function(m){function h(f){f=g.call(this,f);f.layerId=null;f.nameField=null;f.siteIdField=null;f.sublayerId=null;return f}d._inherits(h,m);var g=d._createSuper(h);return d._createClass(h)}(a.JSONSupport);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"layerId",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"nameField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"siteIdField",void 0);b.__decorate([k.property({type:Number,
json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0);return a=b.__decorate([q.subclass("esri.layers.support.SiteLayerInfo")],a)})},"esri/support/webSceneUtils":function(){define(["exports","../core/Error"],function(d,b){d.createCopyError=function(){return new b("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};d.createSchemaValidationError=function(a){return new b("webscene:schema-validation",
"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:a})};d.schemaValidationErrorName="webscene:schema-validation";Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/asyncUtils ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(d,b,a,k,l,t,x){async function q(h,g){g={...(k.isSome(g)?
g:{}),compress:h.compress};g=await b.result(h.resource.portalItem.addResource(h.resource,h.content,g));if(!0===g.ok)h.finish?.(h.resource);else throw h.error?.(g.error),g.error;}async function m(h,g){g=await b.result(h.resource.update(h.content,g));if(!0===g.ok)h.finish?.(h.resource);else throw h.error?.(g.error),g.error;}d.saveResources=async function(h,g,f){if(g&&g.resources){var p=g.portalItem===h.portalItem?new Set(h.paths):new Set;h.paths.length=0;h.portalItem=g.portalItem;var r=new Set(g.resources.toKeep.map(B=>
B.resource.path)),u=new Set,y=[];r.forEach(B=>{p.delete(B);h.paths.push(B)});for(const B of g.resources.toUpdate)if(p.delete(B.resource.path),r.has(B.resource.path)||u.has(B.resource.path)){const {resource:F,content:L,finish:H,error:V}=B,M=x.getSiblingOfSameTypeI(F,t.generateUUID());h.paths.push(M.path);y.push(q({resource:M,content:L,compress:B.compress,finish:H,error:V},f))}else h.paths.push(B.resource.path),y.push(m(B,f)),u.add(B.resource.path);for(const B of g.resources.toAdd)y.push(q(B,f)),h.paths.push(B.resource.path);
p.forEach(B=>{g.portalItem&&(B=g.portalItem.resourceFromPath(B),y.push(B.portalItem.removeResource(B).catch(()=>{})))});if(0!==y.length&&(r=await l.eachAlways(y),l.throwIfAborted(f),f=r.filter(B=>"error"in B).map(B=>B.error),0<f.length))throw new a("save:resources","Failed to save one or more resources",{errors:f});}};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/maybe",
"../../core/urlUtils"],function(d,b,a,k,l){function t(m){const h=m.lastIndexOf("/");return-1===h?[".",m]:[m.slice(0,h),m.slice(h+1)]}function x(m){{const r=l.getPathExtension(m);m=k.isNone(r)?[m,""]:[m.slice(0,m.length-r.length-1),`.${r}`]}const [h,g]=m,[f,p]=t(h);return[f,p,g]}async function q(m){return m instanceof Blob?m:(await b(m.url,{responseType:"blob"})).data}d.addOrUpdateResource=async function(m,h,g,f){if(!m.hasPath())throw new a(`portal-item-resource-${h}:invalid-path`,"Resource does not have a valid path");
const p=m.portalItem;await p.load(f);h=l.join(p.userItemUrl,"add"===h?"addResources":"updateResources");const [r,u]=t(m.path);g=await q(g);const y=new FormData;r&&"."!==r&&y.append("resourcesPrefix",r);k.isSome(f)&&f.compress&&y.append("compress","true");y.append("fileName",u);y.append("file",g,u);y.append("f","json");k.isSome(f)&&f.access&&y.append("access",f.access);await p.portal.request(h,{method:"post",body:y,signal:k.get(f,"signal")});return m};d.contentToBlob=q;d.fetchResources=async function(m,
h={},g){await m.load(g);var f=l.join(m.itemUrl,"resources");const {start:p=1,num:r=10,sortOrder:u="asc",sortField:y="created"}=h;h={query:{start:p,num:r,sortOrder:u,sortField:y,token:m.apiKey},signal:k.get(g,"signal")};f=await m.portal.request(f,h);return{total:f.total,nextStart:f.nextStart,resources:f.resources.map(({created:B,size:F,resource:L})=>({created:new Date(B),size:F,resource:m.resourceFromPath(L)}))}};d.getSiblingOfSameType=function(m,h){if(!m.hasPath())return null;const [g,,f]=x(m.path);
return m.portalItem.resourceFromPath(l.join(g,h+f))};d.getSiblingOfSameTypeI=function(m,h){if(!m.hasPath())return null;const [g,,f]=x(m.path);return m.portalItem.resourceFromPath(l.join(g,h+f))};d.removeAllResources=async function(m,h){await m.load(h);const g=l.join(m.userItemUrl,"removeResources");return m.portal.request(g,{method:"post",query:{deleteAll:!0},signal:k.get(h,"signal")})};d.removeResource=async function(m,h,g){if(!h.hasPath())throw new a("portal-item-resources-remove:invalid-path",
"Resource does not have a valid path");await m.load(g);const f=l.join(m.userItemUrl,"removeResources");await m.portal.request(f,{method:"post",query:{resource:h.path},signal:k.get(g,"signal")});h.portalItem=null};d.splitPrefixFileNameAndExtension=x;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],function(d){const b={width:600,height:400};d.getOptimalThumbnailSize=function(a,k){k=k||b;let {width:l,height:t}=k;k=l/t;
1.5>k?t=l/1.5:1.5<k&&(l=1.5*t);l>a.width&&(t*=a.width/l,l=a.width);t>a.height&&(l*=a.height/t,t=a.height);return{width:Math.round(l),height:Math.round(t)}};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/ApplicationProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../webdoc/applicationProperties/Viewing".split(" "),
function(d,b,a,k,l,t,x,q,m){var h;a=h=function(g){function f(r){r=p.call(this,r);r.viewing=null;return r}d._inherits(f,g);var p=d._createSuper(f);f.prototype.clone=function(){return new h({viewing:this.viewing?this.viewing.clone():null})};return d._createClass(f)}(a.JSONSupport);b.__decorate([k.property({type:m,json:{write:!0}})],a.prototype,"viewing",void 0);return a=h=b.__decorate([q.subclass("esri.webscene.ApplicationProperties")],a)})},"esri/webdoc/applicationProperties/Viewing":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Search".split(" "),
function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(p){p=f.call(this,p);p.search=null;return p}d._inherits(g,h);var f=d._createSuper(g);g.prototype.clone=function(){return new m(k.clone({search:this.search}))};return d._createClass(g)}(a.JSONSupport);b.__decorate([l.property({type:q,json:{write:!0}})],a.prototype,"search",void 0);return a=m=b.__decorate([x.subclass("esri.webdoc.applicationProperties.Viewing")],a)})},"esri/webdoc/applicationProperties/Search":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils ./SearchLayer ./SearchTable".split(" "),
function(d,b,a,k,l,t,x,q,m,h,g,f,p){var r;const u=a.ofType(f),y=a.ofType(p);a=r=function(B){function F(H){H=L.call(this,H);H.addressSearchEnabled=!0;H.enabled=!0;H.hintText=null;H.layers=new u;H.tables=new y;return H}d._inherits(F,B);var L=d._createSuper(F);B=F.prototype;B.readAddressSearchEnabled=function(H){return!H};B.writeAddressSearchEnabled=function(H,V,M){V[M]=!H};B.clone=function(){return new r(l.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,
layers:this.layers,tables:this.tables}))};return d._createClass(F)}(k.JSONSupport);b.__decorate([t.property({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"addressSearchEnabled",void 0);b.__decorate([q.reader("addressSearchEnabled")],a.prototype,"readAddressSearchEnabled",null);b.__decorate([h.writer("addressSearchEnabled")],a.prototype,"writeAddressSearchEnabled",null);
b.__decorate([t.property({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],a.prototype,"enabled",void 0);b.__decorate([t.property({type:String,json:{write:!0}})],a.prototype,"hintText",void 0);b.__decorate([t.property({type:u,json:{write:{overridePolicy:g.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],a.prototype,"layers",void 0);b.__decorate([t.property({type:y,json:{read:!0,write:{overridePolicy:g.writeNonEmptyCollectionPolicy}}})],
a.prototype,"tables",void 0);return a=r=b.__decorate([m.subclass("esri.webdoc.applicationProperties.Search")],a)})},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],function(d){d.writeNonEmptyCollectionPolicy=function(b){return{enabled:!!b?.length}};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchLayerField".split(" "),
function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(p){p=f.call(this,p);p.field=null;p.id=null;p.subLayer=null;return p}d._inherits(g,h);var f=d._createSuper(g);g.prototype.clone=function(){return new m(k.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};return d._createClass(g)}(a.JSONSupport);b.__decorate([l.property({type:q,json:{write:{isRequired:!0}}})],a.prototype,"field",void 0);b.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"id",void 0);
b.__decorate([l.property({type:t.Integer,json:{write:!0}})],a.prototype,"subLayer",void 0);return a=m=b.__decorate([x.subclass("esri.webdoc.applicationProperties.SearchLayer")],a)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(d,b,a,k,l,t,x,q,m,h){var g;a=g=function(f){function p(u){u=r.call(this,u);u.exactMatch=!1;u.name=null;u.type=null;return u}d._inherits(p,f);var r=d._createSuper(p);p.prototype.clone=function(){return new g({exactMatch:this.exactMatch,type:this.type,name:this.name})};return d._createClass(p)}(a.JSONSupport);b.__decorate([k.property({type:Boolean,json:{write:!0}})],a.prototype,"exactMatch",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);b.__decorate([q.enumeration(h.kebabDict)],
a.prototype,"type",void 0);return a=g=b.__decorate([m.subclass("esri.webdoc.applicationProperties.SearchLayerField")],a)})},"esri/webdoc/applicationProperties/SearchTable":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchTableField".split(" "),function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(p){p=
f.call(this,p);p.field=null;p.id=null;return p}d._inherits(g,h);var f=d._createSuper(g);g.prototype.clone=function(){return new m(k.clone({field:this.field,id:this.id}))};return d._createClass(g)}(a.JSONSupport);b.__decorate([l.property({type:q,json:{write:{isRequired:!0}}})],a.prototype,"field",void 0);b.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"id",void 0);return a=m=b.__decorate([x.subclass("esri.webdoc.applicationProperties.SearchTable")],a)})},"esri/webdoc/applicationProperties/SearchTableField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(d,b,a,k,l,t,x,q,m,h){var g;a=g=function(f){function p(u){u=r.call(this,u);u.exactMatch=!1;u.name=null;u.type=null;return u}d._inherits(p,f);var r=d._createSuper(p);p.prototype.clone=function(){return new g({exactMatch:this.exactMatch,type:this.type,name:this.name})};return d._createClass(p)}(a.JSONSupport);b.__decorate([k.property({type:Boolean,json:{write:!0}})],a.prototype,"exactMatch",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);b.__decorate([q.enumeration(h.kebabDict)],
a.prototype,"type",void 0);return a=g=b.__decorate([m.subclass("esri.webdoc.applicationProperties.SearchTableField")],a)})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(d,b,a,k,l,t,x,q,m,h,g,f,p,r){var u;const y=l.getLogger("esri.webscene.Environment");l=(B,F,L)=>({enabled:!L||!L.isPresentation});a=u=function(B){function F(H){H=L.call(this,H);H.lighting=new f;H.background=null;H.atmosphereEnabled=!0;H.starsEnabled=!0;return H}d._inherits(F,B);var L=d._createSuper(F);B=F.prototype;B.clone=function(){return new u(this.cloneConstructProperties())};B.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?p.prototype.clone.call(this.lighting):
f.prototype.clone.call(this.lighting),background:k.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};d._createClass(F,[{key:"weather",set:function(H){h.validateWeatherType(H?.type,y)&&this._set("weather",H)}}]);return F}(a.JSONSupport);b.__decorate([t.property({types:g.lightingTypes,nonNullable:!0,json:{write:!0}})],a.prototype,"lighting",void 0);b.__decorate([t.property(r.backgroundProperty)],a.prototype,"background",void 0);
b.__decorate([t.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],a.prototype,"atmosphereEnabled",void 0);b.__decorate([t.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],a.prototype,"starsEnabled",void 0);b.__decorate([t.property({types:h.weatherTypes,nonNullable:!0,json:{write:!0},value:new m})],a.prototype,"weather",null);return a=u=b.__decorate([q.subclass("esri.webscene.Environment")],a)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q,m){var h;a=h=function(g){function f(r){r=p.call(this,r);r.type="sunny";r.cloudCover=.5;return r}d._inherits(f,g);var p=d._createSuper(f);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover})};return d._createClass(f)}(a.JSONSupport);b.__decorate([q.enumeration({sunny:"sunny"})],a.prototype,"type",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);return a=h=b.__decorate([m.subclass("esri.views.3d.environment.SunnyWeather")],
a)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(d,b,a,k,l,t){b={key:"type",base:t,typeMap:{sunny:t,cloudy:b,rainy:k,snowy:l,foggy:a}};const x=Object.keys(b.typeMap);d.validateWeatherType=function(q,m){return x.includes(q)?!0:(m.error(`"${q}" is not a valid weather type`),!1)};d.weatherHeightLimit=1E4;d.weatherTypes=b;d.weatherTypesArray=x;Object.defineProperty(d,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(d,b,a,k,l,t,x,q,m){var h;a=h=function(g){function f(r){r=p.call(this,
r);r.type="cloudy";r.cloudCover=.5;return r}d._inherits(f,g);var p=d._createSuper(f);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover})};return d._createClass(f)}(a.JSONSupport);b.__decorate([q.enumeration({cloudy:"cloudy"})],a.prototype,"type",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);return a=h=b.__decorate([m.subclass("esri.views.3d.environment.CloudyWeather")],a)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q,m){var h;a=h=function(g){function f(r){r=p.call(this,r);r.type="foggy";r.fogStrength=.5;return r}d._inherits(f,g);var p=d._createSuper(f);f.prototype.clone=function(){return new h({fogStrength:this.fogStrength})};return d._createClass(f)}(a.JSONSupport);b.__decorate([q.enumeration({foggy:"foggy"})],a.prototype,"type",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"fogStrength",void 0);return a=h=b.__decorate([m.subclass("esri.views.3d.environment.FoggyWeather")],
a)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(d,b,a,k,l,t,x,q,m){var h;a=h=function(g){function f(r){r=p.call(this,r);r.type="rainy";
r.cloudCover=.5;r.precipitation=.5;return r}d._inherits(f,g);var p=d._createSuper(f);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover,precipitation:this.precipitation})};return d._createClass(f)}(a.JSONSupport);b.__decorate([q.enumeration({rainy:"rainy"})],a.prototype,"type",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],a.prototype,"precipitation",void 0);return a=h=b.__decorate([m.subclass("esri.views.3d.environment.RainyWeather")],a)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q,m){var h;a=h=function(g){function f(r){r=p.call(this,r);r.type="snowy";r.cloudCover=.5;r.precipitation=.5;r.snowCover="disabled";return r}d._inherits(f,g);var p=d._createSuper(f);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return d._createClass(f)}(a.JSONSupport);b.__decorate([q.enumeration({snowy:"snowy"})],a.prototype,"type",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,
range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);b.__decorate([k.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"precipitation",void 0);b.__decorate([k.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],a.prototype,"snowCover",void 0);return a=h=b.__decorate([m.subclass("esri.views.3d.environment.SnowyWeather")],a)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],
function(d,b,a){d.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:a}};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(d,b,a,k,l,t,x,q,m,h){var g;a=g=function(f){function p(u){u=r.call(this,u);u.type="sun";u.date=null;u.directShadowsEnabled=!1;u.displayUTCOffset=null;return u}d._inherits(p,f);var r=d._createSuper(p);f=p.prototype;f.readDate=function(u,y){return null!=y.datetime&&new Date(y.datetime)||null};f.writeDate=function(u,y,B){y[B]=u.getTime()};f.readDirectShadowsEnabled=function(u,y){return!!y.directShadows};f.writedirectShadowsEnabled=function(u,y,B){u&&(y[B]=u)};f.writeDisplayUTCOffset=function(u,
y){null!=u&&(y.displayUTCOffset=u)};f.clone=function(){return new g(this.cloneConstructProperties())};f.cloneConstructProperties=function(){const u={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(u.date=new Date(this.date.getTime()));return u};return d._createClass(p)}(a.JSONSupport);b.__decorate([k.property({readOnly:!0,type:["sun"],json:{write:!0}})],a.prototype,"type",void 0);b.__decorate([k.property({type:Date,
json:{type:Number,write:{target:"datetime"}}})],a.prototype,"date",void 0);b.__decorate([q.reader("date",["datetime"])],a.prototype,"readDate",null);b.__decorate([h.writer("date")],a.prototype,"writeDate",null);b.__decorate([k.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],a.prototype,"directShadowsEnabled",void 0);b.__decorate([q.reader("directShadowsEnabled",["directShadows"])],a.prototype,"readDirectShadowsEnabled",null);b.__decorate([h.writer("directShadowsEnabled")],
a.prototype,"writedirectShadowsEnabled",null);b.__decorate([k.property({type:Number,json:{write:!0}})],a.prototype,"displayUTCOffset",void 0);b.__decorate([h.writer("displayUTCOffset")],a.prototype,"writeDisplayUTCOffset",null);return a=g=b.__decorate([m.subclass("esri.webscene.SunLighting")],a)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(p){p=f.call(this,p);p.type="virtual";p.directShadowsEnabled=!1;return p}d._inherits(g,h);var f=d._createSuper(g);h=g.prototype;h.clone=function(){return new m(this.cloneConstructProperties())};h.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return d._createClass(g)}(a.JSONSupport);b.__decorate([k.property({readOnly:!0,type:["virtual"],json:{write:!0}})],a.prototype,"type",void 0);b.__decorate([k.property({type:Boolean,
json:{default:!1,name:"directShadows",write:!0}})],a.prototype,"directShadowsEnabled",void 0);return a=m=b.__decorate([q.subclass("esri.webscene.VirtualLighting")],a)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(d,b,a){b={base:b,key:"type",typeMap:{color:a}};b={types:b,json:{read:function(k){return(l,t,x)=>{if(!l)return l;for(const q in k.typeMap)if(l.type===q)return t=new k.typeMap[q],t.read(l,x),t}}(b),write:{overridePolicy:(k,l,t)=>
({enabled:!t||!t.isPresentation})}}};d.backgroundProperty=b;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(d,b,a,k,l,t,x,q){a=function(m){function h(f){return g.call(this,
f)}d._inherits(h,m);var g=d._createSuper(h);h.prototype.clone=function(){};return d._createClass(h)}(a.JSONSupport);b.__decorate([k.property({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0);return a=b.__decorate([q.subclass("esri.webscene.background.Background")],a)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(d,b,a,k,l,t,x,q,m,h,g){var f;l={...h.colorAndTransparencyProperty,nonNullable:!0};g=f=function(p){function r(y){y=u.call(this,y);y.type="color";y.color=new a([0,0,0,1]);return y}d._inherits(r,p);var u=d._createSuper(r);p=r.prototype;p.clone=function(){return new f(this.cloneProperties())};p.cloneProperties=function(){return{color:this.color.clone()}};return d._createClass(r)}(g);b.__decorate([q.enumeration({color:"color"},{readOnly:!0})],g.prototype,"type",void 0);b.__decorate([k.property(l)],
g.prototype,"color",void 0);return g=f=b.__decorate([m.subclass("esri.webscene.background.ColorBackground")],g)})},"esri/webscene/InitialViewProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Viewpoint ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../geometry/SpatialReference ./Environment".split(" "),function(d,b,a,k,l,t,x,q,m,h,g){var f;
k=f=function(p){function r(y){y=u.call(this,y);y.environment=new g;y.spatialReference=null;y.viewpoint=null;return y}d._inherits(r,p);var u=d._createSuper(r);r.prototype.clone=function(){return new f({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};d._createClass(r,[{key:"viewingMode",set:function(y){this._set("viewingMode",y)}}]);return r}(k.JSONSupport);
b.__decorate([l.property({type:g,json:{write:{isRequired:!0}}})],k.prototype,"environment",void 0);b.__decorate([l.property({type:h})],k.prototype,"spatialReference",void 0);b.__decorate([l.property({type:["local","global"]})],k.prototype,"viewingMode",null);b.__decorate([l.property({type:a,json:{write:{isRequired:!0}}})],k.prototype,"viewpoint",void 0);return k=f=b.__decorate([m.subclass("esri.webscene.InitialViewProperties")],k)})},"esri/webscene/Presentation":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Slide".split(" "),
function(d,b,a,k,l,t,x,q,m,h,g){const f=a.ofType(g);a=function(p){function r(y){y=u.call(this,y);y.slides=new f;return y}d._inherits(r,p);var u=d._createSuper(r);p=r.prototype;p.destroy=function(){this.slides.forEach(y=>y.destroy());this.slides.removeAll()};p.clone=function(){return new this.constructor({slides:this.slides.clone()})};d._createClass(r,[{key:"slides",set:function(y){y&&(y=y.filter(B=>!!B.viewpoint));this._set("slides",k.referenceSetter(y,this._get("slides"),f))}}]);return r}(l.JSONSupport);
b.__decorate([t.property({type:f,nonNullable:!0,json:{write:!0}}),x.cast(k.castForReferenceSetter)],a.prototype,"slides",null);return a=b.__decorate([h.subclass("esri.webscene.Presentation")],a)})},"esri/webscene/Slide":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3 ../chunks/vec3f64 ../layers/Layer ../layers/mixins/OperationalLayer ../support/basemapUtils ../views/3d/support/mathUtils ../views/3d/support/viewpointUtils ../views/support/Scheduler ../webdoc/support/SlideThumbnail ./SunLighting ./VirtualLighting ./support/Description ./support/SlideEnvironment ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(d,b,a,k,l,t,x,q,m,h,g,f,p,r,u,y,B,F,L,H,V,M,aa,ja,ka,la,U,T,ma,Y,fa,W,ba,X){function ca(E){if("building-scene"===E.type||"map-image"===E.type)return E.allSublayers.toArray()}function da(E){if(E=ca(E))return E.filter(K=>K.visible).map(K=>K.id)}function ha(E,K){E=K-E;43200<E&&(E-=86400);-43200>E&&(E+=86400);return E}let ia=0;const ea=t.ofType(ba.SlideVisibleLayer);q=function(E){function K(n){n=Z.call(this,n);n.id=Date.now().toString(16)+"-slide-"+ia++;n.title=new X;n.description=new Y;n.thumbnail=
new U.SlideThumbnail;n.viewpoint=null;n.basemap=null;n.ground=null;n.environment=new fa.SlideEnvironment;n.visibleLayers=new ea;return n}d._inherits(K,E);var Z=d._createSuper(K);E=K.prototype;E.destroy=function(){this.visibleLayers.removeAll();this.basemap?.destroy();this.basemap=null;this.thumbnail=h.destroyMaybe(this.thumbnail);this.thumbnail=this.title=this.description=null};E.castTitle=function(n){return"string"===typeof n?new X({text:n}):F.ensureType(X,n)};E.castDescription=function(n){return"string"===
typeof n?new Y({text:n}):F.ensureType(Y,n)};E.castThumbnail=function(n){return"string"===typeof n?new U.SlideThumbnail({url:n}):F.ensureType(U.SlideThumbnail,n)};E.castBasemap=function(n){return aa.ensureType(n)};E.castVisibleLayers=function(n){return n&&"function"===typeof n.map?n.map(z=>{if("string"===typeof z)return{id:z};if(z instanceof V){const G=da(z);return{id:z.id,sublayerIds:G}}if(z.id)return{id:z.id,sublayerIds:"sublayerIds"in z?z.sublayerIds:void 0};m.getLogger(this.declaredClass).warn('Invalid visible layer, expected { id }, Layer or "id"');
return z}):null};E.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};E._updateVisibleLayersFrom=function(n){const z=[];return g.eachAlways(this._getLayers(n.map).map(G=>
n.whenLayerView(G).then(J=>{if(J.visible){const I=da(G);z.push(new ba.SlideVisibleLayer({id:J.layer.id,sublayerIds:I}))}})).toArray()).then(()=>{this.visibleLayers.removeAll();this.visibleLayers.addMany(z)})};E.updateFrom=function(n,z){const G={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...(z&&z.screenshot)};return n.when(()=>{this.viewpoint=n.viewpoint.clone();this.environment.lighting="virtual"===n.environment.lighting.type?ma.prototype.clone.apply(n.environment.lighting):
T.prototype.clone.apply(n.environment.lighting);this.environment.weather=n.environment.weather.clone();this.basemap=n.map.basemap&&n.map.basemap.clone()||null;this.ground=n.map.ground?W.fromGround(n.map.ground):null;return this._updateVisibleLayersFrom(n)}).then(()=>n.takeScreenshot(G)).then(J=>{this.thumbnail=new U.SlideThumbnail({url:J.dataUrl});return this})};E.applyTo=async function(n,z){h.isSome(this._applyToController)&&this._applyToController.abort();let G=new AbortController;this._applyToController=
G;const J=g.onAbortOrThrow(z,()=>G?.abort()),I=n.resourceController.scheduler.registerTask(la.TaskPriority.SLIDE);let Q=!1;const w={animate:!0,...z,signal:this._applyToController.signal};z=await l.result(n.addUpdatingPromise((async()=>{await Promise.all([I.schedule(()=>Q=this._setViewpointOfInterest(n,w)),I.schedule(()=>this._applyBasemap(n,w),w.signal)]);await Promise.all([I.schedule(()=>this._applyLayerVisibility(n),w.signal),I.schedule(()=>this._applyGround(n),w.signal),I.schedule(()=>this._applyViewpoint(n,
w),w.signal)]);await I.schedule(()=>n.environment.weather=this.environment.weather.clone())})()));Q&&(n.contentCamera=null);I.remove();this._applyToController===G&&(this._applyToController=null);G=null;J?.remove();if(!1===z.ok)throw z.error;return this};E._applyBasemap=async function(n,z){if(this.basemap){try{await this.basemap.load(z)}catch(G){if(g.isAbortError(G))throw G;}n.map.basemap=aa.clonePreservingTiledLayers(this.basemap,n.map.basemap)}};E._applyGround=function(n){this.ground&&(n.map.ground=
this.ground.cloneAndApplyTo(n.map.ground))};E._getLayers=function(n){const z=new t;this._collectLayers(n,z);this._collectLayers(n.ground,z);return z};E._collectLayers=function(n,z){n.layers.forEach(G=>{M.isOperationalLayer(G)&&(z.add(G),"layers"in G&&this._collectLayers(G,z))})};E._applyLayerVisibility=function(n){this.visibleLayers&&this._getLayers(n.map).forEach(z=>{var G=this.visibleLayers.find(I=>I.id===z.id);z.visible=null!=G;const J=G&&G.sublayerIds;G=ca(z);J&&G&&G.forEach(I=>I.visible=J.includes(I.id))})};
E._setViewpointOfInterest=function(n,z){if(n.state.fixedContentCamera||!this.viewpoint||z?.ignoreViewpoint||!z?.useDestinationCamera)return!1;z=ka.toCamera(n,this.viewpoint);n.contentCamera=z;return h.isSome(z)};E._applyViewpoint=async function(n,z){this._applyCachedCameraTrackingEnabled(n);if(this.viewpoint&&!z.ignoreViewpoint){h.isSome(this.viewpoint.camera)&&(this.viewpoint.camera.fov=n.camera.fov);if(z.animate&&this.get("environment.lighting.date"))return this._animateToLighting(n,z);z.animate&&
(n.environment.applyLighting(this.environment.lighting.clone()),await n.goTo(this.viewpoint,z));n.viewpoint=this.viewpoint}n.environment.applyLighting(this.environment.lighting.clone())};E._animateToLighting=async function(n,z){let G=null;"virtual"!==n.environment.lighting.type&&"virtual"!==this.environment.lighting.type&&("global"===n.viewingMode&&(G=this._animateLightingWithCamera(n,n.environment.lighting,this.environment.lighting)),n.environment.cachedCameraTrackingEnabled=n.environment.lighting.cameraTrackingEnabled,
n.environment.lighting.cameraTrackingEnabled=!1);n.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;"virtual"===this.environment.lighting.type||"virtual"===n.environment.lighting.type?(n.environment.applyLighting(this.environment.lighting.clone()),"virtual"!==n.environment.lighting.type&&(n.environment.cachedCameraTrackingEnabled=n.environment.lighting.cameraTrackingEnabled,n.environment.lighting.cameraTrackingEnabled=!1)):null!=this.environment.lighting.displayUTCOffset&&
(n.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);return n.goTo(this.viewpoint,z).then(()=>{this._applyCachedCameraTrackingEnabled(n);n.environment.applyLighting(this.environment.lighting.clone())}).catch(J=>{h.isNone(n.animation)&&this._applyCachedCameraTrackingEnabled(n);throw J;}).finally(()=>{h.removeMaybe(G)})};E._applyCachedCameraTrackingEnabled=function(n){h.isSome(n.environment.cachedCameraTrackingEnabled)&&(n.environment.lighting.cameraTrackingEnabled=n.environment.cachedCameraTrackingEnabled,
n.environment.cachedCameraTrackingEnabled=null)};E._getTime=function(n){const z=n.getTime();n=3600*n.getUTCHours()+60*n.getUTCMinutes()+n.getUTCSeconds();return[z,n]};E._setTime=function(n,z,G){n.setTime(z);n.setUTCHours(G/3600);n.setUTCMinutes(G%3600/60);n.setUTCSeconds(G%3600%60);return n};E._animateLightingWithCamera=function(n,z,G){const [J,I]=this._getTime(new Date(z.date.toString())),[Q,w]=this._getTime(G.date),N=ha(I,w),R=n.renderCoordsHelper,c=H.create();R.toRenderCoords(n.camera.position,
c);const e=H.create(),v=H.create();h.isSome(this.viewpoint.camera)&&R.toRenderCoords(this.viewpoint.camera.position,e);const D=new Date;return f.when(()=>n.camera,C=>{R.toRenderCoords(C.position,v);var A=L.squaredDistance(c,v);const O=L.squaredDistance(e,v);C=0;0!==A+O&&(C=A/(A+O));A=J+(Q-J)*C;C=ja.moduloPositive(I+N*C,86400);z.date=this._setTime(D,A,C)})};K.createFrom=function(n,z){return(new this).updateFrom(n,z)};d._createClass(K,[{key:"visibleLayers",set:function(n){this._set("visibleLayers",
x.referenceSetter(n,this._get("visibleLayers"),ea))}}]);return K}(q.JSONSupport);b.__decorate([p.property({type:String,json:{write:{isRequired:!0}}})],q.prototype,"id",void 0);b.__decorate([p.property({type:X,json:{default:()=>new X({text:""}),write:{isRequired:!0}}})],q.prototype,"title",void 0);b.__decorate([r.cast("title")],q.prototype,"castTitle",null);b.__decorate([p.property({type:Y,json:{write:{overridePolicy(E){return{enabled:!(!E||!E.text)}}}}})],q.prototype,"description",void 0);b.__decorate([r.cast("description")],
q.prototype,"castDescription",null);b.__decorate([p.property({type:U.SlideThumbnail,json:{default:()=>new U.SlideThumbnail({url:""}),write:{isRequired:!0}}})],q.prototype,"thumbnail",void 0);b.__decorate([r.cast("thumbnail")],q.prototype,"castThumbnail",null);b.__decorate([p.property({type:k,nonNullable:!0,json:{write:{isRequired:!0}}})],q.prototype,"viewpoint",void 0);b.__decorate([p.property({type:a,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],q.prototype,"basemap",void 0);b.__decorate([r.cast("basemap")],
q.prototype,"castBasemap",null);b.__decorate([p.property({type:W,json:{write:!0}})],q.prototype,"ground",void 0);b.__decorate([p.property({type:ea,json:{write:{isRequired:!0}}})],q.prototype,"visibleLayers",null);b.__decorate([r.cast("visibleLayers")],q.prototype,"castVisibleLayers",null);b.__decorate([p.property({type:fa.SlideEnvironment,json:{write:!0}})],q.prototype,"environment",void 0);return q=b.__decorate([B.subclass("esri.webscene.Slide")],q)})},"esri/webdoc/support/SlideThumbnail":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q,m){var h;d.SlideThumbnail=h=function(g){function f(){var r=p.apply(this,arguments);r.url="";return r}b._inherits(f,g);var p=b._createSuper(f);g=f.prototype;g.destroy=function(){this.url=""};g.clone=function(){return new h({url:this.url})};return b._createClass(f)}(k.JSONSupport);a.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],d.SlideThumbnail.prototype,"url",void 0);d.SlideThumbnail=h=a.__decorate([m.subclass("esri.webdoc.support.SlideThumbnail")],d.SlideThumbnail);
Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/Description":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(){var p=f.apply(this,arguments);p.text="";return p}d._inherits(g,
h);var f=d._createSuper(g);g.prototype.clone=function(){return new m({text:this.text})};return d._createClass(g)}(a.JSONSupport);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"text",void 0);return a=m=b.__decorate([q.subclass("esri.webscene.support.Description")],a)})},"esri/webscene/support/SlideEnvironment":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../views/3d/environment/SunnyWeather ../../views/3d/environment/weather ../lightingTypes ../SunLighting".split(" "),
function(d,b,a,k,l,t,x,q,m,h,g,f){var p;d.SlideEnvironment=p=function(r){function u(){var B=y.apply(this,arguments);B.lighting=new f;B.weather=new m;return B}b._inherits(u,r);var y=b._createSuper(u);u.prototype.clone=function(){return new p({lighting:l.clone(this.lighting),weather:l.clone(this.weather)})};return b._createClass(u)}(k.JSONSupport);a.__decorate([t.property({types:g.lightingTypes,json:{write:!0}})],d.SlideEnvironment.prototype,"lighting",void 0);a.__decorate([t.property({types:h.weatherTypes,
json:{write:!0}})],d.SlideEnvironment.prototype,"weather",void 0);d.SlideEnvironment=p=a.__decorate([q.subclass("esri.webscene.Environment")],d.SlideEnvironment);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/SlideGround":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../webdoc/support/opacityUtils".split(" "),
function(d,b,a,k,l,t,x,q,m,h){var g;k=g=function(f){function p(){var u=r.apply(this,arguments);u.opacity=null;return u}d._inherits(p,f);var r=d._createSuper(p);f=p.prototype;f.clone=function(){return new g({opacity:this.opacity})};f.cloneAndApplyTo=function(u){if(null==this.opacity)return u;u=null!=u?u.clone():new a;u.opacity=this.opacity;return u};p.fromGround=function(u){return new g({opacity:u.opacity})};return d._createClass(p)}(k.JSONSupport);b.__decorate([l.property({type:Number,json:{type:t.Integer,
read:{reader:h.transparencyToOpacity,source:"transparency"},write:{writer:(f,p)=>{p.transparency=h.opacityToTransparency(f)},target:"transparency"}}})],k.prototype,"opacity",void 0);return k=g=b.__decorate([m.subclass("esri.webscene.support.SlideGround")],k)})},"esri/webscene/support/SlideVisibleLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q){var m;d.SlideVisibleLayer=m=function(h){function g(p){p=f.call(this,p);p.id="";p.sublayerIds=null;return p}b._inherits(g,h);var f=b._createSuper(g);g.prototype.clone=function(){return new m({id:this.id,sublayerIds:l.clone(this.sublayerIds)})};return b._createClass(g)}(k.JSONSupport);a.__decorate([t.property({type:String,json:{write:!0}})],d.SlideVisibleLayer.prototype,"id",void 0);a.__decorate([t.property({type:[x.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],
d.SlideVisibleLayer.prototype,"sublayerIds",void 0);d.SlideVisibleLayer=m=a.__decorate([q.subclass("esri.webscene.support.SlideVisibleLayer")],d.SlideVisibleLayer);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/Title":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(){var p=f.apply(this,arguments);p.text="";return p}d._inherits(g,h);var f=d._createSuper(g);g.prototype.clone=function(){return new m({text:this.text})};return d._createClass(g)}(a.JSONSupport);b.__decorate([k.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"text",void 0);return a=m=b.__decorate([q.subclass("esri.webscene.support.Title")],a)})},"esri/webscene/TransportationNetwork":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,a,k,l,t,x,q){var m;a=m=function(h){function g(p){return f.call(this,p)}d._inherits(g,h);var f=d._createSuper(g);g.prototype.clone=function(){return new m({name:this.name,path:this.path,title:this.title})};return d._createClass(g)}(a.JSONSupport);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"path",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"title",
void 0);return a=m=b.__decorate([q.subclass("esri.webscene.TransportationNetwork")],a)})},"esri/webscene/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../core/Version"],function(d,b,a){a=function(k){function l(x,q){return t.call(this,x,q,"webscene")}b._inherits(l,k);var t=b._createSuper(l);b._createClass(l,[{key:"supportsGround",get:function(){return this.since(1,8)}},{key:"supportsVisibleElevationLayersInSlides",get:function(){return this.lessThan(1,8)}}]);return l}(a.Version);
d.Version=a;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","./Error"],function(d,b,a){let k=function(){function l(x,q,m=""){this.major=x;this.minor=q;this._context=m}var t=l.prototype;t.lessThan=function(x,q){return this.major<x||x===this.major&&this.minor<q};t.since=function(x,q){return!this.lessThan(x,q)};t.validate=function(x){if(this.major!==x.major)throw new a((this._context&&this._context+
":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:x});};t.clone=function(){return new l(this.major,this.minor,this._context)};l.parse=function(x,q=""){const [m,h]=x.split(".");var g=/^\s*\d+\s*$/;if(!m||!m.match||!m.match(g))throw new a((q&&q+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:x});if(!h||!h.match||!h.match(g))throw new a((q&&q+":")+
"invalid-version","Expected minor version to be a number, but got '${version}'",{version:x});x=parseInt(m,10);g=parseInt(h,10);return new l(x,g,q)};return b._createClass(l)}();d.Version=k;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/schemaValidatorLoader":function(){define(["exports"],function(d){let b=null;d.getLoader=function(){return b};d.registerLoader=function(a){b=a};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/projection ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./geometry/support/spatialReferenceUtils ./portal/Portal ./portal/PortalItem ./support/MapFloorInfo ./support/webSceneUtils ./views/ViewingMode ./views/support/spatialReferenceSupport ./webdoc/support/saveUtils ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version ./webscene/support/schemaValidatorLoader".split(" "),function(d,
b,a,k,l,t,x,q,m,h,g,f,p,r,u,y,B,F,L,H,V,M,aa,ja,ka,la,U,T,ma,Y,fa,W,ba,X,ca,da,ha,ia,ea,E,K,Z,n,z,G,J){const I=new G.Version(1,31);l=function(w){function N(c){var e=R.call(this,c);e._layersIdGCTimeoutId=void 0;e._updateFromPromise=null;e.applicationProperties=null;e.clippingArea=null;e.clippingEnabled=!1;e.floorInfo=null;e.heightModelInfo=void 0;e.sourceVersion=null;e.transportationNetworks=null;e.presentation=new n;e.initialViewProperties=new Z;e.portalItem=null;e.resourceInfo=null;e._debouncedSaveOperations=
y.debounce(async(v,D,C)=>{switch(v){case Q.SAVE:return e._saveImpl(D);case Q.SAVE_AS:return e._saveAsImpl(C,D)}});e._resourceReferences={portalItem:null,paths:[]};e.authoringApp=null;e.authoringAppVersion=null;e._isAuthoringAppSetByUser=!1;e._isAuthoringAppVersionSetByUser=!1;return e}b._inherits(N,w);var R=b._createSuper(N);w=N.prototype;w.initialize=function(){this.when().catch(c=>{f.getLogger(this.declaredClass).error("#load()","Failed to load web scene",c)});if(this.resourceInfo){let c;try{c=
this._validateJSON(this.resourceInfo)}catch(e){this.addResolvingPromise(Promise.reject(e));return}this.read(c);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(this.allLayers.on("change",()=>this._scheduleLayersIdGC()))};w.destroy=function(){this._unscheduleLayersIdGC();this.presentation&&this.presentation.destroy();const c=this.portalItem;this.portalItem=null;c?.destroy();this.basemap?.destroy()};w.writeClippingArea=
function(c,e){e.clippingArea||(e.clippingArea={});e.clippingArea.geometry=c.toJSON()};w.readClippingEnabled=function(c,e){return e.clippingArea?!!e.clippingArea.clip:!1};w.writeClippingEnabled=function(c,e){this.clippingArea&&(e.clippingArea||(e.clippingArea={}),e.clippingArea.clip=c)};w.writeLayers=function(c,e,v,D){const C={...D,layerContainerType:"operational-layers"};c=c.map(A=>this.verifyWriteLayer(A,D)?A.write({},C):null).filter(A=>!!A);e[v]=c.toArray()};w.verifyWriteLayer=function(c,e){return"write"in
c?!0:(e&&e.messages&&e.messages.push(new q("layer:unsupported",`Layers (${c.title}, ${c.id}) of type '${c.declaredClass}' cannot be persisted in web scenes`,{layer:c})),!1)};w.readSourceVersion=function(c,e){const [v,D]=e.version.split(".");return new G.Version(parseInt(v,10),parseInt(D,10))};w.writeSourceVersion=function(c,e,v){e[v]=`${I.major}.${I.minor}`};w.writeAuthoringApp=function(c,e){e.authoringApp=c&&this._isAuthoringAppSetByUser?c:"ArcGIS API for JavaScript"};w.writeAuthoringAppVersion=
function(c,e){e.authoringAppVersion=c&&this._isAuthoringAppVersionSetByUser?c:k.version};w.writeGround=function(c,e,v,D){e[v]=c?c.write({},D):{transparency:0,layers:[]}};w.readInitialViewProperties=function(c,e){c={};e.initialState&&e.initialState.environment&&(c.environment=K.fromJSON(e.initialState.environment));c.spatialReference=e.spatialReference?T.fromJSON(e.spatialReference):T.WebMercator;c.viewingMode=e.viewingMode||"global";e.initialState&&e.initialState.viewpoint&&(c.viewpoint=t.fromJSON(e.initialState.viewpoint));
return new Z(c)};w.load=function(c){const e=this.ground;this.addResolvingPromise(this._loadFromSource().then(()=>{e&&e!==this.ground&&e.destroy()}));return Promise.resolve(this)};w.loadAll=function(){return g.loadAll(this,c=>{const e=this.presentation&&this.presentation.slides;c(this.ground,this.basemap,this.layers,e&&e.map(v=>v.basemap))})};w.read=function(c,e){e={...e,origin:"web-scene"};const v=this._isAuthoringAppVersionSetByUser,D=this._isAuthoringAppSetByUser;ja.readLoadable(this,c,C=>b._get(b._getPrototypeOf(N.prototype),
"read",this).call(this,c,C),e);D||(this._isAuthoringAppSetByUser=!1);v||(this._isAuthoringAppVersionSetByUser=!1);if(c.baseMap&&Array.isArray(c.baseMap.elevationLayers)&&(this.sourceVersion?.supportsVisibleElevationLayersInSlides??!1)){e=c.baseMap.elevationLayers.map(P=>({id:P.id}));const C=this.presentation.slides,A=(P,S)=>P.visibleLayers.some(na=>na.id===S),O=e.filter(P=>!C.some(S=>A(S,P.id)));C.forEach(P=>{P.visibleLayers.addMany(O)})}};w._writeBasemapElevationLayers=function(c){const e=c.ground&&
c.ground.layers;!c.baseMap&&e&&e.length&&(c.baseMap={title:"Basemap",baseMapLayers:[]});c.baseMap&&(c.baseMap.elevationLayers=m.clone(e))};w.write=function(c,e){if("loaded"!==this.loadStatus)throw e=new q("webscene:not-loaded","Web scene must be loaded before it can be serialized"),f.getLogger(this.declaredClass).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e;this._runLayersIdGC();var v=!e?.messages;e={messages:[],...e,origin:"web-scene"};
c=b._get(b._getPrototypeOf(N.prototype),"write",this).call(this,c,e);if(v&&(e=e.messages?.filter(D=>"web-document-write:property-required"===D.name)??[],e.length))throw v=new q("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e}),f.getLogger(this.declaredClass).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),v;this._writeBasemapElevationLayers(c);
return c};w.save=async function(c){return this._debouncedSaveOperations(Q.SAVE,c)};w._saveImpl=async function(c){if(!this.portalItem)throw f.getLogger(this.declaredClass).error("save(): requires the .portalItem property to be set"),await Promise.resolve(),new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if("Web Scene"!==this.portalItem?.type)throw await Promise.resolve(),new q("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"');
const e=this._updateFromPromise;await this._ensureLoadBeforeSave();const v=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?B.urlToObject(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??W.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),D=this.write({},v);await Promise.all(v.resources.pendingOperations);await this._verifySave(D,v,c);this._updateTypeKeywords(this.portalItem);
await this.portalItem.update({data:D});await ia.saveResources(this._resourceReferences,v,null);aa.updateOrigins(v);e&&await e;await this._saveThumbnail();return this.portalItem};w.saveAs=async function(c,e){return this._debouncedSaveOperations(Q.SAVE_AS,e,c)};w._saveAsImpl=async function(c,e){c=ba.from(c);c||(f.getLogger(this.declaredClass).error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new q("webscene:portal-item-required","saveAs requires a portal item to save to")));
c.id&&(c=c.clone(),c.id=null);const v=c.portal||W.getDefault();await this._ensureLoadBeforeSave();c.type="Web Scene";c.portal=v;const D=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:v,portalItem:c,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),C=this.write({},D);await Promise.all(D.resources.pendingOperations);await this._verifySaveAs(C,D,e);const A=this.thumbnailUrl,O=!this._isOverridden("thumbnailUrl");
this._updateTypeKeywords(c);await v.signIn();await v.user?.addItem({item:c,folder:e&&e.folder,data:C});await ia.saveResources(this._resourceReferences,D,null);this.portalItem=c;r.MultiOriginJSONSupport.prototype.read.call(this,{version:C.version,authoringApp:C.authoringApp,authoringAppVersion:C.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:c.itemUrl&&B.urlToObject(c.itemUrl)});aa.updateOrigins(D);A&&(this.thumbnailUrl=O?B.addQueryParameter(A,"w","8192"):A);D.portalItem=c;await this._saveThumbnail();
return c};w._saveThumbnail=async function(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))};w._verifySave=function(c,e,v,D=!1){if(!fa.isEarth(this.spatialReference))return Promise.reject(new q("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let C=e.messages?.filter(A=>"error"===A.type).map(A=>
new q(A.name,A.message,A.details))??[];e.blockedRelativeUrls&&(C=C.concat(e.blockedRelativeUrls.map(A=>new q("url:unsupported",`Relative url '${A}' is not supported in Web Scene`))));v&&v.ignoreUnsupported&&(C=C.filter(A=>"layer:unsupported"!==A.name&&"symbol:unsupported"!==A.name&&"symbol-layer:unsupported"!==A.name&&"property:unsupported"!==A.name&&"url:unsupported"!==A.name&&"scenemodification:unsupported"!==A.name));v?.requiredPropertyChecksDisabled&&(C=C.filter(A=>"web-document-write:property-required"!==
A.name));e=!!v?.strictSchemaValidationEnabled;v=J.getLoader();return(e&&v?v().then(A=>{A=A.validate(c);if(0<A.length){const O=`webscene did not validate:\n${A.join("\n")}`;f.getLogger(this.declaredClass).error(`${D?"saveAs":"save"}(): ${O}`)}return A.map(O=>new q("webscene:schema-validation",O))}).then(A=>{if(0<A.length)throw ca.createSchemaValidationError(A.concat(C));return C}):Promise.resolve(C)).then(A=>{if(0<A.length)throw new q("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:A});})};w._verifySaveAs=function(c,e,v){return this.canNotSaveAs(e)?Promise.reject(ca.createCopyError()):this._verifySave(c,e,v,!0)};w.verifySaveAs=function(c){const e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),v=this.write({},e);return this._verifySaveAs(v,e,c)};w.canNotSaveAs=function(c){c||(c=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},c));return 0<(c.verifyItemRelativeUrls?.writtenUrls?.length??0)};w.updateFrom=async function(c,
e={}){this._updateFromPromise=c=this._updateFrom(c,e);await c;this._updateFromPromise===c&&(this._updateFromPromise=null)};w._updateFrom=async function(c,e={}){await c.whenReady();!e.environmentExcluded&&c.environment&&(this.initialViewProperties.environment=K.prototype.clone.apply(c.environment));!e.viewpointExcluded&&c.viewpoint&&(this.initialViewProperties.viewpoint=c.viewpoint.clone());this.initialViewProperties.spatialReference=c.spatialReference.clone();this.initialViewProperties.viewingMode=
c.viewingMode;p.isSome(c.clippingArea)?c.clippingArea!==this.clippingArea&&(this.clippingArea=c.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;c.heightModelInfo&&(this.heightModelInfo=c.heightModelInfo.clone());if(c.map===this)for(const v of c.allLayerViews)"visible"in v&&"visible"in v.layer&&v._isOverridden("visible")&&(v.layer.visible=v.visible);(!1===e.thumbnailExcluded||null==e.thumbnailExcluded&&!e.viewpointExcluded)&&await this._updateFromThumbnail(c,e.thumbnailSize??
void 0)};w._updateFromThumbnail=async function(c,e){e=ea.getOptimalThumbnailSize(c,e);this.thumbnailUrl=(await c.takeScreenshot({format:"jpg",width:e.width,height:e.height,disableDecorations:!0})).dataUrl};w._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};w._readAndLoadFromJSON=function(c,e){c=this._validateJSON(c);this.read(c,e);return this._loadFromJSON(c,
e)};w._extractOperationalLayers=function(c){const e=[];if(!this.sourceVersion?.supportsGround&&c.baseMap&&Array.isArray(c.baseMap.elevationLayers))for(const C of c.baseMap.elevationLayers)e.push(C);const v=[],D=C=>{C.layers&&(C.layers=C.layers.filter(D));return"ArcGISTiledElevationServiceLayer"===C.layerType?(this.sourceVersion?.supportsGround||v.push(C),!1):!0};return{operationalLayers:c.operationalLayers?c.operationalLayers.filter(D):[],operationalElevationLayers:v,basemapElevationLayers:e}};w._loadFromJSON=
function(c,e){const v=new x;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>new Promise((D,C)=>d(["./layers/support/layersCreator"],D,C))).then(({populateOperationalLayers:D})=>{const {operationalLayers:C,operationalElevationLayers:A,basemapElevationLayers:O}=this._extractOperationalLayers(c),P=[],S={context:{...e,layerContainerType:"operational-layers"}};this.portalItem&&(S.context.portal=this.portalItem.portal||W.getDefault());0<O.length&&P.push(D(this.ground.layers,
O,{...S,context:{...S.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));0<A.length&&P.push(D(v,A,{...S,context:{...S.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));C&&0<C.length&&P.push(D(this.layers,C,S));return y.eachAlways(P).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(v)})};w._ensureLoadBeforeSave=async function(){await this.load();await this._loadObjectsWithLayers();
const c=[];for(const e of this.allLayers.items)if("beforeSave"in e&&"function"===typeof e.beforeSave){const v=e.beforeSave();v&&c.push(v)}await y.eachAlways(c)};w._loadObjectsWithLayers=async function(){const c=[];this.ground&&c.push(this.ground.load());this.basemap&&c.push(this.basemap.load());this.presentation.slides.forEach(e=>{e.basemap&&c.push(e.basemap.load())});await y.eachAlways(c)};w._loadFromItem=async function(c){await c.load().catch(D=>{throw new q("webscene:load-portal-item","Failed to load portal item",
{error:D});});if("Web Scene"!==c.type)throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:c.type});const e=await c.fetchData();this.resourceInfo=e;const v={origin:"web-scene",url:B.urlToObject(c.itemUrl),portal:c.portal||W.getDefault(),portalItem:c,readResourcePaths:[]};await this._readAndLoadFromJSON(e,v);this._resourceReferences={portalItem:c,paths:v.readResourcePaths??[]}};w._validateSpatialReference=function(){const c=this.initialViewProperties,
e=this._sceneSpatialReference;let v=void 0;if("local"!==c.viewingMode){if(!ha.isSpatialReferenceSupported(e,da.ViewingMode.Global))return Promise.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:e,viewingMode:c.viewingMode}));v=A=>!A||U.canProjectWithoutEngine(A,e)}else{if(!ha.isSpatialReferenceSupported(e,da.ViewingMode.Local))return Promise.reject(new q("webscene:unsupported-spatial-reference",
"Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:e,viewingMode:c.viewingMode}));v=A=>!A||A.equals(e)}const D=A=>p.unwrap(A?.camera)?.position.spatialReference??p.unwrap(A?.targetGeometry)?.spatialReference;var C=D(c.viewpoint);return C&&!v(C)?Promise.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{cameraSpatialReference:C,sceneSpatialReference:e,viewingMode:c.viewingMode})):(C=this.presentation.slides.find(A=>!v(D(A.viewpoint))))?(C=D(C.viewpoint),Promise.reject(new q("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:C,sceneSpatialReference:e,viewingMode:c.viewingMode}))):Promise.resolve()};w._validateHeightModelInfo=function(){const c=
ma.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return c?Promise.reject(c):Promise.resolve()};w._validateJSON=function(c){const e=G.Version.parse(c.version||"","webscene");I.validate(e);c.version=`${e.major}.${e.minor}`;1===e.major&&2>=e.minor&&(c.spatialReference=T.WebMercator.toJSON());return c};w._updateTypeKeywords=function(c){"local"===this.initialViewProperties.viewingMode?c.typeKeywords?c.typeKeywords.includes("ViewingMode-Local")||c.typeKeywords.push("ViewingMode-Local"):
c.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&c.typeKeywords&&(c.typeKeywords=c.typeKeywords.filter(e=>"ViewingMode-Local"!==e));c.typeKeywords&&(c.typeKeywords=c.typeKeywords.filter((e,v,D)=>D.indexOf(e)===v))};w._enableVerifyItemRelativeUrls=function(c){const e=this._verifyItemRelativeRootPath;e&&(c.verifyItemRelativeUrls={rootPath:e,writtenUrls:[]});return c};w._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};w._scheduleLayersIdGC=function(){this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0;this._runLayersIdGC()},3E3)};w._runLayersIdGC=function(){this._unscheduleLayersIdGC();var c=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search;const e=v=>this.allLayers.some(D=>D.id===v);c&&c.layers&&(c.layers=c.layers.filter(v=>e(v.id)));(c=this.presentation&&this.presentation.slides)&&
c.forEach(v=>{v.visibleLayers&&(v.visibleLayers=v.visibleLayers.filter(D=>e(D.id)))})};N.fromJSON=function(c){if(!c)throw new q("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:c})};b._createClass(N,[{key:"thumbnailUrl",get:function(){return this.portalItem?.thumbnailUrl??null},set:function(c){c?this._override("thumbnailUrl",c):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}},{key:"authoringApp",set:function(c){this._isAuthoringAppSetByUser=
!0;this._set("authoringApp",c)}},{key:"authoringAppVersion",set:function(c){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",c)}},{key:"spatialReference",get:function(){return this.initialViewProperties?.spatialReference??T.WebMercator}},{key:"viewingMode",get:function(){return this.initialViewProperties?.viewingMode??"global"}},{key:"_sceneSpatialReference",get:function(){return this.initialViewProperties.spatialReference||T.WebMercator}},{key:"_verifyItemRelativeRootPath",
get:function(){return this.portalItem?.itemUrl?B.urlToObject(this.portalItem.itemUrl).path:null}}]);return N}(h.LoadableMixin(u.EsriPromiseMixin(r.MultiOriginJSONMixin(l))));l.version=`${I.major}.${I.minor}`;a.__decorate([F.property({type:E,json:{write:!0}})],l.prototype,"applicationProperties",void 0);a.__decorate([F.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],l.prototype,"basemap",void 0);a.__decorate([F.property({type:ka,json:{read:{source:"clippingArea.geometry",reader:Y.fromJSON},
write:{target:"clippingArea.geometry"}}})],l.prototype,"clippingArea",void 0);a.__decorate([M.writer("clippingArea")],l.prototype,"writeClippingArea",null);a.__decorate([F.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],l.prototype,"clippingEnabled",void 0);a.__decorate([H.reader("clippingEnabled",["clippingArea"])],l.prototype,"readClippingEnabled",null);a.__decorate([M.writer("clippingEnabled")],l.prototype,"writeClippingEnabled",null);a.__decorate([F.property({type:X,json:{read:{source:"mapFloorInfo"},
write:{target:"mapFloorInfo"}}})],l.prototype,"floorInfo",void 0);a.__decorate([F.property({type:la,json:{write:!0}})],l.prototype,"heightModelInfo",void 0);a.__decorate([F.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],l.prototype,"layers",void 0);a.__decorate([M.writer("layers")],l.prototype,"writeLayers",null);a.__decorate([F.property({readOnly:!0,type:G.Version,json:{type:(()=>{const w=[],N=I.major;for(let R=8;R<=I.minor;R++)w.push(`${N}.${R}`);return w})(),write:{ignoreOrigin:!0,
target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],l.prototype,"sourceVersion",void 0);a.__decorate([H.reader("sourceVersion",["version"])],l.prototype,"readSourceVersion",null);a.__decorate([M.writer("sourceVersion")],l.prototype,"writeSourceVersion",null);a.__decorate([F.property({json:{read:!1,write:!1}})],l.prototype,"tables",void 0);a.__decorate([F.property()],l.prototype,"thumbnailUrl",null);a.__decorate([F.property({type:String,json:{write:{writerEnsuresNonNull:!0,
ignoreOrigin:!0}}})],l.prototype,"authoringApp",null);a.__decorate([M.writer("authoringApp")],l.prototype,"writeAuthoringApp",null);a.__decorate([F.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],l.prototype,"authoringAppVersion",null);a.__decorate([M.writer("authoringAppVersion")],l.prototype,"writeAuthoringAppVersion",null);a.__decorate([F.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],l.prototype,"ground",void 0);a.__decorate([M.writer("ground")],
l.prototype,"writeGround",null);a.__decorate([F.property({type:x.ofType(z),json:{write:!0}})],l.prototype,"transportationNetworks",void 0);a.__decorate([F.property({type:n,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(w,N,R,c)=>{w.slides&&0<w.slides.length&&(N.presentation=w.write({},{...c,isPresentation:!0}))}}}})],l.prototype,"presentation",void 0);a.__decorate([F.property({type:Z,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new Z({viewingMode:"global",
spatialReference:T.WebMercator})}})],l.prototype,"initialViewProperties",void 0);a.__decorate([H.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],l.prototype,"readInitialViewProperties",null);a.__decorate([F.property({type:T,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],l.prototype,"spatialReference",null);a.__decorate([F.property({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],l.prototype,
"viewingMode",null);a.__decorate([F.property({type:ba})],l.prototype,"portalItem",void 0);a.__decorate([F.property()],l.prototype,"resourceInfo",void 0);l=a.__decorate([V.subclass("esri.WebScene")],l);var Q;(function(w){w[w.SAVE=0]="SAVE";w[w.SAVE_AS=1]="SAVE_AS"})(Q||(Q={}));return l});