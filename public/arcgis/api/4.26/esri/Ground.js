// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Color ./core/Collection ./core/collectionUtils ./core/compilerUtils ./core/Error ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./ground/NavigationConstraint ./webdoc/support/opacityUtils".split(" "),function(t,l,m,A,B,
C,D,E,g,v,F,G,w,q,p,x,H,I,J,y){function z(d){return"elevation"===d.type||d&&"createElevationSampler"in d}var u;g=u=function(d){function h(a){var b=K.call(this,a);b.opacity=1;b.surfaceColor=null;b.navigationConstraint=null;b.layers=new B;b.addHandles([b.layers.on("after-add",c=>{c=c.item;c.parent&&c.parent!==l._assertThisInitialized(b)&&"remove"in c.parent&&c.parent.remove(c);c.parent=l._assertThisInitialized(b);"elevation"!==c.type&&"base-elevation"!==c.type&&w.getLogger(b.declaredClass).error(`Layer '${c.title}, id:${c.id}' of type '${c.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)}),
b.layers.on("after-remove",c=>{c.item.parent=null})]);return b}l._inherits(h,d);var K=l._createSuper(h);d=h.prototype;d.initialize=function(){this.when().catch(a=>{w.getLogger(this.declaredClass).error("#load()","Failed to load ground",a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};d.destroy=function(){const a=this.layers.removeAll();for(const b of a)b.destroy();this.layers.destroy()};d.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",
a.resourceInfo),a={...a},delete a.resourceInfo);return a};d.writeLayers=function(a,b,c,e){const k=[];a&&(e={...e,layerContainerType:"ground"},a.forEach(f=>{if("write"in f){const n={};D.typeCast(f)().write(n,e)&&k.push(n)}else e&&e.messages&&e.messages.push(new E("layer:unsupported",`Layers (${f.title}, ${f.id}) of type '${f.declaredClass}' cannot be persisted in the ground`,{layer:f}))}));b.layers=k};d.load=function(a){this.addResolvingPromise(this._loadFromSource(a));return Promise.resolve(this)};
d.loadAll=function(){return G.loadAll(this,a=>{a(this.layers)})};d.queryElevation=async function(a,b){await this.load({signal:b?.signal});var {ElevationQuery:c}=await new Promise((k,f)=>t(["./layers/support/ElevationQuery"],k,f));q.throwIfAborted(b);c=new c;const e=this.layers.filter(z).toArray();return c.queryAll(e,a,b)};d.createElevationSampler=async function(a,b){await this.load({signal:b?.signal});var {ElevationQuery:c}=await new Promise((k,f)=>t(["./layers/support/ElevationQuery"],k,f));q.throwIfAborted(b);
c=new c;const e=this.layers.filter(z).toArray();return c.createSamplerAll(e,a,b)};d.clone=function(){const a={opacity:this.opacity,surfaceColor:v.clone(this.surfaceColor),navigationConstraint:v.clone(this.navigationConstraint),layers:this.layers.slice()};this.loaded&&(a.loadStatus="loaded");return(new u({resourceInfo:this.resourceInfo})).set(a)};d.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});l._get(l._getPrototypeOf(h.prototype),"read",this).call(this,a,b)};d._loadFromSource=
function(a){const b=this.resourceInfo;return b?this._loadLayersFromJSON(b.data,b.context,a):Promise.resolve()};d._loadLayersFromJSON=function(a,b,c){const e=b&&b.origin||"web-scene",k=b&&b.portal||null,f=b&&b.url||null;return(new Promise((n,r)=>t(["./layers/support/layersCreator"],n,r))).then(({populateOperationalLayers:n})=>{q.throwIfAborted(c);const r=[];a.layers&&Array.isArray(a.layers)&&r.push(n(this.layers,a.layers,{context:{origin:e,url:f,portal:k,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));
return q.eachAlways(r)}).then(()=>{})};l._createClass(h,[{key:"layers",set:function(a){this._set("layers",C.referenceSetter(a,this._get("layers")))}}]);return h}(g.JSONSupportMixin(F));m.__decorate([p.property({json:{read:!1}})],g.prototype,"layers",null);m.__decorate([I.writer("layers")],g.prototype,"writeLayers",null);m.__decorate([p.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);m.__decorate([p.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:x.Integer,read:{reader:y.transparencyToOpacity,
source:"transparency"},write:{writer:(d,h)=>{h.transparency=y.opacityToTransparency(d)},target:"transparency"}}})],g.prototype,"opacity",void 0);m.__decorate([p.property({type:A,json:{type:[x.Integer],write:(d,h)=>{h.surfaceColor=d.toJSON().slice(0,3)}}})],g.prototype,"surfaceColor",void 0);m.__decorate([p.property({type:J.NavigationConstraint,json:{write:!0}})],g.prototype,"navigationConstraint",void 0);return g=u=m.__decorate([H.subclass("esri.Ground")],g)});