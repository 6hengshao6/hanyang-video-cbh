// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/Collection ./core/collectionUtils ./core/deprecate ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./webdoc/support/writeUtils".split(" "),
function(E,l,k,t,y,F,g,G,H,I,u,z,v,w,m,O,J,K,L,A,M,B,C){var q;let N=0;g=q=function(e){function h(a){var b=x.call(this,a);b.id=null;b.portalItem=null;b.spatialReference=null;b.thumbnailUrl=null;b.title="Basemap";b.id=Date.now().toString(16)+"-basemap-"+N++;b.baseLayers=new t;b.referenceLayers=new t;const d=c=>{c.parent&&c.parent!==l._assertThisInitialized(b)&&"remove"in c.parent&&c.parent.remove(c);c.parent=l._assertThisInitialized(b);"elevation"===c.type&&u.getLogger(b.declaredClass).error(`Layer '${c.title}, id:${c.id}' of type '${c.type}' is not supported as a basemap layer and will therefore be ignored.`)};
b.addHandles([b.baseLayers.on("after-add",c=>d(c.item)),b.referenceLayers.on("after-add",c=>d(c.item)),b.baseLayers.on("after-remove",c=>{c.item.parent=null}),b.referenceLayers.on("after-remove",c=>{c.item.parent=null})]);return b}l._inherits(h,e);var x=l._createSuper(h);e=h.prototype;e.initialize=function(){this.when().catch(a=>{u.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,a)});this.resourceInfo&&this.read(this.resourceInfo.data,
this.resourceInfo.context)};e.destroy=function(){var a=this.baseLayers.removeAll();for(const b of a)b.destroy();a=this.referenceLayers.removeAll();for(const b of a)b.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem?.destroy();this.portalItem=null};e.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a={...a},delete a.resourceInfo);return a};e._writeBaseLayers=function(a,b,d){const c=[];a&&(d={...d,layerContainerType:"basemap"},
this.baseLayers.forEach(f=>{f=C.getLayerJSON(f,d.webmap?d.webmap.getLayerJSONFromResourceInfo(f):null,d);z.isSome(f)&&c.push(f)}),this.referenceLayers.forEach(f=>{const n=C.getLayerJSON(f,d.webmap?d.webmap.getLayerJSONFromResourceInfo(f):null,d);z.isSome(n)&&("scene"!==f.type&&(n.isReference=!0),c.push(n))}));b.baseMapLayers=c};e.writeTitle=function(a,b){b.title=a||"Basemap"};e.load=function(a){this.addResolvingPromise(this._loadFromSource(a));return Promise.resolve(this)};e.loadAll=function(){return I.loadAll(this,
a=>{a(this.baseLayers,this.referenceLayers)})};e.clone=function(){const a={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};this.loaded&&(a.loadStatus="loaded");return(new q({resourceInfo:this.resourceInfo})).set(a)};e.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});l._get(l._getPrototypeOf(h.prototype),"read",this).call(this,a,b)};e.write=function(a,b){a=a||{};b&&b.origin||(b=
{origin:"web-map",...b});l._get(l._getPrototypeOf(h.prototype),"write",this).call(this,a,b);!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(a.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(d=>{d=G.clone(d);d.url&&w.isProtocolRelative(d.url)&&(d.url=`https:${d.url}`);d.templateUrl&&w.isProtocolRelative(d.templateUrl)&&(d.templateUrl=`https:${d.templateUrl}`);return d}));return a};e._loadFromSource=async function(a){const {resourceInfo:b,portalItem:d}=this;v.throwIfAborted(a);
const c=[];b?(c.push(this._loadLayersFromJSON(b.data,b.context?b.context.url:null,a)),b.data.id&&!b.data.title&&c.push(B.getBasemapTitle(b.data.id).then(f=>{f&&this.read({title:f},b.context)}))):d&&c.push(this._loadFromItem(d,a));await Promise.all(c)};e._loadLayersFromJSON=async function(a,b,d){var c=this.resourceInfo&&this.resourceInfo.context;const f=this.portalItem&&this.portalItem.portal||c&&c.portal||null,n=c&&"web-scene"===c.origin?"web-scene":"web-map",{populateOperationalLayers:D}=await new Promise((r,
p)=>E(["./layers/support/layersCreator"],r,p));c=[];v.throwIfAborted(d);if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){b={context:{origin:n,url:b,portal:f,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const r=p=>"web-scene"===n&&"ArcGISSceneServiceLayer"===p.layerType||p.isReference;d=D(this.baseLayers,a.baseMapLayers.filter(p=>!r(p)),b);c.push(d);a=D(this.referenceLayers,a.baseMapLayers.filter(r),b);c.push(a)}await v.eachAlways(c)};e._loadFromItem=async function(a,b){const d=
await (await a.load(b)).fetchData("json",b),c=w.urlToObject(a.itemUrl??"");this._set("resourceInfo",{data:d.baseMap??{},context:{origin:"Web Scene"===a.type?"web-scene":"web-map",portal:a.portal||A.getDefault(),url:c}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:d.spatialReference},this.resourceInfo.context);this.read({title:a.title,thumbnailUrl:a.thumbnailUrl},{origin:"portal-item",portal:a.portal||A.getDefault(),url:c});return this._loadLayersFromJSON(this.resourceInfo.data,
c,b)};h.fromId=function(a){const b=B.esriBasemapDefinitions[a];if(b){if(b.deprecated){let d=null;"dark-gray"===a?d="dark-gray-vector":"gray"===a?d="gray-vector":"streets"===a?d="streets-vector":"topo"===a&&(d="topo-vector");F.deprecated(u.getLogger("esri.Basemap"),`The ${a} basemap has entered mature support and is no longer being updated.`,{replacement:d,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return q.fromJSON(b)}return null};l._createClass(h,[{key:"baseLayers",set:function(a){this._set("baseLayers",
y.referenceSetter(a,this._get("baseLayers")))}},{key:"referenceLayers",set:function(a){this._set("referenceLayers",y.referenceSetter(a,this._get("referenceLayers")))}}]);return h}(g.JSONSupportMixin(H));k.__decorate([m.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,h,x,a){this._writeBaseLayers(e,h,a)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:t}},writer(e,h,x,a){this._writeBaseLayers(e,h,a)}}}}}})],g.prototype,"baseLayers",null);k.__decorate([m.property({type:String,
json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"id",void 0);k.__decorate([m.property({type:M})],g.prototype,"portalItem",void 0);k.__decorate([m.property()],g.prototype,"referenceLayers",null);k.__decorate([m.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);k.__decorate([m.property({type:L})],g.prototype,"spatialReference",void 0);k.__decorate([m.property()],g.prototype,"thumbnailUrl",void 0);k.__decorate([m.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],
g.prototype,"title",void 0);k.__decorate([K.writer("title")],g.prototype,"writeTitle",null);return g=q=k.__decorate([J.subclass("esri.Basemap")],g)});