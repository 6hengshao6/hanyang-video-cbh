// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../core/asyncUtils ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(h,k,q,r,l,t,u){async function m(c,b){b={...(r.isSome(b)?b:{}),compress:c.compress};b=await k.result(c.resource.portalItem.addResource(c.resource,c.content,b));if(!0===b.ok)c.finish?.(c.resource);else throw c.error?.(b.error),b.error;}async function v(c,b){b=await k.result(c.resource.update(c.content,b));if(!0===b.ok)c.finish?.(c.resource);
else throw c.error?.(b.error),b.error;}h.saveResources=async function(c,b,d){if(b&&b.resources){var g=b.portalItem===c.portalItem?new Set(c.paths):new Set;c.paths.length=0;c.portalItem=b.portalItem;var f=new Set(b.resources.toKeep.map(a=>a.resource.path)),n=new Set,e=[];f.forEach(a=>{g.delete(a);c.paths.push(a)});for(const a of b.resources.toUpdate)if(g.delete(a.resource.path),f.has(a.resource.path)||n.has(a.resource.path)){const {resource:w,content:x,finish:y,error:z}=a,p=u.getSiblingOfSameTypeI(w,
t.generateUUID());c.paths.push(p.path);e.push(m({resource:p,content:x,compress:a.compress,finish:y,error:z},d))}else c.paths.push(a.resource.path),e.push(v(a,d)),n.add(a.resource.path);for(const a of b.resources.toAdd)e.push(m(a,d)),c.paths.push(a.resource.path);g.forEach(a=>{b.portalItem&&(a=b.portalItem.resourceFromPath(a),e.push(a.portalItem.removeResource(a).catch(()=>{})))});if(0!==e.length&&(f=await l.eachAlways(e),l.throwIfAborted(d),d=f.filter(a=>"error"in a).map(a=>a.error),0<d.length))throw new q("save:resources",
"Failed to save one or more resources",{errors:d});}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});