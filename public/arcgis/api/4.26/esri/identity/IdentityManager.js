// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/Evented ../core/events ../core/lang ../core/object ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo ../portal/support/urlUtils".split(" "),
function(C,z,r,D,t,B,K,W,Z,V,da,E,O,I,Y,S,ea,na,ka,ma,aa,oa,wa){const pa={},ua=n=>{const X=(new I.Url(n.owningSystemUrl)).host;n=(new I.Url(n.server)).host;const la=/.+\.arcgis\.com$/i;return la.test(X)&&la.test(n)},ra=(n,X)=>!!(ua(n)&&X&&X.some(la=>la.test(n.server)));let sa=null,va=null;try{sa=window.localStorage,va=window.sessionStorage}catch{}S=function(n){function X(){var a=la.call(this);a._portalConfig=globalThis.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=[];
a._xoReqs=[];a._portals=[];a._defaultOAuthInfo=null;a._defaultTokenValidity=60;a.dialog=null;a.formConstructor=na;a.tokenValidity=null;a.normalizeWebTierAuth=!1;a._appOrigin="null"!==window.origin?window.origin:window.location.origin;a._appUrlObj=I.urlToObject(window.location.href);a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthLocationParams=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;
a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthLocationParams();window.addEventListener("pageshow",b=>{a._pageShowHandler(b)});return a}z._inherits(X,n);var la=z._createSuper(X);n=X.prototype;n.registerServers=function(a){const b=this.serverInfos;b?(a=a.filter(c=>!this.findServerInfo(c.server)),
this.serverInfos=b.concat(a)):this.serverInfos=a;a.forEach(c=>{c.owningSystemUrl&&this._portals.push(c.owningSystemUrl);c.hasPortal&&this._portals.push(c.server)})};n.registerOAuthInfos=function(a){const b=this.oAuthInfos;if(b){for(const c of a){const d=this.findOAuthInfo(c.portalUrl);d&&b.splice(b.indexOf(d),1)}this.oAuthInfos=b.concat(a)}else this.oAuthInfos=a};n.registerToken=function(a){a={...a};const b=this._sanitizeUrl(a.server),c=this._isServerRsrc(b);let d=this.findServerInfo(b),f=!0,l;d||
(d=new oa,d.server=this._getServerInstanceRoot(b),c?d.hasServer=!0:(d.tokenServiceUrl=this._getTokenSvcUrl(b),d.hasPortal=!0),this.registerServers([d]));(l=this._findCredential(b))?(delete a.server,Object.assign(l,a),f=!1):(l=new C.Credential({userId:a.userId,server:d.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:c?"server":"portal"}),l.resources=[b],this.credentials.push(l));l.emitTokenChange(!1);f||l.refreshServerTokens()};n.toJSON=function(){return V.fixJson({serverInfos:this.serverInfos.map(a=>
a.toJSON()),oAuthInfos:this.oAuthInfos.map(a=>a.toJSON()),credentials:this.credentials.map(a=>a.toJSON())})};n.initialize=function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var b=a.serverInfos,c=a.oAuthInfos;a=a.credentials;if(b){const d=[];b.forEach(f=>{f.server&&f.tokenServiceUrl&&d.push(f.declaredClass?f:new oa(f))});d.length&&this.registerServers(d)}if(c){const d=[];c.forEach(f=>{f.appId&&d.push(f.declaredClass?f:new aa(f))});d.length&&this.registerOAuthInfos(d)}a&&a.forEach(d=>{d.server&&
d.token&&d.expires&&d.expires>Date.now()&&(d=d.declaredClass?d:new C.Credential(d),d.emitTokenChange(),this.credentials.push(d))})}};n.findServerInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.serverInfos)if(this._hasSameServerInstance(c.server,a)){b=c;break}return b};n.findOAuthInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.oAuthInfos)if(this._hasSameServerInstance(c.portalUrl,a)){b=c;break}return b};n.findCredential=function(a,b){if(a){a=this._sanitizeUrl(a);
var c=this._isServerRsrc(a)?"server":"portal";if(b)for(const f of this.credentials){if(this._hasSameServerInstance(f.server,a)&&b===f.userId&&f.scope===c){var d=f;break}}else for(const f of this.credentials)if(this._hasSameServerInstance(f.server,a)&&-1!==this._getIdenticalSvcIdx(a,f)&&f.scope===c){d=f;break}return d}};n.getCredential=function(a,b){let c=!0;if(b){var d=!!b.token;var f=b.error;c=!1!==b.prompt}b={...b};a=this._sanitizeUrl(a);const l=new AbortController,q=E.createResolver();if(b.signal)E.onAbort(b.signal,
()=>{l.abort()});E.onAbort(l,()=>{q.reject(new K("identity-manager:user-aborted","ABORTED"))});if(E.isAborted(l))return q.promise;b.signal=l.signal;const A=this._isAdminResource(a);if((d=d?this.findCredential(a):null)&&f&&f.details&&498===f.details.httpStatus)d.destroy();else if(d)return a=new K("identity-manager:not-authorized","You are currently signed in as: '"+d.userId+"'. You do not have access to this resource: "+a,{error:f}),q.reject(a),q.promise;if(f=this._findCredential(a,b))return q.resolve(f),
q.promise;let k=this.findServerInfo(a);if(k)!k.hasServer&&this._isServerRsrc(a)&&(k._restInfoPms=this._getTokenSvcUrl(a),k.hasServer=!0);else{f=this._getTokenSvcUrl(a);if(!f)return a=new K("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),q.reject(a),q.promise;k=new oa;k.server=this._getServerInstanceRoot(a);"string"===typeof f?(k.tokenServiceUrl=f,k.hasPortal=!0):(k._restInfoPms=f,k.hasServer=!0);this.registerServers([k])}k.hasPortal&&void 0===k._selfReq&&
(c||I.hasSameOrigin(k.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(p=>p.tokenServiceUrl===k.tokenServiceUrl))&&(k._selfReq={owningTenant:b&&b.owningTenant,selfDfd:this._getPortalSelf(k.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,k,b,q,A)};n.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&
a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};n.generateToken=function(a,b,c){const d=this._rePortalTokenSvc.test(a.tokenServiceUrl),f=new I.Url(this._appOrigin);var l=a.shortLivedTokenValidity;let q,A,k,p,J,y,L;b&&(L=this.tokenValidity||l||this._defaultTokenValidity,L>l&&0<l&&(L=l));c&&(q=c.isAdmin,A=c.serverUrl,k=c.token,J=c.signal,y=c.ssl,a.customParameters=c.customParameters);q?l=a.adminTokenServiceUrl:(l=a.tokenServiceUrl,p=new I.Url(l.toLowerCase()),
a.webTierAuth&&c?.serverUrl&&!y&&"http"===f.scheme&&(I.hasSameOrigin(f.uri,l,!0)||"https"===p.scheme&&f.host===p.host&&"7080"===f.port&&"7443"===p.port)&&(l=l.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));c={query:{request:"getToken",username:b?.username,password:b?.password,serverUrl:A,token:k,expiration:L,referer:q||d?this._appOrigin:null,client:q?"referer":null,f:"json",...a.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(a,c),signal:J,...c?.ioArgs};d||(c.withCredentials=
!1);return B(l,c).then(M=>{M=M.data;if(!M||!M.token)return new K("identity-manager:authentication-failed","Unable to generate token");const G=a.server;pa[G]||(pa[G]={});b&&(pa[G][b.username]=b.password);M.validity=L;return M})};n.isBusy=function(){return!!this._busy};n.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(b=>b.credential)};n.checkAppAccess=function(a,b,c){let d=!1;return this.getCredential(a,{prompt:!1}).then(f=>{let l;const q={f:"json"};if("portal"===f.scope)if(b&&
(this._doPortalSignIn(a)||c&&c.force))l=f.server+"/sharing/rest/oauth2/validateAppAccess",q.client_id=b;else if(f.token)l=f.server+"/sharing/rest";else return{credential:f};else if(f.token)l=f.server+"/rest/services";else return{credential:f};f.token&&(q.token=f.token);return B(l,{query:q,authMode:"anonymous"}).then(A=>{if(!1===A.data.valid)throw new K("identity-manager:not-authorized",`You are currently signed in as: '${f.userId}'.`,A.data);d=!!A.data.viewOnlyUserTypeApp;return{credential:f}}).catch(A=>
{if("identity-manager:not-authorized"===A.name)throw A;A=A.details&&A.details.httpStatus;if(498===A)throw f.destroy(),new K("identity-manager:not-authenticated","User is not signed in.");if(400===A)throw new K("identity-manager:invalid-request");return{credential:f}})}).then(f=>({credential:f.credential,viewOnly:d}))};n.setOAuthResponseHash=function(a){a&&("#"===a.charAt(0)&&(a=a.substring(1)),this._processOAuthPopupParams(I.queryToObject(a)))};n.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=
a};n.setProtocolErrorHandler=function(a){this._protocolFunc=a};n.signIn=function(a,b,c={}){const d=E.createResolver(),f=()=>{A?.remove();k?.remove();p?.remove();q?.destroy();this.dialog?.destroy();this.dialog=q=A=k=p=null},l=()=>{f();this._oAuthDfd=null;d.reject(new K("identity-manager:user-aborted","ABORTED"))};if(c.signal)E.onAbort(c.signal,()=>{l()});let q=new this.formConstructor;q.resource=this.getResourceName(a);q.server=b.server;this.dialog=new ka;this.dialog.content=q;this.dialog.open=!0;
this.emit("dialog-create");let A=q.on("cancel",l),k=O.watch(()=>this.dialog.open,l),p=q.on("submit",J=>{this.generateToken(b,J,{isAdmin:c.isAdmin,signal:c.signal}).then(y=>{f();y=new C.Credential({userId:J.username,server:b.server,token:y.token,expires:null!=y.expires?Number(y.expires):null,ssl:!!y.ssl,isAdmin:c.isAdmin,validity:y.validity});d.resolve(y)}).catch(y=>{q.error=y;q.signingIn=!1})});return d.promise};n.oAuthSignIn=function(a,b,c,d){const f=this._oAuthDfd=E.createResolver();if(d?.signal)E.onAbort(d.signal,
()=>{const M=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;M&&!M.closed?M.close():this.dialog&&y()});f.resUrl_=a;f.sinfo_=b;f.oinfo_=c;let l;const q=c._oAuthCred;if(q.storage&&("authorization-code"===c.flowType||"auto"===c.flowType&&!c.popup&&8.4<=b.currentVersion)){let M=crypto.getRandomValues(new Uint8Array(32));l=I.base64UrlEncode(M);q.codeVerifier=l;M=crypto.getRandomValues(new Uint8Array(32));q.stateUID=I.base64UrlEncode(M);q.save()||(q.codeVerifier=l=null)}else q.codeVerifier=null;this._getCodeChallenge(l).then(M=>
{const G=!d||!1!==d.oAuthPopupConfirmation;c.popup&&G?(A=new this.formConstructor,A.oAuthPrompt=!0,A.server=b.server,this.dialog=new ka,this.dialog.content=A,this.dialog.open=!0,this.emit("dialog-create"),k=A.on("cancel",y),p=O.watch(()=>this.dialog.open,y),J=A.on("submit",()=>{L();this._doOAuthSignIn(a,b,c,M)})):this._doOAuthSignIn(a,b,c,M)});let A,k,p,J;const y=()=>{L();this._oAuthDfd=null;f.reject(new K("identity-manager:user-aborted","ABORTED"))},L=()=>{k?.remove();p?.remove();J?.remove();A?.destroy();
this.dialog?.destroy();this.dialog=null};return f.promise};n.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")};n.enablePostMessageAuth=function(a="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=Z.on(window,"message",b=>{if((b.origin===this._appOrigin||b.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===b.data?.type){const c=
b.source;this.getCredential(a).then(d=>{c.postMessage({type:"arcgis:auth:credential",credential:{expires:d.expires,server:d.server,ssl:d.ssl,token:d.token,userId:d.userId}},b.origin)}).catch(d=>{c.postMessage({type:"arcgis:auth:error",error:{name:d.name,message:d.message}},b.origin)})}})};n.disablePostMessageAuth=function(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)};n._getOAuthLocationParams=function(){var a=window.location.hash;if(a){"#"===
a.charAt(0)&&(a=a.substring(1));a=I.queryToObject(a);var b=!1;if(a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username"))try{a.state=JSON.parse(a.state),a.state.portalUrl&&(this._oAuthLocationParams=a,b=!0)}catch{}else if(a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0,a.state)))try{a.state=JSON.parse(a.state)}catch{}b&&(window.location.hash=a.state?.hash||"")}if(a=window.location.search){"?"===
a.charAt(0)&&(a=a.substring(1));a=I.queryToObject(a);b=!1;if(a.code&&a.state)try{a.state=JSON.parse(a.state),a.state.portalUrl&&a.state.uid&&(this._oAuthLocationParams=a,b=!0)}catch{}else if(a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0,a.state)))try{a.state=JSON.parse(a.state)}catch{}if(b){const c={...a};"code error error_description message_code persist state".split(" ").forEach(d=>{delete c[d]});b=
I.objectToQuery(c);window.history.replaceState(window.history.state,"",window.location.pathname+(b?`?${b}`:"")+(a.state?.hash||""))}}};n._getOAuthToken=function(a,b,c,d,f){a=a.replace(/^http:/i,"https:");return B(`${a}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:d&&f?{grant_type:"authorization_code",code:b,redirect_uri:d,client_id:c,code_verifier:f}:{grant_type:"refresh_token",refresh_token:b,client_id:c}}).then(l=>l.data)};n._getCodeChallenge=function(a){return a&&globalThis.isSecureContext?
(a=(new TextEncoder).encode(a),crypto.subtle.digest("SHA-256",a).then(b=>I.base64UrlEncode(new Uint8Array(b)))):Promise.resolve(null)};n._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new K("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))};n._findCredential=function(a,b){let c=-1,d,f,l;const q=b&&b.token;b=b&&b.resource;const A=this._isServerRsrc(a)?"server":"portal",k=this.credentials.filter(p=>this._hasSameServerInstance(p.server,a)&&
p.scope===A);a=b||a;if(k.length)if(1===k.length)if(b=k[0],l=(d=(f=this.findServerInfo(b.server))&&f.owningSystemUrl)?this.findCredential(d,b.userId):void 0,c=this._getIdenticalSvcIdx(a,b),q)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,l));else return-1===c&&b.resources.push(a),this._addResource(a,l),b;else{let p,J;k.some(y=>{J=this._getIdenticalSvcIdx(a,y);return-1!==J?(p=y,l=(d=(f=this.findServerInfo(p.server))&&f.owningSystemUrl)?this.findCredential(d,p.userId):void 0,c=J,!0):!1});if(q)p&&
(p.resources.splice(c,1),this._removeResource(a,l));else if(p)return this._addResource(a,l),p}};n._findOAuthInfo=function(a){let b=this.findOAuthInfo(a);if(!b)for(const c of this.oAuthInfos)if(this._isIdProvider(c.portalUrl,a)){b=c;break}return b};n._addResource=function(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)};n._removeResource=function(a,b){let c=-1;b&&(c=this._getIdenticalSvcIdx(a,b),-1<c&&b.resources.splice(c,1))};n._useProxy=function(a,b){return b&&b.isAdmin&&!I.hasSameOrigin(a.adminTokenServiceUrl,
this._appOrigin)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!I.hasSameOrigin(a.tokenServiceUrl,this._appOrigin)};n._getOrigin=function(a){a=new I.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};n._getServerInstanceRoot=function(a){const b=a.toLowerCase();let c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&(c=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1!==c||wa.isSecureProxyService(b)||(c=
b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&(c=b.length-1);return-1<c?a.substring(0,c):a};n._hasSameServerInstance=function(a,b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b};n._normalizeAGOLorgDomain=function(a){const b=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,c=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,
d=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;b.test(a)?a=a.replace(b,"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a};n._sanitizeUrl=function(a){const b=(D.request.proxyUrl||"").toLowerCase(),c=b?a.toLowerCase().indexOf(b+"?"):-1;-1!==c&&(a=a.substring(c+b.length+1));a=I.normalize(a);return I.urlToObject(a).path};n._isRESTService=function(a){return a.includes(this._agsRest)};n._isAdminResource=
function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};n._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};n._isIdenticalService=function(a,b){var c=!1;this._isRESTService(a)&&this._isRESTService(b)?(a=this._getSuffix(a).toLowerCase(),b=this._getSuffix(b).toLowerCase(),c=a===b,c||(c=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi,c=a.replace(c,"$1")===b.replace(c,"$1"))):this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||
this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=!0);return c};n._isPortalDomain=function(a){const b=new I.Url(a.toLowerCase());a=this._portalConfig;let c=this._gwDomains.some(d=>d.regex.test(b.uri));!c&&a&&(c=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),b.uri));c||D.portalUrl&&(c=I.hasSameOrigin(b,D.portalUrl,!0));c||(c=this._portals.some(d=>this._hasSameServerInstance(d,b.uri)));return c=c||this._agsPortal.test(b.path)};n._isIdProvider=function(a,b){let c=-1,d=-1;this._gwDomains.forEach((l,
q)=>{-1===c&&l.regex.test(a)&&(c=q);-1===d&&l.regex.test(b)&&(d=q)});let f=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)f=!0}else if(1===c){if(1===d||2===d)f=!0}else 2===c?2===d&&(f=!0):3===c&&3===d&&(f=!0);if(!f){const l=this.findServerInfo(b),q=l&&l.owningSystemUrl;q&&ua(l)&&this._isPortalDomain(q)&&this._isIdProvider(a,q)&&(f=!0)}return f};n._getIdenticalSvcIdx=function(a,b){let c=-1;for(let d=0;d<b.resources.length;d++)if(this._isIdenticalService(a,b.resources[d])){c=d;break}return c};n._getSuffix=
function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};n._getTokenSvcUrl=function(a){if(this._isRESTService(a)||this._isAdminResource(a)){var b=this._getServerInstanceRoot(a);var c=b+"/admin/generateToken";a=b+"/rest/info";b=B(a,{query:{f:"json"}}).then(d=>d.data);return{adminUrl:c,promise:b}}if(this._isPortalDomain(a)){let d="";this._gwDomains.some(f=>{f.regex.test(a)&&(d=f.tokenServiceUrl);return!!d});d||this._portals.some(f=>{this._hasSameServerInstance(f,a)&&
(d=f+this._gwTokenUrl);return!!d});d||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(d=a.substring(0,c)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(c=(new I.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===c&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,"https:"));return d}if(a.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};n._processOAuthResponseParams=function(a,b,c){const d=b._oAuthCred;if(a.code){var f=d.codeVerifier;
d.codeVerifier=null;d.stateUID=null;d.save();return this._getOAuthToken(c.server,a.code,b.appId,this._getRedirectURI(b,!0),f).then(l=>{const q=new C.Credential({userId:l.username,server:c.server,token:l.access_token,expires:Date.now()+1E3*l.expires_in,ssl:l.ssl,oAuthState:a.state,_oAuthCred:d});b.userId=q.userId;d.storage=l.persist?sa:va;d.refreshToken=l.refresh_token;d.token=null;d.expires=l.refresh_token_expires_in?Date.now()+1E3*l.refresh_token_expires_in:null;d.userId=q.userId;d.ssl=q.ssl;d.save();
return q})}f=new C.Credential({userId:a.username,server:c.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,oAuthState:a.state,_oAuthCred:d});b.userId=f.userId;d.storage=a.persist?sa:va;d.refreshToken=null;d.token=f.token;d.expires=f.expires;d.userId=f.userId;d.ssl=f.ssl;d.save();return Promise.resolve(f)};n._processOAuthPopupParams=function(a){const b=this._oAuthDfd;this._oAuthDfd=null;if(b)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),
a.error){const c="access_denied"===a.error;a=new K(c?"identity-manager:user-aborted":"identity-manager:authentication-failed",c?"ABORTED":"OAuth: "+a.error+" - "+a.error_description);b.reject(a)}else this._processOAuthResponseParams(a,b.oinfo_,b.sinfo_).then(c=>{b.resolve(c)}).catch(c=>{b.reject(c)})};n._setOAuthResponseQueryString=function(a){a&&("?"===a.charAt(0)&&(a=a.substring(1)),this._processOAuthPopupParams(I.queryToObject(a)))};n._exchangeToken=function(a,b,c){return B(`${a}/sharing/rest/oauth2/exchangeToken`,
{authMode:"anonymous",method:"post",query:{f:"json",client_id:b,token:c}}).then(d=>d.data.token)};n._getPlatformSelf=function(a,b){a=a.replace(/^http:/i,"https:");return B(`${a}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":b,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(c=>c.data)};n._getPortalSelf=function(a,b){let c;this._gwDomains.some(d=>{d.regex.test(a)&&(c=
d.customBaseUrl);return!!c});if(c)return Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:c,portalMode:"multitenant",supportsOAuth:!0});this._appOrigin.startsWith("https:")?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return B(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(d=>d.data)};n._doPortalSignIn=function(a){const b=this._portalConfig,c=window.location.href,d=this.findServerInfo(a);
return(b||this._isPortalDomain(c))&&(d?d.hasPortal||d.owningSystemUrl&&this._isPortalDomain(d.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(c,a)||b&&(this._hasSameServerInstance(this._getServerInstanceRoot(b.restBaseUrl),a)||this._isIdProvider(b.restBaseUrl,a))||I.hasSameOrigin(c,a,!0))?!0:!1};n._checkProtocol=function(a,b,c,d){let f=!0;d=d?b.adminTokenServiceUrl:b.tokenServiceUrl;d.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&I.getProxyRule(d)&&
(f=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:b}):!1,f||(a=new K("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),c(a)));return f};n._enqueue=function(a,b,c,d,f,l){d||(d=E.createResolver());d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=f;d.refresh_=l;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):
this._xoReqs.push(d):this._doSignIn(d);return d.promise};n._doSignIn=function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const b=k=>{var p=a.options_&&a.options_.resource;const J=a.resUrl_,y=a.refresh_;let L=!1;this.credentials.includes(k)||(y&&this.credentials.includes(y)?(y.userId=k.userId,y.token=k.token,y.expires=k.expires,y.validity=k.validity,y.ssl=k.ssl,y.creationTime=k.creationTime,L=!0,k=y):this.credentials.push(k));k.resources||(k.resources=[]);k.resources.includes(p||J)||k.resources.push(p||
J);k.scope=this._isServerRsrc(J)?"server":"portal";k.emitTokenChange();p=this._soReqs;const M={};this._soReqs=[];p.forEach(G=>{if(!this._isIdenticalService(J,G.resUrl_)){const H=this._getSuffix(G.resUrl_);M[H]||(M[H]=!0,k.resources.push(G.resUrl_))}});a.resolve(k);p.forEach(G=>{this._hasSameServerInstance(this._getServerInstanceRoot(J),G.resUrl_)?G.resolve(k):this._soReqs.push(G)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;L||this.emit("credential-create",{credential:k});this._soReqs.length?this._doSignIn(this._soReqs.shift()):
this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},c=k=>{a.reject(k);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},d=(k,p,J,y)=>{const L=a.sinfo_,M=!a.options_||!1!==a.options_.prompt,G=L.hasPortal&&this._findOAuthInfo(a.resUrl_);let H,Q;if(k)b(new C.Credential({userId:k,server:L.server,token:J||null,expires:null!=y?Number(y):null,ssl:!!p}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&
this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),a.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const h=Z.on(window,"message",e=>{e.source===window.parent&&e.data&&("arcgis:auth:credential"===e.data.type?(h.remove(),e.data.credential.expires<Date.now()?c(new K("identity-manager:credential-request-failed","Parent application's token has expired.")):
b(new C.Credential(e.data.credential))):"arcgis:auth:error"===e.data.type&&(h.remove(),"tokenExpiredError"===e.data.error.name?c(new K("identity-manager:credential-request-failed","Parent application's token has expired.")):c(K.fromJSON(e.data.error))))});E.onAbort(a.options_?.signal,()=>{h.remove()})}else if(G){let h=G._oAuthCred;h||(k=new ma(G,sa),p=new ma(G,va),k.isValid()&&p.isValid()?k.expires>p.expires?(h=k,p.destroy()):(h=p,k.destroy()):h=k.isValid()?k:p,G._oAuthCred=h);if(h.isValid()){H=new C.Credential({userId:h.userId,
server:L.server,token:h.token,expires:h.expires,ssl:h.ssl,_oAuthCred:h});const e=G.appId!==h.appId&&this._doPortalSignIn(a.resUrl_);e||h.refreshToken?(a._pendingDfd=h.refreshToken?this._getOAuthToken(L.server,h.refreshToken,h.appId).then(g=>{H.expires=Date.now()+1E3*g.expires_in;H.token=g.access_token;return H}):Promise.resolve(H),a._pendingDfd.then(g=>e?this._exchangeToken(g.server,G.appId,g.token).then(u=>{g.token=u;return g}).catch(()=>g):g).then(g=>{b(g)}).catch(()=>{h?.destroy();d()})):b(H)}else if(this._oAuthLocationParams&&
this._hasSameServerInstance(G.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===h.stateUID&&h.codeVerifier))k=this._oAuthLocationParams,this._oAuthLocationParams=null,a._pendingDfd=this._processOAuthResponseParams(k,G,L).then(e=>{b(e)}).catch(c);else{const e=()=>{M?a._pendingDfd=this.oAuthSignIn(a.resUrl_,L,G,a.options_).then(b,c):(Q=new K("identity-manager:not-authenticated","User is not signed in."),
c(Q))};this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._getPlatformSelf(L.server,G.appId).then(g=>{I.hasSameOrigin(g.portalUrl,this._appOrigin,!0)?(H=new C.Credential({userId:g.username,server:L.server,expires:Date.now()+1E3*g.expires_in,token:g.token}),b(H)):e()}).catch(e):e()}}else M?this._checkProtocol(a.resUrl_,L,c,a.admin_)&&(k=a.options_,a.admin_&&(k=k||{},k.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,L,k).then(b,c)):(Q=new K("identity-manager:not-authenticated","User is not signed in."),
c(Q))},f=()=>{const k=a.sinfo_;var p=k.owningSystemUrl;const J=a.options_;let y,L,M,G;J&&(y=J.token,L=J.error,M=J.prompt);G=this._findCredential(p,{token:y,resource:a.resUrl_});if(!G)for(const H of this.credentials)if(this._isIdProvider(p,H.server)){G=H;break}G?(p=this.findCredential(a.resUrl_,G.userId))?b(p):ra(k,this._legacyFed)?(p=G.toJSON(),p.server=k.server,p.resources=null,b(new C.Credential(p))):(a._pendingDfd=this.generateToken(this.findServerInfo(G.server),null,{serverUrl:a.resUrl_,token:G.token,
signal:a.options_.signal,ssl:G.ssl})).then(H=>{b(new C.Credential({userId:G?.userId,server:k.server,token:H.token,expires:null!=H.expires?Number(H.expires):null,ssl:!!H.ssl,isAdmin:a.admin_,validity:H.validity}))},c):(this._busy=null,y&&(a.options_.token=null),(a._pendingDfd=this.getCredential(p.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:k.owningTenant,signal:a.options_.signal,token:y,error:L,prompt:M})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},H=>{a.resUrl_=
a.sinfo_=a.refresh_=null;a.reject(H)}))};this._errbackFunc=c;const l=a.sinfo_.owningSystemUrl,q=this._isServerRsrc(a.resUrl_),A=a.sinfo_._restInfoPms;A?A.promise.then(k=>{const p=a.sinfo_;p._restInfoPms&&(p.adminTokenServiceUrl=p._restInfoPms.adminUrl,p._restInfoPms=null,p.tokenServiceUrl=(da.getDeepValue("authInfo.tokenServicesUrl",k)||da.getDeepValue("authInfo.tokenServiceUrl",k)||da.getDeepValue("tokenServiceUrl",k))??null,p.shortLivedTokenValidity=da.getDeepValue("authInfo.shortLivedTokenValidity",
k)??null,p.currentVersion=k.currentVersion,p.owningTenant=k.owningTenant,(k=p.owningSystemUrl=k.owningSystemUrl)&&this._portals.push(k));q&&p.owningSystemUrl?f():d()},()=>{a.sinfo_._restInfoPms=null;const k=new K("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");c(k)}):q&&l?f():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(k=>{const p={};let J,y,L,M;k&&(J=k.user&&k.user.username,p.username=J,p.allSSL=k.allSSL,y=k.supportsOAuth,M=parseFloat(k.currentVersion),
"multitenant"===k.portalMode&&(L=k.customBaseUrl),a.sinfo_.currentVersion=M);a.sinfo_.webTierAuth=!!J;return J&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:p.allSSL}).catch(()=>null).then(G=>{p.portalToken=G&&G.token;p.tokenExpiration=G&&G.expires;return p}):!J&&y&&4.4<=M&&!this._findOAuthInfo(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:L,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>p):p}).catch(()=>null).then(k=>{a.sinfo_._selfReq=
null;k?d(k.username,k.allSSL,k.portalToken,k.tokenExpiration):d()}):d()};n._generateOAuthInfo=function(a){let b=null,c=a.portalUrl;const d=a.customBaseUrl,f=a.owningTenant;if(a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){b=window.location.href;let l=b.indexOf("?");-1<l&&(b=b.slice(0,l));l=b.search(/\/(apps|home)\//);b=-1<l?b.slice(0,l):null}a&&b?(this._hasTestedIfAppIsOnPortal=!0,a=B(b+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=
new aa({appId:"arcgisonline",popupCallbackUrl:b+"/home/oauth-callback.html"})})):a=Promise.resolve();return a.then(()=>{if(this._defaultOAuthInfo)return c=c.replace(/^http:/i,"https:"),B(c+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:f,client_id:this._defaultOAuthInfo.appId,redirect_uri:I.makeAbsolute(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const q=this._defaultOAuthInfo.clone();q.portalUrl=l.data.urlKey&&d?"https://"+l.data.urlKey.toLowerCase()+
"."+d:c;q.popup=window!==window.top||!(I.hasSameOrigin(c,this._appOrigin)||this._gwDomains.some(A=>A.regex.test(c)&&A.regex.test(this._appOrigin)));this.oAuthInfos.push(q)}})})};n._doOAuthSignIn=function(a,b,c,d){var f=c._oAuthCred,l={portalUrl:c.portalUrl};!c.popup&&c.preserveUrlHash&&window.location.hash&&(l.hash=window.location.hash);f.stateUID&&(l.uid=f.stateUID);l={client_id:c.appId,response_type:f.codeVerifier?"code":"token",state:JSON.stringify(l),expiration:c.expiration,locale:c.locale,redirect_uri:this._getRedirectURI(c,
!!f.codeVerifier)};c.forceLogin&&(l.force_login=!0);c.forceUserId&&c.userId&&(l.prepopulatedusername=c.userId);!c.popup&&this._doPortalSignIn(a)&&(l.redirectToUserOrgUrl=!0);f.codeVerifier&&(l.code_challenge=d||f.codeVerifier,l.code_challenge_method=d?"S256":"plain");d=c.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize";f=d+"?"+I.objectToQuery(l);if(c.popup){const q=window.open(f,"esriJSAPIOAuth",c.popupWindowFeatures);q?(q.focus(),this._oAuthDfd.oAuthWin_=q,this._oAuthIntervalId=
setInterval(()=>{if(q.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnPopupHandle.remove();const A=this._oAuthDfd;if(A){const k=new K("identity-manager:user-aborted","ABORTED");A.reject(k)}}},500),this._oAuthOnPopupHandle=Z.on(window,["arcgis:auth:hash","arcgis:auth:location:search"],A=>{"arcgis:auth:hash"===A.type?this.setOAuthResponseHash(A.detail):this._setOAuthResponseQueryString(A.detail)})):(a=new K("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=
!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:l,authorizeUrl:d,resourceUrl:a,serverInfo:b,oAuthInfo:c}):window.location.href=f};n._getRedirectURI=function(a,b){const c=window.location.href.replace(/#.*$/,"");if(a.popup)return I.makeAbsolute(a.popupCallbackUrl);if(b){const d=I.urlToObject(c);d.query&&"code error error_description message_code persist state".split(" ").forEach(f=>{delete d.query[f]});return I.addQueryParameters(d.path,d.query)}return c};return z._createClass(X)}(W);
S.prototype.declaredClass="esri.identity.IdentityManagerBase";C.Credential=function(n){function X(a){var b=la.call(this,a);b._oAuthCred=null;b.tokenRefreshBuffer=2;a&&a._oAuthCred&&(b._oAuthCred=a._oAuthCred);return b}z._inherits(X,n);var la=z._createSuper(X);n=X.prototype;n.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};n.refreshToken=function(){const a=t.id.findServerInfo(this.server),b=a&&a.owningSystemUrl,c=!!b&&"server"===this.scope,
d=c&&ra(a,t.id._legacyFed);var f=a.webTierAuth;const l=f&&t.id.normalizeWebTierAuth;var q=pa[this.server];q=q&&q[this.userId];let A=this.resources&&this.resources[0],k=c?t.id.findServerInfo(b):null,p={username:this.userId,password:q},J;if(!f||l)if(c&&!k&&t.id.serverInfos.some(y=>{t.id._isIdProvider(b,y.server)&&(k=y);return!!k}),f=k?t.id.findCredential(k.server,this.userId):null,!c||f)if(d)f?.refreshToken();else{if(c)J={serverUrl:A,token:f&&f.token,ssl:f&&f.ssl};else if(l)p=null,J={ssl:this.ssl};
else if(q)this.isAdmin&&(J={isAdmin:!0});else{let y;A&&(A=t.id._sanitizeUrl(A),this._enqueued=1,y=t.id._enqueue(A,a,null,null,this.isAdmin,this),y.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return y}return t.id.generateToken(c?k:a,c?null:p,J).then(y=>{this.token=y.token;this.expires=null!=y.expires?Number(y.expires):null;this.creationTime=Date.now();this.validity=y.validity;this.emitTokenChange();this.refreshServerTokens()}).catch(()=>{})}};n.refreshServerTokens=
function(){"portal"===this.scope&&t.id.credentials.forEach(a=>{const b=t.id.findServerInfo(a.server),c=b&&b.owningSystemUrl;a!==this&&a.userId===this.userId&&c&&"server"===a.scope&&(t.id._hasSameServerInstance(this.server,c)||t.id._isIdProvider(c,this.server))&&(ra(b,t.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})};n.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var b=this.server&&
t.id.findServerInfo(this.server);const c=(b=b&&b.owningSystemUrl)&&t.id.findServerInfo(b);!1===a||b&&"portal"!==this.scope&&(!c||!c.webTierAuth||t.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};n.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=t.id.credentials.indexOf(this);-1<a&&t.id.credentials.splice(a,
1);this.emitTokenChange();this.emit("destroy")};n.toJSON=function(){const a=V.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a};n._startRefreshTimer=function(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer,b=2**31-1;let c=(this.validity?this.creationTime+6E4*this.validity:
this.expires)-Date.now();0>c?c=0:c>b&&(c=b);this._refreshTimer=setTimeout(this.refreshToken.bind(this),c>a?c-a:c)};return z._createClass(X)}(W.EventedAccessor);r.__decorate([Y.property()],C.Credential.prototype,"creationTime",void 0);r.__decorate([Y.property()],C.Credential.prototype,"expires",void 0);r.__decorate([Y.property()],C.Credential.prototype,"isAdmin",void 0);r.__decorate([Y.property()],C.Credential.prototype,"oAuthState",void 0);r.__decorate([Y.property()],C.Credential.prototype,"resources",
void 0);r.__decorate([Y.property()],C.Credential.prototype,"scope",void 0);r.__decorate([Y.property()],C.Credential.prototype,"server",void 0);r.__decorate([Y.property()],C.Credential.prototype,"ssl",void 0);r.__decorate([Y.property()],C.Credential.prototype,"token",void 0);r.__decorate([Y.property()],C.Credential.prototype,"tokenRefreshBuffer",void 0);r.__decorate([Y.property()],C.Credential.prototype,"userId",void 0);r.__decorate([Y.property()],C.Credential.prototype,"validity",void 0);C.Credential=
r.__decorate([ea.subclass("esri.identity.Credential")],C.Credential);C.IdentityManagerBase=S;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/identity/IdentityForm":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../intl/substitute ../widgets/Widget ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../widgets/support/jsxFactory".split(" "),
function(C,z,r,D,t,B,K,W,Z,V,da,E){D=function(O){function I(S,ea){S=Y.call(this,S,ea);S._usernameInputNode=null;S._passwordInputNode=null;S.signingIn=!1;S.server=null;S.resource=null;S.error=null;S.oAuthPrompt=!1;return S}C._inherits(I,O);var Y=C._createSuper(I);O=I.prototype;O.render=function(){const {error:S,server:ea,resource:na,signingIn:ka,oAuthPrompt:ma,messages:aa}=this,oa=E.tsx("div",{class:"esri-identity-form__group"},W.substitute(ma?aa.oAuthInfo:aa.info,{server:ea&&/\.arcgis\.com/i.test(ea)?
"ArcGIS Online":ea,resource:`(${na||aa.lblItem})`})),wa=ma?null:E.tsx("div",{class:"esri-identity-form__group",key:"username"},E.tsx("label",{class:"esri-identity-form__label"},aa.lblUser,E.tsx("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:V.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),pa=ma?null:E.tsx("div",{class:"esri-identity-form__group",key:"password"},E.tsx("label",{class:"esri-identity-form__label"},aa.lblPwd,E.tsx("input",
{value:"",required:!0,type:"password",bind:this,afterCreate:V.storeNode,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),ua=E.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},E.tsx("input",{type:"submit",disabled:!!ka,value:ka?aa.lblSigning:aa.lblOk,class:"esri-button"}),E.tsx("input",{type:"button",value:aa.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),ra=S?E.tsx("div",null,S.details&&S.details.httpStatus?
aa.invalidUser:aa.noAuthService):null;return E.tsx("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},oa,ra,wa,pa,ua)};O._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};O._submit=function(S){S.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&
this._passwordInputNode.value})};return C._createClass(I)}(Z);z.__decorate([r.property(),da.messageBundle("esri/identity/t9n/identity")],D.prototype,"messages",void 0);z.__decorate([r.property()],D.prototype,"signingIn",void 0);z.__decorate([r.property()],D.prototype,"server",void 0);z.__decorate([r.property()],D.prototype,"resource",void 0);z.__decorate([r.property()],D.prototype,"error",void 0);z.__decorate([r.property()],D.prototype,"oAuthPrompt",void 0);return D=z.__decorate([K.subclass("esri.identity.IdentityForm")],
D)})},"esri/identity/IdentityModal":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/handleUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../widgets/Widget ../widgets/support/widget ../widgets/support/jsxFactory ../widgets/support/decorators/messageBundle".split(" "),function(C,z,r,D,t,B,K,W,Z,V,da,E,O){function I(H,Q){var h=Object.keys(H);
if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(H);Q&&(e=e.filter(function(g){return Object.getOwnPropertyDescriptor(H,g).enumerable}));h.push.apply(h,e)}return h}function Y(H){for(var Q=1;Q<arguments.length;Q++){var h=null!=arguments[Q]?arguments[Q]:{};Q%2?I(Object(h),!0).forEach(function(e){var g=h[e];a:if("object"===typeof e&&null!==e){var u=e[Symbol.toPrimitive];if(void 0!==u){e=u.call(e,"string");if("object"!==typeof e)break a;throw new TypeError("@@toPrimitive must return a primitive value.");
}e=String(e)}e="symbol"===typeof e?e:String(e);e in H?Object.defineProperty(H,e,{value:g,enumerable:!0,configurable:!0,writable:!0}):H[e]=g}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(h)):I(Object(h)).forEach(function(e){Object.defineProperty(H,e,Object.getOwnPropertyDescriptor(h,e))})}return H}B='input:not([inert]) select:not([inert]) textarea:not([inert]) a[href]:not([inert]) button:not([inert]) [tabindex]:not(slot):not([inert]) audio[controls]:not([inert]) video[controls]:not([inert]) [contenteditable]:not([contenteditable\x3d"false"]):not([inert]) details\x3esummary:first-of-type:not([inert]) details:not([inert])'.split(" ");
var S=B.join(","),ea=(K="undefined"===typeof Element)?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,na=!K&&Element.prototype.getRootNode?function(H){var Q;return null===H||void 0===H?void 0:null===(Q=H.getRootNode)||void 0===Q?void 0:Q.call(H)}:function(H){return null===H||void 0===H?void 0:H.ownerDocument},ka=function e(Q,h){var g;void 0===h&&(h=!0);var u=null===Q||void 0===Q?void 0:null===(g=Q.getAttribute)||void 0===g?void 0:
g.call(Q,"inert");return""===u||"true"===u||h&&Q&&e(Q.parentNode)},ma=function(Q,h,e){if(ka(Q))return[];var g=Array.prototype.slice.apply(Q.querySelectorAll(S));h&&ea.call(Q,S)&&g.unshift(Q);return g=g.filter(e)},aa=function u(h,e,g){for(var x=[],w=Array.from(h);w.length;){var F=w.shift();if(!ka(F,!1))if("SLOT"===F.tagName){var N=F.assignedElements();N=u(N.length?N:F.children,!0,g);g.flatten?x.push.apply(x,N):x.push({scopeParent:F,candidates:N})}else{ea.call(F,S)&&g.filter(F)&&(e||!h.includes(F))&&
x.push(F);N=F.shadowRoot||"function"===typeof g.getShadowRoot&&g.getShadowRoot(F);var R=!ka(N,!1)&&(!g.shadowRootFilter||g.shadowRootFilter(F));N&&R?(N=u(!0===N?F.children:N.children,!0,g),g.flatten?x.push.apply(x,N):x.push({scopeParent:F,candidates:N})):w.unshift.apply(w,F.children)}}return x},oa=function(h,e){if(0>h.tabIndex){if(!(e=e||/^(AUDIO|VIDEO|DETAILS)$/.test(h.tagName))){var g;e=null===h||void 0===h?void 0:null===(g=h.getAttribute)||void 0===g?void 0:g.call(h,"contenteditable");e=""===e||
"true"===e}if(e&&isNaN(parseInt(h.getAttribute("tabindex"),10)))return 0}return h.tabIndex},wa=function(h,e){return h.tabIndex===e.tabIndex?h.documentOrder-e.documentOrder:h.tabIndex-e.tabIndex},pa=function(h){return"DETAILS"===h.tagName&&Array.prototype.slice.apply(h.children).some(function(e){return"SUMMARY"===e.tagName})},ua=function(h,e){for(var g=0;g<h.length;g++)if(h[g].checked&&h[g].form===e)return h[g]},ra=function(h){if(!h.name)return!0;var e=h.form||na(h),g=function(x){return e.querySelectorAll('input[type\x3d"radio"][name\x3d"'+
x+'"]')};if("undefined"!==typeof window&&"undefined"!==typeof window.CSS&&"function"===typeof window.CSS.escape)var u=g(window.CSS.escape(h.name));else try{u=g(h.name)}catch(x){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",x.message),!1}g=ua(u,h.form);return!g||g===h},sa=function(h){h=h.getBoundingClientRect();var e=h.height;return 0===h.width&&0===e},va=function(h,e){var g=e.displayCheck;
e=e.getShadowRoot;if("hidden"===getComputedStyle(h).visibility)return!0;var u=ea.call(h,"details\x3esummary:first-of-type")?h.parentElement:h;if(ea.call(u,"details:not([open]) *"))return!0;if(!g||"full"===g||"legacy-full"===g){if("function"===typeof e){for(u=h;h;){var x=h.parentElement,w=na(h);if(x&&!x.shadowRoot&&!0===e(x))return sa(h);h=h.assignedSlot?h.assignedSlot:x||w===h.ownerDocument?x:w.host}h=u}e=h;var F;u=e&&na(e);x=null===(F=u)||void 0===F?void 0:F.host;F=!1;if(u&&u!==e){var N,R,ba;for(F=
!!(null!==(N=x)&&void 0!==N&&null!==(R=N.ownerDocument)&&void 0!==R&&R.contains(x)||null!==e&&void 0!==e&&null!==(ba=e.ownerDocument)&&void 0!==ba&&ba.contains(e));!F&&x;){var ha,ca,fa;u=na(x);x=null===(ha=u)||void 0===ha?void 0:ha.host;F=!(null===(ca=x)||void 0===ca||null===(fa=ca.ownerDocument)||void 0===fa||!fa.contains(x))}}if(F)return!h.getClientRects().length;if("legacy-full"!==g)return!0}else if("non-zero-area"===g)return sa(h);return!1},n=function(h,e){var g;(g=e.disabled||ka(e))||(g="INPUT"===
e.tagName&&"hidden"===e.type);if(!(h=g||va(e,h)||pa(e)))a:{if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(h=e.parentElement;h;){if("FIELDSET"===h.tagName&&h.disabled){for(g=0;g<h.children.length;g++){var u=h.children.item(g);if("LEGEND"===u.tagName){h=ea.call(h,"fieldset[disabled] *")?!0:!u.contains(e);break a}}h=!0;break a}h=h.parentElement}h=!1}return h?!1:!0},X=function(h,e){return"INPUT"===e.tagName&&"radio"===e.type&&!ra(e)||0>oa(e)||!n(h,e)?!1:!0},la=function(h){h=parseInt(h.getAttribute("tabindex"),
10);return isNaN(h)||0<=h?!0:!1},a=function g(e){var u=[],x=[];e.forEach(function(w,F){var N=!!w.scopeParent,R=N?w.scopeParent:w,ba=oa(R,N),ha=N?g(w.candidates):R;0===ba?N?u.push.apply(u,ha):u.push(R):x.push({documentOrder:F,tabIndex:ba,item:w,isScope:N,content:ha})});return x.sort(wa).reduce(function(w,F){F.isScope?w.push.apply(w,F.content):w.push(F.content);return w},[]).concat(u)},b=function(e,g){g=g||{};e=g.getShadowRoot?aa([e],g.includeContainer,{filter:X.bind(null,g),flatten:!1,getShadowRoot:g.getShadowRoot,
shadowRootFilter:la}):ma(e,g.includeContainer,X.bind(null,g));return a(e)},c=function(e,g){g=g||{};return g.getShadowRoot?aa([e],g.includeContainer,{filter:n.bind(null,g),flatten:!0,getShadowRoot:g.getShadowRoot}):ma(e,g.includeContainer,n.bind(null,g))},d=function(e,g){g=g||{};if(!e)throw Error("No node provided");return!1===ea.call(e,S)?!1:X(g,e)},f=B.concat("iframe").join(","),l=function(e,g){g=g||{};if(!e)throw Error("No node provided");return!1===ea.call(e,f)?!1:n(g,e)},q={activateTrap:function(e,
g){if(0<e.length){var u=e[e.length-1];u!==g&&u.pause()}u=e.indexOf(g);-1!==u&&e.splice(u,1);e.push(g)},deactivateTrap:function(e,g){g=e.indexOf(g);-1!==g&&e.splice(g,1);0<e.length&&e[e.length-1].unpause()}},A=function(e){return"Tab"===e.key||9===e.keyCode},k=function(e){return A(e)&&!e.shiftKey},p=function(e){return A(e)&&e.shiftKey},J=function(e,g){var u=-1;e.every(function(x,w){return g(x)?(u=w,!1):!0});return u},y=function(e){for(var g=arguments.length,u=Array(1<g?g-1:0),x=1;x<g;x++)u[x-1]=arguments[x];
return"function"===typeof e?e.apply(void 0,u):e},L=function(e){return e.target.shadowRoot&&"function"===typeof e.composedPath?e.composedPath()[0]:e.target},M=[],G=function(e,g){var u=(null===g||void 0===g?void 0:g.document)||document,x=(null===g||void 0===g?void 0:g.trapStack)||M,w=Y({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:k,isKeyBackward:p},g),F=[],N=[],R=[],ba=null,ha=null,ca=!1,fa=!1,xa=void 0,ta=function(T,m,v){return T&&void 0!==T[m]?T[m]:w[v||m]},ya=
function(T){return N.findIndex(function(m){var v=m.tabbableNodes;return m.container.contains(T)||v.find(function(P){return P===T})})},za=function(T){var m=w[T];if("function"===typeof m){for(var v=arguments.length,P=Array(1<v?v-1:0),U=1;U<v;U++)P[U-1]=arguments[U];m=m.apply(void 0,P)}!0===m&&(m=void 0);if(!m){if(void 0===m||!1===m)return m;throw Error("`".concat(T,"` was specified but was not a node, or did not return a node"));}v=m;if("string"===typeof m&&(v=u.querySelector(m),!v))throw Error("`".concat(T,
"` as selector refers to no known node"));return v},Ca=function(){var T=za("initialFocus");if(!1===T)return!1;void 0===T&&(T=0<=ya(u.activeElement)?u.activeElement:(T=R[0])&&T.firstTabbableNode||za("fallbackFocus"));if(!T)throw Error("Your focus-trap needs to have at least one focusable element");return T},Aa=function(){N=F.map(function(T){var m=b(T,w.tabbableOptions),v=c(T,w.tabbableOptions);return{container:T,tabbableNodes:m,focusableNodes:v,firstTabbableNode:0<m.length?m[0]:null,lastTabbableNode:0<
m.length?m[m.length-1]:null,nextTabbableNode:function(P){var U=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,ja=v.findIndex(function(ia){return ia===P});if(!(0>ja))return U?v.slice(ja+1).find(function(ia){return d(ia,w.tabbableOptions)}):v.slice(0,ja).reverse().find(function(ia){return d(ia,w.tabbableOptions)})}}});R=N.filter(function(T){return 0<T.tabbableNodes.length});if(0>=R.length&&!za("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");
},Ba=function v(m){!1!==m&&m!==u.activeElement&&(m&&m.focus?(m.focus({preventScroll:!!w.preventScroll}),ha=m,m.tagName&&"input"===m.tagName.toLowerCase()&&"function"===typeof m.select&&m.select()):v(Ca()))},Fa=function(m){var v=za("setReturnFocus",m);return v?v:!1===v?!1:m},Da=function(m){var v=L(m);0<=ya(v)||(y(w.clickOutsideDeactivates,m)?qa.deactivate({returnFocus:w.returnFocusOnDeactivate}):y(w.allowOutsideClick,m)||m.preventDefault())},Ga=function(m){var v=L(m),P=0<=ya(v);P||v instanceof Document?
P&&(ha=v):(m.stopImmediatePropagation(),Ba(ha||Ca()))},La=function(m){var v=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,P=L(m);Aa();var U=null;if(0<R.length){var ja=ya(P),ia=0<=ja?N[ja]:void 0;0>ja?U=v?R[R.length-1].lastTabbableNode:R[0].firstTabbableNode:v?(v=J(R,function(Ea){return P===Ea.firstTabbableNode}),0>v&&(ia.container===P||l(P,w.tabbableOptions)&&!d(P,w.tabbableOptions)&&!ia.nextTabbableNode(P,!1))&&(v=ja),0<=v?U=R[0===v?R.length-1:v-1].lastTabbableNode:A(m)||(U=ia.nextTabbableNode(P,
!1))):(v=J(R,function(Ea){return P===Ea.lastTabbableNode}),0>v&&(ia.container===P||l(P,w.tabbableOptions)&&!d(P,w.tabbableOptions)&&!ia.nextTabbableNode(P))&&(v=ja),0<=v?U=R[v===R.length-1?0:v+1].firstTabbableNode:A(m)||(U=ia.nextTabbableNode(P)))}else U=za("fallbackFocus");U&&(A(m)&&m.preventDefault(),Ba(U))},Ha=function(m){"Escape"!==m.key&&"Esc"!==m.key&&27!==m.keyCode||!1===y(w.escapeDeactivates,m)?(w.isKeyForward(m)||w.isKeyBackward(m))&&La(m,w.isKeyBackward(m)):(m.preventDefault(),qa.deactivate())},
Ia=function(m){var v=L(m);0<=ya(v)||y(w.clickOutsideDeactivates,m)||y(w.allowOutsideClick,m)||(m.preventDefault(),m.stopImmediatePropagation())},Ja=function(){if(ca)return q.activateTrap(x,qa),xa=w.delayInitialFocus?setTimeout(function(){Ba(Ca())},0):Ba(Ca()),u.addEventListener("focusin",Ga,!0),u.addEventListener("mousedown",Da,{capture:!0,passive:!1}),u.addEventListener("touchstart",Da,{capture:!0,passive:!1}),u.addEventListener("click",Ia,{capture:!0,passive:!1}),u.addEventListener("keydown",Ha,
{capture:!0,passive:!1}),qa},Ka=function(){if(ca)return u.removeEventListener("focusin",Ga,!0),u.removeEventListener("mousedown",Da,!0),u.removeEventListener("touchstart",Da,!0),u.removeEventListener("click",Ia,!0),u.removeEventListener("keydown",Ha,!0),qa};var qa={get active(){return ca},get paused(){return fa},activate:function(m){if(ca)return this;var v=ta(m,"onActivate"),P=ta(m,"onPostActivate"),U=ta(m,"checkCanFocusTrap");U||Aa();ca=!0;fa=!1;ba=u.activeElement;v&&v();m=function(){U&&Aa();Ja();
P&&P()};if(U)return U(F.concat()).then(m,m),this;m();return this},deactivate:function(m){if(!ca)return this;var v=Y({onDeactivate:w.onDeactivate,onPostDeactivate:w.onPostDeactivate,checkCanReturnFocus:w.checkCanReturnFocus},m);clearTimeout(xa);xa=void 0;Ka();fa=ca=!1;q.deactivateTrap(x,qa);var P=ta(v,"onDeactivate"),U=ta(v,"onPostDeactivate");m=ta(v,"checkCanReturnFocus");var ja=ta(v,"returnFocus","returnFocusOnDeactivate");P&&P();v=function(){setTimeout(function(){ja&&Ba(Fa(ba));U&&U()},0)};if(ja&&
m)return m(Fa(ba)).then(v,v),this;v();return this},pause:function(){if(fa||!ca)return this;fa=!0;Ka();return this},unpause:function(){if(!fa||!ca)return this;fa=!1;Aa();Ja();return this},updateContainerElements:function(m){F=[].concat(m).filter(Boolean).map(function(v){return"string"===typeof v?u.querySelector(v):v});ca&&Aa();return this}};qa.updateContainerElements(e);return qa};V=function(e){function g(x,w){var F=u.call(this,x,w);F.container=document.createElement("div");F.content=null;F.open=!1;
F._focusTrap=null;F._close=()=>{F.open=!1};document.body.appendChild(F.container);F.addHandles(D.watch(()=>F.open,()=>F._toggleFocusTrap()));return F}C._inherits(g,e);var u=C._createSuper(g);e=g.prototype;e.destroy=function(){this._destroyFocusTrap()};e.render=function(){var x=this.id;const {open:w,content:F,title:N,messages:R}=this;var ba=w&&!!F;const ha={["esri-identity-modal--open"]:ba,["esri-identity-modal--closed"]:!ba},ca=E.tsx("button",{class:"esri-identity-modal__close-button","aria-label":R.close,
title:R.close,bind:this,onclick:this._close,type:"button"},E.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})),fa=`${x}_title`;x=`${x}_content`;const xa=N?E.tsx("h1",{id:fa,class:"esri-identity-modal__title"},N):null;ba=ba?E.tsx("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":fa,"aria-describedby":x,afterCreate:this._createFocusTrap},ca,xa,this._renderContent(x)):null;return E.tsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",ha)},ba)};
e._destroyFocusTrap=function(){this._focusTrap?.deactivate({onDeactivate:()=>{}});this._focusTrap=null};e._toggleFocusTrap=function(){const {_focusTrap:x,open:w}=this;x&&(w?x.activate():x.deactivate())};e._createFocusTrap=function(x){this._destroyFocusTrap();const w=requestAnimationFrame(()=>{this._focusTrap=G(x,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()});this.addHandles(r.makeHandle(()=>cancelAnimationFrame(w)))};e._renderContent=function(x){const w=this.content;return"string"===
typeof w?E.tsx("div",{class:"esri-identity-modal__content",id:x,innerHTML:w}):da.isWidget(w)?E.tsx("div",{class:"esri-identity-modal__content",id:x},w.render()):w instanceof HTMLElement?E.tsx("div",{class:"esri-identity-modal__content",id:x,bind:w,afterCreate:this._attachToNode}):null};e._attachToNode=function(x){x.appendChild(this)};C._createClass(g,[{key:"title",get:function(){return this.messages?.auth.signIn}}]);return g}(V);z.__decorate([t.property({readOnly:!0})],V.prototype,"container",void 0);
z.__decorate([t.property()],V.prototype,"content",void 0);z.__decorate([t.property()],V.prototype,"open",void 0);z.__decorate([t.property(),O.messageBundle("esri/t9n/common")],V.prototype,"messages",void 0);z.__decorate([t.property()],V.prototype,"title",null);return V=z.__decorate([Z.subclass("esri.identity.IdentityModal")],V)})},"esri/identity/OAuthCredential":function(){define(["../chunks/_rollupPluginBabelHelpers"],function(C){let z=function(){function r(t,B){this.userId=this.token=this.stateUID=
this.ssl=this.refreshToken=this.expires=this.codeVerifier=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=t;this.storage=B;this._init()}var D=r.prototype;D.isValid=function(){let t=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token))if(null==this.expires&&this.refreshToken)t=!0;else if(this.expires){const B=Date.now();this.expires>B&&(this.expires-B)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}return t};D.save=function(){if(!this.storage)return!1;const t=this._load(),
B=this.oAuthInfo;if(B&&B.authNamespace&&B.portalUrl){let K=t[B.authNamespace];K||(K=t[B.authNamespace]={});this.appId||(this.appId=B.appId);K[B.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(t))}catch(W){return console.warn(W),!1}return!0}return!1};D.destroy=function(){const t=this._load(),B=this.oAuthInfo;
if(B&&B.appId&&B.portalUrl&&(null==this.expires||this.expires>Date.now())&&(this.refreshToken||this.token)){var K=B.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const W=new FormData;W.append("f","json");W.append("auth_token",this.refreshToken||this.token);W.append("client_id",B.appId);W.append("token_type_hint",this.refreshToken?"refresh_token":"access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(K,W);else{const Z=new XMLHttpRequest;Z.open("POST",
K);Z.send(W)}}if(B&&B.authNamespace&&B.portalUrl&&this.storage&&(K=t[B.authNamespace])){delete K[B.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(t))}catch(W){console.log(W)}}B&&(this.oAuthInfo=B._oAuthCred=null)};D._init=function(){var t=this._load();const B=this.oAuthInfo;B&&B.authNamespace&&B.portalUrl&&(t=t[B.authNamespace])&&(t=t[B.portalUrl])&&(this.appId=t.appId,this.codeVerifier=t.codeVerifier,this.expires=t.expires,this.refreshToken=t.refreshToken,this.ssl=t.ssl,this.stateUID=
t.stateUID,this.token=t.token,this.userId=t.userId)};D._load=function(){let t={};if(this.storage){const B=this.storage.getItem("esriJSAPIOAuth");if(B)try{t=JSON.parse(B)}catch(K){console.warn(K)}}return t};return C._createClass(r)}();z.prototype.declaredClass="esri.identity.OAuthCredential";return z})},"esri/identity/OAuthInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(C,z,r,D,t,B,K,W){var Z;r=Z=function(V){function da(O){O=E.call(this,O);O._oAuthCred=null;O.appId=null;O.authNamespace="/";O.expiration=20160;O.flowType="auto";O.forceLogin=!1;O.forceUserId=!1;O.locale=null;O.minTimeUntilExpiration=30;O.popup=!1;O.popupCallbackUrl="oauth-callback.html";O.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";O.portalUrl="https://www.arcgis.com";O.preserveUrlHash=!1;O.userId=null;return O}C._inherits(da,V);var E=C._createSuper(da);da.prototype.clone=
function(){return Z.fromJSON(this.toJSON())};return C._createClass(da)}(r.JSONSupport);z.__decorate([D.property({json:{write:!0}})],r.prototype,"appId",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"authNamespace",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"expiration",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"flowType",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"forceLogin",void 0);z.__decorate([D.property({json:{write:!0}})],
r.prototype,"forceUserId",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"locale",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"minTimeUntilExpiration",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"popup",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"popupCallbackUrl",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"popupWindowFeatures",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"portalUrl",
void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"preserveUrlHash",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"userId",void 0);return r=Z=z.__decorate([W.subclass("esri.identity.OAuthInfo")],r)})},"esri/identity/ServerInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(C,z,r,D,t,B,K,W){r=function(Z){function V(E){E=da.call(this,E);E.adminTokenServiceUrl=null;E.currentVersion=null;E.hasPortal=null;E.hasServer=null;E.owningSystemUrl=null;E.owningTenant=null;E.server=null;E.shortLivedTokenValidity=null;E.tokenServiceUrl=null;E.webTierAuth=null;return E}C._inherits(V,Z);var da=C._createSuper(V);return C._createClass(V)}(r.JSONSupport);z.__decorate([D.property({json:{write:!0}})],r.prototype,"adminTokenServiceUrl",void 0);z.__decorate([D.property({json:{write:!0}})],
r.prototype,"currentVersion",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"hasPortal",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"hasServer",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"owningSystemUrl",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"owningTenant",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"server",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"shortLivedTokenValidity",
void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"tokenServiceUrl",void 0);z.__decorate([D.property({json:{write:!0}})],r.prototype,"webTierAuth",void 0);return r=z.__decorate([W.subclass("esri.identity.ServerInfo")],r)})},"*noref":1}});
define(["../chunks/_rollupPluginBabelHelpers","../kernel","./IdentityManagerBase"],function(C,z,r){r=function(D){function t(){return B.apply(this,arguments)}C._inherits(t,D);var B=C._createSuper(t);return C._createClass(t)}(r.IdentityManagerBase);r.prototype.declaredClass="esri.identity.IdentityManager";r=new r;z.setId(r);return r});