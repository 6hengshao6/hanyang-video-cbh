// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(n,m,e,u,v,w,x,g,I,J,K,p,y,z,A,
q){n.ArcGISMapService=c=>{c=function(h){function k(){var a=B.apply(this,arguments);a.capabilities=void 0;a.copyright=null;a.fullExtent=null;a.legendEnabled=!0;a.spatialReference=null;a.version=void 0;a._allLayersAndTablesPromise=null;a._allLayersAndTablesMap=null;return a}m._inherits(k,h);var B=m._createSuper(k);h=k.prototype;h.readCapabilities=function(a,b){var d=b.capabilities&&b.capabilities.split(",").map(C=>C.toLowerCase().trim());if(!d)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,
supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var f=this.type;a="tile"!==f&&!!b.supportsDynamicLayers;const D=d.includes("query"),r=d.includes("map"),t=!!b.exportTilesAllowed,E=d.includes("tilemap");d=d.includes("data");const F="tile"!==f&&(!b.tileInfo||a),G="tile"!==f&&(!b.tileInfo||a);f="tile"!==f;var l=b.cimVersion&&x.Version.parse(b.cimVersion);const H=l?.since(1,4)??!1;l=l?.since(2,0)??!1;return{operations:{supportsExportMap:r,supportsExportTiles:t,
supportsIdentify:D,supportsQuery:d,supportsTileMap:E},exportMap:r?{supportsArcadeExpressionForLabeling:H,supportsSublayersChanges:f,supportsDynamicLayers:a,supportsSublayerVisibility:F,supportsSublayerDefinitionExpression:G,supportsCIMSymbols:l}:null,exportTiles:t?{maxExportTilesCount:+b.maxExportTilesCount}:null}};h.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};h.fetchSublayerInfo=
async function(a,b){try{return await this.fetchAllLayersAndTables(b),this._allLayersAndTablesMap?.get(a)}catch{}};h.fetchAllLayersAndTables=async function(a){await this.load(a);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=u(w.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(d=>{this._allLayersAndTablesMap=new Map;for(const f of d.data.layers)this._allLayersAndTablesMap.set(f.id,f);return{result:d.data}},
d=>({error:d})));const b=await this._allLayersAndTablesPromise;v.throwIfAborted(a);if("result"in b)return b.result;throw b.error;};return m._createClass(k)}(c);e.__decorate([g.property({readOnly:!0})],c.prototype,"capabilities",void 0);e.__decorate([p.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],c.prototype,"readCapabilities",null);e.__decorate([g.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",
void 0);e.__decorate([g.property({type:z})],c.prototype,"fullExtent",void 0);e.__decorate([g.property(q.id)],c.prototype,"id",void 0);e.__decorate([g.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],c.prototype,"legendEnabled",void 0);e.__decorate([g.property(q.popupEnabled)],c.prototype,"popupEnabled",void 0);e.__decorate([g.property({type:A})],c.prototype,"spatialReference",void 0);e.__decorate([g.property({readOnly:!0})],
c.prototype,"version",void 0);e.__decorate([p.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],c.prototype,"readVersion",null);return c=e.__decorate([y.subclass("esri.layers.mixins.ArcGISMapService")],c)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});