// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),function(B,l,C,p,D,E,F,m,G,n,k,u,q){async function y(a,b,e){if(!a)return null;var {where:c}=a;a.where=c=c&&c.trim();if(!c||/^1 *= *1$/.test(c)||
b&&b===c)a.where=null;if(!a.geometry)return a;b=await H(a);a.distance=0;a.units=null;"esriSpatialRelEnvelopeIntersects"===a.spatialRel&&({spatialReference:c}=a.geometry,b=F.getGeometryExtent(b),b.spatialReference=c);if(b){await q.checkProjectionSupport(b.spatialReference,e);c=b.spatialReference;b=z(b,e)&&m.isExtent(b)?{spatialReference:c,rings:[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]]}:b;c=(await G.normalizeCentralMeridian(m.fromJSON(b)))[0];if(p.isNone(c))throw v;
const f="quantizationParameters"in a&&a.quantizationParameters?.tolerance||"maxAllowableOffset"in a&&a.maxAllowableOffset||0;b=f&&z(b,e)?{densificationStep:8*f}:void 0;c=c.toJSON();b=await q.project(c,c.spatialReference,e,b);if(!b)throw v;b.spatialReference=e;a.geometry=b}return a}function z(a,b){if(!a)return!1;const e=a.spatialReference;return(m.isExtent(a)||m.isPolygon(a)||m.isPolyline(a))&&!n.equals(e,b)&&!E.canProjectWithoutEngine(e,b)}async function H(a){const {distance:b,units:e}=a,c=a.geometry;
if(null==b||"vertexAttributes"in c)return c;var f=c.spatialReference;a=e?I.fromJSON(e):D.getUnitString(f);f=f&&(n.isGeographic(f)||n.isWebMercator(f))?c:await q.checkProjectionSupport(f,n.WGS84).then(()=>q.project(c,n.WGS84));return(await J())(f.spatialReference,f,b,a)}async function J(){return(await new Promise((a,b)=>B(["../../../geometry/geometryEngineJSON"],a,b))).geodesicBuffer}const I=new C.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",
esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),v=Object.freeze({}),A=new u,K=new u,w=new u,x={esriGeometryPoint:k.convertToPoint,esriGeometryPolyline:k.convertToPolyline,esriGeometryPolygon:k.convertToPolygon,esriGeometryMultipoint:k.convertToMultipoint},L=(a,b)=>"_geVersion"!==a?b:void 0;l.QUERY_ENGINE_EMPTY_RESULT=v;l.cleanFromGeometryEngine=function(a){return a&&"_geVersion"in a?JSON.parse(JSON.stringify(a,L)):a};l.getGeometry=function(a,b,e,c,f,g,h=b,
d=e){const r=b&&h,t=e&&d;c=p.isSome(c)?"coords"in c?c:c.geometry:null;if(p.isNone(c))return null;if(f)return b=k.generalizeOptimizedGeometry(K,c,b,e,a,f,h,d),g&&(b=k.quantizeOptimizedGeometry(w,b,r,t,a,g)),x[a]?.(b,r,t)??null;if(g)return g=k.quantizeOptimizedGeometry(w,c,b,e,a,g,h,d),x[a]?.(g,r,t)??null;k.removeZMValues(A,c,b,e,h,d);return x[a]?.(A,r,t)??null};l.normalizeQuery=async function(a,b,e){const {outFields:c,orderByFields:f,groupByFieldsForStatistics:g,outStatistics:h}=a;if(c)for(var d=0;d<
c.length;d++)c[d]=c[d].trim();if(f)for(d=0;d<f.length;d++)f[d]=f[d].trim();if(g)for(d=0;d<g.length;d++)g[d]=g[d].trim();if(h)for(d=0;d<h.length;d++)h[d].onStatisticField&&(h[d].onStatisticField=h[d].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return y(a,b,e)};l.normalizeQueryLike=y;l.transformCentroid=function(a,b,e,c=a.hasZ,f=a.hasM){if(p.isNone(b))return null;const g=a.hasZ&&c,h=a.hasM&&f;return e?(a=k.quantizeOptimizedGeometry(w,b,a.hasZ,a.hasM,"esriGeometryPoint",
e,c,f),k.convertToPoint(a,g,h)):k.convertToPoint(b,g,h)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});