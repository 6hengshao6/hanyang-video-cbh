// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/CollectionFlattener ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/lazyLayerLoader ../support/collectionUtils ../support/LayersMixin ../support/TablesMixin ../webdoc/support/writeUtils".split(" "),
function(n,e,q,r,t,c,p,f,I,J,K,u,v,w,x,y,z,A,B,C,D,E,F,G){c=function(d){function m(a){var b=H.call(this,a);b.allLayers=new q({getCollections:()=>[b.layers],getChildrenFunction:g=>"layers"in g?g.layers:null});b.allTables=D.createFlattenedTablesCollection(n._assertThisInitialized(b));b.fullExtent=void 0;b.operationalLayerType="GroupLayer";b.spatialReference=void 0;b.type="group";return b}n._inherits(m,d);var H=n._createSuper(m);d=m.prototype;d.initialize=function(){this._enforceVisibility(this.visibilityMode,
this.visible);this.addHandles(p.watch(()=>this.visible,this._onVisibilityChange.bind(this),p.sync))};d.destroy=function(){this.allLayers.destroy();this.allTables.destroy()};d._writeLayers=function(a,b,g,h){const k=[];if(!a)return k;a.forEach(l=>{l=G.getLayerJSON(l,h.webmap?h.webmap.getLayerJSONFromResourceInfo(l):null,h);t.isSome(l)&&l.layerType&&k.push(l)});b.layers=k};d.load=function(a){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"],
layerModuleTypeMap:C.layerLookupMap},a));return Promise.resolve(this)};d.loadAll=async function(){return r.loadAll(this,a=>{a(this.layers,this.tables)})};d.layerAdded=function(a){a.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(a):"inherited"===this.visibilityMode&&(a.visible=this.visible);this.hasHandles(a.uid)?console.error(`Layer readded to Grouplayer: uid=${a.uid}`):this.addHandles(p.watch(()=>a.visible,b=>this._onChildVisibilityChange(a,b),p.sync),a.uid)};d.layerRemoved=
function(a){this.removeHandles(a.uid);this._enforceVisibility(this.visibilityMode,this.visible)};d._turnOffOtherLayers=function(a){this.layers.forEach(b=>{b!==a&&(b.visible=!1)})};d._enforceVisibility=function(a,b){if(u.getProperties(this).initialized){var g=this.layers,h=g.find(k=>k.visible);switch(a){case "exclusive":g.length&&!h&&(h=g.getItemAt(0),h.visible=!0);this._turnOffOtherLayers(h);break;case "inherited":g.forEach(k=>{k.visible=b})}}};d._onVisibilityChange=function(a){"inherited"===this.visibilityMode&&
this.layers.forEach(b=>{b.visible=a})};d._onChildVisibilityChange=function(a,b){switch(this.visibilityMode){case "exclusive":b?this._turnOffOtherLayers(a):this._isAnyLayerVisible()||(a.visible=!0);break;case "inherited":a.visible=this.visible}};d._isAnyLayerVisible=function(){return this.layers.some(a=>a.visible)};n._createClass(m,[{key:"portalItem",set:function(a){this._set("portalItem",a)}},{key:"visibilityMode",set:function(a){const b=this._get("visibilityMode")!==a;this._set("visibilityMode",
a);b&&this._enforceVisibility(a,this.visible)}}]);return m}(y.BlendLayer(B.ScaleRangeLayer(z.OperationalLayer(A.PortalLayer(F.TablesMixin(E.LayersMixin(c.MultiOriginJSONMixin(x))))))));e.__decorate([f.property({readOnly:!0,dependsOn:[]})],c.prototype,"allLayers",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"allTables",void 0);e.__decorate([f.property()],c.prototype,"fullExtent",void 0);e.__decorate([f.property({json:{read:!0,write:!0}})],c.prototype,"blendMode",void 0);e.__decorate([f.property({json:{read:!1,
write:{ignoreOrigin:!0}}})],c.prototype,"layers",void 0);e.__decorate([w.writer("layers")],c.prototype,"_writeLayers",null);e.__decorate([f.property({type:["GroupLayer"]})],c.prototype,"operationalLayerType",void 0);e.__decorate([f.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],c.prototype,"portalItem",null);e.__decorate([f.property()],c.prototype,"spatialReference",void 0);e.__decorate([f.property({json:{read:!1},readOnly:!0,value:"group"})],c.prototype,"type",void 0);e.__decorate([f.property({type:["independent",
"inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{read:!1,write:!1}}}})],c.prototype,"visibilityMode",null);return c=e.__decorate([v.subclass("esri.layers.GroupLayer")],c)});