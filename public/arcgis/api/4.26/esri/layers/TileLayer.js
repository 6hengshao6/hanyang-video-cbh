// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(y,l,c,g,m,H,v,
w,p,O,u,I,K){y.ArcGISCachedService=G=>{G=function(B){function P(){var S=L.apply(this,arguments);S.copyright=null;S.minScale=0;S.maxScale=0;S.spatialReference=null;S.tileInfo=null;S.tilemapCache=null;return S}l._inherits(P,B);var L=l._createSuper(P);B=P.prototype;B.readMinScale=function(S,A){return null!=A.minLOD&&null!=A.maxLOD?S:0};B.readMaxScale=function(S,A){return null!=A.minLOD&&null!=A.maxLOD?S:0};B.readTilemapCache=function(S,A){return A.capabilities&&A.capabilities.includes("Tilemap")?new I.TilemapCache({layer:this}):
null};B.destroy=function(){this.tilemapCache?.destroy()};l._createClass(P,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return P}(G);c.__decorate([m.property({json:{read:{source:"copyrightText"}}})],G.prototype,"copyright",void 0);c.__decorate([m.property()],G.prototype,"minScale",void 0);c.__decorate([p.reader("service","minScale")],G.prototype,"readMinScale",null);c.__decorate([m.property()],G.prototype,"maxScale",void 0);c.__decorate([p.reader("service","maxScale")],G.prototype,
"readMaxScale",null);c.__decorate([m.property({type:K})],G.prototype,"spatialReference",void 0);c.__decorate([m.property({readOnly:!0})],G.prototype,"supportsBlankTile",null);c.__decorate([m.property(u.serviceTileInfoProperty)],G.prototype,"tileInfo",void 0);c.__decorate([m.property()],G.prototype,"tilemapCache",void 0);c.__decorate([p.reader("service","tilemapCache",["capabilities"])],G.prototype,"readTilemapCache",null);c.__decorate([m.property()],G.prototype,"version",void 0);return G=c.__decorate([O.subclass("esri.layers.mixins.ArcGISCachedService")],
G)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(y,l){function c(m,H,v,w){if(!m)return null;const {minScale:p,maxScale:O,minLOD:u,maxLOD:I}=H;if(null!=u&&null!=I)return w&&w.ignoreMinMaxLOD?l.fromJSON(m):l.fromJSON({...m,lods:m.lods.filter(({level:K})=>null!=K&&K>=u&&K<=I)});if(0!==p&&0!==O){const K=p?Math.round(1E4*p)/1E4:Infinity,G=O?Math.round(1E4*O)/1E4:-Infinity;return l.fromJSON({...m,
lods:m.lods.filter(B=>{B=Math.round(1E4*B.scale)/1E4;return B<=K&&B>=G})})}return l.fromJSON(m)}const g={type:l,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:c}}}}};y.readServiceTileInfo=c;y.serviceTileInfoProperty=g;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(y,l,c,g,m,H,v,w,p,O,u,I,K,G,B,P,L,S,A,da){var F;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});g=F=function(r){function D(d){d=E.call(this,d);d.dpi=96;d.format=null;d.origin=null;d.minScale=0;d.maxScale=0;d.size=null;d.spatialReference=null;return d}y._inherits(D,r);var E=y._createSuper(D);
D.create=function(d={}){const {resolutionFactor:e=1,scales:b,size:h=256,spatialReference:t=B.WebMercator,numLODs:k=24}=d;if(!L.isValid(t)){d=[];if(b)for(var x=0;x<b.length;x++){var Q=b[x];d.push(new A({level:x,scale:Q,resolution:Q}))}else for(x=5E-4,Q=k-1;0<=Q;Q--)d.unshift(new A({level:Q,scale:x,resolution:x})),x*=2;return new F({dpi:96,lods:d,origin:new G(0,0,t),size:[h,h],spatialReference:t})}x=L.getInfo(t);d=d.origin?new G({x:d.origin.x,y:d.origin.y,spatialReference:t}):x?new G({x:x.origin[0],
y:x.origin[1],spatialReference:t}):new G({x:0,y:0,spatialReference:t});x=1/(39.37*H.getMetersPerUnitForSR(t)*96);Q=[];if(b)for(var V=0;V<b.length;V++){var R=b[V];Q.push(new A({level:V,scale:R,resolution:R*x}))}else{var U=L.isGeographic(t)?512/h*5.916575275917094E8:256/h*5.91657527591555E8;V=Math.ceil(k/e);Q.push(new A({level:0,scale:U,resolution:U*x}));for(R=1;R<V;R++)U/=2**e,Q.push(new A({level:R,scale:U,resolution:U*x}))}return new F({dpi:96,lods:Q,origin:d,size:[h,h],spatialReference:t})};r=D.prototype;
r.readOrigin=function(d,e){return G.fromJSON({spatialReference:e.spatialReference,...d})};r.readSize=function(d,e){return[e.cols,e.rows]};r.writeSize=function(d,e){e.cols=d[0];e.rows=d[1]};r.zoomToScale=function(d){const e=this.scales;if(0>=d)return e[0];if(d>=e.length-1)return e[e.length-1];const b=Math.floor(d);return e[b]/(e[b]/e[b+1])**(d-b)};r.scaleToZoom=function(d){const e=this.scales,b=e.length-1;let h=0;for(;h<b;h++){const t=e[h],k=e[h+1];if(t<=d)break;if(k===d)return h+1;if(t>d&&k<d)return h+
Math.log(t/d)/Math.log(t/k)}return h};r.snapScale=function(d,e=.95){d=this.scaleToZoom(d);return d%Math.floor(d)>=e?this.zoomToScale(Math.ceil(d)):this.zoomToScale(Math.floor(d))};r.tileAt=function(d,e,b,h){var t=this.lodAt(d);if(!t)return null;let k;if("number"===typeof e)k=e,e=b;else{if(L.equals(e.spatialReference,this.spatialReference))k=e.x,e=e.y;else{h=S.project(e,this.spatialReference);if(m.isNone(h))return null;k=h.x;e=h.y}h=b}b=t.resolution*this.size[0];t=t.resolution*this.size[1];h||(h=new da.TileKey(null,
0,0,0,P.create()));h.level=d;h.row=Math.floor((this.origin.y-e)/t+.001);h.col=Math.floor((k-this.origin.x)/b+.001);this.updateTileInfo(h);return h};r.updateTileInfo=function(d,e=F.ExtrapolateOptions.NONE){var b=this.lodAt(d.level);b||e!==F.ExtrapolateOptions.POWER_OF_TWO||(e=this.lods[this.lods.length-1],e.level<d.level&&(b=e));if(b){var h=d.level-b.level;e=b.resolution*this.size[0]/2**h;b=b.resolution*this.size[1]/2**h;d.id=`${d.level}/${d.row}/${d.col}`;d.extent||(d.extent=P.create());d.extent[0]=
this.origin.x+d.col*e;d.extent[1]=this.origin.y-(d.row+1)*b;d.extent[2]=d.extent[0]+e;d.extent[3]=d.extent[1]+b}};r.upsampleTile=function(d){const e=this._upsampleLevels[d.level];if(!e||-1===e.parentLevel)return!1;d.level=e.parentLevel;d.row=Math.floor(d.row/e.factor+.001);d.col=Math.floor(d.col/e.factor+.001);this.updateTileInfo(d);return!0};r.getTileBounds=function(d,e){var b=this.lodAt(e.level);if(null==b)return null;var {resolution:h}=b;b=h*this.size[0];h*=this.size[1];d[0]=this.origin.x+e.col*
b;d[1]=this.origin.y-(e.row+1)*h;d[2]=d[0]+b;d[3]=d[1]+h;return d};r.lodAt=function(d){return this._levelToLOD?.[d]??null};r.clone=function(){return F.fromJSON(this.write({}))};r.getOrCreateCompatible=function(d,e){if(256===this.size[0]&&256===this.size[1])return 256===d?this:null;const b=[],h=this.lods.length;for(let t=0;t<h;t++){const k=this.lods[t];b.push(new A({level:k.level,scale:k.scale,resolution:k.resolution*e}))}return new F({size:[d,d],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,
origin:this.origin,spatialReference:this.spatialReference,lods:b})};r._initializeUpsampleLevels=function(){const d=this.lods;this._upsampleLevels=[];let e=null;for(let b=0;b<d.length;b++){const h=d[b];this._upsampleLevels[h.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/h.resolution:0};e=h}};y._createClass(D,[{key:"isWrappable",get:function(){const {spatialReference:d,origin:e}=this;if(d&&e){const b=L.getInfo(d);return d.isWrappable&&!!b&&Math.abs(b.origin[0]-e.x)<=b.dx}return!1}},{key:"lods",
set:function(d){let e=0,b=0;const h=[],t=this._levelToLOD={};d&&(e=-Infinity,b=Infinity,d.forEach(k=>{h.push(k.scale);e=k.scale>e?k.scale:e;b=k.scale<b?k.scale:b;t[k.level]=k}));this._set("scales",h);this._set("minScale",e);this._set("maxScale",b);this._set("lods",d);this._initializeUpsampleLevels()}}]);return D}(g.JSONSupport);l.__decorate([v.property({type:Number,json:{write:!0}})],g.prototype,"compressionQuality",void 0);l.__decorate([v.property({type:Number,json:{write:!0}})],g.prototype,"dpi",
void 0);l.__decorate([v.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,write:!1}}}})],g.prototype,"format",void 0);l.__decorate([v.property({readOnly:!0})],g.prototype,"isWrappable",null);l.__decorate([v.property({type:G,json:{write:!0}})],g.prototype,"origin",void 0);l.__decorate([u.reader("origin")],g.prototype,"readOrigin",null);l.__decorate([v.property({type:[A],value:null,json:{write:!0}})],g.prototype,"lods",null);l.__decorate([v.property({readOnly:!0})],
g.prototype,"minScale",void 0);l.__decorate([v.property({readOnly:!0})],g.prototype,"maxScale",void 0);l.__decorate([v.property({readOnly:!0})],g.prototype,"scales",void 0);l.__decorate([v.property({cast:r=>Array.isArray(r)?r:"number"===typeof r?[r,r]:[256,256]})],g.prototype,"size",void 0);l.__decorate([u.reader("size",["rows","cols"])],g.prototype,"readSize",null);l.__decorate([K.writer("size",{cols:{type:w.Integer},rows:{type:w.Integer}})],g.prototype,"writeSize",null);l.__decorate([v.property({type:B,
json:{write:!0}})],g.prototype,"spatialReference",void 0);g=F=l.__decorate([I.subclass("esri.layers.support.TileInfo")],g);(function(r){r=r.ExtrapolateOptions||(r.ExtrapolateOptions={});r[r.NONE=0]="NONE";r[r.POWER_OF_TWO=1]="POWER_OF_TWO"})(g||(g={}));return g})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(y,l,c,g,m,H,v,w){var p;c=p=function(O){function u(K){K=I.call(this,K);K.cols=null;K.level=0;K.levelValue=null;K.origin=null;K.resolution=0;K.rows=null;K.scale=0;return K}y._inherits(u,O);var I=y._createSuper(u);u.prototype.clone=function(){return new p({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return y._createClass(u)}(c.JSONSupport);l.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},
"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);l.__decorate([g.property({type:m.Integer,json:{write:!0}})],c.prototype,"level",void 0);l.__decorate([g.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);l.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);l.__decorate([g.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);l.__decorate([g.property({json:{write:!0,
origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0);l.__decorate([g.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=p=l.__decorate([w.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TileKey":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(y,l){l=l._createClass(function(c,g,m,H,v){this.id=c;this.level=g;this.row=m;this.col=H;this.extent=v});y.TileKey=l;Object.defineProperty(y,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/byteSizeEstimations ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./TileKey ./Tilemap".split(" "),
function(y,l,c,g,m,H,v,w,p,O,u,I,K,G,B,P,L,S,A,da,F,r){var D;y.TilemapCache=D=function(E){function d(b){b=e.call(this,b);b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2*H.ByteSizeUnit.MEGABYTES;b.request=g;b._prefetchingEnabled=!0;return b}l._inherits(d,E);var e=l._createSuper(d);E=d.prototype;E.initialize=function(){this._tilemapCache=new O(this.cacheByteSize);this.addHandles([K.watch(()=>{const {layer:b}=this;return[b?.parsedUrl,b?.tileServers,b?.apiKey,b?.customParameters]},
()=>this._initializeTilemapDefinition()),K.watch(()=>this.layer?.tileInfo?.lods,b=>this._initializeAvailableLevels(b),K.syncAndInitial)]);this._initializeTilemapDefinition()};E.castLevels=function(b){return 2>=b?(p.getLogger(this.declaredClass).error("Minimum levels for Tilemap is 3, but got ",b),3):b};E.fetchTilemap=function(b,h,t,k){if(!this._availableLevels[b])return Promise.reject(new v("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));const x=this._tmpTilemapDefinition;
if(b=this._tilemapFromCache(b,h,t,x))return Promise.resolve(b);const Q=k&&k.signal;k={...k,signal:null};return new Promise((V,R)=>{I.onAbort(Q,()=>R(I.createAbortError()));const U=r.tilemapDefinitionId(x);let C=this._pendingTilemapRequests[U];if(!C){C=r.Tilemap.fromDefinition(x,k).then(ea=>{this._tilemapCache.put(U,ea,ea.byteSize);return ea});const T=()=>delete this._pendingTilemapRequests[U];this._pendingTilemapRequests[U]=C;C.then(T,T)}C.then(V,R)})};E.getAvailability=function(b,h,t){return this._availableLevels[b]?
(b=this._tilemapFromCache(b,h,t,this._tmpTilemapDefinition))?b.getAvailability(h,t):"unknown":"unavailable"};E.fetchAvailability=function(b,h,t,k){return this._availableLevels[b]?this.fetchTilemap(b,h,t,k).catch(x=>x).then(x=>{if(x instanceof r.Tilemap){x=x.getAvailability(h,t);if("unavailable"===x)throw new v("tile-map:tile-unavailable","Tile is not available",{level:b,row:h,col:t});return x}if(I.isAbortError(x))throw x;return"unknown"}):Promise.reject(new v("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`))};
E.fetchAvailabilityUpsample=function(b,h,t,k,x){k.level=b;k.row=h;k.col=t;const Q=this.layer.tileInfo;Q.updateTileInfo(k);const V=this.fetchAvailability(b,h,t,x).catch(R=>{if(I.isAbortError(R))throw R;if(Q.upsampleTile(k))return this.fetchAvailabilityUpsample(k.level,k.row,k.col,k);throw R;});this._fetchAvailabilityUpsamplePrefetch(k.id,b,h,t,x,V);return V};E._fetchAvailabilityUpsamplePrefetch=async function(b,h,t,k,x,Q){if(this._prefetchingEnabled&&null!=b){var V=`prefetch-${b}`;if(!this.handles.has(V)){var R=
new AbortController;Q.then(()=>R.abort(),()=>R.abort());var U=!1;this.handles.add({remove(){U||(U=!0,R.abort())}},V);await G.waitTicks(10,R.signal).catch(()=>{});U||(U=!0,this.handles.remove(V));if(!I.isAborted(R))for(b=new F.TileKey(b,h,t,k),x={...x,signal:R.signal},h=this.layer.tileInfo,t=0;D._prefetches.length<D._maxPrefetch&&h.upsampleTile(b);++t){const C=this.fetchAvailability(b.level,b.row,b.col,x);D._prefetches.push(C);k=()=>{D._prefetches.removeUnordered(C)};C.then(k,k)}}}};E._initializeTilemapDefinition=
function(){if(this.layer.parsedUrl){var {parsedUrl:b,apiKey:h,customParameters:t}=this.layer;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:b.path,query:B.objectToQuery({...b.query,...t,token:h??b.query?.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};E._tilemapFromCache=function(b,h,t,k){k.level=b;k.row=h-h%this.size;k.col=t-t%this.size;b=r.tilemapDefinitionId(k);return this._tilemapCache.get(b)};
E._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(h=>this._availableLevels[h.level]=!0)};l._createClass(d,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(h){b._prefetchingEnabled=h},hasTilemap(h,t,k){return!!b._tilemapFromCache(h,t,k,b._tmpTilemapDefinition)}}}}]);return d}(w.HandleOwnerMixin(m));y.TilemapCache._maxPrefetch=4;y.TilemapCache._prefetches=
new u({initialSize:D._maxPrefetch});c.__decorate([P.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"levels",void 0);c.__decorate([L.cast("levels")],y.TilemapCache.prototype,"castLevels",null);c.__decorate([P.property({readOnly:!0,type:Number})],y.TilemapCache.prototype,"size",null);c.__decorate([P.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"cacheByteSize",void 0);c.__decorate([P.property({constructOnly:!0})],y.TilemapCache.prototype,"layer",void 0);c.__decorate([P.property({constructOnly:!0})],
y.TilemapCache.prototype,"request",void 0);y.TilemapCache=D=c.__decorate([da.subclass("esri.layers.support.TilemapCache")],y.TilemapCache);Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Tilemap":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(y,l,c,g,m,H){function v(p){if("vector-tile"===p.service.type)var O=`${p.service.url}/tilemap/${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`;
else O=p.service.tileServers,O=`${O&&O.length?O[p.row%O.length]:p.service.url}/tilemap/${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`;(p=p.service.query)&&(O=`${O}?${p}`);return O}let w=function(){function p(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var O=p.prototype;O.getAvailability=function(u,I){if("unknown"!==this._allAvailability)return this._allAvailability;u=(u-this.location.top)*this.location.width+(I-this.location.left);I=u>>3;
const K=this._tileAvailabilityBitSet;return 0>I||I>K.length?"unknown":K[I]&1<<u%8?"available":"unavailable"};O._updateFromData=function(u){let I=!0,K=!0;const G=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let B=0;for(let P=0;P<u.length;P++){const L=P%8;u[P]?(K=!1,G[B]|=1<<L):I=!1;7===L&&++B}K?this._allAvailability="unavailable":I?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=G,this.byteSize+=G.length)};p.fromDefinition=function(u,
I){const K=u.service.request||c,{row:G,col:B,width:P,height:L}=u,S={query:{f:"json"}};I=I?{...S,...I}:S;return K(v(u),I).then(A=>A.data).catch(A=>{if(A&&A.details&&422===A.details.httpStatus)return{location:{top:G,left:B,width:P,height:L},valid:!0,data:g.constant(P*L,0)};throw A;}).then(A=>{if(A.location&&(A.location.top!==G||A.location.left!==B||A.location.width!==P||A.location.height!==L))throw new m("tilemap:location-mismatch","Tilemap response for different location than requested",{response:A,
definition:{top:G,left:B,width:P,height:L}});return p.fromJSON(A)})};p.fromJSON=function(u){p._validateJSON(u);const I=new p;I.location=Object.freeze(H.clone(u.location));I._updateFromData(u.data);return Object.freeze(I)};p._validateJSON=function(u){if(!u||!u.location)throw new m("tilemap:missing-location","Location missing from tilemap response");if(!1===u.valid)throw new m("tilemap:invalid","Tilemap response was marked as invalid");if(!u.data)throw new m("tilemap:missing-data","Data missing from tilemap response");
if(!Array.isArray(u.data))throw new m("tilemap:data-mismatch","Data must be an array of numbers");if(u.data.length!==u.location.width*u.location.height)throw new m("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return l._createClass(p)}();y.Tilemap=w;y.tilemapDefinitionId=function(p){return`${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(y,l,c,g,m,H,v,w,p,O,u,I,K,G,B,P){y.ArcGISMapService=L=>{L=function(S){function A(){var F=da.apply(this,arguments);F.capabilities=void 0;F.copyright=null;F.fullExtent=null;F.legendEnabled=!0;F.spatialReference=null;F.version=void 0;F._allLayersAndTablesPromise=null;F._allLayersAndTablesMap=null;return F}l._inherits(A,S);var da=l._createSuper(A);S=A.prototype;S.readCapabilities=function(F,r){var D=r.capabilities&&r.capabilities.split(",").map(V=>V.toLowerCase().trim());if(!D)return{operations:{supportsExportMap:!1,
supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var E=this.type;F="tile"!==E&&!!r.supportsDynamicLayers;const d=D.includes("query"),e=D.includes("map"),b=!!r.exportTilesAllowed,h=D.includes("tilemap");D=D.includes("data");const t="tile"!==E&&(!r.tileInfo||F),k="tile"!==E&&(!r.tileInfo||F);E="tile"!==E;var x=r.cimVersion&&v.Version.parse(r.cimVersion);const Q=x?.since(1,4)??!1;x=x?.since(2,0)??!1;return{operations:{supportsExportMap:e,
supportsExportTiles:b,supportsIdentify:d,supportsQuery:D,supportsTileMap:h},exportMap:e?{supportsArcadeExpressionForLabeling:Q,supportsSublayersChanges:E,supportsDynamicLayers:F,supportsSublayerVisibility:t,supportsSublayerDefinitionExpression:k,supportsCIMSymbols:x}:null,exportTiles:b?{maxExportTilesCount:+r.maxExportTilesCount}:null}};S.readVersion=function(F,r){(F=r.currentVersion)||(F=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return F};S.fetchSublayerInfo=async function(F,r){try{return await this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap?.get(F)}catch{}};S.fetchAllLayersAndTables=async function(F){await this.load(F);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=g(H.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(D=>{this._allLayersAndTablesMap=new Map;for(const E of D.data.layers)this._allLayersAndTablesMap.set(E.id,
E);return{result:D.data}},D=>({error:D})));const r=await this._allLayersAndTablesPromise;m.throwIfAborted(F);if("result"in r)return r.result;throw r.error;};return l._createClass(A)}(L);c.__decorate([w.property({readOnly:!0})],L.prototype,"capabilities",void 0);c.__decorate([I.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],L.prototype,"readCapabilities",null);c.__decorate([w.property({json:{read:{source:"copyrightText"}}})],
L.prototype,"copyright",void 0);c.__decorate([w.property({type:G})],L.prototype,"fullExtent",void 0);c.__decorate([w.property(P.id)],L.prototype,"id",void 0);c.__decorate([w.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],L.prototype,"legendEnabled",void 0);c.__decorate([w.property(P.popupEnabled)],L.prototype,"popupEnabled",void 0);c.__decorate([w.property({type:B})],L.prototype,"spatialReference",void 0);c.__decorate([w.property({readOnly:!0})],
L.prototype,"version",void 0);c.__decorate([I.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],L.prototype,"readVersion",null);return L=c.__decorate([K.subclass("esri.layers.mixins.ArcGISMapService")],L)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","./Error"],function(y,l,c){let g=function(){function m(v,w,p=""){this.major=v;this.minor=w;this._context=
p}var H=m.prototype;H.lessThan=function(v,w){return this.major<v||v===this.major&&this.minor<w};H.since=function(v,w){return!this.lessThan(v,w)};H.validate=function(v){if(this.major!==v.major)throw new c((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:v});};H.clone=function(){return new m(this.major,this.minor,this._context)};m.parse=function(v,w=""){const [p,
O]=v.split(".");var u=/^\s*\d+\s*$/;if(!p||!p.match||!p.match(u))throw new c((w&&w+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:v});if(!O||!O.match||!O.match(u))throw new c((w&&w+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:v});v=parseInt(p,10);u=parseInt(O,10);return new m(v,u,w)};return l._createClass(m)}();y.Version=g;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(y,l,c,g,m,H,v,w,p,O,u,I,K,G,B,P,L){function S(r,D){const E=[],d={};if(!r)return E;r.forEach(e=>{const b=new P;b.read(e,D);d[b.id]=b;null!=e.parentLayerId&&-1!==e.parentLayerId?(e=d[e.parentLayerId],e.sublayers||(e.sublayers=[]),e.sublayers.unshift(b)):E.unshift(b)});return E}function A(r,D){r&&r.forEach(E=>{D(E);E.sublayers&&E.sublayers.length&&A(E.sublayers,D)})}const da=v.getLogger("esri.layers.TileLayer"),F=g.ofType(P);y.SublayersOwner=r=>{r=function(D){function E(...e){var b=d.call(this,
...e);b.allSublayers=new m({getCollections:()=>[b.sublayers],getChildrenFunction(h){return h.sublayers}});b.sublayersSourceJSON={[B.OriginId.SERVICE]:{},[B.OriginId.PORTAL_ITEM]:{},[B.OriginId.WEB_SCENE]:{},[B.OriginId.WEB_MAP]:{}};b.addHandles(w.watch(()=>b.sublayers,(h,t)=>b._handleSublayersChange(h,t),w.sync));return b}l._inherits(E,D);var d=l._createSuper(E);D=E.prototype;D.readSublayers=function(e,b){if(b&&e){var {sublayersSourceJSON:h}=this,t=B.nameToId(b.origin);if(!(t<B.OriginId.SERVICE||
(h[t]={context:b,visibleLayers:e.visibleLayers||h[t].visibleLayers,layers:e.layers||h[t].layers},t>B.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:k,origin:x}=this.createSublayersForOrigin("web-document");e=K.getProperties(this);e.setDefaultOrigin(x);this._set("sublayers",new F(k));e.setDefaultOrigin("user")}}};D.findSublayerById=function(e){return this.allSublayers.find(b=>b.id===e)};D.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
D.createSublayersForOrigin=function(e){const b="web-document"===e?B.nameToId("web-map"):B.nameToId(e);let h=B.OriginId.SERVICE;e=this.sublayersSourceJSON[B.OriginId.SERVICE].layers;let t=this.sublayersSourceJSON[B.OriginId.SERVICE].context,k=null;var x=[B.OriginId.PORTAL_ITEM,B.OriginId.WEB_SCENE,B.OriginId.WEB_MAP].filter(T=>T<=b);for(var Q of x)x=this.sublayersSourceJSON[Q],L.isSublayerOverhaul(x.layers)&&(h=Q,e=x.layers,t=x.context,x.visibleLayers&&(k={visibleLayers:x.visibleLayers,context:x.context}));
Q=[B.OriginId.PORTAL_ITEM,B.OriginId.WEB_SCENE,B.OriginId.WEB_MAP].filter(T=>T>h&&T<=b);let V=null;for(var R of Q){const {layers:T,visibleLayers:ea,context:q}=this.sublayersSourceJSON[R];T&&(V={layers:T,context:q});ea&&(k={visibleLayers:ea,context:q})}R=S(e,t);const U=new Map,C=new Set;if(V)for(const T of V.layers)U.set(T.id,T);if(k?.visibleLayers)for(const T of k.visibleLayers)C.add(T);A(R,T=>{V&&T.read(U.get(T.id),V.context);k&&T.read({defaultVisibility:C.has(T.id)},k.context)});return{origin:B.idToName(h),
sublayers:new F({items:R})}};D.read=function(e,b){l._get(l._getPrototypeOf(E.prototype),"read",this).call(this,e,b);this.readSublayers(e,b)};D._handleSublayersChange=function(e,b){b&&(b.forEach(h=>{h.parent=null;h.layer=null}),this.removeHandles("sublayers-owner"));e&&(e.forEach(h=>{h.parent=this;h.layer=this}),this.addHandles([e.on("after-add",({item:h})=>{h.parent=this;h.layer=this}),e.on("after-remove",({item:h})=>{h.parent=null;h.layer=null})],"sublayers-owner"),"tile"===this.type&&this.addHandles(e.on("before-changes",
h=>{da.error(new H("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));h.preventDefault()}),"sublayers-owner"))};return l._createClass(E)}(r);c.__decorate([p.property({readOnly:!0})],r.prototype,"allSublayers",void 0);c.__decorate([p.property({readOnly:!0,type:g.ofType(P)})],r.prototype,"serviceSublayers",void 0);c.__decorate([p.property({value:null,type:F,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],r.prototype,"sublayers",
void 0);c.__decorate([p.property({readOnly:!0})],r.prototype,"sublayersSourceJSON",void 0);return r=c.__decorate([G.subclass("esri.layers.mixins.SublayersOwner")],r)};y.forEachSublayer=A;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/has ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../graphics/sources/support/QueryTask ./FeatureType ./Field ./FieldsIndex ./LabelClass ./labelingInfo ./LayerFloorInfo ./serviceCapabilitiesUtils ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/AttachmentQuery ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/support/typeUtils".split(" "),
function(y,l,c,g,m,H,v,w,p,O,u,I,K,G,B,P,L,S,A,da,F,r,D,E,d,e,b,h,t,k,x,Q,V,R,U,C,T,ea,q,M,W,X,ba,la,fa,qa,ma,ta,ua,va,wa,na){function oa(z){return null!=z&&"esriSMS"===z.type}function pa(z,Z,Y){z=this.originIdOf(Z)>=C.nameToId(Y.origin);return{ignoreOrigin:!0,allowNull:z,enabled:Y?"map-image"===Y.layer?.type&&(Y.writeSublayerStructure||z):!1}}function ra(z,Z,Y){return{enabled:Y?"tile"===Y.layer?.type&&this._isOverridden(Z):!1}}function ca(z,Z,Y){return{ignoreOrigin:!0,enabled:Y&&Y.writeSublayerStructure||
!1}}function ja(z,Z,Y){return{ignoreOrigin:!0,enabled:Y?Y.writeSublayerStructure||this.originIdOf(Z)>=C.nameToId(Y.origin):!1}}var ka;let xa=0;const ha=new Set;ha.add("layer");ha.add("parent");ha.add("loaded");ha.add("loadStatus");ha.add("loadError");ha.add("loadWarnings");g=ka=function(z){function Z(a){a=Y.call(this,a);a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.geometryType=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=
null;a.title=null;a.typeIdField=null;a.types=null;a._lastParsedUrl=null;return a}l._inherits(Z,z);var Y=l._createSuper(Z);z=Z.prototype;z.load=async function(a){this.addResolvingPromise((async()=>{const {layer:f,source:n,url:J}=this;if(!f&&!J)throw new A("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});var N=null;!f||this.originIdOf("url")>C.OriginId.SERVICE||"data-layer"===n?.type?N=(await P(J,{responseType:"json",query:{f:"json"},...a})).data:(N=
this.id,"map-layer"===n?.type&&(N=n.mapLayerId),N=await f.fetchSublayerInfo(N,a));N&&(this.sourceJSON=N,this.read({layerDefinition:N},{origin:"service"}))})());return this};z.readCapabilities=function(a,f){f=f.layerDefinition||f;const {operations:{supportsQuery:n,supportsQueryAttachments:J},query:{supportsFormatPBF:N},data:{supportsAttachment:aa}}=fa.getFeatureLayerCapabilities(f,this.url);return{exportMap:{supportsModification:!!f.canModifyLayer},operations:{supportsQuery:n,supportsQueryAttachments:J},
data:{supportsAttachment:aa},query:{supportsFormatPBF:N}}};z.readGlobalIdFieldFromService=function(a,f){f=f.layerDefinition||f;if(f.globalIdField)return f.globalIdField;if(f.fields)for(const n of f.fields)if("esriFieldTypeGlobalID"===n.type)return n.name};z.writeLabelingInfo=function(a,f,n,J){a&&a.length&&(f.layerDefinition={drawingInfo:{labelingInfo:a.map(N=>N.write({},J))}})};z.readMinScale=function(a,f){return f.minScale||f.layerDefinition&&f.layerDefinition.minScale||0};z.readMaxScale=function(a,
f){return f.maxScale||f.layerDefinition&&f.layerDefinition.maxScale||0};z.readObjectIdFieldFromService=function(a,f){f=f.layerDefinition||f;if(f.objectIdField)return f.objectIdField;if(f.fields)for(const n of f.fields)if("esriFieldTypeOID"===n.type)return n.name};z.readOpacity=function(a,f){a=f.layerDefinition;return 1-.01*((null!=a?.transparency?a.transparency:a?.drawingInfo?.transparency)??0)};z.writeOpacity=function(a,f,n,J){f.layerDefinition={drawingInfo:{transparency:100-100*a}}};z.writeParent=
function(a,f){f.parentLayerId=this.parent&&this.parent!==this.layer?U.ensureInteger(this.parent.id):-1};z.castSublayers=function(a){return U.ensureType(S.ofType(ka),a)};z.writeSublayers=function(a,f,n){this.sublayers?.length&&(f[n]=this.sublayers.map(J=>J.id).toArray().reverse())};z.readTypeIdField=function(a,f){f=f.layerDefinition||f;let n=f.typeIdField;n&&f.fields&&(n=n.toLowerCase(),a=f.fields.find(J=>J.name.toLowerCase()===n))&&(n=a.name);return n};z.writeVisible=function(a,f,n,J){f[n]=this.getAtOrigin("defaultVisibility",
"service")||a};z.clone=function(){const {store:a}=T.getProperties(this),f=new ka;T.getProperties(f).store=a.clone(ha);this.commitProperty("url");f._lastParsedUrl=this._lastParsedUrl;return f};z.createPopupTemplate=function(a){return va.createPopupTemplate(this,a)};z.createQuery=function(){return new ua({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};z.createFeatureLayer=async function(){if(this.hasOwnProperty("sublayers"))return null;const {layer:a}=this,f=a?.parsedUrl,n=new (await new Promise((J,
N)=>y(["../FeatureLayer"],aa=>J(Object.freeze(Object.defineProperty({__proto__:null,default:aa},Symbol.toStringTag,{value:"Module"}))),N))).default({url:f?.path});f&&this.source&&("map-layer"===this.source.type?n.layerId=this.source.mapLayerId:n.dynamicDataSource=this.source);null!=a?.refreshInterval&&(n.refreshInterval=a.refreshInterval);this.definitionExpression&&(n.definitionExpression=this.definitionExpression);this.floorInfo&&(n.floorInfo=D.clone(this.floorInfo));this.originIdOf("labelingInfo")>
C.OriginId.SERVICE&&(n.labelingInfo=D.clone(this.labelingInfo));this.originIdOf("labelsVisible")>C.OriginId.DEFAULTS&&(n.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>C.OriginId.DEFAULTS&&(n.legendEnabled=this.legendEnabled);this.originIdOf("visible")>C.OriginId.DEFAULTS&&(n.visible=this.visible);this.originIdOf("minScale")>C.OriginId.DEFAULTS&&(n.minScale=this.minScale);this.originIdOf("maxScale")>C.OriginId.DEFAULTS&&(n.maxScale=this.maxScale);this.originIdOf("opacity")>C.OriginId.DEFAULTS&&
(n.opacity=this.opacity);this.originIdOf("popupTemplate")>C.OriginId.DEFAULTS&&(n.popupTemplate=D.clone(this.popupTemplate));this.originIdOf("renderer")>C.OriginId.SERVICE&&(n.renderer=D.clone(this.renderer));"data-layer"===this.source?.type&&(n.dynamicDataSource=this.source.clone());this.originIdOf("title")>C.OriginId.DEFAULTS&&(n.title=this.title);"map-image"===a?.type&&a.originIdOf("customParameters")>C.OriginId.DEFAULTS&&(n.customParameters=a.customParameters);"tile"===a?.type&&a.originIdOf("customParameters")>
C.OriginId.DEFAULTS&&(n.customParameters=a.customParameters);return n};z.getField=function(a){return this.fieldsIndex.get(a)};z.getFeatureType=function(a){const {typeIdField:f,types:n}=this;if(!f||!a)return null;const J=a.attributes?a.attributes[f]:void 0;if(null==J)return null;let N=null;n?.some(aa=>{const {id:ia}=aa;if(null==ia)return!1;ia.toString()===J.toString()&&(N=aa);return!!N});return N};z.getFieldDomain=function(a,f){return(f=this.getFeatureType(f&&f.feature))&&(f=f.domains&&f.domains[a])&&
"inherited"!==f.type?f:this._getLayerDomain(a)};z.queryAttachments=async function(a,f){await this.load();a=ta.from(a);const n=this.capabilities;if(!n?.data?.supportsAttachment)throw new A("queryAttachments:not-supported","this layer doesn't support attachments");const {attachmentTypes:J,objectIds:N,globalIds:aa,num:ia,size:ya,start:za,where:sa}=a;if(!n?.operations?.supportsQueryAttachments&&(0<J?.length||0<aa?.length||0<ya?.length||ia||za||sa))throw new A("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",
a);if(!(N?.length||aa?.length||sa))throw new A("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",a);return this.queryTask.executeAttachmentQuery(a,f)};z.queryFeatures=async function(a=this.createQuery(),f){await this.load();if(!this.capabilities.operations.supportsQuery)throw new A("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new A("queryFeatures:not-supported","this layer has no url.");a=await this.queryTask.execute(a,
{...f,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(a?.features)for(const n of a.features)n.sourceLayer=this;return a};z.toExportImageJSON=function(a){const f={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:"mapLayer"}};a=h.sqlAnd(a,this.definitionExpression);e.isSome(a)&&(f.definitionExpression=a);const n=["renderer","labelingInfo","opacity","labelsVisible"].reduce((J,N)=>{J[N]=this.originIdOf(N);return J},{});if(Object.keys(n).some(J=>n[J]>C.OriginId.SERVICE)){a=
f.drawingInfo={};n.renderer>C.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null);n.labelsVisible>C.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&n.labelingInfo>C.OriginId.SERVICE){!this.loaded&&this.labelingInfo.some(N=>!N.labelPlacement)&&d.getLogger(this.declaredClass).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",
{sublayer:this});let J=this.labelingInfo;e.isSome(this.geometryType)&&(J=ba.validateLabelingInfo(this.labelingInfo,na.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));a.labelingInfo=J.filter(N=>N.labelPlacement).map(N=>N.toJSON({origin:"service",layer:this.layer}));a.showLabels=!0}n.opacity>C.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return f};z._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,f=>{f.color||
"esriSMSX"!==f.style&&"esriSMSCross"!==f.style||(f.color=f.outline&&f.outline.color?f.outline.color:[0,0,0,0])})};z._forEachSimpleMarkerSymbols=function(a,f){if(a){const n=("uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:null)??[];for(const J of n)oa(J.symbol)&&f(J.symbol);"symbol"in a&&oa(a.symbol)&&f(a.symbol);"defaultSymbol"in a&&oa(a.defaultSymbol)&&f(a.defaultSymbol)}};z._setAndNotifyLayer=function(a,f){const n=this.layer,J=this._get(a);let N,aa;switch(a){case "definitionExpression":case "floorInfo":N=
"supportsSublayerDefinitionExpression";break;case "minScale":case "maxScale":case "visible":N="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":N="supportsDynamicLayers",aa="supportsModification"}const ia=T.getProperties(this).getDefaultOrigin();if("service"!==ia){if(N&&!1===this.layer?.capabilities?.exportMap?.[N]){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${N}'`);return}if(aa&&!1===this.capabilities?.exportMap[aa]){this._logLockedError(a,
`capability not available 'capabilities.exportMap.${aa}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,f),"service"!==ia&&J!==f&&n&&n.emit&&n.emit("sublayer-update",{propertyName:a,target:this}))};z._handleSublayersChange=function(a,f){f&&(f.forEach(n=>{n.parent=null;n.layer=null}),this.handles.removeAll());a&&(a.forEach(n=>{n.parent=this;n.layer=this.layer}),this.handles.add([a.on("after-add",
({item:n})=>{n.parent=this;n.layer=this.layer}),a.on("after-remove",({item:n})=>{n.parent=null;n.layer=null}),a.on("before-changes",n=>{const J=this.layer?.capabilities?.exportMap?.supportsSublayersChanges;null==J||J||(d.getLogger(this.declaredClass).error(new A("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),n.preventDefault())})]))};z._logLockedError=function(a,f){const {layer:n,declaredClass:J}=this;
d.getLogger(J).error(new A("sublayer:locked",`Property '${String(a)}' can't be changed on Sublayer from the layer '${n?.id}'`,{reason:f,sublayer:this,layer:n}))};z._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};l._createClass(Z,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new W(this.fields||[])}},{key:"floorInfo",
set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?xa++:a},set:function(a){this._get("id")!==a&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",
a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(f=>f.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:f}=this;return{minScale:a,maxScale:f}}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"queryTask",
get:function(){if(!this.layer)return null;const {spatialReference:a}=this.layer,f="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:n,fieldsIndex:J}=this,N=F("featurelayer-pbf")&&n?.query.supportsFormatPBF;return new ea({url:this.url,pbfSupported:N,fieldsIndex:J,gdbVersion:f,sourceSpatialReference:a,queryAttachmentsSupported:n?.operations?.supportsQueryAttachments??!1})}},{key:"renderer",set:function(a){if(a)for(const f of a.getSymbols())if(L.isSymbol3D(f)){d.getLogger(this.declaredClass).warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new ma.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){const a=this.layer?.parsedUrl??this._lastParsedUrl;var f=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===f?.type)return`${a.path}/${f.mapLayerId}`;
f={layer:JSON.stringify({source:this.source})};return`${a.path}/dynamicLayer?${t.objectToQuery(f)}`},set:function(a){this._overrideIfSome("url",a)}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return Z}(da.HandleOwnerMixin(b.MultiOriginJSONMixin(r.IdentifiableMixin(E))));g.test={isMapImageLayerOverridePolicy:z=>z===ca||z===pa,isTileImageLayerOverridePolicy:z=>z===ra};c.__decorate([k.property({readOnly:!0})],g.prototype,"capabilities",void 0);c.__decorate([Q.reader("service",
"capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],g.prototype,"readCapabilities",null);c.__decorate([k.property()],g.prototype,"defaultPopupTemplate",null);c.__decorate([k.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:pa}}})],g.prototype,"definitionExpression",null);c.__decorate([k.property({type:[M],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],g.prototype,"fields",void 0);
c.__decorate([k.property({readOnly:!0})],g.prototype,"fieldsIndex",null);c.__decorate([k.property({type:la,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:pa},origins:{"web-scene":{read:!1,write:!1}}}})],g.prototype,"floorInfo",null);c.__decorate([k.property({type:wa,json:{read:{source:"layerDefinition.extent"}}})],g.prototype,"fullExtent",void 0);c.__decorate([k.property({type:na.featureGeometryTypeKebabDictionary.apiValues,
json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:na.featureGeometryTypeKebabDictionary.read}}}}})],g.prototype,"geometryType",void 0);c.__decorate([k.property({type:String})],g.prototype,"globalIdField",void 0);c.__decorate([Q.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],g.prototype,"readGlobalIdFieldFromService",null);c.__decorate([k.property({type:U.Integer,json:{write:{ignoreOrigin:!0}}})],g.prototype,"id",null);c.__decorate([k.property({value:null,
type:[X],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ca}}})],g.prototype,"labelingInfo",null);c.__decorate([R.writer("labelingInfo")],g.prototype,"writeLabelingInfo",null);c.__decorate([k.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ca}}})],g.prototype,"labelsVisible",null);c.__decorate([k.property({value:null})],
g.prototype,"layer",null);c.__decorate([k.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ja}}})],g.prototype,"legendEnabled",void 0);c.__decorate([k.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],g.prototype,"listMode",null);c.__decorate([k.property({type:Number,value:0,json:{write:{overridePolicy:ca}}})],g.prototype,"minScale",
null);c.__decorate([Q.reader("minScale",["minScale","layerDefinition.minScale"])],g.prototype,"readMinScale",null);c.__decorate([k.property({type:Number,value:0,json:{write:{overridePolicy:ca}}})],g.prototype,"maxScale",null);c.__decorate([Q.reader("maxScale",["maxScale","layerDefinition.maxScale"])],g.prototype,"readMaxScale",null);c.__decorate([k.property({readOnly:!0})],g.prototype,"effectiveScaleRange",null);c.__decorate([k.property({type:String})],g.prototype,"objectIdField",void 0);c.__decorate([Q.reader("service",
"objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],g.prototype,"readObjectIdFieldFromService",null);c.__decorate([k.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ca}}})],g.prototype,"opacity",null);c.__decorate([Q.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],g.prototype,"readOpacity",null);c.__decorate([R.writer("opacity")],g.prototype,"writeOpacity",null);c.__decorate([k.property({json:{type:U.Integer,
write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:ca}}})],g.prototype,"parent",void 0);c.__decorate([R.writer("parent")],g.prototype,"writeParent",null);c.__decorate([k.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(z,Z){return!Z.disablePopup}},write:{target:"disablePopup",overridePolicy:ja,writer(z,Z,Y){Z[Y]=!z}}}})],g.prototype,"popupEnabled",void 0);c.__decorate([k.property({type:m,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ja}}})],
g.prototype,"popupTemplate",void 0);c.__decorate([k.property({readOnly:!0})],g.prototype,"queryTask",null);c.__decorate([k.property({types:B.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ca},origins:{"web-scene":{types:B.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ca}}}}})],g.prototype,"renderer",null);c.__decorate([k.property({types:{key:"type",base:null,typeMap:{"data-layer":qa.DataLayerSource,"map-layer":ma.MapLayerSource}},
cast(z){if(z){if("mapLayerId"in z)return U.ensureClass(ma.MapLayerSource,z);if("dataSource"in z)return U.ensureClass(qa.DataLayerSource,z)}return z},json:{name:"layerDefinition.source",write:{overridePolicy:ca}}})],g.prototype,"source",null);c.__decorate([k.property()],g.prototype,"sourceJSON",void 0);c.__decorate([k.property({value:null,json:{type:[U.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ca}}})],g.prototype,"sublayers",null);c.__decorate([x.cast("sublayers")],g.prototype,
"castSublayers",null);c.__decorate([R.writer("sublayers")],g.prototype,"writeSublayers",null);c.__decorate([k.property({type:String,json:{name:"name",write:{overridePolicy:ja}}})],g.prototype,"title",void 0);c.__decorate([k.property({type:String})],g.prototype,"typeIdField",void 0);c.__decorate([Q.reader("typeIdField",["layerDefinition.typeIdField"])],g.prototype,"readTypeIdField",null);c.__decorate([k.property({type:[q],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],g.prototype,
"types",void 0);c.__decorate([k.property({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:ra}}})],g.prototype,"url",null);c.__decorate([k.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ca}}})],g.prototype,"visible",null);c.__decorate([R.writer("visible")],g.prototype,"writeVisible",null);return g=ka=c.__decorate([V.subclass("esri.layers.support.Sublayer")],g)})},"esri/layers/support/sublayerUtils":function(){define(["exports",
"../../core/maybe","../../core/accessorSupport/PropertyOrigin"],function(y,l,c){function g(m,H){if(!m||!m.length||l.isNone(H))return!0;H=H.slice().reverse().flatten(({sublayers:p})=>p&&p.toArray().reverse()).map(p=>p.id).toArray();if(m.length>H.length)return!1;let v=0;const w=H.length;for(const {id:p}of m){for(;v<w&&H[v]!==p;)v++;if(v>=w)return!1}return!0}y.isExportDynamic=function(m,H,v){return m.some(w=>{const p=w.source;return!(!p||"map-layer"===p.type&&p.mapLayerId===w.id&&(l.isNone(p.gdbVersion)||
p.gdbVersion===v))||w.originIdOf("renderer")>c.OriginId.SERVICE||w.originIdOf("labelingInfo")>c.OriginId.SERVICE||w.originIdOf("opacity")>c.OriginId.SERVICE||w.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!g(m,H)};y.isSublayerOverhaul=function(m){return!!m&&m.some(H=>null!=H.minScale||H.layerDefinition&&null!=H.layerDefinition.minScale)};y.shouldWriteSublayerStructure=function(m,H,v){return H.flatten(({sublayers:w})=>w).length!==m.length||m.some(w=>w.originIdOf("minScale")>v||w.originIdOf("maxScale")>
v||w.originIdOf("renderer")>v||w.originIdOf("labelingInfo")>v||w.originIdOf("opacity")>v||w.originIdOf("labelsVisible")>v||w.originIdOf("source")>v)?!0:!g(m,H)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageBitmapUtils":function(){define(["exports","../../core/Error"],function(y,l){y.createBitmap=async function(c,g){try{return await createImageBitmap(c)}catch(m){throw new l("request:server",`Unable to load ${g}`,{url:g,error:m});}};Object.defineProperty(y,
Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/SpatialReference ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/imageBitmapUtils ./support/Sublayer".split(" "),function(y,
l,c,g,m,H,v,w,p,O,u,I,K,G,B,P,L,S,A,da,F,r,D,E,d,e,b,h,t,k,x,Q,V,R){const U="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");m=function(C){function T(...q){q=
ea.call(this,...q);q.listMode="show";q.isReference=null;q.operationalLayerType="ArcGISTiledMapServiceLayer";q.resampling=!0;q.sourceJSON=null;q.spatialReference=null;q.path=null;q.sublayers=null;q.type="tile";q.url=null;return q}y._inherits(T,C);var ea=y._createSuper(T);C=T.prototype;C.normalizeCtorArgs=function(q,M){return"string"===typeof q?{url:q,...M}:q};C.load=function(q){const M=v.isSome(q)?q.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},q).catch(p.throwIfAbortError).then(()=>
this._fetchService(M)));return Promise.resolve(this)};C.readSpatialReference=function(q,M){return(q=q||M.tileInfo&&M.tileInfo.spatialReference)&&S.fromJSON(q)};C.writeSublayers=function(q,M,W,X){if(this.loaded&&q){q=q.slice().reverse().flatten(({sublayers:fa})=>fa&&fa.toArray().reverse()).toArray();var ba=[],la={writeSublayerStructure:!1,...X};q.forEach(fa=>{fa=fa.write({},la);ba.push(fa)});ba.some(fa=>1<Object.keys(fa).length)&&(M.layers=ba)}};C.castTileServers=function(q){return Array.isArray(q)?
q.map(M=>O.urlToObject(M).path):null};C.fetchTile=function(q,M,W,X={}){({signal:X}=X);q=this.getTileUrl(q,M,W);return c(q,{responseType:"image",signal:X,query:{...this.refreshParameters}}).then(ba=>ba.data)};C.fetchImageBitmapTile=async function(q,M,W,X={}){({signal:X}=X);q=this.getTileUrl(q,M,W);({data:M}=await c(q,{responseType:"blob",signal:X,query:{...this.refreshParameters}}));return V.createBitmap(M,q)};C.getTileUrl=function(q,M,W){const X=O.objectToQuery({...this.parsedUrl?.query,blankTile:!this.tilemapCache&&
this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),ba=this.tileServers;return`${ba&&ba.length?ba[M%ba.length]:this.parsedUrl?.path}/tile/${q}/${M}/${W}${X?"?"+X:""}`};C.loadAll=function(){return H.loadAll(this,q=>{q(this.allSublayers)})};C._fetchService=function(q){return(new Promise((M,W)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new g("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
M({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new g("tile-layer:undefined-url","layer's url is not defined");var X=x.parse(this.parsedUrl.path);if(v.isSome(X)&&"ImageServer"===X.serverType)throw new g("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:q}).then(M,W)}})).then(M=>{let W=this.url;M.ssl&&(W=this.url=W.replace(/^http:/i,
"https:"));this.sourceJSON=M.data;this.read(M.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!x.isHostedAgolService(W))return this._fetchServerVersion(W,q).then(X=>{this.read({currentVersion:X})}).catch(()=>{})})};C._fetchServerVersion=function(q,M){if(!x.isArcGISUrl(q))return Promise.reject();q=q.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return c(q,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:M}).then(W=>{if(W.data&&W.data.currentVersion)return W.data.currentVersion;
throw new g("tile-layer:version-not-available");})};C._getMapName=function(q){return(q=q.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))?q[2]:void 0};C._getDefaultAttribution=function(q){if(null==q)return null;let M;q=q.toLowerCase();for(let W=0,X=U.length;W<X;W++)if(M=U[W],M.toLowerCase().includes(q))return O.makeAbsolute("//static.arcgis.com/attribution/"+M);return null};C._getDefaultTileServers=
function(q){if(null==q)return[];const M=-1!==q.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),W=-1!==q.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return M||W?[q,q.replace(M?/server\.arcgisonline/i:/services\.arcgisonline/i,M?"services.arcgisonline":"server.arcgisonline")]:[]};y._createClass(T,[{key:"attributionDataUrl",get:function(){const q=this.parsedUrl?.path.toLowerCase();return q?this._getDefaultAttribution(this._getMapName(q)):null}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl?.path)}},
{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return T}(E.BlendLayer(k.SublayersOwner(t.ScaleRangeLayer(e.OperationalLayer(b.PortalLayer(F.ArcGISCachedService(r.ArcGISMapService(D.ArcGISService(w.MultiOriginJSONMixin(m.HandleOwnerMixin(h.RefreshableLayer(da.APIKeyMixin(d.CustomParametersMixin(A))))))))))))));l.__decorate([u.property({readOnly:!0})],m.prototype,"attributionDataUrl",null);l.__decorate([u.property({type:["show","hide","hide-children"]})],m.prototype,
"listMode",void 0);l.__decorate([u.property({json:{read:!0,write:!0}})],m.prototype,"blendMode",void 0);l.__decorate([u.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],m.prototype,"isReference",void 0);l.__decorate([u.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],m.prototype,"operationalLayerType",void 0);l.__decorate([u.property({type:Boolean})],m.prototype,"resampling",void 0);l.__decorate([u.property()],m.prototype,"sourceJSON",void 0);
l.__decorate([u.property({type:S})],m.prototype,"spatialReference",void 0);l.__decorate([B.reader("spatialReference",["spatialReference","tileInfo"])],m.prototype,"readSpatialReference",null);l.__decorate([u.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],m.prototype,"path",void 0);l.__decorate([u.property({readOnly:!0})],m.prototype,"sublayers",void 0);l.__decorate([L.writer("sublayers",{layers:{type:[R]}})],m.prototype,"writeSublayers",null);l.__decorate([u.property({json:{read:!1,
write:!1}})],m.prototype,"popupEnabled",void 0);l.__decorate([u.property()],m.prototype,"tileServers",null);l.__decorate([I.cast("tileServers")],m.prototype,"castTileServers",null);l.__decorate([u.property({readOnly:!0,json:{read:!1}})],m.prototype,"type",void 0);l.__decorate([u.property(Q.url)],m.prototype,"url",void 0);m=l.__decorate([P.subclass("esri.layers.TileLayer")],m);m.prototype.fetchTile.__isDefault__=!0;return m});