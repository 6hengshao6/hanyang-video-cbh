// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(u,n,c,e,z,k,v,g,C,ca,F,ha,ka,ia,D,Y){u.ArcGISMapService=G=>{G=function(L){function N(){var p=l.apply(this,arguments);p.capabilities=void 0;p.copyright=null;p.fullExtent=null;p.legendEnabled=!0;p.spatialReference=null;p.version=void 0;p._allLayersAndTablesPromise=null;p._allLayersAndTablesMap=null;return p}n._inherits(N,L);var l=n._createSuper(N);L=N.prototype;L.readCapabilities=function(p,m){var q=m.capabilities&&m.capabilities.split(",").map(da=>da.toLowerCase().trim());if(!q)return{operations:{supportsExportMap:!1,
supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var w=this.type;p="tile"!==w&&!!m.supportsDynamicLayers;const W=q.includes("query"),t=q.includes("map"),A=!!m.exportTilesAllowed,B=q.includes("tilemap");q=q.includes("data");const R="tile"!==w&&(!m.tileInfo||p),r="tile"!==w&&(!m.tileInfo||p);w="tile"!==w;var O=m.cimVersion&&v.Version.parse(m.cimVersion);const S=O?.since(1,4)??!1;O=O?.since(2,0)??!1;return{operations:{supportsExportMap:t,
supportsExportTiles:A,supportsIdentify:W,supportsQuery:q,supportsTileMap:B},exportMap:t?{supportsArcadeExpressionForLabeling:S,supportsSublayersChanges:w,supportsDynamicLayers:p,supportsSublayerVisibility:R,supportsSublayerDefinitionExpression:r,supportsCIMSymbols:O}:null,exportTiles:A?{maxExportTilesCount:+m.maxExportTilesCount}:null}};L.readVersion=function(p,m){(p=m.currentVersion)||(p=m.hasOwnProperty("capabilities")||m.hasOwnProperty("tables")?10:m.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return p};L.fetchSublayerInfo=async function(p,m){try{return await this.fetchAllLayersAndTables(m),this._allLayersAndTablesMap?.get(p)}catch{}};L.fetchAllLayersAndTables=async function(p){await this.load(p);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=e(k.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(q=>{this._allLayersAndTablesMap=new Map;for(const w of q.data.layers)this._allLayersAndTablesMap.set(w.id,
w);return{result:q.data}},q=>({error:q})));const m=await this._allLayersAndTablesPromise;z.throwIfAborted(p);if("result"in m)return m.result;throw m.error;};return n._createClass(N)}(G);c.__decorate([g.property({readOnly:!0})],G.prototype,"capabilities",void 0);c.__decorate([ha.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],G.prototype,"readCapabilities",null);c.__decorate([g.property({json:{read:{source:"copyrightText"}}})],
G.prototype,"copyright",void 0);c.__decorate([g.property({type:ia})],G.prototype,"fullExtent",void 0);c.__decorate([g.property(Y.id)],G.prototype,"id",void 0);c.__decorate([g.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],G.prototype,"legendEnabled",void 0);c.__decorate([g.property(Y.popupEnabled)],G.prototype,"popupEnabled",void 0);c.__decorate([g.property({type:D})],G.prototype,"spatialReference",void 0);c.__decorate([g.property({readOnly:!0})],
G.prototype,"version",void 0);c.__decorate([ha.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],G.prototype,"readVersion",null);return G=c.__decorate([ka.subclass("esri.layers.mixins.ArcGISMapService")],G)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","./Error"],function(u,n,c){let e=function(){function z(v,g,C=""){this.major=v;this.minor=g;this._context=
C}var k=z.prototype;k.lessThan=function(v,g){return this.major<v||v===this.major&&this.minor<g};k.since=function(v,g){return!this.lessThan(v,g)};k.validate=function(v){if(this.major!==v.major)throw new c((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:v});};k.clone=function(){return new z(this.major,this.minor,this._context)};z.parse=function(v,g=""){const [C,
ca]=v.split(".");var F=/^\s*\d+\s*$/;if(!C||!C.match||!C.match(F))throw new c((g&&g+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:v});if(!ca||!ca.match||!ca.match(F))throw new c((g&&g+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:v});v=parseInt(C,10);F=parseInt(ca,10);return new z(v,F,g)};return n._createClass(z)}();u.Version=e;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(u,n,c,e,z,k,v,g,C,ca,F,ha,ka,ia,D,Y,G){function L(m,q){const w=[],W={};if(!m)return w;m.forEach(t=>{const A=new Y;A.read(t,q);W[A.id]=A;null!=t.parentLayerId&&-1!==t.parentLayerId?(t=W[t.parentLayerId],t.sublayers||(t.sublayers=[]),t.sublayers.unshift(A)):w.unshift(A)});return w}function N(m,q){m&&m.forEach(w=>{q(w);w.sublayers&&w.sublayers.length&&N(w.sublayers,q)})}const l=v.getLogger("esri.layers.TileLayer"),p=e.ofType(Y);u.SublayersOwner=m=>{m=function(q){function w(...t){var A=W.call(this,
...t);A.allSublayers=new z({getCollections:()=>[A.sublayers],getChildrenFunction(B){return B.sublayers}});A.sublayersSourceJSON={[D.OriginId.SERVICE]:{},[D.OriginId.PORTAL_ITEM]:{},[D.OriginId.WEB_SCENE]:{},[D.OriginId.WEB_MAP]:{}};A.addHandles(g.watch(()=>A.sublayers,(B,R)=>A._handleSublayersChange(B,R),g.sync));return A}n._inherits(w,q);var W=n._createSuper(w);q=w.prototype;q.readSublayers=function(t,A){if(A&&t){var {sublayersSourceJSON:B}=this,R=D.nameToId(A.origin);if(!(R<D.OriginId.SERVICE||
(B[R]={context:A,visibleLayers:t.visibleLayers||B[R].visibleLayers,layers:t.layers||B[R].layers},R>D.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:r,origin:O}=this.createSublayersForOrigin("web-document");t=ka.getProperties(this);t.setDefaultOrigin(O);this._set("sublayers",new p(r));t.setDefaultOrigin("user")}}};q.findSublayerById=function(t){return this.allSublayers.find(A=>A.id===t)};q.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
q.createSublayersForOrigin=function(t){const A="web-document"===t?D.nameToId("web-map"):D.nameToId(t);let B=D.OriginId.SERVICE;t=this.sublayersSourceJSON[D.OriginId.SERVICE].layers;let R=this.sublayersSourceJSON[D.OriginId.SERVICE].context,r=null;var O=[D.OriginId.PORTAL_ITEM,D.OriginId.WEB_SCENE,D.OriginId.WEB_MAP].filter(I=>I<=A);for(var S of O)O=this.sublayersSourceJSON[S],G.isSublayerOverhaul(O.layers)&&(B=S,t=O.layers,R=O.context,O.visibleLayers&&(r={visibleLayers:O.visibleLayers,context:O.context}));
S=[D.OriginId.PORTAL_ITEM,D.OriginId.WEB_SCENE,D.OriginId.WEB_MAP].filter(I=>I>B&&I<=A);let da=null;for(var Z of S){const {layers:I,visibleLayers:oa,context:la}=this.sublayersSourceJSON[Z];I&&(da={layers:I,context:la});oa&&(r={visibleLayers:oa,context:la})}Z=L(t,R);const aa=new Map,H=new Set;if(da)for(const I of da.layers)aa.set(I.id,I);if(r?.visibleLayers)for(const I of r.visibleLayers)H.add(I);N(Z,I=>{da&&I.read(aa.get(I.id),da.context);r&&I.read({defaultVisibility:H.has(I.id)},r.context)});return{origin:D.idToName(B),
sublayers:new p({items:Z})}};q.read=function(t,A){n._get(n._getPrototypeOf(w.prototype),"read",this).call(this,t,A);this.readSublayers(t,A)};q._handleSublayersChange=function(t,A){A&&(A.forEach(B=>{B.parent=null;B.layer=null}),this.removeHandles("sublayers-owner"));t&&(t.forEach(B=>{B.parent=this;B.layer=this}),this.addHandles([t.on("after-add",({item:B})=>{B.parent=this;B.layer=this}),t.on("after-remove",({item:B})=>{B.parent=null;B.layer=null})],"sublayers-owner"),"tile"===this.type&&this.addHandles(t.on("before-changes",
B=>{l.error(new k("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));B.preventDefault()}),"sublayers-owner"))};return n._createClass(w)}(m);c.__decorate([C.property({readOnly:!0})],m.prototype,"allSublayers",void 0);c.__decorate([C.property({readOnly:!0,type:e.ofType(Y)})],m.prototype,"serviceSublayers",void 0);c.__decorate([C.property({value:null,type:p,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],m.prototype,"sublayers",
void 0);c.__decorate([C.property({readOnly:!0})],m.prototype,"sublayersSourceJSON",void 0);return m=c.__decorate([ia.subclass("esri.layers.mixins.SublayersOwner")],m)};u.forEachSublayer=N;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/has ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../graphics/sources/support/QueryTask ./FeatureType ./Field ./FieldsIndex ./LabelClass ./labelingInfo ./LayerFloorInfo ./serviceCapabilitiesUtils ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/AttachmentQuery ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/support/typeUtils".split(" "),
function(u,n,c,e,z,k,v,g,C,ca,F,ha,ka,ia,D,Y,G,L,N,l,p,m,q,w,W,t,A,B,R,r,O,S,da,Z,aa,H,I,oa,la,T,pa,sa,f,E,J,K,P,U,ea,M,fa,ja){function ta(h){return null!=h&&"esriSMS"===h.type}function ua(h,V,Q){h=this.originIdOf(V)>=H.nameToId(Q.origin);return{ignoreOrigin:!0,allowNull:h,enabled:Q?"map-image"===Q.layer?.type&&(Q.writeSublayerStructure||h):!1}}function va(h,V,Q){return{enabled:Q?"tile"===Q.layer?.type&&this._isOverridden(V):!1}}function ba(h,V,Q){return{ignoreOrigin:!0,enabled:Q&&Q.writeSublayerStructure||
!1}}function qa(h,V,Q){return{ignoreOrigin:!0,enabled:Q?Q.writeSublayerStructure||this.originIdOf(V)>=H.nameToId(Q.origin):!1}}var ra;let xa=0;const ma=new Set;ma.add("layer");ma.add("parent");ma.add("loaded");ma.add("loadStatus");ma.add("loadError");ma.add("loadWarnings");e=ra=function(h){function V(a){a=Q.call(this,a);a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.geometryType=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=
null;a.title=null;a.typeIdField=null;a.types=null;a._lastParsedUrl=null;return a}n._inherits(V,h);var Q=n._createSuper(V);h=V.prototype;h.load=async function(a){this.addResolvingPromise((async()=>{const {layer:b,source:d,url:x}=this;if(!b&&!x)throw new N("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});var y=null;!b||this.originIdOf("url")>H.OriginId.SERVICE||"data-layer"===d?.type?y=(await Y(x,{responseType:"json",query:{f:"json"},...a})).data:(y=
this.id,"map-layer"===d?.type&&(y=d.mapLayerId),y=await b.fetchSublayerInfo(y,a));y&&(this.sourceJSON=y,this.read({layerDefinition:y},{origin:"service"}))})());return this};h.readCapabilities=function(a,b){b=b.layerDefinition||b;const {operations:{supportsQuery:d,supportsQueryAttachments:x},query:{supportsFormatPBF:y},data:{supportsAttachment:X}}=J.getFeatureLayerCapabilities(b,this.url);return{exportMap:{supportsModification:!!b.canModifyLayer},operations:{supportsQuery:d,supportsQueryAttachments:x},
data:{supportsAttachment:X},query:{supportsFormatPBF:y}}};h.readGlobalIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(const d of b.fields)if("esriFieldTypeGlobalID"===d.type)return d.name};h.writeLabelingInfo=function(a,b,d,x){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(y=>y.write({},x))}})};h.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};h.readMaxScale=function(a,
b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};h.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(const d of b.fields)if("esriFieldTypeOID"===d.type)return d.name};h.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*((null!=a?.transparency?a.transparency:a?.drawingInfo?.transparency)??0)};h.writeOpacity=function(a,b,d,x){b.layerDefinition={drawingInfo:{transparency:100-100*a}}};h.writeParent=
function(a,b){b.parentLayerId=this.parent&&this.parent!==this.layer?aa.ensureInteger(this.parent.id):-1};h.castSublayers=function(a){return aa.ensureType(L.ofType(ra),a)};h.writeSublayers=function(a,b,d){this.sublayers?.length&&(b[d]=this.sublayers.map(x=>x.id).toArray().reverse())};h.readTypeIdField=function(a,b){b=b.layerDefinition||b;let d=b.typeIdField;d&&b.fields&&(d=d.toLowerCase(),a=b.fields.find(x=>x.name.toLowerCase()===d))&&(d=a.name);return d};h.writeVisible=function(a,b,d,x){b[d]=this.getAtOrigin("defaultVisibility",
"service")||a};h.clone=function(){const {store:a}=I.getProperties(this),b=new ra;I.getProperties(b).store=a.clone(ma);this.commitProperty("url");b._lastParsedUrl=this._lastParsedUrl;return b};h.createPopupTemplate=function(a){return M.createPopupTemplate(this,a)};h.createQuery=function(){return new ea({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};h.createFeatureLayer=async function(){if(this.hasOwnProperty("sublayers"))return null;const {layer:a}=this,b=a?.parsedUrl,d=new (await new Promise((x,
y)=>u(["../FeatureLayer"],X=>x(Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}))),y))).default({url:b?.path});b&&this.source&&("map-layer"===this.source.type?d.layerId=this.source.mapLayerId:d.dynamicDataSource=this.source);null!=a?.refreshInterval&&(d.refreshInterval=a.refreshInterval);this.definitionExpression&&(d.definitionExpression=this.definitionExpression);this.floorInfo&&(d.floorInfo=q.clone(this.floorInfo));this.originIdOf("labelingInfo")>
H.OriginId.SERVICE&&(d.labelingInfo=q.clone(this.labelingInfo));this.originIdOf("labelsVisible")>H.OriginId.DEFAULTS&&(d.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>H.OriginId.DEFAULTS&&(d.legendEnabled=this.legendEnabled);this.originIdOf("visible")>H.OriginId.DEFAULTS&&(d.visible=this.visible);this.originIdOf("minScale")>H.OriginId.DEFAULTS&&(d.minScale=this.minScale);this.originIdOf("maxScale")>H.OriginId.DEFAULTS&&(d.maxScale=this.maxScale);this.originIdOf("opacity")>H.OriginId.DEFAULTS&&
(d.opacity=this.opacity);this.originIdOf("popupTemplate")>H.OriginId.DEFAULTS&&(d.popupTemplate=q.clone(this.popupTemplate));this.originIdOf("renderer")>H.OriginId.SERVICE&&(d.renderer=q.clone(this.renderer));"data-layer"===this.source?.type&&(d.dynamicDataSource=this.source.clone());this.originIdOf("title")>H.OriginId.DEFAULTS&&(d.title=this.title);"map-image"===a?.type&&a.originIdOf("customParameters")>H.OriginId.DEFAULTS&&(d.customParameters=a.customParameters);"tile"===a?.type&&a.originIdOf("customParameters")>
H.OriginId.DEFAULTS&&(d.customParameters=a.customParameters);return d};h.getField=function(a){return this.fieldsIndex.get(a)};h.getFeatureType=function(a){const {typeIdField:b,types:d}=this;if(!b||!a)return null;const x=a.attributes?a.attributes[b]:void 0;if(null==x)return null;let y=null;d?.some(X=>{const {id:na}=X;if(null==na)return!1;na.toString()===x.toString()&&(y=X);return!!y});return y};h.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&
"inherited"!==b.type?b:this._getLayerDomain(a)};h.queryAttachments=async function(a,b){await this.load();a=U.from(a);const d=this.capabilities;if(!d?.data?.supportsAttachment)throw new N("queryAttachments:not-supported","this layer doesn't support attachments");const {attachmentTypes:x,objectIds:y,globalIds:X,num:na,size:ya,start:za,where:wa}=a;if(!d?.operations?.supportsQueryAttachments&&(0<x?.length||0<X?.length||0<ya?.length||na||za||wa))throw new N("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",
a);if(!(y?.length||X?.length||wa))throw new N("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",a);return this.queryTask.executeAttachmentQuery(a,b)};h.queryFeatures=async function(a=this.createQuery(),b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new N("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new N("queryFeatures:not-supported","this layer has no url.");a=await this.queryTask.execute(a,
{...b,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(a?.features)for(const d of a.features)d.sourceLayer=this;return a};h.toExportImageJSON=function(a){const b={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:"mapLayer"}};a=B.sqlAnd(a,this.definitionExpression);t.isSome(a)&&(b.definitionExpression=a);const d=["renderer","labelingInfo","opacity","labelsVisible"].reduce((x,y)=>{x[y]=this.originIdOf(y);return x},{});if(Object.keys(d).some(x=>d[x]>H.OriginId.SERVICE)){a=
b.drawingInfo={};d.renderer>H.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null);d.labelsVisible>H.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&d.labelingInfo>H.OriginId.SERVICE){!this.loaded&&this.labelingInfo.some(y=>!y.labelPlacement)&&W.getLogger(this.declaredClass).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",
{sublayer:this});let x=this.labelingInfo;t.isSome(this.geometryType)&&(x=f.validateLabelingInfo(this.labelingInfo,ja.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));a.labelingInfo=x.filter(y=>y.labelPlacement).map(y=>y.toJSON({origin:"service",layer:this.layer}));a.showLabels=!0}d.opacity>H.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return b};h._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,b=>{b.color||
"esriSMSX"!==b.style&&"esriSMSCross"!==b.style||(b.color=b.outline&&b.outline.color?b.outline.color:[0,0,0,0])})};h._forEachSimpleMarkerSymbols=function(a,b){if(a){const d=("uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:null)??[];for(const x of d)ta(x.symbol)&&b(x.symbol);"symbol"in a&&ta(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&ta(a.defaultSymbol)&&b(a.defaultSymbol)}};h._setAndNotifyLayer=function(a,b){const d=this.layer,x=this._get(a);let y,X;switch(a){case "definitionExpression":case "floorInfo":y=
"supportsSublayerDefinitionExpression";break;case "minScale":case "maxScale":case "visible":y="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":y="supportsDynamicLayers",X="supportsModification"}const na=I.getProperties(this).getDefaultOrigin();if("service"!==na){if(y&&!1===this.layer?.capabilities?.exportMap?.[y]){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${y}'`);return}if(X&&!1===this.capabilities?.exportMap[X]){this._logLockedError(a,
`capability not available 'capabilities.exportMap.${X}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),"service"!==na&&x!==b&&d&&d.emit&&d.emit("sublayer-update",{propertyName:a,target:this}))};h._handleSublayersChange=function(a,b){b&&(b.forEach(d=>{d.parent=null;d.layer=null}),this.handles.removeAll());a&&(a.forEach(d=>{d.parent=this;d.layer=this.layer}),this.handles.add([a.on("after-add",({item:d})=>
{d.parent=this;d.layer=this.layer}),a.on("after-remove",({item:d})=>{d.parent=null;d.layer=null}),a.on("before-changes",d=>{const x=this.layer?.capabilities?.exportMap?.supportsSublayersChanges;null==x||x||(W.getLogger(this.declaredClass).error(new N("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),d.preventDefault())})]))};h._logLockedError=function(a,b){const {layer:d,declaredClass:x}=this;W.getLogger(x).error(new N("sublayer:locked",
`Property '${String(a)}' can't be changed on Sublayer from the layer '${d?.id}'`,{reason:b,sublayer:this,layer:d}))};h._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};n._createClass(V,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new pa(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",
a)}},{key:"id",get:function(){const a=this._get("id");return null==a?xa++:a},set:function(a){this._get("id")!==a&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",
a);this.sublayers&&this.sublayers.forEach(b=>b.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:b}=this;return{minScale:a,maxScale:b}}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"queryTask",get:function(){if(!this.layer)return null;const {spatialReference:a}=
this.layer,b="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:d,fieldsIndex:x}=this,y=p("featurelayer-pbf")&&d?.query.supportsFormatPBF;return new oa({url:this.url,pbfSupported:y,fieldsIndex:x,gdbVersion:b,sourceSpatialReference:a,queryAttachmentsSupported:d?.operations?.supportsQueryAttachments??!1})}},{key:"renderer",set:function(a){if(a)for(const b of a.getSymbols())if(G.isSymbol3D(b)){W.getLogger(this.declaredClass).warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",
a)}},{key:"source",get:function(){return this._get("source")||new P.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){const a=this.layer?.parsedUrl??this._lastParsedUrl;var b=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===b?.type)return`${a.path}/${b.mapLayerId}`;b={layer:JSON.stringify({source:this.source})};
return`${a.path}/dynamicLayer?${R.objectToQuery(b)}`},set:function(a){this._overrideIfSome("url",a)}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return V}(l.HandleOwnerMixin(A.MultiOriginJSONMixin(m.IdentifiableMixin(w))));e.test={isMapImageLayerOverridePolicy:h=>h===ba||h===ua,isTileImageLayerOverridePolicy:h=>h===va};c.__decorate([r.property({readOnly:!0})],e.prototype,"capabilities",void 0);c.__decorate([S.reader("service","capabilities",["layerDefinition.canModifyLayer",
"layerDefinition.capabilities"])],e.prototype,"readCapabilities",null);c.__decorate([r.property()],e.prototype,"defaultPopupTemplate",null);c.__decorate([r.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:ua}}})],e.prototype,"definitionExpression",null);c.__decorate([r.property({type:[T],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],e.prototype,"fields",void 0);c.__decorate([r.property({readOnly:!0})],e.prototype,
"fieldsIndex",null);c.__decorate([r.property({type:E,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:ua},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"floorInfo",null);c.__decorate([r.property({type:fa,json:{read:{source:"layerDefinition.extent"}}})],e.prototype,"fullExtent",void 0);c.__decorate([r.property({type:ja.featureGeometryTypeKebabDictionary.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",
read:{reader:ja.featureGeometryTypeKebabDictionary.read}}}}})],e.prototype,"geometryType",void 0);c.__decorate([r.property({type:String})],e.prototype,"globalIdField",void 0);c.__decorate([S.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],e.prototype,"readGlobalIdFieldFromService",null);c.__decorate([r.property({type:aa.Integer,json:{write:{ignoreOrigin:!0}}})],e.prototype,"id",null);c.__decorate([r.property({value:null,type:[sa],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ba}}})],e.prototype,"labelingInfo",null);c.__decorate([Z.writer("labelingInfo")],e.prototype,"writeLabelingInfo",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ba}}})],e.prototype,"labelsVisible",null);c.__decorate([r.property({value:null})],e.prototype,"layer",null);c.__decorate([r.property({type:Boolean,
value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:qa}}})],e.prototype,"legendEnabled",void 0);c.__decorate([r.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],e.prototype,"listMode",null);c.__decorate([r.property({type:Number,value:0,json:{write:{overridePolicy:ba}}})],e.prototype,"minScale",null);c.__decorate([S.reader("minScale",["minScale","layerDefinition.minScale"])],
e.prototype,"readMinScale",null);c.__decorate([r.property({type:Number,value:0,json:{write:{overridePolicy:ba}}})],e.prototype,"maxScale",null);c.__decorate([S.reader("maxScale",["maxScale","layerDefinition.maxScale"])],e.prototype,"readMaxScale",null);c.__decorate([r.property({readOnly:!0})],e.prototype,"effectiveScaleRange",null);c.__decorate([r.property({type:String})],e.prototype,"objectIdField",void 0);c.__decorate([S.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
e.prototype,"readObjectIdFieldFromService",null);c.__decorate([r.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ba}}})],e.prototype,"opacity",null);c.__decorate([S.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],e.prototype,"readOpacity",null);c.__decorate([Z.writer("opacity")],e.prototype,"writeOpacity",null);c.__decorate([r.property({json:{type:aa.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,
overridePolicy:ba}}})],e.prototype,"parent",void 0);c.__decorate([Z.writer("parent")],e.prototype,"writeParent",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(h,V){return!V.disablePopup}},write:{target:"disablePopup",overridePolicy:qa,writer(h,V,Q){V[Q]=!h}}}})],e.prototype,"popupEnabled",void 0);c.__decorate([r.property({type:z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:qa}}})],e.prototype,"popupTemplate",void 0);c.__decorate([r.property({readOnly:!0})],
e.prototype,"queryTask",null);c.__decorate([r.property({types:D.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ba},origins:{"web-scene":{types:D.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ba}}}}})],e.prototype,"renderer",null);c.__decorate([r.property({types:{key:"type",base:null,typeMap:{"data-layer":K.DataLayerSource,"map-layer":P.MapLayerSource}},cast(h){if(h){if("mapLayerId"in h)return aa.ensureClass(P.MapLayerSource,
h);if("dataSource"in h)return aa.ensureClass(K.DataLayerSource,h)}return h},json:{name:"layerDefinition.source",write:{overridePolicy:ba}}})],e.prototype,"source",null);c.__decorate([r.property()],e.prototype,"sourceJSON",void 0);c.__decorate([r.property({value:null,json:{type:[aa.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ba}}})],e.prototype,"sublayers",null);c.__decorate([O.cast("sublayers")],e.prototype,"castSublayers",null);c.__decorate([Z.writer("sublayers")],e.prototype,
"writeSublayers",null);c.__decorate([r.property({type:String,json:{name:"name",write:{overridePolicy:qa}}})],e.prototype,"title",void 0);c.__decorate([r.property({type:String})],e.prototype,"typeIdField",void 0);c.__decorate([S.reader("typeIdField",["layerDefinition.typeIdField"])],e.prototype,"readTypeIdField",null);c.__decorate([r.property({type:[la],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],e.prototype,"types",void 0);c.__decorate([r.property({type:String,json:{read:{source:"layerUrl"},
write:{target:"layerUrl",overridePolicy:va}}})],e.prototype,"url",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ba}}})],e.prototype,"visible",null);c.__decorate([Z.writer("visible")],e.prototype,"writeVisible",null);return e=ra=c.__decorate([da.subclass("esri.layers.support.Sublayer")],e)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/maybe","../../core/accessorSupport/PropertyOrigin"],
function(u,n,c){function e(z,k){if(!z||!z.length||n.isNone(k))return!0;k=k.slice().reverse().flatten(({sublayers:C})=>C&&C.toArray().reverse()).map(C=>C.id).toArray();if(z.length>k.length)return!1;let v=0;const g=k.length;for(const {id:C}of z){for(;v<g&&k[v]!==C;)v++;if(v>=g)return!1}return!0}u.isExportDynamic=function(z,k,v){return z.some(g=>{const C=g.source;return!(!C||"map-layer"===C.type&&C.mapLayerId===g.id&&(n.isNone(C.gdbVersion)||C.gdbVersion===v))||g.originIdOf("renderer")>c.OriginId.SERVICE||
g.originIdOf("labelingInfo")>c.OriginId.SERVICE||g.originIdOf("opacity")>c.OriginId.SERVICE||g.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!e(z,k)};u.isSublayerOverhaul=function(z){return!!z&&z.some(k=>null!=k.minScale||k.layerDefinition&&null!=k.layerDefinition.minScale)};u.shouldWriteSublayerStructure=function(z,k,v){return k.flatten(({sublayers:g})=>g).length!==z.length||z.some(g=>g.originIdOf("minScale")>v||g.originIdOf("maxScale")>v||g.originIdOf("renderer")>v||g.originIdOf("labelingInfo")>
v||g.originIdOf("opacity")>v||g.originIdOf("labelsVisible")>v||g.originIdOf("source")>v)?!0:!e(z,k)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/sql ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./commonProperties ./floorFilterUtils ./sublayerUtils".split(" "),
function(u,n,c,e,z,k,v,g,C,ca,F,ha,ka,ia,D){const Y={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};u.ExportImageParameters=function(G){function L(l){l=N.call(this,l);l.floors=null;l.scale=0;return l}n._inherits(L,G);var N=n._createSuper(L);G=L.prototype;G.destroy=function(){this.layer=
null};G.toJSON=function(){var l=this.layer;l={dpi:l.dpi,format:l.imageFormat,transparent:l.imageTransparency,gdbVersion:l.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?l.dynamicLayers=this.dynamicLayers:l={...l,layers:this.layers,layerDefs:this.layerDefs};return l};n._createClass(L,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const l=this.visibleSublayers.map(p=>{const m=ia.getLayerFloorFilterClause(this.floors,p);return p.toExportImageJSON(m)});return l.length?
JSON.stringify(l):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&D.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(l){this._get("layer")!==l&&(this._set("layer",l),this.handles.remove("layer"),l&&this.handles.add([l.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),l.on("sublayer-update",p=>this.notifyChange(Y[p.propertyName]))],"layer"))}},{key:"layers",get:function(){const l=this.visibleSublayers;
return l?l.length?"show:"+l.map(p=>p.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){const l=!!this.floors?.length,p=this.visibleSublayers.filter(m=>null!=m.definitionExpression||l&&null!=m.floorInfo);return p.length?JSON.stringify(p.reduce((m,q)=>{var w=ia.getLayerFloorFilterClause(this.floors,q);w=v.sqlAnd(w,q.definitionExpression);k.isSome(w)&&(m[q.id]=w);return m},{})):null}},{key:"version",get:function(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");
this.commitProperty("timeExtent");const l=this.layer;l&&(l.commitProperty("dpi"),l.commitProperty("imageFormat"),l.commitProperty("imageTransparency"),l.commitProperty("gdbVersion"));return(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){const l=[];if(!this.layer)return l;var p=this.layer.sublayers;const m=q=>{const w=this.scale,W=0===q.minScale||w<=q.minScale,t=0===q.maxScale||w>=q.maxScale;q.visible&&(0===w||W&&t)&&(q.sublayers?q.sublayers.forEach(m):l.unshift(q))};p&&p.forEach(m);
p=this._get("visibleSublayers");return!p||p.length!==l.length||p.some((q,w)=>l[w]!==q)?l:p}}]);return L}(z.HandleOwnerMixin(e));c.__decorate([g.property({readOnly:!0})],u.ExportImageParameters.prototype,"dynamicLayers",null);c.__decorate([g.property()],u.ExportImageParameters.prototype,"floors",void 0);c.__decorate([g.property({readOnly:!0})],u.ExportImageParameters.prototype,"hasDynamicLayers",null);c.__decorate([g.property()],u.ExportImageParameters.prototype,"layer",null);c.__decorate([g.property({readOnly:!0})],
u.ExportImageParameters.prototype,"layers",null);c.__decorate([g.property({readOnly:!0})],u.ExportImageParameters.prototype,"layerDefs",null);c.__decorate([g.property({type:Number})],u.ExportImageParameters.prototype,"scale",void 0);c.__decorate([g.property(ka.combinedViewLayerTimeExtentProperty)],u.ExportImageParameters.prototype,"timeExtent",void 0);c.__decorate([g.property({readOnly:!0})],u.ExportImageParameters.prototype,"version",null);c.__decorate([g.property({readOnly:!0})],u.ExportImageParameters.prototype,
"visibleSublayers",null);u.ExportImageParameters=c.__decorate([ha.subclass("esri.layers.mixins.ExportImageParameters")],u.ExportImageParameters);Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(u){function n(c,e){if(!c?.length)return null;c=c.filter(z=>""!==z).map(z=>`'${z}'`);c.push("''");return`${e} IN (${c.join(",")}) OR ${e} IS NULL`}u.getFloorFilterClause=function(c){const e=c.layer;return"floorInfo"in
e&&e.floorInfo?.floorField&&"floors"in c.view?n(c.view.floors,e.floorInfo.floorField):null};u.getLayerFloorFilterClause=function(c,e){return"floorInfo"in e&&e.floorInfo?.floorField?n(c,e.floorInfo.floorField):null};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageBitmapUtils":function(){define(["exports","../../core/Error"],function(u,n){u.createBitmap=async function(c,e){try{return await createImageBitmap(c)}catch(z){throw new n("request:server",`Unable to load ${e}`,
{url:e,error:z});}};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../TimeExtent ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ../geometry/Extent ../geometry/support/scaleUtils ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/imageBitmapUtils ./support/Sublayer ./support/sublayerUtils ./support/versionUtils ../time/TimeReference".split(" "),function(u,
n,c,e,z,k,v,g,C,ca,F,ha,ka,ia,D,Y,G,L,N,l,p,m,q,w,W,t,A,B,R,r,O,S,da,Z,aa,H,I,oa,la){k=function(T){function pa(...f){f=sa.call(this,...f);f.dateFieldsTimeReference=null;f.datesInUnknownTimezone=!1;f.dpi=96;f.gdbVersion=null;f.imageFormat="png24";f.imageMaxHeight=2048;f.imageMaxWidth=2048;f.imageTransparency=!0;f.isReference=null;f.labelsVisible=!1;f.operationalLayerType="ArcGISMapServiceLayer";f.preferredTimeReference=null;f.sourceJSON=null;f.sublayers=null;f.type="map-image";f.url=null;return f}
u._inherits(pa,T);var sa=u._createSuper(pa);T=pa.prototype;T.normalizeCtorArgs=function(f,E){return"string"===typeof f?{url:f,...E}:f};T.load=function(f){const E=g.isSome(f)?f.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},f).catch(ca.throwIfAbortError).then(()=>this._fetchService(E)));return Promise.resolve(this)};T.readImageFormat=function(f,E){return(f=E.supportedImageFormatTypes)&&f.includes("PNG32")?"png32":"png24"};T.writeSublayers=function(f,E,J,K){if(this.loaded&&
f){f=f.slice().reverse().flatten(({sublayers:M})=>M&&M.toArray().reverse()).toArray();J=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap?.supportsDynamicLayers){const M=L.nameToId(K.origin);M===L.OriginId.PORTAL_ITEM?(J=this.createSublayersForOrigin("service").sublayers,J=I.shouldWriteSublayerStructure(f,J,L.OriginId.SERVICE)):M>L.OriginId.PORTAL_ITEM&&(J=this.createSublayersForOrigin("portal-item"),J=I.shouldWriteSublayerStructure(f,J.sublayers,
L.nameToId(J.origin)))}var P=[],U={writeSublayerStructure:J,...K},ea=J;f.forEach(M=>{const fa=M.write({},U);P.push(fa);ea=ea||"user"===M.originOf("visible")});P.some(M=>1<Object.keys(M).length)&&(E.layers=P);ea&&(E.visibleLayers=f.filter(M=>M.visible).map(M=>M.id))}};T.createExportImageParameters=function(f,E,J,K){var P=K&&K.pixelRatio||1;f&&10<=this.version&&(f=f.clone().shiftCentralMeridian());var U=new Z.ExportImageParameters({layer:this,floors:K?.floors,scale:l.getScale({extent:f,width:E})*P});
const ea=U.toJSON();U.destroy();U=!K||!K.rotation||10.3>this.version?{}:{rotation:-K.rotation};var M=f&&f.spatialReference;M=M.wkid||JSON.stringify(M.toJSON());ea.dpi*=P;P={};if(K?.timeExtent){const {start:fa,end:ja}=K.timeExtent.toJSON();P.time=fa&&ja&&fa===ja?""+fa:`${null==fa?"null":fa},${null==ja?"null":ja}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(P.time="null,null");return{bbox:f&&f.xmin+","+f.ymin+","+f.xmax+","+f.ymax,bboxSR:M,imageSR:M,size:E+","+J,...ea,...U,...P}};T.fetchImage=
async function(f,E,J,K){({data:f}=await this._fetchImage("image",f,E,J,K));return f};T.fetchImageBitmap=async function(f,E,J,K){const {data:P,url:U}=await this._fetchImage("blob",f,E,J,K);return aa.createBitmap(P,U)};T.fetchRecomputedExtents=async function(f={}){({data:f}=await c(this.url,{...f,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}}));const {extent:E,fullExtent:J,timeExtent:K}=f;f=E||J;return{fullExtent:f&&N.fromJSON(f),timeExtent:K&&e.fromJSON({start:K[0],end:K[1]})}};
T.loadAll=function(){return v.loadAll(this,f=>{f(this.allSublayers)})};T.serviceSupportsSpatialReference=function(f){return oa.serviceSupportsSpatialReference(this,f)};T._fetchImage=async function(f,E,J,K,P){f={responseType:f,signal:P?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(E,J,K,P),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}};E=this.parsedUrl.path+"/export";if(null!=f.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new z("mapimagelayer:dynamiclayer-not-supported",
`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:f.query});try{const {data:U}=await c(E,f);return{data:U,url:E}}catch(U){if(ca.isAbortError(U))throw U;throw new z("mapimagelayer:image-fetch-error",`Unable to load image: ${E}`,{error:U});}};T._fetchService=async function(f){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:E,ssl:J}=await c(this.parsedUrl.path,
{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:f});J&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=E;this.read(E,{origin:"service",url:this.parsedUrl})}};return u._createClass(pa)}(W.BlendLayer(S.TemporalLayer(r.ScaleRangeLayer(O.SublayersOwner(q.ArcGISMapService(w.ArcGISService(A.OperationalLayer(B.PortalLayer(C.MultiOriginJSONMixin(R.RefreshableLayer(m.APIKeyMixin(t.CustomParametersMixin(k.HandleOwnerMixin(p))))))))))))));n.__decorate([F.property({type:la})],
k.prototype,"dateFieldsTimeReference",void 0);n.__decorate([F.property({type:Boolean})],k.prototype,"datesInUnknownTimezone",void 0);n.__decorate([F.property()],k.prototype,"dpi",void 0);n.__decorate([F.property()],k.prototype,"gdbVersion",void 0);n.__decorate([F.property()],k.prototype,"imageFormat",void 0);n.__decorate([D.reader("imageFormat",["supportedImageFormatTypes"])],k.prototype,"readImageFormat",null);n.__decorate([F.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],
k.prototype,"imageMaxHeight",void 0);n.__decorate([F.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],k.prototype,"imageMaxWidth",void 0);n.__decorate([F.property()],k.prototype,"imageTransparency",void 0);n.__decorate([F.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],k.prototype,"isReference",void 0);n.__decorate([F.property({json:{read:!1,write:!1}})],k.prototype,"labelsVisible",void 0);n.__decorate([F.property({type:["ArcGISMapServiceLayer"]})],
k.prototype,"operationalLayerType",void 0);n.__decorate([F.property({json:{read:!1,write:!1}})],k.prototype,"popupEnabled",void 0);n.__decorate([F.property({type:la})],k.prototype,"preferredTimeReference",void 0);n.__decorate([F.property()],k.prototype,"sourceJSON",void 0);n.__decorate([F.property({json:{write:{ignoreOrigin:!0}}})],k.prototype,"sublayers",void 0);n.__decorate([G.writer("sublayers",{layers:{type:[H]},visibleLayers:{type:[ha.Integer]}})],k.prototype,"writeSublayers",null);n.__decorate([F.property({type:["show",
"hide","hide-children"]})],k.prototype,"listMode",void 0);n.__decorate([F.property({json:{read:!1},readOnly:!0,value:"map-image"})],k.prototype,"type",void 0);n.__decorate([F.property(da.url)],k.prototype,"url",void 0);return k=n.__decorate([Y.subclass("esri.layers.MapImageLayer")],k)});