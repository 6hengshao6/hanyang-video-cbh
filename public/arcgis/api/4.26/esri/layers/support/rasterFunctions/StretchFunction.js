// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./pixelUtils ./StretchFunctionArguments ./stretchUtils".split(" "),function(t,h,v,m,d,B,C,w,x,y,z,k){d=function(n){function q(){var a=A.apply(this,arguments);a.functionName="Stretch";a.functionArguments=
null;a.rasterArgumentNames=["raster"];a.lookup=null;a.cutOffs=null;return a}t._inherits(q,n);var A=t._createSuper(q);n=q.prototype;n._bindSourceRasters=function(){this.cutOffs=this.lookup=null;var a=this.sourceRasterInfos[0];const {pixelType:c}=a;var {functionArguments:b}=this;const {dynamicRangeAdjustment:e,gamma:l,useGamma:r}=b;if(!e&&["u8","u16","s8","s16"].includes(c)){b=k.getStretchCutoff(b.toJSON(),{rasterInfo:a});const f=this._isOutputRoundingNeeded()?"round":"float";this.lookup=k.createStretchLUT({pixelType:c,
...b,gamma:r?l:null,rounding:f});this.cutOffs=b}else e||(this.cutOffs=k.getStretchCutoff(b.toJSON(),{rasterInfo:a}));this.outputPixelType=this._getOutputPixelType(c);a=a.clone();a.pixelType=this.outputPixelType;a.statistics=null;a.histograms=null;a.colormap=null;a.attributeTable=null;"u8"===this.outputPixelType&&(a.keyProperties.DataType="processed");this.rasterInfo=a;return{success:!0,supportsGPU:!e}};n._processPixels=function(a){a=a.pixelBlocks?.[0];if(v.isNone(a))return a;var {lookup:c}=this;if(c)return y.lookupPixels(a,
{...c,outputPixelType:this.rasterInfo.pixelType});({functionArguments:c}=this);const b=this.cutOffs||k.getStretchCutoff(c.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:a});return k.stretch(a,{...b,gamma:c.useGamma?c.gamma:null,outputPixelType:this.outputPixelType})};n._getWebGLParameters=function(){const {outputMin:a=0,outputMax:c=255,gamma:b,useGamma:e}=this.functionArguments,l=2<=this.rasterInfo.bandCount?3:1,r=e&&b&&b.length?k.computeGammaCorrection(l,b):[1,1,1],{minCutOff:f,maxCutOff:p}=
this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===f.length&&(f[1]=f[2]=f[0],p[1]=p[2]=p[0]);const u=new Float32Array(l);var g;for(g=0;g<l;g++)u[g]=(c-a)/(p[g]-f[g]);g=this._isOutputRoundingNeeded();return{bandCount:l,outMin:a,outMax:c,minCutOff:f,maxCutOff:p,factor:u,useGamma:e,gamma:e&&b?b:[1,1,1],gammaCorrection:e&&r?r:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:g,type:"stretch"}};return t._createClass(q)}(x);h.__decorate([m.property({json:{write:!0,name:"rasterFunction"}})],
d.prototype,"functionName",void 0);h.__decorate([m.property({type:z,json:{write:!0,name:"rasterFunctionArguments"}})],d.prototype,"functionArguments",void 0);h.__decorate([m.property()],d.prototype,"rasterArgumentNames",void 0);h.__decorate([m.property({json:{write:!0}})],d.prototype,"lookup",void 0);h.__decorate([m.property({json:{write:!0}})],d.prototype,"cutOffs",void 0);return d=h.__decorate([w.subclass("esri.layers.support.rasterFunctions.StretchFunction")],d)});