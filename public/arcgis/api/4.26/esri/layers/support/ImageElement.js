// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/maybe ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./MediaElementBase ../../portal/support/resourceExtension ../../chunks/persistableUrlUtils".split(" "),
function(r,k,t,y,z,h,A,u,g,I,J,B,C,D,E,F,l){async function v(b){if("string"===typeof b){if(h.isBlobProtocol(b)){var {data:f}=await t(b,{responseType:"blob"});return f}if(h.isDataProtocol(b))return h.dataToBlob(b);f=await t(b,{responseType:"image"});return v(f.data)}return new Promise(m=>{if(b instanceof HTMLCanvasElement)var a=b;else{a=b instanceof HTMLImageElement?b.naturalWidth:b.width;var e=b instanceof HTMLImageElement?b.naturalHeight:b.height,d=document.createElement("canvas"),c=d.getContext("2d");
d.width=a;d.height=e;b instanceof HTMLImageElement?c.drawImage(b,0,0,b.width,b.height):b instanceof ImageData&&c.putImageData(b,0,0);a=d}return a.toBlob(m)})}function G(b,f){const m=A.generateUUID();b=`${h.join("media",m)}.${F.getResourceContentExtension(b)}`;return f.resourceFromPath(b)}g=function(b){function f(a){a=m.call(this,a);a.content=null;a.image=null;a.type="image";a.image=null;return a}r._inherits(f,b);var m=r._createSuper(f);b=f.prototype;b.load=function(){const a=this.image;if("string"===
typeof a){var e=t(a,{responseType:"image"}).then(({data:d})=>{this._set("content",d)});this.addResolvingPromise(e)}else a instanceof HTMLImageElement?(e=a.decode().then(()=>{this._set("content",a)}),this.addResolvingPromise(e)):a?this._set("content",a):this.addResolvingPromise(Promise.reject(new y("image-element:invalid-image-type","Invalid image type",{image:a})));return Promise.resolve(this)};b.readImage=function(a,e,d){return l.fromJSON(e.url,d)};b.writeImage=function(a,e,d,c){if(!z.isNone(a)){var n=
c?.portalItem,p=c?.resources;if(n&&p){var q="string"!==typeof a||h.isDataProtocol(a)||h.isBlobProtocol(a)?null:a;if(q){if(null==l.itemIdFromResourceUrl(q)){e[d]=q;return}c=l.toJSON(q,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},l.MarkKeep.NO);if(n&&c&&!h.isAbsolute(c)){p.toKeep.push({resource:n.resourceFromPath(c),compress:!1});e[d]=c;return}}e[d]="\x3cpending\x3e";p.pendingOperations.push(v(a).then(w=>{const x=
G(w,n);e[d]=x.itemRelativeUrl;p.toAdd.push({resource:x,content:w,compress:!1,finish:H=>{this.image=H.url}})}))}else"string"===typeof a&&(e[d]=l.toJSON(a,c))}};return r._createClass(f)}(E);k.__decorate([u.property({readOnly:!0})],g.prototype,"content",void 0);k.__decorate([u.property({json:{name:"url",type:String}})],g.prototype,"image",void 0);k.__decorate([B.reader("image",["url"])],g.prototype,"readImage",null);k.__decorate([D.writer("image")],g.prototype,"writeImage",null);k.__decorate([u.property({readOnly:!0,
json:{name:"mediaType"}})],g.prototype,"type",void 0);return g=k.__decorate([C.subclass("esri.layers.support.ImageElement")],g)});