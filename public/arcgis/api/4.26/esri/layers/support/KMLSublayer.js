// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/Collection ../../core/Evented ../../core/JSONSupport ../../core/Loadable ../../core/maybe ../../core/reactiveUtils ../../core/string ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./kmlUtils ../../geometry/Extent".split(" "),function(k,d,
c,q,u,v,w,x,g,y,f,z,D,E,A,B,p,r){var l;c=l=function(h){function m(...b){var a=C.call(this,...b);a.description=null;a.id=null;a.networkLink=null;a.sublayers=null;a.title=null;a.sourceJSON=null;a.fullExtent=null;a.addHandles([g.on(()=>a.sublayers,"after-add",({item:e})=>{e.parent=k._assertThisInitialized(a);e.layer=a.layer},g.sync),g.on(()=>a.sublayers,"after-remove",({item:e})=>{e.layer=e.parent=null},g.sync),g.watch(()=>a.sublayers,(e,t)=>{if(t)for(const n of t)n.layer=n.parent=null;if(e)for(const n of e)n.parent=
k._assertThisInitialized(a),n.layer=a.layer},g.sync)]);return a}k._inherits(m,h);var C=k._createSuper(m);h=m.prototype;h.initialize=function(){g.whenOnce(()=>this.networkLink).then(()=>g.whenOnce(()=>!0===this.visible)).then(()=>this.load())};h.load=function(b){if(this.networkLink&&!this.networkLink.viewFormat)return b=x.isSome(b)?b.signal:null,b=this._fetchService(this._get("networkLink")?.href??"",b).then(a=>{const e=p.computeExtent(a.sublayers);this.fullExtent=r.fromJSON(e);this.sourceJSON=a;a=
z.ensureType(q.ofType(l),p.sublayersFromJSON(l,a));this.sublayers?this.sublayers.addMany(a):this.sublayers=a;this.layer?.emit("sublayer-update");this.layer&&this.layer.notifyChange("visibleSublayers")}),this.addResolvingPromise(b),Promise.resolve(this)};h.readVisible=function(b,a){return!!a.visibility};h._fetchService=function(b,a){return p.fetchService(b,this.layer.outSpatialReference,this.layer.refreshInterval,a).then(e=>p.parseKML(e.data))};k._createClass(m,[{key:"visible",get:function(){return this._get("visible")},
set:function(b){this._get("visible")!==b&&(this._set("visible",b),this.layer&&this.layer.notifyChange("visibleSublayers"))}},{key:"layer",set:function(b){this._set("layer",b);this.sublayers&&this.sublayers.forEach(a=>a.layer=b)}}]);return m}(u.EventedMixin(v.JSONSupportMixin(w)));d.__decorate([f.property()],c.prototype,"description",void 0);d.__decorate([f.property()],c.prototype,"id",void 0);d.__decorate([f.property({readOnly:!0,value:null})],c.prototype,"networkLink",void 0);d.__decorate([f.property({json:{write:{allowNull:!0}}})],
c.prototype,"parent",void 0);d.__decorate([f.property({type:q.ofType(l),json:{write:{allowNull:!0}}})],c.prototype,"sublayers",void 0);d.__decorate([f.property({value:null,json:{read:{source:"name",reader(h){return y.stripHTML(h)}}}})],c.prototype,"title",void 0);d.__decorate([f.property({value:!0})],c.prototype,"visible",null);d.__decorate([A.reader("visible",["visibility"])],c.prototype,"readVisible",null);d.__decorate([f.property()],c.prototype,"sourceJSON",void 0);d.__decorate([f.property({value:null})],
c.prototype,"layer",null);d.__decorate([f.property({type:r})],c.prototype,"fullExtent",void 0);return c=l=d.__decorate([B.subclass("esri.layers.support.KMLSublayer")],c)});