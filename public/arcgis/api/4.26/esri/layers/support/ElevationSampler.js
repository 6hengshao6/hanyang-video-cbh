// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),function(n,l,p,v,z,t,A,q,B,C){function w(b,e){const g=x(b,e.spatialReference);if(!g)return null;switch(b.type){case "point":b.z=e.elevationAt(g.x,g.y);break;case "polyline":h.spatialReference=g.spatialReference;var a=b.hasM&&!b.hasZ;for(var c=0;c<b.paths.length;c++){var f=
b.paths[c],d=g.paths[c];for(let k=0;k<f.length;k++){const m=f[k],r=d[k];h.x=r[0];h.y=r[1];a&&(m[3]=m[2]);m[2]=e.elevationAt(h.x,h.y)}}b.hasZ=!0;break;case "multipoint":h.spatialReference=g.spatialReference;a=b.hasM&&!b.hasZ;for(c=0;c<b.points.length;c++)f=b.points[c],d=g.points[c],h.x=d[0],h.y=d[1],a&&(f[3]=f[2]),f[2]=e.elevationAt(h.x,h.y);b.hasZ=!0}return b}function x(b,e){if(t.isNone(b))return null;const g=b.spatialReference;if(g.equals(e))return b;(b=B.project(b,e))||u.error(`Cannot project geometry spatial reference (wkid:${g.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`);
return b}const u=z.getLogger("esri.layers.support.ElevationSampler");p=function(){function b(){}var e=b.prototype;e.queryElevation=function(g){return w(g.clone(),this)};e.on=function(){return D};e.projectIfRequired=function(g,a){return x(g,a)};return l._createClass(b)}();let y=function(b){function e(a,c,f){var d=g.call(this);d.tile=a;d.noDataValue=f;f=a.tile.extent;d.extent=q.toExtent(f,c.spatialReference);d.extent.zmin=a.zmin;d.extent.zmax=a.zmax;d._aaExtent=f;f=A.getMetersPerUnitForSR(c.spatialReference);
a=c.lodAt(a.tile.level).resolution*f;d.demResolution={min:a,max:a};return d}l._inherits(e,b);var g=l._createSuper(e);b=e.prototype;b.contains=function(a){a=this.projectIfRequired(a,this.spatialReference);return t.isNone(a)?!1:this.containsAt(a.x,a.y)};b.containsAt=function(a,c){return q.containsXY(this._aaExtent,a,c)};b.elevationAt=function(a,c){if(!this.containsAt(a,c)){const f=this.extent;u.warn("#elevationAt()",`Point used to sample elevation (${a}, ${c}) is outside of the sampler extent (${`${f.xmin}, ${f.ymin}, ${f.xmax}, ${f.ymax}`})`);
return this.noDataValue}return t.unwrapOr(this.tile.sample(a,c),this.noDataValue)};l._createClass(e,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return e}(p);v=function(b){function e(a,c,f){var d=g.call(this);let k;"number"===typeof c?(d.noDataValue=c,k=null):(k=c,d.noDataValue=f);d.samplers=k?a.map(m=>new y(m,k,d.noDataValue)):a;if(a=d.samplers[0]){d.extent=a.extent.clone();const {min:m,max:r}=a.demResolution;d.demResolution={min:m,max:r};for(a=1;a<d.samplers.length;a++)c=
d.samplers[a],d.extent.union(c.extent),d.demResolution.min=Math.min(d.demResolution.min,c.demResolution.min),d.demResolution.max=Math.max(d.demResolution.max,c.demResolution.max)}else d.extent=q.toExtent(q.create(),k.spatialReference),d.demResolution={min:0,max:0};return d}l._inherits(e,b);var g=l._createSuper(e);e.prototype.elevationAt=function(a,c){for(const f of this.samplers)if(f.containsAt(a,c))return f.elevationAt(a,c);u.warn("#elevationAt()",`Point used to sample elevation (${a}, ${c}) is outside of the sampler`);
return this.noDataValue};l._createClass(e,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return e}(p);const h=new C,D={remove(){}};n.ElevationSamplerBase=p;n.MultiTileElevationSampler=v;n.TileElevationSampler=y;n.updateGeometryElevation=w;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});