// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(z,l,y,h,E,F,m,A,L,M,B,G,H,r,C,D,w,I,q,J){var p;y=new y.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});h=p=function(e){function t(a){a=K.call(this,a);a.dpi=96;a.format=null;a.origin=null;a.minScale=0;a.maxScale=0;a.size=null;a.spatialReference=null;return a}z._inherits(t,e);var K=z._createSuper(t);t.create=
function(a={}){const {resolutionFactor:b=1,scales:c,size:d=256,spatialReference:f=C.WebMercator,numLODs:g=24}=a;if(!w.isValid(f)){a=[];if(c)for(var k=0;k<c.length;k++){var n=c[k];a.push(new q({level:k,scale:n,resolution:n}))}else for(k=5E-4,n=g-1;0<=n;n--)a.unshift(new q({level:n,scale:k,resolution:k})),k*=2;return new p({dpi:96,lods:a,origin:new r(0,0,f),size:[d,d],spatialReference:f})}k=w.getInfo(f);a=a.origin?new r({x:a.origin.x,y:a.origin.y,spatialReference:f}):k?new r({x:k.origin[0],y:k.origin[1],
spatialReference:f}):new r({x:0,y:0,spatialReference:f});k=1/(39.37*F.getMetersPerUnitForSR(f)*96);n=[];if(c)for(var u=0;u<c.length;u++){var v=c[u];n.push(new q({level:u,scale:v,resolution:v*k}))}else{var x=w.isGeographic(f)?512/d*5.916575275917094E8:256/d*5.91657527591555E8;u=Math.ceil(g/b);n.push(new q({level:0,scale:x,resolution:x*k}));for(v=1;v<u;v++)x/=2**b,n.push(new q({level:v,scale:x,resolution:x*k}))}return new p({dpi:96,lods:n,origin:a,size:[d,d],spatialReference:f})};e=t.prototype;e.readOrigin=
function(a,b){return r.fromJSON({spatialReference:b.spatialReference,...a})};e.readSize=function(a,b){return[b.cols,b.rows]};e.writeSize=function(a,b){b.cols=a[0];b.rows=a[1]};e.zoomToScale=function(a){const b=this.scales;if(0>=a)return b[0];if(a>=b.length-1)return b[b.length-1];const c=Math.floor(a);return b[c]/(b[c]/b[c+1])**(a-c)};e.scaleToZoom=function(a){const b=this.scales,c=b.length-1;let d=0;for(;d<c;d++){const f=b[d],g=b[d+1];if(f<=a)break;if(g===a)return d+1;if(f>a&&g<a)return d+Math.log(f/
a)/Math.log(f/g)}return d};e.snapScale=function(a,b=.95){a=this.scaleToZoom(a);return a%Math.floor(a)>=b?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};e.tileAt=function(a,b,c,d){var f=this.lodAt(a);if(!f)return null;let g;if("number"===typeof b)g=b,b=c;else{if(w.equals(b.spatialReference,this.spatialReference))g=b.x,b=b.y;else{d=I.project(b,this.spatialReference);if(E.isNone(d))return null;g=d.x;b=d.y}d=c}c=f.resolution*this.size[0];f=f.resolution*this.size[1];d||(d=new J.TileKey(null,
0,0,0,D.create()));d.level=a;d.row=Math.floor((this.origin.y-b)/f+.001);d.col=Math.floor((g-this.origin.x)/c+.001);this.updateTileInfo(d);return d};e.updateTileInfo=function(a,b=p.ExtrapolateOptions.NONE){var c=this.lodAt(a.level);c||b!==p.ExtrapolateOptions.POWER_OF_TWO||(b=this.lods[this.lods.length-1],b.level<a.level&&(c=b));if(c){var d=a.level-c.level;b=c.resolution*this.size[0]/2**d;c=c.resolution*this.size[1]/2**d;a.id=`${a.level}/${a.row}/${a.col}`;a.extent||(a.extent=D.create());a.extent[0]=
this.origin.x+a.col*b;a.extent[1]=this.origin.y-(a.row+1)*c;a.extent[2]=a.extent[0]+b;a.extent[3]=a.extent[1]+c}};e.upsampleTile=function(a){const b=this._upsampleLevels[a.level];if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+.001);a.col=Math.floor(a.col/b.factor+.001);this.updateTileInfo(a);return!0};e.getTileBounds=function(a,b){var c=this.lodAt(b.level);if(null==c)return null;var {resolution:d}=c;c=d*this.size[0];d*=this.size[1];a[0]=this.origin.x+b.col*
c;a[1]=this.origin.y-(b.row+1)*d;a[2]=a[0]+c;a[3]=a[1]+d;return a};e.lodAt=function(a){return this._levelToLOD?.[a]??null};e.clone=function(){return p.fromJSON(this.write({}))};e.getOrCreateCompatible=function(a,b){if(256===this.size[0]&&256===this.size[1])return 256===a?this:null;const c=[],d=this.lods.length;for(let f=0;f<d;f++){const g=this.lods[f];c.push(new q({level:g.level,scale:g.scale,resolution:g.resolution*b}))}return new p({size:[a,a],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,
origin:this.origin,spatialReference:this.spatialReference,lods:c})};e._initializeUpsampleLevels=function(){const a=this.lods;this._upsampleLevels=[];let b=null;for(let c=0;c<a.length;c++){const d=a[c];this._upsampleLevels[d.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/d.resolution:0};b=d}};z._createClass(t,[{key:"isWrappable",get:function(){const {spatialReference:a,origin:b}=this;if(a&&b){const c=w.getInfo(a);return a.isWrappable&&!!c&&Math.abs(c.origin[0]-b.x)<=c.dx}return!1}},{key:"lods",
set:function(a){let b=0,c=0;const d=[],f=this._levelToLOD={};a&&(b=-Infinity,c=Infinity,a.forEach(g=>{d.push(g.scale);b=g.scale>b?g.scale:b;c=g.scale<c?g.scale:c;f[g.level]=g}));this._set("scales",d);this._set("minScale",b);this._set("maxScale",c);this._set("lods",a);this._initializeUpsampleLevels()}}]);return t}(h.JSONSupport);l.__decorate([m.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);l.__decorate([m.property({type:Number,json:{write:!0}})],h.prototype,"dpi",
void 0);l.__decorate([m.property({type:String,json:{read:y.read,write:y.write,origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"format",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"isWrappable",null);l.__decorate([m.property({type:r,json:{write:!0}})],h.prototype,"origin",void 0);l.__decorate([B.reader("origin")],h.prototype,"readOrigin",null);l.__decorate([m.property({type:[q],value:null,json:{write:!0}})],h.prototype,"lods",null);l.__decorate([m.property({readOnly:!0})],
h.prototype,"minScale",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"maxScale",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"scales",void 0);l.__decorate([m.property({cast:e=>Array.isArray(e)?e:"number"===typeof e?[e,e]:[256,256]})],h.prototype,"size",void 0);l.__decorate([B.reader("size",["rows","cols"])],h.prototype,"readSize",null);l.__decorate([H.writer("size",{cols:{type:A.Integer},rows:{type:A.Integer}})],h.prototype,"writeSize",null);l.__decorate([m.property({type:C,
json:{write:!0}})],h.prototype,"spatialReference",void 0);h=p=l.__decorate([G.subclass("esri.layers.support.TileInfo")],h);(function(e){e=e.ExtrapolateOptions||(e.ExtrapolateOptions={});e[e.NONE=0]="NONE";e[e.POWER_OF_TWO=1]="POWER_OF_TWO"})(h||(h={}));return h});