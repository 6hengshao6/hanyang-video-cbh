// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../RasterInfo ./BaseRaster ../rasterFunctions/pixelUtils ../rasterFunctions/stretchUtils ../../../geometry/Extent ../../../geometry/SpatialReference".split(" "),
function(k,l,e,u,q,v,r,I,J,K,w,x,y,z,A,B,C){e=function(f){function g(){var a=D.apply(this,arguments);a.datasetFormat="MEMORY";a.data=null;return a}k._inherits(g,f);var D=k._createSuper(g);f=g.prototype;f.open=async function(a){await this.init();var b=this.data;const {pixelBlock:c,statistics:d,histograms:m,name:t,keyProperties:E,nativeExtent:F,transform:G}=this.data,{width:n,height:p,pixelType:H}=c,h=b.extent??new B({xmin:-.5,ymin:.5,xmax:n-.5,ymax:p-.5,spatialReference:new C({wkid:3857})});b=new x({width:n,
height:p,pixelType:H,extent:h,nativeExtent:F,transform:G,pixelSize:{x:h.width/n,y:h.height/p},spatialReference:h.spatialReference,bandCount:c.pixels.length,keyProperties:E||{},statistics:d,isPseudoSpatialReference:b.isPseudoSpatialReference??!b.extent,histograms:m});this.createRemoteDatasetStorageInfo(b,512,512);this._set("rasterInfo",b);this.updateTileInfo();await this._buildInMemoryRaster(c,{width:512,height:512},a);this.datasetName=t;this.url="/InMemory/"+t};f.fetchRawTile=function(a,b,c,d){a=
this._pixelBlockTiles.get(`${a}/${b}/${c}`);return Promise.resolve(a)};f._buildInMemoryRaster=async function(a,b,c){var d=this.rasterInfo.storageInfo.maximumPyramidLevel;const m=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:a,tileSize:b,maximumPyramidLevel:d},c):Promise.resolve(z.split(a,b,d));b=q.isSome(this.rasterInfo.statistics);d=q.isSome(this.rasterInfo.histograms);a=b?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:a},
c):Promise.resolve(A.estimateStatisticsHistograms(a));a=await v.eachAlways([m,a]);if(!a[0].value&&a[1].value)throw new u("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=a[0].value;b||(this.rasterInfo.statistics=a[1].value?.statistics);d||(this.rasterInfo.histograms=a[1].value?.histograms)};return k._createClass(g)}(y);l.__decorate([r.property({type:String,json:{write:!0}})],e.prototype,"datasetFormat",void 0);l.__decorate([r.property()],e.prototype,"data",void 0);
return e=l.__decorate([w.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],e)});