// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/has ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/object ../../core/sql ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/extensions/serializableProperty/reader ../../form/FormTemplate ./commonProperties ./featureLayerUtils ./FeatureTemplate ./fieldProperties ./fieldUtils ./LabelClass ./labelingInfo ../../rest/support/Query ../../support/popupUtils ../../symbols/support/defaults".split(" "),
function(G,e,P,B,na,oa,pa,qa,Q,H,R,ra,sa,C,c,S,v,T,U,D,V,W,K,h,ta,E,X,Y,Z,aa,ba,x,ca,L,F,da,ea,fa,ha,ia,I){function y(b){const k=b.json.write;"object"===typeof k?k.ignoreOrigin=!0:b.json.write={ignoreOrigin:!0};return b}function ja(b){switch(b){case "point":case "multipoint":return I.defaultPointSymbol2D.clone();case "polyline":return I.defaultPolylineSymbol2D.clone();case "polygon":case "multipatch":return I.defaultPolygonSymbol2D.clone();default:return null}}function ka(b,k){return k?"unique-value"===
b?.type&&"string"===typeof b.field&&b.field.toLowerCase()===k.toLowerCase()&&!b.field2&&!b.field3&&!b.valueExpression:!1}function M(b,k){return null==b?null:k.subtypes?.find(z=>z.code===b)}const la="charts editingEnabled formTemplate labelsVisible labelingInfo legendEnabled minScale maxScale opacity popupEnabled popupTemplate renderer subtypeCode templates title visible".split(" ");B={key:"type",base:Q,errorContext:"renderer",typeMap:{simple:H,"unique-value":R,"class-breaks":B}};F=F.defineFieldProperties();
const N=aa.createTypeReader({types:B});let ma=0;c=function(b){function k(a){a=z.call(this,a);a.charts=null;a.editingEnabled=!0;a.fieldOverrides=null;a.fieldsIndex=null;a.formTemplate=null;a.id=`${Date.now().toString(16)}-subtype-sublayer-${ma++}`;a.type="subtype-sublayer";a.labelsVisible=!0;a.labelingInfo=null;a.layerType="ArcGISFeatureLayer";a.legendEnabled=!0;a.listMode="show";a.minScale=0;a.maxScale=0;a.opacity=1;a.popupEnabled=!0;a.popupTemplate=null;a.subtypeCode=null;a.templates=null;a.title=
null;a.visible=!0;return a}G._inherits(k,b);var z=G._createSuper(k);b=k.prototype;b.writeFieldOverrides=function(a,f,d){const {fields:g,parent:l}=this;let m;if(g){m=[];let p=0;g.forEach(({name:w,alias:A,editable:n,visible:r})=>{if(r&&(r=l?.fields?.find(J=>J.name===w))){var q={name:w},t=!1;A!==r.alias&&(q.alias=A,t=!0);n!==r.editable&&(q.editable=n,t=!0);m.push(q);t&&p++}});0===p&&m.length===g.length&&(m=null)}else m=v.clone(a);m?.length&&W.setDeepValue(d,m,f)};b.readRendererFromService=function(a,
f,d){if("Table"===f.type)return null;d=N(f.drawingInfo?.renderer,f,d);a=void 0;const {subtypeCode:g}=this;null!=g&&ka(d,f.subtypeField)?(f=d.uniqueValueInfos?.find(({value:l})=>{l="number"===typeof l?String(l):l;return l===String(g)}))&&(a=new H({symbol:f.symbol})):"simple"!==d?.type||d.visualVariables?.length||(a=d);return a};b.readRenderer=function(a,f,d){if((a=f?.layerDefinition?.drawingInfo?.renderer)&&!a.visualVariables?.some(g=>"rotationInfo"!==g.type))return N(a,f,d)||void 0};b.readTemplatesFromService=
function(a,f){a=this.subtypeCode;let d=null;switch(f.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":d="point";break;case "esriGeometryPolyline":d="line";break;case "esriGeometryPolygon":case "esriGeometryMultiPatch":d="polygon";break;default:d=null}const g={};var l=M(a,f);if(D.isSome(l)){({defaultValues:l}=l);for(const m in l)g[m]=l[m]}g[f.subtypeField]=a;return[new L({name:"New Feature",drawingTool:d,prototype:{attributes:g}})]};b.readTitleFromService=function(a,f){a=M(this.subtypeCode,
f);return D.isSome(a)?a.name:null};b.addAttachment=async function(a,f){const {parent:d}=this;if(!d)throw u("addAttachment");if(a.getAttribute(d.subtypeField)!==this.subtypeCode)throw new C("subtype-sublayer:addAttachment","The feature provided does not belong to this SubtypeSublayer");return d.addAttachment(a,f)};b.updateAttachment=async function(a,f,d){const {parent:g}=this;if(!g)throw u("updateAttachment");if(a.getAttribute(g.subtypeField)!==this.subtypeCode)throw new C("subtype-sublayer:updateAttachment",
"The feature provided does not belong to this SubtypeSublayer");return g.updateAttachment(a,f,d)};b.deleteAttachments=async function(a,f){const {parent:d}=this;if(!d)throw u("deleteAttachments");if(a.getAttribute(d.subtypeField)!==this.subtypeCode)throw new C("subtype-sublayer:deleteAttachments","The feature provided does not belong to this SubtypeSublayer");return d.deleteAttachments(a,f)};b.applyEdits=async function(a,f){if(!this.parent)throw u("applyEdits");return this.parent.applyEdits(a,f)};
b.createPopupTemplate=function(a){let f=this;const {parent:d,fields:g,title:l}=this;if(d){const {displayField:m,editFieldsInfo:p,objectIdField:w}=d;f={displayField:m,editFieldsInfo:p,fields:g,objectIdField:w,title:l}}return ia.createPopupTemplate(f,a)};b.createQuery=function(){if(!this.parent)throw u("createQuery");const a=ca.createQuery(this.parent);a.where=K.sqlAnd(`${this.parent.subtypeField}=${this.subtypeCode}`,this.parent.definitionExpression);return a};b.getField=function(a){return this.fieldsIndex.get(a)};
b.getFieldDomain=function(a){return this._getLayerDomain(a)};b.hasUserOverrides=function(){return la.some(a=>this.originIdOf(a)===Z.OriginId.USER)};b.queryAttachments=async function(a,f){const d=await this.load();if(!d.parent)throw u("queryAttachments");const g=a.clone();g.where=O(g.where,d.parent.subtypeField,d.subtypeCode);return d.parent.queryAttachments(a,f)};b.queryFeatures=async function(a,f){const d=await this.load();if(!d.parent)throw u("queryFeatures");const g=ha.from(a)??d.createQuery();
D.isSome(a)&&(g.where=O(g.where,d.parent.subtypeField,d.subtypeCode));return d.parent.queryFeatures(g,f)};b._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};G._createClass(k,[{key:"capabilities",get:function(){return this.parent?.capabilities}},{key:"effectiveCapabilities",get:function(){return this.parent?.effectiveCapabilities}},{key:"effectiveEditingEnabled",get:function(){const {parent:a}=this;return a?a.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}},
{key:"elevationInfo",get:function(){return this.parent?.elevationInfo}},{key:"fields",get:function(){const {parent:a,fieldOverrides:f,subtypeCode:d}=this;var g=a?.fields;if(!a||!g?.length)return null;const {subtypes:l,subtypeField:m}=a;var p=l?.find(r=>r.code===d);const w=p?.defaultValues;p=p?.domains;const A=[];for(const r of g){g=r.clone();const {name:q}=g;var n=f?.find(t=>t.name===q);g.visible=!f||!!n;if(n){const {alias:t,editable:J}=n;t&&(g.alias=t);!1===J&&(g.editable=!1)}n=w?.[q]??null;g.defaultValue=
q===m?d:n;n=p?.[q]??null;g.domain=q===m?null:n?"inherited"===n.type?g.domain:n.clone():null;A.push(g)}return A}},{key:"geometryType",get:function(){return this.parent?.geometryType}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:f}=this;return{minScale:a,maxScale:f}}},{key:"objectIdField",get:function(){this.parent||U.getLogger("esri.layers.support.SubtypeSublayer").error(u("objectIdField"));return this.parent?.objectIdField}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},
{key:"renderer",get:function(){if(this._isOverridden("renderer"))return this._get("renderer");const {parent:a}=this;return a&&!a.isTable&&"mesh"!==a.geometryType?new H({symbol:ja(a.geometryType)}):null},set:function(a){da.fixRendererFields(a,this.fieldsIndex);this._override("renderer",a)}},{key:"spatialReference",get:function(){return this.parent?.spatialReference}},{key:"url",get:function(){return this.parent?.url}},{key:"userHasUpdateItemPrivileges",get:function(){return!!this.parent?.userHasUpdateItemPrivileges}}]);
return k}(c.HandleOwnerMixin(V.MultiOriginJSONMixin(S.IdentifiableMixin(T))));e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"capabilities",null);e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"effectiveCapabilities",null);e.__decorate([h.property({json:{write:{ignoreOrigin:!0}}})],c.prototype,"charts",void 0);e.__decorate([h.property({type:Boolean,nonNullable:!0,json:{name:"enableEditing",write:{ignoreOrigin:!0}}})],c.prototype,"editingEnabled",void 0);e.__decorate([h.property({type:Boolean,
readOnly:!0})],c.prototype,"effectiveEditingEnabled",null);e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"elevationInfo",null);e.__decorate([h.property({readOnly:!0,json:{name:"layerDefinition.fieldOverrides",origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],c.prototype,"fieldOverrides",void 0);e.__decorate([Y.writer("fieldOverrides")],c.prototype,"writeFieldOverrides",null);e.__decorate([h.property({...F.fields,readOnly:!0,json:{read:!1}})],c.prototype,"fields",
null);e.__decorate([h.property(F.fieldsIndex)],c.prototype,"fieldsIndex",void 0);e.__decorate([h.property({type:ba,json:{name:"formInfo",write:{ignoreOrigin:!0}}})],c.prototype,"formTemplate",void 0);e.__decorate([h.property({type:String,readOnly:!0,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],c.prototype,"id",void 0);e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"geometryType",null);e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",
void 0);e.__decorate([h.property(y(v.clone(x.labelsVisible)))],c.prototype,"labelsVisible",void 0);e.__decorate([h.property({type:[ea],json:{name:"layerDefinition.drawingInfo.labelingInfo",origins:{service:{read:!1}},read:{reader:fa.reader},write:{ignoreOrigin:!0}}})],c.prototype,"labelingInfo",void 0);e.__decorate([h.property({type:["ArcGISFeatureLayer"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],c.prototype,"layerType",void 0);e.__decorate([h.property(y(v.clone(x.legendEnabled)))],c.prototype,
"legendEnabled",void 0);e.__decorate([h.property({type:["show","hide"]})],c.prototype,"listMode",void 0);e.__decorate([h.property((()=>{const b=v.clone(x.minScale);b.json.origins.service.read=!1;return y(b)})())],c.prototype,"minScale",void 0);e.__decorate([h.property((()=>{const b=v.clone(x.maxScale);b.json.origins.service.read=!1;return y(b)})())],c.prototype,"maxScale",void 0);e.__decorate([h.property({readOnly:!0})],c.prototype,"effectiveScaleRange",null);e.__decorate([h.property({readOnly:!0,
json:{read:!1}})],c.prototype,"objectIdField",null);e.__decorate([h.property({type:Number,range:{min:0,max:1},nonNullable:!0,json:{write:{ignoreOrigin:!0}}})],c.prototype,"opacity",void 0);e.__decorate([h.property()],c.prototype,"parent",void 0);e.__decorate([h.property(y(v.clone(x.popupEnabled)))],c.prototype,"popupEnabled",void 0);e.__decorate([h.property({type:P,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],c.prototype,"popupTemplate",void 0);e.__decorate([h.property({readOnly:!0})],c.prototype,
"defaultPopupTemplate",null);e.__decorate([h.property({types:B,json:{write:{target:"layerDefinition.drawingInfo.renderer",ignoreOrigin:!0}}})],c.prototype,"renderer",null);e.__decorate([E.reader("service","renderer",["drawingInfo.renderer","subtypeField","type"])],c.prototype,"readRendererFromService",null);e.__decorate([E.reader("renderer",["layerDefinition.drawingInfo.renderer"])],c.prototype,"readRenderer",null);e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"spatialReference",
null);e.__decorate([h.property({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],c.prototype,"subtypeCode",void 0);e.__decorate([h.property({type:[L],json:{name:"layerDefinition.templates",write:{ignoreOrigin:!0}}})],c.prototype,"templates",void 0);e.__decorate([E.reader("service","templates",["geometryType","subtypeField","subtypes","type"])],c.prototype,"readTemplatesFromService",null);e.__decorate([h.property({type:String,json:{write:{ignoreOrigin:!0}}})],c.prototype,"title",
void 0);e.__decorate([E.reader("service","title",["subtypes"])],c.prototype,"readTitleFromService",null);e.__decorate([h.property({readOnly:!0,json:{read:!1}})],c.prototype,"url",null);e.__decorate([h.property({readOnly:!0})],c.prototype,"userHasUpdateItemPrivileges",null);e.__decorate([h.property({type:Boolean,nonNullable:!0,json:{name:"visibility",write:{ignoreOrigin:!0}}})],c.prototype,"visible",void 0);c=e.__decorate([X.subclass("esri.layers.support.SubtypeSublayer")],c);const O=(b,k,z)=>{const a=
new RegExp(`${k}=[0-9]`);k=`${k}=${z}`;b=D.unwrapOr(b,"");return a.test(b)?b.replace(a,k):K.sqlAnd(k,b)},u=b=>new C(`This sublayer must have a parent SubtypeGroupLayer in order to use ${b}`);return c});