// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Collection ../core/CollectionFlattener ../core/Error ../core/lang ../core/loadAll ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/SpatialReference ./Layer ./buildingSublayers/BuildingComponentSublayer ./buildingSublayers/BuildingGroupSublayer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/BuildingFilter ./support/BuildingSummaryStatistics ./support/commonProperties ./support/FetchAssociatedFeatureLayer".split(" "),
function(k,e,n,A,u,v,B,q,C,d,D,E,g,Q,w,F,G,H,x,m,I,J,K,L,M,r,N,y,t,O){const z=n.ofType(N);n=v.clone(m.sublayersProperty);n.json.origins["web-scene"]={type:[x],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}};n.json.origins["portal-item"]={type:[x],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}};d=function(c){function l(a){var b=P.call(this,a);b.operationalLayerType="BuildingSceneLayer";b.allSublayers=new A({getCollections:()=>[b.sublayers],getChildrenFunction:h=>"building-group"===h.type?
h.sublayers:null});b.sublayers=null;b._sublayerOverrides=null;b.filters=new z;b.activeFilterId=null;b.summaryStatistics=null;b.outFields=null;b.type="building-scene";return b}k._inherits(l,c);var P=k._createSuper(l);c=l.prototype;c.normalizeCtorArgs=function(a){return"string"===typeof a?{url:a}:a??{}};c.destroy=function(){this.allSublayers.destroy()};c.readSublayers=function(a,b,h){a=m.readSublayers(a,b,h);m.forEachSublayer(a,f=>f.layer=this);this._sublayerOverrides&&(this.applySublayerOverrides(a,
this._sublayerOverrides),this._sublayerOverrides=null);return a};c.applySublayerOverrides=function(a,{overrides:b,context:h}){m.forEachSublayer(a,f=>f.read(b.get(f.id),h))};c.readSublayerOverrides=function(a,b){const h=new Map;for(const f of a)null==f||"object"!==typeof f||"number"!==typeof f.id?b.messages?.push(new u("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",{value:f})):h.set(f.id,f);return{overrides:h,context:b}};c.writeSublayerOverrides=
function(a,b,h){const f=[];m.forEachSublayer(this.sublayers,p=>{p=p.write({},h);1<Object.keys(p).length&&f.push(p)});0<f.length&&(b.sublayers=f)};c.writeUnappliedOverrides=function(a,b){b.sublayers=[];a.overrides.forEach(h=>{b.sublayers.push(v.clone(h))})};c.write=function(a,b){a=k._get(k._getPrototypeOf(l.prototype),"write",this).call(this,a,b);!b||"web-scene"!==b.origin&&"portal-item"!==b.origin||(this.sublayers?this.writeSublayerOverrides(this.sublayers,a,b):this._sublayerOverrides&&this.writeUnappliedOverrides(this._sublayerOverrides,
a));return a};c.read=function(a,b){k._get(k._getPrototypeOf(l.prototype),"read",this).call(this,a,b);b&&("web-scene"===b.origin||"portal-item"===b.origin)&&null!=a&&Array.isArray(a.sublayers)&&(a=this.readSublayerOverrides(a.sublayers,b),this.sublayers?this.applySublayerOverrides(this.sublayers,a):this._sublayerOverrides=a)};c.readSummaryStatistics=function(a,b){return"string"===typeof b.statisticsHRef?(a=E.join(this.parsedUrl?.path,b.statisticsHRef),new y({url:a})):null};c.load=function(a){const b=
C.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).catch(D.throwIfAbortError).then(()=>this._fetchService(b)).then(()=>this._fetchAssociatedFeatureService(b));this.addResolvingPromise(a);return Promise.resolve(this)};c.loadAll=function(){return B.loadAll(this,a=>{m.forEachSublayer(this.sublayers,b=>{"building-group"!==b.type&&a(b)});this.summaryStatistics&&a(this.summaryStatistics)})};c.saveAs=async function(a,b){return this._debouncedSaveOperations(r.SaveOperationType.SAVE_AS,
{...b,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"},a)};c.save=async function(){return this._debouncedSaveOperations(r.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"})};c.validateLayer=function(a){if(!a.layerType||"Building"!==a.layerType)throw new u("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:a.layerType});};c._getTypeKeywords=function(){return["Building"]};
c._validateElevationInfo=function(){const a=this.elevationInfo;a&&("absolute-height"!==a.mode&&q.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Building scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&q.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Building scene layers do not support featureExpressionInfo"))};c._fetchAssociatedFeatureService=async function(a){a=new O.FetchAssociatedFeatureLayer(this.parsedUrl,
this.portalItem,this.apiKey,a);try{this.associatedFeatureServiceItem=await a.fetchPortalItem()}catch(b){q.getLogger(this.declaredClass).warn("Associated feature service item could not be loaded",b)}};k._createClass(l,[{key:"elevationInfo",set:function(a){this._set("elevationInfo",a);this._validateElevationInfo()}}]);return l}(r.SceneService(J.ArcGISService(K.OperationalLayer(L.PortalLayer(M.ScaleRangeLayer(d.MultiOriginJSONMixin(I.APIKeyMixin(H))))))));e.__decorate([g.property({type:["BuildingSceneLayer"]})],
d.prototype,"operationalLayerType",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"allSublayers",void 0);e.__decorate([g.property(n)],d.prototype,"sublayers",void 0);e.__decorate([w.reader("service","sublayers")],d.prototype,"readSublayers",null);e.__decorate([g.property({type:z,nonNullable:!0,json:{write:!0}})],d.prototype,"filters",void 0);e.__decorate([g.property({type:String,json:{write:!0}})],d.prototype,"activeFilterId",void 0);e.__decorate([g.property({readOnly:!0,type:y})],d.prototype,
"summaryStatistics",void 0);e.__decorate([w.reader("summaryStatistics",["statisticsHRef"])],d.prototype,"readSummaryStatistics",null);e.__decorate([g.property({type:[String],json:{read:!1}})],d.prototype,"outFields",void 0);e.__decorate([g.property(t.sceneLayerFullExtent)],d.prototype,"fullExtent",void 0);e.__decorate([g.property({type:["show","hide","hide-children"]})],d.prototype,"listMode",void 0);e.__decorate([g.property(t.readOnlyService(G))],d.prototype,"spatialReference",void 0);e.__decorate([g.property(t.elevationInfo)],
d.prototype,"elevationInfo",null);e.__decorate([g.property({json:{read:!1},readOnly:!0})],d.prototype,"type",void 0);e.__decorate([g.property()],d.prototype,"associatedFeatureServiceItem",void 0);return d=e.__decorate([F.subclass("esri.layers.BuildingSceneLayer")],d)});